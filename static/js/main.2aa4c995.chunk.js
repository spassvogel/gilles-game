(this["webpackJsonpgilles-game"]=this["webpackJsonpgilles-game"]||[]).push([[0],{107:function(e,t,n){e.exports=n(250)},134:function(e,t,n){},160:function(e,t,n){},210:function(e,t,n){},211:function(e,t,n){},212:function(e,t,n){},213:function(e,t,n){},214:function(e,t,n){},215:function(e,t,n){},217:function(e,t,n){},218:function(e,t,n){},219:function(e,t,n){},220:function(e,t,n){},221:function(e,t,n){},222:function(e,t,n){},223:function(e,t,n){},224:function(e,t,n){},225:function(e,t,n){},226:function(e,t,n){},227:function(e,t,n){},228:function(e,t,n){},232:function(e,t,n){},233:function(e,t,n){},234:function(e,t,n){},235:function(e,t,n){},237:function(e,t,n){},238:function(e,t,n){},239:function(e,t,n){},247:function(e,t){},250:function(e,t,n){"use strict";n.r(t);var r,o,a,c=n(16),i=n(32),s=n.n(i),u=n(42),l=n(93),m=n.n(l);!function(e){e.clearCombatAction="clearCombatAction",e.startCombatAction="startCombatAction",e.moveActor="moveActor"}(r||(r={})),function(e){e[e.player=0]="player",e[e.enemy=1]="enemy"}(o||(o={})),function(e){e.move="move",e.slash="slash",e.shoot="shoot"}(a||(a={}));var d,p,g,f={actors:[{allegiance:o.player,health:100,location:[3,5],name:"c4a5d270",remainingAP:5},{allegiance:o.player,health:100,location:[4,6],name:"2e655832",remainingAP:4}],turn:o.player},v=function(e,t){var n,c,i=t.getState().combat;if(i.action&&i.action.endsAt<Date.now())if(i.turn===o.enemy);else if(i.turn===o.player){switch(i.action.type){case a.move:t.dispatch((n=i.action.actor,c=i.action.target,{type:r.moveActor,actor:n,location:c})),t.dispatch({type:r.clearCombatAction})}return{action:null}}return null},h=n(0),b=n.n(h),y=n(51),w=n(10);function O(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:p.common,r=arguments.length>3?arguments[3]:void 0;return{type:g.addLogEntry,key:e,channel:n,channelContext:r,context:t}}!function(e){e.gameTick="gameTick"}(d||(d={})),function(e){e[e.common=0]="common",e[e.town=1]="town",e[e.quest=2]="quest"}(p||(p={})),function(e){e.addLogEntry="addLogEntry"}(g||(g={}));var k,j,E,T=function(e){var t=e.split(".").map((function(e){return Number(e)}));if(3!==t.length)throw new Error("Received invalid version string: ".concat(e));t.forEach((function(e){if(e>=1024)throw new Error("Version string invalid, ".concat(e," is too large"))}));for(var n=0,r=0;r<3;r++)n|=t[r]<<10*r;return n}("0.0.4"),I=n(2),C=n(4),x=n(5),S=n(14),N=n(12),q=n(54),D=n(13),A=(n(134),function(e){var t=e.className||"";return h.createElement("div",{className:"ui-button widgets-squareiconbutton ".concat(t),onClick:function(t){e.onClick&&e.onClick(t)}},e.text)}),R=(n(78),function(e){var t=(e.active?"active":"")+(e.className||"");return h.createElement("li",{className:"widget-tab ".concat(t),onClick:function(t){e.onClick&&e.onClick(t)}},e.children)}),P=n(7),M=function(e){var t=null;e.children&&e.children.length&&(t=e.children[0].props.id);var n=Object(h.useState)(t),r=Object(P.a)(n,2),o=r[0],a=r[1],c=e.className||"",i=b.a.Children.map(e.children,(function(e){return b.a.cloneElement(e,{active:e.props.id===o,onClick:function(){s(e.props.id)}})})),s=function(t){a(t),e.onTabSelected&&e.onTabSelected(t)};return b.a.createElement("ul",{className:"widget-tabstrip ".concat(c),onClick:function(t){e.onClick&&e.onClick(t)}},i)};!function(e){e[e.deed=0]="deed",e[e.apparel=1]="apparel",e[e.material=2]="material",e[e.questItem=3]="questItem",e[e.trinket=4]="trinket",e[e.weapon=5]="weapon"}(k||(k={})),function(e){e.deedForLumbermill="deedForLumbermill",e.deedForWeaponsmith="deedForWeaponsmith",e.boots1="boots1",e.boots2="boots2",e.boots3="boots3",e.chainmailHood="chainmailHood",e.chest="chest",e.clothGloves="clothGloves",e.cowl="cowl",e.fedora="fedora",e.druidChest="druidChest",e.druidFeet="druidFeet",e.druidHands="druidHands",e.druidHead="druidHead",e.druidLegs="druidLegs",e.greaves1="greaves1",e.greaves2="greaves2",e.hornedHelmet="hornedHelmet",e.leatherGloves="leatherGloves",e.nomadHelmet="nomadHelmet",e.pants1="pants1",e.pants2="pants2",e.plateChest1="plateChest1",e.plateChest2="plateChest2",e.plateChest3="plateChest3",e.plateChest4="plateChest4",e.plateGloves1="plateGloves1",e.plateGloves2="plateGloves2",e.plateHelmet="plateHelmet",e.platePants="platePants",e.plateShoulders1="plateShoulders1",e.plateShoulders2="plateShoulders2",e.robe="robe",e.shoulders1="shoulders1",e.shoulders2="shoulders2",e.shoulders3="shoulders3",e.vest="vest",e.arrowheads="arrowheads",e.bolts="bolts",e.buckle="buckle",e.chain="chain",e.cogs="cogs",e.gem="gem",e.gunpowder="gunpowder",e.ingot="ingot",e.nails="nails",e.poisonVial="poisonVial",e.ribbon="ribbon",e.rope="rope",e.scales="scales",e.spring="spring",e.thread="thread",e.blueprints="blueprints",e.crate="crate",e.dynamite="dynamite",e.eye="eye",e.feather="feather",e.food="food",e.heart="heart",e.horn="horn",e.key="key",e.letters="letters",e.lockPicks="lockPicks",e.oil="oil",e.orcFinger="orcFinger",e.plans="plans",e.purpleGems="purpleGems",e.runestone="runestone",e.sandwich="sandwich",e.teeth="teeth",e.tooth="tooth",e.torch="torch",e.tusk="tusk",e.vase="vase",e.vial="vial",e.weeds="weeds",e.ring="ring",e.magicAmulet="magicAmulet",e.battleAxe="battleAxe",e.brassKnuckles="brassKnuckles",e.cleaver="cleaver",e.club="club",e.crossbow="crossbow",e.dagger="dagger",e.flail="flail",e.greatswordOfGwai="greatswordOfGwai",e.khopesh="khopesh",e.longbow="longbow",e.mace="mace",e.morningStar="morningStar",e.poisonedDagger="poisonedDagger",e.ravenStaff="ravenStaff",e.savageStaff="savageStaff",e.spear="spear",e.sword="sword",e.warhammer="warhammer"}(j||(j={}));var W,L=k.apparel,_="/img/items/apparel/";!function(e){e[e.feet=0]="feet",e[e.hands=1]="hands",e[e.chest=2]="chest",e[e.legs=3]="legs",e[e.head=4]="head",e[e.shoulders=5]="shoulders"}(W||(W={}));var H,B=(E={},Object(I.a)(E,j.boots1,{item:j.boots1,equipmentType:W.feet,itemType:L,subText:"These boots are made for questin'",iconImg:"".concat(_,"boots_1.png")}),Object(I.a)(E,j.boots2,{item:j.boots2,equipmentType:W.feet,itemType:L,subText:"",iconImg:"".concat(_,"boots_2.png")}),Object(I.a)(E,j.boots3,{item:j.boots3,equipmentType:W.feet,itemType:L,subText:"",iconImg:"".concat(_,"boots_3.png")}),Object(I.a)(E,j.chainmailHood,{item:j.chainmailHood,equipmentType:W.head,itemType:L,subText:"",iconImg:"".concat(_,"chainmail_hood.png"),armorRating:3}),Object(I.a)(E,j.chest,{item:j.chest,equipmentType:W.chest,itemType:L,subText:"",iconImg:"".concat(_,"chest_1.png"),armorRating:2}),Object(I.a)(E,j.clothGloves,{item:j.clothGloves,equipmentType:W.hands,itemType:L,subText:"",iconImg:"".concat(_,"cloth_gloves.png")}),Object(I.a)(E,j.cowl,{item:j.cowl,equipmentType:W.head,itemType:L,subText:"",iconImg:"".concat(_,"cowl.png"),armorRating:20}),Object(I.a)(E,j.druidChest,{item:j.druidHands,equipmentType:W.chest,itemType:L,subText:"",iconImg:"".concat(_,"druid-chest.png")}),Object(I.a)(E,j.druidFeet,{item:j.druidFeet,equipmentType:W.feet,itemType:L,subText:"",iconImg:"".concat(_,"druid-feet.png")}),Object(I.a)(E,j.druidHands,{item:j.druidHands,equipmentType:W.hands,itemType:L,subText:"",iconImg:"".concat(_,"druid-hands.png")}),Object(I.a)(E,j.druidHead,{item:j.druidHead,equipmentType:W.head,itemType:L,subText:"",iconImg:"".concat(_,"druid-head.png")}),Object(I.a)(E,j.druidLegs,{item:j.druidLegs,equipmentType:W.legs,itemType:L,subText:"",iconImg:"".concat(_,"druid-legs.png")}),Object(I.a)(E,j.fedora,{item:j.fedora,equipmentType:W.head,itemType:L,subText:"I study the blade",iconImg:"".concat(_,"fedora.png")}),Object(I.a)(E,j.greaves1,{item:j.greaves1,equipmentType:W.hands,itemType:L,subText:"",iconImg:"".concat(_,"greaves_1.png"),armorRating:10}),Object(I.a)(E,j.greaves2,{item:j.greaves2,equipmentType:W.hands,itemType:L,subText:"",iconImg:"".concat(_,"greaves_2.png")}),Object(I.a)(E,j.hornedHelmet,{item:j.hornedHelmet,equipmentType:W.head,itemType:L,subText:"",iconImg:"".concat(_,"horned_helmet.png")}),Object(I.a)(E,j.leatherGloves,{item:j.leatherGloves,equipmentType:W.hands,itemType:L,subText:"",iconImg:"".concat(_,"leather_gloves.png")}),Object(I.a)(E,j.nomadHelmet,{item:j.nomadHelmet,equipmentType:W.head,itemType:L,subText:"",iconImg:"".concat(_,"nomad_helmet.png")}),Object(I.a)(E,j.pants1,{item:j.pants1,equipmentType:W.legs,itemType:L,subText:"",iconImg:"".concat(_,"pants_1.png"),armorRating:10}),Object(I.a)(E,j.pants2,{item:j.pants2,equipmentType:W.legs,itemType:L,subText:"",iconImg:"".concat(_,"pants_2.png")}),Object(I.a)(E,j.plateChest1,{item:j.plateChest1,equipmentType:W.chest,itemType:L,subText:"",iconImg:"".concat(_,"plate_chest_1.png")}),Object(I.a)(E,j.plateChest2,{item:j.plateChest2,equipmentType:W.chest,itemType:L,subText:"",iconImg:"".concat(_,"plate_chest_2.png")}),Object(I.a)(E,j.plateChest3,{item:j.plateChest3,equipmentType:W.chest,itemType:L,subText:"",iconImg:"".concat(_,"plate_chest_3.png")}),Object(I.a)(E,j.plateChest4,{item:j.plateChest4,equipmentType:W.chest,itemType:L,subText:"",iconImg:"".concat(_,"plate_chest_4.png")}),Object(I.a)(E,j.plateGloves1,{item:j.plateGloves1,equipmentType:W.hands,itemType:L,subText:"",iconImg:"".concat(_,"plate_gloves_1.png")}),Object(I.a)(E,j.plateGloves2,{item:j.plateGloves2,equipmentType:W.hands,itemType:L,subText:"",iconImg:"".concat(_,"plate_gloves_2.png")}),Object(I.a)(E,j.plateHelmet,{item:j.plateHelmet,equipmentType:W.head,itemType:L,subText:"",iconImg:"".concat(_,"plate_helmet_1.png")}),Object(I.a)(E,j.platePants,{item:j.platePants,equipmentType:W.legs,itemType:L,subText:"",iconImg:"".concat(_,"plate_pants1.png")}),Object(I.a)(E,j.plateShoulders1,{item:j.plateShoulders1,equipmentType:W.shoulders,itemType:L,subText:"",iconImg:"".concat(_,"plate_shoulders_1.png")}),Object(I.a)(E,j.plateShoulders2,{item:j.plateShoulders2,equipmentType:W.shoulders,itemType:L,subText:"",iconImg:"".concat(_,"plate_shoulders_2.png")}),Object(I.a)(E,j.robe,{item:j.robe,equipmentType:W.chest,itemType:L,subText:"",iconImg:"".concat(_,"robe_1.png")}),Object(I.a)(E,j.shoulders1,{item:j.shoulders1,equipmentType:W.shoulders,itemType:L,subText:"",iconImg:"".concat(_,"shoulders_1.png")}),Object(I.a)(E,j.shoulders2,{item:j.shoulders2,equipmentType:W.shoulders,itemType:L,subText:"",iconImg:"".concat(_,"shoulders_2.png")}),Object(I.a)(E,j.shoulders3,{item:j.shoulders3,equipmentType:W.shoulders,itemType:L,subText:"",iconImg:"".concat(_,"shoulders_3.png")}),Object(I.a)(E,j.vest,{item:j.vest,equipmentType:W.chest,itemType:L,subText:"",iconImg:"".concat(_,"vest_1.png")}),E),G=B;!function(e){e[e.resource=0]="resource",e[e.production=1]="production",e[e.tavern=2]="tavern",e[e.warehouse=3]="warehouse"}(H||(H={}));var F,U,Q={type:H.production,cost:{gold:40,time:4e3},levels:[{displayName:"structure-alchemist-name",workerCapacity:2,cost:{gold:0},produces:[]},{displayName:"structure-alchemist-name",workerCapacity:5,cost:{gold:30},produces:[]},{displayName:"structure-alchemist-name",workerCapacity:10,cost:{gold:50},produces:[]}]},V=n(65),z=(n(135),function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"milliseconds";return V.duration(e,t).format("d [days] h [hours] m [min] s [sec]",{trim:"both"})}),K={item:j.boots1,cost:{resources:{wood:2,iron:15},time:18e5}},X={item:j.chest,cost:{resources:{wood:10,iron:45},time:36e5}},J={item:j.cowl,cost:{resources:{iron:15},time:36e5}},Y={cost:{gold:40,time:4e3},type:H.production,levels:[{displayName:"structure-armoursmith-name",workerCapacity:2,cost:{gold:0},produces:[K]},{displayName:"structure-armoursmith-name",workerCapacity:5,cost:{gold:30},produces:[K,X]},{displayName:"structure-armoursmith-name",workerCapacity:10,cost:{gold:50},produces:[K,X,J]}]},Z={type:H.resource,cost:{gold:40,time:4e3},levels:[{displayName:"structure-garden-name",workerCapacity:2,cost:{gold:0},generates:{food:2}},{displayName:"structure-garden-name",workerCapacity:5,cost:{gold:30},generates:{food:2}},{displayName:"structure-garden-name",workerCapacity:10,cost:{gold:50},generates:{food:2}}]},$={type:H.resource,cost:{gold:31,time:5e3},levels:[{displayName:"structure-lumber-mill-name",workerCapacity:2,cost:{gold:0},generates:{wood:2}},{displayName:"structure-lumber-mill-name",workerCapacity:5,cost:{gold:30},generates:{wood:2}},{displayName:"structure-lumber-mill-name",workerCapacity:10,cost:{gold:50},generates:{wood:2}}]},ee={cost:{gold:40,time:4e3},type:H.resource,levels:[{displayName:"structure-mine-name",workerCapacity:2,cost:{gold:0},generates:{iron:2}},{displayName:"structure-mine-name",workerCapacity:5,cost:{gold:30},generates:{iron:2}},{displayName:"structure-mine-name",workerCapacity:10,cost:{gold:50},generates:{iron:2}}]},te={cost:{gold:40,time:4e3},type:H.resource,levels:[{displayName:"structure-quarry-name",workerCapacity:2,cost:{gold:0},generates:{stone:2}},{displayName:"structure-quarry-name",workerCapacity:5,cost:{gold:30},generates:{stone:4}},{displayName:"structure-quarry-name",workerCapacity:10,cost:{gold:50},generates:{stone:6}}]},ne={cost:{gold:40,time:4e3},type:H.resource,levels:[{displayName:"structure-tannery-name",workerCapacity:2,cost:{gold:0},generates:{leather:2}},{displayName:"structure-tannery-name",workerCapacity:5,cost:{gold:30},generates:{leather:5}},{displayName:"structure-tannery-name",workerCapacity:10,cost:{gold:50},generates:{leather:7}}]},re={cost:{gold:40,time:4e3},type:H.tavern,levels:[{displayName:"structure-tavern-name",workerCapacity:2,cost:{gold:0},rooms:10},{displayName:"structure-tavern-name",workerCapacity:5,cost:{gold:30},rooms:12},{displayName:"structure-tavern-name",workerCapacity:10,cost:{gold:50},rooms:15}]},oe={cost:{gold:40,time:4e3},type:H.warehouse,levels:[{displayName:"structure-warehouse-name",workerCapacity:2,cost:{gold:0},maxResources:{fabric:200,food:200,iron:200,leather:200,stone:200,wood:200}},{displayName:"structure-warehouse-name",workerCapacity:5,cost:{gold:30},maxResources:{fabric:500,food:500,iron:500,leather:500,stone:500,wood:500}},{displayName:"structure-warehouse-name",workerCapacity:10,cost:{gold:50},maxResources:{fabric:1e3,food:1e3,iron:1e3,leather:1e3,stone:1e3,wood:1e3}}]},ae={item:j.crossbow,cost:{resources:{wood:20,iron:5},time:18e5}},ce={item:j.longbow,cost:{resources:{wood:40,iron:5},time:36e5}},ie={item:j.poisonedDagger,cost:{resources:{wood:50,iron:15},materials:[j.poisonVial],time:36e5}},se={item:j.dagger,cost:{resources:{wood:10,iron:10},time:36e5}},ue={item:j.sword,cost:{resources:{wood:10,iron:30},time:36e5}},le={item:j.khopesh,cost:{resources:{wood:15,iron:40},time:12e4}},me={type:H.production,cost:{gold:40,time:4e3},levels:[{displayName:"structure-weaponsmith-name",workerCapacity:2,cost:{gold:0},produces:[ae,se]},{displayName:"structure-weaponsmith-name",workerCapacity:5,cost:{gold:30},produces:[ae,se,ce]},{displayName:"structure-weaponsmith-name",workerCapacity:10,cost:{gold:50},produces:[ae,se,ce,ue,le]},{displayName:"structure-weaponsmith-name",workerCapacity:14,cost:{gold:50},produces:[ae,se,ce,ue,le,ie]}]},de={cost:{gold:40,time:4e3},type:H.resource,levels:[{displayName:"structure-weaver-name",workerCapacity:2,cost:{gold:0},generates:{fabric:2}},{displayName:"structure-weaver-name",workerCapacity:5,cost:{gold:30},generates:{fabric:5}},{displayName:"structure-weaver-name",workerCapacity:10,cost:{gold:50},generates:{fabric:7}}]},pe={item:j.torch,cost:{resources:{wood:2,fabric:1},time:6e4}},ge={item:j.sandwich,cost:{resources:{food:1},time:3e4}},fe={type:H.production,cost:{gold:40,time:4e3},levels:[{displayName:"structure-workshop-name",workerCapacity:2,cost:{gold:0},produces:[pe,ge]},{displayName:"structure-workshop-name",workerCapacity:5,cost:{gold:30},produces:[]},{displayName:"structure-workshop-name",workerCapacity:10,cost:{gold:50},produces:[]},{displayName:"structure-workshop-name",workerCapacity:14,cost:{gold:50},produces:[]}]};(U=F||(F={})).alchemist="alchemist",U.armoursmith="armoursmith",U.garden="garden",U.lumberMill="lumberMill",U.mine="mine",U.quarry="quarry",U.tavern="tavern",U.tannery="tannery",U.warehouse="warehouse",U.weaponsmith="weaponsmith",U.weaver="weaver",U.workshop="workshop";var ve={alchemist:Q,armoursmith:Y,garden:Z,lumberMill:$,mine:ee,quarry:te,tavern:re,tannery:ne,warehouse:oe,weaponsmith:me,weaver:de,workshop:fe};function he(e){return ve[e]}var be,ye,we,Oe,ke,je,Ee=k.deed,Te={deedForLumbermill:{item:j.deedForLumbermill,structure:F.lumberMill,itemType:Ee,subText:"It allows for the construction of a lumber mill",iconImg:"/img/items/deeds/deed.png"},deedForWeaponsmith:{item:j.deedForWeaponsmith,structure:F.weaponsmith,itemType:Ee,subText:"It allows for the construction of a weaponsmith",iconImg:"/img/items/deeds/deed.png"}},Ie=k.material,Ce="/img/items/materials/",xe=(be={},Object(I.a)(be,j.arrowheads,{item:j.arrowheads,itemType:Ie,iconImg:"".concat(Ce,"arrowheads.png")}),Object(I.a)(be,j.bolts,{item:j.bolts,itemType:Ie,iconImg:"".concat(Ce,"bolts.png")}),Object(I.a)(be,j.buckle,{item:j.buckle,itemType:Ie,iconImg:"".concat(Ce,"buckle.png")}),Object(I.a)(be,j.chain,{item:j.chain,itemType:Ie,iconImg:"".concat(Ce,"chain.png")}),Object(I.a)(be,j.cogs,{item:j.cogs,itemType:Ie,iconImg:"".concat(Ce,"cogs.png")}),Object(I.a)(be,j.gem,{item:j.gem,itemType:Ie,iconImg:"".concat(Ce,"gem.png")}),Object(I.a)(be,j.ingot,{item:j.ingot,itemType:Ie,iconImg:"".concat(Ce,"ingot.png")}),Object(I.a)(be,j.nails,{item:j.nails,itemType:Ie,iconImg:"".concat(Ce,"nails.png")}),Object(I.a)(be,j.poisonVial,{item:j.poisonVial,itemType:Ie,iconImg:"".concat(Ce,"poison-vial.png")}),Object(I.a)(be,j.ribbon,{item:j.ribbon,itemType:Ie,iconImg:"".concat(Ce,"ribbon.png")}),Object(I.a)(be,j.rope,{item:j.rope,itemType:Ie,iconImg:"".concat(Ce,"rope.png")}),Object(I.a)(be,j.gem,{item:j.gem,itemType:Ie,iconImg:"".concat(Ce,"gem.png")}),Object(I.a)(be,j.gunpowder,{item:j.gunpowder,itemType:Ie,iconImg:"".concat(Ce,"gunpowder.png")}),Object(I.a)(be,j.scales,{item:j.scales,itemType:Ie,iconImg:"".concat(Ce,"scales.png")}),Object(I.a)(be,j.spring,{item:j.spring,itemType:Ie,iconImg:"".concat(Ce,"spring.png")}),Object(I.a)(be,j.thread,{item:j.thread,itemType:Ie,iconImg:"".concat(Ce,"thread.png")}),be),Se=k.questItem,Ne="/img/items/quest-items/",qe=(ye={},Object(I.a)(ye,j.blueprints,{item:j.blueprints,itemType:Se,iconImg:"".concat(Ne,"blueprints.png")}),Object(I.a)(ye,j.crate,{item:j.crate,itemType:Se,iconImg:"".concat(Ne,"crate.png")}),Object(I.a)(ye,j.dynamite,{item:j.dynamite,itemType:Se,iconImg:"".concat(Ne,"dynamite.png")}),Object(I.a)(ye,j.eye,{item:j.eye,itemType:Se,iconImg:"".concat(Ne,"eye.png")}),Object(I.a)(ye,j.feather,{item:j.feather,itemType:Se,iconImg:"".concat(Ne,"feather.png")}),Object(I.a)(ye,j.food,{item:j.food,itemType:Se,iconImg:"".concat(Ne,"food.png")}),Object(I.a)(ye,j.heart,{item:j.heart,itemType:Se,iconImg:"".concat(Ne,"heart.png")}),Object(I.a)(ye,j.horn,{item:j.horn,itemType:Se,iconImg:"".concat(Ne,"horn.png")}),Object(I.a)(ye,j.key,{item:j.key,itemType:Se,iconImg:"".concat(Ne,"key.png")}),Object(I.a)(ye,j.letters,{item:j.letters,itemType:Se,iconImg:"".concat(Ne,"letters.png")}),Object(I.a)(ye,j.lockPicks,{item:j.lockPicks,itemType:Se,iconImg:"".concat(Ne,"lock-picks.png")}),Object(I.a)(ye,j.oil,{item:j.oil,itemType:Se,iconImg:"".concat(Ne,"oil.png")}),Object(I.a)(ye,j.orcFinger,{item:j.orcFinger,itemType:Se,iconImg:"".concat(Ne,"orc-finger.png")}),Object(I.a)(ye,j.plans,{item:j.plans,itemType:Se,iconImg:"".concat(Ne,"plans.png")}),Object(I.a)(ye,j.purpleGems,{item:j.purpleGems,itemType:Se,iconImg:"".concat(Ne,"purple-gems.png")}),Object(I.a)(ye,j.runestone,{item:j.runestone,itemType:Se,iconImg:"".concat(Ne,"runestone.png")}),Object(I.a)(ye,j.sandwich,{item:j.sandwich,itemType:Se,iconImg:"".concat(Ne,"sandwich.png")}),Object(I.a)(ye,j.teeth,{item:j.teeth,itemType:Se,iconImg:"".concat(Ne,"teeth.png")}),Object(I.a)(ye,j.tooth,{item:j.tooth,itemType:Se,iconImg:"".concat(Ne,"tooth.png")}),Object(I.a)(ye,j.torch,{item:j.torch,itemType:Se,iconImg:"".concat(Ne,"torch.png")}),Object(I.a)(ye,j.tusk,{item:j.tusk,itemType:Se,iconImg:"".concat(Ne,"tusk.png")}),Object(I.a)(ye,j.vase,{item:j.vase,itemType:Se,iconImg:"".concat(Ne,"vase.png")}),Object(I.a)(ye,j.vial,{item:j.vial,itemType:Se,iconImg:"".concat(Ne,"vial.png")}),Object(I.a)(ye,j.weeds,{item:j.weeds,itemType:Se,iconImg:"".concat(Ne,"weeds.png")}),ye),De=k.trinket,Ae=(we={},Object(I.a)(we,j.magicAmulet,{item:j.magicAmulet,itemType:De,iconImg:"".concat("/img/items/trinkets/","magic_amulet.png")}),Object(I.a)(we,j.ring,{item:j.ring,itemType:De,iconImg:"".concat("/img/items/trinkets/","ring.png")}),we),Re=k.weapon,Pe="/img/items/weapons/";!function(e){e[e.axe=0]="axe",e[e.bow=1]="bow",e[e.club=2]="club",e[e.crossbow=3]="crossbow",e[e.fist=4]="fist",e[e.flail=5]="flail",e[e.hammer=6]="hammer",e[e.melee=7]="melee",e[e.knife=8]="knife",e[e.staff=9]="staff",e[e.sword=10]="sword",e[e.poleArm=11]="poleArm"}(ke||(ke={})),function(e){e.kinetic="kinetic"}(je||(je={}));var Me=(Oe={},Object(I.a)(Oe,j.battleAxe,{item:j.battleAxe,itemType:Re,weaponType:ke.axe,subText:"It's an axe for battle",iconImg:"".concat(Pe,"battle_axe.png"),damage:Object(I.a)({},je.kinetic,20)}),Object(I.a)(Oe,j.brassKnuckles,{item:j.brassKnuckles,itemType:Re,weaponType:ke.melee,subText:" Brass knuckles are pieces of metal shaped to fit around the knuckles.",iconImg:"".concat(Pe,"brass_knuckles.png"),damage:Object(I.a)({},je.kinetic,10)}),Object(I.a)(Oe,j.crossbow,{item:j.crossbow,itemType:Re,weaponType:ke.crossbow,subText:"Shoots and reloads fast",iconImg:"".concat(Pe,"crossbow.png"),damage:Object(I.a)({},je.kinetic,3)}),Object(I.a)(Oe,j.cleaver,{item:j.cleaver,itemType:Re,weaponType:ke.knife,subText:"A cleaver is a large knife that varies in its shape but usually resembles a rectangular-bladed hatchet.",iconImg:"".concat(Pe,"cleaver.png"),damage:Object(I.a)({},je.kinetic,5)}),Object(I.a)(Oe,j.club,{item:j.club,itemType:Re,weaponType:ke.club,subText:"A club is among the simplest of all weapons: a short staff or stick, usually made of wood, wielded as a weapon",iconImg:"".concat(Pe,"club.png"),damage:Object(I.a)({},je.kinetic,8)}),Object(I.a)(Oe,j.dagger,{item:j.dagger,itemType:Re,weaponType:ke.knife,subText:"Excellent for ritual sacrifice and cheese platters",iconImg:"".concat(Pe,"dagger.png"),damage:Object(I.a)({},je.kinetic,8)}),Object(I.a)(Oe,j.flail,{item:j.flail,itemType:Re,weaponType:ke.flail,subText:"A flail is a weapon consisting of a striking head attached to a handle by a flexible rope, strap, or chain. ",iconImg:"".concat(Pe,"flail.png"),damage:Object(I.a)({},je.kinetic,15)}),Object(I.a)(Oe,j.greatswordOfGwai,{item:j.greatswordOfGwai,itemType:Re,weaponType:ke.sword,subText:"Finer steel was seldom forged",iconImg:"".concat(Pe,"greatsword-gwai.png"),unique:!0,damage:Object(I.a)({},je.kinetic,25)}),Object(I.a)(Oe,j.khopesh,{item:j.khopesh,itemType:Re,weaponType:ke.sword,subText:"Dafuq is this. Can I get garlic sauce with that?",iconImg:"".concat(Pe,"khopesh.png"),damage:Object(I.a)({},je.kinetic,15)}),Object(I.a)(Oe,j.longbow,{item:j.longbow,itemType:Re,weaponType:ke.bow,subText:"A deadly killer from long range",iconImg:"".concat(Pe,"longbow.png"),damage:Object(I.a)({},je.kinetic,2)}),Object(I.a)(Oe,j.mace,{item:j.mace,itemType:Re,weaponType:ke.club,subText:"A mace is a blunt weapon, a type of club or virge that uses a heavy head on the end of a handle to deliver powerful blows.",iconImg:"".concat(Pe,"mace.png"),damage:Object(I.a)({},je.kinetic,15)}),Object(I.a)(Oe,j.morningStar,{item:j.morningStar,itemType:Re,weaponType:ke.club,subText:"A morning star is any of several medieval club-like weapons consisting of a shaft with an attached ball adorned with one or more spikes.",iconImg:"".concat(Pe,"morning-star.png"),damage:Object(I.a)({},je.kinetic,13)}),Object(I.a)(Oe,j.poisonedDagger,{item:j.poisonedDagger,itemType:Re,weaponType:ke.knife,subText:"Excellent for ritual sacrifice and cheese platters",iconImg:"".concat(Pe,"poisoned-dagger.png"),damage:Object(I.a)({},je.kinetic,12)}),Object(I.a)(Oe,j.ravenStaff,{item:j.ravenStaff,itemType:Re,weaponType:ke.staff,subText:"Kaa, kaa!",iconImg:"".concat(Pe,"raven-staff.png"),damage:Object(I.a)({},je.kinetic,13)}),Object(I.a)(Oe,j.savageStaff,{item:j.savageStaff,itemType:Re,weaponType:ke.staff,subText:"Savage dude",iconImg:"".concat(Pe,"savage-staff.png"),damage:Object(I.a)({},je.kinetic,8)}),Object(I.a)(Oe,j.spear,{item:j.spear,itemType:Re,weaponType:ke.poleArm,subText:"A spear is a pole weapon consisting of a shaft, usually of wood, with a pointed head. ",iconImg:"".concat(Pe,"sword.png"),damage:Object(I.a)({},je.kinetic,10)}),Object(I.a)(Oe,j.sword,{item:j.sword,itemType:Re,weaponType:ke.sword,subText:"An elegant weapon for a more civilized age",iconImg:"".concat(Pe,"sword.png"),damage:Object(I.a)({},je.kinetic,14)}),Object(I.a)(Oe,j.warhammer,{item:j.warhammer,itemType:Re,weaponType:ke.hammer,subText:"A war hammer is a late medieval weapon of war intended for close combat action, whose design resembles the hammer",iconImg:"".concat(Pe,"warhammer.png"),damage:Object(I.a)({},je.kinetic,16)}),Oe);function We(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var Le=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?We(n,!0).forEach((function(t){Object(I.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):We(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},Te,{},G,{},xe,{},qe,{},Ae,{},Me),_e=Le;function He(e){return Le[e]}var Be=n(33),Ge=function(){function e(){Object(C.a)(this,e)}return Object(x.a)(e,null,[{key:"init",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.texts=e,this.templates={},t&&this.compileAll(),this.initialized=!0}},{key:"get",value:function(e,t){if(!this.initialized)throw new Error("Error ".concat(this," not initialized!"));var n=this.getTemplate(e);return n?n(t):(console.error("Key '".concat(e,"' not found in TextManager")),"<<'".concat(e,"' missing>>"))}},{key:"getTextEntry",value:function(e){return this.get(e.key,e.context)}},{key:"getTemplate",value:function(e){var t=this.templates[e];return!t&&this.texts[e]&&(this.compile(e,this.texts[e]),t=this.templates[e]),t}},{key:"getQuestTitle",value:function(e){return this.get("quest-".concat(e,"-title"))}},{key:"getQuestDescription",value:function(e){return this.get("quest-".concat(e,"-description"))}},{key:"getResourceName",value:function(e){return this.get("resource-".concat(e,"-name"))}},{key:"getItemName",value:function(e){var t=k[He(e).itemType];return this.get("item-".concat(t,"-").concat(e,"-name"))}},{key:"getStructureName",value:function(e){return this.get("structure-".concat(e,"-name"))}},{key:"compileAll",value:function(){var e=this;Object.keys(this.texts).forEach((function(t){e.compile(t,e.texts[t])}))}},{key:"compile",value:function(e,t){var n=Be.compile(t);this.templates[e]=n}}]),e}();Ge.initialized=!1,Ge.texts=void 0,Ge.templates=void 0,Be.registerHelper("item:name",(function(e,t){if(!_e[e])return new Be.SafeString("<<ITEM DEFINITION NOT FOUND: ".concat(e,">>"));switch(t){case"aA":return Ue(e);case"aD":case"aU":return Ve(e);default:var n=_e[e].name;return new Be.SafeString(n)}})),Be.registerHelper("structure:name",(function(e){var t=Ge.get("structure-".concat(e,"-name"));return new Be.SafeString(t)}));var Fe,Ue=function(e){return Qe(e)},Qe=function(e){var t=Ge.getItemName(e),n=Ge.getTemplate("common-article-undefined");return new Be.SafeString("".concat(n({noun:t})))},Ve=function(e){var t=Ge.getItemName(e),n=Ge.getTemplate("common-article-defined");return new Be.SafeString("".concat(n({noun:t})))};n(160);!function(e){e[e.all=0]="all",e[e.town=1]="town",e[e.quest=2]="quest"}(Fe||(Fe={}));var ze,Ke=function(e){function t(e){var n;return Object(C.a)(this,t),(n=Object(S.a)(this,Object(N.a)(t).call(this,e))).state={expanded:!1,selectedTabId:"all"},n}return Object(D.a)(t,e),Object(x.a)(t,[{key:"render",value:function(){var e=this,t=[{label:Ge.get("common-log-tab-all"),tabId:"all",tabType:Fe.all},{label:Ge.get("common-log-tab-town"),tabId:"town",tabType:Fe.town}];this.props.questNames.forEach((function(e){t.push({channelContext:e,label:Ge.getQuestTitle(e),tabId:"quest-".concat(e),tabType:Fe.quest})}));var n=[],r=t.find((function(t){return t.tabId===e.state.selectedTabId}));switch(r.tabType){case Fe.all:n=this.props.logEntries;break;case Fe.town:n=this.props.logEntries.filter((function(e){return e.channel===p.town}));break;case Fe.quest:n=this.props.logEntries.filter((function(e){return e.channel===p.quest&&e.channelContext===r.channelContext}))}var o=t.map((function(e){return h.createElement(R,{id:e.tabId,key:e.tabId},e.label)}));return h.createElement("div",{className:"log ".concat(this.state.expanded?"expanded":"")},h.createElement("div",{className:"tab-bar"},h.createElement(M,{className:"tabs",onTabSelected:function(t){return e.handleTabSelected(t)}},o),h.createElement(A,{className:"expand-button",onClick:function(){return e.handleToggleExpand()},text:this.state.expanded?"\u25bc":"\u25b2"})),h.createElement("div",{className:"log-entries"},n.map((function(e){return function(e){var t=Ge.get(e.key,e.context);return h.createElement("div",{className:"entry",key:e.time},t)}(e)}))))}},{key:"handleTabSelected",value:function(e){this.setState({selectedTabId:e})}},{key:"handleToggleExpand",value:function(){this.setState({expanded:!this.state.expanded})}}]),t}(h.Component),Xe=n(35);!function(e){e[e.unavailable=0]="unavailable",e[e.available=1]="available",e[e.active=2]="active",e[e.completed=3]="completed"}(ze||(ze={}));var Je,Ye=Object(Xe.a)([function(e){return e.quests}],(function(e){return e.filter((function(e){return e.status===ze.active})).map((function(e){return e.name}))})),Ze=Object(w.b)((function(e){return{logEntries:e.log,questNames:Ye(e)}}),(function(e){return{}}))(Ke),$e=n(34);!function(e){e[e.NotBuilt=0]="NotBuilt",e[e.Building=1]="Building",e[e.Built=2]="Built"}(Je||(Je={}));var et,tt,nt,rt={level:0,state:Je.NotBuilt,workers:0};!function(e){e[e.town=0]="town",e[e.world=1]="world"}(et||(et={})),function(e){e[e.buttonClick=0]="buttonClick",e[e.error=1]="error"}(tt||(tt={}));var ot={},at=null,ct={},it=function(){function e(){Object(C.a)(this,e)}return Object(x.a)(e,null,[{key:"loadMedia",value:function(e){nt=e}},{key:"addSounds",value:function(e){Object.entries(e).forEach((function(e){var t=Object(P.a)(e,2),n=t[0],r=t[1];ct[n]=nt.find((function(e){return e.url===r})).content}))}},{key:"playSound",value:function(e){ct[e].play()}},{key:"addMusicTrack",value:function(e,t){var n=nt.find((function(e){return e.url===t}));if(!n)throw new Error("No sound found at ".concat(t));ot.hasOwnProperty(e)||(ot[e]=n.content)}},{key:"playMusicTrack",value:function(e){null!==at&&ot[at].fade(1,0,500);var t=ot[e];t.playing()||(t.loop(!0),t.play()),t.fade(0,1,500),at=e}}]),e}(),st=(n(210),function(e){function t(e){var n;return Object(C.a)(this,t),(n=Object(S.a)(this,Object(N.a)(t).call(this,e))).anim=void 0,n.handleStructureClick=function(e){n.props.onStructureClick&&n.props.onStructureClick(F[e.target.name()])},n.handleBackgroundClick=function(){n.props.onStructureClick&&n.props.onStructureClick(null)},n.state={images:{}},it.addMusicTrack(et.town,"sound/music/Soliloquy.mp3"),n}return Object(D.a)(t,e),Object(x.a)(t,[{key:"componentDidMount",value:function(){this.playMusic()}},{key:"componentWillUnmount",value:function(){this.anim&&this.anim.stop(),delete this.anim}},{key:"render",value:function(){var e=this,t=Object.keys(F).map((function(t,n){var r=he(t),o=e.props.structures[t];if(o.state===Je.NotBuilt)return null;var a=r.levels[o.level],c=Ge.get(a.displayName);return h.createElement($e.Text,{name:t,key:t,text:"\u2588 ".concat(c," (level ").concat(o.level+1,")"),x:100,y:90*n+100,fontSize:80,fill:"white",onClick:e.handleStructureClick})}));return console.log("rendered the town"),h.createElement($e.Stage,{width:1024,height:768,scale:{x:.4,y:.4}},h.createElement($e.Layer,{name:"background",onClick:this.handleBackgroundClick},h.createElement($e.Image,{image:this.imgSrc("img/town/sky.jpg")})),h.createElement($e.Layer,{name:"town"},h.createElement($e.Image,{name:"warehouse",image:this.imgSrc("img/town/tavern.png"),x:15,y:1057,shadowBlur:15,shadowColor:"red",shadowEnabled:!0,strokeWidth:30,ref:function(e){ut(e)}}),h.createElement($e.Image,{name:F.warehouse,image:this.imgSrc("img/town/lighthouse.png"),ref:function(e){ut(e)}}),h.createElement($e.Image,{name:"lumberMill",image:this.imgSrc("img/town/mill.png"),x:947,y:1384,shadowBlur:15,ref:function(e){ut(e)}}),t))}},{key:"imgSrc",value:function(e){var t=this.props.media.find((function(t){return t.url===e}));if(void 0===t)throw Error("Could not find image with url ".concat(e));return t.content}},{key:"playMusic",value:function(){it.playMusicTrack(et.town)}}]),t}(h.Component)),ut=function(e){},lt=st,mt=function(e){return function(t){function n(){return Object(C.a)(this,n),Object(S.a)(this,Object(N.a)(n).apply(this,arguments))}return Object(D.a)(n,t),Object(x.a)(n,[{key:"render",value:function(){var t=this;return h.createElement(Qr.Consumer,null,(function(n){return h.createElement(e,Object.assign({},t.props,n))}))}}]),n}(h.Component)},dt=n(15);var pt,gt,ft=Object(dt.c)(Object(w.b)((function(e,t){return{structures:e.structures}}),(function(e,t){return{}})),mt)(lt);function vt(e){return{type:pt.addGold,amount:e}}function ht(e){return{type:pt.addGold,amount:-e}}function bt(e){return{type:gt.addResources,resources:e}}!function(e){e.addGold="addGold"}(pt||(pt={})),function(e){e.addResources="addResources",e.removeResources="removeResources"}(gt||(gt={}));n(45),n(211);var yt,wt,Ot=function(e){var t=e.itemsInInventory,n=(e.className||"")+" itemsbox",r=e.items.reduce((function(e,t){return e[t]||(e[t]=0),e[t]++,e}),{}),o=Object.keys(r).map((function(e){var n=e,o=r[e],a="item";o>(t?t.filter((function(e){return e===n})).length:0)&&(a+=" missing");var c=_e[n];return h.createElement("li",{className:a,key:n},h.createElement("div",{className:"icon common-icon-smallest",style:{backgroundImage:"url(".concat(c.iconImg,")")}}),h.createElement("div",{className:"name"},"".concat(Ge.getItemName(n)," (").concat(o,")")))}));return h.createElement("ul",{className:n},o)},kt=Object(w.b)((function(e,t){var n=[],r=Object(c.a)(e.items);return t.items.forEach((function(e){var t=r.findIndex((function(t){return t===e}));if(t>-1){var o=r.splice(t,1),a=Object(P.a)(o,1)[0];a&&n.push(a)}})),{itemsInInventory:n}}))(Ot);!function(e){e.wood="wood",e.iron="iron",e.stone="stone",e.leather="leather",e.fabric="fabric",e.food="food"}(wt||(wt={}));var jt,Et,Tt=(yt={},Object(I.a)(yt,wt.wood,{resource:wt.wood,iconImg:"/img/resources/wood.png"}),Object(I.a)(yt,wt.iron,{resource:wt.iron,iconImg:"/img/resources/iron.png"}),Object(I.a)(yt,wt.stone,{resource:wt.stone,iconImg:"/img/resources/stone.png"}),Object(I.a)(yt,wt.leather,{resource:wt.leather,iconImg:"/img/resources/leather.png"}),Object(I.a)(yt,wt.fabric,{resource:wt.fabric,iconImg:"/img/resources/fabric.png"}),Object(I.a)(yt,wt.food,{resource:wt.food,iconImg:"/img/resources/food.png"}),yt),It=(n(64),function(e){var t=e.sufficientResources,n=(e.className||"")+" resourcesbox",r=Object.keys(e.resources).map((function(n){var r="resource";t&&!t[n]&&(r+=" insufficient");var o=Tt[n];if(!o)throw new Error("No resource description found for ".concat(n));return h.createElement("li",{className:r,key:n},h.createElement("div",{className:"icon",style:{backgroundImage:"url(".concat(o.iconImg,")")}}),h.createElement("div",{className:"name"},Ge.getResourceName(n)),h.createElement("div",{className:"amount"},e.resources[n]))}));return h.createElement("ul",{className:n},r)}),Ct=Object(w.b)((function(e,t){var n={};return Object.keys(t.resources).forEach((function(r){n[r]=e.resources[r]>=t.resources[r]})),{sufficientResources:n}}))(It),xt=function(e,t){if(t>6)throw new Error("Cannot possibly have more than ".concat(6," on one item!"));return e-.1*e*(t-1)};!function(e){e[e.item=0]="item"}(jt||(jt={})),function(e){e[e.smallest=0]="smallest",e[e.small=1]="small",e[e.medium=2]="medium",e[e.big=3]="big",e[e.biggest=4]="biggest"}(Et||(Et={}));var St=function e(t){switch(t){case Et.smallest:return"common-icon-smallest";case Et.small:return"common-icon-small";case Et.medium:return"common-icon-medium";case Et.big:return"common-icon-big";case Et.biggest:return"common-icon-biggest"}return e(Et.medium)},Nt=(n(212),function(e){var t=e.item,n=He(t),r=h.useContext(Qr),o=h.useRef(null);n||console.warn("could not find definition for ".concat(t));var a="item-icon "+St(e.size);return h.createElement("div",{className:a,onClick:function(n){if(!1!==e.showContext){var a=n.currentTarget.getBoundingClientRect();r.onContextualObjectActivated(jt.item,He(t),o,a)}e.onClick&&e.onClick(n)},style:{backgroundImage:"url(".concat(n.iconImg,")")}})}),qt=(n(213),function(e){var t,n,r,o=(t=e.progress||0,n=0,t>(r=1)?r:t<n?n:t);return h.createElement("div",{className:"progressbar"},h.createElement("div",{className:"progressbar-label"},e.label),h.createElement("div",{className:"progressbar-info",style:{width:"".concat(100*o,"%")}},"  "))});n(214);var Dt,At,Rt,Pt=function(e){var t;return t=null==e.max?e.value:h.createElement("span",null,e.value," / ",h.createElement("span",{className:"max"},e.max)),h.createElement("div",{className:"updownvalue"},h.createElement("label",null," ",e.label),t,h.createElement("i",{className:"arrow up"+(e.upDisabled?" disabled":""),onClick:function(t){e.onUp&&!e.upDisabled&&e.onUp(t)}}),h.createElement("i",{className:"arrow down"+(e.downDisabled?" disabled":""),onClick:function(t){e.onDown&&!e.downDisabled&&e.onDown(t)}}))},Mt=(n(215),function(e){function t(e){var n;return Object(C.a)(this,t),(n=Object(S.a)(this,Object(N.a)(t).call(this,e))).state={selectedItem:null,workersAssigned:0},n}return Object(D.a)(t,e),Object(x.a)(t,[{key:"render",value:function(){var e=this,t=he(this.props.type);if(!t)throw new Error("No definition found for structure ".concat(this.props.type,"\n                with type ProductionStructureDefinition."));var n=this.props.level||0,r=t.levels[n],o=Ge.getStructureName(this.props.type);return h.createElement("details",{open:!0,className:"productionstructureview"},h.createElement("summary",null,o),h.createElement("section",null,function(){var r=e.props.gold,o=t.levels[n+1],a=null!=o?o.cost.gold||0:-1,c=null!=o&&r>=a,i="Upgrade! (".concat(a<0?"max":a+" gold",")");return h.createElement("div",null,h.createElement("label",null,"level:"),n+1+" / "+t.levels.length,h.createElement("button",{style:{float:"right"},onClick:function(t){e.props.onUpgrade&&e.props.onUpgrade(a,n+1)},disabled:!c},i))}(),h.createElement("div",null,"craft:"),h.createElement("div",{className:"crafting-area"},h.createElement("ul",{className:"vertical-tab-bar"},function(){var t=e.state.selectedItem;return r.produces.map((function(n){return h.createElement("li",{key:"craft".concat(n.item),onClick:function(t){t.stopPropagation(),e.setState({selectedItem:n.item})},className:t===n.item?"selected":""},h.createElement(Nt,{item:n.item}),Ge.getItemName(n.item))}))}()),function(){var t=e.state.selectedItem;if(!t)return null;var n=r.produces.find((function(e){return e.item===t})),o=e.props.resources||{},a=n.cost.resources,c=Object.keys(a).some((function(e){return a[e]>o[e]})),i=!1,s=n.cost.materials;s&&(i=s.some((function(t){return-1===e.props.items.indexOf(t)})));var u=c||i||e.state.workersAssigned<1,l=_e[t],m=null;return s&&(m=h.createElement(kt,{items:s})),h.createElement("div",{className:"crafting-details"},"Craft a ",Ge.getItemName(l.item),h.createElement("div",{className:"crafting-costs"},h.createElement("fieldset",null,h.createElement(Ct,{resources:a})),h.createElement("fieldset",null,m)),h.createElement("div",{style:{display:"flex "}},h.createElement(Pt,{value:e.state.workersAssigned,label:"Workers: ",onUp:function(t){t.stopPropagation(),e.setState({workersAssigned:e.state.workersAssigned+1})},onDown:function(t){t.stopPropagation(),e.setState({workersAssigned:e.state.workersAssigned-1})},upDisabled:e.state.workersAssigned>=e.props.workersFree||e.state.workersAssigned>=6,downDisabled:e.state.workersAssigned<1}),"\xa0",function(t){if(0===e.state.workersAssigned)return"";var n=xt(t,e.state.workersAssigned),r=z(n);return" Crafting time: ".concat(r)}(n.cost.time||0)),h.createElement("div",null,h.createElement("button",{disabled:u,onClick:function(t){t.stopPropagation(),e.props.onCraft&&(e.props.onCraft(n,e.state.workersAssigned),e.setState({workersAssigned:0}))}},"Craft")))}()),h.createElement("fieldset",null,h.createElement("legend",null,"Currently crafting:"),(e.props.tasks||[]).map((function(e){return h.createElement(qt,{key:"".concat(e.name).concat(e.startTime),label:"".concat(e.name," (").concat(z(e.timeRemaining),")"),progress:e.progress})})))))}}]),t}(h.Component));function Wt(e,t){return{type:Dt.addItem,item:e,toSlot:t}}function Lt(e){return{type:At.finishBuildingStructure,structure:e}}function _t(e){return{type:At.upgradeStructure,structure:e}}function Ht(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return{type:At.increaseWorkers,structure:e,workers:t}}function Bt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return{type:At.decreaseWorkers,structure:e,workers:t}}function Gt(e,t,n,r,o){return{type:Rt.start,taskType:e,name:t,origin:n,time:r,callbacks:o}}!function(e){e.addItem="addItem",e.moveItemInWarehouse="moveItemInWarehouse",e.removeItem="removeItem"}(Dt||(Dt={})),function(e){e.upgradeStructure="upgradeStructure",e.increaseWorkers="increaseWorkers",e.decreaseWorkers="decreaseWorkers",e.startBuildingStructure="startBuildingStructure",e.finishBuildingStructure="finishBuildingStructure",e.setStructureState="setStructureState"}(At||(At={})),function(e){e.start="startTask",e.update="updateTasks"}(Rt||(Rt={}));var Ft,Ut=Object(Xe.a)([function(e){return e.structures},function(e){return e.workers}],(function(e,t){return t-Object.keys(e).map((function(t){return e[t]})).reduce((function(e,t){return e+t.workers}),0)}));!function(e){e[e.buildStructure=0]="buildStructure",e[e.craftItem=1]="craftItem"}(Ft||(Ft={}));var Qt=Object(w.b)((function(e,t){var n=e.structures[t.type],r=e.tasks.running.filter((function(e){return e.origin==="".concat(t.type,".craft")}));return{gold:e.gold,items:e.items,level:n.level,resources:e.resources,tasks:r,workersFree:Ut(e)}}),(function(e,t){return{onCraft:function(n,r){var o,a=xt(n.cost.time||0,r);e((o=n.cost.resources||{},{type:gt.removeResources,resources:o})),e(Ht(t.type,r));var c=[Wt(n.item),Bt(t.type,r)],i=Gt(Ft.craftItem,n.item,"".concat(t.type,".craft"),a,c);e(i)},onUpgrade:function(n,r){e(ht(n)),e(_t(t.type)),r++,e(O("log-town-upgrade-structure-complete",{level:r,structure:t.type},p.town))}}}))(Mt),Vt=function(e){var t=he(e.type);if(!t)throw new Error("No definition found for structure ".concat(e.type," with type ResourceStructureDefinition."));var n=e.level||0,r=t.levels[n],o=Ge.getStructureName(e.type);return h.createElement("details",{open:!0,className:"structureview"},h.createElement("summary",null,o),h.createElement("section",null,function(){var t=e.workers===r.workerCapacity||(e.workersFree||0)<1,n=0===e.workers;return h.createElement(Pt,{label:"workers:",value:e.workers,max:r.workerCapacity,upDisabled:t,downDisabled:n,onDown:function(){e.onWorkersDown&&e.onWorkersDown()},onUp:function(){e.onWorkersUp&&e.onWorkersUp()}})}(),function(){var r=e.gold||0,o=t.levels[n+1],a=null!=o?o.cost.gold||0:-1,c=null!=o&&r>=a,i="Upgrade! (".concat(a<0?"max":a+" gold",")");return h.createElement("div",null,h.createElement("label",null,"level:"),n+1+" / "+t.levels.length,h.createElement("button",{style:{float:"right"},onClick:function(t){e.onUpgrade&&e.onUpgrade(a,n+1)},disabled:!c},i))}(),function(){var t=r.generates,n=Object.keys(t).reduce((function(n,r){return t[r]&&n.push("".concat(t[r]," x ").concat(e.workers," = ").concat(t[r]*(e.workers||0)," ").concat(r)),n}),[]).join(",");return h.createElement("div",null,"Generates (every minute): ",h.createElement("br",null),n)}()))};var zt,Kt=Object(w.b)((function(e,t){var n=e.structures[t.type];if(!n)throw new Error("No structure '".concat(t.type,"' found in the store!"));return{gold:e.gold,level:n.level,workers:n.workers,workersFree:Ut(e)}}),(function(e,t){return{onUpgrade:function(n,r){e(ht(n)),e(_t(t.type)),r++,e(O("log-town-upgrade-structure-complete",{level:r,structure:t.type},p.town))},onWorkersDown:function(){e(Bt(t.type))},onWorkersUp:function(){e(Ht(t.type))}}}))(Vt);function Xt(e,t){return{type:zt.startEncounter,questName:e,encounter:t}}!function(e){e.launchQuest="launchQuest",e.advanceQuest="advanceQuest",e.updateQuestVars="updateQuestVars",e.updateEncounterResult="updateEncounterResult",e.startEncounter="startEncounter",e.updateQuests="updateQuests"}(zt||(zt={}));var Jt,Yt="adventurer",Zt="item";!function(e){e[e.adventurerInventory=0]="adventurerInventory",e[e.warehouse=1]="warehouse",e[e.tavern=2]="tavern",e[e.adventurerEquipment=3]="adventurerEquipment"}(Jt||(Jt={}));var $t=n(25),en=(n(217),function(e){var t=e.adventurer,n=(e.className||"")+" avatar";return h.createElement("div",{className:n,style:{backgroundImage:"url(".concat(t.avatarImg,")")},onClick:function(){e.onClick&&e.onClick(e.adventurer.id)}},h.createElement("div",{className:"sizer"}),e.displayName&&h.createElement("div",{className:"name"},t.name))}),tn=(n(218),{beginDrag:function(e){return{adventurer:e.adventurer,sourceId:e.sourceId,sourceType:Jt.adventurerInventory}}});var nn,rn,on=function(e){function t(){return Object(C.a)(this,t),Object(S.a)(this,Object(N.a)(t).apply(this,arguments))}return Object(D.a)(t,e),Object(x.a)(t,[{key:"render",value:function(){var e=this.props,t=e.isDragging,n=e.connectDragSource,r="draggable-adventurer-avatar";return e.disabled&&(r+=" disabled"),t&&(r+=" dragging"),n(h.createElement("div",{className:r},h.createElement(en,this.props)))}}]),t}(h.Component),an=Object($t.c)(Yt,tn,(function(e,t){return{connectDragSource:e.dragSource(),isDragging:t.isDragging()}}))(on);!function(e){e.backstabbed="backstabbed",e.goblinHouseHallway="goblinHouseHallway",e.goblinHouseOutside="goblinHouseOutside",e.theBigTree="theBigTree"}(nn||(nn={})),function(e){e[e.nothing=0]="nothing",e[e.encounter=1]="encounter",e[e.combat=2]="combat",e[e.boss=3]="boss"}(rn||(rn={}));var cn={kill10Boars:{nodes:[{x:0,y:1,type:rn.nothing,log:"quest-kill10Boars-node0"},{x:0,y:2,type:rn.nothing,log:"quest-kill10Boars-node1"},{x:0,y:3,type:rn.encounter,encounter:nn.goblinHouseOutside},{x:1,y:3,type:rn.nothing,log:"quest-kill10Boars-node4"},{x:1,y:3,type:rn.nothing},{x:2,y:3,type:rn.nothing},{x:3,y:3,type:rn.encounter,encounter:nn.backstabbed},{x:4,y:4,type:rn.nothing,log:"The party spots a boss"},{x:5,y:4,type:rn.boss}]},retrieveMagicAmulet:{requiredItems:[j.torch,j.torch,j.torch,j.sandwich,j.sandwich],nodes:[{x:0,y:1,type:rn.nothing},{x:1,y:1,type:rn.nothing,log:"Papa loves mambo"},{x:1,y:1,type:rn.nothing,log:"Mama loves mambo"},{x:1,y:1,type:rn.nothing,log:"Look at 'em sway with it"},{x:1,y:1,type:rn.nothing,log:"gettin' so gay with it"},{x:1,y:1,type:rn.nothing},{x:1,y:1,type:rn.nothing},{x:0,y:2,type:rn.encounter,encounter:nn.theBigTree},{x:1,y:1,type:rn.nothing},{x:1,y:1,type:rn.nothing},{x:1,y:1,type:rn.nothing},{x:1,y:1,type:rn.nothing},{x:1,y:1,type:rn.nothing},{x:1,y:1,type:rn.nothing},{x:1,y:1,type:rn.nothing},{x:1,y:1,type:rn.nothing},{x:1,y:1,type:rn.nothing},{x:2,y:1,type:rn.encounter,encounter:nn.backstabbed},{x:3,y:1,type:rn.boss}]}},sn=cn;function un(e){return cn[e]}n(219);var ln=function(e){function t(){return Object(C.a)(this,t),Object(S.a)(this,Object(N.a)(t).apply(this,arguments))}return Object(D.a)(t,e),Object(x.a)(t,[{key:"render",value:function(){var e=this.props,t=e.isOver,n=e.canDrop,r="droppable-adventurer-slot";return t?r+=" active-drop":n&&(r+=" can-drop"),(0,e.connectDropTarget)(h.createElement("div",{className:r}))}}]),t}(h.Component),mn=Object($t.d)(Yt,{drop:function(e,t){e.onDrop(t.getItem())},canDrop:function(e,t){return!0}},(function(e,t){return{canDrop:t.canDrop(),connectDropTarget:e.dropTarget(),isOver:t.isOver()}}))(ln),dn=(n(220),function(e){return h.createElement("ul",{className:"assign-adventurers"},function(){for(var t=[],n=function(n){var r=void 0,o="";if(!!e.assignedAventurers[n]){var a=e.assignedAventurers[n];r=h.createElement(en,{adventurer:a,displayName:!1,onClick:function(){return e.onRemoveAdventurer(n)}}),o="has-adventurer"}else r=h.createElement(mn,{onDrop:function(t){e.onAddEventurer(t,n)}});t.push(h.createElement("li",{key:"slot".concat(n),className:o}," ",r," "))},r=0;r<e.availableSlots;r++)n(r);return t}())}),pn=(n(221),function(e){function t(e){var n;return Object(C.a)(this,t),(n=Object(S.a)(this,Object(N.a)(t).call(this,e))).state={selectedQuest:null},n}return Object(D.a)(t,e),Object(x.a)(t,[{key:"render",value:function(){var e=this,t=this.props.availableQuests.map((function(t){var n="img/sigils/".concat(t.icon),r="quest"+(t.name===e.props.selectedQuestName?" selected":"");return h.createElement("li",{key:t.name,className:r,onClick:function(){e.props.onQuestClick(t.name)}},h.createElement("div",{className:"icon",style:{backgroundImage:"url(".concat(n,")")}}),h.createElement("div",{className:"title"},Ge.getQuestTitle(t.name)," "))}));return h.createElement("div",{className:"quest-board"},h.createElement("h2",null," ",Ge.get("structure-tavern-title-quest-board")," "),h.createElement("ul",{className:"quest-list"},t),function(){if(!e.props.selectedQuestName)return null;var t=e.props.availableQuests.find((function(t){return t.name===e.props.selectedQuestName}));if(!t)return h.createElement("div",null," ",Ge.get("structure-tavern-quest-launched")," ");var n=un(t.name),r=e.props.assignedAventurers.filter((function(e){return null!==e})).length>=3,o=e.checkEnoughItems(n),a=r&&o;return h.createElement("div",{className:"quest-details"},Ge.getQuestDescription(e.props.selectedQuestName),h.createElement(dn,{availableSlots:5,assignedAventurers:e.props.assignedAventurers,onRemoveAdventurer:e.props.onRemoveAdventurer,onAddEventurer:e.props.onAddAdventurer}),h.createElement(kt,{items:n.requiredItems||[]}),h.createElement("button",{disabled:!a,onClick:function(){return e.props.onLaunchQuest()}},Ge.get("structure-tavern-button-launch-quest")))}())}},{key:"checkEnoughItems",value:function(e){var t=this;return!e.requiredItems||e.requiredItems.every((function(n){var r=e.requiredItems.filter((function(e){return e===n})).length;return t.props.items.filter((function(e){return e===n})).length>=r}))}}]),t}(h.Component));var gn,fn=Object(w.b)((function(e,t){return{items:e.items}}))(pn);n(222);function vn(e,t,n){return{type:gn.moveItemInInventory,adventurerId:e,fromSlot:t,toSlot:n}}function hn(e,t,n){return{type:gn.addItemToInventory,adventurerId:e,item:t,toSlot:n}}function bn(e,t){return{type:gn.removeItemFromInventory,adventurerId:e,fromSlot:t}}!function(e){e.moveItemInInventory="moveItemInInventory",e.moveItemToOtherAdventurer="moveItemToOtherAdventurer",e.moveItemFromWarehouseToAdventurer="moveItemFromWarehouseToAdventurer",e.addItemToInventory="addItemToInventory",e.removeItemFromInventory="removeItemFromInventory",e.assignEquipment="assignEquipment",e.removeEquipment="removeEquipment"}(gn||(gn={}));n(223);var yn,wn=function(e){function t(){return Object(C.a)(this,t),Object(S.a)(this,Object(N.a)(t).apply(this,arguments))}return Object(D.a)(t,e),Object(x.a)(t,[{key:"render",value:function(){var e=this.props,t=e.item,n=e.onClick,r=e.isDragging,o=e.connectDragSource,a=e.size;return r?null:o(h.createElement("div",null,h.createElement(Nt,{item:t,onClick:function(e){n&&n(e)},size:a})))}}]),t}(h.Component),On=Object($t.c)(Zt,{beginDrag:function(e){return{inventorySlot:e.index,item:e.item,sourceId:e.sourceId,sourceType:e.sourceType}}},(function(e,t){return{connectDragSource:e.dragSource(),isDragging:t.isDragging()}}))(wn),kn=(n(224),{drop:function(e,t){e.onDrop(t.getItem())},canDrop:function(e,t){var n=t.getItem().item;return jn(n,e.type)}}),jn=function(e,t){switch(t){case yn.chest:return Tn(e,W.chest);case yn.feet:return Tn(e,W.feet);case yn.hands:return Tn(e,W.hands);case yn.head:return Tn(e,W.head);case yn.legs:return Tn(e,W.legs);case yn.mainHand:case yn.offHand:return He(e).itemType===k.weapon;default:return!1}};!function(e){e[e.feet=0]="feet",e[e.hands=1]="hands",e[e.chest=2]="chest",e[e.legs=3]="legs",e[e.head=4]="head",e[e.shoulders=5]="shoulders",e[e.mainHand=6]="mainHand",e[e.offHand=7]="offHand"}(yn||(yn={}));var En=Object($t.d)(Zt,kn,(function(e,t){return{canDrop:t.canDrop(),connectDropTarget:e.dropTarget(),isOver:t.isOver()}}))((function(e){var t=e.isOver,n=e.canDrop,r="grey";return t&&n?r="green":n&&(r="orange"),(0,e.connectDropTarget)(h.createElement("div",{className:"equipment-slot",style:{borderColor:r},title:yn[e.type]},e.children))})),Tn=function(e,t){var n=He(e);return n.itemType===k.apparel&&n.equipmentType===t},In=(n(225),{drop:function(e,t){e.onDrop(t.getItem())},canDrop:function(e,t){var n=t.getItem();return n.sourceType!==Jt.adventurerEquipment||(null==e.item||jn(e.item,n.inventorySlot))}}),Cn=function(e){function t(){return Object(C.a)(this,t),Object(S.a)(this,Object(N.a)(t).apply(this,arguments))}return Object(D.a)(t,e),Object(x.a)(t,[{key:"render",value:function(){var e=this.props,t=e.isOver,n=e.canDrop,r=e.connectDropTarget,o=t&&n,a=["inventory-item",St(this.props.size)];return o?a.push("drop-active"):n&&a.push("drop-possible"),r(h.createElement("div",{className:a.join(" ")},this.props.children))}}]),t}(h.Component),xn=Object($t.d)(Zt,In,(function(e,t){return{canDrop:t.canDrop(),connectDropTarget:e.dropTarget(),isOver:t.isOver()}}))(Cn),Sn=mt((function(e){for(var t=[],n=function(n){var r=void 0,o=e.items[n];o&&(r=h.createElement(On,{index:n,sourceId:e.sourceId,sourceType:e.sourceType,item:o}));var a=h.createElement(xn,{key:"inventory-slot-".concat(n),item:o,size:e.iconSize,onDrop:function(t){if((t.inventorySlot!==n||t.sourceType!==e.sourceType||t.sourceId!==e.sourceId)&&e.onDropItem){var r=t.inventorySlot;e.onDropItem(t.item,r,n,t.sourceType,t.sourceId)}}},r);t.push(a)},r=0;r<e.items.length;r++)n(r);return h.createElement("div",{className:"inventory"},t)})),Nn=function(e){var t=h.useContext(Qr),n=e.adventurer,r=Object.keys(n.stats).map((function(e){var t=n.stats[e];return h.createElement("div",{key:"".concat(n.id,"-").concat(e)}," ",h.createElement("b",null,e),": ",t.toFixed(1)," ")})),o=function(r){var o=n.equipment[yn[r]],a=null;if(o){var c=h.createRef();a=h.createElement(On,{index:r,sourceId:n.id,sourceType:Jt.adventurerEquipment,item:o,onClick:function(e){var n=e.currentTarget.getBoundingClientRect();t.onContextualObjectActivated(jt.item,He(o),c,n),e.stopPropagation()},ref:c,size:Et.medium})}return h.createElement(En,{onDrop:function(t){return function(t,r){var o=t.item;switch(t.sourceType){case Jt.adventurerInventory:e.onRemoveItemFromInventory(n.id,t.inventorySlot),e.onAssignEquipment(n.id,r,o);var a=n.equipment[yn[r]];a&&e.onAddItemToInventory(n.id,a,t.inventorySlot);break;case Jt.adventurerEquipment:e.onAssignEquipment(n.id,r,o);var c=n.equipment[yn[r]],i=t.inventorySlot;c?e.onAssignEquipment(n.id,i,c):e.onRemoveEquipment(n.id,i)}}(t,r)},type:r},a)},a=h.createElement("ul",null,h.createElement("li",null,o(yn.head)),h.createElement("li",null,o(yn.shoulders)),h.createElement("li",null,o(yn.chest)),h.createElement("li",null,o(yn.hands)),h.createElement("li",null,o(yn.legs)),h.createElement("li",null,o(yn.feet)),h.createElement("li",null,o(yn.mainHand)),h.createElement("li",null,o(yn.offHand)));return h.createElement("div",{className:"adventurer-info"},h.createElement("div",{className:"left"},h.createElement("div",{className:"name"},h.createElement("b",null,n.name)),h.createElement("div",{className:"attributes"},r),h.createElement("div",{className:"equipment"},a)),h.createElement("div",{className:"right"},h.createElement(Sn,{sourceType:Jt.adventurerInventory,sourceId:n.id,items:n.inventory,onDropItem:function(t,r,o,a,c){switch(a){case Jt.adventurerInventory:e.onMoveItemInInventory&&e.onMoveItemInInventory(n.id,r,o);break;case Jt.adventurerEquipment:e.onAddItemToInventory&&e.onRemoveEquipment&&e.onAddItemToInventory(n.id,t,o);var i=n.inventory[o];i?e.onAssignEquipment(n.id,r,i):e.onRemoveEquipment(n.id,r)}}})))},qn=(n(226),function(e){var t=null;!1!==e.backEnabled&&(t=h.createElement(A,{className:"back-button",onClick:function(t){e.onBack&&e.onBack()},text:"<"}));var n=null;return!1!==e.closeEnabled&&(n=h.createElement(A,{className:"close-button",onClick:function(t){e.onClose&&e.onClose()},text:"x"})),h.createElement("div",{className:"window"},h.createElement("div",{className:"header"},t,h.createElement("h3",null,e.title),n),e.children)}),Dn=function(e){return function(t){function n(){return Object(C.a)(this,n),Object(S.a)(this,Object(N.a)(n).apply(this,arguments))}return Object(D.a)(n,t),Object(x.a)(n,[{key:"render",value:function(){return h.createElement(qn,this.props,h.createElement(e,this.props))}}]),n}(h.Component)},An=Object(dt.c)(Dn,Object(w.b)((function(e,t){return{adventurer:e.adventurers.find((function(e){return e.id===t.adventurerId}))}}),(function(e){return{onAddItemToInventory:function(t,n,r){var o=hn(t,n,r);e(o)},onAssignEquipment:function(t,n,r){var o=function(e,t,n){return{type:gn.assignEquipment,adventurerId:e,item:n,equipmentSlot:t}}(t,n,r);e(o)},onMoveItemInInventory:function(t,n,r){var o=vn(t,n,r);e(o)},onRemoveEquipment:function(t,n){var r=function(e,t){return{type:gn.removeEquipment,adventurerId:e,equipmentSlot:t}}(t,n);e(r)},onRemoveItemFromInventory:function(t,n){var r=bn(t,n);e(r)}}})))(Nn),Rn=function(e){var t=h.useState([]),n=Object(P.a)(t,2),r=n[0],o=n[1],a=h.useState(null),i=Object(P.a)(a,2),s=i[0],u=i[1],l=h.useContext(Qr),m=he(F.tavern),d=e.level||0,p=m.levels[d],g=Ge.getStructureName(F.tavern),f=p.rooms,v=e.quests.filter((function(e){return e.status===ze.available})),b=function(t){return Object.values(e.quests).find((function(e){return e.party.indexOf(t)>-1}))},y=function(e){var t=h.createElement(An,{adventurerId:e.id,title:e.name});l.onOpenWindow(t)};return h.createElement("details",{open:!0,className:"tavernstructureview"},h.createElement("summary",null,g),function(){var t=e.gold,n=m.levels[d+1],r=null!=n?n.cost.gold||0:-1,o=null!=n&&t>=r,a="Upgrade! (".concat(r<0?"max":r+" gold",")");return h.createElement("div",null,h.createElement("label",null,"level:"),d+1+" / "+m.levels.length,h.createElement("button",{style:{float:"right"},onClick:function(t){e.onUpgrade&&e.onUpgrade(r,d+1)},disabled:!o},a))}(),h.createElement("section",null,function(){for(var t=[],n=function(n){var o=e.adventurers.find((function(e){return e.room===n})),a=null;if(o){var c=o.name,i=r.indexOf(o)>-1,s=b(o.id);s&&(c+=" (on a quest)"),a=[h.createElement(an,{disabled:i||null!=s,adventurer:o,className:"adventurer-icon",sourceId:"tavern",key:"avatar:".concat(o.id)}),h.createElement("a",{key:o.id,onClick:function(){return y(o)}}," ",c)]}else a="(empty room)";t.push(h.createElement("div",{key:"room".concat(n),className:"room"},a))},o=0;o<f;o++)n(o);return h.createElement("div",{className:"rooms"},h.createElement("h2",null,"Rooms"),t)}(),h.createElement(fn,{availableQuests:v,selectedQuestName:s,assignedAventurers:r,onQuestClick:function(e){return function(e){u(s===e?null:e),o([])}(e)},onAddAdventurer:function(e,t){return function(e,t){if("tavern"===e.sourceId){var n=Object(c.a)(r);n[t]=e.adventurer,o(n)}}(e,t)},onRemoveAdventurer:function(e){return function(e){var t=Object(c.a)(r);delete t[e],o(t)}(e)},onLaunchQuest:function(){e.onLaunchQuest(s,r)}})))};var Pn=Object(w.b)((function(e,t){var n=e.structures[F.tavern];return{adventurers:e.adventurers,gold:e.gold,level:n.level,quests:e.quests}}),(function(e,t){return{onLaunchQuest:function(t,n){e(function(e,t){return{type:zt.launchQuest,questName:e,assignedAventurers:t}}(t,n))},onUpgrade:function(t,n){e(ht(t)),e(_t(F.tavern)),n++,e(O("log-town-upgrade-structure-complete",{level:n,structure:F.tavern},p.town))}}}))(Rn),Mn=function(e){var t=e.sufficientResources,n=e.resources,r=e.deltaResources,o=(e.className||"")+" resourcesbox",a=Object.keys(n).map((function(n){var o="resource";t&&!t[n]&&(o+=" insufficient");var a,c=Tt[n],i=e.resources[n];if(!c)throw new Error("No resource description found for ".concat(n));return r[n]&&(a=h.createElement("span",{className:"animate-up"},"+ ".concat(r[n].toFixed(2)))),h.createElement("li",{className:o,key:n},h.createElement("div",{className:"icon common-icon-smallest",style:{backgroundImage:"url(".concat(c.iconImg,")")}}),h.createElement("div",{className:"name"},Ge.getResourceName(n)),h.createElement("div",{className:"amount"},i.toFixed(1)),h.createElement("div",{className:"max"}," / ".concat(e.maxResources[n])),h.createElement("div",{className:"delta"},a))}));return h.createElement("ul",{className:o},a)},Wn=(n(227),Jt.warehouse),Ln=function(e){function t(e){var n;return Object(C.a)(this,t),(n=Object(S.a)(this,Object(N.a)(t).call(this,e))).resourcesDelta=void 0,n.resourcesRef=void 0,n.state={selectedAdventurer:null},n.resourcesDelta={},n.resourcesRef=null,n}return Object(D.a)(t,e),Object(x.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=he(F.warehouse);if(!n)throw new Error("No definition found for structure ".concat(F.warehouse," with type StructureDefinition."));var r=t.level,o=Ge.getStructureName(F.warehouse),a=null;if(this.state.selectedAdventurer){var c=t.adventurersInTown.find((function(t){return t.id===e.state.selectedAdventurer}));a=h.createElement(Sn,{sourceType:Wn,items:c.inventory,onDropItem:function(n,r,o,a,c){var i=e.state.selectedAdventurer;switch(a){case Jt.adventurerInventory:t.onMoveItemInInventory&&t.onMoveItemInInventory(i,r,o);break;case Wn:t.onMoveItemToAdventurer&&t.onMoveItemToAdventurer(i,n,r,o)}}})}var i=h.createElement(h.Fragment,null,h.createElement(M,{className:"adventurers-tabstrip",onTabSelected:function(t){return function(t){e.setState({selectedAdventurer:t})}(t)}},t.adventurersInTown.map((function(e){return h.createElement(R,{id:e.id,key:e.id},h.createElement(en,{adventurer:e,className:"common-icon-small"}))}))),h.createElement("div",{className:"adventurer-info"},a));return h.createElement("details",{open:!0,className:"warehouse-structureview"},h.createElement("summary",null,o),function(){var e=t.gold,o=n.levels[r+1],a=null!=o?o.cost.gold||0:-1,c=null!=o&&e>=a,i="Upgrade! (".concat(a<0?"max":a+" gold",")");return h.createElement("div",null,h.createElement("label",null,"level:"),r+1+" / "+n.levels.length,h.createElement("button",{style:{float:"right"},onClick:function(e){t.onUpgrade&&t.onUpgrade(a,r+1)},disabled:!c},i))}(),h.createElement("fieldset",{className:"resources",ref:function(t){e.resourcesRef=t}},h.createElement("legend",null,"Resources"),h.createElement(Mn,{resources:t.resources,maxResources:t.maxResources,deltaResources:this.resourcesDelta})),h.createElement(Sn,{sourceType:Wn,items:t.items,onDropItem:function(e,n,r,o,a){switch(o){case Wn:t.onMoveItemInWarehouse&&t.onMoveItemInWarehouse(n,r);break;case Jt.adventurerInventory:t.onMoveItemFromAdventurer&&t.onMoveItemFromAdventurer(a,e,n,r)}}}),i)}},{key:"componentDidUpdate",value:function(e){var t=this;Object.keys(e.resources).forEach((function(n){t.resourcesDelta[n]=t.props.resources[n]-e.resources[n]})),this.resourcesRef&&(this.resourcesRef.classList.remove("animate"),setTimeout((function(){t.resourcesRef&&t.resourcesRef.classList.add("animate")}),200))}}]),t}(h.Component),_n=function(e){return e.adventurers},Hn=function(e){return e.quests},Bn=(Object(Xe.a)([_n,Hn],(function(e,t){var n=[],r=function(t){return e.find((function(e){return e.id===t}))},o=Object.values(t).reduce((function(e,t){var o=t.party.map((function(e){return r(e)}));return t.status===ze.active&&(e[t.name]=o),n.push.apply(n,Object(c.a)(o)),e}),{});return o.solo=e.filter((function(e){return-1===n.indexOf(e)})),o})),Object(Xe.a)([_n,Hn],(function(e,t){var n=t.reduce((function(e,t){return t.status===ze.active&&e.push.apply(e,Object(c.a)(t.party)),e}),[]);return e.filter((function(e){return-1===n.indexOf(e.id)}))})));var Gn=Object(w.b)((function(e,t){var n=e.structures[F.warehouse],r=he(F.warehouse),o=n.level,a=r.levels[o],c=Bn(e);if(!n)throw new Error("No structure '".concat(F.warehouse,"' found in the store!"));return{adventurersInTown:c,gold:e.gold,items:e.items,level:o,maxResources:a.maxResources,resources:e.resources,workers:n.workers,workersFree:Ut(e)}}),(function(e,t){return{onMoveItemFromAdventurer:function(t,n,r,o){var a=bn(t,r);e(a);var c=Wt(n,o);e(c)},onMoveItemInWarehouse:function(t,n){e(function(e,t){return{type:Dt.moveItemInWarehouse,fromSlot:e,toSlot:t}}(t,n))},onMoveItemInInventory:function(t,n,r){var o=vn(t,n,r);e(o)},onMoveItemToAdventurer:function(t,n,r,o){var a=function(e){return{type:Dt.removeItem,fromSlot:e}}(r);e(a);var c=hn(t,n,o);e(c)},onUpgrade:function(t,n){e(ht(t)),e(_t(F.warehouse)),n++,e(O("log-town-upgrade-structure-complete",{level:n,structure:F.warehouse},p.town))}}}))(Ln),Fn=(n(228),function(e){var t;if(e.structures[e.structure].state===Je.Building){var n=e.buildTask?e.buildTask.progress:1;t=h.createElement("div",null,h.createElement(qt,{label:"Building...",progress:n}))}else t=function(e){switch(he(e).type){case H.production:return h.createElement(Qt,{type:e});case H.resource:return h.createElement(Kt,{type:e});case H.warehouse:return h.createElement(Gn,null);case H.tavern:return h.createElement(Pn,null);default:return h.createElement("div",null," ",e," ")}}(e.structure);return h.createElement("fieldset",{className:"structure-details"},h.createElement("legend",null,"Structure"),t)});var Un=Object(dt.c)(Object(w.b)((function(e,t){return{buildTask:e.tasks.running.filter((function(e){return"town"===e.origin&&e.name==="".concat(t.structure,".build")}))[0],structures:e.structures}}),(function(e){return{onCheatGold:function(t){return e(vt(t))},onCheatResources:function(t){return e(bt(t))}}})),Dn)(Fn),Qn=n(29),Vn=n(1),zn=n(96),Kn=new Vn.Vector3(-50,150,50),Xn=function(e){var t=Object(Qn.d)().camera,n=Object(h.useRef)();Object(h.useEffect)((function(){var e=new zn.a(t);if(e.enableDamping=!0,e.dampingFactor=.05,e.screenSpacePanning=!0,e.minDistance=1,e.maxDistance=250,e.maxPolarAngle=Math.PI/2,e.target=new Vn.Vector3(0,0,0),n.current=e,t.position.copy(Kn),localStorage.getItem("worldpos")){var r=JSON.parse(localStorage.getItem("worldpos"));r&&(t.position.copy(r.cam),e.target.copy(r.target))}}),[t]),Object(h.useEffect)((function(){if(n.current&&e.scrollToPosition){var r=e.scrollToPosition,o=r.x,a=r.y,c=new Vn.Vector3(o,0,a);n.current.target=c,t.position.copy(new Vn.Vector3(o+Kn.x,Kn.y,Kn.z+a))}}),[e.scrollToPosition]),Object(Qn.c)((function(){n.current&&n.current.update(),r.current,e.onCameraMove(t,n.current),localStorage.setItem("worldpos",JSON.stringify({cam:t.position,target:n.current.target}))}),!1),Object(h.useEffect)((function(){return function(){}}),[t.position]);var r=Object(h.useRef)(!1);return Object(h.useEffect)((function(){var e=function(){r.current=!0},t=function(){r.current=!1};return document.addEventListener("mousedown",e),document.addEventListener("mouseup",t),function(){document.removeEventListener("mousedown",e),document.removeEventListener("mouseup",t)}}),[]),null},Jn=function(e){var t=new Vn.SphereGeometry(5,32,32),n=new Vn.MeshBasicMaterial({color:"purple"});return t?b.a.createElement("mesh",{name:e.name,position:e.position,onClick:function(t){e.onClick&&e.onClick(t.object)},geometry:t,material:n}):null};var Yn=function(e){var t=Object(Qn.d)().scene;return Object(h.useEffect)((function(){window.scene||(window.scene=t),window.THREE=Vn}),[]),null},Zn=n(106),$n=n(58),er=n(100),tr=function(e){var t=Object(h.useState)(),n=Object(P.a)(t,2),r=n[0],o=n[1];return Object(h.useEffect)((function(){e.toLowerCase().endsWith("obj")?(new er.a).load(e,(function(e){})):e.toLowerCase().endsWith("dae")?(new Zn.a).load(e,(function(e){var t=new Vn.Group;t.children.push(e.scene),o(t)})):e.toLowerCase().endsWith("fbx")?(new $n.a).load(e,(function(e){o(e)}),void 0,(function(t){console.error("Error loading model ".concat(e),t)})):console.error("Unknown format for model ".concat(e))}),[e]),r},nr=function(e){var t="models/terrain/terrain-grass.dae",n=Object(h.useMemo)((function(){return(new Vn.TextureLoader).load("models/terrain/grass1.png")}),["models/terrain/grass1.png"]),r=tr(t),o=Object(h.useMemo)((function(){return r?r.children[0].children[0].geometry:null}),[r]);return n&&(n.wrapS=n.wrapT=Vn.RepeatWrapping),o&&n?b.a.createElement("mesh",{name:"Model (".concat(t,")"),scale:e.scale||[1,1,1],rotation:e.rotation},b.a.createElement("meshBasicMaterial",{attach:"material",fog:!0},b.a.createElement("primitive",{attach:"map",object:n})),b.a.createElement("bufferGeometry",Object.assign({attach:"geometry"},o))):null},rr=function(e){var t=or(e.size||new Vn.Vector3(1,1,1)),n=new Vn.BoxGeometry(t.x,t.y,t.z),r=new Vn.MeshBasicMaterial({color:e.color||"green"});return n?b.a.createElement("mesh",{name:e.name,position:e.position,onClick:function(t){e.onClick&&e.onClick(t.object)},geometry:n,material:r}):null},or=function(e){if(e instanceof Vn.Vector3)return e;var t=Object(P.a)(e,3),n=t[0],r=t[1],o=t[2];return new Vn.Vector3(n,r,o)},ar=function(e){var t=Object(h.useState)(),n=Object(P.a)(t,2),r=n[0],o=n[1];return Object(h.useEffect)((function(){e.toLowerCase().endsWith("fbx")?(new $n.a).load(e,(function(e){o(e.animations)}),void 0,(function(t){console.error("Error loading file ".concat(e),t)})):console.error("Unknown format for model file ".concat(e))}),[e]),r},cr="models/world/human/Textures/RTS_human_atlas_4096.png",ir=function(e){var t=tr(e.url),n=ar("models/westernkingdoms/animation/archer/WK_archer_01_idle_A.FBX"),r=Object(h.useRef)(),o=Object(h.useMemo)((function(){return(new Vn.TextureLoader).load(cr)}),[cr]),a=Object(h.useState)((function(){return new Vn.AnimationMixer(null)})),c=Object(P.a)(a,1)[0],i=Object(h.useMemo)((function(){return t?t.children[0].geometry:null}),[t]),s=Object(h.useMemo)((function(){return t?t.children[1].geometry:null}),[t]);return Object(h.useEffect)((function(){n&&c.clipAction(n[0],r.current).play()}),[n,s]),Object(Qn.b)((function(e,t){c.update(1*t)})),i&&o?b.a.createElement("group",{ref:r},b.a.createElement("mesh",{name:"Model (".concat(e.url,")"),position:e.position,scale:[1,1,1]},b.a.createElement("meshBasicMaterial",{attach:"material",fog:!0,color:"purple",map:o}),b.a.createElement("bufferGeometry",Object.assign({attach:"geometry"},i)))):null},sr=function(e){var t=tr(e.url),n=Object(h.useMemo)((function(){return t?t.children[0].geometry:null}),[t]),r=Object(h.useMemo)((function(){return(new Vn.TextureLoader).load("models/world/human/Textures/RTS_human_atlas_4096.png")}),["models/world/human/Textures/RTS_human_atlas_4096.png"]);return n&&r?b.a.createElement("mesh",{name:"Model (".concat(e.url,")"),position:e.position,scale:[.01,.01,.01]},b.a.createElement("meshBasicMaterial",{attach:"material",fog:!0,map:r}),b.a.createElement("bufferGeometry",Object.assign({attach:"geometry"},n))):null},ur=[Math.PI/180*-90,0,0],lr=[40,40,40],mr=new Vn.Vector3(0,0,0),dr=function(e){var t=e.activeQuests[0],n=gr(t);return console.log(t.progress,n),b.a.createElement(Qn.a,{style:{height:690,width:648},camera:{fov:10}},b.a.createElement(Yn,null)," */}",b.a.createElement(Xn,{onCameraMove:function(t){var n=pr(t,e.compassCenter),r=n.x,o=n.z,a=new Vn.Vector2(r,o),c=a.distanceTo(new Vn.Vector2(mr.x,mr.z)),i=a.angle();e.onMapMove(c,i)},scrollToPosition:e.scrollToPosition}),b.a.createElement(nr,{rotation:ur,scale:lr}),b.a.createElement(Jn,{onClick:function(e){},position:[62,0,14],name:"party1"}),b.a.createElement(rr,{size:[1,1,1],position:n,color:"red"}),b.a.createElement(rr,{size:[1,1,1],position:[0,0,1],color:"blue"}),b.a.createElement(rr,{size:[1,1,1],position:[1,0,2],color:"blue"}),b.a.createElement(ir,{url:"models/westernkingdoms/models/WK_archer.FBX",position:[220,20,110]}),b.a.createElement(sr,{url:"models/world/human/house_atlas.fbx",position:[10,0,0]}),b.a.createElement(sr,{url:"models/world/human/smithy_atlas.fbx",position:[20,0,10]}))},pr=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=new Vn.Vector3;r.set(t.x/648*2-1,-t.y/690*2+1,.5),r.unproject(e);var o=r.sub(e.position).normalize(),a=(n-e.position.y)/o.y;return e.position.clone().add(o.multiplyScalar(a))},gr=function(e){var t=un(e.name),n=Math.floor(e.progress),r=t.nodes[n],o=t.nodes[n+1],a=new Vn.Vector3(r.x,1,r.y),c=new Vn.Vector3(o.x,1,o.y);return a.lerp(c,e.progress-n)},fr=(n(232),function(e){var t=Object(h.useRef)(null),n=Object(h.useState)(),r=Object(P.a)(n,2),o=r[0],a=r[1],c=Object(h.useState)(),i=Object(P.a)(c,2);i[0],i[1];Object(h.useEffect)((function(){it.addMusicTrack(et.world,"sound/music/TheLoomingBattle.ogg"),it.playMusicTrack(et.world)}),[]);var s=e.quests.filter((function(e){return e.status===ze.active}));s[0];return b.a.createElement("div",{className:"realworldview"},b.a.createElement("div",{className:"compass",ref:t,onClick:function(){a(new Vn.Vector2(1,1))}},b.a.createElement("div",{className:"distance"})),b.a.createElement(dr,{quests:e.quests,onMapMove:function(e,n){var r=t.current,o=r.firstElementChild;r.style.transform="rotate(".concat(n-Math.PI/2,"rad)"),r.style.opacity=e>10?"1":"0",o.style.transform="rotate(".concat(-n+Math.PI/2,"rad)"),o.innerHTML="".concat(e.toFixed(0))},activeQuests:s,compassCenter:new Vn.Vector2(525,585),scrollToPosition:o}))});var vr,hr=Object(dt.c)(Object(w.b)((function(e,t){return{quests:e.quests}}),(function(e,t){return{onAdvanceQuest:function(e){}}})),mt)(fr);n(233);!function(e){e[e.bottom=0]="bottom",e[e.top=1]="top",e[e.left=2]="left",e[e.right=3]="right"}(vr||(vr={}));var br,yr=["img/terrain/mountains512.png","img/town/effects/plasma_beam_heavy_green.png","img/town/effects/smoke.png","img/town/sky.jpg","img/town/lighthouse.png","img/town/tavern.png","img/town/mill.png","sound/fx/button-click.ogg","sound/fx/error.ogg","sound/music/Soliloquy.mp3","sound/music/TheLoomingBattle.ogg"],wr=n(105),Or=n(47),kr=n(36);!function(e){e.addWorkers="addWorkers"}(br||(br={}));n(92);var jr,Er=function(e){function t(e){var n;return Object(C.a)(this,t),(n=Object(S.a)(this,Object(N.a)(t).call(this,e))).itemSelectRef=void 0,n.handleCheatGold=function(e){var t=n.state.gold;n.props.onCheatGold&&n.props.onCheatGold(t)},n.handleCheatWorkers=function(e){var t=n.state.workers;n.props.onCheatWorkers&&n.props.onCheatWorkers(t)},n.handleCheatResources=function(e){n.props.onCheatResources&&n.props.onCheatResources(n.state.resources)},n.handleCheatItem=function(e){var t=n.itemSelectRef.current.value;n.props.onCheatItem&&n.props.onCheatItem(t)},n.handleChangeStructureState=function(e,t){n.props.onCheatStructureState&&n.props.onCheatStructureState(e,t?Je.Built:Je.NotBuilt)},n.handleChangeGold=function(e){var t=Number(e.target.value);n.setState({gold:t})},n.handleChangeWorkers=function(e){var t=Number(e.target.value);n.setState({workers:t})},n.handleChangeResources=function(e){var t=Number(e.target.checked);n.setState({resources:t})},n.state={gold:50,resources:50,workers:10},n.itemSelectRef=h.createRef(),n}return Object(D.a)(t,e),Object(x.a)(t,[{key:"render",value:function(){var e=this,t=Object.keys(this.props.structures).map((function(t){return function(t){var n=he(t),r=e.props.structures[t],o=n.levels[r.level],a=Ge.get(o.displayName);return h.createElement("div",{className:"label-dropdown",key:t},h.createElement("label",{title:t},"".concat(a)),h.createElement("input",{key:t,type:"checkbox",checked:e.props.structures[t].state===Je.Built,onChange:function(){return e.handleChangeStructureState(t,e.props.structures[t].state!==Je.Built)}}))}(t)})),n=function(e){return h.createElement("option",{value:e,key:e},Ge.getItemName(e))},r=Object.keys(k).filter((function(e){return!isNaN(e)})).map((function(e){return h.createElement("optgroup",{label:k[e],key:e},function(e){return Object.keys(j).filter((function(t){return He(t).itemType==e})).map((function(e){return n(e)}))}(e))}));return h.createElement("div",{className:"cheat-box"},h.createElement("div",{className:"label-numberbox-button"},h.createElement("label",null,"Gold"),h.createElement("input",{type:"number",value:this.state.gold,style:{width:"50px"},onChange:this.handleChangeGold}),h.createElement("button",{onClick:this.handleCheatGold},"Add")),h.createElement("div",{className:"label-numberbox-button"},h.createElement("label",null,"Workers"),h.createElement("input",{type:"number",value:this.state.workers,style:{width:"50px"},onChange:this.handleChangeWorkers}),h.createElement("button",{onClick:this.handleCheatWorkers},"Add")),h.createElement("div",{className:"label-numberbox-button"},h.createElement("label",null,"Resources"),h.createElement("input",{type:"number",value:this.state.resources,style:{width:"50px"},onChange:this.handleChangeResources}),h.createElement("button",{onClick:this.handleCheatResources},"Add")),h.createElement("div",{className:"label-numberbox-button"},h.createElement("label",null,"Items"),h.createElement("select",{style:{width:"150px"},ref:this.itemSelectRef},r),h.createElement("button",{onClick:this.handleCheatItem},"Add")),t)}}]),t}(h.Component),Tr=[wt.food,wt.wood,wt.stone,wt.fabric,wt.leather],Ir=Object(dt.c)(Object(w.b)((function(e){return{structures:e.structures}}),(function(e){return{onCheatGold:function(t){e(vt(t)),e(O("common-cheat-gold-added",{amount:t},p.common))},onCheatItem:function(t){e(Wt(t)),e(O("common-cheat-item-added",{item:t},p.common))},onCheatResources:function(t){var n=Tr.reduce((function(e,n){return e[n]=t,e}),{});e(bt(n)),e(O("common-cheat-resources-added",{amount:t},p.common))},onCheatStructureState:function(t,n){return e(function(e,t){return{type:At.setStructureState,structure:e,state:t}}(t,n))},onCheatWorkers:function(t){var n;e((n=t,{type:br.addWorkers,value:n})),e(O("common-cheat-workers-added",{amount:t},p.common))}}})),Dn)(Er),Cr=function(e){function t(e){var n;return Object(C.a)(this,t),(n=Object(S.a)(this,Object(N.a)(t).call(this,e))).state={},n}return Object(D.a)(t,e),Object(x.a)(t,[{key:"render",value:function(){var e=this;return h.createElement("div",{className:"menu"},h.createElement("ul",null,h.createElement("li",{onClick:function(){var t=h.createElement(Ir,{title:"Cheats"});e.props.onOpenWindow(t)}},"Cheats!")))}}]),t}(h.Component),xr=Object(dt.c)(Dn,mt)(Cr),Sr=(n(234),function(e){var t=function(e,t,n){return h.createElement("li",{title:n,key:n},h.createElement("div",{className:"icon common-icon-smallest",style:{backgroundImage:"url(".concat(e,")")}}),h.createElement("div",{className:"amount"},t.toFixed(0)))},n=Tr.map((function(n){return t(Tt[n].iconImg,e.resources[n],Ge.getResourceName(n))}));return n.push(t("/img/resources/worker.png",e.workersFree,"workers"),t("/img/resources/gold.png",e.gold,"gold")),h.createElement("ul",{className:"resourcebar"},n)}),Nr=Object(w.b)((function(e){return{gold:e.gold,resources:e.resources,workers:e.workers,workersFree:Ut(e)}}))(Sr),qr=(n(235),Object(dt.c)(Object(w.b)((function(e){return{}})),kr.f,mt)((function(e){return h.createElement("div",{className:"topbar"},h.createElement("div",{className:"topbar-left"},h.createElement(Nr,null)),h.createElement("div",{className:"topbar-right"},h.createElement("div",{className:"hamburger",onClick:function(t){var n=h.createElement(xr,{title:"Menu"});e.onOpenWindow(n)}},"\u2630")))}))),Dr=(n(237),n(102)),Ar=function(e){function t(){return Object(C.a)(this,t),Object(S.a)(this,Object(N.a)(t).apply(this,arguments))}return Object(D.a)(t,e),Object(x.a)(t,[{key:"render",value:function(){var e=this.props,t=e.itemsLoaded,n=e.itemsTotal;return h.createElement("div",null," ","Loading (".concat(Math.floor((t||0)/(n||0)*100),")%")," ")}}]),t}(h.Component);!function(e){e[e.image=0]="image",e[e.sound=1]="sound"}(jr||(jr={}));var Rr=function(e){function t(e){var n;return Object(C.a)(this,t),(n=Object(S.a)(this,Object(N.a)(t).call(this,e))).loadMedia=function(){n.setState({itemsLoaded:0});var e=n.props.manifest.map((function(e){return n.loadItem(e).catch((function(e){return console.error(e)}))}));Promise.all(e).then((function(e){n.props.onLoadComplete&&n.props.onLoadComplete(Pr),n.setState({completed:!0})}))},n.loadItem=function(){var e=Object(u.a)(s.a.mark((function e(t){var r,o,a,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Pr.some((function(e){return e.url===t}))&&console.warn("Loading media with url ".concat(t," more than once! Will overwrite.")),(r=Wr(t))!==jr.image){e.next=7;break}return e.next=5,Mr(t);case 5:a=e.sent,o={content:a,mediaType:r,url:t};case 7:if(r===jr.sound&&(c=new Dr.Howl({src:[t]}),o={content:c,mediaType:r,url:t}),!o){e.next=14;break}return Pr.push(o),n.setState({itemsLoaded:n.state.itemsLoaded+1}),e.abrupt("return",o);case 14:throw new Error("Unknown error while trying to load ".concat(t));case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.state={completed:!1,itemsLoaded:0},n}return Object(D.a)(t,e),Object(x.a)(t,[{key:"componentDidMount",value:function(){this.loadMedia()}},{key:"componentDidUpdate",value:function(e){}},{key:"componentWillUnmount",value:function(){}},{key:"render",value:function(){var e=this.props,t=e.children,n=e.manifest,r=this.state.completed,o=h.createElement(Ar,{itemsLoaded:this.state.itemsLoaded,itemsTotal:n.length});return r?t:o}}]),t}(h.Component),Pr=[],Mr=function(e){var t=new Image;return t.src=e,new Promise((function(e,n){function r(){t.naturalWidth?e(t):n(null),t.removeEventListener("load",r),t.removeEventListener("error",r)}t.naturalWidth?e(t):t.complete?n(null):(t.addEventListener("load",r),t.addEventListener("error",r))}))},Wr=function(e){if((e=e.toLowerCase()).endsWith("png")||e.endsWith("jpg")||e.endsWith("gif"))return jr.image;if(e.endsWith("mp3")||e.endsWith("ogg")||e.endsWith("wav"))return jr.sound;throw Error("Could not determine type for ".concat(e))};var Lr,_r,Hr=Object(w.b)((function(e,t){return{store:e}}),(function(e,t){return{handleStartConstruction:function(t){var n=he(t);e(ht(n.cost.gold||0)),e(function(e){return{type:At.startBuildingStructure,structure:e}}(t));var r=[Lt(t)],o=n.cost.time,a=Gt(Ft.buildStructure,"".concat(t,".build"),"town",o,r);e(a)}}}))((function(e){var t,n=e.info;switch(n.itemType){case k.deed:var r=e.store.gold,o=n,a=he(o.structure),c=a.cost.gold||0<=r,i=!(e.store.structures[o.structure].state===Je.NotBuilt)||!c;return h.createElement("div",null,h.createElement("p",null,' " ',n.subText,' " '),h.createElement("button",{disabled:i,onClick:function(){return e.handleStartConstruction(o.structure)}},"Start construction (",a.cost.gold," gold)"));case k.weapon:var s=(t=n.item,Me[t]);return h.createElement(h.Fragment,null,h.createElement("p",null,' " ',n.subText,' " '),h.createElement("p",null," damage: ",s.damage[je.kinetic]," "));case k.apparel:var u=function(e){return B[e]}(n.item);return h.createElement(h.Fragment,null,h.createElement("p",null,' " ',n.subText,' " '),u.armorRating&&h.createElement("p",null," armor: ",u.armorRating," "));default:return h.createElement("p",null,' " ',n.subText,' " ')}})),Br=(n(238),function(e){function t(){return Object(C.a)(this,t),Object(S.a)(this,Object(N.a)(t).apply(this,arguments))}return Object(D.a)(t,e),Object(x.a)(t,[{key:"render",value:function(){var e,t=this.props.info,n=this.props.type;switch(t||(t={iconImg:"/img/items/deeds/deed.png",item:j.deedForWeaponsmith,itemType:k.weapon,subText:"It allows for the construction of a weaponsmith"}),n){case jt.item:default:e=h.createElement(Hr,{info:t})}var r=Ge.getItemName(t.item);return h.createElement("div",{className:"contextbox"},h.createElement("div",null,r," "),e)}},{key:"componentDidUpdate",value:function(){}}]),t}(h.Component)),Gr=(Lr=Br,function(e){var t=h.useRef(null),n=h.useState(e.placement||vr.bottom),r=Object(P.a)(n,2),o=r[0],a=r[1],c=e.containerRect,i=e.referenceRect;h.useEffect((function(){var e=t.current,n=e.getBoundingClientRect();switch(o){case vr.top:if(n.top-n.height-8-8<c.top)return void a(vr.bottom);break;case vr.bottom:if(n.top+n.height+8+8>c.height)return void a(vr.top)}if(e.style.opacity="1",n.left<c.left+8){var r=c.left-n.left+8;e.querySelector(".popup-content").style.transform="translateX(".concat(r,"px)")}if(n.right>c.right-8){var i=n.right-c.right+8;e.querySelector(".popup-content").style.transform="translateX(".concat(-i,"px)")}}),[o]);var s=0,u=0,l="";switch(o){case vr.bottom:s=i.left-c.left+i.width/2,u=i.top-c.top+i.height,l="popup-bottom";break;case vr.top:s=i.left-c.left+i.width/2,u=i.top-c.top,l="popup-top"}return h.createElement("div",{className:"popup ".concat(l),style:{left:s,opacity:0,top:u},ref:t},h.createElement("div",{className:"popup-arrow"}),h.createElement("div",{className:"popup-content"},h.createElement(Lr,e)))});!function(e){e[e.Town=0]="Town",e[e.World=1]="World"}(_r||(_r={}));var Fr=860,Ur=648,Qr=h.createContext(null),Vr=function(e){function t(e){var n;return Object(C.a)(this,t),(n=Object(S.a)(this,Object(N.a)(t).call(this,e))).containerRef=void 0,n.selectStructure=function(e){if(e){var t=Ge.getStructureName(e),r=h.createElement(Un,{structure:e,title:t});n.handleWindowOpened(r)}},n.handleMediaLoadComplete=function(e){var t,r=e.filter((function(e){return e.mediaType===jr.sound}));it.loadMedia(r),it.addSounds((t={},Object(I.a)(t,tt.buttonClick,"sound/fx/button-click.ogg"),Object(I.a)(t,tt.error,"sound/fx/error.ogg"),t)),n.setState({media:e})},n.handleContextualObjectActivated=function(e,t,r,o){n.setState({selectedContext:{contextInfo:t,contextType:e,contextRect:o}})},n.handleAppClick=function(){n.state.selectedContext&&n.setState({selectedContext:null})},n.handleWindowOpened=function(e){n.setState({activeWindows:[].concat(Object(c.a)(n.state.activeWindows),[e])})},n.handleWindowClose=function(){n.state.activeWindows.length&&n.setState({activeWindows:[]})},n.handleWindowBack=function(){n.state.activeWindows.length&&n.setState({activeWindows:n.state.activeWindows.slice(0,-1)})},n.state={selectedContext:null,containerRect:null,media:[],selectedStructure:null,activeWindows:[]},n.containerRef=h.createRef(),n.handleResize=n.handleResize.bind(Object(q.a)(n)),n}return Object(D.a)(t,e),Object(x.a)(t,[{key:"render",value:function(){var e=this,t=function(){it.playSound(tt.buttonClick)},n=null;if(this.state.selectedContext){var r=this.state.selectedContext,o=r.contextType,a=r.contextInfo,c=r.contextRect;n=h.createElement(Gr,{type:o,info:a,containerRect:this.state.containerRect,referenceRect:c,placement:vr.bottom})}var i=this.getActiveWindow();return h.createElement(Qr.Provider,{value:{media:this.state.media,onContextualObjectActivated:this.handleContextualObjectActivated,onOpenWindow:this.handleWindowOpened}},h.createElement("div",{className:"app",ref:this.containerRef,style:{width:Ur,height:Fr},onClick:this.handleAppClick},h.createElement($t.b,{backend:wr.a},h.createElement(Or.a,null,h.createElement(Rr,{manifest:yr,onLoadComplete:this.handleMediaLoadComplete},h.createElement(qr,null),h.createElement(kr.a,{from:"/",to:"world"}),h.createElement(kr.b,{path:"/world",component:function(){return h.createElement(Or.b,{to:"/town"},h.createElement("button",{onClick:function(){return t()}}," ",Ge.get("common-view-button-town")," "))}}),h.createElement(kr.b,{path:"/town",component:function(){return h.createElement(Or.b,{to:"/world"},h.createElement("button",{onClick:function(){return t()}}," ",Ge.get("common-view-button-world")," "))}})," | ",h.createElement("button",{onClick:function(){return e.props.persistor.purge(),void window.location.reload()},style:{color:"red"}}," Restart! "),h.createElement(kr.b,{path:"/town",component:function(){return h.createElement(ft,{onStructureClick:e.selectStructure})}}),h.createElement(kr.b,{path:"/world",component:function(){return h.createElement(hr,null)}}),i,n,h.createElement(Ze,null))))))}},{key:"componentDidMount",value:function(){window.addEventListener("resize",this.handleResize),this.handleResize()}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.handleResize)}},{key:"getActiveWindow",value:function(){if(!this.state.activeWindows.length)return null;var e=this.state.activeWindows[this.state.activeWindows.length-1],t={onClose:this.handleWindowClose,onBack:this.handleWindowBack,backEnabled:this.state.activeWindows.length>1,closeEnabled:!0};return h.cloneElement(e,t)}},{key:"handleResize",value:function(){if(this.containerRef.current){window.innerHeight<Fr?this.containerRef.current.style.transform="scale(".concat(window.innerHeight/Fr,") translateX(-50%)"):this.containerRef.current.style.transform="scale(1) translateX(-50%)";var e=this.containerRef.current.getBoundingClientRect();this.setState({containerRect:e,selectedContext:null})}}}]),t}(h.Component);var zr,Kr=Object(w.b)((function(e,t){return{}}),(function(e,t){return{}}))(Vr),Xr=(n(239),function(e){var t=he(F.warehouse),n=e.structures[F.warehouse].level;return t.levels[n].maxResources}),Jr=function(e,t){var n=t.structures,r={},o=e/6e4,a=Xr(t);return Object.keys(n).forEach((function(e){return function(e){var t=he(e);if(t.type===H.resource){var a=t,c=n[e].level,i=a.levels[c];Object.keys(i.generates).reduce((function(t,r){var a=i.generates[r]*n[e].workers*o;return t[r]=(t[r]||0)+a,t}),r)}}(e)})),Object.keys(r).forEach((function(e){r[e]&&t.resources[e]+r[e]>=a[e]&&(r[e]=a[e]-t.resources[e])})),r},Yr=function(e,t){return t.party.map((function(t){return Zr(e,t)}))},Zr=function(e,t){return e.adventurers.find((function(e){return e.id===t}))},$r=function(e){return!!e.rngState},eo=n(103),to=n.n(eo);function no(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return e=Math.ceil(e),t=Math.floor(t),Math.floor(function(){if(!zr)throw new Error("Call init() before random()");return ro=!0,zr()}()*(t-e+1))+e}var ro=!1,oo=function(){function e(t,n){Object(C.a)(this,e),this.questName=void 0,this.store=void 0,this.questName=t,this.store=n}return Object(x.a)(e,[{key:"getAdventurerWithHighest",value:function(e){return Yr(this.store,this.quest).concat().sort((function(t,n){return n.stats[e]-t.stats[e]}))[0]}},{key:"getAdventurerWithLowest",value:function(e){return Yr(this.store,this.quest).concat().sort((function(t,n){return t.stats[e]-n.stats[e]}))[0]}},{key:"getRandomAdventurer",value:function(){return this.adventurers[no(0,this.adventurers.length)]}},{key:"questVars",get:function(){return this.quest.questVars}},{key:"quest",get:function(){var e=this;return this.store.quests.find((function(t){return t.name===e.questName}))}},{key:"adventurers",get:function(){return Yr(this.store,this.quest)}}]),e}(),ao={},co={name:nn.backstabbed,getOracle:function(e,t){return new oo(e,t)},getDescription:function(e){return{key:"encounter-backstabbed-description"}},getOptions:function(e){return{fight:"Fight the brigands",flight:"Run away!"}},answer:function(e,t,n){switch(e){case"flight":return"You run away like a pussy";case"fight":var r=t.getRandomAdventurer();return n(hn(r.id,j.deedForWeaponsmith)),"The party fights off the rogues. One of them drops a document. ".concat(r.name," picks it up");default:throw new Error("Unhandled option '".concat(e))}}},io={name:nn.goblinHouseOutside,getOracle:function(e,t){return new oo(e,t)},getDescription:function(e){return{key:"encounter-goblinHouseOutside-description"}},getOptions:function(e){return{investigate:"Investigate",leave:"Keep walking"}},answer:function(e,t,n){t.store,t.questVars;var r=t.quest;switch(e){case"investigate":return n(Xt(r.name,nn.goblinHouseHallway)),"The party coutiously opens the door and goes inside";case"leave":return n(Xt(r.name,nn.goblinHouseHallway)),"The party coutiously opens the door and goes inside";default:throw new Error("Unhandled option ".concat(e))}}},so={backstabbed:co,goblinHouseHallway:{name:nn.goblinHouseHallway,getOracle:function(e,t){return new oo(e,t)},getDescription:function(e){return{key:"encounter-goblinHouseHallway-description"}},getOptions:function(e){return{investigate:"Go inside the house",leave:"Leave the premise"}},answer:function(e,t,n){t.store,t.questVars,t.quest;switch(e){case"walkAround":return"Your party walks around the tree";case"leave":return n(function(e){return{type:zt.advanceQuest,questName:e}}(t.questName)),"The party escapes the house unscathed";default:throw new Error("Unhandled option ".concat(e))}}},goblinHouseOutside:io,theBigTree:{name:nn.theBigTree,getOracle:function(e,t){return new oo(e,t)},getDescription:function(e){return{key:"encounter-thebigtree-description"}},getOptions:function(e){var t=e.getAdventurerWithHighest("strength");return{walkAround:"Walk around the tree",lift:"Lift the tree (".concat(t.name,")")}},answer:function(e,t,n){var r=t.questVars,o=t.quest;switch(e){case"walkAround":return"Your party walks around the tree";case"lift":var a=t.getAdventurerWithHighest("strength");r.treeState="lifted",n(function(e,t){return{type:zt.updateQuestVars,questName:e,vars:t}}(o.name,r));var c=no(2,5);return n(vt(c)),"".concat(a.name," heaves and lifts the heavy tree, moving it aside. Underneath your party finds ").concat(c," gold coins");default:throw new Error("Unhandled option ".concat(e))}}}},uo=so;function lo(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function mo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?lo(n,!0).forEach((function(t){Object(I.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):lo(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var po=function(e,t){var n=[],r=[];return t.quests.forEach((function(t){if(t.status===ze.active){var o=sn[t.name],a=t.progress,c=Math.floor(a);if(o.nodes[c].type===rn.nothing){for(var i=e/6e4*4,s=Math.min(a+i,o.nodes.length-1),u=Math.floor(s)-c,l=t.currentEncounter,m=1;m<=u;m++){var d=o.nodes[c+m];if(d.type===rn.encounter){var g=uo[d.encounter],f=ao[t.name];s=c+m,l=d.encounter,n.push(mo({channel:p.quest,channelContext:t.name},g.getDescription(f)));break}d.type===rn.nothing&&(l=null,d.log&&n.push({channel:p.quest,channelContext:t.name,key:d.log}))}r.push({currentEncounter:l,name:t.name,progress:s})}}})),{logUpdates:n,questUpdates:r}},go=function(){return ro?(ro=!1,zr.state()):null},fo=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function vo(){if("serviceWorker"in navigator){if(new URL("/gilles-game",window.location.toString()).origin!==window.location.origin)return;window.addEventListener("load",(function(){var e="".concat("/gilles-game","/service-worker.js");fo?(!function(e){fetch(e).then((function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):ho(e)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")}))):ho(e)}))}}function ho(e){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var t=e.installing;t&&(t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}function bo(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function yo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?bo(n,!0).forEach((function(t){Object(I.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bo(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var wo=function(){return{strength:100*Math.random(),perception:100*Math.random(),endurance:100*Math.random(),charisma:100*Math.random(),intelligenge:100*Math.random(),agility:100*Math.random(),luck:100*Math.random()}},Oo=[{id:"c4a5d270",equipment:{chest:j.chest,head:j.cowl},stats:wo(),health:100*Math.random(),room:0,name:"Ximena Maddox",avatarImg:"/img/avatars/andy-victorovych-a1.jpg",inventory:[j.deedForLumbermill,null,j.crossbow,j.dagger,j.khopesh,null,j.sword,null,null,null,null,null,null,null,null,null]},{id:"2e655832",equipment:{},stats:wo(),name:"Donte Houston",health:100*Math.random(),room:1,avatarImg:"/img/avatars/andy-victorovych-a2.jpg",inventory:[j.crossbow,null,null,null,null,j.boots1,j.chainmailHood,j.nomadHelmet,j.plateChest4,null,null,null,null,null,null,null,null,null,null,null,null,null,j.plateHelmet,j.cowl]},{id:"ec6f1050",equipment:{},stats:wo(),name:"Zackary Morris",health:100*Math.random(),room:2,avatarImg:"/img/avatars/andy-victorovych-a3.jpg",inventory:[j.greatswordOfGwai,null,null,null]},{id:"d299f98a",stats:wo(),equipment:{},name:"Mike Keith",health:100*Math.random(),room:4,avatarImg:"/img/avatars/andy-victorovych-a4.jpg",inventory:[null,null,null,null,j.khopesh,j.hornedHelmet]},{id:"96c686c3",equipment:{},stats:wo(),name:"Wayne Monroe",health:100*Math.random(),room:5,avatarImg:"/img/avatars/andy-victorovych-a5.jpg",inventory:[null,null,null]},{id:"250d1a9d",stats:wo(),equipment:{},name:"Mike Keith",health:100*Math.random(),room:9,avatarImg:"/img/avatars/andy-victorovych-a6.jpg",inventory:[null,null,null,null,null]},{id:"169384ef",equipment:{},stats:wo(),name:"Karlee Nolan",health:100*Math.random(),room:3,avatarImg:"/img/avatars/andy-victorovych-a7.jpg",inventory:[j.greatswordOfGwai,null,null,null]},{id:"f22d66cb",stats:wo(),equipment:{},name:"Gylbarde the Earnest",health:100*Math.random(),room:8,avatarImg:"/img/avatars/andy-victorovych-a8.jpg",inventory:[null,null,null,null,null]},{id:"36c686c1",equipment:{},stats:wo(),name:"Lanslet of the Water",health:100*Math.random(),room:6,avatarImg:"/img/avatars/andy-victorovych-a9.jpg",inventory:[j.greatswordOfGwai,null,null,null,j.shoulders1,j.fedora,j.greaves2]},{id:"12c613d4",equipment:{},stats:wo(),name:"Tedric the Bold",health:100*Math.random(),room:7,avatarImg:"/img/avatars/andy-victorovych-a10.jpg",inventory:[j.greatswordOfGwai,null,null,null]}];function ko(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function jo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ko(n,!0).forEach((function(t){Object(I.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ko(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Eo={lastTick:Date.now()};function To(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Io(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?To(n,!0).forEach((function(t){Object(I.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):To(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Co=[null,null,null,j.dagger,j.deedForWeaponsmith];function xo(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var So=function(e,t){if(!t.log.length)return e;var n=t.log.map((function(e){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?xo(n,!0).forEach((function(t){Object(I.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xo(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e,{time:Date.now()})}));return[].concat(Object(c.a)(n),Object(c.a)(e))};function No(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function qo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?No(n,!0).forEach((function(t){Object(I.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):No(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Do,Ao=[{name:"kill10Boars",status:ze.active,party:["c4a5d270","2e655832","ec6f1050","d299f98a"],progress:0,questVars:{},encounterResults:[],icon:"sigil1.png",currentEncounter:null},{name:"retrieveMagicAmulet",party:[],status:ze.available,progress:0,questVars:{},encounterResults:[],icon:"sigil2.png",currentEncounter:null,reward:{gold:4,items:[j.deedForWeaponsmith]}}],Ro=function(e,t){var n=t.assignedAventurers.filter((function(e){return!!e})).map((function(e){return e.id}));return e.map((function(e){return e.name===t.questName?qo({},e,{status:ze.active,party:n}):e}))},Po=function(e,t){return e.map((function(e){if(e.name===t.questName){var n=e.progress+1;sn[e.name];return qo({},e,{progress:n})}return e}))},Mo=function(e,t){return e.map((function(e){return e.name===t.questName?qo({},e,{currentEncounter:t.encounter}):e}))},Wo=function(e,t){var n=t.quests;return n.length?e.map((function(e){var t=n.find((function(t){return t.name===e.name}));if(t){var r=t.progress,o=t.currentEncounter;return qo({},e,{progress:r,currentEncounter:o})}return e})):e},Lo=function(e,t){return e.map((function(e){return e.name===t.questName?qo({},e,{questVars:Object.assign({},e.questVars,t.vars)}):e}))},_o=function(e,t){return e.map((function(e){if(e.name===t.questName){var n=e.encounterResults.concat();return n[t.nodeIndex]=t.result,qo({},e,{encounterResults:n})}return e}))},Ho={fabric:0,food:0,iron:60,leather:0,stone:0,wood:40},Bo=(Do={},Object(I.a)(Do,F.alchemist,{level:0,workers:1,state:Je.NotBuilt}),Object(I.a)(Do,F.armoursmith,rt),Object(I.a)(Do,F.garden,{level:0,workers:0,state:Je.Built}),Object(I.a)(Do,F.lumberMill,rt),Object(I.a)(Do,F.mine,{level:0,workers:0,state:Je.NotBuilt}),Object(I.a)(Do,F.quarry,rt),Object(I.a)(Do,F.tavern,{level:0,workers:0,state:Je.Built}),Object(I.a)(Do,F.tannery,rt),Object(I.a)(Do,F.warehouse,{level:0,workers:0,state:Je.Built}),Object(I.a)(Do,F.weaponsmith,{level:0,workers:0,state:Je.Built}),Object(I.a)(Do,F.weaver,rt),Object(I.a)(Do,F.workshop,rt),Do);function Go(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Fo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Go(n,!0).forEach((function(t){Object(I.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Go(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Uo=function(e,t,n){var r=Fo({},e[t],{state:n});return Fo({},e,Object(I.a)({},t,r))},Qo={completed:[],running:[]};function Vo(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function zo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Vo(n,!0).forEach((function(t){Object(I.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Vo(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ko=function(e){return{name:e.name,origin:e.origin,type:e.taskType,callbacks:e.callbacks,timeRemaining:e.time,startTime:Date.now(),lastTick:Date.now(),progress:0}},Xo=Object(dt.b)({adventurers:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Oo,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case gn.moveItemInInventory:var n=t,r=n.adventurerId,o=n.fromSlot,a=n.toSlot,c=e.find((function(e){return e.id===r})),i=c.inventory.map((function(e,t){return t===o?c.inventory[a]:t===a?c.inventory[o]:e}));return e.map((function(e){return e===c?yo({},e,{inventory:i}):e}));case gn.moveItemToOtherAdventurer:var s=t,u=s.adventurerId,l=s.fromSlot,m=s.toAdventurerId,d=e.find((function(e){return e.id===u})),p=d.inventory[l];return e.map((function(e){if(e.id===u){var t=e.inventory.concat();return t[l]=null,yo({},e,{inventory:t})}if(e.id===m){var n=e.inventory.concat(),r=n.findIndex((function(e){return null===e}));return n[r]=p,yo({},e,{inventory:n})}return e}));case gn.addItemToInventory:var g=t,f=g.item;return e.map((function(e){if(e.id===t.adventurerId){var n=e.inventory.concat(),r=t.toSlot;return null===r&&(r=n.findIndex((function(e){return null===e||void 0===e}))),n[r]=f,yo({},e,{inventory:n})}return e}));case gn.removeItemFromInventory:var v=t,h=v.fromSlot;return e.map((function(e){if(e.id===t.adventurerId){var n=e.inventory.map((function(e,t){return t!==h?e:null}));return yo({},e,{inventory:n})}return e}));case gn.assignEquipment:var b=t,y=b.equipmentSlot,w=b.item;return e.map((function(e){return e.id===t.adventurerId?yo({},e,{equipment:yo({},e.equipment,Object(I.a)({},yn[y],w))}):e}));case gn.removeEquipment:var O=t,k=O.equipmentSlot;return e.map((function(e){return e.id===t.adventurerId?yo({},e,{equipment:yo({},e.equipment,Object(I.a)({},yn[k],null))}):e}))}return e},combat:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case r.startCombatAction:var n=t;return jo({},e,{action:{actor:n.actor,endsAt:n.endsAt,target:n.target,type:n.combatType}});case r.moveActor:var o=t,a=e.actors.map((function(e){return e.name===o.actor?jo({},e,{location:o.location}):e}));return jo({},e,{actors:a});case r.clearCombatAction:return jo({},e,{action:void 0})}return e},engine:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Eo,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case d.gameTick:return Io({},e,{lastTick:Date.now()})}return e},gold:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case pt.addGold:return e+t.amount}return e},items:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Co,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Dt.addItem:var n=t,r=n.item,o=t,a=o.toSlot;return void 0===a&&-1===(a=e.findIndex((function(e){return null===e})))?[].concat(Object(c.a)(e),[r]):e.map((function(e,t){return t===a?r:e}));case Dt.moveItemInWarehouse:var i=t,s=i.fromSlot,u=i.toSlot;return e.map((function(t,n){return n===s?null:n===u?e[s]:t}));case Dt.removeItem:var l=t,m=l.fromSlot;return e.map((function(e,t){return t!==m?e:null}))}return e},log:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case g.addLogEntry:var n=t,r=n.key,o=n.channel,a=n.channelContext,i=n.context,s=Date.now();return[{channel:o,channelContext:a,context:i,key:r,time:s}].concat(Object(c.a)(e));case d.gameTick:return So(e,t)}return e},quests:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ao,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case zt.launchQuest:return Ro(e,t);case zt.advanceQuest:return Po(e,t);case zt.updateQuestVars:return Lo(e,t);case zt.updateEncounterResult:return _o(e,t);case zt.startEncounter:return Mo(e,t);case d.gameTick:return Wo(e,t)}return e},resources:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ho,t=arguments.length>1?arguments[1]:void 0,n=function(t){return Object.keys(e).reduce((function(n,r){return n[r]=e[r]+(t[r]||0),n}),{})};switch(t.type){case gt.addResources:var r=t.resources;return n(r);case gt.removeResources:var o=t.resources;return Object.keys(e).reduce((function(t,n){return t[n]=e[n]-(o[n]||0),t}),{});case d.gameTick:var a=t.resources;return n(a)}return e},rngState:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;return t.type===d.gameTick&&null!=t.rngState&&(e=Object.assign({},t.rngState)),e},structures:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Bo,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case At.startBuildingStructure:return Uo(e,t.structure,Je.Building);case At.finishBuildingStructure:return Uo(e,t.structure,Je.Built);case At.upgradeStructure:var n=e[t.structure].level+1,r=Fo({},e[t.structure],{level:n});return Fo({},e,Object(I.a)({},t.structure,r));case At.increaseWorkers:var o=t,a=o.workers,c=e[t.structure].workers+a,i=Fo({},e[t.structure],{workers:c});return Fo({},e,Object(I.a)({},t.structure,i));case At.decreaseWorkers:var s=t,u=s.workers,l=e[t.structure].workers-u,m=Fo({},e[t.structure],{workers:l});return Fo({},e,Object(I.a)({},t.structure,m));case At.setStructureState:var d=t,p=d.state;return Uo(e,t.structure,p)}return e},tasks:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Qo,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Rt.start:var n=Ko(t),r=e.running.concat(n);return zo({},e,{running:r});case d.gameTick:var o=Date.now(),a=[],c=[];return e.running.forEach((function(e){var t=o+e.timeRemaining,n=(o-e.startTime)/(t-e.startTime),r=e.timeRemaining-(o-e.lastTick),i=zo({},e,{progress:n,lastTick:o,timeRemaining:r});r<0?c.push(i):a.push(i)})),{running:a,completed:c}}return e},workers:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:13,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case br.addWorkers:return e+t.value}return e}}),Jo=n(69),Yo=n(104),Zo={key:"root",storage:n.n(Yo).a,version:T},$o=Object(Jo.a)(Zo,Xo),ea=Object(u.a)(s.a.mark((function e(){var t,n=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},e.abrupt("return",new Promise((function(e,n){var r=Object(dt.d)($o,t,window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__()),o=Object(Jo.b)(r,void 0,(function(){var t=$r(r.getState());e({store:r,persistor:o,isHydrated:t})}))})));case 2:case"end":return e.stop()}}),e)}))),ta=function(){var e=Object(u.a)(s.a.mark((function e(){var t,n,r,o,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.a.get("lang/en-US.json");case 2:return t=e.sent,n=t.data,Ge.init(n),c="GILLESROX2",ro=!0,zr=to()(c,{state:!0}),e.next=8,ea();case 8:r=e.sent,o=r.store,a=r.persistor,r.isHydrated?ra(o):na(o),oa(o,a);case 14:case"end":return e.stop()}var c}),e)})));return function(){return e.apply(this,arguments)}}(),na=function(e){e.dispatch(O("test-game-welcome")),console.log("Starting new GILLES-IDLE-GAME (version ".concat("0.0.4",")"))},ra=function(e){console.log("Continuing existing GILLES-IDLE-GAME (version ".concat("0.0.4",")"))},oa=function(e,t){y.render(h.createElement(w.a,{store:e},h.createElement(Kr,{persistor:t})),document.getElementById("root")),vo();var n=function(t){t.completed.forEach((function(t){return function(t){t.callbacks.forEach((function(t){return e.dispatch(t)}))}(t)}))};setInterval((function(){var t=e.getState(),r=Date.now()-t.engine.lastTick,o=[],a=Jr(r,t),i=go();v(r,e);var s=po(r,t),u=s.questUpdates,l=s.logUpdates;o.push.apply(o,Object(c.a)(l)),e.dispatch(function(e,t,n,r,o){return{type:d.gameTick,delta:e,rngState:t,resources:n,quests:r,log:o}}(r,i,a,u,o)),n(t.tasks)}),2500)};ta()},45:function(e,t,n){},64:function(e,t,n){},78:function(e,t,n){},92:function(e,t,n){}},[[107,1,2]]]);
//# sourceMappingURL=main.2aa4c995.chunk.js.map