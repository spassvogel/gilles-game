(this["webpackJsonpgilles-game"]=this["webpackJsonpgilles-game"]||[]).push([[0],[,function(e,t,n){"use strict";var a,r;n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return r})),function(e){e[e.deed=0]="deed",e[e.apparel=1]="apparel",e[e.material=2]="material",e[e.questItem=3]="questItem",e[e.trinket=4]="trinket",e[e.weapon=5]="weapon"}(a||(a={})),function(e){e.deedForLumbermill="deedForLumbermill",e.deedForWeaponsmith="deedForWeaponsmith",e.boots1="boots1",e.boots2="boots2",e.boots3="boots3",e.chainmailHood="chainmailHood",e.chest="chest",e.clothGloves="clothGloves",e.cowl="cowl",e.fedora="fedora",e.druidChest="druidChest",e.druidFeet="druidFeet",e.druidHands="druidHands",e.druidHead="druidHead",e.druidLegs="druidLegs",e.greaves1="greaves1",e.greaves2="greaves2",e.hornedHelmet="hornedHelmet",e.leatherGloves="leatherGloves",e.nomadHelmet="nomadHelmet",e.pants1="pants1",e.pants2="pants2",e.plateChest1="plateChest1",e.plateChest2="plateChest2",e.plateChest3="plateChest3",e.plateChest4="plateChest4",e.plateGloves1="plateGloves1",e.plateGloves2="plateGloves2",e.plateHelmet="plateHelmet",e.platePants="platePants",e.plateShoulders1="plateShoulders1",e.plateShoulders2="plateShoulders2",e.robe="robe",e.shoulders1="shoulders1",e.shoulders2="shoulders2",e.shoulders3="shoulders3",e.vest="vest",e.arrowheads="arrowheads",e.bolts="bolts",e.buckle="buckle",e.chain="chain",e.cogs="cogs",e.gem="gem",e.gunpowder="gunpowder",e.ingot="ingot",e.nails="nails",e.poisonVial="poisonVial",e.ribbon="ribbon",e.rope="rope",e.scales="scales",e.spring="spring",e.thread="thread",e.blueprints="blueprints",e.crate="crate",e.dragonEye="dragonEye",e.dynamite="dynamite",e.eye="eye",e.feather="feather",e.food="food",e.heart="heart",e.horn="horn",e.key="key",e.letters="letters",e.lockPicks="lockPicks",e.oil="oil",e.orcFinger="orcFinger",e.plans="plans",e.purpleGems="purpleGems",e.runestone="runestone",e.sandwich="sandwich",e.teeth="teeth",e.tooth="tooth",e.torch="torch",e.tusk="tusk",e.vase="vase",e.vial="vial",e.weeds="weeds",e.ring="ring",e.magicAmulet="magicAmulet",e.arbalest="arbalest",e.battleAxe="battleAxe",e.brassKnuckles="brassKnuckles",e.cleaver="cleaver",e.club="club",e.crossbow="crossbow",e.dagger="dagger",e.flail="flail",e.greatswordOfGwai="greatswordOfGwai",e.javelin="javelin",e.khopesh="khopesh",e.longbow="longbow",e.mace="mace",e.morningStar="morningStar",e.poisonedDagger="poisonedDagger",e.ravenStaff="ravenStaff",e.savageStaff="savageStaff",e.spear="spear",e.sword="sword",e.warhammer="warhammer"}(r||(r={}))},,,,,,function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return A})),n.d(t,"c",(function(){return D}));var a,r=n(21),c={type:r.a.production,cost:{gold:40,time:4e3},levels:[{displayName:"structure-alchemist-name",workerCapacity:2,cost:{gold:0},produces:[]},{displayName:"structure-alchemist-name",workerCapacity:5,cost:{gold:30},produces:[]},{displayName:"structure-alchemist-name",workerCapacity:10,cost:{gold:50},produces:[]}]},o=n(32),i=n(1),u={item:i.a.boots1,cost:{resources:{wood:2,iron:15},time:o.a}},s={item:i.a.chest,cost:{resources:{wood:10,iron:45},time:o.b}},l={item:i.a.cowl,cost:{resources:{iron:15},time:o.b}},m={cost:{gold:40,time:4e3},type:r.a.production,levels:[{displayName:"structure-armoursmith-name",workerCapacity:2,cost:{gold:0},produces:[u]},{displayName:"structure-armoursmith-name",workerCapacity:5,cost:{gold:30},produces:[u,s]},{displayName:"structure-armoursmith-name",workerCapacity:10,cost:{gold:50},produces:[u,s,l]}]},d={type:r.a.resource,cost:{gold:40,time:4e3},levels:[{displayName:"structure-garden-name",workerCapacity:2,cost:{gold:0},generates:{food:2}},{displayName:"structure-garden-name",workerCapacity:5,cost:{gold:30},generates:{food:2}},{displayName:"structure-garden-name",workerCapacity:10,cost:{gold:50},generates:{food:2}}]},p={type:r.a.resource,cost:{gold:31,time:o.a},levels:[{displayName:"structure-lumberMill-name",workerCapacity:2,cost:{gold:0},generates:{wood:2}},{displayName:"structure-lumberMill-name",workerCapacity:5,cost:{gold:30},generates:{wood:2}},{displayName:"structure-lumberMill-name",workerCapacity:10,cost:{gold:50},generates:{wood:2}}]},f={cost:{gold:40,time:4e3},type:r.a.resource,levels:[{displayName:"structure-mine-name",workerCapacity:2,cost:{gold:0},generates:{iron:2}},{displayName:"structure-mine-name",workerCapacity:5,cost:{gold:30},generates:{iron:2}},{displayName:"structure-mine-name",workerCapacity:10,cost:{gold:50},generates:{iron:2}}]},v={cost:{gold:40,time:4e3},type:r.a.resource,levels:[{displayName:"structure-quarry-name",workerCapacity:2,cost:{gold:0},generates:{stone:2}},{displayName:"structure-quarry-name",workerCapacity:5,cost:{gold:30},generates:{stone:4}},{displayName:"structure-quarry-name",workerCapacity:10,cost:{gold:50},generates:{stone:6}}]},h={cost:{gold:40,time:4e3},type:r.a.resource,levels:[{displayName:"structure-tannery-name",workerCapacity:2,cost:{gold:0},generates:{leather:2}},{displayName:"structure-tannery-name",workerCapacity:5,cost:{gold:30},generates:{leather:5}},{displayName:"structure-tannery-name",workerCapacity:10,cost:{gold:50},generates:{leather:7}}]},g={cost:{gold:40,time:4e3},type:r.a.tavern,levels:[{displayName:"structure-tavern-name",workerCapacity:2,cost:{gold:0},rooms:10},{displayName:"structure-tavern-name",workerCapacity:5,cost:{gold:30},rooms:12},{displayName:"structure-tavern-name",workerCapacity:10,cost:{gold:50},rooms:15}]},b={cost:{gold:40,time:4e3},type:r.a.warehouse,levels:[{displayName:"structure-warehouse-name",workerCapacity:2,cost:{gold:0},maxResources:{fabric:200,food:200,iron:200,leather:200,stone:200,wood:200}},{displayName:"structure-warehouse-name",workerCapacity:5,cost:{gold:30},maxResources:{fabric:500,food:500,iron:500,leather:500,stone:500,wood:500}},{displayName:"structure-warehouse-name",workerCapacity:10,cost:{gold:50},maxResources:{fabric:1e3,food:1e3,iron:1e3,leather:1e3,stone:1e3,wood:1e3}}]},y={item:i.a.crossbow,cost:{resources:{wood:20,iron:5},time:o.a}},w={item:i.a.longbow,cost:{resources:{wood:40,iron:5},time:o.b}},O={item:i.a.poisonedDagger,cost:{resources:{wood:50,iron:15},materials:[i.a.poisonVial],time:o.b}},j={item:i.a.dagger,cost:{resources:{wood:10,iron:10},time:o.b}},E={item:i.a.sword,cost:{resources:{wood:10,iron:30},time:o.b}},k={item:i.a.khopesh,cost:{resources:{wood:15,iron:40},time:o.d}},N={type:r.a.production,cost:{gold:40,time:4e3},levels:[{displayName:"structure-weaponsmith-name",workerCapacity:2,cost:{gold:0},produces:[y,j]},{displayName:"structure-weaponsmith-name",workerCapacity:5,cost:{gold:30},produces:[y,j,w]},{displayName:"structure-weaponsmith-name",workerCapacity:10,cost:{gold:50},produces:[y,j,w,E,k]},{displayName:"structure-weaponsmith-name",workerCapacity:14,cost:{gold:50},produces:[y,j,w,E,k,O]}]},T={cost:{gold:40,time:4e3},type:r.a.resource,levels:[{displayName:"structure-weaver-name",workerCapacity:2,cost:{gold:0},generates:{fabric:2}},{displayName:"structure-weaver-name",workerCapacity:5,cost:{gold:30},generates:{fabric:5}},{displayName:"structure-weaver-name",workerCapacity:10,cost:{gold:50},generates:{fabric:7}}]},I={item:i.a.torch,cost:{resources:{wood:2,fabric:1},time:o.c}},S={item:i.a.sandwich,cost:{resources:{food:1},time:o.c/2}},x={type:r.a.production,cost:{gold:40,time:4e3},levels:[{displayName:"structure-workshop-name",workerCapacity:2,cost:{gold:0},produces:[I,S]},{displayName:"structure-workshop-name",workerCapacity:5,cost:{gold:30},produces:[]},{displayName:"structure-workshop-name",workerCapacity:10,cost:{gold:50},produces:[]},{displayName:"structure-workshop-name",workerCapacity:14,cost:{gold:50},produces:[]}]},C=n(22);!function(e){e.alchemist="alchemist",e.armoursmith="armoursmith",e.garden="garden",e.lumberMill="lumberMill",e.mine="mine",e.quarry="quarry",e.tavern="tavern",e.tannery="tannery",e.warehouse="warehouse",e.weaponsmith="weaponsmith",e.weaver="weaver",e.workshop="workshop"}(a||(a={}));var q={alchemist:c,armoursmith:m,garden:d,lumberMill:p,mine:f,quarry:v,tavern:g,tannery:h,warehouse:b,weaponsmith:N,weaver:T,workshop:x};function A(e){return q[e]}function D(e){switch(e){case C.a.fabric:return a.weaver;case C.a.food:return a.garden;case C.a.iron:return a.mine;case C.a.leather:return a.tannery;case C.a.stone:return a.quarry;case C.a.wood:return a.lumberMill}}},,function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var a=n(18),r=n(19),c=n(31),o=n(1),i=n(62),u=function(){function e(){Object(a.a)(this,e)}return Object(r.a)(e,null,[{key:"init",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.texts=e,this.templates={},t&&this.compileAll(),this.initialized=!0}},{key:"get",value:function(e,t){var n=this.getDefault(e,t);return null===n?(console.error("Key '".concat(e,"' not found in TextManager")),"<<'".concat(e,"' missing>>")):n}},{key:"getDefault",value:function(e,t){if(!this.initialized)throw new Error("Error ".concat(this," not initialized!"));var n=this.getTemplate(e);return n?n(t):null}},{key:"getTextEntry",value:function(e){return this.get(e.key,e.context)}},{key:"getTemplate",value:function(e){var t=this.templates[e];return!t&&this.texts[e]&&(this.compile(e,this.texts[e]),t=this.templates[e]),t}},{key:"getQuestTitle",value:function(e){return this.get("quest-".concat(e,"-title"))}},{key:"getQuestDescription",value:function(e){return this.get("quest-".concat(e,"-description"))}},{key:"getResourceName",value:function(e){return this.get("resource-".concat(e,"-name"))}},{key:"getItemName",value:function(e){var t=o.b[Object(c.b)(e).itemType];return this.get("item-".concat(t,"-").concat(e,"-name"))}},{key:"getItemSubtext",value:function(e){var t=o.b[Object(c.b)(e).itemType];return this.getDefault("item-".concat(t,"-").concat(e,"-subtext"))}},{key:"getStructureName",value:function(e){return this.get("structure-".concat(e,"-name"))}},{key:"compileAll",value:function(){var e=this;Object.keys(this.texts).forEach((function(t){e.compile(t,e.texts[t])}))}},{key:"compile",value:function(e,t){var n=i.compile(t);this.templates[e]=n}}]),e}();u.initialized=!1,u.texts=void 0,u.templates=void 0,i.registerHelper("item:name",(function(e,t){if(!c.a[e])return new i.SafeString("<<ITEM DEFINITION NOT FOUND: ".concat(e,">>"));switch(t){case"aA":return s(e);case"aD":case"aU":return m(e);default:var n=c.a[e].name;return new i.SafeString(n)}})),i.registerHelper("structure:name",(function(e){var t=u.get("structure-".concat(e,"-name"));return new i.SafeString(t)}));var s=function(e){return l(e)},l=function(e){var t=u.getItemName(e),n=u.getTemplate("common-article-undefined");return new i.SafeString("".concat(n({noun:t})))},m=function(e){var t=u.getItemName(e),n=u.getTemplate("common-article-defined");return new i.SafeString("".concat(n({noun:t})))}},,,,function(e,t,n){"use strict";var a;n.d(t,"a",(function(){return a})),function(e){e[e.nothing=0]="nothing",e[e.encounter=1]="encounter"}(a||(a={}))},,,,function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return g}));var a,r,c,o=n(14),i=n(35),u=n.n(i),s=n(48),l=n(18),m=n(19),d=n(60),p=n.n(d);!function(e){e[e.town=0]="town",e[e.world=1]="world"}(a||(a={})),function(e){e[e.buttonClick=0]="buttonClick",e[e.error=1]="error",e[e.toast=2]="toast"}(r||(r={}));var f={},v=null,h={},g=function(){function e(){Object(l.a)(this,e)}return Object(m.a)(e,null,[{key:"init",value:function(){var e=Object(s.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.a.getItem("musicVolume");case 2:return this._musicVolume=e.sent,e.next=5,p.a.getItem("soundVolume");case 5:this._soundVolume=e.sent,null===this._soundVolume&&(this._soundVolume=1),null===this._musicVolume&&(this._musicVolume=.8),this._initialized=!0;case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"loadMedia",value:function(e){c=e}},{key:"addSounds",value:function(e){Object.entries(e).forEach((function(e){var t=Object(o.a)(e,2),n=t[0],a=t[1];h[n]=c.find((function(e){return e.url===a})).content}))}},{key:"playSound",value:function(e){var t=h[e];t.volume(this.soundVolume),t.play()}},{key:"addMusicTrack",value:function(){var e=Object(s.a)(u.a.mark((function e(t,n){var a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c){e.next=2;break}return e.abrupt("return");case 2:if(this._initialized){e.next=5;break}return e.next=5,this.init();case 5:if(a=c.find((function(e){return e.url===n}))){e.next=8;break}throw new Error("No sound found at ".concat(n));case 8:f.hasOwnProperty(t)||(f[t]=a.content);case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"playMusicTrack",value:function(){var t=Object(s.a)(u.a.mark((function t(n){var a,r;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(c){t.next=2;break}return t.abrupt("return");case 2:if(this._initialized){t.next=5;break}return t.next=5,this.init();case 5:null!==v&&(a=f[v],console.log(e.musicVolume),a.fade(e.musicVolume,0,500)),(r=f[n]).playing()||(r.loop(!0),r.play()),r.fade(0,e.musicVolume,500),v=n;case 10:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"soundVolume",set:function(e){this._soundVolume=e,p.a.setItem("soundVolume",e)},get:function(){return this._soundVolume}},{key:"musicVolume",set:function(e){v&&f[v].volume(e),this._musicVolume=e,p.a.setItem("musicVolume",e)},get:function(){return this._musicVolume}}]),e}();g._musicVolume=.8,g._soundVolume=1,g._initialized=!1},,,,function(e,t,n){"use strict";var a;n.d(t,"a",(function(){return a})),function(e){e[e.resource=0]="resource",e[e.production=1]="production",e[e.tavern=2]="tavern",e[e.warehouse=3]="warehouse"}(a||(a={}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var a,r,c=n(3);!function(e){e.wood="wood",e.iron="iron",e.stone="stone",e.leather="leather",e.fabric="fabric",e.food="food"}(r||(r={})),t.b=(a={},Object(c.a)(a,r.wood,{resource:r.wood,iconImg:"/img/resources/wood.png"}),Object(c.a)(a,r.iron,{resource:r.iron,iconImg:"/img/resources/iron.png"}),Object(c.a)(a,r.stone,{resource:r.stone,iconImg:"/img/resources/stone.png"}),Object(c.a)(a,r.leather,{resource:r.leather,iconImg:"/img/resources/leather.png"}),Object(c.a)(a,r.fabric,{resource:r.fabric,iconImg:"/img/resources/fabric.png"}),Object(c.a)(a,r.food,{resource:r.food,iconImg:"/img/resources/food.png"}),a)},function(e,t,n){"use strict";n.d(t,"d",(function(){return a})),n.d(t,"a",(function(){return r})),n.d(t,"c",(function(){return c})),n.d(t,"b",(function(){return o}));var a=function(){return"/world"},r=function(e){return"".concat(a(),"/").concat(e)},c=function(){return"/town"},o=function(e){return"".concat(c(),"/").concat(e)}},function(e,t,n){"use strict";var a;function r(e,t){return{type:a.launchQuest,questName:e,assignedAventurers:t}}function c(e){return{type:a.exitEncounter,questName:e}}function o(e,t){return{type:a.setSceneName,questName:e,sceneName:t}}function i(e,t){return{type:a.setScene,questName:e,scene:t}}function u(e,t){return{type:a.enqueueSceneAction,questName:e,sceneAction:t}}function s(e){return{type:a.completeSceneAction,questName:e}}n.d(t,"a",(function(){return a})),n.d(t,"e",(function(){return r})),n.d(t,"d",(function(){return c})),n.d(t,"g",(function(){return o})),n.d(t,"f",(function(){return i})),n.d(t,"c",(function(){return u})),n.d(t,"b",(function(){return s})),n.d(t,"j",(function(){return l})),n.d(t,"h",(function(){return m})),n.d(t,"i",(function(){return d})),function(e){e.launchQuest="launchQuest",e.updateQuestVars="updateQuestVars",e.updateEncounterResult="updateEncounterResult",e.startEncounter="startEncounter",e.setSceneName="setSceneName",e.setScene="setScene",e.exitEncounter="exitEncounter",e.updateQuests="updateQuests",e.enqueueSceneAction="enqueueSceneAction",e.completeSceneAction="completeSceneAction",e.updateSceneObjectAction="updateSceneObjectAction",e.takeGoldFromCache="takeGoldFromCache",e.takeItemFromCache="takeItemFromCache"}(a||(a={}));var l=function(e,t,n){return{type:a.updateSceneObjectAction,questName:e,id:t,object:n}};var m=function(e,t){return{type:a.takeGoldFromCache,questName:e,cacheName:t}},d=function(e,t,n){return{type:a.takeItemFromCache,questName:e,cacheName:t,item:n}}},,,,function(e,t,n){"use strict";var a;n.d(t,"a",(function(){return a})),function(e){e[e.common=0]="common",e[e.town=1]="town",e[e.quest=2]="quest"}(a||(a={}))},,,function(e,t,n){"use strict";n.d(t,"b",(function(){return E}));var a,r,c,o=n(15),i=n(64),u=n(7),s=n(1),l=s.b.deed,m={deedForLumbermill:{item:s.a.deedForLumbermill,structure:u.a.lumberMill,itemType:l,iconImg:"/img/items/deeds/deed.png"},deedForWeaponsmith:{item:s.a.deedForWeaponsmith,structure:u.a.weaponsmith,itemType:l,iconImg:"/img/items/deeds/deed.png"}},d=n(3),p=s.b.material,f="/img/items/materials/",v=(a={},Object(d.a)(a,s.a.arrowheads,{item:s.a.arrowheads,itemType:p,iconImg:"".concat(f,"arrowheads.png")}),Object(d.a)(a,s.a.bolts,{item:s.a.bolts,itemType:p,iconImg:"".concat(f,"bolts.png")}),Object(d.a)(a,s.a.buckle,{item:s.a.buckle,itemType:p,iconImg:"".concat(f,"buckle.png")}),Object(d.a)(a,s.a.chain,{item:s.a.chain,itemType:p,iconImg:"".concat(f,"chain.png")}),Object(d.a)(a,s.a.cogs,{item:s.a.cogs,itemType:p,iconImg:"".concat(f,"cogs.png")}),Object(d.a)(a,s.a.gem,{item:s.a.gem,itemType:p,iconImg:"".concat(f,"gem.png")}),Object(d.a)(a,s.a.ingot,{item:s.a.ingot,itemType:p,iconImg:"".concat(f,"ingot.png")}),Object(d.a)(a,s.a.nails,{item:s.a.nails,itemType:p,iconImg:"".concat(f,"nails.png")}),Object(d.a)(a,s.a.poisonVial,{item:s.a.poisonVial,itemType:p,iconImg:"".concat(f,"poison-vial.png")}),Object(d.a)(a,s.a.ribbon,{item:s.a.ribbon,itemType:p,iconImg:"".concat(f,"ribbon.png")}),Object(d.a)(a,s.a.rope,{item:s.a.rope,itemType:p,iconImg:"".concat(f,"rope.png")}),Object(d.a)(a,s.a.gem,{item:s.a.gem,itemType:p,iconImg:"".concat(f,"gem.png")}),Object(d.a)(a,s.a.gunpowder,{item:s.a.gunpowder,itemType:p,iconImg:"".concat(f,"gunpowder.png")}),Object(d.a)(a,s.a.scales,{item:s.a.scales,itemType:p,iconImg:"".concat(f,"scales.png")}),Object(d.a)(a,s.a.spring,{item:s.a.spring,itemType:p,iconImg:"".concat(f,"spring.png")}),Object(d.a)(a,s.a.thread,{item:s.a.thread,itemType:p,iconImg:"".concat(f,"thread.png")}),a),h=s.b.questItem,g="/img/items/quest-items/",b=(r={},Object(d.a)(r,s.a.blueprints,{item:s.a.blueprints,itemType:h,iconImg:"".concat(g,"blueprints.png")}),Object(d.a)(r,s.a.crate,{item:s.a.crate,itemType:h,iconImg:"".concat(g,"crate.png")}),Object(d.a)(r,s.a.dynamite,{item:s.a.dynamite,itemType:h,iconImg:"".concat(g,"dynamite.png")}),Object(d.a)(r,s.a.dragonEye,{item:s.a.dragonEye,itemType:h,iconImg:"".concat(g,"dragon-eye.png")}),Object(d.a)(r,s.a.eye,{item:s.a.eye,itemType:h,iconImg:"".concat(g,"eye.png")}),Object(d.a)(r,s.a.feather,{item:s.a.feather,itemType:h,iconImg:"".concat(g,"feather.png")}),Object(d.a)(r,s.a.food,{item:s.a.food,itemType:h,iconImg:"".concat(g,"food.png")}),Object(d.a)(r,s.a.heart,{item:s.a.heart,itemType:h,iconImg:"".concat(g,"heart.png")}),Object(d.a)(r,s.a.horn,{item:s.a.horn,itemType:h,iconImg:"".concat(g,"horn.png")}),Object(d.a)(r,s.a.key,{item:s.a.key,itemType:h,iconImg:"".concat(g,"key.png")}),Object(d.a)(r,s.a.letters,{item:s.a.letters,itemType:h,iconImg:"".concat(g,"letters.png")}),Object(d.a)(r,s.a.lockPicks,{item:s.a.lockPicks,itemType:h,iconImg:"".concat(g,"lock-picks.png")}),Object(d.a)(r,s.a.oil,{item:s.a.oil,itemType:h,iconImg:"".concat(g,"oil.png")}),Object(d.a)(r,s.a.orcFinger,{item:s.a.orcFinger,itemType:h,iconImg:"".concat(g,"orc-finger.png")}),Object(d.a)(r,s.a.plans,{item:s.a.plans,itemType:h,iconImg:"".concat(g,"plans.png")}),Object(d.a)(r,s.a.purpleGems,{item:s.a.purpleGems,itemType:h,iconImg:"".concat(g,"purple-gems.png")}),Object(d.a)(r,s.a.runestone,{item:s.a.runestone,itemType:h,iconImg:"".concat(g,"runestone.png")}),Object(d.a)(r,s.a.sandwich,{item:s.a.sandwich,itemType:h,iconImg:"".concat(g,"sandwich.png")}),Object(d.a)(r,s.a.teeth,{item:s.a.teeth,itemType:h,iconImg:"".concat(g,"teeth.png")}),Object(d.a)(r,s.a.tooth,{item:s.a.tooth,itemType:h,iconImg:"".concat(g,"tooth.png")}),Object(d.a)(r,s.a.torch,{item:s.a.torch,itemType:h,iconImg:"".concat(g,"torch.png")}),Object(d.a)(r,s.a.tusk,{item:s.a.tusk,itemType:h,iconImg:"".concat(g,"tusk.png")}),Object(d.a)(r,s.a.vase,{item:s.a.vase,itemType:h,iconImg:"".concat(g,"vase.png")}),Object(d.a)(r,s.a.vial,{item:s.a.vial,itemType:h,iconImg:"".concat(g,"vial.png")}),Object(d.a)(r,s.a.weeds,{item:s.a.weeds,itemType:h,iconImg:"".concat(g,"weeds.png")}),r),y=s.b.trinket,w=(c={},Object(d.a)(c,s.a.magicAmulet,{item:s.a.magicAmulet,itemType:y,iconImg:"".concat("/img/items/trinkets/","magic_amulet.png")}),Object(d.a)(c,s.a.ring,{item:s.a.ring,itemType:y,iconImg:"".concat("/img/items/trinkets/","ring.png")}),c),O=n(84),j=Object(o.a)({},m,{},i.b,{},v,{},b,{},w,{},O.b);t.a=j;function E(e){return j[e]}},function(e,t,n){"use strict";n.d(t,"c",(function(){return r})),n.d(t,"d",(function(){return c})),n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return i})),n.d(t,"e",(function(){return l}));var a=n(9),r=6e4,c=12e4,o=30*r,i=60*r,u=24*i,s=265.25*u,l=function(e){var t=[{unit:"year",amount:s},{unit:"day",amount:u},{unit:"hour",amount:i},{unit:"minute",amount:r},{unit:"second",amount:1e3}],n=Math.abs(e),c=[];return t.forEach((function(e){var t=Math.floor(n/e.amount);if(n-=t*e.amount,0!==t){var r=a.a.get("common-time-".concat(e.unit).concat(t>1?"-plural":""));c.push("".concat(t," ").concat(r))}})),c.join(" ")}},function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var a=n(26),r=n(18),c=n(19),o=n(29),i=n(30),u=n(85),s=n(17),l=function(e){Object(i.a)(n,e);var t=Object(o.a)(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,null,[{key:"addToast",value:function(e,t,n,r){var c=this;this.stack=[].concat(Object(a.a)(this.stack),[{time:Date.now(),title:e,type:t,icon:n,link:r}]),this.emit(this.EVENT_TOASTS_UPDATED,this.stack),s.c.playSound(s.b.toast),setTimeout((function(){c.stack=c.stack.filter((function(e){return Date.now()-e.time<c.lifeTime})),c.emit(c.EVENT_TOASTS_UPDATED,c.stack)}),this.lifeTime)}}]),n}(Object(u.a)());l.stack=[],l.lifeTime=5e3,l.EVENT_TOASTS_UPDATED="toast"},,,function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"c",(function(){return c})),n.d(t,"b",(function(){return o}));var a,r=n(28);function c(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r.a.common,c=arguments.length>3?arguments[3]:void 0,o={key:e,context:t};return{type:a.addLogEntry,entry:o,channel:n,channelContext:c}}function o(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.a.common,n=arguments.length>2?arguments[2]:void 0;return{type:a.addLogEntry,entry:e,channel:t,channelContext:n}}!function(e){e.addLogEntry="addLogEntry"}(a||(a={}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var a,r=n(0),c=n.n(r),o=n(9),i=n(20);!function(e){e[e.achievementUnlocked=0]="achievementUnlocked",e[e.cheat=1]="cheat",e[e.itemCrafted=2]="itemCrafted",e[e.questCompleted=3]="questCompleted",e[e.questEncounter=4]="questEncounter",e[e.questLaunched=5]="questLaunched",e[e.questUpdate=6]="questUpdate"}(a||(a={}));t.b=function(e){var t=e.title,n=e.type,r=void 0===n?a.achievementUnlocked:n,u=e.icon,s=void 0===u?"/img/items/quest-items/dragon-eye.png":u,l=e.link,m=Object(i.g)(),d=o.a.get("ui-toast-type-".concat(a[r]));return c.a.createElement("div",{className:"toast ".concat(l&&"withlink"),onClick:function(){l&&m.push(l)}},c.a.createElement("div",{className:"label type"},d),c.a.createElement("div",{className:"label title app-h2-white"},t),c.a.createElement("div",{className:"icon"},c.a.createElement("div",{className:"background"}),c.a.createElement("img",{className:"image",width:"300",alt:"dragon eye",src:"".concat(".").concat(s)}),c.a.createElement("div",{className:"foreground"})),c.a.createElement("div",{className:"banner"}))}},,,,,function(e,t,n){"use strict";n.d(t,"b",(function(){return u}));var a=n(13),r=n(86),c={getQuestVars:function(e){return e.questVars},getInitialQuestVars:function(e){return r.a},nodes:[{x:0,y:1,type:a.a.nothing,log:"quest-kill10Boars-node0"},{x:0,y:2,type:a.a.nothing},{x:0,y:3,type:a.a.nothing},{x:0,y:4,type:a.a.nothing},{x:0,y:3,type:a.a.encounter,startScene:"dungeon.entrance"},{x:1,y:3,type:a.a.nothing,log:"quest-kill10Boars-leave-dungeon"},{x:1,y:3,type:a.a.nothing,log:"quest-kill10Boars-left-dungeon"},{x:2,y:3,type:a.a.nothing},{x:3,y:3,type:a.a.encounter,startScene:"dungeon.hallway"},{x:4,y:4,type:a.a.nothing,log:"The party spots a boss"},{x:5,y:4,type:a.a.nothing}]},o=n(1),i={kill10Boars:c,retrieveMagicAmulet:{getQuestVars:function(e){return e.questVars},getInitialQuestVars:function(e){return{baz:!1,zux:13}},requiredItems:[o.a.torch,o.a.torch,o.a.torch,o.a.sandwich,o.a.sandwich],nodes:[{x:0,y:1,type:a.a.nothing},{x:1,y:1,type:a.a.nothing},{x:2,y:1,type:a.a.nothing},{x:3,y:1,type:a.a.nothing},{x:4,y:1,type:a.a.nothing},{x:5,y:1,type:a.a.nothing},{x:7,y:1,type:a.a.nothing},{x:8,y:2,type:a.a.nothing},{x:8,y:3,type:a.a.nothing},{x:9,y:3,type:a.a.nothing},{x:10,y:1,type:a.a.nothing},{x:10,y:2,type:a.a.nothing},{x:10,y:3,type:a.a.nothing},{x:10,y:4,type:a.a.nothing},{x:11,y:5,type:a.a.nothing},{x:12,y:6,type:a.a.nothing},{x:12,y:7,type:a.a.nothing},{x:13,y:8,type:a.a.nothing},{x:12,y:8,type:a.a.nothing},{x:12,y:9,type:a.a.nothing},{x:11,y:8,type:a.a.nothing},{x:10,y:8,type:a.a.nothing},{x:9,y:8,type:a.a.nothing},{x:8,y:9,type:a.a.nothing},{x:7,y:8,type:a.a.encounter,startScene:"dungeon.hallway"},{x:8,y:1,type:a.a.nothing},{x:1,y:1,type:a.a.nothing},{x:1,y:1,type:a.a.nothing},{x:1,y:1,type:a.a.nothing},{x:1,y:1,type:a.a.nothing},{x:1,y:1,type:a.a.nothing},{x:1,y:1,type:a.a.nothing},{x:1,y:1,type:a.a.nothing},{x:1,y:1,type:a.a.nothing},{x:2,y:1,type:a.a.encounter,startScene:"dungeon.hallway"},{x:3,y:1,type:a.a.nothing}]}};t.a=i;function u(e){return i[e]}},,function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return r})),n.d(t,"a",(function(){return o})),n.d(t,"d",(function(){return i}));var a=function(e,t){return t.party.map((function(t){return c(e,t)}))},r=function(e,t){var n=t.party[0];return c(e,n)},c=function(e,t){return e.find((function(e){return e.id===t}))},o=function(e){return e.inventory.filter((function(e){return null===e})).length},i=function(e){return!!e.rngState}},,,,,,,,,function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"c",(function(){return u})),n.d(t,"b",(function(){return l}));var a=n(35),r=n.n(a),c=n(48),o=function(e,t,n){return{x:i(e.x,t.x,n),y:i(e.y,t.y,n)}},i=function(e,t,n){return e+n*(t-e)};function u(e){return s.apply(this,arguments)}function s(){return(s=Object(c.a)(r.a.mark((function e(t){var n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=PIXI.Loader.shared,e.abrupt("return",new Promise((function(e,a){n.resources[t]?e(n.resources[t]):n.add(t).load((function(n,a){e(a[t])}))})));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var l=function(e,t){var n=PIXI.Loader.shared;n.resources[e]?t(n.resources[e]):n.add(e).load((function(n,a){t(a[e])}))}},,,,,,,,,,,function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var a,r,c=n(3),o=n(1),i=o.b.apparel,u="/img/items/apparel/";!function(e){e[e.feet=0]="feet",e[e.hands=1]="hands",e[e.chest=2]="chest",e[e.legs=3]="legs",e[e.head=4]="head",e[e.shoulders=5]="shoulders"}(r||(r={}));var s=(a={},Object(c.a)(a,o.a.boots1,{item:o.a.boots1,equipmentType:r.feet,itemType:i,iconImg:"".concat(u,"boots_1.png")}),Object(c.a)(a,o.a.boots2,{item:o.a.boots2,equipmentType:r.feet,itemType:i,iconImg:"".concat(u,"boots_2.png")}),Object(c.a)(a,o.a.boots3,{item:o.a.boots3,equipmentType:r.feet,itemType:i,iconImg:"".concat(u,"boots_3.png")}),Object(c.a)(a,o.a.chainmailHood,{item:o.a.chainmailHood,equipmentType:r.head,itemType:i,iconImg:"".concat(u,"chainmail_hood.png"),armourRating:3}),Object(c.a)(a,o.a.chest,{item:o.a.chest,equipmentType:r.chest,itemType:i,iconImg:"".concat(u,"chest_1.png"),armourRating:2}),Object(c.a)(a,o.a.clothGloves,{item:o.a.clothGloves,equipmentType:r.hands,itemType:i,iconImg:"".concat(u,"cloth_gloves.png")}),Object(c.a)(a,o.a.cowl,{item:o.a.cowl,equipmentType:r.head,itemType:i,iconImg:"".concat(u,"cowl.png"),armourRating:20}),Object(c.a)(a,o.a.druidChest,{item:o.a.druidHands,equipmentType:r.chest,itemType:i,iconImg:"".concat(u,"druid-chest.png")}),Object(c.a)(a,o.a.druidFeet,{item:o.a.druidFeet,equipmentType:r.feet,itemType:i,iconImg:"".concat(u,"druid-feet.png")}),Object(c.a)(a,o.a.druidHands,{item:o.a.druidHands,equipmentType:r.hands,itemType:i,iconImg:"".concat(u,"druid-hands.png")}),Object(c.a)(a,o.a.druidHead,{item:o.a.druidHead,equipmentType:r.head,itemType:i,iconImg:"".concat(u,"druid-head.png")}),Object(c.a)(a,o.a.druidLegs,{item:o.a.druidLegs,equipmentType:r.legs,itemType:i,iconImg:"".concat(u,"druid-legs.png")}),Object(c.a)(a,o.a.fedora,{item:o.a.fedora,equipmentType:r.head,itemType:i,iconImg:"".concat(u,"fedora.png")}),Object(c.a)(a,o.a.greaves1,{item:o.a.greaves1,equipmentType:r.feet,itemType:i,iconImg:"".concat(u,"greaves_1.png"),armourRating:10}),Object(c.a)(a,o.a.greaves2,{item:o.a.greaves2,equipmentType:r.hands,itemType:i,iconImg:"".concat(u,"greaves_2.png")}),Object(c.a)(a,o.a.hornedHelmet,{item:o.a.hornedHelmet,equipmentType:r.head,itemType:i,iconImg:"".concat(u,"horned_helmet.png")}),Object(c.a)(a,o.a.leatherGloves,{item:o.a.leatherGloves,equipmentType:r.hands,itemType:i,iconImg:"".concat(u,"leather_gloves.png")}),Object(c.a)(a,o.a.nomadHelmet,{item:o.a.nomadHelmet,equipmentType:r.head,itemType:i,iconImg:"".concat(u,"nomad_helmet.png")}),Object(c.a)(a,o.a.pants1,{item:o.a.pants1,equipmentType:r.legs,itemType:i,iconImg:"".concat(u,"pants_1.png"),armourRating:10}),Object(c.a)(a,o.a.pants2,{item:o.a.pants2,equipmentType:r.legs,itemType:i,iconImg:"".concat(u,"pants_2.png")}),Object(c.a)(a,o.a.plateChest1,{item:o.a.plateChest1,equipmentType:r.chest,itemType:i,iconImg:"".concat(u,"plate_chest_1.png")}),Object(c.a)(a,o.a.plateChest2,{item:o.a.plateChest2,equipmentType:r.chest,itemType:i,iconImg:"".concat(u,"plate_chest_2.png")}),Object(c.a)(a,o.a.plateChest3,{item:o.a.plateChest3,equipmentType:r.chest,itemType:i,iconImg:"".concat(u,"plate_chest_3.png")}),Object(c.a)(a,o.a.plateChest4,{item:o.a.plateChest4,equipmentType:r.chest,itemType:i,iconImg:"".concat(u,"plate_chest_4.png")}),Object(c.a)(a,o.a.plateGloves1,{item:o.a.plateGloves1,equipmentType:r.hands,itemType:i,iconImg:"".concat(u,"plate_gloves_1.png")}),Object(c.a)(a,o.a.plateGloves2,{item:o.a.plateGloves2,equipmentType:r.hands,itemType:i,iconImg:"".concat(u,"plate_gloves_2.png")}),Object(c.a)(a,o.a.plateHelmet,{item:o.a.plateHelmet,equipmentType:r.head,itemType:i,iconImg:"".concat(u,"plate_helmet_1.png")}),Object(c.a)(a,o.a.platePants,{item:o.a.platePants,equipmentType:r.legs,itemType:i,iconImg:"".concat(u,"plate_pants1.png")}),Object(c.a)(a,o.a.plateShoulders1,{item:o.a.plateShoulders1,equipmentType:r.shoulders,itemType:i,iconImg:"".concat(u,"plate_shoulders_1.png")}),Object(c.a)(a,o.a.plateShoulders2,{item:o.a.plateShoulders2,equipmentType:r.shoulders,itemType:i,iconImg:"".concat(u,"plate_shoulders_2.png")}),Object(c.a)(a,o.a.robe,{item:o.a.robe,equipmentType:r.chest,itemType:i,iconImg:"".concat(u,"robe_1.png")}),Object(c.a)(a,o.a.shoulders1,{item:o.a.shoulders1,equipmentType:r.shoulders,itemType:i,iconImg:"".concat(u,"shoulders_1.png")}),Object(c.a)(a,o.a.shoulders2,{item:o.a.shoulders2,equipmentType:r.shoulders,itemType:i,iconImg:"".concat(u,"shoulders_2.png")}),Object(c.a)(a,o.a.shoulders3,{item:o.a.shoulders3,equipmentType:r.shoulders,itemType:i,iconImg:"".concat(u,"shoulders_3.png")}),Object(c.a)(a,o.a.vest,{item:o.a.vest,equipmentType:r.chest,itemType:i,iconImg:"".concat(u,"vest_1.png")}),a);t.b=s},,,function(e,t,n){},,,,,,,,,,function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var a=n(18),r=n(19),c=function(){function e(){Object(a.a)(this,e)}return Object(r.a)(e,null,[{key:"registerSceneController",value:function(e,t,n){this.controllerTypes["".concat(e,".").concat(t)]=n}},{key:"getSceneController",value:function(e,t,n){if(!this.store["".concat(e,".").concat(t)]){if(!this.controllerTypes["".concat(e,".").concat(t)])throw new Error("No controller registered for ".concat(e,".").concat(t));this.store["".concat(e,".").concat(t)]=new(this.controllerTypes["".concat(e,".").concat(t)])(n,e)}return this.store["".concat(e,".").concat(t)]}},{key:"destroySceneConroller",value:function(e,t){delete this.store["".concat(e,".").concat(t)]}}]),e}();c.store={},c.controllerTypes={},n(284)},,,,,,,function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var a,r,c,o=n(3),i=n(1),u=i.b.weapon,s="/img/items/weapons/";!function(e){e[e.axe=0]="axe",e[e.bow=1]="bow",e[e.club=2]="club",e[e.crossbow=3]="crossbow",e[e.fist=4]="fist",e[e.flail=5]="flail",e[e.hammer=6]="hammer",e[e.melee=7]="melee",e[e.knife=8]="knife",e[e.staff=9]="staff",e[e.sword=10]="sword",e[e.poleArm=11]="poleArm"}(r||(r={})),function(e){e.kinetic="kinetic"}(c||(c={}));var l=(a={},Object(o.a)(a,i.a.arbalest,{item:i.a.arbalest,itemType:u,weaponType:r.crossbow,iconImg:"".concat(s,"arbalest.png"),damage:Object(o.a)({},c.kinetic,40)}),Object(o.a)(a,i.a.battleAxe,{item:i.a.battleAxe,itemType:u,weaponType:r.axe,iconImg:"".concat(s,"battle_axe.png"),damage:Object(o.a)({},c.kinetic,20)}),Object(o.a)(a,i.a.brassKnuckles,{item:i.a.brassKnuckles,itemType:u,weaponType:r.melee,iconImg:"".concat(s,"brass_knuckles.png"),damage:Object(o.a)({},c.kinetic,10)}),Object(o.a)(a,i.a.crossbow,{item:i.a.crossbow,itemType:u,weaponType:r.crossbow,iconImg:"".concat(s,"crossbow.png"),damage:Object(o.a)({},c.kinetic,3)}),Object(o.a)(a,i.a.cleaver,{item:i.a.cleaver,itemType:u,weaponType:r.knife,iconImg:"".concat(s,"cleaver.png"),damage:Object(o.a)({},c.kinetic,5)}),Object(o.a)(a,i.a.club,{item:i.a.club,itemType:u,weaponType:r.club,iconImg:"".concat(s,"club.png"),damage:Object(o.a)({},c.kinetic,8)}),Object(o.a)(a,i.a.dagger,{item:i.a.dagger,itemType:u,weaponType:r.knife,iconImg:"".concat(s,"dagger.png"),damage:Object(o.a)({},c.kinetic,8)}),Object(o.a)(a,i.a.flail,{item:i.a.flail,itemType:u,weaponType:r.flail,iconImg:"".concat(s,"flail.png"),damage:Object(o.a)({},c.kinetic,15)}),Object(o.a)(a,i.a.greatswordOfGwai,{item:i.a.greatswordOfGwai,itemType:u,weaponType:r.sword,iconImg:"".concat(s,"greatsword-gwai.png"),unique:!0,damage:Object(o.a)({},c.kinetic,25)}),Object(o.a)(a,i.a.javelin,{item:i.a.javelin,itemType:u,weaponType:r.poleArm,iconImg:"".concat(s,"javelin.png"),damage:Object(o.a)({},c.kinetic,25)}),Object(o.a)(a,i.a.khopesh,{item:i.a.khopesh,itemType:u,weaponType:r.sword,iconImg:"".concat(s,"khopesh.png"),damage:Object(o.a)({},c.kinetic,15)}),Object(o.a)(a,i.a.longbow,{item:i.a.longbow,itemType:u,weaponType:r.bow,iconImg:"".concat(s,"longbow.png"),damage:Object(o.a)({},c.kinetic,2)}),Object(o.a)(a,i.a.mace,{item:i.a.mace,itemType:u,weaponType:r.club,iconImg:"".concat(s,"mace.png"),damage:Object(o.a)({},c.kinetic,15)}),Object(o.a)(a,i.a.morningStar,{item:i.a.morningStar,itemType:u,weaponType:r.club,iconImg:"".concat(s,"morning-star.png"),damage:Object(o.a)({},c.kinetic,13)}),Object(o.a)(a,i.a.poisonedDagger,{item:i.a.poisonedDagger,itemType:u,weaponType:r.knife,iconImg:"".concat(s,"poisoned-dagger.png"),damage:Object(o.a)({},c.kinetic,12)}),Object(o.a)(a,i.a.ravenStaff,{item:i.a.ravenStaff,itemType:u,weaponType:r.staff,iconImg:"".concat(s,"raven-staff.png"),damage:Object(o.a)({},c.kinetic,13)}),Object(o.a)(a,i.a.savageStaff,{item:i.a.savageStaff,itemType:u,weaponType:r.staff,iconImg:"".concat(s,"savage-staff.png"),damage:Object(o.a)({},c.kinetic,8)}),Object(o.a)(a,i.a.spear,{item:i.a.spear,itemType:u,weaponType:r.poleArm,iconImg:"".concat(s,"sword.png"),damage:Object(o.a)({},c.kinetic,10)}),Object(o.a)(a,i.a.sword,{item:i.a.sword,itemType:u,weaponType:r.sword,iconImg:"".concat(s,"sword.png"),damage:Object(o.a)({},c.kinetic,14)}),Object(o.a)(a,i.a.warhammer,{item:i.a.warhammer,itemType:u,weaponType:r.hammer,iconImg:"".concat(s,"warhammer.png"),damage:Object(o.a)({},c.kinetic,16)}),a);t.b=l},function(e,t,n){"use strict";var a=n(18),r=n(19);t.a=function(){var e=function(){function e(){Object(a.a)(this,e)}return Object(r.a)(e,null,[{key:"addEventListener",value:function(e,t){this.events[e]=this.events[e]||[],this.events[e].push(t)}},{key:"removeEventListener",value:function(e,t){if(this.events[e])for(var n=0;n<this.events[e].length;n++)if(this.events[e][n]===t){this.events[e].splice(n,1);break}}},{key:"emit",value:function(e,t){this.events[e]&&this.events[e].forEach((function(e){return e(t)}))}}]),e}();return e.events={},e}},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var a={dungeon:{entered:!1},foo:!1,bar:3}},,,function(e,t,n){"use strict";var a,r,c;n.d(t,"a",(function(){return a})),function(e){e.tilelayer="tilelayer",e.objectgroup="objectgroup"}(a||(a={})),function(e){e.orthagonal="orthagonal",e.isometric="isometric",e.staggered="staggered",e.hexagonal="hexagonal"}(r||(r={})),function(e){e.rightUp="right-up",e.rightDown="right-down",e.leftUp="left-up",e.leftDown="left-down"}(c||(c={}))},,,,,,function(e,t,n){},,,,,,,,,function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAgCAYAAAABtRhCAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAB3RJTUUH3gMODzc3YHmYGgAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAE50lEQVRIx7WXW0wcVRjHfzO7y16YZbfAytACvbjU1hqkLVZMbbSXBEPUNjX6YDYanwYfTXzxrb7qm0lTJ018QhOjaWI0trFYbRoqpYVuwy2UpRS2lAF22YUdtuxt1ofKCIXShaZfMjm37+Q33zn/cxMURWHRVFXNAyiKIvCMTFwKO6Ne4ONPTpngZwoE6Lx6FYCDhwLPDLoMeKPtV8b6ewkEAssiVVU1v/gtLS+dhnUDFUUResZvUhLXuNF+ZVmkBw8F6B+4b5avXR8x82fUC+uCWhoaGsxCV1fXKZelGOvMNPcXspw9+zV60s3MzAweTwXJZBLJXYXPt8XMJ5NJbgX/pqGh4ctCgNalBUVRhId/u5tsQqf9UpDGxkZCoRCtra2mX2trK5qmAZhpoWZdrTIvCOyQihn8/RydsQSVm6uQJAnZ6zV9MjYbkUgEAL/fj6p+my9kOYmPViiKIgQn+8mLIv1jowSONtN0+OgyGEAkEkHXdTRNQ5Kkjal0qY3MJciLIsdOvslYXy9xbXxZu67rAEiSZOafCtgzfpM8Al2/deDEwJZOrYAu2lNFqKpq/rPjLTTtbWY0Psu1jovUVm7Hmk1jS6eYmXooEiH//0pYj3BWFc2RukM4HpxHMAz6x0aRvT1scfsYT0yTTwnEtXEsuQzxhbQ5j08F/O7H0+zz+ThQWsK52yGuBNs5XPcqllwOVzrOjv2HsZaXsuv1OtySnYSeort7kE+Vt56o1FWBo7EollwGQ7Sww13McHyWbE8n9VVVNLzWzMDkXSYGujl/uY1wNIamaciybO4+a0FXXRbd04P8PHydu/EYtmwaSy7NaCzOi0eO09F5kfk7/bhSSZ4T8zQ2NiLLMgCyLPPe+5+vudWtqlJFUYRF8MhsHNHIcXKnn86rfxK8P4Etk8G5kKR4YZ758F1OnDixrP9aUHGt8V6ExlMLbLP7GBoeAkGkxuWhKJfFlUoiJRNE7o0TCARM8UiS9NgjTnySqhRFEUZmR/jm5l9YsynGolG0RJQqpwd7OoU0P0dqZJD0TJyWlhZzU/D7/Txfe2wFVCxUzttLPNyaGEc0svx0+zZVW/cD4Eo/wJuIkevtwZiKLhteWZZXQAsGdk9PscluRzByODxlnL78Aw17mpDdZdizGUr0GNEbndRvKeeD5rcpLy83oRWVjeuLUFEUYTQ+jMfpwutw4CgpJVmzm6/++QVDtFDpLkU0DLxzUabbB6ir9vHGtp3mxi5JkhmluJ6zzONw/pfaMUSR0HyaL6530zYRBmBz7QFqj9YhSQ5efsXPQjxS2MJ/nJUUS8zEZ/G4nPSEQgyHLj08kCehtQuqy66w94/vEfIGNaVliEYGr6No40AAj9OBkDcYHmpb0RaO9hGO9lFdtodubQqAovQCG1IpgGgYlNlsbCqyrekXjvaZ+SlD3Dgwoc9hyWU4WP1SQf6lNbXouo6u6+ZtvmCgoihCcErDks2QCA3w4YF3ngjz+/1omsbkRMfG5nBkdoQ7bjeEe9hVVsZHe5u4FB7nXqTX9Kmvf5eKys3IskwwGGR4qG3ZW0VY+pgpxFRVze/zvcBWbylep5OMzY5hsVLsLiFd5MTqq+DedJRQKLQCtiHg0uv91k21uF1uPE4XhsVC1monlsqSmE8yOdGx6itsQ8BHwavN9+P6/Avf+1eTf20QhwAAAABJRU5ErkJggg=="},,,,,,,,,,,,,,,function(e,t,n){},,,,,,,,,,,,,,,function(e,t,n){},,,,,,,,,,,,,,,,,function(e){e.exports=JSON.parse('{"alchemist":[{"shape":[34,18,31,1,37,0]},{"shape":[37,0,53,5,45,17]},{"shape":[45,17,68,27,81,48]},{"shape":[72,67,75,168,11,168]},{"shape":[9,65,1,45,10,30]},{"shape":[31,19,29,5,45,0]},{"shape":[45,0,34,18,37,0]},{"shape":[45,17,81,48,72,67]},{"shape":[72,67,11,168,9,65]},{"shape":[9,65,10,30,31,19]},{"shape":[45,17,72,67,9,65]},{"shape":[9,65,31,19,45,0]},{"shape":[37,0,45,17,9,65]}],"garden":[{"shape":[48,45,48,0,58,0]},{"shape":[57,41,75,56,73,78]},{"shape":[73,78,11,68,2,56]},{"shape":[2,56,13,45,48,45]},{"shape":[48,45,58,0,57,41]},{"shape":[73,78,2,56,48,45]},{"shape":[48,45,57,41,73,78]}],"armoursmith":[{"shape":[53,1,55,0,93,5]},{"shape":[93,5,112,11,120,20]},{"shape":[120,20,124,36,119,49]},{"shape":[119,49,122,156,75,149]},{"shape":[75,149,57,135,33,104]},{"shape":[33,104,10,95,11,52]},{"shape":[11,52,0,35,2,20]},{"shape":[2,20,6,14,27,5]},{"shape":[27,5,53,1,93,5]},{"shape":[93,5,120,20,119,49]},{"shape":[119,49,75,149,33,104]},{"shape":[33,104,11,52,2,20]},{"shape":[2,20,27,5,93,5]},{"shape":[93,5,119,49,33,104]},{"shape":[33,104,2,20,93,5]}],"lumberMill":[{"shape":[32,11,43,1,45,0]},{"shape":[45,0,49,4,37,18]},{"shape":[39,29,50,44,49,48]},{"shape":[38,46,38,230,17,233]},{"shape":[17,233,13,232,13,48]},{"shape":[13,48,3,48,14,28]},{"shape":[14,28,1,7,6,4]},{"shape":[31,18,32,11,45,0]},{"shape":[39,29,49,48,40,43]},{"shape":[38,46,17,233,13,48]},{"shape":[14,28,6,4,19,18]},{"shape":[31,18,45,0,37,18]},{"shape":[37,18,39,29,40,43]},{"shape":[40,43,38,46,13,48]},{"shape":[13,48,14,28,19,18]},{"shape":[31,18,37,18,40,43]},{"shape":[40,43,13,48,19,18]},{"shape":[19,18,31,18,40,43]}],"mine":[{"shape":[15,0,79,1,88,13]},{"shape":[88,13,78,66,27,70]},{"shape":[27,70,2,50,11,27]},{"shape":[11,27,6,13,15,0]},{"shape":[15,0,88,13,27,70]},{"shape":[27,70,11,27,15,0]}],"quarry":[{"shape":[2,24,20,2,22,0]},{"shape":[22,0,103,2,117,15]},{"shape":[117,15,124,24,112,24]},{"shape":[112,24,112,64,104,70]},{"shape":[104,70,104,89,97,88]},{"shape":[97,68,66,67,60,43]},{"shape":[60,43,17,42,17,26]},{"shape":[17,26,2,24,22,0]},{"shape":[22,0,117,15,112,24]},{"shape":[112,24,104,70,97,88]},{"shape":[60,43,17,26,22,0]},{"shape":[112,24,97,88,97,68]},{"shape":[97,68,60,43,22,0]},{"shape":[22,0,112,24,97,68]}],"tannery":[{"shape":[4,2,4,0,61,1]},{"shape":[59,36,89,37,85,79]},{"shape":[85,79,15,77,15,47]},{"shape":[15,47,5,35,0,9]},{"shape":[0,9,4,2,61,1]},{"shape":[59,36,85,79,15,47]},{"shape":[15,47,0,9,61,1]},{"shape":[61,1,59,36,15,47]}],"tavern":[{"shape":[110,27,108,24,112,23]},{"shape":[112,23,151,27,148,60]},{"shape":[148,60,137,71,133,67]},{"shape":[133,67,136,69,132,75]},{"shape":[132,75,137,77,138,124]},{"shape":[131,131,136,136,55,119]},{"shape":[29,64,6,72,0,69]},{"shape":[27,56,76,61,85,67]},{"shape":[101,25,108,13,112,17]},{"shape":[112,17,102,18,104,6]},{"shape":[110,27,112,23,148,60]},{"shape":[132,75,138,124,131,131]},{"shape":[131,131,55,119,59,118]},{"shape":[29,64,0,69,27,56]},{"shape":[112,17,104,6,111,9]},{"shape":[92,27,110,27,148,60]},{"shape":[132,75,131,131,59,118]},{"shape":[50,68,29,64,27,56]},{"shape":[92,27,148,60,133,67]},{"shape":[133,67,132,75,59,118]},{"shape":[50,68,27,56,85,67]},{"shape":[133,67,59,118,56,72]},{"shape":[56,72,50,68,85,67]},{"shape":[133,67,56,72,85,67]},{"shape":[133,67,85,67,89,60]},{"shape":[92,27,133,67,89,60]},{"shape":[92,27,89,60,86,25]},{"shape":[104,0,92,27,86,25]}],"warehouse":[{"shape":[36,414,3,409,2,13]},{"shape":[2,13,31,-7,63,7]},{"shape":[62,197,63,126,65,218]},{"shape":[61,262,83,272,84,459]},{"shape":[84,459,36,414,2,13]},{"shape":[2,13,63,7,62,197]},{"shape":[62,197,65,218,61,262]},{"shape":[61,262,84,459,2,13]},{"shape":[2,13,62,197,61,262]}],"weaponsmith":[{"shape":[52,18,50,2,50,0]},{"shape":[50,0,114,1,109,49]},{"shape":[109,49,115,132,98,129]},{"shape":[98,129,66,95,65,34]},{"shape":[11,33,11,77,0,77]},{"shape":[0,29,18,18,52,18]},{"shape":[52,18,50,0,109,49]},{"shape":[109,49,98,129,65,34]},{"shape":[11,33,0,77,0,29]},{"shape":[52,18,109,49,65,34]},{"shape":[15,27,11,33,0,29]},{"shape":[52,18,65,34,53,26]},{"shape":[15,27,0,29,52,18]},{"shape":[52,18,53,26,15,27]}],"weaver":[{"shape":[51,41,54,0,55,6]},{"shape":[55,41,82,53,87,63]},{"shape":[87,63,86,259,62,254]},{"shape":[62,254,23,212,21,61]},{"shape":[21,61,2,56,51,41]},{"shape":[51,41,55,6,55,41]},{"shape":[55,41,87,63,62,254]},{"shape":[62,254,21,61,51,41]},{"shape":[51,41,55,41,62,254]}],"workshop":[{"shape":[11,2,13,0,68,3]},{"shape":[68,3,77,12,70,14]},{"shape":[70,14,69,38,10,37]},{"shape":[9,13,1,12,11,2]},{"shape":[11,2,68,3,70,14]},{"shape":[70,14,10,37,9,13]},{"shape":[9,13,11,2,70,14]}]}')},function(e){e.exports=JSON.parse('{"alpha":{"start":0.25,"end":0},"scale":{"start":0.04,"end":0.29,"minimumScaleMultiplier":1},"color":{"start":"#85888d","end":"#100f0c"},"speed":{"start":100,"end":200,"minimumSpeedMultiplier":1},"acceleration":{"x":10,"y":-30},"maxSpeed":200,"startRotation":{"min":265,"max":270},"noRotation":false,"rotationSpeed":{"min":8,"max":0},"lifetime":{"min":0.5,"max":3.05},"blendMode":"normal","frequency":0.0005,"emitterLifetime":-1,"maxParticles":300,"pos":{"x":0,"y":0},"addAtBack":true,"spawnType":"point"}')},,,,,,,,,,,function(e,t,n){e.exports=n(283)},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){},,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},,,,,,,,,,,,,,,,,,,,,,,function(e,t){},,,,,,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},,,,,,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},,,,,,,,function(e,t){},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var a,r,c,o=n(26),i=n(35),u=n.n(i),s=n(48);!function(e){e.clearCombatAction="clearCombatAction",e.startCombatAction="startCombatAction",e.moveActor="moveActor"}(a||(a={})),function(e){e[e.player=0]="player",e[e.enemy=1]="enemy"}(r||(r={})),function(e){e.move="move",e.slash="slash",e.shoot="shoot"}(c||(c={}));var l,m={actors:[{allegiance:r.player,health:100,location:[3,5],name:"c4a5d270",remainingAP:5},{allegiance:r.player,health:100,location:[4,6],name:"2e655832",remainingAP:4}],turn:r.player},d=function(e,t){var n,o,i=t.getState().combat;if(i.action&&i.action.endsAt<Date.now())if(i.turn===r.enemy);else if(i.turn===r.player){switch(i.action.type){case c.move:t.dispatch((n=i.action.actor,o=i.action.target,{type:a.moveActor,actor:n,location:o})),t.dispatch({type:a.clearCombatAction})}return{action:null}}return null},p=n(0),f=n.n(p),v=n(82),h=n(10);!function(e){e.gameTick="gameTick"}(l||(l={}));var g,b=n(36),y=function(e){var t=e.split(".").map((function(e){return Number(e)}));if(3!==t.length)throw new Error("Received invalid version string: ".concat(e));t.forEach((function(e){if(e>=1024)throw new Error("Version string invalid, ".concat(e," is too large"))}));for(var n=0,a=0;a<3;a++)n|=t[a]<<10*a;return n}("0.0.5"),w=n(3),O=n(14),j=n(288),E=n(157),k=n(56),N=n(20),T=n(287),I=n(57),S=n(17),x=n(9),C=n(146),q=n.n(C),A=n(147),D=function(e){var t=e.itemsLoaded,n=e.itemsTotal;return p.createElement("div",null," ","Loading (".concat(Math.floor((t||0)/(n||0)*100),")%")," ")};!function(e){e[e.image=0]="image",e[e.sound=1]="sound"}(g||(g={}));var R,P=[],M=function(e){var t=new Image;return t.src=e,new Promise((function(e,n){function a(){t.naturalWidth?e(t):n(null),t.removeEventListener("load",a),t.removeEventListener("error",a)}t.naturalWidth?e(t):t.complete?n(null):(t.addEventListener("load",a),t.addEventListener("error",a))}))},L=function(e){if((e=e.toLowerCase()).endsWith("png")||e.endsWith("jpg")||e.endsWith("gif"))return g.image;if(e.endsWith("mp3")||e.endsWith("ogg")||e.endsWith("wav"))return g.sound;throw Error("Could not determine type for ".concat(e))},_=function(e){var t=Object(p.useState)(!1),n=Object(O.a)(t,2),a=n[0],r=n[1],c=Object(p.useState)(0),o=Object(O.a)(c,2),i=o[0],l=o[1];Object(p.useEffect)((function(){v()}),[]);var m=e.children,d=e.manifest,f=p.createElement(D,{itemsLoaded:i,itemsTotal:d.length}),v=function(){l(0);var t=e.manifest.map((function(e){return h(e).catch((function(e){return console.error(e)}))}));Promise.all(t).then((function(t){e.onLoadComplete&&e.onLoadComplete(P),r(!0)}))},h=function(){var e=Object(s.a)(u.a.mark((function e(t){var n,a,r,c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(P.some((function(e){return e.url===t}))&&console.warn("Loading media with url ".concat(t," more than once! Will overwrite.")),(n=L(t))!==g.image){e.next=7;break}return e.next=5,M(t);case 5:r=e.sent,a={content:r,mediaType:n,url:t};case 7:if(n===g.sound&&(c=new A.Howl({src:["".concat(".","/").concat(t)]}),a={content:c,mediaType:n,url:t}),!a){e.next=14;break}return P.push(a),l(i+1),e.abrupt("return",a);case 14:throw new Error("Unknown error while trying to load ".concat(t));case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return a?m:f},V=n(16),F=n(7),W=n(149),Q=n(23),B=n(150),U=n(104),G=n.n(U),H=Object(p.forwardRef)((function(e,t){var n=Object(V.useApp)();if(console.log(G.a),n){var a="url('".concat(G.a,"'), auto");n.renderer.plugins.interaction.cursorStyles.pointer=a}return f.a.createElement(z,Object.assign({app:n},e,{ref:t}))})),z=Object(V.PixiComponent)("Viewport",{create:function(e){var t=new B.a({screenWidth:e.screenWidth,screenHeight:e.screenHeight,worldWidth:e.worldWidth,worldHeight:e.worldHeight,ticker:e.app.ticker});t.on("clicked",(function(t){e.onClick&&e.onClick(t)}));var n=e.minScale,a=void 0===n?1:n,r=e.maxScale,c=void 0===r?2:r;return t.drag().pinch().wheel().clamp({direction:"all"}).clampZoom({minScale:a,maxScale:c}).decelerate(),t}}),X=H;!function(e){e[e.NotBuilt=0]="NotBuilt",e[e.Building=1]="Building",e[e.Built=2]="Built"}(R||(R={}));var Y,Z,J,K,$,ee={level:0,state:R.NotBuilt,workers:0},te=n(18),ne=n(19),ae=n(8),re=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"0";Object(te.a)(this,e),this.shapes=void 0,this.shapes=t[n].map((function(e){var t=e.shape;return new ae.Polygon(t)}))}return Object(ne.a)(e,[{key:"contains",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return!(!this.shapes||0===this.shapes.length)&&this.shapes.some((function(n){return n.contains(e,t)}))}}]),e}(),ce=n(151),oe=n(53),ie=function(e){var t=e.hitAreaShapes,n=F.a.lumberMill,a="".concat(".","/img/town/town-alpha/").concat(n,".json"),r=Object(p.useState)(),c=Object(O.a)(r,2),o=c[0],i=c[1],u=e.selected?[be]:[],s=Object(V.useApp)();Object(p.useEffect)((function(){Object(oe.b)(a,(function(e){i(e.textures)}))}),[s,s.loader,a]);var l=Object(p.useState)(0),m=Object(O.a)(l,2),d=m[0],v=m[1];return Object(V.useTick)((function(e){return v((function(t){return t+.01*e}))})),o?f.a.createElement(V.Sprite,{name:n,position:e.position,interactive:!0,buttonMode:!0,pointertap:function(){e.onStructureClick(n)},hitArea:t,filters:u,texture:o["structure.png"]},f.a.createElement(V.Sprite,{name:"blades",texture:o["blades.png"],anchor:new ae.Point(.5,.5),x:15,y:10,rotation:d})):null},ue=n(152),se=n(90),le=n(153),me=Object(V.PixiComponent)("ParticleEmitter",{create:function(){return new ae.ParticleContainer},applyProps:function(e,t,n){var a=n.image,r=n.config,c=Object(se.a)(n,["image","config"]);Object(V.applyDefaultProps)(e,t,c);var o=this._emitter;if(!o){o=new le.a(e,[ae.Texture.from(a)],r);var i=performance.now();o.emit=!0,function e(){o.raf=requestAnimationFrame(e);var t=performance.now();o.update(3e-4*(t-i)),i=t}()}this._emitter=o},willUnmount:function(){this._emitter&&(this._emitter.emit=!1,cancelAnimationFrame(this._emitter.raf))}}),de=function(e){var t=e.hitAreaShapes,n=e.position,a=F.a.tavern,r=e.selected?[be]:[];return f.a.createElement(V.Container,{position:n},f.a.createElement(V.Sprite,{name:a,interactive:!0,buttonMode:!0,pointertap:function(){e.onStructureClick(a)},filters:r,hitArea:t,image:"".concat(".","/img/town/town-alpha/").concat(a,".png")}),f.a.createElement(me,{name:"smoke",x:107,y:-2,image:"".concat(".","/img/town/effects/smokeparticle.png"),config:ue}))},pe=n(29),fe=n(30),ve=function(e){return function(t){Object(fe.a)(a,t);var n=Object(pe.a)(a);function a(){return Object(te.a)(this,a),n.apply(this,arguments)}return Object(ne.a)(a,[{key:"render",value:function(){var t=this;return p.createElement(Ea.Consumer,null,(function(n){return p.createElement(e,Object.assign({},t.props,n))}))}}]),a}(p.Component)},he=function(e){var t=e.structure,n=e.position,a=e.hitAreaShapes,r=e.selected,c=e.onStructureClick,o=r?[be]:[];return f.a.createElement(V.Sprite,{name:t,position:n,interactive:!0,buttonMode:!0,pointertap:function(){c(t)},hitArea:a,filters:o,image:"".concat(".","/img/town/town-alpha/").concat(t,".png")})},ge=(n(203),function(e){var t=e.structures,n=[F.a.workshop,F.a.quarry,F.a.tavern,F.a.tannery,F.a.alchemist,F.a.garden,F.a.weaponsmith,F.a.armoursmith,F.a.warehouse,F.a.mine,F.a.lumberMill,F.a.weaver],a=Object(N.h)("".concat(Object(Q.c)(),"/:structure"));return f.a.createElement("div",{className:"legenda"},f.a.createElement("ul",null,n.map((function(e){return t[e].state===R.NotBuilt?null:f.a.createElement("li",{key:e},function(e){return(null===a||void 0===a?void 0:a.params.structure)===e.toString()?f.a.createElement("span",{className:"highlighted"},"".concat(x.a.getStructureName(e))):f.a.createElement(k.b,{to:Object(Q.b)(e)},"".concat(x.a.getStructureName(e)))}(e))}))))}),be=(n(205),new W.a(8,16763904)),ye=ve((function(e){var t=Object(N.h)("".concat(Object(Q.c)(),"/:structure")),n=null===t||void 0===t?void 0:t.params.structure,a=Object(p.useRef)(null);Object(p.useEffect)((function(){S.c.addMusicTrack(S.a.town,"sound/music/Soliloquy.mp3"),S.c.playMusicTrack(S.a.town)}),[]),Object(p.useEffect)((function(){var e=I.b.to(be,{duration:.6,thickness:2,yoyo:!0,repeat:-1});return function(){e.pause(0),e.kill()}}),[]);var r=function(t){o.current||e.onStructureClick(t)},c=Object(h.e)((function(e){return e.structures})),o=Object(p.useRef)(!1),i=Object(p.useRef)(null);Object(p.useEffect)((function(){if(i.current){var e=i.current;e.on("drag-start",(function(){o.current=!0})),e.on("drag-end",(function(){o.current=!1}))}var t=function(e){e.preventDefault()};return window.addEventListener("wheel",t,{passive:!1}),function(){window.removeEventListener("wheel",t)}}),[]),Object(p.useEffect)((function(){if(n&&i.current){var e=i.current;e.zoomPercent(2);var t=Oe(F.a[n]);e.moveCenter(t)}}),[n]);var u=Object(p.useState)(ja),s=Object(O.a)(u,2),l=s[0],m=s[1],d=Object(p.useState)(1079),v=Object(O.a)(d,2),g=v[0],b=v[1];Object(p.useEffect)((function(){var e=function(){var e,t,n=(null===(e=a.current)||void 0===e?void 0:e.clientWidth)||ja,r=(null===(t=a.current)||void 0===t?void 0:t.clientHeight)||1079;m(n),b(r)};return e(),window.addEventListener("resize",e),function(){window.removeEventListener("resize",e)}}),[]);return f.a.createElement("div",{className:"town-view",ref:a},f.a.createElement(ge,{structures:c}),f.a.createElement(V.Stage,{width:l,height:g,options:{sharedLoader:!0}},f.a.createElement(X,{screenWidth:l,screenHeight:g,worldWidth:1024,worldHeight:1600,ref:i},f.a.createElement(V.Sprite,{name:"background",image:"".concat(".","/img/town/town-alpha/background.png")},[F.a.workshop,F.a.quarry,F.a.tavern,F.a.tannery,F.a.alchemist,F.a.garden,F.a.weaponsmith,F.a.armoursmith,F.a.warehouse,F.a.mine,F.a.lumberMill,F.a.weaver].reverse().map((function(e){if(c[e].state===R.NotBuilt)return null;var t=we(e),a=Oe(e),o=new re(ce,e);return f.a.createElement(t,{position:a,structure:e,hitAreaShapes:o,onStructureClick:r,key:e,selected:n===e})}))))))})),we=function(e){switch(e){case F.a.workshop:case F.a.quarry:case F.a.tannery:case F.a.alchemist:case F.a.garden:case F.a.weaponsmith:case F.a.armoursmith:case F.a.warehouse:case F.a.mine:case F.a.weaver:return he;case F.a.lumberMill:return ie;case F.a.tavern:return de}},Oe=function(e){var t,n;switch(e){case F.a.workshop:t=373,n=610;break;case F.a.quarry:t=632,n=633;break;case F.a.tannery:t=372,n=460;break;case F.a.tavern:t=500,n=469;break;case F.a.alchemist:t=411,n=371;break;case F.a.garden:t=822,n=689;break;case F.a.weaponsmith:t=449,n=460;break;case F.a.armoursmith:t=473,n=442;break;case F.a.warehouse:t=471,n=130;break;case F.a.lumberMill:t=403,n=320;break;case F.a.mine:t=183,n=527;break;case F.a.weaver:t=484,n=333}return new PIXI.Point(t,n)},je=n(33),Ee=n(37),ke=(n(206),function(){var e=Object(p.useState)([]),t=Object(O.a)(e,2),n=t[0],a=t[1],r=function(e){a(e)};return Object(p.useEffect)((function(){return je.a.addEventListener(je.a.EVENT_TOASTS_UPDATED,r),function(){je.a.removeEventListener(je.a.EVENT_TOASTS_UPDATED,r)}}),[]),f.a.createElement("div",{className:"toasts"},n.map((function(e){return f.a.createElement(Ee.b,Object.assign({key:e.time},e))})))}),Ne=(n(207),n(208),function(e){var t=e.className||"";return p.createElement("div",{className:"ui-button widgets-squareiconbutton ".concat(t),onClick:function(t){e.onClick&&e.onClick(t)}},e.text)}),Te=(n(67),n(95),function(e){return p.createElement("div",{className:"window"},p.createElement("div",{className:"header"},!1!==e.backEnabled&&p.createElement(Ne,{className:"back-button",onClick:function(t){e.onBack&&(null===e||void 0===e||e.onBack(),S.c.playSound(S.b.buttonClick))},text:"<"}),p.createElement("h3",null,e.title),!1!==e.closeEnabled&&p.createElement(Ne,{className:"close-button",onClick:function(t){e.onClose&&(null===e||void 0===e||e.onClose(),S.c.playSound(S.b.buttonClick))},text:"x"})),e.children)}),Ie=function(e){return function(t){Object(fe.a)(a,t);var n=Object(pe.a)(a);function a(){return Object(te.a)(this,a),n.apply(this,arguments)}return Object(ne.a)(a,[{key:"render",value:function(){return p.createElement(Te,this.props,p.createElement(e,this.props))}}]),a}(p.Component)},Se=n(38),xe=(n(119),n(209),Object(Se.c)(Ie)((function(){var e=Object(p.useRef)(null),t=Object(p.useRef)(null);return p.createElement("div",{className:"settings-window"},p.createElement("details",{open:!0,className:"sound"},p.createElement("summary",null,"Sound"),p.createElement("section",null,p.createElement("p",null,p.createElement("label",null,"Sound"),p.createElement("button",{onClick:function(){I.a.to(e.current,{duration:.5,value:0,onComplete:function(){S.c.soundVolume=0}})}},p.createElement("span",{role:"img","aria-label":"Mute"},"\ud83d\udd07")),p.createElement("input",{type:"range",min:"0",max:"1",step:"0.05",ref:e,onChange:function(e){var t=parseFloat(e.target.value),n=Math.pow(t,2);S.c.soundVolume=n},defaultValue:"".concat(Math.sqrt(S.c.soundVolume))})),p.createElement("p",null,p.createElement("label",null,"Music"),p.createElement("button",{onClick:function(){I.a.to(t.current,{duration:.5,value:0,onComplete:function(){S.c.musicVolume=0}})}},p.createElement("span",{role:"img","aria-label":"Mute"},"\ud83d\udd07")),p.createElement("input",{type:"range",min:"0",max:"1",step:"0.05",ref:t,onChange:function(e){var t=parseFloat(e.target.value),n=Math.pow(t,2);S.c.musicVolume=n},defaultValue:"".concat(Math.sqrt(S.c.musicVolume))})))))}))),Ce=n(15),qe=n(31),Ae=n(1),De=n(28),Re=n(22),Pe=[Re.a.food,Re.a.wood,Re.a.iron,Re.a.stone,Re.a.fabric,Re.a.leather];function Me(e){return{type:Y.addResources,resources:e}}function Le(e){return{type:Z.finishBuildingStructure,structure:e}}function _e(e){return{type:Z.upgradeStructure,structure:e}}function Ve(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return{type:Z.increaseWorkers,structure:e,workers:t}}function Fe(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return{type:Z.decreaseWorkers,structure:e,workers:t}}function We(e){return{type:J.addGold,amount:e}}function Qe(e){return{type:J.addGold,amount:-e}}function Be(e,t){return{type:K.addItem,item:e,toSlot:t}}function Ue(e){return{type:K.removeItem,fromSlot:e}}!function(e){e.addResources="addResources",e.removeResources="removeResources"}(Y||(Y={})),function(e){e.upgradeStructure="upgradeStructure",e.increaseWorkers="increaseWorkers",e.decreaseWorkers="decreaseWorkers",e.startBuildingStructure="startBuildingStructure",e.finishBuildingStructure="finishBuildingStructure",e.setStructureState="setStructureState"}(Z||(Z={})),function(e){e.addGold="addGold"}(J||(J={})),function(e){e.addItem="addItem",e.moveItemInWarehouse="moveItemInWarehouse",e.removeItem="removeItem"}(K||(K={})),function(e){e.addWorkers="addWorkers"}($||($={}));var Ge,He=Ie((function(e){var t=Object(p.useRef)(null),n=Object(p.useState)({gold:50,resources:50,workers:10}),a=Object(O.a)(n,2),r=a[0],c=a[1],o=Object(h.d)(),i=function(e,t){o(function(e,t){return{type:Z.setStructureState,structure:e,state:t}}(e,t))},u=function(e){var t;o((t=e,{type:$.addWorkers,value:t})),o(Object(b.c)("common-cheat-workers-added",{amount:e},De.a.common))},s=Object(h.e)((function(e){return e.structures})),l=function(e){return p.createElement("option",{value:e,key:e},x.a.getItemName(e))},m=Object.keys(Ae.b).filter((function(e){return!isNaN(e)})).map((function(e){return p.createElement("optgroup",{label:Ae.b[e],key:e},function(e){return Object.keys(Ae.a).filter((function(t){return Object(qe.b)(t).itemType==e})).map((function(e){return l(e)}))}(e))})),d=function(e,t){i(e,t?R.Built:R.NotBuilt),t?je.a.addToast("The ".concat(x.a.getStructureName(e)," is constructed"),Ee.a.cheat):je.a.addToast("The ".concat(x.a.getStructureName(e)," is not constructed"),Ee.a.cheat)};return p.createElement("div",{className:"cheat-box"},p.createElement("div",{className:"label-numberbox-button"},p.createElement("label",null,"Gold"),p.createElement("input",{type:"number",value:r.gold,style:{width:"50px"},onChange:function(e){var t=Number(e.target.value);c(Object(Ce.a)({},r,{gold:t}))}}),p.createElement("button",{onClick:function(e){var t=r.gold;!function(e){o(We(e)),o(Object(b.c)("common-cheat-gold-added",{amount:e},De.a.common))}(t);var n=x.a.get("common-cheat-gold-added",{amount:t});je.a.addToast(n,Ee.a.cheat,"/img/resources/gold.png")}},"Add")),p.createElement("div",{className:"label-numberbox-button"},p.createElement("label",null,"Workers"),p.createElement("input",{type:"number",value:r.workers,style:{width:"50px"},onChange:function(e){var t=Number(e.target.value);c(Object(Ce.a)({},r,{workers:t}))}}),p.createElement("button",{onClick:function(e){var t=r.workers;u(t);var n=x.a.get("common-cheat-workers-added",{amount:t});je.a.addToast(n,Ee.a.cheat,"/img/resources/worker.png")}},"Add")),p.createElement("div",{className:"label-numberbox-button"},p.createElement("label",null,"Resources"),p.createElement("input",{type:"number",value:r.resources,style:{width:"50px"},onChange:function(e){var t=Number(e.target.value);c(Object(Ce.a)({},r,{resources:t}))}}),p.createElement("button",{onClick:function(e){!function(e){var t=Pe.reduce((function(t,n){return t[n]=e,t}),{});o(Me(t)),o(Object(b.c)("common-cheat-resources-added",{amount:e},De.a.common))}(r.resources);var t=x.a.get("common-cheat-resources-added",{amount:r.resources});je.a.addToast(t,Ee.a.cheat)}},"Add")),p.createElement("div",{className:"label-numberbox-button"},p.createElement("label",null,"Items"),p.createElement("select",{style:{width:"150px"},ref:t},m),p.createElement("button",{onClick:function(e){var n=t.current.value;!function(e){o(Be(e)),o(Object(b.c)("common-cheat-item-added",{item:e},De.a.common))}(n);var a=x.a.get("common-cheat-item-added",{item:n}),r=Object(qe.b)(n).iconImg;je.a.addToast(a,Ee.a.cheat,r)}},"Add")),Object.keys(s).map((function(e){return function(e){var t=Object(F.b)(e),n=s[e],a=t.levels[n.level],r=x.a.get(a.displayName);return p.createElement("div",{className:"label-dropdown",key:e},p.createElement("label",{title:e},"".concat(r)),p.createElement("input",{key:e,type:"checkbox",checked:s[e].state===R.Built,onChange:function(){return d(e,s[e].state!==R.Built)}}))}(e)})))})),ze=Object(Se.c)(Ie,ve)((function(e){return p.createElement("div",{className:"menu"},p.createElement("p",null,p.createElement("button",{onClick:function(){var t=p.createElement(He,{title:"Cheats"});e.onOpenWindow(t)}},"Cheats!")),p.createElement("p",null,p.createElement("button",{onClick:function(){var t=p.createElement(xe,{title:"Settings"});e.onOpenWindow(t)}},"Settings")))})),Xe=(n(210),n(211),n(154)),Ye=n.n(Xe),Ze=n(85),Je=function(e){Object(fe.a)(n,e);var t=Object(pe.a)(n);function n(){return Object(te.a)(this,n),t.apply(this,arguments)}return Object(ne.a)(n,null,[{key:"showContextTooltip",value:function(e,t,n){var a={type:e,info:t,referenceRect:n};Ye()(a,this.lastContext)?this.clear():(this.emit(this.EVENT_CONTEXT_UPDATED,a),this.lastContext=a)}},{key:"clear",value:function(){this.emit(this.EVENT_CONTEXT_UPDATED,void 0),this.lastContext=void 0}}]),n}(Object(Ze.a)());Je.EVENT_CONTEXT_UPDATED="tooltipContextUpdated",Je.lastContext=void 0,function(e){e[e.item=0]="item",e[e.resource=1]="resource"}(Ge||(Ge={}));var Ke=function(){return Object(h.e)((function(e){return e.gold}))},$e=function(){return Object(h.e)((function(e){return e.resources}))},et=n(58),tt=Object(et.a)([function(e){return e.structures},function(e){return e.workers}],(function(e,t){return t-Object.keys(e).map((function(t){return e[t]})).reduce((function(e,t){return e+t.workers}),0)})),nt=function(){var e=Ke(),t=$e(),n=Object(h.e)(tt),a=function(e,t,n){return p.createElement("li",{key:n,onClick:function(e){var t=e.currentTarget.getBoundingClientRect();Je.showContextTooltip(Ge.resource,n,t),e.stopPropagation()}},p.createElement("div",{className:"icon common-icon-smallest",style:{backgroundImage:"url(".concat(".").concat(e,")")}}),p.createElement("div",{className:"amount"},function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=["","k","M","G","T","P","E"],a=Math.log10(e)/3|0;if(0===a)return e.toFixed(t);var r=n[a],c=Math.pow(10,3*a),o=e/c;return o.toFixed(t)+r}(t,0)))},r=Pe.map((function(e){var n=Re.b[e];return a(n.iconImg,t[e],e)}));return r.push(a("/img/resources/worker.png",n,"workers"),a("/img/resources/gold.png",e,"gold")),p.createElement("ul",{className:"resourcebar"},r)},at=function(){var e=Object(p.useContext)(Ea);return p.createElement("div",{className:"topbar"},p.createElement("div",{className:"topbar-left"},p.createElement(nt,null)),p.createElement("div",{className:"topbar-right"},p.createElement("div",{className:"hamburger",onClick:function(t){var n=p.createElement(ze,{title:"Menu"});e.onOpenWindow(n)}},"\u2630")))},rt=n(13);window.PIXI=ae;var ct,ot=function(e){var t=e.quest,n=e.leader,a=e.encounterActive,r=e.position,c=e.onClick,o=e.selected?"/img/world/map-marker-selected.png":"/img/world/map-marker.png",i=Object(p.useRef)(null);return Object(p.useEffect)((function(){var e=i.current,t=new ae.Graphics;t.beginFill(12245589),t.drawCircle(0,0,256),t.endFill(),e.mask=t,e.addChild(t)}),[i]),f.a.createElement(V.Sprite,{image:"".concat(".").concat(o),name:t.name,x:r.x,y:r.y,interactive:!0,buttonMode:!0,scale:new ae.Point(.1,.1),anchor:new ae.Point(.5,1),pointerdown:function(){c&&c(t)}},n&&f.a.createElement(V.Sprite,{image:"".concat(".","/").concat(n.avatarImg),name:"avatar",anchor:new ae.Point(.5,.5),x:0,y:-396,scale:new ae.Point(.66,.66),ref:i}),a&&f.a.createElement(V.Sprite,{image:"".concat(".","/img/world/quest-alert.png"),name:"quest-alert",anchor:new ae.Point(.5,1),x:180,y:-396,scale:new ae.Point(2,2)}))},it=n(44),ut=function(e){var t=e.positions;return e.positions.length>2?f.a.createElement(V.Graphics,{name:"questline",x:0,y:0,draw:function(e){e.lineStyle(3,16724736),e.moveTo(t[0].x,t[0].y);var n=0;for(n=1;n<t.length-2;n++){var a=(t[n].x+t[n+1].x)/2,r=(t[n].y+t[n+1].y)/2;e.quadraticCurveTo(t[n].x,t[n].y,a,r)}e.quadraticCurveTo(t[n].x,t[n].y,t[n+1].x,t[n+1].y),e.endFill()}}):null};!function(e){e[e.unavailable=0]="unavailable",e[e.available=1]="available",e[e.active=2]="active",e[e.completed=3]="completed"}(ct||(ct={}));var st=Object(et.a)([function(e){return e.quests}],(function(e){return e.filter((function(e){return e.status===ct.active})).map((function(e){return e}))})),lt=n(42);window.PIXI=ae;var mt,dt=function(e){var t=e.retrieveWorldViewRef,n=e.smallMap,a=Object(p.useCallback)((function(t){return t.quests.find((function(t){return t.name===e.selectedQuestName}))}),[e.selectedQuestName]),r=Object(h.e)(a),c=Object(h.e)((function(e){return e.adventurers})),o=Object(h.e)((function(e){return st(e)})),i=Object(p.useState)(ja),u=Object(O.a)(i,2),s=u[0],l=u[1],m=Object(p.useState)(1024),d=Object(O.a)(m,2),v=d[0],g=d[1];Object(p.useEffect)((function(){var e=function(){var e,a,r=t(),c=(null===(e=r.current)||void 0===e?void 0:e.clientWidth)||ja,o=(null===(a=r.current)||void 0===a?void 0:a.clientHeight)||1024;l(c),g(n?c<576?64:128:o)};return e(),window.addEventListener("resize",e),function(){window.removeEventListener("resize",e)}}),[t,n]),Object(p.useEffect)((function(){r&&y(r)}),[r,v]);var b=Object(p.useRef)(null);Object(p.useEffect)((function(){if(b.current){var e=b.current,t=ft({x:0,y:0});e.moveCenter(t.x,t.y)}}),[s]);var y=function(e){var t=b.current;if(t){var n=pt(e),a=ft(n);t.moveCenter(a.x,a.y)}};return f.a.createElement(V.Stage,{width:s,height:v},f.a.createElement(X,{screenWidth:s,screenHeight:v,worldWidth:1500,worldHeight:1061,ref:b},f.a.createElement(V.Sprite,{image:"".concat(".","/img/world/francesca-baerald-fbaerald-angeloumap-lowres.jpg"),interactive:!0,pointerdown:function(){}},o.map((function(e){var t=vt(e);return f.a.createElement(ut,{positions:t,key:e.name})})),o.map((function(t){var n=pt(t),a=ft(n),o=Object(it.c)(c,t),i=Object(lt.b)(t.name),u=Math.floor(t.progress),s=i.nodes[u];return f.a.createElement(ot,{quest:t,leader:o,position:a,key:t.name,selected:t===r,encounterActive:s.type===rt.a.encounter,onClick:function(t){return n=t.name,void e.onPartyClick(n);var n}})})))))},pt=function(e){var t=Object(lt.b)(e.name),n=Math.floor(e.progress),a=t.nodes[n],r=t.nodes[n+1];return r?Object(oe.a)(a,r,e.progress-n):a},ft=function(e){var t=10*e.x+750,n=10*e.y+530.5;return new ae.Point(t,n)},vt=function(e){for(var t=[],n=Object(lt.b)(e.name),a=0;a<e.progress;a++)t.push(ft(n.nodes[a]));var r=ft(pt(e));return t.push(r),t},ht=(n(240),n(241),n(134),function(e){var t=e.activeTab,n=void 0===t?null:t;!n&&e.children&&e.children.length&&(n=e.children[0].props.id);var a="".concat(e.className," ").concat(e.disabled?"disabled":""),r=f.a.Children.map(e.children,(function(e){return f.a.cloneElement(e,{active:e.props.id===n,onClick:function(){c(e.props.id)}})})),c=function(t){e.onTabSelected&&!0!==e.disabled&&e.onTabSelected(t)};return f.a.createElement("ul",{className:"tabstrip ".concat(a),onClick:function(t){S.c.playSound(S.b.buttonClick),e.onClick&&e.onClick(t)}},r)}),gt=function(e){var t=(e.active?"active":"")+(e.className||"");return p.createElement("li",{className:"tabstrip-tab ".concat(t),onClick:function(t){e.onClick&&e.onClick(t)}},e.children)},bt=(n(242),function(e){var t=e.adventurer,n=(e.className||"")+" avatar";return p.createElement("div",{className:n,style:{backgroundImage:"url(".concat(".","/").concat(t.avatarImg,")")},onClick:function(){e.onClick&&e.onClick(e.adventurer.id)}},p.createElement("div",{className:"sizer"}),e.displayName&&p.createElement("div",{className:"name"},t.name))}),yt=function(e){var t=e.adventurers,n=e.onAdventurerTabSelected;return f.a.createElement(ht,{className:"adventurers-tabstrip",onTabSelected:function(t){var a=e.adventurers.find((function(e){return e.id===t}));n(a.id)},activeTab:e.selectedAdventurerId,disabled:e.disabled},t.map((function(e){return t=e,f.a.createElement(gt,{id:t.id,key:t.id},f.a.createElement(bt,{adventurer:t,className:"common-icon-small"}));var t})))},wt=function(e){return e.adventurers},Ot=function(e){return e.quests},jt=(Object(et.a)([wt,Ot],(function(e,t){var n=[],a=Object.values(t).reduce((function(t,a){var r=Object(it.b)(e,a);return a.status===ct.active&&(t[a.name]=r),n.push.apply(n,Object(o.a)(r)),t}),{});return a.solo=e.filter((function(e){return-1===n.indexOf(e)})),a})),Object(et.a)([wt,Ot],(function(e,t){var n=t.reduce((function(e,t){return t.status===ct.active&&e.push.apply(e,Object(o.a)(t.party)),e}),[]);return e.filter((function(e){return-1===n.indexOf(e.id)}))})),"adventurer"),Et="item";!function(e){e[e.adventurerInventory=0]="adventurerInventory",e[e.warehouse=1]="warehouse",e[e.tavern=2]="tavern",e[e.adventurerEquipment=3]="adventurerEquipment",e[e.lootCache=4]="lootCache"}(mt||(mt={}));var kt,Nt=n(64),Tt=n(51),It=(n(243),{drop:function(e,t){e.onDrop(t.getItem())},canDrop:function(e,t){var n=t.getItem().item;return xt(n,e.type)}});!function(e){e[e.feet=0]="feet",e[e.hands=1]="hands",e[e.chest=2]="chest",e[e.legs=3]="legs",e[e.head=4]="head",e[e.shoulders=5]="shoulders",e[e.mainHand=6]="mainHand",e[e.offHand=7]="offHand"}(kt||(kt={}));var St,xt=function(e,t){switch(t){case kt.chest:return qt(e,Nt.a.chest);case kt.feet:return qt(e,Nt.a.feet);case kt.hands:return qt(e,Nt.a.hands);case kt.head:return qt(e,Nt.a.head);case kt.legs:return qt(e,Nt.a.legs);case kt.mainHand:case kt.offHand:return Object(qe.b)(e).itemType===Ae.b.weapon;default:return!1}},Ct=Object(Tt.DropTarget)(Et,It,(function(e,t){return{canDrop:t.canDrop(),connectDropTarget:e.dropTarget(),isOver:t.isOver()}}))((function(e){var t=e.isOver,n=e.canDrop,a="grey";return t&&n?a="green":n&&(a="orange"),(0,e.connectDropTarget)(p.createElement("div",{className:"equipment-slot",style:{borderColor:a},title:kt[e.type]},e.children))})),qt=function(e,t){var n=Object(qe.b)(e);return n.itemType===Ae.b.apparel&&n.equipmentType===t};!function(e){e[e.smallest=0]="smallest",e[e.small=1]="small",e[e.medium=2]="medium",e[e.big=3]="big",e[e.biggest=4]="biggest"}(St||(St={}));var At=function e(t){switch(t){case St.smallest:return"common-icon-smallest";case St.small:return"common-icon-small";case St.medium:return"common-icon-medium";case St.big:return"common-icon-big";case St.biggest:return"common-icon-biggest"}return e(St.medium)},Dt=(n(244),function(e){var t=e.item,n=Object(qe.b)(t);n||console.warn("could not find definition for ".concat(t));var a="item-icon ".concat(At(e.size));return p.createElement("div",{className:a,onClick:function(n){if(!1!==e.showContext){var a=n.currentTarget.getBoundingClientRect();Je.showContextTooltip(Ge.item,Object(qe.b)(t),a),n.stopPropagation()}e.onClick&&e.onClick(n)},style:{backgroundImage:"url(".concat(".").concat(n.iconImg,")")}})});var Rt,Pt=Object(Tt.DragSource)(Et,{beginDrag:function(e){return{inventorySlot:e.index,item:e.item,sourceId:e.sourceId,sourceType:e.sourceType}}},(function(e,t){return{connectDragSource:e.dragSource(),isDragging:t.isDragging()}}))((function(e){var t=e.item,n=e.onClick,a=e.isDragging,r=e.connectDragSource,c=e.size;return a?null:r(p.createElement("div",null,p.createElement(Dt,{item:t,onClick:function(e){n&&n(e)},size:c})))})),Mt=function(e){var t=e.adventurer,n=e.onDropItemEquipment,a=function(e){var a=t.equipment[kt[e]],r=null;if(a){var c=f.a.createRef();r=f.a.createElement(Pt,{index:e,sourceId:t.id,sourceType:mt.adventurerEquipment,item:a,ref:c,size:St.medium})}return f.a.createElement(f.a.Fragment,null,f.a.createElement(Ct,{onDrop:function(t){return n(t,e)},type:e},r),f.a.createElement("span",{className:"info"},x.a.get("ui-equipmentslot-".concat(kt[e]))))};return f.a.createElement("ul",null,f.a.createElement("li",null,a(kt.head)),f.a.createElement("li",null,a(kt.shoulders)),f.a.createElement("li",null,a(kt.chest)),f.a.createElement("li",null,a(kt.hands)),f.a.createElement("li",null,a(kt.legs)),f.a.createElement("li",null,a(kt.feet)),f.a.createElement("li",null,a(kt.mainHand)),f.a.createElement("li",null,a(kt.offHand)))},Lt=(n(245),{drop:function(e,t){e.onDrop(t.getItem())},canDrop:function(e,t){var n=t.getItem();return n.sourceType!==mt.adventurerEquipment||(null==e.item||xt(e.item,n.inventorySlot))}}),_t=Object(Tt.DropTarget)(Et,Lt,(function(e,t){return{canDrop:t.canDrop(),connectDropTarget:e.dropTarget(),isOver:t.isOver()}}))((function(e){var t=e.isOver,n=e.canDrop,a=e.connectDropTarget,r=t&&n,c=["inventory-item",At(e.size)];return r?c.push("drop-active"):n&&c.push("drop-possible"),a(p.createElement("div",{className:c.join(" ")},e.children))})),Vt=function(e){for(var t=[],n=function(n){var a=void 0,r=e.items[n];r&&(a=p.createElement(Pt,{index:n,sourceId:e.sourceId,sourceType:e.sourceType,item:r}));var c=p.createElement(_t,{key:"inventory-slot-".concat(n),item:r,size:e.iconSize,onDrop:function(t){if((t.inventorySlot!==n||t.sourceType!==e.sourceType||t.sourceId!==e.sourceId)&&e.onDropItem){var a=t.inventorySlot;e.onDropItem(t.item,a,n,t.sourceType,t.sourceId)}}},a);t.push(c)},a=0;a<e.items.length;a++)n(a);return p.createElement("div",{className:"inventory ".concat(e.className)},t)};function Ft(e,t,n){return{type:Rt.addItemToInventory,adventurerId:e,item:t,toSlot:n}}function Wt(e,t){return{type:Rt.removeItemFromInventory,adventurerId:e,fromSlot:t}}function Qt(e,t,n){return{type:Rt.assignEquipment,adventurerId:e,item:n,equipmentSlot:t}}function Bt(e,t){return{type:Rt.removeEquipment,adventurerId:e,equipmentSlot:t}}!function(e){e.moveItemInInventory="moveItemInInventory",e.moveItemToOtherAdventurer="moveItemToOtherAdventurer",e.moveItemFromWarehouseToAdventurer="moveItemFromWarehouseToAdventurer",e.addItemToInventory="addItemToInventory",e.removeItemFromInventory="removeItemFromInventory",e.assignEquipment="assignEquipment",e.removeEquipment="removeEquipment"}(Rt||(Rt={}));var Ut=function(){return Object(h.e)((function(e){return e.stockpile}))},Gt=function(){var e=Object(h.d)(),t=Ut();return{dropItemEquipment:function(t,n,a){var r=t.item,c=[];switch(t.sourceType){case mt.adventurerInventory:c.push(Wt(a.id,t.inventorySlot),Qt(a.id,n,r));var o=a.equipment[kt[n]];o&&c.push(Ft(a.id,o,t.inventorySlot));break;case mt.warehouse:c.push(Ue(t.inventorySlot),Qt(a.id,n,r));var i=a.equipment[kt[n]];i&&c.push(Be(i,t.inventorySlot));break;case mt.adventurerEquipment:c.push(Qt(a.id,n,r));var u=a.equipment[kt[n]],s=t.inventorySlot;u?c.push(Qt(a.id,s,u)):c.push(Bt(a.id,s))}c.forEach((function(t){return e(t)}))},dropItemInventory:function(t,n,a,r,c,o){var i=[];switch(r){case mt.adventurerInventory:i.push(function(e,t,n){return{type:Rt.moveItemInInventory,adventurerId:e,fromSlot:t,toSlot:n}}(c.id,n,a));break;case mt.warehouse:i.push(Ue(n),Ft(c.id,t,a));var u=c.inventory[a];u&&i.push(Be(u,n));break;case mt.adventurerEquipment:i.push(Ft(c.id,t,a));var s=c.inventory[a];s?i.push(Qt(c.id,n,s)):i.push(Bt(c.id,n))}i.forEach((function(t){return e(t)}))},dropItemWarehouse:function(n,a,r,c,o){var i=[];switch(c){case mt.warehouse:i.push(function(e,t){return{type:K.moveItemInWarehouse,fromSlot:e,toSlot:t}}(a,r));var u=t[r];u&&i.push(Ft(o,u,a));break;case mt.adventurerInventory:i.push(Wt(o,a),Be(n,r));var s=t[r];s&&i.push(Ft(o,s,a))}i.forEach((function(t){return e(t)}))}}},Ht=(n(246),function(e){var t=e.adventurer,n=Gt(),a=n.dropItemEquipment,r=n.dropItemInventory;return f.a.createElement("div",{className:"adventurer-panel"},f.a.createElement("div",{className:"info"},f.a.createElement("div",{className:"name"},f.a.createElement("b",null,t.name))),f.a.createElement("div",{className:"equipment"},f.a.createElement(Mt,{adventurer:t,onDropItemEquipment:function(e,n){a(e,n,t)}})),f.a.createElement("div",{className:"right"},f.a.createElement(Vt,{sourceType:mt.adventurerInventory,sourceId:t.id,items:t.inventory,className:"inventory-small",onDropItem:function(e,n,a,c,o){r(e,n,a,c,t,o)}})))}),zt=function(e){var t=Object(p.useCallback)((function(t){return t.quests.find((function(t){return t.name===e}))}),[e]);return Object(h.e)(t)},Xt=n(89);n(99);window.PIXI=ae;var Yt=Object(V.PixiComponent)("RectTileLayer",{create:function(e){return new window.PIXI.tilemap.CompositeRectTileLayer(0,[e.texture])},applyProps:function(e,t,n){var a=n.layer,r=n.tileset,c=n.horizontalTiles,o=n.spritesheet;if(a.data)for(var i=0;i<a.data.length;i++){var u=r.tilewidth,s=r.tileheight,l=i%c*u,m=Math.floor(i/c)*s;if(a.data[i]>0){var d="".concat(r.name,"-").concat(a.data[i]);e.addFrame(o.textures[d],l,m)}}}});window.PIXI=ae;var Zt,Jt=Object(V.PixiComponent)("ObjectTileLayer",{create:function(e){return new window.PIXI.tilemap.CompositeRectTileLayer(0,[e.texture])},applyProps:function(e,t,n){var a=n.objects,r=n.tileset,c=n.spritesheet;e.clear(),a&&a.forEach((function(t){var n=r.tilewidth,a=r.tileheight,o=t.location[0]*n,i=t.location[1]*a;if(void 0!==t.gid){var u="".concat(r.name,"-").concat(t.gid);e.addFrame(c.textures[u],o,i)}}))}}),Kt=function(e){var t=e.basePath,n=e.data,a=e.tileObjects,r=Object(p.useState)(),c=Object(O.a)(r,2),o=c[0],i=c[1],u=Object(p.useState)(),s=Object(O.a)(u,2),l=s[0];s[1];return Object(p.useEffect)((function(){var e=nn(n),r=$t(n);Object(oe.b)("".concat(t,"/").concat(r.image),(function(t){var c=t.texture;if(c){ae.utils.clearTextureCache();var o=new ae.Spritesheet(c,e);o.parse((function(){var e=n.layers.filter((function(e){return e.visible&&e.type===Xt.a.tilelayer})).map((function(e){return en(e,c,n.width,r,o)}));e.push(tn(a,c,r,o)),i(e)}))}}))}),[t,n,a]),f.a.createElement(V.Container,null,o,l)},$t=function(e){if(!e.tilesets.length)throw new Error("No tilesets found! Can't continue");if(e.tilesets.length>1&&console.warn("Found more than one tileset. But we currently only support one."),e.tilesets[0].source)throw new Error("Please embed tilemaps in Tiled! Can't continue");return e.tilesets[0]},en=function(e,t,n,a,r){return f.a.createElement(Yt,{key:e.name,texture:t,layer:e,horizontalTiles:n,tileset:a,spritesheet:r})},tn=function(e,t,n,a){return f.a.createElement(Jt,{key:"objects",objects:e,texture:t,tileset:n,spritesheet:a})},nn=function(e){for(var t=$t(e),n=t.columns,a={},r=0;r<t.tilecount;r++){var c=t.tilewidth,o=t.tileheight,i=r%n*c,u=Math.floor(r/n)*o;a["".concat(t.name,"-").concat(r+t.firstgid)]={frame:{x:i,y:u,w:c,h:o},spriteSourceSize:{x:i,y:u,w:c,h:o},rotated:!1,trimmed:!1,sourceSize:{w:c,h:o}}}return{frames:a,meta:{image:t.image,size:{w:t.imagewidth,h:t.imageheight},scale:1}}},an=function(e){var t=e.children,n=Object(se.a)(e,["children"]);return f.a.createElement(h.b.Consumer,null,(function(e){var a=e.store;return f.a.createElement(V.Stage,n,f.a.createElement(h.a,{store:a},t))}))};!function(e){e.move="move"}(Zt||(Zt={}));var rn=n(24),cn=function(e){var t,n,a=e.location,r=void 0===a?[0,0]:a,c=e.controller,o=e.children,i=null===(t=c.mapData)||void 0===t?void 0:t.tilewidth,u=null===(n=c.mapData)||void 0===n?void 0:n.tileheight,s=Object(p.useRef)(null),l=Object(h.d)(),m=Object(p.useCallback)((function(t){var n=t.quests.find((function(t){return t.name===e.controller.questName}));return n.scene.actionQueue?n.scene.actionQueue.filter((function(t){return t.actor===e.name})):[]}),[e.name,e.controller.questName]),d=Object(h.e)(m);Object(p.useEffect)((function(){if(s){var t=d[0];if(t)switch(t.actionType){case Zt.move:var n=function(){l(Object(rn.b)(e.controller.questName)),e.controller.actorMoved(e.name,t.target)},a=(t.endsAt-performance.now())/1e3;a<0&&n(),I.b.killTweensOf(s.current),I.b.to(s.current,{duration:a,ease:"linear",pixi:{x:t.target[0]*i,y:t.target[1]*u},onComplete:n})}}}),[l,i,u,d,e.controller,e.name]);var v=Object(p.useMemo)((function(){return{x:r[0]*i,y:r[1]*u}}),[r,i,u]),g=v.x,b=v.y;return f.a.createElement(V.Container,{x:g,y:b,ref:s},o)},on=Object(p.forwardRef)((function(e,t){var n=Object(p.useRef)(null);return Object(p.useImperativeHandle)(t,(function(){var e;return{drawAction:function(e,t){var a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=n.current;if(r){var c=a?65280:16724736;r.clear().lineStyle(3,c).moveTo(e.x,e.y).lineTo(t.x,t.y)}},clear:function(){var e=n.current;null===e||void 0===e||e.clear()},parent:null===(e=n.current)||void 0===e?void 0:e.parent}})),f.a.createElement(V.Graphics,{name:"ActionPath",ref:n})})),un=function(e){var t=Object(p.useCallback)((function(t){return t.adventurers.find((function(t){return t.id===e}))}),[e]);return Object(h.e)(t)},sn=function(e){var t,n,a=e.controller,r=e.location,c=e.name,o=e.selected,i=null===(t=a.mapData)||void 0===t?void 0:t.tilewidth,u=null===(n=a.mapData)||void 0===n?void 0:n.tileheight,s=Object(h.d)(),l=zt(e.questName).scene,m=un(c),d=Object(p.useRef)(null),v=Object(p.useState)(!1),g=Object(O.a)(v,2),b=g[0],y=g[1];Object(p.useEffect)((function(){if(b&&r){var e=d.current,t=null===e||void 0===e?void 0:e.parent,n=function(t){if(b&&r&&e){var n=a.pointToSceneLocation(new PIXI.Point(t.data.global.x,t.data.global.y)),c=a.locationIsBlocked(n),o=new PIXI.Point(r[0]*i+i/2,r[1]*u+u/2);e.drawAction(o,t.data.global,!c)}};return t.on("pointermove",n),function(){t.off("pointermove",n)}}}),[b,a,r,u,i]);return f.a.createElement(f.a.Fragment,null,f.a.createElement(on,{ref:d}),f.a.createElement(cn,{key:c,name:c,controller:a,location:r},o&&f.a.createElement(V.Graphics,{name:"selectioncircle",draw:function(e){e.lineStyle(3,16777215),e.drawCircle(i/2,u/2,i/2-3),e.endFill()}}),f.a.createElement(V.Sprite,{y:-80,image:"".concat(".","/img/scene/actors/wizard.png"),interactive:!0,pointerdown:function(){y(!0),e.setSelectedActor(c)},pointerup:function(e){y(!1),e.stopPropagation()},pointerupoutside:function(t){var n;if(y(!1),!(null===(n=l.actionQueue)||void 0===n?void 0:n.length)){e.onLootCacheChanged("chest");var o=a.pointToSceneLocation(new PIXI.Point(t.data.global.x,t.data.global.y));if(!a.locationIsBlocked(o)){var i,u=a.pointToSceneLocation(t.data.global),m=function(e){return{x:e[0],y:e[1]}},p=r,f=null===(i=a.aStar)||void 0===i?void 0:i.findPath(m(p),m(u));null===f||void 0===f||f.forEach((function(t,n){var a={actionType:Zt.move,actor:c,target:t,endsAt:500*(n+1)+performance.now()};s(Object(rn.c)(e.questName,a))}))}y(!1);var v=d.current;null===v||void 0===v||v.clear()}}}),f.a.createElement(V.Sprite,{scale:.1,anchor:.5,x:i/2,y:-30,image:"".concat(".","/").concat(m.avatarImg)}),o&&a.actorCanInteract(c)&&f.a.createElement(V.Container,{interactive:!0,pointerdown:function(){a.actorInteract(c)}},f.a.createElement(V.Graphics,{draw:function(e){e.beginFill(14561865),e.drawCircle(i/2,u,i/4),e.endFill()}}),f.a.createElement(V.Sprite,{image:"".concat(".","/img/ui/scene/icons/interact.png"),scale:[.3,.3],y:u,x:i/2,anchor:.5}))))};window.PIXI=ae;var ln,mn=function(e){var t,n=e.controller,a=n.mapData,r=n.basePath,c=Object(p.useRef)(null),o=zt(e.questName).scene,i=Object(p.useMemo)((function(){var t;return(null===(t=o.actors)||void 0===t?void 0:t.find((function(t){return t.name===e.selectedActor})))||null}),[o.actors,e.selectedActor]),u=a.width*a.tilewidth,s=a.height*a.tileheight;return f.a.createElement(f.a.Fragment,null,f.a.createElement(an,{width:u,height:s},f.a.createElement(V.Container,{ref:c,interactive:!0,hitArea:new ae.Rectangle(0,0,u,s)},f.a.createElement(Kt,{basePath:r,data:a,tileObjects:o.tileObjects}),null===(t=o.actors)||void 0===t?void 0:t.map((function(t){return function(t){var a=t.name,r=t.location;return f.a.createElement(sn,{controller:n,location:r,name:a,key:a,questName:e.questName,selected:(null===i||void 0===i?void 0:i.name)===a,onLootCacheChanged:e.onLootCacheChanged,setSelectedActor:e.setSelectedActor})}(t)})))),!1)},dn=n(77),pn=function(e){var t=zt(e.questName),n=Object(lt.b)(t.name),a=Math.floor(t.progress);do{var r=n.nodes[a].log;if(r)return f.a.createElement("div",null,f.a.createElement("h1",{className:"app-h2"},x.a.getQuestTitle(t.name)),f.a.createElement("p",null,"".concat(x.a.get(r))));a--}while(a>=0);return null},fn=function(e){var t=zt(e.questName);return t.sceneName?f.a.createElement(vn,Object.assign({},e,{sceneName:t.sceneName,scene:t.scene})):f.a.createElement(pn,{questName:e.questName})},vn=function(e){var t=function(e,t){var n=Object(h.f)(),a=Object(p.useMemo)((function(){return dn.a.getSceneController(e,t,n)}),[e,t,n]),r=Object(p.useState)(!1),c=Object(O.a)(r,2),o=c[0],i=c[1],u=n.getState().quests.find((function(t){return t.name===e})).scene;return Object(p.useEffect)((function(){if(t){i(!1);a.loadData((function(){i(!0),u||(a.createScene(),a.sceneEntered())}))}}),[a,e,u,t]),{controller:a,loaded:o}}(e.questName,e.sceneName),n=t.controller,a=t.loaded;return e.scene&&a&&n.mapData?f.a.createElement(mn,Object.assign({},e,{controller:n})):null},hn=(n(252),function(e){var t=(e.className||"")+" itemslist";return p.createElement("ul",{className:t},e.items.map((function(t,n){return p.createElement("li",{key:"".concat(t).concat(n),className:"item"},p.createElement(Pt,{item:t,index:n,sourceId:e.sourceId,sourceType:e.sourceType}),p.createElement("div",{className:"text"},p.createElement("p",{className:"name"},x.a.getItemName(t)),p.createElement("p",{className:"subtext"},x.a.getItemSubtext(t))))})))}),gn=(n(253),function(e){var t=Object(h.d)(),n=zt(e.questName).scene,a=null===n||void 0===n?void 0:n.caches[e.cacheName],r=un(e.adventurerId),c=Object(p.useState)(!1),o=Object(O.a)(c,2),i=o[0],u=o[1],s=Object(it.a)(r),l=Object(p.useRef)(null);if(Object(p.useEffect)((function(){var n;if(i&&a&&l.current){var r,c=a.items[0];if(!c)return void u(!1);null===(r=l.current.querySelector(".itemslist .item"))||void 0===r||r.classList.add("taking"),s>0?n=setTimeout((function(){t(Ft(e.adventurerId,c)),t(Object(rn.i)(e.questName,e.cacheName,c))}),500):u(!1)}return function(){clearInterval(n)}}),[a,s,t,e.adventurerId,e.cacheName,e.questName,i]),!a)return null;return f.a.createElement("div",{className:"loot-cache",ref:l},f.a.createElement("div",{className:"header"},f.a.createElement("div",{className:"title"},x.a.get(a.title)),f.a.createElement("div",{className:"close",onClick:e.onClose})),a.items.length>0&&f.a.createElement("div",{className:"content"},f.a.createElement("div",{className:"items"},f.a.createElement(hn,{items:a.items,sourceType:mt.lootCache,sourceId:e.cacheName})),f.a.createElement("div",{className:"adventurer"},f.a.createElement(bt,{adventurer:r}),f.a.createElement("button",{onClick:function(e){e.stopPropagation(),u(!0)},disabled:0===s},x.a.get("quest-common-loot-cache-take-all")))),!!a.gold&&f.a.createElement("div",{className:"content"},f.a.createElement("div",{className:"gold"},f.a.createElement("div",{className:"icon common-icon-medium",style:{backgroundImage:"url(".concat(".","/img/resources/gold.png)")}}),x.a.get("quest-common-loot-cache-gold",{gold:a.gold})),f.a.createElement("div",{className:"take-gold"},f.a.createElement("button",{onClick:function(n){n.stopPropagation(),t(We(a.gold||0)),t(Object(rn.h)(e.questName,e.cacheName))}},x.a.get("quest-common-loot-cache-take")))))});!function(e){e[e.auto=0]="auto",e[e.vertical=1]="vertical",e[e.horizontal=2]="horizontal"}(ln||(ln={}));var bn,yn=function(e){var t,n=Object(N.g)(),a=e.layout,r=void 0===a?ln.auto:a,c=Object(h.e)((t=e.questName,Object(et.a)([wt,Ot],(function(e,n){var a=n.find((function(e){return e.name===t}));return Object(it.b)(e,a)})))),o=Object(p.useState)(),i=Object(O.a)(o,2),u=i[0],s=i[1],l=c[0],m=Object(p.useState)(null===l||void 0===l?void 0:l.id),d=Object(O.a)(m,2),v=d[0],g=d[1],b=Object(p.useMemo)((function(){return c.find((function(e){return e.id===v}))}),[c,v]),y=function(e){g(e)};return Object(p.useEffect)((function(){c.length||n.push(Object(Q.d)())}),[c.length,n]),c.length?f.a.createElement("div",{className:"quest-panel quest-panel-".concat(ln[r])},f.a.createElement("div",{className:"quest-area"},f.a.createElement(fn,{questName:e.questName,selectedActor:v,onLootCacheChanged:function(e){s(e)},setSelectedActor:y}),u&&f.a.createElement("div",{className:"modal",onClick:function(){return s(void 0)}},f.a.createElement(gn,{questName:e.questName,cacheName:u,adventurerId:v,onClose:function(){return s(void 0)}}))),f.a.createElement("div",{className:"party-area"},f.a.createElement(yt,{adventurers:c,selectedAdventurerId:v,onAdventurerTabSelected:y,disabled:void 0!==u}),f.a.createElement("div",{className:"adventurer-details"},b&&f.a.createElement(Ht,{adventurer:b})))):null},wn=function(){var e=Object(p.useRef)(null),t=Object(N.h)("".concat(Object(Q.d)(),"/:questname")),n=null===t||void 0===t?void 0:t.params.questname,a=Object(N.g)();Object(p.useEffect)((function(){S.c.addMusicTrack(S.a.world,"sound/music/TheLoomingBattle.ogg"),S.c.playMusicTrack(S.a.world)}),[]);return f.a.createElement("div",{className:"world-view",ref:e},f.a.createElement(dt,{selectedQuestName:n,smallMap:null!=n,onPartyClick:function(e){e===n?a.push(Object(Q.d)()):a.push(Object(Q.a)(e)),S.c.playSound(S.b.buttonClick)},retrieveWorldViewRef:function(){return e}}),n&&f.a.createElement(yn,{questName:n}))};n(254);!function(e){e[e.all=0]="all",e[e.town=1]="town",e[e.quest=2]="quest"}(bn||(bn={}));var On,jn,En=function(e){var t=Object(p.useState)(!1),n=Object(O.a)(t,2),a=n[0],r=n[1],c=Object(p.useState)("all"),o=Object(O.a)(c,2),i=o[0],u=o[1],s=Object(h.e)((function(e){return e.log})),l=Object(h.e)((function(e){return st(e)})),m=[{label:x.a.get("ui-log-tab-all"),tabId:"all",tabType:bn.all},{label:x.a.get("ui-log-tab-town"),tabId:"town",tabType:bn.town}];l.forEach((function(e){var t=e.name;m.push({channelContext:t,label:x.a.getQuestTitle(t),tabId:"quest-".concat(t),tabType:bn.quest})}));var d=[],f=m.find((function(e){return e.tabId===i}));switch(f.tabType){case bn.all:d=s;break;case bn.town:d=s.filter((function(e){return e.channel===De.a.town}));break;case bn.quest:d=s.filter((function(e){return e.channel===De.a.quest&&e.channelContext===f.channelContext}))}return p.createElement("div",{className:"log ".concat(a?"expanded":"")},p.createElement("div",{className:"tab-bar"},p.createElement(ht,{className:"tabs",onTabSelected:function(e){u(e)},activeTab:i},m.map((function(e){return p.createElement(gt,{id:e.tabId,key:e.tabId},e.label)}))),p.createElement(Ne,{className:"expand-button",onClick:function(){r(!a)},text:a?"\u25bc":"\u25b2"})),p.createElement("div",{className:"log-entries"},d.map((function(e){return function(e){var t=x.a.get(e.key,e.context);return p.createElement("div",{className:"entry",key:e.time},t)}(e)}))))};function kn(e,t,n,a,r){return{type:On.start,taskType:e,name:t,origin:n,time:a,callbacks:r}}!function(e){e.start="startTask",e.update="updateTasks"}(On||(On={})),function(e){e[e.buildStructure=0]="buildStructure",e[e.craftItem=1]="craftItem"}(jn||(jn={}));var Nn,Tn=function(e){var t=Object(p.useCallback)((function(t){return t.structures[e]}),[e]);return Object(h.e)(t)},In=function(e){var t=e.info,n=Object(h.d)(),a=Ke(),r=Object(F.b)(t.structure),c=r.cost.gold||0<=a,o=!(Tn(t.structure).state===R.NotBuilt)||!c,i=x.a.getItemSubtext(t.item),u=function(e){n(Qe(r.cost.gold||0)),n(function(e){return{type:Z.startBuildingStructure,structure:e}}(e));var t=[Le(e)],a=r.cost.time,c=kn(jn.buildStructure,"".concat(e,".build"),"town",a,t);n(c)};return p.createElement("div",null,i&&p.createElement("p",null,'"',i,'"'),p.createElement("button",{disabled:o,onClick:function(){return u(t.structure)}},"Start construction (",r.cost.gold," gold)"))},Sn=n(84),xn=function(e){var t=e.info,n=x.a.getItemSubtext(t.item);return p.createElement(p.Fragment,null,n&&p.createElement("p",null,'"',n,'"'),p.createElement("p",null," damage: ",t.damage[Sn.a.kinetic]," "))},Cn=function(e){var t=e.info,n=x.a.getItemSubtext(t.item);return p.createElement(p.Fragment,null,n&&p.createElement("p",null,'"',n,'"'),t.armourRating&&p.createElement("p",null," armour: ",t.armourRating," "))},qn=function(e){var t=e.info;switch(t.itemType){case Ae.b.deed:return p.createElement(In,{info:t});case Ae.b.weapon:return p.createElement(xn,{info:t});case Ae.b.apparel:return p.createElement(Cn,{info:t});default:var n=x.a.getItemSubtext(t.item);return n&&p.createElement("p",null,'"',n,'"')||null}},An=(n(255),function(e){var t=e.info,n=Object(h.e)((function(e){return e.structures}));switch(t){case Re.a.fabric:case Re.a.food:case Re.a.iron:case Re.a.leather:case Re.a.stone:case Re.a.wood:return p.createElement(p.Fragment,null,p.createElement("div",{className:"resource-context"},x.a.get("resource-".concat(t,"-info"))),p.createElement("div",null,function(){var e=Object(F.c)(Re.a[t]),a=n[e];if(a.state!==R.Built)return p.createElement("span",null,x.a.get("ui-tooltip-resource-produce-row-notbuilt",{structure:x.a.getStructureName(e)}));var r=Object(F.b)(e).levels[a.level].generates[t],c=x.a.get("ui-tooltip-resource-produce-row",{structure:"%SPLIT%",amount:r}).split("%SPLIT%");return p.createElement("span",{className:"produced"},c[0],p.createElement(k.b,{to:Object(Q.b)(e)},x.a.getStructureName(e)),c[1])}()));default:return p.createElement(p.Fragment,null,p.createElement("div",{className:"resource-context"}," ".concat(x.a.get("resource-".concat(t,"-info")))))}});n(256),n(257);!function(e){e[e.bottom=0]="bottom",e[e.top=1]="top",e[e.left=2]="left",e[e.right=3]="right"}(Nn||(Nn={}));var Dn=function(e){var t=e.children,n=e.referenceRect,a=Object(p.useRef)(null),r=Object(p.useState)(e.placement||Nn.bottom),c=Object(O.a)(r,2),o=c[0],i=c[1],u=Object(p.useState)(),s=Object(O.a)(u,2),l=s[0],m=s[1];Object(p.useEffect)((function(){var e=a.current;if(e&&l){var t=e.getBoundingClientRect();switch(o){case Nn.top:if(t.top-t.height-8-8<l.top)return void i(Nn.bottom);break;case Nn.bottom:if(t.top+t.height+8+8>l.height)return void i(Nn.top)}e.style.opacity="1";var n=e.querySelector(".tooltip-content");if(t.left<l.left+8){var r=l.left-t.left+8;n.style.transform="translateX(".concat(r,"px)")}else if(t.right>l.right-8){var c=t.right-l.right+8;n.style.transform="translateX(".concat(-c,"px)")}else n.style.transform=""}}),[i,l,o,n]);var d=function(){Je.clear()};Object(p.useEffect)((function(){var e,t;return m(null===(e=a.current)||void 0===e||null===(t=e.closest(".app"))||void 0===t?void 0:t.getBoundingClientRect()),window.addEventListener("resize",d),function(){window.removeEventListener("resize",d)}}),[]);var v=0,h=0,g="";if(l)switch(o){case Nn.bottom:v=n.left-l.left+n.width/2,h=n.top-l.top+n.height,g="tooltip-bottom";break;case Nn.top:v=n.left-l.left+n.width/2,h=n.top-l.top,g="tooltip-top"}return f.a.createElement("div",{className:"tooltip ".concat(g),style:{left:v,opacity:0,top:h},ref:a},f.a.createElement("div",{className:"tooltip-arrow"}),f.a.createElement("div",{className:"tooltip-content"},t))},Rn=function(){var e=Object(p.useState)(),t=Object(O.a)(e,2),n=t[0],a=t[1],r=function(e){a(e)};if(Object(p.useEffect)((function(){return Je.addEventListener(Je.EVENT_CONTEXT_UPDATED,r),function(){Je.removeEventListener(Je.EVENT_CONTEXT_UPDATED,r)}}),[]),!n)return null;var c=n.info,o=n.type;return f.a.createElement(Dn,{referenceRect:n.referenceRect},f.a.createElement("div",{className:"context-tooltip"},function(){switch(o){case Ge.resource:var e=x.a.getResourceName(c);return f.a.createElement(f.a.Fragment,null,f.a.createElement("div",{className:"name resource"},e),f.a.createElement(An,{info:c}));case Ge.item:default:var t=x.a.getItemName(c.item);return f.a.createElement(f.a.Fragment,null,f.a.createElement("div",{className:"name item"},t),f.a.createElement(qn,{info:c}))}}()))},Pn=n(60),Mn=n.n(Pn),Ln=(n(258),function(e){var t=e.itemsInInventory,n=(e.className||"")+" itemsbox",a=e.items.reduce((function(e,t){return e[t]||(e[t]=0),e[t]++,e}),{}),r=Object.keys(a).map((function(e){var n=e,r=a[e],c="item";r>(t?t.filter((function(e){return e===n})).length:0)&&(c+=" missing");var o=qe.a[n];return p.createElement("li",{className:c,key:n},p.createElement("div",{className:"icon common-icon-smallest",style:{backgroundImage:"url(".concat(".").concat(o.iconImg,")")}}),p.createElement("div",{className:"name"},"".concat(x.a.getItemName(n)," (").concat(r,")")))}));return p.createElement("ul",{className:n},r)}),_n=Object(h.c)((function(e,t){var n=[],a=Object(o.a)(e.stockpile);return t.items.forEach((function(e){var t=a.findIndex((function(t){return t===e}));if(t>-1){var r=a.splice(t,1),c=Object(O.a)(r,1)[0];c&&n.push(c)}})),{itemsInInventory:n}}))(Ln),Vn=function(e,t){if(t>6)throw new Error("Cannot possibly have more than ".concat(6," on one item!"));return e-.1*e*(t-1)},Fn=n(32),Wn=(n(259),function(e){var t,n,a,r=(t=e.progress||0,n=0,t>(a=1)?a:t<n?n:t);return p.createElement("div",{className:"progressbar"},p.createElement("div",{className:"progressbar-label"},e.label),p.createElement("div",{className:"progressbar-bar",style:{width:"".concat(100*r,"%")}}))});n(260);var Qn=function(e){var t;return t=null==e.max?e.value:p.createElement("span",null,e.value," / ",p.createElement("span",{className:"max"},e.max)),p.createElement("div",{className:"updownvalue"},p.createElement("label",null," ",e.label),t,p.createElement("i",{className:"arrow up"+(e.upDisabled?" disabled":""),onClick:function(t){e.onUp&&!e.upDisabled&&e.onUp(t)}}),p.createElement("i",{className:"arrow down"+(e.downDisabled?" disabled":""),onClick:function(t){e.onDown&&!e.downDisabled&&e.onDown(t)}}))},Bn=(n(261),function(e){return f.a.createElement("div",{className:"structureview-header structureview-header-".concat(e.structure)})}),Un=function(e){var t=e.resources,n=$e(),a=Object(p.useMemo)((function(){return Object.keys(t).reduce((function(e,a){return e[a]=n[a]>=t[a],e}),{})}),[t,n]),r=(e.className||"")+" resourcesbox",c=Object.keys(e.resources).map((function(t){var n="resource";a&&!a[t]&&(n+=" insufficient");var r=Re.b[t];if(!r)throw new Error("No resource description found for ".concat(t));return p.createElement("li",{className:n,key:t},p.createElement("div",{className:"icon",style:{backgroundImage:"url(".concat(".").concat(r.iconImg,")")}}),p.createElement("div",{className:"name"},x.a.getResourceName(t)),p.createElement("div",{className:"amount"},e.resources[t]))}));return p.createElement("ul",{className:r},c)},Gn=(n(262),function(e){var t=Object(p.useState)(),n=Object(O.a)(t,2),a=n[0],r=n[1],c=Object(p.useState)(0),o=Object(O.a)(c,2),i=o[0],u=o[1],s=Object(F.b)(e.type);if(!s)throw new Error("No definition found for structure ".concat(e.type,"\n            with type ProductionStructureDefinition."));var l=e.level||0,m=s.levels[l],d=x.a.getStructureName(e.type);return p.createElement(p.Fragment,null,p.createElement(Bn,{structure:e.type}),p.createElement("details",{open:!0,className:"productionstructureview"},p.createElement("summary",null,d),p.createElement("section",null,function(){var t=e.gold,n=s.levels[l+1],a=null!=n?n.cost.gold||0:-1,r=null!=n&&t>=a,c="Upgrade! (".concat(a<0?"max":a+" gold",")");return p.createElement("div",null,p.createElement("label",null,"level:"),"".concat(l+1," / ").concat(s.levels.length),p.createElement("button",{style:{float:"right"},onClick:function(t){e.onUpgrade&&e.onUpgrade(a,l+1)},disabled:!r},c))}(),p.createElement("div",null,"craft:"),p.createElement("div",{className:"crafting-area"},p.createElement("ul",{className:"vertical-tab-bar"},m.produces.map((function(e){return p.createElement("li",{key:"craft".concat(e.item),onClick:function(t){t.stopPropagation(),r(e.item)},className:a===e.item?"selected":""},p.createElement(Dt,{item:e.item}),x.a.getItemName(e.item))}))),function(){var t=a;if(!t)return null;var n=m.produces.find((function(e){return e.item===t})),r=e.resources||{},c=n.cost.resources,o=Object.keys(c).some((function(e){return c[e]>r[e]})),s=!1,l=n.cost.materials;l&&(s=l.some((function(t){return-1===e.items.indexOf(t)})));var d=o||s||i<1,f=qe.a[t];return p.createElement("div",{className:"crafting-details"},"Craft a ",x.a.getItemName(f.item),p.createElement("div",{className:"crafting-costs"},p.createElement("fieldset",null,p.createElement(Un,{resources:c})),p.createElement("fieldset",null,l&&p.createElement(_n,{items:l}))),p.createElement("div",{style:{display:"flex"}},p.createElement(Qn,{value:i,label:"Workers: ",onUp:function(e){e.stopPropagation(),u(i+1)},onDown:function(e){e.stopPropagation(),u(i-1)},upDisabled:i>=e.workersFree||i>=6,downDisabled:i<1}),"\xa0",function(e){if(0===i)return"";var t=Vn(e,i),n=Object(Fn.e)(t);return" Crafting time: ".concat(n)}(n.cost.time||0)),p.createElement("div",null,p.createElement("button",{disabled:d,onClick:function(t){t.stopPropagation(),e.onCraft&&(e.onCraft(n,i),u(0))}},"Craft")))}()),p.createElement("fieldset",null,p.createElement("legend",null,"Currently crafting:"),(e.tasks||[]).map((function(e){return p.createElement(Wn,{key:"".concat(e.name).concat(e.startTime),label:"".concat(e.name," (").concat(Object(Fn.e)(e.timeRemaining),")"),progress:e.progress})}))))))});var Hn=Object(h.c)((function(e,t){var n=e.structures[t.type],a=e.tasks.running.filter((function(e){return e.origin==="".concat(t.type,".craft")}));return{gold:e.gold,items:e.stockpile,level:n.level,resources:e.resources,tasks:a,workersFree:tt(e)}}),(function(e,t){return{onCraft:function(n,a){var r,c=Vn(n.cost.time||0,a);e((r=n.cost.resources||{},{type:Y.removeResources,resources:r})),e(Ve(t.type,a));var o=[Be(n.item),Fe(t.type,a)],i=kn(jn.craftItem,n.item,"".concat(t.type,".craft"),c,o);e(i)},onUpgrade:function(n,a){e(Qe(n)),e(_e(t.type)),a++,e(Object(b.c)("log-town-upgrade-structure-complete",{level:a,structure:t.type},De.a.town))}}}))(Gn),zn=n(21),Xn=function(){var e=Object(h.d)();return{startUpgradeStructure:function(t,n,a){e(Qe(t)),e(_e(a)),e(Object(b.c)("log-town-upgrade-structure-complete",{level:n,structure:a},De.a.town))}}},Yn=function(e){var t=Object(h.e)((function(e){return e.gold})),n=Object(h.e)((function(t){var n=t.structures[e.type];if(!n)throw new Error("No structure '".concat(e.type,"' found in the store!"));return n.level})),a=Object(h.e)((function(t){var n=t.structures[e.type];if(!n)throw new Error("No structure '".concat(e.type,"' found in the store!"));return n.workers})),r=Object(h.e)((function(e){return tt(e)})),c=Object(F.b)(e.type);if(!c)throw new Error("No definition found for structure ".concat(e.type," with type ResourceStructureDefinition."));var o=Xn().startUpgradeStructure,i=Object(h.d)(),u=function(){i(Fe(e.type))},s=function(){i(Ve(e.type))},l=c.levels[n];return p.createElement(p.Fragment,null,p.createElement(Bn,{structure:e.type}),p.createElement("details",{open:!0,className:"structureview"},p.createElement("section",null,function(){var e=a===l.workerCapacity||(r||0)<1,t=0===a;return p.createElement(Qn,{label:"workers:",value:a,max:l.workerCapacity,upDisabled:e,downDisabled:t,onDown:u,onUp:s})}(),function(){var a=c.levels[n+1],r=null!=a?a.cost.gold||0:-1,i=null!=a&&t>=r,u="Upgrade! (".concat(r<0?"max":r+" gold",")");return p.createElement("div",null,p.createElement("label",null,"level:"),n+1+" / "+c.levels.length,p.createElement("button",{style:{float:"right"},onClick:function(){o(r,n+1,e.type)},disabled:!i},u))}(),function(){var e=l.generates,t=Object.keys(e).reduce((function(t,n){return e[n]&&t.push("".concat(e[n]," x ").concat(a," = ").concat(e[n]*(a||0)," ").concat(n)),t}),[]).join(",");return p.createElement("div",null,"Generates (every minute): ",p.createElement("br",null),t)}())))},Zn=(n(263),{beginDrag:function(e){return{adventurer:e.adventurer,sourceId:e.sourceId,sourceType:mt.adventurerInventory}}});var Jn,Kn=Object(Tt.DragSource)(jt,Zn,(function(e,t){return{connectDragSource:e.dragSource(),isDragging:t.isDragging()}}))((function(e){var t=e.isDragging,n=e.connectDragSource,a="draggable-adventurer-avatar";return e.disabled&&(a+=" disabled"),t&&(a+=" dragging"),n(p.createElement("div",{className:a},p.createElement(bt,e)))})),$n=(n(264),Object(Tt.DropTarget)(jt,{drop:function(e,t){e.onDrop(t.getItem())},canDrop:function(e,t){return!0}},(function(e,t){return{canDrop:t.canDrop(),connectDropTarget:e.dropTarget(),isOver:t.isOver()}}))((function(e){var t=e.isOver,n=e.canDrop,a="droppable-adventurer-slot";return t?a+=" active-drop":n&&(a+=" can-drop"),(0,e.connectDropTarget)(p.createElement("div",{className:a}))}))),ea=(n(265),function(e){return p.createElement("ul",{className:"assign-adventurers"},function(){for(var t=[],n=function(n){var a=void 0,r="";if(!!e.assignedAventurers[n]){var c=e.assignedAventurers[n];a=p.createElement(bt,{adventurer:c,displayName:!1,onClick:function(){return e.onAdventurerClicked(c)}}),r="has-adventurer"}else a=p.createElement($n,{onDrop:function(t){e.onAdventurerDropped(t,n)}});t.push(p.createElement("li",{key:"slot".concat(n),className:r}," ",a," "))},a=0;a<e.availableSlots;a++)n(a);return t}())}),ta=(n(266),function(e){var t=Object(h.e)((function(e){return e.stockpile})),n=function(e){return!e.requiredItems||e.requiredItems.every((function(n){var a=e.requiredItems.filter((function(e){return e===n})).length;return t.filter((function(e){return e===n})).length>=a}))};return p.createElement("div",{className:"quest-board"},p.createElement("h2",null,x.a.get("structure-tavern-title-quest-board")),p.createElement("ul",{className:"quest-list"},e.availableQuests.map((function(t){var n="".concat(".","img/sigils/").concat(t.icon),a="quest ".concat(t.name===e.selectedQuestName?" selected":"");return p.createElement("li",{key:t.name,className:a,onClick:function(){e.onQuestClick(t.name)}},p.createElement("div",{className:"icon",style:{backgroundImage:"url(".concat(".").concat(n,")")}}),p.createElement("div",{className:"title"},x.a.getQuestTitle(t.name)," "))}))),function(){if(!e.selectedQuestName)return null;var t=e.availableQuests.find((function(t){return t.name===e.selectedQuestName}));if(!t)return p.createElement("div",null," ",x.a.get("structure-tavern-quest-launched")," ");var a=Object(lt.b)(t.name),r=e.assignedAventurers.filter((function(e){return null!==e})).length>=3,c=n(a),o=r&&c;return p.createElement("div",{className:"quest-details"},x.a.getQuestDescription(e.selectedQuestName),p.createElement(ea,{availableSlots:5,assignedAventurers:e.assignedAventurers,onAdventurerClicked:e.onRemoveAdventurer,onAdventurerDropped:e.onAdventurerDropped}),p.createElement(_n,{items:a.requiredItems||[]}),p.createElement("button",{disabled:!o,onClick:function(){return e.onLaunchQuest()}},x.a.get("structure-tavern-button-launch-quest")))}())}),na=(n(267),function(e){var t=e.adventurer,n=e.assignedAventurers,a=e.onAddAdventurer,r=e.onRemoveAdventurer;return n.indexOf(t)>-1?p.createElement("button",{onClick:function(){r(t)},className:"adventurer-button"},"Leave"):5===n.filter(Boolean).length?p.createElement("button",{disabled:!0,className:"adventurer-button"},"Party full"):p.createElement("button",{onClick:function(){var e=aa(n);a(t,e)},className:"adventurer-button"},"Join")}),aa=function(e){for(var t=0;t<5;t++)if(!e[t])return t;return 0},ra=function(e){var t=e.adventurer,n=e.onQuest,a=e.assignedAventurers,r=e.expanded,c=e.selectedQuestName,o=e.onClick,i=e.onAddAdventurer,u=e.onRemoveAdventurer,s=a.indexOf(t)>-1;return f.a.createElement(f.a.Fragment,null,f.a.createElement("div",{className:"room ".concat(r?"expanded":"")},f.a.createElement(Kn,{disabled:s||n,adventurer:t,className:"adventurer-icon",sourceId:ia,key:"avatar:".concat(t.id)}),f.a.createElement("span",{key:t.id,onClick:function(){return o(t)}},t.name,n&&" (on a quest)")),r&&f.a.createElement("div",{className:"adventurer-details"},f.a.createElement(Ht,{adventurer:t}),!n&&c&&f.a.createElement(na,{adventurer:t,assignedAventurers:a,onAddAdventurer:i,onRemoveAdventurer:u})))},ca=function(){return f.a.createElement("div",{className:"room"},"(empty room)")},oa=function(e){for(var t=e.roomCount,n=e.adventurers,a=e.assignedAventurers,r=e.selectedQuestName,c=e.onAddAdventurer,o=e.onRemoveAdventurer,i=Object(p.useState)(),u=Object(O.a)(i,2),s=u[0],l=u[1],m=function(e){s===e.id?l(void 0):l(e.id)},d=[],v=function(t){var i=n.find((function(e){return e.room===t}));if(!i)return d.push(f.a.createElement(ca,{key:"room".concat(t)})),"continue";var u,l=(u=i.id,!!Object.values(e.quests).find((function(e){return e.party.indexOf(u)>-1})));d.push(f.a.createElement(ra,{key:i.id,adventurer:i,assignedAventurers:a,selectedQuestName:r,expanded:s===i.id,onQuest:l,onClick:m,onAddAdventurer:c,onRemoveAdventurer:o}))},h=0;h<t;h++)v(h);return f.a.createElement("div",{className:"rooms"},f.a.createElement("h2",null,"Rooms"),d)},ia=(n(268),"tavern"),ua=function(e){var t=Ke(),n=Tn(F.a.tavern).level,a=Object(h.e)((function(e){return e.adventurers})),r=Object(h.e)((function(e){return e.quests})),c=Object(p.useState)([]),i=Object(O.a)(c,2),u=i[0],s=i[1],l=Object(p.useState)(),m=Object(O.a)(l,2),d=m[0],f=m[1],v=Object(F.b)(F.a.tavern),g=v.levels[n],y=x.a.getStructureName(F.a.tavern),w=Object(h.d)(),j=r.filter((function(e){return e.status===ct.available})),E=function(e,t){var n=Object(o.a)(u);n[t]=e,s(n)},k=function(e){var t=u.indexOf(e),n=Object(o.a)(u);delete n[t],s(n)},N=function(){var e,t=x.a.getQuestTitle(d),n=u[0];je.a.addToast(t,Ee.a.questLaunched,null===n||void 0===n?void 0:n.avatarImg,Object(Q.a)(d)),e=d,w(Object(rn.e)(e,u))};return p.createElement("details",{open:!0,className:"tavernstructureview"},p.createElement("summary",null,y),function(){var e=v.levels[n+1],a=null!=e?e.cost.gold||0:-1,r=null!=e&&t>=a,c="Upgrade! (".concat(a<0?"max":a+" gold",")");return p.createElement("div",null,p.createElement("label",null,"level:"),"".concat(n+1," / ").concat(v.levels.length),p.createElement("button",{style:{float:"right"},onClick:function(e){w(Qe(a)),w(_e(F.a.tavern)),w(Object(b.c)("log-town-upgrade-structure-complete",{level:n+1,structure:F.a.tavern},De.a.town))},disabled:!r},c))}(),p.createElement("section",null,p.createElement(oa,{roomCount:g.rooms,adventurers:a,assignedAventurers:u,quests:r,selectedQuestName:d,onAddAdventurer:E,onRemoveAdventurer:k}),p.createElement(ta,{availableQuests:j,selectedQuestName:d,assignedAventurers:u,onQuestClick:function(e){return function(e){f(d===e?void 0:e),s([])}(e)},onAdventurerDropped:function(e,t){e.sourceId===ia&&E(e.adventurer,t)},onRemoveAdventurer:k,onLaunchQuest:function(){return N()}})))},sa=ve((function(e){var t=e.sufficientResources,n=e.resources,a=e.deltaResources,r=Object(h.e)((function(e){return e.structures})),c=(e.className||"")+" resourcesbox",o=Object.keys(n).map((function(n){var c="resource";t&&!t[n]&&(c+=" insufficient");var o,i=Re.b[n],u=e.resources[n];if(!i)throw new Error("No resource description found for ".concat(n));a[n]&&(o=p.createElement("span",{className:"animate-up"},"+ ".concat(a[n].toFixed(2))));var s=Object(F.c)(Re.a[n]);return p.createElement("li",{className:c,key:n},p.createElement("div",{className:"icon common-icon-smallest",style:{backgroundImage:"url(".concat(".").concat(i.iconImg,")")}}),p.createElement("div",{className:"name"},x.a.getResourceName(n)),p.createElement("div",{className:"amount"},u.toFixed(1)),p.createElement("div",{className:"max"}," / ".concat(e.maxResources[n])),p.createElement("div",{className:"delta"},o),p.createElement("div",{className:"structure"},"source:",r[s].state===R.Built?p.createElement(k.b,{to:Object(Q.b)(s),onClick:function(){e.onCloseWindow()}},x.a.getStructureName(s)):x.a.getStructureName(s)))}));return p.createElement("ul",{className:c},o)})),la=function(e){var t=Object(p.useRef)();return Object(p.useEffect)((function(){t.current=e})),t.current},ma={fabric:0,food:0,iron:10,leather:0,stone:0,wood:10},da={fabric:0,food:0,iron:0,leather:0,stone:0,wood:0},pa=(n(269),function(){var e=Object(h.e)((function(e){return e.adventurers})),t=Object(h.e)((function(e){return e.quests}));return Object(p.useMemo)((function(){return function(e,t){var n=t.reduce((function(e,t){return t.status===ct.active&&e.push.apply(e,Object(o.a)(t.party)),e}),[]);return e.filter((function(e){return-1===n.indexOf(e.id)}))}(e,t)}),[e,t])}),fa=(n(270),function(e){var t=un(e.adventurerId),n=Object.keys(t.stats).map((function(e){var n=t.stats[e];return p.createElement("div",{key:"".concat(t.id,"-").concat(e)}," ",p.createElement("b",null,e),": ",n.toFixed(1)," ")})),a=Gt(),r=a.dropItemEquipment,c=a.dropItemInventory,o=function(e){var n=t.equipment[kt[e]],a=null;if(n){var c=p.createRef();a=p.createElement(Pt,{index:e,sourceId:t.id,sourceType:mt.adventurerEquipment,item:n,onClick:function(e){var t=e.currentTarget.getBoundingClientRect();Je.showContextTooltip(Ge.item,Object(qe.b)(n),t),e.stopPropagation()},ref:c,size:St.medium})}return p.createElement(p.Fragment,null,p.createElement(Ct,{onDrop:function(n){return function(e,n){r(e,n,t)}(n,e)},type:e},a),p.createElement("span",{className:"info"},x.a.get("ui-equipmentslot-".concat(kt[e]))))},i=p.createElement("ul",null,p.createElement("li",null,o(kt.head)),p.createElement("li",null,o(kt.shoulders)),p.createElement("li",null,o(kt.chest)),p.createElement("li",null,o(kt.hands)),p.createElement("li",null,o(kt.legs)),p.createElement("li",null,o(kt.feet)),p.createElement("li",null,o(kt.mainHand)),p.createElement("li",null,o(kt.offHand)));return p.createElement("div",{className:"adventurer-info"},p.createElement("div",{className:"left"},p.createElement("div",{className:"name"},p.createElement("b",null,t.name)),p.createElement("div",{className:"attributes"},n),p.createElement("div",{className:"equipment"},i)),p.createElement("div",{className:"right"},p.createElement(Vt,{sourceType:mt.adventurerInventory,sourceId:t.id,items:t.inventory,onDropItem:function(e,n,a,r,o){c(e,n,a,r,t,o)}})))}),va=mt.warehouse,ha=function(e){var t=Object(p.useState)(),n=Object(O.a)(t,2),a=n[0],r=n[1],c=$e(),o=Object(p.useState)(da),i=Object(O.a)(o,2),u=i[0],s=i[1],l=la(c),m=Object(p.useRef)(null),d=Ke(),f=Ut(),v=Object(h.e)((function(e){return e.structures})),g=Xn().startUpgradeStructure,b=pa(),y=Gt().dropItemWarehouse;Object(p.useEffect)((function(){var e=Object.keys(c).reduce((function(e,t){return l&&l[t]&&(e[t]=c[t]-l[t]),e}),{});s(e)}),[c,l]),Object(p.useEffect)((function(){if(m.current){var e=m.current;e.classList.remove("animate"),setTimeout((function(){m&&e.classList.add("animate")}),200)}}),[u]);var w=Object(F.b)(F.a.warehouse);if(!w)throw new Error("No definition found for structure ".concat(F.a.warehouse," with type StructureDefinition."));var j=Tn(F.a.warehouse),E=w.levels[j.level],k=j.level,N=x.a.getStructureName(F.a.warehouse);return p.createElement("details",{open:!0,className:"warehouse-structureview"},p.createElement("summary",null,N),function(){var e=w.levels[k+1],t=null!=e?e.cost.gold||0:-1,n=null!=e&&d>=t,a="Upgrade! (".concat(t<0?"max":t+" gold",")");return p.createElement("div",null,p.createElement("label",null,"level:"),k+1+" / "+w.levels.length,p.createElement("button",{style:{float:"right"},onClick:function(e){g(t,k+1,F.a.warehouse)},disabled:!n},a))}(),p.createElement("fieldset",{className:"resources",ref:m},p.createElement("legend",null,"Resources"),p.createElement(sa,{resources:c,structures:v,maxResources:E.maxResources,deltaResources:u})),p.createElement("h3",null,"Stockpile"),p.createElement(Vt,{sourceType:va,items:f,onDropItem:function(e,t,n,a,r){y(e,t,n,a,r)}}),p.createElement("h3",null,"Adventurers"),p.createElement("div",null,p.createElement(yt,{adventurers:b,selectedAdventurerId:a,onAdventurerTabSelected:function(e){r(e)}}),p.createElement("div",{className:"adventurer-inventory"},a?p.createElement(fa,{adventurerId:a}):null)))},ga=(n(271),Ie((function(e){var t=Object(h.e)((function(e){return e.tasks})).running.filter((function(t){return"town"===t.origin&&t.name==="".concat(e.structure,".build")}))[0],n=Tn(e.structure);return p.createElement("div",{className:"structure-details"},function(){if(n.state===R.Building)return t?p.createElement("div",{className:"building"},p.createElement(Wn,{progress:t.progress,label:"Building... (".concat(Object(Fn.e)(t.timeRemaining),")")})):null;switch(Object(F.b)(e.structure).type){case zn.a.production:return p.createElement(Hn,{type:e.structure});case zn.a.resource:return p.createElement(Yn,{type:e.structure});case zn.a.warehouse:return p.createElement(ha,null);case zn.a.tavern:return p.createElement(ua,null);default:return p.createElement("div",null," ",e.structure," ")}}())}))),ba=(n(272),function(){Object(p.useRef)();var e=Object(p.useRef)(new ae.Filter("",wa,ya));return Object(p.useEffect)((function(){requestAnimationFrame((function t(n){e.current.uniforms.time=(n||0)/1e3,requestAnimationFrame(t)}))}),[]),p.createElement(V.Stage,{width:window.innerWidth,height:window.innerHeight,className:"background"},p.createElement(V.Sprite,{image:"https://s3-us-west-2.amazonaws.com/s.cdpn.io/167451/test_BG.jpg",width:window.innerWidth,height:window.innerHeight}))}),ya={resolution:{type:"2f",value:{x:window.innerWidth,y:window.innerHeight}},alpha:{type:"1f",value:1},shift:{type:"1f",value:1.6},time:{type:"1f",value:0},speed:{type:"2f",value:{x:.7,y:.4}}},wa="\n    precision mediump float;\n    uniform vec2      resolution;\n    uniform float     time;\n    uniform float     alpha;\n    uniform vec2      speed;\n    uniform float     shift;\n\n    float rand(vec2 n) {\n        return fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\n    }\n\n    float noise(vec2 n) {\n    const vec2 d = vec2(0.0, 1.0);\n    vec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\n        return mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\n    }\n\n    float fbm(vec2 n) {\n    float total = 0.0, amplitude = 1.0;\n    for (int i = 0; i < 4; i++) {\n        total += noise(n) * amplitude;\n        n += n;\n        amplitude *= 0.5;\n    }\n\n    return total;\n    }\n\n    void main() {\n    const vec3 c1 = vec3(126.0/255.0, 0.0/255.0, 97.0/255.0);\n    const vec3 c2 = vec3(173.0/255.0, 0.0/255.0, 161.4/255.0);\n    const vec3 c3 = vec3(0.2, 0.0, 0.0);\n    const vec3 c4 = vec3(164.0/255.0, 1.0/255.0, 214.4/255.0);\n    const vec3 c5 = vec3(0.1);\n    const vec3 c6 = vec3(0.9);\n\n    vec2 p = gl_FragCoord.xy * 8.0 / resolution.xx;\n    float q = fbm(p - time * 0.1);\n    vec2 r = vec2(fbm(p + q + time * speed.x - p.x - p.y), fbm(p + q - time * speed.y));\n    vec3 c = mix(c1, c2, fbm(p + r)) + mix(c3, c4, r.x) - mix(c5, c6, r.y);\n    float grad = gl_FragCoord.y / resolution.y;\n    gl_FragColor = vec4(c * cos(shift * gl_FragCoord.y / resolution.y), 1.0);\n    gl_FragColor.xyz *= 1.0-grad;\n    }\n",Oa=["sound/fx/button-click.ogg","sound/fx/error.ogg","sound/fx/toast.ogg","sound/music/Soliloquy.mp3","sound/music/TheLoomingBattle.ogg"];n(273);T.a.registerPIXI(PIXI),I.b.registerPlugin(T.a),function(e){e[e.Town=0]="Town",e[e.World=1]="World"}(Jn||(Jn={}));var ja=960,Ea=Object(p.createContext)(null),ka=function(e){var t=Object(p.useRef)(null),n=Object(p.useState)([]),a=Object(O.a)(n,2),r=a[0],c=a[1],i=Object(p.useState)([]),u=Object(O.a)(i,2),s=u[0],l=u[1],m=function(){S.c.playSound(S.b.buttonClick)},d=function(e){if(e){var t=x.a.getStructureName(e);f(p.createElement(ga,{structure:e,title:t})),S.c.playSound(S.b.buttonClick)}},f=function(e){l([].concat(Object(o.a)(s||[]),[e]))},v=function(){l([])},h=function(){s&&s.length&&l(s.slice(0,-1))};return Object(p.useEffect)((function(){var e=q()((function(){Je.clear()}),100);return window.addEventListener("scroll",e),window.addEventListener("wheel",e),function(){window.removeEventListener("resize",e),window.removeEventListener("wheel",e)}}),[]),p.createElement(Ea.Provider,{value:{media:r,onOpenWindow:f,onCloseWindow:v}},p.createElement(ba,null),p.createElement("div",{className:"app",ref:t,style:{maxWidth:ja},onClick:function(){Je.clear()}},p.createElement(j.a,{backend:E.a},p.createElement(k.a,null,p.createElement(_,{manifest:Oa,onLoadComplete:function(e){var t,n=e.filter((function(e){return e.mediaType===g.sound}));S.c.loadMedia(n),S.c.addSounds((t={},Object(w.a)(t,S.b.buttonClick,"sound/fx/button-click.ogg"),Object(w.a)(t,S.b.error,"sound/fx/error.ogg"),Object(w.a)(t,S.b.toast,"sound/fx/toast.ogg"),t)),c(e)}},p.createElement(at,null),p.createElement("div",null,p.createElement(N.d,null,p.createElement(N.b,{path:"/",exact:!0},p.createElement(N.a,{from:"/",to:Object(Q.d)()})),p.createElement(N.b,{path:Object(Q.d)()},p.createElement(k.b,{to:Object(Q.c)()},p.createElement("button",{onClick:function(){return m()}}," ",x.a.get("ui-view-button-town")," "))),p.createElement(N.b,{path:Object(Q.c)()},p.createElement(k.b,{to:Object(Q.d)()},p.createElement("button",{onClick:function(){return m()}}," ",x.a.get("ui-view-button-world")," "))))," | ",p.createElement("button",{onClick:function(){return e.persistor.purge(),Mn.a.clear(),void window.location.reload()},style:{color:"red"}}," Restart! ")),p.createElement(N.d,null,p.createElement(N.b,{path:Object(Q.c)(),render:function(){return p.createElement(ye,{onStructureClick:d})}}),p.createElement(N.b,{path:Object(Q.d)(),render:function(){return p.createElement(wn,null)}})),p.createElement(En,null),function(){if(!s.length)return null;var e=s[s.length-1],t={onClose:v,onBack:h,backEnabled:s.length>1,closeEnabled:!0};return p.cloneElement(e,t)}(),p.createElement(Rn,null),p.createElement(ke,null))))))};var Na,Ta=Object(h.c)((function(e,t){return{}}),(function(e,t){return{}}))(ka),Ia=function(e){var t=Object(F.b)(F.a.warehouse),n=e.structures[F.a.warehouse].level;return t.levels[n].maxResources},Sa=function(e,t){var n=t.structures,a={},r=(Date.now()-e)/2e4,c=Ia(t);return r<1?null:(Object.keys(n).forEach((function(e){return function(e){var t=Object(F.b)(e);if(t.type===zn.a.resource){var c=t,o=n[e].level,i=c.levels[o];Object.keys(i.generates).reduce((function(t,a){var c=i.generates[a]*n[e].workers*r;return t[a]=(t[a]||0)+c,t}),a)}}(e)})),Object.keys(a).forEach((function(e){a[e]&&t.resources[e]+a[e]>=c[e]&&(a[e]=c[e]-t.resources[e])})),a)},xa=function(e,t){var n=[],a=[],r=t.getState();return r.quests.forEach((function(c){if(c.status===ct.active){var o=lt.a[c.name],i=c.progress,u=Math.floor(i);if(o.nodes[u].type===rt.a.nothing){for(var s=e/6e4*4,l=Math.min(i+s,o.nodes.length-1),m=Math.floor(l)-u,d=1;d<=m;d++){var p=o.nodes[u+d];if(p.type===rt.a.encounter){t.dispatch(Object(rn.g)(c.name,p.startScene));var f=x.a.getQuestTitle(c.name),v=Object(it.c)(r.adventurers,c);je.a.addToast(f,Ee.a.questEncounter,null===v||void 0===v?void 0:v.avatarImg,Object(Q.a)(c.name)),p.log&&n.push({channel:De.a.quest,channelContext:c.name,key:p.log});break}p.type===rt.a.nothing&&p.log&&n.push({channel:De.a.quest,channelContext:c.name,key:p.log})}a.push({name:c.name,progress:l})}}})),{logUpdates:n,questUpdates:a}},Ca=n(156),qa=n.n(Ca);var Aa=!1,Da=function(){return Aa?(Aa=!1,Na.state()):null},Ra=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function Pa(){if("serviceWorker"in navigator){if(new URL(".",window.location.toString()).origin!==window.location.origin)return;window.addEventListener("load",(function(){var e="".concat(".","/service-worker.js");Ra?(!function(e){fetch(e).then((function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):Ma(e)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")}))):Ma(e)}))}}function Ma(e){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var t=e.installing;t&&(t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}var La,_a=function(){return{strength:100*Math.random(),perception:100*Math.random(),endurance:100*Math.random(),charisma:100*Math.random(),intelligenge:100*Math.random(),agility:100*Math.random(),luck:100*Math.random()}},Va=[{id:"c4a5d270",equipment:{chest:Ae.a.chest,head:Ae.a.cowl},stats:_a(),health:100*Math.random(),room:0,name:"Ximena Maddox",avatarImg:"".concat("img/avatars","/female/f_14.png"),inventory:[Ae.a.deedForLumbermill,null,Ae.a.crossbow,Ae.a.dagger,Ae.a.khopesh,null,Ae.a.sword,null,null,null,null,null,null,null,null,null]},{id:"2e655832",equipment:{},stats:_a(),name:"Donte Houston",health:100*Math.random(),room:1,avatarImg:"".concat("img/avatars","/male/m_05.png"),inventory:[Ae.a.crossbow,null,null,null,null,Ae.a.boots1,Ae.a.chainmailHood,Ae.a.nomadHelmet,Ae.a.plateChest4,null,null,null,null,null,null,null,null,null,null,null,null,null,Ae.a.plateHelmet,Ae.a.cowl]},{id:"ec6f1050",equipment:{},stats:_a(),name:"Zackary Morris",health:100*Math.random(),room:2,avatarImg:"".concat("img/avatars","/male/m_09.png"),inventory:[Ae.a.greatswordOfGwai,null,null,null]},{id:"d299f98a",stats:_a(),equipment:{},name:"Mike Keith",health:100*Math.random(),room:4,avatarImg:"".concat("img/avatars","/male/m_19.png"),inventory:[null,null,null,null,Ae.a.khopesh,Ae.a.hornedHelmet]},{id:"96c686c3",equipment:{},stats:_a(),name:"Wayne Monroe",health:100*Math.random(),room:5,avatarImg:"".concat("img/avatars","/male/m_08.png"),inventory:[null,null,null]},{id:"250d1a9d",stats:_a(),equipment:{},name:"Alexis Ortiz ",health:100*Math.random(),room:9,avatarImg:"".concat("img/avatars","/female/f_10.png"),inventory:[null,null,null,null,null]},{id:"169384ef",equipment:{},stats:_a(),name:"Karlee Nolan",health:100*Math.random(),room:3,avatarImg:"".concat("img/avatars","/female/f_16.png"),inventory:[Ae.a.greatswordOfGwai,null,null,null]},{id:"f22d66cb",stats:_a(),equipment:{},name:"Gylbarde the Earnest",health:100*Math.random(),room:8,avatarImg:"".concat("img/avatars","/male/m_09.png"),inventory:[null,null,null,null,null]},{id:"36c686c1",equipment:{},stats:_a(),name:"Lanslet of the Water",health:100*Math.random(),room:6,avatarImg:"".concat("img/avatars","/male/m_26.png"),inventory:[Ae.a.greatswordOfGwai,null,null,null,Ae.a.shoulders1,Ae.a.fedora,Ae.a.greaves2]},{id:"12c613d4",equipment:{},stats:_a(),name:"Tedric the Bold",health:100*Math.random(),room:7,avatarImg:"".concat("img/avatars","/male/m_33.png"),inventory:[Ae.a.greatswordOfGwai,null,null,null]}],Fa={lastTick:Date.now(),lastProducedUpdate:Date.now()},Wa=[null,null,null,Ae.a.dagger,Ae.a.deedForWeaponsmith,null,Ae.a.sandwich,Ae.a.sandwich,null,null,Ae.a.torch,Ae.a.torch,null,Ae.a.torch],Qa=function(e,t){if(!t.log.length)return e;var n=t.log.map((function(e){return Object(Ce.a)({},e,{time:Date.now()})}));return[].concat(Object(o.a)(n),Object(o.a)(e))},Ba=n(86),Ua=[{name:"kill10Boars",status:ct.active,party:["c4a5d270","2e655832","ec6f1050","d299f98a"],progress:0,questVars:Ba.a,encounterResults:[],icon:"sigil1.png"},{name:"retrieveMagicAmulet",party:[],status:ct.available,progress:0,questVars:{},encounterResults:[],icon:"sigil2.png",reward:{gold:4,items:[Ae.a.deedForWeaponsmith]}}],Ga=function(e,t){var n=t.assignedAventurers.filter((function(e){return!!e})).map((function(e){return e.id}));return e.map((function(e){if(e.name===t.questName){var a=Object(lt.b)(t.questName).getInitialQuestVars(e);return Object(Ce.a)({},e,{status:ct.active,party:n,questVars:a})}return e}))},Ha=function(e,t){return e.map((function(e){if(e.name===t.questName){var n=e.progress+1;return Object(Ce.a)({},e,{progress:n,scene:void 0,sceneName:void 0})}return e}))},za=function(e,t){return e.map((function(e){return e.name===t.questName?Object(Ce.a)({},e,{sceneName:t.sceneName}):e}))},Xa=function(e,t){return e.map((function(e){return e.name===t.questName?Object(Ce.a)({},e,{scene:t.scene}):e}))},Ya=function(e,t){return e.map((function(e){if(e.name===t.questName){var n=e.scene;if(!n)throw new Error("Something broke. No scene");return n.actionQueue=[].concat(Object(o.a)(n.actionQueue||[]),[t.sceneAction]),Object(Ce.a)({},e,{scene:n})}return e}))},Za=function(e,t){return e.map((function(e){if(e.name===t.questName){var n=e.scene;if(!n)throw new Error("Something broke. No scene");var a=n.actionQueue[0];if(!a)return e;switch(a.actionType){case Zt.move:n.actors=n.actors.map((function(e){return e.name===a.actor?Object(Ce.a)({},e,{location:a.target}):e}))}return n.actionQueue=Object(o.a)(n.actionQueue.slice(1)),Object(Ce.a)({},e,{scene:n})}return e}))},Ja=function(e,t){return e.map((function(e){if(e.name===t.questName){var n=e.scene;if(!n)throw new Error("Something broke. No scene");return n.tileObjects=n.tileObjects.map((function(e){return e.id===t.id?Object(Ce.a)({},e,{},t.object):e})),Object(Ce.a)({},e,{scene:n})}return e}))},Ka=function(e,t){var n=t.quests;return n.length?e.map((function(e){var t=n.find((function(t){return t.name===e.name}));if(t){var a=t.progress;return Object(Ce.a)({},e,{progress:a})}return e})):e},$a=function(e,t){return e.map((function(e){if(e.name===t.questName){var n=Object.assign({},e.questVars,t.vars);return Object(Ce.a)({},e,{questVars:n})}return e}))},er=function(e,t){return e.map((function(e){if(e.name===t.questName){var n=e.encounterResults.concat();return n[t.nodeIndex]=t.result,Object(Ce.a)({},e,{encounterResults:n})}return e}))},tr=function(e,t){return e.map((function(e){if(e.name===t.questName&&e.scene){var n,a,r=Object(Ce.a)({},null===(n=e.scene)||void 0===n?void 0:n.caches,Object(w.a)({},t.cacheName,Object(Ce.a)({},null===(a=e.scene)||void 0===a?void 0:a.caches[t.cacheName],{gold:0})));e.scene.caches=r}return e}))},nr=function(e,t){return e.map((function(e){if(e.name===t.questName&&e.scene){var n=e.scene.caches[t.cacheName],a=n.items.indexOf(t.item);a>-1&&(e.scene.caches[t.cacheName].items=[].concat(Object(o.a)(n.items.slice(0,a)),Object(o.a)(n.items.slice(a+1))))}return e}))},ar=(La={},Object(w.a)(La,F.a.alchemist,{level:0,workers:1,state:R.NotBuilt}),Object(w.a)(La,F.a.armoursmith,ee),Object(w.a)(La,F.a.garden,{level:0,workers:0,state:R.Built}),Object(w.a)(La,F.a.lumberMill,ee),Object(w.a)(La,F.a.mine,{level:0,workers:0,state:R.NotBuilt}),Object(w.a)(La,F.a.quarry,ee),Object(w.a)(La,F.a.tavern,{level:0,workers:0,state:R.Built}),Object(w.a)(La,F.a.tannery,ee),Object(w.a)(La,F.a.warehouse,{level:0,workers:0,state:R.Built}),Object(w.a)(La,F.a.weaponsmith,{level:0,workers:0,state:R.Built}),Object(w.a)(La,F.a.weaver,ee),Object(w.a)(La,F.a.workshop,ee),La),rr=function(e,t,n){var a=Object(Ce.a)({},e[t],{state:n});return Object(Ce.a)({},e,Object(w.a)({},t,a))},cr={completed:[],running:[]},or=function(e){return{name:e.name,origin:e.origin,type:e.taskType,callbacks:e.callbacks,timeRemaining:e.time,startTime:Date.now(),lastTick:Date.now(),progress:0}},ir=Object(Se.b)({adventurers:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Va,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Rt.moveItemInInventory:var n=t,a=n.adventurerId,r=n.fromSlot,c=n.toSlot,o=e.find((function(e){return e.id===a})),i=o.inventory.map((function(e,t){return t===r?o.inventory[c]:t===c?o.inventory[r]:e}));return e.map((function(e){return e===o?Object(Ce.a)({},e,{inventory:i}):e}));case Rt.moveItemToOtherAdventurer:var u=t,s=u.adventurerId,l=u.fromSlot,m=u.toAdventurerId,d=e.find((function(e){return e.id===s})),p=d.inventory[l];return e.map((function(e){if(e.id===s){var t=e.inventory.concat();return t[l]=null,Object(Ce.a)({},e,{inventory:t})}if(e.id===m){var n=e.inventory.concat(),a=n.findIndex((function(e){return null===e}));return n[a]=p,Object(Ce.a)({},e,{inventory:n})}return e}));case Rt.addItemToInventory:var f=t,v=f.item;return e.map((function(e){if(e.id===t.adventurerId){var n=e.inventory.concat(),a=t.toSlot;return null!==a&&void 0!==a||(a=n.findIndex((function(e){return null===e||void 0===e}))),n[a]=v,Object(Ce.a)({},e,{inventory:n})}return e}));case Rt.removeItemFromInventory:var h=t,g=h.fromSlot;return e.map((function(e){if(e.id===t.adventurerId){var n=e.inventory.map((function(e,t){return t!==g?e:null}));return Object(Ce.a)({},e,{inventory:n})}return e}));case Rt.assignEquipment:var b=t,y=b.equipmentSlot,O=b.item;return e.map((function(e){return e.id===t.adventurerId?Object(Ce.a)({},e,{equipment:Object(Ce.a)({},e.equipment,Object(w.a)({},kt[y],O))}):e}));case Rt.removeEquipment:var j=t,E=j.equipmentSlot;return e.map((function(e){return e.id===t.adventurerId?Object(Ce.a)({},e,{equipment:Object(Ce.a)({},e.equipment,Object(w.a)({},kt[E],null))}):e}))}return e},combat:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case a.startCombatAction:var n=t;return Object(Ce.a)({},e,{action:{actor:n.actor,endsAt:n.endsAt,target:n.target,type:n.combatType}});case a.moveActor:var r=t,c=e.actors.map((function(e){return e.name===r.actor?Object(Ce.a)({},e,{location:r.location}):e}));return Object(Ce.a)({},e,{actors:c});case a.clearCombatAction:return Object(Ce.a)({},e,{action:void 0})}return e},engine:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Fa,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case l.gameTick:var n=t.resources,a=null===n?e.lastProducedUpdate:Date.now();return Object(Ce.a)({},e,{lastProducedUpdate:a,lastTick:Date.now()})}return e},gold:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case J.addGold:return e+t.amount}return e},stockpile:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Wa,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case K.addItem:var n=t,a=n.item,r=t,c=r.toSlot;return void 0===c&&-1===(c=e.findIndex((function(e){return null===e})))?[].concat(Object(o.a)(e),[a]):e.map((function(e,t){return t===c?a:e}));case K.moveItemInWarehouse:var i=t,u=i.fromSlot,s=i.toSlot;return e.map((function(t,n){return n===u?e[s]:n===s?e[u]:t}));case K.removeItem:var l=t,m=l.fromSlot;return e.map((function(e,t){return t!==m?e:null}))}return e},log:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case b.a.addLogEntry:var n=t,a=n.entry,r=n.channel,c=n.channelContext,i=a.key,u=a.context,s=Date.now();return[{channel:r,channelContext:c,context:u,key:i,time:s}].concat(Object(o.a)(e));case l.gameTick:return Qa(e,t)}return e},quests:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ua,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case rn.a.launchQuest:return Ga(e,t);case rn.a.exitEncounter:return Ha(e,t);case rn.a.updateQuestVars:return $a(e,t);case rn.a.updateEncounterResult:return er(e,t);case rn.a.setSceneName:return za(e,t);case rn.a.setScene:return Xa(e,t);case rn.a.enqueueSceneAction:return Ya(e,t);case rn.a.completeSceneAction:return Za(e,t);case rn.a.updateSceneObjectAction:return Ja(e,t);case rn.a.takeGoldFromCache:return tr(e,t);case rn.a.takeItemFromCache:return nr(e,t);case l.gameTick:return Ka(e,t)}return e},resources:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ma,t=arguments.length>1?arguments[1]:void 0,n=function(t){return Object.keys(e).reduce((function(n,a){return n[a]=e[a]+(t[a]||0),n}),{})};switch(t.type){case Y.addResources:var a=t.resources;return n(a);case Y.removeResources:var r=t.resources;return Object.keys(e).reduce((function(t,n){return t[n]=e[n]-(r[n]||0),t}),{});case l.gameTick:var c=t.resources;return null===c?e:n(c)}return e},rngState:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;return t.type===l.gameTick&&null!=t.rngState&&(e=Object.assign({},t.rngState)),e},structures:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ar,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Z.startBuildingStructure:return rr(e,t.structure,R.Building);case Z.finishBuildingStructure:return rr(e,t.structure,R.Built);case Z.upgradeStructure:var n=e[t.structure].level+1,a=Object(Ce.a)({},e[t.structure],{level:n});return Object(Ce.a)({},e,Object(w.a)({},t.structure,a));case Z.increaseWorkers:var r=t,c=r.workers,o=e[t.structure].workers+c,i=Object(Ce.a)({},e[t.structure],{workers:o});return Object(Ce.a)({},e,Object(w.a)({},t.structure,i));case Z.decreaseWorkers:var u=t,s=u.workers,l=e[t.structure].workers-s,m=Object(Ce.a)({},e[t.structure],{workers:l});return Object(Ce.a)({},e,Object(w.a)({},t.structure,m));case Z.setStructureState:var d=t,p=d.state;return rr(e,t.structure,p)}return e},tasks:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:cr,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case On.start:var n=or(t),a=e.running.concat(n);return Object(Ce.a)({},e,{running:a});case l.gameTick:var r=Date.now(),c=[],o=[];return e.running.forEach((function(e){var t=r+e.timeRemaining,n=(r-e.startTime)/(t-e.startTime),a=e.timeRemaining-(r-e.lastTick),i=Object(Ce.a)({},e,{progress:n,lastTick:r,timeRemaining:a});a<0?o.push(i):c.push(i)})),{running:c,completed:o}}return e},workers:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:13,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case $.addWorkers:return e+t.value}return e}}),ur=n(108),sr={key:"root",storage:Mn.a,version:y},lr=Object(ur.a)(sr,ir),mr=Object(s.a)(u.a.mark((function e(){var t,n=arguments;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},e.abrupt("return",new Promise((function(e,n){var a=Object(Se.d)(lr,t,window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__()),r=Object(ur.b)(a,void 0,(function(){var t=Object(it.d)(a.getState());e({store:a,persistor:r,isHydrated:t})}))})));case 2:case"end":return e.stop()}}),e)}))),dr=function(e,t){e.completed.forEach((function(e){return function(e){switch(e.callbacks.forEach((function(e){return t(e)})),e.type){case jn.craftItem:var n=e.name,a=x.a.get("common-item-crafted",{item:n}),r=Object(qe.b)(n);je.a.addToast(a,Ee.a.itemCrafted,r.iconImg)}}(e)}))},pr=(n(282),function(){var e=Object(s.a)(u.a.mark((function e(){var t,n,a,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(oe.c)("".concat(".","/lang/en-US.json"));case 2:return t=e.sent,x.a.init(t.data),c="GILLESROX2",Aa=!0,Na=qa()(c,{state:!0}),e.next=7,mr();case 7:n=e.sent,a=n.store,r=n.persistor,n.isHydrated?vr(a):fr(a),hr(a,r);case 13:case"end":return e.stop()}var c}),e)})));return function(){return e.apply(this,arguments)}}()),fr=function(e){e.dispatch(Object(b.c)("test-game-welcome")),console.log("Starting new GILLES-IDLE-GAME (version ".concat("0.0.5",")"))},vr=function(e){console.log("Continuing existing GILLES-IDLE-GAME (version ".concat("0.0.5",")"))},hr=function(e,t){v.render(p.createElement(h.a,{store:e},p.createElement(Ta,{persistor:t})),document.getElementById("root")),Pa();setInterval((function(){var t=e.getState(),n=Date.now()-t.engine.lastTick,a=[],r=Sa(t.engine.lastProducedUpdate,t),c=Da();d(n,e);var i=xa(n,e),u=i.questUpdates,s=i.logUpdates;a.push.apply(a,Object(o.a)(s)),e.dispatch(function(e,t,n,a,r){return{type:l.gameTick,delta:e,rngState:t,resources:n,quests:a,log:r}}(n,c,r,u,a)),dr(t.tasks,e.dispatch)}),2500)};pr()},function(e,t,n){"use strict";n.r(t),n.d(t,"DungeonEntranceSceneController",(function(){return I})),n.d(t,"DungeonHallwaySceneController",(function(){return S}));var a=n(18),r=n(19),c=n(55),o=n(79),i=n(29),u=n(30),s=n(15),l=n(89),m=function(e){if(e)return e.reduce((function(e,t){return e[t.name]=t.value,e}),{})},d=function(e,t){return e[0]===t[0]&&e[1]===t[1]},p=n(44),f=n(53),v=n(155),h=n(24),g=n(33),b=n(37),y=n(23);var w=n(9),O=n(36),j=n(42),E=n(28),k=n(1),N=function(){function e(t,n){Object(a.a)(this,e),this.mapData=void 0,this.aStar=void 0,this.questName=void 0,this.tilemapObjects=void 0,this.jsonPath=void 0,this.store=void 0,this.blockedTiles=[],this.store=t,this.questName=n}return Object(r.a)(e,[{key:"loadData",value:function(e){var t=this;if(this.dataLoaded)return e();if(!this.jsonPath)throw new Error("No jsonPath defined!");Object(f.b)("".concat(".","/").concat(this.jsonPath),(function(n){t.mapData=n.data,t.tilemapObjects=function(e){var t=e.layers.filter((function(e){return e.type===l.a.objectgroup})),n={};return t.forEach((function(t){t.objects.reduce((function(t,n){var a=n.x,r=n.y;void 0!==n.gid&&(r-=n.height);var c=[a/e.tilewidth,r/e.tileheight],o=m(n.properties),i=Object(s.a)({location:c,ezProps:o},n);return t["".concat(c[0],",").concat(c[1])]=i,t}),n)})),n}(n.data),t.mapData.layers.filter((function(e){return e.visible})).forEach((function(e){e.properties&&e.properties.some((function(e){return"blocksMovement"===e.name&&!0===e.value}))&&function(e,t,n){t.data.reduce((function(e,t,a){if(t>0){var r=a%n,c=Math.floor(a/n);e.push([r,c])}return e}),e)}(t.blockedTiles,e,e.width)})),t.aStar=t.createAStar(),e()}))}},{key:"createScene",value:function(){var e={tileObjects:this.createTileObjects(),actors:this.createActors(),caches:this.createCaches()};this.store.dispatch(Object(h.f)(this.questName,e))}},{key:"sceneEntered",value:function(){}},{key:"actorMoved",value:function(e,t){var n,a=this.tilemapObjects["".concat(t[0],",").concat(t[1])];if(a&&"exit"===a.type)if(null===(n=a.ezProps)||void 0===n?void 0:n.loadScene)this.store.dispatch(Object(h.g)(this.questName,a.ezProps.loadScene));else{var r=Math.floor(this.getQuest().progress)+1,c=Object(j.b)(this.questName).nodes[r];c.log&&this.store.dispatch(Object(O.c)(c.log,null,E.a.quest,this.questName)),this.store.dispatch(Object(h.d)(this.questName))}}},{key:"actorCanInteract",value:function(e){var t=this.getQuest().scene,n=null===t||void 0===t?void 0:t.actors.find((function(t){return t.name===e}));return!!(null===t||void 0===t?void 0:t.tileObjects.find((function(e){return d(e.location,n.location)})))}},{key:"actorInteract",value:function(e){if(this.actorCanInteract(e)){var t=this.getQuest().scene,n=null===t||void 0===t?void 0:t.actors.find((function(t){return t.name===e})),a=null===t||void 0===t?void 0:t.tileObjects.find((function(e){return d(e.location,n.location)}));a&&"tileobject"===a.type?this.interactWithObject(n,a):console.warn("No object found")}else console.warn("Can't interact")}},{key:"interactWithObject",value:function(e,t){}},{key:"pointToSceneLocation",value:function(e){var t,n;return(null===(t=this.mapData)||void 0===t?void 0:t.tilewidth)&&(null===(n=this.mapData)||void 0===n?void 0:n.tileheight)?[Math.floor(e.x/this.mapData.tilewidth),Math.floor(e.y/this.mapData.tilewidth)]:[0,0]}},{key:"locationIsBlocked",value:function(e){return this.blockedTiles.some((function(t){return d(t,e)}))}},{key:"createAStar",value:function(){for(var e=[],t=0;t<this.mapData.height;t++){for(var n=[],a=0;a<this.mapData.width;a++){var r=[a,t],c=this.locationIsBlocked(r);n.push(c?1:0)}e.push(n)}return new v.AStarFinder({grid:{matrix:e},includeStartNode:!1,heuristic:"Manhatten",weight:0})}},{key:"createActors",value:function(){if(!this.tilemapObjects)throw new Error("No tilemapObjects");var e=this.getAdventurers(),t=Object.values(this.tilemapObjects).filter((function(e){return"adventurerStart"===e.type})).map((function(e){return e.location}));if(e.length>t.length)throw new Error("Not enough objects with 'adventurerStart' property set to true");return e.reduce((function(e,n,a){var r=t[a];return e.push({health:100,location:r,name:n.id}),e}),[])}},{key:"createTileObjects",value:function(){if(!this.tilemapObjects)throw new Error("No tilemapObjects");return Object.values(this.tilemapObjects).map((function(e){return{id:e.id,gid:e.gid,location:e.location,name:e.name,type:e.type}}))}},{key:"createCaches",value:function(){return Object.values(this.tilemapObjects).filter((function(e){return"lootCache"===e.type})).reduce((function(e,t){var n,a,r=null===(n=t.ezProps)||void 0===n?void 0:n.items.split(",").map((function(e){var t=k.a[e.trim()];if(t)return t})).filter(Boolean);return e[t.name]={title:null===(a=t.ezProps)||void 0===a?void 0:a.title,items:r},e}),{})}},{key:"getQuest",value:function(){var e=this;return this.store.getState().quests.find((function(t){return t.name===e.questName}))}},{key:"getQuestVars",value:function(){return this.getQuest().questVars}},{key:"getAdventurers",value:function(){var e=this.store.getState(),t=this.getQuest();return Object(p.b)(e.adventurers,t)}},{key:"getAdventurerByActor",value:function(e){return this.store.getState().adventurers.find((function(t){return t.id===e.name}))}},{key:"questUpdate",value:function(e,t){var n="string"===typeof e.key?e:{key:e},a=w.a.getTextEntry(n);g.a.addToast(a,b.a.questUpdate,t,Object(y.a)(this.questName)),this.store.dispatch(Object(O.b)(n,E.a.quest,this.questName))}},{key:"basePath",get:function(){return this.jsonPath?"".concat(".","/").concat(this.jsonPath.substr(0,this.jsonPath.lastIndexOf("/"))):null}},{key:"dataLoaded",get:function(){return!!this.mapData}}]),e}(),T=n(77),I=function(e){Object(u.a)(n,e);var t=Object(i.a)(n);function n(){var e;Object(a.a)(this,n);for(var r=arguments.length,c=new Array(r),o=0;o<r;o++)c[o]=arguments[o];return(e=t.call.apply(t,[this].concat(c))).jsonPath="scenes/ork-dungeon-level1.json",e}return Object(r.a)(n,[{key:"interactWithObject",value:function(e,t){switch(t.name){case"chest":if(33===t.gid){var a,r={key:"quest-common-adventurer-opened-chest",context:{adventurer:null===(a=this.getAdventurerByActor(e))||void 0===a?void 0:a.name}};this.questUpdate(r,"/img/items/misc/chest-02.png"),this.store.dispatch(Object(h.j)(this.questName,t.id,{gid:34}))}}Object(o.a)(Object(c.a)(n.prototype),"interactWithObject",this).call(this,e,t)}},{key:"sceneEntered",value:function(){this.getQuestVars().dungeon.entered||this.questUpdate("quest-kill10Boars-enter-dungeon-see-chest")}}]),n}(N),S=function(e){Object(u.a)(n,e);var t=Object(i.a)(n);function n(){var e;Object(a.a)(this,n);for(var r=arguments.length,c=new Array(r),o=0;o<r;o++)c[o]=arguments[o];return(e=t.call.apply(t,[this].concat(c))).jsonPath="scenes/ork-dungeon-level2.json",e}return n}(N);T.a.registerSceneController("kill10Boars","dungeon.entrance",I),T.a.registerSceneController("kill10Boars","dungeon.hallway",S)}],[[163,1,2]]]);
//# sourceMappingURL=main.bda38d9b.chunk.js.map