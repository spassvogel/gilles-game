{"version":3,"sources":["definitions/items/types.ts","definitions/structures/index.ts","definitions/structures/alchemist.ts","definitions/production/armour.ts","definitions/structures/armoursmith.ts","definitions/structures/garden.ts","definitions/structures/lumberMill.ts","definitions/structures/mine.ts","definitions/structures/quarry.ts","definitions/structures/tannery.ts","definitions/structures/tavern.ts","definitions/structures/warehouse.ts","definitions/production/weapons.ts","definitions/structures/weaponsmith.ts","definitions/structures/weaver.ts","definitions/production/questItems.ts","definitions/structures/workshop.ts","global/TextManager.ts","definitions/quests/types.ts","global/SoundManager.ts","definitions/structures/types.ts","definitions/resources.ts","utils/routing.ts","actions/quests.ts","stores/logEntry.ts","definitions/items/deeds.ts","definitions/items/materials.ts","definitions/items/questItems.ts","definitions/items/trinkets.ts","definitions/items/index.ts","utils/time.ts","global/ToastManager.tsx","actions/log.ts","components/ui/toasts/Toast.tsx","definitions/quests/kill10Boars/index.ts","definitions/quests/index.ts","definitions/quests/retrieveMagicAmulet/index.ts","storeHelpers/index.ts","utils/pixiJs.ts","definitions/items/apparel.ts","global/SceneControllerManager.ts","definitions/items/weapons.ts","global/EventEmitter.ts","definitions/quests/kill10Boars/questVars.ts","constants/tiledMapData.ts","components/App/styles/img/cursors/dwarven_gauntlet_extra_6.png","actions/combat.ts","stores/combat.ts","actions/game.ts","mechanics/gameTick/combat.ts","components/preloading/Preloader.tsx","constants/version.tsx","utils/version.ts","components/preloading/Indicator.tsx","stores/structure.ts","components/pixi/Viewport.tsx","actions/resources.ts","actions/structures.ts","actions/gold.ts","actions/items.ts","actions/index.ts","utils/hitAreaShapes.ts","components/town/structures/LumberMill/index.tsx","components/pixi/ParticleEmitter.ts","components/town/structures/Tavern/index.tsx","hoc/withAppContext.tsx","components/town/structures/Generic/index.tsx","components/town/Legenda/index.tsx","components/town/TownView.tsx","components/ui/toasts/Toasts.tsx","components/ui/buttons/SquareIconButton.tsx","components/ui/window/Window.tsx","hoc/withWindow.tsx","components/ui/window/windows/SettingsWindow.tsx","constants/resources.ts","components/ui/window/windows/CheatWindow.tsx","constants/context.ts","components/ui/window/windows/MenuWindow.tsx","global/TooltipManager.ts","hooks/store/useGold.ts","hooks/store/useResources.ts","selectors/workers.ts","components/ui/topbar/Resourcebar.tsx","hooks/store/useWorkers.ts","utils/number.ts","components/ui/topbar/Topbar.tsx","components/world/WorldMap/QuestMarker.tsx","stores/quest.ts","components/world/WorldMap/QuestLine.tsx","selectors/quests.ts","components/world/WorldMap/index.tsx","constants/dragging.ts","components/ui/tabs/Tabstrip.tsx","components/ui/tabs/Tab.tsx","components/ui/AdventurerAvatar.tsx","components/world/QuestPanel/AdventurerTabstrip.tsx","selectors/adventurers.ts","components/ui/EquipmentSlot.tsx","constants/icons.ts","components/ui/ItemIcon.tsx","components/ui/DraggableItemIcon.tsx","actions/adventurers.ts","components/world/QuestPanel/AdventurerEquipment.tsx","components/ui/inventory/InventorySlot.tsx","components/ui/inventory/Inventory.tsx","hooks/store/useStockpileState.ts","hooks/actions/useItemActions.ts","components/world/QuestPanel/AdventurerPanel.tsx","hooks/store/useQuest.ts","components/pixi/tile/RectTileLayer.tsx","components/pixi/tile/ObjectTileLayer.tsx","stores/scene.ts","components/world/QuestPanel/QuestDetails/scene/Tilemap.tsx","components/pixi/util/BridgedStage.tsx","components/world/QuestPanel/QuestDetails/scene/SceneActor.tsx","components/world/QuestPanel/QuestDetails/scene/ActionPath.tsx","hooks/store/useAdventurer.ts","components/world/QuestPanel/QuestDetails/scene/SceneAdventurer.tsx","components/world/QuestPanel/QuestDetails/scene/Scene.tsx","components/world/QuestPanel/index.tsx","components/world/QuestPanel/QuestDetails/OnTheRoad.tsx","components/world/QuestPanel/QuestDetails/index.tsx","hooks/useSceneController.ts","components/ui/items/DraggableItemsList/index.tsx","components/world/QuestPanel/modals/LootCache/index.tsx","components/log/SimpleLog.tsx","components/world/WorldView.tsx","actions/tasks.ts","stores/task.ts","hooks/store/useStructure.ts","components/ui/tooltip/Tooltip/index.tsx","components/ui/tooltip/context/ItemContext/DeedContent.tsx","components/ui/tooltip/context/ItemContext/WeaponContent.tsx","components/ui/tooltip/context/ItemContext/ApparelContent.tsx","components/ui/tooltip/context/ItemContext/index.tsx","components/ui/tooltip/context/ResourceContext/index.tsx","components/ui/tooltip/ContextTooltip/index.tsx","components/ui/items/ItemsBox.tsx","containers/ui/context/items/ItemsCostBox.tsx","mechanics/crafting.ts","components/ui/Progressbar/index.tsx","components/ui/UpDownValue.tsx","components/structures/StructureViewHeader.tsx","components/ui/resources/ResourcesCostBox.tsx","components/structures/ProductionStructureView.tsx","containers/structures/ProductionStructureView.tsx","hooks/actions/useStructureActions.ts","components/structures/ResourceStructureView.tsx","components/ui/DraggableAdventurerAvatar.tsx","components/App/index.tsx","components/ui/DroppableAdventurerSlot.tsx","components/structures/tavern/AssignAdventurers.tsx","components/structures/tavern/QuestBoard.tsx","components/structures/tavern/AdventurerButton.tsx","components/structures/tavern/RoomWithAdventurer.tsx","components/structures/tavern/RoomEmpty.tsx","components/structures/tavern/RoomList.tsx","components/structures/tavern/TavernStructureView.tsx","components/ui/resources/ResourcesBox.tsx","hooks/usePrevious.ts","stores/resources.ts","hooks/store/adventurers.ts","components/ui/AdventurerInfo.tsx","components/structures/warehouse/WarehouseStructureView.tsx","components/StructureDetailsView.tsx","components/Background/index.tsx","components/App/manifest/app.ts","containers/App.tsx","utils/random.ts","mechanics/gameTick/producedResources.ts","mechanics/gameTick/quests.ts","mechanics/gameTick/rngState.ts","registerServiceWorker.ts","reducers/adventurers.ts","stores/engine.ts","reducers/items.ts","reducers/log.ts","reducers/quests.ts","stores/structures.ts","reducers/structures.ts","stores/tasks.ts","reducers/tasks.ts","reducers/index.ts","reducers/combat.ts","reducers/engine.ts","reducers/gold.ts","reducers/resources.ts","reducers/rngState.ts","reducers/workers.ts","utils/configureStore.ts","mechanics/gameTick/tasks.ts","index.tsx","utils/tilemap.ts","mechanics/scenes/BaseSceneController.ts","constants/text.ts","definitions/quests/kill10Boars/encounters/dungeon.ts"],"names":["ItemType","Item","Structure","alchemist","type","StructureType","production","cost","gold","time","levels","displayName","workerCapacity","produces","boots1","item","resources","wood","iron","chest","cowl","armoursmith","garden","resource","generates","food","lumberMill","HALF_HOUR","mine","quarry","stone","tannery","leather","tavern","rooms","warehouse","maxResources","fabric","crossbow","longbow","poisonedDagger","materials","poisonVial","dagger","sword","khopesh","weaponsmith","weaver","torch","sandwich","workshop","all","getDefinition","structure","getStructureByResource","Resource","TextManager","texts","precompile","this","templates","compileAll","initialized","key","context","result","getDefault","console","error","Error","template","getTemplate","textEntry","get","compile","name","itemType","Object","keys","forEach","value","Handlebars","article","itemDefinitions","itemArticleAuto","itemArticleDefined","itemArticleUndefined","getItemName","articleTemplate","noun","QuestNodeType","MusicTrack","Sound","media","musicTracks","currentMusicTrack","sounds","SoundManager","localforage","getItem","_musicVolume","_soundVolume","_initialized","m","soundList","entries","find","url","content","sound","howl","volume","soundVolume","play","track","init","hasOwnProperty","currentMusic","log","musicVolume","fade","nextMusic","playing","loop","setItem","iconImg","getWorldLink","getQuestLink","questName","getTownLink","getStructureLink","ActionType","launchQuest","assignedAventurers","exitEncounter","quest","setSceneName","sceneName","setScene","scene","enqueueSceneAction","sceneAction","completeSceneAction","updateSceneObjectAction","id","object","takeGoldFromCache","cacheName","takeItemFromCache","LogChannel","deed","deedForLumbermill","deedForWeaponsmith","material","basePath","arrowheads","bolts","buckle","chain","cogs","gem","ingot","nails","ribbon","rope","gunpowder","scales","spring","thread","questItem","questItemDefinitions","blueprints","crate","dynamite","dragonEye","eye","feather","heart","horn","letters","lockPicks","oil","orcFinger","plans","purpleGems","runestone","teeth","tooth","tusk","vase","vial","weeds","trinket","trinketDefinitions","magicAmulet","ring","deeds","apparel","questItems","trinkets","weapons","ONE_MINUTE","TWO_MINUTES","ONE_HOUR","ONE_DAY","ONE_YEAR","formatDuration","ms","timeUnitsList","unit","amount","Math","abs","output","el","tmp","floor","push","join","ToastManager","title","icon","link","stack","Date","now","emit","EVENT_TOASTS_UPDATED","playSound","toast","setTimeout","filter","lifeTime","EventEmitter","addLogText","channel","common","channelContext","entry","addLogEntry","Type","Toast","props","achievementUnlocked","history","useHistory","typeText","className","onClick","width","alt","src","process","kill10Boars","getQuestVars","questStore","questVars","getInitialQuestVars","initialQuestVars","nodes","x","y","nothing","encounter","startScene","retrieveMagicAmulet","baz","zux","requiredItems","adventurersOnQuest","adventurers","party","map","findAdventurerById","getQuestLeader","leaderId","a","adventurerFreeInventorySlots","adventurer","inventory","i","length","storeIsRehydrated","store","rngState","lerpLocation","point1","point2","alpha","lerp","n1","n2","loadResourceAsync","path","loader","PIXI","Loader","shared","Promise","resolve","reject","add","load","_","loadResource","callback","ApparelType","equipmentType","feet","boots2","boots3","chainmailHood","head","armourRating","clothGloves","hands","druidChest","druidHands","druidFeet","druidHead","druidLegs","legs","fedora","greaves1","greaves2","hornedHelmet","leatherGloves","nomadHelmet","pants1","pants2","plateChest1","plateChest2","plateChest3","plateChest4","plateGloves1","plateGloves2","plateHelmet","platePants","plateShoulders1","shoulders","plateShoulders2","robe","shoulders1","shoulders2","shoulders3","vest","SceneControllerManager","controllerType","controllerTypes","require","WeaponType","DamageType","weapon","weaponDefinitions","arbalest","weaponType","damage","kinetic","battleAxe","axe","brassKnuckles","melee","cleaver","knife","club","flail","greatswordOfGwai","unique","javelin","poleArm","bow","mace","morningStar","ravenStaff","staff","savageStaff","spear","warhammer","hammer","eventEmitter","eventName","listener","events","splice","event","fn","dungeon","entered","foo","bar","TiledLayerType","Orientation","RenderOrder","module","exports","Allegiance","CombatActionType","barBrawl","actors","allegiance","player","health","location","remainingAP","turn","updateCombat","delta","actor","combat","getState","action","endsAt","enemy","move","dispatch","target","moveActor","clearCombatAction","MediaType","asInt","semVer","parts","split","part","Number","numericVersion","convertSemVerToInt","Indicator","itemsLoaded","itemsTotal","StructureState","loadImage","image","Image","check","naturalWidth","removeEventListener","complete","addEventListener","getType","toLowerCase","endsWith","Preloader","useState","completed","setCompleted","setItemsLoaded","useEffect","loadMedia","children","manifest","indicator","promises","loadItem","catch","err","then","results","onLoadComplete","some","warn","mediaType","Howl","Viewport","forwardRef","ref","app","useApp","gauntlet","cursor","renderer","plugins","interaction","cursorStyles","pointer","PixiComponentViewport","PixiComponent","create","viewport","PixiViewport","screenWidth","screenHeight","worldWidth","worldHeight","ticker","on","minScale","maxScale","drag","pinch","wheel","clamp","direction","clampZoom","decelerate","initialState","level","state","NotBuilt","workers","HitAreaShapes","shapes","sprite","definition","shape","contains","LumberMill","hitAreaShapes","atlas","textures","setTextures","filters","selected","STRUCTURE_HIGHLIGHT_FILTER","rotation","setRotation","useTick","r","position","interactive","buttonMode","pointertap","onStructureClick","hitArea","texture","anchor","ParticleEmitter","applyProps","instance","oldProps","newProps","config","newP","applyDefaultProps","emitter","_emitter","particles","from","elapsed","performance","tick","raf","requestAnimationFrame","update","willUnmount","cancelAnimationFrame","Tavern","smoke","withAppContext","WrappedComponent","AppContext","Consumer","Component","Generic","Legenda","structures","orderedStructures","match","useRouteMatch","params","toString","getStructureName","to","renderText","OutlineFilter","selectedStructure","useRef","addMusicTrack","town","playMusicTrack","tween","gsap","duration","thickness","yoyo","repeat","pause","kill","handleStructureClick","dragging","current","useSelector","viewportRef","onScroll","e","preventDefault","window","passive","zoomPercent","getStructurePosition","moveCenter","MAX_WIDTH","canvasWidth","setCanvasWidth","canvasHeight","setCanvasHeight","resize","worldViewWidth","clientWidth","worldViewHeight","clientHeight","height","options","sharedLoader","reverse","StructureComponent","getStructure","polygons","Point","Toasts","activeToasts","setActiveToasts","toastsUpdated","toastConfig","SquareIconButton","text","Window","backEnabled","onBack","buttonClick","closeEnabled","onClose","withWindow","React","compose","soundSlider","musicSlider","open","onComplete","role","aria-label","min","max","step","onChange","linear","parseFloat","pow","defaultValue","sqrt","resourceOrder","addResources","finishBuildingStructure","upgradeStructure","increaseWorkers","decreaseWorkers","addGold","subtractGold","addItemToWarehouse","toSlot","addItem","removeItemFromWarehouse","fromSlot","removeItem","ContextType","itemSelectRef","cheats","setCheats","useDispatch","onCheatStructureState","setStructureState","onCheatWorkers","addWorkers","getItemOption","items","val","isNaN","label","getItemTypeOptions","handleChangeStructureState","checked","Built","addToast","cheat","style","evt","onCheatGold","reduce","acc","onCheatResources","onCheatItem","structureDef","getStructureDefinition","structureStore","levelDef","getStructureRow","onOpenWindow","TooltipManager","info","originRect","referenceRect","deepEquals","lastContext","clear","EVENT_CONTEXT_UPDATED","undefined","useGold","useResources","selectFreeWorkers","createSelector","Resourcebar","storeResources","workersFree","createItem","currentTarget","getBoundingClientRect","showContextTooltip","stopPropagation","backgroundImage","number","digits","SI_SYMBOL","tier","log10","toFixed","suffix","scale","scaled","formatNumber","resourceDescription","resourceDescriptions","Topbar","useContext","QuestStatus","QuestMarker","leader","encounterActive","avatar","maskGraphics","beginFill","drawCircle","CIRCLE_DIAMETER","endFill","mask","addChild","pointerdown","avatarImg","QuestLine","positions","draw","graphics","lineStyle","moveTo","xc","yc","quadraticCurveTo","selectActiveQuests","quests","q","status","active","DragSourceType","WorldMap","retrieveWorldViewRef","smallMap","questSelector","useCallback","selectedQuestName","selectedQuest","activeQuests","WIDTH","worldView","SMALL_HEIGHT","focusOnQuestingParty","point","nodeLocationToPoint","partyLocation","getQuestWorldLocation","previousPositions","getPreviousPositions","currentPosition","questDefinition","progress","questNode","onPartyClick","roundedProgress","lastNode","nextNode","WORLD_WIDTH","WORLD_HEIGHT","lastPosition","Tabstrip","activeTab","disabled","Children","child","cloneElement","handleTabClick","tabId","onTabSelected","Tab","AdventurerAvatar","AdventurerTabstrip","onAdventurerTabSelected","adventurerId","selectedAdventurerId","getAdventurers","getQuests","DragType","foundInParty","groupedAdventurers","values","foundAdventurers","indexOf","EquipmentSlotType","dropTarget","drop","monitor","onDrop","canDrop","itemAndEquipmentSlotMatch","IconSize","equipmentSlotType","checkEquipment","mainHand","offHand","DropTarget","connect","connectDropTarget","isOver","borderColor","itemDefinition","getClassName","size","smallest","small","medium","big","biggest","ItemIcon","showContext","DragSource","beginDrag","inventorySlot","index","sourceId","sourceType","connectDragSource","dragSource","isDragging","AdventurerEquipment","onDropItemEquipment","getEquipmentSlot","slotType","equipment","contents","itemRef","createRef","adventurerEquipment","dragInfo","isActive","classNames","Inventory","slots","slot","iconSize","onDropItem","addItemToInventory","removeItemFromInventory","assignEquipment","equipmentSlot","removeEquipment","useStockpileState","stockpile","useItemDropActions","dropItemEquipment","actions","adventurerInventory","existingEquipment","dropItemInventory","moveItemInInventory","otherItem","dropItemWarehouse","moveItemInWarehouse","AdventurerPanel","useQuest","RectTileLayer","tilemap","CompositeRectTileLayer","layer","tileset","horizontalTiles","spritesheet","data","w","tilewidth","h","tileheight","spriteId","addFrame","SceneActionType","ObjectTileLayer","objects","gid","Tilemap","tileObjects","layers","setLayers","debug","spritesheetData","parseSpritesheetData","getTileset","clearTextureCache","parse","allLayers","l","visible","tilelayer","createTileLayer","createObjectLayer","mapData","tilesets","source","columns","frames","tilecount","firstgid","frame","spriteSourceSize","rotated","trimmed","sourceSize","meta","imagewidth","imageheight","BridgedStage","restProps","SceneActor","controller","tileWidth","tileHeight","actorRef","actionQueueSelector","actionQueue","nextAction","actionType","moveComplete","actorMoved","killTweensOf","ease","pixi","useMemo","ActionPath","graphicsRef","useImperativeHandle","drawAction","allowed","grfx","color","lineTo","parent","useAdventurer","adventurerSelector","SceneAdventurer","actionPathRef","actionActive","setActionActive","actionPath","container","mouseMove","destinationLocation","pointToSceneLocation","global","blocked","locationIsBlocked","off","setSelectedActor","pointerup","pointerupoutside","onLootCacheChanged","endLocation","convertLocation","origin","aStar","findPath","actorCanInteract","actorInteract","Layout","Scene","selectedActor","sceneWidth","sceneHeight","o","renderActor","OnTheRoad","getQuestTitle","QuestDetails","SceneLoader","useStore","getSceneController","loaded","setLoaded","loadData","createScene","sceneEntered","useSceneController","DraggableItemsList","getItemSubtext","LootCache","cache","caches","taking","setTaking","freeSlots","interval","querySelector","classList","clearInterval","lootCache","ChannelType","QuestPanel","layout","auto","activeLootCache","setActiveLootCache","setSelectedAdventurerID","selectedAdventurer","handleAdventurerSelected","WorldView","worldMapRef","questname","world","TaskType","SimpleLog","expanded","setExpanded","selectedTabId","setSelectedTabId","logEntries","channels","tabType","displayEntries","currentTab","t","lE","tab","logEntry","getLogEntryRow","startTask","taskType","callbacks","start","Placement","useStructure","structureSelector","DeedContent","structureDefinition","enoughGold","subtext","handleStartConstruction","startBuildingStructure","buildStructure","WeaponContent","ApparelContent","ItemContext","ResourceContext","structureStates","structureState","renderProducedBy","Tooltip","placement","bottom","setPlacement","containerRect","setContainerRect","tooltipElement","tooltipRect","top","opacity","contentElement","left","offset","transform","right","closest","ContextTooltip","selectedContext","setSelectedContext","tooltipUpdated","getResourceName","renderContent","ItemsBox","itemsInInventory","aggregate","accumulator","listItems","listItemClass","itemDescription","itemsDescription","ownProps","tmpWarehouse","found","findIndex","removed","calculateProductionTime","Progressbar","UpDownValue","displayValue","upDisabled","onUp","downDisabled","onDown","StructureViewHeader","ResourcesCostBox","sufficientResources","ProductionStructureView","selectedItem","setSelectedItem","workersAssigned","setWorkersAssigned","levelDefinition","nextLevel","nextLevelCost","canUpgrade","upgradeText","float","onUpgrade","createUpgradeRow","p","playerResources","costResources","missingAtLeastOneResource","missingAtLeastOneItem","costMaterials","display","craftingTime","formatted","makeTimeString","onCraft","createCraftingDetails","tasks","startTime","timeRemaining","running","productionDefinition","removeResources","craftItem","useStructureActions","startUpgradeStructure","ResourceStructureView","handleWorkersDown","handleWorkersUp","createWorkersRow","generatesText","createGeneratesRow","spec","View","AssignAdventurers","onAdventurerClicked","onAdventurerDropped","availableSlots","slotsContent","QuestBoard","checkEnoughItems","every","amountRequired","availableQuests","iconImgPath","onQuestClick","fullParty","enoughItems","canLaunch","getQuestDescription","onRemoveAdventurer","ItemsCostBox","onLaunchQuest","getQuestDetails","AdventurerButton","onAddAdventurer","Boolean","emptySlot","getEmptySlot","RoomWithAdventurer","onQuest","assigned","SOURCE_ID","RoomEmpty","RoomList","roomCount","setSelectedAdventurer","handleAdventurerNameClick","roomContent","room","TavernStructureView","setAassignedAdventurers","setSelectedQuest","getAvailableQuests","available","handleAddAdventurer","copy","handleRemoveAdventurer","handleLaunchQuest","questTitle","questLaunched","handleQuestClick","deltaResources","onCloseWindow","usePrevious","empty","useAdventurersInTown","getAdventurersInTown","AdventurerInfo","attributes","stats","stat","handleDropItemEquipment","equipmentList","WAREHOUSE","WarehouseStructureView","resourcesDelta","setResourcesDelta","previousResources","resourcesRef","stockpileState","structuresState","adventurersInTown","remove","buildTask","Building","Background","fragmentSrc","uniforms","timestamp","innerWidth","innerHeight","resolution","shift","speed","PixiPlugin","registerPIXI","registerPlugin","createContext","App","containerRef","setMedia","activeWindows","setActiveWindows","handleViewButtonClick","selectStructure","handleWindowOpened","handleWindowClose","handleWindowBack","slice","handleScroll","debounce","Provider","maxWidth","DndProvider","backend","HTML5Backend","mediaItems","addSounds","exact","persistor","purge","reload","render","topWindow","commonWindowProps","renderWindow","generator","getMaxResources","getProducedResources","lastProducedUpdate","factor","resourceStructureDefinition","handleStructure","getQuestUpdates","questDefinitions","currentProgress","currentNodeIndex","progressIncrease","nextProgress","nodesPassed","questEncounter","logUpdates","questUpdates","dirty","getRngState","Random","isLocalhost","hostname","register","navigator","URL","swUrl","fetch","response","headers","serviceWorker","ready","registration","unregister","registerValidSW","checkValidServiceWorker","onupdatefound","installingWorker","installing","onstatechange","generateRandomStats","strength","random","perception","endurance","charisma","intelligenge","agility","luck","testState","lastTick","gameTick","lU","encounterResults","reward","questStoreState","qss","tO","questsToUpdate","questToUpdate","updateQuestVars","assign","vars","updateEncounterResult","concat","nodeIndex","lootCaches","structureInitialState","updateStructureState","createTask","combineReducers","element","moveItemToOtherAdventurer","fromAdventurerId","toAdventurerId","fromAdventurer","startCombatAction","addAction","combatType","moveAction","engine","GameActionType","resourcesToAdd","resourcesToRemove","workersToAdd","workersToRemove","task","end","persistConfig","storage","localForage","version","persistedReducer","persistReducer","rootReducer","initial","createStore","__REDUX_DEVTOOLS_EXTENSION__","persistStore","isHydrated","processCompletedTasks","itemCrafted","handleCompletedTask","initGame","seed","seedrandom","configureStore","continueGame","startNewGame","runGame","ReactDOM","document","getElementById","registerServiceWorker","setInterval","logs","resourcesUpdates","parseProperties","properties","locationEquals","b","BaseSceneController","tilemapObjects","jsonPath","blockedTiles","dataLoaded","tilemapData","objectLayers","objectgroup","objectLayer","ezProps","extended","getExtendedTilemapObjects","list","tile","addAllTilesInLayerToList","createAStar","createTileObjects","createActors","createCaches","loadScene","getQuest","node","actorName","interactWithObject","_actor","_object","matrix","row","AStarFinder","grid","includeStartNode","heuristic","weight","startLocations","v","trim","storeState","input","getTextEntry","questUpdate","substr","lastIndexOf","DungeonEntranceSceneController","getAdventurerByActor","DungeonHallwaySceneController","registerSceneController"],"mappings":"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","file":"static/js/main.bda38d9b.chunk.js","sourcesContent":["\r\nexport enum ItemType {\r\n    deed,\r\n    apparel,\r\n    material,\r\n    questItem,\r\n    trinket,\r\n    weapon,\r\n}\r\n\r\n// the string must correspond to a named export in /items/index.tsx\r\nexport enum Item {\r\n    // deeds\r\n    deedForLumbermill = \"deedForLumbermill\",\r\n    deedForWeaponsmith = \"deedForWeaponsmith\",\r\n\r\n    // equipment\r\n    boots1 = \"boots1\",\r\n    boots2 = \"boots2\",\r\n    boots3 = \"boots3\",\r\n    chainmailHood = \"chainmailHood\",\r\n    chest = \"chest\",\r\n    clothGloves = \"clothGloves\",\r\n    cowl = \"cowl\",\r\n    fedora = \"fedora\",\r\n    druidChest = \"druidChest\",\r\n    druidFeet = \"druidFeet\",\r\n    druidHands = \"druidHands\",\r\n    druidHead = \"druidHead\",\r\n    druidLegs = \"druidLegs\",\r\n    greaves1 = \"greaves1\",\r\n    greaves2 = \"greaves2\",\r\n    hornedHelmet = \"hornedHelmet\",\r\n    leatherGloves = \"leatherGloves\",\r\n    nomadHelmet = \"nomadHelmet\",\r\n    pants1 = \"pants1\",\r\n    pants2 = \"pants2\",\r\n    plateChest1 = \"plateChest1\",\r\n    plateChest2 = \"plateChest2\",\r\n    plateChest3 = \"plateChest3\",\r\n    plateChest4 = \"plateChest4\",\r\n    plateGloves1 = \"plateGloves1\",\r\n    plateGloves2 = \"plateGloves2\",\r\n    plateHelmet = \"plateHelmet\",\r\n    platePants = \"platePants\",\r\n    plateShoulders1 = \"plateShoulders1\",\r\n    plateShoulders2 = \"plateShoulders2\",\r\n    robe = \"robe\",\r\n    shoulders1 = \"shoulders1\",\r\n    shoulders2 = \"shoulders2\",\r\n    shoulders3 = \"shoulders3\",\r\n    vest = \"vest\",\r\n\r\n    // materials\r\n    arrowheads = \"arrowheads\",\r\n    bolts = \"bolts\",\r\n    buckle = \"buckle\",\r\n    chain = \"chain\",\r\n    cogs = \"cogs\",\r\n    gem = \"gem\",\r\n    gunpowder = \"gunpowder\",\r\n    ingot = \"ingot\",\r\n    nails = \"nails\",\r\n    poisonVial = \"poisonVial\",\r\n    ribbon = \"ribbon\",\r\n    rope = \"rope\",\r\n    scales = \"scales\",\r\n    spring = \"spring\",\r\n    thread = \"thread\",\r\n\r\n    // quest-items\r\n    blueprints = \"blueprints\",\r\n    crate = \"crate\",\r\n    dragonEye = \"dragonEye\",\r\n    dynamite = \"dynamite\",\r\n    eye = \"eye\",\r\n    feather = \"feather\",\r\n    food = \"food\",\r\n    heart = \"heart\",\r\n    horn = \"horn\",\r\n    key = \"key\",\r\n    letters = \"letters\",\r\n    lockPicks = \"lockPicks\",\r\n    oil = \"oil\",\r\n    orcFinger = \"orcFinger\",\r\n    plans = \"plans\",\r\n    purpleGems = \"purpleGems\",\r\n    runestone = \"runestone\",\r\n    sandwich = \"sandwich\",\r\n    teeth = \"teeth\",\r\n    tooth = \"tooth\",\r\n    torch = \"torch\",\r\n    tusk = \"tusk\",\r\n    vase = \"vase\",\r\n    vial = \"vial\",\r\n    weeds = \"weeds\",\r\n\r\n    // trinkets\r\n    ring = \"ring\",\r\n    magicAmulet = \"magicAmulet\",\r\n\r\n    // weapons\r\n    arbalest = \"arbalest\",\r\n    battleAxe = \"battleAxe\",\r\n    brassKnuckles = \"brassKnuckles\",\r\n    cleaver = \"cleaver\",\r\n    club = \"club\",\r\n    crossbow = \"crossbow\",\r\n    dagger = \"dagger\",\r\n    flail = \"flail\",\r\n    greatswordOfGwai = \"greatswordOfGwai\",\r\n    javelin = \"javelin\",\r\n    khopesh = \"khopesh\",\r\n    longbow = \"longbow\",\r\n    mace = \"mace\",\r\n    morningStar = \"morningStar\",\r\n    poisonedDagger = \"poisonedDagger\",\r\n    ravenStaff = \"ravenStaff\",\r\n    savageStaff = \"savageStaff\",\r\n    spear = \"spear\",\r\n    sword = \"sword\",\r\n    warhammer = \"warhammer\",\r\n}\r\n\r\nexport interface ItemDefinition {\r\n    item: Item;\r\n    itemType: ItemType;\r\n    iconImg: string;\r\n//    articleUndefined?: string;  // Key to text\r\n    unique?: boolean;           // Indicate that this item is unique.\r\n                                // Not actually enforced by anything,\r\n                                // but used to generate the article ('a' or 'the')\r\n}\r\n","// tslint:disable:object-literal-sort-keys\r\n\r\nimport alchemist from \"./alchemist\";\r\nimport armoursmith from \"./armoursmith\";\r\nimport garden from \"./garden\";\r\nimport lumberMill from \"./lumberMill\";\r\nimport mine from \"./mine\";\r\nimport quarry from \"./quarry\";\r\nimport tannery from \"./tannery\";\r\nimport tavern from \"./tavern\";\r\nimport { StructureDefinition } from \"./types\";\r\nimport warehouse from \"./warehouse\";\r\nimport weaponsmith from \"./weaponsmith\";\r\nimport weaver from \"./weaver\";\r\nimport workshop from \"./workshop\";\r\nimport { Resource } from 'definitions/resources';\r\n\r\nexport enum Structure {\r\n    alchemist = \"alchemist\",\r\n    armoursmith = \"armoursmith\",\r\n    garden = \"garden\",\r\n    lumberMill = \"lumberMill\",\r\n    mine = \"mine\",\r\n    quarry = \"quarry\",\r\n    tavern = \"tavern\",\r\n    tannery = \"tannery\",\r\n    warehouse = \"warehouse\",\r\n    weaponsmith = \"weaponsmith\",\r\n    weaver = \"weaver\",\r\n    workshop = \"workshop\",\r\n}\r\n\r\nconst all = {\r\n    alchemist,\r\n    armoursmith,\r\n    garden,\r\n    lumberMill,\r\n    mine,\r\n    quarry,\r\n    tavern,\r\n    tannery,\r\n    warehouse,\r\n    weaponsmith,\r\n    weaver,\r\n    workshop,\r\n};\r\n\r\nexport default all;\r\n\r\nexport function getDefinition<T extends StructureDefinition>(structure: string): T {\r\n    return all[structure] as T;\r\n}\r\n\r\nexport function getStructureByResource(resource: Resource) : Structure {\r\n    switch (resource) {\r\n        case Resource.fabric:\r\n            return Structure.weaver;\r\n        case Resource.food:\r\n            return Structure.garden;\r\n        case Resource.iron:\r\n            return Structure.mine;\r\n        case Resource.leather:\r\n            return Structure.tannery;\r\n        case Resource.stone:\r\n            return Structure.quarry;\r\n        case Resource.wood:\r\n            return Structure.lumberMill;\r\n    }\r\n}\r\n","// tslint:disable:object-literal-sort-keys\r\nimport { ProductionStructureDefinition, StructureType } from \"./types\";\r\nconst alchemist: ProductionStructureDefinition = {\r\n    type: StructureType.production,\r\n    cost: {\r\n        gold: 40,\r\n        time: 4000,\r\n    },\r\n    levels: [{\r\n        displayName: \"structure-alchemist-name\",\r\n        // level 1:\r\n        workerCapacity: 2,\r\n        cost: {\r\n            gold: 0,\r\n        },\r\n        produces: [],\r\n    }, {\r\n        // level 2:\r\n        displayName: \"structure-alchemist-name\",\r\n        workerCapacity: 5,\r\n        cost: {\r\n            gold: 30,\r\n        },\r\n        produces: [],\r\n    }, {\r\n        // level 3:\r\n        displayName: \"structure-alchemist-name\",\r\n        workerCapacity: 10,\r\n        cost: {\r\n             gold: 50,\r\n        },\r\n        produces: [],\r\n    }],\r\n};\r\n\r\nexport default alchemist;\r\n","// tslint:disable:object-literal-sort-keys\r\n\r\nimport * as time from \"utils/time\";\r\nimport { Item } from \"../items/types\";\r\nimport { ProductionDefinition } from \"./types\";\r\n\r\nexport const boots1: ProductionDefinition = {\r\n    item: Item.boots1,\r\n    cost: {\r\n        resources: { wood: 2, iron: 15 },\r\n        time: time.HALF_HOUR,\r\n    },\r\n};\r\nexport const chest: ProductionDefinition = {\r\n    item: Item.chest,\r\n    cost: {\r\n        resources: { wood: 10, iron: 45},\r\n        time: time.ONE_HOUR,\r\n    },\r\n};\r\nexport const cowl: ProductionDefinition = {\r\n    item: Item.cowl,\r\n    cost: {\r\n        resources: { iron: 15 },\r\n        time: time.ONE_HOUR,\r\n    },\r\n};\r\n","// tslint:disable:object-literal-sort-keys\r\n\r\nimport { boots1, chest, cowl } from \"../production/armour\";\r\nimport { ProductionStructureDefinition, StructureType } from \"./types\";\r\n\r\nconst armoursmith: ProductionStructureDefinition = {\r\n    cost: {\r\n        gold: 40,\r\n        time: 4000,\r\n    },\r\n    type: StructureType.production,\r\n    levels: [{\r\n        // level 1:\r\n        displayName: \"structure-armoursmith-name\",\r\n        workerCapacity: 2,\r\n        cost: {\r\n            gold: 0,\r\n        },\r\n        produces: [ boots1 ],\r\n    }, {\r\n        // level 2:\r\n        displayName: \"structure-armoursmith-name\",\r\n        workerCapacity: 5,\r\n        cost: {\r\n            gold: 30,\r\n        },\r\n        produces: [ boots1, chest ],\r\n    }, {\r\n        // level 3:\r\n        displayName: \"structure-armoursmith-name\",\r\n        workerCapacity: 10,\r\n        cost: {\r\n            gold: 50,\r\n        },\r\n        produces: [ boots1, chest, cowl],\r\n    }],\r\n};\r\nexport default armoursmith;\r\n","// tslint:disable:object-literal-sort-keys\r\nimport { ResourceStructureDefinition, StructureType } from \"./types\";\r\n\r\nconst garden: ResourceStructureDefinition = {\r\n    type: StructureType.resource,\r\n    cost: {\r\n        gold: 40,\r\n        time: 4000,\r\n    },\r\n    levels: [{\r\n        displayName: \"structure-garden-name\",\r\n        // level 1:\r\n        workerCapacity: 2,\r\n        cost: {\r\n            gold: 0,\r\n        },\r\n        generates: { food: 2 },\r\n    }, {\r\n        displayName: \"structure-garden-name\",\r\n        // level 2:\r\n        workerCapacity: 5,\r\n        cost: {\r\n            gold: 30,\r\n        },\r\n        generates: { food: 2 },\r\n    }, {\r\n        // level 3:\r\n        displayName: \"structure-garden-name\",\r\n        workerCapacity: 10,\r\n        cost: {\r\n            gold: 50,\r\n        },\r\n        generates: { food: 2 },\r\n    }],\r\n};\r\n\r\nexport default garden;\r\n","// tslint:disable:object-literal-sort-keys\r\n\r\nimport { ResourceStructureDefinition, StructureType } from \"./types\";\r\nimport { HALF_HOUR } from 'utils/time';\r\n\r\nconst lumberMill: ResourceStructureDefinition = {\r\n    type: StructureType.resource,\r\n    cost: {\r\n        gold: 31,\r\n        time: HALF_HOUR,\r\n    },\r\n    levels: [{\r\n        // level 0:\r\n        displayName: \"structure-lumberMill-name\",\r\n        workerCapacity: 2,\r\n        cost: {\r\n            gold: 0,\r\n        },\r\n        generates: { wood: 2 },\r\n    }, {\r\n        // level 1:\r\n        displayName: \"structure-lumberMill-name\",\r\n        workerCapacity: 5,\r\n        cost: {\r\n            gold: 30,\r\n        },\r\n        generates: { wood: 2 },\r\n    }, {\r\n        // level 2:\r\n        displayName: \"structure-lumberMill-name\",\r\n        workerCapacity: 10,\r\n        cost: {\r\n            gold: 50,\r\n        },\r\n        generates: { wood: 2 },\r\n    }],\r\n};\r\n\r\nexport default lumberMill;\r\n","// tslint:disable:object-literal-sort-keys\r\nimport { ResourceStructureDefinition, StructureType } from \"./types\";\r\n\r\nconst mine: ResourceStructureDefinition = {\r\n    cost: {\r\n        gold: 40,\r\n        time: 4000,\r\n    },\r\n    type: StructureType.resource,\r\n    levels: [{\r\n        displayName: \"structure-mine-name\",\r\n        // level 0:\r\n        workerCapacity: 2,\r\n        cost: {\r\n            gold: 0,\r\n        },\r\n        generates: { iron: 2 },\r\n    }, {\r\n        displayName: \"structure-mine-name\",\r\n        // level 1:\r\n        workerCapacity: 5,\r\n        cost: {\r\n            gold: 30,\r\n        },\r\n        generates: { iron: 2 },\r\n    }, {\r\n        displayName: \"structure-mine-name\",\r\n        // level 2:\r\n        workerCapacity: 10,\r\n        cost: {\r\n            gold: 50,\r\n        },\r\n        generates: { iron: 2 },\r\n    }],\r\n};\r\nexport default mine;\r\n","// tslint:disable:object-literal-sort-keys\r\nimport { ResourceStructureDefinition, StructureType } from \"./types\";\r\n\r\nconst quarry: ResourceStructureDefinition = {\r\n    cost: {\r\n        gold: 40,\r\n        time: 4000,\r\n    },\r\n    type: StructureType.resource,\r\n    levels: [{\r\n        displayName: \"structure-quarry-name\",\r\n        // level 1:\r\n        workerCapacity: 2,\r\n        cost: {\r\n            gold: 0,\r\n        },\r\n        generates: { stone: 2 },\r\n    }, {\r\n        // level 2:\r\n        displayName: \"structure-quarry-name\",\r\n        workerCapacity: 5,\r\n        cost: {\r\n            gold: 30,\r\n        },\r\n        generates: { stone: 4 },\r\n    }, {\r\n        // level 3:\r\n        displayName: \"structure-quarry-name\",\r\n        workerCapacity: 10,\r\n        cost: {\r\n            gold: 50,\r\n        },\r\n        generates: { stone: 6 },\r\n    }],\r\n};\r\n\r\nexport default quarry;\r\n","// tslint:disable:object-literal-sort-keys\r\n\r\nimport { ResourceStructureDefinition, StructureType } from \"./types\";\r\n\r\nconst tannery: ResourceStructureDefinition = {\r\n    cost: {\r\n        gold: 40,\r\n        time: 4000,\r\n    },\r\n    type: StructureType.resource,\r\n    levels: [{\r\n        displayName: \"structure-tannery-name\",\r\n        // level 1:\r\n        workerCapacity: 2,\r\n        cost: {\r\n            gold: 0,\r\n        },\r\n        generates: { leather: 2 },\r\n    }, {\r\n        // level 2:\r\n        displayName: \"structure-tannery-name\",\r\n        workerCapacity: 5,\r\n        cost: {\r\n            gold: 30,\r\n        },\r\n        generates: { leather: 5 },\r\n    }, {\r\n        // level 3:\r\n        displayName: \"structure-tannery-name\",\r\n        workerCapacity: 10,\r\n        cost: {\r\n            gold: 50,\r\n        },\r\n        generates: { leather: 7 },\r\n    }],\r\n};\r\n\r\nexport default tannery;\r\n","// tslint:disable:object-literal-sort-keys\r\n\r\nimport { StructureType, TavernStructureDefinition } from \"./types\";\r\n\r\nconst tavern: TavernStructureDefinition = {\r\n    cost: {\r\n        gold: 40,\r\n        time: 4000,\r\n    },\r\n    type: StructureType.tavern,\r\n    levels: [{\r\n        displayName: \"structure-tavern-name\",\r\n        // level 1:\r\n        workerCapacity: 2,\r\n        cost: {\r\n             gold: 0,\r\n        },\r\n        rooms: 10,\r\n    }, {\r\n        // level 2:\r\n        displayName: \"structure-tavern-name\",\r\n        workerCapacity: 5,\r\n        cost: {\r\n             gold: 30,\r\n        },\r\n        rooms: 12,\r\n    }, {\r\n        // level 3:\r\n        displayName: \"structure-tavern-name\",\r\n        workerCapacity: 10,\r\n        cost: {\r\n             gold: 50,\r\n        },\r\n        rooms: 15,\r\n    }],\r\n};\r\n\r\nexport default tavern;\r\n","// tslint:disable:object-literal-sort-keys\r\n\r\nimport {  StructureType, WarehouseStructureDefinition } from \"./types\";\r\n\r\nconst warehouse: WarehouseStructureDefinition = {\r\n    cost: {\r\n        gold: 40,\r\n        time: 4000,\r\n    },\r\n    type: StructureType.warehouse,\r\n    levels: [{\r\n        displayName: \"structure-warehouse-name\",\r\n        // level 1:\r\n        workerCapacity: 2,\r\n        cost: {\r\n            gold: 0,\r\n        },\r\n        maxResources: {\r\n            fabric: 200,\r\n            food: 200,\r\n            iron: 200,\r\n            leather: 200,\r\n            stone: 200,\r\n            wood: 200,\r\n        },\r\n    }, {\r\n        // level 2:\r\n        displayName: \"structure-warehouse-name\",\r\n        workerCapacity: 5,\r\n        cost: {\r\n            gold: 30,\r\n        },\r\n        maxResources: {\r\n            fabric: 500,\r\n            food: 500,\r\n            iron: 500,\r\n            leather: 500,\r\n            stone: 500,\r\n            wood: 500,\r\n        },\r\n    }, {\r\n        // level 3:\r\n        displayName: \"structure-warehouse-name\",\r\n        workerCapacity: 10,\r\n        cost: {\r\n            gold: 50,\r\n        },\r\n        maxResources: {\r\n            fabric: 1000,\r\n            food: 1000,\r\n            iron: 1000,\r\n            leather: 1000,\r\n            stone: 1000,\r\n            wood: 1000,\r\n        },\r\n    }],\r\n};\r\n\r\nexport default warehouse;\r\n","// tslint:disable:object-literal-sort-keys\r\n\r\nimport * as time from \"utils/time\";\r\nimport { Item } from \"../items/types\";\r\nimport { ProductionDefinition } from \"./types\";\r\n\r\nexport const crossbow: ProductionDefinition = {\r\n    item: Item.crossbow,\r\n    cost: {\r\n        resources: { wood: 20, iron: 5 },\r\n        time: time.HALF_HOUR,\r\n    },\r\n};\r\nexport const longbow: ProductionDefinition = {\r\n    item: Item.longbow,\r\n    cost: {\r\n        resources: { wood: 40, iron: 5},\r\n        time: time.ONE_HOUR,\r\n    },\r\n};\r\nexport const poisonedDagger: ProductionDefinition = {\r\n    item: Item.poisonedDagger,\r\n    cost: {\r\n        resources: { wood: 50, iron: 15},\r\n        materials: [ Item.poisonVial ],\r\n        time: time.ONE_HOUR,\r\n    },\r\n};\r\nexport const dagger: ProductionDefinition = {\r\n    item: Item.dagger,\r\n    cost: {\r\n        resources: { wood: 10, iron: 10},\r\n        time: time.ONE_HOUR,\r\n    },\r\n};\r\nexport const sword: ProductionDefinition = {\r\n    item: Item.sword,\r\n    cost: {\r\n        resources: { wood: 10, iron: 30},\r\n        time:  time.ONE_HOUR,\r\n    },\r\n};\r\nexport const khopesh: ProductionDefinition = {\r\n    item: Item.khopesh,\r\n    cost: {\r\n        resources: { wood: 15, iron: 40},\r\n        time:  time.TWO_MINUTES,\r\n    },\r\n};\r\n","// tslint:disable:object-literal-sort-keys\r\n\r\nimport { crossbow, dagger, khopesh, longbow, poisonedDagger, sword } from \"../production/weapons\";\r\nimport { ProductionStructureDefinition, StructureType } from \"./types\";\r\n\r\nconst weaponsmith: ProductionStructureDefinition = {\r\n    type: StructureType.production,\r\n    cost: {\r\n        gold: 40,\r\n        time: 4000,\r\n    },\r\n    levels: [{\r\n        // level 1:\r\n        displayName: \"structure-weaponsmith-name\",\r\n        workerCapacity: 2,\r\n        cost: {\r\n            gold: 0,\r\n        },\r\n        produces: [crossbow, dagger],\r\n    }, {\r\n        // level 2:\r\n        displayName: \"structure-weaponsmith-name\",\r\n        workerCapacity: 5,\r\n        cost: {\r\n            gold: 30,\r\n        },\r\n        produces: [crossbow, dagger, longbow],\r\n    }, {\r\n        // level 3:\r\n        displayName: \"structure-weaponsmith-name\",\r\n        workerCapacity: 10,\r\n        cost: {\r\n            gold: 50,\r\n        },\r\n        produces: [crossbow, dagger, longbow, sword, khopesh],\r\n    }, {\r\n        // level 4:\r\n        displayName: \"structure-weaponsmith-name\",\r\n        workerCapacity: 14,\r\n        cost: {\r\n            gold: 50,\r\n        },\r\n        produces: [crossbow, dagger, longbow, sword, khopesh, poisonedDagger],\r\n    }],\r\n};\r\nexport default weaponsmith;\r\n","// tslint:disable:object-literal-sort-keys\r\nimport { ResourceStructureDefinition, StructureType } from \"./types\";\r\n\r\nconst weaver: ResourceStructureDefinition = {\r\n    cost: {\r\n        gold: 40,\r\n        time: 4000,\r\n    },\r\n    type: StructureType.resource,\r\n    levels: [{\r\n        displayName: \"structure-weaver-name\",\r\n        // level 0:\r\n        workerCapacity: 2,\r\n        cost: {\r\n            gold: 0,\r\n        },\r\n        generates: { fabric: 2 },\r\n    }, {\r\n        displayName: \"structure-weaver-name\",\r\n        // level 1:\r\n        workerCapacity: 5,\r\n        cost: {\r\n             gold: 30,\r\n        },\r\n        generates: { fabric: 5 },\r\n    }, {\r\n        displayName: \"structure-weaver-name\",\r\n        // level 2:\r\n        workerCapacity: 10,\r\n        cost: {\r\n             gold: 50,\r\n        },\r\n        generates: { fabric: 7 },\r\n    }],\r\n};\r\n\r\nexport default weaver;\r\n","// tslint:disable:object-literal-sort-keys\r\n// todo: maybe 'quest items' is not the right name\r\nimport * as time from \"utils/time\";\r\nimport { Item } from \"../items/types\";\r\nimport { ProductionDefinition } from \"./types\";\r\n\r\nexport const torch: ProductionDefinition = {\r\n    item: Item.torch,\r\n    cost: {\r\n        resources: { wood: 2, fabric: 1 },\r\n        time: time.ONE_MINUTE,\r\n    },\r\n};\r\n\r\nexport const sandwich: ProductionDefinition = {\r\n    item: Item.sandwich,\r\n    cost: {\r\n        resources: { food: 1 },\r\n        time: time.ONE_MINUTE / 2,\r\n    },\r\n};\r\n","// tslint:disable:object-literal-sort-keys\r\nimport { sandwich, torch } from \"definitions/production/questItems\";\r\nimport { ProductionStructureDefinition, StructureType } from \"./types\";\r\n\r\nconst workshop: ProductionStructureDefinition = {\r\n    type: StructureType.production,\r\n    cost: {\r\n        gold: 40,\r\n        time: 4000,\r\n    },\r\n    levels: [{\r\n        // level 1:\r\n        displayName: \"structure-workshop-name\",\r\n        workerCapacity: 2,\r\n        cost: {\r\n            gold: 0,\r\n        },\r\n        produces: [ torch, sandwich ],\r\n    }, {\r\n        // level 2:\r\n        displayName: \"structure-workshop-name\",\r\n        workerCapacity: 5,\r\n        cost: {\r\n            gold: 30,\r\n        },\r\n        produces: [],\r\n    }, {\r\n        // level 3:\r\n        displayName: \"structure-workshop-name\",\r\n        workerCapacity: 10,\r\n        cost: {\r\n            gold: 50,\r\n        },\r\n        produces: [],\r\n    }, {\r\n        // level 4:\r\n        displayName: \"structure-workshop-name\",\r\n        workerCapacity: 14,\r\n        cost: {\r\n            gold: 50,\r\n        },\r\n        produces: [],\r\n    }],\r\n};\r\nexport default workshop;\r\n","import { TextEntry } from \"constants/text\";\r\nimport itemDefinitions, { getDefinition } from \"definitions/items\";\r\nimport { Item, ItemType } from \"definitions/items/types\";\r\nimport { Resource } from \"definitions/resources\";\r\nimport { Structure } from \"definitions/structures\";\r\nimport * as Handlebars from \"handlebars\";\r\n\r\nexport abstract class TextManager {\r\n\r\n    public static init(texts: Record<string, string>, precompile = true) {\r\n        this.texts = texts;\r\n        this.templates = {};\r\n        if (precompile) {\r\n            this.compileAll();\r\n        }\r\n        this.initialized = true;\r\n    }\r\n\r\n//    public static addTexts(texts: Record<string, string>)\r\n    public static get(key: string, context?: any): string {\r\n        const result = this.getDefault(key, context);\r\n        if (result === null) {\r\n            // tslint:disable-next-line: no-console\r\n            console.error(`Key '${key}' not found in TextManager`);\r\n            return `<<'${key}' missing>>`;\r\n        } else {\r\n            return result;\r\n        }\r\n    }\r\n\r\n    // Will return `null` when no text found, otherwise will return the text\r\n    public static getDefault(key: string, context?: any): string|null {\r\n        if (!this.initialized) {\r\n            throw new Error(`Error ${this} not initialized!`);\r\n        }\r\n        const template = this.getTemplate(key);\r\n        if (!template) {\r\n            return null;\r\n        }\r\n        return template(context);\r\n    }\r\n\r\n    public static getTextEntry(textEntry: TextEntry): string {\r\n        return this.get(textEntry.key, textEntry.context);\r\n    }\r\n\r\n    public static getTemplate(key: string) {\r\n        let template = this.templates[key];\r\n        if (!template && this.texts[key]) {\r\n            // Template not found but key is defined. Needs to be compiled\r\n            this.compile(key, this.texts[key]);\r\n            template = this.templates[key];\r\n        }\r\n        return template;\r\n    }\r\n\r\n    public static getQuestTitle(name: string) {\r\n        return this.get(`quest-${name}-title`);\r\n    }\r\n\r\n    public static getQuestDescription(name: string) {\r\n        return this.get(`quest-${name}-description`);\r\n    }\r\n\r\n    public static getResourceName(type: Resource) {\r\n        return this.get(`resource-${type}-name`);\r\n    }\r\n\r\n    public static getItemName(item: Item): string {\r\n        const itemType = ItemType[getDefinition(item).itemType];\r\n        return this.get(`item-${itemType}-${item}-name`);\r\n    }\r\n    public static getItemSubtext(item: Item): string|null {\r\n        const itemType = ItemType[getDefinition(item).itemType];\r\n        return this.getDefault(`item-${itemType}-${item}-subtext`);\r\n    }\r\n\r\n    public static getStructureName(structure: Structure): string {\r\n        return this.get(`structure-${structure}-name`);\r\n    }\r\n\r\n    private static initialized = false;\r\n    private static texts: Record<string, string>;\r\n    private static templates: Record<string, Handlebars.TemplateDelegate<any>>;\r\n\r\n    private static compileAll() {\r\n        Object.keys(this.texts).forEach((key: string) =>  {\r\n            this.compile(key, this.texts[key]);\r\n        });\r\n    }\r\n\r\n    private static compile(key: string, value: string) {\r\n        const template = Handlebars.compile(value);\r\n        this.templates[key] = template;\r\n    }\r\n}\r\n\r\nHandlebars.registerHelper(\"item:name\", (item: Item, article?: string) => {\r\n    if (!itemDefinitions[item]) {\r\n        return new Handlebars.SafeString(`<<ITEM DEFINITION NOT FOUND: ${item}>>`);\r\n    }\r\n    switch (article) {\r\n        case \"aA\":  // article Auto\r\n            return itemArticleAuto(item);\r\n        case \"aD\":  // article Defined \"a sword\"\r\n            return itemArticleDefined(item);\r\n        case \"aU\":  // article Defined \"the sword\"\r\n            return itemArticleDefined(item);\r\n        default:\r\n            // No article\r\n            const name = itemDefinitions[item].name;\r\n            return new Handlebars.SafeString(name);\r\n    }\r\n});\r\nHandlebars.registerHelper(\"structure:name\", (structure: string) => {\r\n    const name = TextManager.get(`structure-${structure}-name`);\r\n    return new Handlebars.SafeString(name);\r\n});\r\n\r\nconst itemArticleAuto = (item: Item) => {\r\n    return itemArticleUndefined(item);\r\n};\r\n\r\nconst itemArticleUndefined = (item: Item) => {\r\n    const name = TextManager.getItemName(item);\r\n    const articleTemplate = TextManager.getTemplate(\"common-article-undefined\");\r\n    return new Handlebars.SafeString(`${articleTemplate({ noun: name})}`);\r\n};\r\n\r\nconst itemArticleDefined = (item: Item) => {\r\n    const name = TextManager.getItemName(item);\r\n    const articleTemplate = TextManager.getTemplate(\"common-article-defined\");\r\n    return new Handlebars.SafeString(`${articleTemplate({ noun: name})}`);\r\n};\r\n","import { QuestStoreState } from 'stores/quest';\r\nimport { Item } from 'definitions/items/types';\r\n\r\nexport enum QuestNodeType {\r\n    nothing = 0,    // Nothing much going on here\r\n    encounter = 1,\r\n    // combat = 2,     // Not implemented\r\n    // boss = 3,\r\n}\r\n\r\nexport interface QuestDefinition<TQuestVars = any> {\r\n    nodes: QuestNode[];\r\n    requiredItems?: Item[];\r\n    getQuestVars: (questStoreState: QuestStoreState) => TQuestVars;\r\n    getInitialQuestVars: (questStoreState: QuestStoreState) => TQuestVars;\r\n}\r\n\r\ntype AllNodeTypes = {\r\n    x: number;\r\n    y: number;\r\n    log?: string;   \r\n}\r\n\r\nexport type QuestNode  =\r\n    | AllNodeTypes & { type: QuestNodeType.nothing}\r\n    | AllNodeTypes & { type: QuestNodeType.encounter, startScene: string}\r\n","import { MediaItem } from \"components/preloading/Preloader\";\r\nimport { Howl } from \"howler\";\r\nimport localforage from 'localforage';\r\n\r\nexport enum MusicTrack {\r\n    town,\r\n    world,\r\n}\r\n\r\nexport enum Sound {\r\n    buttonClick,\r\n    error,\r\n    toast\r\n}\r\n\r\nlet media: MediaItem[];\r\n\r\nconst musicTracks: { [key: number]: Howl; } = {};\r\nlet currentMusicTrack: MusicTrack|null = null;\r\n\r\nconst sounds: { [key: number]: Howl; } = {};\r\nconst DEFAULT_MUSIC_VOLUME = 0.8;\r\nconst STORAGE_KEY_MUSIC_VOLUME = \"musicVolume\";\r\nconst DEFAULT_SOUND_VOLUME = 1;\r\nconst STORAGE_KEY_SOUND_VOLUME = \"soundVolume\";\r\n\r\nexport class SoundManager {\r\n    private static _musicVolume: number = DEFAULT_MUSIC_VOLUME;\r\n    private static _soundVolume: number = DEFAULT_SOUND_VOLUME;\r\n    private static _initialized = false;\r\n\r\n    public static async init() {\r\n        // Attempt to fetch volumes from storage. If not set, revert to defaults\r\n        this._musicVolume = await localforage.getItem(STORAGE_KEY_MUSIC_VOLUME);\r\n        this._soundVolume = await localforage.getItem(STORAGE_KEY_SOUND_VOLUME);\r\n        if (this._soundVolume === null) this._soundVolume = DEFAULT_SOUND_VOLUME;\r\n        if (this._musicVolume === null) this._musicVolume = DEFAULT_MUSIC_VOLUME;\r\n\r\n        this._initialized = true;\r\n    }\r\n\r\n    public static loadMedia(m: MediaItem[]) {\r\n        media = m;\r\n    }\r\n\r\n    public static addSounds(soundList: Record<Sound, string>) {\r\n        Object.entries(soundList).forEach(([key, value]) => {\r\n            // todo: assert [10/07/2019 ASSERTS]\r\n            sounds[key] = media.find((m) => m.url === value)!.content;\r\n        });\r\n    }\r\n\r\n    public static playSound(sound: Sound) {\r\n        const howl = sounds[sound];\r\n        howl.volume(this.soundVolume);\r\n        howl.play();\r\n    }\r\n\r\n    public static async addMusicTrack(track: MusicTrack, url: string) {\r\n        if (!media) { return; }\r\n        if (!this._initialized) {\r\n            await this.init();\r\n        }\r\n\r\n        const sound = media.find((m) => m.url === url);\r\n        if (!sound) {\r\n            throw new Error(`No sound found at ${url}`);\r\n        }\r\n        if (!musicTracks.hasOwnProperty(track)) {\r\n            musicTracks[track] = sound.content as Howl;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Fades out currently playing music and fades new music in\r\n     * @param track\r\n     */\r\n    public static async playMusicTrack(track: MusicTrack) {\r\n        if (!media) { return; }\r\n        if (!this._initialized) {\r\n            await this.init();\r\n        }\r\n\r\n        if (currentMusicTrack !== null) {\r\n            const currentMusic: Howl = musicTracks[currentMusicTrack];\r\n            console.log(SoundManager.musicVolume)\r\n            currentMusic.fade(SoundManager.musicVolume, 0, 500);\r\n        }\r\n        const nextMusic = musicTracks[track];\r\n        if (!nextMusic.playing()) {\r\n            nextMusic.loop(true);\r\n            nextMusic.play();\r\n        }\r\n        nextMusic.fade(0, SoundManager.musicVolume, 500);\r\n\r\n        currentMusicTrack = track;\r\n    }\r\n\r\n    static set soundVolume(volume: number) {\r\n        this._soundVolume = volume;\r\n        localforage.setItem(STORAGE_KEY_SOUND_VOLUME, volume);\r\n    }\r\n\r\n    static get soundVolume(): number {\r\n        return this._soundVolume;\r\n    }\r\n\r\n    static set musicVolume(volume: number) {\r\n        if (currentMusicTrack) {\r\n            musicTracks[currentMusicTrack].volume(volume);\r\n        }\r\n        this._musicVolume = volume;\r\n        localforage.setItem(STORAGE_KEY_MUSIC_VOLUME, volume);\r\n    }\r\n\r\n    static get musicVolume() : number {\r\n        return this._musicVolume;\r\n    }\r\n}\r\n","import { CostStoreState } from \"reducers\";\r\nimport { ResourceStoreState } from \"stores/resources\";\r\nimport { ProductionDefinition } from \"../production/types\";\r\n\r\nexport enum StructureType {\r\n    resource,\r\n    production,\r\n    tavern,\r\n    warehouse,\r\n}\r\n\r\nexport interface StructureDefinition {\r\n    type: StructureType;\r\n    cost: CostStoreState;\r\n    levels: StructureLevelDefinition[];\r\n}\r\n\r\nexport interface StructureLevelDefinition {\r\n    displayName: string;          // At this moment we can potentially support different names depending on the level\r\n                                  // of the structure. But this is not implemented because I feel it can cause confusion\r\n                                  // todo: REMOVE\r\n    cost: CostStoreState;                 // in gold\r\n    workerCapacity: number;       // number of workers that can work at this structure at this level\r\n}\r\n\r\nexport interface ResourceStructureDefinition extends StructureDefinition {\r\n    levels: ResourceStructureLevelDefinition[];\r\n}\r\n\r\nexport interface ResourceStructureLevelDefinition extends StructureLevelDefinition {\r\n    generates: ResourceStoreState;\r\n}\r\n\r\nexport interface ProductionStructureDefinition extends StructureDefinition {\r\n    levels: ProductionStructureLevelDefinition[];\r\n}\r\n\r\nexport interface ProductionStructureLevelDefinition extends StructureLevelDefinition {\r\n    produces: ProductionDefinition[];\r\n}\r\n\r\nexport interface WarehouseStructureDefinition extends StructureDefinition {\r\n    levels: WarehouseStructureLevelDefinition[];\r\n}\r\n\r\nexport interface WarehouseStructureLevelDefinition extends StructureLevelDefinition {\r\n    maxResources: ResourceStoreState;\r\n}\r\n\r\n// tslint:disable-next-line:no-empty-interface\r\nexport interface TavernStructureDefinition extends StructureDefinition {\r\n    levels: TavernStructureLevelDefinition[];\r\n}\r\n\r\nexport interface TavernStructureLevelDefinition extends StructureLevelDefinition {\r\n    rooms: number;\r\n}\r\n","// tslint:disable: object-literal-sort-keys\r\nexport enum Resource {\r\n    wood = \"wood\",\r\n    iron = \"iron\",\r\n    stone = \"stone\",\r\n    leather = \"leather\",\r\n    fabric = \"fabric\",\r\n    food = \"food\",\r\n}\r\n\r\nexport interface ResourceDefinition {\r\n    resource: Resource;\r\n    iconImg: string;\r\n}\r\n\r\nexport default {\r\n    [Resource.wood]: {\r\n        resource: Resource.wood,\r\n        iconImg: \"/img/resources/wood.png\",\r\n    },\r\n    [Resource.iron]: {\r\n        resource: Resource.iron,\r\n        iconImg: \"/img/resources/iron.png\",\r\n    },\r\n    [Resource.stone]: {\r\n        resource: Resource.stone,\r\n        iconImg: \"/img/resources/stone.png\",\r\n    },\r\n    [Resource.leather]: {\r\n        resource: Resource.leather,\r\n        iconImg: \"/img/resources/leather.png\",\r\n    },\r\n    [Resource.fabric]: {\r\n        resource: Resource.fabric,\r\n        iconImg: \"/img/resources/fabric.png\",\r\n    },\r\n    [Resource.food]: {\r\n        resource: Resource.food,\r\n        iconImg: \"/img/resources/food.png\",\r\n    },\r\n};\r\n","// Utilities for routing \r\n\r\nimport { Structure } from 'definitions/structures';\r\n\r\nexport const getWorldLink = () => `/world`;\r\nexport const getQuestLink = (questName: string) => `${getWorldLink()}/${questName}`;\r\n\r\nexport const getTownLink = () => `/town`;\r\nexport const getStructureLink = (structure: Structure) => `${getTownLink()}/${structure}`;\r\n","import { Action } from \"redux\";\r\nimport { AdventurerStoreState } from \"stores/adventurer\";\r\nimport { SceneAction, SceneStoreState, TileObject } from 'stores/scene';\r\nimport { Item } from 'definitions/items/types';\r\n\r\n// tslint:disable:object-literal-sort-keys\r\n\r\nexport enum ActionType {\r\n    launchQuest = \"launchQuest\",                            // Embark upon a new quest\r\n    updateQuestVars = \"updateQuestVars\",                    // ?\r\n    updateEncounterResult = \"updateEncounterResult\",        // unused?\r\n    startEncounter = \"startEncounter\",                      // unused! remove\r\n    setSceneName = \"setSceneName\",                          // Sets name of the current scene of a quest\r\n    setScene = \"setScene\",                                  // Fills in the scene of a quest\r\n    exitEncounter = \"exitEncounter\",                        // Encounter is complete, leave scene and continue on quest\r\n    updateQuests = \"updateQuests\",                          // unused! remove\r\n    enqueueSceneAction = \"enqueueSceneAction\",\r\n    completeSceneAction = \"completeSceneAction\",\r\n    updateSceneObjectAction = \"updateSceneObjectAction\",    // Updates a tile object on the scene. Can update any property except 'id'\r\n    takeGoldFromCache = \"takeGoldFromCache\",                // Takes *all* the gold from a cache\r\n    takeItemFromCache = \"takeItemFromCache\"                 // Takes an item from a cache\r\n}\r\n\r\nexport interface QuestAction extends Action<ActionType> {\r\n    questName: string;\r\n}\r\n\r\nexport interface QuestVarsAction extends QuestAction {\r\n    vars: any;\r\n}\r\n\r\nexport interface QuestLaunchAction extends QuestAction {\r\n    assignedAventurers: AdventurerStoreState[];\r\n}\r\n\r\nexport interface SetSceneNameAction extends QuestAction {\r\n    sceneName: string;\r\n}\r\n\r\nexport interface SetSceneAction extends QuestAction {\r\n    scene: SceneStoreState;\r\n}\r\n\r\nexport interface EnqueueSceneActionAction extends QuestAction {\r\n    sceneAction: SceneAction;\r\n}\r\n\r\nexport interface UpdateEncounterResultAction extends QuestAction {\r\n    nodeIndex: number;\r\n    result: string;\r\n}\r\n\r\nexport interface TakeGoldFromCacheAction extends QuestAction {\r\n    cacheName: string;\r\n}\r\n\r\nexport interface TakeItemFromCacheAction extends QuestAction {\r\n    cacheName: string;\r\n    item: Item;\r\n}\r\n\r\nexport interface UpdateSceneObjectAction extends QuestAction {\r\n    id: number;\r\n    object: Partial<Omit<TileObject, 'id'>>;\r\n}\r\n\r\nexport function launchQuest(questName: string, assignedAventurers: AdventurerStoreState[]): QuestLaunchAction {\r\n    return {\r\n        type: ActionType.launchQuest,\r\n        questName,\r\n        assignedAventurers,\r\n    };\r\n}\r\n\r\n/** Completes the current encounter so the party can continue the quest */\r\nexport function exitEncounter(quest: string): QuestAction {\r\n    return {\r\n        type: ActionType.exitEncounter,\r\n        questName: quest,\r\n    };\r\n}\r\n\r\nexport function updateQuestVars(quest: string, vars: any): QuestVarsAction {\r\n    return {\r\n        type: ActionType.updateQuestVars,\r\n        questName: quest,\r\n        vars,\r\n    };\r\n}\r\n\r\n// Scene stuff\r\n\r\nexport function setSceneName(questName: string, sceneName: string): SetSceneNameAction {\r\n    return {\r\n        type: ActionType.setSceneName,\r\n        questName,\r\n        sceneName,\r\n    };\r\n}\r\n\r\nexport function setScene(questName: string, scene: SceneStoreState): SetSceneAction {\r\n    return {\r\n        type: ActionType.setScene,\r\n        questName,\r\n        scene,\r\n    };\r\n}\r\n\r\nexport function enqueueSceneAction(quest: string, sceneAction: SceneAction): EnqueueSceneActionAction {\r\n    return {\r\n        type: ActionType.enqueueSceneAction,\r\n        questName: quest,\r\n        sceneAction,\r\n    };\r\n}\r\n\r\nexport function completeSceneAction(quest: string): QuestAction {\r\n    return {\r\n        type: ActionType.completeSceneAction,\r\n        questName: quest,\r\n    };\r\n}\r\n\r\nexport const updateSceneObjectAction = (questName: string, id: number, object: Partial<Omit<TileObject, 'id'>>): UpdateSceneObjectAction => {\r\n    return {\r\n        type: ActionType.updateSceneObjectAction,\r\n        questName,\r\n        id,\r\n        object\r\n    };\r\n}\r\n\r\nexport function updateEncounterResult(quest: string, nodeIndex: number, result: string): UpdateEncounterResultAction {\r\n    return {\r\n        type: ActionType.updateEncounterResult,\r\n        questName: quest,\r\n        nodeIndex,\r\n        result,\r\n    };\r\n}\r\n\r\nexport const takeGoldFromCache = (questName: string, cacheName: string): TakeGoldFromCacheAction => {\r\n   return {\r\n       type: ActionType.takeGoldFromCache,\r\n       questName,\r\n       cacheName\r\n   }\r\n}\r\n\r\nexport const takeItemFromCache = (questName: string, cacheName: string, item: Item): TakeItemFromCacheAction => {\r\n   return {\r\n       type: ActionType.takeItemFromCache,\r\n       questName,\r\n       cacheName,\r\n       item\r\n   }\r\n}","import { TextEntry } from \"constants/text\";\n\nexport enum LogChannel {\n    common,         // Only visible in 'all'\n    town,           // Visible in 'all' and town\n    quest,          // Visible in 'all' and the appropriate quest tab\n}\n\nexport interface LogEntry extends TextEntry {\n    time: number;\n    channel: LogChannel;\n    channelContext?: string;\n}\n","// tslint:disable:object-literal-sort-keys\r\n\r\nimport { Structure } from \"../structures\";\r\nimport { Item, ItemDefinition, ItemType } from \"./types\";\r\n\r\nconst itemType = ItemType.deed;\r\n\r\nexport interface DeedDefinition extends ItemDefinition {\r\n    structure: Structure;\r\n}\r\n\r\nexport const deedForLumbermill: DeedDefinition = {\r\n    item: Item.deedForLumbermill,\r\n    structure: Structure.lumberMill,\r\n    itemType,\r\n    iconImg: \"/img/items/deeds/deed.png\",\r\n};\r\n\r\nexport const deedForWeaponsmith: DeedDefinition = {\r\n    item: Item.deedForWeaponsmith,\r\n    structure: Structure.weaponsmith,\r\n    itemType,\r\n    iconImg: \"/img/items/deeds/deed.png\",\r\n};\r\n\r\nexport default {\r\n    deedForLumbermill,\r\n    deedForWeaponsmith,\r\n};\r\n","// tslint:disable:object-literal-sort-keys\n\nimport { Item, ItemType } from \"./types\";\n\nconst itemType = ItemType.material;\nconst basePath = \"/img/items/materials/\";\n\nexport default {\n    [Item.arrowheads]: {\n        item: Item.arrowheads,\n        itemType,\n        iconImg: `${basePath}arrowheads.png`,\n    },\n    [Item.bolts]: {\n        item: Item.bolts,\n        itemType,\n        iconImg: `${basePath}bolts.png`,\n    },\n    [Item.buckle]: {\n        item: Item.buckle,\n        itemType,\n        iconImg: `${basePath}buckle.png`,\n    },\n    [Item.chain]: {\n        item: Item.chain,\n        itemType,\n        iconImg: `${basePath}chain.png`,\n    },\n    [Item.cogs]: {\n        item: Item.cogs,\n        itemType,\n        iconImg: `${basePath}cogs.png`,\n    },\n    [Item.gem]: {\n        item: Item.gem,\n        itemType,\n        iconImg: `${basePath}gem.png`,\n    },\n    [Item.ingot]: {\n        item: Item.ingot,\n        itemType,\n        iconImg: `${basePath}ingot.png`,\n    },\n    [Item.nails]: {\n        item: Item.nails,\n        itemType,\n        iconImg: `${basePath}nails.png`,\n    },\n    [Item.poisonVial]: {\n        item: Item.poisonVial,\n        itemType,\n        iconImg: `${basePath}poison-vial.png`,\n    },\n    [Item.ribbon]: {\n        item: Item.ribbon,\n        itemType,\n        iconImg: `${basePath}ribbon.png`,\n    },\n    [Item.rope]: {\n        item: Item.rope,\n        itemType,\n        iconImg: `${basePath}rope.png`,\n    },\n    [Item.gem]: {\n        item: Item.gem,\n        itemType,\n        iconImg: `${basePath}gem.png`,\n    },\n    [Item.gunpowder]: {\n        item: Item.gunpowder,\n        itemType,\n        iconImg: `${basePath}gunpowder.png`,\n    },\n    [Item.scales]: {\n        item: Item.scales,\n        itemType,\n        iconImg: `${basePath}scales.png`,\n    },\n    [Item.spring]: {\n        item: Item.spring,\n        itemType,\n        iconImg: `${basePath}spring.png`,\n    },\n    [Item.thread]: {\n        item: Item.thread,\n        itemType,\n        iconImg: `${basePath}thread.png`,\n    },\n};\n","// tslint:disable:object-literal-sort-keys\r\n\r\nimport { Item, ItemDefinition, ItemType } from \"./types\";\r\n\r\nconst itemType = ItemType.questItem;\r\nconst basePath = \"/img/items/quest-items/\";\r\n\r\nconst questItemDefinitions: Record<string, ItemDefinition> = {\r\n    [Item.blueprints]: {\r\n        item: Item.blueprints,\r\n        itemType,\r\n        iconImg: `${basePath}blueprints.png`,\r\n    },\r\n    [Item.crate]: {\r\n        item: Item.crate,\r\n        itemType,\r\n        iconImg: `${basePath}crate.png`,\r\n    },\r\n    [Item.dynamite]: {\r\n        item: Item.dynamite,\r\n        itemType,\r\n        iconImg: `${basePath}dynamite.png`,\r\n    },\r\n    [Item.dragonEye]: {\r\n        item: Item.dragonEye,\r\n        itemType,\r\n        iconImg: `${basePath}dragon-eye.png`,\r\n    },\r\n    [Item.eye]: {\r\n        item: Item.eye,\r\n        itemType,\r\n        iconImg: `${basePath}eye.png`,\r\n    },\r\n    [Item.feather]: {\r\n        item: Item.feather,\r\n        itemType,\r\n        iconImg: `${basePath}feather.png`,\r\n    },\r\n    [Item.food]: {\r\n        item: Item.food,\r\n        itemType,\r\n        iconImg: `${basePath}food.png`,\r\n    },\r\n    [Item.heart]: {\r\n        item: Item.heart,\r\n        itemType,\r\n        iconImg: `${basePath}heart.png`,\r\n    },\r\n    [Item.horn]: {\r\n        item: Item.horn,\r\n        itemType,\r\n        iconImg: `${basePath}horn.png`,\r\n    },\r\n    [Item.key]: {\r\n        item: Item.key,\r\n        itemType,\r\n        iconImg: `${basePath}key.png`,\r\n    },\r\n    [Item.letters]: {\r\n        item: Item.letters,\r\n        itemType,\r\n        iconImg: `${basePath}letters.png`,\r\n    },\r\n    [Item.lockPicks]: {\r\n        item: Item.lockPicks,\r\n        itemType,\r\n        iconImg: `${basePath}lock-picks.png`,\r\n    },\r\n    [Item.oil]: {\r\n        item: Item.oil,\r\n        itemType,\r\n        iconImg: `${basePath}oil.png`,\r\n    },\r\n    [Item.orcFinger]: {\r\n        item: Item.orcFinger,\r\n        itemType,\r\n        iconImg: `${basePath}orc-finger.png`,\r\n    },\r\n    [Item.plans]: {\r\n        item: Item.plans,\r\n        itemType,\r\n        iconImg: `${basePath}plans.png`,\r\n    },\r\n    [Item.purpleGems]: {\r\n        item: Item.purpleGems,\r\n        itemType,\r\n        iconImg: `${basePath}purple-gems.png`,\r\n    },\r\n    [Item.runestone]: {\r\n        item: Item.runestone,\r\n        itemType,\r\n        iconImg: `${basePath}runestone.png`,\r\n    },\r\n    [Item.sandwich]: {\r\n        item: Item.sandwich,\r\n        itemType,\r\n        iconImg: `${basePath}sandwich.png`,\r\n    },\r\n    [Item.teeth]: {\r\n        item: Item.teeth,\r\n        itemType,\r\n        iconImg: `${basePath}teeth.png`,\r\n    },\r\n    [Item.tooth]: {\r\n        item: Item.tooth,\r\n        itemType,\r\n        iconImg: `${basePath}tooth.png`,\r\n    },\r\n    [Item.torch]: {\r\n        item: Item.torch,\r\n        itemType,\r\n        iconImg: `${basePath}torch.png`,\r\n    },\r\n    [Item.tusk]: {\r\n        item: Item.tusk,\r\n        itemType,\r\n        iconImg: `${basePath}tusk.png`,\r\n    },\r\n    [Item.vase]: {\r\n        item: Item.vase,\r\n        itemType,\r\n        iconImg: `${basePath}vase.png`,\r\n    },\r\n    [Item.vial]: {\r\n        item: Item.vial,\r\n        itemType,\r\n        iconImg: `${basePath}vial.png`,\r\n    },\r\n    [Item.weeds]: {\r\n        item: Item.weeds,\r\n        itemType,\r\n        iconImg: `${basePath}weeds.png`,\r\n    },\r\n};\r\n\r\nexport default questItemDefinitions;\r\n","// tslint:disable:object-literal-sort-keys\n\nimport { Item, ItemDefinition, ItemType } from \"./types\";\n\nconst itemType = ItemType.trinket;\nconst basePath = \"/img/items/trinkets/\";\n\nconst trinketDefinitions: Record<string, ItemDefinition> = {\n    [Item.magicAmulet]: {\n        item: Item.magicAmulet,\n        itemType,\n        iconImg: `${basePath}magic_amulet.png`,\n    },\n    [Item.ring]: {\n        item: Item.ring,\n        itemType,\n        iconImg: `${basePath}ring.png`,\n    },\n};\n\nexport default trinketDefinitions;\n","import apparel from \"./apparel\";\nimport deeds from \"./deeds\";\nimport materials from \"./materials\";\nimport questItems from \"./questItems\";\nimport trinkets from \"./trinkets\";\nimport { Item, ItemDefinition } from \"./types\";\nimport weapons from \"./weapons\";\n\nconst all = {\n    ...deeds,\n    ...apparel,\n    ...materials,\n    ...questItems,\n    ...trinkets,\n    ...weapons,\n};\n\nexport default all;\n\nexport function getDefinition(item: Item): ItemDefinition {\n    return all[item];\n}\n","import { TextManager } from 'global/TextManager';\r\n\r\nexport const ONE_SECOND = 1000;\r\nexport const TWO_SECONDS = 2000;\r\nexport const THREE_SECONDS = 3000;\r\nexport const FOUR_SECONDS = 4000;\r\n// ...\r\nexport const TEN_SECONDS = 10000;\r\nexport const TWENTY_SECONDS = 20000;\r\nexport const THIRTY_SECONDS = 30000;\r\n\r\nexport const ONE_MINUTE = 60000;\r\nexport const TWO_MINUTES = 120000;\r\nexport const THREE_MINUTES = 180000;\r\nexport const FOUR_MINUTES = 240000;\r\n\r\nexport const HALF_HOUR = ONE_MINUTE * 30;\r\nexport const ONE_HOUR = ONE_MINUTE * 60;\r\nexport const ONE_DAY = ONE_HOUR * 24;\r\nexport const ONE_YEAR = ONE_DAY * 265.25;\r\n\r\nexport const formatDuration = (ms: number): string => {\r\n    const timeUnitsList = [\r\n        { unit: 'year', amount: ONE_YEAR },\r\n        { unit: 'day', amount: ONE_DAY },\r\n        { unit: 'hour', amount: ONE_HOUR },\r\n        { unit: 'minute', amount: ONE_MINUTE },\r\n        { unit: 'second', amount: ONE_SECOND },\r\n    ]\r\n    let time = Math.abs(ms);\r\n    const output: string[] = [];\r\n    timeUnitsList.forEach((el) => {\r\n        const tmp = Math.floor(time / el.amount);\r\n        time -= tmp * el.amount\r\n        if (tmp !== 0) {\r\n            const unit = TextManager.get(`common-time-${el.unit}${tmp > 1 ? \"-plural\": \"\"}`);\r\n            output.push(`${tmp} ${unit}`);\r\n        }\r\n    })\r\n    return output.join(\" \");\r\n}\r\n","import { Type } from '../components/ui/toasts/Toast';\r\nimport EventEmitter from './EventEmitter';\r\nimport { SoundManager, Sound } from './SoundManager';\r\n\r\nexport interface ToastConfig {\r\n    time: number;\r\n    title: string;\r\n    type?: Type;\r\n    icon?: string;\r\n    link?: string;\r\n}\r\n\r\nexport abstract class ToastManager extends EventEmitter<ToastConfig[]>() {\r\n\r\n    private static stack: ToastConfig[] = [];\r\n    private static lifeTime = 5000; // Time each toast lives\r\n\r\n    static EVENT_TOASTS_UPDATED = \"toast\";\r\n\r\n    static addToast(title: string, type?: Type, icon?: string, link?: string) {\r\n\r\n        this.stack = [...this.stack, {\r\n            time: Date.now(),\r\n            title,\r\n            type,\r\n            icon,\r\n            link\r\n        }];\r\n\r\n        this.emit(this.EVENT_TOASTS_UPDATED, this.stack);\r\n\r\n        SoundManager.playSound(Sound.toast);\r\n\r\n        setTimeout(() => {\r\n            // Remove all popups that have expired\r\n            this.stack = this.stack.filter((toast) => {\r\n                return Date.now() - toast.time < this.lifeTime\r\n            });\r\n            this.emit(this.EVENT_TOASTS_UPDATED, this.stack);\r\n\r\n        }, this.lifeTime);\r\n    }\r\n}","import { Action } from \"redux\";\r\nimport { LogChannel } from \"stores/logEntry\";\r\nimport { TextEntry } from 'constants/text';\r\n\r\nexport enum ActionType {\r\n    addLogEntry = \"addLogEntry\",\r\n}\r\n\r\nexport interface AddLogEntryAction extends Action<ActionType> {\r\n    entry: TextEntry;\r\n    channel: LogChannel;\r\n    channelContext?: string;\r\n}\r\n\r\nexport function addLogText(key: string, context?: any, channel: LogChannel = LogChannel.common, channelContext?: string): AddLogEntryAction {\r\n    const entry: TextEntry = {\r\n        key,\r\n        context\r\n    };\r\n    return {\r\n        type: ActionType.addLogEntry,\r\n        entry,\r\n        channel,\r\n        channelContext,\r\n    };\r\n}\r\n\r\nexport function addLogEntry(entry: TextEntry, channel: LogChannel = LogChannel.common, channelContext?: string): AddLogEntryAction {\r\n    return {\r\n        type: ActionType.addLogEntry,\r\n        entry,\r\n        channel,\r\n        channelContext,\r\n    };\r\n}\r\n","import React from 'react';\r\nimport { TextManager } from 'global/TextManager';\r\nimport { ToastConfig } from 'global/ToastManager';\r\nimport { useHistory } from 'react-router';\r\n\r\ntype Props = ToastConfig;\r\n\r\nexport enum Type {\r\n    achievementUnlocked,\r\n    cheat,\r\n    itemCrafted,\r\n    questCompleted,\r\n    questEncounter,\r\n    questLaunched,\r\n    questUpdate,\r\n}\r\n\r\nconst Toast = (props: Props) => {\r\n    const { \r\n        title,\r\n        type = Type.achievementUnlocked,\r\n        icon = \"/img/items/quest-items/dragon-eye.png\",\r\n        link\r\n    } = props;\r\n    const history = useHistory();\r\n\r\n    const handleClick = () => {\r\n        if (link) {\r\n            history.push(link);\r\n        }\r\n    }\r\n\r\n    const typeText = TextManager.get(`ui-toast-type-${Type[type]}`)\r\n    return (\r\n        <div className={`toast ${link && \"withlink\"}`} onClick={handleClick}>\r\n            <div className=\"label type\">{typeText}</div>\r\n            <div className=\"label title app-h2-white\">{title}</div>\r\n            <div className=\"icon\">\r\n                <div className=\"background\"/>\r\n                <img className=\"image\" width=\"300\" alt=\"dragon eye\" src={`${process.env.PUBLIC_URL}${icon}`} />\r\n                <div className=\"foreground\"/>\r\n            </div>\r\n            <div className=\"banner\"/>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default Toast;","import { QuestStoreState } from 'stores/quest';\r\nimport { QuestDefinition, QuestNodeType } from '../types';\r\nimport { initialQuestVars, Kill10BoarsQuestVars } from './questVars';\r\n\r\n\r\nconst kill10Boars: QuestDefinition<Kill10BoarsQuestVars> = {\r\n    getQuestVars: (questStore: QuestStoreState) => questStore.questVars as Kill10BoarsQuestVars,\r\n    getInitialQuestVars: (questStore: QuestStoreState) => {\r\n        return initialQuestVars;\r\n    },\r\n    nodes: [{\r\n        x: 0,\r\n        y: 1,\r\n        type: QuestNodeType.nothing,\r\n        log: \"quest-kill10Boars-node0\",\r\n    }, {\r\n        x: 0,\r\n        y: 2,\r\n        type: QuestNodeType.nothing,\r\n    }, {\r\n        x: 0,\r\n        y: 3,\r\n        type: QuestNodeType.nothing,\r\n    }, {\r\n        x: 0,\r\n        y: 4,\r\n        type: QuestNodeType.nothing,\r\n    }, {\r\n        x: 0,\r\n        y: 3,\r\n        type: QuestNodeType.encounter,\r\n        // log: \"quest-kill10Boars-enter-dungeon\",\r\n        startScene: \"dungeon.entrance\"\r\n    }, {\r\n        x: 1,\r\n        y: 3,\r\n        type: QuestNodeType.nothing,\r\n        log: \"quest-kill10Boars-leave-dungeon\",\r\n    }, {\r\n        x: 1,\r\n        y: 3,\r\n        type: QuestNodeType.nothing,\r\n        log: \"quest-kill10Boars-left-dungeon\"\r\n    }, {\r\n        x: 2,\r\n        y: 3,\r\n        type: QuestNodeType.nothing,\r\n    }, {\r\n        x: 3,\r\n        y: 3,\r\n        type: QuestNodeType.encounter,\r\n        startScene: \"dungeon.hallway\"\r\n\r\n        //encounter: Encounter.backstabbed,\r\n    }, {\r\n        x: 4,\r\n        y: 4,\r\n        type: QuestNodeType.nothing,\r\n        log: \"The party spots a boss\",\r\n    }, {\r\n        x: 5,\r\n        y: 4,\r\n        type: QuestNodeType.nothing,\r\n    }],\r\n};\r\n\r\nexport default kill10Boars;","import kill10Boars from './kill10Boars';\r\nimport retrieveMagicAmulet from './retrieveMagicAmulet';\r\nimport { QuestDefinition } from './types';\r\n\r\n// tslint:disable:object-literal-sort-keys\r\n\r\n\r\n\r\n\r\n\r\n// const fulruhmRaid: QuestDefinition = {\r\n//     nodes: [{\r\n//         x: -4,\r\n//         y: -1,\r\n//         type: QuestNodeType.nothing,\r\n//     }, {\r\n//         x: -4,\r\n//         y: -1,\r\n//         type: QuestNodeType.nothing,\r\n\r\nconst all = {\r\n    kill10Boars,\r\n    retrieveMagicAmulet,\r\n};\r\n\r\nexport default all;\r\n\r\nexport function getDefinition<T>(questName: string): QuestDefinition<T> {\r\n    return all[questName];\r\n}\r\n","import { QuestStoreState } from 'stores/quest';\r\nimport { Item } from 'definitions/items/types';\r\nimport { QuestDefinition, QuestNodeType } from '../types';\r\n\r\nexport interface RetrieveMagicAmuletQuestVars {\r\n    baz: boolean;\r\n    zux: number;\r\n}\r\n\r\nconst retrieveMagicAmulet: QuestDefinition<RetrieveMagicAmuletQuestVars> = {\r\n    getQuestVars: (questStore: QuestStoreState) => questStore.questVars as RetrieveMagicAmuletQuestVars,\r\n    getInitialQuestVars: (questStore: QuestStoreState) => {\r\n        const vars: RetrieveMagicAmuletQuestVars = {\r\n            baz: false,\r\n            zux: 13\r\n        }\r\n        return vars;\r\n    },\r\n    requiredItems: [\r\n        Item.torch,\r\n        Item.torch,\r\n        Item.torch,\r\n        Item.sandwich,\r\n        Item.sandwich,\r\n    ],\r\n    nodes: [{\r\n        x: 0,\r\n        y: 1,\r\n        type: QuestNodeType.nothing,\r\n    }, {\r\n        x: 1,\r\n        y: 1,\r\n        type: QuestNodeType.nothing,\r\n    }, {\r\n        x: 2,\r\n        y: 1,\r\n        type: QuestNodeType.nothing,\r\n    }, {\r\n        x: 3,\r\n        y: 1,\r\n        type: QuestNodeType.nothing,\r\n    }, {\r\n        x: 4,\r\n        y: 1,\r\n        type: QuestNodeType.nothing,\r\n    }, {\r\n        x: 5,\r\n        y: 1,\r\n        type: QuestNodeType.nothing,\r\n    }, {\r\n        x: 7,\r\n        y: 1,\r\n        type: QuestNodeType.nothing,\r\n    }, {\r\n        x: 8,\r\n        y: 2,\r\n        type: QuestNodeType.nothing,\r\n    }, {\r\n        x: 8,\r\n        y: 3,\r\n        type: QuestNodeType.nothing,\r\n    }, {\r\n        x: 9,\r\n        y: 3,\r\n        type: QuestNodeType.nothing,\r\n    }, {\r\n        x: 10,\r\n        y: 1,\r\n        type: QuestNodeType.nothing,\r\n    }, {\r\n        x: 10,\r\n        y: 2,\r\n        type: QuestNodeType.nothing,\r\n    }, {\r\n        x: 10,\r\n        y: 3,\r\n        type: QuestNodeType.nothing,\r\n    }, {\r\n        x: 10,\r\n        y: 4,\r\n        type: QuestNodeType.nothing,\r\n    }, {\r\n        x: 11,\r\n        y: 5,\r\n        type: QuestNodeType.nothing,\r\n    }, {\r\n        x: 12,\r\n        y: 6,\r\n        type: QuestNodeType.nothing,\r\n    }, {\r\n        x: 12,\r\n        y: 7,\r\n        type: QuestNodeType.nothing,\r\n    }, {\r\n        x: 13,\r\n        y: 8,\r\n        type: QuestNodeType.nothing,\r\n    }, {\r\n        x: 12,\r\n        y: 8,\r\n        type: QuestNodeType.nothing,\r\n    }, {\r\n        x: 12,\r\n        y: 9,\r\n        type: QuestNodeType.nothing,\r\n    }, {\r\n        x: 11,\r\n        y: 8,\r\n        type: QuestNodeType.nothing,\r\n    }, {\r\n        x: 10,\r\n        y: 8,\r\n        type: QuestNodeType.nothing,\r\n    }, {\r\n        x: 9,\r\n        y: 8,\r\n        type: QuestNodeType.nothing,\r\n    }, {\r\n        x: 8,\r\n        y: 9,\r\n        type: QuestNodeType.nothing,\r\n    }, {\r\n        x: 7,\r\n        y: 8,\r\n        type: QuestNodeType.encounter,\r\n        startScene: \"dungeon.hallway\"\r\n    }, {\r\n        x: 8,\r\n        y: 1,\r\n        type: QuestNodeType.nothing,\r\n    }, {\r\n        x: 1,\r\n        y: 1,\r\n        type: QuestNodeType.nothing,\r\n    }, {\r\n        x: 1,\r\n        y: 1,\r\n        type: QuestNodeType.nothing,\r\n    }, {\r\n        x: 1,\r\n        y: 1,\r\n        type: QuestNodeType.nothing,\r\n    }, {\r\n        x: 1,\r\n        y: 1,\r\n        type: QuestNodeType.nothing,\r\n    }, {\r\n        x: 1,\r\n        y: 1,\r\n        type: QuestNodeType.nothing,\r\n    }, {\r\n        x: 1,\r\n        y: 1,\r\n        type: QuestNodeType.nothing,\r\n    }, {\r\n        x: 1,\r\n        y: 1,\r\n        type: QuestNodeType.nothing,\r\n    }, {\r\n        x: 1,\r\n        y: 1,\r\n        type: QuestNodeType.nothing,\r\n    }, {\r\n        x: 2,\r\n        y: 1,\r\n        type: QuestNodeType.encounter,\r\n        startScene: \"dungeon.hallway\"\r\n    }, {\r\n        x: 3,\r\n        y: 1,\r\n        type: QuestNodeType.nothing,\r\n    }],\r\n};\r\n\r\nexport default retrieveMagicAmulet;","import { StoreState } from \"stores\";\r\nimport { AdventurerStoreState } from \"stores/adventurer\";\r\nimport { QuestStoreState } from \"stores/quest\";\r\n\r\n// export const adventurersInParty = (store: StoreState, partyId: string): AdventurerStoreState[] => {\r\n//     const party: PartyStoreState = store.parties[partyId];\r\n//     return party.adventurers.map((id: string) => findAdventurerById(store, id)!);\r\n// };\r\n\r\nexport const adventurersOnQuest = (adventurers: AdventurerStoreState[], quest: QuestStoreState): AdventurerStoreState[] => {\r\n    return quest.party.map((id: string) => findAdventurerById(adventurers, id)!);\r\n};\r\n\r\nexport const getQuestLeader = (adventurers: AdventurerStoreState[], quest: QuestStoreState): AdventurerStoreState | undefined => {\r\n    const leaderId = quest.party[0];\r\n    return findAdventurerById(adventurers, leaderId);\r\n}\r\n\r\nexport const findAdventurerById = (adventurers: AdventurerStoreState[], id: string): AdventurerStoreState | undefined => {\r\n    return adventurers.find((a) => a.id === id);\r\n};\r\n\r\n/**\r\n * Returns the amount of free inventory slots on this adventurer\r\n */\r\nexport const adventurerFreeInventorySlots = (adventurer: AdventurerStoreState): number => {\r\n    return adventurer.inventory.filter(i => i === null).length;\r\n};\r\n\r\nexport const storeIsRehydrated = (store: StoreState): boolean => {\r\n    // Returns a value indicating whether this store is fresh or rehydrated\r\n    // Probably I should find a more solid way to do this\r\n    return !!store.rngState;\r\n};\r\n\r\n","import { LoaderResource } from 'pixi.js';\r\n\r\ninterface Location {\r\n    x: number;\r\n    y: number;\r\n}\r\n\r\nexport const lerpLocation = (point1: Location, point2: Location, alpha: number): Location => {\r\n    const x = lerp(point1.x, point2.x, alpha);\r\n    const y = lerp(point1.y, point2.y, alpha);\r\n    return { x, y };\r\n}\r\n\r\nconst lerp = (n1: number,  n2: number,  alpha: number) =>  {\r\n    return n1 + alpha * (n2 - n1);\r\n}\r\n\r\n// Uses the shared pixi loader to load a resource\r\nexport async function loadResourceAsync(path: string) { \r\n    const loader = PIXI.Loader.shared;\r\n    return new Promise<LoaderResource>((resolve, reject) => {\r\n        if (loader.resources[path]) {\r\n            resolve(loader.resources[path]);\r\n        }\r\n        else { \r\n            loader.add(path).load((_, resources) => {\r\n                resolve(resources[path]);            \r\n            });    \r\n        }\r\n    });\r\n}\r\n\r\nexport const loadResource = (path: string, callback: (resource: LoaderResource) => void) => { \r\n    const loader = PIXI.Loader.shared;\r\n    if (loader.resources[path]) {\r\n        callback(loader.resources[path]);\r\n        return;\r\n    }\r\n    loader.add(path).load((_, resources) => { callback(resources[path]!)});\r\n}","// tslint:disable:object-literal-sort-keys\r\nimport { Item, ItemDefinition, ItemType } from \"./types\";\r\n\r\nconst itemType = ItemType.apparel;\r\nconst basePath = \"/img/items/apparel/\";\r\n\r\nexport enum ApparelType {\r\n    feet,\r\n    hands,\r\n    chest,\r\n    legs,\r\n    head,\r\n    shoulders,\r\n}\r\n\r\nexport interface ApparelDefinition extends ItemDefinition {\r\n    equipmentType: ApparelType;\r\n    armourRating?: number;\r\n}\r\n\r\nconst all: Record<string, ApparelDefinition> = {\r\n    [Item.boots1]: {\r\n        item: Item.boots1,\r\n        equipmentType: ApparelType.feet,\r\n        itemType,\r\n        iconImg: `${basePath}boots_1.png`,\r\n    },\r\n    [Item.boots2]: {\r\n        item: Item.boots2,\r\n        equipmentType: ApparelType.feet,\r\n        itemType,\r\n        iconImg: `${basePath}boots_2.png`,\r\n    },\r\n    [Item.boots3]: {\r\n        item: Item.boots3,\r\n        equipmentType: ApparelType.feet,\r\n        itemType,\r\n        iconImg: `${basePath}boots_3.png`,\r\n    },\r\n    [Item.chainmailHood]: {\r\n        item: Item.chainmailHood,\r\n        equipmentType: ApparelType.head,\r\n        itemType,\r\n        iconImg: `${basePath}chainmail_hood.png`,\r\n        armourRating: 3,\r\n    },\r\n    [Item.chest]: {\r\n        item: Item.chest,\r\n        equipmentType: ApparelType.chest,\r\n        itemType,\r\n        iconImg: `${basePath}chest_1.png`,\r\n        armourRating: 2,\r\n    },\r\n    [Item.clothGloves]: {\r\n        item: Item.clothGloves,\r\n        equipmentType: ApparelType.hands,\r\n        itemType,\r\n        iconImg: `${basePath}cloth_gloves.png`,\r\n    },\r\n    [Item.cowl]: {\r\n        item: Item.cowl,\r\n        equipmentType: ApparelType.head,\r\n        itemType,\r\n        iconImg: `${basePath}cowl.png`,\r\n        armourRating: 20,\r\n    },\r\n    [Item.druidChest]: {\r\n        item: Item.druidHands,\r\n        equipmentType: ApparelType.chest,\r\n        itemType,\r\n        iconImg: `${basePath}druid-chest.png`,\r\n    },\r\n    [Item.druidFeet]: {\r\n        item: Item.druidFeet,\r\n        equipmentType: ApparelType.feet,\r\n        itemType,\r\n        iconImg: `${basePath}druid-feet.png`,\r\n    },\r\n    [Item.druidHands]: {\r\n        item: Item.druidHands,\r\n        equipmentType: ApparelType.hands,\r\n        itemType,\r\n        iconImg: `${basePath}druid-hands.png`,\r\n    },\r\n    [Item.druidHead]: {\r\n        item: Item.druidHead,\r\n        equipmentType: ApparelType.head,\r\n        itemType,\r\n        iconImg: `${basePath}druid-head.png`,\r\n    },\r\n    [Item.druidLegs]: {\r\n        item: Item.druidLegs,\r\n        equipmentType: ApparelType.legs,\r\n        itemType,\r\n        iconImg: `${basePath}druid-legs.png`,\r\n    },\r\n    [Item.fedora]: {\r\n        item: Item.fedora,\r\n        equipmentType: ApparelType.head,\r\n        itemType,\r\n        iconImg: `${basePath}fedora.png`,\r\n    },\r\n    [Item.greaves1]: {\r\n        item: Item.greaves1,\r\n        equipmentType: ApparelType.feet,\r\n        itemType,\r\n        iconImg: `${basePath}greaves_1.png`,\r\n        armourRating: 10,\r\n    },\r\n    [Item.greaves2]: {\r\n        item: Item.greaves2,\r\n        equipmentType: ApparelType.hands,\r\n        itemType,\r\n        iconImg: `${basePath}greaves_2.png`,\r\n    },\r\n    [Item.hornedHelmet]: {\r\n        item: Item.hornedHelmet,\r\n        equipmentType: ApparelType.head,\r\n        itemType,\r\n        iconImg: `${basePath}horned_helmet.png`,\r\n    },\r\n    [Item.leatherGloves]: {\r\n        item: Item.leatherGloves,\r\n        equipmentType: ApparelType.hands,\r\n        itemType,\r\n        iconImg: `${basePath}leather_gloves.png`,\r\n    },\r\n    [Item.nomadHelmet]: {\r\n        item: Item.nomadHelmet,\r\n        equipmentType: ApparelType.head,\r\n        itemType,\r\n        iconImg: `${basePath}nomad_helmet.png`,\r\n    },\r\n    [Item.pants1]: {\r\n        item: Item.pants1,\r\n        equipmentType: ApparelType.legs,\r\n        itemType,\r\n        iconImg: `${basePath}pants_1.png`,\r\n        armourRating: 10,\r\n    },\r\n    [Item.pants2]: {\r\n        item: Item.pants2,\r\n        equipmentType: ApparelType.legs,\r\n        itemType,\r\n        iconImg: `${basePath}pants_2.png`,\r\n    },\r\n    [Item.plateChest1]: {\r\n        item: Item.plateChest1,\r\n        equipmentType: ApparelType.chest,\r\n        itemType,\r\n        iconImg: `${basePath}plate_chest_1.png`,\r\n    },\r\n    [Item.plateChest2]: {\r\n        item: Item.plateChest2,\r\n        equipmentType: ApparelType.chest,\r\n        itemType,\r\n        iconImg: `${basePath}plate_chest_2.png`,\r\n    },\r\n    [Item.plateChest3]: {\r\n        item: Item.plateChest3,\r\n        equipmentType: ApparelType.chest,\r\n        itemType,\r\n        iconImg: `${basePath}plate_chest_3.png`,\r\n    },\r\n    [Item.plateChest4]: {\r\n        item: Item.plateChest4,\r\n        equipmentType: ApparelType.chest,\r\n        itemType,\r\n        iconImg: `${basePath}plate_chest_4.png`,\r\n    },\r\n    [Item.plateGloves1]: {\r\n        item: Item.plateGloves1,\r\n        equipmentType: ApparelType.hands,\r\n        itemType,\r\n        iconImg: `${basePath}plate_gloves_1.png`,\r\n    },\r\n    [Item.plateGloves2]: {\r\n        item: Item.plateGloves2,\r\n        equipmentType: ApparelType.hands,\r\n        itemType,\r\n        iconImg: `${basePath}plate_gloves_2.png`,\r\n    },\r\n    [Item.plateHelmet]: {\r\n        item: Item.plateHelmet,\r\n        equipmentType: ApparelType.head,\r\n        itemType,\r\n        iconImg: `${basePath}plate_helmet_1.png`,\r\n    },\r\n    [Item.platePants]: {\r\n        item: Item.platePants,\r\n        equipmentType: ApparelType.legs,\r\n        itemType,\r\n        iconImg: `${basePath}plate_pants1.png`,\r\n    },\r\n    [Item.plateShoulders1]: {\r\n        item: Item.plateShoulders1,\r\n        equipmentType: ApparelType.shoulders,\r\n        itemType,\r\n        iconImg: `${basePath}plate_shoulders_1.png`,\r\n    },\r\n    [Item.plateShoulders2]: {\r\n        item: Item.plateShoulders2,\r\n        equipmentType: ApparelType.shoulders,\r\n        itemType,\r\n        iconImg: `${basePath}plate_shoulders_2.png`,\r\n    },\r\n    [Item.robe]: {\r\n        item: Item.robe,\r\n        equipmentType: ApparelType.chest,\r\n        itemType,\r\n        iconImg: `${basePath}robe_1.png`,\r\n    },\r\n    [Item.shoulders1]: {\r\n        item: Item.shoulders1,\r\n        equipmentType: ApparelType.shoulders,\r\n        itemType,\r\n        iconImg: `${basePath}shoulders_1.png`,\r\n    },\r\n    [Item.shoulders2]: {\r\n        item: Item.shoulders2,\r\n        equipmentType: ApparelType.shoulders,\r\n        itemType,\r\n        iconImg: `${basePath}shoulders_2.png`,\r\n    },\r\n    [Item.shoulders3]: {\r\n        item: Item.shoulders3,\r\n        equipmentType: ApparelType.shoulders,\r\n        itemType,\r\n        iconImg: `${basePath}shoulders_3.png`,\r\n    },\r\n    [Item.vest]: {\r\n        item: Item.vest,\r\n        equipmentType: ApparelType.chest,\r\n        itemType,\r\n        iconImg: `${basePath}vest_1.png`,\r\n    },\r\n};\r\n\r\nexport default all;\r\n\r\nexport function getDefinition<T extends ApparelDefinition>(apparel: string): T {\r\n    return all[apparel] as T;\r\n}\r\n","import { Store, AnyAction } from \"redux\";\r\nimport { StoreState } from 'stores';\r\nimport { BaseSceneController } from 'mechanics/scenes/BaseSceneController';\r\n\r\nexport abstract class SceneControllerManager {\r\n    static store: { [key: string]: BaseSceneController<any> } = {};\r\n    static controllerTypes = {};\r\n\r\n    static registerSceneController(questName: string, sceneName: string, controllerType: typeof BaseSceneController) {\r\n        this.controllerTypes[`${questName}.${sceneName}`] = controllerType;\r\n    }\r\n\r\n    static getSceneController<TQuestVars>(questName: string, sceneName: string, store: Store<StoreState, AnyAction>,): BaseSceneController<TQuestVars> {\r\n        if (!this.store[`${questName}.${sceneName}`]) {\r\n            if (!this.controllerTypes[`${questName}.${sceneName}`]) {\r\n                throw new Error(`No controller registered for ${questName}.${sceneName}`);\r\n            }\r\n            this.store[`${questName}.${sceneName}`] = new this.controllerTypes[`${questName}.${sceneName}`](store, questName);\r\n        }\r\n        return this.store[`${questName}.${sceneName}`];\r\n    }\r\n\r\n    static destroySceneConroller(questName: string, sceneName: string, ) {\r\n        delete this.store[`${questName}.${sceneName}`];\r\n    }\r\n}\r\n\r\n// tslint:disable-next-line: no-var-requires\r\nrequire('definitions/quests/kill10Boars/encounters/dungeon');\r\n","// tslint:disable:object-literal-sort-keys\r\n\r\nimport { Item, ItemDefinition, ItemType } from \"./types\";\r\n\r\nconst itemType = ItemType.weapon;\r\nconst basePath = \"/img/items/weapons/\";\r\n\r\nexport enum WeaponType {\r\n    axe,\r\n    bow,\r\n    club,\r\n    crossbow,\r\n    fist,\r\n    flail,\r\n    hammer,\r\n    melee,\r\n    knife,\r\n    staff,\r\n    sword,\r\n    poleArm,\r\n}\r\n\r\nexport enum DamageType {\r\n    kinetic = \"kinetic\",\r\n}\r\n\r\nexport interface DamageDefinition {\r\n    [DamageType.kinetic]: number | undefined;\r\n}\r\n\r\n// tslint:disable-next-line:no-empty-interface\r\nexport interface WeaponDefinition extends ItemDefinition {\r\n    weaponType: WeaponType;\r\n    damage: DamageDefinition;\r\n}\r\n\r\nconst weaponDefinitions: Record<string, WeaponDefinition> = {\r\n    [Item.arbalest]: {\r\n        item: Item.arbalest,\r\n        itemType,\r\n        weaponType: WeaponType.crossbow,\r\n        iconImg: `${basePath}arbalest.png`,\r\n        damage: { [DamageType.kinetic]: 40 },\r\n    },\r\n    [Item.battleAxe]: {\r\n        item: Item.battleAxe,\r\n        itemType,\r\n        weaponType: WeaponType.axe,\r\n        iconImg: `${basePath}battle_axe.png`,\r\n        damage: { [DamageType.kinetic]: 20 },\r\n    },\r\n    [Item.brassKnuckles]: {\r\n        item: Item.brassKnuckles,\r\n        itemType,\r\n        weaponType: WeaponType.melee,\r\n        iconImg: `${basePath}brass_knuckles.png`,\r\n        damage: { [DamageType.kinetic]: 10 },\r\n    },\r\n    [Item.crossbow]: {\r\n        item: Item.crossbow,\r\n        itemType,\r\n        weaponType: WeaponType.crossbow,\r\n        iconImg: `${basePath}crossbow.png`,\r\n        damage: { [DamageType.kinetic]: 3 },\r\n    },\r\n    [Item.cleaver]: {\r\n        item: Item.cleaver,\r\n        itemType,\r\n        weaponType: WeaponType.knife,\r\n        iconImg: `${basePath}cleaver.png`,\r\n        damage: { [DamageType.kinetic]: 5 },\r\n    },\r\n    [Item.club]: {\r\n        item: Item.club,\r\n        itemType,\r\n        weaponType: WeaponType.club,\r\n        iconImg: `${basePath}club.png`,\r\n        damage: { [DamageType.kinetic]: 8 },\r\n    },\r\n    [Item.dagger]: {\r\n        item: Item.dagger,\r\n        itemType,\r\n        weaponType: WeaponType.knife,\r\n        iconImg: `${basePath}dagger.png`,\r\n        damage: { [DamageType.kinetic]: 8 },\r\n    },\r\n    [Item.flail]: {\r\n        item: Item.flail,\r\n        itemType,\r\n        weaponType: WeaponType.flail,\r\n        iconImg: `${basePath}flail.png`,\r\n        damage: { [DamageType.kinetic]: 15 },\r\n    },\r\n    [Item.greatswordOfGwai]: {\r\n        item: Item.greatswordOfGwai,\r\n        itemType,\r\n        weaponType: WeaponType.sword,\r\n        iconImg: `${basePath}greatsword-gwai.png`,\r\n        unique: true,\r\n        damage: { [DamageType.kinetic]: 25 },\r\n    },\r\n    [Item.javelin]: {\r\n        item: Item.javelin,\r\n        itemType,\r\n        weaponType: WeaponType.poleArm,\r\n        iconImg: `${basePath}javelin.png`,\r\n        damage: { [DamageType.kinetic]: 25 },\r\n    },\r\n    [Item.khopesh]: {\r\n        item: Item.khopesh,\r\n        itemType,\r\n        weaponType: WeaponType.sword,\r\n        iconImg: `${basePath}khopesh.png`,\r\n        damage: { [DamageType.kinetic]: 15 },\r\n    },\r\n    [Item.longbow]: {\r\n        item: Item.longbow,\r\n        itemType,\r\n        weaponType: WeaponType.bow,\r\n        iconImg: `${basePath}longbow.png`,\r\n        damage: { [DamageType.kinetic]: 2 },\r\n    },\r\n    [Item.mace]: {\r\n        item: Item.mace,\r\n        itemType,\r\n        weaponType: WeaponType.club,\r\n        iconImg: `${basePath}mace.png`,\r\n        damage: { [DamageType.kinetic]: 15 },\r\n    },\r\n    [Item.morningStar]: {\r\n        item: Item.morningStar,\r\n        itemType,\r\n        weaponType: WeaponType.club,\r\n        iconImg: `${basePath}morning-star.png`,\r\n        damage: { [DamageType.kinetic]: 13 },\r\n    },\r\n    [Item.poisonedDagger]: {\r\n        item: Item.poisonedDagger,\r\n        itemType,\r\n        weaponType: WeaponType.knife,\r\n        iconImg: `${basePath}poisoned-dagger.png`,\r\n        damage: { [DamageType.kinetic]: 12 },\r\n    },\r\n    [Item.ravenStaff]: {\r\n        item: Item.ravenStaff,\r\n        itemType,\r\n        weaponType: WeaponType.staff,\r\n        iconImg: `${basePath}raven-staff.png`,\r\n        damage: { [DamageType.kinetic]: 13 },\r\n    },\r\n    [Item.savageStaff]: {\r\n        item: Item.savageStaff,\r\n        itemType,\r\n        weaponType: WeaponType.staff,\r\n        iconImg: `${basePath}savage-staff.png`,\r\n        damage: { [DamageType.kinetic]: 8 },\r\n    },\r\n    [Item.spear]: {\r\n        item: Item.spear,\r\n        itemType,\r\n        weaponType: WeaponType.poleArm,\r\n        iconImg: `${basePath}sword.png`,\r\n        damage: { [DamageType.kinetic]: 10 },\r\n    },\r\n    [Item.sword]: {\r\n        item: Item.sword,\r\n        itemType,\r\n        weaponType: WeaponType.sword,\r\n        iconImg: `${basePath}sword.png`,\r\n        damage: { [DamageType.kinetic]: 14 },\r\n    },\r\n    [Item.warhammer]: {\r\n        item: Item.warhammer,\r\n        itemType,\r\n        weaponType: WeaponType.hammer,\r\n        iconImg: `${basePath}warhammer.png`,\r\n        damage: { [DamageType.kinetic]: 16 },\r\n    },\r\n};\r\nexport default weaponDefinitions;\r\n\r\nexport function getDefinition<T extends WeaponDefinition>(weapon: string): T {\r\n    return weaponDefinitions[weapon] as T;\r\n}\r\n","function eventEmitter<TEventType>() {\r\n    abstract class EventEmitter {\r\n        static events = {};\r\n\r\n        static addEventListener (eventName: string, listener: (event: TEventType) => void) {\r\n            this.events[eventName] = this.events[eventName] || [];\r\n            this.events[eventName].push(listener);\r\n        }\r\n\r\n        static removeEventListener (eventName: string, listener: (event: TEventType) => void) {\r\n            if (this.events[eventName]) {\r\n                for (let i = 0; i < this.events[eventName].length; i++) {\r\n                    if (this.events[eventName][i] === listener) {\r\n                        this.events[eventName].splice(i, 1);\r\n                        break;\r\n                    }\r\n                };\r\n            }\r\n        }\r\n\r\n        protected static emit (eventName: string, event: TEventType | undefined) {\r\n            if (this.events[eventName]) {\r\n                this.events[eventName].forEach((fn: (event: TEventType | undefined) => any) => fn(event));\r\n            }\r\n        }\r\n    }\r\n    return EventEmitter;\r\n}\r\n\r\nexport default eventEmitter;","export interface Kill10BoarsQuestVars {\r\n    dungeon: {\r\n        entered: boolean\r\n    },\r\n    foo: boolean;\r\n    bar: number;\r\n}\r\n\r\nexport const initialQuestVars: Kill10BoarsQuestVars = {\r\n    dungeon: {\r\n        entered: false\r\n    },\r\n    foo: false,\r\n    bar: 3\r\n}","export interface TiledMapData {\r\n    width: number;\r\n    height: number;\r\n    tilewidth: number;\r\n    tileheight: number;\r\n    infinite: boolean;\r\n    backgroundcolor: string | null;\r\n    orientation: Orientation;\r\n    renderorder: RenderOrder;\r\n    tilesets: TiledTilesetData[];\r\n    layers: TiledLayerData[];\r\n}\r\n\r\nexport interface TiledTilesetData {\r\n    columns: number;\r\n    firstgid: number;\r\n    source: string;\r\n    image: string;\r\n    imagewidth: number;\r\n    imageheight: number;\r\n    tilewidth: number;\r\n    tileheight: number;\r\n    tilecount: number;\r\n    name: string;\r\n    margin: number; // todo:\r\n    spacing: number; // todo\r\n    tiles?: TileData[];\r\n}\r\n\r\nexport interface TileData {\r\n    id: number,\r\n    properties?: TiledProperty[];\r\n}\r\n\r\nexport interface TiledLayerData {\r\n    data: number[];\r\n    objects: TiledObjectData[];\r\n    type: TiledLayerType;\r\n    height: number;\r\n    id: number;\r\n    name: string;\r\n    opacity: number; // not supported atm\r\n    visible: boolean;\r\n    x: number;\r\n    y: number;\r\n    width: number;\r\n    properties?: TiledProperty[];\r\n}\r\n\r\nexport interface TiledObjectData {\r\n    gid?: number;\r\n    id: number;\r\n    name: string;\r\n    properties?: TiledProperty[];\r\n    type: string;\r\n    visible: boolean;\r\n    width: number;\r\n    height: number;\r\n    x: number;\r\n    y: number;\r\n}\r\n\r\nexport enum TiledLayerType {\r\n    tilelayer = \"tilelayer\",\r\n    objectgroup = \"objectgroup\"\r\n}\r\n\r\nexport interface TiledProperty {\r\n    name: string,\r\n    type: string,\r\n    value: any\r\n}\r\n\r\nenum Orientation {\r\n    orthagonal = \"orthagonal\",\r\n    isometric = \"isometric\",\r\n    staggered = \"staggered\",\r\n    hexagonal = \"hexagonal\"\r\n}\r\n\r\nenum RenderOrder {\r\n    rightUp = \"right-up\",\r\n    rightDown = \"right-down\",\r\n    leftUp = \"left-up\",\r\n    leftDown = \"left-down\"\r\n}","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAgCAYAAAABtRhCAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAB3RJTUUH3gMODzc3YHmYGgAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAE50lEQVRIx7WXW0wcVRjHfzO7y16YZbfAytACvbjU1hqkLVZMbbSXBEPUNjX6YDYanwYfTXzxrb7qm0lTJ018QhOjaWI0trFYbRoqpYVuwy2UpRS2lAF22YUdtuxt1ofKCIXShaZfMjm37+Q33zn/cxMURWHRVFXNAyiKIvCMTFwKO6Ne4ONPTpngZwoE6Lx6FYCDhwLPDLoMeKPtV8b6ewkEAssiVVU1v/gtLS+dhnUDFUUResZvUhLXuNF+ZVmkBw8F6B+4b5avXR8x82fUC+uCWhoaGsxCV1fXKZelGOvMNPcXspw9+zV60s3MzAweTwXJZBLJXYXPt8XMJ5NJbgX/pqGh4ctCgNalBUVRhId/u5tsQqf9UpDGxkZCoRCtra2mX2trK5qmAZhpoWZdrTIvCOyQihn8/RydsQSVm6uQJAnZ6zV9MjYbkUgEAL/fj6p+my9kOYmPViiKIgQn+8mLIv1jowSONtN0+OgyGEAkEkHXdTRNQ5Kkjal0qY3MJciLIsdOvslYXy9xbXxZu67rAEiSZOafCtgzfpM8Al2/deDEwJZOrYAu2lNFqKpq/rPjLTTtbWY0Psu1jovUVm7Hmk1jS6eYmXooEiH//0pYj3BWFc2RukM4HpxHMAz6x0aRvT1scfsYT0yTTwnEtXEsuQzxhbQ5j08F/O7H0+zz+ThQWsK52yGuBNs5XPcqllwOVzrOjv2HsZaXsuv1OtySnYSeort7kE+Vt56o1FWBo7EollwGQ7Sww13McHyWbE8n9VVVNLzWzMDkXSYGujl/uY1wNIamaciybO4+a0FXXRbd04P8PHydu/EYtmwaSy7NaCzOi0eO09F5kfk7/bhSSZ4T8zQ2NiLLMgCyLPPe+5+vudWtqlJFUYRF8MhsHNHIcXKnn86rfxK8P4Etk8G5kKR4YZ758F1OnDixrP9aUHGt8V6ExlMLbLP7GBoeAkGkxuWhKJfFlUoiJRNE7o0TCARM8UiS9NgjTnySqhRFEUZmR/jm5l9YsynGolG0RJQqpwd7OoU0P0dqZJD0TJyWlhZzU/D7/Txfe2wFVCxUzttLPNyaGEc0svx0+zZVW/cD4Eo/wJuIkevtwZiKLhteWZZXQAsGdk9PscluRzByODxlnL78Aw17mpDdZdizGUr0GNEbndRvKeeD5rcpLy83oRWVjeuLUFEUYTQ+jMfpwutw4CgpJVmzm6/++QVDtFDpLkU0DLxzUabbB6ir9vHGtp3mxi5JkhmluJ6zzONw/pfaMUSR0HyaL6530zYRBmBz7QFqj9YhSQ5efsXPQjxS2MJ/nJUUS8zEZ/G4nPSEQgyHLj08kCehtQuqy66w94/vEfIGNaVliEYGr6No40AAj9OBkDcYHmpb0RaO9hGO9lFdtodubQqAovQCG1IpgGgYlNlsbCqyrekXjvaZ+SlD3Dgwoc9hyWU4WP1SQf6lNbXouo6u6+ZtvmCgoihCcErDks2QCA3w4YF3ngjz+/1omsbkRMfG5nBkdoQ7bjeEe9hVVsZHe5u4FB7nXqTX9Kmvf5eKys3IskwwGGR4qG3ZW0VY+pgpxFRVze/zvcBWbylep5OMzY5hsVLsLiFd5MTqq+DedJRQKLQCtiHg0uv91k21uF1uPE4XhsVC1monlsqSmE8yOdGx6itsQ8BHwavN9+P6/Avf+1eTf20QhwAAAABJRU5ErkJggg==\"","// tslint:disable:object-literal-sort-keys\r\nimport { Action } from \"redux\";\r\nimport { CombatActionType } from \"stores/combat\";\r\n\r\nexport enum ActionType {\r\n    clearCombatAction = \"clearCombatAction\",\r\n    startCombatAction = \"startCombatAction\",\r\n    moveActor = \"moveActor\",\r\n}\r\n\r\nexport interface AddCombatActionAction extends Action<ActionType> {\r\n    combatType: CombatActionType;\r\n    actor: string;\r\n    target: [number, number];\r\n    endsAt: number;\r\n}\r\n\r\nexport interface MoveActorAction extends Action<ActionType> {\r\n    actor: string;\r\n    location: [number, number];\r\n}\r\n\r\nexport function startCombatAction(type: CombatActionType, actor: string, target: [number, number], endsAt: number): AddCombatActionAction {\r\n    return {\r\n        type: ActionType.startCombatAction,\r\n        combatType: type,\r\n        actor,\r\n        target,\r\n        endsAt,\r\n    };\r\n}\r\n\r\nexport function moveActor(actor: string, location: [number, number]): MoveActorAction {\r\n    return {\r\n        type: ActionType.moveActor,\r\n        actor,\r\n        location,\r\n    };\r\n}\r\n\r\nexport function clearCombatAction(): Action<ActionType> {\r\n    // currently there is only one combat possible. so only one needs to be cleared\r\n    return {\r\n        type: ActionType.clearCombatAction,\r\n    };\r\n}\r\n","export interface CombatStoreState {\r\n    actors: Actor[];\r\n    turn: Allegiance;\r\n    action?: CombatAction;\r\n}\r\n\r\nexport interface Actor {\r\n    name: string;\r\n    allegiance: Allegiance;\r\n    location: number[];\r\n    health: number;\r\n    remainingAP: number;\r\n}\r\n\r\nexport enum Allegiance {\r\n    player,\r\n    enemy,\r\n}\r\n\r\nexport interface CombatAction {\r\n    type: CombatActionType;\r\n    actor: string;\r\n    target: [number, number];\r\n    endsAt: number;\r\n}\r\n\r\nexport enum CombatActionType {\r\n    move = \"move\",\r\n    slash = \"slash\",\r\n    shoot = \"shoot\",\r\n}\r\n\r\nexport const barBrawl: CombatStoreState = {\r\n    actors: [{\r\n        allegiance: Allegiance.player,\r\n        health: 100,\r\n        location: [3, 5],\r\n        name: \"c4a5d270\",\r\n        remainingAP: 5,\r\n    }, {\r\n        allegiance: Allegiance.player,\r\n        health: 100,\r\n        location: [4, 6],\r\n        name: \"2e655832\",\r\n        remainingAP: 4,\r\n    }],\r\n    turn: Allegiance.player,\r\n};\r\n","import { LogUpdate, QuestUpdate } from \"mechanics/gameTick/quests\";\r\nimport { Action } from \"redux\";\r\nimport { State as seedrandomStateType } from \"seedrandom\";\r\nimport { ResourceStoreState } from \"stores/resources\";\r\n\r\nexport enum ActionType {\r\n    gameTick = \"gameTick\",\r\n}\r\nexport interface GameTickAction extends Action<ActionType> {\r\n    delta: number;\r\n    rngState: seedrandomStateType | null;\r\n    resources: ResourceStoreState | null;\r\n    quests: QuestUpdate[];\r\n    log: LogUpdate[];\r\n}\r\n\r\n// export type IncrementResource = IncrementResource // | others\r\n\r\n// tslint:disable: align\r\nexport function gameTick(delta: number,\r\n    rngState: seedrandomStateType | null,\r\n    resources: ResourceStoreState | null,\r\n    quests: QuestUpdate[],\r\n    log: LogUpdate[],\r\n): GameTickAction {\r\n    return {\r\n        type: ActionType.gameTick,\r\n        delta,\r\n        rngState,\r\n        resources,\r\n        quests,\r\n        log,\r\n    };\r\n}\r\n","import { clearCombatAction, moveActor } from \"actions/combat\";\nimport { Store } from \"redux\";\nimport { StoreState } from \"stores\";\nimport { Allegiance, CombatAction, CombatActionType } from \"stores/combat\";\n\n// tslint:disable-next-line: no-empty-interface\nexport interface CombatUpdate  {\n    // todo: maybe this is not needed\n    action: CombatAction | null;\n}\n\nconst updateCombat = (delta: number, store: Store<StoreState>): CombatUpdate | null => {\n    const state = store.getState();\n    const combat = state.combat;\n    if (combat.action) {\n        const action = combat.action;\n        if (action.endsAt < Date.now()) {\n            if (combat.turn === Allegiance.enemy) {\n                /* if (apLeft(enemy))\n                determine next action\n                else\n                players turn now\n                */\n            } else if (combat.turn === Allegiance.player) {\n                switch (combat.action.type) {\n                    case CombatActionType.move:\n                        store.dispatch(moveActor(combat.action.actor, combat.action.target));\n                        store.dispatch(clearCombatAction());\n                        break;\n                    default:\n                        break;\n                }\n                return {\n                    action: null,\n                };\n            }\n        }\n    }\n    return null;\n};\n\nexport default updateCombat;\n","import { Howl } from \"howler\";\r\nimport * as React from \"react\";\r\nimport Indicator from \"./Indicator\";\r\nimport { useState, useEffect } from 'react';\r\n\r\n// https://medium.com/@jchiam/publishing-a-typescript-react-component-to-npm-d3cc15b8d0a2\r\nexport interface Props {\r\n    manifest: string[];\r\n    onLoadComplete?: (mediaItems: MediaItem[]) => void;\r\n    children: any;\r\n}\r\n\r\nexport enum MediaType {\r\n    image,\r\n    sound,\r\n}\r\n\r\nexport interface MediaItem {\r\n    url: string;\r\n    mediaType: MediaType;\r\n    content?: HTMLImageElement | Howl;\r\n    sound?: Howl;\r\n}\r\n\r\nconst Preloader = (props: Props) => {    \r\n\r\n    const [completed, setCompleted] = useState(false);\r\n    const [itemsLoaded, setItemsLoaded] = useState(0);\r\n\r\n    useEffect(() => {\r\n        loadMedia();\r\n    }, []);\r\n\r\n    const { children, manifest } = props;\r\n\r\n    const indicator = <Indicator\r\n        itemsLoaded = { itemsLoaded }\r\n        itemsTotal = { manifest.length }\r\n    />;\r\n\r\n    const loadMedia = () => {\r\n        // todo: what if props get set at runtime\r\n        setItemsLoaded(0);\r\n\r\n        const promises = props.manifest\r\n            .map((url) => loadItem(url)\r\n            // tslint:disable-next-line:no-console\r\n            .catch((err) => console.error(err)));\r\n\r\n        Promise.all(promises).then((results) => {\r\n            if (props.onLoadComplete) {\r\n                props.onLoadComplete(media);\r\n            }\r\n            setCompleted(true);\r\n        });\r\n    }\r\n\r\n    const loadItem = async (url: string): Promise<MediaItem> => {\r\n        if (media.some((m) => m.url === url)) {\r\n            // tslint:disable-next-line:no-console\r\n            console.warn(`Loading media with url ${url} more than once! Will overwrite.`);\r\n        }\r\n        const mediaType = getType(url);\r\n        let item;\r\n        if (mediaType === MediaType.image) {\r\n            const value = await loadImage(url);\r\n            item = {\r\n                content: value,\r\n                mediaType,\r\n                url,\r\n            } ;\r\n        }\r\n        if (mediaType === MediaType.sound) {\r\n            const value = new Howl({\r\n                src: [ `${process.env.PUBLIC_URL}/${url}` ],\r\n            });\r\n            item = {\r\n                content: value,\r\n                mediaType,\r\n                url,\r\n            };\r\n        }\r\n        if (item) {\r\n            media.push(item);\r\n            setItemsLoaded(itemsLoaded + 1);\r\n            return item;\r\n        } else {\r\n            throw new Error(`Unknown error while trying to load ${url}`);\r\n        }\r\n    }\r\n\r\n    return completed ? children : indicator;\r\n}\r\n\r\nconst media: MediaItem[] = [];\r\n\r\nconst loadImage = (url: string): Promise<HTMLImageElement> => {\r\n    const image = new Image();\r\n    image.src = url;\r\n\r\n    return new Promise((resolve, reject) => {\r\n        if (image.naturalWidth) {\r\n            resolve(image);\r\n        } else if (image.complete) {\r\n            reject(null);\r\n        } else {\r\n            image.addEventListener(\"load\", check);\r\n            image.addEventListener(\"error\", check);\r\n        }\r\n        function check() {\r\n            if (image.naturalWidth) {\r\n                resolve(image);\r\n            } else {\r\n                reject(null);\r\n            }\r\n            image.removeEventListener(\"load\", check);\r\n            image.removeEventListener(\"error\", check);\r\n        }\r\n    });\r\n};\r\n\r\nconst getType = (url: string): MediaType => {\r\n    url = url.toLowerCase();\r\n    if (url.endsWith(\"png\") || url.endsWith(\"jpg\") || url.endsWith(\"gif\")) {\r\n        return MediaType.image;\r\n    }\r\n    if (url.endsWith(\"mp3\") || url.endsWith(\"ogg\") || url.endsWith(\"wav\")) {\r\n        return MediaType.sound;\r\n    }\r\n    throw Error(`Could not determine type for ${url}`);\r\n};\r\n\r\nexport default Preloader;","import { convertSemVerToInt } from \"utils/version\";\r\n\r\n// <MAJOR>.<MINOR>.<RELEASE>\r\n\r\nconst version = \"0.0.5\";\r\n\r\nexport default version;\r\nexport const asInt: number = convertSemVerToInt(version);\r\n","// tslint:disable:no-bitwise\r\n\r\n/**\r\n * Convert a sematic versioning string into an 32-bit integer.\r\n *\r\n * Make sure the input string is compatible with the standard found\r\n * at semver.org. Since this only uses 10-bit per major/minor/patch version,\r\n * the highest possible SemVer string would be 1023.1023.1023.\r\n * @param  {string} semVer SemVer string\r\n * @return {number}         Numeric version\r\n */\r\nexport const convertSemVerToInt = (semVer: string): number => {\r\n    // Split a given version string into three parts.\r\n    const parts = semVer.split(\".\").map((part) => Number(part));\r\n    // Check if we got exactly three parts, otherwise throw an error.\r\n    if (parts.length !== 3) {\r\n        throw new Error(`Received invalid version string: ${semVer}`);\r\n    }\r\n    // Make sure that no part is larger than 1023 or else it\r\n    // won't fit into a 32-bit integer.\r\n    parts.forEach((part: number) => {\r\n        if (part >= 1024) {\r\n            throw new Error(`Version string invalid, ${part} is too large`);\r\n        }\r\n    });\r\n    let numericVersion = 0;\r\n    // Shift all parts either 0, 10 or 20 bits to the left.\r\n    for (let i = 0; i < 3; i++) {\r\n        numericVersion |= parts[i] << i * 10;\r\n    }\r\n    return numericVersion;\r\n};\r\n\r\n/**\r\n * Converts a 32-bit integer into a semantic versioning (SemVer) compatible string.\r\n * @param  {number} version Numeric version\r\n * @return {string}   SemVer string\r\n */\r\nexport const convertIntToSemVer = (version: number) => {\r\n    // Works by shifting the numeric version to the right and then masking it\r\n    // with 0b1111111111 (or 1023 in decimal).\r\n    // eslint-disable-next-line no-mixed-operators\r\n    return `${version & 1023}.${version >> 10 & 1023}.${version >> 20 & 1023}`;\r\n};\r\n","import * as React from \"react\";\r\n\r\nexport interface Props {\r\n    itemsLoaded?: number;\r\n    itemsTotal?: number;\r\n}\r\n\r\n/**\r\n * Loading indicator\r\n */\r\nconst Indicator = (props: Props) =>  {\r\n    const { itemsLoaded, itemsTotal } = props;\r\n    return <div> { `Loading (${Math.floor((itemsLoaded || 0) / (itemsTotal || 0 ) * 100)})%`} </div>;\r\n}\r\n\r\nexport default Indicator;\r\n","\nexport enum StructureState {\n    NotBuilt,\n    Building,\n    Built,\n}\n\nexport interface StructureStoreState {\n    level: number;\n    workers: number;\n    state: StructureState;\n}\nexport const initialState: StructureStoreState = {\n    level: 0,\n    state: StructureState.NotBuilt,\n    workers: 0,\n};\n","import React, { forwardRef } from \"react\";\r\nimport { Viewport as PixiViewport, ClickEventData } from \"pixi-viewport\";\r\nimport { PixiComponent, useApp } from \"@inlet/react-pixi\";\r\nimport gauntlet from \"components/App/styles/img/cursors/dwarven_gauntlet_extra_6.png\";\r\n\r\ninterface Props {\r\n  children: React.ReactNode;\r\n  onClick?(event: ClickEventData): void;\r\n  screenWidth: number,\r\n  screenHeight: number,\r\n  worldWidth: number,\r\n  worldHeight: number,\r\n  minScale?: number;\r\n  maxScale?: number;\r\n}\r\n\r\n/** Viewport leverages pixi-viewport to create a pannable map\r\n * https://davidfig.github.io/pixi-viewport/jsdoc/\r\n */\r\nconst Viewport = forwardRef<PixiViewport, any>((props, ref) => {\r\n  const app = useApp();\r\n  console.log(gauntlet)\r\n  if (app) {\r\n      // Perhaps this is better moved somewhere else\r\n      const cursor = `url('${gauntlet}'), auto`;\r\n      app.renderer.plugins.interaction.cursorStyles.pointer = cursor;\r\n  }\r\n  return <PixiComponentViewport app={app} {...props} ref={ref} />;\r\n})\r\n\r\ninterface PixiComponentProps {\r\n    app: PIXI.Application;\r\n}\r\n\r\nconst PixiComponentViewport = PixiComponent(\"Viewport\", {\r\n  create: (props: PixiComponentProps & Props) => {\r\n    const viewport = new PixiViewport({\r\n      screenWidth: props.screenWidth,\r\n      screenHeight: props.screenHeight,\r\n      worldWidth: props.worldWidth,\r\n      worldHeight: props.worldHeight,\r\n      ticker: props.app.ticker,\r\n      //interaction: props.app.renderer.plugins.interaction,\r\n      // the interaction module is important for wheel to work properly when renderer.view is placed or scaled\r\n    });\r\n    viewport.on(\"clicked\", (event) => { if(props.onClick) props.onClick(event) });\r\n\r\n    const {\r\n      minScale = 1,\r\n      maxScale = 2\r\n    } = props;\r\n\r\n    viewport\r\n      .drag()\r\n      .pinch()\r\n      .wheel()\r\n      .clamp({ direction: 'all' })\r\n      .clampZoom({ minScale, maxScale })\r\n      .decelerate();\r\n\r\n    return viewport;\r\n  },\r\n  // applyProps: (instance, oldProps, newProps) => {\r\n  //   console.log(\"applyProps\");\r\n  // },\r\n  // didMount: () => {\r\n  //   console.log(\"didMount\");\r\n  // },\r\n  // willUnmount: () => {\r\n  //   console.log(\"willUnmount\");\r\n  // }\r\n});\r\nexport default Viewport;\r\n","// tslint:disable:object-literal-sort-keys\nimport { Action } from \"redux\";\nimport { ResourceStoreState } from \"stores/resources\";\n\nexport enum ActionType {\n    addResources = \"addResources\",\n    removeResources = \"removeResources\",\n}\n\nexport interface AddResources extends Action<ActionType> {\n    resources: ResourceStoreState;\n}\n\nexport function addResource(resource: string, value: number): AddResources {\n    return addResources({\n        [resource]: value,\n    });\n}\n\nexport function addResources(resources: ResourceStoreState): AddResources {\n    return {\n        type: ActionType.addResources,\n        resources,\n    };\n}\n\nexport function removeResources(resources: ResourceStoreState): AddResources {\n    return {\n        type: ActionType.removeResources,\n        resources,\n    };\n}\n","// tslint:disable:object-literal-sort-keys\r\n\r\nimport { Structure } from \"definitions/structures\";\r\nimport { Action } from \"redux\";\r\nimport { StructureState } from \"stores/structure\";\r\n\r\nexport enum ActionType {\r\n    upgradeStructure = \"upgradeStructure\",\r\n    increaseWorkers = \"increaseWorkers\",\r\n    decreaseWorkers = \"decreaseWorkers\",\r\n    startBuildingStructure = \"startBuildingStructure\",\r\n    finishBuildingStructure = \"finishBuildingStructure\",\r\n    setStructureState = \"setStructureState\",\r\n}\r\n\r\nexport interface StructureAction extends Action<ActionType> {\r\n    structure: Structure;\r\n}\r\nexport interface StructureStateAction extends StructureAction {\r\n    state: StructureState;\r\n}\r\n\r\nexport interface WorkerCountAction extends StructureAction {\r\n    workers: number;\r\n}\r\n\r\nexport function startBuildingStructure(structure: Structure): StructureAction {\r\n    return {\r\n        type: ActionType.startBuildingStructure,\r\n        structure,\r\n    };\r\n}\r\n\r\nexport function finishBuildingStructure(structure: Structure): StructureAction {\r\n    return {\r\n        type: ActionType.finishBuildingStructure,\r\n        structure,\r\n    };\r\n}\r\n\r\nexport function upgradeStructure(structure: Structure): StructureAction {\r\n    return {\r\n        type: ActionType.upgradeStructure,\r\n        structure,\r\n    };\r\n}\r\n\r\n// Increases workers used by given structure by given amount\r\nexport function increaseWorkers(structure: Structure, workers: number = 1): WorkerCountAction {\r\n    return {\r\n        type: ActionType.increaseWorkers,\r\n        structure,\r\n        workers,\r\n    };\r\n}\r\n\r\n// Decreases workers used by given structure by given amount\r\nexport function decreaseWorkers(structure: Structure, workers: number = 1): WorkerCountAction {\r\n    return {\r\n        type: ActionType.decreaseWorkers,\r\n        structure,\r\n        workers,\r\n    };\r\n}\r\n\r\nexport function setStructureState(structure: Structure, state: StructureState): StructureStateAction {\r\n    return {\r\n        type: ActionType.setStructureState,\r\n        structure,\r\n        state,\r\n    };\r\n}\r\n","import { Action } from \"redux\";\n\n// tslint:disable:object-literal-sort-keys\nexport enum ActionType {\n    addGold = \"addGold\",\n}\n\nexport interface ModifyGoldAction extends Action<ActionType> {\n    amount: number;\n}\n\nexport function addGold(amount: number): ModifyGoldAction {\n    return {\n        type: ActionType.addGold,\n        amount,\n    };\n}\nexport function subtractGold(amount: number): ModifyGoldAction {\n    return {\n        type: ActionType.addGold,\n        amount: -amount,\n    };\n}\n","import { Item } from \"definitions/items/types\";\nimport { Action } from \"redux\";\n\n// tslint:disable:object-literal-sort-keys\nexport enum ActionType {\n    addItem = \"addItem\",\n    moveItemInWarehouse = \"moveItemInWarehouse\",\n    removeItem = \"removeItem\",\n}\n\nexport interface MoveItemInWarehouseAction extends Action<ActionType> {\n    fromSlot: number;\n    toSlot: number;\n}\n\nexport interface AddAction extends Action {\n    item: Item;\n    toSlot?: number;\n}\n\nexport interface RemoveItemFromWarehouseAction extends Action {\n    fromSlot: number;\n}\n\n// Adds one Item to the warehouse\n// slot is optional, will take the first empty slot if not provided\nexport function addItemToWarehouse(item: Item, toSlot?: number): AddAction {\n    return {\n        type: ActionType.addItem,\n        item,\n        toSlot,\n    };\n}\n\n// When an Item is moved from one slot to the other in the warehouse\nexport function moveItemInWarehouse(fromSlot: number, toSlot: number): MoveItemInWarehouseAction {\n    return {\n        type: ActionType.moveItemInWarehouse,\n        fromSlot,\n        toSlot,\n    };\n}\nexport function removeItemFromWarehouse(fromSlot: number): RemoveItemFromWarehouseAction {\n    return {\n        type: ActionType.removeItem,\n        fromSlot,\n    };\n}\n","import { Action } from \"redux\";\n\n// todo this should go somewhere else\nexport enum ActionType {\n    addWorkers = \"addWorkers\",\n}\n\nexport interface ModifyWorkersAction extends Action<ActionType> {\n    value: number;\n}\n\nexport function addWorkers(value: number): ModifyWorkersAction {\n    return {\n        type: ActionType.addWorkers,\n        value,\n    };\n}\nexport function subtractWorkers(value: number): ModifyWorkersAction {\n    return {\n        type: ActionType.addWorkers,\n        value: -value,\n    };\n}\n","import * as PIXI from 'pixi.js';\r\n// Adapted from https://github.com/explooosion/hitarea-shapes/blob/master/src/index.js\r\n\r\nexport default class HitAreaShapes {\r\n    public shapes: PIXI.Polygon[];\r\n\r\n    constructor(shapes = {}, sprite: string = \"0\") {\r\n      this.shapes = shapes[sprite].map((definition: { shape: number[]; }) => {\r\n          const shape: number[] = definition.shape;\r\n          return new PIXI.Polygon(shape);\r\n      });\r\n    }\r\n  \r\n    /**\r\n     * Called by hitArea\r\n     * @param {number} x\r\n     * @param {number} y\r\n     */\r\n    contains(x = 0, y = 0) {\r\n      return (!this.shapes || this.shapes.length === 0)\r\n        ? false\r\n        : this.shapes.some(shape => shape.contains(x, y));\r\n    }\r\n  }","import React, { useState, useEffect } from 'react';\r\nimport { Structure } from 'definitions/structures';\r\nimport { Sprite, useApp, useTick } from '@inlet/react-pixi';\r\nimport HitAreaShapes from 'utils/hitAreaShapes';\r\nimport * as PIXI from 'pixi.js';\r\nimport { ITextureDictionary } from 'pixi.js';\r\nimport { STRUCTURE_HIGHLIGHT_FILTER } from 'components/town/TownView';\r\nimport { loadResource } from 'utils/pixiJs';\r\n\r\nconst BLADE_ROTATION_SPEED = 0.01;\r\n\r\nexport interface Props {\r\n    onStructureClick: (structure: Structure | null) => void;\r\n    position: PIXI.Point;\r\n    selected?: boolean;\r\n    hitAreaShapes: HitAreaShapes;\r\n}\r\n\r\nconst LumberMill = (props: Props) => {\r\n    const {hitAreaShapes} = props;\r\n    const structure = Structure.lumberMill;\r\n    const atlas = `${process.env.PUBLIC_URL}/img/town/town-alpha/${structure}.json`;\r\n    const [textures, setTextures] = useState<ITextureDictionary>();\r\n    const filters = props.selected ? [STRUCTURE_HIGHLIGHT_FILTER] : [];\r\n\r\n    const app = useApp();\r\n\r\n    useEffect(() => {\r\n        loadResource(atlas, (resource) => {\r\n            setTextures(resource.textures);    \r\n        })\r\n    }, [app, app.loader, atlas]);\r\n\r\n    const [rotation, setRotation] = useState(0);\r\n    useTick((delta:number | undefined) => setRotation(r => r + (BLADE_ROTATION_SPEED * delta!)));\r\n\r\n\r\n    if (!textures) return null;\r\n    return (\r\n        <Sprite \r\n            name={structure}\r\n            position={props.position}\r\n            interactive={true}\r\n            buttonMode={true}\r\n            pointertap={() => {\r\n                props.onStructureClick(structure);\r\n            }}\r\n            hitArea={hitAreaShapes}\r\n            filters={filters}\r\n            texture={textures[\"structure.png\"]}\r\n        >\r\n            <Sprite \r\n                name=\"blades\"\r\n                texture={textures[\"blades.png\"]}\r\n                anchor={new PIXI.Point(0.5, 0.5)}\r\n                x={15}\r\n                y={10}\r\n                rotation={rotation}\r\n            /> \r\n        </Sprite>        \r\n    )\r\n}\r\n\r\nexport default LumberMill;","import { PixiComponent, applyDefaultProps, Container } from \"@inlet/react-pixi\";\r\nimport * as PIXI  from 'pixi.js';\r\nimport * as particles from 'pixi-particles';\r\n\r\ninterface Props  {\r\n    image: string;\r\n    config: particles.OldEmitterConfig | particles.EmitterConfig;\r\n};\r\n\r\nconst ParticleEmitter = PixiComponent<Props & React.ComponentProps<typeof Container>, PIXI.ParticleContainer>(\"ParticleEmitter\", {\r\n    create() {\r\n      return new PIXI.ParticleContainer();\r\n    },\r\n\r\n    applyProps(instance, oldProps: Props, newProps: Props) {\r\n      const { image, config, ...newP } = newProps;\r\n\r\n      // apply rest props to PIXI.ParticleContainer\r\n      applyDefaultProps(instance, oldProps, newP);\r\n\r\n      let emitter = (this as any)._emitter;\r\n      if (!emitter) {\r\n        emitter = new particles.Emitter(\r\n          instance,\r\n          [PIXI.Texture.from(image)],\r\n          config\r\n        );\r\n\r\n        let elapsed = performance.now();\r\n\r\n        const tick = () => {\r\n          emitter.raf = requestAnimationFrame(tick);\r\n          const now = performance.now();\r\n          // const amp = Math.random() * 5 + 15;\r\n          // const amp = 15;\r\n          // const freq = 0.0015;\r\n          // emitter.acceleration.x = (Math.sin((elapsed * freq)) * amp) + 15;\r\n\r\n          emitter.update((now - elapsed) * 0.0003);\r\n\r\n          elapsed = now;\r\n        };\r\n        emitter.emit = true;\r\n        // emitter.update(00.2);\r\n\r\n        tick();\r\n      }\r\n      (this as any)._emitter = emitter;\r\n    },\r\n\r\n    willUnmount() {\r\n      if ((this as any)._emitter) {\r\n        (this as any)._emitter.emit = false;\r\n        cancelAnimationFrame((this as any)._emitter.raf);\r\n      }\r\n    }\r\n});\r\n\r\nexport default ParticleEmitter;","import React from \"react\";\r\nimport { Sprite, Container } from '@inlet/react-pixi';\r\nimport { Structure } from 'definitions/structures';\r\nimport HitAreaShapes from 'utils/hitAreaShapes';\r\nimport smoke from './smoke.json';\r\nimport ParticleEmitter from 'components/pixi/ParticleEmitter';\r\nimport { STRUCTURE_HIGHLIGHT_FILTER } from 'components/town/TownView';\r\n\r\nexport interface Props {\r\n    onStructureClick: (structure: Structure | null) => void;\r\n    position: PIXI.Point;\r\n    selected?: boolean;\r\n    hitAreaShapes: HitAreaShapes;\r\n}\r\n\r\nconst Tavern = (props: Props) => {\r\n    const {hitAreaShapes, position} = props;\r\n    const structure = Structure.tavern;\r\n    const filters = props.selected ? [STRUCTURE_HIGHLIGHT_FILTER] : [];\r\n\r\n    return (\r\n        <Container position={position}>\r\n            <Sprite\r\n                name={structure}\r\n                interactive={true}\r\n                buttonMode={true}\r\n                pointertap={() => {\r\n                    props.onStructureClick(structure);\r\n                }}\r\n                filters={filters}\r\n                hitArea={hitAreaShapes}\r\n                image={`${process.env.PUBLIC_URL}/img/town/town-alpha/${structure}.png`}\r\n            />\r\n            <ParticleEmitter\r\n                name=\"smoke\"\r\n                x={107}\r\n                y={-2}\r\n                image={`${process.env.PUBLIC_URL}/img/town/effects/smokeparticle.png`}\r\n                config={smoke}\r\n            />\r\n        </Container>\r\n    )\r\n}\r\nexport default Tavern;","import { AppContext } from \"components/App\";\r\nimport { MediaItem } from \"components/preloading/Preloader\";\r\nimport * as React from \"react\";\r\nimport { Component, ComponentType } from 'react';\r\n\r\n// Sharing context within the entire App\r\nexport interface AppContextProps {  \r\n    onOpenWindow: (window: React.ReactElement) => void;\r\n    onCloseWindow: () => void;\r\n    media: MediaItem[] | null;\r\n}\r\n\r\nexport const withAppContext = <TWrappedComponentProps extends AppContextProps>(WrappedComponent: ComponentType<TWrappedComponentProps>) => {\r\n    type WrappedComponentPropsExceptProvided = Exclude<keyof TWrappedComponentProps, keyof AppContextProps>;\r\n    type ForwardedProps = Pick<TWrappedComponentProps, WrappedComponentPropsExceptProvided>;\r\n    return class WithContext extends Component<ForwardedProps> {\r\n        public render() {\r\n            return (\r\n                <AppContext.Consumer>\r\n                    {(context: any) => <WrappedComponent {...this.props } {...context} />}\r\n                </AppContext.Consumer>\r\n            );\r\n        }\r\n    };\r\n};\r\n","import React from 'react';\r\nimport { Structure } from 'definitions/structures';\r\nimport { Sprite } from '@inlet/react-pixi';\r\nimport HitAreaShapes from 'utils/hitAreaShapes';\r\nimport { STRUCTURE_HIGHLIGHT_FILTER } from 'components/town/TownView';\r\n\r\nexport interface Props {\r\n    onStructureClick: (structure: Structure | null) => void;\r\n    position: PIXI.Point;\r\n    selected?: boolean;\r\n    structure: Structure;\r\n    hitAreaShapes: HitAreaShapes;\r\n}\r\n\r\nconst Generic = (props: Props) => {\r\n    const {structure, position, hitAreaShapes, selected, onStructureClick} = props;\r\n    const filters = selected ? [STRUCTURE_HIGHLIGHT_FILTER] : [];\r\n\r\n    const handlePointerTap = () => {\r\n        onStructureClick(structure);\r\n    };\r\n\r\n    return (\r\n        <Sprite\r\n            name={structure}\r\n            position={position}\r\n            interactive={true}\r\n            buttonMode={true}\r\n            pointertap={handlePointerTap}\r\n            hitArea={hitAreaShapes}\r\n            filters={filters}\r\n            image={`${process.env.PUBLIC_URL}/img/town/town-alpha/${structure}.png`}\r\n        >\r\n            {/* <Graphics\r\n                name=\"hitarea\"\r\n                draw={graphics => {\r\n                    graphics.beginFill(0xffffff);\r\n                    hitAreaShapes.shapes.map(shape => graphics.drawPolygon(shape))\r\n                    graphics.endFill();\r\n                }}\r\n            /> */}\r\n        </Sprite>\r\n    );\r\n}\r\nexport default Generic;","import React from \"react\";\r\nimport \"./css/legenda.css\";\r\nimport { StructuresStoreState } from 'stores/structures';\r\nimport { Structure } from 'definitions/structures';\r\nimport { StructureStoreState, StructureState } from 'stores/structure';\r\nimport { Link } from 'react-router-dom';\r\nimport { getStructureLink, getTownLink } from 'utils/routing';\r\nimport { TextManager } from 'global/TextManager';\r\nimport { useRouteMatch } from 'react-router';\r\n\r\ninterface Props {\r\n    structures: StructuresStoreState;\r\n}\r\n\r\n// Legenda with clickable names of structures\r\nconst Legenda = (props: Props) => {\r\n    const {structures} = props;\r\n    const orderedStructures = [\r\n        Structure.workshop,\r\n        Structure.quarry,\r\n        Structure.tavern,\r\n        Structure.tannery,\r\n        Structure.alchemist,\r\n        Structure.garden,\r\n        Structure.weaponsmith,\r\n        Structure.armoursmith,\r\n        Structure.warehouse,\r\n        Structure.mine,\r\n        Structure.lumberMill,\r\n        Structure.weaver,\r\n    ];\r\n    const match = useRouteMatch<{structure: string}>(`${getTownLink()}/:structure`);\r\n\r\n    const renderText = (structure: Structure) => {\r\n        if (match?.params.structure === structure.toString()) {\r\n            return (\r\n                <span className=\"highlighted\">{`${TextManager.getStructureName(structure)}`}</span>\r\n            )\r\n        }\r\n        return (\r\n            <Link to={getStructureLink(structure)} >\r\n                {`${TextManager.getStructureName(structure)}`}\r\n            </Link>\r\n        )\r\n    }\r\n\r\n    return (\r\n        <div className=\"legenda\">\r\n            <ul>\r\n            {orderedStructures.map((structure) => {\r\n                const structureStore: StructureStoreState = structures[structure];\r\n                if (structureStore.state === StructureState.NotBuilt) {\r\n                    return null;\r\n                }\r\n                return (\r\n                    <li key={structure}>\r\n                        {renderText(structure)}\r\n                    </li>\r\n                );\r\n            })}\r\n            </ul>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default Legenda;","import React, { useRef, useEffect, useState } from \"react\";\r\nimport { Stage, Sprite } from '@inlet/react-pixi';\r\nimport { Structure } from 'definitions/structures';\r\nimport { StructuresStoreState } from 'stores/structures';\r\nimport { SoundManager, MusicTrack } from 'global/SoundManager';\r\nimport { Viewport as PixiViewport} from 'pixi-viewport';\r\nimport { useRouteMatch } from 'react-router';\r\nimport {OutlineFilter} from '@pixi/filter-outline';\r\nimport { getTownLink } from 'utils/routing';\r\nimport Viewport from '../pixi/Viewport';\r\nimport { StructureState, StructureStoreState } from 'stores/structure';\r\nimport { useSelector } from 'react-redux';\r\nimport { StoreState } from 'stores';\r\nimport { gsap } from 'gsap';\r\nimport { MAX_WIDTH } from 'components/App';\r\nimport HitAreaShapes from 'utils/hitAreaShapes';\r\nimport polygons from './hitAreas.json';\r\nimport LumberMill from './structures/LumberMill';\r\nimport Tavern from './structures/Tavern';\r\nimport { withAppContext, AppContextProps } from 'hoc/withAppContext';\r\nimport Generic from './structures/Generic';\r\nimport Legenda from './Legenda';\r\nimport \"./css/townView.css\"\r\n\r\nconst HEIGHT = 1079;\r\nconst WORLD_WIDTH = 1024;\r\nconst WORLD_HEIGHT = 1600;\r\n\r\nexport interface Props {\r\n    onStructureClick: (structure: Structure | null) => void;\r\n}\r\n\r\n// todo: animate this\r\nexport const STRUCTURE_HIGHLIGHT_FILTER = new OutlineFilter(8, 0xffcc00);\r\n\r\nconst TownView = (props: Props & AppContextProps) => {\r\n    const match = useRouteMatch<{structure: string}>(`${getTownLink()}/:structure`);\r\n    const selectedStructure = match?.params.structure;\r\n    const ref = useRef<HTMLDivElement>(null);\r\n\r\n    useEffect(() => {\r\n        SoundManager.addMusicTrack(MusicTrack.town, \"sound/music/Soliloquy.mp3\");\r\n        SoundManager.playMusicTrack(MusicTrack.town);\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        const tween = gsap.to(STRUCTURE_HIGHLIGHT_FILTER, {\r\n            duration: .6,\r\n            thickness: 2,\r\n            yoyo: true,\r\n            repeat: -1\r\n        });\r\n        return () => {\r\n            tween.pause(0);\r\n            tween.kill();\r\n        }\r\n    }, []);\r\n\r\n    const handleStructureClick = (structure: Structure | null) => {\r\n        if (!dragging.current) {\r\n            // if (structure) {\r\n            //     // history.push(getStructureLink(structure));\r\n            // } else {\r\n            //     // history.push(getTownLink());\r\n            // }\r\n            props.onStructureClick(structure);\r\n        }\r\n    }\r\n    // console.log('rendering town');\r\n\r\n    const structures = useSelector<StoreState, StructuresStoreState>((state: StoreState) => {\r\n        return state.structures;\r\n    });\r\n\r\n\r\n    const renderStructures = () => {\r\n        const orderedStructures = [\r\n            Structure.workshop,\r\n            Structure.quarry,\r\n            Structure.tavern,\r\n            Structure.tannery,\r\n            Structure.alchemist,\r\n            Structure.garden,\r\n            Structure.weaponsmith,\r\n            Structure.armoursmith,\r\n            Structure.warehouse,\r\n            Structure.mine,\r\n            Structure.lumberMill,\r\n            Structure.weaver,\r\n        ]\r\n        return orderedStructures.reverse().map((structure) => {\r\n            const structureStore: StructureStoreState = structures[structure];\r\n            if (structureStore.state === StructureState.NotBuilt) {\r\n                return null;\r\n            }\r\n            // todo: refactor into seperate components\r\n\r\n            const StructureComponent = getStructure(structure);\r\n            const position = getStructurePosition(structure);\r\n            const hitAreaShapes = new HitAreaShapes(polygons, structure);\r\n            return (\r\n                <StructureComponent\r\n                    position={position}\r\n                    structure={structure}\r\n                    hitAreaShapes={hitAreaShapes}\r\n                    onStructureClick={handleStructureClick}\r\n                    key={structure}\r\n                    selected={selectedStructure === structure}\r\n                />\r\n            );\r\n        });\r\n    }\r\n\r\n    const dragging = useRef(false);\r\n    const viewportRef = useRef<PixiViewport>(null);\r\n    useEffect(() => {\r\n        if(viewportRef.current) {\r\n            const viewport = viewportRef.current;\r\n            viewport.on(\"drag-start\", () => { dragging.current = true; });\r\n            viewport.on(\"drag-end\", () => { dragging.current = false; });\r\n        }\r\n\r\n        const onScroll = (e: WheelEvent) => {\r\n            // Scrolling the mouse is just used for zoom, not for actual scrolling\r\n            e.preventDefault();\r\n        }\r\n        window.addEventListener(\"wheel\", onScroll, {passive: false});\r\n        return () => {\r\n            window.removeEventListener(\"wheel\", onScroll);\r\n        };\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        if (selectedStructure && viewportRef.current) {\r\n            const viewport = viewportRef.current;\r\n            viewport.zoomPercent(2);\r\n            const position = getStructurePosition(Structure[selectedStructure]);\r\n            viewport.moveCenter(position);\r\n        }\r\n    }, [selectedStructure]);\r\n\r\n    const [canvasWidth, setCanvasWidth] = useState(MAX_WIDTH);\r\n    const [canvasHeight, setCanvasHeight] = useState(HEIGHT);\r\n\r\n    useEffect(() => {\r\n        // This will set the dimensions of the canvas tot that of the townview\r\n        const resize = () => {\r\n            const worldViewWidth = ref.current?.clientWidth || MAX_WIDTH;\r\n            const worldViewHeight = ref.current?.clientHeight || HEIGHT;\r\n\r\n            setCanvasWidth(worldViewWidth);\r\n            setCanvasHeight(worldViewHeight);\r\n        }\r\n        resize();\r\n        window.addEventListener(\"resize\", resize);\r\n        return () => {\r\n            window.removeEventListener(\"resize\", resize);\r\n        };\r\n    }, []);\r\n\r\n    const options = {\r\n        sharedLoader: true\r\n    }\r\n    return (\r\n        <div className=\"town-view\" ref={ref}>\r\n            <Legenda structures={structures} />\r\n            <Stage width={canvasWidth} height={canvasHeight} options={options} >\r\n                <Viewport screenWidth={canvasWidth} screenHeight={canvasHeight} worldWidth={WORLD_WIDTH} worldHeight={WORLD_HEIGHT} ref={viewportRef}>\r\n                    <Sprite\r\n                        name=\"background\"\r\n                        image={`${process.env.PUBLIC_URL}/img/town/town-alpha/background.png`}\r\n                    >\r\n                        {renderStructures()}\r\n                    </Sprite>\r\n                </Viewport>\r\n            </Stage>\r\n            {/* { selectedStructure && (\r\n                <StructureDetailsView\r\n                    structure={selectedStructure}\r\n                    title={TextManager.getStructureName(selectedStructure)}\r\n                    onClose={() => handleStructureClick(null)}\r\n                />\r\n            )} */}\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default withAppContext(TownView);\r\n\r\nconst getStructure = (structure: Structure) => {\r\n    switch (structure) {\r\n        case Structure.workshop:\r\n        case Structure.quarry:\r\n        case Structure.tannery:\r\n        case Structure.alchemist:\r\n        case Structure.garden:\r\n        case Structure.weaponsmith:\r\n        case Structure.armoursmith:\r\n        case Structure.warehouse:\r\n        case Structure.mine:\r\n        case Structure.weaver:\r\n            return Generic;\r\n        case Structure.lumberMill:\r\n            return LumberMill;\r\n        case Structure.tavern:\r\n            return Tavern;\r\n    }\r\n}\r\n\r\nconst getStructurePosition = (structure: Structure) => {\r\n    let x;\r\n    let y;\r\n    switch (structure) {\r\n        case Structure.workshop:\r\n            x = 373;\r\n            y = 610;\r\n            break;\r\n        case Structure.quarry:\r\n            x = 632;\r\n            y = 633;\r\n            break;\r\n        case Structure.tannery:\r\n            x = 372;\r\n            y = 460;\r\n            break;\r\n        case Structure.tavern:\r\n            x = 500;\r\n            y = 469;\r\n            break;\r\n        case Structure.alchemist:\r\n            x = 411;\r\n            y = 371;\r\n            break;\r\n        case Structure.garden:\r\n            x = 822;\r\n            y = 689;\r\n            break;\r\n        case Structure.weaponsmith:\r\n            x = 449;\r\n            y = 460;\r\n            break;\r\n        case Structure.armoursmith:\r\n            x = 473;\r\n            y = 442;\r\n            break;\r\n        case Structure.warehouse:\r\n            x = 471;\r\n            y = 130;\r\n            break;\r\n        case Structure.lumberMill:\r\n            x = 403;\r\n            y = 320;\r\n            break;\r\n        case Structure.mine:\r\n            x = 183;\r\n            y = 527;\r\n            break;\r\n        case Structure.weaver:\r\n            x = 484;\r\n            y = 333;\r\n            break;\r\n    }\r\n    return new PIXI.Point(x, y);\r\n}","import React, { useEffect, useState } from 'react';\r\nimport { ToastManager, ToastConfig } from 'global/ToastManager';\r\nimport Toast from './Toast';\r\nimport './styles/toasts.scss';\r\n\r\n// Toasts can be added by calling ToastManager.addToast\r\n// ToastManager will inform whenever the something is added to the list of toasts via EVENT_TOASTS_UPDATED\r\n// The toasts themselves will fade out via css transition\r\nconst Toasts = () => {\r\n\r\n    const [activeToasts, setActiveToasts] = useState<ToastConfig[]>([]);\r\n\r\n    const toastsUpdated = (stack: ToastConfig[]) => {\r\n        setActiveToasts(stack);\r\n    }\r\n\r\n    useEffect(() => {\r\n        ToastManager.addEventListener(ToastManager.EVENT_TOASTS_UPDATED, toastsUpdated);\r\n        return () => {\r\n            ToastManager.removeEventListener(ToastManager.EVENT_TOASTS_UPDATED, toastsUpdated);\r\n        }\r\n    }, []);\r\n\r\n    return (\r\n        <div className=\"toasts\" > \r\n            { activeToasts.map((toastConfig) => (\r\n                <Toast key={toastConfig.time} {...toastConfig}/>\r\n            ))}\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default Toasts;","import * as React from \"react\";\r\nimport \"./css/squareiconbutton.css\";\r\n\r\nexport interface Props {\r\n    text: string; /* temp */\r\n    className?: string;\r\n    onClick?: React.MouseEventHandler<Element>;\r\n}\r\n\r\ntype AllProps = Props;\r\n\r\nconst SquareIconButton = (props: AllProps) => {\r\n    const handleClick = (e: React.MouseEvent<HTMLDivElement>) => {\r\n        if (props.onClick) {\r\n            props.onClick(e);\r\n        }\r\n    };\r\n    const className = props.className || \"\";\r\n    return (\r\n        <div className={ `ui-button widgets-squareiconbutton ${className}`} onClick={handleClick}>\r\n            {props.text}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default SquareIconButton;\r\n","import SquareIconButton from \"components/ui/buttons/SquareIconButton\";\r\nimport * as React from \"react\";\r\nimport { SoundManager, Sound } from 'global/SoundManager';\r\nimport \"components/ui/css/common/icon.css\";\r\nimport \"components/ui/resources/css/resourcesbox.css\";\r\n\r\n// todo: refactor using WindowManager [30/03/2020]\r\nexport interface Props {\r\n    title: string;\r\n    backEnabled?: boolean;\r\n    closeEnabled?: boolean;\r\n    onClose?: () => void;\r\n    onBack?: () => void;\r\n}\r\n\r\ntype AllProps = Props;\r\n\r\n/**\r\n *\r\n */\r\nconst Window: React.FunctionComponent<AllProps> = (props) => {\r\n\r\n    const handleClose = (e: React.MouseEvent) => {\r\n        if (props.onClose) {\r\n            props?.onClose();\r\n\r\n            SoundManager.playSound(Sound.buttonClick);\r\n        }\r\n    };\r\n\r\n    const handleBack = (e: React.MouseEvent) => {\r\n        if (props.onBack) {\r\n            props?.onBack();\r\n\r\n            SoundManager.playSound(Sound.buttonClick);\r\n        }\r\n    };\r\n\r\n    return <div className = \"window\">\r\n        <div className = \"header\">\r\n            { props.backEnabled !== false && <SquareIconButton className = \"back-button\" onClick = { handleBack } text = \"<\"/> }\r\n            <h3>{ props.title }</h3>\r\n            { props.closeEnabled !== false && <SquareIconButton className = \"close-button\" onClick = { handleClose } text = \"x\"/> }\r\n        </div>\r\n        { props.children }\r\n    </div>;\r\n};\r\n\r\nexport default Window;\r\n","import \"components/ui/window/css/window.css\";\nimport Window, { Props } from \"components/ui/window/Window\";\nimport * as React from \"react\";\n\nexport const withWindow = <TWrappedComponentProps extends Props>(WrappedComponent: React.ComponentType<TWrappedComponentProps>) => {\n    return class WithWindow extends React.Component<TWrappedComponentProps> {\n\n        public render() {\n            return <Window { ...this.props } >\n                <WrappedComponent { ...this.props } />\n            </Window>;\n        }\n    };\n};\n","import { withWindow } from \"hoc/withWindow\";\r\nimport * as React from \"react\";\r\nimport { compose } from \"redux\";\r\nimport \"./css/settingswindow.css\";\r\nimport { ChangeEvent, useRef } from 'react';\r\nimport { SoundManager } from 'global/SoundManager';\r\nimport gsap from 'gsap';\r\n\r\nconst SettingsWindow = () => {\r\n\r\n    const soundSlider = useRef<HTMLInputElement>(null);\r\n    const musicSlider = useRef<HTMLInputElement>(null);\r\n\r\n    const handleSoundMuteClick = () => {\r\n        gsap.to(soundSlider.current, {\r\n            duration: .5,\r\n            value: 0,\r\n            onComplete: () => {\r\n                SoundManager.soundVolume = 0;\r\n            }\r\n        });\r\n    }\r\n    const handleMusicMuteClick = () => {\r\n        gsap.to(musicSlider.current, {\r\n            duration: .5,\r\n            value: 0,\r\n            onComplete: () => {\r\n                SoundManager.musicVolume = 0;\r\n            }\r\n        });\r\n    }\r\n\r\n    const handleSoundChange = (e: ChangeEvent<HTMLInputElement>) => {\r\n        const linear = parseFloat(e.target.value);\r\n        const log = Math.pow(linear, 2);\r\n        SoundManager.soundVolume = log;\r\n    };\r\n\r\n    const handleMusicChange = (e: ChangeEvent<HTMLInputElement>) => {\r\n        const linear = parseFloat(e.target.value);\r\n        const log = Math.pow(linear, 2);\r\n        SoundManager.musicVolume = log;\r\n    };\r\n\r\n    return (\r\n        <div className=\"settings-window\">\r\n            <details open = { true } className=\"sound\" >\r\n                <summary>Sound</summary>\r\n                <section>\r\n                    <p>\r\n                        <label>Sound</label>\r\n                        <button onClick={handleSoundMuteClick}>\r\n                            <span role=\"img\" aria-label=\"Mute\">🔇</span>\r\n                        </button>\r\n                        <input\r\n                            type=\"range\"\r\n                            min=\"0\"\r\n                            max=\"1\"\r\n                            step=\"0.05\"\r\n                            ref={soundSlider}\r\n                            onChange={handleSoundChange}\r\n                            defaultValue={`${Math.sqrt(SoundManager.soundVolume)}`}\r\n                        />\r\n                    </p>\r\n                    <p>\r\n                        <label>Music</label>\r\n                        <button onClick={handleMusicMuteClick}>\r\n                            <span role=\"img\" aria-label=\"Mute\">🔇</span>\r\n                        </button>\r\n                        <input\r\n                            type=\"range\"\r\n                            min=\"0\"\r\n                            max=\"1\"\r\n                            step=\"0.05\"\r\n                            ref={musicSlider}\r\n                            onChange={handleMusicChange}\r\n                            defaultValue={`${Math.sqrt(SoundManager.musicVolume)}`}\r\n                        />\r\n                    </p>\r\n                </section>\r\n            </details>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default compose(\r\n    withWindow,\r\n)(SettingsWindow);\r\n","import { Resource } from \"definitions/resources\";\r\n\r\n// Whenever a list of resource is shown, use this order\r\nexport const resourceOrder = [\r\n    Resource.food,\r\n    Resource.wood,\r\n    Resource.iron,\r\n    Resource.stone,\r\n    Resource.fabric,\r\n    Resource.leather,\r\n];\r\n","import { getDefinition } from \"definitions/items\";\r\nimport { Item, ItemType } from \"definitions/items/types\";\r\nimport { getDefinition as getStructureDefinition, Structure } from \"definitions/structures\";\r\nimport * as React from \"react\";\r\nimport { StructureState, StructureStoreState } from \"stores/structure\";\r\nimport { StructuresStoreState } from \"stores/structures\";\r\nimport { TextManager } from \"global/TextManager\";\r\nimport { useRef, useState } from 'react';\r\nimport { ToastManager } from 'global/ToastManager';\r\nimport { Type } from 'components/ui/toasts/Toast';\r\nimport { useDispatch, useSelector } from 'react-redux';\r\nimport { addLogText } from 'actions/log';\r\nimport { LogChannel } from 'stores/logEntry';\r\nimport { resourceOrder } from 'constants/resources';\r\nimport { ResourceStoreState } from 'stores/resources';\r\nimport { addResources } from 'actions/resources';\r\nimport { setStructureState } from 'actions/structures';\r\nimport { StoreState } from 'stores';\r\nimport { addGold } from 'actions/gold';\r\nimport { addItemToWarehouse } from 'actions/items';\r\nimport { addWorkers } from 'actions';\r\nimport \"./css/cheatbox.css\";\r\nimport { withWindow } from 'hoc/withWindow';\r\n\r\n\r\n// tslint:disable-next-line:no-empty-interface\r\nexport interface Props {\r\n}\r\n\r\n\r\nconst CheatWindow = (props: Props) => {\r\n\r\n    const itemSelectRef = useRef<HTMLSelectElement>(null);\r\n    const [cheats, setCheats] = useState({\r\n        gold: 50,\r\n        resources: 50,\r\n        workers: 10,\r\n    });\r\n    const dispatch = useDispatch();\r\n\r\n    const onCheatGold = (amount: number) => {\r\n        dispatch(addGold(amount));\r\n        dispatch(addLogText(\"common-cheat-gold-added\", { amount }, LogChannel.common));\r\n    };\r\n\r\n    const onCheatItem = (item: Item) => {\r\n        dispatch(addItemToWarehouse(item));\r\n        dispatch(addLogText(\"common-cheat-item-added\", { item }, LogChannel.common));\r\n    };\r\n\r\n    const onCheatResources = (amount: number) => {\r\n        // Create ResourceStoreState where value of each resource is `amount`\r\n        const resources = resourceOrder.reduce((acc: ResourceStoreState, resource) => {\r\n            acc[resource] = amount;\r\n            return acc;\r\n        }, {});\r\n\r\n        dispatch(addResources(resources));\r\n        dispatch(addLogText(\"common-cheat-resources-added\", { amount }, LogChannel.common));\r\n    };\r\n\r\n    const onCheatStructureState = (structure: Structure, state: StructureState) => {\r\n        dispatch(setStructureState(structure, state))\r\n    }\r\n\r\n    const onCheatWorkers = (amount: number) => {\r\n        dispatch(addWorkers(amount));\r\n        dispatch(addLogText(\"common-cheat-workers-added\", { amount }, LogChannel.common));\r\n    };\r\n\r\n    const structures = useSelector<StoreState, StructuresStoreState>(store => store.structures);\r\n\r\n\r\n    const getStructureRow = (structure: Structure) => {\r\n        const structureDef = getStructureDefinition(structure);\r\n        const structureStore: StructureStoreState = structures[structure];\r\n        const levelDef = structureDef.levels[structureStore.level];\r\n\r\n        const displayName = TextManager.get(levelDef.displayName);\r\n\r\n        return <div\r\n            className=\"label-dropdown\"\r\n            key={structure}\r\n        >\r\n            <label title={structure}>\r\n                { `${displayName}` }\r\n            </label>\r\n            <input\r\n                key={structure}\r\n                type=\"checkbox\"\r\n                checked={structures[structure].state === StructureState.Built }\r\n                onChange={() => handleChangeStructureState(structure, structures[structure].state !== StructureState.Built)}\r\n            />\r\n        </div>;\r\n    };\r\n\r\n    const getItemTypeOptions = (type: ItemType) => {\r\n        return Object.keys(Item)\r\n            // eslint-disable-next-line eqeqeq\r\n            // tslint:disable-next-line: triple-equals\r\n            .filter((item: string) => getDefinition(item as Item).itemType == type)\r\n            .map((item: string) => getItemOption(item as Item));\r\n    };\r\n\r\n    const getItemOption = (item: Item) => {\r\n        return <option value ={item } key ={item }>\r\n            { TextManager.getItemName(item) }\r\n        </option>;\r\n    };\r\n\r\n    const items = Object.keys(ItemType)\r\n        .filter((val: any) => !isNaN(val))\r\n        .map((type: string) => {\r\n        return <optgroup label ={ItemType[type] } key ={type }>\r\n            { getItemTypeOptions(type as unknown as ItemType) }\r\n        </optgroup>;\r\n    });\r\n\r\n\r\n    const handleCheatGold = (evt: React.MouseEvent<HTMLButtonElement>) => {\r\n        const amount = cheats.gold;\r\n        onCheatGold(amount);\r\n\r\n        const text = TextManager.get(\"common-cheat-gold-added\", { amount });\r\n        const icon = \"/img/resources/gold.png\";\r\n        ToastManager.addToast(text, Type.cheat, icon);\r\n    }\r\n\r\n    const handleCheatWorkers = (evt: React.MouseEvent<HTMLButtonElement>) => {\r\n        const amount = cheats.workers;\r\n        onCheatWorkers(amount);\r\n        const text = TextManager.get(\"common-cheat-workers-added\", { amount });\r\n        const icon = \"/img/resources/worker.png\";\r\n        ToastManager.addToast(text, Type.cheat, icon);\r\n    }\r\n\r\n    const handleCheatResources = (evt: React.MouseEvent<HTMLButtonElement>) => {\r\n        onCheatResources(cheats.resources);\r\n        const text = TextManager.get(\"common-cheat-resources-added\", { amount: cheats.resources });\r\n        ToastManager.addToast(text, Type.cheat);\r\n    }\r\n\r\n    const handleCheatItem = (evt: React.MouseEvent<HTMLButtonElement>) => {\r\n        const item = itemSelectRef.current!.value as Item;\r\n        onCheatItem(item);\r\n\r\n        const text = TextManager.get(\"common-cheat-item-added\", { item });\r\n        const icon = getDefinition(item).iconImg;\r\n        ToastManager.addToast(text, Type.cheat, icon);\r\n    }\r\n\r\n    const handleChangeStructureState = (structure: Structure, checked: boolean) => {\r\n        onCheatStructureState(structure, checked ? StructureState.Built : StructureState.NotBuilt);\r\n        if (checked) {\r\n            ToastManager.addToast(`The ${TextManager.getStructureName(structure)} is constructed`, Type.cheat);\r\n        } else {\r\n            ToastManager.addToast(`The ${TextManager.getStructureName(structure)} is not constructed`, Type.cheat);\r\n        }\r\n    }\r\n\r\n    const handleChangeGold = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n        const amount = Number(event.target.value);\r\n        setCheats({\r\n            ...cheats,\r\n            gold: amount,\r\n        });\r\n    }\r\n\r\n    const handleChangeWorkers = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n        const amount = Number(event.target.value);\r\n        setCheats({\r\n            ...cheats,\r\n            workers: amount,\r\n        });\r\n    }\r\n\r\n    const handleChangeResources = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n        const amount = Number(event.target.value);\r\n        setCheats({\r\n            ...cheats,\r\n            resources: amount,\r\n        });\r\n    }\r\n\r\n    return (\r\n        <div className=\"cheat-box\">\r\n            <div className=\"label-numberbox-button\">\r\n                <label>Gold</label>\r\n                <input type=\"number\"\r\n                    value= {cheats.gold}\r\n                    style={{width: \"50px\"}}\r\n                    onChange={handleChangeGold}/>\r\n                <button onClick={handleCheatGold}>Add</button>\r\n            </div>\r\n            <div className=\"label-numberbox-button\">\r\n                <label>Workers</label>\r\n                <input type=\"number\"\r\n                    value= {cheats.workers}\r\n                    style={{width: \"50px\"}}\r\n                    onChange={handleChangeWorkers}/>\r\n                <button onClick={handleCheatWorkers}>Add</button>\r\n            </div>\r\n            <div className=\"label-numberbox-button\">\r\n                <label>Resources</label>\r\n                <input type=\"number\"\r\n                    value= {cheats.resources}\r\n                    style={{width: \"50px\"}}\r\n                    onChange={handleChangeResources}/>\r\n                <button onClick={handleCheatResources}>Add</button>\r\n            </div>\r\n            <div className=\"label-numberbox-button\">\r\n                <label>Items</label>\r\n                <select style={{width: \"150px\"}} ref={itemSelectRef}>\r\n                    { items }\r\n                </select>\r\n                <button onClick={handleCheatItem}>Add</button>\r\n            </div>\r\n            { Object.keys(structures).map((structure) => getStructureRow(structure as Structure)) }\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default withWindow(CheatWindow);\r\n","import { ItemDefinition } from \"definitions/items/types\";\r\n\r\n// Things that can be shown on the ContextPopup\r\nexport enum ContextType {\r\n    item,\r\n    resource\r\n}\r\n\r\nexport type ContextInfo = ItemDefinition | string;\r\n","import { Props as WindowProps } from \"components/ui/window/Window\";\r\nimport { AppContextProps, withAppContext } from \"hoc/withAppContext\";\r\nimport { withWindow } from \"hoc/withWindow\";\r\nimport * as React from \"react\";\r\nimport { compose } from \"redux\";\r\nimport \"./css/cheatbox.css\";\r\nimport SettingsWindow from './SettingsWindow';\r\nimport CheatWindow from './CheatWindow';\r\n\r\nexport interface DispatchProps {\r\n}\r\n\r\nexport interface StateProps {\r\n}\r\n\r\n// tslint:disable-next-line:no-empty-interface\r\nexport interface Props {\r\n}\r\n\r\ninterface LocalState {\r\n}\r\n\r\ntype AllProps = Props & StateProps & DispatchProps & WindowProps;\r\nconst Menu = (props: AllProps & AppContextProps) => {\r\n\r\n    const handleClickCheats = () => {\r\n        const window = <CheatWindow title = \"Cheats\" />;\r\n        props.onOpenWindow(window);\r\n    };\r\n\r\n    const handleClickSettings = () => {\r\n        const window = <SettingsWindow title = \"Settings\" />;\r\n        props.onOpenWindow(window);\r\n    };\r\n    return (\r\n        <div className=\"menu\">\r\n            <p>\r\n                <button onClick={handleClickCheats}>Cheats!</button>\r\n            </p>\r\n            <p>\r\n                <button onClick={handleClickSettings}>Settings</button>\r\n            </p>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default compose(\r\n    withWindow,\r\n    withAppContext,\r\n)(Menu) as React.ComponentType<AllProps>;\r\n","import { ContextInfo, ContextType } from 'constants/context';\r\nimport deepEquals from 'deep-equal';\r\nimport EventEmitter from './EventEmitter';\r\n\r\nexport interface Context {\r\n    type: ContextType;\r\n    info: ContextInfo;\r\n    referenceRect: ClientRect;\r\n}\r\n\r\nexport abstract class TooltipManager extends EventEmitter<Context>() {\r\n\r\n    static EVENT_CONTEXT_UPDATED = \"tooltipContextUpdated\";\r\n    private static lastContext: Context | undefined;\r\n\r\n    static showContextTooltip (type: ContextType, info: ContextInfo, originRect: ClientRect) {\r\n        const context = { type, info, referenceRect: originRect};\r\n\r\n        if(deepEquals(context, this.lastContext)) {\r\n            this.clear();\r\n        } else {\r\n            this.emit(this.EVENT_CONTEXT_UPDATED, context);\r\n            this.lastContext = context;\r\n        }\r\n    }\r\n\r\n    static clear() {\r\n        this.emit(this.EVENT_CONTEXT_UPDATED, undefined);\r\n        this.lastContext = undefined;\r\n    }\r\n}","import { StoreState } from 'stores';\r\nimport { useSelector } from 'react-redux';\r\n\r\n// Returns the gold from redux store\r\nconst useGold = () => {\r\n    return useSelector<StoreState, number>(store => store.gold);\r\n}\r\n\r\nexport default useGold;","import { StoreState } from 'stores';\r\nimport { useSelector } from 'react-redux';\r\nimport { ResourceStoreState } from 'stores/resources';\r\n\r\n// Returns the gold from redux store\r\n// todo: rename to useResourcesState\r\nconst useResources = () => {\r\n    return useSelector<StoreState, ResourceStoreState>(store => store.resources);\r\n}\r\n\r\nexport default useResources;","import { createSelector } from \"reselect\";\r\nimport { StoreState } from \"stores\";\r\nimport { StructureStoreState } from \"stores/structure\";\r\nimport { StructuresStoreState } from \"stores/structures\";\r\n\r\nconst getStructures = (state: StoreState) => state.structures;\r\nconst getWorkers = (state: StoreState) => state.workers;\r\n\r\nconst calculateFreeWorkers = (structures: StructuresStoreState, workers: number) => {\r\n    // Add up all the workers used by all structures in town\r\n    const workersUsed = Object.keys(structures).map((name) => structures[name])\r\n        .reduce((acc: number, value: StructureStoreState) => acc += value.workers, 0);\r\n\r\n    return workers - workersUsed;\r\n};\r\n\r\nexport const selectFreeWorkers = createSelector([\r\n    getStructures,\r\n    getWorkers],\r\n    calculateFreeWorkers,\r\n);\r\n","import \"components/ui/css/common/icon.css\";\r\nimport { resourceOrder } from \"constants/resources\";\r\nimport resourceDescriptions from \"definitions/resources\";\r\nimport * as React from \"react\";\r\nimport { ResourceStoreState } from \"stores/resources\";\r\nimport \"./css/resourcebar.css\";\r\nimport { formatNumber } from 'utils/number';\r\nimport { TooltipManager } from 'global/TooltipManager';\r\nimport { ContextType } from 'constants/context';\r\nimport useGold from 'hooks/store/useGold';\r\nimport useResources from 'hooks/store/useResources';\r\nimport { useWorkersFree } from 'hooks/store/useWorkers';\r\n\r\nexport interface StateProps  {\r\n    gold: number;\r\n    workers: number;    // total\r\n    workersFree: number;\r\n    resources: ResourceStoreState;\r\n}\r\n\r\n/** Shown on top in the UI */\r\nconst Resourcebar = () => {\r\n\r\n    const gold = useGold();\r\n    const storeResources = useResources();\r\n    const workersFree = useWorkersFree();\r\n\r\n    const createItem = (icon: string, amount: number, type: string) => {\r\n\r\n        const handleClick = (event: React.MouseEvent) => {\r\n\r\n            const origin = (event.currentTarget as HTMLElement);\r\n            const originRect = origin.getBoundingClientRect();\r\n            TooltipManager.showContextTooltip(ContextType.resource, type, originRect);\r\n            event.stopPropagation();\r\n        };\r\n\r\n        return (\r\n            <li key={type} onClick={handleClick}>\r\n                <div\r\n                    className=\"icon common-icon-smallest\"\r\n                    style={{ backgroundImage: `url(${process.env.PUBLIC_URL}${icon})` }}\r\n                />\r\n                <div className=\"amount\">\r\n                    { formatNumber(amount, 0) }\r\n                </div>\r\n            </li>\r\n        )\r\n    };\r\n\r\n    const resources = resourceOrder.map((resource) => {\r\n        const resourceDescription = resourceDescriptions[resource];\r\n        return createItem(resourceDescription.iconImg, storeResources[resource as string], resource);\r\n    });\r\n\r\n    resources.push(\r\n        createItem(\"/img/resources/worker.png\", workersFree, \"workers\"),\r\n        createItem(\"/img/resources/gold.png\", gold, \"gold\"),\r\n    );\r\n\r\n    return (\r\n        <ul className=\"resourcebar\">\r\n            { resources }\r\n        </ul>\r\n    );\r\n};\r\nexport default Resourcebar;\r\n","import { StoreState } from 'stores';\r\nimport { useSelector } from 'react-redux';\r\nimport { selectFreeWorkers } from 'selectors/workers';\r\n\r\n// Returns all the workers from redux store\r\nexport const useWorkers = () => {\r\n    return useSelector<StoreState, number>(store => store.workers);\r\n}\r\n\r\n// Returns all the workers not working on something from redux store\r\nexport const useWorkersFree = () => {\r\n    const quest = useSelector<StoreState, number>(selectFreeWorkers);\r\n    return quest;\r\n}\r\n\r\n","export const formatNumber = (number: number, digits: number = 1): string => {\r\n    const SI_SYMBOL = [\"\", \"k\", \"M\", \"G\", \"T\", \"P\", \"E\"];\r\n   \r\n    // what tier? (determines SI symbol)\r\n    const tier = Math.log10(number) / 3 | 0;\r\n    // if zero, we don't need a suffix\r\n    if(tier === 0) return number.toFixed(digits);\r\n\r\n    // get suffix and determine scale\r\n    const suffix = SI_SYMBOL[tier];\r\n    const scale = Math.pow(10, tier * 3);\r\n\r\n    // scale the number\r\n    const scaled = number / scale;\r\n\r\n    // format number and add suffix\r\n    return scaled.toFixed(digits) + suffix;\r\n}","import Menu from \"components/ui/window/windows/MenuWindow\";\r\nimport * as React from \"react\";\r\nimport \"./css/topbar.css\";\r\nimport Resourcebar from './Resourcebar';\r\nimport { useContext } from 'react';\r\nimport { AppContext } from 'components/App';\r\n\r\n\r\n\r\n\r\nconst Topbar = () => {\r\n    const context = useContext(AppContext)!;\r\n\r\n    const handleClick = (e: React.MouseEvent<HTMLDivElement, MouseEvent>) => {\r\n        const window = <Menu title = \"Menu\" />;\r\n        context.onOpenWindow(window);\r\n    };\r\n\r\n    return (\r\n        <div className = \"topbar\">\r\n            <div className = \"topbar-left\">\r\n                <Resourcebar />\r\n            </div>\r\n            <div className = \"topbar-right\">\r\n                <div className = \"hamburger\" onClick = { handleClick }>☰</div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\nexport default Topbar;","import React, { useRef, useEffect } from 'react';\r\nimport { Sprite } from '@inlet/react-pixi';\r\nimport { QuestStoreState } from 'stores/quest';\r\nimport * as PIXI from 'pixi.js';\r\nimport { AdventurerStoreState } from 'stores/adventurer';\r\nwindow.PIXI = PIXI;\r\n\r\ninterface Props {\r\n    quest: QuestStoreState;\r\n    position: PIXI.Point;\r\n    selected?: boolean;\r\n    encounterActive?: boolean;\r\n    onClick?: (quest: QuestStoreState) => void;\r\n    leader: AdventurerStoreState;\r\n}\r\nconst CIRCLE_DIAMETER = 256; // = avatar size / 2\r\n\r\nconst QuestMarker = (props: Props) => {\r\n    const { quest, leader, encounterActive, position, onClick, selected } = props;\r\n    const image = selected ? '/img/world/map-marker-selected.png' : '/img/world/map-marker.png';\r\n\r\n    const avatar = useRef<PIXI.Sprite>(null);\r\n    // Mask has to be a child of the avatar in order to move with it\r\n    useEffect(() => {\r\n        const sprite = avatar.current as any as PIXI.Sprite;\r\n\r\n        const maskGraphics = new PIXI.Graphics();\r\n        maskGraphics.beginFill(0xBADA55);\r\n        maskGraphics.drawCircle(0, 0, CIRCLE_DIAMETER * 1);\r\n        maskGraphics.endFill();\r\n\r\n        sprite.mask = maskGraphics;\r\n        sprite.addChild(maskGraphics);\r\n    }, [avatar]);\r\n\r\n    return (\r\n        <Sprite\r\n            image={`${process.env.PUBLIC_URL}${image}`}\r\n            name={quest.name}\r\n            x={position.x}\r\n            y={position.y}\r\n            interactive={true}\r\n            buttonMode={true}\r\n            scale={new PIXI.Point(0.1, 0.1)}\r\n            anchor={new PIXI.Point(0.5, 1)}\r\n            pointerdown={() => {\r\n                if(onClick) {\r\n                    onClick(quest);\r\n                }\r\n            }}\r\n        >\r\n            { leader && (\r\n            <Sprite\r\n                image={`${process.env.PUBLIC_URL}/${leader.avatarImg}`}\r\n                name=\"avatar\"\r\n                anchor={new PIXI.Point(0.5, 0.5)}\r\n                x={0}\r\n                y={-396}\r\n                scale={new PIXI.Point(0.66, 0.66)}\r\n                ref={avatar}\r\n            />)}\r\n            {encounterActive && (\r\n            <Sprite\r\n                image={`${process.env.PUBLIC_URL}/img/world/quest-alert.png`}\r\n                name=\"quest-alert\"\r\n                anchor={new PIXI.Point(0.5, 1)}\r\n                x={180}\r\n                y={-396}\r\n                scale={new PIXI.Point(2, 2)}\r\n            />\r\n            )}\r\n        </Sprite>\r\n    )\r\n}\r\n\r\nexport default QuestMarker;","import { Item } from \"definitions/items/types\";\r\nimport { SceneStoreState } from './scene';\r\n\r\nexport enum QuestStatus {\r\n    unavailable,\r\n    available,  // on the quest board\r\n    active,\r\n    completed,\r\n    // todo: failed?\r\n}\r\n\r\nexport interface QuestReward {\r\n    gold?: number;\r\n    items?: Item[];\r\n}\r\n\r\nexport interface QuestStoreState {\r\n    name: string;\r\n    status: QuestStatus;\r\n    party: string[];                // list of adventurer ids\r\n    progress: number;               // Which questnode the party is at currently\r\n    questVars: any;                     // \r\n    encounterResults: string[];   // Store what option the place chose during an encounter // OBSOLETE\r\n    icon: string;\r\n\r\n    reward?: QuestReward;\r\n    scene?: SceneStoreState;\r\n    sceneName?: string;\r\n}\r\n ","import React from \"react\";\r\nimport { Graphics } from '@inlet/react-pixi';\r\n\r\ninterface Props {\r\n    positions: PIXI.Point[];\r\n}\r\n\r\nconst QuestLine = (props: Props) => {\r\n    const { positions } = props;\r\n    if (props.positions.length > 2) {\r\n        return <Graphics\r\n            name=\"questline\"\r\n            x={0}\r\n            y={0}\r\n            draw={graphics => {\r\n                graphics.lineStyle(3, 0xFF3300);\r\n                graphics.moveTo(positions[0].x, positions[0].y);\r\n\r\n                let i = 0;\r\n                for (i = 1; i < positions.length - 2; i ++)\r\n                {\r\n                    const xc = (positions[i].x + positions[i + 1].x) / 2;\r\n                    const yc = (positions[i].y + positions[i + 1].y) / 2;\r\n                    graphics.quadraticCurveTo(positions[i].x, positions[i].y, xc, yc);\r\n                }\r\n                graphics.quadraticCurveTo(positions[i].x, positions[i].y, positions[i+1].x, positions[i+1].y);\r\n                graphics.endFill();\r\n            }}\r\n        />;\r\n    }\r\n    return null;\r\n}\r\n\r\nexport default QuestLine;","import { TextEntry } from \"constants/text\";\r\nimport { createSelector } from \"reselect\";\r\nimport { StoreState } from \"stores\";\r\nimport { LogChannel, LogEntry } from \"stores/logEntry\";\r\nimport { QuestStatus, QuestStoreState } from \"stores/quest\";\r\n\r\nconst getQuests = (state: StoreState) => state.quests;\r\nconst getLog = (state: StoreState) => state.log;\r\n\r\nconst activeQuests = (quests: QuestStoreState[]) => {\r\n    // returns the names of the active quests\r\n    return quests.filter((q) => q.status === QuestStatus.active).map((q) => q);\r\n};\r\n\r\nexport const selectActiveQuests = createSelector([\r\n    getQuests],\r\n    activeQuests,\r\n);\r\n\r\n/**\r\n * Returns the most recent log entry for a given quest\r\n */\r\nexport const selectLastQuestLogEntry = (state: StoreState, questName: string) => createSelector([\r\n    getLog],\r\n    (log: LogEntry[]): TextEntry | undefined => {\r\n        const questLog = log.find((l) => l.channel === LogChannel.quest && l.channelContext === questName);\r\n        return questLog;\r\n    },\r\n)(state);\r\n\r\n/**\r\n * Returns all log entries for given quest\r\n */\r\nexport const selectQuestLogEntries = (state: StoreState, questName: string) => createSelector([\r\n    getLog],\r\n    (log: LogEntry[]): TextEntry[] | undefined => {\r\n        return log.filter((l) => l.channel === LogChannel.quest && l.channelContext === questName);\r\n    },\r\n)(state);\r\n","import * as PIXI from 'pixi.js';\r\nimport { Stage, Sprite } from '@inlet/react-pixi';\r\nimport { Viewport as PixiViewport } from \"pixi-viewport\";\r\nimport { useSelector } from 'react-redux'\r\n\r\nimport React, { useEffect, useRef, useCallback, useState } from \"react\";\r\nimport { QuestStoreState } from \"stores/quest\";\r\nimport { lerpLocation } from 'utils/pixiJs';\r\nimport { QuestDefinition, QuestNodeType, QuestNode } from \"definitions/quests/types\";\r\nimport Viewport from '../../pixi/Viewport';\r\nimport MapGrid from './MapGrid';\r\nimport QuestMarker from './QuestMarker';\r\nimport { StoreState } from 'stores';\r\nimport { getQuestLeader } from 'storeHelpers';\r\nimport { AdventurerStoreState } from 'stores/adventurer';\r\nimport QuestLine from './QuestLine';\r\nimport { MAX_WIDTH as WIDTH } from 'components/App';\r\nimport { selectActiveQuests } from 'selectors/quests';\r\nimport { getDefinition } from 'definitions/quests';\r\nwindow.PIXI = PIXI; // workaround for pixi-tilemap\r\n\r\nconst FULL_HEIGHT = 1024;\r\nconst SMALL_HEIGHT = 128;   // Used when QuestPanel is open\r\nconst WORLD_WIDTH = 1500;\r\nconst WORLD_HEIGHT = 1061;\r\nconst GRID_WIDTH = 10;      // width or height of each node location in pixels\r\n\r\n// // This stuff is needed for the pixi-js browser plugin\r\nif (process.env.NODE_ENV === \"development\") {\r\n    // @ts-ignore\r\n    // tslint:disable-next-line: no-unused-expression\r\n    window.__PIXI_INSPECTOR_GLOBAL_HOOK__ && window.__PIXI_INSPECTOR_GLOBAL_HOOK__.register({ PIXI });\r\n}\r\n\r\nexport interface Props {\r\n    selectedQuestName?: string;\r\n    smallMap: boolean;\r\n    onPartyClick: (questName: string) => void;\r\n    retrieveWorldViewRef: () => React.RefObject<HTMLDivElement>;\r\n}\r\n\r\nconst WorldMap = (props: Props) => {\r\n    const { retrieveWorldViewRef, smallMap } = props;\r\n    const questSelector = useCallback(\r\n        (state: StoreState) => state.quests.find((q) => q.name === props.selectedQuestName),\r\n        [props.selectedQuestName]\r\n    );\r\n    const selectedQuest = useSelector<StoreState, QuestStoreState | undefined>(questSelector);\r\n    const adventurers = useSelector<StoreState, AdventurerStoreState[]>((store) => store.adventurers);\r\n    const activeQuests = useSelector<StoreState, QuestStoreState[]>((store) => selectActiveQuests(store));\r\n\r\n    const handlePartyClick = (name: string) => {\r\n        props.onPartyClick(name);\r\n    };\r\n\r\n    // useEffect(() => {\r\n    //     const onScroll = (e: WheelEvent) => {\r\n    //         // When the map is big, scrolling the mouse is just used for zoom, not for actual scrolling\r\n    //         if (!smallMap) {\r\n    //             e.preventDefault();\r\n    //         }\r\n    //     }\r\n    //     window.addEventListener(\"wheel\", onScroll, {passive: false} );\r\n    //     return () => {\r\n    //         window.removeEventListener(\"wheel\", onScroll);\r\n    //     };\r\n    // }, [smallMap]);\r\n\r\n\r\n    const [canvasWidth, setCanvasWidth] = useState(WIDTH);\r\n    const [canvasHeight, setCanvasHeight] = useState(FULL_HEIGHT);\r\n\r\n    useEffect(() => {\r\n        // This will set the dimensions of the canvas tot that of the parent (worldview)\r\n        const resize = () => {\r\n            const worldView = retrieveWorldViewRef();\r\n            const worldViewWidth = worldView.current?.clientWidth || WIDTH;\r\n            const worldViewHeight = worldView.current?.clientHeight || FULL_HEIGHT;\r\n\r\n            setCanvasWidth(worldViewWidth);\r\n            if (smallMap) {\r\n                if (worldViewWidth < 576) {\r\n                    // Small screens\r\n                    setCanvasHeight(SMALL_HEIGHT / 2);\r\n                } else {\r\n                    setCanvasHeight(SMALL_HEIGHT);\r\n                }\r\n            }\r\n            else {\r\n                setCanvasHeight(worldViewHeight);\r\n            }\r\n        }\r\n        resize();\r\n        window.addEventListener(\"resize\", resize);\r\n        return () => {\r\n            window.removeEventListener(\"resize\", resize);\r\n        };\r\n    }, [retrieveWorldViewRef, smallMap]);\r\n\r\n    useEffect(() => {\r\n        if (selectedQuest) {\r\n            focusOnQuestingParty(selectedQuest);\r\n        }\r\n    }, [selectedQuest, canvasHeight])\r\n\r\n    const viewportRef = useRef<PixiViewport>(null);\r\n    useEffect(() => {\r\n        // focus on center of the map\r\n        if (viewportRef.current) {\r\n            const viewport = viewportRef.current;\r\n            const point = nodeLocationToPoint({ x: 0, y: 0 });\r\n            viewport.moveCenter(point.x, point.y);\r\n        }\r\n    }, [canvasWidth]);\r\n\r\n    const renderQuestlines = () => {\r\n        return activeQuests.map((quest) => {\r\n            const previousPositions = getPreviousPositions(quest);\r\n            return (\r\n                <QuestLine positions={previousPositions} key={quest.name} />\r\n            );\r\n        });\r\n    };\r\n\r\n    const renderMarkers = () => {\r\n        return activeQuests.map((quest) => {\r\n            const location = getQuestWorldLocation(quest);\r\n            const currentPosition = nodeLocationToPoint(location);\r\n            const leader = getQuestLeader(adventurers, quest)!;\r\n            const questDefinition: QuestDefinition = getDefinition(quest.name);\r\n            const progress: number = Math.floor(quest.progress);\r\n            const questNode: QuestNode = questDefinition.nodes[progress];\r\n\r\n            return (\r\n                <QuestMarker\r\n                    quest={quest}\r\n                    leader={leader}\r\n                    position={currentPosition}\r\n                    key={quest.name}\r\n                    selected={quest === selectedQuest}\r\n                    encounterActive={questNode.type === QuestNodeType.encounter}\r\n                    onClick={(q) => handlePartyClick(q.name)}\r\n                />\r\n            );\r\n        });\r\n    };\r\n\r\n\r\n    // puts the given party in the center of the map\r\n    const focusOnQuestingParty = (quest: QuestStoreState) => {\r\n        const viewport = viewportRef.current;\r\n        if (viewport) {\r\n            const partyLocation = getQuestWorldLocation(quest);\r\n            const point = nodeLocationToPoint(partyLocation);\r\n            viewport.moveCenter(point.x, point.y);\r\n        }\r\n    }\r\n\r\n    const handleMapClick = () => {\r\n        /// todo: close map\r\n        // if(smallMap === true && selectedQuest) {\r\n        //     props.onPartyClick(selectedQuest.name);\r\n        // }\r\n    }\r\n\r\n    // console.log(canvasWidth);\r\n    return (\r\n        <Stage width={canvasWidth} height={canvasHeight} >\r\n            <Viewport screenWidth={canvasWidth} screenHeight={canvasHeight} worldWidth={WORLD_WIDTH} worldHeight={WORLD_HEIGHT} ref={viewportRef} >\r\n                <Sprite\r\n                    image={`${process.env.PUBLIC_URL}/img/world/francesca-baerald-fbaerald-angeloumap-lowres.jpg`}\r\n                    interactive={true}\r\n                    pointerdown={handleMapClick}\r\n                >\r\n                    {renderQuestlines()}\r\n                    {renderMarkers()}\r\n                </Sprite>\r\n                {/* <MapGrid width={WORLD_WIDTH} height={WORLD_HEIGHT} gridWidth={GRID_WIDTH} /> */}\r\n            </Viewport>\r\n        </Stage>\r\n    );\r\n};\r\n\r\n\r\n\r\nexport default WorldMap;\r\n\r\nconst getQuestWorldLocation = (quest: QuestStoreState): { x: number; y: number; } => {\r\n    const questDefinition = getDefinition(quest.name);\r\n    const roundedProgress = Math.floor(quest.progress);\r\n    const lastNode = questDefinition.nodes[roundedProgress];\r\n\r\n    const nextNode = questDefinition.nodes[roundedProgress + 1];\r\n    if (!nextNode) {\r\n        // We've reached the last node\r\n        return lastNode;\r\n    }\r\n    return lerpLocation(lastNode, nextNode, quest.progress - roundedProgress);\r\n};\r\n\r\n// Node locations work on a centered coordinate system\r\nconst nodeLocationToPoint = (location: { x: number; y: number; }) => {\r\n    const x = location.x * GRID_WIDTH + WORLD_WIDTH / 2;\r\n    const y = location.y * GRID_WIDTH + WORLD_HEIGHT / 2;\r\n    return new PIXI.Point(x, y);\r\n}\r\n\r\nconst getPreviousPositions = (quest: QuestStoreState) => {\r\n    const positions: PIXI.Point[] = [];\r\n    const questDefinition = getDefinition(quest.name);\r\n\r\n    for (let i = 0; i < quest.progress; i++) {\r\n        positions.push(nodeLocationToPoint(questDefinition.nodes[i]))\r\n    }\r\n    const lastPosition = nodeLocationToPoint(getQuestWorldLocation(quest));\r\n    positions.push(lastPosition);\r\n    return positions;\r\n}","\n// Things that can be dragged\nexport const DragType = {\n    ADVENTURER: \"adventurer\",   // Adventurer avatar\n    ITEM: \"item\",               // A game 'item' (equipment, etc)\n};\n\n// Source, where it comes from\nexport enum DragSourceType {\n    adventurerInventory,\n    warehouse,\n    tavern,\n    adventurerEquipment,\n    lootCache\n}\n","import React from \"react\";\r\nimport \"./css/tabstrip.css\";\r\nimport { Props as TabProps } from \"./Tab\";\r\nimport { SoundManager, Sound } from 'global/SoundManager';\r\n\r\nexport interface Props {\r\n    className?: string;\r\n    onClick?: React.MouseEventHandler<Element>;\r\n    onTabSelected?: (tabId: string) => void;\r\n    children?: any;\r\n    activeTab?: string;\r\n    disabled?: boolean;\r\n}\r\n\r\ntype AllProps = Props;\r\nconst Tabstrip = (props: AllProps) => {\r\n    let {activeTab = null} = props;\r\n    if (!activeTab && props.children && props.children.length) {\r\n        activeTab = props.children[0].props.id;\r\n    }\r\n    const className = `${props.className} ${(props.disabled ? \"disabled\" : \"\")}`;\r\n    const children = React.Children.map(props.children, (child: React.ReactElement<TabProps>) => {\r\n        const clone: React.ReactElement<TabProps> = React.cloneElement(child, {\r\n            active: child.props.id === activeTab,\r\n            onClick: () => { handleTabClick(child.props.id); }\r\n        });\r\n        return clone;\r\n    });\r\n\r\n    const handleTabClick = (tabId: string) => {\r\n        if (props.onTabSelected && props.disabled !== true) {\r\n            props.onTabSelected(tabId);\r\n        }\r\n    };\r\n\r\n    const handleClick = (e: React.MouseEvent<Element>) => {\r\n        SoundManager.playSound(Sound.buttonClick);\r\n        if (props.onClick) {\r\n            props.onClick(e);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <ul className={`tabstrip ${className}`} onClick={handleClick}>\r\n            {children}\r\n        </ul>\r\n    );\r\n};\r\n\r\nexport default Tabstrip;\r\n","import * as React from \"react\";\r\nimport \"./css/tabstrip.css\";\r\n\r\nexport interface Props {\r\n    id: string;\r\n    className?: string;\r\n    onClick?: React.MouseEventHandler<Element>;\r\n    active?: boolean;\r\n    children?: any;\r\n}\r\n\r\ntype AllProps = Props;\r\n\r\nconst Tab = (props: AllProps) => {\r\n    const handleClick = (e: React.MouseEvent<HTMLLIElement>) => {\r\n        if (props.onClick) {\r\n            props.onClick(e);\r\n        }\r\n    };\r\n    const className = ((props.active) ? \"active\" : \"\") + (props.className || \"\");\r\n    return (\r\n        <li className={`tabstrip-tab ${className}`} onClick={handleClick}>\r\n            {props.children}\r\n        </li>\r\n    );\r\n};\r\n\r\nexport default Tab;\r\n","import * as React from \"react\";\r\nimport { AdventurerStoreState } from \"stores/adventurer\";\r\nimport \"./css/adventureravatar.css\";\r\n\r\nexport interface Props {\r\n    adventurer: AdventurerStoreState;\r\n    className?: string;\r\n    displayName?: boolean;\r\n    onClick?: (adventurerId: string) => void;\r\n}\r\n\r\n/**\r\n * The AdventurerAvatar displays the avatar of an adventurer in the party screen\r\n */\r\nconst AdventurerAvatar = (props: Props) => {\r\n    const {\r\n        adventurer,\r\n    } = props;\r\n\r\n    const className = (props.className || \"\") + \" avatar\";\r\n\r\n    const handleClick = () => {\r\n        if (props.onClick) {\r\n            props.onClick(props.adventurer.id);\r\n        }\r\n    };\r\n    return (\r\n        <div className = { className }\r\n            style={{ backgroundImage: `url(${process.env.PUBLIC_URL}/${adventurer.avatarImg})` }}\r\n            onClick={ () => handleClick() }>\r\n            <div className=\"sizer\"/>\r\n            {\r\n                props.displayName && <div className=\"name\">\r\n                    { adventurer.name }\r\n                </div>\r\n            }\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default AdventurerAvatar;\r\n","import React from \"react\";\r\nimport Tabstrip from 'components/ui/tabs/Tabstrip';\r\nimport { AdventurerStoreState } from 'stores/adventurer';\r\nimport Tab from 'components/ui/tabs/Tab';\r\nimport AdventurerAvatar from 'components/ui/AdventurerAvatar';\r\n\r\ninterface Props {\r\n    adventurers: AdventurerStoreState[];\r\n    selectedAdventurerId?: string;\r\n    onAdventurerTabSelected: (adventurerId: string) => void;\r\n    disabled?: boolean;\r\n}\r\n\r\n// Shows adventurer portraits in a tabstrip\r\nconst AdventurerTabstrip = (props: Props) => {\r\n    const {adventurers, onAdventurerTabSelected} = props;\r\n\r\n    const handleAdventurerTabSelected = (adventurerId: string) => {\r\n        const adventurer = props.adventurers.find(a => a.id === adventurerId)!;\r\n        onAdventurerTabSelected(adventurer.id);\r\n    }\r\n\r\n    const renderAdventurerTab = (adventurer: AdventurerStoreState) => (\r\n        <Tab id={adventurer.id} key={adventurer.id}>\r\n            <AdventurerAvatar adventurer={adventurer} className=\"common-icon-small\"/>\r\n        </Tab>\r\n    );\r\n    return (\r\n        <Tabstrip \r\n            className=\"adventurers-tabstrip\"\r\n            onTabSelected={handleAdventurerTabSelected}\r\n            activeTab={props.selectedAdventurerId}\r\n            disabled={props.disabled}\r\n        >\r\n            {adventurers.map((a) => renderAdventurerTab(a))}\r\n        </Tabstrip>\r\n    )\r\n}\r\n\r\nexport default AdventurerTabstrip;","import { createSelector } from \"reselect\";\r\nimport { StoreState } from \"stores\";\r\nimport { AdventurerStoreState } from \"stores/adventurer\";\r\nimport { QuestStatus, QuestStoreState } from \"stores/quest\";\r\nimport { adventurersOnQuest } from 'storeHelpers';\r\n\r\n// maybe this is not used anymore?\r\n\r\n// Store accessors\r\nconst getAdventurers = (state: StoreState): AdventurerStoreState[] => state.adventurers;\r\nconst getQuests = (state: StoreState): QuestStoreState[] => state.quests;\r\n\r\nconst groupAdventurersByQuest = (adventurers: AdventurerStoreState[], quests: QuestStoreState[]): Record<string, AdventurerStoreState[]> => {\r\n    const foundInParty: AdventurerStoreState[] = []; // store the adventurers in parties in a temp array\r\n\r\n\r\n    const groupedAdventurers = Object.values(quests).reduce((acc, val: QuestStoreState) => {\r\n        const foundAdventurers = adventurersOnQuest(adventurers, val);\r\n        if (val.status === QuestStatus.active) {\r\n            // Only active quests\r\n            acc[val.name] = foundAdventurers;\r\n        }\r\n        foundInParty.push(...foundAdventurers);\r\n        return acc;\r\n    }, {});\r\n\r\n    // Add a special group called 'solo' for those adventurers not in a party\r\n    const soloKey = \"solo\";\r\n    groupedAdventurers[soloKey] = adventurers.filter((a) => foundInParty.indexOf(a) === -1);\r\n\r\n    return groupedAdventurers;\r\n};\r\n\r\nconst getAdventurersInTown = (adventurers: AdventurerStoreState[], quests: QuestStoreState[]): AdventurerStoreState[] => {\r\n    // Get an array of all adventurer ids on any active quest\r\n    const adventurersOnQuest = quests.reduce<string[]>((acc, val: QuestStoreState) => {\r\n        if (val.status === QuestStatus.active) {\r\n            acc.push(...val.party);\r\n        }\r\n        return acc;\r\n    }, []);\r\n\r\n    return adventurers.filter((a) => adventurersOnQuest.indexOf(a.id) === -1);\r\n};\r\n\r\n/** Returns an object keyed by active quests whose value is a list of AdventurerStoreState */\r\nexport const selectAdventurersGroupedByQuest = createSelector([\r\n    getAdventurers,\r\n    getQuests],\r\n    groupAdventurersByQuest,\r\n);\r\n\r\n/** Returns a selector keyed by active quests whose value is a list of AdventurerStoreState */\r\nexport const createSelectAdventurersOnQuest = (questName: string) => {\r\n    const getAdventurersOnQuest = (adventurers: AdventurerStoreState[], quests: QuestStoreState[]): AdventurerStoreState[] => {\r\n        const quest = quests.find(q => q.name === questName)!;\r\n        return adventurersOnQuest(adventurers, quest);\r\n    };\r\n\r\n    return createSelector([\r\n        getAdventurers,\r\n        getQuests],\r\n        getAdventurersOnQuest,\r\n    );\r\n}\r\n\r\n/** Returns an object keyed by active quests whose value is a list of AdventurerStoreState */\r\nexport const selectAdventurersInTown = createSelector([\r\n    getAdventurers,\r\n    getQuests],\r\n    getAdventurersInTown,\r\n);\r\n","// todo: hooks!\r\n// https://github.com/react-dnd/react-dnd/pull/1244\r\nimport { DragType } from \"constants/dragging\";\r\nimport { getDefinition } from \"definitions/items\";\r\nimport { ApparelDefinition, ApparelType } from \"definitions/items/apparel\";\r\nimport { Item, ItemType } from \"definitions/items/types\";\r\nimport * as React from \"react\";\r\nimport { ConnectDropTarget, DropTarget, DropTargetConnector, DropTargetMonitor, DropTargetSpec } from \"react-dnd\";\r\nimport \"./css/equipmentslot.css\";\r\nimport { InventoryItemDragInfo } from \"./DraggableItemIcon\";\r\n\r\nconst dropTarget: DropTargetSpec<Props> = {\r\n    drop(props: Props, monitor: DropTargetMonitor) {\r\n        props.onDrop(monitor.getItem());\r\n    },\r\n    canDrop(props: Props, monitor: DropTargetMonitor)  {\r\n        const item = monitor.getItem().item;\r\n\r\n        return itemAndEquipmentSlotMatch(item, props.type);\r\n    },\r\n};\r\n\r\nexport enum EquipmentSlotType {\r\n    feet,\r\n    hands,\r\n    chest,\r\n    legs,\r\n    head,\r\n    shoulders,\r\n    mainHand,\r\n    offHand,\r\n}\r\n\r\n// Returns true if item can be slotted in equipmentSlotType\r\nexport const itemAndEquipmentSlotMatch = (item: Item, equipmentSlotType: EquipmentSlotType) => {\r\n    switch (equipmentSlotType) {\r\n        case EquipmentSlotType.chest:\r\n            return checkEquipment(item, ApparelType.chest);\r\n         case EquipmentSlotType.feet:\r\n            return checkEquipment(item, ApparelType.feet);\r\n        case EquipmentSlotType.hands:\r\n            return checkEquipment(item, ApparelType.hands);\r\n        case EquipmentSlotType.head:\r\n            return checkEquipment(item, ApparelType.head);\r\n        case EquipmentSlotType.legs:\r\n            return checkEquipment(item, ApparelType.legs);\r\n        case EquipmentSlotType.mainHand:\r\n        case EquipmentSlotType.offHand:\r\n            const itemDefinition = getDefinition(item);\r\n            if (itemDefinition.itemType !== ItemType.weapon) {\r\n                return false;\r\n            }\r\n\r\n            // todo: prevent shields to be equipped in main hand\r\n            return true;\r\n        default:\r\n            return false;\r\n    }\r\n};\r\n\r\nexport interface Props {\r\n    type: EquipmentSlotType;\r\n    onDrop: (item: InventoryItemDragInfo) => void;\r\n}\r\n\r\nexport interface DropSourceProps {\r\n    canDrop: boolean;\r\n    isOver: boolean;\r\n    connectDropTarget: ConnectDropTarget;\r\n}\r\n\r\nconst collect = (connect: DropTargetConnector, monitor: DropTargetMonitor) => ({\r\n    canDrop: monitor.canDrop(),\r\n    connectDropTarget: connect.dropTarget(),\r\n    isOver: monitor.isOver(),\r\n});\r\n\r\n/**\r\n * The EquipmentSlot displays a slot in which an item can be placed.\r\n */\r\nconst EquipmentSlot = (props: React.PropsWithChildren<Props & DropSourceProps>) => {\r\n    const {\r\n        isOver,\r\n        canDrop,\r\n        connectDropTarget,\r\n    } = props;\r\n    const isActive = isOver && canDrop;\r\n    let borderColor = \"grey\";\r\n    if (isActive) {\r\n        borderColor = \"green\";\r\n    } else if (canDrop) {\r\n        borderColor = \"orange\";\r\n    }\r\n\r\n    return connectDropTarget(\r\n        <div className = \"equipment-slot\" style = { { borderColor }} title={EquipmentSlotType[props.type]}>\r\n            { props.children }\r\n        </div>,\r\n    );\r\n};\r\n\r\nexport default DropTarget<Props, DropSourceProps>(\r\n    DragType.ITEM,\r\n    dropTarget,\r\n    collect,\r\n)(EquipmentSlot);\r\n\r\nconst checkEquipment = (item: Item, equipmentType: ApparelType) => {\r\n    const itemDefinition = getDefinition(item);\r\n    if (itemDefinition.itemType !== ItemType.apparel) {\r\n        return false;\r\n    }\r\n    return (itemDefinition as ApparelDefinition).equipmentType === equipmentType;\r\n};\r\n","export enum IconSize {\r\n    smallest,\r\n    small,\r\n    medium,\r\n    big,\r\n    biggest,\r\n}\r\n\r\nexport const getClassName = (size?: IconSize): string => {\r\n    switch (size) {\r\n        case IconSize.smallest:\r\n            return \"common-icon-smallest\";\r\n        case IconSize.small:\r\n            return \"common-icon-small\";\r\n        case IconSize.medium:\r\n            return \"common-icon-medium\";\r\n        case IconSize.big:\r\n            return \"common-icon-big\";\r\n        case IconSize.biggest:\r\n            return \"common-icon-biggest\";\r\n    }\r\n    return getClassName(IconSize.medium);\r\n};\r\n","import \"components/ui/css/common/icon.css\";\r\nimport { ContextType } from \"constants/context\";\r\nimport { getClassName, IconSize } from \"constants/icons\";\r\nimport { getDefinition } from \"definitions/items\";\r\nimport { Item } from \"definitions/items/types\";\r\nimport * as React from \"react\";\r\nimport \"./css/itemicon.css\";\r\nimport { TooltipManager } from 'global/TooltipManager';\r\n\r\nexport interface Props {\r\n    item: Item;\r\n    onClick?: (event: React.MouseEvent) => void;\r\n    size?: IconSize;\r\n    showContext?: boolean;\r\n}\r\n\r\nconst ItemIcon = (props: Props) => {\r\n    const {item} = props;\r\n    const itemDefinition = getDefinition(item);\r\n\r\n    if (!itemDefinition) {\r\n        // tslint:disable-next-line: no-console\r\n        console.warn(`could not find definition for ${item}`);\r\n    }     // todo: [10/07/2019] assert\r\n\r\n    const handleClick = (event: React.MouseEvent) => {\r\n        if (props.showContext !== false) {\r\n            const origin = (event.currentTarget as HTMLElement);\r\n            const originRect = origin.getBoundingClientRect();\r\n            TooltipManager.showContextTooltip(ContextType.item, getDefinition(item), originRect);\r\n            event.stopPropagation();\r\n        }\r\n\r\n        if (props.onClick) {\r\n            props.onClick(event);\r\n        }\r\n    };\r\n\r\n    const className = `item-icon ${getClassName(props.size)}`;\r\n\r\n    return (\r\n        <div\r\n            className={className}\r\n            onClick={handleClick}\r\n            style={{backgroundImage: `url(${process.env.PUBLIC_URL}${itemDefinition.iconImg})`}}\r\n        />\r\n    );\r\n};\r\n\r\nexport default ItemIcon;\r\n","import { DragSourceType, DragType } from \"constants/dragging\";\r\nimport { IconSize } from \"constants/icons\";\r\nimport { Item } from \"definitions/items/types\";\r\nimport * as React from \"react\";\r\nimport { ConnectDragSource, DragSource, DragSourceConnector, DragSourceMonitor, DragSourceSpec } from \"react-dnd\";\r\nimport ItemIcon from \"./ItemIcon\";\r\n\r\nexport interface Props {\r\n    index: number;\r\n    item: Item;\r\n    sourceType: DragSourceType;\r\n    sourceId?: string;\r\n    size?: IconSize;\r\n    onClick?: (event: React.MouseEvent) => void;\r\n}\r\n\r\ninterface CollectedProps {\r\n    isDragging: boolean;\r\n    connectDragSource: ConnectDragSource;\r\n}\r\n\r\nexport interface InventoryItemDragInfo {\r\n    item: Item;\r\n    inventorySlot?: number;\r\n    sourceId?: string;\r\n    sourceType: DragSourceType;\r\n}\r\n\r\n/**\r\n * Specifies the drag source contract.\r\n * Only `beginDrag` function is required.\r\n */\r\nconst source: DragSourceSpec<Props, InventoryItemDragInfo> = {\r\n    beginDrag(props: Props) {\r\n        // Return the data describing the dragged item\r\n        return {\r\n            inventorySlot: props.index,\r\n            item: props.item,\r\n            sourceId: props.sourceId,\r\n            sourceType: props.sourceType,\r\n        };\r\n    },\r\n};\r\n\r\n/**\r\n * Specifies which props to inject into your component.\r\n */\r\nfunction collect(connect: DragSourceConnector, monitor: DragSourceMonitor) {\r\n    return {\r\n        connectDragSource: connect.dragSource(),\r\n        isDragging: monitor.isDragging(),\r\n    };\r\n}\r\n\r\nconst DraggableItemIcon = (props: Props & CollectedProps) => {\r\n\r\n    const { item, onClick, isDragging, connectDragSource, size } = props;\r\n    const handleClick = (event: React.MouseEvent) => {\r\n        if (onClick) {\r\n            onClick(event);\r\n        }\r\n    };\r\n    if (isDragging) {\r\n        // TODO: can show some sort of empty state?\r\n        return null;\r\n    }\r\n    return connectDragSource((\r\n        <div>\r\n            <ItemIcon\r\n                item={item}\r\n                onClick={handleClick}\r\n                size={size}\r\n            />\r\n        </div>\r\n    ));\r\n}\r\n\r\nexport default DragSource<Props, CollectedProps>(DragType.ITEM, source, collect)(DraggableItemIcon);\r\n","import { EquipmentSlotType } from \"components/ui/EquipmentSlot\";\r\nimport { Item } from \"definitions/items/types\";\r\nimport { Action } from \"redux\";\r\n\r\n// tslint:disable:object-literal-sort-keys\r\nexport enum ActionType {\r\n    moveItemInInventory = \"moveItemInInventory\",\r\n    moveItemToOtherAdventurer = \"moveItemToOtherAdventurer\",\r\n    moveItemFromWarehouseToAdventurer = \"moveItemFromWarehouseToAdventurer\",\r\n    addItemToInventory = \"addItemToInventory\",\r\n    removeItemFromInventory = \"removeItemFromInventory\",\r\n    assignEquipment = \"assignEquipment\",\r\n    removeEquipment = \"removeEquipment\",\r\n}\r\n\r\nexport interface AdventurerAction extends Action<ActionType> {\r\n    adventurerId: string;\r\n}\r\n\r\nexport interface InventoryAction extends AdventurerAction {\r\n    item: Item;\r\n    toSlot?: number;\r\n}\r\n\r\nexport interface MoveItemInInventoryAction extends AdventurerAction {\r\n    fromSlot: number;\r\n    toSlot: number;\r\n}\r\n\r\nexport interface RemoveItemFromInventoryAction extends AdventurerAction {\r\n    fromSlot: number;\r\n}\r\n\r\nexport interface MoveItemToOtherAdventurerAction extends AdventurerAction {\r\n    fromSlot: number;\r\n    toSlot?: number;\r\n    toAdventurerId: string;\r\n}\r\n\r\nexport interface AssignEquipmentAction extends AdventurerAction {\r\n    item: Item;\r\n    equipmentSlot: EquipmentSlotType;\r\n}\r\nexport interface RemoveEquipmentAction extends AdventurerAction {\r\n    equipmentSlot: EquipmentSlotType;\r\n}\r\n\r\nexport function moveItemInInventory(adventurerId: string, fromSlot: number, toSlot: number):\r\n    MoveItemInInventoryAction {\r\n    return {\r\n        type: ActionType.moveItemInInventory,\r\n        adventurerId,\r\n        fromSlot,\r\n        toSlot,\r\n    };\r\n}\r\n\r\n/**\r\n * Moves the an item from one adventurers' inventory to another\r\n * @param fromAdventurerId adventurer whose inventory to take the item from\r\n * @param fromSlot index of the inventory item\r\n * @param toAdventurerId player who to give the item to\r\n */\r\nexport function moveItemToOtherAdventurer(fromAdventurerId: string,\r\n                                          fromSlot: number,\r\n                                          toAdventurerId: string, toSlot?: number): MoveItemToOtherAdventurerAction {\r\n    return {\r\n        type: ActionType.moveItemToOtherAdventurer,\r\n        adventurerId: fromAdventurerId,\r\n        fromSlot,\r\n        toAdventurerId,\r\n        toSlot,\r\n    };\r\n}\r\n\r\n// If slot is not provided, will take the first empty slot\r\nexport function addItemToInventory(adventurerId: string, item: Item, toSlot?: number): InventoryAction {\r\n    return {\r\n        type: ActionType.addItemToInventory,\r\n        adventurerId,\r\n        item,\r\n        toSlot,\r\n    };\r\n}\r\n\r\nexport function removeItemFromInventory(adventurerId: string, fromSlot: number): RemoveItemFromInventoryAction {\r\n    return {\r\n        type: ActionType.removeItemFromInventory,\r\n        adventurerId,\r\n        fromSlot,\r\n    };\r\n}\r\n\r\nexport function assignEquipment(adventurerId: string, equipmentSlot: EquipmentSlotType, item: Item): AssignEquipmentAction {\r\n    return {\r\n        type: ActionType.assignEquipment,\r\n        adventurerId,\r\n        item,\r\n        equipmentSlot,\r\n    };\r\n}\r\n\r\nexport function removeEquipment(adventurerId: string, equipmentSlot: EquipmentSlotType): RemoveEquipmentAction {\r\n    return {\r\n        type: ActionType.removeEquipment,\r\n        adventurerId,\r\n        equipmentSlot,\r\n    };\r\n}\r\n","import React from \"react\";\r\nimport { AdventurerStoreState } from 'stores/adventurer';\r\nimport EquipmentSlot, { EquipmentSlotType } from 'components/ui/EquipmentSlot';\r\nimport { Item } from 'definitions/items/types';\r\nimport DraggableItemIcon, { InventoryItemDragInfo } from 'components/ui/DraggableItemIcon';\r\nimport { DragSourceType } from 'constants/dragging';\r\nimport { IconSize } from 'constants/icons';\r\nimport { TextManager } from 'global/TextManager';\r\n\r\nexport interface Props {\r\n    adventurer: AdventurerStoreState\r\n    onDropItemEquipment: (dragInfo: InventoryItemDragInfo, slotType: EquipmentSlotType) => void;\r\n}\r\n\r\nconst AdventurerEquipment = (props: Props) => {\r\n    const { adventurer, onDropItemEquipment } = props;\r\n\r\n    const getEquipmentSlot = (slotType: EquipmentSlotType) => {\r\n        // returns EquipmentSlot\r\n        const item: Item | undefined = adventurer.equipment[EquipmentSlotType[slotType]];\r\n        let contents = null;\r\n        if (item) {\r\n            const itemRef: React.RefObject<any> = React.createRef();\r\n\r\n            contents = (\r\n                <DraggableItemIcon\r\n                    index={slotType}\r\n                    sourceId={adventurer.id}\r\n                    sourceType={DragSourceType.adventurerEquipment}\r\n                    item={item}\r\n                    ref={itemRef}\r\n                    size={IconSize.medium}\r\n                />\r\n            );\r\n        }\r\n\r\n        return (\r\n            <>\r\n                <EquipmentSlot\r\n                    onDrop={(dragInfo: InventoryItemDragInfo) => onDropItemEquipment(dragInfo, slotType)}\r\n                    type={slotType}\r\n                >\r\n                    {contents}\r\n                </EquipmentSlot>\r\n                <span className=\"info\">{TextManager.get(`ui-equipmentslot-${EquipmentSlotType[slotType]}`)}</span>\r\n            </>\r\n        );\r\n    };\r\n    return (\r\n        <ul>\r\n            <li>{getEquipmentSlot(EquipmentSlotType.head)}</li>\r\n            <li>{getEquipmentSlot(EquipmentSlotType.shoulders)}</li>\r\n            <li>{getEquipmentSlot(EquipmentSlotType.chest)}</li>\r\n            <li>{getEquipmentSlot(EquipmentSlotType.hands)}</li>\r\n            <li>{getEquipmentSlot(EquipmentSlotType.legs)}</li>\r\n            <li>{getEquipmentSlot(EquipmentSlotType.feet)}</li>\r\n            <li>{getEquipmentSlot(EquipmentSlotType.mainHand)}</li>\r\n            <li>{getEquipmentSlot(EquipmentSlotType.offHand)}</li>\r\n        </ul>\r\n    )\r\n}\r\n\r\nexport default AdventurerEquipment;","import { DragSourceType, DragType } from \"constants/dragging\";\r\nimport { getClassName, IconSize } from \"constants/icons\";\r\nimport { Item } from \"definitions/items/types\";\r\nimport * as React from \"react\";\r\nimport { ConnectDropTarget, DropTarget, DropTargetConnector, DropTargetMonitor, DropTargetSpec } from \"react-dnd\";\r\nimport { InventoryItemDragInfo } from \"../DraggableItemIcon\";\r\nimport { itemAndEquipmentSlotMatch } from \"../EquipmentSlot\";\r\n\r\nconst dropTarget: DropTargetSpec<Props> = {\r\n    drop(props: Props, monitor: DropTargetMonitor) {\r\n        props.onDrop(monitor.getItem());\r\n    },\r\n    canDrop(props: Props, monitor: DropTargetMonitor) {\r\n        const dragInfo: InventoryItemDragInfo = monitor.getItem();\r\n        if (dragInfo.sourceType === DragSourceType.adventurerEquipment) {\r\n            return props.item == null || itemAndEquipmentSlotMatch(props.item, dragInfo.inventorySlot!);\r\n        }\r\n        return true;\r\n    },\r\n};\r\n\r\nexport interface Props {\r\n    item: Item | null;\r\n    onDrop: (item: any) => void;\r\n    size?: IconSize;\r\n    children: React.ReactNode;\r\n}\r\n\r\nexport interface DropSourceProps {\r\n    canDrop: boolean;\r\n    isOver: boolean;\r\n    connectDropTarget: ConnectDropTarget;\r\n}\r\n\r\nconst collect = (connect: DropTargetConnector, monitor: DropTargetMonitor) => ({\r\n    canDrop: monitor.canDrop(),\r\n    connectDropTarget: connect.dropTarget(),\r\n    isOver: monitor.isOver(),\r\n});\r\n\r\n/**\r\n * The InventorySlot displays a slot in which an item can be placed.\r\n */\r\nconst InventorySlot = (props: Props & DropSourceProps) => {\r\n    const {\r\n        isOver,\r\n        canDrop,\r\n        connectDropTarget,\r\n    } = props;\r\n    const isActive = isOver && canDrop;\r\n\r\n    const classNames = [\r\n        \"inventory-item\",\r\n        getClassName(props.size),\r\n    ];\r\n\r\n    if (isActive) {\r\n        classNames.push(\"drop-active\");\r\n    } else if (canDrop) {\r\n        classNames.push(\"drop-possible\");\r\n    }\r\n\r\n    return connectDropTarget(\r\n        <div className = { classNames.join(\" \") }>\r\n            { props.children }\r\n        </div>,\r\n    );\r\n}\r\n\r\nexport default DropTarget<Props, DropSourceProps>(\r\n    DragType.ITEM,\r\n    dropTarget,\r\n    collect,\r\n)(InventorySlot);\r\n","import DraggableItemIcon, {InventoryItemDragInfo} from \"components/ui/DraggableItemIcon\";\r\nimport { DragSourceType } from \"constants/dragging\";\r\nimport { IconSize } from \"constants/icons\";\r\nimport {Item} from \"definitions/items/types\";\r\nimport * as React from \"react\";\r\nimport \"./css/inventory.css\";\r\nimport InventorySlot from \"./InventorySlot\";\r\n\r\nexport interface Props {\r\n    items: (Item|null)[];\r\n    sourceId?: string;   // who does this inventory belong to?\r\n    sourceType: DragSourceType;\r\n    iconSize?: IconSize;\r\n    onDropItem: (item: Item, fromSlot: number, toSlot: number, sourceType: DragSourceType, sourceId?: string) => void;\r\n    className?: string;\r\n}\r\n\r\n/**\r\n * Inventory is used to show Items. They can be dragged about\r\n * @param props\r\n */\r\nconst Inventory = (props: Props) => {\r\n    const slots = [];\r\n    for (let i = 0; i < props.items.length; i++) {\r\n        let contents;\r\n        const item = props.items[i];\r\n        const handleDrop = (dragInfo: InventoryItemDragInfo) => {\r\n            if (dragInfo.inventorySlot === i && dragInfo.sourceType === props.sourceType && dragInfo.sourceId === props.sourceId) {\r\n                // TODO: Swap items?!\r\n                return;\r\n            }\r\n            if (props.onDropItem) {\r\n                const {inventorySlot: fromSlot} = dragInfo;\r\n                props.onDropItem(dragInfo.item, fromSlot!, i, dragInfo.sourceType, dragInfo.sourceId);\r\n           }\r\n        };\r\n\r\n        if (item) {\r\n            contents = (\r\n                <DraggableItemIcon\r\n                    index={i}\r\n                    sourceId={props.sourceId}\r\n                    sourceType={props.sourceType}\r\n                    item={item}\r\n                />\r\n            );\r\n       }\r\n\r\n        const slot = (\r\n            <InventorySlot\r\n                key={`inventory-slot-${i}`}\r\n                item={item}\r\n                size={props.iconSize}\r\n                onDrop={handleDrop}\r\n            >\r\n                {contents}\r\n            </InventorySlot>\r\n        );\r\n        slots.push(slot);\r\n   }\r\n    return (\r\n        <div className={`inventory ${props.className}`}>\r\n            {slots}\r\n        </div>\r\n    );\r\n};\r\nexport default Inventory;\r\n","import { StoreState } from 'stores';\r\nimport { useSelector } from 'react-redux';\r\nimport { Item } from 'definitions/items/types';\r\n\r\n// Returns the gold from redux store\r\nconst useStockpileState = () => {\r\n    return useSelector<StoreState, (Item|null)[]>(store => store.stockpile);\r\n}\r\n\r\nexport default useStockpileState;","import { useDispatch } from 'react-redux';\r\nimport { Action } from \"redux\";\r\nimport { removeItemFromInventory, assignEquipment, addItemToInventory, removeEquipment, moveItemInInventory } from 'actions/adventurers';\r\nimport { removeItemFromWarehouse, addItemToWarehouse, moveItemInWarehouse } from 'actions/items';\r\nimport { EquipmentSlotType } from 'components/ui/EquipmentSlot';\r\nimport { Item } from 'definitions/items/types';\r\nimport { InventoryItemDragInfo } from 'components/ui/DraggableItemIcon';\r\nimport { DragSourceType } from 'constants/dragging';\r\nimport { AdventurerStoreState } from 'stores/adventurer';\r\nimport useStockpileState from 'hooks/store/useStockpileState';\r\n\r\nconst useItemDropActions = () => {\r\n    const dispatch = useDispatch();\r\n    const stockpile = useStockpileState();\r\n\r\n    // When an item gets dropped on equipment slot\r\n    const dropItemEquipment = (dragInfo: InventoryItemDragInfo, slotType: EquipmentSlotType, adventurer: AdventurerStoreState) => {\r\n        const item = dragInfo.item;\r\n        const actions: Action[] = [];\r\n\r\n        switch (dragInfo.sourceType) {\r\n            // Dragged from inventory\r\n            case DragSourceType.adventurerInventory: {\r\n                actions.push(\r\n                    // Item gets removed from inventory\r\n                    removeItemFromInventory(adventurer.id, dragInfo.inventorySlot!),\r\n                    // Item gets assigned to an equipment slot\r\n                    assignEquipment(adventurer.id, slotType, item),\r\n                );\r\n\r\n                const existingEquipment = adventurer.equipment[EquipmentSlotType[slotType]];\r\n                if (existingEquipment) {\r\n                    // There is already an item in this slot. Place in inventory\r\n                    actions.push(addItemToInventory(adventurer.id, existingEquipment, dragInfo.inventorySlot!));\r\n                }\r\n                break;\r\n            }\r\n            // Dragged from warehouse.\r\n            case DragSourceType.warehouse: {\r\n                actions.push(\r\n                    removeItemFromWarehouse(dragInfo.inventorySlot!),\r\n                    assignEquipment(adventurer.id, slotType, item),\r\n                );\r\n\r\n                const existingEquipment = adventurer.equipment[EquipmentSlotType[slotType]];\r\n                if (existingEquipment) {\r\n                    // There is already an item in this slot. Place in warehouse\r\n                    actions.push(addItemToWarehouse(existingEquipment, dragInfo.inventorySlot!));\r\n                }\r\n                break;\r\n            }\r\n\r\n            // Dragged from equipment slot (only applicable to weapons)\r\n            case DragSourceType.adventurerEquipment: {\r\n                actions.push(\r\n                    assignEquipment(adventurer.id, slotType, item)\r\n                );\r\n\r\n                const existingEquipment = adventurer.equipment[EquipmentSlotType[slotType]];\r\n                const fromSlot = dragInfo.inventorySlot!;\r\n                if (existingEquipment) {\r\n                    // Another weapon was there, switch them\r\n                    actions.push(assignEquipment(adventurer.id, fromSlot, existingEquipment),)\r\n                } else {\r\n                    // Clear the slot where it came from\r\n                    actions.push(removeEquipment(adventurer.id, fromSlot));\r\n                }\r\n                break;\r\n            }\r\n        }\r\n        actions.forEach(a => dispatch(a));\r\n    };\r\n\r\n    // When an item gets dropped on an adventurer inventory\r\n    const dropItemInventory = (item: Item, fromSlot: number, toSlot: number, sourceType: DragSourceType, adventurer: AdventurerStoreState, sourceId?: string): void => {\r\n        const actions: Action[] = [];\r\n        switch (sourceType) {\r\n            // Drag from one inventory slot to another\r\n            case DragSourceType.adventurerInventory:\r\n                actions.push(moveItemInInventory(adventurer.id, fromSlot, toSlot))\r\n                break;\r\n\r\n            // Dragged from warehouse\r\n            case DragSourceType.warehouse: {\r\n                actions.push(\r\n                    removeItemFromWarehouse(fromSlot),\r\n                    addItemToInventory(adventurer.id, item, toSlot),\r\n                )\r\n                const otherItem = adventurer.inventory[toSlot];\r\n                if (otherItem) {\r\n                    actions.push(\r\n                        addItemToWarehouse(otherItem, fromSlot)\r\n                    )\r\n                }\r\n                break;\r\n            }\r\n\r\n            // Drag from equipment slot\r\n            case DragSourceType.adventurerEquipment: {\r\n                actions.push(\r\n                    addItemToInventory(adventurer.id, item, toSlot)\r\n                );\r\n\r\n                const existingEquipment = adventurer.inventory[toSlot];\r\n                if (existingEquipment) {\r\n                    // Was dropped on another piece of equipment in inventory, switch them\r\n                    actions.push(assignEquipment(adventurer.id, fromSlot, existingEquipment));\r\n                } else {\r\n                    // Clear the slot where it came from\r\n                    actions.push(removeEquipment(adventurer.id, fromSlot));\r\n                }\r\n                break;\r\n            }\r\n        }\r\n        actions.forEach(a => dispatch(a));\r\n    };\r\n\r\n    // When an item gets dropped on the warehouse inventory\r\n    const dropItemWarehouse = (item: Item, fromSlot: number, toSlot: number, sourceType: DragSourceType, sourceId?: string): void => {\r\n        const actions: Action[] = [];\r\n\r\n        switch (sourceType) {\r\n            // Dragged from the warehouse itself\r\n            case DragSourceType.warehouse: {\r\n                actions.push(\r\n                    moveItemInWarehouse(fromSlot, toSlot)\r\n                )\r\n                const otherItem = stockpile[toSlot];\r\n                if (otherItem) {\r\n                    actions.push(\r\n                        addItemToInventory(sourceId!, otherItem, fromSlot)\r\n                    )\r\n                }\r\n                break;\r\n            }\r\n            // Dragged from an adventurer inventory\r\n            case DragSourceType.adventurerInventory: {\r\n                actions.push(\r\n                    removeItemFromInventory(sourceId!, fromSlot),\r\n                    addItemToWarehouse(item, toSlot)\r\n                )\r\n                const otherItem = stockpile[toSlot];\r\n                if (otherItem) {\r\n                    actions.push(\r\n                        addItemToInventory(sourceId!, otherItem, fromSlot)\r\n                    )\r\n                }\r\n                break;\r\n            }\r\n        }\r\n        actions.forEach(a => dispatch(a));\r\n    };\r\n    return {\r\n        dropItemEquipment,\r\n        dropItemInventory,\r\n        dropItemWarehouse\r\n    }\r\n}\r\n\r\nexport default useItemDropActions;","import React from \"react\";\r\nimport { AdventurerStoreState } from 'stores/adventurer';\r\nimport { DragSourceType } from 'constants/dragging';\r\nimport AdventurerEquipment from './AdventurerEquipment';\r\nimport Inventory from 'components/ui/inventory/Inventory';\r\nimport useItemDropActions from 'hooks/actions/useItemActions';\r\nimport { InventoryItemDragInfo } from 'components/ui/DraggableItemIcon';\r\nimport { EquipmentSlotType } from 'components/ui/EquipmentSlot';\r\nimport { Item } from 'definitions/items/types';\r\nimport \"./css/adventurerPanel.css\";\r\n\r\nexport interface Props {\r\n    adventurer: AdventurerStoreState;\r\n}\r\n\r\n/** Vertical panel showing adventurer info\r\n * todo: move outside of /world\r\n */\r\nconst AdventurerPanel = (props: Props) => {\r\n    const { adventurer } = props;\r\n\r\n    // const renderAttributes = () => Object.keys(adventurer.stats).map((stat) => {\r\n    //     const value: number = adventurer.stats[stat];\r\n    //     return <div key={`${adventurer.id}-${stat}`} > <b>{stat}</b>: {value.toFixed(1)} </div>;\r\n    // });\r\n\r\n    const {\r\n        dropItemEquipment,\r\n        dropItemInventory\r\n    } = useItemDropActions();\r\n\r\n    const handleDropItemEquipment = (dragInfo: InventoryItemDragInfo, slotType: EquipmentSlotType) => {\r\n        dropItemEquipment(dragInfo, slotType, adventurer);\r\n    };\r\n    const handleDropItemInventory = (item: Item, fromSlot: number, toSlot: number, sourceType: DragSourceType, sourceId?: string) => {\r\n        dropItemInventory(item, fromSlot, toSlot, sourceType, adventurer, sourceId);\r\n    }\r\n\r\n    return (\r\n        <div className=\"adventurer-panel\">\r\n            <div className=\"info\">\r\n                <div className=\"name\">\r\n                    <b>{adventurer.name}</b>\r\n                </div>\r\n                {/* <div className=\"renderAttributes\">\r\n                    {renderAttributes()}\r\n                </div> */}\r\n            </div>\r\n            <div className=\"equipment\">\r\n                <AdventurerEquipment\r\n                    adventurer={adventurer}\r\n                    onDropItemEquipment={handleDropItemEquipment}\r\n                />\r\n            </div>\r\n            <div className=\"right\">\r\n                <Inventory\r\n                    sourceType={DragSourceType.adventurerInventory}\r\n                    sourceId={adventurer.id}\r\n                    items={adventurer.inventory}\r\n                    className=\"inventory-small\"\r\n                    onDropItem={handleDropItemInventory}\r\n                />\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default AdventurerPanel;","import { useCallback } from 'react';\r\nimport { StoreState } from 'stores';\r\nimport { useSelector } from 'react-redux';\r\nimport { QuestStoreState } from 'stores/quest';\r\n\r\n// Returns the quest from redux store\r\nconst useQuest = (questName: string) => {\r\n    const questSelector = useCallback(\r\n        (state: StoreState) => state.quests.find((q) => q.name === questName)!,\r\n        [questName]\r\n    );\r\n    const quest = useSelector<StoreState, QuestStoreState>(questSelector);\r\n    return quest;\r\n}\r\n\r\nexport default useQuest;","import { PixiComponent } from \"@inlet/react-pixi\";\r\nimport * as PIXI  from 'pixi.js';\r\nimport { TiledLayerData, TiledTilesetData } from 'constants/tiledMapData';\r\n\r\nwindow.PIXI = PIXI;\r\n// eslint-disable-next-line import/first\r\nimport 'pixi-tilemap';\r\n\r\ninterface Props  {\r\n    texture: PIXI.Texture;\r\n    horizontalTiles: number;\r\n    layer: TiledLayerData;\r\n    tileset: TiledTilesetData;\r\n    spritesheet: PIXI.Spritesheet;\r\n};\r\n\r\nconst RectTileLayer = PixiComponent<Props, any>(\"RectTileLayer\", {\r\n    create(props: Props) {\r\n        const tileLayer = new window.PIXI.tilemap.CompositeRectTileLayer(0, [props.texture]);\r\n        return tileLayer;\r\n    },\r\n\r\n    applyProps(instance, oldProps: Props, props: Props) {\r\n        const {layer, tileset, horizontalTiles, spritesheet} = props;\r\n        if (!layer.data) {\r\n            return;\r\n        }\r\n        for (let i = 0; i < layer.data.length; i++) {\r\n            const w = tileset.tilewidth;\r\n            const h = tileset.tileheight;\r\n            const x = (i % horizontalTiles) * w;\r\n            const y = Math.floor(i / horizontalTiles) * h;\r\n\r\n            if (layer.data[i] > 0) {\r\n                const spriteId = `${tileset.name}-${layer.data[i]}`;\r\n                instance.addFrame(spritesheet.textures[spriteId], x, y);\r\n            }\r\n        }\r\n    }\r\n});\r\n\r\nexport default RectTileLayer;\r\n\r\n","import { PixiComponent } from \"@inlet/react-pixi\";\r\nimport * as PIXI  from 'pixi.js';\r\nimport { TiledTilesetData } from 'constants/tiledMapData';\r\nimport { TileObject } from 'stores/scene';\r\n\r\nwindow.PIXI = PIXI;\r\n// eslint-disable-next-line import/first\r\nimport 'pixi-tilemap';\r\n\r\n\r\ninterface Props  {\r\n    texture: PIXI.Texture;\r\n    objects: TileObject[];\r\n    tileset: TiledTilesetData;\r\n    spritesheet: PIXI.Spritesheet;\r\n};\r\n\r\nconst ObjectTileLayer = PixiComponent<Props, any>(\"ObjectTileLayer\", {\r\n    create(props: Props) {\r\n        const tileLayer = new window.PIXI.tilemap.CompositeRectTileLayer(0, [props.texture]);\r\n        return tileLayer;\r\n    },\r\n\r\n    applyProps(instance, oldProps: Props, props: Props) {\r\n        const {objects, tileset, spritesheet} = props;\r\n        instance.clear();\r\n        if (!objects) return;\r\n\r\n        objects.forEach((object) => {\r\n            const w = tileset.tilewidth;\r\n            const h = tileset.tileheight;\r\n            const x = object.location[0] * w;\r\n            const y = object.location[1] * h;\r\n\r\n            if (object.gid !== undefined) {\r\n                const spriteId = `${tileset.name}-${(object).gid}`;\r\n                instance.addFrame(spritesheet.textures[spriteId], x, y);\r\n            }\r\n        });\r\n    }\r\n});\r\n\r\nexport default ObjectTileLayer;\r\n\r\n","import { Item } from 'definitions/items/types';\r\n\r\n\r\nexport interface SceneStoreState {\r\n    tileObjects: TileObject[];\r\n    actors: ActorObject[];\r\n    caches: { [key: string]: LootCache }\r\n    actionQueue?: SceneAction[];\r\n}\r\n\r\n// https://www.typescriptlang.org/docs/handbook/advanced-types.html#discriminated-unions\r\nexport interface TileObject {\r\n    id: number;\r\n    name?: string;\r\n    type: string;\r\n    gid: number;\r\n    location: [number, number];\r\n};\r\n\r\nexport type ActorObject = {\r\n    name: string;                   // todo: refactor to id\r\n    location: [number, number];\r\n    health: number;\r\n};\r\n\r\n // export type Actor = SceneObject & {\r\n//     type: \"actor\";\r\n//     //allegiance: Allegiance;\r\n//     health: number;\r\n//     //remainingAP: number;\r\n// }\r\n\r\n\r\nexport interface LootCache {\r\n    title: string;\r\n    items: Item[];\r\n    gold?: number;\r\n}\r\n\r\nexport interface SceneAction {\r\n    actionType: SceneActionType;\r\n    actor: string;\r\n    target: [number, number];\r\n    endsAt: number;\r\n}\r\n\r\nexport enum SceneActionType {\r\n    move = \"move\"\r\n    // todo: interact?\r\n}\r\n","import React, { useState } from 'react';\r\nimport { TiledMapData, TiledLayerData, TiledTilesetData, TiledLayerType } from 'constants/tiledMapData';\r\nimport { Container, Text } from '@inlet/react-pixi';\r\nimport { useEffect } from 'react';\r\nimport { SpritesheetData, SpriteData } from 'constants/spritesheetData';\r\nimport RectTileLayer from 'components/pixi/tile/RectTileLayer';\r\nimport * as PIXI from 'pixi.js';\r\nimport { loadResource } from 'utils/pixiJs';\r\nimport { TileObject } from 'stores/scene';\r\nimport ObjectTileLayer from 'components/pixi/tile/ObjectTileLayer';\r\n\r\ninterface Props {\r\n    basePath: string;\r\n    data: TiledMapData;\r\n    tileObjects: TileObject[]; // Objects that don't move\r\n}\r\n\r\nconst DEBUG = false;\r\n\r\nconst Tilemap = (props: Props) => {\r\n    const {basePath, data, tileObjects} = props;\r\n    const [layers, setLayers] = useState<JSX.Element[]>();\r\n    const [debug, setDebug] = useState<JSX.Element[]>();\r\n\r\n    useEffect(() => {\r\n        const spritesheetData = parseSpritesheetData(data);\r\n        const tileset = getTileset(data);\r\n        loadResource(`${basePath}/${tileset.image}`, (resource) => {\r\n            const texture = resource.texture;\r\n            if (!texture) return;\r\n            PIXI.utils.clearTextureCache();\r\n            const spritesheet = new PIXI.Spritesheet(texture, spritesheetData);\r\n    \r\n            spritesheet.parse(() => {\r\n                const allLayers = data.layers.filter(l => l.visible && l.type === TiledLayerType.tilelayer).map(layer => {\r\n                     return createTileLayer(layer, texture, data.width, tileset, spritesheet);\r\n                });\r\n                allLayers.push(createObjectLayer(tileObjects, texture, tileset, spritesheet));\r\n                setLayers(allLayers);\r\n                \r\n                if (DEBUG){\r\n                    setDebug(getDebug(data.layers[0].data.length, data.layers[0].width, tileset.tilewidth, tileset.tileheight))\r\n                }\r\n            });\r\n    \r\n        })\r\n    }, [basePath, data, tileObjects]);\r\n    return (\r\n        <Container >\r\n            {layers}\r\n            {debug}\r\n        </Container>\r\n    );\r\n}\r\n\r\nexport default Tilemap;\r\n\r\nconst getDebug = (tileCount: number, columns: number, tileWidth: number, tileHeight: number) => {\r\n    const elements = [];\r\n    for (let i = 0 ; i < tileCount ; i++) {\r\n        const location = [(i % columns),  Math.floor(i / columns)];\r\n        const x = location[0] * tileWidth;\r\n        const y = location[1] * tileHeight;\r\n        var style = {\r\n            font : 'bold italic 36px Arial',\r\n            fill : '#F7EDCA',\r\n            stroke : '#4a1850',\r\n            strokeThickness : 5,\r\n            wordWrap : true,\r\n            wordWrapWidth : 440\r\n        };\r\n        // tile index\r\n        elements.push(<Text key={`${x},${y}`} style={style} text={`${i}`} x={x} y={y} />);\r\n        // // blocked\r\n        // elements.push(<Graphics\r\n        //     key={`blocked_${x},${y}`}\r\n        //     x={x} y={y}\r\n        //     draw={graphics => {\r\n        //         const line = 3;\r\n        //         const blocked = blockedTiles.some((loc) => loc[0] === location[0] && loc[1] === location[1]);\r\n        //         const color = blocked ? 0xFF3300 : 0x00FF00;\r\n        //         graphics.lineStyle(line, color);\r\n        //         graphics.drawRect(line / 2, line / 2, tileWidth - line / 2, tileHeight - line / 2);\r\n        //         graphics.endFill();\r\n        //     }}\r\n        // />)\r\n    }\r\n    return elements;\r\n}\r\n\r\nconst getTileset = (mapData: TiledMapData) => {\r\n    if (!mapData.tilesets.length) {\r\n        throw new Error(\"No tilesets found! Can't continue\");\r\n    }\r\n    if (mapData.tilesets.length > 1) {\r\n        console.warn(\"Found more than one tileset. But we currently only support one.\");\r\n    }\r\n    if (mapData.tilesets[0].source) {\r\n        throw new Error(\"Please embed tilemaps in Tiled! Can't continue\");\r\n    }\r\n    return mapData.tilesets[0];\r\n}\r\n\r\nconst createTileLayer = (layer: TiledLayerData, texture: PIXI.Texture, horizontalTiles: number, tileset: TiledTilesetData, spritesheet: PIXI.Spritesheet) => {\r\n    return (\r\n        <RectTileLayer\r\n            key={layer.name}\r\n            texture={texture} \r\n            layer={layer} \r\n            horizontalTiles={horizontalTiles}\r\n            tileset={tileset}\r\n            spritesheet={spritesheet}\r\n        />\r\n    );\r\n}\r\nconst createObjectLayer = (objects: TileObject[], texture: PIXI.Texture, tileset: TiledTilesetData, spritesheet: PIXI.Spritesheet) => {\r\n    return (\r\n        <ObjectTileLayer\r\n            key={\"objects\"}\r\n            objects={objects}\r\n            texture={texture} \r\n            tileset={tileset}\r\n            spritesheet={spritesheet}\r\n        />\r\n    );\r\n}\r\n\r\nconst parseSpritesheetData = (mapData: TiledMapData): SpritesheetData => {\r\n    const tileset = getTileset(mapData);\r\n    const columns = tileset.columns;\r\n\r\n    const frames: { [name: string]: SpriteData } = {};\r\n    for (let i = 0; i < tileset.tilecount; i++) {\r\n        const w = tileset.tilewidth;\r\n        const h = tileset.tileheight;\r\n        const x = (i % columns) * w;\r\n        const y = Math.floor(i / columns) * h;\r\n\r\n        frames[`${tileset.name}-${i + tileset.firstgid}`] = { \r\n            frame: {x, y, w, h},\r\n            spriteSourceSize: {x, y, w, h},\r\n            rotated: false,\r\n            trimmed: false,\r\n            sourceSize: { w, h}\r\n        };\r\n    }\r\n    const image = tileset.image;\r\n    const size = { w: tileset.imagewidth, h: tileset.imageheight };\r\n    return {\r\n        frames,\r\n        meta: {\r\n            image,\r\n            size,\r\n            scale: 1\r\n        }\r\n    };\r\n}\r\n","import React from \"react\";\r\nimport { ReactReduxContext, Provider } from 'react-redux';\r\nimport { Stage } from '@inlet/react-pixi';\r\n\r\n// Contexts are not passed through the reconcilers with the new Context API. \r\n// This means we lose the redux context\r\n// Create a wrapper component that consumes the context and provides it again in the new reconciler context:\r\n// https://github.com/inlet/react-pixi/issues/77\r\nconst BridgedStage = (props: React.ComponentProps<typeof Stage>) => {\r\n    const { children, ...restProps } = props;\r\n    return (\r\n        <ReactReduxContext.Consumer>\r\n            {({ store }) => (\r\n                <Stage {...restProps}>\r\n                    <Provider store={store}>\r\n                        {children}\r\n                    </Provider>\r\n                </Stage>\r\n            )}\r\n        </ReactReduxContext.Consumer>\r\n    );\r\n}\r\n\r\nexport default BridgedStage;\r\n","import { Container } from '@inlet/react-pixi';\r\nimport React, { useMemo,  useEffect, useRef, useCallback } from 'react';\r\nimport { SceneActionType, SceneAction } from 'stores/scene';\r\nimport { useDispatch, useSelector } from 'react-redux';\r\nimport { completeSceneAction } from 'actions/quests';\r\nimport { StoreState } from 'stores';\r\nimport { gsap } from 'gsap';\r\nimport { BaseSceneController } from 'mechanics/scenes/BaseSceneController';\r\n\r\nexport interface Props  {\r\n    name: string;\r\n    controller: BaseSceneController<any>;\r\n    location?: [number, number]; // tile coordinate space\r\n    children: React.ReactNode;\r\n};\r\n\r\n// This is a wrapper that exposes a location property. Will set x and y on children\r\nconst SceneActor = (props: Props) => {\r\n    const {\r\n        location = [0, 0],\r\n        controller,\r\n        children\r\n    } = props;\r\n    const tileWidth = controller.mapData?.tilewidth!;\r\n    const tileHeight = controller.mapData?.tileheight!;\r\n\r\n    const actorRef = useRef<PIXI.Container>(null);\r\n    const dispatch = useDispatch();\r\n\r\n    const actionQueueSelector = useCallback(\r\n        (state: StoreState) => {\r\n            const quest = state.quests.find((q) => q.name === props.controller.questName)!;\r\n            if (!quest.scene!.actionQueue) {\r\n                return [];\r\n            }\r\n            return quest.scene!.actionQueue.filter(a => a.actor === props.name);\r\n        },\r\n        [props.name, props.controller.questName]\r\n    );\r\n    const actionQueue = useSelector<StoreState, SceneAction[]>(actionQueueSelector);\r\n\r\n    // Handle actions\r\n    useEffect(() => {\r\n        if (!actorRef) {\r\n            return;\r\n        }\r\n        const nextAction = actionQueue[0];\r\n        if (nextAction) {\r\n            switch (nextAction.actionType) {\r\n                case SceneActionType.move: {\r\n                    const moveComplete = () => {\r\n                        dispatch(completeSceneAction(props.controller.questName));\r\n                        props.controller.actorMoved(props.name, nextAction.target);\r\n                    }\r\n                    const duration = (nextAction.endsAt - performance.now()) / 1000;\r\n                    if (duration < 0) {\r\n                        moveComplete();\r\n                    }\r\n                    gsap.killTweensOf(actorRef.current);\r\n                    gsap.to(actorRef.current, {\r\n                        duration,\r\n                        ease: \"linear\",\r\n                        pixi: {\r\n                            x: nextAction.target[0] * tileWidth,\r\n                            y: nextAction.target[1] * tileHeight\r\n                        },\r\n                        onComplete: moveComplete\r\n                    });\r\n\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n    }, [dispatch, tileWidth, tileHeight, actionQueue, props.controller, props.name]);\r\n\r\n    const {x, y} = useMemo(() => {\r\n        return {\r\n            x: location[0] * tileWidth,\r\n            y: location[1] * tileHeight,\r\n        };\r\n    }, [location, tileWidth, tileHeight]);\r\n\r\n    return (\r\n        <Container x={x} y={y} ref={actorRef}>\r\n            {children}\r\n        </Container>\r\n    )\r\n};\r\n\r\nexport default SceneActor;\r\n","import React, { useRef, forwardRef, useImperativeHandle } from \"react\";\r\nimport { Graphics } from '@inlet/react-pixi';\r\n\r\n// tslint:disable-next-line: no-empty-interface\r\ninterface Props {\r\n\r\n}\r\n\r\nexport interface RefActions {\r\n    drawAction: (from: PIXI.Point, to: PIXI.Point, allowed?: boolean) => void;\r\n    clear: () => void;\r\n    parent: PIXI.Container;\r\n}\r\n/**\r\n * ActionPath shows a line previewing the action the user is taking on a scene\r\n * @param props\r\n */\r\nconst ActionPath = forwardRef((props: Props, ref: React.Ref<RefActions>) => {\r\n    const graphicsRef = useRef<PIXI.Graphics>(null);\r\n\r\n    useImperativeHandle(ref, () => {\r\n        // console.log(graphicsRef.current.parent)\r\n        return {\r\n            drawAction: (from: PIXI.Point, to: PIXI.Point, allowed: boolean = true)=> {\r\n                const grfx = graphicsRef.current;\r\n                if (!grfx) return;\r\n                const color = allowed ? 0x00FF00 : 0xFF3300;\r\n                grfx.clear()\r\n                    .lineStyle(3, color)\r\n                    .moveTo(from.x, from.y)\r\n                    .lineTo(to.x, to.y);\r\n            },\r\n            clear: () => {\r\n                const grfx = graphicsRef.current;\r\n                grfx?.clear();\r\n            },\r\n            parent: graphicsRef.current?.parent!\r\n        }\r\n    });\r\n\r\n    return (\r\n        <Graphics\r\n            name=\"ActionPath\"\r\n            ref={graphicsRef}\r\n        />\r\n    )\r\n});\r\n\r\nexport default ActionPath;\r\n\r\n","import { useCallback } from 'react';\r\nimport { StoreState } from 'stores';\r\nimport { useSelector } from 'react-redux';\r\nimport { AdventurerStoreState } from 'stores/adventurer';\r\n\r\n// Returns the adventurer from redux store\r\n// todo: rename to useAdventurerState and move to 'adventurers.ts'\r\nconst useAdventurer = (adventurerId: string) => {\r\n    const adventurerSelector = useCallback(\r\n        (state: StoreState) => state.adventurers.find((q) => q.id === adventurerId)!,\r\n        [adventurerId]\r\n    );\r\n    const quest = useSelector<StoreState, AdventurerStoreState>(adventurerSelector);\r\n    return quest;\r\n}\r\n\r\nexport default useAdventurer;","import { Container, Graphics, Sprite } from '@inlet/react-pixi';\r\nimport React, { useRef, useEffect, useState } from 'react';\r\nimport SceneActor, { Props as SceneActorProps } from './SceneActor';\r\nimport { useDispatch } from 'react-redux';\r\nimport useQuest from 'hooks/store/useQuest';\r\nimport { enqueueSceneAction } from 'actions/quests';\r\nimport { SceneAction, SceneActionType } from 'stores/scene';\r\nimport ActionPath, { RefActions } from './ActionPath';\r\nimport useAdventurer from 'hooks/store/useAdventurer';\r\n\r\ninterface Props  {\r\n    questName: string;\r\n    selected: boolean;\r\n    setSelectedActor: (actor: string) => void;\r\n    onLootCacheChanged: (value: string) => void; // todo: opens loot cache popup\r\n};\r\n\r\n// The adventurers avatar on the scene\r\nconst SceneAdventurer = (props: Props & Omit<SceneActorProps, 'children'>) => {\r\n    const {\r\n        controller,\r\n        location,\r\n        name,\r\n        selected,\r\n    } = props;\r\n    const tileWidth = controller.mapData?.tilewidth!;\r\n    const tileHeight = controller.mapData?.tileheight!;\r\n    const dispatch = useDispatch();\r\n\r\n    const quest = useQuest(props.questName);\r\n    const scene = quest.scene!;\r\n\r\n    const adventurer = useAdventurer(name);\r\n\r\n    // Draw a line to indicate the action to take\r\n    const actionPathRef = useRef<RefActions>(null);\r\n    const [actionActive, setActionActive] = useState(false);\r\n    useEffect(() => {\r\n        if (!actionActive || !location /* || scene.actionQueue?.length*/) {\r\n            return;\r\n        }\r\n        const actionPath = actionPathRef.current;\r\n        const container = actionPath?.parent!;\r\n        const mouseMove = (event: PIXI.InteractionEvent) => {\r\n            if (actionActive && location && actionPath) {\r\n                // Find out if on a blocked tile\r\n                const destinationLocation = controller.pointToSceneLocation(new PIXI.Point(event.data.global.x, event.data.global.y));\r\n                const blocked = controller.locationIsBlocked(destinationLocation);\r\n                const from = new PIXI.Point(location[0] * tileWidth + tileWidth / 2,\r\n                    location[1] * tileHeight + tileHeight / 2);\r\n\r\n                // Draw a line to the destination tile\r\n                actionPath.drawAction(from, event.data.global, !blocked);\r\n            }\r\n        }\r\n        container.on('pointermove', mouseMove);\r\n        return () => {\r\n           container.off('pointermove', mouseMove);\r\n        }\r\n    }, [actionActive, controller, location, tileHeight, tileWidth]);\r\n\r\n    const handleActorStartDrag = () => {\r\n        setActionActive(true);\r\n        props.setSelectedActor(name);\r\n    }\r\n\r\n    const handleCancelAction = (event: PIXI.InteractionEvent) => {\r\n        setActionActive(false);\r\n        event.stopPropagation();\r\n    }\r\n\r\n    // Queue actions\r\n    const handleActorEndDrag = (event: PIXI.InteractionEvent) => {\r\n        setActionActive(false);\r\n        if(scene.actionQueue?.length) {\r\n            return;\r\n        }\r\n        props.onLootCacheChanged(\"chest\"); // todo: remove!!\r\n\r\n        const endLocation = controller.pointToSceneLocation(new PIXI.Point(event.data.global.x, event.data.global.y));\r\n        const blocked = controller.locationIsBlocked(endLocation);\r\n        if (!blocked) {\r\n            const target = controller.pointToSceneLocation(event.data.global);\r\n\r\n            const convertLocation = (l: [number, number]) => {\r\n                // This is the format AStarFind works with\r\n                return { x: l[0], y: l[1] }\r\n            }\r\n            const origin = location!;\r\n            const path = controller.aStar?.findPath(\r\n                convertLocation(origin), convertLocation(target)\r\n            );\r\n\r\n            const movementDuration = 500; // time every tile movement takes\r\n            path?.forEach((l, index) => {\r\n                const sceneAction: SceneAction = {\r\n                    actionType: SceneActionType.move,\r\n                    actor: name,\r\n                    target: l as [number, number],\r\n                    endsAt: movementDuration * (index + 1) + performance.now()\r\n                };\r\n                dispatch(enqueueSceneAction(props.questName, sceneAction));\r\n            });\r\n\r\n            // if (DEBUG_ASTAR) {\r\n            //     const graphics = new PIXI.Graphics();\r\n            //     path?.forEach((tile) => {\r\n            //         const [x, y] = tile;\r\n            //         const stroke = 3;\r\n            //         graphics.beginFill(0xDE3249, 0.5);\r\n            //         graphics.lineStyle(stroke, 0xFF0000);\r\n            //         graphics.drawRect(x * tileWidth + stroke / 2,\r\n            //             y * tileHeight + stroke / 2,\r\n            //             tileWidth - stroke / 2,\r\n            //             tileHeight - stroke / 2);\r\n            //         graphics.endFill();\r\n            //     });\r\n            //     ref.current!.addChild(graphics);\r\n            //     setTimeout(() => {\r\n            //         ref.current?.removeChild(graphics)}\r\n            //     , 1000);\r\n            // }\r\n\r\n        }\r\n        setActionActive(false);\r\n        const actionPath = actionPathRef.current;\r\n        actionPath?.clear();\r\n    }\r\n\r\n    return (\r\n        <>\r\n            <ActionPath ref={actionPathRef} />\r\n            <SceneActor\r\n                key={name}\r\n                name={name}\r\n                controller={controller}\r\n                location={location}\r\n            >\r\n                {selected && (\r\n                    <Graphics\r\n                        name=\"selectioncircle\"\r\n                        draw={graphics => {\r\n                            const line = 3;\r\n                            graphics.lineStyle(line, 0xFFFFFF);\r\n                            graphics.drawCircle(tileWidth / 2, tileHeight / 2, tileWidth / 2 - line);\r\n                            graphics.endFill();\r\n                        }}\r\n                    />\r\n                )}\r\n                <Sprite\r\n                    y={-80}\r\n                    image={`${process.env.PUBLIC_URL}/img/scene/actors/wizard.png`}\r\n                    interactive={true}\r\n                    pointerdown={handleActorStartDrag}\r\n                    pointerup={handleCancelAction}\r\n                    pointerupoutside={handleActorEndDrag}\r\n                />\r\n                <Sprite\r\n                    scale={.1}\r\n                    anchor={.5}\r\n                    x={tileWidth / 2}\r\n                    y={-30}\r\n                    image={`${process.env.PUBLIC_URL}/${adventurer.avatarImg}`}\r\n                />\r\n                { (selected && controller.actorCanInteract(name)) && (\r\n                    <Container\r\n                        interactive={true}\r\n                        pointerdown={() => {controller.actorInteract(name)}}\r\n                    >\r\n                        <Graphics\r\n                            draw={graphics => {\r\n                                graphics.beginFill(0xDE3249);\r\n                                graphics.drawCircle(tileWidth / 2, tileHeight, tileWidth / 4);\r\n                                graphics.endFill();\r\n                            }}\r\n                        />\r\n                        <Sprite\r\n                            image={`${process.env.PUBLIC_URL}/img/ui/scene/icons/interact.png`}\r\n                            scale={[.3, .3]}\r\n                            y={tileHeight}\r\n                            x={tileWidth/2}\r\n                            anchor={.5}\r\n                    />\r\n                    </Container>\r\n                )}\r\n            </SceneActor>\r\n        </>\r\n    )\r\n}\r\n\r\nexport default SceneAdventurer;\r\n","import React, { useRef, useMemo } from \"react\";\r\nimport { Container } from '@inlet/react-pixi';\r\nimport useQuest from 'hooks/store/useQuest';\r\nimport Tilemap from './Tilemap';\r\nimport { ActorObject } from 'stores/scene';\r\nimport BridgedStage from 'components/pixi/util/BridgedStage';\r\nimport { BaseSceneController } from 'mechanics/scenes/BaseSceneController';\r\nimport SceneAdventurer from './SceneAdventurer';\r\n\r\nimport * as PIXI from 'pixi.js';\r\nwindow.PIXI = PIXI;\r\n// eslint-disable-next-line import/first\r\nimport 'pixi-tilemap'; // tilemap is not a real npm module :/\r\n\r\nexport interface Props {\r\n    questName: string;\r\n    controller: BaseSceneController<any>;\r\n    selectedActor: string;\r\n    setSelectedActor: (actor: string) => void;\r\n    onLootCacheChanged: (value: string) => void; // todo: opens loot cache popup\r\n}\r\n\r\nconst DEBUG_ACTIONQUEUE = false;\r\n\r\nconst Scene = (props: Props) => {\r\n    const {controller} = props;\r\n    const mapData = controller.mapData!;\r\n    const basePath = controller.basePath!;\r\n\r\n    const ref = useRef<PIXI.Container>(null);\r\n    const quest = useQuest(props.questName);\r\n    const scene = quest.scene!;\r\n\r\n    const selectedActor = useMemo(() => {\r\n        return scene.actors?.find(a => a.name === props.selectedActor) || null;\r\n    }, [scene.actors, props.selectedActor]);\r\n\r\n    const sceneWidth = mapData.width * mapData.tilewidth;\r\n    const sceneHeight = mapData.height * mapData.tileheight;\r\n\r\n    const renderActor = (actor: ActorObject) => {\r\n        const {name, location} = actor;\r\n        return (\r\n            <SceneAdventurer\r\n                controller={controller}\r\n                location={location}\r\n                name={name}\r\n                key={name}\r\n                questName={props.questName}\r\n                selected={selectedActor?.name === name}\r\n                onLootCacheChanged={props.onLootCacheChanged}\r\n                setSelectedActor={props.setSelectedActor}\r\n            />\r\n        );\r\n    }\r\n\r\n    return (\r\n        <>\r\n            <BridgedStage width={sceneWidth} height={sceneHeight}>\r\n                <Container\r\n                    ref={ref}\r\n                    interactive={true}\r\n                    hitArea={new PIXI.Rectangle(0, 0, sceneWidth, sceneHeight)}\r\n                >\r\n                    <Tilemap\r\n                        basePath={basePath}\r\n                        data={mapData}\r\n                        tileObjects={scene.tileObjects}\r\n                    />\r\n                    { scene.actors?.map((o) => renderActor(o))}\r\n                </Container>\r\n            </BridgedStage>\r\n            {DEBUG_ACTIONQUEUE && (\r\n                <div style={{ position: 'absolute', bottom: 0}}>\r\n                    <h2>ActionQueue</h2>\r\n                    <ul>\r\n                        {scene.actionQueue && scene.actionQueue.map((action) => (\r\n                            <li key={JSON.stringify(action)}>{JSON.stringify(action)}</li>\r\n                        ))}\r\n                    </ul>\r\n                </div>\r\n            )}\r\n        </>\r\n    );\r\n}\r\n\r\nexport default Scene;\r\n","import React, { useState, useMemo, useEffect } from \"react\";\r\nimport \"./css/questPanel.css\";\r\nimport AdventurerTabstrip from './AdventurerTabstrip';\r\nimport { createSelectAdventurersOnQuest } from 'selectors/adventurers';\r\nimport { useSelector } from 'react-redux';\r\nimport AdventurerPanel from './AdventurerPanel';\r\nimport QuestDetails from './QuestDetails';\r\nimport { useHistory } from 'react-router';\r\nimport { getWorldLink } from 'utils/routing';\r\nimport LootCache from './modals/LootCache';\r\n\r\nenum Layout {\r\n    auto,       // horizontal on large screens, vertical on small screens\r\n    vertical,\r\n    horizontal\r\n}\r\n\r\ninterface Props {\r\n    questName: string;\r\n    layout?: Layout;\r\n}\r\n\r\nconst QuestPanel = (props: Props) => {\r\n    const history = useHistory();\r\n    const {layout = Layout.auto} = props;\r\n    const adventurers = useSelector(createSelectAdventurersOnQuest(props.questName));\r\n    const [activeLootCache, setActiveLootCache] = useState<string>();\r\n    const leader = adventurers[0];\r\n    const [selectedAdventurerId, setSelectedAdventurerID] = useState<string>(leader?.id);\r\n\r\n    const selectedAdventurer = useMemo(() => {\r\n        return adventurers.find(a => a.id === selectedAdventurerId);\r\n    }, [adventurers, selectedAdventurerId]);\r\n\r\n    const handleLootCacheChanged = (value: string) => {\r\n        setActiveLootCache(value);\r\n    }\r\n\r\n    const handleAdventurerSelected = (adventurerId: string) => {\r\n        setSelectedAdventurerID(adventurerId);\r\n    }\r\n\r\n    useEffect(() => {\r\n        if (!adventurers.length) {\r\n            // no adventurers, something went wrong, perhaps invalid url\r\n            // bounce back to world\r\n            history.push(getWorldLink());\r\n       }\r\n    }, [adventurers.length, history]);\r\n    if (!adventurers.length) return null;\r\n\r\n    return (\r\n        <div className={`quest-panel quest-panel-${Layout[layout]}`}>\r\n            <div className=\"quest-area\">\r\n                <QuestDetails\r\n                    questName={props.questName}\r\n                    selectedActor={selectedAdventurerId}\r\n                    onLootCacheChanged={handleLootCacheChanged}\r\n                    setSelectedActor={handleAdventurerSelected}\r\n                />\r\n                { activeLootCache && (\r\n                    <div className=\"modal\" onClick={() => setActiveLootCache(undefined)}>\r\n                        <LootCache\r\n                            questName={props.questName}\r\n                            cacheName={activeLootCache}\r\n                            adventurerId={selectedAdventurerId}\r\n                            onClose={() => setActiveLootCache(undefined)}\r\n                        />\r\n                    </div>\r\n                )}\r\n            </div>\r\n            <div className=\"party-area\">\r\n                <AdventurerTabstrip\r\n                    adventurers={adventurers}\r\n                    selectedAdventurerId={selectedAdventurerId}\r\n                    onAdventurerTabSelected={handleAdventurerSelected}\r\n                    disabled={activeLootCache !== undefined}\r\n                />\r\n                <div className=\"adventurer-details\">\r\n                    { selectedAdventurer && (\r\n                        <AdventurerPanel adventurer={selectedAdventurer} />\r\n                    )}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default QuestPanel;\r\n","import React from 'react';\r\nimport useQuest from 'hooks/store/useQuest';\r\nimport { getDefinition } from 'definitions/quests';\r\nimport { QuestDefinition } from 'definitions/quests/types';\r\nimport { TextManager } from 'global/TextManager';\r\n\r\nexport interface Props {\r\n    questName: string;\r\n}\r\n\r\n/* Shows the most recent log on a questnode */\r\nconst OnTheRoad = (props: Props) => {\r\n    const quest = useQuest(props.questName);\r\n    const questDefinition: QuestDefinition = getDefinition(quest.name);\r\n    let progress: number = Math.floor(quest.progress);\r\n    do {\r\n        const log = questDefinition.nodes[progress].log;\r\n        if (log) {\r\n            return (\r\n                <div>\r\n                    { <h1 className=\"app-h2\">{TextManager.getQuestTitle(quest.name)}</h1>}\r\n                    <p>{`${TextManager.get(log)}`}</p>\r\n                </div>\r\n            )\r\n        }\r\n        progress--;\r\n    } while (progress >= 0);\r\n    return null;\r\n}\r\n\r\nexport default OnTheRoad;","import React from 'react';\r\nimport Scene from 'components/world/QuestPanel/QuestDetails/scene/Scene';\r\nimport { useSceneController } from 'hooks/useSceneController';\r\nimport { SceneStoreState } from 'stores/scene';\r\nimport useQuest from 'hooks/store/useQuest';\r\nimport OnTheRoad from './OnTheRoad';\r\n\r\nexport interface Props {\r\n    questName: string;\r\n    selectedActor: string;\r\n    setSelectedActor: (actor: string) => void;\r\n    onLootCacheChanged: (value: string) => void;\r\n}\r\n\r\nconst QuestDetails = (props: Props) => {\r\n\r\n    const quest = useQuest(props.questName);\r\n\r\n    if (!quest.sceneName) {\r\n        return <OnTheRoad questName={props.questName} />;\r\n    }\r\n\r\n    return (\r\n        <SceneLoader {...props} sceneName={quest.sceneName} scene={quest.scene} />\r\n    );\r\n}\r\n\r\nexport default QuestDetails;\r\n\r\ntype SceneLoaderProps = Props & {\r\n    sceneName: string;\r\n    scene?: SceneStoreState;\r\n}\r\n\r\n// Ensures a sceneController is present with tilemap data loaded and quest scene data is present on the store\r\nconst SceneLoader = (props: SceneLoaderProps) => {\r\n    const { controller, loaded } = useSceneController(props.questName, props.sceneName);\r\n    if (!props.scene || !loaded || !controller.mapData) {\r\n        return null;\r\n    }\r\n    return (\r\n        <Scene {...props} controller={controller} />\r\n    )\r\n}\r\n","import { useStore } from 'react-redux';\r\nimport { SceneControllerManager } from 'global/SceneControllerManager';\r\nimport { useEffect, useState, useMemo } from 'react';\r\nimport { StoreState } from 'stores';\r\n\r\nexport const useSceneController = (questName: string, sceneName: string) => {\r\n    const store = useStore<StoreState>();\r\n    const controller = useMemo(() => (\r\n        SceneControllerManager.getSceneController(questName, sceneName, store)\r\n    ), [questName, sceneName, store]);\r\n    const [loaded, setLoaded] = useState<boolean>(false);\r\n\r\n    const storeState = store.getState();\r\n    const quest = storeState.quests.find(q => q.name === questName)!;\r\n    const {scene} = quest;\r\n\r\n    useEffect(() => {\r\n        if (sceneName) {\r\n            setLoaded(false);\r\n            const loadingComplete = () => {\r\n                setLoaded(true);\r\n\r\n                // If the store has no scene for this quest yet, create and store it!\r\n                if (!scene) {\r\n                    controller.createScene();\r\n                    controller.sceneEntered();\r\n                }\r\n            }\r\n            controller.loadData(loadingComplete);\r\n        }\r\n    }, [controller, questName, scene, sceneName]);\r\n\r\n    return { controller, loaded };\r\n}","import { Item } from \"definitions/items/types\";\r\nimport * as React from \"react\";\r\nimport { TextManager } from \"global/TextManager\";\r\nimport \"components/ui/css/common/icon.css\";\r\nimport DraggableItemIcon from 'components/ui/DraggableItemIcon';\r\nimport { DragSourceType } from 'constants/dragging';\r\nimport \"./itemsList.scss\";\r\n\r\nexport interface Props {\r\n    className?: string;\r\n    items: Item[];\r\n    sourceType: DragSourceType;\r\n    sourceId?: string;\r\n}\r\n\r\n/**\r\n * The ItemsList displays a list of items vertically. Shows icon and description\r\n */\r\nconst DraggableItemsList = (props: Props) => {\r\n    const className = (props.className || \"\")+ \" itemslist\";\r\n\r\n    return (\r\n        <ul className={className} >\r\n            {props.items.map((item, index)=> (\r\n                <li\r\n                    key={`${item}${index}`}\r\n                    className=\"item\"\r\n                >\r\n                    <DraggableItemIcon\r\n                        item={item}\r\n                        index={index}\r\n                        sourceId={props.sourceId}\r\n                        sourceType={props.sourceType}\r\n                    />\r\n                    <div className=\"text\">\r\n                        <p className=\"name\">{TextManager.getItemName(item)}</p>\r\n                        <p className=\"subtext\">{TextManager.getItemSubtext(item)}</p>\r\n                    </div>\r\n                </li>\r\n            ))}\r\n        </ul>\r\n    );\r\n};\r\n\r\nexport default DraggableItemsList;\r\n","import React, { useState, useEffect, useRef } from \"react\";\r\nimport useQuest from 'hooks/store/useQuest';\r\nimport DraggableItemsList from 'components/ui/items/DraggableItemsList';\r\nimport { TextManager } from 'global/TextManager';\r\nimport AdventurerAvatar from 'components/ui/AdventurerAvatar';\r\nimport useAdventurer from 'hooks/store/useAdventurer';\r\nimport { DragSourceType } from 'constants/dragging';\r\nimport { useDispatch } from 'react-redux';\r\nimport { addGold } from 'actions/gold';\r\nimport { takeGoldFromCache, takeItemFromCache } from 'actions/quests';\r\nimport { addItemToInventory } from 'actions/adventurers';\r\nimport { adventurerFreeInventorySlots } from 'storeHelpers';\r\nimport \"./lootCache.scss\";\r\n\r\ninterface Props {\r\n    questName: string;\r\n    cacheName: string;\r\n    adventurerId: string;\r\n    onClose: () => void;\r\n}\r\n\r\nconst LootCache = (props: Props) => {\r\n    const dispatch = useDispatch();\r\n    const quest = useQuest(props.questName);\r\n    const {scene} = quest;\r\n    const cache = scene?.caches[props.cacheName];\r\n    const adventurer = useAdventurer(props.adventurerId);\r\n    const [taking, setTaking] = useState(false)\r\n    const freeSlots = adventurerFreeInventorySlots(adventurer);\r\n    const ref = useRef<HTMLDivElement>(null);\r\n\r\n    useEffect(() => {\r\n        let interval: NodeJS.Timeout;\r\n        // Todo:\r\n        // determine max items to be added to inventory\r\n        // play staggered animation onClick\r\n        // add items immediately\r\n        if (taking && cache && ref.current) {\r\n            const item = cache.items[0];\r\n            if (!item) {\r\n                setTaking(false);\r\n                return;\r\n            }\r\n            ref.current.querySelector(\".itemslist .item\")?.classList.add(\"taking\");\r\n\r\n            if (freeSlots > 0) {\r\n                interval = setTimeout(() => {\r\n                    dispatch(addItemToInventory(props.adventurerId, item));\r\n                    dispatch(takeItemFromCache(props.questName, props.cacheName, item));\r\n                }, 500);\r\n            }\r\n            else {\r\n                setTaking(false);\r\n            }\r\n        }\r\n        return () => {\r\n            clearInterval(interval);\r\n        }\r\n    }, [cache, freeSlots, dispatch, props.adventurerId, props.cacheName, props.questName, taking]);\r\n\r\n    if (!cache) {\r\n        return null;\r\n    }\r\n\r\n    const handleTakeGold = (e: React.MouseEvent) => {\r\n        e.stopPropagation();\r\n        // todo: animate gold flying away\r\n\r\n        dispatch(addGold(cache.gold || 0));\r\n        dispatch(takeGoldFromCache(props.questName, props.cacheName))\r\n    }\r\n\r\n    const handleTakeAllItems = (e: React.MouseEvent) => {\r\n        e.stopPropagation();\r\n        setTaking(true);\r\n    }\r\n\r\n    return (\r\n        <div className={`loot-cache`} ref={ref}>\r\n            <div className=\"header\">\r\n                <div className=\"title\">\r\n                    {TextManager.get(cache.title)}\r\n                </div>\r\n                <div className=\"close\" onClick={props.onClose} />\r\n            </div>\r\n            { cache.items.length > 0 && (\r\n                <div className=\"content\">\r\n                    <div className=\"items\">\r\n                        <DraggableItemsList\r\n                            items={cache.items}\r\n                            sourceType={DragSourceType.lootCache}\r\n                            sourceId={props.cacheName}\r\n                        />\r\n                    </div>\r\n                    <div className=\"adventurer\">\r\n                        <AdventurerAvatar adventurer={adventurer}/>\r\n                        <button onClick={handleTakeAllItems} disabled={freeSlots === 0}>\r\n                            {TextManager.get(\"quest-common-loot-cache-take-all\")}\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            )}\r\n            { !!cache.gold && (\r\n                <div className=\"content\">\r\n                    <div className=\"gold\">\r\n                        <div\r\n                            className=\"icon common-icon-medium\"\r\n                            style={{ backgroundImage: `url(${process.env.PUBLIC_URL}/img/resources/gold.png)`}}\r\n                        />\r\n                        {TextManager.get(\"quest-common-loot-cache-gold\", { gold: cache.gold })}\r\n                    </div>\r\n                    <div className=\"take-gold\">\r\n                        <button onClick={handleTakeGold}>\r\n                            {TextManager.get(\"quest-common-loot-cache-take\")}\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default LootCache;","import SquareIconButton from \"components/ui/buttons/SquareIconButton\";\r\nimport Tab from \"components/ui/tabs/Tab\";\r\nimport Tabstrip from \"components/ui/tabs/Tabstrip\";\r\nimport * as React from \"react\";\r\nimport {LogChannel, LogEntry} from \"stores/logEntry\";\r\nimport {TextManager} from \"global/TextManager\";\r\nimport {useState} from 'react';\r\nimport {StoreState} from 'stores';\r\nimport {useSelector} from 'react-redux';\r\nimport {QuestStoreState} from 'stores/quest';\r\nimport {selectActiveQuests} from 'selectors/quests';\r\nimport \"./css/simplelog.css\";\r\n\r\n// tslint:disable-next-line:no-empty-interface\r\nexport interface Props {\r\n}\r\n\r\nenum ChannelType {\r\n    all,\r\n    town,\r\n    quest,\r\n}\r\n\r\ninterface ChannelDefinition {\r\n    label: string;\r\n    tabType: ChannelType;\r\n    tabId: string;\r\n    channelContext?: string;\r\n}\r\n\r\nconst SimpleLog = (props: Props) => {\r\n\r\n    const [expanded, setExpanded] = useState(false);\r\n    const [selectedTabId, setSelectedTabId] = useState(\"all\");\r\n\r\n    const logEntries = useSelector<StoreState, LogEntry[]>((store) => store.log);\r\n    const activeQuests = useSelector<StoreState, QuestStoreState[]>((store) => selectActiveQuests(store));\r\n\r\n\r\n    const channels: ChannelDefinition[]=[{\r\n        label: TextManager.get(\"ui-log-tab-all\"),\r\n        tabId: \"all\",\r\n        tabType: ChannelType.all,\r\n    }, {\r\n        label: TextManager.get(\"ui-log-tab-town\"),\r\n        tabId: \"town\",\r\n        tabType: ChannelType.town,\r\n    }];\r\n\r\n    const handleTabSelected = (tabId: string) => {\r\n        setSelectedTabId(tabId);\r\n    }\r\n\r\n    const handleToggleExpand=() => {\r\n        setExpanded(!expanded);\r\n    }\r\n\r\n    activeQuests.forEach((quest) => {\r\n        const questName = quest.name;\r\n        channels.push({\r\n            channelContext: questName,\r\n            label: TextManager.getQuestTitle(questName),\r\n            tabId: `quest-${questName}`,\r\n            tabType: ChannelType.quest,\r\n        });\r\n    });\r\n\r\n    let displayEntries: LogEntry[] = [];\r\n    const currentTab=channels.find((t) => t.tabId === selectedTabId)!;\r\n\r\n    switch (currentTab.tabType) {\r\n        case ChannelType.all:\r\n            // All the things\r\n            displayEntries = logEntries;\r\n            break;\r\n\r\n        case ChannelType.town:\r\n            // Only town\r\n            displayEntries = logEntries.filter((lE) => lE.channel === LogChannel.town);\r\n            break;\r\n\r\n        case ChannelType.quest:\r\n            // Only the selected quest\r\n            displayEntries = logEntries.filter((lE) => lE.channel === LogChannel.quest && lE.channelContext === currentTab.channelContext);\r\n            break;\r\n}\r\n\r\n    const getLogEntryRow = (logEntry: LogEntry) => {\r\n        const text = TextManager.get(logEntry.key, logEntry.context);\r\n        return <div className=\"entry\" key={logEntry.time}>\r\n            {text}\r\n        </div>;\r\n    };\r\n\r\n    return (\r\n        <div className={`log ${expanded ? \"expanded\" : \"\"}`}>\r\n            <div className=\"tab-bar\">\r\n                <Tabstrip className=\"tabs\" onTabSelected={handleTabSelected} activeTab={selectedTabId}>\r\n                    {channels.map((tab) => {\r\n                        return <Tab id={tab.tabId} key={tab.tabId}>{tab.label}</Tab>;\r\n                    })}\r\n                </Tabstrip>\r\n                <SquareIconButton className=\"expand-button\" onClick={handleToggleExpand} text={expanded ? \"▼\" : \"▲\"}/>\r\n            </div>\r\n            <div className=\"log-entries\">\r\n                {displayEntries.map((entry) => getLogEntryRow(entry))}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default SimpleLog;\r\n","import WorldMap from \"components/world/WorldMap\";\r\nimport React, { useEffect, useRef } from \"react\";\r\nimport { MusicTrack, SoundManager, Sound } from \"global/SoundManager\";\r\nimport \"./css/worldView.css\";\r\nimport QuestPanel from './QuestPanel';\r\nimport { useRouteMatch, useHistory } from 'react-router';\r\nimport { getQuestLink, getWorldLink } from 'utils/routing';\r\n\r\n// tslint:disable-next-line:no-empty-interface\r\nexport interface Props {\r\n}\r\n\r\n\r\n/**\r\n * WorldView shows the map and QuestPanel\r\n * @param props\r\n */\r\nconst WorldView = () => {\r\n    const worldMapRef = useRef<HTMLDivElement>(null);\r\n    const match = useRouteMatch<{questname: string}>(`${getWorldLink()}/:questname`);\r\n    const selectedQuestName = match?.params.questname;\r\n    const history = useHistory();\r\n\r\n    useEffect(() => {\r\n        SoundManager.addMusicTrack(MusicTrack.world, \"sound/music/TheLoomingBattle.ogg\");\r\n        SoundManager.playMusicTrack(MusicTrack.world);\r\n    }, []);\r\n\r\n    // console.log(params.questname);\r\n    // const handleMapMove = (distance: number, angle: number) => {\r\n    //     const compassEl = compassRef!.current!;\r\n    //     const compassTextEl = compassEl.firstElementChild! as HTMLElement;\r\n\r\n    //     // Rotate the compass\r\n    //     compassEl.style.transform = `rotate(${angle - (Math.PI / 2)}rad)`;\r\n    //     compassEl.style.opacity = distance > 10 ? \"1\" : \"0\";\r\n    //     compassTextEl.style.transform = `rotate(${-angle + (Math.PI / 2)}rad)`;\r\n    //     compassTextEl.innerHTML = `${distance.toFixed(0)}`;\r\n    // };\r\n\r\n    // const handleCompassClick = () => {\r\n    //     //setScrollToPosition(new Vector2(1, 1));\r\n    // };\r\n\r\n    const handlePartyClick = (questName: string) => {\r\n        if (questName === selectedQuestName) {\r\n            history.push(getWorldLink());\r\n        } else {\r\n            history.push(getQuestLink(questName));\r\n        }\r\n        SoundManager.playSound(Sound.buttonClick);\r\n    };\r\n\r\n    const handleRetrieveWorldViewRef = () => {\r\n        return worldMapRef;\r\n    }\r\n\r\n    return (\r\n        <div className=\"world-view\" ref={worldMapRef}>\r\n            {/* <div className=\"compass\" ref={compassRef} onClick={handleCompassClick}>\r\n                <div className=\"distance\"/>\r\n            </div> */}\r\n            <WorldMap\r\n                selectedQuestName={selectedQuestName}\r\n                // onMapMove={handleMapMove}\r\n                smallMap={selectedQuestName != null}\r\n                onPartyClick={handlePartyClick}\r\n                retrieveWorldViewRef={handleRetrieveWorldViewRef}\r\n            />\r\n            { selectedQuestName && (\r\n                <QuestPanel questName={selectedQuestName} />\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default WorldView;\r\n","// tslint:disable:object-literal-sort-keys\nimport { Action, AnyAction } from \"redux\";\nimport { TaskType } from \"stores/task\";\n\nexport enum ActionType {\n    start = \"startTask\",\n    update = \"updateTasks\",\n}\n\nexport interface AddAction extends Action<ActionType> {\n    taskType: TaskType;\n    name: string;\n    origin: string;\n    time: number;\n    callbacks: AnyAction[];\n}\n\nexport function startTask(taskType: TaskType,\n                          name: string, origin: string, time: number, callbacks: AnyAction[]): AddAction {\n    return {\n        type: ActionType.start,\n        taskType,\n        name,\n        origin,\n        time,\n        callbacks,\n    };\n}\n","import { AnyAction } from \"redux\";\n\nexport enum TaskType {\n    buildStructure,\n    craftItem,\n}\n\nexport interface TaskStoreState {\n    type: TaskType;\n    name: string;\n    origin: string;\n    startTime: number;        // time the task was scheduled\n    lastTick: number;         // time of last tick\n    timeRemaining: number;\n    progress: number;         // value between 0 and 1 indicating progress\n    callbacks: AnyAction[];\t  // actions to dispatch on complete\n}\n","import { useCallback } from 'react';\r\nimport { StoreState } from 'stores';\r\nimport { useSelector } from 'react-redux';\r\nimport { Structure } from 'definitions/structures';\r\nimport { StructureStoreState } from 'stores/structure';\r\n\r\n// Returns the structure state from redux store\r\n// todo: rename to `useStructureState`\r\nconst useStructure = (structure: Structure) => {\r\n    const structureSelector = useCallback(\r\n        (state: StoreState) => state.structures[structure],\r\n        [structure]\r\n    );\r\n    return useSelector<StoreState, StructureStoreState>(structureSelector);\r\n}\r\n\r\nexport default useStructure;","import React, { useEffect, useRef, useState } from 'react';\r\nimport './style/tooltip.scss';\r\nimport { TooltipManager } from 'global/TooltipManager';\r\n\r\nconst ARROW_SIZE = 8; // warning: sync to tooltip.css var\r\nconst PADDING = 8;\r\n\r\nexport interface Props {\r\n    referenceRect: ClientRect;  // place tooltip in reference to this rect\r\n    placement?: Placement;\r\n    children?: any;\r\n}\r\n\r\nexport enum Placement {\r\n    bottom,\r\n    top,\r\n    left,\r\n    right,\r\n}\r\n\r\nexport const Tooltip = (props: Props) => {\r\n    const { children, referenceRect } = props;\r\n    const ref = useRef<HTMLDivElement>(null);\r\n    const [placement, setPlacement] = useState<Placement>(props.placement || Placement.bottom);\r\n\r\n    const [containerRect, setContainerRect] = useState<ClientRect>(); // This is the\r\n\r\n    useEffect(() => {\r\n        // Reposition if needed\r\n        const tooltipElement = ref.current;\r\n        if (!tooltipElement) return;\r\n        if (!containerRect) return;\r\n        const tooltipRect = tooltipElement.getBoundingClientRect();\r\n\r\n        // Flip vertically\r\n        switch (placement) {\r\n            case Placement.top:\r\n                if (tooltipRect.top - tooltipRect.height - ARROW_SIZE - PADDING < containerRect!.top) {\r\n                    // Too high, place underneath\r\n                    setPlacement(Placement.bottom);\r\n                    return;\r\n                }\r\n                break;\r\n            case Placement.bottom:\r\n                if (tooltipRect.top + tooltipRect.height + ARROW_SIZE + PADDING > containerRect!.height) {\r\n                    // Too low, place top\r\n                    setPlacement(Placement.top);\r\n                    return;\r\n                }\r\n                break;\r\n        }\r\n        tooltipElement.style.opacity = \"1\"; // animated through css\r\n\r\n        const contentElement = tooltipElement.querySelector(\".tooltip-content\") as HTMLElement;\r\n        if (tooltipRect.left < containerRect!.left + PADDING) {\r\n            // Check left bounding edge\r\n            const offset = containerRect!.left - tooltipRect.left + PADDING;\r\n            contentElement.style.transform = `translateX(${offset}px)`;\r\n        } else if (tooltipRect.right > containerRect!.right - PADDING) {\r\n            // Check right bounding edge\r\n            const offset = tooltipRect.right - containerRect!.right + PADDING;\r\n            contentElement.style.transform = `translateX(${-offset}px)`;\r\n        } else {\r\n            contentElement.style.transform = '';\r\n        }\r\n\r\n    }, [setPlacement, containerRect, placement, referenceRect]);\r\n\r\n    const resize = () => {\r\n        TooltipManager.clear();\r\n    }\r\n\r\n    useEffect(() => {\r\n        setContainerRect(ref.current?.closest('.app')?.getBoundingClientRect());\r\n\r\n        window.addEventListener(\"resize\", resize);\r\n        return () => {\r\n            window.removeEventListener(\"resize\", resize);\r\n        };\r\n    }, []);\r\n\r\n\r\n    let x: number = 0;\r\n    let y: number = 0;\r\n    let className: string = \"\";\r\n\r\n    if (containerRect) {\r\n        switch (placement) {\r\n            case Placement.bottom:\r\n                x = referenceRect.left - containerRect!.left + referenceRect.width / 2;\r\n                y = referenceRect.top - containerRect!.top + referenceRect.height;\r\n                className = \"tooltip-bottom\";\r\n                break;\r\n            case Placement.top:\r\n                x = referenceRect.left - containerRect!.left + referenceRect.width / 2;\r\n                y = referenceRect.top - containerRect!.top;\r\n                className = \"tooltip-top\";\r\n                break;\r\n        }\r\n    }\r\n\r\n    return (\r\n        <div className={`tooltip ${className}`}\r\n            style={{\r\n                left: x,\r\n                opacity: 0,\r\n                top: y,\r\n            }}\r\n            ref={ref}\r\n        >\r\n            <div className=\"tooltip-arrow\" />\r\n            <div className=\"tooltip-content\">\r\n                {children}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default Tooltip;\r\n","import * as React from \"react\";\r\nimport { useDispatch } from 'react-redux';\r\nimport { Structure, getDefinition } from 'definitions/structures';\r\nimport { subtractGold } from 'actions/gold';\r\nimport { startBuildingStructure, finishBuildingStructure } from 'actions/structures';\r\nimport { startTask } from 'actions/tasks';\r\nimport { TaskType } from 'stores/task';\r\nimport { DeedDefinition } from 'definitions/items/deeds';\r\nimport useGold from 'hooks/store/useGold';\r\nimport useStructure from 'hooks/store/useStructure';\r\nimport { StructureState } from 'stores/structure';\r\nimport { TextManager } from 'global/TextManager';\r\n\r\ninterface Props {\r\n    info: DeedDefinition;\r\n}\r\n\r\nconst DeedContent = (props: Props) => {\r\n    const { info } = props;\r\n    const dispatch = useDispatch();\r\n\r\n    const gold = useGold();\r\n    const structureDefinition = getDefinition(info.structure);\r\n    const enoughGold = structureDefinition.cost.gold || 0 <= gold;\r\n    const structureStoreState = useStructure(info.structure);\r\n    const canBeBuilt = structureStoreState.state === StructureState.NotBuilt;\r\n    const disabled = !canBeBuilt || !enoughGold;\r\n    const subtext = TextManager.getItemSubtext(info.item);\r\n\r\n    const handleStartConstruction = (structure: Structure) => {\r\n\r\n        dispatch(subtractGold(structureDefinition.cost.gold || 0));\r\n        dispatch(startBuildingStructure(structure));\r\n\r\n        const callbacks = [ finishBuildingStructure(structure) ];\r\n        const time = structureDefinition.cost.time!;\r\n        const start = startTask(TaskType.buildStructure,\r\n            `${structure}.build`,\r\n            \"town\",\r\n            time,\r\n            callbacks);\r\n        dispatch(start);\r\n    }\r\n    return (\r\n        <div>\r\n            { subtext && (<p>\"{subtext}\"</p>)}\r\n            <button disabled={ disabled } onClick= { () => handleStartConstruction(info.structure) }>\r\n                Start construction ({ structureDefinition.cost.gold } gold)\r\n            </button>\r\n        </div>\r\n    );\r\n\r\n}\r\n\r\nexport default DeedContent;","import * as React from \"react\";\r\nimport { WeaponDefinition, DamageType } from 'definitions/items/weapons';\r\nimport { TextManager } from 'global/TextManager';\r\n\r\ninterface Props {\r\n    info: WeaponDefinition;\r\n}\r\n\r\nconst WeaponContent = (props: Props) => {\r\n    const { info } = props;\r\n    const subtext = TextManager.getItemSubtext(info.item);\r\n\r\n    return (\r\n        <>\r\n            { subtext && (<p>\"{subtext}\"</p>)}\r\n            <p> damage: { info.damage[DamageType.kinetic] } </p>\r\n        </>\r\n    );\r\n\r\n}\r\n\r\nexport default WeaponContent;","import * as React from \"react\";\r\nimport { TextManager } from 'global/TextManager';\r\nimport { ApparelDefinition } from 'definitions/items/apparel';\r\n\r\ninterface Props {\r\n    info: ApparelDefinition;\r\n}\r\n\r\nconst ApparelContent = (props: Props) => {\r\n    const { info } = props;\r\n    const subtext = TextManager.getItemSubtext(info.item);\r\n\r\n    return (\r\n        <>\r\n            { subtext && (<p>\"{subtext}\"</p>)}\r\n            { info.armourRating && <p> armour: { info.armourRating } </p> }\r\n        </>\r\n    );\r\n\r\n}\r\n\r\nexport default ApparelContent;","import * as React from \"react\";\r\nimport { ApparelDefinition } from \"definitions/items/apparel\";\r\nimport { DeedDefinition } from \"definitions/items/deeds\";\r\nimport { ItemDefinition, ItemType } from \"definitions/items/types\";\r\nimport { WeaponDefinition } from \"definitions/items/weapons\";\r\nimport DeedContent from './DeedContent';\r\nimport WeaponContent from './WeaponContent';\r\nimport ApparelContent from './ApparelContent';\r\nimport { TextManager } from 'global/TextManager';\r\n\r\nexport interface Props {\r\n    info: ItemDefinition;\r\n}\r\n\r\nconst ItemContext = (props: Props) => {\r\n\r\n    const info = props.info;\r\n    switch (info.itemType) {\r\n        case ItemType.deed:\r\n           return <DeedContent info={info as DeedDefinition} />;\r\n\r\n        case ItemType.weapon:\r\n            return <WeaponContent info={info as WeaponDefinition} />;\r\n\r\n        case ItemType.apparel:\r\n            return <ApparelContent info={info as ApparelDefinition} />;\r\n\r\n        default:\r\n            const subtext = TextManager.getItemSubtext(info.item);\r\n            return (subtext && (<p>\"{subtext}\"</p>)) || null;\r\n    }\r\n}\r\nexport default ItemContext;","import * as React from \"react\";\r\nimport { TextManager } from 'global/TextManager';\r\nimport { useSelector } from 'react-redux';\r\nimport { StoreState } from 'stores';\r\nimport { StructuresStoreState } from 'stores/structures';\r\nimport { Resource } from 'definitions/resources';\r\nimport { getStructureByResource, getDefinition } from 'definitions/structures';\r\nimport { StructureState } from 'stores/structure';\r\nimport { getStructureLink } from 'utils/routing';\r\nimport { Link } from 'react-router-dom';\r\nimport { ResourceStructureLevelDefinition, ResourceStructureDefinition } from 'definitions/structures/types';\r\nimport './resourceContext.scss';\r\n\r\nexport interface Props {\r\n    info: string;\r\n}\r\n\r\nconst ResourceContext = (props: Props) => {\r\n\r\n    const resource = props.info;\r\n    const structureStates = useSelector<StoreState, StructuresStoreState>(store => store.structures);\r\n\r\n    const renderProducedBy = () => {\r\n        const structure = getStructureByResource(Resource[resource]);\r\n        const structureState = structureStates[structure];\r\n        if (structureState.state !== StructureState.Built) {\r\n            return (\r\n                <span>\r\n                    {TextManager.get(\"ui-tooltip-resource-produce-row-notbuilt\", {\r\n                        structure: TextManager.getStructureName(structure)\r\n                    })}\r\n                </span>\r\n            )\r\n        }\r\n        const structureDefinition = getDefinition<ResourceStructureDefinition>(structure);\r\n        const levelDefinition: ResourceStructureLevelDefinition = structureDefinition.levels[structureState.level];\r\n        const amount = levelDefinition.generates[resource];\r\n        // Split the string at {{structure}}\r\n        const split = TextManager.get(\"ui-tooltip-resource-produce-row\", {\r\n            structure: \"%SPLIT%\",\r\n            amount\r\n        }).split(\"%SPLIT%\");\r\n        return (\r\n            <span className=\"produced\">\r\n                {split[0]}\r\n                <Link to={getStructureLink(structure)} >\r\n                    { TextManager.getStructureName(structure) }\r\n                </Link>\r\n                {split[1]}\r\n            </span>\r\n        )\r\n    }\r\n\r\n    switch (resource) {\r\n        case Resource.fabric:\r\n        case Resource.food:\r\n        case Resource.iron:\r\n        case Resource.leather:\r\n        case Resource.stone:\r\n        case Resource.wood: {\r\n            return (\r\n                <>\r\n                    <div className=\"resource-context\">\r\n                        {TextManager.get(`resource-${resource}-info`)}\r\n                    </div>\r\n                    <div>\r\n                        {renderProducedBy()}\r\n                    </div>\r\n                </>\r\n            )\r\n        }\r\n        default: {\r\n            return (\r\n                <>\r\n                    <div className=\"resource-context\">\r\n                        {` ${TextManager.get(`resource-${resource}-info`)}`}\r\n                    </div>\r\n                </>\r\n            )\r\n        }\r\n\r\n    }\r\n\r\n}\r\nexport default ResourceContext;","import React, { useEffect, useState } from 'react';\r\nimport { ContextType } from 'constants/context';\r\nimport { TooltipManager, Context } from 'global/TooltipManager';\r\nimport { TextManager } from 'global/TextManager';\r\nimport ItemContext from '../context/ItemContext';\r\nimport { ItemDefinition } from 'definitions/items/types';\r\nimport { Resource } from 'definitions/resources';\r\nimport ResourceContext from '../context/ResourceContext';\r\nimport './contextTooltip.css';\r\nimport Tooltip from '../Tooltip';\r\n\r\n\r\n// A contextual popup showing what you just clicked. Can be an Item\r\nconst ContextTooltip = () => {\r\n\r\n    const [selectedContext, setSelectedContext] = useState<Context | undefined>();\r\n\r\n    const tooltipUpdated = (context: Context | undefined) => {\r\n        setSelectedContext(context);\r\n    }\r\n\r\n    useEffect(() => {\r\n        TooltipManager.addEventListener(TooltipManager.EVENT_CONTEXT_UPDATED, tooltipUpdated);\r\n        return () => {\r\n            TooltipManager.removeEventListener(TooltipManager.EVENT_CONTEXT_UPDATED, tooltipUpdated);\r\n        }\r\n    }, []);\r\n    if (!selectedContext) { return null; }\r\n\r\n    const { info, type } = selectedContext;\r\n    const renderContent = () => {\r\n        switch (type) {\r\n            case ContextType.resource: {\r\n                const name = TextManager.getResourceName(info as Resource);\r\n                return (\r\n                    <>\r\n                        <div className=\"name resource\">{name}</div>\r\n                        <ResourceContext info={info as string} />\r\n                    </>\r\n                );\r\n            }\r\n            case ContextType.item:\r\n            default: {\r\n                const name = TextManager.getItemName((info as ItemDefinition).item);\r\n                return (\r\n                    <>\r\n                        <div className=\"name item\">{name}</div>\r\n                        <ItemContext info={info as ItemDefinition} />\r\n                    </>\r\n                );\r\n            }\r\n        }\r\n    }\r\n\r\n    return (\r\n        <Tooltip referenceRect={selectedContext.referenceRect}>\r\n            <div className = \"context-tooltip\">\r\n                {renderContent()}\r\n            </div>\r\n        </Tooltip>\r\n    )\r\n}\r\nexport default ContextTooltip;\r\n","import itemsDescription from \"definitions/items\";\r\nimport { Item } from \"definitions/items/types\";\r\nimport * as React from \"react\";\r\nimport { TextManager } from \"global/TextManager\";\r\nimport \"components/ui/css/common/icon.css\";\r\nimport \"./css/itemsbox.css\";\r\n\r\nexport interface Props {\r\n    className?: string;\r\n    items: Item[];\r\n}\r\n\r\nexport interface StateProps {\r\n    itemsInInventory?: Item[]; // Items that are in `items` array and also in inventory\r\n}\r\n\r\ntype AllProps = Props & StateProps;\r\n\r\n/**\r\n * The ItemsBox displays a list of items, to be used as requirements for something\r\n */\r\nconst ItemsBox = (props: AllProps) => {\r\n    const { itemsInInventory } = props;\r\n    const className = (props.className || \"\") + \" itemsbox\";\r\n    const aggregate = props.items.reduce((accumulator: object, current: Item) => {\r\n        if (!accumulator[current]) {\r\n            accumulator[current] = 0;\r\n        }\r\n        accumulator[current]++;\r\n        return accumulator;\r\n    }, {});\r\n\r\n    const listItems = Object.keys(aggregate).map((key: string) => {\r\n        const item = key as Item;\r\n        const amount = aggregate[key] as number;\r\n        let listItemClass = \"item\";\r\n\r\n        // Check if we have enough\r\n        const amountInInventory = itemsInInventory ? itemsInInventory.filter((i) => i === item).length : 0;\r\n        if (amount > amountInInventory) {\r\n            listItemClass += \" missing\";\r\n        }\r\n        const itemDescription = itemsDescription[item];\r\n        return <li className={listItemClass} key={item}>\r\n            <div \r\n                className=\"icon common-icon-smallest\" \r\n                style={{ backgroundImage: `url(${process.env.PUBLIC_URL}${itemDescription.iconImg})`}}\r\n            ></div>\r\n            <div className=\"name\">\r\n                { `${TextManager.getItemName(item)} (${ amount })` }\r\n            </div>\r\n        </li>;\r\n    });\r\n\r\n    return (\r\n        <ul className={className} >\r\n            {listItems}\r\n        </ul>\r\n    );\r\n};\r\n\r\nexport default ItemsBox;\r\n","import ItemsBox, { Props, StateProps } from \"components/ui/items/ItemsBox\";\r\nimport { Item } from \"definitions/items/types\";\r\nimport { connect } from \"react-redux\";\r\nimport { StoreState } from \"stores\";\r\n\r\nconst mapStateToProps = (store: StoreState, ownProps: Props): StateProps => {\r\n    const itemsInInventory: Item[] = [];\r\n    const tmpWarehouse = [ ...store.stockpile];\r\n    ownProps.items.forEach((item: Item) => {\r\n        const found = tmpWarehouse.findIndex((i) => i === item);\r\n        if (found > -1) {\r\n            // Remove the item from tmpWarehouse and add to itemsInInventory\r\n            const [ removed ] = tmpWarehouse.splice(found, 1);\r\n            if (removed) {\r\n                itemsInInventory.push(removed);\r\n            }\r\n        }\r\n    });\r\n    return {\r\n        itemsInInventory,\r\n    };\r\n};\r\n\r\nexport default connect<StateProps, null, Props, StoreState>(mapStateToProps)(ItemsBox);\r\n","export const MAX_WORKERS_CRAFTING = 6;\n\n/**\n * Calculates the production time for productionDefinition with given amount of workers\n * @param productionDefinition\n * @param workers\n */\nexport const calculateProductionTime = (time: number, workers: number): number => {\n    if (workers > MAX_WORKERS_CRAFTING) {\n        throw new Error(`Cannot possibly have more than ${MAX_WORKERS_CRAFTING} on one item!`);\n    }\n    // Each additional worker shaves off 10% of the production time\n    return time - (.1 * time * (workers - 1));\n};\n","import * as React from \"react\";\r\nimport \"./css/progressbar.css\";\r\n\r\nexport interface Props {\r\n    progress?: number;     // between 0 and 1\r\n    label?: string;\r\n}\r\n\r\nconst Progressbar = (props: Props) => {\r\n    const progress: number = clamp(props.progress || 0, 0, 1);\r\n\r\n    return (\r\n        <div className=\"progressbar\">\r\n            <div className=\"progressbar-label\">{props.label}</div>\r\n            <div className=\"progressbar-bar\" style= {{width: `${progress * 100}%`}}></div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default Progressbar;\r\n\r\nfunction clamp(val: number, min: number, max: number): number {\r\n    return val > max ? max : val < min ? min : val;\r\n}\r\n","// Todo: come up with a less retarded name\r\nimport * as React from \"react\";\r\nimport \"./css/updownvalue.css\";\r\n\r\nexport interface DispatchProps {\r\n    onUp?: (e: React.MouseEvent) => void;\r\n    onDown?: (e: React.MouseEvent) => void;\r\n}\r\nexport interface Props extends DispatchProps {\r\n    label?: string;\r\n    value?: number;\r\n    max?: number;\r\n    upDisabled?: boolean;\r\n    downDisabled?: boolean;\r\n}\r\n\r\nconst UpDownValue = (props: Props) => {\r\n    const handleUp = (e: React.MouseEvent) => {\r\n        if (props.onUp && !props.upDisabled) { props.onUp(e); }\r\n    };\r\n\r\n    const handleDown = (e: React.MouseEvent) => {\r\n        if (props.onDown && !props.downDisabled) { props.onDown(e); }\r\n    };\r\n\r\n    let displayValue;\r\n    if (props.max == null) {\r\n        displayValue = props.value;\r\n    } else {\r\n        displayValue = <span>\r\n            { props.value } / <span className=\"max\">{ props.max }</span>\r\n        </span>;\r\n    }\r\n    return (\r\n        <div className=\"updownvalue\">\r\n            <label> { props.label }</label>\r\n            { displayValue }\r\n            <i className= { \"arrow up\" + (props.upDisabled ? \" disabled\" : \"\" )}\r\n                onClick= { handleUp }\r\n            />\r\n            <i className={\"arrow down\" + (props.downDisabled ? \" disabled\" : \"\")}\r\n                onClick= { handleDown }\r\n            />\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default UpDownValue;\r\n","import React from \"react\";\r\nimport { Structure } from 'definitions/structures';\r\nimport \"./styles/structureViewHeader.scss\";\r\n\r\ninterface Props {\r\n    structure: Structure;\r\n}\r\n\r\nconst StructureViewHeader = (props: Props) => {\r\n    // const displayName = TextManager.getStructureName(props.structure);\r\n    return (\r\n        <div className={`structureview-header structureview-header-${props.structure}`}>\r\n            {/* <h1 className=\"app-h1-white\">{displayName}</h1> */}\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default StructureViewHeader;","import { Resource } from \"definitions/resources\";\r\nimport resourceDescriptions from \"definitions/resources\";\r\nimport * as React from \"react\";\r\nimport { ResourceStoreState } from \"stores/resources\";\r\nimport { TextManager } from \"global/TextManager\";\r\nimport \"./css/resourcesbox.css\";\r\nimport { useMemo } from 'react';\r\nimport useResources from 'hooks/store/useResources';\r\n\r\nexport interface Props {\r\n    className?: string;\r\n    resources: ResourceStoreState;\r\n}\r\n\r\nexport interface StateProps {\r\n    sufficientResources?: Record<Resource, boolean>;\r\n}\r\n\r\ntype AllProps = Props & StateProps;\r\n\r\n/**\r\n * The ResourcesBox displays a list of resources\r\n */\r\nconst ResourcesCostBox = (props: AllProps) => {\r\n    const {\r\n        resources,\r\n    } = props;\r\n\r\n    const storeResources = useResources();\r\n    const sufficientResources = useMemo(() => {\r\n        return Object.keys(resources).reduce((acc, value) => {\r\n            acc[value] = storeResources[value] >= resources[value];\r\n            return acc;\r\n        }, {});\r\n    }, [resources, storeResources]);\r\n\r\n\r\n    const className = (props.className || \"\") + \" resourcesbox\";\r\n    const listItems = Object.keys(props.resources).map((resource: string) => {\r\n        let listItemClass = \"resource\";\r\n        if (sufficientResources && !sufficientResources[resource]) {\r\n             listItemClass += \" insufficient\";\r\n        }\r\n        const resourceDescription = resourceDescriptions[resource];\r\n        if (!resourceDescription) {\r\n            throw new Error(`No resource description found for ${resource}`);\r\n        }\r\n\r\n        return <li className = { listItemClass } key = { resource }>\r\n            <div\r\n                className=\"icon\"\r\n                style={{backgroundImage: `url(${process.env.PUBLIC_URL}${resourceDescription.iconImg})`}}\r\n            />\r\n            <div className=\"name\">\r\n                {TextManager.getResourceName(resource as Resource)}\r\n            </div>\r\n            <div className=\"amount\" >\r\n                { props.resources[resource] }\r\n            </div>\r\n        </li>;\r\n    });\r\n\r\n    return (\r\n        <ul className={className}>\r\n            {listItems}\r\n        </ul>\r\n    );\r\n};\r\n\r\nexport default ResourcesCostBox;\r\n","import * as React from \"react\";\r\nimport { useState } from 'react';\r\nimport MaterialsCostBox from \"containers/ui/context/items/ItemsCostBox\";\r\nimport itemDefinitions from \"definitions/items\";\r\nimport { Item, ItemDefinition } from \"definitions/items/types\";\r\nimport { ProductionDefinition } from \"definitions/production/types\";\r\nimport { getDefinition, Structure } from \"definitions/structures\";\r\nimport { ProductionStructureDefinition, ProductionStructureLevelDefinition } from \"definitions/structures/types\";\r\nimport { calculateProductionTime, MAX_WORKERS_CRAFTING } from \"mechanics/crafting\";\r\nimport { ResourceStoreState } from \"stores/resources\";\r\nimport { TaskStoreState } from \"stores/task\";\r\nimport { TextManager } from \"global/TextManager\";\r\nimport { formatDuration } from \"utils/time\";\r\nimport ItemIcon from \"../ui/ItemIcon\";\r\nimport Progressbar from \"../ui/Progressbar\";\r\nimport UpDownValue from \"../ui/UpDownValue\";\r\nimport StructureViewHeader from './StructureViewHeader';\r\nimport ResourcesCostBox from 'components/ui/resources/ResourcesCostBox';\r\nimport \"./styles/productionStructureView.scss\";\r\n\r\nexport interface DispatchProps {\r\n    onUpgrade?: (cost: number, level: number) => void;\r\n    onCraft?: (productionDefinition: ProductionDefinition, workers: number) => void;\r\n}\r\n\r\nexport interface StateProps {\r\n    resources: ResourceStoreState;\r\n    items: (Item | null)[];  // items in inventory\r\n    level: number;\r\n    workersFree: number;\r\n    gold: number;\r\n    tasks: TaskStoreState[];\r\n}\r\n\r\nexport interface Props {\r\n    type: Structure;\r\n}\r\n\r\ntype AllProps = Props & StateProps & DispatchProps;\r\n\r\nconst ProductionStructureView = (props: AllProps) => {\r\n\r\n    const [selectedItem, setSelectedItem] = useState<Item>();\r\n    const [workersAssigned, setWorkersAssigned] = useState<number>(0);\r\n\r\n    const structureDefinition = getDefinition<ProductionStructureDefinition>(props.type);\r\n    if (!structureDefinition) {\r\n        throw new Error(`No definition found for structure ${props.type}\r\n            with type ProductionStructureDefinition.`);\r\n    }\r\n    const level: number =   props.level || 0;\r\n    const levelDefinition: ProductionStructureLevelDefinition = structureDefinition.levels[level];\r\n    const displayName = TextManager.getStructureName(props.type);\r\n\r\n    const createUpgradeRow = () => {\r\n        const gold = props.gold;\r\n        const nextLevel = structureDefinition.levels[level + 1];\r\n        const nextLevelCost = (nextLevel != null ? nextLevel.cost.gold || 0 : -1);\r\n        const canUpgrade = nextLevel != null && gold >= nextLevelCost;\r\n        const upgradeText = `Upgrade! (${nextLevelCost < 0 ? \"max\" : nextLevelCost + \" gold\"})`;\r\n\r\n        const handleClick = (event: React.MouseEvent<HTMLButtonElement>) => {\r\n            if (props.onUpgrade) { props.onUpgrade(nextLevelCost, level + 1); }\r\n        };\r\n        return (\r\n            <div>\r\n                <label>level:</label>{ `${(level + 1)} / ${structureDefinition.levels.length}` }\r\n                <button\r\n                    style={{float: \"right\"}}\r\n                    onClick={handleClick}\r\n                    disabled={!canUpgrade}>\r\n                        { upgradeText }\r\n                </button>\r\n            </div>\r\n        );\r\n    };\r\n\r\n    const createCraftTabs = () => {\r\n\r\n        return levelDefinition.produces.map((produces) => {\r\n            const handleSelectCraftingItem = (e: React.MouseEvent) => {\r\n                e.stopPropagation();\r\n\r\n                setSelectedItem(produces.item);\r\n            };\r\n\r\n            return (\r\n                <li\r\n                    key={`craft${produces.item}`}\r\n                    onClick={handleSelectCraftingItem}\r\n                    className={selectedItem === produces.item ? \"selected\" : \"\"}\r\n                >\r\n                    <ItemIcon item={produces.item} />\r\n                    { TextManager.getItemName(produces.item) }\r\n                </li>\r\n            );\r\n        });\r\n    };\r\n\r\n    const createCraftingDetails = () => {\r\n        const item = selectedItem;\r\n        if (!item) { return null; }\r\n\r\n        const produces = levelDefinition.produces.find((p) => p.item === item)!;\r\n        const playerResources = props.resources || {};\r\n        const costResources = produces.cost.resources!;\r\n        const missingAtLeastOneResource = Object.keys(costResources)\r\n            .some((resource) => costResources[resource] > playerResources[resource]);\r\n\r\n        let missingAtLeastOneItem = false;\r\n        const costMaterials = produces.cost.materials;\r\n        if (costMaterials) {\r\n            missingAtLeastOneItem = costMaterials\r\n                .some((i: Item) => props.items.indexOf(i) === -1);\r\n        }\r\n\r\n        const disabled = missingAtLeastOneResource || missingAtLeastOneItem || workersAssigned < 1;\r\n        // TODO: [10/07/2019] Perhaps each item can have a number of minimum workers?\r\n\r\n        const itemDefinition: ItemDefinition = itemDefinitions[item];\r\n\r\n        const makeTimeString = (time: number): string => {\r\n            if (workersAssigned === 0) {\r\n                return \"\";\r\n            }\r\n            const craftingTime = calculateProductionTime(time, workersAssigned);\r\n            const formatted = formatDuration(craftingTime);\r\n            return ` Crafting time: ${formatted}`;\r\n        };\r\n\r\n        const handleClick = (e: React.MouseEvent) => {\r\n            e.stopPropagation();\r\n\r\n            if (props.onCraft) {\r\n                props.onCraft(produces, workersAssigned);\r\n                setWorkersAssigned(0);\r\n            }\r\n        };\r\n\r\n        const handleUp = (e: React.MouseEvent) => {\r\n            e.stopPropagation();\r\n            setWorkersAssigned(workersAssigned + 1);\r\n        };\r\n\r\n        const handleDown = (e: React.MouseEvent) => {\r\n            e.stopPropagation();\r\n            setWorkersAssigned(workersAssigned - 1);\r\n        };\r\n\r\n        return (\r\n            <div className=\"crafting-details\">\r\n                Craft a { TextManager.getItemName(itemDefinition.item) }\r\n                <div className=\"crafting-costs\">\r\n                    <fieldset>\r\n                        <ResourcesCostBox resources={costResources} />\r\n                    </fieldset>\r\n                    <fieldset>\r\n                        {costMaterials && <MaterialsCostBox items={costMaterials} />}\r\n                    </fieldset>\r\n                </div>\r\n                <div style={{display: \"flex\"}}>\r\n                    <UpDownValue\r\n                        value={workersAssigned}\r\n                        label={\"Workers: \"}\r\n                        onUp={handleUp}\r\n                        onDown={handleDown}\r\n                        upDisabled={\r\n                            workersAssigned >= props.workersFree ||\r\n                            workersAssigned >= MAX_WORKERS_CRAFTING\r\n                        }\r\n                        downDisabled={ workersAssigned < 1 }\r\n                    />\r\n                    &nbsp;\r\n                    { makeTimeString(produces.cost.time || 0) }\r\n                </div>\r\n                <div>\r\n                    <button\r\n                        disabled={disabled }\r\n                        onClick={handleClick }>\r\n                        Craft\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        );\r\n    };\r\n\r\n    const createProgressbars = () => {\r\n        const tasks = props.tasks || [];\r\n        return tasks.map((t) => (\r\n            <Progressbar\r\n                key={`${t.name}${t.startTime}`}\r\n                label={`${t.name} (${formatDuration(t.timeRemaining)})`}\r\n                progress={t.progress}\r\n            />\r\n        ));\r\n    };\r\n\r\n    return (\r\n        // TODO: abstract some stuff to generic StructureView\r\n        <>\r\n            <StructureViewHeader structure={props.type} />\r\n\r\n            <details open={true } className = \"productionstructureview\">\r\n                <summary>{displayName}</summary>\r\n                <section>\r\n                    { createUpgradeRow() }\r\n                    <div>craft:</div>\r\n                    {/* { createCraftRows() } */}\r\n                    <div className=\"crafting-area\">\r\n                        <ul className=\"vertical-tab-bar\">\r\n                            {createCraftTabs()}\r\n                        </ul>\r\n                        {createCraftingDetails()}\r\n                    </div>\r\n                    <fieldset>\r\n                        <legend>Currently crafting:</legend>\r\n                        {createProgressbars()}\r\n                    </fieldset>\r\n                </section>\r\n            </details>\r\n        </>\r\n    );\r\n}\r\n\r\nexport default ProductionStructureView;\r\n","import ProductionStructureView,\r\n    { DispatchProps, Props, StateProps } from \"../../components/structures/ProductionStructureView\";\r\n\r\nimport { subtractGold } from \"actions/gold\";\r\nimport { addItemToWarehouse } from \"actions/items\";\r\nimport { addLogText } from \"actions/log\";\r\nimport { removeResources } from \"actions/resources\";\r\nimport { decreaseWorkers, increaseWorkers, upgradeStructure } from \"actions/structures\";\r\nimport { startTask } from \"actions/tasks\";\r\nimport { ProductionDefinition } from \"definitions/production/types\";\r\nimport { calculateProductionTime } from \"mechanics/crafting\";\r\nimport { connect } from \"react-redux\";\r\nimport { AnyAction, Dispatch } from \"redux\";\r\nimport { selectFreeWorkers } from \"selectors/workers\";\r\nimport { LogChannel } from \"stores/logEntry\";\r\nimport { TaskType } from \"stores/task\";\r\nimport { StoreState } from \"../../stores\";\r\nimport { StructureStoreState } from \"../../stores/structure\";\r\n\r\nfunction mapStateToProps(store: StoreState, ownProps: Props): StateProps {\r\n    const structureStore: StructureStoreState = store.structures[ownProps.type];\r\n\r\n    const tasks = store.tasks.running.filter((val) => val.origin === `${ownProps.type}.craft`);\r\n    return {\r\n        gold: store.gold,\r\n        items: store.stockpile,\r\n        level: structureStore.level,\r\n        resources: store.resources,\r\n        tasks,\r\n        workersFree: selectFreeWorkers(store),\r\n    };\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch: Dispatch<AnyAction>, ownProps: Props): DispatchProps {\r\n    return {\r\n        onCraft: (productionDefinition: ProductionDefinition, workers: number) => {\r\n            const craftingTime = calculateProductionTime(productionDefinition.cost.time || 0, workers);\r\n            dispatch(removeResources(productionDefinition.cost.resources || {}));\r\n            dispatch(increaseWorkers(ownProps.type, workers));\r\n\r\n            const callbacks = [\r\n                addItemToWarehouse(productionDefinition.item),\r\n                decreaseWorkers(ownProps.type, workers),\r\n            ];\r\n            const start = startTask(TaskType.craftItem,\r\n                productionDefinition.item,\r\n                `${ownProps.type}.craft`,\r\n                craftingTime,\r\n                callbacks);\r\n            dispatch(start);\r\n        },\r\n        onUpgrade: (cost: number, level: number) => {\r\n            dispatch(subtractGold(cost));\r\n            dispatch(upgradeStructure(ownProps.type)); // TODO: [07/07/2019] time to upgarde??\r\n\r\n            level++;\r\n            dispatch(addLogText(\"log-town-upgrade-structure-complete\", {\r\n                level,\r\n                structure: ownProps.type,\r\n            }, LogChannel.town));\r\n        },\r\n    };\r\n}\r\n\r\nexport default connect<StateProps, DispatchProps, Props, StoreState>(mapStateToProps, mapDispatchToProps)(ProductionStructureView);\r\n","import { useDispatch } from 'react-redux';\r\nimport { subtractGold } from 'actions/gold';\r\nimport { upgradeStructure } from 'actions/structures';\r\nimport { Structure } from 'definitions/structures';\r\nimport { addLogText } from 'actions/log';\r\nimport { LogChannel } from 'stores/logEntry';\r\n\r\n\r\nconst useStructureActions = () => {\r\n    const dispatch = useDispatch();\r\n\r\n    const startUpgradeStructure = (cost: number, level: number, structure: Structure) => {\r\n        dispatch(subtractGold(cost));\r\n        dispatch(upgradeStructure(structure)); // Todo: [07/07/2019] time??\r\n\r\n        dispatch(addLogText(\"log-town-upgrade-structure-complete\", {\r\n            level,\r\n            structure,\r\n        }, LogChannel.town));\r\n    }\r\n\r\n    return {\r\n        startUpgradeStructure\r\n    }\r\n}\r\n\r\nexport default useStructureActions;","import { getDefinition, Structure  } from \"definitions/structures\";\r\nimport { ResourceStructureDefinition, ResourceStructureLevelDefinition } from \"definitions/structures/types\";\r\nimport * as React from \"react\";\r\nimport UpDownValue from \"../ui/UpDownValue\";\r\nimport { StructureStoreState } from 'stores/structure';\r\nimport { useSelector, useDispatch } from 'react-redux';\r\nimport { StoreState } from 'stores';\r\nimport { selectFreeWorkers } from 'selectors/workers';\r\nimport { decreaseWorkers, increaseWorkers } from 'actions/structures';\r\nimport StructureViewHeader from './StructureViewHeader';\r\nimport useStructureActions from 'hooks/actions/useStructureActions';\r\n\r\n\r\nexport interface Props  {\r\n    type: Structure;\r\n}\r\n\r\nconst ResourceStructureView = (props: Props) => {\r\n\r\n    // Fetch needed values from store\r\n    const gold = useSelector<StoreState, number>((store) => store.gold);\r\n    const level = useSelector<StoreState, number>((store) => {\r\n        const structureStore: StructureStoreState = store.structures[props.type];\r\n        if (!structureStore) { throw new Error(`No structure '${props.type}' found in the store!`); }\r\n        return structureStore.level;\r\n    });\r\n    const workers = useSelector<StoreState, number>((store) => {\r\n        const structureStore: StructureStoreState = store.structures[props.type];\r\n        if (!structureStore) { throw new Error(`No structure '${props.type}' found in the store!`); }\r\n        return structureStore.workers;\r\n    });\r\n    const workersFree = useSelector<StoreState, number>((store) => selectFreeWorkers(store));\r\n\r\n    const structureDefinition = getDefinition<ResourceStructureDefinition>(props.type);\r\n    if (!structureDefinition) {\r\n        throw new Error(`No definition found for structure ${props.type} with type ResourceStructureDefinition.`);\r\n    }\r\n    const {startUpgradeStructure} = useStructureActions();\r\n\r\n    // Reducer dispatch\r\n    const dispatch = useDispatch();\r\n\r\n    const handleWorkersDown = () => {\r\n        dispatch(decreaseWorkers(props.type));\r\n    }\r\n\r\n    const handleWorkersUp = () => {\r\n        dispatch(increaseWorkers(props.type));\r\n    };\r\n\r\n    const levelDefinition: ResourceStructureLevelDefinition = structureDefinition.levels[level];\r\n\r\n    const createWorkersRow = () => {\r\n        const upDisabled = workers === levelDefinition.workerCapacity || (workersFree || 0) < 1;\r\n        const downDisabled = workers === 0;\r\n        return <UpDownValue\r\n            label=\"workers:\"\r\n            value={workers}\r\n            max={levelDefinition.workerCapacity}\r\n            upDisabled={upDisabled}\r\n            downDisabled={downDisabled}\r\n            onDown={handleWorkersDown}\r\n            onUp={handleWorkersUp}\r\n        />;\r\n    };\r\n\r\n    const createUpgradeRow = () => {\r\n        const nextLevel = structureDefinition.levels[level + 1];\r\n        const nextLevelCost = (nextLevel != null ? nextLevel.cost.gold || 0 : -1);\r\n        const canUpgrade = nextLevel != null && gold >= nextLevelCost;\r\n        const upgradeText = `Upgrade! (${nextLevelCost < 0 ? \"max\" : nextLevelCost + \" gold\"})`;\r\n\r\n        const handleClick = () => {\r\n            startUpgradeStructure(nextLevelCost, level + 1, props.type);\r\n        };\r\n\r\n        return <div>\r\n            <label>level:</label>{(level + 1) + \" / \" + structureDefinition.levels.length }\r\n            <button\r\n                style={{float: \"right\"}}\r\n                onClick={handleClick }\r\n                disabled= {!canUpgrade } >\r\n                    {upgradeText }\r\n            </button>\r\n        </div>;\r\n    };\r\n\r\n    const createGeneratesRow = () => {\r\n        const generates = levelDefinition.generates;\r\n        const generatesText = Object.keys(generates).reduce((accumulator: string[], value: string) => {\r\n            // For values that are not 0\r\n            if (generates[value]) {\r\n                // tslint:disable-next-line:max-line-length\r\n                accumulator.push(`${generates[value]} x ${workers} = ${generates[value] * (workers || 0)} ${value}`);\r\n            }\r\n            return accumulator;\r\n        }, []).join(\",\");\r\n        return <div>\r\n            {\"Generates (every minute): \" }\r\n            <br/>\r\n            {generatesText }\r\n        </div>;\r\n    };\r\n\r\n    return (\r\n        <>\r\n            <StructureViewHeader structure={props.type} />\r\n            <details open={true} className=\"structureview\">\r\n                <section>\r\n                    {createWorkersRow() }\r\n                    {createUpgradeRow() }\r\n                    {createGeneratesRow() }\r\n                </section>\r\n            </details>\r\n        </>\r\n    );\r\n};\r\n\r\nexport default ResourceStructureView;\r\n","import { DragSourceType, DragType } from \"constants/dragging\";\r\nimport * as React from \"react\";\r\nimport { ConnectDragSource, DragSource, DragSourceConnector, DragSourceMonitor, DragSourceSpec } from \"react-dnd\";\r\nimport { AdventurerStoreState } from \"stores/adventurer\";\r\nimport AdventurerAvatar, { Props as AdventurerAvatarProps } from \"./AdventurerAvatar\";\r\nimport \"./css/draggableadventureravatar.css\";\r\n\r\nexport interface Props {\r\n    sourceId?: string;\r\n    onClick?: () => void;\r\n    disabled?: boolean;\r\n}\r\n\r\ninterface CollectedProps {\r\n    isDragging: boolean;\r\n    connectDragSource: ConnectDragSource;\r\n}\r\n\r\nexport interface AdventurerAvatarDragInfo {\r\n    adventurer: AdventurerStoreState;\r\n    sourceId?: string;\r\n}\r\n\r\n/**\r\n * Specifies the drag source contract.\r\n * Only `beginDrag` function is required.\r\n */\r\nconst spec: DragSourceSpec<Props & AdventurerAvatarProps, AdventurerAvatarDragInfo> = {\r\n    beginDrag(props: Props & AdventurerAvatarProps) {\r\n        // Return the data describing the dragged item\r\n        return {\r\n            adventurer: props.adventurer,\r\n            sourceId: props.sourceId,\r\n            sourceType: DragSourceType.adventurerInventory,\r\n        };\r\n    },\r\n};\r\n\r\n/**\r\n * Specifies which props to inject into your component.\r\n */\r\nfunction collect(connect: DragSourceConnector, monitor: DragSourceMonitor) {\r\n    return {\r\n        connectDragSource: connect.dragSource(),\r\n        isDragging: monitor.isDragging(),\r\n    };\r\n}\r\n\r\nconst DraggableAdventurerAvatar = (props: Props & CollectedProps & AdventurerAvatarProps) => {\r\n\r\n    const { isDragging, connectDragSource, disabled } = props;\r\n    let className = \"draggable-adventurer-avatar\";\r\n    if (disabled) {\r\n        className += \" disabled\";\r\n    }\r\n    if (isDragging) {\r\n        className += \" dragging\";\r\n    }\r\n\r\n    /*if (isDragging) {\r\n        // TODO: can show some sort of empty state?\r\n        return null;\r\n    }*/\r\n    return connectDragSource(\r\n        <div className = { className }>\r\n            <AdventurerAvatar\r\n                // Copy all props down to AdventurerAvatar\r\n                { ...props }\r\n            />\r\n        </div>,\r\n    );\r\n}\r\n\r\nexport default DragSource<Props & AdventurerAvatarProps, CollectedProps>(DragType.ADVENTURER, spec, collect)(DraggableAdventurerAvatar);\r\n","// tslint:disable: object-literal-sort-keys\r\nimport {ContextInfo, ContextType} from \"constants/context\";\r\nimport CombatView from \"containers/combat/CombatView\";\r\nimport {AppContextProps} from \"hoc/withAppContext\";\r\nimport * as React from \"react\";\r\nimport {useRef, useState, createContext, useEffect } from \"react\";\r\nimport {DndProvider } from \"react-dnd\";\r\nimport {HTML5Backend } from 'react-dnd-html5-backend';\r\nimport {Link, Redirect, Route, Switch, HashRouter} from \"react-router-dom\";\r\nimport {Persistor} from \"redux-persist\";\r\nimport {PixiPlugin } from 'gsap/all';\r\nimport {gsap } from 'gsap';\r\nimport {Sound, SoundManager} from \"global/SoundManager\";\r\nimport {TextManager} from \"global/TextManager\";\r\nimport {Structure} from \"definitions/structures\";\r\nimport debounce from \"debounce\";\r\nimport Preloader, {MediaItem, MediaType} from \"../preloading/Preloader\";\r\nimport TownView from 'components/town/TownView';\r\nimport Toasts from 'components/ui/toasts/Toasts';\r\nimport Topbar from 'components/ui/topbar/Topbar';\r\nimport WorldView from 'components/world/WorldView';\r\nimport SimpleLog from 'components/log/SimpleLog';\r\nimport ContextTooltip from 'components/ui/tooltip/ContextTooltip';\r\nimport {TooltipManager } from 'global/TooltipManager';\r\nimport {getWorldLink, getTownLink } from 'utils/routing';\r\nimport localforage from 'localforage';\r\nimport StructureDetailsView from 'components/StructureDetailsView';\r\nimport Background from 'components/Background';\r\nimport {manifest} from \"./manifest/app\";\r\nimport \"./styles/app.scss\";\r\n\r\nPixiPlugin.registerPIXI(PIXI);\r\ngsap.registerPlugin(PixiPlugin);\r\n\r\n\r\n// tslint:disable-next-line:no-empty-interface\r\nexport interface StateProps {\r\n}\r\n\r\n// tslint:disable-next-line:no-empty-interface\r\nexport interface DispatchProps {\r\n}\r\n\r\nexport enum View {\r\n    Town,\r\n    World,\r\n}\r\n\r\nexport interface Props {\r\n    persistor: Persistor;\r\n}\r\n\r\ninterface SelectedContext {\r\n    contextType: ContextType ;\r\n    contextInfo: ContextInfo;\r\n    contextRect: ClientRect;\r\n}\r\n\r\nexport const MAX_WIDTH = 960;\r\n\r\nexport const AppContext = createContext<AppContextProps | null>(null);\r\ntype AllProps = Props & StateProps & DispatchProps;\r\n\r\n\r\nconst App = (props: AllProps) => {\r\n    const containerRef = useRef<HTMLDivElement>(null);\r\n\r\n    const [media, setMedia] = useState<MediaItem[]>([]);\r\n    const [activeWindows, setActiveWindows] = useState<React.ReactElement[]>([]);\r\n\r\n    const handleViewButtonClick = () => {\r\n        SoundManager.playSound(Sound.buttonClick);\r\n    };\r\n\r\n    const handleResetClick = () => {\r\n        props.persistor.purge();\r\n        localforage.clear();\r\n        // todo: go to root\r\n        (window as any).location.reload();\r\n    };\r\n\r\n    const selectStructure = (structure: Structure | null) => {\r\n        if (structure) {\r\n            const displayName = TextManager.getStructureName(structure);\r\n\r\n            const window = <StructureDetailsView structure={structure} title={displayName}/>;\r\n            handleWindowOpened(window);\r\n\r\n            SoundManager.playSound(Sound.buttonClick);\r\n       }\r\n    };\r\n\r\n    const renderTownView = () => <TownView onStructureClick={selectStructure} />;\r\n    const renderWorldView = () => <WorldView />;\r\n\r\n    const handleWindowOpened = (window: React.ReactElement) => {\r\n        setActiveWindows([\r\n            ...activeWindows || [],\r\n            window,\r\n        ]);\r\n    };\r\n\r\n    /**\r\n     * Closes all windows\r\n     */\r\n    const handleWindowClose = () => {\r\n        setActiveWindows([]);\r\n    };\r\n\r\n    /**\r\n     * Closes the top window of the stack\r\n     */\r\n    const handleWindowBack = () => {\r\n        if (activeWindows && activeWindows.length) {\r\n            setActiveWindows(activeWindows.slice(0, -1));\r\n        }\r\n    };\r\n\r\n    const renderWindow = (): React.ReactElement | null => {\r\n        if (!activeWindows.length) {\r\n            return null;\r\n        }\r\n\r\n        const topWindow = activeWindows[activeWindows.length - 1];\r\n        const commonWindowProps = {\r\n            onClose: handleWindowClose,\r\n            onBack: handleWindowBack,\r\n            backEnabled: activeWindows.length > 1,\r\n            closeEnabled: true,\r\n        };\r\n\r\n        const element = React.cloneElement(topWindow, commonWindowProps);\r\n        return element;\r\n    };\r\n\r\n    const handleMediaLoadComplete = (mediaItems: MediaItem[]) => {\r\n        const sounds = mediaItems.filter((m) => m.mediaType === MediaType.sound);\r\n        SoundManager.loadMedia(sounds);\r\n\r\n        // todo: refactor manifest stuff\r\n        SoundManager.addSounds({\r\n            [Sound.buttonClick]: \"sound/fx/button-click.ogg\",\r\n            [Sound.error]: \"sound/fx/error.ogg\",\r\n            [Sound.toast]: \"sound/fx/toast.ogg\"\r\n            // add more sounds here\r\n        });\r\n\r\n        setMedia(mediaItems);\r\n\r\n        // todo: temporary!\r\n        // const window = <CombatView/>;\r\n        // handleWindowOpened(window);\r\n    };\r\n\r\n    const handleAppClick = () => {\r\n        TooltipManager.clear();\r\n    };\r\n\r\n    useEffect(() => {\r\n        const handleScroll = debounce(() => {\r\n            TooltipManager.clear();\r\n        }, 100);\r\n        window.addEventListener(\"scroll\", handleScroll);\r\n        window.addEventListener(\"wheel\", handleScroll);\r\n        return () => {\r\n            window.removeEventListener(\"resize\", handleScroll);\r\n            window.removeEventListener(\"wheel\", handleScroll);\r\n        };\r\n    }, []);\r\n    // const handleResize = () => {\r\n    //     if (containerRef.current) {\r\n    //         if (window.innerHeight < resolution.height) {\r\n    //            // containerRef.current.style.transform = `scale(${Math.min(window.innerWidth / resolution.width, 1)}) translateX(-50%)`;\r\n    //         } else {\r\n    //             //containerRef.current.style.transform = `scale(1) translateX(-50%)`;\r\n    //         }\r\n    //         //const parentBox = containerRef.current.getBoundingClientRect();\r\n    //         //setContainerRect(parentBox);\r\n    //    }\r\n    // };\r\n\r\n    // useEffect(() => {\r\n    //     // todo: see if we can disable this;\r\n    //     window.addEventListener(\"resize\", handleResize);\r\n    //     handleResize();\r\n    //     return () => {\r\n    //         window.removeEventListener(\"resize\", handleResize);\r\n    //     };\r\n    // }, []);\r\n\r\n    return (\r\n        <AppContext.Provider value={{\r\n            media,\r\n            onOpenWindow: handleWindowOpened,\r\n            onCloseWindow: handleWindowClose,\r\n        }} >\r\n            <Background />\r\n            <div\r\n                className=\"app\"\r\n                ref={containerRef}\r\n                style={{\r\n                    maxWidth: MAX_WIDTH\r\n                }}\r\n                onClick={handleAppClick}\r\n            >\r\n                <DndProvider backend={HTML5Backend}>\r\n                <HashRouter>\r\n                    <Preloader\r\n                        manifest={manifest}\r\n                        onLoadComplete={handleMediaLoadComplete}\r\n                    >\r\n                        <Topbar/>\r\n                        <div>\r\n                            <Switch>\r\n                                <Route path=\"/\" exact={true} >\r\n                                    <Redirect from=\"/\" to={getWorldLink()} />\r\n                                </Route>\r\n                                <Route path={getWorldLink()}>\r\n                                    <Link to={getTownLink()}>\r\n                                        <button onClick={() => handleViewButtonClick()}> {TextManager.get(`ui-view-button-town`)} </button>\r\n                                    </Link>\r\n                                </Route>\r\n                                <Route path={getTownLink()}>\r\n                                    <Link to={getWorldLink()}>\r\n                                        <button onClick={() => handleViewButtonClick()}> {TextManager.get(`ui-view-button-world`)} </button>\r\n                                    </Link>\r\n                                </Route>\r\n                            </Switch>\r\n                            {` | `}\r\n                            <button onClick={() => handleResetClick()} style={{color: \"red\"}}> Restart! </button>\r\n                        </div>\r\n                        <Switch>\r\n                            <Route path={getTownLink()} render={renderTownView} />\r\n                            <Route path={getWorldLink()} render={renderWorldView} />\r\n                        </Switch>\r\n                        <SimpleLog/>\r\n                        {renderWindow()}\r\n                        <ContextTooltip />\r\n                        <Toasts />\r\n                    </Preloader>\r\n                </HashRouter>\r\n                </DndProvider>\r\n            </div>\r\n        </AppContext.Provider>\r\n    );\r\n};\r\n\r\nexport default App;\r\n","import { DragType } from \"constants/dragging\";\r\nimport * as React from \"react\";\r\nimport { ConnectDropTarget, DropTarget, DropTargetConnector, DropTargetMonitor, DropTargetSpec } from \"react-dnd\";\r\nimport \"./css/droppableadventurerslot.css\";\r\n\r\nconst dropTarget: DropTargetSpec<Props> = {\r\n    drop(props: Props, monitor: DropTargetMonitor) {\r\n        props.onDrop(monitor.getItem());\r\n    },\r\n    canDrop(props: Props, monitor: DropTargetMonitor)  {\r\n        return true; // todo: can't drop on yourself\r\n    },\r\n};\r\n\r\nexport interface Props {\r\n    onDrop: (item: any) => void;\r\n}\r\n\r\nexport interface DropSourceProps {\r\n    canDrop: boolean;\r\n    isOver: boolean;\r\n    connectDropTarget: ConnectDropTarget;\r\n}\r\n\r\nconst collect = (connect: DropTargetConnector, monitor: DropTargetMonitor) => ({\r\n    canDrop: monitor.canDrop(),\r\n    connectDropTarget: connect.dropTarget(),\r\n    isOver: monitor.isOver(),\r\n});\r\n\r\n/*\r\n * Can drop adventurers on this */\r\nconst DroppableAdventurerSlot = (props: Props & DropSourceProps) => {\r\n    const {\r\n        isOver,\r\n        canDrop,\r\n        connectDropTarget,\r\n    } = props;\r\n    // const isActive = isOver && canDrop;\r\n    let className = \"droppable-adventurer-slot\";\r\n\r\n    if (isOver) {\r\n        className += \" active-drop\";\r\n    } else if (canDrop) {\r\n        className += \" can-drop\";\r\n    }\r\n\r\n    return connectDropTarget(\r\n        <div className = { className }/>\r\n    );\r\n}\r\n\r\nexport default DropTarget<Props, DropSourceProps>(\r\n    DragType.ADVENTURER,\r\n    dropTarget,\r\n    collect,\r\n)(DroppableAdventurerSlot);\r\n","import AdventurerAvatar from \"components/ui/AdventurerAvatar\";\r\nimport { AdventurerAvatarDragInfo } from \"components/ui/DraggableAdventurerAvatar\";\r\nimport DroppableAdventurerSlot from \"components/ui/DroppableAdventurerSlot\";\r\nimport * as React from \"react\";\r\nimport { AdventurerStoreState } from \"stores/adventurer\";\r\nimport \"./css/assignadventurers.css\";\r\n\r\nexport interface DispatchProps {\r\n    onAdventurerDropped: (item: AdventurerAvatarDragInfo, index: number) => void;\r\n    onAdventurerClicked: (adventurer: AdventurerStoreState) => void;\r\n}\r\n\r\nexport interface Props {\r\n    availableSlots: number;\r\n    assignedAventurers: AdventurerStoreState[];\r\n}\r\n\r\n/*\r\n * Displays a number of slots to drag adventurers to */\r\nconst AssignAdventurers = (props: Props & DispatchProps) => {\r\n    const slotsContent = () => {\r\n        const slots: JSX.Element[] = [];\r\n        for (let i = 0; i < props.availableSlots; i++) {\r\n            let content;\r\n            let className = \"\";\r\n            const hasAdventurer = !!props.assignedAventurers[i];\r\n\r\n            if (hasAdventurer) {\r\n                const adventurer = props.assignedAventurers[i];\r\n                content = (\r\n                    <AdventurerAvatar\r\n                        adventurer={adventurer}\r\n                        displayName={false}\r\n                        onClick={() => props.onAdventurerClicked(adventurer) }\r\n                    />\r\n                );\r\n                className = \"has-adventurer\";\r\n            } else {\r\n                content = (\r\n                    <DroppableAdventurerSlot onDrop={ (item: AdventurerAvatarDragInfo) => { props.onAdventurerDropped(item, i); }} />\r\n                );\r\n            }\r\n            slots.push(<li key = { `slot${i}`} className = { className }> { content } </li>);\r\n        }\r\n        return slots;\r\n    };\r\n\r\n    return (\r\n        <ul className = \"assign-adventurers\">\r\n            { slotsContent() }\r\n        </ul>\r\n    );\r\n};\r\n\r\nexport default AssignAdventurers;\r\n","import { AdventurerAvatarDragInfo } from \"components/ui/DraggableAdventurerAvatar\";\r\nimport ItemsCostBox from \"containers/ui/context/items/ItemsCostBox\";\r\nimport { Item } from \"definitions/items/types\";\r\nimport { getDefinition } from \"definitions/quests\";\r\nimport * as React from \"react\";\r\nimport { AdventurerStoreState } from \"stores/adventurer\";\r\nimport { QuestStoreState } from \"stores/quest\";\r\nimport { TextManager } from \"global/TextManager\";\r\nimport AssignAdventurers from \"./AssignAdventurers\";\r\nimport \"./css/questboard.css\";\r\nimport { QuestDefinition } from 'definitions/quests/types';\r\nimport { useSelector } from 'react-redux';\r\nimport { StoreState } from 'stores';\r\n\r\nexport const AVAILABLE_SLOTS = 5;\r\nconst minimumCountAdventurers = 3;  // we need this many adventurers to start the quest\r\n\r\n\r\n// tslint:disable-next-line: no-empty-interface\r\n\r\nexport interface Props {\r\n    availableQuests: QuestStoreState[];\r\n    selectedQuestName?: string;       // name of selected quest\r\n    assignedAventurers: AdventurerStoreState[];\r\n\r\n    onQuestClick: (questName: string) => void;\r\n    onAdventurerDropped: (item: AdventurerAvatarDragInfo, index: number) => void;\r\n    onRemoveAdventurer: (adventurer: AdventurerStoreState) => void;\r\n    onLaunchQuest: () => void;\r\n}\r\n\r\nconst QuestBoard = (props: Props) => {\r\n\r\n    const items = useSelector<StoreState, (null|Item)[]>(state => state.stockpile);\r\n\r\n    const getQuestDetails = () => {\r\n        if (!props.selectedQuestName) {\r\n            return null;\r\n        }\r\n        const quest = props.availableQuests.find((q) => q.name === props.selectedQuestName);\r\n        if (!quest) {\r\n            return <div> { TextManager.get(\"structure-tavern-quest-launched\") } </div>;\r\n        }\r\n        const questDefinition = getDefinition(quest.name);\r\n\r\n        // Need a full party to launch\r\n        const fullParty = props.assignedAventurers.filter((a) => a !== null).length >= minimumCountAdventurers;\r\n        // Check if we have the required items\r\n        const enoughItems = checkEnoughItems(questDefinition);\r\n\r\n        const canLaunch = fullParty && enoughItems;\r\n\r\n        return (\r\n            <div className=\"quest-details\">\r\n                {TextManager.getQuestDescription(props.selectedQuestName)}\r\n                <AssignAdventurers\r\n                    availableSlots={AVAILABLE_SLOTS}\r\n                    assignedAventurers={props.assignedAventurers}\r\n                    onAdventurerClicked={props.onRemoveAdventurer}\r\n                    onAdventurerDropped={props.onAdventurerDropped}\r\n                />\r\n                <ItemsCostBox items={ questDefinition.requiredItems || [] }/>\r\n                <button disabled={!canLaunch} onClick = { () => props.onLaunchQuest() }>\r\n                    {TextManager.get(\"structure-tavern-button-launch-quest\")}\r\n                </button>\r\n            </div>\r\n        );\r\n    };\r\n\r\n    /**\r\n     * Returns true if all the items required by the quest are in the inventory\r\n     */\r\n    const checkEnoughItems = (questDefinition: QuestDefinition): boolean => {\r\n        if (!questDefinition.requiredItems) {\r\n            return true;\r\n        }\r\n        return questDefinition.requiredItems.every((item: Item) => {\r\n            const amountRequired = (questDefinition.requiredItems)!.filter((i) => i === item).length;\r\n            return items.filter((i) => i === item).length >= amountRequired;\r\n        });\r\n    }\r\n\r\n    // quest board, expanded quest info + assign adventurers + launch button\r\n    return (\r\n        <div className=\"quest-board\">\r\n            <h2>\r\n                {TextManager.get(\"structure-tavern-title-quest-board\")}\r\n            </h2>\r\n            <ul className=\"quest-list\">\r\n                {props.availableQuests.map((q) => {\r\n                    const iconImgPath = `${process.env.PUBLIC_URL}img/sigils/${q.icon }`;\r\n                    const className = `quest ${(q.name === props.selectedQuestName) ? \" selected\" : \"\"}`;\r\n                    return (\r\n                        <li key={q.name} className={className} onClick={() => {props.onQuestClick(q.name);} }>\r\n                            <div\r\n                                className=\"icon\"\r\n                                style={{backgroundImage: `url(${process.env.PUBLIC_URL}${iconImgPath})`}}\r\n                            />\r\n                            <div className=\"title\">{ TextManager.getQuestTitle(q.name) } </div>\r\n                        </li>\r\n                    );\r\n                })}\r\n            </ul>\r\n            { getQuestDetails() }\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default QuestBoard;\r\n","import * as React from \"react\";\r\nimport { AdventurerStoreState } from 'stores/adventurer';\r\nimport { AVAILABLE_SLOTS } from './QuestBoard';\r\nimport \"./css/adventurerButton.css\";\r\n\r\nexport interface Props {\r\n    adventurer: AdventurerStoreState;\r\n    assignedAventurers: AdventurerStoreState[];  // assigned to a quest in the QuestBoard\r\n\r\n    onAddAdventurer: (adventurer: AdventurerStoreState, index: number) => void;\r\n    onRemoveAdventurer: (adventurer: AdventurerStoreState) => void;\r\n}\r\n\r\n// Toggles adventurer participation in a quest\r\nconst AdventurerButton = (props: Props) => {\r\n    const {\r\n        adventurer,\r\n        assignedAventurers,\r\n        onAddAdventurer,\r\n        onRemoveAdventurer\r\n    } = props;\r\n\r\n    const isAssigned = assignedAventurers.indexOf(adventurer) > -1;\r\n\r\n    const handleAddClick = () => {\r\n        const emptySlot = getEmptySlot(assignedAventurers);\r\n        onAddAdventurer(adventurer, emptySlot);\r\n    };\r\n\r\n    const handleRemoveClick = () => {\r\n        onRemoveAdventurer(adventurer);\r\n    }\r\n\r\n    if (isAssigned) {\r\n        return (\r\n            <button onClick={handleRemoveClick} className=\"adventurer-button\">\r\n                Leave\r\n            </button>\r\n        );\r\n    }\r\n    // Skip holes\r\n    if (assignedAventurers.filter(Boolean).length === AVAILABLE_SLOTS) {\r\n        return (\r\n            <button disabled={true} className=\"adventurer-button\">\r\n                Party full\r\n            </button>\r\n        )\r\n    }\r\n    return (\r\n        <button onClick={handleAddClick}  className=\"adventurer-button\">\r\n            Join\r\n        </button>\r\n    )\r\n}\r\n\r\nexport default AdventurerButton;\r\n\r\n// Finds the first array index with a falsey value\r\nconst getEmptySlot = (assignedAventurers: AdventurerStoreState[]) => {\r\n    for (let i = 0; i < AVAILABLE_SLOTS; i++) {\r\n        if (!assignedAventurers[i]) {\r\n            return i;\r\n        }\r\n    }\r\n    return 0;\r\n}","import React from 'react';\r\nimport { AdventurerStoreState } from 'stores/adventurer';\r\nimport DraggableAdventurerAvatar from 'components/ui/DraggableAdventurerAvatar';\r\nimport { SOURCE_ID } from './TavernStructureView';\r\nimport AdventurerPanel from 'components/world/QuestPanel/AdventurerPanel';\r\nimport AdventurerButton from './AdventurerButton';\r\n\r\nexport interface Props {\r\n    adventurer: AdventurerStoreState;\r\n    onQuest: boolean;\r\n    assignedAventurers: AdventurerStoreState[];\r\n    expanded: boolean;\r\n    selectedQuestName?: string;\r\n\r\n    onClick: (adventurer: AdventurerStoreState) => void;\r\n    onAddAdventurer: (adventurer: AdventurerStoreState, index: number) => void;\r\n    onRemoveAdventurer: (adventurer: AdventurerStoreState) => void;\r\n}\r\n\r\n// Room block that has adventurer\r\nconst RoomWithAdventurer = (props: Props) => {\r\n    const {\r\n        adventurer,\r\n        onQuest,\r\n        assignedAventurers,\r\n        expanded,\r\n        selectedQuestName,\r\n        onClick,\r\n        onAddAdventurer,\r\n        onRemoveAdventurer\r\n    } = props;\r\n    /*\r\n    <button\r\n        className=\"boot\"\r\n        key={ `boot:${adventurer.id}` }\r\n    >\r\n        Boot\r\n    </button>,*/\r\n    const assigned = assignedAventurers.indexOf(adventurer) > -1; // assigned to a quest in the QuestBoard\r\n\r\n    return (\r\n        <>\r\n            <div className={`room ${expanded ? \"expanded\" : \"\"}`}>\r\n                <DraggableAdventurerAvatar\r\n                    disabled={assigned || onQuest}\r\n                    adventurer={adventurer}\r\n                    className=\"adventurer-icon\"\r\n                    sourceId={SOURCE_ID}\r\n                    key={`avatar:${adventurer.id}`}\r\n                />\r\n                <span key={ adventurer.id } onClick={() => onClick(adventurer)}>\r\n                    {adventurer.name}\r\n                    {(onQuest) && \" (on a quest)\" }\r\n                </span>\r\n            </div>\r\n            { expanded && (\r\n                <div className=\"adventurer-details\">\r\n                    <AdventurerPanel adventurer={adventurer} />\r\n                    { (!onQuest && selectedQuestName) && (\r\n                        <AdventurerButton \r\n                            adventurer={adventurer}\r\n                            assignedAventurers={assignedAventurers}\r\n                            onAddAdventurer={onAddAdventurer}\r\n                            onRemoveAdventurer={onRemoveAdventurer}\r\n                        />\r\n                    )}\r\n                </div>\r\n            )}\r\n        </>\r\n    );\r\n}\r\n\r\nexport default RoomWithAdventurer;\r\n","import React, {  } from 'react';\r\n\r\nexport interface Props {\r\n}\r\n\r\nconst RoomEmpty = () => {\r\n    return (\r\n        <div className=\"room\">\r\n            (empty room)\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default RoomEmpty;\r\n","import React, { useState } from 'react';\r\nimport { AdventurerStoreState } from 'stores/adventurer';\r\nimport { QuestStoreState } from 'stores/quest';\r\nimport RoomWithAdventurer from './RoomWithAdventurer';\r\nimport RoomEmpty from './RoomEmpty';\r\n\r\nexport interface Props {\r\n    roomCount: number;\r\n    adventurers: AdventurerStoreState[];\r\n    assignedAventurers: AdventurerStoreState[];\r\n    quests: QuestStoreState[];\r\n    selectedQuestName?: string;       // name of selected quest\r\n\r\n    onAddAdventurer: (adventurer: AdventurerStoreState, index: number) => void;\r\n    onRemoveAdventurer: (adventurer: AdventurerStoreState) => void;\r\n}\r\n\r\nconst RoomList = (props: Props) => {\r\n    const {\r\n        roomCount,\r\n        adventurers,\r\n        assignedAventurers,\r\n        selectedQuestName,\r\n        onAddAdventurer,\r\n        onRemoveAdventurer\r\n    } = props;\r\n    const [selectedAdventurer, setSelectedAdventurer] = useState<string>();\r\n\r\n    const getQuestByAdventurer = (adventurerId: string): QuestStoreState | undefined => {\r\n        return Object.values(props.quests).find((quest) => {\r\n            return quest.party.indexOf(adventurerId) > -1;\r\n        });\r\n    };\r\n\r\n    const handleAdventurerNameClick = (adventurer: AdventurerStoreState) => {\r\n        if (selectedAdventurer === adventurer.id) {\r\n            setSelectedAdventurer(undefined);\r\n        } else {\r\n            setSelectedAdventurer(adventurer.id);\r\n        }\r\n    };\r\n\r\n    const roomContent: JSX.Element[] = [];\r\n    for (let i = 0; i < roomCount; i++) {\r\n        const adventurer = adventurers.find((a) => a.room === i);\r\n        if (!adventurer) {\r\n            roomContent.push((\r\n                <RoomEmpty key={`room${i}`} />\r\n            ));\r\n            continue;\r\n        }\r\n        const onQuest = !!getQuestByAdventurer(adventurer.id);\r\n\r\n        roomContent.push((\r\n            <RoomWithAdventurer\r\n                key={adventurer.id}\r\n                adventurer={adventurer}\r\n                assignedAventurers={assignedAventurers}\r\n                selectedQuestName={selectedQuestName}\r\n                expanded={selectedAdventurer === adventurer.id}\r\n                onQuest={onQuest}\r\n\r\n                onClick={handleAdventurerNameClick}\r\n                onAddAdventurer={onAddAdventurer}\r\n                onRemoveAdventurer={onRemoveAdventurer}\r\n            />\r\n        ));\r\n    }\r\n\r\n    return (\r\n        <div className=\"rooms\">\r\n            <h2>Rooms</h2>\r\n            { roomContent }\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default RoomList;","import * as React from \"react\";\r\nimport { AdventurerAvatarDragInfo} from \"components/ui/DraggableAdventurerAvatar\";\r\nimport { getDefinition, Structure} from \"definitions/structures\";\r\nimport { TavernStructureDefinition, TavernStructureLevelDefinition} from \"definitions/structures/types\";\r\nimport { AdventurerStoreState} from \"stores/adventurer\";\r\nimport { QuestStatus, QuestStoreState} from \"stores/quest\";\r\nimport { TextManager} from \"global/TextManager\";\r\nimport { ToastManager} from 'global/ToastManager';\r\nimport { Type} from 'components/ui/toasts/Toast';\r\nimport { getQuestLink} from 'utils/routing';\r\nimport RoomList from './RoomList';\r\nimport { useState} from 'react';\r\nimport QuestBoard from './QuestBoard';\r\nimport useGold from 'hooks/store/useGold';\r\nimport useStructure from 'hooks/store/useStructure';\r\nimport { useSelector, useDispatch } from 'react-redux';\r\nimport { StoreState } from 'stores';\r\nimport { launchQuest } from 'actions/quests';\r\nimport { subtractGold } from 'actions/gold';\r\nimport { upgradeStructure } from 'actions/structures';\r\nimport { addLogText } from 'actions/log';\r\nimport { LogChannel } from 'stores/logEntry';\r\nimport \"./css/tavernstructureview.css\";\r\n\r\n\r\n\r\nexport interface StateProps {\r\n    gold: number;\r\n    level: number;\r\n    adventurers: AdventurerStoreState[];\r\n    quests: QuestStoreState[];\r\n}\r\n\r\n// tslint:disable-next-line:no-empty-interface\r\nexport interface Props {\r\n}\r\n\r\n\r\nexport const SOURCE_ID = \"tavern\";\r\n\r\n// The UI for the tavern\r\nconst TavernStructureView = (props: Props) => {\r\n    const gold = useGold();\r\n    const level = useStructure(Structure.tavern).level;\r\n    const adventurers = useSelector<StoreState, AdventurerStoreState[]>(store => store.adventurers);\r\n    const quests = useSelector<StoreState, QuestStoreState[]>(store => store.quests);\r\n\r\n    const [assignedAventurers, setAassignedAdventurers] = useState<AdventurerStoreState[]>([]);\r\n    const [selectedQuest, setSelectedQuest] = useState<string>();\r\n\r\n    const structureDefinition = getDefinition<TavernStructureDefinition>(Structure.tavern);\r\n    const levelDefinition: TavernStructureLevelDefinition = structureDefinition.levels[level];\r\n    const displayName = TextManager.getStructureName(Structure.tavern);\r\n\r\n    const dispatch = useDispatch();\r\n\r\n    const onLaunchQuest = (questName: string) => {\r\n        dispatch(launchQuest(questName, assignedAventurers));\r\n    };\r\n\r\n    const onUpgrade = (cost: number) => {\r\n        dispatch(subtractGold(cost));\r\n        dispatch(upgradeStructure(Structure.tavern));  // Todo: [07/07/2019] time??\r\n\r\n        dispatch(addLogText(\"log-town-upgrade-structure-complete\", {\r\n            level: level + 1,\r\n            structure: Structure.tavern,\r\n        }, LogChannel.town));\r\n    };\r\n\r\n    const createUpgradeRow = () => {\r\n\r\n        const nextLevel = structureDefinition.levels[level + 1];\r\n        const nextLevelCost = (nextLevel != null ? nextLevel.cost.gold || 0 : -1);\r\n        const canUpgrade = nextLevel != null && gold >= nextLevelCost;\r\n        const upgradeText = `Upgrade! (${nextLevelCost < 0 ? \"max\" : nextLevelCost + \" gold\"})`;\r\n\r\n        const handleClick = (event: React.MouseEvent<HTMLButtonElement>) => {\r\n            onUpgrade(nextLevelCost);\r\n        };\r\n\r\n        return (\r\n            <div>\r\n                <label>level:</label>{ `${(level + 1)} / ${structureDefinition.levels.length}` }\r\n                <button\r\n                    style = {{ float: \"right\"}}\r\n                    onClick={handleClick}\r\n                    disabled= { !canUpgrade}\r\n                >\r\n                    { upgradeText}\r\n                </button>\r\n            </div>\r\n        );\r\n    };\r\n\r\n    const getAvailableQuests = quests.filter((q) => q.status === QuestStatus.available );\r\n\r\n    const handleQuestClick = (name: string): void => {\r\n        if (selectedQuest === name) {\r\n            setSelectedQuest(undefined);\r\n        } else {\r\n            setSelectedQuest(name);\r\n        }\r\n\r\n        // Unassign all adventurers\r\n        setAassignedAdventurers([]);\r\n    };\r\n\r\n    const handleAdventurerDropped = (item: AdventurerAvatarDragInfo, index: number) => {\r\n        if (item.sourceId === SOURCE_ID) {\r\n            handleAddAdventurer(item.adventurer, index)\r\n        }\r\n    }\r\n\r\n    const handleAddAdventurer = (adventurer: AdventurerStoreState, index: number): void => {\r\n        const copy = [ ...assignedAventurers];\r\n        copy[index] = adventurer;\r\n        setAassignedAdventurers(copy);\r\n    };\r\n\r\n    const handleRemoveAdventurer = (adventurer: AdventurerStoreState): void => {\r\n        const index = assignedAventurers.indexOf(adventurer);\r\n        const copy = [ ...assignedAventurers];\r\n        delete copy[index];\r\n        setAassignedAdventurers(copy);\r\n    };\r\n\r\n    const handleLaunchQuest = (): void => {\r\n        const questTitle = TextManager.getQuestTitle(selectedQuest!);\r\n        const leader = assignedAventurers[0];\r\n        ToastManager.addToast(questTitle, Type.questLaunched, leader?.avatarImg, getQuestLink(selectedQuest!));\r\n        onLaunchQuest(selectedQuest!);\r\n    };\r\n\r\n    return (\r\n        <details open={true} className=\"tavernstructureview\">\r\n            <summary>{displayName}</summary>\r\n            {createUpgradeRow()}\r\n            <section>\r\n                <RoomList\r\n                    roomCount={levelDefinition.rooms}\r\n                    adventurers={adventurers}\r\n                    assignedAventurers={assignedAventurers}\r\n                    quests={quests}\r\n                    selectedQuestName={selectedQuest}\r\n                    onAddAdventurer={handleAddAdventurer}\r\n                    onRemoveAdventurer={handleRemoveAdventurer}\r\n                />\r\n                <QuestBoard\r\n                    availableQuests={getAvailableQuests}\r\n                    selectedQuestName={selectedQuest}\r\n                    assignedAventurers={assignedAventurers}\r\n                    onQuestClick={(name: string) => handleQuestClick(name)}\r\n                    onAdventurerDropped={handleAdventurerDropped}\r\n                    onRemoveAdventurer={handleRemoveAdventurer}\r\n                    onLaunchQuest={() => handleLaunchQuest()}\r\n                />\r\n            </section>\r\n        </details>\r\n    );\r\n};\r\n\r\nexport default TavernStructureView;\r\n","import { Resource } from \"definitions/resources\";\r\nimport resourceDescriptions from \"definitions/resources\";\r\nimport * as React from \"react\";\r\nimport { ResourceStoreState } from \"stores/resources\";\r\nimport { TextManager } from \"global/TextManager\";\r\nimport { StructuresStoreState } from 'stores/structures';\r\nimport { getStructureByResource } from 'definitions/structures';\r\nimport { Link } from 'react-router-dom';\r\nimport { getStructureLink } from 'utils/routing';\r\nimport { withAppContext, AppContextProps } from 'hoc/withAppContext';\r\nimport \"components/ui/css/common/icon.css\";\r\nimport \"components/ui/resources/css/resourcesbox.css\";\r\nimport { useSelector } from 'react-redux';\r\nimport { StoreState } from 'stores';\r\nimport { StructureState } from 'stores/structure';\r\n\r\nexport interface Props {\r\n    className?: string;\r\n    resources: ResourceStoreState;\r\n    structures: StructuresStoreState;\r\n    maxResources: ResourceStoreState;\r\n    deltaResources: ResourceStoreState;\r\n}\r\n\r\nexport interface StateProps {\r\n    sufficientResources?: Record<Resource, boolean>;\r\n}\r\n\r\ntype AllProps = Props & StateProps;\r\n\r\n/**\r\n * The ResourcesBox is used in the Warehouse to show a list of resources\r\n */\r\nconst ResourcesBox = (props: AllProps & AppContextProps) => {\r\n    const {\r\n        sufficientResources,\r\n        resources,\r\n        deltaResources,\r\n    } = props;\r\n    const structures = useSelector<StoreState, StructuresStoreState>(store => store.structures);\r\n\r\n    const className=(props.className || \"\") + \" resourcesbox\";\r\n    const listItems = Object.keys(resources).map((resource: string) => {\r\n        let listItemClass = \"resource\";\r\n        if (sufficientResources && !sufficientResources[resource]) {\r\n             listItemClass += \" insufficient\";\r\n        }\r\n        const resourceDescription=resourceDescriptions[resource];\r\n        const amount = props.resources[resource]!;\r\n        if (!resourceDescription) {\r\n            throw new Error(`No resource description found for ${resource}`);\r\n        }\r\n\r\n        let delta;\r\n        if (deltaResources[resource]) {\r\n            delta = <span className=\"animate-up\">\r\n                { `+ ${deltaResources[resource]!.toFixed(2)}`  }\r\n            </span>;\r\n        }\r\n\r\n        const structure = getStructureByResource(Resource[resource]);\r\n\r\n        const handleStructureClick=() => {\r\n            props.onCloseWindow();\r\n        }\r\n\r\n        return (\r\n            <li className={listItemClass} key={resource}>\r\n                <div className=\"icon common-icon-smallest\" style={{\r\n                    backgroundImage: `url(${process.env.PUBLIC_URL}${resourceDescription.iconImg})`,\r\n                }}/>\r\n                <div className=\"name\">\r\n                    { TextManager.getResourceName(resource as Resource) }\r\n                </div>\r\n                <div className=\"amount\" >\r\n                    { amount.toFixed(1) }\r\n                </div>\r\n                <div className=\"max\" >\r\n                    { ` / ${props.maxResources[resource]}` }\r\n                </div>\r\n                <div className=\"delta\">\r\n                    { delta }\r\n                </div>\r\n                <div className=\"structure\">\r\n                    source:\r\n                    { structures[structure].state === StructureState.Built ? (\r\n                        <Link to={getStructureLink(structure)} onClick={handleStructureClick}>\r\n                            { TextManager.getStructureName(structure) }\r\n                        </Link>\r\n                    ) : (\r\n                        TextManager.getStructureName(structure)\r\n                    )}\r\n                </div>\r\n            </li>\r\n        );\r\n    });\r\n\r\n    return (\r\n        <ul className={ className } >\r\n            { listItems }\r\n        </ul>\r\n    );\r\n};\r\n\r\nexport default withAppContext(ResourcesBox);\r\n\r\n\r\n","import { useEffect, useRef } from \"react\";\r\n\r\nconst usePrevious = <T extends {}>(value: T) => {\r\n    const ref = useRef<T>();\r\n    useEffect(() => {\r\n      ref.current = value;\r\n    });\r\n    return ref.current;\r\n};\r\nexport default usePrevious;\r\n","import { Resource } from \"definitions/resources\";\r\n\r\n// The keys should be the same as the enum Resource\r\nexport interface ResourceStoreState {\r\n    [Resource.wood]?: number;\r\n    [Resource.iron]?: number;\r\n    [Resource.stone]?: number;\r\n    [Resource.leather]?: number;\r\n    [Resource.fabric]?: number;\r\n    [Resource.food]?: number;\r\n}\r\n\r\nexport const initialState: ResourceStoreState = {\r\n    fabric: 0,\r\n    food: 0,\r\n    iron: 10,\r\n    leather: 0,\r\n    stone: 0,\r\n    wood: 10,\r\n};\r\n\r\nexport const empty: ResourceStoreState = {\r\n    fabric: 0,\r\n    food: 0,\r\n    iron: 0,\r\n    leather: 0,\r\n    stone: 0,\r\n    wood: 0,\r\n};\r\n","import { AdventurerStoreState } from 'stores/adventurer';\r\nimport { QuestStoreState, QuestStatus } from 'stores/quest';\r\nimport { StoreState } from 'stores';\r\nimport { useSelector } from 'react-redux';\r\nimport { useMemo } from 'react';\r\n\r\nconst getAdventurersInTown = (adventurers: AdventurerStoreState[], quests: QuestStoreState[]): AdventurerStoreState[] => {\r\n    // Get an array of all adventurer ids on any active quest\r\n    const adventurersOnQuest = quests.reduce<string[]>((acc, val: QuestStoreState) => {\r\n        if (val.status === QuestStatus.active) {\r\n            acc.push(...val.party);\r\n        }\r\n        return acc;\r\n    }, []);\r\n\r\n    return adventurers.filter((a) => adventurersOnQuest.indexOf(a.id) === -1);\r\n};\r\n\r\n/** Returns all the adventurers currently not on a mission */\r\nexport const useAdventurersInTown = () => {\r\n    const adventurers = useSelector<StoreState, AdventurerStoreState[]>(store => store.adventurers);\r\n    const quests = useSelector<StoreState, QuestStoreState[]>(store => store.quests);\r\n\r\n    const adventurersInTown = useMemo(() => {\r\n        return getAdventurersInTown(adventurers, quests)\r\n    }, [adventurers, quests]);\r\n\r\n    return adventurersInTown;\r\n}","import { ContextType } from \"constants/context\";\r\nimport { DragSourceType } from \"constants/dragging\";\r\nimport { IconSize } from \"constants/icons\";\r\nimport { getDefinition } from \"definitions/items\";\r\nimport { Item } from \"definitions/items/types\";\r\nimport * as React from \"react\";\r\nimport { AdventurerStoreState } from \"stores/adventurer\";\r\nimport { TextManager } from \"global/TextManager\";\r\nimport \"./css/adventurerinfo.css\";\r\nimport DraggableItemIcon, { InventoryItemDragInfo } from \"./DraggableItemIcon\";\r\nimport EquipmentSlot, { EquipmentSlotType } from \"./EquipmentSlot\";\r\nimport Inventory from \"./inventory/Inventory\";\r\nimport { TooltipManager } from 'global/TooltipManager';\r\nimport useItemDropActions from 'hooks/actions/useItemActions';\r\nimport useAdventurer from 'hooks/store/useAdventurer';\r\n\r\nexport interface Props {\r\n    adventurerId: string;\r\n}\r\n\r\n\r\n\r\nexport interface StateProps {\r\n    adventurer: AdventurerStoreState;\r\n    warehouse: (Item|null)[];\r\n}\r\n\r\n// Used in warehouse\r\nconst AdventurerInfo = (props: Props) => {\r\n\r\n    const adventurer = useAdventurer(props.adventurerId);\r\n    const attributes = Object.keys(adventurer.stats).map((stat) => {\r\n        const value: number = adventurer.stats[stat];\r\n        return <div key={`${adventurer.id}-${stat}`} > <b>{stat}</b>: {value.toFixed(1)} </div>;\r\n    });\r\n\r\n    const {\r\n        dropItemEquipment,\r\n        dropItemInventory\r\n    } = useItemDropActions()\r\n\r\n    const handleDropItemEquipment = (dragInfo: InventoryItemDragInfo, slotType: EquipmentSlotType) => {\r\n        dropItemEquipment(dragInfo, slotType, adventurer);\r\n    };\r\n\r\n    const handleDropItemInventory = (item: Item, fromSlot: number, toSlot: number, sourceType: DragSourceType, sourceId?: string): void => {\r\n        dropItemInventory(item, fromSlot, toSlot, sourceType, adventurer, sourceId);\r\n    };\r\n\r\n    const getEquipmentSlot = (slotType: EquipmentSlotType) => {\r\n        // returns EquipmentSlot\r\n        const item: Item | undefined = adventurer.equipment[EquipmentSlotType[slotType]];\r\n        let contents = null;\r\n        if (item) {\r\n            const itemRef: React.RefObject<any> = React.createRef();\r\n            const handleClick = (event: React.MouseEvent) => {\r\n                const origin = (event.currentTarget as HTMLElement);\r\n                const originRect = origin.getBoundingClientRect();\r\n                TooltipManager.showContextTooltip(ContextType.item, getDefinition(item), originRect);\r\n                event.stopPropagation();\r\n            };\r\n\r\n            contents = (\r\n                <DraggableItemIcon\r\n                    index={slotType}\r\n                    sourceId={adventurer.id}\r\n                    sourceType={DragSourceType.adventurerEquipment}\r\n                    item={item}\r\n                    onClick={handleClick}\r\n                    ref={itemRef}\r\n                    size={IconSize.medium}\r\n                />\r\n            );\r\n        }\r\n\r\n        return (\r\n            <>\r\n                <EquipmentSlot\r\n                    onDrop={(dragInfo: InventoryItemDragInfo) => handleDropItemEquipment(dragInfo, slotType)}\r\n                    type={slotType}\r\n                >\r\n                    {contents}\r\n                </EquipmentSlot>\r\n                <span className=\"info\">{TextManager.get(`ui-equipmentslot-${EquipmentSlotType[slotType]}`)}</span>\r\n            </>\r\n        );\r\n    };\r\n\r\n    const equipmentList = (\r\n        <ul>\r\n            <li>{getEquipmentSlot(EquipmentSlotType.head)}</li>\r\n            <li>{getEquipmentSlot(EquipmentSlotType.shoulders)}</li>\r\n            <li>{getEquipmentSlot(EquipmentSlotType.chest)}</li>\r\n            <li>{getEquipmentSlot(EquipmentSlotType.hands)}</li>\r\n            <li>{getEquipmentSlot(EquipmentSlotType.legs)}</li>\r\n            <li>{getEquipmentSlot(EquipmentSlotType.feet)}</li>\r\n            <li>{getEquipmentSlot(EquipmentSlotType.mainHand)}</li>\r\n            <li>{getEquipmentSlot(EquipmentSlotType.offHand)}</li>\r\n        </ul>\r\n    );\r\n\r\n    return (\r\n        <div className=\"adventurer-info\">\r\n            <div className=\"left\">\r\n                <div className=\"name\">\r\n                    <b>{adventurer.name}</b>\r\n                </div>\r\n                <div className=\"attributes\">\r\n                    {attributes}\r\n                </div>\r\n                <div className=\"equipment\">\r\n                    {equipmentList}\r\n                </div>\r\n            </div>\r\n            <div className=\"right\">\r\n                <Inventory\r\n                    sourceType={DragSourceType.adventurerInventory}\r\n                    sourceId={adventurer.id}\r\n                    items={adventurer.inventory}\r\n                    onDropItem={handleDropItemInventory}\r\n                />\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default AdventurerInfo;\r\n","import Inventory from \"components/ui/inventory/Inventory\";\r\nimport ResourcesBox from \"components/ui/resources/ResourcesBox\";\r\nimport { DragSourceType } from \"constants/dragging\";\r\nimport { Item } from \"definitions/items/types\";\r\nimport { getDefinition, Structure } from \"definitions/structures\";\r\nimport { StructureDefinition, WarehouseStructureLevelDefinition } from \"definitions/structures/types\";\r\nimport usePrevious from \"hooks/usePrevious\";\r\nimport * as React from \"react\";\r\nimport { useEffect, useRef, useState } from \"react\";\r\nimport { empty, ResourceStoreState } from \"stores/resources\";\r\nimport { StructuresStoreState } from \"stores/structures\";\r\nimport { TextManager } from \"global/TextManager\";\r\nimport \"./css/warehousestructureview.css\";\r\nimport AdventurerTabstrip from 'components/world/QuestPanel/AdventurerTabstrip';\r\nimport useStructure from 'hooks/store/useStructure';\r\nimport useResources from 'hooks/store/useResources';\r\nimport useGold from 'hooks/store/useGold';\r\nimport useStructureActions from 'hooks/actions/useStructureActions';\r\nimport useStockpileState from 'hooks/store/useStockpileState';\r\nimport { useSelector } from 'react-redux';\r\nimport { StoreState } from 'stores';\r\nimport { useAdventurersInTown } from 'hooks/store/adventurers';\r\nimport useItemDropActions from 'hooks/actions/useItemActions';\r\nimport AdventurerInfo from 'components/ui/AdventurerInfo';\r\n\r\n// tslint:disable-next-line: no-empty-interface\r\nexport interface Props  {\r\n}\r\n\r\n\r\nconst WAREHOUSE = DragSourceType.warehouse;\r\n\r\n\r\n// todo 20191202: Resource update should happen at a set interval\r\nconst WarehouseStructureView = (props: Props) => {\r\n\r\n    const [selectedAdventurer, setSelectedAdventurer] = useState<string>();\r\n    const resources = useResources();\r\n    const [resourcesDelta, setResourcesDelta] = useState<ResourceStoreState>(empty);    // updating this will trigger animation\r\n    const previousResources = usePrevious(resources);\r\n    const resourcesRef = useRef<HTMLFieldSetElement>(null);\r\n    const gold = useGold();\r\n    const stockpileState = useStockpileState();\r\n    const structuresState = useSelector<StoreState, StructuresStoreState>(store => store.structures);\r\n    const {startUpgradeStructure} = useStructureActions();\r\n    const adventurersInTown = useAdventurersInTown();\r\n    const {dropItemWarehouse} = useItemDropActions();\r\n\r\n    useEffect(() => {\r\n        // Calculate delta\r\n        const delta = Object.keys(resources).reduce((acc, value) => {\r\n            if (previousResources && previousResources[value]) {\r\n                acc[value] = resources[value] - previousResources[value];\r\n            }\r\n            return acc;\r\n        }, {});\r\n\r\n        setResourcesDelta(delta);\r\n    }, [resources, previousResources]);\r\n\r\n    useEffect(() => {\r\n        if (!resourcesRef.current) {\r\n            return;\r\n        }\r\n        const ref = resourcesRef.current as unknown as HTMLFieldSetElement;\r\n        ref.classList.remove(\"animate\");\r\n        setTimeout(() => {\r\n            if (resourcesRef) {\r\n                ref.classList.add(\"animate\");\r\n            }\r\n        }, 200);\r\n    }, [resourcesDelta]);\r\n\r\n    const structureDefinition = getDefinition<StructureDefinition>(Structure.warehouse);\r\n    if (!structureDefinition) {\r\n        throw new Error(`No definition found for structure ${Structure.warehouse} with type StructureDefinition.`);\r\n    }\r\n\r\n    const structureState = useStructure(Structure.warehouse);\r\n    const levelDefinition: WarehouseStructureLevelDefinition = structureDefinition.levels[structureState.level] as WarehouseStructureLevelDefinition;\r\n    const level: number = structureState.level;\r\n    const displayName = TextManager.getStructureName(Structure.warehouse);\r\n\r\n    const createUpgradeRow = () => {\r\n        const nextLevel = structureDefinition.levels[level + 1];\r\n        const nextLevelCost = (nextLevel != null ? nextLevel.cost.gold || 0 : -1);\r\n        const canUpgrade = nextLevel != null && gold >= nextLevelCost;\r\n        const upgradeText = `Upgrade! (${nextLevelCost < 0 ? \"max\" : nextLevelCost + \" gold\"})`;\r\n\r\n        const handleClick = (event: React.MouseEvent<HTMLButtonElement>) => {\r\n            startUpgradeStructure(nextLevelCost, level + 1, Structure.warehouse);\r\n        };\r\n        return (\r\n            <div>\r\n                <label>level:</label>{(level + 1) + \" / \" + structureDefinition.levels.length}\r\n                <button\r\n                    style={{ float: \"right\" }}\r\n                    onClick={handleClick}\r\n                    disabled={!canUpgrade}\r\n                >\r\n                    {upgradeText}\r\n                </button>\r\n            </div>\r\n        );\r\n    };\r\n\r\n    const handleDropItemWarehouse = (item: Item, fromSlot: number, toSlot: number, sourceType: DragSourceType, sourceId?: string): void => {\r\n        dropItemWarehouse(item, fromSlot, toSlot, sourceType, sourceId);\r\n    }\r\n\r\n    const handleAdventurerTabSelected = (tabId: string) => {\r\n        setSelectedAdventurer(tabId);\r\n    };\r\n\r\n    const renderAdventurerContent = () => {\r\n        if (selectedAdventurer) {\r\n            return (\r\n                <AdventurerInfo\r\n                    adventurerId={selectedAdventurer}\r\n                />\r\n            );\r\n        }\r\n        return null;\r\n    };\r\n\r\n    return (\r\n        <details open={true} className=\"warehouse-structureview\">\r\n            <summary>{displayName}</summary>\r\n            {createUpgradeRow()}\r\n            <fieldset className=\"resources\" ref={resourcesRef}>\r\n                <legend>Resources</legend>\r\n                <ResourcesBox\r\n                    resources={resources}\r\n                    structures={structuresState}\r\n                    maxResources={levelDefinition.maxResources}\r\n                    deltaResources={resourcesDelta}\r\n                />\r\n            </fieldset>\r\n            <h3>Stockpile</h3>\r\n            <Inventory\r\n                sourceType={WAREHOUSE}\r\n                items={stockpileState}\r\n                onDropItem={handleDropItemWarehouse}\r\n            />\r\n            <h3>Adventurers</h3>\r\n            <div>\r\n                <AdventurerTabstrip\r\n                    adventurers={adventurersInTown}\r\n                    selectedAdventurerId={selectedAdventurer}\r\n                    onAdventurerTabSelected={handleAdventurerTabSelected}\r\n                />\r\n                <div className=\"adventurer-inventory\">\r\n                    {renderAdventurerContent()}\r\n                </div>\r\n            </div>\r\n        </details>\r\n    );\r\n\r\n};\r\n\r\nexport default WarehouseStructureView;\r\n","\r\nimport ProductionStructureView from \"containers/structures/ProductionStructureView\";\r\nimport { getDefinition, Structure } from \"definitions/structures\";\r\nimport { StructureDefinition, StructureType } from \"definitions/structures/types\";\r\nimport * as React from \"react\";\r\nimport { StructureState } from \"stores/structure\";\r\nimport Progressbar from \"./ui/Progressbar\";\r\nimport ResourceStructureView from './structures/ResourceStructureView';\r\nimport TavernStructureView from './structures/tavern/TavernStructureView';\r\nimport { useSelector } from 'react-redux';\r\nimport { StoreState } from 'stores';\r\nimport { TasksStoreState } from 'stores/tasks';\r\nimport useStructure from 'hooks/store/useStructure';\r\nimport { withWindow } from 'hoc/withWindow';\r\nimport { Props as WindowProps } from \"components/ui/window/Window\";\r\nimport WarehouseStructureView from './structures/warehouse/WarehouseStructureView';\r\nimport { formatDuration } from 'utils/time';\r\nimport \"./css/structuredetailsview.css\";\r\n\r\nexport interface Props {\r\n    structure: Structure;\r\n}\r\n\r\nconst StructureDetailsView = (props: Props & WindowProps) => {\r\n    const tasks = useSelector<StoreState, TasksStoreState>(store => store.tasks);\r\n    const buildTask = tasks.running.filter((val) =>\r\n        val.origin === `town` && val.name === `${props.structure}.build`)[0];\r\n    const structureState = useStructure(props.structure);\r\n\r\n    const renderContent = () => {\r\n        if (structureState.state === StructureState.Building) {\r\n            if (!buildTask) return null;\r\n            return (\r\n                <div className=\"building\">\r\n                    <Progressbar\r\n                        progress={buildTask.progress}\r\n                        label={`Building... (${formatDuration(buildTask.timeRemaining)})`}\r\n                    />\r\n                </div>\r\n            );\r\n        } else {\r\n\r\n            const structureDefinition: StructureDefinition = getDefinition(props.structure);\r\n            switch (structureDefinition.type) {\r\n                case StructureType.production: {\r\n                    return <ProductionStructureView type = { props.structure }/>;\r\n                }\r\n                case StructureType.resource: {\r\n                    return <ResourceStructureView type = { props.structure }/>;\r\n                }\r\n                case StructureType.warehouse: {\r\n                    return <WarehouseStructureView />;\r\n                }\r\n                case StructureType.tavern: {\r\n                    return <TavernStructureView />;\r\n                }\r\n                default: {\r\n                    return <div> { props.structure } </div>;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    return (\r\n        <div className=\"structure-details\">\r\n            { renderContent() }\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default withWindow(StructureDetailsView);\r\n","import * as React from \"react\";\r\nimport \"./background.css\";\r\nimport { useEffect, useRef } from 'react';\r\nimport * as PIXI from \"pixi.js\";\r\nimport { Stage, Sprite, useTick } from '@inlet/react-pixi';\r\n\r\nconst Background = () => {\r\n\r\n    const ref = useRef();\r\n\r\n    const filter = useRef(new PIXI.Filter('', fragmentSrc, uniforms));\r\n    useEffect(() => {\r\n\r\n        // filter.current!.syncUniforms();\r\n        function update(timestamp: number) {\r\n            filter.current!.uniforms.time = (timestamp || 0) / 1000;\r\n            requestAnimationFrame(update);\r\n        }\r\n\r\n        requestAnimationFrame(update);\r\n    },[]);\r\n\r\n    return (\r\n        <Stage width={window.innerWidth} height={window.innerHeight} className=\"background\">\r\n            <Sprite\r\n                image={'https://s3-us-west-2.amazonaws.com/s.cdpn.io/167451/test_BG.jpg'}\r\n                width={window.innerWidth}\r\n                height={window.innerHeight}\r\n                // filters={[filter.current]}\r\n            />\r\n        </Stage>\r\n    )\r\n}\r\nexport default Background;\r\n\r\n\r\nconst uniforms = {\r\n    resolution: {\r\n        type: '2f',\r\n        value: {\r\n        x: window.innerWidth,\r\n        y: window.innerHeight,\r\n        },\r\n    },\r\n    alpha: {\r\n        type: '1f',\r\n        value: 1,\r\n    },\r\n    shift: {\r\n        type: '1f',\r\n        value: 1.6,\r\n    },\r\n    time: {\r\n        type: '1f',\r\n        value: 0,\r\n    },\r\n    speed: {\r\n        type: '2f',\r\n        value: {\r\n        x: 0.7,\r\n        y: 0.4,\r\n        },\r\n    },\r\n};\r\n\r\nconst fragmentSrc = `\r\n    precision mediump float;\r\n    uniform vec2      resolution;\r\n    uniform float     time;\r\n    uniform float     alpha;\r\n    uniform vec2      speed;\r\n    uniform float     shift;\r\n\r\n    float rand(vec2 n) {\r\n        return fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\r\n    }\r\n\r\n    float noise(vec2 n) {\r\n    const vec2 d = vec2(0.0, 1.0);\r\n    vec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\r\n        return mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\r\n    }\r\n\r\n    float fbm(vec2 n) {\r\n    float total = 0.0, amplitude = 1.0;\r\n    for (int i = 0; i < 4; i++) {\r\n        total += noise(n) * amplitude;\r\n        n += n;\r\n        amplitude *= 0.5;\r\n    }\r\n\r\n    return total;\r\n    }\r\n\r\n    void main() {\r\n    const vec3 c1 = vec3(126.0/255.0, 0.0/255.0, 97.0/255.0);\r\n    const vec3 c2 = vec3(173.0/255.0, 0.0/255.0, 161.4/255.0);\r\n    const vec3 c3 = vec3(0.2, 0.0, 0.0);\r\n    const vec3 c4 = vec3(164.0/255.0, 1.0/255.0, 214.4/255.0);\r\n    const vec3 c5 = vec3(0.1);\r\n    const vec3 c6 = vec3(0.9);\r\n\r\n    vec2 p = gl_FragCoord.xy * 8.0 / resolution.xx;\r\n    float q = fbm(p - time * 0.1);\r\n    vec2 r = vec2(fbm(p + q + time * speed.x - p.x - p.y), fbm(p + q - time * speed.y));\r\n    vec3 c = mix(c1, c2, fbm(p + r)) + mix(c3, c4, r.x) - mix(c5, c6, r.y);\r\n    float grad = gl_FragCoord.y / resolution.y;\r\n    gl_FragColor = vec4(c * cos(shift * gl_FragCoord.y / resolution.y), 1.0);\r\n    gl_FragColor.xyz *= 1.0-grad;\r\n    }\r\n`;","\r\nexport const manifest = [\r\n    \"sound/fx/button-click.ogg\",\r\n    \"sound/fx/error.ogg\",\r\n    \"sound/fx/toast.ogg\",\r\n    \"sound/music/Soliloquy.mp3\",\r\n    \"sound/music/TheLoomingBattle.ogg\",\r\n];\r\n","import App, { DispatchProps, Props, StateProps } from \"components/App\";\r\nimport { Dispatch } from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport { AnyAction } from \"redux\";\r\nimport { StoreState } from \"stores\";\r\n\r\nfunction mapStateToProps(store: StoreState, ownProps: Props): StateProps {\r\n    return { };\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch: Dispatch<AnyAction>, ownProps: Props): DispatchProps {\r\n    return { };\r\n}\r\n\r\nexport default connect<StateProps, DispatchProps, Props, StoreState>(mapStateToProps, mapDispatchToProps)(App);\r\n","import seedrandom from \"seedrandom\";\n\nlet generator: seedrandom.prng;\nexport function init(seed: string) {\n    dirty = true;\n    generator = seedrandom(seed, {state: true});\n}\n\nexport function random(): number {\n    if (!generator) { throw new Error(\"Call init() before random()\"); }\n    dirty = true;\n    return generator();\n}\n\n/**\n * Returns a random integer between min (inclusive) and max (inclusive).\n * The value is no lower than min (or the next integer greater than min\n * if min isn't an integer) and no greater than max (or the next integer\n * lower than max if max isn't an integer).\n */\nexport function randomInt(min: number = 0, max: number = 10) {\n    min = Math.ceil(min);\n    max = Math.floor(max);\n    return Math.floor(random() * (max - min + 1)) + min;\n}\n\nexport function state(): seedrandom.State {\n    dirty = false;\n    return generator.state();\n}\n\nexport let dirty = false;\n","import { getDefinition, Structure } from \"definitions/structures\";\r\nimport { ResourceStructureDefinition, ResourceStructureLevelDefinition, StructureType, WarehouseStructureDefinition, WarehouseStructureLevelDefinition } from \"definitions/structures/types\";\r\nimport { StoreState } from \"stores\";\r\nimport { ResourceStoreState } from \"stores/resources\";\r\nimport { StructuresStoreState } from \"stores/structures\";\r\n\r\n// const RESOURCE_INTERVAL = 60000; // every minute constitutes a resource tick. todo: move to some other shared place\r\nconst RESOURCE_INTERVAL = 20000; // every thirty seconds constitutes a resource tick. todo: move to some other shared place\r\n\r\n /*\r\n  * Calculates how many resources are generated by the in the town.\r\n  * Will return a ResourceStoreState with the amount of each resource to add  */\r\nconst getProducedResources = (lastProducedUpdate: number, store: StoreState): ResourceStoreState|null => {\r\n    const structures: StructuresStoreState = store.structures;\r\n    const result: ResourceStoreState = {};\r\n    const factor = ((Date.now() - lastProducedUpdate) / RESOURCE_INTERVAL);\r\n\r\n    // this function can run at different intervals\r\n    // faster or slower than once a minute\r\n    // we will multiply the resource amount by the factor to normalize\r\n    const maxResources = getMaxResources(store);\r\n\r\n    const handleStructure = (structure: string) => {\r\n        const structureDefinition = getDefinition(structure);\r\n\r\n        if (structureDefinition.type === StructureType.resource) {\r\n            const resourceStructureDefinition = structureDefinition as ResourceStructureDefinition;\r\n            const level: number = structures[structure].level;\r\n            const levelDefinition: ResourceStructureLevelDefinition = resourceStructureDefinition.levels[level];\r\n\r\n            // Store all the resources that this structure will generate this tick into `result`\r\n            Object.keys(levelDefinition.generates).reduce((accumulator: ResourceStoreState, resource: string) => {\r\n                const amount: number = levelDefinition.generates[resource] * structures[structure].workers * factor;\r\n                accumulator[resource] = (accumulator[resource] || 0) + amount;\r\n                return accumulator;\r\n            }, result);\r\n        }\r\n    };\r\n\r\n    if (factor < 1) {\r\n        return null;\r\n    }\r\n    // Calculate what each structure generates. Stores in `result`.\r\n    Object.keys(structures).forEach((structure) => handleStructure(structure));\r\n\r\n    // Check if the warehouse can actually hold it\r\n    Object.keys(result).forEach((resource: string) => {\r\n        if (result[resource]) {\r\n            if (store.resources[resource]! + result[resource]! >= maxResources[resource]!) {\r\n                result[resource] = maxResources[resource]! - (store.resources[resource]!);\r\n            }\r\n        }\r\n        // console.log(`Adding: ${resource} ${result[resource]} factor ${factor}`);\r\n    });\r\n\r\n    return result;\r\n};\r\n\r\n// Returns a ResourceStoreState with maximum stockpile of each resource the warehouse supports\r\nconst getMaxResources = (store: StoreState): ResourceStoreState => {\r\n    const structureDefinition = getDefinition<WarehouseStructureDefinition>(Structure.warehouse);\r\n    const level: number = store.structures[Structure.warehouse].level;\r\n    const levelDefinition: WarehouseStructureLevelDefinition = structureDefinition.levels[level];\r\n    return levelDefinition.maxResources;\r\n};\r\n\r\nexport default getProducedResources;\r\n","import { TextEntry } from \"constants/text\";\r\nimport questDefinitions from \"definitions/quests\";\r\nimport { QuestDefinition, QuestNodeType } from 'definitions/quests/types';\r\n\r\nimport { Store } from \"redux\";\r\nimport { StoreState } from \"stores\";\r\nimport { LogChannel } from \"stores/logEntry\";\r\nimport { QuestStatus, QuestStoreState } from \"stores/quest\";\r\nimport { ToastManager } from 'global/ToastManager';\r\nimport { TextManager } from 'global/TextManager';\r\nimport { Type } from 'components/ui/toasts/Toast';\r\nimport { getQuestLeader } from 'storeHelpers';\r\nimport { getQuestLink } from 'utils/routing';\r\nimport { setSceneName } from 'actions/quests';\r\n\r\nexport interface QuestUpdate {\r\n    name: string;\r\n    progress: number;\r\n}\r\n\r\nexport interface LogUpdate extends TextEntry {\r\n    key: string;\r\n    channel: LogChannel;\r\n    channelContext?: any;\r\n}\r\n\r\ninterface QuestGameTickResponse {\r\n    questUpdates: QuestUpdate[];\r\n    logUpdates: LogUpdate[];\r\n}\r\n\r\nconst getQuestUpdates = (delta: number, store: Store<StoreState>): QuestGameTickResponse => {\r\n\r\n    const speed = 4;    // in nodes per minute\r\n    const MS_PER_MINUTE = 60000;\r\n    const log: LogUpdate[] = [];\r\n    const quests: QuestUpdate[] = [];\r\n    const state: StoreState = store.getState();\r\n\r\n    // Moves the quest line progress. Only if currently at a 'nothing' node\r\n    // Otherwise the player has to do something to move the quest along\r\n    state.quests.forEach((quest: QuestStoreState) => {\r\n        if (quest.status !== QuestStatus.active) {\r\n            return;\r\n        }\r\n        const questDefinition: QuestDefinition = questDefinitions[quest.name];\r\n        const currentProgress = quest.progress;\r\n        const currentNodeIndex = Math.floor(currentProgress);\r\n        const currentNode = questDefinition.nodes[currentNodeIndex];\r\n\r\n        if (currentNode.type === QuestNodeType.nothing) {\r\n            // Currently at a 'nothing' node\r\n            const progressIncrease = (delta / MS_PER_MINUTE) * speed;\r\n            // todo: [15/07/2019] speed could be different for each party\r\n            const nextProgress = Math.min(currentProgress + progressIncrease, questDefinition.nodes.length - 1);\r\n            const nodesPassed = Math.floor(nextProgress) - currentNodeIndex;\r\n\r\n            // console.log(nextProgress, nodesPassed)\r\n            for (let i = 1; i <= nodesPassed; i++) {\r\n                // Loop through all the nodes we've passed since last tick\r\n                const nextNode = questDefinition.nodes[currentNodeIndex + i];\r\n//                console.log(`next node: ${QuestNodeType[nextNode.type]}`)\r\n                if (nextNode.type === QuestNodeType.encounter) {\r\n                    // We've hit an encounter node. set the progress to here and stop looking at other nodes\r\n\r\n                    store.dispatch(setSceneName(quest.name, nextNode.startScene!));\r\n\r\n                    const questTitle = TextManager.getQuestTitle(quest.name);\r\n                    const leader = getQuestLeader(state.adventurers, quest);\r\n                    ToastManager.addToast(questTitle, Type.questEncounter, leader?.avatarImg, getQuestLink(quest.name));\r\n\r\n                    // Add quest to log\r\n                    if (nextNode.log) {\r\n                        log.push({\r\n                            channel: LogChannel.quest,\r\n                            channelContext: quest.name,\r\n                            key: nextNode.log,\r\n                        });\r\n                    }\r\n\r\n                    break;\r\n                } else if (nextNode.type === QuestNodeType.nothing) {\r\n                    if (nextNode.log) {\r\n                        log.push({\r\n                            channel: LogChannel.quest,\r\n                            channelContext: quest.name,\r\n                            key: nextNode.log,\r\n                        });\r\n                    }\r\n                }\r\n            }\r\n            quests.push({\r\n                name: quest.name,\r\n                progress: nextProgress,\r\n            });\r\n        }\r\n    });\r\n    return {\r\n        logUpdates: log,\r\n        questUpdates: quests,\r\n    };\r\n};\r\n\r\nexport default getQuestUpdates;\r\n","import { State as seedrandomStateType } from \"seedrandom\";\nimport * as Random from \"utils/random\";\n\nconst getRngState = (): seedrandomStateType | null => {\n    if (Random.dirty) {\n        return Random.state();\n    }\n    return null;\n};\n\nexport default getRngState;\n","// tslint:disable:no-console\n// In production, we register a service worker to serve assets from local cache.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on the 'N+1' visit to a page, since previously\n// cached resources are updated in the background.\n\n// To learn more about the benefits of this model, read https://goo.gl/KwvDNy.\n// This link also includes instructions on opting out of this behavior.\n\nconst isLocalhost = Boolean(\n  window.location.hostname === \"localhost\" ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === \"[::1]\" ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/,\n    ),\n);\n\nexport default function register() {\n  if (process.env.NODE_ENV === \"production\" && \"serviceWorker\" in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL!,\n      window.location.toString(),\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebookincubator/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener(\"load\", () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Lets check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            \"This web app is being served cache-first by a service \" +\n              \"worker. To learn more, visit https://goo.gl/SC7cgQ\",\n          );\n        });\n      } else {\n        // Is not local host. Just register service worker\n        registerValidSW(swUrl);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then((registration) => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker) {\n          installingWorker.onstatechange = () => {\n            if (installingWorker.state === \"installed\") {\n              if (navigator.serviceWorker.controller) {\n                // At this point, the old content will have been purged and\n                // the fresh content will have been added to the cache.\n                // It's the perfect time to display a 'New content is\n                // available; please refresh.' message in your web app.\n                console.log(\"New content is available; please refresh.\");\n              } else {\n                // At this point, everything has been precached.\n                // It's the perfect time to display a\n                // 'Content is cached for offline use.' message.\n                console.log(\"Content is cached for offline use.\");\n              }\n            }\n          };\n        }\n      };\n    })\n    .catch((error) => {\n      console.error(\"Error during service worker registration:\", error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then((response) => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      if (\n        response.status === 404 ||\n        response.headers.get(\"content-type\")!.indexOf(\"javascript\") === -1\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then((registration) => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl);\n      }\n    })\n    .catch(() => {\n      console.log(\n        \"No internet connection found. App is running in offline mode.\",\n      );\n    });\n}\n\nexport function unregister() {\n  if (\"serviceWorker\" in navigator) {\n    navigator.serviceWorker.ready.then((registration) => {\n      registration.unregister();\n    });\n  }\n}\n","// tslint:disable:object-literal-sort-keys\r\nimport { ActionType,\r\n    AssignEquipmentAction,\r\n    InventoryAction,\r\n    MoveItemInInventoryAction,\r\n    MoveItemToOtherAdventurerAction, RemoveEquipmentAction, RemoveItemFromInventoryAction } from \"actions/adventurers\";\r\nimport { EquipmentSlotType } from \"components/ui/EquipmentSlot\";\r\nimport { Item } from \"definitions/items/types\";\r\nimport { AnyAction, Reducer } from \"redux\";\r\nimport { AdventurerStoreState, StatsStoreState } from \"stores/adventurer\";\r\n\r\n/**\r\n * reducer\r\n * @param state\r\n * @param action\r\n */\r\nconst generateRandomStats = (): StatsStoreState => {\r\n    return {\r\n        strength: Math.random() * 100,\r\n        perception: Math.random() * 100,\r\n        endurance: Math.random() * 100,\r\n        charisma: Math.random() * 100,\r\n        intelligenge: Math.random() * 100,\r\n        agility: Math.random() * 100,\r\n        luck: Math.random() * 100,\r\n    };\r\n};\r\n\r\nconst avatarImgBasePath = \"img/avatars\";\r\n// Create a bunch of guys for debugging\r\nconst testState: AdventurerStoreState[] = [{\r\n    id: \"c4a5d270\",\r\n    equipment: {\r\n        chest: Item.chest,\r\n        head: Item.cowl,\r\n    },\r\n    stats: generateRandomStats(),\r\n    health: Math.random() * 100,\r\n    room: 0,\r\n    name: \"Ximena Maddox\",\r\n    avatarImg: `${avatarImgBasePath}/female/f_14.png`,\r\n    // tslint:disable-next-line:max-line-length\r\n    inventory: [ Item.deedForLumbermill, null, Item.crossbow, Item.dagger, Item.khopesh, null, Item.sword, null,  null,  null,  null,  null,  null,  null,  null,  null],\r\n}, {\r\n    id: \"2e655832\",\r\n    equipment: {},\r\n    stats: generateRandomStats(),\r\n    name: \"Donte Houston\",\r\n    health: Math.random() * 100,\r\n    room: 1,\r\n    avatarImg: `${avatarImgBasePath}/male/m_05.png`,\r\n    // tslint:disable-next-line:max-line-length\r\n    inventory: [ Item.crossbow, null, null, null, null, Item.boots1, Item.chainmailHood, Item.nomadHelmet, Item.plateChest4, null, null, null, null, null,  null,  null,  null,  null,  null,  null,  null,  null, Item.plateHelmet, Item.cowl],\r\n}, {\r\n    id: \"ec6f1050\",\r\n    equipment: {},\r\n    stats: generateRandomStats(),\r\n    name: \"Zackary Morris\",\r\n    health: Math.random() * 100,\r\n    room: 2,\r\n    avatarImg: `${avatarImgBasePath}/male/m_09.png`,\r\n    inventory: [ Item.greatswordOfGwai, null, null, null ],\r\n}, {\r\n    id: \"d299f98a\",\r\n    stats: generateRandomStats(),\r\n    equipment: {},\r\n    name: \"Mike Keith\",\r\n    health: Math.random() * 100,\r\n    room: 4,\r\n    avatarImg: `${avatarImgBasePath}/male/m_19.png`,\r\n    inventory: [ null, null, null, null, Item.khopesh, Item.hornedHelmet ],\r\n}, {\r\n    id: \"96c686c3\",\r\n    equipment: {},\r\n    stats: generateRandomStats(),\r\n    name: \"Wayne Monroe\",\r\n    health: Math.random() * 100,\r\n    room: 5,\r\n    avatarImg: `${avatarImgBasePath}/male/m_08.png`,\r\n    inventory: [ null, null, null ],\r\n}, {\r\n    id: \"250d1a9d\",\r\n    stats: generateRandomStats(),\r\n    equipment: {},\r\n    name: \"Alexis Ortiz \",\r\n    health: Math.random() * 100,\r\n    room: 9,\r\n    avatarImg: `${avatarImgBasePath}/female/f_10.png`,\r\n    inventory: [ null, null, null, null, null ],\r\n}, {\r\n    id: \"169384ef\",\r\n    equipment: {},\r\n    stats: generateRandomStats(),\r\n    name: \"Karlee Nolan\",\r\n    health: Math.random() * 100,\r\n    room: 3,\r\n    avatarImg: `${avatarImgBasePath}/female/f_16.png`,\r\n    inventory: [ Item.greatswordOfGwai, null, null, null ],\r\n}, {\r\n    id: \"f22d66cb\",\r\n    stats: generateRandomStats(),\r\n    equipment: {},\r\n    name: \"Gylbarde the Earnest\",\r\n    health: Math.random() * 100,\r\n    room: 8,\r\n    avatarImg: `${avatarImgBasePath}/male/m_09.png`,\r\n    inventory: [ null, null, null, null, null ],\r\n}, {\r\n    id: \"36c686c1\",\r\n    equipment: {},\r\n    stats: generateRandomStats(),\r\n    name: \"Lanslet of the Water\",\r\n    health: Math.random() * 100,\r\n    room: 6,\r\n    avatarImg: `${avatarImgBasePath}/male/m_26.png`,\r\n    inventory: [ Item.greatswordOfGwai, null, null, null, Item.shoulders1, Item.fedora, Item.greaves2 ],\r\n}, {\r\n    id: \"12c613d4\",\r\n    equipment: {},\r\n    stats: generateRandomStats(),\r\n    name: \"Tedric the Bold\",\r\n    health: Math.random() * 100,\r\n    room: 7,\r\n    avatarImg: `${avatarImgBasePath}/male/m_33.png`,\r\n    inventory: [ Item.greatswordOfGwai, null, null, null ],\r\n}];\r\n\r\n// TODO: To generate a random 11 digit number, use: Math.random().toString(36).substring(2)\r\n\r\nexport const adventurers: Reducer<AdventurerStoreState[], AnyAction> = (\r\n    state: AdventurerStoreState[] = testState, action: AnyAction) => {\r\n\r\n    switch (action.type) {\r\n        // Moves an  item from one inventory slot to another\r\n        case ActionType.moveItemInInventory: {\r\n            const {\r\n                adventurerId,\r\n                fromSlot,\r\n                toSlot,\r\n            } = (action as MoveItemInInventoryAction);\r\n            const adventurer = state.find((a) => a.id === adventurerId)!;\r\n            const inventory = adventurer.inventory.map((element, index) => {\r\n                if (index === fromSlot) { return adventurer.inventory[toSlot]; }\r\n                if (index === toSlot) { return adventurer.inventory[fromSlot]; }\r\n                return element;\r\n            });\r\n\r\n            return state.map((element: AdventurerStoreState) => {\r\n                if (element === adventurer) {\r\n                    return {\r\n                        ...element,\r\n                        inventory,\r\n                    };\r\n                }\r\n                return element;\r\n            });\r\n        }\r\n\r\n        case ActionType.moveItemToOtherAdventurer: {\r\n            // Moves an item from one adventurer to another\r\n            const {\r\n                adventurerId: fromAdventurerId,\r\n                fromSlot,\r\n                toAdventurerId,\r\n            } = (action as MoveItemToOtherAdventurerAction);\r\n\r\n            const fromAdventurer = state.find((a) => a.id === fromAdventurerId)!;\r\n            const item = fromAdventurer.inventory[fromSlot];\r\n\r\n            return state.map((element: AdventurerStoreState) => {\r\n                if (element.id === fromAdventurerId) {\r\n                    // Clear out the item from this adventurer\r\n                    const inventory = element.inventory.concat();\r\n                    inventory[fromSlot] = null;\r\n                    return {\r\n                        ...element,\r\n                        inventory,\r\n                    };\r\n                } else if (element.id === toAdventurerId) {\r\n                    // Find first empty slot, add there\r\n                    const inventory = element.inventory.concat();\r\n                    const index = inventory.findIndex((slot) => slot === null);\r\n                    inventory[index] = item;\r\n                    // todo: what if there is no room?\r\n                    return {\r\n                        ...element,\r\n                        inventory,\r\n                    };\r\n                }\r\n                return element;\r\n            });\r\n        }\r\n\r\n        case ActionType.addItemToInventory: {\r\n            const { item } = action as InventoryAction;\r\n\r\n            return state.map((element: AdventurerStoreState) => {\r\n                if (element.id === action.adventurerId) {\r\n                    const inventory = element.inventory.concat();\r\n                    let toSlot = (action as InventoryAction).toSlot;\r\n                    if (toSlot === null || toSlot === undefined) {\r\n                        toSlot = inventory.findIndex((val) => (val === null || val === undefined));\r\n                    }\r\n                    inventory[toSlot!] = item;\r\n                    // todo: check if no space\r\n                    return {\r\n                        ...element,\r\n                        inventory,\r\n                    };\r\n                }\r\n                return element;\r\n            });\r\n        }\r\n\r\n        case ActionType.removeItemFromInventory: {\r\n            const { fromSlot } = action as RemoveItemFromInventoryAction;\r\n\r\n            return state.map((adventurer: AdventurerStoreState) => {\r\n                if (adventurer.id === action.adventurerId) {\r\n                    const inventory = adventurer.inventory.map((element, index) => index !== fromSlot ? element : null);\r\n                    return {\r\n                        ...adventurer,\r\n                        inventory,\r\n                    };\r\n                }\r\n                return adventurer;\r\n            });\r\n        }\r\n\r\n        case ActionType.assignEquipment: {\r\n            // Assigns equipment to an adventurer\r\n            const { equipmentSlot, item } = action as AssignEquipmentAction;\r\n            return state.map((adventurer: AdventurerStoreState) => {\r\n                if (adventurer.id === action.adventurerId) {\r\n                    return {\r\n                        ...adventurer,\r\n                        equipment: {\r\n                            ...adventurer.equipment,\r\n                            [EquipmentSlotType[equipmentSlot]]: item,\r\n                        },\r\n                    };\r\n                }\r\n                return adventurer;\r\n            });\r\n        }\r\n\r\n        case ActionType.removeEquipment: {\r\n            // Assigns equipment to an adventurer\r\n            const { equipmentSlot } = action as RemoveEquipmentAction;\r\n            return state.map((adventurer: AdventurerStoreState) => {\r\n                if (adventurer.id === action.adventurerId) {\r\n                    return {\r\n                        ...adventurer,\r\n                        equipment: {\r\n                            ...adventurer.equipment,\r\n                            [EquipmentSlotType[equipmentSlot]]: null,\r\n                        },\r\n                    };\r\n                }\r\n                return adventurer;\r\n            });\r\n        }\r\n    }\r\n    return state;\r\n};\r\n","// tslint:disable:object-literal-sort-keys\r\n\r\nexport interface EngineStoreState {\r\n    lastTick: number;\r\n    lastProducedUpdate: number;\r\n}\r\n\r\nexport const initialState: EngineStoreState = {\r\n    lastTick: Date.now(),\r\n    lastProducedUpdate: Date.now()\r\n};\r\n","\r\nimport {  ActionType, AddAction, MoveItemInWarehouseAction, RemoveItemFromWarehouseAction } from \"actions/items\";\r\nimport { Item } from \"definitions/items/types\";\r\nimport { AnyAction, Reducer } from \"redux\";\r\n\r\nconst testState = [\r\n    null,\r\n    null,\r\n    null,\r\n    Item.dagger,\r\n    Item.deedForWeaponsmith,\r\n    null,\r\n    Item.sandwich,\r\n    Item.sandwich,\r\n    null,\r\n    null,\r\n    Item.torch,\r\n    Item.torch,\r\n    null,\r\n    Item.torch\r\n];\r\n\r\n// Items in warehouse\r\n\r\n/**\r\n * reducer\r\n * @param state\r\n * @param action\r\n */\r\nexport const items: Reducer<(Item|null)[]> = (state: (Item|null)[] = testState,\r\n                                                 action: AnyAction) => {\r\n    switch (action.type) {\r\n        case ActionType.addItem: {\r\n            // toSlot is optional\r\n            const { item } = (action as AddAction);\r\n            let { toSlot } = (action as AddAction);\r\n            if (toSlot === undefined) {\r\n                toSlot = state.findIndex((slot) => slot === null);  // find first empty element\r\n                if (toSlot === -1) {\r\n                    // Still not found. Add at end\r\n                    // todo: [07/07/2019] GAME DESIGN\r\n                    return [ ...state, item ];\r\n                }\r\n            }\r\n            return state.map((element, index) => index === toSlot ? item : element);\r\n        }\r\n\r\n        case ActionType.moveItemInWarehouse: {\r\n            const {\r\n                fromSlot,\r\n                toSlot,\r\n            } = (action as MoveItemInWarehouseAction);\r\n\r\n            return state.map((element, index) => {\r\n                if (index === fromSlot) { return state[toSlot]; }\r\n                if (index === toSlot) { return state[fromSlot]; }\r\n                return element;\r\n            });\r\n        }\r\n        case ActionType.removeItem: {\r\n            const { fromSlot } = (action as RemoveItemFromWarehouseAction);\r\n\r\n            return state.map((element, index) => index !== fromSlot ? element : null);\r\n        }\r\n    }\r\n\r\n    return state;\r\n};\r\n","import { ActionType as GameActionType, GameTickAction } from \"actions/game\";\r\nimport { ActionType, AddLogEntryAction } from \"actions/log\";\r\nimport { LogUpdate } from \"mechanics/gameTick/quests\";\r\nimport { AnyAction, Reducer } from \"redux\";\r\nimport { LogEntry } from \"stores/logEntry\";\r\n\r\n/**\r\n * reducer\r\n * @param state\r\n * @param action\r\n */\r\nexport const log: Reducer<LogEntry[]> = (state: LogEntry[] = [], action: AnyAction) => {\r\n    switch (action.type) {\r\n        case ActionType.addLogEntry:\r\n            const {entry, channel, channelContext} = (action as AddLogEntryAction);\r\n            const {key, context} = entry;\r\n            const time = Date.now();\r\n            return [{\r\n                    channel,\r\n                    channelContext,\r\n                    context,\r\n                    key,\r\n                    time,\r\n                },\r\n                ...state,\r\n            ];\r\n\r\n        case GameActionType.gameTick:\r\n            return gameTick(state, action as GameTickAction);\r\n    }\r\n    return state;\r\n};\r\n\r\nconst gameTick = (state: LogEntry[], action: GameTickAction): LogEntry[] => {\r\n    if (!action.log.length) {\r\n        return state;\r\n    }\r\n\r\n    // Add log entries\r\n    const logEntries = action.log.map((lU: LogUpdate): LogEntry => {\r\n        return {\r\n            ...lU,\r\n            time: Date.now(),\r\n        };\r\n    });\r\n    return [\r\n        ...logEntries,\r\n        ...state,\r\n    ];\r\n};\r\n","import { ActionType as GameActionType, GameTickAction } from \"actions/game\";\r\nimport { ActionType, QuestAction, QuestLaunchAction, QuestVarsAction, UpdateEncounterResultAction, EnqueueSceneActionAction, SetSceneNameAction, SetSceneAction, UpdateSceneObjectAction, TakeGoldFromCacheAction, TakeItemFromCacheAction } from \"actions/quests\";\r\nimport { Item } from \"definitions/items/types\";\r\nimport { AnyAction, Reducer } from \"redux\";\r\nimport { QuestStatus, QuestStoreState } from \"stores/quest\";\r\nimport { SceneActionType } from 'stores/scene';\r\nimport { QuestDefinition } from 'definitions/quests/types';\r\nimport { getDefinition } from 'definitions/quests';\r\nimport { initialQuestVars } from 'definitions/quests/kill10Boars/questVars';\r\n\r\n// tslint:disable:object-literal-sort-keys\r\nconst initialState: QuestStoreState[] = [{\r\n    name: \"kill10Boars\",\r\n    status: QuestStatus.active,\r\n    party: [\r\n        \"c4a5d270\",\r\n        \"2e655832\",\r\n        \"ec6f1050\",\r\n        \"d299f98a\",\r\n    ],\r\n    progress: 0,\r\n    questVars: initialQuestVars,\r\n    encounterResults: [],\r\n    icon: \"sigil1.png\",\r\n}, {\r\n    name: \"retrieveMagicAmulet\",\r\n    party: [],\r\n    status: QuestStatus.available,\r\n    progress: 0,\r\n    questVars: {},\r\n    encounterResults: [],\r\n    icon: \"sigil2.png\",\r\n    reward: {\r\n        gold: 4,\r\n        items: [ Item.deedForWeaponsmith ],\r\n    },\r\n}];\r\n\r\n/**\r\n * reducer\r\n * @param state\r\n * @param action\r\n */\r\nexport const quests: Reducer<QuestStoreState[]> = (state: QuestStoreState[] = initialState, action: AnyAction ) => {\r\n    switch (action.type) {\r\n        case ActionType.launchQuest:\r\n            return launchQuest(state, action as QuestLaunchAction);\r\n\r\n        case ActionType.exitEncounter:\r\n            return exitEncounter(state, action as QuestAction);\r\n\r\n        case ActionType.updateQuestVars:\r\n            // Updates the questvars\r\n            return updateQuestVars(state, action as QuestVarsAction);\r\n\r\n        case ActionType.updateEncounterResult:\r\n            return updateEncounterResult(state, action as UpdateEncounterResultAction);\r\n\r\n        // case ActionType.startEncounter:\r\n        //     return startEncounter(state, action as StartEncounterAction);\r\n\r\n        case ActionType.setSceneName:\r\n            return setSceneName(state, action as SetSceneNameAction);\r\n\r\n        case ActionType.setScene:\r\n            return setScene(state, action as SetSceneAction);\r\n\r\n        case ActionType.enqueueSceneAction:\r\n            return enqueueSceneAction(state, action as EnqueueSceneActionAction);\r\n\r\n        case ActionType.completeSceneAction:\r\n            return completeSceneAction(state, action as QuestAction);\r\n\r\n        case ActionType.updateSceneObjectAction:\r\n            return updateSceneObjectAction(state, action as UpdateSceneObjectAction);\r\n\r\n        case ActionType.takeGoldFromCache:\r\n            return takeGoldFromCache(state, action as TakeGoldFromCacheAction);\r\n\r\n        case ActionType.takeItemFromCache:\r\n            return takeItemFromCache(state, action as TakeItemFromCacheAction);\r\n\r\n        case GameActionType.gameTick:\r\n           return gameTick(state, action as GameTickAction);\r\n\r\n    }\r\n    return state;\r\n};\r\n\r\n// Launches quest. Sets state to active, assigns adventurers\r\nconst launchQuest = (questStoreState: QuestStoreState[], action: QuestLaunchAction) => {\r\n    const party = action.assignedAventurers\r\n        .filter((adventurer) => !!adventurer)\r\n        .map((adventurer) => adventurer.id);\r\n\r\n    return questStoreState.map((qss) => {\r\n        if (qss.name === action.questName) {\r\n            const questDefinition: QuestDefinition = getDefinition(action.questName);\r\n            const questVars = questDefinition.getInitialQuestVars(qss);\r\n\r\n            return {\r\n                ...qss,\r\n                status: QuestStatus.active,\r\n                party,\r\n                questVars\r\n            };\r\n        }\r\n        return qss;\r\n    });\r\n};\r\n\r\nconst exitEncounter = (state: QuestStoreState[], action: QuestAction) => {\r\n    return state.map((qss) => {\r\n        if (qss.name === action.questName) {\r\n            const progress = qss.progress + 1;\r\n            // const questDefinition: QuestDefinition = questDefinitions[qss.name];\r\n            // const nextNode = questDefinition.nodes[Math.floor(progress)];\r\n\r\n            return {\r\n                ...qss,\r\n                progress,\r\n                scene: undefined,\r\n                sceneName: undefined\r\n            };\r\n        }\r\n        return qss;\r\n    });\r\n};\r\n\r\n// const startEncounter = (state: QuestStoreState[], action: StartEncounterAction) => {\r\n//     const {scene} = action;\r\n//     return state.map((qss) => {\r\n//         if (qss.name === action.questName) {\r\n//             return {\r\n//                 ...qss,\r\n//                 scene\r\n//             };\r\n//         }\r\n//         return qss;\r\n//     });\r\n// };\r\nconst setSceneName = (state: QuestStoreState[], action: SetSceneNameAction) => {\r\n    return state.map((qss) => {\r\n        if (qss.name === action.questName) {\r\n            return {\r\n                ...qss,\r\n                sceneName: action.sceneName\r\n            };\r\n        }\r\n        return qss;\r\n    });\r\n};\r\n\r\nconst setScene = (state: QuestStoreState[], action: SetSceneAction) => {\r\n    return state.map((qss) => {\r\n        if (qss.name === action.questName) {\r\n            return {\r\n                ...qss,\r\n                scene: action.scene\r\n            };\r\n        }\r\n        return qss;\r\n    });\r\n};\r\n\r\n// Enqueues a scene action on this quest\r\nconst enqueueSceneAction = (state: QuestStoreState[], action: EnqueueSceneActionAction) => {\r\n    return state.map((qss) => {\r\n        if (qss.name === action.questName) {\r\n            const scene = qss.scene;\r\n            if (!scene) throw new Error(\"Something broke. No scene\");\r\n            scene.actionQueue = [...scene.actionQueue || [], action.sceneAction];\r\n\r\n            return {\r\n                ...qss,\r\n                scene\r\n            };\r\n        }\r\n        return qss;\r\n    });\r\n};\r\n\r\n// Action on scene is completed\r\nconst completeSceneAction = (state: QuestStoreState[], action: QuestAction) => {\r\n    return state.map((qss) => {\r\n        if (qss.name === action.questName) {\r\n            const scene = qss.scene;\r\n            if (!scene) throw new Error(\"Something broke. No scene\");\r\n            const sceneAction = scene.actionQueue![0];\r\n            if (!sceneAction) return qss;\r\n\r\n            switch (sceneAction.actionType) {\r\n                case SceneActionType.move: {\r\n                    scene.actors = scene.actors.map((a) => {\r\n                        if (a.name === sceneAction.actor) {\r\n                            return { ...a, location: sceneAction.target };\r\n                        }\r\n                        return a;\r\n                    })\r\n                }\r\n            }\r\n\r\n            // pop first action of the stack\r\n            scene.actionQueue = [\r\n                ...scene.actionQueue!.slice(1)\r\n            ];\r\n\r\n            return {\r\n                ...qss,\r\n                scene\r\n            };\r\n        }\r\n        return qss;\r\n    });\r\n};\r\n\r\nconst updateSceneObjectAction = (state: QuestStoreState[], action: UpdateSceneObjectAction) => {\r\n    return state.map((qss) => {\r\n        if (qss.name === action.questName) {\r\n            const scene = qss.scene;\r\n            if (!scene) throw new Error(\"Something broke. No scene\");\r\n\r\n            scene.tileObjects = scene.tileObjects.map(tO => {\r\n                if (tO.id === action.id) {\r\n                    return {\r\n                        ...tO,\r\n                        ...action.object\r\n                    }\r\n                }\r\n                return tO;\r\n            })\r\n\r\n            return {\r\n                ...qss,\r\n                scene\r\n            };\r\n        }\r\n        return qss;\r\n    });\r\n}\r\n\r\n\r\nconst gameTick = (state: QuestStoreState[], action: GameTickAction) => {\r\n    const questsToUpdate = action.quests;\r\n    if (!questsToUpdate.length) {\r\n        return state;\r\n    }\r\n\r\n    return state.map((qss) => {\r\n        const questToUpdate = questsToUpdate.find((q) => q.name === qss.name);\r\n        if (questToUpdate) {\r\n            const progress = questToUpdate.progress;\r\n            // const currentEncounter = questToUpdate.currentEncounter;\r\n\r\n            return {\r\n                ...qss,\r\n                progress,\r\n                // currentEncounter,\r\n            };\r\n        }\r\n        return qss;\r\n    });\r\n};\r\n\r\nconst updateQuestVars = (state: QuestStoreState[], action: QuestVarsAction)  => {\r\n    return state.map((qss) => {\r\n        if (qss.name === action.questName) {\r\n            const questVars = Object.assign({}, qss.questVars, action.vars);\r\n            return {\r\n                ...qss,\r\n                questVars,\r\n            };\r\n        }\r\n        return qss;\r\n    });\r\n};\r\n\r\nconst updateEncounterResult = (state: QuestStoreState[], action: UpdateEncounterResultAction)  => {\r\n    return state.map((qss: QuestStoreState) => {\r\n        if (qss.name === action.questName) {\r\n            const encounterResults = qss.encounterResults.concat();\r\n            encounterResults[action.nodeIndex] = action.result;\r\n            return {\r\n                ...qss,\r\n                encounterResults,\r\n            };\r\n        }\r\n        return qss;\r\n    });\r\n};\r\n\r\nconst takeGoldFromCache = (state: QuestStoreState[], action: TakeGoldFromCacheAction) => {\r\n    return state.map((qss: QuestStoreState) => {\r\n        if (qss.name === action.questName && qss.scene) {\r\n            const lootCaches = {\r\n                ...qss.scene?.caches,\r\n                [action.cacheName]: {\r\n                    ...qss.scene?.caches[action.cacheName],\r\n                    gold: 0\r\n                }\r\n            }\r\n            qss.scene.caches = lootCaches;\r\n        }\r\n        return qss;\r\n    });\r\n}\r\n\r\nconst takeItemFromCache = (state: QuestStoreState[], action: TakeItemFromCacheAction) => {\r\n    return state.map((qss: QuestStoreState) => {\r\n        if (qss.name === action.questName && qss.scene) {\r\n            const cache = qss.scene.caches[action.cacheName];\r\n            const index = cache.items.indexOf(action.item);\r\n            if (index > -1 ) {\r\n                qss.scene.caches[action.cacheName].items = [\r\n                    ...cache.items.slice(0, index),\r\n                    ...cache.items.slice(index + 1)\r\n                ]\r\n            }\r\n        }\r\n        return qss;\r\n    });\r\n}\r\n\r\n// // Call this when the quest has progressed a node. Will return either `log` or a new array\r\n// // with all values of `log` and a new value appended\r\n// const addLogMessage = (log: string[],\r\n//                        currentNode: QuestNode, nextNode: QuestNode, quest: QuestStoreState): string[] => {\r\n//     if (currentNode.type === QuestNodeType.nothing && nextNode.type === QuestNodeType.nothing) {\r\n//         // Moved from a 'nothing' node to a 'nothing' node\r\n//         // There is no need to flood the log with unimportant messages\r\n//         return log;\r\n//     }\r\n//     switch (nextNode.type) {\r\n//         case QuestNodeType.nothing:\r\n//             return [\r\n//                 ...log,\r\n//                 \"The party trrrudges on\",\r\n//             ];\r\n//         case QuestNodeType.encounter:\r\n//             const encounter = nextNode.encounter!;\r\n//             console.log(encounter.getDescription(oracle))\r\n//             //return log;\r\n//             return [\r\n//                 ...log,\r\n//                 encounter.getDescription(oracle),\r\n//             ]\r\n//         default:\r\n//             return log;\r\n//     }\r\n// }\r\n","import { Structure } from \"definitions/structures\";\nimport { StructureState, StructureStoreState, initialState as structureInitialState } from \"./structure\";\n\nexport interface StructuresStoreState {\n    [Structure.alchemist]: StructureStoreState;\n    [Structure.armoursmith]: StructureStoreState;\n    [Structure.garden]: StructureStoreState;\n    [Structure.lumberMill]: StructureStoreState;\n    [Structure.mine]: StructureStoreState;\n    [Structure.quarry]: StructureStoreState;\n    [Structure.tavern]: StructureStoreState;\n    [Structure.tannery]: StructureStoreState;\n    [Structure.warehouse]: StructureStoreState;\n    [Structure.weaponsmith]: StructureStoreState;\n    [Structure.weaver]: StructureStoreState;\n    [Structure.workshop]: StructureStoreState;\n}\n\nexport const initialState: StructuresStoreState = {\n    [Structure.alchemist]: { level: 0, workers: 1, state: StructureState.NotBuilt  },\n    [Structure.armoursmith]: structureInitialState,\n    [Structure.garden]: { level: 0, workers: 0, state: StructureState.Built  }, // TODO: change back to NotBuilt\n    [Structure.lumberMill]: structureInitialState,\n    [Structure.mine]: { level: 0, workers: 0, state: StructureState.NotBuilt  },\n    [Structure.quarry]: structureInitialState,\n    [Structure.tavern]: { level: 0, workers: 0, state: StructureState.Built },\n    [Structure.tannery]: structureInitialState,\n    [Structure.warehouse]: { level: 0, workers: 0, state: StructureState.Built},\n    [Structure.weaponsmith]: { level: 0, workers: 0, state: StructureState.Built },\n    [Structure.weaver]: structureInitialState,\n    [Structure.workshop]: structureInitialState,\n};\n","import { ActionType, StructureStateAction, WorkerCountAction } from \"actions/structures\";\nimport { Structure } from \"definitions/structures\";\nimport { AnyAction, Reducer } from \"redux\";\nimport { StructureState, StructureStoreState } from \"stores/structure\";\nimport { initialState, StructuresStoreState } from \"../stores/structures\";\n\n/**\n * reducer\n * @param state\n * @param action\n */\nexport const structures: Reducer<StructuresStoreState, AnyAction> = (state: StructuresStoreState = initialState,\n                                                                     action: AnyAction) => {\n    switch (action.type) {\n        case ActionType.startBuildingStructure: {\n            return updateStructureState(state, action.structure, StructureState.Building);\n        }\n        case ActionType.finishBuildingStructure: {\n            return updateStructureState(state, action.structure, StructureState.Built);\n        }\n        case ActionType.upgradeStructure: {\n            const level = state[action.structure].level + 1;\n            const structureStore: StructureStoreState = {\n                ...state[action.structure],\n                level,\n            };\n            return    {\n                ...state,\n                [action.structure]: structureStore,\n            };\n        }\n        case ActionType.increaseWorkers: {\n            const { workers: workersToAdd } = action as WorkerCountAction;\n            const workers = state[action.structure].workers + workersToAdd;\n            const structureStore: StructureStoreState = {\n                ...state[action.structure],\n                workers,\n            };\n            return {\n                ...state,\n                [action.structure]: structureStore,\n            };\n        }\n        case ActionType.decreaseWorkers: {\n            const { workers: workersToRemove } = action as WorkerCountAction;\n            const workers = state[action.structure].workers - workersToRemove;\n            const structureStore: StructureStoreState = {\n                ...state[action.structure],\n                workers,\n            };\n            return {\n                ...state,\n                [action.structure]: structureStore,\n            };\n        }\n        case ActionType.setStructureState: {\n            const { state: structureState } = action as StructureStateAction;\n            return updateStructureState(state, action.structure, structureState);\n        }\n\n    }\n    return state;\n};\n\nconst updateStructureState = (state: StructuresStoreState, structure: Structure, structureState: StructureState) => {\n    const structureStore: StructureStoreState = {\n        ...state[structure],\n        state: structureState,\n    };\n    return {\n        ...state,\n        [structure]: structureStore,\n    };\n};\n","import { TaskStoreState } from \"./task\";\n\nexport interface TasksStoreState {\n    running: TaskStoreState[];\n    completed: TaskStoreState[];\n}\nexport const initialState: TasksStoreState = {\n    completed: [],\n    running: [],\n};\n","\r\nimport { ActionType as GameActionType } from \"actions/game\";\r\nimport {  ActionType, AddAction} from \"actions/tasks\";\r\nimport { AnyAction, Reducer } from \"redux\";\r\nimport { TaskStoreState } from \"stores/task\";\r\nimport { initialState, TasksStoreState } from \"stores/tasks\";\r\n\r\n/**\r\n * Tasks reducer\r\n * @param state\r\n * @param action\r\n */\r\nexport const tasks: Reducer<TasksStoreState> = (state: TasksStoreState = initialState,\r\n                                                action: AnyAction ) => {\r\n    switch (action.type) {\r\n        case ActionType.start: {\r\n        // Adds a new task to the running tasks\r\n            const task: TaskStoreState = createTask(action as AddAction);\r\n            const running = state.running.concat(task);\r\n            return {\r\n                ...state,\r\n                running,\r\n            };\r\n        }\r\n        case GameActionType.gameTick: {\r\n            // Will update all tasks in `running`. If a running task expires it is placed in `complete`\r\n            // Note that completed tasks must be handled BEFORE the next call to ActionType.update, because\r\n            // this list is recreated every time\r\n            const now: number = Date.now();\r\n            const running: TaskStoreState[] = [];\r\n            const completed: TaskStoreState[] = [];\r\n            state.running.forEach((t) => {\r\n                const end = now + t.timeRemaining;\r\n                const progress = (now - t.startTime) / (end - t.startTime);\r\n                const timeRemaining = t.timeRemaining - (now - t.lastTick);\r\n                const task = {\r\n                    ...t,\r\n                    progress,\r\n                    lastTick: now,\r\n                    timeRemaining,\r\n                };\r\n                if (timeRemaining < 0) {\r\n                    completed.push(task);\r\n                } else {\r\n                    running.push(task);\r\n                }\r\n            });\r\n\r\n            return {\r\n                running,\r\n                completed,\r\n            };\r\n        }\r\n    }\r\n    return state;\r\n};\r\n\r\nconst createTask = (action: AddAction): TaskStoreState => {\r\n    return {\r\n        name: action.name,\r\n        origin: action.origin,\r\n        type: action.taskType,\r\n        callbacks: action.callbacks,\r\n        timeRemaining: action.time,\r\n        startTime: Date.now(),\r\n        lastTick: Date.now(),\r\n        progress: 0,\r\n    };\r\n};\r\n","import { Item } from \"definitions/items/types\";\r\nimport { combineReducers } from \"redux\";\r\n\r\nimport { ResourceStoreState } from \"stores/resources\";\r\nimport { StoreState } from \"../stores\";\r\nimport { adventurers } from \"./adventurers\";\r\nimport { combat } from \"./combat\";\r\nimport { engine } from \"./engine\";\r\nimport { gold } from \"./gold\";\r\nimport { items } from \"./items\";\r\nimport { log } from \"./log\";\r\nimport { quests } from \"./quests\";\r\nimport { resources } from \"./resources\";\r\nimport { rngState } from \"./rngState\";\r\nimport { structures } from \"./structures\";\r\nimport { tasks } from \"./tasks\";\r\nimport { workers } from \"./workers\";\r\n\r\n// todo: not sure where to place this actually\r\nexport interface CostStoreState {\r\n    gold?: number;\r\n    time?: number;\r\n    resources?: ResourceStoreState;\r\n    materials?: Item[];\r\n}\r\n\r\nexport default combineReducers<StoreState>({\r\n    adventurers,\r\n    combat,\r\n    engine,\r\n    gold,\r\n    stockpile: items,\r\n    log,\r\n    quests,\r\n    resources,\r\n    rngState,\r\n    structures,\r\n    tasks,\r\n    // version,\r\n    workers,\r\n});\r\n","import { ActionType, AddCombatActionAction, MoveActorAction } from \"actions/combat\";\nimport { AnyAction, Reducer } from \"redux\";\nimport { barBrawl, CombatStoreState } from \"stores/combat\";\n\n/**\n * reducer\n * @param state\n * @param action\n */\nexport const combat: Reducer<CombatStoreState> = (state: CombatStoreState = barBrawl, action: AnyAction) => {\n    switch (action.type) {\n        case ActionType.startCombatAction:\n            const addAction = action as AddCombatActionAction;\n\n            return {\n                ...state,\n                action: {\n                    actor: addAction.actor,\n                    endsAt: addAction.endsAt,\n                    target: addAction.target,\n                    type: addAction.combatType,\n                },\n            };\n\n        case ActionType.moveActor:\n            const moveAction = action as MoveActorAction;\n\n            // Moves an actor to another position\n            const actors = state.actors.map((a) => {\n                if (a.name === moveAction.actor) {\n                    return {\n                        ...a,\n                        location: moveAction.location,\n                    };\n                }\n                return a;\n            });\n\n            return {\n                ...state,\n                actors,\n            };\n\n            case ActionType.clearCombatAction:\n            // Clears current combat action\n            return {\n                ...state,\n                action: undefined,\n            };\n    }\n    return state;\n};\n","import { ActionType as GameActionType, GameTickAction } from \"actions/game\";\r\nimport { AnyAction, Reducer } from \"redux\";\r\nimport { EngineStoreState, initialState } from \"stores/engine\";\r\n\r\n/**\r\n * reducer\r\n * @param state\r\n * @param action\r\n */\r\nexport const engine: Reducer<EngineStoreState> = (state: EngineStoreState = initialState, action: AnyAction) => {\r\n    switch (action.type) {\r\n        case GameActionType.gameTick:\r\n\r\n            // Keep track of the last time resources were produced\r\n            const resourcesToAdd = (action as GameTickAction).resources;\r\n            const lastProducedUpdate = resourcesToAdd === null ? state.lastProducedUpdate : Date.now();\r\n            return {\r\n                ...state,\r\n                lastProducedUpdate,\r\n                lastTick: Date.now(),\r\n            };\r\n    }\r\n    return state;\r\n};\r\n","import { ActionType, ModifyGoldAction } from \"actions/gold\";\r\nimport { AnyAction, Reducer } from \"redux\";\r\n\r\n/**\r\n * reducer\r\n * @param state\r\n * @param action\r\n */\r\nexport const gold: Reducer<number> = (state: number = 0, action: AnyAction) => {\r\n    switch (action.type) {\r\n        case ActionType.addGold:\r\n            // Adds (or subtract, if negative) gold from the players gold supply\r\n            return state + (action as ModifyGoldAction).amount;\r\n    }\r\n    return state;\r\n};\r\n","import { ActionType as GameActionType, GameTickAction } from \"actions/game\";\r\nimport { AnyAction, Reducer } from \"redux\";\r\nimport { ActionType, AddResources } from \"../actions/resources\";\r\nimport { initialState, ResourceStoreState } from \"../stores/resources\";\r\n\r\n/**\r\n * reducer\r\n * @param state\r\n * @param action\r\n */\r\nexport const resources: Reducer<ResourceStoreState> = (state: ResourceStoreState = initialState,\r\n                                                       action: AnyAction | GameTickAction) => {\r\n\r\n    const addResources = (resourcesToAdd: ResourceStoreState) => {\r\n        // todo: Check if warehouse can hold it\r\n        return Object.keys(state).reduce((accumulator: object, current: string) => {\r\n            accumulator[current] = state[current] + (resourcesToAdd[current] || 0);\r\n            return accumulator;\r\n        }, {});\r\n    };\r\n\r\n    switch (action.type) {\r\n        case ActionType.addResources: {\r\n            const resourcesToAdd = (action as AddResources).resources;\r\n            return addResources(resourcesToAdd);\r\n        }\r\n        case ActionType.removeResources: {\r\n            const resourcesToRemove = (action as AddResources).resources;\r\n            return Object.keys(state).reduce((accumulator: object, current: string) => {\r\n                accumulator[current] = state[current] - (resourcesToRemove[current] || 0);\r\n                return accumulator;\r\n            }, {});\r\n        }\r\n\r\n        case GameActionType.gameTick: {\r\n            const resourcesToAdd = (action as GameTickAction).resources;\r\n            if (resourcesToAdd === null) {\r\n                return state;\r\n            }\r\n            return addResources(resourcesToAdd);\r\n        }\r\n    }\r\n    return state;\r\n};\r\n","import { ActionType } from \"actions/game\";\r\nimport { AnyAction, Reducer } from \"redux\";\r\nimport { State as seedrandomStateType } from \"seedrandom\";\r\n\r\nconst initialState = false;\r\n/**\r\n * reducer\r\n * @param state\r\n * @param action\r\n */\r\nexport const rngState: Reducer<seedrandomStateType, AnyAction> = (state: seedrandomStateType = initialState,\r\n                                                                  action: AnyAction) => {\r\n    if (action.type === ActionType.gameTick && action.rngState != null) {\r\n        state = Object.assign({}, action.rngState);\r\n    }\r\n    return state;\r\n};\r\n","import { ActionType, ModifyWorkersAction } from \"actions\";\nimport { AnyAction, Reducer } from \"redux\";\n\n/**\n * reducer\n * @param state\n * @param action\n */\nexport const workers: Reducer<number> = (state: number = 13, action: AnyAction) => {\n    switch (action.type) {\n        case ActionType.addWorkers:\n            // Adds (or subtract, if negative) from the players workers\n            return state + (action as ModifyWorkersAction).value;\n    }\n    return state;\n};\n","import rootReducer from \"reducers/index\";\r\nimport { createStore, DeepPartial, AnyAction } from \"redux\";\r\nimport { Persistor, persistReducer, persistStore } from \"redux-persist\";\r\nimport localForage from 'localforage';\r\nimport { storeIsRehydrated } from \"storeHelpers\";\r\nimport { StoreState } from \"stores\";\r\nimport { PersistPartial } from 'redux-persist/lib/persistReducer';\r\nimport { asInt } from \"constants/version\";\r\n\r\nconst persistConfig = {\r\n    key: \"root\",\r\n    storage: localForage,\r\n    version: asInt,\r\n};\r\n\r\nconst persistedReducer = persistReducer<StoreState, AnyAction>(persistConfig, rootReducer);\r\n\r\ninterface ConfigureStoreResult {\r\n    store: any;\r\n    persistor: Persistor;\r\n    isHydrated: boolean;\r\n}\r\n/**\r\n * Configures the redux store\r\n */\r\nexport default async (initial: DeepPartial<StoreState> = {}): Promise<ConfigureStoreResult> => {\r\n    return new Promise((resolve, reject) => {\r\n        const store = createStore<StoreState & PersistPartial, AnyAction, any, StoreState>(\r\n            persistedReducer,\r\n            initial,\r\n            (window as any).__REDUX_DEVTOOLS_EXTENSION__ && (window as any).__REDUX_DEVTOOLS_EXTENSION__(),\r\n        );\r\n        const persistor = persistStore(store, undefined, () => {\r\n            const isHydrated = storeIsRehydrated(store.getState());\r\n            resolve({ store, persistor, isHydrated }) ;\r\n        });\r\n    });\r\n};\r\n","import { TaskStoreState, TaskType } from 'stores/task';\r\nimport { TasksStoreState } from 'stores/tasks';\r\nimport { AnyAction, Dispatch } from \"redux\";\r\nimport { ToastManager } from 'global/ToastManager';\r\nimport { TextManager } from 'global/TextManager';\r\nimport { Type } from 'components/ui/toasts/Toast';\r\nimport { getDefinition } from 'definitions/items';\r\nimport { Item } from 'definitions/items/types';\r\n\r\nexport const processCompletedTasks = (tasks: TasksStoreState, dispatch: Dispatch<AnyAction>) => {\r\n    const handleCompletedTask = (task: TaskStoreState) => {\r\n        // Fire all callbacks\r\n        task.callbacks.forEach((action) => dispatch(action));\r\n\r\n        switch (task.type) {\r\n            case TaskType.craftItem:\r\n                const item = task.name as Item;\r\n                const title = TextManager.get(\"common-item-crafted\", { item });\r\n                const definition = getDefinition(item);\r\n                ToastManager.addToast(title, Type.itemCrafted, definition.iconImg);\r\n                break;\r\n        }\r\n    };\r\n\r\n    tasks.completed.forEach((task) => handleCompletedTask(task));\r\n};","import updateCombat from \"mechanics/gameTick/combat\";\r\nimport * as React from \"react\";\r\nimport * as ReactDOM from \"react-dom\";\r\nimport { Provider } from \"react-redux\";\r\nimport { Persistor } from \"redux-persist\";\r\nimport { gameTick } from \"./actions/game\";\r\nimport { addLogText } from \"./actions/log\";\r\nimport version from \"./constants/version\";\r\nimport App from \"./containers/App\";\r\nimport getProducedResources from \"./mechanics/gameTick/producedResources\";\r\nimport getQuestUpdates, { LogUpdate } from \"./mechanics/gameTick/quests\";\r\nimport getRngState from \"./mechanics/gameTick/rngState\";\r\nimport registerServiceWorker from \"./registerServiceWorker\";\r\nimport { StoreState } from \"./stores\";\r\nimport configureStore from \"./utils/configureStore\";\r\nimport * as Random from \"./utils/random\";\r\nimport { TextManager } from \"./global/TextManager\";\r\nimport { loadResourceAsync } from 'utils/pixiJs';\r\nimport { processCompletedTasks } from 'mechanics/gameTick/tasks';\r\nimport \"./index.css\";\r\n\r\nconst TICK_INTERVAL = 2500;\r\n\r\nconst initGame = async () => {\r\n    const texts = await loadResourceAsync(`${process.env.PUBLIC_URL}/lang/en-US.json`);\r\n    TextManager.init(texts.data);\r\n    Random.init(\"GILLESROX2\");\r\n\r\n    const { store, persistor, isHydrated } = await configureStore();\r\n    if (!isHydrated) {\r\n        startNewGame(store);\r\n    } else {\r\n        continueGame(store);\r\n    }\r\n    runGame(store, persistor);\r\n};\r\n\r\n/**\r\n * Gets called when a player starts a new game\r\n * @param store\r\n */\r\nconst startNewGame = (store: any) => {\r\n\r\n    store.dispatch(addLogText(\"test-game-welcome\"));\r\n    // todo: here is a good place to launch a tutorial or something\r\n\r\n    // tslint:disable-next-line:no-console\r\n    console.log(`Starting new GILLES-IDLE-GAME (version ${version})`);\r\n};\r\n\r\nconst continueGame = (store: any) => {\r\n    // tslint:disable-next-line:no-console\r\n    console.log(`Continuing existing GILLES-IDLE-GAME (version ${version})`);\r\n};\r\n\r\n// const stopGame = () => {\r\n//     clearTimeout(interval);\r\n// };\r\n\r\nconst runGame = (store: any, persistor: Persistor) => {\r\n    ReactDOM.render((\r\n        <Provider store={store}>\r\n            <App persistor={persistor} />\r\n        </Provider>\r\n    ),\r\n        document.getElementById(\"root\") as HTMLElement,\r\n    );\r\n    registerServiceWorker();\r\n\r\n    const gameLoop = () => {\r\n        const state: StoreState = store.getState();\r\n        const delta = Date.now() - state.engine.lastTick;\r\n\r\n        const logs: LogUpdate[] = [];\r\n        const resourcesUpdates = getProducedResources(state.engine.lastProducedUpdate, state);\r\n        const rngState = getRngState();\r\n        updateCombat(delta, store);\r\n        const { questUpdates, logUpdates } = getQuestUpdates(delta, store);\r\n        logs.push(...logUpdates);\r\n\r\n        store.dispatch(gameTick(delta, rngState, resourcesUpdates, questUpdates, logs));\r\n\r\n        processCompletedTasks(state.tasks, store.dispatch);\r\n\r\n        // store.dispatch(addLogEntry(\"test-you-have-found-an-item\", LogChannel.common, { item: Item.teeth }));\r\n    };\r\n\r\n    setInterval(gameLoop, TICK_INTERVAL);\r\n};\r\n\r\ninitGame();\r\n","import { TiledMapData, TiledObjectData, TiledLayerType, TiledProperty, TiledLayerData } from 'constants/tiledMapData';\r\n\r\n/* Tiled doesnt export the tile location of an Object. This function calculates it based on x and y.\r\n* Also returns a convenience object with all properties\r\n*/\r\nexport const getExtendedTilemapObjects = (tilemapData: TiledMapData) => {\r\n    const objectLayers = tilemapData.layers.filter(layer => layer.type === TiledLayerType.objectgroup);\r\n    const objects: { [key: string]: ExtendedTiledObjectData } = {};\r\n    objectLayers.forEach(objectLayer => {\r\n        objectLayer.objects.reduce((acc: {[location: string]: ExtendedTiledObjectData}, value: TiledObjectData) => {\r\n            let {x, y} = value;\r\n            if (value.gid !== undefined) {\r\n                y -= value.height; // https://github.com/bjorn/tiled/issues/91\r\n            }\r\n            const location: [number, number] = [\r\n                x / tilemapData.tilewidth,\r\n                y / tilemapData.tileheight\r\n            ];\r\n            // reduce the props array into an object with key/values\r\n            const ezProps = parseProperties(value.properties);\r\n            const extended: ExtendedTiledObjectData = {\r\n                location,\r\n                ezProps,\r\n                ...value\r\n            };\r\n            acc[`${location[0]},${location[1]}`] = extended; // todo: what if object alraedy exists at this location?\r\n            return acc;\r\n        }, objects);\r\n    });\r\n    return objects;\r\n}\r\n\r\n// Unpack array of properties into key/value object for fast retrieval\r\nconst parseProperties = (properties?: TiledProperty[]) => {\r\n    if (!properties) return;\r\n    return properties.reduce((acc: {[key: string]: any}, value: TiledProperty) => {\r\n        acc[value.name] = value.value;\r\n        return acc;\r\n    }, {});\r\n}\r\n\r\nexport type ExtendedTiledObjectData = TiledObjectData & {\r\n    location: [number, number];\r\n    ezProps?: { [key: string]: any}\r\n}\r\n\r\n/** Add tiles in this layer to list */\r\nexport const addAllTilesInLayerToList = (list: [number, number][], layer: TiledLayerData, columns: number) => {\r\n    layer.data.reduce((acc: [number, number][], tile, index) => {\r\n        if (tile > 0) {\r\n            const x = (index % columns);\r\n            const y = Math.floor(index / columns);\r\n            acc.push([x, y]);\r\n        }\r\n        return acc;\r\n    }, list);\r\n}\r\n\r\nexport const locationEquals = (a: [number, number], b: [number, number]) => {\r\n    return a[0] === b[0] && a[1] === b[1];\r\n}","import { Store, AnyAction } from \"redux\";\r\nimport { getExtendedTilemapObjects, ExtendedTiledObjectData, addAllTilesInLayerToList, locationEquals } from 'utils/tilemap';\r\nimport { adventurersOnQuest } from 'storeHelpers';\r\nimport { StoreState } from 'stores';\r\nimport { loadResource } from 'utils/pixiJs';\r\nimport { TiledMapData } from 'constants/tiledMapData';\r\nimport { AStarFinder } from 'astar-typescript';\r\nimport { AdventurerStoreState } from 'stores/adventurer';\r\nimport { setScene, setSceneName, exitEncounter } from 'actions/quests';\r\nimport { TileObject, ActorObject, LootCache } from 'stores/scene';\r\nimport { ToastManager } from 'global/ToastManager';\r\nimport { Type } from 'components/ui/toasts/Toast';\r\nimport { getQuestLink } from 'utils/routing';\r\nimport { TextEntry, isTextEntry } from 'constants/text';\r\nimport { TextManager } from 'global/TextManager';\r\nimport { addLogText, addLogEntry } from 'actions/log';\r\nimport { getDefinition } from 'definitions/quests';\r\nimport { LogChannel } from 'stores/logEntry';\r\nimport { Item } from 'definitions/items/types';\r\n\r\nexport class BaseSceneController<TQuestVars> {\r\n    public mapData?: TiledMapData;\r\n    public aStar?: AStarFinder;\r\n    public questName: string;\r\n    public tilemapObjects?: {[location: string]: ExtendedTiledObjectData};\r\n\r\n    protected jsonPath?: string;\r\n    protected store: Store<StoreState, AnyAction>;\r\n    protected blockedTiles: [number, number][] = [];\r\n\r\n    constructor(store: Store<StoreState, AnyAction>, questName: string) {\r\n        this.store = store;\r\n        this.questName = questName;\r\n    }\r\n\r\n    get basePath(): string | null {\r\n        if (!this.jsonPath) return null;\r\n        return `${process.env.PUBLIC_URL}/${this.jsonPath.substr(0, this.jsonPath.lastIndexOf('/'))}`;\r\n    }\r\n\r\n    get dataLoaded(): boolean {\r\n        return !!this.mapData;\r\n    }\r\n\r\n    loadData(callback: () => void) {\r\n        if (this.dataLoaded) {\r\n            return callback();\r\n        }\r\n        if (!this.jsonPath) {\r\n            throw new Error(\"No jsonPath defined!\");\r\n        }\r\n\r\n        loadResource(`${process.env.PUBLIC_URL}/${this.jsonPath}`, (resource) => {\r\n            this.mapData = resource.data;\r\n            this.tilemapObjects = getExtendedTilemapObjects(resource.data);\r\n            this.mapData!.layers.filter(layer => layer.visible).forEach(layer => {\r\n                if (layer.properties && layer.properties.some(p => p.name === 'blocksMovement' && p.value === true)){\r\n                    addAllTilesInLayerToList(this.blockedTiles, layer, layer.width);\r\n                }\r\n            });\r\n\r\n            this.aStar = this.createAStar();\r\n\r\n            callback();\r\n        });\r\n    }\r\n\r\n    // Constructs the scene and dispatches it to be saved to the store\r\n    createScene() {\r\n        const tileObjects = this.createTileObjects();\r\n        const actors = this.createActors();\r\n        const caches = this.createCaches();\r\n\r\n        // todo: perhaps this should be a class such that stuff that repeats for every scene can be done in a base class\r\n        const scene = {\r\n            tileObjects,\r\n            actors,\r\n            caches\r\n        }\r\n        this.store.dispatch(setScene(this.questName, scene));\r\n    }\r\n\r\n    // tslint:disable-next-line: no-empty\r\n    sceneEntered() {\r\n    }\r\n\r\n    actorMoved(actor: string, location: [number, number]) {\r\n        const object = this.tilemapObjects![`${location[0]},${location[1]}`];\r\n        if (!object) return;\r\n\r\n\r\n        if (object.type === \"exit\") {\r\n            // We've hit the exit. Should we load another scene?\r\n            if (object.ezProps?.loadScene) {\r\n                this.store.dispatch(setSceneName(this.questName, object.ezProps.loadScene))\r\n            } else {\r\n                // Or exit the encounter\r\n                const index = Math.floor(this.getQuest().progress) + 1;\r\n                const definition = getDefinition(this.questName);\r\n                const node = definition.nodes[index];\r\n                if (node.log) {\r\n                    // If the next node has a log entry, add it\r\n                    this.store.dispatch(addLogText(node.log, null, LogChannel.quest, this.questName));\r\n                }\r\n                this.store.dispatch(exitEncounter(this.questName));\r\n            }\r\n        }\r\n    }\r\n\r\n    actorCanInteract(actorName: string) {\r\n        const {scene} = this.getQuest();\r\n        const actor = scene?.actors.find(o => o.name === actorName)!;\r\n        const object = scene?.tileObjects\r\n            .find(o => locationEquals(o.location, actor.location));\r\n\r\n        // todo: should we look for some specific property?\r\n        return !!object;\r\n    }\r\n\r\n    actorInteract(actorName: string) {\r\n        if (!this.actorCanInteract(actorName)) {\r\n            // tslint:disable-next-line: no-console\r\n            console.warn(\"Can't interact\");\r\n            return;\r\n        }\r\n        const {scene} = this.getQuest();\r\n        const actor = scene?.actors.find(o => o.name === actorName)!;\r\n        const object = scene?.tileObjects\r\n            .find(o => locationEquals(o.location, actor.location));\r\n\r\n        if (!object || object.type !== \"tileobject\") {\r\n            // tslint:disable-next-line: no-console\r\n            console.warn(\"No object found\");\r\n            return;\r\n        }\r\n\r\n        this.interactWithObject(actor, object);\r\n    }\r\n\r\n    interactWithObject(_actor: ActorObject, _object: TileObject) {\r\n        // override\r\n    }\r\n\r\n    // Converts pixel coordinate to scene location\r\n    pointToSceneLocation (point: PIXI.Point): [number, number] {\r\n        if (!this.mapData?.tilewidth || !this.mapData?.tileheight) {\r\n            return [0, 0];\r\n        }\r\n        return [Math.floor(point.x / this.mapData.tilewidth), Math.floor(point.y / this.mapData.tilewidth)];\r\n    }\r\n\r\n    // Returns true if the tile is blocked\r\n    locationIsBlocked(location: [number, number]){\r\n        return this.blockedTiles.some((l) => locationEquals(l, location));\r\n    }\r\n\r\n    protected createAStar() {\r\n        const matrix: number[][] = [];\r\n        for (let y = 0; y < this.mapData!.height; y++) {\r\n            const row: number[] = [];\r\n            for (let x = 0; x < this.mapData!.width; x++) {\r\n                const location: [number, number] = [x, y];\r\n                const blocked = this.locationIsBlocked(location);\r\n                row.push(blocked ? 1 : 0);\r\n            }\r\n            matrix.push(row);\r\n        }\r\n        return new AStarFinder({\r\n            grid: {\r\n                matrix\r\n            },\r\n            includeStartNode: false,\r\n            heuristic: \"Manhatten\",\r\n            weight: 0,\r\n        });\r\n    }\r\n\r\n    protected createActors(): ActorObject[] {\r\n\r\n        if (!this.tilemapObjects) {\r\n            throw new Error(\"No tilemapObjects\");\r\n        }\r\n\r\n        const adventurers = this.getAdventurers();\r\n\r\n        const startLocations = Object.values(this.tilemapObjects)\r\n            .filter(o => o.type === \"adventurerStart\")\r\n            .map(o => o.location);\r\n        if (adventurers.length > startLocations.length) {\r\n            throw new Error(\"Not enough objects with 'adventurerStart' property set to true\");\r\n        }\r\n        return adventurers.reduce((acc: ActorObject[], value: AdventurerStoreState, index: number) => {\r\n            const location = startLocations[index];\r\n            acc.push({\r\n                health: 100,\r\n                location,\r\n                name: value.id,\r\n            })\r\n            return acc;\r\n        }, []);\r\n    }\r\n\r\n    protected createTileObjects(): TileObject[] {\r\n        if (!this.tilemapObjects) {\r\n            throw new Error(\"No tilemapObjects\");\r\n        }\r\n\r\n        return Object.values(this.tilemapObjects)\r\n            .map(o => ({\r\n                id: o.id,\r\n                gid: o.gid!,\r\n                location: o.location,\r\n                name: o.name,\r\n                type: o.type\r\n            }));\r\n    }\r\n\r\n    protected createCaches(): { [name: string]: LootCache } {\r\n        return Object.values(this.tilemapObjects!)\r\n            .filter(o => o.type === \"lootCache\")\r\n            .reduce((acc: { [name: string]: LootCache }, value) => {\r\n                // serialize comma separated string to array of Item\r\n                const items = value.ezProps?.items.split(\",\").map((v:string) => {\r\n                    const item = Item[v.trim()];\r\n                    if (item) {\r\n                        return item;\r\n                    }\r\n                }).filter(Boolean);\r\n                acc[value.name] = {\r\n                    title: value.ezProps?.title,\r\n                    items\r\n                }\r\n                return acc;\r\n            }, {});\r\n    }\r\n\r\n    protected getQuest() {\r\n        const storeState = this.store.getState();\r\n        return storeState.quests.find(q => q.name === this.questName)!;\r\n    }\r\n\r\n    protected getQuestVars(): TQuestVars {\r\n        return this.getQuest().questVars;\r\n    }\r\n\r\n    protected getAdventurers() {\r\n        const storeState = this.store.getState();\r\n        const quest = this.getQuest();\r\n        return adventurersOnQuest(storeState.adventurers, quest);\r\n    }\r\n\r\n    protected getAdventurerByActor(actor: ActorObject) {\r\n        const storeState = this.store.getState();\r\n        return storeState.adventurers.find(a => a.id === actor.name);\r\n    }\r\n\r\n    protected questUpdate(input: string | TextEntry, icon?: string) : void {\r\n        const textEntry: TextEntry = isTextEntry(input) ? input : {key: input};\r\n        const title = TextManager.getTextEntry(textEntry);\r\n        ToastManager.addToast(title, Type.questUpdate, icon, getQuestLink(this.questName));\r\n        this.store.dispatch(addLogEntry(textEntry, LogChannel.quest, this.questName));\r\n    }\r\n}\r\n","export interface TextEntry {\r\n    key: string;\r\n    context?: any;\r\n}\r\n\r\nexport function isTextEntry(test: any): test is TextEntry {\r\n    return typeof test.key === 'string';\r\n}","import { BaseSceneController } from 'mechanics/scenes/BaseSceneController';\r\nimport { SceneControllerManager } from 'global/SceneControllerManager';\r\nimport { TileObject, ActorObject } from 'stores/scene';\r\nimport { updateSceneObjectAction } from 'actions/quests';\r\nimport { Kill10BoarsQuestVars } from '../questVars';\r\n// tslint:disable: max-classes-per-file\r\n\r\nconst TILE_CHEST_CLOSED = 33; // todo: take this from json?\r\nconst TILE_CHEST_OPEN = 34; // todo: take this from json?\r\n\r\nexport class DungeonEntranceSceneController extends BaseSceneController<Kill10BoarsQuestVars> {\r\n    jsonPath = \"scenes/ork-dungeon-level1.json\";\r\n\r\n    interactWithObject(actor: ActorObject, object: TileObject) {\r\n        switch (object.name) {\r\n            // todo: I want to share this common stuff with other SceneControllers\r\n            case \"chest\":\r\n                if (object.gid === TILE_CHEST_CLOSED) {\r\n                    const adventurer = this.getAdventurerByActor(actor)?.name;\r\n                    const textEntry = { key: \"quest-common-adventurer-opened-chest\", context: { adventurer } };\r\n                    this.questUpdate(textEntry, \"/img/items/misc/chest-02.png\");\r\n                    this.store.dispatch(updateSceneObjectAction(this.questName, object.id, { gid: TILE_CHEST_OPEN }));\r\n                }\r\n                // display loot modal!\r\n                break;\r\n        }\r\n        super.interactWithObject(actor, object);\r\n    }\r\n\r\n    sceneEntered() {\r\n        const vars = this.getQuestVars();\r\n        if (!vars.dungeon.entered) {\r\n            this.questUpdate(\"quest-kill10Boars-enter-dungeon-see-chest\");\r\n        }\r\n    }\r\n}\r\n\r\nexport class DungeonHallwaySceneController extends BaseSceneController<Kill10BoarsQuestVars> {\r\n    jsonPath = \"scenes/ork-dungeon-level2.json\";\r\n}\r\n\r\nSceneControllerManager.registerSceneController(\"kill10Boars\", \"dungeon.entrance\", DungeonEntranceSceneController as any);\r\nSceneControllerManager.registerSceneController(\"kill10Boars\", \"dungeon.hallway\", DungeonHallwaySceneController as any);\r\n"],"sourceRoot":""}