{"version":3,"sources":["global/TextManager.ts","components/ui/adventurer/EquipmentSlot/index.tsx","utils/format/time.ts","global/SoundManager.ts","store/types/scene.ts","definitions/items/weapons.ts","definitions/quests/types.ts","definitions/items/types.ts","components/ui/common/Icon/index.tsx","constants/items.ts","constants/dragging.ts","store/actions/quests.ts","definitions/items/herbs.ts","definitions/items/materials.ts","definitions/items/minerals.ts","definitions/items/trinkets.ts","definitions/items/index.ts","utils/routing.ts","store/actions/adventurers.ts","definitions/effects/types.ts","utils/tilemap.ts","store/types/logEntry.ts","global/ToastManager.tsx","definitions/tempEffects/types.ts","components/ui/toasts/Toast.tsx","mechanics/adventurers/levels.ts","mechanics/combat.ts","global/BubbleManager.ts","store/helpers/storeHelpers.ts","definitions/items/consumables.ts","definitions/quests/index.ts","definitions/quests/kill10Boars/index.ts","definitions/quests/retrieveMagicAmulet/index.ts","store/actions/log.ts","definitions/items/apparel.ts","utils/pixiJs.ts","store/actions/gold.ts","utils/random.ts","definitions/items/deeds.ts","global/SceneControllerManager.ts","definitions/items/ammunition.ts","definitions/items/questItems.ts","constants/tiledMapData.ts","definitions/enemies/trolls.ts","definitions/enemies/index.ts","definitions/quests/kill10Boars/questVars.ts","constants/text.ts","utils/aStar.ts","mechanics/scenes/BaseSceneController.ts","definitions/quests/kill10Boars/encounters/dungeon.ts","store/types/structure.ts","store/actions/game.ts","utils/version.ts","constants/version.ts","utils/pixiJs/hitAreaShapes.ts","components/town/structures/LumberMill/LumberMill.tsx","components/pixi/ParticleEmitter.ts","components/town/structures/Tavern/index.tsx","hoc/withAppContext.tsx","components/town/structures/Generic/index.tsx","components/pixi/Viewport.tsx","components/App/styles/img/cursors/dwarven_gauntlet_extra_6.png","components/pixi/util/BridgedStage.tsx","components/town/TownStage.tsx","definitions/structures/types.ts","components/town/Clouds.tsx","definitions/structures/alchemist.ts","definitions/resources/index.ts","definitions/structures/armoursmith.ts","definitions/structures/garden.ts","definitions/structures/lumberMill.ts","definitions/structures/mine.ts","definitions/structures/quarry.ts","definitions/structures/tannery.ts","definitions/structures/tavern.ts","definitions/structures/warehouse.ts","definitions/structures/weaponsmith.ts","definitions/structures/weaver.ts","definitions/structures/workshop.ts","definitions/structures/index.ts","hooks/store/structures.ts","components/ui/buttons/Button/Button.tsx","components/ui/common/progress/PlainProgressbar.tsx","components/ui/window/Window.tsx","hoc/withWindow.tsx","hooks/store/engine.ts","components/ui/common/progress/TickingProgressbar.tsx","hooks/usePrevious.ts","constants/context.ts","store/selectors/tasks.ts","hooks/store/useTasksState.ts","components/structures/StructureViewHeader.tsx","components/ui/buttons/IconButton/IconButton.tsx","components/structures/StructureLevel.tsx","global/TooltipManager.ts","store/types/task.ts","components/ui/items/ItemIcon/ItemIcon.tsx","components/ui/common/UpDownValue/index.tsx","hooks/store/stockpile.ts","components/ui/items/ItemsBox.tsx","store/selectors/resources.ts","hooks/store/resources.ts","hooks/store/useGoldState.ts","components/structures/production/ResourcesCost.tsx","store/selectors/workers.ts","hooks/store/useWorkersState.ts","mechanics/crafting.ts","definitions/production/weaponsmith.ts","definitions/production/armoursmith.ts","definitions/production/workshop.ts","definitions/production/index.ts","store/actions/stockpile.ts","store/actions/resources.ts","store/actions/structures.ts","store/actions/tasks.ts","components/structures/production/CraftingDetails.tsx","store/types/quest.ts","components/structures/production/CraftingArea.tsx","components/structures/UpgradeHelpModal.tsx","components/structures/production/UpgradeHelpModalContent.tsx","components/structures/production/ProductionStructureView.tsx","utils/format/number.ts","components/structures/warehouse/ResourcesBox.tsx","store/types/resources.ts","components/ui/tabs/Tabstrip.tsx","components/ui/tabs/Tab.tsx","components/ui/adventurer/AdventurerAvatar/index.tsx","components/world/QuestPanel/AdventurerTabstrip.tsx","hooks/store/adventurers.ts","components/ui/inventory/InventorySlot.tsx","components/ui/items/DraggableItemIcon.tsx","definitions/traits/types.ts","components/ui/inventory/Inventory.tsx","components/ui/loading/LoadingSpinner.tsx","components/world/QuestPanel/context/SceneControllerContext.tsx","hooks/actions/useItemActions.ts","components/ui/adventurer/AdventurerPanel/AdventurerSkills/index.tsx","components/ui/adventurer/AdventurerPanel/Level.tsx","utils/reselect.ts","hooks/store/quests.ts","components/ui/adventurer/AdventurerPanel/ApIndicator.tsx","definitions/traits/index.ts","store/types/adventurer.ts","components/ui/adventurer/AdventurerPanel/AdventurerTraits/AdventurerTraits.tsx","components/ui/adventurer/AdventurerPanel/AdventurerEquipment/Guy/Guy.tsx","components/ui/adventurer/AdventurerPanel/AdventurerEquipment/AdventurerEquipment.tsx","mechanics/adventurers/hitpoints.ts","components/ui/adventurer/AdventurerPanel/Health.tsx","utils/typescript.ts","definitions/effects/index.ts","mechanics/adventurers/attributes.ts","components/ui/adventurer/AdventurerPanel/Attributes.tsx","components/ui/adventurer/AdventurerPanel/ConsumeItemSlot.tsx","components/ui/adventurer/AdventurerPanel/ConsumeItem.tsx","components/ui/adventurer/AdventurerPanel/AdventurerEffects/EffectIcon.tsx","components/ui/adventurer/AdventurerPanel/AdventurerEffects/AdventurerTempEffects.tsx","hooks/store/settings.ts","hooks/store/useDraggable.ts","components/ui/modals/InfoWindow/DraggableInfoWindow.tsx","components/ui/adventurer/AdventurerPanel/DebugAdventurerEdit.tsx","components/ui/adventurer/AdventurerPanel/AdventurerPanel.tsx","components/ui/adventurer/AdventurerPanel/AdventurerSectionSelection.tsx","components/ui/adventurer/AdventurerPanel/styles/images/icon-person.png","components/ui/adventurer/AdventurerPanel/styles/images/icon-crosshair.png","components/ui/adventurer/AdventurerPanel/styles/images/icon-helmet.png","components/ui/adventurer/AdventurerPanel/styles/images/icon-sword.png","components/structures/warehouse/UpgradeHelpModalContent.tsx","components/structures/warehouse/Stockpile.tsx","components/structures/warehouse/WarehouseStructureView.tsx","components/ui/adventurer/DroppableAdventurerSlot/index.tsx","components/structures/tavern/AssignAdventurers.tsx","components/structures/tavern/QuestBoard.tsx","components/structures/tavern/rooms/AdventurerButton.tsx","components/ui/adventurer/DraggableAdventurerAvatar/index.tsx","components/structures/tavern/rooms/RoomWithAdventurer.tsx","components/structures/tavern/rooms/RoomEmpty.tsx","components/structures/tavern/rooms/RoomList.tsx","components/structures/tavern/UpgradeHelpModalContent.tsx","components/structures/tavern/TavernStructureView.tsx","mechanics/resources.ts","components/structures/resource/ResourceGenerationRow.tsx","components/ui/items/DraggableItemsList/ItemText.tsx","components/ui/items/DraggableItemsList/DraggableItemsList.tsx","mechanics/lootTable.ts","mechanics/time.ts","mechanics/gameTick/harvest.ts","components/structures/resource/HarvestProgress.tsx","components/structures/styles/images/warehouse/icon.png","components/structures/resource/UpgradeHelpModalContent.tsx","components/structures/resource/ResourceStructureView.tsx","components/town/StructureDetailsView/index.tsx","components/structures/styles/images/alchemist/icon.png","components/structures/styles/images/armoursmith/icon.png","components/structures/styles/images/garden/icon.png","components/structures/styles/images/lumberMill/icon.png","components/structures/styles/images/mine/icon.png","components/structures/styles/images/quarry/icon.png","components/structures/styles/images/tannery/icon.png","components/structures/styles/images/tavern/icon.png","components/structures/styles/images/weaponsmith/icon.png","components/structures/styles/images/weaver/icon.png","components/structures/styles/images/workshop/icon.png","components/town/StructureLabels/StructureIconSprite.tsx","components/town/StructureLabels/StructureLabel.tsx","components/town/StructureLabels/StructureLabels.tsx","components/town/TownView.tsx","components/ui/toasts/Toasts.tsx","store/actions/settings.ts","components/ui/window/windows/SettingsWindow.tsx","constants/resources.ts","components/ui/common/Select/index.tsx","components/world/QuestPanel/QuestDetails/scene/SceneActor.tsx","components/ui/window/windows/CheatWindow.tsx","store/actions/workers.ts","store/selectors/adventurers.ts","components/ui/game/GameStats.tsx","utils/game.ts","components/ui/window/windows/SaveAndLoadWindow.tsx","components/ui/window/windows/MenuWindow.tsx","components/ui/topbar/Resourcebar.tsx","components/ui/topbar/Topbar.tsx","components/world/WorldMap/QuestMarker.tsx","components/world/WorldMap/QuestLine.tsx","components/world/WorldMap/WorldMap.tsx","components/pixi/tile/RectTileLayer.tsx","components/pixi/tile/ObjectTileLayer.tsx","components/pixi/tile/SpriteAnimated.tsx","components/world/QuestPanel/QuestDetails/scene/ActorStats.tsx","components/world/QuestPanel/QuestDetails/scene/useRandomOrientation.ts","components/world/QuestPanel/QuestDetails/scene/SceneAdventurer.tsx","components/world/QuestPanel/QuestDetails/scene/ObjectSpriteLayer.tsx","components/world/QuestPanel/QuestDetails/scene/Tilemap.tsx","hooks/useTilesetsLoader.ts","components/world/QuestPanel/QuestDetails/scene/ui/CombatUIWidget/CombatUIWidget.tsx","components/world/QuestPanel/QuestDetails/scene/ui/NormalUICursor.tsx","components/ui/bubbles/Bubbles.tsx","components/world/QuestPanel/QuestDetails/scene/ui/SceneUI.tsx","utils/interaction.ts","components/pixi/DashedLine.ts","components/world/QuestPanel/QuestDetails/scene/ActionPreview.tsx","hooks/store/useLog.ts","components/world/QuestPanel/QuestDetails/scene/SceneLog.tsx","mechanics/scenes/CombatController.ts","components/world/QuestPanel/index.tsx","components/world/QuestPanel/QuestDetails/scene/Scene.tsx","components/world/QuestPanel/QuestDetails/OnTheRoad.tsx","components/world/QuestPanel/QuestDetails/index.tsx","components/ui/adventurer/DroppableAdventurerAvatar/index.tsx","components/world/QuestPanel/modals/LootCache/LootCache.tsx","components/world/QuestPanel/modals/Situation/index.tsx","components/world/QuestPanel/CombatBar/index.tsx","components/log/SimpleLog.tsx","components/world/WorldView.tsx","components/ui/tooltip/Tooltip/index.tsx","components/ui/tooltip/ContextTooltip/context/ItemContext/DeedContent.tsx","mechanics/studying.ts","components/ui/tooltip/ContextTooltip/context/ItemContext/ProduceOrStudy.tsx","components/ui/tooltip/ContextTooltip/context/ItemContext/WeaponContent/DamageList.tsx","components/ui/tooltip/ContextTooltip/context/TempEffectContext/getEffectDescription.ts","components/ui/tooltip/ContextTooltip/context/ItemContext/Effects.tsx","components/ui/tooltip/ContextTooltip/context/ItemContext/WeaponContent/WeaponContent.tsx","components/ui/tooltip/ContextTooltip/context/ItemContext/ApparelContent.tsx","components/ui/tooltip/ContextTooltip/context/ItemContext/ConsumableContent.tsx","components/ui/tooltip/ContextTooltip/context/ItemContext/ItemContext.tsx","components/ui/tooltip/ContextTooltip/context/ResourceContext/index.tsx","components/ui/modals/InfoWindow/index.tsx","components/App/App.tsx","components/ui/tooltip/ContextTooltip/context/TraitContext/index.tsx","components/ui/tooltip/ContextTooltip/context/AttributeContext/index.tsx","components/ui/tooltip/ContextTooltip/context/ActorContext/CombatAttributes.tsx","components/ui/tooltip/ContextTooltip/context/ActorContext/AdventurerContext.tsx","components/ui/tooltip/ContextTooltip/context/ActorContext/EnemyContext.tsx","components/ui/tooltip/ContextTooltip/context/ActorContext/ActorContext.tsx","components/ui/tooltip/ContextTooltip/context/TempEffectContext/getTempEffectDescription.ts","components/ui/tooltip/ContextTooltip/context/TempEffectContext/index.tsx","components/ui/tooltip/ContextTooltip/ContextTooltip.tsx","definitions/tempEffects/index.ts","store/reducers/adventurers.ts","store/reducers/engine.ts","store/reducers/game.ts","store/reducers/gold.ts","store/reducers/stockpile.ts","store/reducers/log.ts","store/reducers/quests.ts","store/reducers/resources.ts","store/reducers/rngState.ts","store/reducers/settings.ts","store/reducers/structures.ts","store/reducers/tasks.ts","store/reducers/workers.ts","store/reducers/index.ts","store/middleware/effects.ts","utils/configureStore.ts","store/middleware/utils.ts","store/middleware/traits.ts","components/ui/error/ErrorModal.tsx","mechanics/gameTick/producedResources.ts","mechanics/gameTick/quests.ts","mechanics/gameTick/rngState.ts","registerServiceWorker.ts","mechanics/gameTick/tasks.ts","index.tsx"],"names":["TextManager","texts","precompile","this","templates","notFound","compileAll","initialized","key","context","result","getDefault","console","error","decode","Error","template","getTemplate","textEntry","get","compile","adventurerId","adventurerName","name","attribute","enemyType","slotType","toKebab","EquipmentSlotType","quest","sceneName","type","itemOrItemType","isItemType","itemCategory","ItemCategory","item","structure","trait","effect","props","rest","EffectType","TempEffectType","Type","WeaponType","weaponClass","WeaponClassification","length","log","join","Object","keys","forEach","value","Handlebars","article","itemType","getDefinition","itemArticleAuto","itemArticleDefined","link","getStructureLink","resource","getAdventurerName","actor","isAdventurer","isEnemy","getEnemyName","itemArticleUndefined","getItemName","articleTemplate","noun","dropTarget","drop","monitor","onDrop","getItem","canDrop","itemAndEquipmentSlotMatch","equipmentSlotType","chest","feet","hands","head","legs","checkEquipment","mainHand","offHand","itemDefinition","ammunition","weapon","WeaponTypeDefinition","weaponType","classification","oneHanded","shield","DropTarget","DragType","ITEM","connect","connectDropTarget","isOver","className","push","title","children","equipmentType","apparel","rangedWeaponInHand","equipment","mainHandItem","isWeapon","getWeaponDefinition","ranged","FIVE_SECONDS","ONE_MINUTE","TWO_MINUTES","THREE_MINUTES","FOUR_MINUTES","HALF_HOUR","ONE_HOUR","ONE_DAY","ONE_YEAR","formatDuration","ms","short","timeUnitsList","unit","amount","time","Math","abs","output","el","tmp","floor","Channel","MixMode","Music","STORAGE_KEY_VOLUME","SoundManager","music","localforage","ui","scene","ambient","_channelVolume","_initialized","gameSound","files","complete","promise","Promise","resolve","_reject","_sounds","loader","Loader","map","file","add","load","_","resources","values","filter","Boolean","r","sound","channel","loop","mixMode","singleInstance","storePosition","init","pixiSound","getSound","volume","_currentSound","oldSoundInfo","instance","once","progress","duration","_storedPositions","start","play","fade","fadeOutSound","gsap","from","stop","on","destroy","random","soundInfo","to","onComplete","filters","_filter","setItem","TelephoneFilter","Allegiance","SceneActionType","isActorObject","object","TiledObjectType","allegiance","player","enemy","getAdventurer","objects","find","o","WeaponAbility","basePath","DamageType","axe","abilities","cut","bow","shoot","club","swing","parry","crossbow","aimedShot","fist","flail","hammer","knife","staff","twoHanded","sword","poleArm","block","weapons","aegisOfValor","rarity","Rarity","legendary","iconImg","arbalest","epic","damage","kinetic","battleAxe","common","berserkerShield","brassKnuckles","bronzeDagger","buckler","cleaver","dagger","rare","dirk","uncommon","falchion","goldenShield","greatswordOfGwai","unique","effects","attributeIncrease","factor","halbert","huntingBow","indomitableCarapace","jaggedBlade","javelin","khopesh","legionnaireSword","longbow","mace","morningStar","paintedBuckler","poisonedDagger","pikeStaff","ravenStaff","scythe","savageStaff","simpleCrossbow","spear","steelShield","steelSword","warhammer","woodenBulwark","all","entries","reduce","acc","QuestNodeType","test","prototype","hasOwnProperty","call","IconSize","Border","Icon","image","size","border","restProps","sizeClassName","style","backgroundImage","process","borderClassName","smallest","small","medium","big","biggest","gold","none","DragSourceType","ADVENTURER","launchQuest","questName","assignedAventurers","exitEncounter","updateQuestVars","vars","setSceneName","setScene","enqueueSceneAction","sceneAction","completeSceneAction","setCombat","combat","endPlayerTurn","startTurn","turn","adventurers","deductActorAp","ap","setActiveSceneInteractionModal","sceneInteractionModal","herb","herbs","angelicasSorrow","bansheeReeds","blissflower","bloodLotus","bogroot","ceviorise","chicory","dragonroot","heartsVine","hyacinthus","jaboticaba","kingsrose","lastSupper","mistagold","monksweed","moonFlower","mountainGrass","oakLeaf","patricksroot","sunleaf","trollsFeast","uwolic","wyrmvine","winterWeed","wizardsBane","material","materials","arrowheads","beam","bolts","buckle","chain","cogs","gunpowder","ingot","nails","pile","planks","poisonVial","pulley","ribbon","rope","runeCarvedPlank","scales","spring","stake","stick","thread","woodenMask","mineral","minerals","amethyst","aquamarine","arminsHeart","dragonsTooth","greenOpal","jasper","malachite","moonstone","obsidian","roseQuartz","sapphire","spellstone","tigersEye","topaz","wyrdstone","trinket","trinkets","magicAmulet","ring","consumables","deeds","questItems","getWeaponOrApparelDefinition","isApparel","getApparelDefinition","getAllItemsByCategory","category","deed","consumable","questItem","canStackItem","getWorldLink","getQuestLink","getTownLink","onlyHighlight","modifyHealth","consumeItem","fromSlot","moveItemInInventory","toSlot","addItemToInventory","removeItemFromInventory","assignEquipment","equipmentSlot","removeEquipment","changeEquipmentQuantity","quantity","addTempEffect","tempEffect","decreaseEffectCharge","setBasicAttributes","basicAttributes","renameAdventurer","addXp","xp","EffectSourceType","parseProperties","properties","findTileset","gid","tilesets","tileset","i","firstgid","addAllTilesInLayerToList","list","layer","columns","data","tile","index","x","y","locationEquals","a","b","LogChannel","EVENT_TOASTS_UPDATED","ToastManager","icon","stack","Date","now","emit","playSound","setTimeout","toast","lifeTime","_instance","EventEmitter","Toast","achievementUnlocked","history","useHistory","typeText","getToastType","onClick","xpToLevel","sqrt","levelToXp","level","pow","MAX_XP","AP_COST_MOVE","AP_COST_CONSUME","AP_COST_SLASH","AP_COST_SHOOT","ENEMY_BASE_AP","calculateInitialAP","attributes","agi","calculateDodge","BubbleType","BubbleLayer","EVENT_BUBBLE_ADDED","BubbleManager","text","point","bubbleType","general","findQuestByAdventurer","adventurer","quests","q","party","some","id","adventurersOnQuest","findAdventurerById","getQuestLeader","leaderId","adventurerFreeInventorySlots","inventory","storeIsRehydrated","store","undefined","engine","gameStarted","minorHealthPotion","minorManaPotion","minorSoma","lesserHealthPotion","lesserManaPotion","lesserSoma","majorHealthPotion","majorManaPotion","majorSoma","greaterHealthPotion","greaterManaPotion","greaterSoma","isConsumable","kill10Boars","getQuestVars","questStore","questVars","getInitialQuestVars","_questStore","initialQuestVars","nodes","encounter","startScene","nothing","retrieveMagicAmulet","baz","zux","requiredItems","addLogText","channelContext","entry","addLogEntry","crimsonRogueEffect","boots1","boots2","damageReduction","boots3","chainmailHood","clothGloves","cowl","cultistBoots","crimsonRogueBoots","crimsonRogueBritches","crimsonRogueCoif","crimsonRogueGrips","crimsonRogueSpaulders","shoulders","crimsonRogueTunic","cultistGloves","cultistPants","cultistRobe","cultistShoulderwraps","darkPrinceBracers","darkPrinceCape","darkPrinceCuirass","darkPrinceHood","darkPrinceSarong","darkPrinceSlippers","dreadnoughtBoots","dreadnoughtChest","dreadnoughtGauntlets","dreadnoughtHelm","dreadnoughtLegplates","dreadnoughtPauldrons","druidChest","druidFeet","druidHands","druidHead","druidLegs","fedora","footmanBoots","footmanBreastplate","footmanFaceguard","footmanFists","footmanLegplates","footmanPauldrons","greaves1","greaves2","hornedHelmet","leatherGloves","naturalistsCape","naturalistsCowl","naturalistsFootwraps","naturalistsVambraces","naturalistsVest","nomadHelmet","pants1","pants2","plateChest1","plateChest2","plateChest3","plateChest4","plateGloves1","plateGloves2","plateHelmet","platePants","plateShoulders1","plateShoulders2","robe","shoulders1","shoulders2","shoulders3","studdedLeatherShoulderguards","sunchaserBritches","sunchaserGloves","sunchaserHelm","sunchaserMantle","sunchaserMoccasins","sunchaserTunic","templeGuardChestplate","templeGuardGloves","templeGuardGreaves","templeGuardHelm","templeGuardLegplates","templeGuardPauldrons","vest","lerpLocation","point1","point2","alpha","lerp","n1","n2","loadResourceAsync","path","shared","loadResource","callback","addGold","subtractGold","generator","seed","dirty","seedrandom","state","randomInt","min","max","ceil","roll3D6","alchemist","armoursmith","lumbermill","tavern","weaponsmith","workshop","isDeed","SceneControllerManager","controllerType","controllerTypes","require","ammunitions","armorPiercingArrows","basicArrows","crossbowBolts","elfenArrows","isAmmunition","blueprints","crate","dynamite","dragonEye","eye","feather","food","heart","horn","letters","lockPicks","oil","orcFinger","plans","purpleGems","runestone","sandwich","teeth","tooth","torch","tusk","vase","vial","weeds","isQuestItem","TiledLayerType","Orientation","RenderOrder","spritesheetBasePath","trolls","str","for","int","skills","spritesheet","dungeon","entered","entrance","chestOpen","items","hallway","doorOpen","isTextEntry","convertIn","l","convertOut","input","movementDuration","BaseSceneController","mapData","aStar","dataLoading","dataLoadComplete","jsonPath","blockedTiles","tileTypes","promises","addSound","createBlockedTiles","createTileTypes","createAStar","spritesheets","spritesheetPaths","layers","visible","p","width","blocksMovement","location","tiles","createObjects","updateScene","sceneObjects","dispatch","tileWidth","tilewidth","tileHeight","tileheight","destination","getObjectAtLocation","portal","exit","node","actorId","_location","getSceneActor","getActorMainhandItem","definition","getActorSkills","roll","bubbleAtLocation","settings","verboseCombatLog","skill","ammo","getActorOffhandItem","interactWithObject","warn","move","findPath","actionType","target","endsAt","performance","interact","findPathNearest","moveAction","interactAction","slash","pop","meleeAction","shootAction","_actor","_object","Point","height","_name","lootCache","getLootCache","itemIndex","getAdventurerById","indexOf","discardItem","_situation","_adventurerId","_option","origin","includeLast","grid","getGrid","getGridNodes","matrix","c","getIsWalkable","tempAStar","AStarFinder","includeStartNode","heuristic","weight","slice","results","radius","getTop","getRight","getBottom","getLeft","notOutside","filtered","locationIsBlocked","sceneActors","sA","additionalFilter","row","blocked","objectLayers","objectgroup","objectLayer","layerId","sceneNamePrev","getAdventurers","locations","findEmptyLocationsAround","round","adventurerObject","health","isSprite","spritesheetPath","enemySpawn","getEnemyDefinition","getState","updated","storeState","getAdventurerByActor","getEnemyByActor","getTextEntry","addToast","questUpdate","sceneLocationToPoint","set","addBubble","action","DungeonEncounterSceneController","DungeonCanyonSceneController","DungeonEntranceSceneController","previousMusic","situation","getCurrentlyPlaying","DungeonHallwaySceneController","choices","option","discardItemType","interactive","part","DungeonHub1Controller","registerSceneController","StructureState","reduceTime","percentage","what","convertIntToSemVer","version","asInt","semVer","parts","split","Number","numericVersion","convertSemVerToInt","HitAreaShapes","shapes","sprite","shape","PIXI","contains","LumberMill","hitAreaShapes","atlas","useState","textures","setTextures","selected","STRUCTURE_HIGHLIGHT_FILTER","app","useApp","useEffect","rotation","setRotation","useTick","delta","position","buttonMode","pointertap","onStructureClick","hitArea","texture","anchor","ParticleEmitter","PixiComponent","create","applyProps","oldProps","newProps","config","newP","applyDefaultProps","emitter","particles","elapsed","tick","destroyed","update","requestAnimationFrame","Tavern","smoke","withAppContext","WrappedComponent","AppContext","Consumer","Component","Generic","Viewport","forwardRef","ref","cursor","renderer","plugins","interaction","cursorStyles","pointer","PixiComponentViewport","displayName","viewport","PixiViewport","screenWidth","screenHeight","worldWidth","worldHeight","ticker","Ticker","event","minScale","maxScale","drag","pinch","wheel","clamp","direction","clampZoom","decelerate","BridgedStage","TownStage","innerRef","useRef","useImperativeHandle","current","godray","enabled","horizontalFactor","utils","normalize","right","verticalFactor","bottom","gain","lacunarity","onScroll","e","preventDefault","window","addEventListener","passive","removeEventListener","options","StructureType","autoDensity","sharedLoader","GodrayFilter","Clouds","speed","randomCloud","cloud","setCloud","setX","randomY","setY","Resource","production","cost","levels","workerCapacity","unlocks","wood","iron","stone","garden","generates","harvest","lootTable","lumberMill","mine","quarry","tannery","leather","rooms","warehouse","maxResources","fabric","maxStockpile","weaver","isProductionStructure","isResourceStructure","getStructureByResource","ButtonSize","ButtonColor","useStructureState","structureSelector","useCallback","structures","useSelector","useStructureDefinition","structureDefinition","useStructureLevel","Direction","Button","color","square","otherProps","blue","auto","Window","musicFiltered","backEnabled","_e","onBack","closeEnabled","onClose","withWindow","React","PlainProgressbar","val","animationTime","variation","previousProgress","label","transition","useEngine","usePrevious","ContextType","TickingProgressbar","previousTick","useDelta","animate","setAnimate","increasing","decreasing","getTasks","tasks","useCraftingTasksStateByStructure","createSelector","running","createSelectCraftingTasksByStructure","useStudyingTasksStateByStructure","createSelectStudyingTasksByStructure","useUpgradeTasksStateByStructure","createSelectUpgradeTasksByStructure","StructureViewHeader","IconButton","StructureLevel","onHelpClicked","useDispatch","nextLevel","upgradeText","upgradeTasks","t","timeRemaining","startTime","disabled","EVENT_CONTEXT_UPDATED","TooltipManager","info","originRect","source","referenceRect","deepEquals","lastContext","clear","TaskType","ItemIcon","getIconClassName","showContext","currentTarget","getBoundingClientRect","showContextTooltip","stopPropagation","UpDownValue","displayValue","upDisabled","onUp","downDisabled","onDown","useStockpileState","stockpile","useStockpileStateFlat","useMemo","flat","ItemsBox","aggregate","itemsInInventory","tmpWarehouse","tmpItems","found","findIndex","splice","removed","listItems","listItemClass","itemDescription","selectMaxResources","useResourcesState","useMaxResourcesState","useGoldState","ResourcesCost","storeResources","sufficientResources","availableGold","sufficientGold","resourceDescription","resourceDescriptions","getResourceName","selectFreeWorkers","workers","useWorkersFreeState","calculateProductionTime","weaponsmithProduction","levelRequired","armoursmithProduction","workshopProduction","addItemToWarehouse","moveItemInWarehouse","removeItemFromWarehouse","addResources","removeResources","finishBuildingStructure","upgradeStructure","increaseWorkers","addItemToToProduces","startTask","taskType","callbacks","QuestStatus","CraftingDetails","resourcesState","stockpileState","workersFree","workersAssigned","setWorkersAssigned","produces","getProductionDefinition","costResources","missingAtLeastOneResource","missingAtLeastOneItem","costMaterials","handleCraft","productionDefinition","craftingTime","craftItem","asNumber","makeTimeString","CraftingArea","selectedItem","setSelectedItem","UpgradeHelpModal","addUpgradeCallbacks","goldCost","missingGold","canUpgrade","town","UpgradeHelpModalContent","ProductionStructureView","craftingTasks","studyingTasks","handleUpgradeCallbacks","content","component","formatNumber","digits","SI_SYMBOL","tier","log10","toFixed","suffix","scale","scaled","roundIfNeeded","EPSILON","deltaResources","querySelector","rect","top","full","structureText","Built","empty","Tabstrip","activeTab","Children","child","cloneElement","active","handleTabClick","tabId","onTabSelected","open","setOpen","checked","onChange","Tab","AdventurerAvatar","avatarImg","AdventurerTabstrip","onAdventurerTabSelected","selectedAdventurerId","useAdventurersInTown","adventurersInTown","status","getAdventurersInTown","useAdventurerState","adventurerSelector","dragInfo","sourceType","adventurerEquipment","inventorySlot","canDropHere","isActive","classNames","Trait","DragSource","beginDrag","onStartDrag","sourceId","connectDragSource","dragSource","isDragging","slot","Inventory","disabledIndex","slots","contents","iconSize","onDropItem","LoadingSpinner","Array","SceneControllerContext","createContext","SceneControllerContextProvider","useStore","loaded","setLoaded","previousQuestVars","controller","getSceneController","loadData","createScene","sceneEntered","sceneExited","Provider","useItemDropActions","sceneController","useContext","dropItemEquipment","actions","adventurerInventory","existingEquipment","dropItemInventory","otherItem","takeItemFromCache","dropItemWarehouse","stockpileCategory","AdventurerSkills","s","handleClick","getSkillName","renderSkill","Level","currentLevel","currentLevelXp","nextLevelXp","dingAnimationRunning","setDingAnimationRunning","lastState","lastAdventurer","lastDingAnimationRunning","next","createStringArraySelector","createSelectorCreator","defaultMemoize","stringArrayEqual","getQuests","getQuestNames","getQuestStatus","getActiveQuests","useQuest","questSelector","ApIndicator","arrowFinder","hasEffect","gloomy","lucky","houseHouston","houseMaddox","houseMonroe","AdventurerColor","AdventurerTraits","renderTrait","last","traitDefinition","getTraitName","traits","Guy","findDR","useAdventurerDamageReduction","renderDamageReduction","dR","AdventurerEquipment","onDropItemEquipment","getEquipmentSlot","EquipmentSlot","calculateBaseHitpoints","fortitude","Health","baseHP","attributeList","obj","prop","harmful","healthDecreaseOnMove","healthDecreaseOverTime","AttributeSourceType","collectEffects","filterType","tempEffects","tempEffectType","calculateEffectiveAttributesExtended","generateBaseAttributes","effectSource","convertOrigin","base","Attributes","extendedAttribute","components","additional","getAttributeName","renderRow","ConsumeItemSlot","useDrop","accept","collect","ConsumeItem","onConsumed","enoughAp","adventurerConsumeItem","EffectIcon","effectType","getIconImage","brokenLegs","burning","soma","AdventurerTempEffects","getTempEffectName","renderEffect","useSettings","useDraggable","element","handle","initial","offset","touchStart","evt","left","touches","clientX","clientY","mouseStart","touchMove","setPosition","mouseMove","dragEnd","document","DraggableInfoWindow","parentRect","parentNode","ReactDOM","createPortal","body","DebugAdventurerEdit","handleChangeAttribute","AdventurerPanel","horizontalMode","levelBar","onStartInventoryItemDrag","consumeItemIndex","setConsumeItemIndex","extendedAttributes","debugAllowAdventurerEdit","flavor","src","getAdventurerFlavor","AdventurerSectionSelection","sectionParent","debounce","fromTop","scrollTop","querySelectorAll","hash","substring","lastIndexOf","section","offsetTop","clientHeight","classList","remove","smooth","res","WAREHOUSE","Stockpile","selectedItemCategory","setSelectedItemCategory","dragDropManager","useDragDropManager","dragging","getMonitor","dragItem","dragItemType","getItemType","getItemCategory","WarehouseStructureView","selectedAdventurer","setSelectedAdventurer","resourcesDelta","setResourcesDelta","previousResources","resourcesRef","structuresState","levelDefinition","_props","_monitor","AssignAdventurers","onAdventurerClicked","onAdventurerDropped","availableSlots","slotsContent","QuestBoard","checkEnoughItems","questDefinition","every","amountRequired","availableQuests","selectedQuestName","onQuestClick","getQuestTitle","fullParty","enoughItems","canLaunch","getQuestDescription","onRemoveAdventurer","onLaunchQuest","getQuestDetails","AdventurerButton","onAddAdventurer","isAssigned","emptySlot","getEmptySlot","spec","RoomWithAdventurer","onQuest","expanded","assigned","SOURCE_ID","prompt","RoomEmpty","RoomList","roomCount","handleAdventurerClick","roomContent","room","getStructureName","TavernStructureView","setAassignedAdventurers","selectedQuest","setSelectedQuest","getAvailableQuests","available","handleAddAdventurer","copy","handleRemoveAdventurer","handleQuestClick","questTitle","leader","questLaunched","RESOURCE_INTERVAL","ResourceGenerationRow","lastProducedUpdate","ItemText","getItemSubtext","DraggableItemsList","renderButton","pick","table","totalWeight","randomNumber","TimeType","HARVEST_INTERVAL","getHarvest","lastHarvest","resourceStructureDefinition","itemCount","handleStructure","HarvestProgress","ResourceStructureView","selectHarvest","decreaseWorkers","resourceStructure","warehouseIcon","removeItemFromHarvest","handleItemTake","StructureDetailsView","buildTask","structureState","Building","renderContent","RoutedStructureDetailsView","useParams","StructureIconSprite","getImage","TextStyle","fontFamily","fontSize","fill","wordWrap","wordWrapWidth","dropShadow","dropShadowAngle","dropShadowBlur","dropShadowDistance","blurFilter","BlurFilter","StructureLabel","structureName","metrics","TextMetrics","measureText","toUpperCase","StructureLabels","fontLoaded","setFontLoaded","FontFaceObserver","then","OutlineFilter","match","useRouteMatch","selectedStructure","params","viewportRef","tween","thickness","yoyo","repeat","pause","kill","handleStructureClick","zoomPercent","getStructurePosition","moveCenter","MAX_WIDTH","canvasWidth","setCanvasWidth","canvasHeight","setCanvasHeight","resize","worldViewWidth","clientWidth","worldViewHeight","reverse","NotBuilt","StructureComponent","getStructure","polygons","Toasts","activeToasts","setActiveToasts","toastsUpdated","addListener","removeListener","toastConfig","setSetting","setting","compose","getChannelControls","slider","lastChild","setChannelVolume","role","step","linear","parseFloat","defaultValue","getChannelVolume","debugSceneShowPathable","debugSceneShowActionQueue","resourceOrder","cheatTimeMultiplier","getTimeMultiplier","cheat","DefaultSelect","styles","control","provided","minHeight","boxShadow","isFocused","container","_state","flex","padding","placeholder","whiteSpace","valueContainer","marginTop","indicatorsContainer","cheats","setCheats","timeMultiplier","setTimeMultiplier","handleChangeStructureState","setStructureState","onCheatStructureState","k","isNaN","parseInt","typeKey","subtext","allItems","_evt","onCheatGold","onCheatWorkers","onCheatResources","Select","formatGroupLabel","formatOptionLabel","onCheatItem","setCheatTimeMultiplier","structureDef","getStructureDefinition","structureStore","levelDef","getStructureRow","groupAdventurersByQuest","foundInParty","groupedAdventurers","foundAdventurers","createSelectAdventurersOnQuest","GameStats","timePlaying","lastTick","game","Version","completed","solo","encryptor","createEncryptor","loadedStore","setLoadedStore","loading","setLoading","handleClickLoad","loadGame","onCloseWindow","createElement","JSON","stringify","encrypted","encrypt","setAttribute","encodeURIComponent","click","saveGame","fileReader","FileReader","onload","decrypt","parse","decryptSavedGame","readAsText","SaveAndLoadWindow","onOpenWindow","Resourcebar","goldState","createItem","Topbar","QuestMarker","encounterActive","avatar","maskGraphics","beginFill","drawCircle","CIRCLE_DIAMETER","endFill","mask","addChild","pointerdown","QuestLine","positions","draw","graphics","lineStyle","moveTo","xc","yc","quadraticCurveTo","WorldMap","retrieveWorldViewRef","smallMap","activeQuests","selectMemoized","useActiveQuests","WIDTH","worldView","SMALL_HEIGHT","focusOnQuestingParty","nodeLocationToPoint","partyLocation","getQuestWorldLocation","previousPositions","getPreviousPositions","currentPosition","questNode","onPartyClick","getQuestSceneTitle","roundedProgress","lastNode","nextNode","WORLD_WIDTH","WORLD_HEIGHT","lastPosition","DebugToggleCombat","RectTileLayer","CompositeRectTileLayer","horizontalTiles","w","h","spriteId","addFrame","ObjectTileLayer","_oldProps","SpriteAnimated","gotoAndPlay","ActorStats","useActorStatsInfo","align","drawRect","SceneActor","idleAnimation","lookAt","getTileDimensions","actorRef","previousAction","actionQueueSelector","actionQueue","animation","setAnimation","determineOrientation","nextAction","setOrientation","north","northEast","east","southEast","south","southWest","west","northWest","moveComplete","actorMoved","killTweensOf","ease","pixi","actorSlashing","actorSlashed","actorShooting","actorShot","actorInteract","frames","setFrames","indexed","frame","replace","orientation","flipped","bearing","calculateBearing","interval","setInterval","clearInterval","useRandomOrientation","getFrames","prefix","meta","black","createColorReplaceFilter","BLUES","BLACK","orange","ORANGE","purple","PURPLE","red","REDS","teal","TEALS","white","WHITE","yellow","YELLOW","showThingy","animationSpeed","isPlaying","SPRITE_WIDTH","pivot","memo","angle","atan2","PI","replacements","MultiColorReplaceFilter","SceneAdventurer","ObjectSpriteLayer","selectedActorId","Tilemap","getLayerObjects","tileObjects","spriteObjects","Fragment","tilelayer","useTilesetsLoader","tileSpritesheets","setTilesets","setData","nextTileset","nextTilesetToload","tilesetName","spritesheetData","parseSpritesheetData","Spritesheet","newTilesets","loadComplete","loadTilesets","tilesetsTextures","tilecount","spriteSourceSize","rotated","trimmed","sourceSize","imagewidth","imageheight","CombatUIWidget","actionIntent","onActionChange","transform","NormalUICursor","images","Bubbles","timeouts","bubbleAdded","bubble","innerHTML","appendChild","timeout","removeChild","clearTimeout","SceneUI","sceneWidth","sceneHeight","onMouseDown","onSetActionIntent","mouseDown","cursorLocation","setCursorLocation","handleResize","canvas","currentWidth","bind","useLongPress","onStart","findLocation","handleMouseDown","onMove","locationIsOutOfBounds","handleMouseMove","captureEvent","cancelOnMovement","detect","LongPressDetectEvents","BOTH","Element","domRect","DOMRect","fromRect","handleMouseUp","onMouseUp","selectedActorLocation","actorAttemptAction","handleCombatActionChange","actorAP","apCost","calculateWalkApCosts","touch","NaN","convertMouseOrTouchCoords","convertedX","convertedY","pointToSceneLocation","onTouchEnd","DashedLine","points","dash","gap","alignment","native","offsetPercentage","dashLeft","gapLeft","progressOffset","rotatedpoints","clone","cosAngle","cos","sinAngle","sin","dx","dy","p1","p2","len","normal","progressOnLine","lineTo","ActionPreview","convert","converted","valid","getLog","SceneLog","questId","useQuestLog","lastLog","shift","CombatController","storeChange","handleStoreChange","unsubscriber","subscribe","sceneAdventurers","enemies","sceneEnemies","totalAdventurerAp","findEnemyWithAp","findNearestActor","actors","distance","MAX_VALUE","steps","Layout","Scene","setSelectedActor","currentActionIntent","setCurrentActionIntent","initialize","Rectangle","OnTheRoad","QuestDetails","LootCache","freeSlots","cache","cacheName","stagger","each","takeGoldFromCache","Situation","getSituation","handleChoiceClick","choice","getAttribute","handleSituationOptionClick","CombatBar","endTurn","ChannelType","QuestPanel","layout","setSelectedAdventurerID","activeInteractionModal","handleAdventurerSelected","handleCloseLootCacheModal","WorldView","worldMapRef","questname","Placement","SimpleLog","setExpanded","selectedTabId","setSelectedTabId","logEntries","activeQuestNames","questNameSelector","names","statuses","useActiveQuestNames","useLocation","pathname","channels","tabType","displayEntries","currentTab","lE","tab","logEntry","getLogEntryRow","DeedContent","getDeedDefinition","enoughGold","startBuildingStructure","buildStructure","handleStartConstruction","STUDY_TIME","ProducedAtStructure","studyTasks","task","sT","studyTime","studyItem","ProduceOrStudy","getItemDefinition","DamageList","dmgType","getEffectDescription","Effects","WeaponContent","getWeaponType","classificationText","getWeaponClassification","ApparelContent","durability","ConsumableContent","ItemContext","ResourceContext","workersState","workersFreeState","structureStates","renderProducedBy","free","total","InfoWindow","View","Tooltip","placement","setPlacement","containerRect","setContainerRect","tooltipElement","tooltipRect","opacity","contentElement","closest","TraitContext","getTraitDescription","getTraitEffect","AttributeContext","getAttributeMechanics","eAC","renderOrigin","getAttributeDescription","CombatAttributes","AdventurerContext","actorObject","EnemyContext","attributesExtended","ActorContext","getTempEffectDescription","EffectContext","charges","getTempEffectFlavor","ContextTooltip","selectedContext","setSelectedContext","tooltipUpdated","TempEffectContext","getItemNameClassName","getSkillInfo","createTempEffect","getEffects","generateRandomAttributes","generateAttributesHealthAndXp","avatarImgBasePath","initialAdventurers","getInitialEngineState","initialGoldState","getInitialStockpile","itemCategoryName","randomItem","getRandomItemTypeByCategory","initialLogState","initialQuestState","encounterResults","overwriteMerge","sourceArray","initialResourcesState","initialRngState","initialSettingsState","updateStructureState","structureInitialState","initialStructuresState","createTask","initialTasksState","initialWorkersState","combineReducers","fromAdventurerId","toAdventurerId","fromAdventurer","concat","tE","resourcesToAdd","timeLeft","ignoreVersionDiff","lU","qss","deepmerge","arrayMerge","adventurerInStore","questsToUpdate","questToUpdate","resourcesToRemove","rngState","assign","workersToAdd","workersToRemove","structureAsString","end","effectTick","storeApi","persistConfig","storage","localForage","persistedReducer","persistReducer","rootReducer","middlewares","lastAction","lastAdventurerAction","_storeApi","middlewareEnhancer","applyMiddleware","composeEnhancers","__REDUX_DEVTOOLS_EXTENSION_COMPOSE__","configureStore","createStore","persistor","persistStore","isHydrated","ErrorModal","resetErrorBoundary","setState","getStoredState","initState","message","restartGame","PixiPlugin","registerPIXI","registerPlugin","App","containerRef","activeWindows","setActiveWindows","handleViewButtonClick","handleWindowClose","handleWindowBack","handleScroll","FallbackComponent","maxWidth","DndProvider","backend","HTML5Backend","exact","render","topWindow","commonWindowProps","renderWindow","getProducedResources","resourceGeneration","accumulator","getQuestUpdates","questProgress","initializeScene","questEncounter","currentProgress","currentNodeIndex","currentNode","progressIncrease","nextProgress","nodesPassed","logUpdates","questUpdates","getRngState","Random","isLocalhost","hostname","register","navigator","URL","toString","swUrl","fetch","response","headers","serviceWorker","ready","registration","unregister","reload","registerValidSW","catch","checkValidServiceWorker","onupdatefound","installingWorker","installing","onstatechange","processCompletedTasks","itemCrafted","handleCompletedTask","initGame","setupStore","storeConfiguration","continueGame","startNewGame","runGame","confirm","purge","persist","gameVersion","getElementById","registerServiceWorker","logs","resourcesUpdates","harvestUpdates","gameTick"],"mappings":"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,EAAG,EACHC,EAAG,EACHhb,KAAMoQ,IAAcqQ,SACrB,CACC1F,EAAG,EACHC,EAAG,EACHhb,KAAMoQ,IAAcqQ,SACrB,CACC1F,EAAG,EACHC,EAAG,EACHhb,KAAMoQ,IAAcqQ,SACrB,CACC1F,EAAG,EACHC,EAAG,EACHhb,KAAMoQ,IAAcqQ,SACrB,CACC1F,EAAG,EACHC,EAAG,EACHhb,KAAMoQ,IAAcqQ,SACrB,CACC1F,EAAG,EACHC,EAAG,EACHhb,KAAMoQ,IAAcqQ,SACrB,CACC1F,EAAG,EACHC,EAAG,EACHhb,KAAMoQ,IAAcqQ,SACrB,CACC1F,EAAG,EACHC,EAAG,EACHhb,KAAMoQ,IAAcqQ,SACrB,CACC1F,EAAG,EACHC,EAAG,EACHhb,KAAMoQ,IAAcqQ,SACrB,CACC1F,EAAG,EACHC,EAAG,EACHhb,KAAMoQ,IAAcqQ,SACrB,CACC1F,EAAG,GACHC,EAAG,EACHhb,KAAMoQ,IAAcqQ,SACrB,CACC1F,EAAG,GACHC,EAAG,EACHhb,KAAMoQ,IAAcqQ,SACrB,CACC1F,EAAG,GACHC,EAAG,EACHhb,KAAMoQ,IAAcqQ,SACrB,CACC1F,EAAG,GACHC,EAAG,EACHhb,KAAMoQ,IAAcqQ,SACrB,CACC1F,EAAG,GACHC,EAAG,EACHhb,KAAMoQ,IAAcqQ,SACrB,CACC1F,EAAG,GACHC,EAAG,EACHhb,KAAMoQ,IAAcqQ,SACrB,CACC1F,EAAG,GACHC,EAAG,EACHhb,KAAMoQ,IAAcqQ,SACrB,CACC1F,EAAG,GACHC,EAAG,EACHhb,KAAMoQ,IAAcqQ,SACrB,CACC1F,EAAG,GACHC,EAAG,EACHhb,KAAMoQ,IAAcqQ,SACrB,CACC1F,EAAG,GACHC,EAAG,EACHhb,KAAMoQ,IAAcqQ,SACrB,CACC1F,EAAG,GACHC,EAAG,EACHhb,KAAMoQ,IAAcqQ,SACrB,CACC1F,EAAG,GACHC,EAAG,EACHhb,KAAMoQ,IAAcqQ,SACrB,CACC1F,EAAG,EACHC,EAAG,EACHhb,KAAMoQ,IAAcqQ,SACrB,CACC1F,EAAG,EACHC,EAAG,EACHhb,KAAMoQ,IAAcqQ,SACrB,CACC1F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","file":"static/js/main.9c9c32fd.chunk.js","sourcesContent":["import { paramCase as toKebab} from \"text-param-case\";\nimport { decode } from 'html-entities';\nimport { TextEntry } from \"constants/text\";\nimport { getDefinition } from \"definitions/items\";\nimport { ItemType, ItemCategory, isItemType, Item } from \"definitions/items/types\";\nimport { Resource } from \"definitions/resources\";\nimport { Structure } from \"definitions/structures\";\nimport * as Handlebars from \"handlebars\";\nimport { Trait } from 'definitions/traits/types';\nimport { Type } from 'components/ui/toasts/Toast';\nimport { EquipmentSlotType } from 'components/ui/adventurer/EquipmentSlot';\nimport { WeaponType, WeaponClassification } from 'definitions/items/weapons';\nimport { getStructureLink } from \"utils/routing\";\nimport { Attribute } from \"store/types/adventurer\";\nimport { EnemyType } from \"definitions/enemies/types\";\nimport { ActorObject, isAdventurer, isEnemy } from \"store/types/scene\";\nimport { QuestStoreState } from \"store/types/quest\";\nimport { Effect, EffectType } from \"definitions/effects/types\";\nimport { TempEffect, TempEffectType } from \"definitions/tempEffects/types\";\n\nexport abstract class TextManager {\n\n  public static init(texts: {[key: string]: string}, precompile = true) {\n    this.texts = texts;\n    this.templates = {};\n    this.notFound = [];\n\n    if (precompile) {\n      this.compileAll();\n    }\n    this.initialized = true;\n  }\n\n  public static get(key: string, context?: unknown): string {\n    const result = this.getDefault(key, context);\n    if (result === null) {\n      if (process.env.NODE_ENV === 'development') {\n        this.notFound.push(key)\n      }\n\n      console.error(`Key '${key}' not found in TextManager`);\n      return `<<'${key}' missing>>`;\n    } else {\n      return decode(result);\n    }\n  }\n\n  // Will return `null` when no text found, otherwise will return the text\n  public static getDefault(key: string, context?: unknown): string|null {\n    if (!this.initialized) {\n      throw new Error(`Error ${this} not initialized!`);\n    }\n    const template = this.getTemplate(key);\n    if (!template) {\n      return null;\n    }\n    return template(context);\n  }\n\n  public static getTextEntry(textEntry: TextEntry): string {\n    return this.get(textEntry.key, textEntry.context);\n  }\n\n  public static getTemplate(key: string) {\n    let template = this.templates[key];\n    if (!template && this.texts[key]) {\n      // Template not found but key is defined. Needs to be compiled\n      this.compile(key, this.texts[key]);\n      template = this.templates[key];\n    }\n    return template;\n  }\n\n  public static getAdventurerName(adventurerId: string) {\n    return this.get(`adventurer-${adventurerId}-name`);\n  }\n\n  public static getAdventurerFlavor(adventurerId: string, adventurerName?: string) {\n    return this.get(`adventurer-${adventurerId}-flavor`, { name: adventurerName });\n  }\n\n  public static getAttributeName(attribute: Attribute): string {\n    return this.get(`common-attribute-${attribute}-name`);\n  }\n\n  public static getAttributeDescription(attribute: Attribute): string {\n    return this.get(`common-attribute-${attribute}-description`);\n  }\n\n  public static getAttributeMechanics(attribute: Attribute): string {\n    return this.get(`common-attribute-${attribute}-mechanics`);\n  }\n\n  public static getEnemyName(enemyType: EnemyType) {\n    return this.get(`enemy-${enemyType}-name`);\n  }\n\n  public static getEquipmentSlot(slotType: EquipmentSlotType) {\n    return this.get(`ui-equipmentslot-${toKebab(EquipmentSlotType[slotType])}`);\n  }\n\n  public static getQuestTitle(name: string) {\n    return this.get(`quest-${toKebab(name)}-title`);\n  }\n\n  public static getQuestDescription(name: string) {\n    return this.get(`quest-${toKebab(name)}-description`);\n  }\n\n  public static getQuestSceneTitle(quest: QuestStoreState) {\n    const sceneName = quest.sceneName || \"\";\n    return this.get(`quest-${toKebab(quest.name)}-scene-${toKebab(sceneName)}-title`);\n  }\n\n  public static getResourceName(type: Resource) {\n    return this.get(`resource-${type}-name`);\n  }\n\n  public static getItemName(itemOrItemType: Item | ItemType): string {\n    if (isItemType(itemOrItemType)){\n      return this.get(`item-${toKebab(itemOrItemType)}-name`);\n    }\n    return this.get(`item-${toKebab(itemOrItemType.type)}-name`);\n  }\n\n  public static getItemCategory(itemCategory: ItemCategory): string {\n    return this.get(`item-category-${toKebab(ItemCategory[itemCategory])}`);\n  }\n\n  public static getItemSubtext(item: ItemType): string|null {\n    return this.getDefault(`item-${toKebab(item)}-subtext`);\n  }\n\n  public static getStructureName(structure: Structure): string {\n    return this.get(`structure-${toKebab(structure)}-name`);\n  }\n\n  public static getTraitName(trait: Trait): string {\n    return this.get(`trait-${toKebab(trait)}-name`);\n  }\n\n  public static getEffectDescription(effect: Effect, props?: { [key: string]: string}): string {\n    const { type, ...rest } = effect;\n    return this.get(`effect-${toKebab(EffectType[type])}-description`, { ...rest, ...props} );\n  }\n\n  public static getEffectFlavor(effect: Effect): string {\n    return this.get(`effect-${toKebab(EffectType[effect.type])}-flavor`);\n  }\n\n  public static getEffectName(effect: Effect): string {\n    return this.get(`effect-${toKebab(EffectType[effect.type])}-name`);\n  }\n\n  public static getTempEffectDescription(effect: TempEffect, props?: { [key: string]: string}): string {\n    const { type, ...rest } = effect;\n    return this.get(`temp-effect-${toKebab(TempEffectType[type])}-description`, { ...rest, ...props} );\n  }\n\n  public static getTempEffectFlavor(effect: TempEffect): string {\n    return this.get(`temp-effect-${toKebab(TempEffectType[effect.type])}-flavor`);\n  }\n\n  public static getTempEffectName(effect: TempEffect): string {\n    return this.get(`temp-effect-${toKebab(TempEffectType[effect.type])}-name`);\n  }\n\n  public static getTraitDescription(trait: Trait): string {\n    return this.get(`trait-${toKebab(trait)}-description`);\n  }\n\n  public static getTraitEffect(trait: Trait): string {\n    return this.get(`trait-${toKebab(trait)}-effect`);\n  }\n\n  public static getToastType(type: Type): string {\n    return this.get(`ui-toast-type-${toKebab(Type[type])}`);\n  }\n\n  public static getWeaponType(type: WeaponType) {\n    return this.get(`ui-weapon-type-${toKebab(WeaponType[type])}`);\n  }\n\n  public static getSkillName(type: WeaponType) {\n    return this.get(`skill-${toKebab(WeaponType[type])}-name`);\n  }\n\n  public static getSkillInfo(type: WeaponType) {\n    return this.get(`skill-${toKebab(WeaponType[type])}-info`);\n  }\n\n  public static getWeaponClassification(weaponClass: WeaponClassification) {\n    return this.get(`ui-weapon-class-${toKebab(WeaponClassification[weaponClass])}`);\n  }\n\n  // will print all unfound text strings to the console\n  public static printNotFounds() {\n    if (this.notFound.length) {\n      console.log(\"TextManager strings not found:\")\n      console.log(\"\\\"\" + this.notFound.join('\": \"\",\\n\"') + '\": \"\"')\n    }\n  }\n\n  private static initialized = false;\n  private static texts: Record<string, string>;\n  private static templates: Record<string, Handlebars.TemplateDelegate<unknown>>;\n  private static notFound: string[];\n\n  private static compileAll() {\n    Object.keys(this.texts).forEach((key: string) =>  {\n      this.compile(key, this.texts[key]);\n    });\n  }\n\n  private static compile(key: string, value: string) {\n    const template = Handlebars.compile(value);\n    this.templates[key] = template;\n  }\n}\n\nHandlebars.registerHelper(\"item:name\", (itemOrItemType: Item | ItemType, article?: string) => {\n  let itemType: ItemType;\n  if (isItemType(itemOrItemType)){\n    itemType = itemOrItemType;\n  } else {\n    itemType = itemOrItemType.type;\n  }\n  if (!getDefinition(itemType)) {\n    return new Handlebars.SafeString(`<<ITEM DEFINITION NOT FOUND: ${itemType}>>`);\n  }\n  switch (article) {\n    case \"aA\":  // article Auto\n      return itemArticleAuto(itemType);\n    case \"aD\":  // article Defined \"a sword\"\n      return itemArticleDefined(itemType);\n    case \"aU\":  // article Defined \"the sword\"\n      return itemArticleDefined(itemType);\n    default:\n      // No article\n      // const name = itemDefinitions[item].name;\n      return new Handlebars.SafeString(itemType);\n  }\n});\n\nHandlebars.registerHelper(\"structure:name\", (structure: Structure) => {\n  const name = TextManager.get(`structure-${toKebab(structure)}-name`);\n  return new Handlebars.SafeString(name);\n});\n\nHandlebars.registerHelper(\"structure:link\", (structure: Structure) => {\n  const name = TextManager.get(`structure-${toKebab(structure)}-name`);\n  const link = getStructureLink(structure)\n  return new Handlebars.SafeString( `[${name}](#${link})`);\n});\n\nHandlebars.registerHelper(\"resource:name\", (resource: string) => {\n  const name = TextManager.get(`resource-${resource}-name`);\n  return new Handlebars.SafeString(name);\n});\n\nHandlebars.registerHelper(\"adventurer:name\", (adventurerId: string) => {\n  const name = TextManager.getAdventurerName(adventurerId);\n  return new Handlebars.SafeString(name);\n});\n\nHandlebars.registerHelper(\"actor:name\", (actor: ActorObject) => {\n  if (isAdventurer(actor)) {\n    const name = TextManager.getAdventurerName(actor.name);\n    return new Handlebars.SafeString(name);\n  } else if (isEnemy(actor)){\n    const name = TextManager.getEnemyName(actor);\n    return new Handlebars.SafeString(name);\n  }\n});\n\nconst itemArticleAuto = (item: ItemType) => {\n  return itemArticleUndefined(item);\n};\n\nconst itemArticleUndefined = (item: ItemType) => {\n  const name = TextManager.getItemName(item);\n  const articleTemplate = TextManager.getTemplate(\"common-article-undefined\");\n  return new Handlebars.SafeString(`${articleTemplate({ noun: name})}`);\n};\n\nconst itemArticleDefined = (item: ItemType) => {\n  const name = TextManager.getItemName(item);\n  const articleTemplate = TextManager.getTemplate(\"common-article-defined\");\n  return new Handlebars.SafeString(`${articleTemplate({ noun: name})}`);\n};\n","// todo: refactor hooks https://github.com/react-dnd/react-dnd/pull/1244\nimport * as React from \"react\";\nimport { ConnectDropTarget, DropTarget, DropTargetConnector, DropTargetMonitor, DropTargetSpec } from \"react-dnd\";\nimport { DragType } from \"constants/dragging\";\nimport { getDefinition } from \"definitions/items\";\nimport { ApparelDefinition } from \"definitions/items/apparel\";\nimport { ItemType, ItemCategory } from \"definitions/items/types\";\nimport { getDefinition as getWeaponDefinition, WeaponDefinition, WeaponTypeDefinition, WeaponClassification, isWeapon } from 'definitions/items/weapons';\nimport { InventoryItemDragInfo } from 'components/ui/items/DraggableItemIcon';\nimport { EquipmentStoreState } from \"store/types/adventurer\";\nimport \"./styles/equipmentslot.scss\";\n\nconst dropTarget: DropTargetSpec<Props> = {\n  drop(props: Props, monitor: DropTargetMonitor<InventoryItemDragInfo>) {\n    props.onDrop(monitor.getItem());\n  },\n  canDrop(props: Props, monitor: DropTargetMonitor)  {\n    const item = monitor.getItem<InventoryItemDragInfo>().item;\n\n    return itemAndEquipmentSlotMatch(item.type, props.type);\n  },\n};\n\nexport enum EquipmentSlotType {\n  feet,\n  hands,\n  chest,\n  legs,\n  head,\n  shoulders,\n  mainHand,\n  offHand,\n}\n\n// Returns true if item can be slotted in equipmentSlotType\nexport const itemAndEquipmentSlotMatch = (itemType: ItemType, equipmentSlotType: EquipmentSlotType) => {\n  switch (equipmentSlotType) {\n    case EquipmentSlotType.chest:\n    case EquipmentSlotType.feet:\n    case EquipmentSlotType.hands:\n    case EquipmentSlotType.head:\n    case EquipmentSlotType.legs:\n      return checkEquipment(itemType, equipmentSlotType);\n    case EquipmentSlotType.mainHand:\n    case EquipmentSlotType.offHand: {\n      const itemDefinition: WeaponDefinition = getDefinition(itemType) as WeaponDefinition;\n\n      if (itemDefinition.itemCategory === ItemCategory.ammunition) {\n        return true;\n      }\n      else if (itemDefinition.itemCategory !== ItemCategory.weapon) {\n        return false;\n      }\n      const { classification } = WeaponTypeDefinition[itemDefinition.weaponType];\n      switch (classification) {\n        case WeaponClassification.oneHanded:\n          return true;\n        case WeaponClassification.mainHand:\n          return equipmentSlotType === EquipmentSlotType.mainHand;\n        case WeaponClassification.offHand:\n        case WeaponClassification.shield:\n          return equipmentSlotType === EquipmentSlotType.offHand;\n      }\n\n      // todo: prevent shields to be equipped in main hand\n      return true;\n    }\n    default:\n      return false;\n  }\n};\n\nexport interface Props {\n  type: EquipmentSlotType;\n  onDrop: (item: InventoryItemDragInfo) => void;\n}\n\nexport interface DropSourceProps {\n  canDrop: boolean;\n  isOver: boolean;\n  connectDropTarget: ConnectDropTarget;\n}\n\nconst collect = (connect: DropTargetConnector, monitor: DropTargetMonitor) => ({\n  canDrop: monitor.canDrop(),\n  connectDropTarget: connect.dropTarget(),\n  isOver: monitor.isOver(),\n});\n\n/**\n * The EquipmentSlot displays a slot in which an item can be placed.\n */\nconst EquipmentSlot = (props: React.PropsWithChildren<Props & DropSourceProps>) => {\n  const {\n    isOver,\n    canDrop,\n    connectDropTarget,\n  } = props;\n  const isActive = isOver && canDrop;\n  const className = [\"equipment-slot\"]\n  if (isActive) {\n    className.push(\"drop-active\");\n  } else if (canDrop) {\n    className.push(\"drop-possible\");\n  }\n\n  return connectDropTarget(\n    <div className={className.join(' ')} title={EquipmentSlotType[props.type]}>\n      { props.children }\n    </div>,\n  );\n};\n\nexport default DropTarget<Props, DropSourceProps>(\n  DragType.ITEM,\n  dropTarget,\n  collect,\n)(EquipmentSlot);\n\nconst checkEquipment = (item: ItemType, equipmentType: EquipmentSlotType) => {\n  const itemDefinition = getDefinition(item);\n  if (itemDefinition.itemCategory !== ItemCategory.apparel) {\n    return false;\n  }\n  return (itemDefinition as ApparelDefinition).equipmentType === equipmentType;\n};\n\n// Returns true if a ranged weapon is held\nexport const rangedWeaponInHand = (equipment: EquipmentStoreState) => {\n  const mainHandItem = equipment[EquipmentSlotType.mainHand];\n\n  if (mainHandItem && isWeapon(mainHandItem.type)) {\n    const weaponType = getWeaponDefinition(mainHandItem.type).weaponType;\n    if (WeaponTypeDefinition[weaponType].classification === WeaponClassification.ranged) {\n      return true;\n    }\n  }\n  return false;\n}\n","import { TextManager } from 'global/TextManager';\n\nexport const ONE_SECOND = 1000;\nexport const TWO_SECONDS = 2000;\nexport const THREE_SECONDS = 3000;\nexport const FOUR_SECONDS = 4000;\nexport const FIVE_SECONDS = 5000;\n// ...\nexport const TEN_SECONDS = 10000;\nexport const TWENTY_SECONDS = 20000;\nexport const THIRTY_SECONDS = 30000;\n\nexport const ONE_MINUTE = 60000;\nexport const TWO_MINUTES = 120000;\nexport const THREE_MINUTES = 180000;\nexport const FOUR_MINUTES = 240000;\n\nexport const HALF_HOUR = ONE_MINUTE * 30;\nexport const ONE_HOUR = ONE_MINUTE * 60;\nexport const ONE_DAY = ONE_HOUR * 24;\nexport const ONE_YEAR = ONE_DAY * 265.25;\n\nexport const formatDuration = (ms: number, short?: boolean): string => {\n    const timeUnitsList = [\n        { unit: short? 'y' : 'year', amount: ONE_YEAR },\n        { unit: short? 'd' : 'day', amount: ONE_DAY },\n        { unit: short? 'h' : 'hour', amount: ONE_HOUR },\n        { unit: short? 'm' : 'minute', amount: ONE_MINUTE },\n        { unit: short? 's': 'second', amount: ONE_SECOND },\n    ]\n    let time = Math.abs(ms);\n    const output: string[] = [];\n    timeUnitsList.forEach((el) => {\n        const tmp = Math.floor(time / el.amount);\n        time -= tmp * el.amount\n        if (tmp !== 0) {\n            const unit = TextManager.get(`common-time-${el.unit}${tmp > 1 && !short ? \"-plural\": \"\"}`);\n            output.push(`${tmp}${unit}`);\n        }\n    })\n    return output.join(\" \");\n}\n","import localforage from 'localforage';\nimport { Sound, IMediaInstance, filters } from '@pixi/sound';\nimport {gsap } from 'gsap';\nimport { Loader } from 'pixi.js';\n\nexport enum Channel {\n  music,\n  ui,\n  scene,\n  ambient\n}\n\nexport enum MixMode {\n  singleInstance,   // Only one sound plays at the same time in this channel\n  layered,      // Multiple sounds can play in this channel\n  fade        // Fades out currently playing sound on this channel and fades new music in\n}\n\nexport enum Music {\n  town,\n  world,\n}\n\nexport type GameSound =\n  \"ambient/structure/alchemist\" |\n  \"ambient/structure/smith\" |\n  \"ambient/structure/tavern\" |\n  \"ambient/structure/warehouse\" |\n  \"ui/buttonClick\" |\n  \"ui/equip\" |\n  \"ui/error\" |\n  \"ui/levelUp\" |\n  \"ui/toast\" |\n  \"music/town\" |\n  \"music/world\" |\n  \"music/violettesElficSong\" |\n  \"scene/bow\" |\n  \"scene/crossbow\" |\n  \"scene/daggerSwish\" |\n  \"scene/doorOpen\" |\n  \"scene/drinking\" |\n  \"scene/meleeHit\" |\n  \"scene/metalBash\" |\n  \"scene/parry\" |\n  \"scene/shieldBash\" |\n  \"scene/swish\"\n;\n\ntype SoundInfo = {\n  instance: IMediaInstance;\n  gameSound: GameSound;\n  pixiSound: Sound;\n  storePosition?: boolean;\n}\n\nconst DEFAULT_MUSIC_VOLUME = 0;\nconst DEFAULT_UI_VOLUME = 1;\nconst DEFAULT_SCENE_VOLUME = 1;\nconst DEFAULT_AMBIENT_VOLUME = 0.2;\nconst STORAGE_KEY_VOLUME = \"channelVolume\";\n\nexport class SoundManager {\n  private static _sounds: { [key: string]: Sound[] } = {};\n  private static _currentSound: { [key: number]: SoundInfo } = {};  // per channel\n  private static _storedPositions: { [key: string]: number } = {};\n\n  private static _channelVolume: {[key: number]: number} = {};\n  private static _initialized = false;\n  private static _filter = new filters.TelephoneFilter()\n\n  public static async init() {\n    // Attempt to fetch volumes from storage. If not set, revert to defaults\n    this._channelVolume = {\n      [(Channel.music)]: await localforage.getItem(`${STORAGE_KEY_VOLUME}-${Channel.music}`) ?? DEFAULT_MUSIC_VOLUME,\n      [(Channel.ui)]: await localforage.getItem(`${STORAGE_KEY_VOLUME}-${Channel.ui}`) ?? DEFAULT_UI_VOLUME,\n      [(Channel.scene)]: await localforage.getItem(`${STORAGE_KEY_VOLUME}-${Channel.scene}`) ?? DEFAULT_SCENE_VOLUME,\n      [(Channel.ambient)]: await localforage.getItem(`${STORAGE_KEY_VOLUME}-${Channel.ambient}`) ?? DEFAULT_AMBIENT_VOLUME,\n    }\n    this._initialized = true;\n  }\n\n\n  public static async addSound(gameSound: GameSound, files: string[] | string, complete?: (sounds: Sound[]) => void) {\n    const promise = new Promise<Sound[]>((resolve, _reject) => {\n      if (typeof files === \"string\") {\n        files = [files];\n      }\n      if(this._sounds[gameSound]) {\n        // Sound already loaded. Great.\n        complete?.(this._sounds[gameSound]);\n        resolve(this._sounds[gameSound]);\n        return;\n      }\n\n      const loader = new Loader();\n      files.map((file) => loader.add(file));\n      loader.load((_, resources) => {\n        if (resources) {\n          // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n          // @ts-ignore no 'sound' property on LoaderResource\n          this._sounds[gameSound] = Object.values(resources).filter(Boolean).map(r => r.sound);\n          complete?.(this._sounds[gameSound]);\n          resolve(this._sounds[gameSound]);\n        }\n      });\n    })\n    return promise;\n  }\n\n  /**\n   * Plays a sound. The sound needs to be loaded through `addSound` first!\n   * @param gameSound the GameSound to play\n   * @param channel channel to play the sound on\n   * @param loop true to make the sound repeat\n   * @param mixMode how to mix in the new sound into the channel\n   * @param storePosition Store position of current sound on this channel in order to resume\n   */\n  public static async playSound(gameSound: GameSound, channel: Channel = Channel.ui, loop = false, mixMode: MixMode = MixMode.singleInstance, storePosition = false) {\n    if (!this._initialized) {\n      await this.init();\n    }\n    const pixiSound = this.getSound(gameSound);\n    pixiSound.volume = this._channelVolume[channel];\n    pixiSound.loop = loop;\n\n    if (this._currentSound[channel]?.storePosition) {\n      // Did we have to store the position of the current sound?\n      const oldSoundInfo = this._currentSound[channel];\n      oldSoundInfo.instance.once('progress', (progress: number , duration: number) => {\n        this._storedPositions[oldSoundInfo.gameSound] = progress * duration;\n      });\n    }\n    const start = this._storedPositions[gameSound] ?? 0;\n    const instance = await pixiSound.play({ start });\n\n    if (this._currentSound[channel]) {\n      if (mixMode === MixMode.fade) {\n        // Fade out current sound on this channel and fade in new sound\n        SoundManager.fadeOutSound(channel);\n        // Fade in the new sound\n        gsap.from(instance, { volume: 0, duration: 0.75 });\n      }\n      else if (mixMode === MixMode.singleInstance) {\n        this._currentSound[channel].instance.stop();\n      }\n    }\n    this._currentSound[channel] = { instance, gameSound, pixiSound, storePosition };\n    instance.on('end', () => {\n      this._currentSound[channel].instance.destroy();\n      delete this._currentSound[channel];\n    });\n  }\n\n  protected static getSound(sound: GameSound): Sound {\n    if (!this._sounds[sound]?.length) {\n      console.error(`No sound found for ${sound}`);\n    }\n    if (this._sounds[sound].length === 1) {\n      return this._sounds[sound][0];\n    }\n    else {\n      return this._sounds[sound][Math.floor(Math.random() * this._sounds[sound].length)];\n    }\n  }\n\n  public static stopSound(channel: Channel) {\n    this._currentSound[channel]?.instance.destroy();\n    delete this._currentSound[channel];\n  }\n\n  public static fadeOutSound(channel: Channel, duration = 0.75) {\n    const soundInfo = this._currentSound[channel];\n    gsap.to(soundInfo.instance, { volume: 0, duration, onComplete: () => {\n      soundInfo.instance.destroy();\n    }});\n  }\n\n  public static getCurrentlyPlaying(channel: Channel) {\n    return this._currentSound[channel]?.gameSound;\n  }\n\n  public static set musicFiltered(value: boolean) {\n    if(this._currentSound[Channel.music]) {\n      this._currentSound[Channel.music].pixiSound.filters = value ? [ this._filter ] : []\n    }\n  }\n\n  static getChannelVolume(channel: Channel): number {\n    return this._channelVolume[channel];\n  }\n\n  static setChannelVolume(channel: Channel, volume:number) {\n    this._channelVolume[channel] = volume;\n    if(this._currentSound[channel]?.instance) {\n      this._currentSound[channel].instance.volume = volume;\n    }\n    localforage.setItem(`${STORAGE_KEY_VOLUME}-${channel}`, volume);\n  }\n}\n","import { TiledObjectData } from 'constants/tiledMapData';\nimport { Item } from 'definitions/items/types';\nimport { Merge } from 'type-fest';\nimport { TiledObjectType } from 'utils/tilemap';\n\n\nexport interface SceneStoreState {\n  objects: SceneObject[];\n  actionQueue?: SceneAction[];\n  activeInteractionModal?: SceneInteractionModal;\n  combat: boolean;\n  turn?: Allegiance;\n}\n\nexport enum Allegiance {\n  player,\n  enemy,\n}\n\nexport type SceneObject = Merge<TiledObjectData, {\n  layerId: number;\n  properties: { [key: string]: string | boolean | number };\n  location?: [number, number];\n}>;\n\nexport type ActorObject = SceneObject & {\n  name: string;\n  ap: number;           // Remaining AP\n  level?: number;         // Only for enemy, for adventurers we look at the adventurers store\n  health: number;\n  allegiance: Allegiance;\n};\n\n// Type guard for ActorObject\nexport const isActorObject = (object: SceneObject): object is ActorObject => {\n  return object.type === TiledObjectType.actor;\n}\n\n// Returns true if given scene Object is an Adventurer (player controlled Actor)\nexport const isAdventurer = (object: SceneObject): object is ActorObject => {\n  return isActorObject(object) && object.allegiance === Allegiance.player;\n}\n\n// Returns true if given scene Object is an Enemy (AI controlled Actor)\nexport const isEnemy = (object: SceneObject): object is ActorObject => {\n  return isActorObject(object) && object.allegiance === Allegiance.enemy;\n}\n\n// Returns the ActorObject belonging to given adventurerId\nexport const getAdventurer = (objects: SceneObject[], adventurerId: string): ActorObject | undefined => {\n  return objects.find(o => isAdventurer(o) && o.name === adventurerId) as ActorObject;\n}\n\n // export type Actor = SceneObject & {\n//   type: \"actor\";\n//   //allegiance: Allegiance;\n//   health: number;\n//   //remainingAP: number;\n// }\n\nexport type SceneInteractionModal =\n| { type: 'lootCache', lootCache: string }\n| { type: 'situation', situation: string }\n\nexport interface LootCache {\n  title: string;\n  items: Item[];\n  gold?: number;\n  open?: boolean;\n}\n\nexport interface SceneAction {\n  actionType: SceneActionType;\n  actorId: string;\n  target: [number, number];\n  endsAt: number;\n}\n\nexport enum SceneActionType {\n  move = \"move\",\n  interact = \"interact\",\n  attack = \"attack\",\n  slash = \"slash\",\n  shoot = \"shoot\"\n}\n\n","import { ItemType, ItemDefinition, ItemCategory } from \"./types\";\nimport { Rarity } from 'constants/items';\nimport { Effect, EffectAttibuteIncrease, EffectType } from \"definitions/effects/types\";\n\ntype Prefix = \"weapon/\";\nconst PREFIX = \"weapon/\";\nconst itemCategory = ItemCategory.weapon;\nconst basePath = \"/img/items/weapons/\";\n\nexport enum WeaponType {\n  axe = \"axe\",\n  bow = \"bow\",\n  club = \"club\",\n  crossbow = \"crossbow\",\n  fist = \"fist\",\n  flail = \"flail\",\n  hammer = \"hammer\",\n  knife = \"knife\",\n  staff = \"staff\",\n  shield = \"shield\",\n  sword = \"sword\",\n  poleArm = \"poleArm\",\n}\n\nexport enum WeaponAbility {\n  aimedShot,\n  swing,\n  block,\n  cut,\n  cleave,\n  shoot,\n  slash,\n  parry,\n}\n\nexport enum WeaponClassification {\n  oneHanded,  // Can be used in main hand or off hand\n  mainHand,   // Can only be used in main hand\n  offHand,    // Can only be used in the off hand\n  twoHanded,  // Can be used in the main hand and will disable off hand from being used\n  shield,     // ?\n  ranged      // requires ammo\n}\n\nexport const WeaponTypeDefinition = {\n  [WeaponType.axe]: {\n    classification: WeaponClassification.oneHanded,\n    abilities: [WeaponAbility.cut],\n  },\n  [WeaponType.bow]: {\n    classification: WeaponClassification.ranged,\n    abilities: [WeaponAbility.shoot]\n  },\n  [WeaponType.club]: {\n    classification: WeaponClassification.oneHanded,\n    abilities: [WeaponAbility.swing, WeaponAbility.parry]\n  },\n  [WeaponType.crossbow]: {\n    classification: WeaponClassification.ranged,\n    abilities: [WeaponAbility.aimedShot, WeaponAbility.shoot]\n  },\n  [WeaponType.fist]: {\n    classification: WeaponClassification.oneHanded,\n    abilities: [WeaponAbility.swing]\n  },\n  [WeaponType.flail]: {\n    classification: WeaponClassification.mainHand,\n    abilities: [WeaponAbility.swing, WeaponAbility.parry]\n  },\n  [WeaponType.hammer]: {\n    classification: WeaponClassification.oneHanded,\n    abilities: [WeaponAbility.swing, WeaponAbility.parry]\n  },\n  [WeaponType.knife]: {\n    classification: WeaponClassification.oneHanded,\n    abilities: [WeaponAbility.cut, WeaponAbility.parry]\n  },\n  [WeaponType.staff]: {\n    classification: WeaponClassification.twoHanded,\n    abilities: [WeaponAbility.swing, WeaponAbility.parry]\n  },\n  [WeaponType.sword]: {\n    classification: WeaponClassification.oneHanded,\n    abilities: [WeaponAbility.swing, WeaponAbility.parry]\n  },\n  [WeaponType.poleArm]: {\n    classification: WeaponClassification.twoHanded,\n    abilities: [WeaponAbility.swing, WeaponAbility.parry]\n  },\n  [WeaponType.shield]: {\n    classification: WeaponClassification.shield,\n    abilities: [WeaponAbility.block]\n  }\n}\n\nexport enum DamageType {\n  kinetic = \"kinetic\",\n}\n\nexport interface DamageDefinition {\n  [DamageType.kinetic]: number | undefined;\n}\n\n\nexport interface WeaponDefinition extends ItemDefinition {\n  weaponType: WeaponType;\n  damage?: DamageDefinition;\n  effects?: Effect[];\n}\n\nconst weapons = {\n  aegisOfValor: {\n    itemCategory,\n    weaponType: WeaponType.shield,\n    rarity: Rarity.legendary,\n    iconImg: `${basePath}aegis-of-valor.png`,\n  },\n  arbalest: {\n    itemCategory,\n    weaponType: WeaponType.crossbow,\n    rarity: Rarity.epic,\n    iconImg: `${basePath}arbalest.png`,\n    damage: { [DamageType.kinetic]: 40 },\n  },\n  battleAxe: {\n    itemCategory,\n    weaponType: WeaponType.axe,\n    rarity: Rarity.common,\n    iconImg: `${basePath}battle-axe.png`,\n    damage: { [DamageType.kinetic]: 20 },\n  },\n  berserkerShield: {\n    itemCategory,\n    weaponType: WeaponType.shield,\n    rarity: Rarity.epic,\n    iconImg: `${basePath}berserker-shield.png`,\n  },\n  brassKnuckles: {\n    itemCategory,\n    weaponType: WeaponType.fist,\n    iconImg: `${basePath}brass-knuckles.png`,\n    rarity: Rarity.common,\n    damage: { [DamageType.kinetic]: 10 },\n  },\n  bronzeDagger: {\n    itemCategory,\n    weaponType: WeaponType.knife,\n    iconImg: `${basePath}bronze-dagger.png`,\n    rarity: Rarity.common,\n    damage: { [DamageType.kinetic]: 8 },\n  },\n  buckler: {\n    itemCategory,\n    weaponType: WeaponType.shield,\n    rarity: Rarity.common,\n    iconImg: `${basePath}buckler.png`,\n  },\n  cleaver: {\n    itemCategory,\n    weaponType: WeaponType.knife,\n    iconImg: `${basePath}cleaver.png`,\n    rarity: Rarity.common,\n    damage: { [DamageType.kinetic]: 5 },\n  },\n  club: {\n    itemCategory,\n    weaponType: WeaponType.club,\n    iconImg: `${basePath}club.png`,\n    rarity: Rarity.common,\n    damage: { [DamageType.kinetic]: 8 },\n  },\n  dagger: {\n    itemCategory,\n    weaponType: WeaponType.knife,\n    iconImg: `${basePath}dagger.png`,\n    rarity: Rarity.rare,\n    damage: { [DamageType.kinetic]: 10 },\n  },\n  dirk: {\n    itemCategory,\n    weaponType: WeaponType.knife,\n    iconImg: `${basePath}dirk.png`,\n    rarity: Rarity.uncommon,\n    damage: { [DamageType.kinetic]: 10 },\n  },\n  falchion: {\n    itemCategory,\n    weaponType: WeaponType.sword,\n    iconImg: `${basePath}falchion.png`,\n    rarity: Rarity.rare,\n    damage: { [DamageType.kinetic]: 12 },\n  },\n  flail: {\n    itemCategory,\n    weaponType: WeaponType.flail,\n    iconImg: `${basePath}flail.png`,\n    rarity: Rarity.uncommon,\n    damage: { [DamageType.kinetic]: 15 },\n  },\n  goldenShield: {\n    itemCategory,\n    weaponType: WeaponType.shield,\n    rarity: Rarity.rare,\n    iconImg: `${basePath}golden-shield.png`,\n  },\n  greatswordOfGwai: {\n    itemCategory,\n    weaponType: WeaponType.sword,\n    iconImg: `${basePath}greatsword-gwai.png`,\n    unique: true,\n    rarity: Rarity.legendary,\n    damage: { [DamageType.kinetic]: 25 },\n    effects: [{\n      type: EffectType.attributeIncrease,\n      attribute: \"agi\",\n      factor: 1.1,\n    }, {\n      type: EffectType.attributeIncrease,\n      attribute: \"for\",\n      factor: 1.1,\n    }, {\n      type: EffectType.attributeIncrease,\n      attribute: \"int\",\n      factor: 1.1,\n    }, {\n      type: EffectType.attributeIncrease,\n      attribute: \"str\",\n      factor: 1.1,\n    }] as EffectAttibuteIncrease[]\n  },\n  halbert: {\n    itemCategory,\n    weaponType: WeaponType.poleArm,\n    iconImg: `${basePath}halbert.png`,\n    rarity: Rarity.rare,\n    damage: { [DamageType.kinetic]: 12 },\n  },\n  huntingBow: {\n    itemCategory,\n    weaponType: WeaponType.bow,\n    iconImg: `${basePath}hunting-bow.png`,\n    rarity: Rarity.common,\n    damage: { [DamageType.kinetic]: 3 },\n  },\n  indomitableCarapace: {\n    itemCategory,\n    weaponType: WeaponType.shield,\n    rarity: Rarity.epic,\n    unique: true,\n    iconImg: `${basePath}indomitable-carapace.png`,\n  },\n  jaggedBlade: {\n    itemCategory,\n    weaponType: WeaponType.knife,\n    rarity: Rarity.epic,\n    iconImg: `${basePath}jagged-blade.png`,\n  },\n  javelin: {\n    itemCategory,\n    weaponType: WeaponType.poleArm,\n    iconImg: `${basePath}javelin.png`,\n    rarity: Rarity.epic,\n    damage: { [DamageType.kinetic]: 25 },\n  },\n  khopesh: {\n    itemCategory,\n    weaponType: WeaponType.sword,\n    iconImg: `${basePath}khopesh.png`,\n    rarity: Rarity.epic,\n    damage: { [DamageType.kinetic]: 15 },\n  },\n  legionnaireSword: {\n    itemCategory,\n    weaponType: WeaponType.sword,\n    iconImg: `${basePath}legionnaire-sword.png`,\n    rarity: Rarity.rare,\n    damage: { [DamageType.kinetic]: 8 },\n  },\n  longbow: {\n    itemCategory,\n    weaponType: WeaponType.bow,\n    iconImg: `${basePath}longbow.png`,\n    rarity: Rarity.rare,\n    damage: { [DamageType.kinetic]: 2 },\n  },\n  mace: {\n    itemCategory,\n    weaponType: WeaponType.club,\n    iconImg: `${basePath}mace.png`,\n    rarity: Rarity.rare,\n    damage: { [DamageType.kinetic]: 15 },\n  },\n  morningStar: {\n    itemCategory,\n    weaponType: WeaponType.club,\n    iconImg: `${basePath}morning-star.png`,\n    rarity: Rarity.uncommon,\n    damage: { [DamageType.kinetic]: 13 },\n  },\n  paintedBuckler: {\n    itemCategory,\n    weaponType: WeaponType.shield,\n    iconImg: `${basePath}painted-buckler.png`,\n  },\n  poisonedDagger: {\n    itemCategory,\n    weaponType: WeaponType.knife,\n    iconImg: `${basePath}poisoned-dagger.png`,\n    rarity: Rarity.epic,\n    damage: { [DamageType.kinetic]: 12 },\n  },\n  pikeStaff: {\n    itemCategory,\n    weaponType: WeaponType.poleArm,\n    iconImg: `${basePath}pike-staff.png`,\n    rarity: Rarity.uncommon,\n    damage: { [DamageType.kinetic]: 22 },\n  },\n  ravenStaff: {\n    itemCategory,\n    weaponType: WeaponType.staff,\n    iconImg: `${basePath}raven-staff.png`,\n    rarity: Rarity.epic,\n    damage: { [DamageType.kinetic]: 13 },\n  },\n  scythe: {\n    itemCategory,\n    weaponType: WeaponType.poleArm,\n    iconImg: `${basePath}scythe.png`,\n    rarity: Rarity.common,\n    damage: { [DamageType.kinetic]: 5 },\n  },\n  savageStaff: {\n    itemCategory,\n    weaponType: WeaponType.staff,\n    iconImg: `${basePath}savage-staff.png`,\n    rarity: Rarity.epic,\n    damage: { [DamageType.kinetic]: 8 },\n  },\n  simpleCrossbow: {\n    itemCategory,\n    weaponType: WeaponType.crossbow,\n    iconImg: `${basePath}crossbow.png`,\n    rarity: Rarity.common,\n    damage: { [DamageType.kinetic]: 3 },\n  },\n  spear: {\n    itemCategory,\n    weaponType: WeaponType.poleArm,\n    iconImg: `${basePath}spear.png`,\n    rarity: Rarity.rare,\n    damage: { [DamageType.kinetic]: 10 },\n  },\n  steelShield: {\n    itemCategory,\n    weaponType: WeaponType.shield,\n    rarity: Rarity.rare,\n    iconImg: `${basePath}steel-shield.png`,\n  },\n  steelSword: {\n    itemCategory,\n    weaponType: WeaponType.sword,\n    iconImg: `${basePath}steel-sword.png`,\n    rarity: Rarity.uncommon,\n    damage: { [DamageType.kinetic]: 14 },\n  },\n  warhammer: {\n    itemCategory,\n    weaponType: WeaponType.hammer,\n    iconImg: `${basePath}warhammer.png`,\n    rarity: Rarity.rare,\n    damage: { [DamageType.kinetic]: 16 },\n  },\n  woodenBulwark: {\n    itemCategory,\n    weaponType: WeaponType.shield,\n    rarity: Rarity.common,\n    iconImg: `${basePath}wooden-bulwark.png`,\n  },\n};\n\n\nexport type Weapon = `${Prefix}${keyof typeof weapons}`;\nconst all = Object.entries(weapons).reduce<{[key: string]: WeaponDefinition}>((acc, [key, value]) => {\n  acc[`${PREFIX}${key}`] = value;\n  return acc;\n}, {}) as Record<Weapon, WeaponDefinition>;\nexport default all;\n\nexport function getDefinition(weapon: Weapon): WeaponDefinition {\n  return all[weapon];\n}\n\nexport const isWeapon = (item: ItemType): item is Weapon => {\n  return !!all[item as Weapon];\n}\n","import { QuestStoreState } from 'store/types/quest';\nimport { ItemType } from 'definitions/items/types';\n\nexport enum QuestNodeType {\n  nothing = 0,  // Nothing much going on here\n  encounter = 1,\n  // combat = 2,   // Not implemented\n  // boss = 3,\n}\n\n// eslint-disable-next-line @typescript-eslint/ban-types\nexport interface QuestDefinition<TQuestVars = unknown> {\n  nodes: QuestNode[];\n  requiredItems?: ItemType[];\n  getQuestVars: (questStoreState: QuestStoreState) => TQuestVars;\n  getInitialQuestVars: (questStoreState: QuestStoreState) => TQuestVars;\n}\n\ntype AllNodeTypes = {\n  x: number;\n  y: number;\n  log?: string;\n}\n\nexport type QuestNode  =\n  | AllNodeTypes & { type: QuestNodeType.nothing}\n  | AllNodeTypes & { type: QuestNodeType.encounter, startScene: string}\n","import { Rarity } from 'constants/items';\nimport { Ammunition } from './ammunition';\nimport { Apparel } from './apparel';\nimport { Deed } from './deeds';\nimport { Herb } from './herbs';\nimport { Material } from './materials';\nimport { Mineral } from './minerals';\nimport { Consumable } from './consumables';\nimport { QuestItem } from './questItems';\nimport { Trinket } from './trinkets';\nimport { Weapon } from './weapons';\n\nexport enum ItemCategory {\n  ammunition,\n  apparel,\n  consumable,\n  deed,\n  herb,\n  material,\n  mineral,\n  questItem,\n  trinket,\n  weapon,\n}\n\nexport type ItemType = Ammunition | Apparel | Deed | Herb | Material | Mineral | Consumable | QuestItem | Trinket | Weapon;\n\nexport type Item<T = ItemType> = {\n  type: T;\n  quantity?: number; // defaults to 1\n  durability?: number; // 0 to 1\n}\n\nexport const isItemType = (test: Item | ItemType): test is ItemType => {\n  return !Object.prototype.hasOwnProperty.call(test, \"type\");\n}\n\nexport interface ItemDefinition {\n  itemCategory: ItemCategory;\n  iconImg: string;\n  rarity?: Rarity;\n//  articleUndefined?: string;  // Key to text\n  unique?: boolean;       // Indicate that this item is unique.\n                // Not actually enforced by anything,\n                // but used to generate the article ('a' or 'the')\n}\n","import * as React from \"react\";\nimport { PropsWithChildren } from 'react';\nimport \"./styles/icon.scss\";\n\nexport interface Props {\n  image: string;\n  size?: IconSizeType;\n  className?: string;\n  border?: Border | keyof typeof Border;\n}\n\nexport enum IconSize {\n  smallest = \"smallest\",\n  small = \"small\",\n  medium = \"medium\",\n  big = \"big\",\n  biggest = \"biggest\"\n}\n\nexport type IconSizeType = IconSize | keyof typeof IconSize;\n\nexport enum Border {\n  none = \"none\",\n  gold = \"gold\"\n}\n\nconst Icon = (props: PropsWithChildren<Props> & React.ComponentProps<\"div\">) => {\n  const {\n    image,\n    size,\n    children,\n    className = \"\",\n    border = \"none\",\n    ...restProps\n  } = props;\n  return (\n    <div\n      className={`icon ${sizeClassName((typeof size === \"string\") ? IconSize[size] : size)} ${className}`}\n      {...restProps}\n      style={{\n        backgroundImage: `url(${process.env.PUBLIC_URL}${image})`,\n      }}\n    >\n      {children}\n      { border !== \"none\" && border && (\n        <div className={`border ${borderClassName((typeof border === \"string\") ? Border[border] : border)} `}/>\n      )}\n    </div>\n  );\n};\n\nexport default Icon;\n\n\nconst sizeClassName = (size?: IconSize): string => {\n  switch (size) {\n    case IconSize.smallest:\n      return \"size-smallest\";\n    case IconSize.small:\n      return \"size-small\";\n    case IconSize.medium:\n      return \"size-medium\";\n    case IconSize.big:\n      return \"size-big\";\n    case IconSize.biggest:\n      return \"size-biggest\";\n  }\n  return sizeClassName(IconSize.medium);\n};\n\nconst borderClassName = (border?: Border): string => {\n  switch (border) {\n    case Border.gold:\n      return \"border-gold\";\n    case Border.none:\n    default:\n      return \"\";\n  }\n}\n","import { DragSourceType } from \"./dragging\";\n\nexport enum Rarity {\n  // gray = common, green = uncommon, blue = rare, purple = epic, orange = legendary\n  common,\n  uncommon,\n  rare,\n  epic,\n  legendary\n}\n\n// Information about where an item is found\nexport interface ItemSource {\n  origin: DragSourceType;\n  id?: string;  // eg: adventurerId\n  slot?: number;  // slot in the inventory\n}\n","\n// Things that can be dragged\nexport const DragType = {\n  ADVENTURER: \"adventurer\",   // Adventurer avatar\n  ITEM: \"item\",         // A game 'item' (equipment, etc)\n};\n\n// Source, where it comes from\nexport enum DragSourceType {\n  adventurerInventory,\n  adventurerConsumeItem,\n  warehouse,\n  tavern,\n  adventurerEquipment,\n  lootCache,\n  resourceStructure // harvest\n}\n","import { AdventurerStoreState } from \"store/types/adventurer\";\nimport { SceneAction, SceneStoreState, SceneInteractionModal, Allegiance } from \"store/types/scene\";\nimport { PartialDeep } from \"type-fest\";\n\nexport type QuestAction =\n  { type: \"launchQuest\", questName: string, assignedAventurers: AdventurerStoreState[] }\n |  { type: \"exitEncounter\", questName: string }\n |  { type: \"updateQuestVars\", questName: string, vars: PartialDeep<unknown> }\n |  { type: \"setSceneName\", questName: string, sceneName: string }\n |  { type: \"setScene\", questName: string, scene: SceneStoreState; }\n |  { type: \"enqueueSceneAction\", questName: string, sceneAction: SceneAction }\n |  { type: \"completeSceneAction\", questName: string }\n |  { type: \"setCombat\", questName: string, combat: boolean }\n |  { type: \"endPlayerTurn\", questName: string }\n |  { type: \"startTurn\", questName: string, turn: Allegiance, adventurers?: AdventurerStoreState[] }\n |  { type: \"deductActorAp\", questName: string,  actor: string, ap: number }\n |  { type: \"setActorAp\", questName: string, actor: string, ap: number }\n//  |  { type: \"updateEncounterResult\", questName: string, nodeIndex: number, result: string }\n |  { type: \"setActiveSceneInteractionModal\", questName: string, sceneInteractionModal?: SceneInteractionModal }\n\n;\n\n\n/**\n * Embark upon a new quest */\nexport const launchQuest = (questName: string, assignedAventurers: AdventurerStoreState[]): QuestAction => ({\n  type: \"launchQuest\",\n  questName,\n  assignedAventurers,\n})\n\n/**\n * Completes the current encounter so the party can continue the quest */\nexport const exitEncounter = (quest: string): QuestAction => ({\n  type: \"exitEncounter\",\n  questName: quest,\n})\n\nexport const updateQuestVars = (quest: string, vars: PartialDeep<unknown>): QuestAction => ({\n  type: \"updateQuestVars\",\n  questName: quest,\n  vars,\n})\n\n/**\n * Sets name of the current scene of a quest */\nexport const setSceneName = (questName: string, sceneName: string): QuestAction =>({\n  type: \"setSceneName\",\n  questName,\n  sceneName,\n})\n\n/**\n * Fills in the scene of a quest */\nexport const setScene = (questName: string, scene: SceneStoreState): QuestAction => ({\n  type: \"setScene\",\n  questName,\n  scene,\n})\n\nexport const enqueueSceneAction = (questName: string, sceneAction: SceneAction): QuestAction => ({\n  type: \"enqueueSceneAction\",\n  questName,\n  sceneAction,\n})\n\nexport const completeSceneAction = (questName: string): QuestAction => ({\n  type: \"completeSceneAction\",\n  questName,\n})\n\nexport const setCombat = (questName: string, combat: boolean): QuestAction => ({\n  type: \"setCombat\",\n  questName,\n  combat\n})\n\nexport const endPlayerTurn = (questName: string): QuestAction => ({\n  type: \"endPlayerTurn\",\n  questName,\n})\n\nexport const startTurn = (questName: string, turn: Allegiance, adventurers?: AdventurerStoreState[]): QuestAction => ({\n  type: \"startTurn\",\n  questName,\n  turn,\n  adventurers\n})\n\nexport const deductActorAp = (questName: string, actor: string, ap: number): QuestAction => ({\n  type: \"deductActorAp\",\n  questName,\n  actor,\n  ap\n})\n\nexport const setActorAp = (questName: string, actor: string, ap: number): QuestAction => ({\n  type: \"setActorAp\",\n  questName,\n  actor,\n  ap\n})\n\n\n// export const updateEncounterResult = (questName: string, nodeIndex: number, result: string): QuestAction => ({\n//   type: \"updateEncounterResult\",\n//   questName,\n//   nodeIndex,\n//   result,\n// })\n\nexport const setActiveSceneInteractionModal = (questName: string, sceneInteractionModal?: SceneInteractionModal): QuestAction => ({\n  type: \"setActiveSceneInteractionModal\",\n  questName,\n  sceneInteractionModal\n})\n\n","import { ItemType, ItemDefinition, ItemCategory } from \"./types\";\n\ntype Prefix = \"herb/\";\nconst PREFIX = \"herb/\";\nconst itemCategory = ItemCategory.herb;\nconst basePath = \"/img/items/herbs/\";\n\nconst herbs = {\n  angelicasSorrow: {\n    itemCategory,\n    iconImg: `${basePath}angelicas-sorrow.png`,\n  },\n  bansheeReeds: {\n    itemCategory,\n    iconImg: `${basePath}banshee-reeds.png`,\n  },\n  blissflower: {\n    itemCategory,\n    iconImg: `${basePath}blissflower.png`,\n  },\n  bloodLotus: {\n    itemCategory,\n    iconImg: `${basePath}blood-lotus.png`,\n  },\n  bogroot: {\n    itemCategory,\n    iconImg: `${basePath}bogroot.png`,\n  },\n  ceviorise: {\n    itemCategory,\n    iconImg: `${basePath}ceviorise.png`,\n  },\n  chicory: {\n    itemCategory,\n    iconImg: `${basePath}chicory.png`,\n  },\n  dragonroot: {\n    itemCategory,\n    iconImg: `${basePath}dragonroot.png`,\n  },\n  heartsVine: {\n    itemCategory,\n    iconImg: `${basePath}hearts-vine.png`,\n  },\n  hyacinthus: {\n    itemCategory,\n    iconImg: `${basePath}hyacinthus.png`,\n  },\n  jaboticaba: {\n    itemCategory,\n    iconImg: `${basePath}jaboticaba.png`,\n  },\n  kingsrose: {\n    itemCategory,\n    iconImg: `${basePath}kingsrose.png`,\n  },\n  lastSupper: {\n    itemCategory,\n    iconImg: `${basePath}last-supper.png`,\n  },\n  mistagold: {\n    itemCategory,\n    iconImg: `${basePath}mistagold.png`,\n  },\n  monksweed: {\n    itemCategory,\n    iconImg: `${basePath}monksweed.png`,\n  },\n  moonFlower: {\n    itemCategory,\n    iconImg: `${basePath}moon-flower.png`,\n  },\n  mountainGrass: {\n    itemCategory,\n    iconImg: `${basePath}mountain-grass.png`,\n  },\n  oakLeaf: {\n    itemCategory,\n    iconImg: `${basePath}oak-leaf.png`,\n  },\n  patricksroot: {\n    itemCategory,\n    iconImg: `${basePath}patricksroot.png`,\n  },\n  sunleaf: {\n    itemCategory,\n    iconImg: `${basePath}sunleaf.png`,\n  },\n  trollsFeast: {\n    itemCategory,\n    iconImg: `${basePath}trolls-feast.png`,\n  },\n  uwolic: {\n    itemCategory,\n    iconImg: `${basePath}uwolic.png`,\n  },\n  wyrmvine: {\n    itemCategory,\n    iconImg: `${basePath}wyrmvine.png`,\n  },\n  winterWeed: {\n    itemCategory,\n    iconImg: `${basePath}winter-weed.png`,\n  },\n  wizardsBane: {\n    itemCategory,\n    iconImg: `${basePath}wizards-bane.png`,\n  },\n};\n\nexport type Herb = `${Prefix}${keyof typeof herbs}`;\nconst all = Object.entries(herbs).reduce<{[key: string]: ItemDefinition}>((acc, [key, value]) => {\n  acc[`${PREFIX}${key}`] = value;\n  return acc;\n}, {}) as Record<Herb, ItemDefinition>;\nexport default all;\n\nexport function getDefinition(herb: Herb): ItemDefinition {\n  return all[herb];\n}\n\nexport const isHerb = (item: ItemType): item is Herb => {\n  return !!all[item as Herb];\n}\n","import { ItemType, ItemDefinition, ItemCategory } from \"./types\";\n\ntype Prefix = \"material/\";\nconst PREFIX = \"material/\";\nconst itemCategory = ItemCategory.material;\nconst basePath = \"/img/items/materials/\";\n\n\nconst materials = {\n  arrowheads: {\n    itemCategory,\n    iconImg: `${basePath}arrowheads.png`,\n  },\n  beam: {\n    itemCategory,\n    iconImg: `${basePath}beam.png`,\n  },\n  bolts: {\n    itemCategory,\n    iconImg: `${basePath}bolts.png`,\n  },\n  buckle: {\n    itemCategory,\n    iconImg: `${basePath}buckle.png`,\n  },\n  chain: {\n    itemCategory,\n    iconImg: `${basePath}chain.png`,\n  },\n  cogs: {\n    itemCategory,\n    iconImg: `${basePath}cogs.png`,\n  },\n  gunpowder: {\n    itemCategory,\n    iconImg: `${basePath}gunpowder.png`,\n  },\n  ingot: {\n    itemCategory,\n    iconImg: `${basePath}ingot.png`,\n  },\n  nails: {\n    itemCategory,\n    iconImg: `${basePath}nails.png`,\n  },\n  pile: {\n    itemCategory,\n    iconImg: `${basePath}pile.png`,\n  },\n  planks: {\n    itemCategory,\n    iconImg: `${basePath}planks.png`,\n  },\n  poisonVial: {\n    itemCategory,\n    iconImg: `${basePath}poison-vial.png`,\n  },\n  pulley: {\n    itemCategory,\n    iconImg: `${basePath}pulley.png`,\n  },\n  ribbon: {\n    itemCategory,\n    iconImg: `${basePath}ribbon.png`,\n  },\n  rope: {\n    itemCategory,\n    iconImg: `${basePath}rope.png`,\n  },\n  runeCarvedPlank: {\n    itemCategory,\n    iconImg: `${basePath}rune-carved-plank.png`,\n  },\n  scales: {\n    itemCategory,\n    iconImg: `${basePath}scales.png`,\n  },\n  spring: {\n    itemCategory,\n    iconImg: `${basePath}spring.png`,\n  },\n  stake: {\n    itemCategory,\n    iconImg: `${basePath}stake.png`,\n  },\n  stick: {\n    itemCategory,\n    iconImg: `${basePath}stick.png`,\n  },\n  thread: {\n    itemCategory,\n    iconImg: `${basePath}thread.png`,\n  },\n  woodenMask: {\n    itemCategory,\n    iconImg: `${basePath}wooden-mask.png`,\n  },\n};\n\n\nexport type Material = `${Prefix}${keyof typeof materials}`;\nconst all = Object.entries(materials).reduce<{[key: string]: ItemDefinition}>((acc, [key, value]) => {\n  acc[`${PREFIX}${key}`] = value;\n  return acc;\n}, {}) as Record<Material, ItemDefinition>;\nexport default all;\n\nexport function getDefinition(material: Material): ItemDefinition {\n  return all[material];\n}\n\nexport const isMaterial = (item: ItemType): item is Material => {\n  return !!all[item as Material];\n}\n","import { ItemType, ItemDefinition, ItemCategory } from \"./types\";\n\ntype Prefix = \"mineral/\";\nconst PREFIX = \"mineral/\";\nconst itemCategory = ItemCategory.mineral;\nconst basePath = \"/img/items/minerals/\";\n\n// Minerals can be used to imbue magical powers to weapons and armor\nconst minerals = {\n  amethyst: {\n    itemCategory,\n    iconImg: `${basePath}amethyst.png`,\n  },\n  aquamarine: {\n    itemCategory,\n    iconImg: `${basePath}aquamarine.png`,\n  },\n  arminsHeart: {\n    itemCategory,\n    iconImg: `${basePath}armins-heart.png`,\n  },\n  dragonsTooth: {\n    itemCategory,\n    iconImg: `${basePath}dragons-tooth.png`,\n  },\n  greenOpal: {\n    itemCategory,\n    iconImg: `${basePath}green-opal.png`,\n  },\n  jasper: {\n    itemCategory,\n    iconImg: `${basePath}jasper.png`,\n  },\n  malachite: {\n    itemCategory,\n    iconImg: `${basePath}malachite.png`,\n  },\n  moonstone: {\n    itemCategory,\n    iconImg: `${basePath}moonstone.png`,\n  },\n  obsidian: {\n    itemCategory,\n    iconImg: `${basePath}obsidian.png`,\n  },\n  roseQuartz: {\n    itemCategory,\n    iconImg: `${basePath}rose-quartz.png`,\n  },\n  sapphire: {\n    itemCategory,\n    iconImg: `${basePath}sapphire.png`,\n  },\n  spellstone: {\n    itemCategory,\n    iconImg: `${basePath}spellstone.png`,\n  },\n  tigersEye: {\n    itemCategory,\n    iconImg: `${basePath}tigers-eye.png`,\n  },\n  topaz: {\n    itemCategory,\n    iconImg: `${basePath}topaz.png`,\n  },\n  wyrdstone: {\n    itemCategory,\n    iconImg: `${basePath}wyrdstone.png`,\n  },\n};\n\n\nexport type Mineral = `${Prefix}${keyof typeof minerals}`;\nconst all = Object.entries(minerals).reduce<{[key: string]: ItemDefinition}>((acc, [key, value]) => {\n  acc[`${PREFIX}${key}`] = value;\n  return acc;\n}, {}) as Record<Mineral, ItemDefinition>;\nexport default all;\n\nexport function getDefinition(mineral: Mineral): ItemDefinition {\n  return all[mineral];\n}\n\nexport const isMineral = (item: ItemType): item is Mineral => {\n  return !!all[item as Mineral];\n}\n","import {  ItemType, ItemDefinition, ItemCategory } from \"./types\";\n\ntype Prefix = \"trinket/\";\nconst PREFIX = \"trinket/\";\nconst itemCategory = ItemCategory.trinket;\nconst basePath = \"/img/items/trinkets/\";\n\nconst trinkets = {\n  magicAmulet: {\n    itemCategory,\n    iconImg: `${basePath}magic_amulet.png`,\n  },\n  ring: {\n    itemCategory,\n    iconImg: `${basePath}ring.png`,\n  },\n};\n\n\nexport type Trinket = `${Prefix}${keyof typeof trinkets}`;\nconst all = Object.entries(trinkets).reduce<{[key: string]: ItemDefinition}>((acc, [key, value]) => {\n  acc[`${PREFIX}${key}`] = value;\n  return acc;\n}, {}) as Record<Trinket, ItemDefinition>;\nexport default all;\n\nexport function getDefinition(trinket: Trinket): ItemDefinition {\n  return all[trinket];\n}\n\nexport const isTrinket = (item: ItemType): item is Trinket => {\n  return !!all[item as Trinket];\n}\n","import ammunition, { Ammunition } from \"./ammunition\";\nimport apparel, { Apparel, isApparel, getDefinition as getApparelDefinition, ApparelDefinition } from \"./apparel\";\nimport deeds, { Deed } from \"./deeds\";\nimport herbs, { Herb } from \"./herbs\";\nimport materials, { Material } from \"./materials\";\nimport minerals, { Mineral } from \"./minerals\";\nimport consumables, { Consumable } from \"./consumables\";\nimport questItems, { QuestItem } from \"./questItems\";\nimport trinkets, { Trinket } from \"./trinkets\";\nimport { ItemType, ItemDefinition, ItemCategory } from \"./types\";\nimport weapons, { Weapon, WeaponDefinition, isWeapon, getDefinition as getWeaponDefinition  } from \"./weapons\";\n\nconst all = {\n  ...ammunition,\n  ...apparel,\n  ...consumables,\n  ...deeds,\n  ...herbs,\n  ...materials,\n  ...minerals,\n  ...questItems,\n  ...trinkets,\n  ...weapons,\n};\n\nexport default all;\n\nexport const getDefinition = (itemType: ItemType): ItemDefinition => {\n  return all[itemType]\n}\n\nexport const getWeaponOrApparelDefinition = (itemType: ItemType): WeaponDefinition | ApparelDefinition => {\n  if (isApparel(itemType)) {\n    return getApparelDefinition(itemType);\n  }\n  if (isWeapon(itemType)) {\n    return getWeaponDefinition(itemType);\n  }\n\n  throw new Error(`${itemType} is neither a weapon nor apparel`);\n}\n\nexport const getAllItemsByCategory = (category: ItemCategory): ItemType[] => {\n  switch (category) {\n    case ItemCategory.ammunition:\n      return Object.keys(ammunition) as Ammunition[];\n    case ItemCategory.apparel:\n      return Object.keys(apparel) as Apparel[];\n    case ItemCategory.deed:\n      return Object.keys(deeds) as Deed[];\n    case ItemCategory.herb:\n      return Object.keys(herbs) as Herb[];\n    case ItemCategory.material:\n      return Object.keys(materials) as Material[];\n    case ItemCategory.mineral:\n      return Object.keys(minerals) as Mineral[];\n    case ItemCategory.consumable:\n      return Object.keys(consumables) as Consumable[];\n    case ItemCategory.questItem:\n      return Object.keys(questItems) as QuestItem[];\n    case ItemCategory.trinket:\n      return Object.keys(trinkets) as Trinket[];\n    case ItemCategory.weapon:\n      return Object.keys(weapons) as Weapon[];\n  }\n}\n\nexport const canStackItem = (category: ItemCategory): boolean => {\n  return category === ItemCategory.ammunition;\n}\n","// Utilities for routing\n\nimport { Structure } from 'definitions/structures';\n\nexport const getWorldLink = () => `/world`;\nexport const getQuestLink = (questName: string) => `${getWorldLink()}/${questName}`;\n\nexport const getTownLink = () => `/town`;\nexport const getStructureLink = (structure: Structure, onlyHighlight = false) => `${getTownLink()}/${structure}${onlyHighlight ? '' : '/view'}`;\n","import { EquipmentSlotType } from \"components/ui/adventurer/EquipmentSlot\";\nimport { Effect } from \"definitions/effects/types\";\nimport { Item } from \"definitions/items/types\";\nimport { TempEffect } from \"definitions/tempEffects/types\";\nimport { AttributesStoreState } from \"store/types/adventurer\";\n\nexport type AdventurerAction =\n  { type: \"modifyHealth\", adventurerId: string, amount: number }\n| { type: \"consumeItem\", adventurerId: string, fromSlot: number }\n| { type: \"moveItemInInventory\", adventurerId: string, fromSlot: number, toSlot: number }\n| { type: \"moveItemToOtherAdventurer\", adventurerId: string, fromSlot: number, toSlot?: number, toAdventurerId: string }\n| { type: \"addItemToInventory\", adventurerId: string, item: Item, toSlot?: number }\n| { type: \"changeItemQuantity\", adventurerId: string, slot: number, quantity: number }\n| { type: \"removeItemFromInventory\", adventurerId: string, fromSlot: number }\n| { type: \"assignEquipment\", adventurerId: string, item: Item, equipmentSlot: EquipmentSlotType }\n| { type: \"removeEquipment\", adventurerId: string, equipmentSlot: EquipmentSlotType }\n| { type: \"changeEquipmentQuantity\", adventurerId: string, equipmentSlot: EquipmentSlotType, quantity: number }\n| { type: \"addTempEffect\", adventurerId: string, tempEffect: TempEffect }\n| { type: \"decreaseEffectCharge\", adventurerId: string, effect: Omit<Effect, 'lastTick'> }\n| { type: \"setBasicAttributes\", adventurerId: string, basicAttributes: AttributesStoreState }\n| { type: \"renameAdventurer\", adventurerId: string, name: string }\n| { type: \"addXp\", adventurerId: string, xp: number; }\n\nexport const modifyHealth = (adventurerId: string, amount: number): AdventurerAction => ({\n  type: \"modifyHealth\",\n  adventurerId,\n  amount,\n})\n\nexport const consumeItem = (adventurerId: string, fromSlot: number): AdventurerAction => ({\n  type: \"consumeItem\",\n  adventurerId,\n  fromSlot,\n})\n\nexport const moveItemInInventory = (adventurerId: string, fromSlot: number, toSlot: number): AdventurerAction => ({\n  type: \"moveItemInInventory\",\n  adventurerId,\n  fromSlot,\n  toSlot,\n})\n\n/**\n * Moves the an item from one adventurers' inventory to another\n * @param fromAdventurerId adventurer whose inventory to take the item from\n * @param fromSlot index of the inventory item\n * @param toAdventurerId player who to give the item to\n */\nexport const moveItemToOtherAdventurer = (fromAdventurerId: string, fromSlot: number, toAdventurerId: string, toSlot?: number): AdventurerAction => ({\n  type: \"moveItemToOtherAdventurer\",\n  adventurerId: fromAdventurerId,\n  fromSlot,\n  toAdventurerId,\n  toSlot,\n})\n\n// If slot is not provided, will take the first empty slot\nexport const addItemToInventory = (adventurerId: string, item: Item, toSlot?: number): AdventurerAction => ({\n  type: \"addItemToInventory\",\n  adventurerId,\n  item,\n  toSlot,\n})\n\nexport const removeItemFromInventory = (adventurerId: string, fromSlot: number): AdventurerAction => ({\n  type: \"removeItemFromInventory\",\n  adventurerId,\n  fromSlot,\n})\n\nexport const assignEquipment = (adventurerId: string, equipmentSlot: EquipmentSlotType, item: Item): AdventurerAction => ({\n  type: \"assignEquipment\",\n  adventurerId,\n  item,\n  equipmentSlot,\n})\n\nexport const removeEquipment = (adventurerId: string, equipmentSlot: EquipmentSlotType): AdventurerAction => ({\n  type: \"removeEquipment\",\n  adventurerId,\n  equipmentSlot,\n})\n\nexport const changeEquipmentQuantity = (adventurerId: string, equipmentSlot: EquipmentSlotType, quantity: number): AdventurerAction => ({\n  type: \"changeEquipmentQuantity\",\n  adventurerId,\n  equipmentSlot,\n  quantity,\n})\n\n// Adds temporary effect to adventurernpm\nexport const addTempEffect = <T extends TempEffect> (adventurerId: string, tempEffect: T): AdventurerAction => ({\n  type: \"addTempEffect\",\n  adventurerId,\n  tempEffect\n})\n\nexport const decreaseEffectCharge = <T extends Effect> (adventurerId: string, effect: Omit<T, 'lastTick'>): AdventurerAction => ({\n  type: \"decreaseEffectCharge\",\n  adventurerId,\n  effect\n})\n\n// Only used for debugging\nexport const setBasicAttributes = (adventurerId: string, basicAttributes: AttributesStoreState): AdventurerAction => ({\n  type: \"setBasicAttributes\",\n  adventurerId,\n  basicAttributes,\n})\n\nexport const renameAdventurer = (adventurerId: string, name: string): AdventurerAction => ({\n  type: \"renameAdventurer\",\n  adventurerId,\n  name,\n})\n\nexport const addXp = (adventurerId: string, xp: number): AdventurerAction => ({\n  type: \"addXp\",\n  adventurerId,\n  xp,\n})\n","import { ItemType } from \"definitions/items/types\"\nimport { TempEffectType } from \"definitions/tempEffects/types\"\nimport { Attribute } from \"store/types/adventurer\"\n\nexport enum EffectType {\n  attributeIncrease,\n  healthDecreaseOnMove,               // every step decreases health\n  healthDecreaseOverTime,\n}\n\nexport type BaseEffect = {\n  type: EffectType;\n  timeRemaining?: number;   // if set, the effect will wear off\n  charges?: number;         // if set, amount of charges still remaining\n}\n\nexport type EffectAttibuteIncrease = BaseEffect & {\n  type: EffectType.attributeIncrease,\n  attribute: Attribute,\n  factor: number,   // multiply base attribute by this\n}\n\nexport type EffectHealthDecreaseOnMove = BaseEffect & {\n  type: EffectType.healthDecreaseOnMove,\n  damage: number\n}\n\nexport type EffectHealthDecreaseOverTime = BaseEffect & {\n  type: EffectType.healthDecreaseOverTime,\n  interval: number,\n  damage: number\n}\n\nexport type Effect = EffectAttibuteIncrease\n | EffectHealthDecreaseOnMove\n | EffectHealthDecreaseOverTime;\n\n\nexport enum EffectSourceType {\n  tempEffect,\n  item,\n}\n\nexport type EffectSource = {\n  type: EffectSourceType.tempEffect,\n  tempEffectType: TempEffectType\n} | {\n  type: EffectSourceType.item\n  itemType: ItemType\n}\n\n export type EffectWithSource = Effect & {\n  source: EffectSource\n }\n\n","import { TiledProperty, TiledLayerData, TiledTilesetData } from 'constants/tiledMapData';\n\n\n// Unpack array of properties into key/value object for fast retrieval\nexport const parseProperties = (properties?: TiledProperty[]): {[key: string]: string | boolean | number } => {\n  if (!properties) return {};\n  return properties.reduce((acc: {[key: string]: string | boolean | number}, value: TiledProperty) => {\n    acc[value.name] = value.value;\n    return acc;\n  }, {});\n}\n\nexport enum TiledObjectType {\n  actor = \"actor\",\n  enemySpawn = \"enemySpawn\",\n  portal = \"portal\",\n}\n\n// finds tileset based on gid\nexport const findTileset = (gid: number, tilesets: TiledTilesetData[]): TiledTilesetData | undefined => {\n  let tileset;\n  for (let i = tilesets.length - 1; i >= 0; i--) {\n    tileset = tilesets[i];\n    if (tileset.firstgid <= gid) {\n      break;\n    }\n  }\n  return tileset;\n}\n/** Add tiles in this layer to list */\nexport const addAllTilesInLayerToList = (list: [number, number][], layer: TiledLayerData, columns: number): void => {\n  layer.data.reduce((acc: [number, number][], tile, index) => {\n    if (tile > 0) {\n      const x = (index % columns);\n      const y = Math.floor(index / columns);\n      acc.push([x, y]);\n    }\n    return acc;\n  }, list);\n}\n\nexport const locationEquals = (a: [number, number], b: [number, number]): boolean => {\n  return a[0] === b[0] && a[1] === b[1];\n}\n","import { TextEntry } from \"constants/text\";\n\nexport enum LogChannel {\n    common,         // Only visible in 'all'\n    town,           // Visible in 'all' and town\n    quest,          // Visible in 'all' and the appropriate quest tab\n}\n\nexport interface LogEntry extends TextEntry {\n    time: number;\n    channel: LogChannel;\n    channelContext?: string;\n}\n","import { FIVE_SECONDS } from 'utils/format/time';\nimport { Type } from 'components/ui/toasts/Toast';\nimport EventEmitter from \"events\";\nimport TypedEmitter from \"typed-emitter\";\nimport { SoundManager} from './SoundManager';\n\nexport interface ToastConfig {\n  time: number;\n  title: string;\n  type?: Type;\n  icon?: string;\n  link?: string;\n}\n\nexport const EVENT_TOASTS_UPDATED = \"toast\";\ninterface ToastEvents {\n  [EVENT_TOASTS_UPDATED]: (context: ToastConfig[] | undefined) => void;\n}\nexport class ToastManager extends (EventEmitter as new () => TypedEmitter<ToastEvents>) {\n  private static _instance = new ToastManager();\n\n  private static stack: ToastConfig[] = [];\n  private static lifeTime = FIVE_SECONDS; // Time each toast lives\n                      // also update CSS animation!\n\n  static addToast(title: string, type?: Type, icon?: string, link?: string) {\n\n    this.stack = [...this.stack, {\n      time: Date.now(),\n      title,\n      type,\n      icon,\n      link\n    }];\n\n    this.instance.emit(EVENT_TOASTS_UPDATED, this.stack);\n\n    SoundManager.playSound(\"ui/toast\");\n\n    setTimeout(() => {\n      // Remove all popups that have expired\n      this.stack = this.stack.filter((toast) => {\n        return Date.now() - toast.time < this.lifeTime\n      });\n      this.instance.emit(EVENT_TOASTS_UPDATED, this.stack);\n\n    }, this.lifeTime);\n  }\n\n  static get instance() {\n    return this._instance;\n  }\n}\n","// export type TempEffect\n\n// TempEffect (todo: find better name) contains a number of effects that\n// are temporary active on an adventurer\nimport { Effect } from \"definitions/effects/types\";\n\nexport enum TempEffectType {\n  brokenLegs,               // every step decreases health\n  burning,\n  soma,\n}\n\nexport type BaseTempEffect = {\n  type: TempEffectType;\n  effects: Effect[];\n  timeRemaining?: number;   // if set, the effect will wear off\n  charges?: number;         // if set, amount of charges still remaining\n}\n\nexport type TempEffectBrokenLegs = BaseTempEffect & {\n  type: TempEffectType.brokenLegs,\n  damage: number\n}\n\nexport type TempEffectBurning = BaseTempEffect & {\n  type: TempEffectType.burning,\n  interval: number,\n  damage: number\n}\n\nexport type TempEffectSoma = BaseTempEffect & {\n  type: TempEffectType.soma,\n  factor: number\n}\n\nexport type TempEffect = TempEffectBrokenLegs\n | TempEffectBurning\n | TempEffectSoma;\n","import React from 'react';\nimport { TextManager } from 'global/TextManager';\nimport { ToastConfig } from 'global/ToastManager';\nimport { useHistory } from 'react-router';\nimport Icon from 'components/ui/common/Icon';\n\ntype Props = ToastConfig;\n\nexport enum Type {\n    achievementUnlocked,\n    cheat,\n    game,\n    itemCrafted,\n    questCompleted,\n    questEncounter,\n    questLaunched,\n    questUpdate,\n}\n\nconst Toast = (props: Props) => {\n    const {\n        title,\n        type = Type.achievementUnlocked,\n        icon = \"/img/items/quest-items/dragon-eye.png\",\n        link\n    } = props;\n    const history = useHistory();\n\n    const handleClick = () => {\n        if (link) {\n            history.push(link);\n        }\n    }\n\n    const typeText = TextManager.getToastType(type);\n    return (\n        <div className={`toast ${link ? \"withlink\" : \"\"}`} onClick={handleClick}>\n            <div className=\"label type\">{typeText}</div>\n            <div className=\"label title\">{title}</div>\n            <Icon size=\"big\" image={icon} className=\"toast-icon\" border=\"gold\" />\n            <div className=\"banner\"/>\n        </div>\n    );\n}\n\nexport default Toast;","const CONSTANT = 0.5;\n\nexport const xpToLevel = (xp: number) => {\n  return Math.floor(CONSTANT * Math.sqrt(xp));\n}\n\nexport const levelToXp = (level: number) => {\n  return Math.pow(level / CONSTANT, 2);\n}\n\nexport const MAX_LEVEL = 80; //maximum level an adventurer can e\nexport const MAX_XP = levelToXp(MAX_LEVEL);\n\n\n// print out required xp\n// for(let i = 1; i < 20; i++) {\n//   console.log(levelToXp(i))\n// }\n","import { AttributesStoreState } from \"store/types/adventurer\";\n\nexport const AP_COST_MOVE = 1; // amount of AP to deduct for each tile moved\nexport const AP_COST_CONSUME = 2; // amount of AP to deduct for consuming an item\nexport const AP_COST_SLASH = 1; // amount of AP to deduct for consuming an item\nexport const AP_COST_SHOOT = 1; // amount of AP to deduct for consuming an item\nexport const ENEMY_BASE_AP = 6;\n\nexport const calculateInitialAP = (attributes: AttributesStoreState, level: number) => {\n  const { agi } = attributes;\n  return Math.floor(0.2*(1.16 ^ agi)+1+(level/10));\n  // for (let dx = 1; dx < 21; dx++) {\n  //     console.log(`lvl 1, dx ${dx}: ${calculateInitialAP(dx, 1)}`)\n  // }\n  // for (let dx = 1; dx < 21; dx++) {\n  //     console.log(`lvl 10, dx ${dx}: ${calculateInitialAP(dx, 10)}`)\n  // }\n}\n\n// Calculates base dodge %. Note that there should be a modifier applied for\n// relative difference in levels\nexport const calculateDodge = (attributes: AttributesStoreState) => {\n  const { agi } = attributes;\n  return agi * 3;\n}\n","import EventEmitter from \"events\";\nimport { Point } from \"pixi.js\";\nimport TypedEmitter from \"typed-emitter\";\n\n\nexport const EVENT_BUBBLE_ADDED = \"bubbleAdded\";\nexport enum BubbleType { combat, resource }\nexport enum BubbleLayer { general, scene }\n\ninterface BubbleEvents {\n  [EVENT_BUBBLE_ADDED]: (text: string, point: Point, bubbleType?: BubbleType, layer?: BubbleLayer) => void;\n}\n\nexport class BubbleManager extends (EventEmitter as new () => TypedEmitter<BubbleEvents>) {\n  private static _instance = new BubbleManager();\n\n  static addBubble(text: string, point: Point, bubbleType: BubbleType = BubbleType.combat, layer: BubbleLayer = BubbleLayer.general) {\n    this.instance.emit(EVENT_BUBBLE_ADDED, text, point, bubbleType, layer);\n  }\n\n  static get instance() {\n    return this._instance;\n  }\n}\n","import { StoreState } from \"store/types\";\nimport { AdventurerStoreState } from \"store/types/adventurer\";\nimport { QuestStoreState } from \"store/types/quest\";\n\n// export const adventurersInParty = (store: StoreState, partyId: string): AdventurerStoreState[] => {\n//   const party: PartyStoreState = store.parties[partyId];\n//   return party.adventurers.map((id: string) => findAdventurerById(store, id)!);\n// };\n\n/**\n * Returns the quest the given adventurer is currently on. Can be undefined if not on a quest\n */\nexport const findQuestByAdventurer = (adventurer: AdventurerStoreState, quests: QuestStoreState[]) => {\n  return quests.find(q => q.party.some(a => a === adventurer.id))\n}\n\nexport const adventurersOnQuest = (adventurers: AdventurerStoreState[], quest: QuestStoreState): AdventurerStoreState[] => {\n  // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n  return quest.party.map((id: string) => findAdventurerById(adventurers, id)!);\n};\n\nexport const getQuestLeader = (adventurers: AdventurerStoreState[], quest: QuestStoreState): AdventurerStoreState | undefined => {\n  const leaderId = quest.party[0];\n  return findAdventurerById(adventurers, leaderId);\n}\n\nexport const findAdventurerById = (adventurers: AdventurerStoreState[], id: string): AdventurerStoreState | undefined => {\n  return adventurers.find((a) => a.id === id);\n};\n\n/**\n * Returns the amount of free inventory slots on this adventurer\n */\nexport const adventurerFreeInventorySlots = (adventurer: AdventurerStoreState): number => {\n  return adventurer.inventory.filter(i => i === null).length;\n};\n\nexport const storeIsRehydrated = (store: StoreState): boolean => {\n  // Returns a value indicating whether this store is fresh or rehydrated\n  return store?.engine.gameStarted !== undefined;\n};\n\n","import { ItemType, ItemDefinition, ItemCategory } from \"./types\";\n\ntype Prefix = \"consumable/\";\nconst PREFIX = \"consumable/\";\nconst itemCategory = ItemCategory.consumable;\nconst basePath = \"/img/items/consumables/\";\n\nexport type ConsumableCategory = \"health\" | \"soma\" | \"mana\";\nexport interface ConsumableDefinition extends ItemDefinition {\n  category: ConsumableCategory;\n  effect?: number;\n}\n\nconst consumables = {\n  minorHealthPotion: {\n    category: 'health',\n    effect: 10,\n    itemCategory,\n    iconImg: `${basePath}minor-health-potion.png`,\n  },\n  minorManaPotion: {\n    category: 'mana',\n    itemCategory,\n    iconImg: `${basePath}minor-mana-potion.png`,\n  },\n  minorSoma: {\n    category: 'soma',\n    itemCategory,\n    iconImg: `${basePath}minor-soma.png`,\n    effect: 1.1\n  },\n  lesserHealthPotion: {\n    category: 'health',\n    effect: 25,\n    itemCategory,\n    iconImg: `${basePath}lesser-health-potion.png`,\n  },\n  lesserManaPotion: {\n    category: 'mana',\n    itemCategory,\n    iconImg: `${basePath}lesser-mana-potion.png`,\n  },\n  lesserSoma: {\n    category: 'soma',\n    itemCategory,\n    iconImg: `${basePath}lesser-soma.png`,\n    effect: 1.25\n  },\n  majorHealthPotion: {\n    category: 'health',\n    effect: 50,\n    itemCategory,\n    iconImg: `${basePath}major-health-potion.png`,\n  },\n  majorManaPotion: {\n    category: 'mana',\n    itemCategory,\n    iconImg: `${basePath}major-mana-potion.png`,\n  },\n  majorSoma: {\n    category: 'soma',\n    itemCategory,\n    iconImg: `${basePath}major-soma.png`,\n    effect: 1.5\n  },\n  greaterHealthPotion: {\n    category: 'health',\n    effect: 75,\n    itemCategory,\n    iconImg: `${basePath}greater-health-potion.png`,\n  },\n  greaterManaPotion: {\n    category: 'mana',\n    itemCategory,\n    iconImg: `${basePath}greater-mana-potion.png`,\n  },\n  greaterSoma: {\n    category: 'soma',\n    itemCategory,\n    iconImg: `${basePath}greater-soma.png`,\n    effect: 2\n  },\n}\n\nexport type Consumable = `${Prefix}${keyof typeof consumables}`;\nconst all = Object.entries(consumables).reduce<{[key: string]: ConsumableDefinition}>((acc, [key, value]) => {\n  acc[`${PREFIX}${key}`] = value as ConsumableDefinition;\n  return acc;\n}, {}) as Record<Consumable, ConsumableDefinition>;\nexport default all;\n\nexport function getDefinition(consumable: Consumable): ConsumableDefinition {\n  return all[consumable];\n}\n\nexport const isConsumable = (item: ItemType): item is Consumable => {\n  return !!all[item as Consumable];\n}\n","import kill10Boars from './kill10Boars';\r\nimport retrieveMagicAmulet from './retrieveMagicAmulet';\r\nimport { QuestDefinition } from './types';\r\n\r\n\r\n// const fulruhmRaid: QuestDefinition = {\r\n//   nodes: [{\r\n//     x: -4,\r\n//     y: -1,\r\n//     type: QuestNodeType.nothing,\r\n//   }, {\r\n//     x: -4,\r\n//     y: -1,\r\n//     type: QuestNodeType.nothing,\r\n\r\nconst all = {\r\n  kill10Boars,\r\n  retrieveMagicAmulet,\r\n};\r\n\r\nexport default all;\r\n\r\nexport function getDefinition<T = unknown>(questName: string): QuestDefinition<T> {\r\n  return all[questName as keyof typeof all] as unknown as QuestDefinition<T>;\r\n}\r\n","import { QuestStoreState } from 'store/types/quest';\nimport { QuestDefinition, QuestNodeType } from '../types';\nimport { initialQuestVars, Kill10BoarsQuestVars } from './questVars';\n\n\nconst kill10Boars: QuestDefinition<Kill10BoarsQuestVars> = {\n  getQuestVars: (questStore: QuestStoreState) => questStore.questVars as Kill10BoarsQuestVars,\n  getInitialQuestVars: (_questStore: QuestStoreState) => {\n    return initialQuestVars;\n  },\n  nodes: [{\n    x: 0,\n    y: 1,\n    type: QuestNodeType.encounter,\n    startScene: \"dungeon.canyon\",\n  }, {\n    x: 0,\n    y: 2,\n    log: \"quest-kill10-boars-enter-dungeon\",\n    type: QuestNodeType.nothing,\n  }, {\n    x: 0,\n    y: 3,\n    type: QuestNodeType.nothing,\n  }, {\n    x: 0,\n    y: 3,\n    type: QuestNodeType.encounter,\n    startScene: \"dungeon.entrance\"\n  }, {\n    x: 1,\n    y: 3,\n    type: QuestNodeType.nothing,\n    log: \"quest-kill10-boars-leave-dungeon\",\n  }, {\n    x: 1,\n    y: 3,\n    type: QuestNodeType.nothing,\n    log: \"quest-kill10-boars-left-dungeon\"\n  }, {\n    x: 2,\n    y: 3,\n    type: QuestNodeType.nothing,\n  }, {\n    x: 3,\n    y: 3,\n    type: QuestNodeType.encounter,\n    startScene: \"dungeon.hallway\"\n\n    //encounter: Encounter.backstabbed,\n  }, {\n    x: 4,\n    y: 4,\n    type: QuestNodeType.nothing,\n    log: \"The party spots a boss\",\n  }, {\n    x: 5,\n    y: 4,\n    type: QuestNodeType.nothing,\n  }],\n};\n\nexport default kill10Boars;\n","import { QuestStoreState } from 'store/types/quest';\nimport { QuestDefinition, QuestNodeType } from '../types';\n\nexport interface RetrieveMagicAmuletQuestVars {\n    baz: boolean;\n    zux: number;\n}\n\nconst retrieveMagicAmulet: QuestDefinition<RetrieveMagicAmuletQuestVars> = {\n    getQuestVars: (questStore: QuestStoreState) => questStore.questVars as RetrieveMagicAmuletQuestVars,\n    getInitialQuestVars: (_questStore: QuestStoreState) => {\n        const vars: RetrieveMagicAmuletQuestVars = {\n            baz: false,\n            zux: 13\n        }\n        return vars;\n    },\n    requiredItems: [\n        \"questItem/torch\",\n        \"questItem/torch\",\n        \"questItem/torch\",\n        \"questItem/sandwich\",\n        \"questItem/sandwich\",\n    ],\n    nodes: [{\n        x: 0,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 1,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 2,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 3,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 4,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 5,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 7,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 8,\n        y: 2,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 8,\n        y: 3,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 9,\n        y: 3,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 10,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 10,\n        y: 2,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 10,\n        y: 3,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 10,\n        y: 4,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 11,\n        y: 5,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 12,\n        y: 6,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 12,\n        y: 7,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 13,\n        y: 8,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 12,\n        y: 8,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 12,\n        y: 9,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 11,\n        y: 8,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 10,\n        y: 8,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 9,\n        y: 8,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 8,\n        y: 9,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 7,\n        y: 8,\n        type: QuestNodeType.encounter,\n        startScene: \"dungeon.hallway\"\n    }, {\n        x: 8,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 1,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 1,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 1,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 1,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 1,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 1,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 1,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 1,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 2,\n        y: 1,\n        type: QuestNodeType.encounter,\n        startScene: \"dungeon.hallway\"\n    }, {\n        x: 3,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }],\n};\n\nexport default retrieveMagicAmulet;","import { LogChannel } from \"store/types/logEntry\";\nimport { TextEntry } from 'constants/text';\n\nexport type LogAction =\n  { type: \"addLogEntry\", entry: TextEntry, channel: LogChannel, channelContext?: string }\n\n\nexport const addLogText = (key: string, context?: unknown, channel: LogChannel = LogChannel.common, channelContext?: string): LogAction => {\n  const entry: TextEntry = {\n    key,\n    context\n  };\n  return {\n    type: \"addLogEntry\",\n    entry,\n    channel,\n    channelContext,\n  };\n}\n\nexport const addLogEntry = (entry: TextEntry, channel: LogChannel = LogChannel.common, channelContext?: string): LogAction => ({\n  type: \"addLogEntry\",\n  entry,\n  channel,\n  channelContext,\n});\n","import { ItemType, ItemDefinition, ItemCategory } from \"./types\";\nimport { EquipmentSlotType } from 'components/ui/adventurer/EquipmentSlot';\nimport { Effect, EffectAttibuteIncrease, EffectType } from \"definitions/effects/types\";\n\ntype Prefix = \"apparel/\";\nconst PREFIX = \"apparel/\";\nconst itemCategory = ItemCategory.apparel;\nconst basePath = \"/img/items/apparel/\";\n\nconst crimsonRogueEffect: EffectAttibuteIncrease = {\n  type: EffectType.attributeIncrease,\n  attribute: \"agi\",\n  factor: 1.05,\n}\n\nexport interface ApparelDefinition extends ItemDefinition {\n  equipmentType: EquipmentSlotType;\n  damageReduction?: number;\n  effects?: Effect[];\n}\n\nconst apparel = {\n  boots1: {\n    equipmentType: EquipmentSlotType.feet,\n    itemCategory,\n    iconImg: `${basePath}boots_1.png`,\n  },\n  boots2: {\n    equipmentType: EquipmentSlotType.feet,\n    itemCategory,\n    damageReduction: 1,\n    iconImg: `${basePath}boots_2.png`,\n  },\n  boots3: {\n    equipmentType: EquipmentSlotType.feet,\n    itemCategory,\n    damageReduction: 2,\n    iconImg: `${basePath}boots_3.png`,\n  },\n  chainmailHood: {\n    equipmentType: EquipmentSlotType.head,\n    itemCategory,\n    iconImg: `${basePath}chainmail_hood.png`,\n    damageReduction: 3,\n  },\n  chest: {\n    equipmentType: EquipmentSlotType.chest,\n    itemCategory,\n    iconImg: `${basePath}chest_1.png`,\n    damageReduction: 2,\n  },\n  clothGloves: {\n    equipmentType: EquipmentSlotType.hands,\n    itemCategory,\n    iconImg: `${basePath}cloth_gloves.png`,\n    damageReduction: 1\n  },\n  cowl: {\n    equipmentType: EquipmentSlotType.head,\n    itemCategory,\n    iconImg: `${basePath}cowl.png`,\n    damageReduction: 2,\n  },\n  cultistBoots: {\n    equipmentType: EquipmentSlotType.feet,\n    itemCategory,\n    iconImg: `${basePath}cultist_boots.png`,\n    damageReduction: 2,\n  },\n  crimsonRogueBoots: {\n    equipmentType: EquipmentSlotType.feet,\n    itemCategory,\n    iconImg: `${basePath}crimson_rogue_boots.png`,\n    damageReduction: 2,\n    effects: [crimsonRogueEffect]\n  },\n  crimsonRogueBritches: {\n    equipmentType: EquipmentSlotType.legs,\n    itemCategory,\n    iconImg: `${basePath}crimson_rogue_britches.png`,\n    damageReduction: 2,\n    effects: [crimsonRogueEffect]\n  },\n  crimsonRogueCoif: {\n    equipmentType: EquipmentSlotType.head,\n    itemCategory,\n    iconImg: `${basePath}crimson_rogue_coif.png`,\n    damageReduction: 2,\n    effects: [crimsonRogueEffect]\n  },\n  crimsonRogueGrips: {\n    equipmentType: EquipmentSlotType.hands,\n    itemCategory,\n    iconImg: `${basePath}crimson_rogue_grips.png`,\n    damageReduction: 2,\n    effects: [crimsonRogueEffect]\n  },\n  crimsonRogueSpaulders: {\n    equipmentType: EquipmentSlotType.shoulders,\n    itemCategory,\n    iconImg: `${basePath}crimson_rogue_spaulders.png`,\n    damageReduction: 2,\n    effects: [crimsonRogueEffect]\n  },\n  crimsonRogueTunic: {\n    equipmentType: EquipmentSlotType.chest,\n    itemCategory,\n    iconImg: `${basePath}crimson_rogue_tunic.png`,\n    damageReduction: 2,\n    effects: [crimsonRogueEffect]\n  },\n  cultistGloves: {\n    equipmentType: EquipmentSlotType.hands,\n    itemCategory,\n    iconImg: `${basePath}cultist_gloves.png`,\n    damageReduction: 2,\n  },\n  cultistPants: {\n    equipmentType: EquipmentSlotType.legs,\n    itemCategory,\n    iconImg: `${basePath}cultist_pants.png`,\n    damageReduction: 2,\n  },\n  cultistRobe: {\n    equipmentType: EquipmentSlotType.chest,\n    itemCategory,\n    iconImg: `${basePath}cultist_robe.png`,\n    damageReduction: 2,\n  },\n  cultistShoulderwraps: {\n    equipmentType: EquipmentSlotType.shoulders,\n    itemCategory,\n    iconImg: `${basePath}cultist_shoulderwraps.png`,\n    damageReduction: 2,\n  },\n  darkPrinceBracers: {\n    equipmentType: EquipmentSlotType.hands,\n    itemCategory,\n    iconImg: `${basePath}dark_prince_bracers.png`,\n    damageReduction: 2,\n  },\n  darkPrinceCape: {\n    equipmentType: EquipmentSlotType.shoulders,\n    itemCategory,\n    iconImg: `${basePath}dark_prince_cape.png`,\n    damageReduction: 2,\n  },\n  darkPrinceCuirass: {\n    equipmentType: EquipmentSlotType.chest,\n    itemCategory,\n    iconImg: `${basePath}dark_prince_cuirass.png`,\n    damageReduction: 2,\n  },\n  darkPrinceHood: {\n    equipmentType: EquipmentSlotType.head,\n    itemCategory,\n    iconImg: `${basePath}dark_prince_hood.png`,\n    damageReduction: 2,\n  },\n  darkPrinceSarong: {\n    equipmentType: EquipmentSlotType.legs,\n    itemCategory,\n    iconImg: `${basePath}dark_prince_sarong.png`,\n    damageReduction: 2,\n  },\n  darkPrinceSlippers: {\n    equipmentType: EquipmentSlotType.feet,\n    itemCategory,\n    iconImg: `${basePath}dark_prince_slippers.png`,\n    damageReduction: 2,\n  },\n  dreadnoughtBoots: {\n    equipmentType: EquipmentSlotType.feet,\n    itemCategory,\n    iconImg: `${basePath}dreadnought_boots.png`,\n    damageReduction: 8,\n  },\n  dreadnoughtChest: {\n    equipmentType: EquipmentSlotType.chest,\n    itemCategory,\n    iconImg: `${basePath}dreadnought_chest.png`,\n    damageReduction: 8,\n  },\n  dreadnoughtGauntlets: {\n    equipmentType: EquipmentSlotType.hands,\n    itemCategory,\n    iconImg: `${basePath}dreadnought_gauntlets.png`,\n    damageReduction: 8,\n  },\n  dreadnoughtHelm: {\n    equipmentType: EquipmentSlotType.head,\n    itemCategory,\n    iconImg: `${basePath}dreadnought_helm.png`,\n    damageReduction: 8,\n  },\n  dreadnoughtLegplates: {\n    equipmentType: EquipmentSlotType.legs,\n    itemCategory,\n    iconImg: `${basePath}dreadnought_legplates.png`,\n    damageReduction: 8,\n  },\n  dreadnoughtPauldrons: {\n    equipmentType: EquipmentSlotType.shoulders,\n    itemCategory,\n    iconImg: `${basePath}dreadnought_pauldrons.png`,\n    damageReduction: 8,\n  },\n  druidChest: {\n    equipmentType: EquipmentSlotType.chest,\n    itemCategory,\n    iconImg: `${basePath}druid-chest.png`,\n  },\n  druidFeet: {\n    equipmentType: EquipmentSlotType.feet,\n    itemCategory,\n    iconImg: `${basePath}druid-feet.png`,\n  },\n  druidHands: {\n    equipmentType: EquipmentSlotType.hands,\n    itemCategory,\n    iconImg: `${basePath}druid-hands.png`,\n  },\n  druidHead: {\n    equipmentType: EquipmentSlotType.head,\n    itemCategory,\n    iconImg: `${basePath}druid-head.png`,\n  },\n  druidLegs: {\n    equipmentType: EquipmentSlotType.legs,\n    itemCategory,\n    iconImg: `${basePath}druid-legs.png`,\n  },\n  fedora: {\n    equipmentType: EquipmentSlotType.head,\n    itemCategory,\n    iconImg: `${basePath}fedora.png`,\n  },\n  footmanBoots: {\n    equipmentType: EquipmentSlotType.feet,\n    itemCategory,\n    iconImg: `${basePath}footman_boots.png`,\n  },\n  footmanBreastplate: {\n    equipmentType: EquipmentSlotType.chest,\n    itemCategory,\n    iconImg: `${basePath}footman_breastplate.png`,\n  },\n  footmanFaceguard: {\n    equipmentType: EquipmentSlotType.head,\n    itemCategory,\n    iconImg: `${basePath}footman_faceguard.png`,\n  },\n  footmanFists: {\n    equipmentType: EquipmentSlotType.hands,\n    itemCategory,\n    iconImg: `${basePath}footman_fists.png`,\n  },\n  footmanLegplates: {\n    equipmentType: EquipmentSlotType.legs,\n    itemCategory,\n    iconImg: `${basePath}footman_legplates.png`,\n  },\n  footmanPauldrons: {\n    equipmentType: EquipmentSlotType.shoulders,\n    itemCategory,\n    iconImg: `${basePath}footman_pauldrons.png`,\n  },\n  greaves1: {\n    equipmentType: EquipmentSlotType.feet,\n    itemCategory,\n    iconImg: `${basePath}greaves_1.png`,\n    damageReduction: 2,\n  },\n  greaves2: {\n    equipmentType: EquipmentSlotType.feet,\n    itemCategory,\n    iconImg: `${basePath}greaves_2.png`,\n  },\n  hornedHelmet: {\n    equipmentType: EquipmentSlotType.head,\n    itemCategory,\n    iconImg: `${basePath}horned_helmet.png`,\n  },\n  leatherGloves: {\n    equipmentType: EquipmentSlotType.hands,\n    itemCategory,\n    iconImg: `${basePath}leather_gloves.png`,\n  },\n  naturalistsCape: {\n    equipmentType: EquipmentSlotType.shoulders,\n    itemCategory,\n    iconImg: `${basePath}naturalists_cape.png`,\n  },\n  naturalistsCowl: {\n    equipmentType: EquipmentSlotType.head,\n    itemCategory,\n    iconImg: `${basePath}naturalists_cowl.png`,\n  },\n  naturalistsFootwraps: {\n    equipmentType: EquipmentSlotType.feet,\n    itemCategory,\n    iconImg: `${basePath}naturalists_footwraps.png`,\n  },\n  naturalistsVambraces: {\n    equipmentType: EquipmentSlotType.hands,\n    itemCategory,\n    iconImg: `${basePath}naturalists_vambraces.png`,\n  },\n  naturalistsVest: {\n    equipmentType: EquipmentSlotType.chest,\n    itemCategory,\n    iconImg: `${basePath}naturalists_vest.png`,\n  },\n  nomadHelmet: {\n    equipmentType: EquipmentSlotType.head,\n    itemCategory,\n    iconImg: `${basePath}nomad_helmet.png`,\n  },\n  pants1: {\n    equipmentType: EquipmentSlotType.legs,\n    itemCategory,\n    iconImg: `${basePath}pants_1.png`,\n    damageReduction: 3,\n  },\n  pants2: {\n    equipmentType: EquipmentSlotType.legs,\n    itemCategory,\n    iconImg: `${basePath}pants_2.png`,\n    damageReduction: 3\n  },\n  plateChest1: {\n    equipmentType: EquipmentSlotType.chest,\n    itemCategory,\n    iconImg: `${basePath}plate_chest_1.png`,\n  },\n  plateChest2: {\n    equipmentType: EquipmentSlotType.chest,\n    itemCategory,\n    iconImg: `${basePath}plate_chest_2.png`,\n  },\n  plateChest3: {\n    equipmentType: EquipmentSlotType.chest,\n    itemCategory,\n    iconImg: `${basePath}plate_chest_3.png`,\n  },\n  plateChest4: {\n    equipmentType: EquipmentSlotType.chest,\n    itemCategory,\n    iconImg: `${basePath}plate_chest_4.png`,\n  },\n  plateGloves1: {\n    equipmentType: EquipmentSlotType.hands,\n    itemCategory,\n    iconImg: `${basePath}plate_gloves_1.png`,\n  },\n  plateGloves2: {\n    equipmentType: EquipmentSlotType.hands,\n    itemCategory,\n    iconImg: `${basePath}plate_gloves_2.png`,\n  },\n  plateHelmet: {\n    equipmentType: EquipmentSlotType.head,\n    itemCategory,\n    iconImg: `${basePath}plate_helmet_1.png`,\n  },\n  platePants: {\n    equipmentType: EquipmentSlotType.legs,\n    itemCategory,\n    iconImg: `${basePath}plate_pants1.png`,\n  },\n  plateShoulders1: {\n    equipmentType: EquipmentSlotType.shoulders,\n    itemCategory,\n    iconImg: `${basePath}plate_shoulders_1.png`,\n  },\n  plateShoulders2: {\n    equipmentType: EquipmentSlotType.shoulders,\n    itemCategory,\n    iconImg: `${basePath}plate_shoulders_2.png`,\n  },\n  robe: {\n    equipmentType: EquipmentSlotType.chest,\n    itemCategory,\n    iconImg: `${basePath}robe_1.png`,\n  },\n  shoulders1: {\n    equipmentType: EquipmentSlotType.shoulders,\n    itemCategory,\n    iconImg: `${basePath}shoulders_1.png`,\n  },\n  shoulders2: {\n    equipmentType: EquipmentSlotType.shoulders,\n    itemCategory,\n    iconImg: `${basePath}shoulders_2.png`,\n    damageReduction: 2\n  },\n  shoulders3: {\n    equipmentType: EquipmentSlotType.shoulders,\n    itemCategory,\n    iconImg: `${basePath}shoulders_3.png`,\n  },\n  studdedLeatherShoulderguards: {\n    equipmentType: EquipmentSlotType.shoulders,\n    itemCategory,\n    iconImg: `${basePath}studded_leather_shoulderguards.png`,\n  },\n  sunchaserBritches: {\n    equipmentType: EquipmentSlotType.legs,\n    itemCategory,\n    iconImg: `${basePath}sunchaser_britches.png`,\n  },\n  sunchaserGloves: {\n    equipmentType: EquipmentSlotType.hands,\n    itemCategory,\n    iconImg: `${basePath}sunchaser_gloves.png`,\n  },\n  sunchaserHelm: {\n    equipmentType: EquipmentSlotType.head,\n    itemCategory,\n    iconImg: `${basePath}sunchaser_helm.png`,\n  },\n  sunchaserMantle: {\n    equipmentType: EquipmentSlotType.shoulders,\n    itemCategory,\n    iconImg: `${basePath}sunchaser_mantle.png`,\n  },\n  sunchaserMoccasins: {\n    equipmentType: EquipmentSlotType.feet,\n    itemCategory,\n    iconImg: `${basePath}sunchaser_moccasins.png`,\n  },\n  sunchaserTunic: {\n    equipmentType: EquipmentSlotType.chest,\n    itemCategory,\n    iconImg: `${basePath}sunchaser_tunic.png`,\n  },\n  templeGuardChestplate: {\n    equipmentType: EquipmentSlotType.chest,\n    itemCategory,\n    iconImg: `${basePath}temple_guard_chestplate.png`,\n  },\n  templeGuardGloves: {\n    equipmentType: EquipmentSlotType.hands,\n    itemCategory,\n    iconImg: `${basePath}temple_guard_gloves.png`,\n  },\n  templeGuardGreaves: {\n    equipmentType: EquipmentSlotType.shoulders,\n    itemCategory,\n    iconImg: `${basePath}temple_guard_greaves.png`,\n  },\n  templeGuardHelm: {\n    equipmentType: EquipmentSlotType.head,\n    itemCategory,\n    iconImg: `${basePath}temple_guard_helm.png`,\n  },\n  templeGuardLegplates: {\n    equipmentType: EquipmentSlotType.legs,\n    itemCategory,\n    iconImg: `${basePath}temple_guard_legplates.png`,\n  },\n  templeGuardPauldrons: {\n    equipmentType: EquipmentSlotType.shoulders,\n    itemCategory,\n    iconImg: `${basePath}temple_guard_pauldrons.png`,\n  },\n  vest: {\n    equipmentType: EquipmentSlotType.chest,\n    itemCategory,\n    iconImg: `${basePath}vest_1.png`,\n  },\n};\n\nexport type Apparel = `${Prefix}${keyof typeof apparel}`;\nconst all = Object.entries(apparel).reduce<{[key: string]: ApparelDefinition}>((acc, [key, value]) => {\n  acc[`${PREFIX}${key}`] = value;\n  return acc;\n}, {}) as Record<Apparel, ApparelDefinition>;\nexport default all;\n\nexport function getDefinition(apparel: Apparel): ApparelDefinition {\n  return all[apparel];\n}\n\nexport const isApparel = (item: ItemType): item is Apparel => {\n  return !!all[item as Apparel];\n}\n","import { Loader, LoaderResource } from \"pixi.js\";\n\ninterface Location {\n  x: number;\n  y: number;\n}\n\nexport const lerpLocation = (point1: Location, point2: Location, alpha: number): Location => {\n  const x = lerp(point1.x, point2.x, alpha);\n  const y = lerp(point1.y, point2.y, alpha);\n  return { x, y };\n}\n\nconst lerp = (n1: number,  n2: number,  alpha: number) =>  {\n  return n1 + alpha * (n2 - n1);\n}\n\n// Uses the shared pixi loader to load a resource\nexport async function loadResourceAsync(path: string) {\n  const loader = Loader.shared;\n  return new Promise<LoaderResource>((resolve, _reject) => {\n    if (loader.resources[path]) {\n      resolve(loader.resources[path]);\n    }\n    else {\n      loader.add(path).load((_, resources) => {\n        resolve(resources[path]);\n      });\n    }\n  });\n}\n\nexport const loadResource = (path: string, callback: (resource: LoaderResource) => void) => {\n  const loader = Loader.shared;\n  if (loader.resources[path]) {\n    callback(loader.resources[path]);\n    return;\n  }\n  loader.add(path).load((_, resources) => { callback(resources[path])});\n}\n","export type GoldAction = {\n    type: \"addGold\",\n    amount: number\n}\n\nexport const addGold = (amount: number): GoldAction => ({\n    type: \"addGold\",\n    amount,\n})\n\nexport const subtractGold = (amount: number): GoldAction => ({\n    type: \"addGold\",\n    amount: -amount,\n})\n","import seedrandom from \"seedrandom\";\n\ninterface prng {\n  (): number;\n  state(): seedrandom.State;\n}\nlet generator: prng\n\nexport const init = (seed: string): void => {\n  dirty = true;\n  generator = seedrandom(seed, {state: true});\n}\n\nexport function random(): number {\n  if (!generator) { throw new Error(\"Call init() before random()\"); }\n  dirty = true;\n  return generator();\n}\n\n/**\n * Returns a random integer between min (inclusive) and max (inclusive).\n * The value is no lower than min (or the next integer greater than min\n * if min isn't an integer) and no greater than max (or the next integer\n * lower than max if max isn't an integer).\n */\nexport const randomInt = (min = 0, max = 10): number => {\n  min = Math.ceil(min);\n  max = Math.floor(max);\n  return Math.floor(random() * (max - min + 1)) + min;\n}\n\nexport const roll3D6 = (): number =>  {\n  return randomInt(1, 6) + randomInt(1, 6) + randomInt(1, 6)\n}\n\nexport const state = (): seedrandom.State => {\n  dirty = false;\n  return generator.state();\n}\n\nexport let dirty = false;\n","import { Structure } from \"../structures\";\nimport { ItemType, ItemDefinition, ItemCategory } from \"./types\";\n\ntype Prefix = \"deed/\";\nconst PREFIX = \"deed/\";\nconst itemCategory = ItemCategory.deed;\nconst basePath = \"/img/items/deeds/\";\n\nexport interface DeedDefinition extends ItemDefinition {\n  structure: Structure;\n}\n\nconst deeds = {\n  alchemist: {\n    structure: \"alchemist\" as const,\n    itemCategory,\n    iconImg: `${basePath}deed.png`,\n  },\n  armoursmith: {\n    structure: \"armoursmith\" as const,\n    itemCategory,\n    iconImg: `${basePath}deed.png`,\n  },\n  lumbermill: {\n    structure: \"lumberMill\" as const,\n    itemCategory,\n    iconImg: `${basePath}deed.png`,\n  },\n  tavern: {\n    structure: \"tavern\" as const,\n    itemCategory,\n    iconImg: `${basePath}deed.png`,\n  },\n  weaponsmith: {\n    structure: \"weaponsmith\" as const,\n    itemCategory,\n    iconImg: `${basePath}deed.png`,\n  },\n  workshop: {\n    structure: \"workshop\" as const,\n    itemCategory,\n    iconImg: `${basePath}deed.png`,\n  }\n}\n\nexport type Deed = `${Prefix}${keyof typeof deeds}`;\nconst all = Object.entries(deeds).reduce<{[key: string]: DeedDefinition}>((acc, [key, value]) => {\n  acc[`${PREFIX}${key}`] = value;\n  return acc;\n}, {}) as Record<Deed, DeedDefinition>;\nexport default all;\n\nexport function getDefinition(deed: Deed): DeedDefinition {\n  return all[deed] as unknown as DeedDefinition;\n}\n\nexport const isDeed = (item: ItemType): item is Deed => {\n  return !!all[item as Deed];\n}\n","import { Store, AnyAction } from \"redux\";\nimport { StoreState } from 'store/types';\nimport { BaseSceneController } from 'mechanics/scenes/BaseSceneController';\n\nexport abstract class SceneControllerManager {\n  static store: { [key: string]: BaseSceneController<unknown> } = {};\n  static controllerTypes: {[key: string]: typeof BaseSceneController} = {};\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  static registerSceneController(questName: string, sceneName: string, controllerType: any) {\n    this.controllerTypes[`${questName}.${sceneName}`] = controllerType;\n  }\n\n  /**\n   * Gets the scenecontroller for scene. Creates it if it doesnt exist\n   */\n  static getSceneController(questName: string, sceneName: string, store: Store<StoreState, AnyAction>): BaseSceneController<unknown> {\n    if (!this.store[`${questName}.${sceneName}`]) {\n      if (!this.controllerTypes[`${questName}.${sceneName}`]) {\n        throw new Error(`No controller registered for ${questName}.${sceneName}`);\n      }\n      this.store[`${questName}.${sceneName}`] = new this.controllerTypes[`${questName}.${sceneName}`](store, questName);\n    }\n    return this.store[`${questName}.${sceneName}`];\n  }\n\n  static destroySceneConroller(questName: string, sceneName: string, ) {\n    delete this.store[`${questName}.${sceneName}`];\n  }\n}\n\nrequire('definitions/quests/kill10Boars/encounters/dungeon');\n","import {  ItemType, ItemDefinition, ItemCategory } from \"./types\";\nimport { WeaponType } from \"./weapons\";\n\ntype Prefix = \"ammunition/\";\nconst PREFIX = \"ammunition/\";\nconst itemCategory = ItemCategory.ammunition;\nconst basePath = \"/img/items/ammunition/\";\n\nexport interface AmmunitionDefinition extends ItemDefinition {\n  weaponType: WeaponType;\n}\n\nconst ammunitions = {\n  armorPiercingArrows: {\n    itemCategory,\n    iconImg: `${basePath}armor-piercing-arrows.png`,\n    weaponType: WeaponType.bow\n  },\n  basicArrows: {\n    itemCategory,\n    iconImg: `${basePath}basic-arrows.png`,\n    weaponType: WeaponType.bow\n  },\n  crossbowBolts: {\n    itemCategory,\n    iconImg: `${basePath}crossbow-bolts.png`,\n    weaponType: WeaponType.crossbow\n  },\n  elfenArrows: {\n    itemCategory,\n    iconImg: `${basePath}elfen-arrows.png`,\n    weaponType: WeaponType.bow\n  },\n};\n\n\nexport type Ammunition = `${Prefix}${keyof typeof ammunitions}`;\nconst all = Object.entries(ammunitions).reduce<{[key: string]: AmmunitionDefinition}>((acc, [key, value]) => {\n  acc[`${PREFIX}${key}`] = value;\n  return acc;\n}, {}) as Record<Ammunition, AmmunitionDefinition>;\nexport default all;\n\nexport function getDefinition(ammunition: Ammunition): AmmunitionDefinition {\n  return all[ammunition];\n}\n\nexport const isAmmunition = (item: ItemType): item is Ammunition => {\n  return !!all[item as Ammunition];\n}\n","import { ItemType, ItemDefinition, ItemCategory } from \"./types\";\n\ntype Prefix = \"questItem/\";\nconst PREFIX = \"questItem/\";\nconst itemCategory = ItemCategory.questItem;\nconst basePath = \"/img/items/quest-items/\";\n\n\nconst questItems = {\n  blueprints: {\n    itemCategory,\n    iconImg: `${basePath}blueprints.png`,\n  },\n  crate: {\n    itemCategory,\n    iconImg: `${basePath}crate.png`,\n  },\n  dynamite: {\n    itemCategory,\n    iconImg: `${basePath}dynamite.png`,\n  },\n  dragonEye: {\n    itemCategory,\n    iconImg: `${basePath}dragon-eye.png`,\n  },\n  eye: {\n    itemCategory,\n    iconImg: `${basePath}eye.png`,\n  },\n  feather: {\n    itemCategory,\n    iconImg: `${basePath}feather.png`,\n  },\n  food: {\n    itemCategory,\n    iconImg: `${basePath}food.png`,\n  },\n  heart: {\n    itemCategory,\n    iconImg: `${basePath}heart.png`,\n  },\n  horn: {\n    itemCategory,\n    iconImg: `${basePath}horn.png`,\n  },\n  key: {\n    itemCategory,\n    iconImg: `${basePath}key.png`,\n  },\n  letters: {\n    itemCategory,\n    iconImg: `${basePath}letters.png`,\n  },\n  lockPicks: {\n    itemCategory,\n    iconImg: `${basePath}lock-picks.png`,\n  },\n  oil: {\n    itemCategory,\n    iconImg: `${basePath}oil.png`,\n  },\n  orcFinger: {\n    itemCategory,\n    iconImg: `${basePath}orc-finger.png`,\n  },\n  plans: {\n    itemCategory,\n    iconImg: `${basePath}plans.png`,\n  },\n  purpleGems: {\n    itemCategory,\n    iconImg: `${basePath}purple-gems.png`,\n  },\n  runestone: {\n    itemCategory,\n    iconImg: `${basePath}runestone.png`,\n  },\n  sandwich: {\n    itemCategory,\n    iconImg: `${basePath}sandwich.png`,\n  },\n  teeth: {\n    itemCategory,\n    iconImg: `${basePath}teeth.png`,\n  },\n  tooth: {\n    itemCategory,\n    iconImg: `${basePath}tooth.png`,\n  },\n  torch: {\n    itemCategory,\n    iconImg: `${basePath}torch.png`,\n  },\n  tusk: {\n    itemCategory,\n    iconImg: `${basePath}tusk.png`,\n  },\n  vase: {\n    itemCategory,\n    iconImg: `${basePath}vase.png`,\n  },\n  vial: {\n    itemCategory,\n    iconImg: `${basePath}vial.png`,\n  },\n  weeds: {\n    itemCategory,\n    iconImg: `${basePath}weeds.png`,\n  },\n};\n\n\nexport type QuestItem = `${Prefix}${keyof typeof questItems}`;\nconst all = Object.entries(questItems).reduce<{[key: string]: ItemDefinition}>((acc, [key, value]) => {\n  acc[`${PREFIX}${key}`] = value;\n  return acc;\n}, {}) as Record<QuestItem, ItemDefinition>;\nexport default all;\n\nexport function getDefinition(questItem: QuestItem): ItemDefinition {\n  return all[questItem];\n}\n\nexport const isQuestItem = (item: ItemType): item is QuestItem => {\n  return !!all[item as QuestItem];\n}\n","export interface TiledMapData {\n  width: number;\n  height: number;\n  tilewidth: number;\n  tileheight: number;\n  infinite: boolean;\n  backgroundcolor: string | null;\n  orientation: Orientation;\n  renderorder: RenderOrder;\n  tilesets: TiledTilesetData[];\n  layers: TiledLayerData[];\n}\n\nexport interface TiledTilesetData {\n  columns: number;\n  firstgid: number;\n  source: string;\n  image: string;\n  imagewidth: number;\n  imageheight: number;\n  tilewidth: number;\n  tileheight: number;\n  tilecount: number;\n  name: string;\n  margin: number; // todo:\n  spacing: number; // todo\n  tiles?: TileData[];\n}\n\nexport interface TileData {\n  id: number,\n  image: string;\n  type: string;\n  properties?: TiledProperty[];\n}\n\nexport interface TiledLayerData {\n  data: number[];\n  objects: TiledObjectData[];\n  type: TiledLayerType;\n  height: number;\n  id: number;\n  name: string;\n  opacity: number; // not supported atm\n  visible: boolean;\n  x: number;\n  y: number;\n  width: number;\n  properties?: TiledProperty[];\n}\n\nexport interface TiledObjectData {\n  gid?: number;\n  id: number | string;\n  name?: string;\n  properties?: TiledProperty[];\n  polygon?: { x: number, y: number}[];\n  type: string;\n  visible: boolean;\n  width: number;\n  height: number;\n  x: number;\n  y: number;\n}\n\nexport enum TiledLayerType {\n  tilelayer = \"tilelayer\",\n  objectgroup = \"objectgroup\"\n}\n\nexport interface TiledProperty {\n  name: string,\n  type: string,\n  value: string | number | boolean;\n}\n\nenum Orientation {\n  orthagonal = \"orthagonal\",\n  isometric = \"isometric\",\n  staggered = \"staggered\",\n  hexagonal = \"hexagonal\"\n}\n\nenum RenderOrder {\n  rightUp = \"right-up\",\n  rightDown = \"right-down\",\n  leftUp = \"left-up\",\n  leftDown = \"left-down\"\n}\n","import { WeaponType } from \"definitions/items/weapons\";\nimport { EnemyDefinition } from \"./types\";\nconst spritesheetBasePath = \"img/scene/actors/\";\n\ntype TrollDefinition = {\n  [key: string]: EnemyDefinition\n}\nconst trolls: TrollDefinition = {\n  'troll-developer': {\n    attributes: {\n      str: 6,\n      for: 5,\n      int: 16,\n      agi: 8\n    },\n    skills: {\n      [WeaponType.sword]: 12,\n    },\n    mainHand: { type: \"weapon/steelSword\" },\n    spritesheet: `${spritesheetBasePath}troll-sword.json`\n  },\n  'troll-manager': {\n    attributes: {\n      str: 8,\n      for: 7,\n      int: 12,\n      agi: 10\n    },\n    skills: {\n      [WeaponType.axe]: 12,\n    },\n    mainHand: { type: \"weapon/battleAxe\" },\n    spritesheet: `${spritesheetBasePath}troll-axe.json`\n  },\n  'troll-accountant': {\n    attributes: {\n      str: 8,\n      for: 7,\n      int: 12,\n      agi: 10\n    },\n    skills: {\n      [WeaponType.axe]: 12,\n    },\n    mainHand: { type: \"weapon/battleAxe\" },\n    spritesheet: `${spritesheetBasePath}troll-axe.json`\n\n  }\n}\n\nexport default trolls;\nexport type Troll = `${keyof typeof trolls}`;\n\n","import { EnemyDefinition, EnemyType } from \"./types\";\nimport trolls from \"./trolls\";\n\nconst all = {\n  ...trolls,\n};\n\nexport default all;\nexport function getDefinition(enemy: EnemyType): EnemyDefinition {\n  return all[enemy] as unknown as EnemyDefinition;\n}\n","import { LootCache } from 'store/types/scene';\n\nexport interface Kill10BoarsQuestVars {\n  dungeon: {\n    entered: boolean,\n    entrance: {\n      chestOpen: boolean,\n      chest: LootCache,\n    }\n    hallway: {\n      doorOpen: boolean,\n      chestOpen: boolean,\n      chest: LootCache,\n    }\n    // situations: {\n    //   altar: {\n    //     candleLit: boolean\n    //   },\n    // }\n  }\n}\n\nexport const initialQuestVars: Kill10BoarsQuestVars = {\n  dungeon: {\n    entered: false,\n    entrance: {\n      chestOpen: false,\n      chest: {\n        title: \"encounter-dungeon-caches-chest\",\n        items: [\n          { type: \"apparel/nomadHelmet\" },\n          { type: \"questItem/teeth\" },\n          { type: \"material/poisonVial\" },\n          { type: \"apparel/fedora\" },\n        ],\n        gold: 100\n      },\n      // altar: {\n      //   title: \"quest-kill10-boars-dungeonentrance-altar\",\n      //   items: [\n      //     Item.bolts,\n      //     Item.letters\n      //   ]\n      // },\n    },\n    hallway: {\n      chest: {\n        title: \"encounter-dungeon-caches-chest\",\n        items: [ { type: \"questItem/key\" }]\n      },\n      chestOpen: false,\n      doorOpen: false\n    }\n  }\n}\n","export interface TextEntry {\n  key: string;\n  context?: unknown;\n}\n\nexport function isTextEntry(test: string | TextEntry): test is TextEntry {\n  return typeof test !== \"string\";\n}\n","// This is the format AStarFind works with\nexport const convertIn = (l: [number, number]) => ({ x: l[0], y: l[1] });\nexport const convertOut = (input: number[]): [number, number] => [input[0], input[1]];\n","import { Store, AnyAction, DeepPartial } from \"redux\";\nimport { addAllTilesInLayerToList, locationEquals, TiledObjectType, parseProperties } from 'utils/tilemap';\nimport { StoreState } from 'store/types';\nimport { loadResourceAsync } from 'utils/pixiJs';\nimport { TiledLayerType, TiledMapData, TiledObjectData } from 'constants/tiledMapData';\nimport { AStarFinder } from 'astar-typescript';\nimport { AdventurerStoreState } from 'store/types/adventurer';\nimport { setScene, setSceneName, exitEncounter, enqueueSceneAction, updateQuestVars, deductActorAp, endPlayerTurn } from 'store/actions/quests';\nimport { SceneObject, ActorObject, LootCache, SceneActionType, SceneAction, isActorObject, isAdventurer, isEnemy, Allegiance } from 'store/types/scene';\nimport { ToastManager } from 'global/ToastManager';\nimport { Type } from 'components/ui/toasts/Toast';\nimport { getQuestLink } from 'utils/routing';\nimport { TextEntry, isTextEntry } from 'constants/text';\nimport { TextManager } from 'global/TextManager';\nimport { addLogEntry } from 'store/actions/log';\nimport { getDefinition } from 'definitions/quests';\nimport { getDefinition as getEnemyDefinition } from 'definitions/enemies';\nimport { getDefinition as getWeaponDefinition, WeaponType } from 'definitions/items/weapons';\nimport { LogChannel } from 'store/types/logEntry';\nimport { addGold } from 'store/actions/gold';\nimport { addItemToInventory, changeEquipmentQuantity, removeItemFromInventory } from 'store/actions/adventurers';\nimport { adventurersOnQuest } from 'store/helpers/storeHelpers';\nimport { Channel, MixMode, SoundManager } from 'global/SoundManager';\nimport { Item, ItemType } from \"definitions/items/types\";\nimport { Loader, Point } from \"pixi.js\";\nimport { AP_COST_MOVE, AP_COST_SHOOT, AP_COST_SLASH, calculateInitialAP } from \"mechanics/combat\";\nimport { xpToLevel } from \"mechanics/adventurers/levels\";\nimport { EnemyType } from \"definitions/enemies/types\";\nimport { EquipmentSlotType } from \"components/ui/adventurer/EquipmentSlot\";\nimport { roll3D6 } from \"utils/random\";\nimport { BubbleLayer, BubbleManager, BubbleType } from \"global/BubbleManager\";\nimport { convertIn, convertOut } from \"utils/aStar\";\n\nconst spritesheetBasePath = \"img/scene/actors/\";\nexport const movementDuration = 500; // time every tile movement takes\n\n\n/**\n * This is a type of God class that knows pretty much everything about a scene\n */\nexport class BaseSceneController<TQuestVars> {\n\n  public questName: string;\n  public mapData?: TiledMapData;\n  public aStar?: AStarFinder;\n  public dataLoading = false;\n  public dataLoadComplete = false;\n  public store: Store<StoreState, AnyAction>;\n\n  protected jsonPath?: string;\n  protected blockedTiles: [number, number][] = [];\n  protected tileTypes: {[name: string]: number } = {}; // map tiletype to gid\n\n  constructor(store: Store<StoreState, AnyAction>, questName: string) {\n    this.store = store;\n    this.questName = questName;\n  }\n\n  get basePath(): string | null {\n    return `${process.env.PUBLIC_URL}/scenes`;\n  }\n\n  // Loads tiles from json, loads all scene assets\n  async loadData(callback: () => void) {\n    if (this.dataLoadComplete) {\n      return callback();\n    }\n    if (!this.jsonPath) {\n      throw new Error(\"No jsonPath defined!\");\n    }\n    this.dataLoading = true;\n\n    await loadResourceAsync(`${process.env.PUBLIC_URL}/${this.jsonPath}`);\n\n    // load sounds\n    const promises = [\n      SoundManager.addSound(\"scene/bow\", [\"sound/scene/bow-01.mp3\", \"sound/scene/bow-02.mp3\"]),\n      SoundManager.addSound(\"scene/crossbow\", [\"sound/scene/crossbow-01.mp3\", \"sound/scene/crossbow-02.mp3\", \"sound/scene/crossbow-03.mp3\", \"sound/scene/crossbow-04.mp3\"]),\n      SoundManager.addSound(\"scene/daggerSwish\", [\"sound/scene/dagger-swish.ogg\"]),\n      SoundManager.addSound(\"scene/meleeHit\", [\"sound/scene/melee-hit-01.mp3\", \"sound/scene/melee-hit-02.mp3\", \"sound/scene/melee-hit-03.mp3\"]),\n      SoundManager.addSound(\"scene/metalBash\", [\"sound/scene/metal-bash-01.mp3\", \"sound/scene/metal-bash-02.mp3\", \"sound/scene/metal-bash-03.mp3\"]),\n      SoundManager.addSound(\"scene/parry\", [\"sound/scene/parry-01.ogg\", \"sound/scene/parry-02.ogg\"]),\n      SoundManager.addSound(\"scene/shieldBash\", [\"sound/scene/shield-bash-impact.mp3\"]),\n      SoundManager.addSound(\"scene/swish\", [\"sound/scene/swish-01.mp3\", \"sound/scene/swish-02.mp3\", \"sound/scene/swish-03.mp3\", \"sound/scene/swish-04.mp3\"]),\n      SoundManager.addSound(\"scene/doorOpen\", [\"sound/scene/door.ogg\"]),\n    ];\n\n    // Promise.all(promises).then(async () => {\n    await Promise.all(promises);\n\n    const resource = Loader.shared.resources[`${process.env.PUBLIC_URL}/${this.jsonPath}`];\n    if (!resource.data) {\n      throw new Error(`No map data found at ${process.env.PUBLIC_URL}/${this.jsonPath}`)\n    }\n    this.mapData = resource.data;\n\n    // Create aStar based on blocked tiles\n    this.createBlockedTiles();\n    this.createTileTypes();\n    this.aStar = this.createAStar();\n\n    const spritesheets = this.spritesheetPaths;\n    for(const path of spritesheets) {\n      await loadResourceAsync(path);\n    }\n    // PIXI.utils.clearTextureCache()\n    this.dataLoadComplete = true;\n    this.dataLoading = false;\n    callback();\n  }\n\n  createBlockedTiles(objects?: SceneObject[]) {\n    this.blockedTiles = [];\n    this.mapData?.layers.filter(layer => layer.visible).forEach(layer => {\n      if (layer.properties && layer.properties.some(p => p.name === 'blocksMovement' && p.value === true)){\n        addAllTilesInLayerToList(this.blockedTiles, layer, layer.width);\n      }\n    });\n    objects?.forEach(o => {\n      if(o.properties.blocksMovement === true && o.location){\n        this.blockedTiles.push(o.location);\n      }\n    });\n  }\n\n  createTileTypes() {\n    this.mapData?.tilesets.forEach((tileset) => {\n      tileset.tiles?.forEach((tile) => {\n        this.tileTypes[tile.type] = tile.id + tileset.firstgid\n      })\n    });\n  }\n\n  // Constructs the scene and dispatches it to be saved to the store\n  createScene() {\n    const objects = this.createObjects();\n    const combat = false;\n    this.updateScene(objects, combat)\n  }\n\n  updateScene(objects: SceneObject[] = this.sceneObjects, combat: boolean = this.combat) {\n    const scene = {\n      ...this.quest.scene,\n      objects,\n      combat,\n    }\n    this.dispatch(setScene(this.questName, scene));\n\n    this.createBlockedTiles(objects);\n\n    // Create aStar based on blocked tiles\n    if (this.mapData) {\n      this.aStar = this.createAStar();\n    }\n  }\n\n  sceneEntered() {\n    return;\n  }\n\n  sceneExited() {\n    return;\n  }\n\n  // Convenience function returns an object with tileWidth and tileHeight properties\n  getTileDimensions() {\n    return {\n      tileWidth: this.mapData?.tilewidth || 0,\n      tileHeight: this.mapData?.tileheight || 0\n    }\n  }\n\n  actorMoved(actor: string, location: [number, number]) {\n    const isNotAnActor = (object: SceneObject) => !isActorObject(object);\n    const destination = this.getObjectAtLocation(location, isNotAnActor);\n    if (!destination) return;\n\n    if (this.combat) {\n      // Take away AP for moving\n      this.dispatch(deductActorAp(this.questName, actor, AP_COST_MOVE));\n    }\n\n    if (destination.type === TiledObjectType.portal) {\n\n      // We've hit a portal\n      if (destination.properties.exit) {\n        // Exit the encounter\n        const index = Math.floor(this.quest.progress) + 1;\n        const definition = getDefinition(this.questName);\n        const node = definition.nodes[index];\n        if (node.log) {\n          // If the next node has a log entry, add it\n          this.log(node.log)\n        }\n        this.dispatch(exitEncounter(this.questName));\n      }\n      else if (destination.properties.to) {\n        // Load another scene\n        this.dispatch(setSceneName(this.questName, destination.properties.to as string))\n      }\n    }\n  }\n\n  actorSlashing(actorId: string, _location: [number, number]) {\n    // todo 08/08/2019 use CombatController : move to CombatController?\n    SoundManager.playSound(\"scene/swish\", Channel.scene, false, MixMode.singleInstance);\n    const actor = this.getSceneActor(actorId);\n    if (!actor) throw new Error(\"No actor found\");\n    const weapon = this.getActorMainhandItem(actor);\n    if (!weapon) throw new Error(\"No weapon found\");\n    const definition = getWeaponDefinition(weapon.type);\n\n    switch(definition.weaponType) {\n      case WeaponType.knife: {\n        SoundManager.playSound(\"scene/daggerSwish\", Channel.scene, false, MixMode.singleInstance);\n        break;\n      }\n      default: {\n        SoundManager.playSound(\"scene/swish\", Channel.scene, false, MixMode.singleInstance);\n        break;\n      }\n    }\n  }\n\n  actorSlashed(actorId: string, location: [number, number]) {\n    // todo 08/08/2019 use CombatController : move to CombatController?\n    const ap = AP_COST_SLASH;\n    this.dispatch(deductActorAp(this.questName, actorId, ap));\n    const actor = this.getSceneActor(actorId);\n    if (!actor) throw new Error(\"No actor found\");\n    const weapon = this.getActorMainhandItem(actor);\n    if (!weapon) throw new Error(\"No weapon found\");\n    const definition = getWeaponDefinition(weapon.type)\n    const skills = this.getActorSkills(actor);\n    const roll = roll3D6();\n    if (roll <= (skills[definition.weaponType] ?? 0)) {\n      console.log(\"HIT at \", location);\n      this.bubbleAtLocation(\"HIT\", location);\n\n    } else {\n      this.bubbleAtLocation(\"MISS\", location);\n\n      if (this.settings.verboseCombatLog) {\n        this.log({ key: \"scene-combat-attack-slash-missed-verbose\", context: {\n          actor,\n          weapon: weapon.type,\n          ap,\n          roll,\n          weaponType: definition.weaponType,\n          skill: skills[definition.weaponType]\n        }});\n      } else {\n        this.log({ key: \"scene-combat-attack-slash-missed\", context: { actor, weapon: weapon.type }});\n      }\n    }\n    // todo: see if slash misses\n    // todo: process the hit, take away any HP?\n  }\n\n  actorShooting(actorId: string, _location: [number, number]) {\n    const actor = this.getSceneActor(actorId);\n    if (!actor) throw new Error(\"No actor found\");\n    const weapon = this.getActorMainhandItem(actor);\n    if (!weapon) throw new Error(\"No weapon found\");\n    const definition = getWeaponDefinition(weapon.type);\n\n    switch(definition.weaponType) {\n      case WeaponType.bow: {\n        SoundManager.playSound(\"scene/bow\", Channel.scene, false, MixMode.singleInstance);\n      }\n      break;\n      case WeaponType.crossbow: {\n        SoundManager.playSound(\"scene/crossbow\", Channel.scene, false, MixMode.singleInstance);\n      }\n      break;\n    }\n\n    const ammo = this.getActorOffhandItem(actor);\n    if (ammo && isAdventurer(actor)) {\n      let quantity = (ammo.quantity || 1);\n      this.dispatch(changeEquipmentQuantity(actorId, EquipmentSlotType.offHand, --quantity));\n    }\n  }\n\n  actorShot(actorId: string, location: [number, number]) {\n    const ap = AP_COST_SHOOT;\n    // Take away AP for shooting\n    this.dispatch(deductActorAp(this.questName, actorId, ap));\n    const actor = this.getSceneActor(actorId);\n    if (!actor) throw new Error(\"No actor found\");\n    const weapon = this.getActorMainhandItem(actor);\n    if (!weapon) throw new Error(\"No weapon found\");\n    const definition = getWeaponDefinition(weapon.type)\n    const skills = this.getActorSkills(actor);\n    const roll = roll3D6();\n    if (roll <= (skills[definition.weaponType] ?? 0)) {\n      console.log(\"HIT at \", location);\n\n    } else {\n         if (this.settings.verboseCombatLog) {\n          this.log({ key: \"scene-combat-attack-shoot-missed-verbose\", context: {\n            actor,\n            weapon: weapon.type,\n            ap,\n            roll,\n            weaponType: definition.weaponType,\n            skill: skills[definition.weaponType]\n          }});\n        } else {\n          this.log({ key: \"scene-combat-attack-shoot-missed\", context: { actor, weapon: weapon.type }});\n        }\n    }\n    // todo: process the hit, take away any HP?\n  }\n\n  actorInteract(actorId: string, location: [number, number]) {\n    const actor = this.getSceneActor(actorId);\n    const object = this.getObjectAtLocation(location);\n\n    if (!object) {\n      console.warn(\"No object found\");\n      return;\n    }\n    if (actor) {\n      this.interactWithObject(actor, object);\n    }\n  }\n\n  actorAttemptAction(actorId: string, type: SceneActionType, destination: [number, number]) {\n    // Tries to perform action on given actor\n\n    const actor = this.getSceneActor(actorId);\n    if (!actor) return\n    const {location} = actor;\n    if (!location) throw new Error(\"No location found!\")\n\n    switch (type) {\n      case SceneActionType.move: {\n        // Find path to move using aStar\n        const path = this.findPath(location, destination);\n\n        if (this.combat) {\n          const remaining = actor.ap || -1;\n          if (remaining < (path?.length || 0)) {\n            return;\n          }\n        }\n        path?.forEach((l, index) => {\n          // Queue up all the steps\n          const sceneAction: SceneAction = {\n            actionType: SceneActionType.move,\n            actorId,\n            target: l as [number, number],\n            endsAt: movementDuration * (index + 1) + performance.now()\n          };\n          this.dispatch(enqueueSceneAction(this.questName, sceneAction));\n        });\n        break;\n      }\n      case SceneActionType.interact: {\n        const path = this.findPathNearest(location, destination);\n        path?.forEach((l, index) => {\n          const moveAction: SceneAction = {\n            actionType: SceneActionType.move,\n            actorId,\n            target: l as [number, number],\n            endsAt: movementDuration * (index + 1) + performance.now()\n          };\n          this.dispatch(enqueueSceneAction(this.questName, moveAction));\n        });\n\n        const interactAction: SceneAction = {\n          actionType: SceneActionType.interact,\n          actorId,\n          target: destination,\n          endsAt: movementDuration * path.length + performance.now()\n        };\n        this.dispatch(enqueueSceneAction(this.questName, interactAction));\n        break;\n      }\n      case SceneActionType.slash: {\n        // Find path to move towards the target\n        const path = this.findPath(location, destination);\n        const target = path?.pop();\n        if (!path || !target) {\n          // No path possible.. cant do anything now\n          return;\n        }\n\n        // Walk towards the target\n        path?.forEach((l, index) => {\n          const moveAction: SceneAction = {\n            actionType: SceneActionType.move,\n            actorId,\n            target: l as [number, number],\n            endsAt: movementDuration * (index + 1) + performance.now()\n          };\n          this.dispatch(enqueueSceneAction(this.questName, moveAction));\n        });\n        const meleeAction: SceneAction = {\n          actionType: type,\n          actorId,\n          target,\n          endsAt: movementDuration * (path.length + 1) + performance.now()\n        };\n        this.dispatch(enqueueSceneAction(this.questName, meleeAction));\n        break;\n      }\n      case SceneActionType.shoot: {\n\n        const shootAction: SceneAction = {\n          actionType: type,\n          actorId,\n          target: destination,\n          endsAt: 500 + performance.now()\n        };\n        this.dispatch(enqueueSceneAction(this.questName, shootAction));\n      }\n    }\n  }\n\n  interactWithObject(_actor: ActorObject, _object: SceneObject) {\n    // override\n  }\n\n  // Converts pixel coordinate (where 0,0 is top left of the canvas) to scene location\n  pointToSceneLocation (point: Point): [number, number] {\n    if (!this.mapData?.tilewidth || !this.mapData?.tileheight) {\n      return [0, 0];\n    }\n    return [Math.floor(point.x / this.mapData.tilewidth), Math.floor(point.y / this.mapData.tilewidth)];\n  }\n\n  // returns the pixel coordinate of the top left corner of the given location\n  sceneLocationToPoint (location: [number, number]): Point {\n    if (!this.mapData?.tilewidth || !this.mapData?.tileheight) {\n      return new Point();\n    }\n    return new Point(location[0] * this.mapData.tilewidth, location[1] * this.mapData.tileheight);\n  }\n\n  // Returns true if the tile is blocked\n  locationIsBlocked(location: [number, number]){\n    return this.blockedTiles.some((l) => locationEquals(l, location));\n  }\n\n  // Returns true if outsie of the bounds of the map\n  locationIsOutOfBounds(location: [number, number]) {\n    if (!this.mapData) return true;\n\n    return location[0] < 0 || location[1] < 0 ||\n      location[0] >= this.mapData.width ||\n      location[1] >= this.mapData.height;\n  }\n\n  // Should be overridden\n  getLootCache(_name: string): LootCache | undefined {\n    // Override this to retrieve LootCache from questvars\n    return;\n  }\n\n  takeGoldFromCache(name: string) {\n    // Override this to remove gold from questvars\n    const lootCache = this.getLootCache(name);\n    if (lootCache){\n      this.dispatch(addGold(lootCache.gold || 0));\n    }\n  }\n\n  takeItemFromCache(itemIndex: number, name: string, adventurerId: string, toSlot?: number) {\n    // Override this to remove items from questvars\n    const lootCache = this.getLootCache(name);\n    if (!lootCache) return;\n\n    const item = lootCache.items[itemIndex];\n    this.dispatch(addItemToInventory(adventurerId, item, toSlot))\n  }\n\n  discardItem(item: Item, adventurerId: string) {\n    const adventurer = this.getAdventurerById(adventurerId);\n    const itemIndex = adventurer?.inventory.indexOf(item);\n    if (itemIndex !== undefined) {\n      this.dispatch(removeItemFromInventory(adventurerId, itemIndex));\n    }\n  }\n\n  // Discards first item of type\n  discardItemType(itemType: ItemType, adventurerId: string) {\n    const adventurer = this.getAdventurerById(adventurerId);\n    const item = adventurer?.inventory.find(i => i?.type === itemType);\n    if (item) {\n      this.discardItem(item, adventurerId);\n    }\n  }\n\n  getSituation(_situation: string, _adventurerId?: string) : Situation | undefined {\n     return undefined;\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-empty-function\n  handleSituationOptionClick(_situation: string, _option: string, _adventurerId: string) {\n  }\n\n  /**\n   * Returns a path from two locations on the map\n   * @param origin\n   * @param target\n   */\n  findPath(origin: [number, number], target: [number, number]) {\n    return this\n      .aStar?.findPath(convertIn(origin), convertIn(target))\n      .map(convertOut);\n  }\n\n  /**\n   * Finds a path from origin to a tile next to target (closest from origin)\n   * It doesn't matter if target is unpathable\n   * @param origin\n   * @param target\n   */\n  public findPathNearest(origin: [number, number], target: [number, number], includeLast = false) {\n    // todo; shortcut, if already neighbour, return early\n    const grid = this.aStar?.getGrid().getGridNodes();\n    if (!grid) return [];\n\n    const matrix = grid.map(r => r.map(c => (c.getIsWalkable() ? 0 : 1)));\n    matrix[target[1]][target[0]] = 0; // make target pathable\n    const tempAStar = new AStarFinder({\n      grid: {\n        matrix\n      },\n      includeStartNode: false,\n      heuristic: \"Manhattan\",\n      weight: 0.2,\n    });\n\n    return tempAStar.findPath(convertIn(origin), convertIn(target))\n      .map(convertOut)\n      .slice(0, includeLast ? undefined : -1);\n  }\n\n  /**\n   * Searches around @param origin to find empty, pathable locations\n   * @param origin location to search around\n   * @param amount of locations to find\n   */\n  public findEmptyLocationsAround(origin: [number, number], amount: number) {\n    const results: [number, number][] = [];\n    let radius = 1;\n\n    const getTop = (radius: number): [number, number][] => {\n      const y = -radius + origin[1];\n      const result = [];\n      for (let x = -radius + origin[0]; x <= radius + origin[0]; x++) {\n        result.push([x, y] as [number, number])\n      }\n      return result;\n    }\n    const getRight = (radius: number) => {\n      const x = radius + origin[0];\n      const result = [];\n      for (let y = -radius + 1 + origin[1]; y <= radius - 1 + origin[1]; y++) {\n        result.push([x, y] as [number, number])\n      }\n      return result;\n    }\n    const getBottom = (radius: number) => {\n      const y = radius + origin[1];\n      const result = [];\n      for (let x = -radius + origin[0]; x <= radius + origin[0]; x++) {\n        result.push([x, y] as [number, number])\n      }\n      return result;\n    }\n    const getLeft = (radius: number) => {\n      const x = -radius + origin[0];\n      const result = [];\n      for (let y = -radius + 1 + origin[1]; y <= radius - 1 + origin[1]; y++) {\n        result.push([x, y] as [number, number])\n      }\n      return result;\n    }\n\n    const notOutside = (location: [number, number]) => {\n      if (!this.mapData) return false\n      return location[0] >= 0 && location[0] < this.mapData.width\n        && location[1] >= 1 && location[1] < this.mapData.height\n    }\n\n    while (radius < (this.mapData?.width ?? 2)) {\n      // determine locations in square radius\n      const square: [number, number][] = [\n        ...getTop(radius),\n        ...getRight(radius),\n        ...getBottom(radius),\n        ...getLeft(radius)\n      ]\n      const filtered = square.filter(l => notOutside(l) && !this.locationIsBlocked(l));\n      results.push(...filtered.slice(0, amount - results.length))\n      if (results.length === amount) break;\n      radius++;\n    }\n    return results;\n  }\n\n  /**\n   * Calculates the AP costs to walk\n   */\n  calculateWalkApCosts(from: [number, number], to: [number, number]) {\n    return this.findPath(from, to)?.length || 0;\n  }\n\n  /**\n   * Forfeits all player ap\n   */\n  public endTurn() {\n    this.dispatch(endPlayerTurn(this.questName));\n  }\n\n  public getSceneActor(actorId: string): ActorObject | undefined {\n    const actor = this.sceneActors.find(sA => sA.name === actorId);\n    // if (!actor) throw new Error (`No actor found with id ${actorId}`);\n    return actor;\n  }\n\n  /**\n   *\n   * @param location\n   * @param additionalFilter can specifiy an additional filter\n   * @returns\n   */\n  public getObjectAtLocation(location: [number, number], additionalFilter: (object: SceneObject) => boolean = () => true) {\n    return this.quest.scene?.objects?.find(o => o.location && locationEquals(o.location, location) && additionalFilter(o))\n  }\n\n  protected createAStar() {\n    if (!this.mapData) return\n    const matrix: number[][] = [];\n    if (this.mapData){\n      for (let y = 0; y < this.mapData.height; y++) {\n        const row: number[] = [];\n        for (let x = 0; x < this.mapData.width; x++) {\n          const location: [number, number] = [x, y];\n          const blocked = this.locationIsBlocked(location);\n          row.push(blocked ? 1 : 0);\n        }\n        matrix.push(row);\n      }\n    }\n\n    return new AStarFinder({\n      grid: {\n        matrix\n      },\n      includeStartNode: false,\n      heuristic: \"Manhattan\",\n      weight: 0.2,\n    });\n  }\n\n  // Create SceneObject from this.mapData\n  protected createObjects(): SceneObject[] {\n    if (!this.mapData) {\n      throw new Error(\"No mapData\");\n    }\n\n    const objectLayers = this.mapData.layers.filter(layer => layer.type === TiledLayerType.objectgroup);\n    const objects: SceneObject[] = [];\n    objectLayers.forEach(objectLayer => {\n      objectLayer.objects.reduce((acc:  SceneObject[], value: TiledObjectData) => {\n\n        // reduce the props array into an object with key/values\n        const properties = parseProperties(value.properties);\n        const location: [number, number] = [\n          value.x / (this.mapData?.tilewidth || 1),\n          (value.y - (value.gid ? value.height : 0)) / (this.mapData?.tileheight || 1)\n        ];\n\n        const object: SceneObject | null = {\n          ...value,\n          layerId: objectLayer.id,\n          properties,\n          location\n        };\n\n        if (object.type === TiledObjectType.portal) {\n          if ((!object.properties.to && !this.quest.sceneNamePrev) || object.properties.to === this.quest.sceneNamePrev) {\n            // todo: instead store location in var and spawn adventurers at the end\n            const adventurers = this.getAdventurers();\n            const { width, height, layerId } = object;\n            const locations = [\n              location,\n              ...this.findEmptyLocationsAround(location, adventurers.length - 1)\n            ];\n\n            adventurers.forEach((adventurer, i) => {\n              if (!object) throw new Error();\n\n              const x = Math.round(object.x);\n              const y = Math.round(object.y);\n              const level = xpToLevel(adventurer.xp);\n              const adventurerObject: ActorObject = {\n                name: adventurer.id,\n                id: adventurer.id,\n                x,\n                y,\n                location: locations[i],\n                width,\n                height,\n                layerId,\n                visible: true,\n                type: TiledObjectType.actor,\n                ap: calculateInitialAP(adventurer.basicAttributes, level),\n                health: adventurer.health,\n                allegiance: Allegiance.player,\n                properties: {\n                  adventurerId: adventurer.id,\n                  isSprite: true,\n                  spritesheet: adventurer.spritesheetPath\n                }\n              }\n              acc.push(adventurerObject);\n            });\n          }\n        }\n        else if (object.type === TiledObjectType.enemySpawn) {\n          object.type = TiledObjectType.actor;\n          if (isActorObject(object)) { // typeguard, is always true but we need to tell typescript it's an actor\n            const definition = getEnemyDefinition(object.properties.name as EnemyType)\n            const level = object.properties.level as number ?? 1;\n            object.health = Math.random() * 100;\n            object.ap = calculateInitialAP(definition.attributes, level)\n            object.name = object.properties.name as string;\n            object.level = level;\n            object.allegiance = Allegiance.enemy;\n            object.properties.isSprite = true;\n            object.properties.spritesheet = definition.spritesheet;\n          }\n        }\n\n        if (object) {\n          acc.push(object);\n        }\n        return acc;\n      }, objects);\n    });\n    return objects;\n  }\n\n  // Scene\n  protected get combat() {\n    return !!this.quest.scene?.combat;\n  }\n\n  public get sceneObjects(): SceneObject[]  {\n    return this.quest.scene?.objects || [];\n  }\n\n  public get sceneActors(): ActorObject[] {\n    return this.sceneObjects.filter<ActorObject>(isActorObject);\n  }\n\n  public get sceneAdventurers(): ActorObject[] {\n    return this.sceneObjects.filter<ActorObject>(isAdventurer);\n  }\n\n  public get sceneEnemies(): ActorObject[] {\n    return this.sceneObjects.filter<ActorObject>(isEnemy);\n  }\n\n  // Quest\n  public get quest() {\n    const storeState = this.store.getState();\n    const quest = storeState.quests.find(q => q.name === this.questName);\n    if (!quest) throw new Error(\"No quest :(\")\n    return quest;\n  }\n\n  protected get questVars(): TQuestVars {\n    return this.quest.questVars as unknown as TQuestVars;\n  }\n\n  protected get spritesheetPaths(): string[] {\n    const adventurers = this.getAdventurers();\n    return [\n      ...adventurers.map(a => a.spritesheetPath),\n      `${spritesheetBasePath}troll-sword.json`,   // todo: only load enemy sprites that are actually needed\n      `${spritesheetBasePath}troll-axe.json`      // todo: only load enemy sprites that are actually needed\n    ];\n  }\n\n  public get settings() {\n    return this.store.getState().settings;\n  }\n\n  // Provide questvars to update\n  protected updateQuestVars(updated: DeepPartial<TQuestVars>) {\n    this.dispatch(updateQuestVars(this.questName, updated));\n  }\n\n  public getAdventurers(): AdventurerStoreState[] {\n    const storeState = this.store.getState();\n    return adventurersOnQuest(storeState.adventurers, this.quest);\n  }\n\n  protected getAdventurerByActor(actor: ActorObject) {\n    const storeState = this.store.getState();\n    return storeState.adventurers.find(a => a.id === actor.name);\n  }\n  protected getEnemyByActor(actor: ActorObject) {\n    return getEnemyDefinition(actor.name);\n  }\n\n  protected getAdventurerById(id: string) {\n    const storeState = this.store.getState();\n    return storeState.adventurers.find(a => a.id === id);\n  }\n\n  protected getActorSkills(actor: ActorObject) {\n    if (isAdventurer(actor)) {\n      const adventurer = this.getAdventurerByActor(actor);\n      if (!adventurer) throw new Error(\"No adventurer found\")\n      return adventurer.skills;\n    }\n    const enemy = this.getEnemyByActor(actor);\n    return enemy.skills;\n  }\n\n  protected getActorMainhandItem(actor: ActorObject) {\n    if (isAdventurer(actor)) {\n      const adventurer = this.getAdventurerByActor(actor);\n      if (!adventurer) throw new Error(\"No adventurer found\")\n      return adventurer.equipment[EquipmentSlotType.mainHand];\n    }\n    const enemy = this.getEnemyByActor(actor);\n    return enemy.mainHand;\n  }\n\n  protected getActorOffhandItem(actor: ActorObject) {\n    if (isAdventurer(actor)) {\n      const adventurer = this.getAdventurerByActor(actor);\n      if (!adventurer) throw new Error(\"No adventurer found\")\n      return adventurer.equipment[EquipmentSlotType.offHand];\n    }\n    const enemy = this.getEnemyByActor(actor);\n    return enemy.offHand;\n  }\n\n  protected questUpdate(input: string | TextEntry, icon?: string, toast = false): void {\n    const textEntry: TextEntry = isTextEntry(input) ? input : {key: input};\n    const title = TextManager.getTextEntry(textEntry);\n    if (toast) {\n      ToastManager.addToast(title, Type.questUpdate, icon, getQuestLink(this.questName));\n    }\n    this.log(textEntry);\n  }\n\n  protected log(input: string | TextEntry): void {\n    const textEntry: TextEntry = isTextEntry(input) ? input : {key: input};\n    this.dispatch(addLogEntry(textEntry, LogChannel.quest, this.questName));\n  }\n\n  protected bubbleAtLocation(text: string, location: [number, number], bubbleType?: BubbleType) {\n    const point = this.sceneLocationToPoint(location);\n    point.set(point.x + (this.mapData?.tilewidth ?? 2) / 2, point.y);\n    BubbleManager.addBubble(text, point, bubbleType, BubbleLayer.scene);\n  }\n\n  // Store\n  protected dispatch(action: AnyAction) {\n    this.store.dispatch(action)\n  }\n}\n\nexport interface Situation {\n  title: string;\n  choices?: string[];\n  text?: string;\n}\n","import { BaseSceneController } from 'mechanics/scenes/BaseSceneController';\nimport { SceneControllerManager } from 'global/SceneControllerManager';\nimport { SceneObject, ActorObject, LootCache } from 'store/types/scene';\nimport { setActiveSceneInteractionModal } from 'store/actions/quests';\nimport { Kill10BoarsQuestVars } from '../questVars';\nimport { Channel, GameSound, MixMode, SoundManager } from 'global/SoundManager';\nimport { Item } from 'definitions/items/types';\n\nconst TILE_DOOR_UPPER_CLOSED = 121 + 131;\nconst TILE_DOOR_LOWER_CLOSED = 121 + 143;\nconst TILE_DOOR_UPPER_OPEN = 121 + 107;\nconst TILE_DOOR_LOWER_OPEN = 121 + 119;\n\nabstract class DungeonEncounterSceneController extends BaseSceneController<Kill10BoarsQuestVars>  {\n\n  // getLootCache(name: string): LootCache | undefined {\n  //   return this.questVars.dungeon.lootCaches[name];\n  // }\n\n  // takeGoldFromCache(name: string) {\n  //   super.takeGoldFromCache(name);  // first add gold to inventory\n  //   const lootCache = this.getLootCache(name);\n  //   if (lootCache){\n  //     const questVars = this.questVars;\n  //     questVars.dungeon.lootCaches[name].gold = 0;\n  //     this.store.dispatch(updateQuestVars(this.questName, questVars));\n  //   }\n  // }\n\n  // takeItemFromCache(itemIndex: number, name: string, adventurer: AdventurerStoreState, toSlot?: number) {\n  //   super.takeItemFromCache(itemIndex, name, adventurer, toSlot);\n  //   const lootCache = this.getLootCache(name);\n  //   if (lootCache){\n  //     const questVars = this.questVars;\n  //     const items = questVars.dungeon.lootCaches[name].items.filter((_: any, index: number) => index !== itemIndex);\n  //     questVars.dungeon.lootCaches[name].items = items;\n  //     this.store.dispatch(updateQuestVars(this.questName, questVars));\n  //   }\n  // }\n}\n\nexport class DungeonCanyonSceneController extends DungeonEncounterSceneController {\n  jsonPath = \"scenes/dungeon/canyon-64.json\";\n}\nexport class DungeonEntranceSceneController extends DungeonEncounterSceneController {\n  previousMusic?: GameSound;\n  jsonPath = \"scenes/dungeon/dungeon-entrance-64.json\";\n\n\n  getLootCache(_: string): LootCache | undefined {\n    return this.questVars.dungeon.entrance.chest;\n  }\n\n  takeGoldFromCache(name: \"chest\") {\n    super.takeGoldFromCache(name);  // first add gold to inventory\n    this.updateQuestVars({\n      dungeon: { entrance: { chest: { gold: 0 }}}\n    });\n  }\n\n  takeItemFromCache(itemIndex: number, name: string, adventurerId: string, toSlot?: number) {\n    super.takeItemFromCache(itemIndex, name, adventurerId, toSlot);\n    const lootCache = this.getLootCache(name);\n    if (lootCache){\n      const items = lootCache.items.filter((_:Item, index: number) => index !== itemIndex);\n      this.updateQuestVars({\n        dungeon: { entrance: { chest: { items }}}\n      });\n    }\n  }\n\n  updateScene(objects: SceneObject[] = this.sceneObjects, combat: boolean = this.combat) {\n    objects = objects.map(o => {\n      switch(o.name) {\n        case \"chest\": {\n          return {\n            ...o,\n            gid: this.questVars.dungeon.entrance.chestOpen ? this.tileTypes[\"chest.open\"] : this.tileTypes[\"chest.closed\"],\n          }\n        }\n      }\n      return o;\n    });\n    super.updateScene(objects, combat);\n  }\n\n  interactWithObject(actor: ActorObject, object: SceneObject) {\n    switch (object.name) {\n      // todo: I want to share this common stuff with other SceneControllers\n      case \"chest\":\n        if (!this.questVars.dungeon.entrance.chestOpen) {\n          const adventurer = this.getAdventurerByActor(actor)?.name;\n          const textEntry = { key: \"quest-common-adventurer-opened-chest\", context: { adventurer } };\n          this.questUpdate(textEntry, \"/img/items/misc/chest-02.png\");\n\n          this.updateQuestVars({\n            dungeon: { entrance: { chestOpen: true }}\n          })\n        }\n        // display loot modal\n        this.store.dispatch(setActiveSceneInteractionModal(this.questName, {\n          type: 'lootCache',\n          lootCache: object.name\n        }));\n        break;\n\n      case \"altar\":\n        this.store.dispatch(setActiveSceneInteractionModal(this.questName, {\n          type: 'situation',\n          situation: 'altar'\n        }));\n        break;\n    }\n    super.interactWithObject(actor, object);\n  }\n\n  sceneEntered() {\n    if (!this.questVars.dungeon.entered) {\n      // this.questUpdate(\"quest-kill10-boars-enter-dungeon-see-chest\");\n    }\n    this.previousMusic = SoundManager.getCurrentlyPlaying(Channel.music);\n    SoundManager.addSound(\"music/violettesElficSong\", [\"sound/music/ViolettesElficSongForLamentandHope.ogg\"], () => {\n      SoundManager.playSound(\"music/violettesElficSong\", Channel.music, true, MixMode.fade, true);\n    }),\n\n\n    super.sceneEntered();\n  }\n\n  sceneExited() {\n    if (this.previousMusic) {\n      SoundManager.playSound(this.previousMusic, Channel.music, true, MixMode.fade, true);\n    }\n\n    super.sceneExited();\n  }\n\n  getSituation(situation: string, adventurerId?: string) {\n    switch (situation) {\n      // case 'altar':\n      //   const questVars = this.questVars;\n      //   if (questVars.dungeon.situations.altar.candleLit) {\n      //     return {\n      //       title: 'quest-kill10-boars-dungeonentrance-altar',\n      //       choices: [\n      //         \"quest-kill10-boars-dungeonentrance-altar-rummagedrawers\"\n      //       ]\n      //     }f\n      //   }\n      //   return {\n      //     title: 'quest-kill10-boars-dungeonentrance-altar',\n      //     choices: [\n      //       \"quest-kill10-boars-dungeonentrance-altar-lightcandle\",\n      //       \"quest-kill10-boars-dungeonentrance-altar-rummagedrawers\"\n      //     ]\n      //   }\n        default:\n          return super.getSituation(situation, adventurerId);\n    }\n  }\n\n  handleSituationOptionClick(_situation: string, _option: string, _adventurerId: string) {\n    // switch (situation) {\n      // case 'altar': {\n      //   switch (option) {\n      //     case 'quest-kill10-boars-dungeonentrance-altar-lightcandle':\n      //       const questVars = this.questVars;\n      //       questVars.dungeon.situations.altar.candleLit = true;\n      //       this.store.dispatch(updateQuestVars(this.questName, questVars));\n      //       break;\n\n      //     case 'quest-kill10-boars-dungeonentrance-altar-rummagedrawers':\n      //       // display loot modal!\n      //       this.store.dispatch(setActiveSceneInteractionModal(this.questName, {\n      //         type: 'lootCache',\n      //         lootCache: 'altar'\n      //       }));\n      //       break;\n      //   }\n      // }\n    // }\n  }\n}\n\nexport class DungeonHallwaySceneController extends DungeonEncounterSceneController {\n  // jsonPath = \"scenes/ork-dungeon-level2.json\";\n  jsonPath = \"scenes/dungeon/dungeon-entry-64.json\";\n\n  getLootCache(_: string): LootCache | undefined {\n    return this.questVars.dungeon.hallway.chest;\n  }\n\n  sceneEntered() {\n    console.log(\"ENTERED THE HALLWAy\")\n    super.sceneEntered();\n  }\n\n  interactWithObject(actor: ActorObject, object: SceneObject) {\n    switch (object.name) {\n      // todo: I want to share this common stuff with other SceneControllers\n      case \"chest\":\n        if (!this.questVars.dungeon.hallway.chestOpen) {\n          const adventurer = this.getAdventurerByActor(actor)?.name;\n          const textEntry = { key: \"quest-common-adventurer-opened-chest\", context: { adventurer } };\n          this.questUpdate(textEntry, \"/img/items/misc/chest-02.png\");\n\n          this.updateQuestVars({\n            dungeon: { hallway: { chestOpen: true }}\n          })\n        }\n        // display loot modal\n        this.store.dispatch(setActiveSceneInteractionModal(this.questName, {\n          type: 'lootCache',\n          lootCache: object.name\n        }));\n        break;\n      case \"door1\":\n        if (!this.questVars.dungeon.hallway.doorOpen) {\n          this.store.dispatch(setActiveSceneInteractionModal(this.questName, {\n            type: 'situation',\n            situation: 'door'\n          }));\n        }\n        break;\n      case \"latrine\":\n        this.questUpdate(\"quest-kill10-boars-dungeonentrance-latrine\");\n        break;\n    }\n    super.interactWithObject(actor, object);\n  }\n\n  getSituation(situation: string, adventurerId?: string) {\n    switch (situation) {\n      case 'door': {\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        const adventurer = this.getAdventurerById(adventurerId!);\n        if (adventurer && adventurer.inventory.some(i => i?.type === \"questItem/key\")) {\n          // Adventurer has key\n          return {\n            title: 'quest-kill10-boars-dungeonentrance-door',\n            choices: [\n              \"quest-common-scenerio-door-open\"\n            ]\n          }\n        }\n        return {\n          title: 'quest-kill10-boars-dungeonentrance-door',\n          text: 'quest-kill10-boars-dungeonentrance-door-needs-key',\n        }\n      }\n      default:\n        return super.getSituation(situation, adventurerId);\n    }\n  }\n\n\n  handleSituationOptionClick(situation: string, option: string, adventurerId: string) {\n    switch (situation) {\n      case 'door': {\n        // Only one option, to open\n        this.updateQuestVars({\n          dungeon: { hallway: { doorOpen: true }}\n        });\n\n        SoundManager.playSound(\"scene/doorOpen\", Channel.scene, false, MixMode.singleInstance);\n\n        this.discardItemType(\"questItem/key\", adventurerId);\n        const adventurer = this.getAdventurerById(adventurerId)?.name;\n        const textEntry = { key: \"quest-common-adventurer-opened-door\", context: { adventurer } };\n        this.questUpdate(textEntry, \"/img/items/misc/chest-02.png\");\n\n        this.dispatch(setActiveSceneInteractionModal(this.questName));\n      }\n    }\n  }\n\n  // Todo: figure out an easier way to do this\n  takeItemFromCache(itemIndex: number, name: string, adventurerId: string, toSlot?: number) {\n    super.takeItemFromCache(itemIndex, name, adventurerId, toSlot);\n    const lootCache = this.getLootCache(name);\n    if (lootCache){\n      const items = lootCache.items.filter((_: unknown, index: number) => index !== itemIndex);\n      this.updateQuestVars({\n        dungeon: { hallway: { chest: { items }}}\n      });\n    }\n  }\n\n  updateScene(objects: SceneObject[] = this.sceneObjects, combat: boolean = this.combat) {\n    objects = objects.map(o => {\n      switch(o.name) {\n        case \"chest\": {\n          return {\n            ...o,\n            gid: this.questVars.dungeon.entrance.chestOpen ? this.tileTypes[\"chest.open\"] : this.tileTypes[\"chest.closed\"],\n          }\n        }\n        case \"door1\": {\n          if ( this.questVars.dungeon.hallway.doorOpen) {\n            const properties = { ...o.properties, blocksMovement: false, interactive: false };\n            if (o.properties.part === 'upper') {\n              return { ...o, gid: TILE_DOOR_UPPER_OPEN, properties};\n            } else {\n              return { ...o, gid: TILE_DOOR_LOWER_OPEN, properties};\n            }\n          } else {\n            if (o.properties.part === 'upper') {\n              return { ...o, gid: TILE_DOOR_UPPER_CLOSED };\n            } else {\n              return { ...o, gid: TILE_DOOR_LOWER_CLOSED };\n            }\n          }\n        }\n      }\n      return o;\n    });\n    super.updateScene(objects, combat);\n  }\n}\n\nexport class DungeonHub1Controller extends DungeonEncounterSceneController {\n  jsonPath = \"scenes/dungeon/dungeon-hub1.json\";\n}\n\nSceneControllerManager.registerSceneController(\"kill10Boars\", \"dungeon.canyon\", DungeonCanyonSceneController);\nSceneControllerManager.registerSceneController(\"kill10Boars\", \"dungeon.entrance\", DungeonEntranceSceneController);\nSceneControllerManager.registerSceneController(\"kill10Boars\", \"dungeon.hub1\", DungeonHub1Controller);\nSceneControllerManager.registerSceneController(\"kill10Boars\", \"dungeon.hallway\", DungeonHallwaySceneController);\n","import { Apparel } from 'definitions/items/apparel';\nimport { QuestItem } from 'definitions/items/questItems';\nimport { Item } from 'definitions/items/types';\nimport { Weapon } from 'definitions/items/weapons';\n\nexport enum StructureState {\n  NotBuilt,\n  Building,\n  Built,\n}\n\nexport interface StructureStoreState {\n  level: number;\n  workers: number;\n  state: StructureState;\n}\n\nexport type ProducableItem = Weapon | Apparel | QuestItem;\n\nexport interface ProductionStructureStoreState extends StructureStoreState {\n  produces: ProducableItem[];\n}\n\nexport interface ResourceStructureState extends StructureStoreState {\n  harvest?: Item[]; // Items currently available for harvest at this structure\n}\n","import { HarvestUpdate } from \"mechanics/gameTick/harvest\";\nimport { LogUpdate, QuestUpdate } from \"mechanics/gameTick/quests\";\nimport { State as seedrandomStateType } from \"seedrandom\";\nimport { ResourceStoreState } from \"store/types/resources\";\n\nexport type Time = \"harvest\" | \"task\"\nexport type GameAction =\n  { type: \"gameTick\", delta: number, rngState: seedrandomStateType | null, resources: ResourceStoreState | null, quests: QuestUpdate[], harvest: HarvestUpdate | null, log: LogUpdate[] }\n| { type: \"startGame\" }\n| { type: \"ignoreVersionDiff\" }\n| { type: \"reduceTime\", percentage: number, time: Time, what?: string}\n\n\nexport const startGame = (): GameAction => ({\n  type: \"startGame\",\n})\n\nexport const gameTick = (delta: number, rngState: seedrandomStateType | null, resources: ResourceStoreState | null, quests: QuestUpdate[], harvest: HarvestUpdate | null, log: LogUpdate[]): GameAction => ({\n  type: \"gameTick\",\n  delta,\n  rngState,\n  resources,\n  quests,\n  harvest,\n  log,\n})\n\nexport const reduceTime = (percentage: number, time: Time, what?: string): GameAction => ({\n  type: \"reduceTime\",\n  percentage,\n  time,\n  what\n})\n\nexport const ignoreVersionDiff = () => ({\n  type: \"ignoreVersionDiff\"\n})\n","/**\n * Convert a sematic versioning string into an 32-bit integer.\n *\n * Make sure the input string is compatible with the standard found\n * at semver.org. Since this only uses 10-bit per major/minor/patch version,\n * the highest possible SemVer string would be 1023.1023.1023.\n * @param  {string} semVer SemVer string\n * @return {number}     Numeric version\n */\nexport const convertSemVerToInt = (semVer: string): number => {\n  // Split a given version string into three parts.\n  const parts = semVer.split(\".\").map((part) => Number(part));\n  // Check if we got exactly three parts, otherwise throw an error.\n  if (parts.length !== 3) {\n    throw new Error(`Received invalid version string: ${semVer}`);\n  }\n  // Make sure that no part is larger than 1023 or else it\n  // won't fit into a 32-bit integer.\n  parts.forEach((part: number) => {\n    if (part >= 1024) {\n      throw new Error(`Version string invalid, ${part} is too large`);\n    }\n  });\n  let numericVersion = 0;\n  // Shift all parts either 0, 10 or 20 bits to the left.\n  for (let i = 0; i < 3; i++) {\n    numericVersion |= parts[i] << i * 10;\n  }\n  return numericVersion;\n};\n\n/**\n * Converts a 32-bit integer into a semantic versioning (SemVer) compatible string.\n * @param  {number} version Numeric version\n * @return {string}   SemVer string\n */\nexport const convertIntToSemVer = (version: number): string => {\n  // Works by shifting the numeric version to the right and then masking it\n  // with 0b1111111111 (or 1023 in decimal).\n  // eslint-disable-next-line no-mixed-operators\n  return `${version & 1023}.${version >> 10 & 1023}.${version >> 20 & 1023}`;\n};\n","import { convertSemVerToInt } from \"utils/version\";\n\n// <MAJOR>.<MINOR>.<RELEASE>\n\nconst version = \"0.0.9\";\n\nexport default version;\nexport const asInt: number = convertSemVerToInt(version);\n","import * as PIXI from 'pixi.js';\nimport { IHitArea } from 'pixi.js';\n// Adapted from https://github.com/explooosion/hitarea-shapes/blob/master/src/index.js\n\nexport default class HitAreaShapes implements IHitArea {\n  public shapes: PIXI.Polygon[];\n\n  constructor(shapes: { [key: string]: { shape: number[]}[] } = {}, sprite = \"0\") {\n\n    this.shapes = shapes[sprite].map((definition: { shape: number[]; }) => {\n      const shape: number[] = definition.shape;\n      return new PIXI.Polygon(shape);\n    });\n  }\n\n  /**\n   * Called by hitArea\n   * @param {number} x\n   * @param {number} y\n   */\n  contains(x = 0, y = 0) {\n    return (!this.shapes || this.shapes.length === 0)\n    ? false\n    : this.shapes.some(shape => shape.contains(x, y));\n  }\n}\n","import React, { useState, useEffect } from 'react';\nimport { Structure } from 'definitions/structures';\nimport { Sprite, useApp, useTick } from '@inlet/react-pixi';\nimport HitAreaShapes from 'utils/pixiJs/hitAreaShapes';\nimport { STRUCTURE_HIGHLIGHT_FILTER } from 'components/town/TownView';\nimport { loadResource } from 'utils/pixiJs';\nimport { Point, Texture } from 'pixi.js';\n\nconst BLADE_ROTATION_SPEED = 0.01;\n\nexport interface Props {\n  onStructureClick: (structure: Structure | null) => void;\n  position: Point;\n  selected?: boolean;\n  hitAreaShapes: HitAreaShapes;\n}\n\nconst LumberMill = (props: Props) => {\n  const {hitAreaShapes} = props;\n  const structure: Structure = \"lumberMill\";\n  const atlas = `${process.env.PUBLIC_URL}/img/town/town-alpha/${structure}.json`;\n  const [textures, setTextures] = useState<{[name: string]: Texture}>();\n  const filters = props.selected ? [STRUCTURE_HIGHLIGHT_FILTER] : [];\n\n  const app = useApp();\n\n  useEffect(() => {\n    loadResource(atlas, (resource) => {\n      if (resource) {\n        setTextures(resource.textures);\n      }\n    })\n  }, [app, app.loader, atlas]);\n\n  const [rotation, setRotation] = useState(0);\n  useTick((delta:number | undefined) => setRotation(r => r + (BLADE_ROTATION_SPEED * (delta ?? 0))));\n\n\n  if (!textures) return null;\n  return (\n    <Sprite\n      name={structure}\n      position={props.position}\n      interactive={true}\n      buttonMode={true}\n      pointertap={() => {\n        props.onStructureClick(structure);\n      }}\n      hitArea={hitAreaShapes}\n      filters={filters}\n      texture={textures[\"structure.png\"]}\n    >\n      <Sprite\n        name=\"blades\"\n        texture={textures[\"blades.png\"]}\n        anchor={new Point(0.5, 0.5)}\n        x={15}\n        y={10}\n        rotation={rotation}\n      />\n    </Sprite>\n  )\n}\n\nexport default LumberMill;\n","import { PixiComponent, applyDefaultProps, Container } from \"@inlet/react-pixi\";\nimport * as PIXI  from 'pixi.js';\nimport * as particles from 'pixi-particles';\n\ninterface Props  {\n  image: string;\n  config: particles.OldEmitterConfig | particles.EmitterConfig;\n}\n\n\nconst ParticleEmitter = PixiComponent<Props & React.ComponentProps<typeof Container>, PIXI.ParticleContainer>(\"ParticleEmitter\", {\n  create: () => new PIXI.ParticleContainer(256, {}),\n\n  applyProps: (instance, oldProps: Props, newProps: Props) => {\n    const { image, config, ...newP } = newProps;\n\n    // apply rest props to PIXI.ParticleContainer\n    applyDefaultProps(instance, oldProps, newP);\n\n    const emitter = new particles.Emitter(\n      instance,\n      [PIXI.Texture.from(image)],\n      config\n    );\n\n    let elapsed = performance.now();\n\n    const tick = () => {\n      if (instance.destroyed) {\n        return;\n      }\n\n      const now = performance.now();\n      // const amp = Math.random() * 5 + 15;\n      // const amp = 15;\n      // const freq = 0.0015;\n      // emitter.acceleration.x = (Math.sin((elapsed * freq)) * amp) + 15;\n\n      emitter.update((now - elapsed) * 0.0003);\n\n      elapsed = now;\n      requestAnimationFrame(tick);\n    };\n    emitter.emit = true;\n    // emitter.update(00.2);\n\n    tick();\n  }\n});\n\nexport default ParticleEmitter;\n","import React from \"react\";\nimport { Sprite, Container } from '@inlet/react-pixi';\nimport { Structure } from 'definitions/structures';\nimport HitAreaShapes from 'utils/pixiJs/hitAreaShapes';\nimport smoke from './smoke.json';\nimport ParticleEmitter from 'components/pixi/ParticleEmitter';\nimport { STRUCTURE_HIGHLIGHT_FILTER } from 'components/town/TownView';\nimport { Point } from \"pixi.js\";\n\nexport interface Props {\n  onStructureClick: (structure: Structure | null) => void;\n  position: Point;\n  selected?: boolean;\n  hitAreaShapes: HitAreaShapes;\n}\n\nconst Tavern = (props: Props) => {\n  const {hitAreaShapes, position} = props;\n  const structure: Structure = \"tavern\";\n  const filters = props.selected ? [STRUCTURE_HIGHLIGHT_FILTER] : [];\n\n  return (\n    <Container position={position}>\n      <Sprite\n        name={structure}\n        interactive={true}\n        buttonMode={true}\n        pointertap={() => {\n          props.onStructureClick(structure);\n        }}\n        filters={filters}\n        hitArea={hitAreaShapes}\n        image={`${process.env.PUBLIC_URL}/img/town/town-alpha/${structure}.png`}\n      />\n      <ParticleEmitter\n        name=\"smoke\"\n        x={107}\n        y={-2}\n        image={`${process.env.PUBLIC_URL}/img/town/effects/smokeparticle.png`}\n        config={smoke}\n      />\n    </Container>\n  )\n}\nexport default Tavern;\n","import { AppContext } from \"components/App\";\nimport * as React from \"react\";\nimport { Component, ComponentType } from 'react';\n\n// Sharing context within the entire App\nexport interface AppContextProps {\n  onOpenWindow: (window: React.ReactElement) => void;\n  onCloseWindow: () => void;\n}\n\nexport const withAppContext = <TWrappedComponentProps extends AppContextProps>(WrappedComponent: ComponentType<TWrappedComponentProps>) => {\n  type WrappedComponentPropsExceptProvided = Exclude<keyof TWrappedComponentProps, keyof AppContextProps>;\n  type ForwardedProps = Pick<TWrappedComponentProps, WrappedComponentPropsExceptProvided>;\n  return class WithContext extends Component<ForwardedProps> {\n    public render() {\n      return (\n        <AppContext.Consumer>\n          { // eslint-disable-next-line @typescript-eslint/no-explicit-any\n           (context: any) => <WrappedComponent {...this.props } {...context} />}\n        </AppContext.Consumer>\n      );\n    }\n  };\n};\n","import { Structure } from 'definitions/structures';\nimport { Sprite } from '@inlet/react-pixi';\nimport HitAreaShapes from 'utils/pixiJs/hitAreaShapes';\nimport { STRUCTURE_HIGHLIGHT_FILTER } from 'components/town/TownView';\nimport { Point } from 'pixi.js';\n\nexport interface Props {\n  onStructureClick: (structure: Structure | null) => void;\n  position: Point;\n  selected?: boolean;\n  structure: Structure;\n  hitAreaShapes: HitAreaShapes;\n}\n\nconst Generic = (props: Props) => {\n  const {structure, position, hitAreaShapes, selected, onStructureClick} = props;\n  const filters = selected ? [STRUCTURE_HIGHLIGHT_FILTER] : [];\n\n  const handlePointerTap = () => {\n    onStructureClick(structure);\n  };\n\n  return (\n    <Sprite\n      name={structure}\n      position={position}\n      interactive={true}\n      buttonMode={true}\n      pointertap={handlePointerTap}\n      hitArea={hitAreaShapes}\n      filters={filters}\n      image={`${process.env.PUBLIC_URL}/img/town/town-alpha/${structure}.png`}\n    >\n      {/* <Graphics\n        name=\"hitarea\"\n        draw={graphics => {\n          graphics.beginFill(0xffffff);\n          hitAreaShapes.shapes.map(shape => graphics.drawPolygon(shape))\n          graphics.endFill();\n        }}\n      /> */}\n    </Sprite>\n  );\n}\nexport default Generic;\n","import React, { forwardRef, PropsWithChildren } from \"react\";\nimport { Viewport as PixiViewport } from \"pixi-viewport\";\nimport { PixiComponent, useApp } from \"@inlet/react-pixi\";\nimport gauntlet from \"components/App/styles/img/cursors/dwarven_gauntlet_extra_6.png\";\nimport { InteractionEvent, Application, Ticker } from \"pixi.js\";\n\ninterface Props {\n  onClick?(event: InteractionEvent): void;\n  screenWidth: number,\n  screenHeight: number,\n  worldWidth: number,\n  worldHeight: number,\n  minScale?: number;\n  maxScale?: number;\n}\n\n/** Viewport leverages pixi-viewport to create a pannable map\n * https://davidfig.github.io/pixi-viewport/jsdoc/\n */\nconst Viewport = forwardRef<PixiViewport, PropsWithChildren<Props>>((props, ref) => {\n  const app = useApp();\n  if (app) {\n    // Perhaps this is better moved somewhere else\n    const cursor = `url('${gauntlet}'), auto`;\n    app.renderer.plugins.interaction.cursorStyles.pointer = cursor;\n  }\n  return <PixiComponentViewport app={app} {...props} ref={ref} />;\n})\nViewport.displayName = 'DisplayName';\n\ninterface PixiComponentProps {\n  app: Application;\n}\n\nconst PixiComponentViewport = PixiComponent(\"Viewport\", {\n  create: (props: PixiComponentProps & Props) => {\n    const viewport = new PixiViewport({\n      screenWidth: props.screenWidth,\n      screenHeight: props.screenHeight,\n      worldWidth: props.worldWidth,\n      worldHeight: props.worldHeight,\n      ticker: Ticker.shared,\n      interaction: props.app.renderer.plugins.interaction,\n      // the interaction module is important for wheel to work properly when renderer.view is placed or scaled\n    });\n    viewport.on(\"clicked\", (event) => { if(props.onClick) props.onClick(event) });\n\n    const {\n      minScale = 1,\n      maxScale = 2\n    } = props;\n\n    viewport\n    .drag()\n    .pinch()\n    .wheel()\n    .clamp({ direction: 'all' })\n    .clampZoom({ minScale, maxScale })\n    .decelerate();\n\n    return viewport as unknown as PixiViewport;\n  },\n});\nexport default Viewport;\n","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAgCAYAAAABtRhCAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAB3RJTUUH3gMODzc3YHmYGgAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAE50lEQVRIx7WXW0wcVRjHfzO7y16YZbfAytACvbjU1hqkLVZMbbSXBEPUNjX6YDYanwYfTXzxrb7qm0lTJ018QhOjaWI0trFYbRoqpYVuwy2UpRS2lAF22YUdtuxt1ofKCIXShaZfMjm37+Q33zn/cxMURWHRVFXNAyiKIvCMTFwKO6Ne4ONPTpngZwoE6Lx6FYCDhwLPDLoMeKPtV8b6ewkEAssiVVU1v/gtLS+dhnUDFUUResZvUhLXuNF+ZVmkBw8F6B+4b5avXR8x82fUC+uCWhoaGsxCV1fXKZelGOvMNPcXspw9+zV60s3MzAweTwXJZBLJXYXPt8XMJ5NJbgX/pqGh4ctCgNalBUVRhId/u5tsQqf9UpDGxkZCoRCtra2mX2trK5qmAZhpoWZdrTIvCOyQihn8/RydsQSVm6uQJAnZ6zV9MjYbkUgEAL/fj6p+my9kOYmPViiKIgQn+8mLIv1jowSONtN0+OgyGEAkEkHXdTRNQ5Kkjal0qY3MJciLIsdOvslYXy9xbXxZu67rAEiSZOafCtgzfpM8Al2/deDEwJZOrYAu2lNFqKpq/rPjLTTtbWY0Psu1jovUVm7Hmk1jS6eYmXooEiH//0pYj3BWFc2RukM4HpxHMAz6x0aRvT1scfsYT0yTTwnEtXEsuQzxhbQ5j08F/O7H0+zz+ThQWsK52yGuBNs5XPcqllwOVzrOjv2HsZaXsuv1OtySnYSeort7kE+Vt56o1FWBo7EollwGQ7Sww13McHyWbE8n9VVVNLzWzMDkXSYGujl/uY1wNIamaciybO4+a0FXXRbd04P8PHydu/EYtmwaSy7NaCzOi0eO09F5kfk7/bhSSZ4T8zQ2NiLLMgCyLPPe+5+vudWtqlJFUYRF8MhsHNHIcXKnn86rfxK8P4Etk8G5kKR4YZ758F1OnDixrP9aUHGt8V6ExlMLbLP7GBoeAkGkxuWhKJfFlUoiJRNE7o0TCARM8UiS9NgjTnySqhRFEUZmR/jm5l9YsynGolG0RJQqpwd7OoU0P0dqZJD0TJyWlhZzU/D7/Txfe2wFVCxUzttLPNyaGEc0svx0+zZVW/cD4Eo/wJuIkevtwZiKLhteWZZXQAsGdk9PscluRzByODxlnL78Aw17mpDdZdizGUr0GNEbndRvKeeD5rcpLy83oRWVjeuLUFEUYTQ+jMfpwutw4CgpJVmzm6/++QVDtFDpLkU0DLxzUabbB6ir9vHGtp3mxi5JkhmluJ6zzONw/pfaMUSR0HyaL6530zYRBmBz7QFqj9YhSQ5efsXPQjxS2MJ/nJUUS8zEZ/G4nPSEQgyHLj08kCehtQuqy66w94/vEfIGNaVliEYGr6No40AAj9OBkDcYHmpb0RaO9hGO9lFdtodubQqAovQCG1IpgGgYlNlsbCqyrekXjvaZ+SlD3Dgwoc9hyWU4WP1SQf6lNbXouo6u6+ZtvmCgoihCcErDks2QCA3w4YF3ngjz+/1omsbkRMfG5nBkdoQ7bjeEe9hVVsZHe5u4FB7nXqTX9Kmvf5eKys3IskwwGGR4qG3ZW0VY+pgpxFRVze/zvcBWbylep5OMzY5hsVLsLiFd5MTqq+DedJRQKLQCtiHg0uv91k21uF1uPE4XhsVC1monlsqSmE8yOdGx6itsQ8BHwavN9+P6/Avf+1eTf20QhwAAAABJRU5ErkJggg==\"","import React from \"react\";\nimport { ReactReduxContext, Provider } from 'react-redux';\nimport { Stage } from '@inlet/react-pixi';\n\n// Contexts are not passed through the reconcilers with the new Context API.\n// This means we lose the redux context\n// Create a wrapper component that consumes the context and provides it again in the new reconciler context:\n// https://github.com/inlet/react-pixi/issues/77\nconst BridgedStage = (props: React.ComponentProps<typeof Stage>) => {\n  const { children, ...restProps } = props;\n  return (\n    <ReactReduxContext.Consumer>\n      {({ store }) => (\n        <Stage {...restProps}>\n          <Provider store={store}>\n            {children}\n          </Provider>\n        </Stage>\n      )}\n    </ReactReduxContext.Consumer>\n  );\n}\n\nexport default BridgedStage;\n","import { useRef, useEffect, PropsWithChildren, forwardRef, useImperativeHandle } from \"react\";\nimport { Sprite } from '@inlet/react-pixi';\nimport { Viewport as PixiViewport} from 'pixi-viewport';\nimport Viewport from 'components/pixi/Viewport';\nimport { gsap } from 'gsap';\nimport { GodrayFilter } from \"@pixi/filter-godray\";\nimport BridgedStage from \"components/pixi/util/BridgedStage\";\n\nexport interface Props {\n  screenWidth: number;\n  screenHeight: number;\n  worldWidth: number;\n  worldHeight: number;\n}\n\n\nconst TownStage = forwardRef<PixiViewport, PropsWithChildren<Props>>((props, ref: React.Ref<PixiViewport>) => {\n  const {\n    children,\n    /* eslint-disable react/prop-types */\n    screenWidth,\n    screenHeight,\n    worldWidth,\n    worldHeight\n    /* eslint-enable react/prop-types */\n  } = props;\n\n  const innerRef = useRef<PixiViewport>(null);\n\n  useImperativeHandle(ref, () => {\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    return innerRef.current!\n  });\n\n\n  useEffect(() => {\n    godray.enabled = false;\n    if(innerRef.current) {\n\n      const viewport = innerRef.current;\n      viewport.on(\"moved\", () => {\n        const horizontalFactor = gsap.utils.normalize(viewport.screenWidth, worldWidth, viewport.right);\n        const verticalFactor = gsap.utils.normalize(worldHeight, viewport.screenHeight, viewport.bottom);\n        const factor = Math.max(horizontalFactor * verticalFactor - .4, 0);\n\n        godray.gain =  factor;\n        godray.lacunarity = 2.4;\n        godray.enabled = godray.gain > 0;\n      })\n    }\n\n    const onScroll = (e: WheelEvent) => {\n      // Scrolling the mouse is just used for zoom, not for actual scrolling\n      e.preventDefault();\n    }\n    window.addEventListener(\"wheel\", onScroll, {passive: false});\n    return () => {\n      window.removeEventListener(\"wheel\", onScroll);\n    };\n  }, [worldHeight, worldWidth]);\n\n  return (\n    <BridgedStage width={screenWidth} height={screenHeight} options={options} >\n      <Viewport\n        screenWidth={screenWidth}\n        screenHeight={screenHeight}\n        worldWidth={worldWidth}\n        worldHeight={worldHeight}\n        ref={innerRef}>\n        <Sprite\n          name=\"background\"\n          image={`${process.env.PUBLIC_URL}/img/town/town-alpha/background.png`}\n          filters={[godray]}\n        >\n          {children}\n        </Sprite>\n      </Viewport>\n    </BridgedStage>\n\n  )\n});\nTownStage.displayName = \"TownStage\";\n\nexport default TownStage;\n\nconst options = {\n  autoDensity: true,\n  sharedLoader: true\n}\n\nexport const godray = new GodrayFilter();\n","import { ItemType } from \"definitions/items/types\";\nimport { ResourceStoreState } from \"store/types/resources\";\nimport { ProducableItem } from \"store/types/structure\";\nimport { CostStoreState } from \"../production/types\";\n\nexport enum StructureType {\n  resource,\n  production,\n  tavern,\n  warehouse,\n}\n\nexport interface StructureDefinition {\n  type: StructureType;\n  cost: CostStoreState;\n  levels: StructureLevelDefinition[];\n}\n\nexport interface StructureLevelDefinition {\n  displayName: string;      // At this moment we can potentially support different names depending on the level\n                            // of the structure. But this is not implemented because I feel it can cause confusion\n  cost: CostStoreState;     //\n  workerCapacity: number;   // number of workers that can work at this structure at this level\n}\n\nexport interface ResourceStructureDefinition extends StructureDefinition {\n  levels: ResourceStructureLevelDefinition[];\n}\n\ninterface HarvestDefinition {\n  amount: number;\n  lootTable: {[key in ItemType]?: number};\n}\n\nexport interface ResourceStructureLevelDefinition extends StructureLevelDefinition {\n  generates: ResourceStoreState;\n  harvest?: HarvestDefinition;\n}\n\nexport interface ProductionStructureDefinition extends StructureDefinition {\n  levels: ProductionStructureLevelDefinition[];\n}\n\nexport interface ProductionStructureLevelDefinition extends StructureLevelDefinition {\n  unlocks: ProducableItem[];\n}\n\nexport interface WarehouseStructureDefinition extends StructureDefinition {\n  levels: WarehouseStructureLevelDefinition[];\n}\n\nexport interface WarehouseStructureLevelDefinition extends StructureLevelDefinition {\n  maxResources: ResourceStoreState;\n  maxStockpile: number;\n}\n\nexport interface TavernStructureDefinition extends StructureDefinition {\n  levels: TavernStructureLevelDefinition[];\n}\n\nexport interface TavernStructureLevelDefinition extends StructureLevelDefinition {\n  rooms: number;\n}\n","import { Sprite, useTick } from '@inlet/react-pixi';\nimport React, { useState } from 'react';\n\ninterface Props {\n    worldWidth: number;\n    speed?: number;\n}\n\nconst Clouds = (props: Props) => {\n    const { speed = 1 } = props;\n    const [cloud, setCloud] = useState(randomCloud());\n    const image = `${process.env.PUBLIC_URL}/img/town/clouds/cloud-0${cloud}.png`;\n    const [x, setX] = useState(-2000);\n    const [y, setY] = useState(randomY());\n\n    useTick((delta:number | undefined) => {\n        if (x > props.worldWidth){\n            setX(2000 - Math.random() * 1000);\n            setY(randomY());\n            setCloud(randomCloud());\n        } else {\n            setX(x + speed * (delta || 1));\n        }\n    });\n\n    return (\n        <Sprite\n            // name={`cloud ${cloud}`}\n            image={image}\n            alpha={0.8}\n            x={x}\n            y={y}\n        />\n    );\n}\n\nexport default Clouds;\n\nconst randomCloud = () => Math.floor(Math.random() * 2) + 1;\nconst randomY = () => Math.random() * -300 - 200;","import { ONE_MINUTE, TWO_MINUTES } from 'utils/format/time';\nimport { ProductionStructureDefinition, StructureType } from \"./types\";\n\nconst alchemist: ProductionStructureDefinition = {\n    type: StructureType.production,\n    cost: {\n        gold: 40,\n        time: 4000,\n    },\n    levels: [{\n        displayName: \"structure-alchemist-name\",\n        // level 1:\n        workerCapacity: 2,\n        cost: {\n            gold: 0,\n        },\n        unlocks: [],\n    }, {\n        // level 2:\n        displayName: \"structure-alchemist-name\",\n        workerCapacity: 5,\n        cost: {\n            gold: 30,\n            resources: {\n                wood: 100,\n                iron: 100,\n                stone: 100\n            },\n            time: ONE_MINUTE\n        },\n        unlocks: [],\n    }, {\n        // level 3:\n        displayName: \"structure-alchemist-name\",\n        workerCapacity: 10,\n        cost: {\n             gold: 50,\n             time: TWO_MINUTES\n        },\n        unlocks: [],\n    }],\n};\n\nexport default alchemist;\n","export enum Resource {\n  wood = \"wood\",\n  iron = \"iron\",\n  stone = \"stone\",\n  leather = \"leather\",\n  fabric = \"fabric\",\n  food = \"food\",\n}\n\n\nexport interface ResourceDefinition {\n  resource: Resource;\n  iconImg: string;\n}\n\nconst all = {\n  [Resource.wood]: {\n    resource: Resource.wood,\n    iconImg: \"/img/resources/wood.png\",\n  },\n  [Resource.iron]: {\n    resource: Resource.iron,\n    iconImg: \"/img/resources/iron.png\",\n  },\n  [Resource.stone]: {\n    resource: Resource.stone,\n    iconImg: \"/img/resources/stone.png\",\n  },\n  [Resource.leather]: {\n    resource: Resource.leather,\n    iconImg: \"/img/resources/leather.png\",\n  },\n  [Resource.fabric]: {\n    resource: Resource.fabric,\n    iconImg: \"/img/resources/fabric.png\",\n  },\n  [Resource.food]: {\n    resource: Resource.food,\n    iconImg: \"/img/resources/food.png\",\n  },\n};\n\nexport default all;\n","import { ProductionStructureDefinition, StructureType } from \"./types\";\nimport { ONE_MINUTE, TWO_MINUTES } from 'utils/format/time';\n\nconst armoursmith: ProductionStructureDefinition = {\n    cost: {\n        gold: 40,\n        time: 4000,\n    },\n    type: StructureType.production,\n    levels: [{\n        // level 1:\n        displayName: \"structure-armoursmith-name\",\n        workerCapacity: 2,\n        cost: {\n            gold: 0,\n        },\n        unlocks: [\"apparel/boots1\" ],\n    }, {\n        // level 2:\n        displayName: \"structure-armoursmith-name\",\n        workerCapacity: 5,\n        cost: {\n            gold: 30,\n            resources: {\n                wood: 100,\n                iron: 100,\n                stone: 100\n            },\n            time: ONE_MINUTE\n        },\n        unlocks: [\"apparel/chest\" ],\n    }, {\n        // level 3:\n        displayName: \"structure-armoursmith-name\",\n        workerCapacity: 10,\n        cost: {\n            gold: 50,\n            time: TWO_MINUTES\n        },\n        unlocks: [\"apparel/cowl\"],\n    }],\n};\nexport default armoursmith;\n","import { ONE_MINUTE, TWO_MINUTES } from 'utils/format/time';\nimport { ResourceStructureDefinition, StructureType } from \"./types\";\n\nconst garden: ResourceStructureDefinition = {\n  type: StructureType.resource,\n  cost: {\n    gold: 40,\n    time: 4000,\n  },\n  levels: [{\n    displayName: \"structure-garden-name\",\n    // level 1:\n    workerCapacity: 2,\n    cost: {\n      gold: 0,\n    },\n    generates: { food: 2 },\n    harvest: {\n      amount: 3,\n      lootTable: {\n        \"herb/bogroot\": 2,\n        \"herb/winterWeed\": 1\n      }\n    }\n  }, {\n    displayName: \"structure-garden-name\",\n    // level 2:\n    workerCapacity: 5,\n    cost: {\n      gold: 30,\n      resources: {\n        wood: 100,\n        iron: 100,\n        stone: 100\n      },\n      time: ONE_MINUTE\n    },\n    generates: { food: 4 },\n    harvest: {\n      amount: 5,\n      lootTable: {\n        \"herb/bogroot\": 2,\n        \"herb/winterWeed\": 1,\n        \"herb/hyacinthus\": 1, \n        \"herb/bloodLotus\": 1, \n      }\n    }\n  }, {\n    // level 3:\n    displayName: \"structure-garden-name\",\n    workerCapacity: 10,\n    cost: {\n      gold: 50,\n      time: TWO_MINUTES\n    },\n    generates: { food: 8 },\n  }],\n};\n\nexport default garden;\n","import { ResourceStructureDefinition, StructureType } from \"./types\";\nimport { HALF_HOUR, ONE_MINUTE, TWO_MINUTES } from 'utils/format/time';\n\nconst lumberMill: ResourceStructureDefinition = {\n  type: StructureType.resource,\n  cost: {\n    gold: 31,\n    time: HALF_HOUR,\n  },\n  levels: [{\n    // level 0:\n    displayName: \"structure-lumber-mill-name\",\n    workerCapacity: 2,\n    cost: {\n      gold: 0,\n    },\n    generates: { wood: 2 },\n  }, {\n    // level 1:\n    displayName: \"structure-lumber-mill-name\",\n    workerCapacity: 5,\n    cost: {\n      gold: 30,\n      resources: {\n        wood: 100,\n        iron: 100,\n        stone: 100\n      },\n      time: ONE_MINUTE\n    },\n    generates: { wood: 2 },\n  }, {\n    // level 2:\n    displayName: \"structure-lumber-mill-name\",\n    workerCapacity: 10,\n    cost: {\n      gold: 50,\n      time: TWO_MINUTES\n    },\n    generates: { wood: 2 },\n  }],\n};\n\nexport default lumberMill;\n","import { ONE_MINUTE, TWO_MINUTES } from 'utils/format/time';\nimport { ResourceStructureDefinition, StructureType } from \"./types\";\n\nconst mine: ResourceStructureDefinition = {\n  cost: {\n    gold: 40,\n    time: 4000,\n  },\n  type: StructureType.resource,\n  levels: [{\n    displayName: \"structure-mine-name\",\n    // level 0:\n    workerCapacity: 2,\n    cost: {\n      gold: 0,\n    },\n    generates: { iron: 2 },   \n    harvest: {\n      amount: 3,\n      lootTable: {\n        \"mineral/roseQuartz\": 2,\n        \"mineral/topaz\": 1\n      }\n    }\n  }, {\n    displayName: \"structure-mine-name\",\n    // level 1:\n    workerCapacity: 5,\n    cost: {\n      gold: 30,\n      resources: {\n        wood: 100,\n        iron: 100,\n        stone: 100\n      },\n      time: ONE_MINUTE\n    },\n    generates: { iron: 2 },\n    harvest: {\n      amount: 5,\n      lootTable: {\n        \"mineral/roseQuartz\": 2,\n        \"mineral/topaz\": 2,\n        \"mineral/jasper\": 1,\n        \"mineral/greenOpal\": 1,\n      }\n    }\n  }, {\n    displayName: \"structure-mine-name\",\n    // level 2:\n    workerCapacity: 10,\n    cost: {\n      gold: 50,\n      time: TWO_MINUTES\n    },\n    generates: { iron: 2 },\n    harvest: {\n      amount: 5,\n      lootTable: {\n        \"mineral/roseQuartz\": 1,\n        \"mineral/topaz\": 1,\n        \"mineral/jasper\": 1,\n        \"mineral/greenOpal\": 1,\n        \"mineral/malachite\": 1,\n        \"mineral/tigersEye\": 1,\n      }\n    }\n  }],\n};\nexport default mine;\n","import { ONE_MINUTE, TWO_MINUTES } from 'utils/format/time';\nimport { ResourceStructureDefinition, StructureType } from \"./types\";\n\nconst quarry: ResourceStructureDefinition = {\n  cost: {\n    gold: 40,\n    time: 4000,\n  },\n  type: StructureType.resource,\n  levels: [{\n    displayName: \"structure-quarry-name\",\n    // level 1:\n    workerCapacity: 2,\n    cost: {\n      gold: 0,\n    },\n    generates: { stone: 2 },\n  }, {\n    // level 2:\n    displayName: \"structure-quarry-name\",\n    workerCapacity: 5,\n    cost: {\n      gold: 30,\n      resources: {\n        wood: 100,\n        iron: 100,\n        stone: 100\n      },\n      time: ONE_MINUTE\n    },\n    generates: { stone: 4 },\n  }, {\n    // level 3:\n    displayName: \"structure-quarry-name\",\n    workerCapacity: 10,\n    cost: {\n      gold: 50,\n      time: TWO_MINUTES\n    },\n    generates: { stone: 6 },\n  }],\n};\n\nexport default quarry;\n","import { ONE_MINUTE, TWO_MINUTES } from 'utils/format/time';\nimport { ResourceStructureDefinition, StructureType } from \"./types\";\n\nconst tannery: ResourceStructureDefinition = {\n  cost: {\n    gold: 40,\n    time: 4000,\n  },\n  type: StructureType.resource,\n  levels: [{\n    displayName: \"structure-tannery-name\",\n    // level 1:\n    workerCapacity: 2,\n    cost: {\n      gold: 0,\n    },\n    generates: { leather: 2 },\n  }, {\n    // level 2:\n    displayName: \"structure-tannery-name\",\n    workerCapacity: 5,\n    cost: {\n      gold: 30,\n      resources: {\n        wood: 100,\n        iron: 100,\n        stone: 100\n      },\n      time: ONE_MINUTE\n    },\n    generates: { leather: 5 },\n  }, {\n    // level 3:\n    displayName: \"structure-tannery-name\",\n    workerCapacity: 10,\n    cost: {\n      gold: 50,\n      time: TWO_MINUTES\n    },\n    generates: { leather: 7 },\n  }],\n};\n\nexport default tannery;\n","import { ONE_MINUTE, TWO_MINUTES } from 'utils/format/time';\nimport { StructureType, TavernStructureDefinition } from \"./types\";\n\nconst tavern: TavernStructureDefinition = {\n  cost: {\n    gold: 40,\n    time: 4000,\n  },\n  type: StructureType.tavern,\n  levels: [{\n    displayName: \"structure-tavern-name\",\n    // level 1:\n    workerCapacity: 2,\n    cost: {\n       gold: 0,\n    },\n    rooms: 10,\n  }, {\n    // level 2:\n    displayName: \"structure-tavern-name\",\n    workerCapacity: 5,\n    cost: {\n      gold: 30,\n      resources: {\n        wood: 100,\n        iron: 100,\n        stone: 100\n      },\n      time: ONE_MINUTE\n    },\n    rooms: 12,\n  }, {\n    // level 3:\n    displayName: \"structure-tavern-name\",\n    workerCapacity: 10,\n    cost: {\n       gold: 50,\n       time: TWO_MINUTES\n    },\n    rooms: 15,\n  }],\n};\n\nexport default tavern;\n","import { FOUR_MINUTES, TWO_MINUTES } from 'utils/format/time';\nimport {  StructureType, WarehouseStructureDefinition } from \"./types\";\n\nconst warehouse: WarehouseStructureDefinition = {\n  cost: {\n    gold: 40,\n    time: 4000,\n  },\n  type: StructureType.warehouse,\n  levels: [{\n    displayName: \"structure-warehouse-name\",\n    // level 1:\n    workerCapacity: 2,\n    cost: {\n      gold: 0,\n    },\n    maxResources: {\n      fabric: 200,\n      food: 200,\n      iron: 200,\n      leather: 200,\n      stone: 200,\n      wood: 200,\n    },\n    maxStockpile: 16\n  }, {\n    // level 2:\n    displayName: \"structure-warehouse-name\",\n    workerCapacity: 5,\n    cost: {\n      gold: 13,\n      resources: {\n        wood: 100,\n        iron: 100,\n        stone: 100\n      },\n      time: FOUR_MINUTES\n    },\n    maxResources: {\n      fabric: 500,\n      food: 500,\n      iron: 500,\n      leather: 500,\n      stone: 500,\n      wood: 500,\n    },\n    maxStockpile: 32\n  }, {\n    // level 3:\n    displayName: \"structure-warehouse-name\",\n    workerCapacity: 10,\n    cost: {\n      gold: 50,\n      resources: {\n        wood: 200,\n        iron: 200,\n        stone: 200\n      },\n      time: TWO_MINUTES * 5\n    },\n    maxResources: {\n      fabric: 1000,\n      food: 1000,\n      iron: 1000,\n      leather: 1000,\n      stone: 1000,\n      wood: 1000,\n    },\n    maxStockpile: 48\n  }],\n};\n\nexport default warehouse;\n","import { ProductionStructureDefinition, StructureType } from \"./types\";\nimport { ONE_MINUTE, THREE_MINUTES, TWO_MINUTES } from 'utils/format/time';\n\nconst weaponsmith: ProductionStructureDefinition = {\n  type: StructureType.production,\n  cost: {\n    gold: 40,\n    time: 4000,\n  },\n  levels: [{\n    // level 1:\n    displayName: \"structure-weaponsmith-name\",\n    workerCapacity: 2,\n    cost: {\n      gold: 0,\n    },\n    unlocks: [],\n  }, {\n    // level 2:\n    displayName: \"structure-weaponsmith-name\",\n    workerCapacity: 5,\n    cost: {\n      gold: 30,\n      resources: {\n        wood: 100,\n        iron: 100,\n        stone: 100\n      },\n      time: ONE_MINUTE\n    },\n    unlocks: [],\n  }, {\n    // level 3:\n    displayName: \"structure-weaponsmith-name\",\n    workerCapacity: 10,\n    cost: {\n      gold: 50,\n      time: TWO_MINUTES\n\n    },\n    unlocks: [],\n  }, {\n    // level 4:\n    displayName: \"structure-weaponsmith-name\",\n    workerCapacity: 14,\n    cost: {\n      gold: 50,\n      time: THREE_MINUTES\n    },\n    unlocks: [\"weapon/poisonedDagger\"],\n  }],\n};\nexport default weaponsmith;\n","import { ONE_MINUTE, THREE_MINUTES } from 'utils/format/time';\nimport { ResourceStructureDefinition, StructureType } from \"./types\";\n\nconst weaver: ResourceStructureDefinition = {\n  cost: {\n    gold: 40,\n    time: 4000,\n  },\n  type: StructureType.resource,\n  levels: [{\n    displayName: \"structure-weaver-name\",\n    // level 0:\n    workerCapacity: 2,\n    cost: {\n      gold: 0,\n    },\n    generates: { fabric: 2 },\n  }, {\n    displayName: \"structure-weaver-name\",\n    // level 1:\n    workerCapacity: 5,\n    cost: {\n      gold: 30,\n      resources: {\n        wood: 100,\n        iron: 100,\n        stone: 100\n      },\n      time: ONE_MINUTE\n    },\n    generates: { fabric: 5 },\n  }, {\n    displayName: \"structure-weaver-name\",\n    // level 2:\n    workerCapacity: 10,\n    cost: {\n      gold: 50,\n      time: THREE_MINUTES\n    },\n    generates: { fabric: 7 },\n  }],\n};\n\nexport default weaver;\n","import { ONE_MINUTE, THREE_MINUTES, TWO_MINUTES } from 'utils/format/time';\nimport { ProductionStructureDefinition, StructureType } from \"./types\";\n\nconst workshop: ProductionStructureDefinition = {\n  type: StructureType.production,\n  cost: {\n    gold: 40,\n    time: 4000,\n  },\n  levels: [{\n    // level 1:\n    displayName: \"structure-workshop-name\",\n    workerCapacity: 2,\n    cost: {\n      gold: 0,\n    },\n    unlocks: [ ],\n  }, {\n    // level 2:\n    displayName: \"structure-workshop-name\",\n    workerCapacity: 5,\n    cost: {\n      gold: 30,\n      resources: {\n        wood: 100,\n        iron: 100,\n        stone: 100\n      },\n      time: ONE_MINUTE\n    },\n    unlocks: [],\n  }, {\n    // level 3:\n    displayName: \"structure-workshop-name\",\n    workerCapacity: 10,\n    cost: {\n      gold: 50,\n      time: TWO_MINUTES\n    },\n    unlocks: [],\n  }, {\n    // level 4:\n    displayName: \"structure-workshop-name\",\n    workerCapacity: 14,\n    cost: {\n      gold: 50,\n      time: THREE_MINUTES\n    },\n    unlocks: [],\n  }],\n};\nexport default workshop;\n","import alchemist from \"./alchemist\";\nimport armoursmith from \"./armoursmith\";\nimport garden from \"./garden\";\nimport lumberMill from \"./lumberMill\";\nimport mine from \"./mine\";\nimport quarry from \"./quarry\";\nimport tannery from \"./tannery\";\nimport tavern from \"./tavern\";\nimport { StructureDefinition } from \"./types\";\nimport warehouse from \"./warehouse\";\nimport weaponsmith from \"./weaponsmith\";\nimport weaver from \"./weaver\";\nimport workshop from \"./workshop\";\nimport { Resource } from 'definitions/resources';\n\nexport type Structure =\n  \"alchemist\" |\n  \"armoursmith\" |\n  \"garden\" |\n  \"lumberMill\" |\n  \"mine\" |\n  \"quarry\" |\n  \"tavern\" |\n  \"tannery\" |\n  \"warehouse\" |\n  \"weaponsmith\" |\n  \"weaver\" |\n  \"workshop\";\n\n\nexport type ProductionStructure = \"alchemist\" | \"armoursmith\" | \"weaponsmith\" | \"workshop\";\nexport type ResourceStructure = \"garden\" | \"lumberMill\" | \"mine\" | \"quarry\" | \"tannery\" | \"weaver\";\n\n// Type guard\nexport const isProductionStructure = (structure: Structure): structure is ProductionStructure => {\n  return structure === \"alchemist\" ||\n    structure === \"armoursmith\" ||\n    structure === \"weaponsmith\" ||\n    structure === \"workshop\";\n}\n// Type guard\nexport const isResourceStructure = (structure: Structure): structure is ResourceStructure => {\n  return structure === \"garden\" ||\n    structure === \"lumberMill\" ||\n    structure === \"mine\" ||\n    structure === \"quarry\" ||\n    structure === \"tannery\" ||\n    structure === \"weaver\";\n}\nconst all = {\n  alchemist,\n  armoursmith,\n  garden,\n  lumberMill,\n  mine,\n  quarry,\n  tavern,\n  tannery,\n  warehouse,\n  weaponsmith,\n  weaver,\n  workshop,\n};\n\nexport default all;\n\nexport function getDefinition<T extends StructureDefinition>(structure: Structure): T {\n  return all[structure] as unknown as T;\n}\n\n\n\nexport function getStructureByResource(resource: Resource) : Structure {\n  switch (resource) {\n    case Resource.fabric:\n      return \"weaver\";\n    case Resource.food:\n      return \"garden\";\n    case Resource.iron:\n      return \"mine\";\n    case Resource.leather:\n      return \"tannery\";\n    case Resource.stone:\n      return \"quarry\";\n    case Resource.wood:\n      return \"lumberMill\";\n  }\n}\n","import { useCallback } from 'react';\nimport { StoreState } from 'store/types';\nimport { useSelector } from 'react-redux';\nimport { StructureStoreState } from 'store/types/structure';\nimport { getDefinition, Structure  } from \"definitions/structures\";\nimport { StructureDefinition, StructureLevelDefinition } from 'definitions/structures/types';\n\n// Returns the structure state from redux store\nexport const useStructureState = <T extends StructureStoreState>(structure: Structure): T => {\n  const structureSelector = useCallback(\n    (state: StoreState) => state.structures[structure] as T,\n    [structure]\n  );\n  return useSelector<StoreState, T>(structureSelector);\n}\n\nexport const useStructureDefinition = <T extends StructureDefinition>(structure: Structure): T => {\n  const structureDefinition = getDefinition<T>(structure);\n  if (!structureDefinition) {\n    throw new Error(`No definition found for structure ${structure}.`);\n  }\n  return structureDefinition\n}\n\nexport const useStructureLevel = <T extends StructureLevelDefinition>(structure: Structure): T => {\n  const { level } = useStructureState(structure);\n  const structureDefinition = useStructureDefinition(structure)\n  return structureDefinition.levels[level] as T;\n}\n","import * as React from \"react\";\nimport { PropsWithChildren } from 'react';\nimport './styles/button.scss';\n\nexport enum ButtonSize {\n  auto, // will select either medium or small, depending on screen size\n  large,\n  medium,\n  small,\n}\n\nexport enum ButtonColor {\n  blue = \"blue\",\n  purple = \"purple\",\n  green = \"green\"\n}\n\nexport type Props = PropsWithChildren<{\n  text?: string;\n  color?: ButtonColor | keyof typeof ButtonColor; // Can use enum or string\n  size?: ButtonSize | keyof typeof ButtonSize; // Can use enum or string\n  className?: string;\n  disabled?: boolean;\n  square?: boolean;\n  onClick?: React.MouseEventHandler<Element>;\n}>\n\n\nconst Button = (props: React.ComponentProps<'button'> & Props) => {\n  const { color, square, text, ...otherProps } = props;\n\n  const handleClick = (e: React.MouseEvent<HTMLButtonElement>) => {\n    props.onClick?.(e)\n  };\n\n  const className = [\n    'button',\n    (props.className ?? \"\"),\n    `button-${typeof color === \"string\" ? color : ButtonColor[color ?? ButtonColor.blue]}`,\n    `button-${typeof props.size === \"string\" ? props.size : ButtonSize[props.size ?? ButtonSize.auto]}`,\n    `${square ? \"button-square\" : ''}`\n  ]\n\n  return (\n    <button\n      {...otherProps}\n      className={className.join(' ')}\n      onClick={handleClick}\n    >\n      <span>\n        {!!text && text}\n        {!text && props.children}\n      </span>\n    </button>\n  );\n};\n\nexport default Button;\n","import React, { useRef } from 'react';\nimport \"./styles/progressbar.scss\";\n\nexport enum Direction {\n    increasing,\n    decreasing\n}\n\nexport interface Props {\n    progress?: number;     // between 0 and 1\n    label?: string;\n    className?: string;\n    direction?: Direction; // only used to prevent the bar from animating back to the start state\n    animationTime?: number;\n    variation?: \"normal\" | \"health\"\n}\n\nconst PlainProgressbar = (props: Props) => {\n    const { className = \"\", animationTime, variation = \"normal\" } = props;\n    const previousProgress = useRef(0);\n    const progress: number = clamp(props.progress || 0, 0, 1);\n\n    previousProgress.current = progress;\n    return (\n        <div className={`progressbar progressbar--variation-${variation} ${className}`}>\n            <div className=\"progressbar-label\">{props.label}</div>\n            <div className=\"progressbar-bar\" style={{\n                width: `${progress * 100}%`,\n                ...(animationTime && {transition: `width ${animationTime}ms linear`})\n            }}/>\n        </div>\n    );\n};\n\nexport default PlainProgressbar;\n\nfunction clamp(val: number, min: number, max: number): number {\n    return val > max ? max : val < min ? min : val;\n}\n","import * as React from \"react\";\nimport { SoundManager} from 'global/SoundManager';\nimport Button from '../buttons/Button';\nimport { PropsWithChildren, useEffect } from \"react\";\n\n// todo: refactor using WindowManager [30/03/2020]\nexport interface Props {\n    title: string;\n    backEnabled?: boolean;\n    closeEnabled?: boolean;\n    onClose?: () => void;\n    onBack?: () => void;\n}\n\n/**\n *\n */\nconst Window = (props: PropsWithChildren<Props>) => {\n\n    const handleClose = (_e: React.MouseEvent) => {\n        if (props.onClose) {\n            props?.onClose();\n\n            SoundManager.playSound(\"ui/buttonClick\");\n        }\n    };\n\n    const handleBack = (_e: React.MouseEvent) => {\n        if (props.onBack) {\n            props?.onBack();\n\n            SoundManager.playSound(\"ui/buttonClick\");\n        }\n    };\n\n    useEffect(() => {\n        SoundManager.musicFiltered = true;\n        return () => {\n            SoundManager.musicFiltered = false;\n        }\n    })\n\n    return (\n        <div className=\"window\">\n            <div className=\"header\">\n                { props.backEnabled !== false && (\n                    <Button\n                        className=\"back-button\"\n                        onClick={handleBack}\n                        square={true}\n                        size={\"medium\"}\n                        color=\"purple\"\n                        text=\"<\"\n                    />\n                )}\n                <h3>{ props.title }</h3>\n                { props.closeEnabled !== false && (\n                    <Button\n                        className=\"close-button\"\n                        onClick={handleClose}\n                        square={true}\n                        size={\"medium\"}\n                        color=\"purple\"\n                        text=\"x\"\n                    />\n                )}\n            </div>\n            { props.children }\n        </div>\n    );\n};\n\nexport default Window;\n","import Window, { Props } from \"components/ui/window/Window\";\nimport * as React from \"react\";\nimport \"components/ui/window/styles/window.scss\";\n\nexport const withWindow = <TWrappedComponentProps extends Props>(WrappedComponent: React.ComponentType<TWrappedComponentProps>) => {\n  return class WithWindow extends React.Component<TWrappedComponentProps> {\n\n    public render() {\n      return <Window { ...this.props } >\n        <WrappedComponent { ...this.props } />\n      </Window>;\n    }\n  };\n};\n","\nimport { StoreState } from 'store/types';\nimport { useSelector } from 'react-redux';\nimport { EngineStoreState } from 'store/types/engine';\n\n// Returns the 'engine' part from redux store\nexport const useEngine = () => {\n    return useSelector<StoreState, EngineStoreState>(store => store.engine);\n}\n\nexport const useDelta = () => {\n    const engine = useEngine();\n    return Date.now() - engine.previousTick;\n}","import * as React from \"react\";\nimport { useDelta } from 'hooks/store/engine';\nimport { useEffect, useState } from 'react';\nimport PlainProgressbar from \"./PlainProgressbar\";\nimport usePrevious from \"hooks/usePrevious\";\n\nexport enum Direction {\n    increasing,\n    decreasing\n}\n\nexport interface Props {\n    progress: number;     // between 0 and 1\n    label?: string;\n    className?: string;\n    direction?: Direction; // only used to prevent the bar from animating back to the start state\n    animate?: boolean;\n}\n\nconst TickingProgressbar = (props: Props) => {\n    const { className = \"\", label, direction, progress = 0} = props;\n    const previousProgress = usePrevious(progress) || 0;\n    // We use the delta time since last tick to animate\n    const delta = useDelta();\n\n    // If we have a direction defined and we're going the other direction, dont animate\n    // because we've basically reset the progress bar and we just want to animate in one direction\n    const [animate, setAnimate] = useState(false);\n\n    useEffect(() => {\n        setAnimate(\n             direction === undefined ||\n            (direction === Direction.increasing && progress > previousProgress) ||\n            (direction === Direction.decreasing && progress < previousProgress)\n        );\n    }, [direction, progress]); // see https://github.com/facebook/react/issues/20752\n\n    // previousProgress.current = progress;\n    return (\n        <PlainProgressbar\n            progress={progress}\n            label={label}\n            className={className}\n            animationTime={animate ? delta : 0}\n        />\n    );\n};\n\nexport default TickingProgressbar;\n","import { useEffect, useRef } from \"react\";\n\nconst usePrevious = <T>(value: T): T|undefined => {\n  const ref = useRef<T>();\n  useEffect(() => {\n    ref.current = value;\n  }, [value]);\n  return ref.current;\n};\nexport default usePrevious;\n","import { ReactNode } from 'react';\nimport { ItemType } from \"definitions/items/types\";\nimport { WeaponType } from 'definitions/items/weapons';\nimport { TraitDefinition } from 'definitions/traits/types';\nimport { ActorObject } from 'store/types/scene';\nimport { Effect } from 'definitions/effects/types';\nimport { ExtendedAttribute } from 'mechanics/adventurers/attributes';\n\n// Things that can be shown on the ContextPopup\nexport enum ContextType {\n  actor,\n  attribute,\n  component,\n  item,\n  resource,\n  skill,\n  tempEffect,\n  trait,\n}\n\nexport type ContextInfo = ItemType | TraitDefinition | WeaponType | string | ReactNode | ExtendedAttribute | ActorObject | Effect;\n","import { createSelector } from \"reselect\";\nimport { StoreState } from \"store/types\";\nimport { TasksStoreState } from 'store/types/tasks';\nimport { Structure } from 'definitions/structures';\n\nconst getTasks = (state: StoreState) => state.tasks;\n\n/*\n * Returns a selector for the store that selects all crafting tasks running for given structure */\nexport const createSelectCraftingTasksByStructure = (structure: Structure) => {\n  const craftingTasksByStructure = (tasks: TasksStoreState) => {\n    return tasks.running.filter((val) => val.origin === `${structure}.craft`);\n  };\n  return createSelector([\n    getTasks],\n    craftingTasksByStructure,\n  );\n}\n\n/*\n * Returns a selector for the store that selects all study tasks running for given structure */\nexport const createSelectStudyingTasksByStructure = (structure: Structure) => {\n  const studyingTasksByStructure = (tasks: TasksStoreState) => {\n    return tasks.running.filter((val) => val.origin === `${structure}.study`);\n  };\n  return createSelector([\n    getTasks],\n    studyingTasksByStructure,\n  );\n}\n\n/*\n * Returns a selector for the store that selects all upgrade tasks running for given structure\n * Typically 0 or 1 */\nexport const createSelectUpgradeTasksByStructure = (structure: Structure) => {\n  const upgradeTasksByStructure = (tasks: TasksStoreState) => {\n    return tasks.running.filter((val) => val.name === `${structure}.upgrade`);\n  };\n  return createSelector([\n    getTasks],\n    upgradeTasksByStructure,\n  );\n}\n","import { useSelector } from 'react-redux';\nimport { TasksStoreState } from 'store/types/tasks';\nimport { createSelectCraftingTasksByStructure, createSelectStudyingTasksByStructure, createSelectUpgradeTasksByStructure } from 'store/selectors/tasks';\nimport { Structure } from 'definitions/structures';\nimport { StoreState } from 'store/types';\n\n// Returns all the tasks from redux store\nexport const useTasksState = () => {\n  return useSelector<StoreState, TasksStoreState>(store => store.tasks);\n}\n\n// Returns all running crafting tasks for given structure\nexport const useCraftingTasksStateByStructure = (structure: Structure) => {\n  return useSelector(createSelectCraftingTasksByStructure(structure));\n}\n\n// Returns all running crafting tasks for given structure\nexport const useStudyingTasksStateByStructure = (structure: Structure) => {\n  return useSelector(createSelectStudyingTasksByStructure(structure));\n}\n\n// Returns all running update tasks for given structure\nexport const useUpgradeTasksStateByStructure = (structure: Structure) => {\n  return useSelector(createSelectUpgradeTasksByStructure(structure));\n}\n\n","import { Structure } from 'definitions/structures';\nimport \"./styles/structureViewHeader.scss\";\n\ninterface Props {\n  structure: Structure;\n}\n\nconst StructureViewHeader = (props: Props) => {\n  // const displayName = TextManager.getStructureName(props.structure);\n  return (\n    <div className={`structureview-header structureview-header-${props.structure}`}>\n      {/* <h1 className=\"app-h1-white\">{displayName}</h1> */}\n    </div>\n  );\n}\n\nexport default StructureViewHeader;\n","import Icon, { IconSize, IconSizeType } from \"components/ui/common/Icon\";\nimport * as React from \"react\";\nimport { PropsWithChildren } from 'react';\nimport './styles/iconButton.scss';\n\nexport type Props = PropsWithChildren<{\n  iconImg: string;\n  size?: IconSizeType; // Can use enum or string\n}>\n\n\nconst IconButton = (props: React.ComponentProps<'button'> & Props) => {\n  const { iconImg, children, ...otherProps } = props;\n\n  const className = [\n    'icon-button',\n    (props.className ?? \"\"),\n    `size-${typeof props.size === \"string\" ? props.size : IconSize[props.size ?? IconSize.medium]}`,\n  ]\n\n  return (\n    <button\n      {...otherProps}\n      className={className.join(' ')}\n    >\n      <Icon\n        image={iconImg}\n        size={props.size}\n      />\n      { children && (\n        <div className=\"text\">\n          {children}\n        </div>\n      )}\n    </button>\n  );\n};\n\nexport default IconButton;\n","import { TextManager } from 'global/TextManager';\nimport { Structure } from 'definitions/structures';\nimport { useStructureDefinition, useStructureState } from 'hooks/store/structures';\nimport Button from 'components/ui/buttons/Button';\nimport { useUpgradeTasksStateByStructure } from 'hooks/store/useTasksState';\nimport { formatDuration } from 'utils/format/time';\nimport { TickingProgressbar } from \"components/ui/common/progress\";\nimport { reduceTime } from \"store/actions/game\";\nimport { useDispatch } from \"react-redux\";\nimport IconButton from \"components/ui/buttons/IconButton\";\nimport \"./styles/structureLevel.scss\";\n\nexport interface Props {\n  structure: Structure;\n  onHelpClicked?: (e: React.MouseEvent) => void;\n}\n\nconst StructureLevel = (props: Props) => {\n  const {\n    structure,\n    onHelpClicked,\n  } = props;\n  const dispatch = useDispatch();\n  const structureState = useStructureState(structure);\n  const level: number = structureState.level;\n  const structureDefinition = useStructureDefinition(structure);\n\n  const nextLevel = structureDefinition.levels[level + 1];\n  const upgradeText = nextLevel == null ? TextManager.get(\"ui-structure-upgrade-max\") : TextManager.get(\"ui-structure-upgrade\", { level: level + 2 });\n\n  const upgradeTasks = useUpgradeTasksStateByStructure(structure);\n  const handleReduceTime50 = () => {\n    if (!upgradeTasks.length) return;\n    dispatch(reduceTime(50, \"task\", upgradeTasks[0].name))\n  }\n\n  if (upgradeTasks.length) {\n    const t = upgradeTasks[0];\n    return (\n      <div className=\"upgrade-progress-container\">\n        <TickingProgressbar\n          key={`${t.name}${t.startTime}`}\n          className=\"upgrading\"\n          label={`${TextManager.get(\"structure-upgrade-button-upgrading\")} (${formatDuration(t.timeRemaining)})`}\n          progress={t.progress}\n        />\n        <IconButton iconImg=\"/img/ui/misc/clock.png\" size=\"smallest\" onClick={handleReduceTime50}>50%</IconButton>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"upgrade-stucture-button\">\n      <label>\n        {TextManager.get(\"ui-structure-level\")}\n        { level + 1 }\n      </label>\n      <Button\n        className=\"upgrade\"\n        onClick={onHelpClicked}\n        disabled={nextLevel == null}\n      >\n        { upgradeText }\n      </Button>\n    </div>\n  );\n};\n\nexport default StructureLevel;\n","import { ContextInfo, ContextType } from 'constants/context';\nimport { ItemSource } from 'constants/items';\nimport deepEquals from 'deep-equal';\nimport EventEmitter from \"events\";\nimport TypedEmitter from \"typed-emitter\";\n\nexport interface Context {\n  type: ContextType;\n  info: ContextInfo;\n  source?: ItemSource;\n  referenceRect: DOMRect;\n  className?: string;\n}\n\nexport const EVENT_CONTEXT_UPDATED = \"tooltipContextUpdated\";\ninterface TooltipEvents {\n  [EVENT_CONTEXT_UPDATED]: (context: Context | undefined) => void;\n}\n\nexport class TooltipManager extends (EventEmitter as new () => TypedEmitter<TooltipEvents>) {\n  private static _instance = new TooltipManager();\n  private static lastContext: Context | undefined;\n\n  // Note you probably want to call event.stopPropagation() after calling this\n  static showContextTooltip (type: ContextType, info: ContextInfo, originRect: DOMRect, className?: string, source?: ItemSource) {\n    const context = { type, info, referenceRect: originRect, className, source };\n\n    if (deepEquals(context, this.lastContext)) {\n      this.clear();\n    } else {\n      this.instance.emit(EVENT_CONTEXT_UPDATED, context);\n      this.lastContext = context;\n    }\n  }\n\n  static clear() {\n    this.instance.emit(EVENT_CONTEXT_UPDATED, undefined);\n    this.lastContext = undefined;\n  }\n\n  static get instance() {\n    return this._instance;\n  }\n}\n","import { AnyAction } from \"redux\";\n\nexport enum TaskType {\n  buildStructure,\n  upgradeStructure,\n  craftItem,\n  studyItem\n}\n\nexport interface TaskStoreState {\n  type: TaskType;\n  name: string;\n  origin: string;\n  startTime: number;    // time the task was scheduled\n  lastTick: number;     // time of last tick\n  timeRemaining: number;\n  progress: number;     // value between 0 and 1 indicating progress\n  callbacks: AnyAction[];\t  // actions to dispatch on complete\n}\n","import * as React from \"react\";\nimport { ContextType } from \"constants/context\";\nimport { ItemSource, Rarity } from \"constants/items\";\nimport { getDefinition } from \"definitions/items\";\nimport { Item } from \"definitions/items/types\";\nimport { TooltipManager } from 'global/TooltipManager';\nimport Icon, { IconSize } from 'components/ui/common/Icon';\nimport \"./styles/itemIcon.scss\";\n\nexport interface Props {\n  item: Item;\n  onClick?: (event: React.MouseEvent) => void;\n  size?: IconSize;\n  showContext?: boolean;\n  source?: ItemSource;\n}\n\nconst ItemIcon = (props: Props) => {\n  const { item, size, source } = props;\n  const itemDefinition = getDefinition(item.type);\n\n  if (!itemDefinition) {\n    throw `could not find definition for ${item}`;\n  }\n\n  const handleClick = (event: React.MouseEvent) => {\n    if (props.showContext !== false) {\n      const origin = (event.currentTarget as HTMLElement);\n      const originRect = origin.getBoundingClientRect();\n      TooltipManager.showContextTooltip(ContextType.item, item, originRect, undefined, source);\n      event.stopPropagation();\n    }\n\n    if (props.onClick) {\n      props.onClick(event);\n    }\n  };\n\n  const className = `item-icon ${getIconClassName(itemDefinition.rarity)} ${sizeClassName(size)}`;\n\n  return (\n    <div className={className}>\n      <Icon\n        image={itemDefinition.iconImg}\n        size={props.size}\n        onClick={handleClick}\n      />\n      {item.quantity && item.quantity > 1 && (\n        <div className=\"quantity\">{item.quantity}</div>\n      )}\n    </div>\n  );\n};\n\nexport default ItemIcon;\n\n\nconst getIconClassName = (rarity?: Rarity): string => {\n  switch (rarity) {\n    case Rarity.common:\n      return \"item-icon-common\";\n    case Rarity.uncommon:\n      return \"item-icon-uncommon\";\n    case Rarity.rare:\n      return \"item-icon-rare\";\n    case Rarity.epic:\n      return \"item-icon-epic\";\n    case Rarity.legendary:\n      return \"item-icon-legendary\";\n  }\n  return getIconClassName(Rarity.common);\n};\n\nconst sizeClassName = (size?: IconSize): string => {\n  switch (size) {\n    case IconSize.smallest:\n      return \"item-icon-size-smallest\";\n    case IconSize.small:\n      return \"item-icon-size-small\";\n    case IconSize.medium:\n      return \"item-icon-size-medium\";\n    case IconSize.big:\n      return \"item-icon-size-big\";\n    case IconSize.biggest:\n      return \"item-icon-size-biggest\";\n  }\n  return sizeClassName(IconSize.medium);\n};\n","// Todo: come up with a less retarded name\nimport * as React from \"react\";\nimport \"./styles/updownvalue.scss\";\n\nexport interface DispatchProps {\n    onUp?: (e: React.MouseEvent) => void;\n    onDown?: (e: React.MouseEvent) => void;\n}\nexport interface Props extends DispatchProps {\n    label?: string;\n    value?: number;\n    max?: number;\n    upDisabled?: boolean;\n    downDisabled?: boolean;\n}\n\nconst UpDownValue = (props: Props) => {\n    const handleUp = (e: React.MouseEvent) => {\n        if (props.onUp && !props.upDisabled) { props.onUp(e); }\n    };\n\n    const handleDown = (e: React.MouseEvent) => {\n        if (props.onDown && !props.downDisabled) { props.onDown(e); }\n    };\n\n    let displayValue;\n    if (props.max == null) {\n        displayValue = props.value;\n    } else {\n        displayValue = <span>\n            { props.value } / <span className=\"max\">{ props.max }</span>\n        </span>;\n    }\n    return (\n        <div className=\"updownvalue\">\n            <label> { props.label }</label>\n            { displayValue }\n            <i className= { \"arrow up\" + (props.upDisabled ? \" disabled\" : \"\" )}\n                onClick= { handleUp }\n            />\n            <i className={\"arrow down\" + (props.downDisabled ? \" disabled\" : \"\")}\n                onClick= { handleDown }\n            />\n        </div>\n    );\n};\n\nexport default UpDownValue;\n","\nimport { StoreState } from 'store/types';\nimport { useSelector } from 'react-redux';\nimport { StockpileStoreState } from 'store/types/stockpile';\nimport { useMemo } from 'react';\nimport { ItemType } from 'definitions/items/types';\n\n// Returns the stockpile of items grouped into itemCategory\nexport const useStockpileState = () => {\n  return useSelector<StoreState, StockpileStoreState>(state => state.stockpile);\n}\n\nexport const useStockpileStateFlat = (): ItemType[] => {\n  const stockpile = useStockpileState();\n  return useMemo(() => {\n    const all = Object.values(stockpile).flat()\n    return all;\n  }, [stockpile])\n}\n","import { getDefinition } from \"definitions/items\";\nimport { ItemType } from \"definitions/items/types\";\nimport { TextManager } from \"global/TextManager\";\nimport { useMemo } from 'react';\nimport Icon from 'components/ui/common/Icon';\nimport { useStockpileStateFlat } from \"hooks/store/stockpile\";\nimport \"./styles/itemsBox.scss\";\n\nexport interface Props {\n  className?: string;\n  items: ItemType[];\n\n   // itemsInInventory?: Item[]; // Items that are in `items` array and also in inventory\n}\n\n\n/**\n * The ItemsBox displays a list of items, to be used as requirements for something\n */\nconst ItemsBox = (props: Props) => {\n  const { items } = props;\n  const className = (props.className || \"\") + \" items-box\";\n  const aggregate = items.reduce<{[key: string]: number}>((acc, value) => {\n    if (!acc[value]) {\n      acc[value] = 0;\n    }\n    acc[value]++;\n    return acc;\n  }, {});\n\n  const stockpile = useStockpileStateFlat();\n  const itemsInInventory: ItemType[] = useMemo(() => {\n    const tmpWarehouse = [ ...stockpile];\n    const tmpItems: ItemType[] = [];\n    items.forEach((item: ItemType) => {\n      const found = tmpWarehouse.findIndex((i) => i === item);\n      if (found > -1) {\n        // Remove the item from tmpWarehouse and add to itemsInInventory\n        const [ removed ] = tmpWarehouse.splice(found, 1);\n        if (removed) {\n          tmpItems.push(removed);\n        }\n      }\n    });\n    return tmpItems;\n  }, [items, stockpile]);\n\n\n  const listItems = Object.keys(aggregate).map((key: string) => {\n    const item = key as ItemType;\n    const amount = aggregate[key] as number;\n    let listItemClass = \"item\";\n\n    // Check if we have enough\n    const amountInInventory = itemsInInventory ? itemsInInventory.filter((i) => i === item).length : 0;\n    if (amount > amountInInventory) {\n      listItemClass += \" missing\";\n    }\n    const itemDescription = getDefinition(item);\n    return (\n      <li className={listItemClass} key={item}>\n        <Icon\n          image={itemDescription.iconImg}\n          size=\"smallest\"\n        />\n        <div className=\"name\">\n          { `${TextManager.getItemName(item)} (${ amount })` }\n        </div>\n      </li>\n    );\n  });\n\n  return (\n    <ul className={className} >\n      {listItems}\n    </ul>\n  );\n};\n\nexport default ItemsBox;\n","import { getDefinition } from \"definitions/structures\";\nimport { WarehouseStructureDefinition, WarehouseStructureLevelDefinition } from \"definitions/structures/types\";\nimport { createSelector } from 'reselect';\nimport { StoreState } from \"store/types\";\n\nconst getWarehouseLevel = (state: StoreState) => {\n  return state.structures[\"warehouse\"].level;\n}\n\n\nconst maxResources = (level: number) => {\n  const structureDefinition = getDefinition<WarehouseStructureDefinition>(\"warehouse\");\n  const levelDefinition: WarehouseStructureLevelDefinition = structureDefinition.levels[level];\n  return levelDefinition.maxResources;\n}\n\n// Selects a ResourceStoreState with maximum stockpile of each resource the warehouse supports\nexport const selectMaxResources = createSelector([\n  getWarehouseLevel],\n  maxResources,\n);","import { StoreState } from 'store/types';\nimport { useSelector } from 'react-redux';\nimport { ResourceStoreState } from 'store/types/resources';\nimport { selectMaxResources } from 'store/selectors/resources';\n\n// Returns the resources from the warehouse\nexport const useResourcesState = () => {\n  return useSelector<StoreState, ResourceStoreState>(store => store.resources);\n}\n\n// Returns the maximum of each resource that the warehouse can hold\nexport const useMaxResourcesState = () => {\n  return useSelector<StoreState, ResourceStoreState>(selectMaxResources);\n}\n","import { StoreState } from 'store/types';\nimport { useSelector } from 'react-redux';\n\n// Returns the gold from redux store\nconst useGoldState = () => {\n  return useSelector<StoreState, number>(store => store.gold);\n}\n\nexport default useGoldState;\n","import { Resource } from \"definitions/resources\";\nimport resourceDescriptions from \"definitions/resources\";\nimport * as React from \"react\";\nimport { ResourceStoreState } from \"store/types/resources\";\nimport { TextManager } from \"global/TextManager\";\nimport { useMemo } from 'react';\nimport { useResourcesState } from 'hooks/store/resources';\nimport Icon from 'components/ui/common/Icon';\nimport { ContextType } from 'constants/context';\nimport { TooltipManager } from 'global/TooltipManager';\nimport useGoldState from \"hooks/store/useGoldState\";\nimport \"./styles/resourcesCost.scss\";\n\nexport interface Props {\n  className?: string;\n  resources: ResourceStoreState;\n  gold?: number;\n}\n\n/**\n *\n */\nconst ResourcesCost = (props: Props) => {\n  const {\n    resources,\n    gold\n  } = props;\n\n  const storeResources = useResourcesState();\n\n  const sufficientResources = useMemo(() => {\n    return Object.keys(resources).reduce<{[key: string]: boolean}>((acc, value) => {\n      const resource = value as Resource;\n      // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n      acc[value] = storeResources[resource]! >= resources[resource]!;\n      return acc;\n    }, {});\n  }, [resources, storeResources]);\n  const availableGold = useGoldState();\n  const sufficientGold = gold === undefined || availableGold >= gold;\n\n  const className = (props.className || \"\") + \" resources-cost\";\n  const listItems = Object.keys(props.resources).map((key: string) => {\n    const resource = key as Resource;\n    let listItemClass = \"resource\";\n    if (sufficientResources && !sufficientResources[resource]) {\n      listItemClass += \" insufficient\";\n    }\n    const resourceDescription = resourceDescriptions[resource];\n    if (!resourceDescription) {\n      throw new Error(`No resource description found for ${resource}`);\n    }\n\n    const handleClick = (event: React.MouseEvent) => {\n\n      const origin = (event.currentTarget as HTMLElement);\n      const originRect = origin.getBoundingClientRect();\n      TooltipManager.showContextTooltip(ContextType.resource, resource, originRect);\n      event.stopPropagation();\n    };\n\n    return (\n      <li\n        className={listItemClass}\n        key={resource}\n      >\n        <Icon\n          image={resourceDescription.iconImg}\n          size=\"smallest\"\n          onClick={handleClick}\n        />\n        <div className=\"name\">\n          {TextManager.getResourceName(resource as Resource)}\n        </div>\n        <div className=\"amount\" >\n          { props.resources[resource] }\n        </div>\n      </li>\n    );\n  });\n\n  return (\n    <ul className={className}>\n      {listItems}\n      {gold && (\n        <li className={[\"gold\", ...(sufficientGold ? [] : [\"insufficient\"])].join(\" \")}>\n          <Icon\n            image=\"img/resources/gold.png\"\n            size=\"smallest\"\n          />\n          <div className=\"name\">\n            {TextManager.get(\"resource-gold-name\")}\n          </div>\n          <div className=\"amount\" >\n            { gold }\n          </div>\n        </li>\n      )}\n    </ul>\n  );\n};\n\nexport default ResourcesCost;\n","import { Structure } from \"definitions/structures\";\nimport { createSelector } from \"reselect\";\nimport { StoreState } from \"store/types\";\nimport { StructureStoreState } from \"store/types/structure\";\nimport { StructuresStoreState } from \"store/types/structures\";\n\nconst getStructures = (state: StoreState) => state.structures;\nconst getWorkers = (state: StoreState) => state.workers;\n\nconst calculateFreeWorkers = (structures: StructuresStoreState, workers: number) => {\n    // Add up all the workers used by all structures in town\n    const workersUsed = Object.keys(structures).map((name) => structures[name as Structure])\n        .reduce((acc: number, value: StructureStoreState) => acc += value.workers, 0);\n\n    return workers - workersUsed;\n};\n\nexport const selectFreeWorkers = createSelector([\n    getStructures,\n    getWorkers],\n    calculateFreeWorkers,\n);\n","import { StoreState } from 'store/types';\nimport { useSelector } from 'react-redux';\nimport { selectFreeWorkers } from 'store/selectors/workers';\n\n// Returns all the workers from redux store\nexport const useWorkersState = () => {\n  return useSelector<StoreState, number>(store => store.workers);\n}\n\n// Returns all the workers not working on something from redux store\nexport const useWorkersFreeState = () => {\n  return useSelector<StoreState, number>(selectFreeWorkers);\n}\n\n","export const MAX_WORKERS_CRAFTING = 6;\n\n/**\n * Calculates the production time for productionDefinition with given amount of workers\n * @param productionDefinition\n * @param workers\n */\nexport const calculateProductionTime = (time: number, workers: number): number => {\n    if (workers > MAX_WORKERS_CRAFTING) {\n        throw new Error(`Cannot possibly have more than ${MAX_WORKERS_CRAFTING} on one item!`);\n    }\n    // Each additional worker shaves off 10% of the production time\n    return time - (.1 * time * (workers - 1));\n};\n","\nimport { Weapon } from \"definitions/items/weapons\";\nimport * as time from \"utils/format/time\";\nimport { ProductionDefinition } from \"./types\";\n\nconst weaponsmithProduction: {[key in Weapon]?: ProductionDefinition} = {\n  \"weapon/aegisOfValor\": {\n    item: { type: \"weapon/aegisOfValor\" },\n    levelRequired: 3,\n    cost: {\n      resources: { wood: 20, iron: 5 },\n      time: time.HALF_HOUR,\n    },\n  },\n  \"weapon/arbalest\": {\n    item: { type: \"weapon/arbalest\" },\n    cost: {\n      resources: { wood: 20, iron: 5 },\n      time: time.HALF_HOUR,\n    },\n  },\n  \"weapon/battleAxe\": {\n    item: { type: \"weapon/battleAxe\" },\n    cost: {\n      resources: { wood: 20, iron: 5 },\n      time: time.HALF_HOUR,\n    },\n  },\n  \"weapon/berserkerShield\": {\n    item: { type: \"weapon/berserkerShield\" },\n    levelRequired: 2,\n    cost: {\n      resources: { wood: 20, iron: 5 },\n      time: time.HALF_HOUR,\n    },\n  },\n  \"weapon/brassKnuckles\": {\n    item: { type: \"weapon/brassKnuckles\" },\n    cost: {\n      resources: { wood: 20, iron: 5 },\n      time: time.HALF_HOUR,\n    },\n  },\n  \"weapon/simpleCrossbow\": {\n    item: { type: \"weapon/simpleCrossbow\" },\n    cost: {\n      resources: { wood: 20, iron: 5 },\n      time: time.HALF_HOUR,\n    },\n  },\n  \"weapon/cleaver\": {\n    item: { type: \"weapon/cleaver\" },\n    cost: {\n      resources: { wood: 10, iron: 15 },\n      time: time.HALF_HOUR,\n    },\n  },\n  \"weapon/club\": {\n    item: { type: \"weapon/club\" },\n    cost: {\n      resources: { wood: 30,},\n      time: time.HALF_HOUR,\n    },\n  },\n  \"weapon/dagger\": {\n    item: { type: \"weapon/dagger\" },\n    cost: {\n      resources: { wood: 10, iron: 10},\n      time: time.ONE_HOUR,\n    },\n  },\n  \"weapon/flail\": {\n    item: { type: \"weapon/flail\" },\n    cost: {\n      resources: { wood: 10, iron: 10},\n      time: time.ONE_HOUR,\n    },\n  },\n  \"weapon/goldenShield\": {\n    item: { type: \"weapon/goldenShield\" },\n    levelRequired: 2,\n    cost: {\n      resources: { wood: 20, iron: 5 },\n      time: time.HALF_HOUR,\n    },\n  },\n  \"weapon/javelin\": {\n    item: { type: \"weapon/javelin\" },\n    cost: {\n      resources: { wood: 20, iron: 10},\n      time: time.ONE_HOUR + time.HALF_HOUR,\n    },\n  },\n  \"weapon/khopesh\": {\n    item: { type: \"weapon/khopesh\" },\n    cost: {\n      resources: { wood: 15, iron: 40},\n      time:  time.TWO_MINUTES,\n    },\n  },\n  \"weapon/longbow\": {\n    item: { type: \"weapon/longbow\" },\n    cost: {\n      resources: { wood: 40, iron: 5},\n      time: time.ONE_HOUR,\n    },\n  },\n  \"weapon/mace\": {\n    item: { type: \"weapon/mace\" },\n    cost: {\n      resources: { wood: 15, iron: 10},\n      time: time.ONE_HOUR,\n    },\n  },\n  \"weapon/morningStar\": {\n    item: { type: \"weapon/morningStar\" },\n    cost: {\n      resources: { wood: 15, iron: 15},\n      time: time.ONE_HOUR,\n    },\n  },\n  \"weapon/paintedBuckler\": {\n    item: { type: \"weapon/paintedBuckler\" },\n    cost: {\n      resources: { wood: 20, iron: 10},\n      time: time.ONE_HOUR + time.HALF_HOUR,\n    },\n  },\n  \"weapon/poisonedDagger\": {\n    item: { type: \"weapon/poisonedDagger\" },\n    cost: {\n      resources: { wood: 50, iron: 15},\n      materials: [ \"material/poisonVial\" ],\n      time: time.ONE_HOUR,\n    },\n  },\n  \"weapon/ravenStaff\": {\n    item: { type: \"weapon/ravenStaff\" },\n    cost: {\n      resources: { wood: 15, iron: 10, food: 5},\n      time: time.ONE_HOUR,\n    },\n  },\n  \"weapon/savageStaff\": {\n    item: { type: \"weapon/savageStaff\" },\n    cost: {\n      resources: { wood: 15, iron: 10, food: 5},\n      time: time.ONE_HOUR,\n    },\n  },\n  \"weapon/spear\": {\n    item: { type: \"weapon/spear\" },\n    cost: {\n      resources: { wood: 15, iron: 15},\n      time: time.ONE_HOUR,\n    },\n  },\n  \"weapon/steelShield\": {\n    item: { type: \"weapon/steelShield\" },\n    cost: {\n      resources: { wood: 15, iron: 15},\n      time: time.ONE_HOUR,\n    },\n  },\n  \"weapon/steelSword\": {\n    item: { type: \"weapon/steelSword\" },\n    cost: {\n      resources: { wood: 10, iron: 30},\n      time:  time.ONE_HOUR,\n    },\n  },\n  \"weapon/warhammer\": {\n    item: { type: \"weapon/warhammer\" },\n    cost: {\n      resources: { wood: 10, iron: 30},\n      time:  time.ONE_HOUR,\n    },\n  },\n  \"weapon/woodenBulwark\": {\n    item: { type: \"weapon/woodenBulwark\" },\n    cost: {\n      resources: { wood: 10, iron: 30},\n      time:  time.ONE_HOUR,\n    },\n  },\n};\nexport default weaponsmithProduction;\n\nexport const getDefinition = (item: Weapon) => {\n  return weaponsmithProduction[item];\n}\n","import { Apparel } from \"definitions/items/apparel\";\nimport * as time from \"utils/format/time\";\nimport {  ProductionDefinition } from \"./types\";\n\n// todo: real values for costs\nconst armoursmithProduction: { [key in Apparel]?: ProductionDefinition } = {\n  \"apparel/boots1\": {\n    item: { type: \"apparel/boots1\" },\n    cost: {\n      resources: {\n        wood: 10,\n        iron: 45\n      },\n      time: time.ONE_HOUR,\n    },\n  },\n  \"apparel/boots2\": {\n    item: { type: \"apparel/boots2\" },\n    cost: {\n      resources: {\n        wood: 10,\n        iron: 45\n      },\n      time: time.ONE_HOUR,\n    },\n    levelRequired: 2\n  },\n  \"apparel/boots3\": {\n    item: { type: \"apparel/boots3\" },\n    cost: {\n      resources: {\n        wood: 10,\n        iron: 45\n      },\n      time: time.ONE_HOUR,\n    },\n    levelRequired: 3\n  },\n  \"apparel/chainmailHood\": {\n    item: { type: \"apparel/chainmailHood\" },\n    cost: {\n      resources: {\n        wood: 10,\n        iron: 45\n      },\n      time: time.ONE_HOUR,\n    }\n  },\n  \"apparel/chest\": {\n    item: { type: \"apparel/chest\" },\n    cost: {\n      resources: {\n        wood: 10,\n        iron: 45\n      },\n      time: time.ONE_HOUR,\n    }\n  },\n  \"apparel/clothGloves\": {\n    item: { type: \"apparel/clothGloves\" },\n    cost: {\n      resources: {\n        wood: 10,\n        iron: 45\n      },\n      time: time.ONE_HOUR,\n    },\n  },\n  \"apparel/cowl\": {\n    item: { type: \"apparel/cowl\" },\n    cost: {\n      resources: {\n        wood: 10,\n        iron: 45\n      },\n      time: time.ONE_HOUR,\n    }\n  },\n  \"apparel/druidChest\": {\n    item: { type: \"apparel/druidHands\" },\n    cost: {\n      resources: {\n        wood: 10,\n        iron: 45\n      },\n      time: time.ONE_HOUR,\n    },\n    levelRequired: 2\n  },\n  \"apparel/druidFeet\": {\n    item: { type: \"apparel/druidFeet\" },\n    cost: {\n      resources: {\n        wood: 10,\n        iron: 45\n      },\n      time: time.ONE_HOUR,\n    },\n    levelRequired: 2\n  },\n  \"apparel/druidHands\": {\n    item: { type: \"apparel/druidHands\" },\n    cost: {\n      resources: {\n        wood: 10,\n        iron: 45\n      },\n      time: time.ONE_HOUR,\n    },\n    levelRequired: 2\n  },\n  \"apparel/druidHead\": {\n    item: { type: \"apparel/druidHead\" },\n    cost: {\n      resources: {\n        wood: 10,\n        iron: 45\n      },\n      time: time.ONE_HOUR,\n    },\n    levelRequired: 2\n  },\n  \"apparel/druidLegs\": {\n    item: { type: \"apparel/druidLegs\" },\n    cost: {\n      resources: {\n        wood: 10,\n        iron: 45\n      },\n      time: time.ONE_HOUR,\n    },\n    levelRequired: 2\n  },\n  \"apparel/fedora\": {\n    item: { type: \"apparel/fedora\" },\n    cost: {\n      resources: {\n        wood: 10,\n        iron: 45\n      },\n      time: time.ONE_HOUR,\n    }\n  },\n  \"apparel/greaves1\": {\n    item: { type: \"apparel/greaves1\" },\n    cost: {\n      resources: {\n        wood: 10,\n        iron: 45\n      },\n      time: time.ONE_HOUR,\n    }\n  },\n  \"apparel/greaves2\": {\n    item: { type: \"apparel/greaves2\" },\n    cost: {\n      resources: {\n        wood: 10,\n        iron: 45\n      },\n      time: time.ONE_HOUR,\n    }\n  },\n  \"apparel/hornedHelmet\": {\n    item: { type: \"apparel/hornedHelmet\" },\n    cost: {\n      resources: {\n        wood: 10,\n        iron: 45\n      },\n      time: time.ONE_HOUR,\n    }\n  },\n  \"apparel/leatherGloves\": {\n    item: { type: \"apparel/leatherGloves\" },\n    cost: {\n      resources: {\n        wood: 10,\n        iron: 45\n      },\n      time: time.ONE_HOUR,\n    }\n  },\n  \"apparel/nomadHelmet\": {\n    item: { type: \"apparel/nomadHelmet\" },\n    cost: {\n      resources: {\n        wood: 10,\n        iron: 45\n      },\n      time: time.ONE_HOUR,\n    }\n  },\n  \"apparel/pants1\": {\n    item: { type: \"apparel/pants1\" },\n    cost: {\n      resources: {\n        wood: 10,\n        iron: 45\n      },\n      time: time.ONE_HOUR,\n    }\n  },\n  \"apparel/pants2\": {\n    item: { type: \"apparel/pants2\" },\n    cost: {\n      resources: {\n        wood: 10,\n        iron: 45\n      },\n      time: time.ONE_HOUR,\n    }\n  },\n  \"apparel/plateChest1\": {\n    item: { type: \"apparel/plateChest1\" },\n    cost: {\n      resources: {\n        wood: 10,\n        iron: 45\n      },\n      time: time.ONE_HOUR,\n    }\n  },\n  \"apparel/plateChest2\": {\n    item: { type: \"apparel/plateChest2\" },\n    cost: {\n      resources: {\n        wood: 10,\n        iron: 45\n      },\n      time: time.ONE_HOUR,\n    }\n  },\n  \"apparel/plateChest3\": {\n    item: { type: \"apparel/plateChest3\" },\n    cost: {\n      resources: {\n        wood: 10,\n        iron: 45\n      },\n      time: time.ONE_HOUR,\n    }\n  },\n  \"apparel/plateChest4\": {\n    item: { type: \"apparel/plateChest4\" },\n    cost: {\n      resources: {\n        wood: 10,\n        iron: 45\n      },\n      time: time.ONE_HOUR,\n    }\n  },\n  \"apparel/plateGloves1\": {\n    item: { type: \"apparel/plateGloves1\" },\n    cost: {\n      resources: {\n        wood: 10,\n        iron: 45\n      },\n      time: time.ONE_HOUR,\n    }\n  },\n  \"apparel/plateGloves2\": {\n    item: { type: \"apparel/plateGloves2\" },\n    cost: {\n      resources: {\n        wood: 10,\n        iron: 45\n      },\n      time: time.ONE_HOUR,\n    }\n  },\n  \"apparel/plateHelmet\": {\n    item: { type: \"apparel/plateHelmet\" },\n    cost: {\n      resources: {\n        wood: 10,\n        iron: 45\n      },\n      time: time.ONE_HOUR,\n    }\n  },\n  \"apparel/platePants\": {\n    item: { type: \"apparel/platePants\" },\n    cost: {\n      resources: {\n        wood: 10,\n        iron: 45\n      },\n      time: time.ONE_HOUR,\n    }\n  },\n  \"apparel/plateShoulders1\": {\n    item: { type: \"apparel/plateShoulders1\" },\n    cost: {\n      resources: {\n        wood: 10,\n        iron: 45\n      },\n      time: time.ONE_HOUR,\n    }\n  },\n  \"apparel/plateShoulders2\": {\n    item: { type: \"apparel/plateShoulders2\" },\n    cost: {\n      resources: {\n        wood: 10,\n        iron: 45\n      },\n      time: time.ONE_HOUR,\n    },\n  },\n  \"apparel/robe\": {\n    item: { type: \"apparel/robe\" },\n    cost: {\n      resources: { wood: 10, iron: 45},\n      time: time.ONE_HOUR,\n    }\n  },\n  \"apparel/shoulders1\": {\n    item: { type: \"apparel/shoulders1\" },\n    cost: {\n      resources: { wood: 10, iron: 45},\n      time: time.ONE_HOUR,\n    }\n\n  },\n  \"apparel/shoulders2\": {\n    item: { type: \"apparel/shoulders2\" },\n    cost: {\n      resources: { wood: 10, iron: 45},\n      time: time.ONE_HOUR,\n    }\n\n  },\n  \"apparel/shoulders3\": {\n    item: { type: \"apparel/shoulders3\" },\n    cost: {\n      resources: { wood: 10, iron: 45},\n      time: time.ONE_HOUR,\n    }\n\n  },\n  \"apparel/vest\": {\n    item: { type: \"apparel/vest\" },\n    cost: {\n      resources: { wood: 10, iron: 45},\n      time: time.ONE_HOUR,\n    }\n  },\n};\nexport default armoursmithProduction;\n","import { QuestItem } from \"definitions/items/questItems\";\nimport * as time from \"utils/format/time\";\nimport { ProductionDefinition } from \"./types\";\n\nconst workshopProduction: {[key in QuestItem]?: ProductionDefinition} = {\n  \"questItem/torch\": {\n    item: { type: \"questItem/torch\" },\n    cost: {\n      resources: { wood: 2, fabric: 1 },\n      time: time.ONE_MINUTE,\n    },\n  },\n  \"questItem/sandwich\": {\n    item: { type: \"questItem/sandwich\" },\n    cost: {\n      resources: { food: 1 },\n      time: time.ONE_MINUTE / 2,\n    },\n  }\n};\nexport default workshopProduction;\n\n","import weaponsmithProduction from './weaponsmith'\nimport armoursmithProduction from './armoursmith'\nimport { Structure } from 'definitions/structures';\nimport { ProductionDefinition } from './types';\nimport workshopProduction from './workshop';\n// import alchemistProduction from './alchemist';\nimport { isWeapon } from 'definitions/items/weapons';\nimport { isApparel } from 'definitions/items/apparel';\nimport { isQuestItem } from 'definitions/items/questItems';\nimport { ProducableItem } from 'store/types/structure';\n\n// Returns the structure that produces given Item, or null if this Item is not produced anywhere\nexport const getProductionStructureForItem = (item: ProducableItem): Structure | null => {\n  // if (alchemistProduction[item]){\n  //   return Structure.alchemist;\n  // }\n  if (isApparel(item) && armoursmithProduction[item]){\n    return \"armoursmith\";\n  }\n  if (isWeapon(item) && weaponsmithProduction[item]){\n    return \"weaponsmith\";\n  }\n  if (isQuestItem(item) && workshopProduction[item]){\n    return \"workshop\";\n  }\n  return null;\n}\n\n\nconst all = {\n  // ...alchemistProduction,\n  ...armoursmithProduction,\n  ...weaponsmithProduction,\n  ...workshopProduction\n};\n\nexport const getDefinition = (item: ProducableItem ): ProductionDefinition => {\n  // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n  return all[item]!;\n}\n\n\n","import { Item, ItemCategory } from \"definitions/items/types\";\nimport { Action } from \"redux\";\n\nexport type StockpileAction =\n  { type: \"addItem\", item: Item, toSlot?: number }\n| { type: \"moveItemInWarehouse\", itemCategory: ItemCategory, fromSlot: number, toSlot: number }\n| { type: \"removeItem\", itemCategory: ItemCategory, fromSlot: number }\n//  |  { type: \"addStockpileSlots\"\n\n\n\nexport interface AddStockpileSlotsAction extends Action {\n  slots: number;\n}\n\n// Adds one Item to the warehouse\n// slot is optional, will take the first empty slot if not provided\nexport const addItemToWarehouse = (item: Item, toSlot?: number): StockpileAction => {\n  return {\n    type: \"addItem\",\n    item,\n    toSlot,\n  };\n}\n\n// When an Item is moved from one slot to the other in the warehouse\nexport const moveItemInWarehouse = (itemCategory: ItemCategory, fromSlot: number, toSlot: number): StockpileAction => {\n  return {\n    type: \"moveItemInWarehouse\",\n    itemCategory,\n    fromSlot,\n    toSlot,\n  };\n}\n\nexport const removeItemFromWarehouse = (itemCategory: ItemCategory, fromSlot: number): StockpileAction => {\n  return {\n    type: \"removeItem\",\n    itemCategory,\n    fromSlot,\n  };\n}\n\n// export function addStockpileSlots(slots: number): AddStockpileSlotsAction {\n//   return {\n//     type: ActionType.addStockpileSlots,\n//     slots,\n//   };\n// }\n","import { ResourceStoreState } from \"store/types/resources\";\n\nexport type ResourcesAction =\n  { type: \"addResources\", resources: ResourceStoreState }\n| { type: \"removeResources\", resources: ResourceStoreState }\n\n\nexport const addResource = (resource: string, value: number): ResourcesAction => {\n  return addResources({\n    [resource]: value,\n  });\n}\n\nexport const addResources = (resources: ResourceStoreState): ResourcesAction => ({\n  type: \"addResources\",\n  resources,\n})\n\nexport const removeResources = (resources: ResourceStoreState): ResourcesAction => ({\n  type: \"removeResources\",\n  resources,\n})\n","import { Structure } from \"definitions/structures\";\nimport { ProducableItem, StructureState } from \"store/types/structure\";\n\nexport type StructuresAction =\n  { type: \"upgradeStructure\", structure: Structure }\n |  { type: \"increaseWorkers\", structure: Structure, workers: number}\n |  { type: \"decreaseWorkers\", structure: Structure, workers: number}\n |  { type: \"startBuildingStructure\", structure: Structure }\n |  { type: \"finishBuildingStructure\", structure: Structure }\n |  { type: \"setStructureState\", structure: Structure, state: StructureState }\n |  { type: \"addItemToToProduces\", structure: Structure, item: ProducableItem }\n |  { type: \"removeItemFromHarvest\", structure: Structure, index: number }\n\n\nexport const startBuildingStructure = (structure: Structure): StructuresAction => ({\n  type: \"startBuildingStructure\",\n  structure,\n})\n\nexport const finishBuildingStructure = (structure: Structure): StructuresAction => ({\n  type: \"finishBuildingStructure\",\n  structure,\n})\n\nexport const upgradeStructure = (structure: Structure): StructuresAction => ({\n  type: \"upgradeStructure\",\n  structure,\n})\n\n// Increases workers used by given structure by given amount\nexport const increaseWorkers = (structure: Structure, workers = 1): StructuresAction => ({\n  type: \"increaseWorkers\",\n  structure,\n  workers\n})\n\n// Decreases workers used by given structure by given amount\nexport const decreaseWorkers = (structure: Structure, workers = 1): StructuresAction => ({\n  type: \"decreaseWorkers\",\n  structure,\n  workers\n})\n\n// Set state directly\nexport const setStructureState = (structure: Structure, state: StructureState): StructuresAction => ({\n  type: \"setStructureState\",\n  structure,\n  state\n})\n\n// Structure can now preoduce this\nexport const addItemToToProduces = (structure: Structure, item: ProducableItem): StructuresAction => ({\n  type: \"addItemToToProduces\",\n  structure,\n  item\n})\n\n// Take item at specified index\nexport const removeItemFromHarvest = (structure: Structure, index: number): StructuresAction => ({\n  type: \"removeItemFromHarvest\",\n  structure,\n  index\n})\n","import { AnyAction } from \"redux\";\nimport { TaskType } from \"store/types/task\";\n\n\nexport type TaskAction = {\n  type: \"start\",\n  taskType: TaskType;\n  name: string;\n  origin: string;\n  time: number;\n  callbacks: AnyAction[];\n}\n\nexport function startTask(taskType: TaskType, name: string, origin: string, time: number, callbacks: AnyAction[]): TaskAction {\n  return {\n    type: \"start\",\n    taskType,\n    name,\n    origin,\n    time,\n    callbacks,\n  };\n}\n","import React, { useState } from 'react';\nimport { useDispatch } from 'react-redux';\nimport Button from 'components/ui/buttons/Button';\nimport UpDownValue from 'components/ui/common/UpDownValue';\nimport ItemsBox from 'components/ui/items/ItemsBox';\nimport ResourcesCost from 'components/structures/production/ResourcesCost';\nimport { ItemType } from 'definitions/items/types';\nimport { TextManager } from 'global/TextManager';\nimport { useResourcesState } from 'hooks/store/resources';\nimport { useWorkersFreeState } from 'hooks/store/useWorkersState';\nimport { calculateProductionTime, MAX_WORKERS_CRAFTING } from 'mechanics/crafting';\nimport { formatDuration } from 'utils/format/time';\nimport { getDefinition as getProductionDefinition } from \"definitions/production\";\nimport { ProductionDefinition } from 'definitions/production/types';\nimport { addItemToWarehouse } from 'store/actions/stockpile';\nimport { removeResources } from 'store/actions/resources';\nimport { increaseWorkers } from 'store/actions/structures';\nimport { startTask } from 'store/actions/tasks';\nimport { TaskType } from 'store/types/task';\nimport { Structure } from 'definitions/structures';\nimport { Resource } from 'definitions/resources';\nimport { ProducableItem } from 'store/types/structure';\nimport { useStockpileStateFlat } from 'hooks/store/stockpile';\n\nexport interface Props {\n  item: ProducableItem;\n  structure: Structure;\n}\n\nconst CraftingDetails = (props: Props) => {\n  const { item, structure } = props;\n  const dispatch = useDispatch();\n  const resourcesState = useResourcesState();\n  const stockpileState = useStockpileStateFlat();\n  const workersFree = useWorkersFreeState();\n  const [workersAssigned, setWorkersAssigned] = useState<number>(0);\n\n  const produces = getProductionDefinition(item);\n  const costResources = produces.cost.resources || {};\n  const missingAtLeastOneResource = Object.keys(costResources)\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    .some((key) => { const resource:Resource = key as Resource; return costResources[resource]! > resourcesState[resource]! });\n\n  let missingAtLeastOneItem = false;\n  const costMaterials = produces.cost.materials;\n  if (costMaterials) {\n    missingAtLeastOneItem = costMaterials.some((i: ItemType) => stockpileState.indexOf(i) === -1);\n  }\n\n  const disabled = missingAtLeastOneResource || missingAtLeastOneItem || workersAssigned < 1;\n  // TODO: [10/07/2019] Perhaps each item can have a number of minimum workers?\n\n  const makeTimeString = (asNumber: number): string => {\n    if (workersAssigned === 0) {\n      return \"\";\n    }\n    const craftingTime = calculateProductionTime(asNumber, workersAssigned);\n    const time = formatDuration(craftingTime);\n    return TextManager.get(\"ui-structure-production-crafting-time\", { time });\n  };\n\n  const handleClick = (e: React.MouseEvent) => {\n    e.stopPropagation();\n\n    handleCraft(produces, workersAssigned);\n    setWorkersAssigned(0);\n  };\n\n  const handleUp = (e: React.MouseEvent) => {\n    e.stopPropagation();\n    setWorkersAssigned(workersAssigned + 1);\n  };\n\n  const handleDown = (e: React.MouseEvent) => {\n    e.stopPropagation();\n    setWorkersAssigned(workersAssigned - 1);\n  };\n\n  const handleCraft = (productionDefinition: ProductionDefinition, workers: number) => {\n    const craftingTime = calculateProductionTime(productionDefinition.cost.time || 0, workers);\n    dispatch(removeResources(productionDefinition.cost.resources || {}));\n    dispatch(increaseWorkers(structure, workers));\n\n    const callbacks = [\n      addItemToWarehouse(productionDefinition.item),\n      increaseWorkers(structure, workers),\n    ];\n    const start = startTask(\n      TaskType.craftItem,\n      productionDefinition.item.type,\n      `${structure}.craft`,\n      craftingTime,\n      callbacks);\n    dispatch(start);\n  }\n\n  return (\n    <div className=\"crafting-details\">\n      { TextManager.get(\"ui-structure-production-craft-a\", {item}) }\n      <div className=\"crafting-costs\">\n        <fieldset>\n          <ResourcesCost resources={costResources} />\n        </fieldset>\n        <fieldset>\n          {costMaterials && <ItemsBox items={costMaterials} />}\n        </fieldset>\n      </div>\n      <div className=\"buttonrow\">\n        <div>\n          <UpDownValue\n            value={workersAssigned}\n            label={TextManager.get(\"ui-structure-production-workers\")}\n            onUp={handleUp}\n            onDown={handleDown}\n            upDisabled={\n              workersAssigned >= workersFree ||\n              workersAssigned >= MAX_WORKERS_CRAFTING\n            }\n            downDisabled={workersAssigned < 1}\n          />\n          { makeTimeString(produces.cost.time || 0)}\n        </div>\n        <div>\n          <Button\n            disabled={disabled}\n            className=\"craft\"\n            onClick={handleClick}\n          >\n            {TextManager.get(\"ui-structure-production-craft\")}\n          </Button>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default CraftingDetails;\n","import { ItemType } from \"definitions/items/types\";\nimport { SceneStoreState } from './scene';\n\nexport enum QuestStatus {\n  unavailable,\n  available,  // on the quest board\n  active,\n  completed,\n  // todo: failed?\n}\n\nexport interface QuestReward {\n  gold?: number;\n  items?: ItemType[];\n}\n\nexport interface QuestStoreState {\n  name: string;\n  status: QuestStatus;\n  party: string[];        // list of adventurer ids\n  progress: number;         // Which questnode the party is at currently\n  questVars: unknown;       //\n  encounterResults: string[];   // Store what option the place chose during an encounter // OBSOLETE\n  icon: string;\n\n  reward?: QuestReward;\n  scene?: SceneStoreState;\n  sceneName?: string;\n  sceneNamePrev?: string;\n}\n","import { useState } from \"react\";\nimport { IconSize } from 'components/ui/common/Icon';\nimport ItemIcon from 'components/ui/items/ItemIcon';\nimport { Structure } from 'definitions/structures';\nimport { ProducableItem, ProductionStructureStoreState } from 'store/types/structure';\nimport { useStructureState } from 'hooks/store/structures';\nimport { TextManager } from 'global/TextManager';\nimport CraftingDetails from './CraftingDetails';\n\nexport interface Props {\n  structure: Structure;\n}\n\nconst CraftingArea = (props: Props) => {\n  const {structure} = props;\n  const [selectedItem, setSelectedItem] = useState<ProducableItem>();\n\n  const storeState = useStructureState<ProductionStructureStoreState>(structure);\n  const handleSelectCraftingItem = (item: ProducableItem) => {\n    setSelectedItem(item);\n  };\n\n  return (\n    <>\n      <div> { TextManager.get(\"ui-structure-production-craft\") }</div>\n      <div className=\"crafting-area\">\n        <ul className=\"vertical-tab-bar\">\n          {storeState.produces.map((type) => (\n            <li\n              key={`craft${type}`}\n              onClick={() => handleSelectCraftingItem(type)}\n              className={selectedItem === type ? \"selected\" : \"\"}\n            >\n              <ItemIcon item={{ type }} size={IconSize.smallest} />\n              { TextManager.getItemName(type) }\n            </li>\n          ))}\n        </ul>\n        { selectedItem && <CraftingDetails item={selectedItem} structure={structure} /> }\n      </div>\n    </>\n  )\n};\n\nexport default CraftingArea;\n","import { PropsWithChildren } from \"react\";\nimport { TextManager } from 'global/TextManager';\nimport useGoldState from \"hooks/store/useGoldState\";\nimport { Structure } from \"definitions/structures\";\nimport ResourcesCost from \"./production/ResourcesCost\";\nimport { ResourceStructureDefinition } from \"definitions/structures/types\";\nimport { useStructureDefinition } from \"hooks/store/structures\";\nimport { Resource } from \"definitions/resources\";\nimport { useResourcesState } from \"hooks/store/resources\";\nimport { useDispatch } from \"react-redux\";\nimport { AnyAction } from \"redux\";\nimport { subtractGold } from \"store/actions/gold\";\nimport { addLogText } from \"store/actions/log\";\nimport { upgradeStructure } from \"store/actions/structures\";\nimport { startTask } from \"store/actions/tasks\";\nimport { LogChannel } from \"store/types/logEntry\";\nimport { TaskType } from \"store/types/task\";\nimport Button from \"components/ui/buttons/Button\";\nimport { removeResources } from \"store/actions/resources\";\nimport { formatDuration } from \"utils/format/time\";\nimport \"./styles/upgradeHelpModal.scss\"\n\nexport interface Props  {\n  structure: Structure;\n  level: number;\n\n  addUpgradeCallbacks?: (level: number) => AnyAction[]; // add custom actions after upgrade is done\n}\n\n\nconst UpgradeHelpModal = (props: PropsWithChildren<Props>) => {\n  const { structure, level, addUpgradeCallbacks, children } = props;\n  const dispatch = useDispatch();\n  const structureDefinition: ResourceStructureDefinition = useStructureDefinition(structure);\n  const nextLevel = structureDefinition.levels[level + 1];\n\n  const { time } = nextLevel.cost;\n\n  const gold = useGoldState()\n  const goldCost = (nextLevel != null ? nextLevel.cost.gold || 0 : -1);\n  const missingGold = goldCost > gold;\n\n  const resourcesState = useResourcesState();\n  const costResources = nextLevel.cost.resources || {};\n  const missingAtLeastOneResource = Object.keys(costResources)\n    .some((key) => {\n      const resource = key as Resource;\n      return (costResources[resource] ?? 0) > (resourcesState?.[resource] ?? 0)\n    });\n\n  const canUpgrade = nextLevel != null && !missingGold && !missingAtLeastOneResource\n\n  const handleUpgrade = () => {\n    dispatch(subtractGold(goldCost));\n    dispatch(removeResources(costResources))\n    const callbacks = [\n      ...(addUpgradeCallbacks?.(level + 1) || []),\n      upgradeStructure(structure),\n      addLogText(\"log-town-upgrade-structure-complete\", {\n        level: level + 1,\n        structure,\n      }, LogChannel.town)\n    ];\n    const time = nextLevel.cost.time ?? 0;\n    const start = startTask(TaskType.upgradeStructure,\n      `${structure}.upgrade`,\n      \"town\",\n      time,\n      callbacks);\n    dispatch(start);\n  }\n\n  return (\n    <div className=\"structure-upgrade-help-modal\">\n      <div className=\"top\">\n        <h3>{TextManager.get(\"ui-structure-help-upgrade-title\", { structure } )}</h3>\n        <div className=\"level\">\n          {TextManager.get(\"ui-structure-help-upgrade-header-level\", {\n            level: level + 2\n          })}\n        </div>\n      </div>\n      <div className=\"cost\">\n        <h3>Costs</h3>\n        { nextLevel.cost.resources && <ResourcesCost resources={nextLevel.cost.resources} gold={nextLevel.cost.gold} className=\"wrap\" /> }\n      </div>\n      <Button\n        className=\"start\"\n        onClick={handleUpgrade}\n        disabled={!canUpgrade}\n      >\n        { TextManager.get(\"ui-structure-help-upgrade-start\", {\n          time: formatDuration(time ?? 0)\n        })}\n      </Button>\n      {children}\n    </div>\n  )\n}\n\nexport default UpgradeHelpModal;\n","import { Structure } from 'definitions/structures';\nimport { ProductionStructureDefinition } from 'definitions/structures/types';\nimport { IconSize } from 'components/ui/common/Icon';\nimport ItemIcon from 'components/ui/items/ItemIcon';\nimport { ItemType } from \"definitions/items/types\";\nimport { useStructureDefinition } from \"hooks/store/structures\";\nimport { TextManager } from \"global/TextManager\";\nimport \"./styles/upgradeHelpModalContent.scss\"\n\nexport interface Props  {\n  structure: Structure;\n  level: number;\n}\n\nconst UpgradeHelpModalContent = (props: Props) => {\n  const { level, structure } = props;\n  const structureDefinition = useStructureDefinition<ProductionStructureDefinition>(structure);\n  const nextLevel = structureDefinition.levels[level + 1];\n\n  const renderRow = (type: ItemType) => {\n    return (\n      <ItemIcon key={type} item={{type}} size={IconSize.small} />\n    )\n  }\n\n  return (\n    <div className=\"upgrade-help-model-content-production\">\n      <h3>{TextManager.get(\"ui-structure-help-upgrade-unlocks-crafting\")}</h3>\n      <div className=\"unlocks\">\n        {nextLevel.unlocks.map(item => renderRow(item))}\n      </div>\n    </div>\n  )\n}\n\nexport default UpgradeHelpModalContent;\n","import { useEffect } from \"react\";\nimport { ItemType } from \"definitions/items/types\";\nimport { Structure } from \"definitions/structures\";\nimport { ProductionStructureDefinition } from \"definitions/structures/types\";\nimport { TextManager } from \"global/TextManager\";\nimport { formatDuration } from \"utils/format/time\";\nimport { TickingProgressbar } from 'components/ui/common/progress';\nimport { useStructureDefinition, useStructureState } from 'hooks/store/structures';\nimport { useCraftingTasksStateByStructure, useStudyingTasksStateByStructure } from 'hooks/store/useTasksState';\nimport StructureViewHeader from '../StructureViewHeader';\nimport StructureLevel from '../StructureLevel';\nimport { TooltipManager } from 'global/TooltipManager';\nimport { ContextType } from 'constants/context';\nimport CraftingArea from './CraftingArea';\nimport { addItemToToProduces } from 'store/actions/structures';\nimport UpgradeHelpModal from \"../UpgradeHelpModal\";\nimport UpgradeHelpModalContent from \"./UpgradeHelpModalContent\";\nimport { SoundManager, Channel } from \"global/SoundManager\";\nimport \"./styles/productionStructureView.scss\";\n\nexport interface Props {\n  structure: Structure;\n}\n\nconst ProductionStructureView = (props: Props) => {\n  const { structure } = props;\n  const level = useStructureState(structure).level;\n\n  const craftingTasks = useCraftingTasksStateByStructure(structure);\n  const studyingTasks = useStudyingTasksStateByStructure(structure);\n  const structureDefinition = useStructureDefinition<ProductionStructureDefinition>(props.structure);\n\n  useEffect(() => {\n    if (structure === 'armoursmith' || structure === 'weaponsmith') {\n      SoundManager.addSound(\"ambient/structure/smith\", \"sound/structures/smith.ogg\", () => {\n        SoundManager.playSound(\"ambient/structure/smith\", Channel.ambient, true);\n      })\n    }\n    if (structure === 'alchemist') {\n      SoundManager.addSound(\"ambient/structure/alchemist\", \"sound/structures/alchemist.ogg\", () => {\n        SoundManager.playSound(\"ambient/structure/alchemist\", Channel.ambient, true);\n      })\n    }\n    return () => SoundManager.fadeOutSound(Channel.ambient);\n  }, [structure]);\n\n  const handleHelpClicked = (event: React.MouseEvent) => {\n    const origin = (event.currentTarget as HTMLElement);\n    const originRect = origin.getBoundingClientRect();\n    const content = (\n      <UpgradeHelpModal\n        level={level}\n        structure={structure}\n        addUpgradeCallbacks={handleUpgradeCallbacks}\n      >\n        <UpgradeHelpModalContent level={level} structure={structure}/>\n      </UpgradeHelpModal>\n    );\n    TooltipManager.showContextTooltip(ContextType.component, content, originRect, \"upgrade-structure-tooltip\");\n\n    event.stopPropagation();\n  }\n\n  const handleUpgradeCallbacks = (nextLevel: number) => {\n    const nextLevelDefinition = structureDefinition.levels[nextLevel];\n    return nextLevelDefinition.unlocks.map(item => addItemToToProduces(structure, item));\n  }\n\n  return (\n    // TODO: abstract some stuff to generic StructureView\n    <>\n      <StructureViewHeader structure={props.structure} />\n      <div className = \"production-structure-view\">\n        <section>\n          <StructureLevel\n            structure={structure}\n            onHelpClicked={handleHelpClicked}\n          />\n          <CraftingArea structure={structure} />\n          <fieldset>\n            <legend>{TextManager.get(\"ui-structure-production-crafting\")}</legend>\n            {craftingTasks.map((t) => (\n              <TickingProgressbar\n                key={`${t.name}${t.startTime}`}\n                label={`${TextManager.getItemName(t.name as ItemType)} (${formatDuration(t.timeRemaining)})`}\n                progress={t.progress}\n              />\n            ))}\n          </fieldset>\n          {studyingTasks.length > 0 && (\n          <fieldset>\n            <legend>{TextManager.get(\"ui-structure-production-studying\")}</legend>\n            {studyingTasks.map((t) => (\n              <TickingProgressbar\n                key={`${t.name}${t.startTime}`}\n                label={`${TextManager.getItemName(t.name as ItemType)} (${formatDuration(t.timeRemaining)})`}\n                progress={t.progress}\n              />\n            ))}\n          </fieldset>\n          )}\n        </section>\n      </div>\n    </>\n  );\n}\n\nexport default ProductionStructureView;\n","export const formatNumber = (input: number, digits = 1): string => {\n  const SI_SYMBOL = [\"\", \"k\", \"M\", \"G\", \"T\", \"P\", \"E\"];\n\n  // what tier? (determines SI symbol)\n  const tier = Math.log10(input) / 3 | 0;\n  // if zero, we don't need a suffix\n  if(tier === 0) return input.toFixed(digits);\n\n  // get suffix and determine scale\n  const suffix = SI_SYMBOL[tier];\n  const scale = Math.pow(10, tier * 3);\n\n  // scale the number\n  const scaled = input / scale;\n\n  // format number and add suffix\n  return scaled.toFixed(digits) + suffix;\n}\n\nexport const roundIfNeeded = (input: number, digits = 1): number => {\n  return Math.round((input + Number.EPSILON) * Math.pow(10, digits)) / Math.pow(10, digits);\n}\n","import { useRef } from \"react\";\nimport { useSelector } from 'react-redux';\nimport { Resource } from \"definitions/resources\";\nimport resourceDescriptions from \"definitions/resources\";\nimport { ResourceStoreState } from \"store/types/resources\";\nimport { TextManager } from \"global/TextManager\";\nimport ReactMarkdown from \"react-markdown\";\nimport { StructuresStoreState } from 'store/types/structures';\nimport { getStructureByResource } from 'definitions/structures';\nimport { withAppContext, AppContextProps } from 'hoc/withAppContext';\nimport { StoreState } from 'store/types';\nimport { StructureState } from 'store/types/structure';\nimport { formatNumber } from 'utils/format/number';\nimport Icon from '../../ui/common/Icon';\nimport { BubbleLayer, BubbleManager, BubbleType } from \"global/BubbleManager\";\nimport { Point } from \"pixi.js\";\nimport \"./styles/resourcesBox.scss\";\n\nexport interface Props {\n  className?: string;\n  resources: ResourceStoreState;\n  structures: StructuresStoreState;\n  maxResources: ResourceStoreState;\n  deltaResources: ResourceStoreState;\n}\n\n/**\n * The ResourcesBox is used in the Warehouse to show a list of resources\n */\nconst ResourcesBox = (props: Props & AppContextProps) => {\n  const {\n    resources,\n    deltaResources,\n  } = props;\n  const structures = useSelector<StoreState, StructuresStoreState>(store => store.structures);\n  const className = `resources-box ${(props.className || \"\")}`;\n  const ref = useRef<HTMLDivElement>(null);\n\n  return (\n    <div className={className} ref={ref}>\n      {\n        Object.keys(resources).map((value: string) => {\n          const resource = value as Resource;\n          const resourceDescription = resourceDescriptions[resource];\n          const amount = props.resources[resource] || 0;\n          if (!resourceDescription) {\n            throw new Error(`No resource description found for ${resource}`);\n          }\n\n          if (deltaResources[resource]) {\n            // Show bubble\n            const el = ref.current?.querySelector(`[data-resource=\"${resource}\"] .amount`);\n            const rect = el?.getBoundingClientRect();\n            const point = new Point(rect?.right, rect?.top)\n\n            BubbleManager.addBubble(`+ ${deltaResources[resource]?.toFixed(2)}`, point, BubbleType.resource, BubbleLayer.general);\n          }\n\n          const structure = getStructureByResource(Resource[resource]);\n\n          const full = amount >= (props.maxResources?.[resource] ?? 0);\n          const structureText = TextManager.get(structures[structure].state === StructureState.Built ? \"ui-structure-warehouse-resources-source\" : \"ui-structure-warehouse-resources-source-unbuilt\", {structure})\n          return (\n            <div className=\"row\" data-resource={resource} key={resource}>\n              <Icon image={resourceDescription.iconImg} size=\"smallest\"/>\n              <div className=\"name\">\n                { TextManager.getResourceName(resource as Resource) }\n              </div>\n              <div className={`amount${full ? \" full\" : \"\"}`}  >\n                { formatNumber(amount, 0) }\n              </div>\n              <div className=\"max\" >\n                { ` / ${props.maxResources[resource]}` }\n              </div>\n              <div className=\"structure\">\n                <ReactMarkdown>{structureText}</ReactMarkdown>\n              </div>\n            </div>\n          )\n        })\n      }\n    </div>\n  );\n};\n\nexport default withAppContext(ResourcesBox);\n\n\n","import { Resource } from \"definitions/resources\";\n\n// The keys should be the same as the enum Resource\nexport interface ResourceStoreState {\n    [Resource.wood]?: number;\n    [Resource.iron]?: number;\n    [Resource.stone]?: number;\n    [Resource.leather]?: number;\n    [Resource.fabric]?: number;\n    [Resource.food]?: number;\n}\n\nexport const empty: ResourceStoreState = {\n    fabric: 0,\n    food: 0,\n    iron: 0,\n    leather: 0,\n    stone: 0,\n    wood: 0,\n};\n","import React, { useState } from \"react\";\nimport { Props as TabProps } from \"./Tab\";\nimport { SoundManager} from 'global/SoundManager';\nimport \"./styles/tabstrip.scss\";\n\nexport interface Props<T extends string> {\n  className?: string;\n  children: React.ReactElement<TabProps<T>>[] |  React.ReactElement<TabProps<T>>;\n  activeTab?: string;\n  disabled?: boolean;\n  onClick?: React.MouseEventHandler<Element>;\n  onTabSelected?: (tabId: T) => void;\n}\n\nconst Tabstrip = <T extends string> (props: Props<T>) => {\n  const {activeTab = null, onClick} = props;\n  if (!activeTab && props.children && props.children) {\n    //activeTab = props.children[0].props.id;\n  }\n  const className = `${props.className}${(props.disabled ? \" disabled\" : \"\")}`;\n  const children = React.Children.map(props.children, (child: React.ReactElement<TabProps<T>>) => {\n    const clone: React.ReactElement<TabProps<T>> = React.cloneElement(child, {\n      active: child.props.id === activeTab,\n      onClick: () => { handleTabClick(child.props.id); }\n    });\n    return clone;\n  });\n\n  const handleTabClick = (tabId: T) => {\n    if (props.onTabSelected && props.disabled !== true) {\n      props.onTabSelected(tabId);\n    }\n  };\n\n  const handleClick = (e: React.MouseEvent<Element>) => {\n    SoundManager.playSound(\"ui/buttonClick\");\n    onClick?.(e);\n    setOpen(!open)\n  };\n  // used in autocollapse\n  const [open, setOpen] = useState(false);\n\n  return (\n    <>\n      <ul className={`tabstrip ${className ?? \"\"}`} onClick={handleClick}>\n        <input type=\"checkbox\" className=\"open\" id=\"open\" checked={open} onChange={() => setOpen(!open)} />\n        {children}\n      </ul>\n    </>\n  );\n};\n\nexport default Tabstrip;\n","import * as React from \"react\";\n\nexport interface Props<T extends string>  {\n  id: T;\n  className?: string;\n  onClick?: React.MouseEventHandler<Element>;\n  active?: boolean;\n}\n\n\nconst Tab = <T extends string> (props: React.PropsWithChildren<Props<T>>) => {\n  const handleClick = (e: React.MouseEvent<HTMLLIElement>) => {\n    if (props.onClick) {\n      props.onClick(e);\n    }\n  };\n  const className = ((props.active) ? \"active\" : \"\") + (props.className || \"\");\n  return (\n    <li className={`tabstrip-tab ${className}`} onClick={handleClick}>\n      {props.children}\n    </li>\n  );\n};\n\nexport default Tab;\n","import Icon, { IconSize } from 'components/ui/common/Icon';\nimport { AdventurerStoreState } from \"store/types/adventurer\";\nimport \"./styles/adventureravatar.scss\";\n\nexport interface Props {\n  adventurer: AdventurerStoreState;\n  className?: string;\n  displayName?: boolean;\n  onClick?: (adventurerId: string) => void;\n  size?: IconSize;\n}\n\n/**\n * The AdventurerAvatar displays the avatar of an adventurer\n */\nconst AdventurerAvatar = (props: Props) => {\n  const {\n    adventurer,\n    size\n  } = props;\n\n  const className = `${(props.className || \"\")} avatar`;\n\n  const handleClick = () => {\n    if (props.onClick) {\n      props.onClick(props.adventurer.id);\n    }\n  };\n  return (\n    <Icon\n      className={className}\n      image={adventurer.avatarImg}\n      size={size}\n      onClick={handleClick}\n    />\n  );\n};\n\nexport default AdventurerAvatar;\n","import React from \"react\";\nimport Tabstrip from 'components/ui/tabs/Tabstrip';\nimport { AdventurerStoreState } from 'store/types/adventurer';\nimport Tab from 'components/ui/tabs/Tab';\nimport AdventurerAvatar from 'components/ui/adventurer/AdventurerAvatar';\nimport { IconSize } from 'components/ui/common/Icon';\n\ninterface Props {\n  adventurers: AdventurerStoreState[];\n  selectedAdventurerId?: string;\n  onAdventurerTabSelected: (adventurerId: string) => void;\n  disabled?: boolean;\n}\n\n// Shows adventurer portraits in a tabstrip\nconst AdventurerTabstrip = (props: Props) => {\n  const {adventurers, onAdventurerTabSelected} = props;\n\n  const handleAdventurerTabSelected = (adventurerId: string) => {\n    const adventurer = props.adventurers.find(a => a.id === adventurerId);\n    if (adventurer) onAdventurerTabSelected(adventurer.id);\n  }\n\n  const renderAdventurerTab = (adventurer: AdventurerStoreState) => (\n    <Tab id={adventurer.id} key={adventurer.id}>\n      <AdventurerAvatar adventurer={adventurer} size={IconSize.small}/>\n    </Tab>\n  );\n  return (\n    <Tabstrip\n      className=\"adventurers-tabstrip\"\n      onTabSelected={handleAdventurerTabSelected}\n      activeTab={props.selectedAdventurerId}\n      disabled={props.disabled}\n    >\n      {adventurers.map((a) => renderAdventurerTab(a))}\n    </Tabstrip>\n  )\n}\n\nexport default AdventurerTabstrip;\n","import { AdventurerStoreState } from 'store/types/adventurer';\nimport { QuestStoreState, QuestStatus } from 'store/types/quest';\nimport { StoreState } from 'store/types';\nimport { useSelector } from 'react-redux';\nimport { useMemo, useCallback } from 'react';\nimport { EquipmentSlotType } from 'components/ui/adventurer/EquipmentSlot';\nimport { Apparel, getDefinition } from 'definitions/items/apparel';\nimport { Item } from 'definitions/items/types';\n\nconst getAdventurersInTown = (adventurers: AdventurerStoreState[], quests: QuestStoreState[]): AdventurerStoreState[] => {\n  // Get an array of all adventurer ids on any active quest\n  const adventurersOnQuest = quests.reduce<string[]>((acc, val: QuestStoreState) => {\n    if (val.status === QuestStatus.active) {\n      acc.push(...val.party);\n    }\n    return acc;\n  }, []);\n\n  return adventurers.filter((a) => adventurersOnQuest.indexOf(a.id) === -1);\n};\n\n/** Returns all the adventurers currently not on a mission */\nexport const useAdventurersInTown = () => {\n  const adventurers = useSelector<StoreState, AdventurerStoreState[]>(store => store.adventurers);\n  const quests = useSelector<StoreState, QuestStoreState[]>(store => store.quests);\n\n  const adventurersInTown = useMemo(() => {\n    return getAdventurersInTown(adventurers, quests)\n  }, [adventurers, quests]);\n\n  return adventurersInTown;\n}\n\n/** Returns the adventurer from store */\nexport const useAdventurerState = (adventurerId: string) => {\n  const adventurerSelector = useCallback(\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    (state: StoreState) => state.adventurers.find((q) => q.id === adventurerId)!,\n    [adventurerId]\n  );\n  return useSelector<StoreState, AdventurerStoreState>(adventurerSelector);\n}\n\n/* Returns a map keyed by EquipmentSlotType with DR of an adventurer.\n   0 if nothing worn or if item does not have DR */\nexport const useAdventurerDamageReduction = (adventurerId: string): { [key: string]: number } => {\n  const adventurer = useAdventurerState(adventurerId);\n  const findDR = (type: EquipmentSlotType) => {\n    const item: Item<Apparel>|undefined = adventurer.equipment[type as EquipmentSlotType] as Item<Apparel>;\n    if (!item) return 0;\n    return getDefinition(item.type).damageReduction || 0;\n  }\n  return {\n    [EquipmentSlotType[EquipmentSlotType.head]]: findDR(EquipmentSlotType.head),\n    [EquipmentSlotType[EquipmentSlotType.chest]]: findDR(EquipmentSlotType.chest),\n    [EquipmentSlotType[EquipmentSlotType.hands]]: findDR(EquipmentSlotType.hands),\n    [EquipmentSlotType[EquipmentSlotType.shoulders]]: findDR(EquipmentSlotType.shoulders),\n    [EquipmentSlotType[EquipmentSlotType.legs]]: findDR(EquipmentSlotType.legs),\n    [EquipmentSlotType[EquipmentSlotType.feet]]: findDR(EquipmentSlotType.feet),\n  }\n}\n\nexport const useAdventurerMainhandItem = (adventurerId: string) => {\n  const adventurer = useAdventurerState(adventurerId);\n  return adventurer.equipment[EquipmentSlotType.mainHand];\n}\n","import * as React from \"react\";\nimport { PropsWithChildren } from 'react';\nimport { DragSourceType, DragType } from \"constants/dragging\";\nimport { Item } from \"definitions/items/types\";\nimport { ConnectDropTarget, DropTarget, DropTargetConnector, DropTargetMonitor, DropTargetSpec } from \"react-dnd\";\nimport { InventoryItemDragInfo } from '../items/DraggableItemIcon';\nimport { IconSize } from '../common/Icon';\nimport { itemAndEquipmentSlotMatch } from '../adventurer/EquipmentSlot';\n\nconst dropTarget: DropTargetSpec<Props> = {\n  drop(props: Props, monitor: DropTargetMonitor<InventoryItemDragInfo>) {\n    props.onDrop(monitor.getItem());\n  },\n  canDrop(props: Props, monitor: DropTargetMonitor) {\n    const dragInfo: InventoryItemDragInfo = monitor.getItem();\n    if (dragInfo.sourceType === DragSourceType.adventurerEquipment && dragInfo.inventorySlot !== undefined) {\n      return props.item == null || itemAndEquipmentSlotMatch(props.item.type, dragInfo.inventorySlot);\n    }\n    return props.canDropHere ? props.canDropHere(dragInfo) : true;\n  },\n};\n\nexport interface Props {\n  item: Item | null;\n  size?: IconSize;\n  disabled?: boolean;\n  onDrop: (info: InventoryItemDragInfo) => void;\n  canDropHere?: ( dragInfo: InventoryItemDragInfo ) => boolean;\n}\n\nexport interface DropSourceProps {\n  canDrop: boolean;\n  isOver: boolean;\n  connectDropTarget: ConnectDropTarget;\n}\n\nconst collect = (connect: DropTargetConnector, monitor: DropTargetMonitor) => ({\n  canDrop: monitor.canDrop(),\n  connectDropTarget: connect.dropTarget(),\n  isOver: monitor.isOver(),\n});\n\n/**\n * The InventorySlot displays a slot in which an item can be placed.\n */\nconst InventorySlot = (props: PropsWithChildren<Props> & DropSourceProps) => {\n  const {\n    isOver,\n    canDrop,\n    disabled,\n    connectDropTarget,\n  } = props;\n  const isActive = isOver && canDrop;\n\n  const classNames = [\n    \"inventory-item\",\n    ...(disabled ? [\"disabled\"]: []),\n    ...(isActive ? [\"drop-active\"] : []),\n    ...(!isActive && canDrop ? [\"drop-possible\"] : [])\n  ];\n\n\n  return connectDropTarget(\n    <div className={classNames.join(\" \")}>\n      { props.children }\n    </div>,\n  );\n}\n\nexport default DropTarget<Props, DropSourceProps>(\n  DragType.ITEM,\n  dropTarget,\n  collect,\n)(InventorySlot);\n","import * as React from \"react\";\nimport { IconSize } from 'components/ui/common/Icon';\nimport { DragSourceType, DragType } from \"constants/dragging\";\nimport { Item } from \"definitions/items/types\";\nimport ItemIcon from \"./ItemIcon\";\nimport { ConnectDragSource, DragSource, DragSourceConnector, DragSourceMonitor, DragSourceSpec } from \"react-dnd\";\nimport { useMemo } from \"react\";\nimport { ItemSource } from \"constants/items\";\n\nexport interface Props {\n  index: number;\n  item: Item;\n  sourceType: DragSourceType;\n  sourceId?: string;\n  size?: IconSize;\n\n  onStartDrag?: () => void;\n  onClick?: (event: React.MouseEvent) => void;\n}\n\ninterface CollectedProps {\n  isDragging: boolean;\n  connectDragSource: ConnectDragSource;\n}\n\nexport interface InventoryItemDragInfo { // todo: rename to ItemDragInfo\n  item: Item;\n  inventorySlot?: number;\n  sourceId?: string;\n  sourceType: DragSourceType;\n}\n\n/**\n * Specifies the drag source contract.\n * Only `beginDrag` function is required.\n */\nconst source: DragSourceSpec<Props, InventoryItemDragInfo> = {\n  beginDrag(props: Props) {\n    const {\n      onStartDrag,\n      index,\n      item,\n      sourceId,\n      sourceType\n    } = props;\n    onStartDrag?.();\n\n    // Return the data describing the dragged item\n    return {\n      inventorySlot: index,\n      item,\n      sourceId,\n      sourceType,\n    };\n  },\n};\n\n/**\n * Specifies which props to inject into your component.\n */\nfunction collect(connect: DragSourceConnector, monitor: DragSourceMonitor) {\n  return {\n    connectDragSource: connect.dragSource(),\n    isDragging: monitor.isDragging(),\n  };\n}\n\nconst DraggableItemIcon = (props: Props & CollectedProps) => {\n\n  const { item, onClick, isDragging, connectDragSource, size, index, sourceType, sourceId } = props;\n  const handleClick = (event: React.MouseEvent) => {\n    onClick?.(event);\n  };\n  if (isDragging) {\n    // TODO: can show some sort of empty state?\n    return null;\n  }\n  const source = useMemo<ItemSource>(() => ({\n    origin: sourceType,\n    id: sourceId,\n    slot: index\n  }), []);\n\n  // The wrapping div is needed by ReactDnD\n  return connectDragSource((\n    <div>\n      <ItemIcon\n        item={item}\n        source={source}\n        onClick={handleClick}\n        size={size}\n      />\n    </div>\n  ));\n}\n\nexport default DragSource<Props, CollectedProps>(DragType.ITEM, source, collect)(DraggableItemIcon);\n","export interface TraitDefinition {\n  trait: Trait;\n  hasEffect?: boolean;    // shown in tooltip\n}\n\nexport enum Trait {\n  arrowFinder = \"arrowFinder\",\n  gloomy = \"gloomy\",\n  lucky = \"lucky\",\n  houseHouston = \"houseHouston\",\n  houseMaddox = \"houseMaddox\",\n  houseMonroe = \"houseMonroe\",\n}\n\n","import * as React from \"react\";\nimport { DragSourceType } from \"constants/dragging\";\nimport {Item } from \"definitions/items/types\";\nimport InventorySlot from \"./InventorySlot\";\nimport DraggableItemIcon, { InventoryItemDragInfo } from '../items/DraggableItemIcon';\nimport { IconSize } from '../common/Icon';\nimport \"./styles/inventory.scss\";\n\nexport interface Props {\n  items: (Item|null)[];\n  sourceId?: string;   // who does this inventory belong to?\n  sourceType: DragSourceType;\n  iconSize?: IconSize;\n  className?: string;\n  disabledIndex?: number;\n\n  onDropItem: (item: Item, fromSlot: number, toSlot: number, sourceType: DragSourceType, sourceId?: string) => void;\n  onStartDrag?: (item: Item, fromSlot: number) => void;\n  canDropHere?: (dragInfo: InventoryItemDragInfo) => boolean;\n}\n\n/**\n * Inventory is used to show Items. They can be dragged about\n * @param props\n */\nconst Inventory = (props: Props) => {\n  const { items, disabledIndex, canDropHere, onStartDrag } = props;\n  const slots = [];\n  for (let i = 0; i < items.length; i++) {\n    let contents;\n    const item = items[i];\n    const handleDrop = (dragInfo: InventoryItemDragInfo) => {\n      if (dragInfo.inventorySlot === i && dragInfo.sourceType === props.sourceType && dragInfo.sourceId === props.sourceId) {\n        return;\n      }\n      if (props.onDropItem && dragInfo.inventorySlot !== undefined) {\n        const {inventorySlot: fromSlot} = dragInfo;\n        props.onDropItem(dragInfo.item, fromSlot, i, dragInfo.sourceType, dragInfo.sourceId);\n       }\n    };\n\n    const handleCheckDrop = (dragInfo: InventoryItemDragInfo) => {\n      return canDropHere ? canDropHere(dragInfo) : true;\n    }\n\n    const handleStartDrag = () => {\n      if (item) {\n        onStartDrag?.(item, i);\n      }\n    }\n\n    if (item) {\n      contents = (\n        <DraggableItemIcon\n          index={i}\n          sourceId={props.sourceId}\n          sourceType={props.sourceType}\n          item={item}\n          onStartDrag={handleStartDrag}\n        />\n      );\n     }\n\n    const slot = (\n      <InventorySlot\n        key={`inventory-slot-${i}`}\n        item={item}\n        size={props.iconSize}\n        disabled={disabledIndex === i}\n        onDrop={handleDrop}\n        canDropHere={handleCheckDrop}\n      >\n        {contents}\n      </InventorySlot>\n    );\n    slots.push(slot);\n   }\n  return (\n    <div className={`inventory ${props.className ? props.className : \"\"}`}>\n      {slots}\n    </div>\n  );\n};\nexport default Inventory;\n","import React from 'react';\nimport \"./styles/loadingSpinner.scss\";\n\nconst LoadingSpinner = () => {\n    const rings = 5;\n    return (\n        <div className=\"loading-spinner\">\n        {[...Array(rings)].map((e, i) => (\n            <div className=\"ring\" key={i}>\n                <div className=\"inner\"/>\n            </div>\n        ))}\n        </div>\n    );\n}\nexport default LoadingSpinner;","import React, { createContext, PropsWithChildren, useState, useMemo, useEffect } from 'react';\nimport { useStore } from 'react-redux';\nimport { SceneControllerManager } from 'global/SceneControllerManager';\nimport { BaseSceneController } from 'mechanics/scenes/BaseSceneController';\nimport { StoreState } from 'store/types';\nimport LoadingSpinner from 'components/ui/loading/LoadingSpinner';\nimport usePrevious from 'hooks/usePrevious';\n\nexport const SceneControllerContext = createContext<BaseSceneController<unknown> | null>(null);\n\nexport interface Props {\n  questName: string;\n}\n\nconst SceneControllerContextProvider = (props: PropsWithChildren<Props>) => {\n  const {questName, children} = props;\n  const store = useStore<StoreState>();\n  const [loaded, setLoaded] = useState<boolean>(false);\n  const storeState = store.getState();\n  const quest = storeState.quests.find(q => q.name === questName);\n  if (!quest) throw Error(\"No quest found\")\n  const {scene, sceneName, questVars} = quest;\n  const previousQuestVars = usePrevious(questVars);\n\n  const controller = useMemo(() => {\n    if (!sceneName) {\n      return null;\n    }\n    return SceneControllerManager.getSceneController(questName, sceneName, store);\n  }, [questName, sceneName, store]);\n\n  useEffect(() => {\n    setLoaded(false);\n    if (sceneName && controller && !controller.dataLoading) {\n      const loadingComplete = () => {\n        setLoaded(true);\n\n        // If the store has no scene for this quest yet, create and store it!\n        if (!scene && controller) {\n          controller.createScene();\n        }\n        controller.sceneEntered();\n      }\n      controller.loadData(loadingComplete);\n    }\n    return () => {\n      controller?.sceneExited();\n    }\n  }, [controller, questName, scene, sceneName]);\n\n  useEffect(() => {\n    if (questVars !== previousQuestVars && controller?.dataLoadComplete) {\n      controller.updateScene();\n    }\n  }, [controller, previousQuestVars, questVars]);\n\n  if (controller && (controller.dataLoading || !loaded)) {\n    return (\n      <LoadingSpinner />\n    );\n  }\n  return (\n    <SceneControllerContext.Provider value={controller}>\n      {children}\n    </SceneControllerContext.Provider>\n  );\n};\n\nexport default SceneControllerContextProvider;\n","import { useContext } from 'react';\nimport { useDispatch } from 'react-redux';\nimport { Action } from \"redux\";\nimport { removeItemFromInventory, assignEquipment, addItemToInventory, removeEquipment, moveItemInInventory } from 'store/actions/adventurers';\nimport { removeItemFromWarehouse, addItemToWarehouse, moveItemInWarehouse } from 'store/actions/stockpile';\nimport { EquipmentSlotType } from 'components/ui/adventurer/EquipmentSlot';\nimport { Item, ItemCategory } from 'definitions/items/types';\nimport { DragSourceType } from 'constants/dragging';\nimport { AdventurerStoreState } from 'store/types/adventurer';\nimport { SceneControllerContext } from 'components/world/QuestPanel/context/SceneControllerContext';\nimport { InventoryItemDragInfo } from 'components/ui/items/DraggableItemIcon';\nimport { SoundManager } from 'global/SoundManager';\nimport { useStockpileState } from 'hooks/store/stockpile';\nimport { getDefinition } from 'definitions/items';\nimport { StockpileStoreState } from 'store/types/stockpile';\n\n/* Exposes\n- dropItemEquipment,\n- dropItemInventory,\n- dropItemWarehouse\nto use in various places in the UI when an item is dropped somewhere\n*/\nconst useItemDropActions = () => {\n  const dispatch = useDispatch();\n  const sceneController = useContext(SceneControllerContext);  // is only available when in a scene\n  const stockpile = useStockpileState();\n\n  // When an item gets dropped on equipment slot\n  const dropItemEquipment = (dragInfo: InventoryItemDragInfo, slotType: EquipmentSlotType, adventurer: AdventurerStoreState) => {\n    const item = dragInfo.item;\n    const actions: Action[] = [];\n\n    SoundManager.playSound(\"ui/equip\");\n\n    switch (dragInfo.sourceType) {\n      // Dragged from inventory\n      case DragSourceType.adventurerInventory: {\n        actions.push(\n          // Item gets removed from inventory\n          removeItemFromInventory(adventurer.id, dragInfo.inventorySlot ?? -1),\n          // Item gets assigned to an equipment slot\n          assignEquipment(adventurer.id, slotType, item),\n        );\n\n        const existingEquipment = adventurer.equipment[slotType as EquipmentSlotType];\n        if (existingEquipment) {\n          // There is already an item in this slot. Place in inventory\n          actions.push(addItemToInventory(adventurer.id, existingEquipment, dragInfo.inventorySlot ?? -1));\n        }\n        break;\n      }\n      // Dragged from warehouse.\n      case DragSourceType.warehouse: {\n        const definition = getDefinition(item.type)\n        actions.push(\n          removeItemFromWarehouse(definition.itemCategory, dragInfo.inventorySlot ?? -1),\n          assignEquipment(adventurer.id, slotType, item),\n        );\n\n        const existingEquipment = adventurer.equipment[slotType as EquipmentSlotType];\n        if (existingEquipment) {\n          // There is already an item in this slot. Place in warehouse\n          actions.push(addItemToWarehouse(existingEquipment, dragInfo.inventorySlot ?? -1));\n        }\n        break;\n      }\n\n      // Dragged from equipment slot (only applicable to weapons)\n      case DragSourceType.adventurerEquipment: {\n        actions.push(\n          assignEquipment(adventurer.id, slotType, item)\n        );\n\n        const existingEquipment = adventurer.equipment[slotType as EquipmentSlotType];\n        const fromSlot = dragInfo.inventorySlot ?? -1;\n        if (existingEquipment) {\n          // Another weapon was there, switch them\n          actions.push(assignEquipment(adventurer.id, fromSlot, existingEquipment))\n        } else {\n          // Clear the slot where it came from\n          actions.push(removeEquipment(adventurer.id, fromSlot));\n        }\n        break;\n      }\n    }\n    actions.forEach(a => dispatch(a));\n  };\n\n  // When an item gets dropped on an adventurer inventory\n  const dropItemInventory = (item: Item, fromSlot: number, toSlot: number, sourceType: DragSourceType, adventurer: AdventurerStoreState, sourceId?: string): void => {\n    const actions: Action[] = [];\n\n    switch (sourceType) {\n      // Drag from one inventory slot to another\n      case DragSourceType.adventurerInventory:\n        actions.push(moveItemInInventory(adventurer.id, fromSlot, toSlot))\n        break;\n\n      // Dragged from warehouse\n      case DragSourceType.warehouse: {\n        const definition = getDefinition(item.type)\n        actions.push(\n          removeItemFromWarehouse(definition.itemCategory, fromSlot),\n          addItemToInventory(adventurer.id, item, toSlot),\n        )\n        const otherItem = adventurer.inventory[toSlot];\n        if (otherItem) {\n          actions.push(\n            addItemToWarehouse(otherItem, fromSlot)\n          )\n        }\n        break;\n      }\n\n      // Drag from equipment slot\n      case DragSourceType.adventurerEquipment: {\n        actions.push(\n          addItemToInventory(adventurer.id, item, toSlot)\n        );\n\n        const existingEquipment = adventurer.inventory[toSlot];\n        if (existingEquipment) {\n          // Was dropped on another piece of equipment in inventory, switch them\n          actions.push(assignEquipment(adventurer.id, fromSlot, existingEquipment));\n        } else {\n          // Clear the slot where it came from\n          actions.push(removeEquipment(adventurer.id, fromSlot));\n        }\n        break;\n      }\n\n      // Dragged from lootCache on a scene\n      case DragSourceType.lootCache: {\n        if (sceneController && sourceId) {\n          // Let the scene controller handle this action\n          sceneController.takeItemFromCache(fromSlot, sourceId, adventurer.id, toSlot);\n        }\n      }\n    }\n    actions.forEach(a => dispatch(a));\n  };\n\n  // When an item gets dropped on the warehouse inventory\n  const dropItemWarehouse = (item: Item, fromSlot: number, toSlot: number, sourceType: DragSourceType, sourceId = \"\"): void => {\n    const actions: Action[] = [];\n    const definition = getDefinition(item.type)\n    const stockpileCategory = ItemCategory[definition.itemCategory] as keyof StockpileStoreState\nconsole.log(item)\n    switch (sourceType) {\n      // Dragged from the warehouse itself\n      case DragSourceType.warehouse: {\n        actions.push(\n          moveItemInWarehouse(definition.itemCategory, fromSlot, toSlot)\n        )\n        const otherItem = stockpile[stockpileCategory][toSlot];\n        if (otherItem) {\n          actions.push(\n            addItemToInventory(sourceId, otherItem, fromSlot)\n          )\n        }\n        break;\n      }\n      // Dragged from an adventurer inventory\n      case DragSourceType.adventurerInventory: {\n        actions.push(\n          removeItemFromInventory(sourceId, fromSlot),\n          addItemToWarehouse(item, toSlot)\n        )\n\n        const otherItem = stockpile[stockpileCategory][toSlot];\n        if (otherItem) {\n          actions.push(\n            addItemToInventory(sourceId, otherItem, fromSlot)\n          )\n        }\n        break;\n      }\n      // Drag from equipment slot\n      case DragSourceType.adventurerEquipment: {\n        actions.push(\n          removeEquipment(sourceId, fromSlot),\n          addItemToWarehouse(item, toSlot)\n        );\n\n        const otherItem = stockpile[stockpileCategory][toSlot];\n        if (otherItem) {\n          actions.push(\n            assignEquipment(sourceId, fromSlot, otherItem)\n          )\n        }\n        break;\n      }\n    }\n    actions.forEach(a => dispatch(a));\n  };\n  return {\n    dropItemEquipment,\n    dropItemInventory,\n    dropItemWarehouse\n  }\n}\n\nexport default useItemDropActions;\n","import React, { Fragment } from \"react\";\nimport { useAdventurerState } from 'hooks/store/adventurers';\nimport { TextManager } from 'global/TextManager';\nimport { ContextType } from 'constants/context';\nimport { TooltipManager } from 'global/TooltipManager';\nimport { WeaponType } from 'definitions/items/weapons';\nimport './styles/adventurerSkills.scss';\n\ninterface Props {\n  adventurerId: string;\n}\n\nconst AdventurerSkills = (props: Props) => {\n  const adventurer = useAdventurerState(props.adventurerId);\n\n  const renderSkill = (skill: WeaponType) => {\n    // const traitDefinition = getDefinition(trait);\n    const handleClick = (event: React.MouseEvent) => {\n      const origin = (event.currentTarget as HTMLElement);\n      const originRect = origin.getBoundingClientRect();\n      TooltipManager.showContextTooltip(ContextType.skill, skill, originRect);\n      event.stopPropagation();\n    };\n    return (\n      <Fragment key={skill}>\n        <li onClick={handleClick}>\n          <span className=\"skill\" onClick={handleClick}>\n            {TextManager.getSkillName(skill)}\n          </span>\n          <span>\n            {adventurer.skills[skill]}\n          </span>\n          {/* {TextManager.getTraitName(trait)} */}\n        </li>\n      </Fragment>\n    )\n  };\n\n  if (!adventurer?.skills) {\n    return null;\n  }\n  return (\n    <>\n      <p>{TextManager.get(\"ui-adventurer-info-skills-title\")}</p>\n      <ul className=\"adventurer-skills\">\n        {Object.keys(adventurer.skills)?.map((s) => {\n          const skill: WeaponType = s as WeaponType;\n          return renderSkill(skill);\n        })}\n      </ul>\n    </>\n  )\n}\n\nexport default AdventurerSkills;\n","import { levelToXp, MAX_XP, xpToLevel } from 'mechanics/adventurers/levels';\nimport PlainProgressbar from 'components/ui/common/progress/PlainProgressbar';\nimport { TextManager } from 'global/TextManager';\nimport { useEffect, useMemo, useState } from \"react\";\nimport usePrevious from \"hooks/usePrevious\";\nimport { useAdventurerState } from \"hooks/store/adventurers\";\nimport { SoundManager } from \"global/SoundManager\";\n\nexport interface Props {\n  adventurerId: string;\n}\n\nconst Level = (props: Props) => {\n  const { adventurerId } = props;\n  const { xp } = useAdventurerState(adventurerId);\n  const currentLevel = xpToLevel(xp);\n  const currentLevelXp = levelToXp(currentLevel); // start\n  const nextLevel = currentLevel + 1;\n  const nextLevelXp = levelToXp(nextLevel);\n  const [dingAnimationRunning, setDingAnimationRunning] = useState(false)\n\n  const lastState = usePrevious({ currentLevel, currentLevelXp, nextLevel, nextLevelXp })\n  const lastAdventurer = usePrevious(adventurerId);\n\n  useEffect(() => {\n    if (lastAdventurer !== adventurerId) {\n      setDingAnimationRunning(false)\n    }\n    else if (nextLevel > (lastState?.nextLevel ?? 0)) {\n      SoundManager.playSound(\"ui/levelUp\");\n      setDingAnimationRunning(true);\n\n      setTimeout(() => {\n        setDingAnimationRunning(false)\n      }, 2000)\n    }\n  }, [adventurerId, lastAdventurer, lastState?.nextLevel, nextLevel])\n\n  const lastDingAnimationRunning = usePrevious(dingAnimationRunning);\n\n  const progress = useMemo(() => {\n    return dingAnimationRunning ? 1 : (xp - currentLevelXp) / (nextLevelXp - currentLevelXp)\n  }, [currentLevelXp, dingAnimationRunning, nextLevelXp, xp]);\n\n  const label = useMemo(() => {\n    if (dingAnimationRunning) {\n      return TextManager.get(\"ui-adventurer-info-xp-level-up\");\n    }\n    if (xp >= MAX_XP) {\n      return TextManager.get(\"ui-adventurer-info-xp-level-max\");\n    }\n    return TextManager.get(\"ui-adventurer-info-xp-progress\", {\n      xp: Math.floor(xp - currentLevelXp),\n      next: nextLevelXp - currentLevelXp\n    })\n  }, [xp, dingAnimationRunning])\n\n  return (\n    <div className=\"level\">\n      {TextManager.get(\"ui-adventurer-info-level\", { level: currentLevel })}\n      <PlainProgressbar\n        progress={progress}\n        animationTime={lastAdventurer === adventurerId && !lastDingAnimationRunning ? 300 : 0}\n        label={label}\n      />\n    </div>\n  )\n}\nexport default Level;\n","import { createSelectorCreator, defaultMemoize } from 'reselect';\nimport stringArrayEqual from 'string-arrays-equal';\n\nexport const createStringArraySelector = createSelectorCreator(\n  defaultMemoize,\n  stringArrayEqual\n);\n","import { useCallback, useMemo } from 'react';\nimport { StoreState } from 'store/types';\nimport { useSelector } from 'react-redux';\nimport { QuestStatus, QuestStoreState } from 'store/types/quest';\nimport { createSelector } from 'reselect';\nimport { createStringArraySelector } from 'utils/reselect';\nimport { SceneStoreState } from 'store/types/scene';\n\nconst getQuests = (state: StoreState) => state.quests;\nconst getQuestNames = (state: StoreState) => state.quests.map(q => q.name);\nconst getQuestStatus = (state: StoreState) => state.quests.map(q => q.status);\n\n\nconst getActiveQuests = (quests: QuestStoreState[]) => {\n  // returns the names of the active quests\n  return quests.filter((q) => q.status === QuestStatus.active);\n};\n\n// Returns the quest from redux store\nexport const useQuest = (questName: string) => {\n  const questSelector = useCallback(\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    (state: StoreState) => state.quests.find((q) => q.name === questName)!,\n    [questName]\n  );\n  const quest = useSelector<StoreState, QuestStoreState>(questSelector);\n  return quest;\n}\n\nexport const useQuestScene = (questName: string) => {\n  const scene = useSelector<StoreState, SceneStoreState | undefined>(\n    store => store.quests.find((q) => q.name === questName)?.scene)\n  return scene;\n}\n\n// Returns the active quests from the store\nexport const useActiveQuests = () => {\n  const selectMemoized = useMemo(() => {\n    const activeQuests = createSelector(\n      [getQuests],\n      getActiveQuests,\n    );\n\n    return activeQuests;\n  }, []);\n\n  return useSelector<StoreState, QuestStoreState[]>(selectMemoized);\n}\n\n// Returns the active quests from the store\nexport const useActiveQuestNames = () => {\n  const questNameSelector = useMemo(() => createStringArraySelector(\n    [getQuestNames, getQuestStatus],\n    (names: string[], statuses: QuestStatus[]) => names.filter((_: string, index: number) => statuses[index] === QuestStatus.active)\n  ), []);\n  return useSelector<StoreState, string[]>(questNameSelector);\n}\n","import React, { useContext, useMemo } from \"react\";\nimport { SceneControllerContext } from 'components/world/QuestPanel/context/SceneControllerContext';\nimport { TextManager } from 'global/TextManager';\nimport { useQuest } from 'hooks/store/quests';\nimport { AdventurerStoreState } from 'store/types/adventurer';\n\nexport interface Props {\n  adventurer: AdventurerStoreState;\n  questName?: string;\n}\n\n/** Used when AdventurerPanel is used in Quest view\n * todo: move outside of /world\n */\nconst ApIndicator = (props: Props) => {\n  const quest = useQuest(props.questName ?? \"\");\n  const controller = useContext(SceneControllerContext);\n\n  const ap = useMemo(() => {\n    if (!controller) return null;\n    return controller.getSceneActor(props.adventurer.id)?.ap || null;\n  }, [controller, props.adventurer.id]);\n\n  if (!quest?.scene?.combat) {\n    return null;\n  }\n  return (\n    <span>{TextManager.get(\"ui-adventurer-info-ap-remaining\", { ap })}</span>\n  );\n}\n\nexport default ApIndicator;","import { TraitDefinition, Trait } from './types';\n\nconst all = {\n  [Trait.arrowFinder]: {\n    trait: Trait.arrowFinder,\n    hasEffect: true\n  },\n  [Trait.gloomy]: {\n    trait: Trait.gloomy,\n    hasEffect: true\n  },\n  [Trait.lucky]: {\n    trait: Trait.lucky,\n    hasEffect: true\n  },\n  [Trait.houseHouston]: {\n    trait: Trait.houseHouston,\n  },\n  [Trait.houseMaddox]: {\n    trait: Trait.houseMaddox,\n  },\n  [Trait.houseMonroe]: {\n    trait: Trait.houseMonroe,\n  }\n};\n\nexport function getDefinition(trait: Trait): TraitDefinition {\n  return all[trait];\n}\n","import { EquipmentSlotType } from \"components/ui/adventurer/EquipmentSlot\";\nimport { Ammunition } from \"definitions/items/ammunition\";\nimport { Apparel } from \"definitions/items/apparel\";\nimport { Item } from \"definitions/items/types\";\nimport { Weapon, WeaponType } from \"definitions/items/weapons\";\nimport { Trait } from 'definitions/traits/types';\nimport { TempEffect } from \"definitions/tempEffects/types\";\n\nexport interface AdventurerStoreState {\n  id: string;\n  name?: string;\n  flavor?: boolean;           // Has lore text, language key: `adventurer-{id}-flavor\n  avatarImg: string;\n  spritesheetPath: string;      // Path to JSON of spritesheet to use in scenes\n  color?: AdventurerColor;\n  traits?: Trait[];\n  health: number;           // When this reaches zero, the adventurer is dead\n  xp: number;\n\n  equipment: EquipmentStoreState;   // equipment\n  tempEffects: TempEffect[];          // combat effects\n  inventory: (null | Item)[];\n  basicAttributes: AttributesStoreState;\n  skills: SkillsStoreState;       //\n  room: number;             // Adventurer is lodged in this room in the tavern\n}\n\nexport enum AdventurerColor {\n  blue,\n  red,\n  teal,\n  purple,\n  orange,\n  black,\n  white,\n  yellow\n}\n\nexport type Equipment = Apparel | Weapon | Ammunition;\n\nexport interface EquipmentStoreState {\n  [EquipmentSlotType.head]?: Item<Apparel>;\n  [EquipmentSlotType.shoulders]?: Item<Apparel>;\n  [EquipmentSlotType.chest]?: Item<Apparel>;\n  [EquipmentSlotType.hands]?: Item<Apparel>;\n  [EquipmentSlotType.legs]?: Item<Apparel>;\n  [EquipmentSlotType.feet]?: Item<Apparel>;\n  [EquipmentSlotType.mainHand]?: Item<Weapon>;\n  [EquipmentSlotType.offHand]?: Item<Weapon> | Item<Ammunition>;\n}\n\nexport interface AttributesStoreState {\n  str: number;\n  for: number;\n  int: number;\n  agi: number;\n}\n\n// Determines the order in which the attributes are shown\nexport const attributeList: Attribute[] = ['str', 'for', 'int', 'agi'];\n\nexport type Attribute = keyof AttributesStoreState;\n\nexport type SkillsStoreState = {\n  [key in WeaponType]?: number\n}\n\n","import React, { Fragment } from \"react\";\nimport { useAdventurerState } from 'hooks/store/adventurers';\nimport { Trait } from 'definitions/traits/types';\nimport { getDefinition } from 'definitions/traits';\nimport { TextManager } from 'global/TextManager';\nimport { ContextType } from 'constants/context';\nimport { TooltipManager } from 'global/TooltipManager';\nimport './styles/adventurerTraits.scss';\n\ninterface Props {\n  adventurerId: string;\n}\n\nconst AdventurerTraits = (props: Props) => {\n  const adventurer = useAdventurerState(props.adventurerId);\n\n  const renderTrait = (trait: Trait, last: boolean) => {\n    const traitDefinition = getDefinition(trait);\n    const handleClick = (event: React.MouseEvent) => {\n      const origin = (event.currentTarget as HTMLElement);\n      const originRect = origin.getBoundingClientRect();\n\n      TooltipManager.showContextTooltip(ContextType.trait, traitDefinition, originRect);\n      event.stopPropagation();\n    };\n    return (\n      <Fragment key={trait}>\n        <li onClick={handleClick}>\n          {TextManager.getTraitName(trait)}\n        </li>\n        {!last && (', ')}\n      </Fragment>\n    )\n  };\n\n  if (!adventurer?.traits) {\n    return null;\n  }\n  return (\n    <>\n      <p>{TextManager.get(\"ui-adventurer-info-traits-title\")}</p>\n      <ul className=\"adventurer-traits\">\n        {adventurer.traits && adventurer.traits.map((t, i, a)=> renderTrait(t, i === a.length -1))}\n      </ul>\n    </>\n  )\n}\n\nexport default AdventurerTraits;\n","import React from \"react\";\nimport { EquipmentSlotType } from 'components/ui/adventurer/EquipmentSlot';\nimport { useAdventurerDamageReduction } from 'hooks/store/adventurers';\nimport './styles/guy.scss';\n\nexport interface Props {\n  adventurerId: string\n}\n\n// A silhouette of a person with the Damage Reduction numbers\nconst Guy = (props: Props) => {\n  const {adventurerId} = props;\n\n  const damageReduction = useAdventurerDamageReduction(adventurerId);\n  const renderDamageReduction = (equipmentType: EquipmentSlotType) => {\n    const dR = damageReduction[EquipmentSlotType[equipmentType]];\n    if (!dR) {\n      return null;\n    }\n    return (\n      <div className={EquipmentSlotType[equipmentType]} key={equipmentType}>\n        {dR}\n      </div>\n    )\n  }\n\n  return (\n    <li className=\"guy\">\n      {(renderDamageReduction(EquipmentSlotType.head))}\n      {(renderDamageReduction(EquipmentSlotType.chest))}\n      {(renderDamageReduction(EquipmentSlotType.hands))}\n      {(renderDamageReduction(EquipmentSlotType.shoulders))}\n      {(renderDamageReduction(EquipmentSlotType.legs))}\n      {(renderDamageReduction(EquipmentSlotType.feet))}\n    </li>\n  )\n}\n\nexport default Guy;\n","import { AdventurerStoreState } from 'store/types/adventurer';\nimport EquipmentSlot, { EquipmentSlotType, rangedWeaponInHand } from 'components/ui/adventurer/EquipmentSlot';\nimport { Item } from 'definitions/items/types';\nimport DraggableItemIcon, { InventoryItemDragInfo } from 'components/ui/items/DraggableItemIcon';\nimport { DragSourceType } from 'constants/dragging';\nimport { TextManager } from 'global/TextManager';\nimport { IconSize } from 'components/ui/common/Icon';\nimport Guy from './Guy';\nimport './styles/adventurerEquipment.scss';\n\nexport interface Props {\n  adventurer: AdventurerStoreState\n  onDropItemEquipment: (dragInfo: InventoryItemDragInfo, slotType: EquipmentSlotType) => void;\n}\n\n// Shows the gear an adventurer is wearing\nconst AdventurerEquipment = (props: Props) => {\n  const { adventurer, onDropItemEquipment } = props;\n\n  const getEquipmentSlot = (slotType: EquipmentSlotType) => {\n    // returns EquipmentSlot\n    const item: Item | undefined = adventurer.equipment[slotType];\n    let text = TextManager.getEquipmentSlot(slotType);\n\n    if (slotType === EquipmentSlotType.offHand) {\n      // If there a ranged weapon in the main hand the offHand is for ammo\n      if (rangedWeaponInHand(adventurer.equipment)) {\n        text = TextManager.get(\"ui-equipmentslot-ammunition\");\n      }\n    }\n    return (\n      <li className={EquipmentSlotType[slotType]}>\n        <EquipmentSlot\n          onDrop={(dragInfo: InventoryItemDragInfo) => onDropItemEquipment(dragInfo, slotType)}\n          type={slotType}\n        >\n          {item && (\n            <DraggableItemIcon\n              index={slotType}\n              sourceId={adventurer.id}\n              sourceType={DragSourceType.adventurerEquipment}\n              item={item}\n              size={IconSize.medium}\n            />\n          )}\n        </EquipmentSlot>\n        <span className=\"info\">\n          {text}\n        </span>\n      </li>\n    );\n  };\n\n  return (\n    <ul className=\"adventurer-equipment\">\n      {getEquipmentSlot(EquipmentSlotType.head)}\n      {getEquipmentSlot(EquipmentSlotType.chest)}\n      {getEquipmentSlot(EquipmentSlotType.hands)}\n      {getEquipmentSlot(EquipmentSlotType.shoulders)}\n      {getEquipmentSlot(EquipmentSlotType.legs)}\n      {getEquipmentSlot(EquipmentSlotType.feet)}\n      {getEquipmentSlot(EquipmentSlotType.mainHand)}\n      {getEquipmentSlot(EquipmentSlotType.offHand)}\n      <Guy adventurerId={adventurer.id} />\n    </ul>\n  )\n}\n\nexport default AdventurerEquipment;\n\n\n","// Calculates base hitpoints (hitpoints when at full health) given level and fort\nexport const calculateBaseHitpoints = (level: number, fortitude = 10) => {\n  return (20*level)+(fortitude/4)*20\n}\n","import * as React from \"react\";\nimport PlainProgressbar from 'components/ui/common/progress/PlainProgressbar';\nimport { useAdventurerState } from \"hooks/store/adventurers\";\nimport { TextManager } from \"global/TextManager\";\nimport { xpToLevel } from \"mechanics/adventurers/levels\";\nimport { calculateBaseHitpoints } from \"mechanics/adventurers/hitpoints\";\n\nexport interface Props {\n  adventurerId: string;\n}\n\nconst Health = (props: Props) => {\n  const { adventurerId } = props;\n  const { health, basicAttributes, xp } = useAdventurerState(adventurerId);\n  const level = xpToLevel(xp);\n  const baseHP = calculateBaseHitpoints(level, basicAttributes.for);\n\n  return (\n    <div className=\"health\">\n      {TextManager.get(\"ui-adventurer-info-health\")}\n      <PlainProgressbar\n        progress={health / baseHP}\n        label={`${health.toFixed(2)}/${baseHP}`}\n        variation=\"health\"\n      />\n    </div>\n  )\n}\nexport default Health;\n","// Ensures type safety for typescript\nexport function hasOwnProperty<X, Y extends PropertyKey>\n  (obj: X, prop: Y): obj is X & Record<Y, unknown> {\n  return Object.hasOwnProperty.call(obj, prop);\n}\n\nexport type Entries<T> = {\n  [K in keyof T]: [K, T[K]]\n}[keyof T][]\n\nexport function entries<T>(obj: T): Entries<T> {\n  return Object.entries(obj) as Entries<T>;\n}\n\n","import { getWeaponOrApparelDefinition } from \"definitions/items\";\nimport { isAmmunition } from \"definitions/items/ammunition\";\nimport { AdventurerStoreState, } from \"store/types/adventurer\";\nimport { entries } from \"utils/typescript\";\nimport { EffectSource, EffectSourceType, EffectType, EffectWithSource } from \"./types\";\n\nexport type EffectDefinition = {\n  harmful: boolean;\n}\n\nconst all = {\n  [EffectType.attributeIncrease]: {\n    harmful: false\n  },\n  [EffectType.healthDecreaseOnMove]: {\n    harmful: true\n  },\n  [EffectType.healthDecreaseOverTime]: {\n    harmful: true\n  }\n};\n\nexport default all;\nexport const getDefinition = (effectType: EffectType): EffectDefinition  => {\n  return all[effectType] as unknown as EffectDefinition;\n}\n\n\n// returns all effects on an adventurer (temp effects, equipment etc)\nexport const collectEffects = (adventurer: AdventurerStoreState, filterType?: EffectType): EffectWithSource[] => {\n  const result: EffectWithSource[] = [];\n\n  // Add effects from temp effects\n  adventurer.tempEffects.forEach(tempEffect => {\n    tempEffect.effects.forEach(e => {\n      if (filterType === undefined || filterType === e.type) {\n        const source: EffectSource = {\n          type: EffectSourceType.tempEffect,\n          tempEffectType: tempEffect.type\n        }\n\n        result.push({\n          ...e,\n          source\n        });\n      }\n    })\n  })\n\n  // Add effects from equipment\n  entries(adventurer.equipment).forEach((entry) => {\n    if (!entry) return;\n    const [, item] = entry;\n    if (!item || isAmmunition(item.type)) return;\n\n    const def = getWeaponOrApparelDefinition(item.type)\n      def.effects?.forEach(e => {\n        if (filterType === undefined || filterType === e.type) {\n          const source: EffectSource = {\n            type: EffectSourceType.item,\n            itemType: item.type\n          }\n\n          result.push({\n            ...e,\n            source\n          });\n        }\n      })\n    })\n\n    return result;\n}\n","import { EffectSource, EffectSourceType, EffectType } from \"definitions/effects/types\";\nimport { AdventurerStoreState, Attribute, AttributesStoreState } from \"store/types/adventurer\";\nimport { ItemType } from \"definitions/items/types\";\nimport { collectEffects } from \"definitions/effects\";\nimport { TempEffectType } from \"definitions/tempEffects/types\";\n\nexport const MIN_VALUE = 1;   // minimum value of any base attribute\nexport const MAX_VALUE = 20;  // maximum value of any base attribute\n\n\nexport type AttributesExtended = {\n  [key in Attribute]: ExtendedAttributeComponents[]\n}\n\nexport type ExtendedAttribute = {\n  attribute: Attribute;\n  components: ExtendedAttributeComponents[];\n}\n\nexport type ExtendedAttributeComponents = {\n  origin: AttributeSource,\n  value: number\n}\n\nexport enum AttributeSourceType {\n  base,\n  item,\n  tempEffect\n}\n\n// The source of the attribute modifier\nexport type AttributeSource = {\n  type: AttributeSourceType.base\n} | {\n  type: AttributeSourceType.tempEffect\n  tempEffectType: TempEffectType\n} | {\n  type: AttributeSourceType.item\n  item: ItemType\n}\n\nexport const calculateEffectiveAttributes = (adventurer: AdventurerStoreState): AttributesStoreState  => {\n  const extended = calculateEffectiveAttributesExtended(adventurer);\n  return {\n    str: extended.str.reduce((acc, value) => (acc + value.value), 0),\n    for: extended.for.reduce((acc, value) => (acc + value.value), 0),\n    int: extended.int.reduce((acc, value) => (acc + value.value), 0),\n    agi: extended.agi.reduce((acc, value) => (acc + value.value), 0),\n  }\n}\n\n// Returns the extended list of effective attributes (where each component comes from)\nexport const calculateEffectiveAttributesExtended = (adventurer: AdventurerStoreState): AttributesExtended  => {\n  const result = generateBaseAttributes(adventurer.basicAttributes);\n\n  // Add all 'attributeIncrease' effects\n  collectEffects(adventurer, EffectType.attributeIncrease).forEach(effectSource => {\n    const origin = convertOrigin(effectSource.source);\n    if (effectSource.type === EffectType.attributeIncrease) { // this is always true but typescript doesnt know that\n      const { attribute } = effectSource;\n      result[attribute].push({\n        origin,\n        value: adventurer.basicAttributes[attribute] * effectSource.factor - adventurer.basicAttributes[attribute]\n      })\n    }\n  })\n  // Add effects of soma\n  // const somaEffects = adventurer.tempEffects.filter(e => e.type === EffectType.soma) as EffectSoma[];\n  // if (somaEffects.length > 0) {\n  //   const ordered = somaEffects.sort((a: EffectSoma, b: EffectSoma) => b.factor - a.factor);\n  //   // the biggest soma counts\n  //   const top = ordered[0];\n  //   const origin: AttributeSource = { type: AttributeSourceType.soma };\n  //   result.str.push({ origin, value: adventurer.basicAttributes.str * top.factor - adventurer.basicAttributes.str})\n  //   result.for.push({ origin, value: adventurer.basicAttributes.for * top.factor - adventurer.basicAttributes.for})\n  //   result.int.push({ origin, value: adventurer.basicAttributes.int * top.factor - adventurer.basicAttributes.int})\n  //   result.agi.push({ origin, value: adventurer.basicAttributes.agi * top.factor - adventurer.basicAttributes.agi})\n  // }\n\n  return result;\n}\n\n// Turns base attribues into AttributesExtended\nexport const generateBaseAttributes = (basicAttributes: AttributesStoreState): AttributesExtended => {\n  const origin: AttributeSource = { type: AttributeSourceType.base };\n\n  return {\n    str: [{ origin, value: basicAttributes.str }],\n    for: [{ origin, value: basicAttributes.for }],\n    int: [{ origin, value: basicAttributes.int }],\n    agi: [{ origin, value: basicAttributes.agi }]\n  }\n}\n\nconst convertOrigin = (effectSource: EffectSource): AttributeSource => {\n  switch (effectSource.type) {\n    case EffectSourceType.item: {\n      return {\n        type: AttributeSourceType.item,\n        item: effectSource.itemType\n      }\n    }\n    case EffectSourceType.tempEffect: {\n      return {\n        type: AttributeSourceType.tempEffect,\n        tempEffectType: effectSource.tempEffectType\n      }\n    }\n    // default:\n    //   throw new Error(`Unknown effect source type ${effectSource.type}`)\n  }\n}\n\n","import { Attribute, attributeList } from \"store/types/adventurer\";\nimport { TextManager } from \"global/TextManager\";\nimport { TooltipManager } from \"global/TooltipManager\";\nimport { ContextType } from \"constants/context\";\nimport { AttributesExtended, AttributeSourceType, ExtendedAttribute } from \"mechanics/adventurers/attributes\";\nimport { roundIfNeeded } from \"utils/format/number\";\nimport \"./styles/attributes.scss\"\n\ninterface Props {\n  attributes: AttributesExtended;\n  small?: boolean\n}\n\nconst Attributes = (props: Props) => {\n  const { attributes, small } = props;\n\n  const renderRow = (attribute: Attribute) => {\n    const extendedAttribute: ExtendedAttribute = {\n      attribute,\n      components: attributes[attribute]\n     };\n    const handleClick = (event: React.MouseEvent) => {\n      const origin = (event.currentTarget as HTMLElement);\n      const originRect = origin.getBoundingClientRect();\n\n      TooltipManager.showContextTooltip(ContextType.attribute, extendedAttribute, originRect);\n      event.stopPropagation();\n    }\n\n    // Split out base and additional attribute components\n    const { base, additional } = extendedAttribute.components.reduce((acc, value) => {\n      if (value.origin.type === AttributeSourceType.base) {\n        acc.base += value.value;\n      } else {\n        acc.additional += value.value;\n      }\n      return acc;\n    }, { base: 0, additional: 0});\n\n    return (\n      <li key={attribute}>\n        <div className=\"attribute-name\">\n          <span onClick={handleClick}>\n            {small ? attribute : TextManager.getAttributeName(attribute)}\n          </span>\n        </div>\n        <div className=\"attribute-value\">\n          {roundIfNeeded(base)}\n          { additional > 0 && ( <span className=\"additional\"> +{ roundIfNeeded(additional)}</span>)}\n        </div>\n      </li>\n    );\n  }\n\n  return (\n    <div className=\"basic-attributes\">\n      {/* todo: use css grid */}\n      <ul className=\"attribute-list\">\n        {attributeList.map(a => renderRow(a))}\n      </ul>\n    </div>\n  )\n}\nexport default Attributes;\n","import * as React from \"react\";\nimport { ConnectDropTarget, useDrop } from \"react-dnd\";\nimport { DragType } from \"constants/dragging\";\nimport { InventoryItemDragInfo } from 'components/ui/items/DraggableItemIcon';\nimport { isConsumable } from \"definitions/items/consumables\";\nimport \"./styles/consumeitemslot.scss\";\n\nexport interface Props {\n  onDrop: (item: InventoryItemDragInfo) => void;\n}\n\nexport interface DropSourceProps {\n  canDrop: boolean;\n  isOver: boolean;\n  connectDropTarget: ConnectDropTarget;\n}\n\n\n/**\n * The ConsumeItemSlot displays a slot in which a consumable item can be placed\n */\nconst ConsumeItemSlot = (props: React.PropsWithChildren<Props>) => {\n\n  const { onDrop } = props;\n  const [{ canDrop, isOver }, drop] = useDrop(() => ({\n    // The type (or types) to accept - strings or symbols\n    accept: DragType.ITEM,\n    canDrop: ({item}: InventoryItemDragInfo) => {\n      // Can only drop consumables here\n      return isConsumable(item.type);\n    },\n    drop: (info: InventoryItemDragInfo) => {\n      onDrop(info);\n    },\n    // Props to collect\n    collect: (monitor) => ({\n      isOver: monitor.isOver(),\n      canDrop: monitor.canDrop()\n    })\n    //  // The border is still green for some reason ??\n    //  collect: (monitor: DropTargetMonitor<InventoryItemDragInfo>) => {\n    //   const dragInfo = monitor.getItem();\n    //   // Can only drop consumables here\n    //   const canDrop = dragInfo !== null && isConsumable(dragInfo.item) && monitor.canDrop()\n    //   // console.log(canDrop)\n    //   return {\n    //   isOver: monitor.isOver(),\n    //   canDrop\n    //   }\n    // }\n    }))\n  const className = [\"consume-item-slot\"]\n  if (isOver) {\n    className.push(\"drop-active\");\n  } else if (canDrop) {\n    className.push(\"drop-possible\");\n  }\n  return (\n    <div className={className.join(' ')} ref={drop}>\n      {props.children}\n    </div>\n  );\n};\n\nexport default ConsumeItemSlot;\n","import React from \"react\";\nimport { useAdventurerState } from \"hooks/store/adventurers\";\nimport { TextManager } from \"global/TextManager\";\nimport DraggableItemIcon, { InventoryItemDragInfo } from \"components/ui/items/DraggableItemIcon\";\nimport { useMemo } from \"react\";\nimport ConsumeItemSlot from \"./ConsumeItemSlot\";\nimport Button from \"components/ui/buttons/Button\";\nimport { DragSourceType } from \"constants/dragging\";\nimport { IconSize } from \"components/ui/common/Icon\";\nimport { consumeItem } from \"store/actions/adventurers\";\nimport { useDispatch } from \"react-redux\";\nimport { addLogText } from \"store/actions/log\";\nimport { LogChannel } from \"store/types/logEntry\";\nimport { useQuest } from \"hooks/store/quests\";\nimport { getAdventurer } from \"store/types/scene\";\nimport { AP_COST_CONSUME } from \"mechanics/combat\";\nimport { deductActorAp } from \"store/actions/quests\";\nimport { Channel, SoundManager } from \"global/SoundManager\";\nimport \"./styles/consumeitem.scss\";\nimport {  isConsumable } from \"definitions/items/consumables\";\n\nexport interface Props {\n  adventurerId: string;\n  questName?: string;\n  fromSlot?: number;\n\n  onDrop?: (index: number) => void;\n  onConsumed?: () => void;\n}\n\nconst ConsumeItem = (props: Props) => {\n  const { adventurerId, questName, fromSlot, onDrop, onConsumed } = props;\n  const adventurer = useAdventurerState(adventurerId);\n  const quest = useQuest(questName ?? \"\");\n  const dispatch = useDispatch();\n  const combat = !!quest?.scene?.combat; // if in combat mode, you have to pay AP to consume an item\n  const ap = useMemo(() => {\n    return getAdventurer(quest?.scene?.objects ?? [], adventurerId)?.ap ?? 0\n  }, [quest, adventurerId]);\n\n  const enoughAp = ap >= AP_COST_CONSUME;\n\n  const handleDrop = (dragInfo: InventoryItemDragInfo) => {\n    if (dragInfo.inventorySlot !== undefined){\n      onDrop?.(dragInfo.inventorySlot)\n    }\n  }\n\n  const item = useMemo(() => {\n    if (fromSlot === undefined) return null;\n    return adventurer?.inventory[fromSlot];\n  }, [adventurer, fromSlot])\n\n  const handleConsumeItem = () => {\n    if (!adventurerId || !fromSlot) return\n    const consumable = adventurer.inventory[fromSlot];\n    if (!consumable || !isConsumable(consumable.type)) {\n      throw new Error(`No potion found at index ${fromSlot} `)\n    }\n    if (combat) {\n      if (!questName) return\n      // Deduct AP from adventurer if in combat\n      dispatch(deductActorAp(questName , adventurerId, AP_COST_CONSUME));\n    }\n\n    // const definition = getDefinition(consumable.type);\n    // switch (definition.category) {\n    //   case \"health\":\n    //     break;\n    // }\n    dispatch(consumeItem(adventurerId, fromSlot));\n    SoundManager.playSound(\"scene/drinking\", Channel.scene);\n    onConsumed?.();\n\n    // Add log entry\n    if (adventurer) {\n      dispatch(addLogText(\"adventurer-drink-potion\", { item, adventurer: adventurerId }, LogChannel.common));\n    }\n  }\n  return (\n    <fieldset className=\"consume-item\">\n      <legend>{TextManager.get(\"ui-adventurer-info-use-item\")}</legend>\n      <div className=\"content\">\n\n        <ConsumeItemSlot onDrop={handleDrop}>\n          {item && (\n             <DraggableItemIcon\n              index={0}\n              sourceId={adventurerId}\n              sourceType={DragSourceType.adventurerConsumeItem}\n              item={item}\n              size={IconSize.small}\n            />\n          )}\n        </ConsumeItemSlot>\n        <Button\n          className=\"consume-button\"\n          onClick={handleConsumeItem}\n          disabled={!item || (combat && !enoughAp)}\n        >\n          {TextManager.get(\"ui-adventurer-info-use-item\")}\n          {combat && \" \" + TextManager.get(\"ui-adventurer-info-use-item-ap-cost\", { ap: AP_COST_CONSUME })}\n        </Button>\n      </div>\n    </fieldset>\n  )\n}\nexport default ConsumeItem;\n","import { TempEffectType } from 'definitions/tempEffects/types';\n\ninterface Props {\n  effectType: TempEffectType;\n}\n\nconst EffectIcon = (props: Props) => {\n  const { effectType } = props;\n  // const effectDefinition = getDefinition(effectType);\n  const harmful = true;\n  return (\n    <div\n      className={`effect-icon ${harmful ? 'harmful' : 'not-harmful'}`}\n      style={{\n        backgroundImage: `url(${process.env.PUBLIC_URL}/img/ui/icons/${getIconImage(effectType)})`,\n      }}\n    />\n  )\n}\n\nexport default EffectIcon;\n\nconst getIconImage = (effectType: TempEffectType) => {\n  switch (effectType) {\n    case TempEffectType.brokenLegs:\n      return \"knee-bandage.svg\";\n    case TempEffectType.burning:\n      return \"flaming-claw.svg\";\n    case TempEffectType.soma:\n      return \"embrassed-energy.svg\";\n  }\n\n}\n","import React, { Fragment } from \"react\";\nimport { useAdventurerState } from 'hooks/store/adventurers';\nimport { TextManager } from 'global/TextManager';\nimport { ContextType } from 'constants/context';\nimport { TooltipManager } from 'global/TooltipManager';\nimport EffectIcon from \"./EffectIcon\";\nimport { TempEffect } from \"definitions/tempEffects/types\";\nimport './styles/adventurerEffects.scss';\n\ninterface Props {\n  adventurerId: string;\n\n}\n\n// Shows temp effects\nconst AdventurerTempEffects = (props: Props) => {\n  const adventurer = useAdventurerState(props.adventurerId);\n\n  const renderEffect = (effect: TempEffect) => {\n    // const effectDefinition = getDefinition(effect.type);\n\n    const handleClick = (event: React.MouseEvent) => {\n      const origin = (event.currentTarget as HTMLElement).querySelector(\".name\");\n      if (!origin) return;\n      const originRect = origin.getBoundingClientRect();\n\n      TooltipManager.showContextTooltip(ContextType.tempEffect, effect, originRect);\n      event.stopPropagation();\n    };\n    return (\n      <Fragment key={effect.type}>\n        <li onClick={handleClick}>\n          <EffectIcon effectType={effect.type} />\n          <div className=\"name\">\n            {TextManager.getTempEffectName(effect)}\n          </div>\n        </li>\n      </Fragment>\n    )\n  };\n\n  if (!adventurer?.tempEffects) {\n    return null;\n  }\n  return (\n    <>\n      <p>{TextManager.get(\"ui-adventurer-info-effects-title\")}</p>\n      <ul className=\"adventurer-effects\">\n        {adventurer.tempEffects && adventurer.tempEffects.map((effect)=> renderEffect(effect))}\n      </ul>\n    </>\n  )\n}\n\nexport default AdventurerTempEffects;\n","import { useSelector } from \"react-redux\";\nimport { StoreState } from \"store/types\";\nimport { SettingsState } from \"store/types/settings\";\n\nexport const useSettings = () => {\n  return useSelector<StoreState, SettingsState>(state => state.settings);\n}\n","import { RefObject, useEffect, useRef } from \"react\";\n\nconst useDraggable = (element: RefObject<HTMLElement>, handle?: RefObject<HTMLElement>) => {\n  const initial = useRef<{x: number, y: number}>();\n  const offset = useRef<{x: number, y: number}>({ x: 0, y: 0 });\n  const current = useRef<{x: number, y: number}>();\n  const active = useRef(false)\n\n  useEffect(() => {\n    if (!element.current) return;\n    if (!handle) {\n      handle = element;\n    }\n\n    const touchStart = (evt: TouchEvent) => {\n      offset.current = {\n        x: element.current?.getBoundingClientRect().left ?? 0,\n        y: element.current?.getBoundingClientRect().top ?? 0,\n      }\n      initial.current = {\n        x: evt.touches[0].clientX - offset.current.x,\n        y: evt.touches[0].clientY - offset.current.y\n      }\n      if (evt.target === handle?.current) {\n        active.current = true;\n      }\n    }\n\n    const mouseStart = (evt: MouseEvent) => {\n      offset.current = {\n        x: element.current?.getBoundingClientRect().left ?? 0,\n        y: element.current?.getBoundingClientRect().top ?? 0,\n      }\n      initial.current = {\n        x: evt.clientX - offset.current.x,\n        y: evt.clientY - offset.current.y\n      }\n\n      if (evt.target === handle?.current) {\n        active.current = true;\n      }\n    }\n\n    const touchMove = (evt: TouchEvent) => {\n      if (active.current) {\n\n        evt.preventDefault();\n        current.current = {\n          x: evt.touches[0].clientX - (initial.current?.x ?? 0),\n          y: evt.touches[0].clientY - (initial.current?.y ?? 0)\n        }\n\n        offset.current = current.current;\n        setPosition();\n      }\n    }\n\n    const mouseMove = (evt: MouseEvent) => {\n      if (active.current) {\n\n        evt.preventDefault();\n        current.current = {\n          x: evt.clientX - (initial.current?.x ?? 0),\n          y: evt.clientY - (initial.current?.y ?? 0)\n        }\n        offset.current = current.current;\n        setPosition();\n      }\n    }\n\n\n    const dragEnd = () => {\n      if (!initial.current) return;\n\n      initial.current = current.current;\n      active.current = false;\n    }\n\n    const setPosition = () => {\n      if (element.current) {\n        element.current.style.left = `${current.current?.x ?? 0}px`;\n        element.current.style.top = `${current.current?.y ?? 0}px`;\n      }\n    }\n    element.current?.addEventListener(\"touchstart\", touchStart, false);\n    element.current?.addEventListener(\"touchend\", dragEnd, false);\n    document.addEventListener(\"touchmove\", touchMove, false);\n\n    element.current?.addEventListener(\"mousedown\", mouseStart, false);\n    element.current?.addEventListener(\"mouseup\", dragEnd, false);\n    document.addEventListener(\"mousemove\", mouseMove, false);\n\n    return () => {\n      element.current?.removeEventListener(\"touchstart\", touchStart, false);\n      element.current?.removeEventListener(\"touchend\", dragEnd, false);\n      document.removeEventListener(\"touchmove\", touchMove, false);\n\n      element.current?.removeEventListener(\"mousedown\", mouseStart, false);\n      element.current?.removeEventListener(\"mouseup\", dragEnd, false);\n      document.removeEventListener(\"mousemove\", mouseMove, false);\n    }\n  }, [])\n}\n\nexport default useDraggable;\n","import ReactDOM from \"react-dom\";\nimport useDraggable from \"hooks/store/useDraggable\";\nimport { ComponentProps, ReactNode, useEffect, useRef } from \"react\";\n\nexport interface Props {\n  title?: ReactNode;\n  onClose?: () => void;\n}\n\n// An InfoWindow is a semi transparant black square. It is used for tooltips\n// and InfoModal. This can be dragged anywhere on the screen\nexport const DraggableInfoWindow = (props: Props & ComponentProps<\"div\">) => {\n  const {\n    className,\n    onClose,\n    title,\n    children,\n    ...otherProps\n  } = props;\n\n  const ref = useRef<HTMLDivElement>(null);\n  const handle = useRef<HTMLHeadingElement>(null);\n  useDraggable(ref, handle);\n  useEffect(() => {\n    // center window\n    if (ref.current) {\n      const rect = ref.current.getBoundingClientRect();\n      const parentRect = (ref.current.parentNode as HTMLElement).getBoundingClientRect();\n      ref.current.style.left = `${parentRect.width / 2 - rect.width / 2}px`;\n      ref.current.style.top = `${parentRect.height / 2 - rect.height / 2}px`;\n    }\n  }, []);\n\n  return ReactDOM.createPortal(\n    <div {...otherProps} ref={ref} className={`info-window info-window-draggable ${className || \"\"}`} >\n      <h2 className=\"title\" ref={handle}>\n        <div>\n          {title}\n        </div>\n        <div onClick={onClose} className=\"close\">x</div>\n      </h2>\n      {children}\n    </div>,\n    document.querySelector(\".app\") ?? document.body\n  )\n}\n","import { Fragment, useState } from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { TextManager } from \"global/TextManager\";\nimport { MAX_VALUE, MIN_VALUE } from \"mechanics/adventurers/attributes\";\nimport { AdventurerStoreState, Attribute, attributeList } from \"store/types/adventurer\";\nimport { addXp, modifyHealth, renameAdventurer, setBasicAttributes } from \"store/actions/adventurers\";\nimport { MAX_XP, xpToLevel } from \"mechanics/adventurers/levels\";\nimport { calculateBaseHitpoints } from \"mechanics/adventurers/hitpoints\";\nimport { DraggableInfoWindow } from \"components/ui/modals/InfoWindow/DraggableInfoWindow\";\nimport \"./styles/debugAdventurerEdit.scss\";\n\ntype Props = {\n  adventurer: AdventurerStoreState;\n}\n\nconst DebugAdventurerEdit = (props: Props) => {\n  const [open, setOpen] = useState(false);\n  const dispatch = useDispatch();\n  const { adventurer } = props;\n  const { xp, basicAttributes, health } = adventurer;\n  const level = xpToLevel(xp);\n  const baseHP = calculateBaseHitpoints(level, basicAttributes.for);\n\n  const renderAttribute = (attribute: Attribute) => {\n    return (\n      <Fragment key={attribute}>\n        <dt>\n          {TextManager.getAttributeName(attribute)}\n        </dt>\n        <dd>\n          <div className=\"slider\">\n            <input\n              type=\"range\"\n              min={MIN_VALUE}\n              max={MAX_VALUE}\n              value={basicAttributes[attribute]}\n              onChange={(e) => handleChangeAttribute(attribute, Number(e.currentTarget.value))}\n            />\n            <div className=\"value\">\n              ({basicAttributes[attribute]})\n            </div>\n          </div>\n        </dd>\n      </Fragment>\n    )\n  }\n\n  const handleRename = (e: React.ChangeEvent<HTMLInputElement>) => {\n    dispatch(renameAdventurer(adventurer.id, e.currentTarget.value));\n  };\n\n  const handleChangeAttribute = (attribute: Attribute, value: number) => {\n    dispatch(setBasicAttributes(adventurer.id, {\n      ...basicAttributes,\n      [attribute]: value\n    }));\n  }\n\n  const handleChangeHealth = (value: number) => {\n    dispatch(modifyHealth(adventurer.id, value));\n  }\n  const handleChangeXP = (value: number) => {\n    dispatch(addXp(adventurer.id, value));\n  }\n\n  const handleClose = () => {\n    setOpen(false);\n  }\n\n  return (\n    <span className=\"debug-adventurer-edit\">\n      {open && (\n        <DraggableInfoWindow className=\"debug-adventurer-edit modal\" title=\"Edit adventurer stats\" onClose={handleClose}>\n          <fieldset>\n            <summary>General</summary>\n            <dl>\n              <dt>Name</dt>\n              <dd>\n                <input\n                  type=\"text\"\n                  value={adventurer.name}\n                  onChange={handleRename}\n                />\n              </dd>\n              <dt>XP</dt>\n              <dd>\n                <input\n                  type=\"number\"\n                  min={0}\n                  max={MAX_XP}\n                  value={xp}\n                  onChange={(e) => handleChangeXP(Number(e.currentTarget.value) - xp)}\n                />\n              </dd>\n              <dt>Health</dt>\n              <dd>\n                <input\n                  type=\"range\"\n                  min={0}\n                  max={baseHP}\n                  value={health}\n                  onChange={(e) => handleChangeHealth(Number(e.currentTarget.value) - health)}\n                />\n                <div className=\"value\">\n                  ({health}/{baseHP})\n                </div>\n              </dd>\n            </dl>\n          </fieldset>\n          <fieldset>\n            <summary>Attributes</summary>\n            <dl>\n              {attributeList.map(a => renderAttribute(a))}\n            </dl>\n          </fieldset>\n        </DraggableInfoWindow>\n      )}\n      <span className=\"button-toggle\" onClick={() => setOpen(!open)}>\n        { open ? '(close)' : '(edit)' }\n      </span>\n    </span>\n  )\n}\n\nexport default DebugAdventurerEdit;\n\n","import { useMemo, useState } from \"react\";\nimport { DragSourceType } from 'constants/dragging';\nimport Inventory from 'components/ui/inventory/Inventory';\nimport useItemDropActions from 'hooks/actions/useItemActions';\nimport { EquipmentSlotType } from 'components/ui/adventurer/EquipmentSlot';\nimport { InventoryItemDragInfo } from 'components/ui/items/DraggableItemIcon';\nimport { Item } from 'definitions/items/types';\nimport AdventurerSkills from './AdventurerSkills';\nimport { useAdventurerState } from 'hooks/store/adventurers';\nimport Level from 'components/ui/adventurer/AdventurerPanel/Level';\nimport ApIndicator from './ApIndicator';\nimport AdventurerTraits from './AdventurerTraits';\nimport AdventurerEquipment from './AdventurerEquipment';\nimport { TextManager } from \"global/TextManager\";\nimport ReactMarkdown from \"react-markdown\";\nimport Health from \"./Health\";\nimport Attributes from \"./Attributes\";\nimport ConsumeItem from \"./ConsumeItem\";\nimport AdventurerEffects from \"./AdventurerEffects\";\nimport { useSettings } from \"hooks/store/settings\";\nimport DebugAdventurerEdit from \"./DebugAdventurerEdit\";\nimport { calculateEffectiveAttributesExtended } from \"mechanics/adventurers/attributes\";\nimport \"./styles/adventurerPanel.scss\";\n\nexport interface Props {\n  adventurerId: string;\n  questName?: string;\n  horizontalMode?: boolean;\n\n  name?: boolean; // whether to show the adventurer name\n  levelBar?: boolean; // whether to show the level bar\n  effects?: boolean; // whether to show effects\n  traits?: boolean; // whether to show traits\n  skills?: boolean; // whether to show skills\n\n  onStartInventoryItemDrag?: (item: Item, fromSlot: number) => void;\n}\n\n/** Vertical panel showing adventurer info\n */\nconst AdventurerPanel = (props: Props) => {\n  const {\n    adventurerId,\n    questName,\n    horizontalMode,\n    name = true,\n    levelBar = true,\n    effects = true,\n    traits = true,\n    skills = true,\n    onStartInventoryItemDrag\n  } = props;\n  const adventurer = useAdventurerState(adventurerId);\n  const settings = useSettings();\n\n  const {\n    dropItemEquipment,\n    dropItemInventory\n  } = useItemDropActions();\n\n  const handleDropItemEquipment = (dragInfo: InventoryItemDragInfo, slotType: EquipmentSlotType) => {\n    dropItemEquipment(dragInfo, slotType, adventurer);\n  };\n\n  const handleDropItemInventory = (item: Item, fromSlot: number, toSlot: number, sourceType: DragSourceType, sourceId?: string) => {\n    if (sourceType === DragSourceType.adventurerConsumeItem) {\n      setConsumeItemIndex(undefined)\n    } else {\n      dropItemInventory(item, fromSlot, toSlot, sourceType, adventurer, sourceId);\n    }\n  }\n\n  const [consumeItemIndex, setConsumeItemIndex] = useState<number>()\n  const handleDropConsumeItem = (fromSlot: number) => {\n    setConsumeItemIndex(fromSlot)\n  }\n\n  const handleItemConsumed = () => {\n    setConsumeItemIndex(undefined);\n  }\n\n  const extendedAttributes = useMemo(() => calculateEffectiveAttributesExtended(adventurer), [adventurer]);\n\n  return (\n    <div className={`adventurer-panel${(horizontalMode ? \" horizontal\" : \"\")}`}>\n       <section id=\"common\">\n         <div className=\"info\">\n         { name && (\n          <div className=\"name\">\n            {adventurer.name}\n            {questName && <ApIndicator questName={questName} adventurer={adventurer} />}\n            {settings.debugAllowAdventurerEdit && <DebugAdventurerEdit adventurer={adventurer} />}\n          </div>\n        )}\n        { levelBar && <Level adventurerId={adventurer.id}/> }\n        { adventurer.flavor && (\n          <span className=\"flavor\">\n            <img className=\"portrait\" src={`${process.env.PUBLIC_URL}${adventurer.avatarImg}`} />\n            <ReactMarkdown>\n              {TextManager.getAdventurerFlavor(adventurer.id, adventurer.name)}\n            </ReactMarkdown>\n          </span>\n        )}\n        <Health adventurerId={adventurer.id}/>\n        { effects && <AdventurerEffects adventurerId={adventurer.id}/> }\n        { traits && <AdventurerTraits adventurerId={adventurer.id}/> }\n        </div>\n        <Attributes attributes={extendedAttributes} />\n      </section>\n      <section id=\"skills\">\n        { skills && <AdventurerSkills adventurerId={adventurer.id}/> }\n      </section>\n      <section id=\"equipment\">\n        <div className=\"equipment\">\n          <p>{TextManager.get(\"ui-adventurer-info-equipment-title\")}</p>\n          <AdventurerEquipment\n            adventurer={adventurer}\n            onDropItemEquipment={handleDropItemEquipment}\n          />\n        </div>\n      </section>\n      <section id=\"inventory\">\n      <p>{TextManager.get(\"ui-adventurer-info-inventory-title\")}</p>\n        <Inventory\n          sourceType={DragSourceType.adventurerInventory}\n          sourceId={adventurer.id}\n          disabledIndex={consumeItemIndex}\n          items={adventurer.inventory}\n          className=\"inventory-small\"\n          onDropItem={handleDropItemInventory}\n          onStartDrag={onStartInventoryItemDrag}\n        />\n        <ConsumeItem\n          adventurerId={adventurer.id}\n          questName={questName}\n          fromSlot={consumeItemIndex}\n          onDrop={handleDropConsumeItem}\n          onConsumed={handleItemConsumed}\n        />\n      </section>\n    </div>\n  )\n}\n\nexport default AdventurerPanel;\n","import React, { useEffect, useRef } from \"react\";\nimport debounce from \"debounce\";\nimport { TextManager } from \"global/TextManager\";\nimport { HashLink } from 'react-router-hash-link';\nimport iconPerson from './styles/images/icon-person.png';\nimport iconHelmet from './styles/images/icon-helmet.png';\nimport iconCrosshair from './styles/images/icon-crosshair.png';\nimport iconSword from './styles/images/icon-sword.png';\nimport \"./styles/adventurerSectionSelection.scss\"\n\nconst AdventurerSectionSelection = () => {\n  const ref = useRef<HTMLUListElement>(null);\n\n  useEffect(() => {\n    const sectionParent = ref?.current?.parentNode as HTMLElement;\n\n    const onScroll = debounce(() => {\n      const fromTop = sectionParent.scrollTop;\n      ref.current?.querySelectorAll(\"a\")?.forEach(link => {\n        const hash = link.hash.substring(link.hash.lastIndexOf(\"#\"));\n        const section = document.querySelector(hash) as HTMLElement;\n\n        if (section && section.offsetTop <= fromTop && section.offsetTop + section.clientHeight > fromTop) {\n          link.classList.add(\"active\");\n        } else {\n          link.classList.remove(\"active\");\n        }\n      });\n    }, 50);\n    sectionParent?.addEventListener(\"scroll\", onScroll);\n    return () => {\n      sectionParent?.removeEventListener(\"scroll\", onScroll);\n    }\n  }, []);\n\n  return (\n    <ul className=\"adventurer-section-selection\" ref={ref}>\n      <li title={TextManager.get(\"ui-adventurer-info-general-title\")}>\n        <HashLink smooth to=\"#common\" className=\"active\">\n          <img src={iconPerson} />\n        </HashLink>\n      </li>\n      <li title={TextManager.get(\"ui-adventurer-info-skills-title\")}>\n        <HashLink smooth to=\"#skills\">\n          <img src={iconCrosshair} />\n        </HashLink>\n      </li>\n      <li title={TextManager.get(\"ui-adventurer-info-equipment-title\")}>\n        <HashLink smooth to=\"#equipment\">\n          <img src={iconHelmet} />\n        </HashLink>\n      </li>\n      <li title={TextManager.get(\"ui-adventurer-info-inventory-title\")}>\n        <HashLink smooth to={\"#inventory\" }>\n          <img src={iconSword} />\n        </HashLink>\n      </li>\n    </ul>\n  )\n}\n\nexport default AdventurerSectionSelection;\n","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALEAAADyCAMAAAA1O9Q1AAAKQ2lDQ1BJQ0MgcHJvZmlsZQAAeNqdU3dYk/cWPt/3ZQ9WQtjwsZdsgQAiI6wIyBBZohCSAGGEEBJAxYWIClYUFRGcSFXEgtUKSJ2I4qAouGdBiohai1VcOO4f3Ke1fXrv7e371/u855zn/M55zw+AERImkeaiagA5UoU8Otgfj09IxMm9gAIVSOAEIBDmy8JnBcUAAPADeXh+dLA//AGvbwACAHDVLiQSx+H/g7pQJlcAIJEA4CIS5wsBkFIAyC5UyBQAyBgAsFOzZAoAlAAAbHl8QiIAqg0A7PRJPgUA2KmT3BcA2KIcqQgAjQEAmShHJAJAuwBgVYFSLALAwgCgrEAiLgTArgGAWbYyRwKAvQUAdo5YkA9AYACAmUIszAAgOAIAQx4TzQMgTAOgMNK/4KlfcIW4SAEAwMuVzZdL0jMUuJXQGnfy8ODiIeLCbLFCYRcpEGYJ5CKcl5sjE0jnA0zODAAAGvnRwf44P5Dn5uTh5mbnbO/0xaL+a/BvIj4h8d/+vIwCBAAQTs/v2l/l5dYDcMcBsHW/a6lbANpWAGjf+V0z2wmgWgrQevmLeTj8QB6eoVDIPB0cCgsL7SViob0w44s+/zPhb+CLfvb8QB7+23rwAHGaQJmtwKOD/XFhbnauUo7nywRCMW735yP+x4V//Y4p0eI0sVwsFYrxWIm4UCJNx3m5UpFEIcmV4hLpfzLxH5b9CZN3DQCshk/ATrYHtctswH7uAQKLDljSdgBAfvMtjBoLkQAQZzQyefcAAJO/+Y9AKwEAzZek4wAAvOgYXKiUF0zGCAAARKCBKrBBBwzBFKzADpzBHbzAFwJhBkRADCTAPBBCBuSAHAqhGJZBGVTAOtgEtbADGqARmuEQtMExOA3n4BJcgetwFwZgGJ7CGLyGCQRByAgTYSE6iBFijtgizggXmY4EImFINJKApCDpiBRRIsXIcqQCqUJqkV1II/ItchQ5jVxA+pDbyCAyivyKvEcxlIGyUQPUAnVAuagfGorGoHPRdDQPXYCWomvRGrQePYC2oqfRS+h1dAB9io5jgNExDmaM2WFcjIdFYIlYGibHFmPlWDVWjzVjHVg3dhUbwJ5h7wgkAouAE+wIXoQQwmyCkJBHWExYQ6gl7CO0EroIVwmDhDHCJyKTqE+0JXoS+cR4YjqxkFhGrCbuIR4hniVeJw4TX5NIJA7JkuROCiElkDJJC0lrSNtILaRTpD7SEGmcTCbrkG3J3uQIsoCsIJeRt5APkE+S+8nD5LcUOsWI4kwJoiRSpJQSSjVlP+UEpZ8yQpmgqlHNqZ7UCKqIOp9aSW2gdlAvU4epEzR1miXNmxZDy6Qto9XQmmlnafdoL+l0ugndgx5Fl9CX0mvoB+nn6YP0dwwNhg2Dx0hiKBlrGXsZpxi3GS+ZTKYF05eZyFQw1zIbmWeYD5hvVVgq9ip8FZHKEpU6lVaVfpXnqlRVc1U/1XmqC1SrVQ+rXlZ9pkZVs1DjqQnUFqvVqR1Vu6k2rs5Sd1KPUM9RX6O+X/2C+mMNsoaFRqCGSKNUY7fGGY0hFsYyZfFYQtZyVgPrLGuYTWJbsvnsTHYF+xt2L3tMU0NzqmasZpFmneZxzQEOxrHg8DnZnErOIc4NznstAy0/LbHWaq1mrX6tN9p62r7aYu1y7Rbt69rvdXCdQJ0snfU6bTr3dQm6NrpRuoW623XP6j7TY+t56Qn1yvUO6d3RR/Vt9KP1F+rv1u/RHzcwNAg2kBlsMThj8MyQY+hrmGm40fCE4agRy2i6kcRoo9FJoye4Ju6HZ+M1eBc+ZqxvHGKsNN5l3Gs8YWJpMtukxKTF5L4pzZRrmma60bTTdMzMyCzcrNisyeyOOdWca55hvtm82/yNhaVFnMVKizaLx5balnzLBZZNlvesmFY+VnlW9VbXrEnWXOss623WV2xQG1ebDJs6m8u2qK2brcR2m23fFOIUjynSKfVTbtox7PzsCuya7AbtOfZh9iX2bfbPHcwcEh3WO3Q7fHJ0dcx2bHC866ThNMOpxKnD6VdnG2ehc53zNRemS5DLEpd2lxdTbaeKp26fesuV5RruutK10/Wjm7ub3K3ZbdTdzD3Ffav7TS6bG8ldwz3vQfTw91jicczjnaebp8LzkOcvXnZeWV77vR5Ps5wmntYwbcjbxFvgvct7YDo+PWX6zukDPsY+Ap96n4e+pr4i3z2+I37Wfpl+B/ye+zv6y/2P+L/hefIW8U4FYAHBAeUBvYEagbMDawMfBJkEpQc1BY0FuwYvDD4VQgwJDVkfcpNvwBfyG/ljM9xnLJrRFcoInRVaG/owzCZMHtYRjobPCN8Qfm+m+UzpzLYIiOBHbIi4H2kZmRf5fRQpKjKqLupRtFN0cXT3LNas5Fn7Z72O8Y+pjLk722q2cnZnrGpsUmxj7Ju4gLiquIF4h/hF8ZcSdBMkCe2J5MTYxD2J43MC52yaM5zkmlSWdGOu5dyiuRfm6c7Lnnc8WTVZkHw4hZgSl7I/5YMgQlAvGE/lp25NHRPyhJuFT0W+oo2iUbG3uEo8kuadVpX2ON07fUP6aIZPRnXGMwlPUit5kRmSuSPzTVZE1t6sz9lx2S05lJyUnKNSDWmWtCvXMLcot09mKyuTDeR55m3KG5OHyvfkI/lz89sVbIVM0aO0Uq5QDhZML6greFsYW3i4SL1IWtQz32b+6vkjC4IWfL2QsFC4sLPYuHhZ8eAiv0W7FiOLUxd3LjFdUrpkeGnw0n3LaMuylv1Q4lhSVfJqedzyjlKD0qWlQyuCVzSVqZTJy26u9Fq5YxVhlWRV72qX1VtWfyoXlV+scKyorviwRrjm4ldOX9V89Xlt2treSrfK7etI66Trbqz3Wb+vSr1qQdXQhvANrRvxjeUbX21K3nShemr1js20zcrNAzVhNe1bzLas2/KhNqP2ep1/XctW/a2rt77ZJtrWv913e/MOgx0VO97vlOy8tSt4V2u9RX31btLugt2PGmIbur/mft24R3dPxZ6Pe6V7B/ZF7+tqdG9s3K+/v7IJbVI2jR5IOnDlm4Bv2pvtmne1cFoqDsJB5cEn36Z8e+NQ6KHOw9zDzd+Zf7f1COtIeSvSOr91rC2jbaA9ob3v6IyjnR1eHUe+t/9+7zHjY3XHNY9XnqCdKD3x+eSCk+OnZKeenU4/PdSZ3Hn3TPyZa11RXb1nQ8+ePxd07ky3X/fJ897nj13wvHD0Ivdi2yW3S609rj1HfnD94UivW2/rZffL7Vc8rnT0Tes70e/Tf/pqwNVz1/jXLl2feb3vxuwbt24m3Ry4Jbr1+Hb27Rd3Cu5M3F16j3iv/L7a/eoH+g/qf7T+sWXAbeD4YMBgz8NZD+8OCYee/pT/04fh0kfMR9UjRiONj50fHxsNGr3yZM6T4aeypxPPyn5W/3nrc6vn3/3i+0vPWPzY8Av5i8+/rnmp83Lvq6mvOscjxx+8znk98ab8rc7bfe+477rfx70fmSj8QP5Q89H6Y8en0E/3Pud8/vwv94Tz+4A5JREAAAAZdEVYdFNvZnR3YXJlAEFkb2JlIEltYWdlUmVhZHlxyWU8AAADcWlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDIgNzkuMTYwOTI0LCAyMDE3LzA3LzEzLTAxOjA2OjM5ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIgeG1wTU06T3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOjNmZjJmYzA3LThiNGEtNjQ0Yi1iMjNkLTViMDFlOWRlOGVjZSIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo2RDkzMzJCMjUxNkExMUVBOUM3MDk0RTkwOTBCRTk4NiIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo2RDkzMzJCMTUxNkExMUVBOUM3MDk0RTkwOTBCRTk4NiIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgKFdpbmRvd3MpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6N2RhZTkyNzMtYWI4NC03OTQ0LThjZjctZjliMTFkZjk3MTk4IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjNmZjJmYzA3LThiNGEtNjQ0Yi1iMjNkLTViMDFlOWRlOGVjZSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PvfQy5UAAAAGUExURf///////1V89WwAAAACdFJOU/8A5bcwSgAAAkZJREFUeNrs3cGO4yAUBdHi/396dqPuie3IgOFdT9U+4ixa6gTDM21qHDV5iYe189Ws4E5Fs4g7D81C7xwzS70zzCz2jptZ7h01swM8RGaHd8jMJnA/mV3gbjLbwL1k9oE7yezzdprZCg4Us0IMe8lsBt8nsxt8m8x28F3y28Wwn0wB8D3yu8VQgUwJ8B3ym8VQg/xiMRQhK64jhipkxWXEUIasuIoY6pAVK1ZcVgyFyIoVK1asWLFixUvFfttUrFixu1iK3fFW7NMxxc+KfZK+QOyJkAXivHNCnh5bIc47U+hJ0xXivPPHgWe8A8/RB95VCLzBMpHcVonj7jW1wLtjgffzAu9AjpoHlm1byG2PuNs8tmZbT247xXn3/m+bJyzX2kLzlMXanBZx2/88h+WCPXuFlpbiyuKehy4z/rqn/Wp65kOP71f0fOhRccd/tq17m2F79GnPTNNOhLCuKWLWNi6GYmSKeb+bKef9ZqYi+JJMSfAVmZLey+8oVcGnZMqCz8jUBZ+QKQw+JlMZfEimNPiITG3wAZni4E8y1cEfZMqD/yVTHxwo5lwMAWQSwL/I0WKIIJMB/kEOFkMIOVcMKWRiwIFissWQQw4VQxA5UwxJZMVLxBBFVqz4SExWihW/Q2xmZmZmZmZmZmZmZmZmZmZmZmZmZmZmVUq7DxJ8azMCHTVx43i2QsromOJTpj68pee7HXHrzik80dact3nJbdXeOv5Ne2+acAFs14zprdiRyeN7sPveaNJHXf8miDHo3/4IMAAA0TKWRcqboAAAAABJRU5ErkJggg==\"","export default \"data:image/png;base64,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UmVhZHlxyWU8AAADcWlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDIgNzkuMTYwOTI0LCAyMDE3LzA3LzEzLTAxOjA2OjM5ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIgeG1wTU06T3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOjNmZjJmYzA3LThiNGEtNjQ0Yi1iMjNkLTViMDFlOWRlOGVjZSIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDoyNzBDNjVEMjUxNzExMUVBODM1MkY4N0UwMUZBQ0UxNyIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDoyNzBDNjVEMTUxNzExMUVBODM1MkY4N0UwMUZBQ0UxNyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgKFdpbmRvd3MpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6ODUyMmFiMmUtMjAyMS1hYTQ0LWE2NGUtODI3YjBkYzg0NTA5IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjNmZjJmYzA3LThiNGEtNjQ0Yi1iMjNkLTViMDFlOWRlOGVjZSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PtCL+cMAAAAGUExURf///////1V89WwAAAACdFJOU/8A5bcwSgAAA49JREFUeNrs3VFy3DAMA1Dg/pfuBTqTFQlqBBP8TKw1X+S0WWpFgVcD/4nLGQQccMABBxxwwAEHHHDAAQcccMABBxxwwAEHvAGMP+M7YByEPRiFsAWjEX5gtMMKDEm4gCEMAzDE8TgYA/EwGEPxKBiD8SAYw/EYGBfiJTBgI4YNV0SGk1chhhNXQYaZty2GGbdNxlUvf/7imBi3vH8V8W6JccP7a9XyhhjT3tMy7bQYo9xaXXqUjEFvvRA/KMaYt7fyMCbGjFex1DIjxoT3bOjIjZTgThqCy5tiyL3Hg+fuJgH3EhANaYhx1UvVmLpYCq4NH79pB9y9tXBYUQyZt/wCd+5cAvfvqh1ZEeOql+KhBTGueqkeey7WgHkDzMtgzQOlH376U7vq5cT4w1+M9q14E8xrYNV/+yOvcPSP/VWvIrp/CQT8uLebDOy8zXRaYPItsQr8mreVUQNMPifWgOEDxiSYtJxieHrraQVs4i0nVgSTr4q7YLiBMQImbacYthNcTA6+E1zLrgImnxZ3wHAEQw0mnacYzhNcyTBgqye6kCKsJ7iQI7wn+DzJgP94LdJBXAPDF4yAq2DS/ZkO2O2JPk00YLsn+jDTgNeC4Q2GBEz6T3HAAQe8B0waic9qQrd7TfQqWG59FwIOOOCAAw444IADDjjggAMOOOCAAx7K9rNFvJRpAw444M+CP70gns94BLwBnE/ifQmcT9OuBOcT8V8Cr9vkkW08O8Ff3oq3brNlttN+HrxuS/y+pgfr2lqkcclTYgyA1zUf2tdeal0DsX0t4tL18PPgdY0897VqXdeMd1+75XUNtfe1TF/XFD/nPHwfvO7okn2H0+w7fmjdAVP7jhDbd0jcumMA9x30uO8oz32Hte47jnffgcvrjtTed2h676x6weXNd6eVN7SNNPpXd9+Nl97BSzf4QX8XOfinTY898Ngmz2KNprqPs3GZqLpULUoVt66WL5JV0+pVuNJ23doVyuJho+xY2aN8/l11sbRTZy1szD77zkRxuFVYPt+O/vMXx/bg9yrphj0HuksHdi0W2mslbi0lBItDTlwJmE5eapb/bLgqMG28lC3wenCF4FmyMEvyfbI0R/J1sjhD8m2yPD/yZfJAdpyIV7VjYAV5KjGOxYPaWXAVPZwRx+Md7CXw4DLCw+DCUkvAAQcccMABBxxwwAEHHHDAAQcccMABBxxwwB8E/xNgADKop7nSnBUxAAAAAElFTkSuQmCC\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALAAAADsCAMAAADjJdzgAAAKQ2lDQ1BJQ0MgcHJvZmlsZQAAeNqdU3dYk/cWPt/3ZQ9WQtjwsZdsgQAiI6wIyBBZohCSAGGEEBJAxYWIClYUFRGcSFXEgtUKSJ2I4qAouGdBiohai1VcOO4f3Ke1fXrv7e371/u855zn/M55zw+AERImkeaiagA5UoU8Otgfj09IxMm9gAIVSOAEIBDmy8JnBcUAAPADeXh+dLA//AGvbwACAHDVLiQSx+H/g7pQJlcAIJEA4CIS5wsBkFIAyC5UyBQAyBgAsFOzZAoAlAAAbHl8QiIAqg0A7PRJPgUA2KmT3BcA2KIcqQgAjQEAmShHJAJAuwBgVYFSLALAwgCgrEAiLgTArgGAWbYyRwKAvQUAdo5YkA9AYACAmUIszAAgOAIAQx4TzQMgTAOgMNK/4KlfcIW4SAEAwMuVzZdL0jMUuJXQGnfy8ODiIeLCbLFCYRcpEGYJ5CKcl5sjE0jnA0zODAAAGvnRwf44P5Dn5uTh5mbnbO/0xaL+a/BvIj4h8d/+vIwCBAAQTs/v2l/l5dYDcMcBsHW/a6lbANpWAGjf+V0z2wmgWgrQevmLeTj8QB6eoVDIPB0cCgsL7SViob0w44s+/zPhb+CLfvb8QB7+23rwAHGaQJmtwKOD/XFhbnauUo7nywRCMW735yP+x4V//Y4p0eI0sVwsFYrxWIm4UCJNx3m5UpFEIcmV4hLpfzLxH5b9CZN3DQCshk/ATrYHtctswH7uAQKLDljSdgBAfvMtjBoLkQAQZzQyefcAAJO/+Y9AKwEAzZek4wAAvOgYXKiUF0zGCAAARKCBKrBBBwzBFKzADpzBHbzAFwJhBkRADCTAPBBCBuSAHAqhGJZBGVTAOtgEtbADGqARmuEQtMExOA3n4BJcgetwFwZgGJ7CGLyGCQRByAgTYSE6iBFijtgizggXmY4EImFINJKApCDpiBRRIsXIcqQCqUJqkV1II/ItchQ5jVxA+pDbyCAyivyKvEcxlIGyUQPUAnVAuagfGorGoHPRdDQPXYCWomvRGrQePYC2oqfRS+h1dAB9io5jgNExDmaM2WFcjIdFYIlYGibHFmPlWDVWjzVjHVg3dhUbwJ5h7wgkAouAE+wIXoQQwmyCkJBHWExYQ6gl7CO0EroIVwmDhDHCJyKTqE+0JXoS+cR4YjqxkFhGrCbuIR4hniVeJw4TX5NIJA7JkuROCiElkDJJC0lrSNtILaRTpD7SEGmcTCbrkG3J3uQIsoCsIJeRt5APkE+S+8nD5LcUOsWI4kwJoiRSpJQSSjVlP+UEpZ8yQpmgqlHNqZ7UCKqIOp9aSW2gdlAvU4epEzR1miXNmxZDy6Qto9XQmmlnafdoL+l0ugndgx5Fl9CX0mvoB+nn6YP0dwwNhg2Dx0hiKBlrGXsZpxi3GS+ZTKYF05eZyFQw1zIbmWeYD5hvVVgq9ip8FZHKEpU6lVaVfpXnqlRVc1U/1XmqC1SrVQ+rXlZ9pkZVs1DjqQnUFqvVqR1Vu6k2rs5Sd1KPUM9RX6O+X/2C+mMNsoaFRqCGSKNUY7fGGY0hFsYyZfFYQtZyVgPrLGuYTWJbsvnsTHYF+xt2L3tMU0NzqmasZpFmneZxzQEOxrHg8DnZnErOIc4NznstAy0/LbHWaq1mrX6tN9p62r7aYu1y7Rbt69rvdXCdQJ0snfU6bTr3dQm6NrpRuoW623XP6j7TY+t56Qn1yvUO6d3RR/Vt9KP1F+rv1u/RHzcwNAg2kBlsMThj8MyQY+hrmGm40fCE4agRy2i6kcRoo9FJoye4Ju6HZ+M1eBc+ZqxvHGKsNN5l3Gs8YWJpMtukxKTF5L4pzZRrmma60bTTdMzMyCzcrNisyeyOOdWca55hvtm82/yNhaVFnMVKizaLx5balnzLBZZNlvesmFY+VnlW9VbXrEnWXOss623WV2xQG1ebDJs6m8u2qK2brcR2m23fFOIUjynSKfVTbtox7PzsCuya7AbtOfZh9iX2bfbPHcwcEh3WO3Q7fHJ0dcx2bHC866ThNMOpxKnD6VdnG2ehc53zNRemS5DLEpd2lxdTbaeKp26fesuV5RruutK10/Wjm7ub3K3ZbdTdzD3Ffav7TS6bG8ldwz3vQfTw91jicczjnaebp8LzkOcvXnZeWV77vR5Ps5wmntYwbcjbxFvgvct7YDo+PWX6zukDPsY+Ap96n4e+pr4i3z2+I37Wfpl+B/ye+zv6y/2P+L/hefIW8U4FYAHBAeUBvYEagbMDawMfBJkEpQc1BY0FuwYvDD4VQgwJDVkfcpNvwBfyG/ljM9xnLJrRFcoInRVaG/owzCZMHtYRjobPCN8Qfm+m+UzpzLYIiOBHbIi4H2kZmRf5fRQpKjKqLupRtFN0cXT3LNas5Fn7Z72O8Y+pjLk722q2cnZnrGpsUmxj7Ju4gLiquIF4h/hF8ZcSdBMkCe2J5MTYxD2J43MC52yaM5zkmlSWdGOu5dyiuRfm6c7Lnnc8WTVZkHw4hZgSl7I/5YMgQlAvGE/lp25NHRPyhJuFT0W+oo2iUbG3uEo8kuadVpX2ON07fUP6aIZPRnXGMwlPUit5kRmSuSPzTVZE1t6sz9lx2S05lJyUnKNSDWmWtCvXMLcot09mKyuTDeR55m3KG5OHyvfkI/lz89sVbIVM0aO0Uq5QDhZML6greFsYW3i4SL1IWtQz32b+6vkjC4IWfL2QsFC4sLPYuHhZ8eAiv0W7FiOLUxd3LjFdUrpkeGnw0n3LaMuylv1Q4lhSVfJqedzyjlKD0qWlQyuCVzSVqZTJy26u9Fq5YxVhlWRV72qX1VtWfyoXlV+scKyorviwRrjm4ldOX9V89Xlt2treSrfK7etI66Trbqz3Wb+vSr1qQdXQhvANrRvxjeUbX21K3nShemr1js20zcrNAzVhNe1bzLas2/KhNqP2ep1/XctW/a2rt77ZJtrWv913e/MOgx0VO97vlOy8tSt4V2u9RX31btLugt2PGmIbur/mft24R3dPxZ6Pe6V7B/ZF7+tqdG9s3K+/v7IJbVI2jR5IOnDlm4Bv2pvtmne1cFoqDsJB5cEn36Z8e+NQ6KHOw9zDzd+Zf7f1COtIeSvSOr91rC2jbaA9ob3v6IyjnR1eHUe+t/9+7zHjY3XHNY9XnqCdKD3x+eSCk+OnZKeenU4/PdSZ3Hn3TPyZa11RXb1nQ8+ePxd07ky3X/fJ897nj13wvHD0Ivdi2yW3S609rj1HfnD94UivW2/rZffL7Vc8rnT0Tes70e/Tf/pqwNVz1/jXLl2feb3vxuwbt24m3Ry4Jbr1+Hb27Rd3Cu5M3F16j3iv/L7a/eoH+g/qf7T+sWXAbeD4YMBgz8NZD+8OCYee/pT/04fh0kfMR9UjRiONj50fHxsNGr3yZM6T4aeypxPPyn5W/3nrc6vn3/3i+0vPWPzY8Av5i8+/rnmp83Lvq6mvOscjxx+8znk98ab8rc7bfe+477rfx70fmSj8QP5Q89H6Y8en0E/3Pud8/vwv94Tz+4A5JREAAAAZdEVYdFNvZnR3YXJlAEFkb2JlIEltYWdlUmVhZHlxyWU8AAADcWlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDIgNzkuMTYwOTI0LCAyMDE3LzA3LzEzLTAxOjA2OjM5ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIgeG1wTU06T3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOjNmZjJmYzA3LThiNGEtNjQ0Yi1iMjNkLTViMDFlOWRlOGVjZSIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpDNDRDQkUzODUxNzUxMUVBQjM5REFCODVERTEzMUU2MSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpDNDRDQkUzNzUxNzUxMUVBQjM5REFCODVERTEzMUU2MSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgKFdpbmRvd3MpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6ZDI0YWU3ZTAtMDM1Ny04MTQ5LWJhZDQtY2Y2NjM5MWIwMWEyIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjNmZjJmYzA3LThiNGEtNjQ0Yi1iMjNkLTViMDFlOWRlOGVjZSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Pm/dvNIAAAAGUExURf///////1V89WwAAAACdFJOU/8A5bcwSgAAAlpJREFUeNrs3UFy4zAMRNHG/S89s0hNZWLJIgUSQjsf+268rVBlU7FudDorl2ymLmerCLsMrUrtCrOKtWmz6rU5sx7RJsx6jHuTrAe5t8h6lHuDrIe502Q9zp0kq4N3RqwO3BmymniHxWrCHSarj3dMrEbeIbEacYfI6uW9FquZ91Ksbt4rsdp5L8Rqx70gq6P3nVgtvW/E6uk9F6up91T8KWCpq1htvSdi9fUei9XYeyhWZ++R+APAUmuxentfxWrufRG7g6XuYrX3/hB7g6X+YmuwZCCWg/e72BgsWYh9wZKH2BYsmYgBF4ElF7EpWLIRAy4BSz5iwBVgyUgMuAAsOYkBA/YG6y9YgAEDLgUzDMMwDMMwvhMPDGDAgAEDBlz442k3L+C+f1zxlNcPLDevH1hu3kqxfilYbt4qsdvXs9v3vtmJwu2oYnYH8rpd+dzcvO6EbpdNt1usAAMGDBgwYMCAAQMGDBgwYMCAAQMGDBgwYMCAAQMGDBgwYMCAAQMGDBgwYMCAAQMGDBgwYMCAAQMGDBgwYMCAAX80OLzAqdci6sGRe/GkHByRe8ipGPwVTXSUgv9FEyWV4HgFz9fUgb9HEz1l4DgDTzYVgX9EE10l4JdooqwCHNfg8br94KNoonA3+DiaaNwMjhnwUOdW8Gk00boR/CaaqN0Hjnvgq+Jd4PfRRPUe8FU00b0FHFnwm/YN4IFoon85eCiaWLAaHOvAxyvWgkejiSUrwePRxJaF4NgBftmzDDwVTSxaBY594P9XrQHPRu8vi1ggnk/eXhaxQDwf/CPAAEWCOZah9n1oAAAAAElFTkSuQmCC\"","export default \"data:image/png;base64,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UmVhZHlxyWU8AAADcWlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDIgNzkuMTYwOTI0LCAyMDE3LzA3LzEzLTAxOjA2OjM5ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIgeG1wTU06T3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOjNmZjJmYzA3LThiNGEtNjQ0Yi1iMjNkLTViMDFlOWRlOGVjZSIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo5OTY0QUNENDUxNzQxMUVBQjZGRENDOUJGNDMzNjU3NCIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo5OTY0QUNEMzUxNzQxMUVBQjZGRENDOUJGNDMzNjU3NCIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgKFdpbmRvd3MpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6ZDI0YWU3ZTAtMDM1Ny04MTQ5LWJhZDQtY2Y2NjM5MWIwMWEyIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjNmZjJmYzA3LThiNGEtNjQ0Yi1iMjNkLTViMDFlOWRlOGVjZSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PpwgK6gAAAAGUExURf///////1V89WwAAAACdFJOU/8A5bcwSgAAA19JREFUeNrc21ty4zAMRNHG/jc9qfm3RcjEo683EJ2STQINRGH50eEHjRMaJzROaJzQOKFxQuOExgmNExonNE5onNA4oXFC44TGCY0TGic0Tmic0DihcULjhMYJjRMaJzROaJzQOKFxQuOExgmNExonNE5onNBvTuivpdC/OaEPFKFPS6GvApFxm3QF15zIuD26kgJFZNwWXVFpKTJuh66sKRAZt0FX2M6JjJvXlTbiIuOmdcURisi4WV15+CUyblLXEFuKjJvTtQTOIuOmdE2jApFxM7q2IY/IuAld43hOZFy/rnWwKjKuW9c8EhcZ16trX2YQGdepG1hDERnXpxtZIBIZ16UbWv0SGdejG1vaExnXoRtctxQZV68bXZQVGVetG15xFhlXqxtfThcZV6lb8G8FIuPqdBtwZboVuCrdDlyRbgmuRrcFV6Jbg6vQ7cEV6Bbh7us24a7rVuFu63bhLuuW4e7qtuGu6tbhbur24S7qFuLu6Tbi4tYy0krc48OfLoasxJ3oZIs70skVd6aTKS4OH9wTd6qTJe5YJ0fcuU6GuAfd41/fjcvoZIdL6eSGy+lkhovkTeaFy+pkhUvr5ITL62SEe6GTD+6r7vPzmOCiq/ofwSXvOzNc9DWmA7jD3twUF52ZSTvuIK40xkVvnNeMO4qabXHRnTS34g7HBKa4gSFII+54wmWJO5/fOeIS00lDXGb26odLTZbtcLm5uRsuuRVghsvuPHjh0hsdVrj8vooT7sU2jhGu8d2Fgc4K13ZmhoHODNdUq4SBzg7X0iOEgc4Q19Cbh4HOEleeiYWBzhRXnEWHgc4WVzoDCgOdMa5y9mqgs4pRsjqvCCypM4svc7pzhOFtnnlDdpVY7utnVkVnf1tWHVD+4DDqXt+cijbJw7sj3yQ1enufWSR+7y9rg7T2l0pkfdL+W5m1fEryaw25esL1e4G8eDp5o/pfO1m+09os3Qq41bet3Oi415Tue3dXO+5tN8LlOGFXnXk9K9nUvRYEQXsSP6cINq2D4kJk3H8dFhci4/50YFxiUhBkXZB14akLMO7wzAxfXWBxR7VKeOsCijvoEcJfF0jcY28eDF0AcQ+ZWHB0gcN9TWuDpQsY7suUJHi6QOE+TieDqQsQ7sNWAAQX/wQYAPYPhm0aAm5YAAAAAElFTkSuQmCC\"","import { Fragment } from \"react\";\nimport resourceDescriptions from \"definitions/resources\";\nimport { WarehouseStructureDefinition } from 'definitions/structures/types';\nimport { Resource } from 'definitions/resources';\nimport Icon from 'components/ui/common/Icon';\nimport { TextManager } from 'global/TextManager';\nimport { useStructureDefinition } from \"hooks/store/structures\";\nimport \"./styles/upgradeHelpModalContent.scss\"\n\nexport interface Props  {\n  level: number;\n}\n\nconst UpgradeHelpModalContent = (props: Props) => {\n  const { level } = props;\n  const structureDefinition = useStructureDefinition<WarehouseStructureDefinition>(\"warehouse\");\n\n  const currentLevel = structureDefinition.levels[level];\n  const nextLevel = structureDefinition.levels[level + 1];\n\n  const renderRow = (resource: Resource) => {\n    const resourceDescription = resourceDescriptions[resource];\n\n    return (\n      <Fragment key={resource}>\n        <div><Icon image={resourceDescription.iconImg} size=\"smallest\"/></div>\n        <div>{TextManager.getResourceName(resource)}</div>\n        <div className=\"number\">{currentLevel.maxResources[resource]}</div>\n        <div className=\"arrow\">»</div>\n        <div className=\"number\">{nextLevel.maxResources[resource]}</div>\n      </Fragment>\n    )\n  }\n\n  return (\n    <div className=\"upgrade-help-model-content-warehouse\">\n      <h3>{TextManager.get(\"ui-structure-help-upgrade-improvements\")}</h3>\n      <div className=\"storage-increase\">\n        <div className=\"header\"/>\n        <div className=\"header\">\n          {TextManager.get(\"ui-structure-warehouse-help-upgrade-header-capacity\")}\n        </div>\n        <div className=\"header number\">\n          {TextManager.get(\"ui-structure-help-upgrade-header-level\", {\n            level: level + 1\n          })}\n        </div>\n        <div className=\"header\"/>\n        <div className=\"header number\">\n        {TextManager.get(\"ui-structure-help-upgrade-header-level\", {\n            level: level + 2\n          })}\n        </div>\n        {Object.keys(nextLevel.maxResources).map(res => renderRow(res as Resource))}\n      </div>\n    </div>\n  )\n}\n\nexport default UpgradeHelpModalContent;\n","import { useEffect, useMemo, useState } from \"react\";\nimport { useDragDropManager } from \"react-dnd\";\nimport Inventory from \"components/ui/inventory/Inventory\";\nimport { DragSourceType, DragType } from \"constants/dragging\";\nimport { useStockpileState } from \"hooks/store/stockpile\";\nimport useItemDropActions from \"hooks/actions/useItemActions\";\nimport { Item, ItemCategory } from \"definitions/items/types\";\nimport Tabstrip from \"components/ui/tabs/Tabstrip\";\nimport Tab from \"components/ui/tabs/Tab\";\nimport { StockpileStoreState } from \"store/types/stockpile\";\nimport { TextManager } from \"global/TextManager\";\nimport { getDefinition } from \"definitions/items\";\nimport { InventoryItemDragInfo } from \"components/ui/items/DraggableItemIcon\";\nimport \"./styles/stockpile.scss\"\n\nconst WAREHOUSE = DragSourceType.warehouse;\n\nconst Stockpile = () => {\n  const stockpile = useStockpileState();\n  const { dropItemWarehouse } = useItemDropActions();\n  const [selectedItemCategory, setSelectedItemCategory] = useState<string>(Object.keys(stockpile)[0]);\n\n  const handleDropItemWarehouse = (item: Item, fromSlot: number, toSlot: number, sourceType: DragSourceType, sourceId?: string): void => {\n    dropItemWarehouse(item, fromSlot, toSlot, sourceType, sourceId);\n  }\n  const dragDropManager = useDragDropManager()\n  const dragging = dragDropManager.getMonitor().isDragging();\n\n  useEffect(() => {\n    // If we're dragging some item, switch to the appropriate category so we can drop it here\n    if (dragging) {\n      const dragItem: InventoryItemDragInfo = dragDropManager.getMonitor().getItem();\n      const dragItemType = dragDropManager.getMonitor().getItemType();\n\n      if (dragItem && dragItemType === DragType.ITEM) {\n        const item = dragItem.item;\n        const definition = getDefinition(item.type)\n        setSelectedItemCategory(ItemCategory[definition.itemCategory]);\n      }\n    }\n  }, [dragging]);\n\n  const handleCheckDropItem = (dragInfo: InventoryItemDragInfo) => {\n    // can only drop on the appropriate category\n    const definition = getDefinition(dragInfo.item.type)\n    return (definition.itemCategory === ItemCategory[selectedItemCategory as keyof typeof ItemCategory])\n  }\n\n  const items = useMemo(() => {\n    return stockpile[selectedItemCategory as keyof StockpileStoreState]\n  }, [selectedItemCategory, stockpile])\n\n  return (\n    <div className=\"stockpile\">\n      <Tabstrip className=\"tabs auto-collapse\" onTabSelected={setSelectedItemCategory} activeTab={selectedItemCategory}>\n      {Object.keys(stockpile).map((itemCategory) => {\n        return (\n          <Tab id={itemCategory} key={itemCategory}>\n            {TextManager.getItemCategory(ItemCategory[itemCategory as keyof typeof ItemCategory])}\n          </Tab>);\n        }\n      )}\n      </Tabstrip>\n      <Inventory\n        sourceType={WAREHOUSE}\n        className=\"inventory-large\"\n        items={items}\n        onDropItem={handleDropItemWarehouse}\n        // onStartDrag={handleStartDrag}\n        canDropHere={handleCheckDropItem}\n      />\n    </div>\n  )\n}\n\nexport default Stockpile\n","import ResourcesBox from \"components/structures/warehouse/ResourcesBox\";\nimport { WarehouseStructureLevelDefinition } from \"definitions/structures/types\";\nimport usePrevious from \"hooks/usePrevious\";\nimport { useEffect, useRef, useState } from \"react\";\nimport { empty, ResourceStoreState } from \"store/types/resources\";\nimport { StructuresStoreState } from \"store/types/structures\";\nimport { TextManager } from \"global/TextManager\";\nimport { TooltipManager } from 'global/TooltipManager';\nimport AdventurerTabstrip from 'components/world/QuestPanel/AdventurerTabstrip';\nimport { useStructureLevel, useStructureState } from 'hooks/store/structures';\nimport { useResourcesState } from 'hooks/store/resources';\nimport { useSelector } from 'react-redux';\nimport { StoreState } from 'store/types';\nimport { useAdventurersInTown } from 'hooks/store/adventurers';\nimport StructureLevel from '../StructureLevel';\nimport AdventurerPanel from 'components/ui/adventurer/AdventurerPanel';\nimport { ContextType } from 'constants/context';\nimport { Resource } from \"definitions/resources\";\nimport UpgradeHelpModal from \"../UpgradeHelpModal\";\nimport UpgradeHelpModalContent from \"./UpgradeHelpModalContent\";\nimport Stockpile from \"./Stockpile\";\nimport { Channel, SoundManager } from \"global/SoundManager\";\nimport \"./styles/warehouseStructureView.scss\";\n\n\nconst WarehouseStructureView = () => {\n\n  const adventurersInTown = useAdventurersInTown();\n  const [selectedAdventurer, setSelectedAdventurer] = useState<string>(adventurersInTown[0]?.id);\n  const resources = useResourcesState();\n  const [resourcesDelta, setResourcesDelta] = useState<ResourceStoreState>(empty);  // updating this will trigger animation\n  const previousResources = usePrevious(resources);\n  const resourcesRef = useRef<HTMLFieldSetElement>(null);\n  const structuresState = useSelector<StoreState, StructuresStoreState>(store => store.structures);\n\n  useEffect(() => {\n    SoundManager.addSound(\"ambient/structure/warehouse\", \"sound/structures/warehouse.ogg\", () => {\n      SoundManager.playSound(\"ambient/structure/warehouse\", Channel.ambient, true);\n    })\n    return () => SoundManager.fadeOutSound(Channel.ambient);\n  }, []);\n\n  useEffect(() => {\n    // Calculate delta\n    const delta = Object.keys(resources).reduce<ResourceStoreState>((acc, value) => {\n      const resource = value as Resource;\n      if (previousResources && previousResources[resource]) {\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        acc[resource] = resources[resource]! - previousResources[resource]!;\n      }\n      return acc;\n    }, {});\n\n    setResourcesDelta(delta);\n  }, [resources, previousResources]);\n\n  const structureState = useStructureState(\"warehouse\");\n  const { level } = structureState;\n  const levelDefinition = useStructureLevel<WarehouseStructureLevelDefinition>(\"warehouse\");\n\n\n  const handleAdventurerTabSelected = (tabId: string) => {\n    setSelectedAdventurer(tabId);\n  };\n\n  const handleHelpClicked = (event: React.MouseEvent) => {\n    const origin = (event.currentTarget as HTMLElement);\n    const originRect = origin.getBoundingClientRect();\n    const content = (\n      <UpgradeHelpModal level={level} structure={\"warehouse\"}>\n        <UpgradeHelpModalContent level={level} />\n      </UpgradeHelpModal>\n    );\n    TooltipManager.showContextTooltip(ContextType.component, content, originRect, \"upgrade-structure-tooltip\");\n\n    event.stopPropagation();\n  }\n\n  return (\n    <div className=\"warehouse-structureview\">\n      <StructureLevel structure={\"warehouse\"} onHelpClicked={handleHelpClicked} />\n      <fieldset className=\"resources\" ref={resourcesRef}>\n        <legend>{TextManager.get(\"ui-structure-warehouse-resources\")}</legend>\n        <ResourcesBox\n          resources={resources}\n          structures={structuresState}\n          maxResources={levelDefinition.maxResources}\n          deltaResources={resourcesDelta}\n        />\n      </fieldset>\n      <h3>{TextManager.get(\"ui-structure-warehouse-stockpile\")}</h3>\n      <Stockpile />\n      <h3>{TextManager.get(\"ui-structure-warehouse-adventurers\")}</h3>\n      <div>\n        <AdventurerTabstrip\n          adventurers={adventurersInTown}\n          selectedAdventurerId={selectedAdventurer}\n          onAdventurerTabSelected={handleAdventurerTabSelected}\n        />\n        <div className=\"adventurer-inventory\">\n          { selectedAdventurer && (\n            <AdventurerPanel\n              adventurerId={selectedAdventurer}\n              horizontalMode={true}\n              traits={false}\n              skills={false}\n            />\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default WarehouseStructureView;\n","import { DragType } from \"constants/dragging\";\nimport * as React from \"react\";\nimport { ConnectDropTarget, DropTarget, DropTargetConnector, DropTargetMonitor, DropTargetSpec } from \"react-dnd\";\nimport { AdventurerAvatarDragInfo } from \"../DraggableAdventurerAvatar\";\nimport \"./styles/droppableadventurerslot.scss\";\n\nconst dropTarget: DropTargetSpec<Props> = {\n  drop(props: Props, monitor: DropTargetMonitor<AdventurerAvatarDragInfo>) {\n    props.onDrop(monitor.getItem());\n  },\n  canDrop(_props: Props, _monitor: DropTargetMonitor)  {\n    return true; // todo: can't drop on yourself\n  },\n};\n\nexport interface Props {\n  onDrop: (item: AdventurerAvatarDragInfo) => void;\n}\n\nexport interface DropSourceProps {\n  canDrop: boolean;\n  isOver: boolean;\n  connectDropTarget: ConnectDropTarget;\n}\n\nconst collect = (connect: DropTargetConnector, monitor: DropTargetMonitor) => ({\n  canDrop: monitor.canDrop(),\n  connectDropTarget: connect.dropTarget(),\n  isOver: monitor.isOver(),\n});\n\n/*\n * Can drop adventurers on this */\nconst DroppableAdventurerSlot = (props: Props & DropSourceProps) => {\n  const {\n    isOver,\n    canDrop,\n    connectDropTarget,\n  } = props;\n  // const isActive = isOver && canDrop;\n  let className = \"droppable-adventurer-slot\";\n\n  if (isOver) {\n    className += \" active-drop\";\n  } else if (canDrop) {\n    className += \" can-drop\";\n  }\n\n  return connectDropTarget(\n    <div className = { className }/>\n  );\n}\n\nexport default DropTarget<Props, DropSourceProps>(\n  DragType.ADVENTURER,\n  dropTarget,\n  collect,\n)(DroppableAdventurerSlot);\n","import { AdventurerStoreState } from \"store/types/adventurer\";\nimport AdventurerAvatar from \"components/ui/adventurer/AdventurerAvatar\";\nimport { AdventurerAvatarDragInfo } from 'components/ui/adventurer/DraggableAdventurerAvatar';\nimport DroppableAdventurerSlot from 'components/ui/adventurer/DroppableAdventurerSlot';\nimport { IconSize } from 'components/ui/common/Icon';\nimport \"./styles/assignadventurers.scss\";\n\nexport interface DispatchProps {\n  onAdventurerDropped: (item: AdventurerAvatarDragInfo, index: number) => void;\n  onAdventurerClicked: (adventurer: AdventurerStoreState) => void;\n}\n\nexport interface Props {\n  availableSlots: number;\n  assignedAventurers: AdventurerStoreState[];\n}\n\n/*\n * Displays a number of slots to drag adventurers to */\nconst AssignAdventurers = (props: Props & DispatchProps) => {\n  const slotsContent = () => {\n    const slots: JSX.Element[] = [];\n    for (let i = 0; i < props.availableSlots; i++) {\n      let content;\n      let className = \"\";\n      const hasAdventurer = !!props.assignedAventurers[i];\n\n      if (hasAdventurer) {\n        const adventurer = props.assignedAventurers[i];\n        content = (\n          <AdventurerAvatar\n            adventurer={adventurer}\n            displayName={false}\n            size={IconSize.small}\n            onClick={() => props.onAdventurerClicked(adventurer) }\n          />\n        );\n        className = \"has-adventurer\";\n      } else {\n        content = (\n          <DroppableAdventurerSlot\n            onDrop={(item: AdventurerAvatarDragInfo) => { props.onAdventurerDropped(item, i); }}\n          />\n        );\n      }\n      slots.push(\n        <li\n          key={`slot${i}`}\n          className={className}\n        >\n          {content}\n        </li>\n      );\n    }\n    return slots;\n  };\n\n  return (\n    <ul className=\"assign-adventurers\">\n      { slotsContent() }\n    </ul>\n  );\n};\n\nexport default AssignAdventurers;\n","import { ItemType } from \"definitions/items/types\";\nimport { getDefinition } from \"definitions/quests\";\nimport { AdventurerStoreState } from \"store/types/adventurer\";\nimport { QuestStoreState } from \"store/types/quest\";\nimport { TextManager } from \"global/TextManager\";\nimport AssignAdventurers from \"./AssignAdventurers\";\nimport { QuestDefinition } from 'definitions/quests/types';\nimport Button from 'components/ui/buttons/Button';\nimport ItemsBox from 'components/ui/items/ItemsBox';\nimport { AdventurerAvatarDragInfo } from 'components/ui/adventurer/DraggableAdventurerAvatar';\nimport { useStockpileStateFlat } from \"hooks/store/stockpile\";\nimport \"./styles/questboard.scss\";\n\nexport const AVAILABLE_SLOTS = 5;\nconst minimumCountAdventurers = 3;  // we need this many adventurers to start the quest\n\n\nexport interface Props {\n  availableQuests: QuestStoreState[];\n  selectedQuestName?: string;     // name of selected quest\n  assignedAventurers: AdventurerStoreState[];\n\n  onQuestClick: (questName: string) => void;\n  onAdventurerDropped: (item: AdventurerAvatarDragInfo, index: number) => void;\n  onRemoveAdventurer: (adventurer: AdventurerStoreState) => void;\n  onLaunchQuest: () => void;\n}\n\nconst QuestBoard = (props: Props) => {\n\n  const items = useStockpileStateFlat();\n  const getQuestDetails = () => {\n    if (!props.selectedQuestName) {\n      return null;\n    }\n    const quest = props.availableQuests.find((q) => q.name === props.selectedQuestName);\n    if (!quest) {\n      return (\n        <div> { TextManager.get(\"ui-structure-tavern-quest-launched\") } </div>\n      );\n    }\n    const questDefinition = getDefinition(quest.name);\n\n    // Need a full party to launch\n    const fullParty = props.assignedAventurers.filter((a) => a !== null).length >= minimumCountAdventurers;\n    // Check if we have the required items\n    const enoughItems = checkEnoughItems(questDefinition);\n\n    const canLaunch = fullParty && enoughItems;\n\n    return (\n      <div className=\"quest-details\">\n        {TextManager.getQuestDescription(props.selectedQuestName)}\n        <AssignAdventurers\n          availableSlots={AVAILABLE_SLOTS}\n          assignedAventurers={props.assignedAventurers}\n          onAdventurerClicked={props.onRemoveAdventurer}\n          onAdventurerDropped={props.onAdventurerDropped}\n        />\n        <ItemsBox items={ questDefinition.requiredItems || [] }/>\n        <Button disabled={!canLaunch} onClick = { () => props.onLaunchQuest() }>\n          {TextManager.get(\"ui-structure-tavern-button-launch-quest\")}\n        </Button>\n      </div>\n    );\n  };\n\n  /**\n   * Returns true if all the items required by the quest are in the inventory\n   */\n  const checkEnoughItems = (questDefinition: QuestDefinition): boolean => {\n    if (!questDefinition.requiredItems) {\n      return true;\n    }\n    return questDefinition.requiredItems.every((item: ItemType) => {\n      const amountRequired = (questDefinition.requiredItems)?.filter((i) => i === item).length;\n      return items.filter((i) => i === item).length >= (amountRequired ?? 0);\n    });\n  }\n\n  // quest board, expanded quest info + assign adventurers + launch button\n  return (\n    <div className=\"quest-board\">\n      <h2>\n        {TextManager.get(\"ui-structure-tavern-title-quest-board\")}\n      </h2>\n      <ul className=\"quest-list\">\n        {props.availableQuests.map((q) => {\n          const className = `quest ${(q.name === props.selectedQuestName) ? \" selected\" : \"\"}`;\n          return (\n            <li key={q.name}\n              className={className}\n              onClick={() => {props.onQuestClick(q.name);} }\n            >\n              <div\n                className=\"icon\"\n                style={{backgroundImage: `url(${process.env.PUBLIC_URL})`}}\n              />\n              <div className=\"title\">{TextManager.getQuestTitle(q.name) } </div>\n            </li>\n          );\n        })}\n      </ul>\n      { getQuestDetails() }\n    </div>\n  );\n}\n\nexport default QuestBoard;\n","import * as React from \"react\";\nimport { AdventurerStoreState } from 'store/types/adventurer';\nimport { AVAILABLE_SLOTS } from '../QuestBoard';\nimport Button from 'components/ui/buttons/Button';\nimport { TextManager } from 'global/TextManager';\nimport \"./styles/adventurerButton.scss\";\n\nexport interface Props {\n    adventurer: AdventurerStoreState;\n    assignedAventurers: AdventurerStoreState[];  // assigned to a quest in the QuestBoard\n    questName: string;\n\n    onAddAdventurer: (adventurer: AdventurerStoreState, index: number) => void;\n    onRemoveAdventurer: (adventurer: AdventurerStoreState) => void;\n}\n\n// Toggles adventurer participation in a quest\nconst AdventurerButton = (props: Props) => {\n    const {\n        adventurer,\n        assignedAventurers,\n        questName,\n        onAddAdventurer,\n        onRemoveAdventurer\n    } = props;\n\n    const isAssigned = assignedAventurers.indexOf(adventurer) > -1;\n    const quest = TextManager.getQuestTitle(questName);\n\n    const handleAddClick = () => {\n        const emptySlot = getEmptySlot(assignedAventurers);\n        onAddAdventurer(adventurer, emptySlot);\n    };\n\n    const handleRemoveClick = () => {\n        onRemoveAdventurer(adventurer);\n    }\n\n    if (isAssigned) {\n        return (\n            <Button onClick={handleRemoveClick} className=\"adventurer-button\">\n               {TextManager.get(\"ui-structure-tavern-button-leave-quest\")}\n            </Button>\n        );\n    }\n    // Skip holes\n    if (assignedAventurers.filter(Boolean).length === AVAILABLE_SLOTS) {\n        return (\n            <Button disabled={true} className=\"adventurer-button\">\n                {TextManager.get(\"ui-structure-tavern-button-join-quest-full-party\")}\n            </Button>\n        )\n    }\n    return (\n        <Button onClick={handleAddClick}  className=\"adventurer-button\">\n            {TextManager.get(\"ui-structure-tavern-button-join-quest\", { quest })}\n        </Button>\n    )\n}\n\nexport default AdventurerButton;\n\n// Finds the first array index with a falsey value\nconst getEmptySlot = (assignedAventurers: AdventurerStoreState[]) => {\n    for (let i = 0; i < AVAILABLE_SLOTS; i++) {\n        if (!assignedAventurers[i]) {\n            return i;\n        }\n    }\n    return 0;\n}","import { DragSourceType, DragType } from \"constants/dragging\";\nimport * as React from \"react\";\nimport { ConnectDragSource, DragSource, DragSourceConnector, DragSourceMonitor, DragSourceSpec } from \"react-dnd\";\nimport { AdventurerStoreState } from \"store/types/adventurer\";\nimport AdventurerAvatar, { Props as AdventurerAvatarProps } from '../AdventurerAvatar';\nimport \"./styles/draggableadventureravatar.scss\";\n\nexport interface Props {\n  sourceId?: string;\n  onClick?: () => void;\n  disabled?: boolean;\n}\n\ninterface CollectedProps {\n  isDragging: boolean;\n  connectDragSource: ConnectDragSource;\n}\n\nexport interface AdventurerAvatarDragInfo {\n  adventurer: AdventurerStoreState;\n  sourceId?: string;\n}\n\n/**\n * Specifies the drag source contract.\n * Only `beginDrag` function is required.\n */\nconst spec: DragSourceSpec<Props & AdventurerAvatarProps, AdventurerAvatarDragInfo> = {\n  beginDrag(props: Props & AdventurerAvatarProps) {\n    // Return the data describing the dragged item\n    return {\n      adventurer: props.adventurer,\n      sourceId: props.sourceId,\n      sourceType: DragSourceType.adventurerInventory,\n    };\n  },\n};\n\n/**\n * Specifies which props to inject into your component.\n */\nfunction collect(connect: DragSourceConnector, monitor: DragSourceMonitor) {\n  return {\n    connectDragSource: connect.dragSource(),\n    isDragging: monitor.isDragging(),\n  };\n}\n\nconst DraggableAdventurerAvatar = (props: Props & CollectedProps & AdventurerAvatarProps) => {\n\n  const { isDragging, connectDragSource, disabled } = props;\n  let className = \"draggable-adventurer-avatar\";\n  if (disabled) {\n    className += \" disabled\";\n  }\n  if (isDragging) {\n    className += \" dragging\";\n  }\n\n  /*if (isDragging) {\n    // TODO: can show some sort of empty state?\n    return null;\n  }*/\n  return connectDragSource(\n    <div className = { className }>\n      <AdventurerAvatar\n        // Copy all props down to AdventurerAvatar\n        { ...props }\n      />\n    </div>,\n  );\n}\n\nexport default DragSource<Props & AdventurerAvatarProps, CollectedProps>(DragType.ADVENTURER, spec, collect)(DraggableAdventurerAvatar);\n","import { AdventurerStoreState } from 'store/types/adventurer';\nimport { SOURCE_ID } from '../TavernStructureView';\nimport AdventurerButton from './AdventurerButton';\nimport { TextManager } from 'global/TextManager';\nimport DraggableAdventurerAvatar from 'components/ui/adventurer/DraggableAdventurerAvatar';\nimport AdventurerPanel from 'components/ui/adventurer/AdventurerPanel';\nimport { renameAdventurer } from 'store/actions/adventurers';\nimport { useDispatch } from 'react-redux';\n\nexport interface Props {\n  adventurer: AdventurerStoreState;\n  onQuest: boolean;\n  assignedAventurers: AdventurerStoreState[];\n  expanded: boolean;\n  selectedQuestName?: string;\n\n  onClick: (adventurer: AdventurerStoreState) => void;\n  onAddAdventurer: (adventurer: AdventurerStoreState, index: number) => void;\n  onRemoveAdventurer: (adventurer: AdventurerStoreState) => void;\n}\n\n// Room block that has adventurer\nconst RoomWithAdventurer = (props: Props) => {\n  const {\n    adventurer,\n    onQuest,\n    assignedAventurers,\n    expanded,\n    selectedQuestName,\n    onClick,\n    onAddAdventurer,\n    onRemoveAdventurer\n  } = props;\n\n  const dispatch = useDispatch();\n  const assigned = assignedAventurers.indexOf(adventurer) > -1; // assigned to a quest in the QuestBoard\n\n  const handleRename = (e: React.MouseEvent<HTMLSpanElement>) => {\n    e.stopPropagation();\n    const name = prompt(\"Enter new name\", adventurer.name);\n    if (name && name !== adventurer.name) {\n      dispatch(renameAdventurer(adventurer.id, name));\n    }\n  };\n\n  return (\n    <>\n      <div\n        className={`room ${expanded ? \"expanded\" : \"\"}`}\n        onClick={() => onClick(adventurer)}\n      >\n        <DraggableAdventurerAvatar\n          disabled={assigned || onQuest}\n          adventurer={adventurer}\n          className=\"adventurer-icon\"\n          sourceId={SOURCE_ID}\n          key={`avatar:${adventurer.id}`}\n        />\n        <div>\n          <section>\n            {adventurer.name}\n          </section>\n          <section className=\"on-a-quest\">\n           {(onQuest) && TextManager.get(\"ui-structure-tavern-on-a-quest\") }\n          </section>\n        </div>\n        <span className=\"rename\" onClick={handleRename}>rename</span>\n      </div>\n      { expanded && (\n        <div className=\"adventurer-details\">\n          <AdventurerPanel adventurerId={adventurer.id} name={false} />\n          { (!onQuest && selectedQuestName) && (\n            <AdventurerButton\n              adventurer={adventurer}\n              assignedAventurers={assignedAventurers}\n              questName={selectedQuestName}\n              onAddAdventurer={onAddAdventurer}\n              onRemoveAdventurer={onRemoveAdventurer}\n            />\n          )}\n        </div>\n      )}\n    </>\n  );\n}\n\nexport default RoomWithAdventurer;\n","import React, {  } from 'react';\n\n// eslint-disable-next-line @typescript-eslint/no-empty-interface\nexport interface Props {\n}\n\nconst RoomEmpty = () => {\n    return (\n        <div className=\"room\">\n            (empty room)\n        </div>\n    );\n}\n\nexport default RoomEmpty;\n","import { useState } from 'react';\nimport { AdventurerStoreState } from 'store/types/adventurer';\nimport { QuestStoreState } from 'store/types/quest';\nimport RoomWithAdventurer from './RoomWithAdventurer';\nimport RoomEmpty from './RoomEmpty';\nimport { TextManager } from 'global/TextManager';\nimport \"./styles/roomList.scss\";\n\nexport interface Props {\n  roomCount: number;\n  adventurers: AdventurerStoreState[];\n  assignedAventurers: AdventurerStoreState[];\n  quests: QuestStoreState[];\n  selectedQuestName?: string;     // name of selected quest\n\n  onAddAdventurer: (adventurer: AdventurerStoreState, index: number) => void;\n  onRemoveAdventurer: (adventurer: AdventurerStoreState) => void;\n}\n\nconst RoomList = (props: Props) => {\n  const {\n    roomCount,\n    adventurers,\n    assignedAventurers,\n    selectedQuestName,\n    onAddAdventurer,\n    onRemoveAdventurer\n  } = props;\n  const [selectedAdventurer, setSelectedAdventurer] = useState<string>();\n\n  const getQuestByAdventurer = (adventurerId: string): QuestStoreState | undefined => {\n    return Object.values(props.quests).find((quest) => {\n      return quest.party.indexOf(adventurerId) > -1;\n    });\n  };\n\n  const handleAdventurerClick = (adventurer: AdventurerStoreState) => {\n    if (selectedAdventurer === adventurer.id) {\n      setSelectedAdventurer(undefined);\n    } else {\n      setSelectedAdventurer(adventurer.id);\n    }\n  };\n\n  const roomContent: JSX.Element[] = [];\n  for (let i = 0; i < roomCount; i++) {\n    const adventurer = adventurers.find((a) => a.room === i);\n    if (!adventurer) {\n      roomContent.push((\n        <RoomEmpty key={`room${i}`} />\n      ));\n      continue;\n    }\n    const onQuest = !!getQuestByAdventurer(adventurer.id);\n\n    roomContent.push((\n      <RoomWithAdventurer\n        key={adventurer.id}\n        adventurer={adventurer}\n        assignedAventurers={assignedAventurers}\n        selectedQuestName={selectedQuestName}\n        expanded={selectedAdventurer === adventurer.id}\n        onQuest={onQuest}\n\n        onClick={handleAdventurerClick}\n        onAddAdventurer={onAddAdventurer}\n        onRemoveAdventurer={onRemoveAdventurer}\n      />\n    ));\n  }\n\n  return (\n    <div className=\"room-list\">\n      <h2>{TextManager.get(\"ui-structure-tavern-rooms\")}</h2>\n      { roomContent }\n    </div>\n  );\n}\n\nexport default RoomList;\n","import * as React from \"react\";\nimport { getDefinition } from 'definitions/structures';\nimport { TavernStructureDefinition } from 'definitions/structures/types';\nimport Icon from 'components/ui/common/Icon';\nimport { TextManager } from 'global/TextManager';\nimport \"./styles/upgradeHelpModalContent.scss\"\n\nexport interface Props  {\n  level: number;\n}\n\nconst UpgradeHelpModalContent = (props: Props) => {\n  const { level } = props;\n  const structureDefinition: TavernStructureDefinition = getDefinition(\"tavern\");\n\n  const currentLevel = structureDefinition.levels[level];\n  const nextLevel = structureDefinition.levels[level + 1];\n\n\n  return (\n    <div className=\"upgrade-help-model-content-tavern\">\n      <h3>{TextManager.get(\"ui-structure-help-upgrade-improvements\")}</h3>\n\n      <div className=\"rooms-increase\">\n        <div className=\"header\"/>\n        <div className=\"header\">\n          {TextManager.getStructureName(\"tavern\")}\n        </div>\n        <div className=\"header number\">\n          {TextManager.get(\"ui-structure-help-upgrade-header-level\", {\n            level: level + 1\n          })}\n        </div>\n        <div className=\"header\"/>\n        <div className=\"header number\">\n          {TextManager.get(\"ui-structure-help-upgrade-header-level\", {\n            level: level + 2\n          })}\n        </div>\n        <div><Icon image=\"img/ui/structures/tavern.png\" size=\"smallest\"/></div>\n        <div>{TextManager.get(\"ui-structure-tavern-rooms\")}</div>\n        <div className=\"number\">{currentLevel.rooms}</div>\n        <div className=\"arrow\">»</div>\n        <div className=\"number\">{nextLevel.rooms}</div>\n      </div>\n    </div>\n  )\n}\n\nexport default UpgradeHelpModalContent;\n","import { TavernStructureDefinition, TavernStructureLevelDefinition} from \"definitions/structures/types\";\nimport { AdventurerStoreState} from \"store/types/adventurer\";\nimport { QuestStatus, QuestStoreState} from \"store/types/quest\";\nimport { TextManager} from \"global/TextManager\";\nimport { ToastManager} from 'global/ToastManager';\nimport { TooltipManager } from 'global/TooltipManager';\nimport { ContextType } from 'constants/context';\nimport { Type} from 'components/ui/toasts/Toast';\nimport { getQuestLink} from 'utils/routing';\nimport RoomList from './rooms/RoomList';\nimport { useEffect, useState} from 'react';\nimport QuestBoard from './QuestBoard';\nimport { useStructureDefinition, useStructureState } from 'hooks/store/structures';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { StoreState } from 'store/types';\nimport { launchQuest } from 'store/actions/quests';\nimport { AdventurerAvatarDragInfo } from 'components/ui/adventurer/DraggableAdventurerAvatar';\nimport StructureLevel from '../StructureLevel';\nimport StructureViewHeader from \"../StructureViewHeader\";\nimport UpgradeHelpModal from \"../UpgradeHelpModal\";\nimport UpgradeHelpModalContent from \"./UpgradeHelpModalContent\";\nimport { Channel, SoundManager } from \"global/SoundManager\";\nimport \"./styles/tavernStructureView.scss\";\n\nexport const SOURCE_ID = \"tavern\";\n\n// The UI for the tavern\nconst TavernStructureView = () => {\n  const level = useStructureState(\"tavern\").level;\n  const adventurers = useSelector<StoreState, AdventurerStoreState[]>(store => store.adventurers);\n  const quests = useSelector<StoreState, QuestStoreState[]>(store => store.quests);\n\n  const [assignedAventurers, setAassignedAdventurers] = useState<AdventurerStoreState[]>([]);\n  const [selectedQuest, setSelectedQuest] = useState<string>();\n\n  const structureDefinition = useStructureDefinition<TavernStructureDefinition>(\"tavern\");\n  const levelDefinition: TavernStructureLevelDefinition = structureDefinition.levels[level];\n\n  const dispatch = useDispatch();\n\n  useEffect(() => {\n    SoundManager.addSound(\"ambient/structure/tavern\", \"sound/structures/tavern.ogg\", () => {\n      SoundManager.playSound(\"ambient/structure/tavern\", Channel.ambient, true);\n    })\n    return () => SoundManager.fadeOutSound(Channel.ambient);\n  }, []);\n\n  const onLaunchQuest = (questName: string) => {\n    dispatch(launchQuest(questName, assignedAventurers));\n  };\n\n  const getAvailableQuests = quests.filter((q) => q.status === QuestStatus.available );\n\n  const handleQuestClick = (name: string): void => {\n    if (selectedQuest === name) {\n      setSelectedQuest(undefined);\n    } else {\n      setSelectedQuest(name);\n    }\n\n    // Unassign all adventurers\n    setAassignedAdventurers([]);\n  };\n\n  const handleAdventurerDropped = (item: AdventurerAvatarDragInfo, index: number) => {\n    if (item.sourceId === SOURCE_ID) {\n      handleAddAdventurer(item.adventurer, index)\n    }\n  }\n\n  const handleAddAdventurer = (adventurer: AdventurerStoreState, index: number): void => {\n    const copy = [ ...assignedAventurers];\n    copy[index] = adventurer;\n    setAassignedAdventurers(copy);\n  };\n\n  const handleRemoveAdventurer = (adventurer: AdventurerStoreState): void => {\n    const index = assignedAventurers.indexOf(adventurer);\n    const copy = [ ...assignedAventurers];\n    delete copy[index];\n    setAassignedAdventurers(copy);\n  };\n\n  const handleLaunchQuest = (): void => {\n    if (!selectedQuest) return;\n\n    const questTitle = TextManager.getQuestTitle(selectedQuest);\n    const leader = assignedAventurers[0];\n    ToastManager.addToast(questTitle, Type.questLaunched, leader?.avatarImg, getQuestLink(selectedQuest));\n    onLaunchQuest(selectedQuest);\n  };\n\n  const handleHelpClicked = (event: React.MouseEvent) => {\n    const origin = (event.currentTarget as HTMLElement);\n    const originRect = origin.getBoundingClientRect();\n    const content = (\n      <UpgradeHelpModal level={level} structure={\"tavern\"}>\n        <UpgradeHelpModalContent level={level} />\n      </UpgradeHelpModal>\n    );\n    TooltipManager.showContextTooltip(ContextType.component, content, originRect, \"upgrade-structure-tooltip\");\n\n    event.stopPropagation();\n  }\n\n  return (\n    <>\n      <StructureViewHeader structure={\"tavern\"} />\n      <div className=\"tavern-structure-view\">\n        <StructureLevel structure={\"tavern\"} onHelpClicked={handleHelpClicked}/>\n        <section>\n          <RoomList\n            roomCount={levelDefinition.rooms}\n            adventurers={adventurers}\n            assignedAventurers={assignedAventurers}\n            quests={quests}\n            selectedQuestName={selectedQuest}\n            onAddAdventurer={handleAddAdventurer}\n            onRemoveAdventurer={handleRemoveAdventurer}\n          />\n          <QuestBoard\n            availableQuests={getAvailableQuests}\n            selectedQuestName={selectedQuest}\n            assignedAventurers={assignedAventurers}\n            onQuestClick={(name: string) => handleQuestClick(name)}\n            onAdventurerDropped={handleAdventurerDropped}\n            onRemoveAdventurer={handleRemoveAdventurer}\n            onLaunchQuest={handleLaunchQuest}\n          />\n        </section>\n      </div>\n    </>\n  );\n};\n\nexport default TavernStructureView;\n","import { ONE_MINUTE } from 'utils/format/time';\n\nexport const RESOURCE_INTERVAL = ONE_MINUTE; // every minute constitutes a resource tick.\n","import ReactMarkdown from \"react-markdown\";\nimport { Structure } from 'definitions/structures';\nimport { TextManager } from 'global/TextManager';\nimport { useEngine } from 'hooks/store/engine';\nimport { formatDuration } from 'utils/format/time';\nimport { RESOURCE_INTERVAL } from 'mechanics/resources';\nimport { Direction } from 'components/ui/common/progress/PlainProgressbar';\nimport { Resource } from 'definitions/resources';\nimport { useStructureLevel, useStructureState } from 'hooks/store/structures';\nimport { ResourceStructureLevelDefinition } from 'definitions/structures/types';\nimport Icon from 'components/ui/common/Icon';\nimport resourceDescriptions from \"definitions/resources\";\nimport TickingProgressbar from 'components/ui/common/progress/TickingProgressbar';\nimport { useMaxResourcesState, useResourcesState } from \"hooks/store/resources\";\n\ninterface Props {\n  structure: Structure;\n  resource: Resource;\n}\n\nconst ResourceGenerationRow = (props: Props) => {\n  const {structure, resource} = props;\n  const engine = useEngine();\n  const {workers} = useStructureState(structure);\n\n  const levelDefinition = useStructureLevel<ResourceStructureLevelDefinition>(structure);\n  const generates = levelDefinition.generates[resource] || 0;\n  const delta = RESOURCE_INTERVAL - (Date.now() - engine.lastProducedUpdate);\n  const resourceDescription = resourceDescriptions[resource];\n  const resources = useResourcesState();\n  const maxResources = useMaxResourcesState();\n  const full = (resources[resource] ?? 0) >= (maxResources?.[resource] ?? 0);\n  if (full) {\n    return (\n      <div className=\"resource-generation-row\">\n        <div className=\"error-full\">\n        <ReactMarkdown>\n          {TextManager.get(\"ui-structure-resource-warehouse-full\", { structure, resource })}\n        </ReactMarkdown>\n        </div>\n      </div>\n    )\n  }\n  return (\n    <div className=\"resource-generation-row\">\n      <div className=\"info\">\n        <Icon image={resourceDescription.iconImg} size=\"smallest\"/>\n        <div>\n          {TextManager.get(\"ui-structure-resource-generates\", {\n            amount: generates,\n            resource,\n          })}\n        </div>\n      </div>\n      {full}\n      { workers > 0 &&\n      <TickingProgressbar\n        className=\"generating\"\n        direction={Direction.decreasing}\n        label={`${TextManager.get(\"ui-structure-resource-next-generates\", {\n          amount: generates * workers,\n          resource,\n          time: formatDuration(delta)\n        })}`}\n        progress={delta / RESOURCE_INTERVAL}\n      />}\n      { !workers && TextManager.get(\"ui-structure-resource-no-workers\")}\n    </div>\n  )\n}\nexport default ResourceGenerationRow;\n","import * as React from \"react\";\nimport { Item } from \"definitions/items/types\";\nimport { TextManager } from \"global/TextManager\";\n\ninterface Props {\n  item: Item;\n}\n\nconst ItemText = ({ item }: Props) => (\n  <div className=\"text\">\n    <p className=\"name\">{TextManager.getItemName(item.type)}</p>\n    <p className=\"subtext\">{TextManager.getItemSubtext(item.type)}</p>\n  </div>\n)\n\nexport default ItemText;\n","import * as React from \"react\";\nimport { Item } from \"definitions/items/types\";\nimport { DragSourceType } from 'constants/dragging';\nimport DraggableItemIcon from '../DraggableItemIcon';\nimport ItemText from \"./ItemText\";\nimport { ReactNode } from \"react\";\nimport \"./styles/itemsList.scss\";\n\nexport interface Props {\n  className?: string;\n  items: Item[];\n  sourceType: DragSourceType;\n  sourceId?: string;\n  slots?: number; // optionally always show this amount of slots\n  renderButton?: (item: Item, index: number) => ReactNode\n}\n\n/**\n * The ItemsList displays a list of items vertically. Shows icon and description\n */\nconst DraggableItemsList = (props: Props) => {\n  const { renderButton, items } = props;\n  const className = `items-list ${props.className ?? ''}`;\n  const slots = props.slots ?? items.length;\n\n  return (\n    <ul className={className} >\n      {[...Array(slots)].map((_, index )=> {\n        const item = items[index];\n        return (\n          <li\n            key={`${item}${index}`}\n            className=\"item-row\"\n          >\n            <div className=\"item-placeholder\" />\n            { item && (\n              <>\n                <DraggableItemIcon\n                  item={item}\n                  index={index}\n                  sourceId={props.sourceId}\n                  sourceType={props.sourceType}\n                />\n                <ItemText item={item} />\n              </>\n            )}\n            { (item && renderButton) && renderButton(item, index) }\n          </li>\n        )\n      })}\n    </ul>\n  );\n};\n\nexport default DraggableItemsList;\n","import { ItemType } from \"definitions/items/types\";\n\n// export function pick<T extends string, TEnumValue extends number>(table: {[key in keyof T]?: TEnumValue}) : T {\n// export function pick<T =Item>(table: {[key in Item]?: number}) : T {\nexport function pick(table: {[key in ItemType]?: number}) : ItemType {\n  const totalWeight = Object.values(table).reduce((acc, value) => (acc ?? 0 ) + (value ?? 0), 0) ?? 0;\n  const randomNumber = Math.floor(Math.random() * totalWeight + 1);\n\n  let weight = 0;\n  const entries = Object.entries(table);\n  for(let i = 0; i < entries.length; i++) {\n    weight += entries[i][1];\n    if (randomNumber <= weight) {\n      return entries[i][0] as unknown as ItemType\n    }\n  }\n  throw new Error()\n}\n\n/* Tests distribution */\nexport const test = () => {\n  const lootTable: {[key in ItemType]?: number} = {\n    \"herb/bogroot\": 2,\n    \"herb/winterWeed\": 1\n  }\n  const result: {[key in ItemType]?: number} = {}\n  for(let i = 0; i < 500; i++) {\n    const picked = pick(lootTable);\n    result[picked] = (result[picked] ?? 0) + 1;\n  }\n  // console.log(result)\n}\n// */\n","export enum TimeType {\n  questProgress,      // progress on the worldmap\n  resourceGeneration,\n  cheat\n}\n// todo: should come from store?\n\nlet cheatTimeMultiplier = 1;\nexport const setCheatTimeMultiplier = (value: number) => {\n  cheatTimeMultiplier = value;\n}\n\nexport const getTimeMultiplier = (type: TimeType): number => {\n  switch (type) {\n     case TimeType.cheat:\n      return cheatTimeMultiplier;\n    // todo: implement different multipliers for different timetypes?\n    // the idea is to have speed boosts in different areas of the game\n    default:\n      return cheatTimeMultiplier;\n  }\n}\n\n","import { ItemType } from 'definitions/items/types';\nimport { getDefinition, Structure } from \"definitions/structures\";\nimport { ResourceStructureDefinition, ResourceStructureLevelDefinition, StructureType } from \"definitions/structures/types\";\nimport { StoreState } from \"store/types\";\nimport { StructuresStoreState } from \"store/types/structures\";\nimport { pick } from \"mechanics/lootTable\";\nimport { ONE_HOUR } from 'utils/format/time';\nimport { ResourceStructureState } from 'store/types/structure';\n\n\n /*\n  * Items to be harvested  */\nexport type HarvestUpdate = {\n  [key in Structure]?: ItemType[]\n}\n\nexport const HARVEST_INTERVAL = ONE_HOUR * 3; // every three hours constitutes a harvest tick.\n\n\nconst getHarvest = (state: StoreState): HarvestUpdate|null => {\n  const { lastHarvest } = state.engine;\n  const structures: StructuresStoreState = state.structures;\n  const result: HarvestUpdate = {};\n\n  const handleStructure = (structure: Structure) => {\n    const structureDefinition = getDefinition(structure);\n\n    if (structureDefinition.type === StructureType.resource) {\n      const resourceStructureDefinition = structureDefinition as ResourceStructureDefinition;\n      const level: number = structures[structure as Structure].level;\n      const levelDefinition: ResourceStructureLevelDefinition = resourceStructureDefinition.levels[level];\n\n      if (levelDefinition.harvest?.lootTable){\n        const state = structures[structure] as ResourceStructureState;\n        let itemCount = state.harvest?.length ?? 0;\n        const items: ItemType[] = [];\n        while (itemCount < levelDefinition.harvest.amount) {\n          items.push(pick(levelDefinition.harvest.lootTable))\n          itemCount ++;\n        }\n\n        result[structure] = items\n      }\n\n    }\n  };\n\n\n  // Calculate what each structure generates. Stores in `result`.\n  if (Date.now() - lastHarvest > HARVEST_INTERVAL){\n    Object.keys(structures).forEach((structure) => handleStructure(structure as Structure));\n  }\n  return result;\n};\n\n\nexport default getHarvest;\n","import { TickingProgressbar } from \"components/ui/common/progress\";\nimport { Direction } from \"components/ui/common/progress/TickingProgressbar\";\nimport { Structure } from \"definitions/structures\";\nimport { TextManager } from \"global/TextManager\";\nimport { useEngine } from \"hooks/store/engine\";\nimport { HARVEST_INTERVAL } from \"mechanics/gameTick/harvest\";\nimport { formatDuration } from \"utils/format/time\";\nimport IconButton from 'components/ui/buttons/IconButton';\nimport { useDispatch } from 'react-redux';\nimport { reduceTime } from 'store/actions/game';\nimport \"./styles/harvestProgress.scss\"\n\ninterface Props {\n  structure: Structure;\n}\n\nconst HarvestProgress = (props: Props) => {\n  const { structure } = props;\n  const engine = useEngine();\n  const dispatch = useDispatch();\n  const delta = HARVEST_INTERVAL - (Date.now() - engine.lastHarvest);\n\n  const handleReduceTime50 = () => {\n    dispatch(reduceTime(50, \"harvest\", structure))\n  }\n\n  return (\n    <div className=\"harvest-progress\">\n      <TickingProgressbar\n         className=\"harvest-progress\"\n         direction={Direction.decreasing}\n         label={`${TextManager.get(\"ui-structure-resource-next-harvest\", {\n           time: formatDuration(delta)\n         })}`}\n         progress={delta / HARVEST_INTERVAL}\n      />\n      <IconButton iconImg=\"/img/ui/misc/clock.png\" size=\"smallest\" onClick={handleReduceTime50}> 50%</IconButton>\n    </div>\n  )\n}\n\nexport default HarvestProgress;\n","export default __webpack_public_path__ + \"static/media/icon.745e2ffb.png\";","import { Fragment } from \"react\";\nimport { getDefinition, Structure } from 'definitions/structures';\nimport resourceDescriptions from \"definitions/resources\";\nimport { ResourceStructureDefinition } from 'definitions/structures/types';\nimport { Resource } from 'definitions/resources';\nimport Icon from 'components/ui/common/Icon';\nimport { TextManager } from 'global/TextManager';\nimport \"./styles/upgradeHelpModalContent.scss\"\n\nexport interface Props  {\n  structure: Structure;\n  level: number;\n}\n\nconst UpgradeHelpModalContent = (props: Props) => {\n  const { level, structure } = props;\n  const structureDefinition: ResourceStructureDefinition = getDefinition(structure);\n\n  const currentLevel = structureDefinition.levels[level];\n  const nextLevel = structureDefinition.levels[level + 1];\n\n  const renderRow = (resource: Resource) => {\n    const resourceDescription = resourceDescriptions[resource];\n\n    return (\n      <Fragment key={resource}>\n        <div><Icon image={resourceDescription.iconImg} size=\"smallest\"/></div>\n        <div>\n           {TextManager.get(\"ui-structure-resource-help-upgrade-resource-generates\", { resource })}\n        </div>\n        <div className=\"number\">{currentLevel.generates[resource]}</div>\n        <div className=\"arrow\">›</div>\n        <div className=\"number\">{nextLevel.generates[resource]}</div>\n      </Fragment>\n    )\n  }\n\n  return (\n    <div className=\"upgrade-help-model-content-resource\">\n      <div className=\"grid generates-increase\">\n        <div className=\"header\">\n          <h3>{TextManager.get(\"ui-structure-help-upgrade-improvements\")}</h3>\n        </div>\n        <div className=\"header\"/>\n        <div className=\"header number\">\n          {TextManager.get(\"ui-structure-help-upgrade-header-level\", {\n            level: level + 1\n          })}\n        </div>\n        <div className=\"header\"/>\n        <div className=\"header number\">\n        {TextManager.get(\"ui-structure-help-upgrade-header-level\", {\n          level: level + 2\n        })}\n        </div>\n        <div><Icon image={\"/img/resources/worker.png\"} size=\"smallest\"/></div>\n        <div>{TextManager.get(\"ui-structure-help-upgrade-worker-capacity\")}</div>\n        <div className=\"number\">{currentLevel.workerCapacity}</div>\n        <div className=\"arrow\">»</div>\n        <div className=\"number\">{nextLevel.workerCapacity}</div>\n        {Object.keys(nextLevel.generates).map(res => renderRow(res as Resource))}\n      </div>\n    </div>\n  )\n}\n\nexport default UpgradeHelpModalContent;\n","import { ResourceStructure, Structure  } from \"definitions/structures\";\nimport { ResourceStructureLevelDefinition } from \"definitions/structures/types\";\nimport UpDownValue from \"components/ui/common/UpDownValue\";\nimport { useSelector, useDispatch } from 'react-redux';\nimport ReactMarkdown from \"react-markdown\";\nimport { StoreState } from 'store/types';\nimport { selectFreeWorkers } from 'store/selectors/workers';\nimport { decreaseWorkers, increaseWorkers, removeItemFromHarvest } from 'store/actions/structures';\nimport StructureViewHeader from '../StructureViewHeader';\nimport { TextManager } from 'global/TextManager';\nimport StructureLevel from '../StructureLevel';\nimport { TooltipManager } from 'global/TooltipManager';\nimport { ContextType } from 'constants/context';\nimport { useStructureLevel, useStructureState } from 'hooks/store/structures';\nimport ResourceGenerationRow from './ResourceGenerationRow';\nimport { Resource } from 'definitions/resources';\nimport DraggableItemsList from \"components/ui/items/DraggableItemsList\";\nimport { Item } from \"definitions/items/types\";\nimport { DragSourceType } from \"constants/dragging\";\nimport HarvestProgress from \"./HarvestProgress\";\nimport IconButton from \"components/ui/buttons/IconButton\";\nimport warehouseIcon from \"components/structures/styles/images/warehouse/icon.png\"\nimport { addItemToWarehouse } from \"store/actions/stockpile\";\nimport UpgradeHelpModal from \"../UpgradeHelpModal\";\nimport UpgradeHelpModalContent from \"./UpgradeHelpModalContent\";\nimport './styles/resourceStructureView.scss';\n\nexport interface Props  {\n  structure: Structure;\n}\n\n// todo: 02/12/2019 [ ] Can show progress bar in resource screen\nconst ResourceStructureView = (props: Props) => {\n  const {structure} = props;\n\n  // Fetch needed values from store\n  const {level, workers} = useStructureState(structure);\n  const workersFree = useSelector<StoreState, number>((store) => selectFreeWorkers(store));\n  const harvest = useSelector<StoreState, Item[]>((store) => selectHarvest(store, structure as ResourceStructure));\n  const levelDefinition = useStructureLevel<ResourceStructureLevelDefinition>(structure);\n\n  // Reducer dispatch\n  const dispatch = useDispatch();\n  const handleWorkersDown = () => {\n    dispatch(decreaseWorkers(props.structure));\n  }\n\n  const handleWorkersUp = () => {\n    dispatch(increaseWorkers(props.structure));\n  };\n\n\n  const upDisabled = workers === levelDefinition.workerCapacity || (workersFree || 0) < 1;\n  const downDisabled = workers === 0;\n\n  const handleHelpClicked = (event: React.MouseEvent) => {\n    const origin = (event.currentTarget as HTMLElement);\n    const originRect = origin.getBoundingClientRect();\n    const content = (\n      <UpgradeHelpModal level={level} structure={structure}>\n        <UpgradeHelpModalContent level={level} structure={structure}/>\n      </UpgradeHelpModal>\n    );\n    TooltipManager.showContextTooltip(ContextType.component, content, originRect, \"upgrade-structure-tooltip\");\n\n    event.stopPropagation();\n  }\n\n  const handleItemTake = (item: Item, index: number) => {\n    dispatch(removeItemFromHarvest(structure, index));\n    dispatch(addItemToWarehouse(item))\n  }\n\n  return (\n    <>\n      <StructureViewHeader structure={props.structure} />\n      <div className=\"resource-structure-view\">\n        <section>\n          <StructureLevel structure={structure} onHelpClicked={handleHelpClicked}/>\n          <UpDownValue\n            label={TextManager.get(\"ui-structure-production-workers\")}\n            value={workers}\n            max={levelDefinition.workerCapacity}\n            upDisabled={upDisabled}\n            downDisabled={downDisabled}\n            onDown={handleWorkersDown}\n            onUp={handleWorkersUp}\n          />\n          { /** Generates this resource */}\n          <h3>Generates</h3>\n          { Object.keys(levelDefinition.generates).map(r => <ResourceGenerationRow structure={structure} resource={r as Resource} key={r} />)}\n\n          { levelDefinition.harvest && (\n            <>\n              { /** Generates these items */}\n              <h3>Harvest</h3>\n              <ReactMarkdown>\n                {TextManager.get(`ui-structure-resource-harvest-${structure}`)}\n              </ReactMarkdown>\n              <HarvestProgress structure={structure} />\n              <DraggableItemsList\n                items={harvest}\n                sourceType={DragSourceType.resourceStructure}\n                sourceId={structure}\n                slots={levelDefinition.harvest?.amount}\n                renderButton={(item: Item, index: number) => (<IconButton iconImg={warehouseIcon} onClick={() => handleItemTake(item, index)} >Take</IconButton>)}\n              />\n\n            </>\n          )}\n        </section>\n      </div>\n    </>\n  );\n};\n\nexport default ResourceStructureView;\n\nconst selectHarvest = (store: StoreState, structure: ResourceStructure): Item[] => {\n  return store.structures[structure].harvest ?? [];\n}\n","import * as React from \"react\";\nimport { getDefinition, Structure } from \"definitions/structures\";\nimport { StructureDefinition, StructureType } from \"definitions/structures/types\";\nimport { StructureState } from \"store/types/structure\";\nimport { useSelector } from 'react-redux';\nimport { StoreState } from 'store/types';\nimport { TasksStoreState } from 'store/types/tasks';\nimport { useStructureState } from 'hooks/store/structures';\nimport { withWindow } from 'hoc/withWindow';\nimport { Props as WindowProps } from \"components/ui/window/Window\";\nimport { formatDuration } from 'utils/format/time';\nimport { TickingProgressbar } from 'components/ui/common/progress';\nimport ProductionStructureView from 'components/structures/production/ProductionStructureView';\nimport WarehouseStructureView from 'components/structures/warehouse/WarehouseStructureView';\nimport TavernStructureView from 'components/structures/tavern/TavernStructureView';\nimport ResourceStructureView from 'components/structures/resource/ResourceStructureView';\nimport { Link, useParams } from \"react-router-dom\";\nimport { TextManager } from \"global/TextManager\";\nimport Button from \"components/ui/buttons/Button\";\nimport { getStructureLink } from \"utils/routing\";\nimport \"./styles/structuredetailsview.scss\";\n\nexport interface Props {\n  structure: Structure;\n}\n\nconst StructureDetailsView = (props: Props & WindowProps) => {\n  const tasks = useSelector<StoreState, TasksStoreState>(store => store.tasks);\n  const buildTask = tasks.running.filter((val) =>\n    val.origin === `town` && val.name === `${props.structure}.build`)[0];\n  const structureState = useStructureState(props.structure);\n\n  const renderContent = () => {\n    if (structureState.state === StructureState.Building) {\n      if (!buildTask) return null;\n      return (\n        <div className=\"building\">\n          <TickingProgressbar\n            progress={buildTask.progress}\n            label={`Building... (${formatDuration(buildTask.timeRemaining)})`}\n          />\n        </div>\n      );\n    } else {\n\n      const structureDefinition: StructureDefinition = getDefinition(props.structure);\n      switch (structureDefinition.type) {\n        case StructureType.production: {\n          return <ProductionStructureView structure={props.structure}/>;\n        }\n        case StructureType.resource: {\n          return <ResourceStructureView structure={props.structure} />;\n        }\n        case StructureType.warehouse: {\n          return <WarehouseStructureView />;\n        }\n        case StructureType.tavern: {\n          return <TavernStructureView />;\n        }\n        default: {\n          return <div> { props.structure } </div>;\n        }\n      }\n    }\n  }\n\n  return (\n    <div className=\"structure-details\">\n      { renderContent() }\n    </div>\n  );\n};\n\nexport default StructureDetailsView\nexport const StructureDetailsWindow = withWindow(StructureDetailsView);\n\nexport const RoutedStructureDetailsView = () => {\n  const { structure } = useParams<{structure: Structure}>();\n  const title = TextManager.getStructureName(structure)\n  return (\n    <div className=\"structure-details-window \">\n      <div className=\"header\">\n        <h3>{ title }</h3>\n        <Link to={getStructureLink(structure, true)}>\n          <Button\n            className=\"close-button\"\n            square={true}\n            size={\"medium\"}\n            color=\"purple\"\n            text=\"x\"\n          />\n        </Link>\n      </div>\n      <StructureDetailsView structure={structure} title={title}  />\n    </div>\n  )\n}","export default __webpack_public_path__ + \"static/media/icon.049af8e1.png\";","export default __webpack_public_path__ + \"static/media/icon.c8d10643.png\";","export default __webpack_public_path__ + \"static/media/icon.0e0cc642.png\";","export default __webpack_public_path__ + \"static/media/icon.98ba42d7.png\";","export default __webpack_public_path__ + \"static/media/icon.2819a92b.png\";","export default __webpack_public_path__ + \"static/media/icon.d422c1b8.png\";","export default __webpack_public_path__ + \"static/media/icon.cb41f623.png\";","export default __webpack_public_path__ + \"static/media/icon.8c08d004.png\";","export default __webpack_public_path__ + \"static/media/icon.54fdc54f.png\";","export default __webpack_public_path__ + \"static/media/icon.288a01cf.png\";","export default __webpack_public_path__ + \"static/media/icon.701060d5.png\";","import React, { ComponentProps } from \"react\";\nimport { Sprite } from \"@inlet/react-pixi\"\nimport alchemist from \"components/structures/styles/images/alchemist/icon.png\"\nimport armoursmith from \"components/structures/styles/images/armoursmith/icon.png\"\nimport garden from \"components/structures/styles/images/garden/icon.png\"\nimport lumberMill from \"components/structures/styles/images/lumberMill/icon.png\"\nimport mine from \"components/structures/styles/images/mine/icon.png\"\nimport quarry from \"components/structures/styles/images/quarry/icon.png\"\nimport tannery from \"components/structures/styles/images/tannery/icon.png\"\nimport tavern from \"components/structures/styles/images/tavern/icon.png\"\nimport warehouse from \"components/structures/styles/images/warehouse/icon.png\"\nimport weaponsmith from \"components/structures/styles/images/weaponsmith/icon.png\"\nimport weaver from \"components/structures/styles/images/weaver/icon.png\"\nimport workshop from \"components/structures/styles/images/workshop/icon.png\"\nimport { Structure } from \"definitions/structures\";\n\ninterface Props {\n  structure: Structure;\n}\n\nconst StructureIconSprite = (props: Props & ComponentProps<typeof Sprite>) => (\n  <Sprite\n    image={getImage(props.structure)}\n    {...props}\n  />\n)\nexport default StructureIconSprite;\n\nconst getImage = (structure: Structure) => {\n  switch (structure) {\n    case \"alchemist\": return alchemist;\n    case \"armoursmith\": return armoursmith;\n    case \"garden\": return garden;\n    case \"lumberMill\": return lumberMill;\n    case \"mine\": return mine;\n    case \"quarry\": return quarry;\n    case \"tannery\": return tannery;\n    case \"tavern\": return tavern;\n    case \"warehouse\": return warehouse;\n    case \"weaponsmith\": return weaponsmith;\n    case \"weaver\": return weaver;\n    case \"workshop\": return workshop;\n    default:\n      throw new Error(`No such structure ${structure}`)\n  }\n}\n","import React from \"react\";\nimport { Container, Sprite, Text } from \"@inlet/react-pixi\"\nimport { Structure } from \"definitions/structures\";\nimport { useStructureState } from \"hooks/store/structures\";\nimport { StructureState } from \"store/types/structure\";\nimport { TextManager } from \"global/TextManager\";\nimport { TextMetrics, TextStyle } from \"@pixi/text\";\nimport { BlurFilter } from \"@pixi/filter-blur\";\nimport StructureIconSprite from \"./StructureIconSprite\";\n\ninterface Props {\n  structure: Structure;\n  x: number;\n  y: number;\n}\n\nconst style = new TextStyle({\n  fontFamily : 'Gabriela',\n  fontSize: 25,\n  fill: 0xffffff,\n  wordWrap: true,\n  wordWrapWidth: 200,\n  dropShadow: true,\n  dropShadowAngle: 0.9,\n  dropShadowBlur: 10,\n  dropShadowDistance: 0\n})\n\nconst blurFilter = new BlurFilter(2, 2)\nconst borderWidth = 985; // width of original border image\n\nconst StructureLabel = (props: Props) => {\n  const { x, y } = props;\n  const structure = useStructureState(props.structure);\n  // const mask = useRef<PIXI.Graphics>(null);\n    if (structure.state !== StructureState.Built){\n    return null\n  }\n  const structureName = TextManager.getStructureName(props.structure) ?? \"\";\n\n  const metrics = TextMetrics.measureText(`${structureName}`, style)\n  return (\n    <Container\n      x={x}\n      y={y}\n      name={props.structure}\n    >\n      <Sprite\n        name=\"background\"\n        image={`${process.env.PUBLIC_URL}/img/town/structure-label/background.png`}\n        scale={[(metrics.width + 16) / 190, 25.5]}\n        alpha={0.5}\n        filters={[blurFilter]}\n        y={3.5}\n        x={8}\n      />\n      <Sprite\n        name=\"border-top\"\n        image={`${process.env.PUBLIC_URL}/img/town/structure-label/border-top.png`}\n        scale={[(metrics.width + 30)/ borderWidth, 0.2]}\n        y={2}\n      />\n       <Sprite\n          name=\"border-bottom\"\n          image={`${process.env.PUBLIC_URL}/img/town/structure-label/border-top.png`}\n          y={28}\n          scale={[(metrics.width + 30)/ borderWidth, 0.2]}\n       />\n       <StructureIconSprite\n          name=\"icon\"\n          structure={props.structure}\n          y={-2}\n          x={metrics.width + 12}\n          scale={[0.015, 0.015]}\n       />\n      {/* <Graphics\n        name=\"mask\"\n        ref={mask}\n        draw={graphics => {\n            graphics.beginFill(0xff0000)\n            graphics.drawRect(-32, 6, metrics.width + 60, 32-6);\n            graphics.endFill();\n        }}\n      /> */}\n      <Text\n        anchor={[0, 0]}\n        text={`  ${structureName[0].toUpperCase() + structureName.slice(1)}  `}\n        style={style}\n      />\n    </Container>\n  )\n}\n\nexport default StructureLabel;\n","import React, { useEffect, useState } from \"react\";\nimport { Container } from \"@inlet/react-pixi\"\nimport FontFaceObserver from \"fontfaceobserver\";\nimport StructureLabel from \"./StructureLabel\";\n\nconst StructureLabels = () => {\n  const [fontLoaded, setFontLoaded] = useState(false)\n  useEffect(() => {\n    const font = new FontFaceObserver('Gabriela');\n    font.load().then(function () {\n      setFontLoaded(true)\n    });\n  }, []);\n\n  if (!fontLoaded) return null\n  return (\n    <Container name=\"structure-labels\">\n      <StructureLabel structure={\"tavern\"} x={645} y={535} />\n      <StructureLabel structure={\"warehouse\"} x={430} y={130} />\n      <StructureLabel structure={\"lumberMill\"} x={235} y={410} />\n      <StructureLabel structure={\"alchemist\"} x={375} y={460} />\n      <StructureLabel structure={\"weaponsmith\"} x={435} y={495} />\n      <StructureLabel structure={\"armoursmith\"} x={515} y={425} />\n      <StructureLabel structure={\"weaver\"} x={555} y={370} />\n      <StructureLabel structure={\"tannery\"} x={255} y={520} />\n      <StructureLabel structure={\"mine\"} x={185} y={590} />\n      <StructureLabel structure={\"workshop\"} x={345} y={660} />\n      <StructureLabel structure={\"quarry\"} x={685} y={666} />\n      <StructureLabel structure={\"garden\"} x={785} y={776} />\n    </Container>\n  )\n}\n\nexport default StructureLabels;\n","import { useRef, useEffect, useState } from \"react\";\nimport { Structure } from 'definitions/structures';\nimport { StructuresStoreState } from 'store/types/structures';\nimport { SoundManager, Channel, MixMode } from 'global/SoundManager';\nimport { Route, Switch, useHistory, useRouteMatch } from 'react-router';\nimport {OutlineFilter} from '@pixi/filter-outline';\nimport { getStructureLink, getTownLink } from 'utils/routing';\nimport { StructureState, StructureStoreState } from 'store/types/structure';\nimport { useSelector } from 'react-redux';\nimport { StoreState } from 'store/types';\nimport { gsap } from 'gsap';\nimport { MAX_WIDTH } from 'components/App';\nimport HitAreaShapes from 'utils/pixiJs/hitAreaShapes';\nimport polygons from './hitAreas.json';\nimport LumberMill from './structures/LumberMill';\nimport Tavern from './structures/Tavern';\nimport { withAppContext } from 'hoc/withAppContext';\nimport Generic from './structures/Generic';\nimport TownStage from './TownStage';\nimport { Viewport as PixiViewport } from \"pixi-viewport\";\nimport Clouds from './Clouds';\nimport { Point } from \"pixi.js\";\nimport { RoutedStructureDetailsView } from \"./StructureDetailsView\";\nimport StructureLabels from \"./StructureLabels\";\nimport \"./styles/townView.scss\"\n\nconst HEIGHT = 1079;\nconst WORLD_WIDTH = 1024;\nconst WORLD_HEIGHT = 1600;\n\n\nexport const STRUCTURE_HIGHLIGHT_FILTER = new OutlineFilter(8, 0xffcc00);\n\nconst TownView = () => {\n  const match = useRouteMatch<{structure: string}>(`${getTownLink()}/:structure`);\n  const selectedStructure = match?.params.structure;\n  const ref = useRef<HTMLDivElement>(null);\n  const viewportRef = useRef<PixiViewport>(null);\n  const dragging = useRef(false);\n  const history = useHistory();\n\n  useEffect(() => {\n    SoundManager.addSound(\"music/town\", \"sound/music/Soliloquy.mp3\", () => {\n      SoundManager.playSound(\"music/town\", Channel.music, true, MixMode.fade, true);\n    })\n  }, []);\n\n  useEffect(() => {\n    const tween = gsap.to(STRUCTURE_HIGHLIGHT_FILTER, {\n      duration: .6,\n      thickness: 2,\n      yoyo: true,\n      repeat: -1\n    });\n    return () => {\n      tween.pause(0);\n      tween.kill();\n    }\n  }, []);\n\n  useEffect(() => {\n    if(viewportRef.current) {\n\n      const viewport = viewportRef.current;\n      viewport.on(\"drag-start\", (e) => {\n        dragging.current = true;\n        e.event.stopPropagation();\n      });\n      viewport.on(\"drag-end\", () => { dragging.current = false; });\n    }\n  }, []);\n\n  const handleStructureClick = (structure: Structure | null) => {\n    if (!dragging.current && structure) {\n      SoundManager.playSound(\"ui/buttonClick\");\n      history.push(getStructureLink(structure))\n    }\n  }\n\n  const structures = useSelector<StoreState, StructuresStoreState>((state: StoreState) => {\n    return state.structures;\n  });\n\n  const renderStructures = () => {\n    const orderedStructures: Structure[] = [\n      \"workshop\",\n      \"quarry\",\n      \"tavern\",\n      \"tannery\",\n      \"alchemist\",\n      \"garden\",\n      \"weaponsmith\",\n      \"armoursmith\",\n      \"warehouse\",\n      \"mine\",\n      \"lumberMill\",\n      \"weaver\",\n    ]\n    return orderedStructures.reverse().map((structure) => {\n      const structureStore: StructureStoreState = structures[structure];\n      if (structureStore.state === StructureState.NotBuilt) {\n        return null;\n      }\n      // todo: refactor into seperate components\n\n      const StructureComponent = getStructure(structure);\n      const position = getStructurePosition(structure);\n      const hitAreaShapes = new HitAreaShapes(polygons, structure as string);\n      return (\n        <StructureComponent\n          position={position}\n          structure={structure}\n          hitAreaShapes={hitAreaShapes}\n          onStructureClick={handleStructureClick}\n          key={structure}\n          selected={selectedStructure === structure}\n        />\n      );\n    });\n  }\n\n  useEffect(() => {\n    if (selectedStructure && viewportRef.current) {\n      const viewport = viewportRef.current;\n      viewport.zoomPercent(0);\n      const position = getStructurePosition(selectedStructure as Structure);\n      viewport.moveCenter(position);\n    }\n  }, [selectedStructure]);\n\n  const [canvasWidth, setCanvasWidth] = useState(MAX_WIDTH);\n  const [canvasHeight, setCanvasHeight] = useState(HEIGHT);\n\n  useEffect(() => {\n    // This will set the dimensions of the canvas tot that of the townview\n    const resize = () => {\n      const worldViewWidth = ref.current?.clientWidth || MAX_WIDTH;\n      const worldViewHeight = ref.current?.clientHeight || HEIGHT;\n\n      setCanvasWidth(worldViewWidth);\n      setCanvasHeight(worldViewHeight);\n    }\n    resize();\n    window.addEventListener(\"resize\", resize);\n    return () => {\n      window.removeEventListener(\"resize\", resize);\n    };\n  }, []);\n\n\n  return (\n    <div className=\"town-view\" ref={ref}>\n      {/* <Legenda structures={structures} /> */}\n      <TownStage\n        screenWidth={canvasWidth}\n        screenHeight={canvasHeight}\n        worldWidth={WORLD_WIDTH}\n        worldHeight={WORLD_HEIGHT}\n        ref={viewportRef}\n      >\n        <Clouds worldWidth={canvasWidth} />\n        {renderStructures()}\n        <Clouds worldWidth={canvasWidth} />\n        <StructureLabels />\n      </TownStage>\n      <Switch>\n        <Route path=\"/town/:structure/view\" >\n          <RoutedStructureDetailsView />\n        </Route>\n      </Switch>\n    </div>\n  );\n}\n\nexport default withAppContext(TownView);\n\nconst getStructure = (structure: Structure) => {\n  switch (structure) {\n    case \"workshop\":\n    case \"quarry\":\n    case \"tannery\":\n    case \"alchemist\":\n    case \"garden\":\n    case \"weaponsmith\":\n    case \"armoursmith\":\n    case \"warehouse\":\n    case \"mine\":\n    case \"weaver\":\n      return Generic;\n    case \"lumberMill\":\n      return LumberMill;\n    case \"tavern\":\n      return Tavern;\n  }\n}\n\nconst getStructurePosition = (structure: Structure) => {\n  let x;\n  let y;\n  switch (structure) {\n    case \"workshop\":\n      x = 373;\n      y = 610;\n      break;\n    case \"quarry\":\n      x = 632;\n      y = 633;\n      break;\n    case \"tannery\":\n      x = 372;\n      y = 460;\n      break;\n    case \"tavern\":\n      x = 500;\n      y = 469;\n      break;\n    case \"alchemist\":\n      x = 411;\n      y = 371;\n      break;\n    case \"garden\":\n      x = 822;\n      y = 689;\n      break;\n    case \"weaponsmith\":\n      x = 449;\n      y = 460;\n      break;\n    case \"armoursmith\":\n      x = 473;\n      y = 442;\n      break;\n    case \"warehouse\":\n      x = 471;\n      y = 130;\n      break;\n    case \"lumberMill\":\n      x = 403;\n      y = 320;\n      break;\n    case \"mine\":\n      x = 183;\n      y = 527;\n      break;\n    case \"weaver\":\n      x = 484;\n      y = 333;\n      break;\n  }\n  return new Point(x, y);\n}\n","import React, { useEffect, useState } from 'react';\nimport { ToastManager, ToastConfig, EVENT_TOASTS_UPDATED } from 'global/ToastManager';\nimport Toast from './Toast';\nimport './styles/toasts.scss';\n\n// Toasts can be added by calling ToastManager.addToast\n// ToastManager will inform whenever the something is added to the list of toasts via EVENT_TOASTS_UPDATED\n// The toasts themselves will fade out via css transition\nconst Toasts = () => {\n\n  const [activeToasts, setActiveToasts] = useState<ToastConfig[]>([]);\n\n  const toastsUpdated = (stack?: ToastConfig[]) => {\n    if (stack) setActiveToasts(stack);\n  }\n\n  useEffect(() => {\n    ToastManager.instance.addListener(EVENT_TOASTS_UPDATED, toastsUpdated);\n    return () => {\n      ToastManager.instance.removeListener(EVENT_TOASTS_UPDATED, toastsUpdated);\n    }\n  }, []);\n\n  return (\n    <div className=\"toasts\" >\n      { activeToasts.map((toastConfig) => (\n        <Toast key={toastConfig.time} {...toastConfig}/>\n      ))}\n    </div>\n  )\n}\n\nexport default Toasts;\n","import { SettingsState } from \"store/types/settings\";\n\nexport type SettingsAction = {\n  type: \"setSetting\",\n  setting: keyof SettingsState\n  value: unknown\n}\n\nexport const setSetting = (setting: keyof SettingsState, value: unknown): SettingsAction => ({\n  type: \"setSetting\",\n  setting,\n  value\n});\n","import * as React from \"react\";\nimport { compose } from \"redux\";\nimport { useDispatch } from \"react-redux\";\nimport { ChangeEvent } from 'react';\nimport gsap from 'gsap';\nimport { Channel, SoundManager } from 'global/SoundManager';\nimport { withWindow } from \"hoc/withWindow\";\nimport { setSetting } from \"store/actions/settings\";\nimport { useSettings } from \"hooks/store/settings\";\nimport \"./styles/settings.scss\";\n\nconst SettingsWindow = () => {\n  const settings = useSettings();\n  const dispatch = useDispatch();\n\n  const getChannelControls = (channel: Channel) => {\n    const handleVolumeChange = (e: ChangeEvent<HTMLInputElement>) => {\n      const linear = parseFloat(e.target.value);\n      const log = Math.pow(linear, 2);\n      SoundManager.setChannelVolume(channel, log);\n    };\n\n    const handleMuteClick = (e: React.MouseEvent<HTMLButtonElement>) => {\n      const slider = (e.currentTarget as HTMLButtonElement).parentNode?.lastChild;\n      if (slider) {\n        gsap.to(slider, {\n          duration: .5,\n          value: 0,\n          onComplete: () => {\n            SoundManager.setChannelVolume(channel, 0);\n          }\n        });\n      }\n    }\n\n    return (\n      <p>\n        <label>{Channel[channel]}</label>\n        <button onClick={handleMuteClick}>\n          <span role=\"img\" aria-label=\"Mute\">🔇</span>\n        </button>\n        <input\n          type=\"range\"\n          min=\"0\"\n          max=\"1\"\n          step=\"0.05\"\n          onChange={handleVolumeChange}\n          defaultValue={`${Math.sqrt(SoundManager.getChannelVolume(channel))}`}\n        />\n      </p>\n    )\n  }\n\n  const handleVerboseCombatLogChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    dispatch(setSetting(\"verboseCombatLog\", e.currentTarget.checked));\n  }\n\n  const handleDebugAllowAdventurerEditChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    dispatch(setSetting(\"debugAllowAdventurerEdit\", e.currentTarget.checked));\n  }\n\n  const handleDebugSceneShowPathableChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    dispatch(setSetting(\"debugSceneShowPathable\", e.currentTarget.checked));\n  }\n\n  const handleDebugSceneShowDebugSceneChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    dispatch(setSetting(\"debugSceneShowActionQueue\", e.currentTarget.checked));\n  }\n\n  return (\n    <div className=\"settings-window\">\n      <details open className=\"settings-section sound\" >\n        <summary>Sound volume</summary>\n        <section>\n          {getChannelControls(Channel.ui)}\n          {getChannelControls(Channel.scene)}\n          {getChannelControls(Channel.music)}\n          {getChannelControls(Channel.ambient)}\n        </section>\n      </details>\n      <details open className=\"settings-section combat\" >\n        <summary>Combat</summary>\n        <section>\n          <p>\n          <label>Verbose combat log</label>\n          <input\n            type=\"checkbox\"\n            checked={settings.verboseCombatLog}\n            onChange={handleVerboseCombatLogChange}\n          />\n        </p>\n        </section>\n      </details>\n      <details open className=\"settings-section debug\" >\n        <summary>Debug</summary>\n        <section>\n          <p>\n          <label>Allow adventurer stats edit</label>\n          <input\n            type=\"checkbox\"\n            checked={settings.debugAllowAdventurerEdit}\n            onChange={handleDebugAllowAdventurerEditChange}\n          />\n        </p>\n        </section>\n        <section>\n          <p>\n          <label>Show pathable tiles in scene</label>\n          <input\n            type=\"checkbox\"\n            checked={settings.debugSceneShowPathable}\n            onChange={handleDebugSceneShowPathableChange}\n          />\n        </p>\n        </section>\n        <section>\n          <p>\n          <label>Show action queue tiles in scene</label>\n          <input\n            type=\"checkbox\"\n            checked={settings.debugSceneShowActionQueue}\n            onChange={handleDebugSceneShowDebugSceneChange}\n          />\n        </p>\n        </section>\n      </details>\n    </div>\n  );\n}\n\nexport default compose(\n  withWindow,\n)(SettingsWindow);\n","import { Resource } from \"definitions/resources\";\n\n// Whenever a list of resource is shown, use this order\nexport const resourceOrder = [\n  Resource.food,\n  Resource.wood,\n  Resource.iron,\n  Resource.stone,\n  Resource.fabric,\n  Resource.leather,\n];\n","import React from 'react';\nimport Select, { Props} from 'react-select';\n\n\nfunction DefaultSelect<Option, IsMulti extends boolean = false> (props: Props<Option, IsMulti>) {\n  return <Select\n    styles={{\n      control: (provided, state) => ({\n        ...provided,\n        minHeight: 'inherit',\n        height: '32px',\n        boxShadow: '0',\n        border: state.isFocused ? '1px solid orange' : '1px solid #B1B1B1',\n        ':hover': {\n          border: '1px solid orange'\n        }       \n      }),\n      container: (provided, _state) => ({\n        ...provided,\n        flex: 1\n      }),\n      option: (provided) => ({\n        ...provided,\n        padding: '4px 12px',\n      }),\n      placeholder: (provided) => ({\n        ...provided,\n        whiteSpace: 'nowrap'\n      }), \n      valueContainer: (provided) => ({\n        ...provided,\n        marginTop: '-2px'\n      }), \n      indicatorsContainer: (provided) => ({\n        ...provided,\n        marginTop: '-2px',\n\n        'div': {\n          padding: '4px'\n        }\n      }),\n      \n    }}\n    {...props}\n  />\n}\nDefaultSelect.displayName = \"DefaultSelect\";\n\nexport default DefaultSelect;","import React, { useMemo,  useEffect, useRef, useCallback, PropsWithChildren, useState, memo } from 'react';\nimport { gsap } from 'gsap';\nimport { Container } from '@inlet/react-pixi';\nimport { SceneActionType, SceneAction, ActorObject } from 'store/types/scene';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { completeSceneAction } from 'store/actions/quests';\nimport { StoreState } from 'store/types';\nimport { BaseSceneController } from 'mechanics/scenes/BaseSceneController';\nimport SpriteAnimated from 'components/pixi/tile/SpriteAnimated';\nimport { AdventurerColor } from 'store/types/adventurer';\nimport { useQuest } from 'hooks/store/quests';\nimport ActorStats from './ActorStats';\nimport { Filter, Loader, Texture, Container as PixiContainer } from 'pixi.js';\nimport { MultiColorReplaceFilter } from '@pixi/filter-multi-color-replace';\nimport { useRandomOrientation } from './useRandomOrientation';\n\nexport interface Props  {\n  actor: ActorObject;\n  spritesheetPath: string;\n  color?: AdventurerColor;\n  controller: BaseSceneController<unknown>;\n  location?: [number, number]; // tile coordinate space\n  lookAt?: [number, number];\n  idleAnimation?: boolean;  // Only when lookAt is undefined, will randomly turn around\n}\n\nexport enum Orientation {\n  north = \"n\",\n  northEast = \"ne\",\n  east = \"e\",\n  southEast = \"se\",\n  south = \"s\",\n  southWest = \"sw\",\n  west = \"w\",\n  northWest = \"nw\"\n}\n\nconst SPRITE_WIDTH = 142;\n\n// This is a wrapper that exposes a location property. Will set x and y on children\nconst SceneActor = (props: PropsWithChildren<Props> & React.ComponentProps<typeof Container>) => {\n  const {\n    location = [0, 0],\n    controller,\n    idleAnimation,\n    color,\n    children,\n    spritesheetPath,\n    lookAt,\n    actor,\n    ...rest\n  } = props;\n  const { tileWidth, tileHeight } = controller.getTileDimensions();\n  const actorRef = useRef<PixiContainer>(null);\n  const previousAction = useRef<SceneAction>();\n  const dispatch = useDispatch();\n  const quest = useQuest(props.controller.questName);\n  const actionQueueSelector = useCallback(() => {\n    if (!quest.scene?.actionQueue) {\n      return [];\n    }\n    return quest.scene.actionQueue.filter(a => a.actorId === actor.name);\n  }, [quest.scene, actor.name]);\n\n  const actionQueue = useSelector<StoreState, SceneAction[]>(actionQueueSelector);\n  const [animation, setAnimation] = useState(\"stand\");\n  const tween = useRef<gsap.core.Tween>();\n\n  // Handle actions\n  useEffect(() => {\n    if (!actorRef) {\n      return;\n    }\n    // Determines orientation based on where the target is\n    const determineOrientation = () => {\n      if (location[0] === nextAction.target[0] && location[1] > nextAction.target[1]) {\n        setOrientation(Orientation.north);\n      }\n      else if (location[0] < nextAction.target[0] && location[1] > nextAction.target[1]) {\n        setOrientation(Orientation.northEast);\n      }\n      else if (location[0] < nextAction.target[0] && location[1] === nextAction.target[1]) {\n        setOrientation(Orientation.east);\n      }\n      else if (location[0] < nextAction.target[0] && location[1] < nextAction.target[1]) {\n        setOrientation(Orientation.southEast);\n      }\n      else if (location[0] === nextAction.target[0] && location[1] < nextAction.target[1]) {\n        setOrientation(Orientation.south);\n      }\n      else if (location[0] > nextAction.target[0] && location[1] < nextAction.target[1]) {\n        setOrientation(Orientation.southWest);\n      }\n      else if (location[0] > nextAction.target[0] && location[1] === nextAction.target[1]) {\n        setOrientation(Orientation.west);\n      }\n      else if (location[0] > nextAction.target[0] && location[1] > nextAction.target[1]) {\n        setOrientation(Orientation.northWest);\n      }\n    }\n    const nextAction = actionQueue[0];\n    if (nextAction && nextAction !== previousAction.current) {\n      // console.log(`next action is ${nextAction.target} (${nextAction.actionType}), \\ncurrent location is: ${location}\\nprev action was ${previousAction?.current?.target} `)\n      switch (nextAction.actionType) {\n        case SceneActionType.move: {\n          const moveComplete = () => {\n            dispatch(completeSceneAction(props.controller.questName));\n            props.controller.actorMoved(actor.name, nextAction.target);\n          }\n          const duration = (nextAction.endsAt - performance.now()) / 1000;\n          if (duration < 0) {\n            moveComplete();\n          }\n\n          // determine orientation\n          determineOrientation();\n          setAnimation(\"walk\");\n          gsap.killTweensOf(actorRef.current);\n          tween.current = gsap.to(actorRef.current, {\n            duration,\n            ease: \"linear\",\n            pixi: {\n              x: nextAction.target[0] * tileWidth,\n              y: nextAction.target[1] * tileHeight\n            },\n            onComplete: moveComplete\n          });\n          break;\n        }\n        case SceneActionType.slash: {\n          determineOrientation();\n          setAnimation(\"attack\");\n          props.controller.actorSlashing(actor.name, nextAction.target);\n\n          const attackComplete = () => {\n            setAnimation(\"stand\");\n            dispatch(completeSceneAction(props.controller.questName));\n            props.controller.actorSlashed(actor.name, nextAction.target);\n          }\n          setTimeout(attackComplete, 1000);\n          break;\n        }\n        case SceneActionType.shoot: {\n          determineOrientation();\n          setAnimation(\"attack\");\n          props.controller.actorShooting(actor.name, nextAction.target);\n\n          const attackComplete = () => {\n            setAnimation(\"stand\");\n            dispatch(completeSceneAction(props.controller.questName));\n            props.controller.actorShot(actor.name, nextAction.target);\n          }\n          setTimeout(attackComplete, 500);\n          break;\n        }\n        case SceneActionType.interact: {\n          controller.actorInteract(actor.name, nextAction.target);\n          dispatch(completeSceneAction(props.controller.questName));\n          break;\n        }\n      }\n      previousAction.current = nextAction;\n    }\n  }, [dispatch, tileWidth, tileHeight, actionQueue, props.controller, props.name, location, controller]);\n\n  useEffect(() => {\n    return () => {\n      tween.current?.kill();\n    }\n  }, []);\n\n  const {x, y} = useMemo(() => {\n    setAnimation(\"stand\")\n\n    return {\n      x: location[0] * tileWidth,\n      y: location[1] * tileHeight,\n    };\n  }, [location, tileWidth, tileHeight]);\n\n  const [frames, setFrames] = useState<{ [key: string]: Texture[]}|null>(null);\n\n  useEffect(() => {\n    if (!spritesheetPath) return;\n\n    if (!Loader.shared.resources[spritesheetPath]?.textures){\n      throw new Error(`No textures for ${spritesheetPath}`);\n    }\n    const allFrames = Object.keys(Loader.shared.resources[spritesheetPath].textures ?? {});\n    const indexed = allFrames.reduce((acc: {[key: string]: Texture[] }, frame: string) => {\n      // frames are in the format of: 'stand-n', 'walk0-ne', 'walk1-ne' etc\n      // create a mapping with arrays keyed by the part without the number,\n      // eg: 'stand-n': [TEXTURE:stand-n] and 'walk-ne': [TEXTURE:walk0-ne, TEXTURE:walk1-ne]\n      const key = frame.replace(/[0-9]/g, '');\n      if (!acc[key]) {\n        acc[key] = [];\n      }\n      const texture = Loader.shared.resources[spritesheetPath].textures?.[frame];\n      if (texture) acc[key].push(texture);\n      return acc;\n    }, {});\n    setFrames(indexed);\n  }, [spritesheetPath])\n\n  const [orientation, setOrientation] = useState<Orientation>(Orientation.north);\n  // const [flipped, setFlipped] = useState(false);\n  const flipped = useRef(false);\n  const setFlipped = (value:boolean) => {\n    flipped.current = value;\n  }\n\n  useEffect(() => {\n    if (lookAt !== undefined) {\n      const bearing = calculateBearing(location, lookAt);\n      setOrientation(bearing);\n    }\n  }, [location, lookAt])\n\n  useEffect(() => {\n    setFlipped(orientation === Orientation.southWest || orientation === Orientation.west || orientation === Orientation.northWest)\n  }, [orientation]);\n\n  useRandomOrientation(!!idleAnimation && !lookAt, orientation, setOrientation)\n\n  const getFrames = useCallback(() => {\n    const spritesheet = Loader.shared.resources[spritesheetPath];\n    // Prefix all animations with the name of the image (without the extension) and a hyphen\n    // So `orc-axe-walk0-n`, `skeleton-attack1-e`\n    const prefix = `${spritesheet.data.meta.image.substring(0, spritesheet.data.meta.image.lastIndexOf('.'))}-`;\n    switch (orientation) {\n      case Orientation.northWest:\n        return `${prefix}${animation}-${Orientation.northEast}`;\n      case Orientation.west:\n        return `${prefix}${animation}-${Orientation.east}`;\n      case Orientation.southWest:\n        return `${prefix}${animation}-${Orientation.southEast}`;\n      default:\n        return `${prefix}${animation}-${orientation}`;\n    }\n  }, [animation, orientation]);\n\n  const filters = useMemo<Filter[]>(() => {\n    switch (color) {\n      case AdventurerColor.black:\n        return [createColorReplaceFilter(BLUES, BLACK)];\n      case AdventurerColor.orange:\n        return [createColorReplaceFilter(BLUES, ORANGE)];\n      case AdventurerColor.purple:\n        return [createColorReplaceFilter(BLUES, PURPLE)];\n      case AdventurerColor.red:\n        return [createColorReplaceFilter(BLUES, REDS)];\n      case AdventurerColor.teal:\n        return [createColorReplaceFilter(BLUES, TEALS)];\n      case AdventurerColor.white:\n        return [createColorReplaceFilter(BLUES, WHITE)];\n      case AdventurerColor.yellow:\n        return [createColorReplaceFilter(BLUES, YELLOW)];\n\n      // case AdventurerColor.blue:\n      default:\n        return [];\n    }\n  }, [color])\n  const showThingy = !!quest.scene?.combat;\n  return (\n    <Container x={x} y={y} ref={actorRef} {...rest}>\n      { spritesheetPath && frames && (\n        <SpriteAnimated\n          animationSpeed={0.1}\n          name={`${actor.id}-sprite`}\n          isPlaying={true}\n          textures={frames[getFrames()]}\n          x={SPRITE_WIDTH/4}\n          y={20}\n          scale={[(flipped.current ? -1 : 1), 1]}\n          anchor={[.5, .5]}\n          pivot={[0, 0]}\n          filters={filters}\n        />\n      )}\n      {children}\n      {showThingy && (\n        <ActorStats tileWidth={tileWidth} actor={actor} />\n      )}\n    </Container>\n  )\n};\n\nexport default memo(SceneActor);\n\n// Calculates an orientation that origin would be in if it was looking at destination\nconst calculateBearing = (origin: [number, number], destination: [number, number]) => {\n  const angle = Math.atan2(destination[1] - origin[1], destination[0] - origin[0]);\n  const result = Math.round((angle / (2 * Math.PI / 8) + 8) % 8);\n  const orientations = [Orientation.east, Orientation.southEast, Orientation.south, Orientation.southWest, Orientation.west, Orientation.northWest, Orientation.north, Orientation.northEast];\n  return orientations[result];\n}\n\nconst createColorReplaceFilter = (from: number[], to: number[]) => {\n  const replacements: [number, number][] = from.map((val, index) => {\n    return [\n      from[index], to[index]\n    ]\n  });\n  // todo!!\n  return new MultiColorReplaceFilter(replacements, 0.15);\n}\n\nconst BLUES = [\n  0x000e5f,\n  0x00227f,\n  0x0038a5,\n  0x0055cc,\n];\n\nconst REDS = [\n  0x570800,\n  0x700c00,\n  0x901000,\n  0xb51700\n];\n\nconst TEALS = [\n  0x00330d,\n  0x00653a,\n  0x08936f,\n  0x30bea5\n];\n\nconst PURPLE = [\n  0x3b0d3a,\n  0x641d5e,\n  0x884696,\n  0xaa61bd\n];\n\nconst ORANGE = [\n  0x802d0c,\n  0xaa4a12,\n  0xd16d11,\n  0xf59717\n];\n\nconst BLACK = [\n  0x0d0d1a,\n  0x1a1b2b,\n  0x25263a,\n  0x35354c\n];\n\nconst WHITE = [\n  0x30375e,\n  0x676993,\n  0xa9aac2,\n  0xe6e6e6\n];\n\nconst YELLOW = [\n  0xc28600,\n  0xd6ae10,\n  0xe9d333,\n  0xfdf959\n];\n","import * as React from \"react\";\nimport { useEffect, useMemo,  useState } from 'react';\nimport { getDefinition } from \"definitions/items\";\nimport { ItemType, ItemCategory } from \"definitions/items/types\";\nimport { getDefinition as getStructureDefinition, Structure } from \"definitions/structures\";\nimport { StructureState, StructureStoreState } from \"store/types/structure\";\nimport { StructuresStoreState } from \"store/types/structures\";\nimport { TextManager } from \"global/TextManager\";\nimport { ToastManager } from 'global/ToastManager';\nimport { Type } from 'components/ui/toasts/Toast';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { addLogText } from 'store/actions/log';\nimport { LogChannel } from 'store/types/logEntry';\nimport { resourceOrder } from 'constants/resources';\nimport { ResourceStoreState } from 'store/types/resources';\nimport { addResources } from 'store/actions/resources';\nimport { setStructureState } from 'store/actions/structures';\nimport { StoreState } from 'store/types';\nimport { addGold } from 'store/actions/gold';\nimport { addItemToWarehouse } from 'store/actions/stockpile';\nimport { withWindow } from 'hoc/withWindow';\nimport { getTimeMultiplier, setCheatTimeMultiplier, TimeType } from 'mechanics/time';\nimport ItemIcon from \"components/ui/items/ItemIcon\";\nimport { IconSize } from \"components/ui/common/Icon\";\nimport Button from \"components/ui/buttons/Button\";\nimport Select from \"components/ui/common/Select\";\nimport allItems from \"definitions/items\";\nimport { addWorkers } from \"store/actions/workers\";\nimport \"./styles/cheat.scss\";\n\ninterface Options {\n  label: ItemCategory;\n  value: string;\n  subtext: string\n}\n\nconst CheatWindow = () => {\n\n  const [cheats, setCheats] = useState({\n    gold: 50,\n    resources: 50,\n    workers: 10,\n  });\n  const [selectedItem, setSelectedItem] = useState<string|null>();\n  const dispatch = useDispatch();\n  const [timeMultiplier, setTimeMultiplier] = useState(getTimeMultiplier(TimeType.cheat));\n\n  const onCheatGold = (amount: number) => {\n    dispatch(addGold(amount));\n    dispatch(addLogText(\"common-cheat-gold-added\", { amount }, LogChannel.common));\n  };\n\n  const onCheatItem = (type: ItemType) => {\n    const item = { type }\n    dispatch(addItemToWarehouse(item));\n    dispatch(addLogText(\"common-cheat-item-added\", { item }, LogChannel.common));\n  };\n\n  const onCheatResources = (amount: number) => {\n    // Create ResourceStoreState where value of each resource is `amount`\n    const resources = resourceOrder.reduce((acc: ResourceStoreState, resource) => {\n      acc[resource] = amount;\n      return acc;\n    }, {});\n\n    dispatch(addResources(resources));\n    dispatch(addLogText(\"common-cheat-resources-added\", { amount }, LogChannel.common));\n  };\n\n  const onCheatStructureState = (structure: Structure, state: StructureState) => {\n    dispatch(setStructureState(structure, state))\n  }\n\n  const onCheatWorkers = (amount: number) => {\n    dispatch(addWorkers(amount));\n    dispatch(addLogText(\"common-cheat-workers-added\", { amount }, LogChannel.common));\n  };\n\n  const structures = useSelector<StoreState, StructuresStoreState>(store => store.structures);\n\n  const getStructureRow = (structure: Structure) => {\n    const structureDef = getStructureDefinition(structure);\n    const structureStore: StructureStoreState = structures[structure];\n    const levelDef = structureDef.levels[structureStore.level];\n\n    const displayName = TextManager.get(levelDef.displayName);\n\n    return (\n      <div\n        className=\"label-dropdown\"\n        key={structure}\n      >\n        <label title={structure}>\n          {`${displayName}`}\n        </label>\n        <input\n          key={structure}\n          type=\"checkbox\"\n          checked={structureStore.state === StructureState.Built}\n          onChange={() => handleChangeStructureState(structure, structureStore.state !== StructureState.Built)}\n        />\n      </div>\n    );\n  };\n\n  const handleCheatGold = (_evt: React.MouseEvent<HTMLButtonElement>) => {\n    const amount = cheats.gold;\n    onCheatGold(amount);\n\n    const text = TextManager.get(\"common-cheat-gold-added\", { amount });\n    const icon = \"/img/resources/gold.png\";\n    ToastManager.addToast(text, Type.cheat, icon);\n  }\n\n  const handleCheatWorkers = (_evt: React.MouseEvent<HTMLButtonElement>) => {\n    const amount = cheats.workers;\n    onCheatWorkers(amount);\n    const text = TextManager.get(\"common-cheat-workers-added\", { amount });\n    const icon = \"/img/resources/worker.png\";\n    ToastManager.addToast(text, Type.cheat, icon);\n  }\n\n  const handleCheatResources = (_evt: React.MouseEvent<HTMLButtonElement>) => {\n    onCheatResources(cheats.resources);\n    const text = TextManager.get(\"common-cheat-resources-added\", { amount: cheats.resources });\n    ToastManager.addToast(text, Type.cheat);\n  }\n\n  const handleCheatItem = (_evt: React.MouseEvent<HTMLButtonElement>) => {\n    const item = selectedItem as ItemType;\n    onCheatItem(item);\n\n    const text = TextManager.get(\"common-cheat-item-added\", { item });\n    const icon = getDefinition(item).iconImg;\n    ToastManager.addToast(text, Type.cheat, icon);\n  }\n\n  const handleChangeStructureState = (structure: Structure, checked: boolean) => {\n    onCheatStructureState(structure, checked ? StructureState.Built : StructureState.NotBuilt);\n    if (checked) {\n      ToastManager.addToast(`The ${TextManager.getStructureName(structure)} is constructed`, Type.cheat);\n    } else {\n      ToastManager.addToast(`The ${TextManager.getStructureName(structure)} is not constructed`, Type.cheat);\n    }\n  }\n\n  const handleChangeGold = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const amount = Number.parseFloat(event.target.value);\n    setCheats({\n      ...cheats,\n      gold: amount,\n    });\n  }\n\n  const handleChangeWorkers = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const amount = Number.parseFloat(event.target.value);\n    setCheats({\n      ...cheats,\n      workers: amount,\n    });\n  }\n\n  const handleChangeResources = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const amount = Number.parseFloat(event.target.value);\n    setCheats({\n      ...cheats,\n      resources: amount,\n    });\n  }\n\n  const handleChangeTimeMultiplier = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const value = Number.parseFloat(event.target.value);\n    setTimeMultiplier(value)\n    setCheatTimeMultiplier(value);\n  }\n\n  const items = useMemo(() => (Object.keys(ItemCategory)\n    .filter(k => !isNaN(parseInt(k))) // such a weird way to unumerate an enum.. sigh\n    .map((typeKey: string) => {\n      const type = ItemCategory[typeKey as unknown as number] as unknown as ItemCategory;\n      return {\n        label: type as unknown as ItemCategory,\n        value: \"\",\n        subtext: \"\",\n        options: Object.keys(allItems)\n          .filter((item: string) => getDefinition(item as ItemType).itemCategory as unknown as string == typeKey)\n          .map((item: string) => ({\n            value: item,\n            label: TextManager.getItemName(item as ItemType),\n            subtext: TextManager.getItemSubtext(item as ItemType),\n          })\n        )\n      }\n    })\n  ), []);\n\n  useEffect(() => {\n    if (process.env.NODE_ENV === 'development') {\n      TextManager.printNotFounds();\n    }\n  }, [])\n\n  return (\n    <div className=\"cheat-window\">\n      <div className=\"label-numberbox-button\">\n        <label>Gold</label>\n        <input type=\"number\"\n          value={cheats.gold}\n          style={{ width: \"50px\" }}\n          onChange={handleChangeGold} />\n        <button onClick={handleCheatGold}>Add</button>\n      </div>\n      <div className=\"label-numberbox-button\">\n        <label>Workers</label>\n        <input type=\"number\"\n          value={cheats.workers}\n          style={{ width: \"50px\" }}\n          onChange={handleChangeWorkers} />\n        <button onClick={handleCheatWorkers}>Add</button>\n      </div>\n      <div className=\"label-numberbox-button\">\n        <label>Resources</label>\n        <input type=\"number\"\n          value={cheats.resources}\n          style={{ width: \"50px\" }}\n          onChange={handleChangeResources} />\n        <button onClick={handleCheatResources}>Add</button>\n      </div>\n      <div className=\"label-numberbox-button\">\n        <label>Items</label>\n        <Select<Options, false>\n          placeholder={\"Find item in any category...\"}\n          onChange={(e) => setSelectedItem(e?.value)}\n          formatGroupLabel={(data) => (\n            <div className=\"item-group\">\n              <div className=\"item-group-label\">{data.label}</div>\n              <div className=\"item-group-count\">{data.options.length} items</div>\n            </div>\n          )}\n          formatOptionLabel={option => (\n            <div className=\"item-option\">\n              <ItemIcon item={ {type: option.value as ItemType}} size={IconSize.smallest} />\n              <div className=\"item-label\">\n                {option.label}\n                <span>{(option as unknown as { subtext: string}).subtext}</span>\n              </div>\n            </div>\n          )}\n          options={items} />\n        <Button onClick={handleCheatItem}>Add</Button>\n      </div>\n      <div className=\"label-range-value\">\n        <label>Speed</label>\n        <input\n          type=\"range\"\n          min=\"1\" max=\"10\" value={timeMultiplier} step={1}\n          onChange={handleChangeTimeMultiplier}\n        />\n        {timeMultiplier}x speed\n      </div>\n      <div>\n        <h2>Structures</h2>\n      </div>\n      { Object.keys(structures).map((structure) => getStructureRow(structure as Structure))}\n    </div>\n  );\n}\n\nexport default withWindow(CheatWindow);\n\n","export type WorkersAction = {\n  type: \"addWorkers\",\n  value: number\n}\n\nexport const addWorkers = (value: number): WorkersAction => ({\n  type: \"addWorkers\",\n  value,\n})\n\nexport const subtractWorkers = (value: number): WorkersAction => ({\n  type: \"addWorkers\",\n  value: -value,\n})\n","import { createSelector } from \"reselect\";\nimport { adventurersOnQuest } from 'store/helpers/storeHelpers';\nimport { StoreState } from 'store/types';\nimport { AdventurerStoreState } from \"store/types/adventurer\";\nimport { QuestStatus, QuestStoreState } from 'store/types/quest';\n\n// maybe this is not used anymore?\n\n// Store accessors\nconst getAdventurers = (state: StoreState): AdventurerStoreState[] => state.adventurers;\nconst getQuests = (state: StoreState): QuestStoreState[] => state.quests;\n\nexport const groupAdventurersByQuest = (adventurers: AdventurerStoreState[], quests: QuestStoreState[]): Record<string, AdventurerStoreState[]> => {\n  const foundInParty: AdventurerStoreState[] = []; // store the adventurers in parties in a temp array\n\n  const groupedAdventurers = Object.values(quests).reduce<{[key: string]: AdventurerStoreState[]}>((acc, value) => {\n    const foundAdventurers = adventurersOnQuest(adventurers, value);\n    if (value.status === QuestStatus.active) {\n      // Only active quests\n      acc[value.name] = foundAdventurers;\n    }\n    foundInParty.push(...foundAdventurers);\n    return acc;\n  }, {});\n\n  // Add a special group called 'solo' for those adventurers not in a party\n  const soloKey = \"solo\";\n  groupedAdventurers[soloKey] = adventurers.filter((a) => foundInParty.indexOf(a) === -1);\n\n  return groupedAdventurers;\n};\n\nconst getAdventurersInTown = (adventurers: AdventurerStoreState[], quests: QuestStoreState[]): AdventurerStoreState[] => {\n  // Get an array of all adventurer ids on any active quest\n  const adventurersOnQuest = quests.reduce<string[]>((acc, val: QuestStoreState) => {\n    if (val.status === QuestStatus.active) {\n      acc.push(...val.party);\n    }\n    return acc;\n  }, []);\n\n  return adventurers.filter((a) => adventurersOnQuest.indexOf(a.id) === -1);\n};\n\n/** Returns an object keyed by active quests whose value is a list of AdventurerStoreState */\nexport const selectAdventurersGroupedByQuest = createSelector([\n  getAdventurers,\n  getQuests],\n  groupAdventurersByQuest,\n);\n\n/** Returns a selector keyed by active quests whose value is a list of AdventurerStoreState */\nexport const createSelectAdventurersOnQuest = (questName: string) => {\n  const getAdventurersOnQuest = (adventurers: AdventurerStoreState[], quests: QuestStoreState[]): AdventurerStoreState[] => {\n    const quest = quests.find(q => q.name === questName);\n    if (!quest) throw new Error(`No quest named ${questName}`)\n    return adventurersOnQuest(adventurers, quest);\n  };\n\n  return createSelector([\n    getAdventurers,\n    getQuests],\n    getAdventurersOnQuest,\n  );\n}\n\n/** Returns an object keyed by active quests whose value is a list of AdventurerStoreState */\nexport const selectAdventurersInTown = createSelector([\n  getAdventurers,\n  getQuests],\n  getAdventurersInTown,\n);\n","// Displays various game stats\n\nimport { Resource } from \"definitions/resources\";\nimport { Structure } from \"definitions/structures\";\nimport { TextManager } from \"global/TextManager\";\nimport { Fragment, useMemo } from \"react\";\nimport { groupAdventurersByQuest } from \"store/selectors/adventurers\";\nimport { StoreState } from \"store/types\"\nimport { QuestStatus } from \"store/types/quest\";\nimport { StructureState } from \"store/types/structure\";\nimport { formatDuration } from \"utils/format/time\";\nimport { convertIntToSemVer } from \"utils/version\";\nimport * as Version from \"constants/version\";\nimport \"./styles/gameStats.scss\";\n\ntype Props = {\n  state: StoreState\n}\n\nconst GameStats = (props: Props) => {\n  const { state } = props;\n  const timePlaying = formatDuration(state.engine.lastTick - (state.engine.gameStarted ?? 0), true)\n  const groupedAdventurers = groupAdventurersByQuest(state.adventurers, state.quests);\n  const version = useMemo(() => {\n    if (!state.game?.version) return \"unknown\";\n    if (state.game.version === Version.asInt) {\n      return convertIntToSemVer(state.game.version);\n    }\n    return (\n      <>\n        <span className=\"invalid\">{convertIntToSemVer(state.game.version)}</span>\n        <span className=\"prop\"> (current: </span>\n        <span>{convertIntToSemVer(Version.asInt)}</span>\n        <span className=\"prop\">) </span>\n      </>\n    )\n  }, []);\n\n  return (\n    <div className=\"game-stats\">\n      <div className=\"column\">\n        <fieldset>\n          <legend>General</legend>\n          <dl>\n            <dt>Time playing</dt>\n            <dd>{timePlaying}</dd>\n            <dt>Version</dt>\n            <dd>{version}</dd>\n            <dt>Quests active</dt>\n            <dd>{state.quests.filter(q => q.status === QuestStatus.active).length}</dd>\n            <dt>Quests completed</dt>\n            <dd>{state.quests.filter(q => q.status === QuestStatus.completed).length}</dd>\n          </dl>\n        </fieldset>\n        <fieldset>\n          <legend>Structures</legend>\n          <dl>\n            {Object.keys(state.structures).map(key => {\n              const structure = key as Structure;\n              if (state.structures[structure].state === StructureState.Built) {\n                return (\n                  <Fragment key={structure}>\n                    <dt>{TextManager.getStructureName(structure)}</dt>\n                    <dd>{TextManager.get(\"ui-structure-level\")} {state.structures[structure].level + 1}</dd>\n                  </Fragment>\n                )\n              }\n              if (state.structures[structure].state === StructureState.Building) {\n                return (\n                  <Fragment key={structure}>\n                    <dt>{TextManager.getStructureName(structure)}</dt>\n                    <dd>constructing...</dd>\n                  </Fragment>\n                )\n              }\n            })}\n          </dl>\n        </fieldset>\n      </div>\n      <div className=\"column\">\n        <fieldset>\n          <legend>Resources</legend>\n          <dl>\n            {Object.keys(state.resources).map(key => {\n              const resource = key as Resource;\n              return (\n                <Fragment key={resource}>\n                  <dt>{TextManager.getResourceName(resource)}</dt>\n                  <dd>{state.resources[resource]}</dd>\n                </Fragment>\n              )\n            })}\n            <dt>{TextManager.get(\"resource-gold-name\")}</dt>\n            <dd>{state.gold}</dd>\n            <dt>{TextManager.get(\"resource-workers-name\")}</dt>\n            <dd>{state.workers}</dd>\n          </dl>\n        </fieldset>\n        <fieldset>\n          <legend>Adventurers</legend>\n          <dl>\n            <dt>In tavern</dt>\n            <dd>{groupedAdventurers.solo.length}</dd>\n            <dt>On quest</dt>\n            <dd>{state.adventurers.length - groupedAdventurers.solo.length}</dd>\n          </dl>\n        </fieldset>\n      </div>\n    </div>\n  )\n}\n\nexport default GameStats\n","import { createEncryptor } from 'simple-encryptor';\nimport { StoreState } from 'store/types';\nconst key = \"P5mw}jD>5c6Y]yqy\";\nconst encryptor = createEncryptor(key);\n\nexport const saveGame = (storeState: StoreState) => {\n  const a = document.createElement('a');\n  const text = JSON.stringify(storeState);\n  const encrypted = encryptor.encrypt(text);\n  const filename = \"Gidletown save.json\";\n  a.setAttribute('href', 'data:text/json;charset=utf-8,' + encodeURIComponent(encrypted));\n  a.setAttribute('download', filename);\n  a.click();\n}\n\nexport const decryptSavedGame = (encrypted: string) : StoreState => {\n  const text = encryptor.decrypt(encrypted);\n  return JSON.parse(text);\n}\n","import { Props as WindowProps } from \"components/ui/window/Window\";\nimport { AppContextProps, withAppContext } from \"hoc/withAppContext\";\nimport { withWindow } from \"hoc/withWindow\";\nimport * as React from \"react\";\nimport { compose } from \"redux\";\nimport { useSelector } from 'react-redux';\nimport { StoreState } from 'store/types';\nimport { loadGame } from 'index';\nimport { useState } from 'react';\nimport { ToastManager } from 'global/ToastManager';\nimport { Type } from 'components/ui/toasts/Toast';\nimport { TextManager } from 'global/TextManager';\nimport Button from 'components/ui/buttons/Button';\nimport { decryptSavedGame, saveGame } from \"utils/game\";\nimport GameStats from \"components/ui/game/GameStats\";\nimport \"./styles/saveAndLoad.scss\";\n\n\ntype AllProps = WindowProps;\nconst SaveAndLoad = (props: AllProps & AppContextProps) => {\n\n  const storeState = useSelector<StoreState, StoreState>(state => state);\n  const [loadedStore, setLoadedStore] = useState<StoreState>();\n  const [loading, setLoading] = useState(false);\n\n  const handleClickSave = () => {\n     saveGame(storeState);\n  }\n\n  const handleClickLoad = async () => {\n    if (!loadedStore) return;\n    setLoading(true);\n    setLoadedStore(undefined);\n\n    await loadGame(loadedStore);\n    ToastManager.addToast(TextManager.get(\"ui-game-loaded\"), Type.game, \"/img/items/misc/magic-eye.png\");\n    props.onCloseWindow();\n\n  }\n\n  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const fileReader = new FileReader();\n    fileReader.onload = () => {\n      const encrypted = fileReader.result as string;\n      const state =  decryptSavedGame(encrypted)\n\n      setLoadedStore(state);\n    }\n    if (e.target.files){\n      fileReader.readAsText(e.target.files[0]);\n    }\n  }\n\n\n\n  return (\n    <div className=\"save-and-load\">\n      <section>\n        Save game to disk:&nbsp;\n        <Button onClick={handleClickSave}>Save</Button>\n      </section>\n      <section>\n        Load game from disk:&nbsp;\n        <input type=\"file\" onChange={handleFileChange} />\n        <Button onClick={handleClickLoad} disabled={!loadedStore}>Load</Button>\n      </section>\n      <div>\n        { loading && \"Loading... please wait\" }\n        { loadedStore && <GameStats state={loadedStore} />}\n      </div>\n    </div>\n  );\n}\n\nexport default compose(\n  withWindow,\n  withAppContext,\n)(SaveAndLoad) as React.ComponentType<AllProps>;\n","import { Props as WindowProps } from \"components/ui/window/Window\";\nimport { AppContextProps, withAppContext } from \"hoc/withAppContext\";\nimport { withWindow } from \"hoc/withWindow\";\nimport * as React from \"react\";\nimport { compose } from \"redux\";\nimport SettingsWindow from './SettingsWindow';\nimport CheatWindow from './CheatWindow';\nimport { useSelector } from 'react-redux';\nimport { StoreState } from 'store/types';\nimport Button from 'components/ui/buttons/Button';\nimport GameStats from \"components/ui/game/GameStats\";\nimport SaveAndLoadWindow from \"./SaveAndLoadWindow\";\nimport \"./styles/menu.scss\";\n\n\ntype AllProps = WindowProps;\nconst Menu = (props: AllProps & AppContextProps) => {\n\n  const storeState = useSelector<StoreState, StoreState>(state => state);\n\n  const handleClickCheats = () => {\n    const window = <CheatWindow title=\"Cheats\" />;\n    props.onOpenWindow(window);\n  };\n\n  const handleClickSettings = () => {\n    const window = <SettingsWindow title=\"Settings\" />;\n    props.onOpenWindow(window);\n  };\n\n  const handleClickSaveAndLoad = () => {\n    const window = <SaveAndLoadWindow title=\"Save and Load\" />;\n    props.onOpenWindow(window);\n  }\n\n  return (\n    <div className=\"menu\">\n      <p>\n        <Button onClick={handleClickSaveAndLoad}>Save and load</Button>\n      </p>\n      <p>\n        <Button onClick={handleClickCheats}>Cheats!</Button>\n      </p>\n      <p>\n        <Button onClick={handleClickSettings}>Settings</Button>\n      </p>\n      <div>\n        <GameStats state={storeState} />\n      </div>\n    </div>\n  );\n}\n\nexport default compose(\n  withWindow,\n  withAppContext,\n)(Menu) as React.ComponentType<AllProps>;\n","import { resourceOrder } from \"constants/resources\";\nimport resourceDescriptions, { Resource } from \"definitions/resources\";\nimport * as React from \"react\";\nimport { ResourceStoreState } from \"store/types/resources\";\nimport { formatNumber } from 'utils/format/number';\nimport { TooltipManager } from 'global/TooltipManager';\nimport { ContextType } from 'constants/context';\nimport useGoldState from 'hooks/store/useGoldState';\nimport { useMaxResourcesState, useResourcesState } from 'hooks/store/resources';\nimport { useWorkersFreeState } from 'hooks/store/useWorkersState';\nimport Icon from 'components/ui/common/Icon';\nimport \"./styles/resourcebar.scss\";\n\nexport interface StateProps  {\n  gold: number;\n  workers: number;  // total\n  workersFree: number;\n  resources: ResourceStoreState;\n}\n\n/** Shown on top in the UI */\nconst Resourcebar = () => {\n\n  const goldState = useGoldState();\n  const storeResources = useResourcesState();\n  const workersFree = useWorkersFreeState();\n  const maxResources = useMaxResourcesState();\n\n  const createItem = (icon: string, amount: number, type: Resource | \"workers\" | \"gold\") => {\n    const full = type !== \"workers\" && type !== \"gold\" && (amount ?? 0) >= (maxResources?.[type] ?? 0);\n\n    const handleClick = (event: React.MouseEvent) => {\n\n      const origin = (event.currentTarget as HTMLElement);\n      const originRect = origin.getBoundingClientRect();\n      TooltipManager.showContextTooltip(ContextType.resource, type, originRect);\n      event.stopPropagation();\n    };\n\n    return (\n      <li key={type} onClick={handleClick}>\n        <Icon\n          image={icon}\n          size=\"smallest\"\n        />\n        <div className={`amount ${full ? \"full\" : \"\"}`}>\n          { formatNumber(amount, 0) }\n        </div>\n      </li>\n    )\n  };\n\n  const resources = resourceOrder.map((resource) => {\n    const resourceDescription = resourceDescriptions[resource];\n    return createItem(resourceDescription.iconImg, storeResources[resource] ?? 0, resource);\n  });\n\n  resources.push(\n    createItem(\"/img/resources/worker.png\", workersFree, \"workers\"),\n    createItem(\"/img/resources/gold.png\", goldState, \"gold\"),\n  );\n\n  return (\n    <ul className=\"resourcebar\">\n      { resources }\n    </ul>\n  );\n};\nexport default Resourcebar;\n","import Menu from \"components/ui/window/windows/MenuWindow\";\nimport * as React from \"react\";\nimport Resourcebar from './Resourcebar';\nimport { useContext } from 'react';\nimport { AppContext } from 'components/App';\nimport \"./styles/topbar.scss\";\n\nconst Topbar = () => {\n  const context = useContext(AppContext);\n\n  const handleClick = (_e: React.MouseEvent<HTMLDivElement, MouseEvent>) => {\n    const window = <Menu title = \"Menu\" />;\n    context?.onOpenWindow(window);\n  };\n\n  return (\n    <div className=\"topbar\">\n      <div className=\"topbar-left\">\n        <Resourcebar />\n      </div>\n      <div className=\"topbar-right\">\n        <div className=\"hamburger\" onClick={handleClick}>☰</div>\n      </div>\n    </div>\n  );\n}\nexport default Topbar;\n","import React, { useRef, useEffect } from 'react';\nimport { Sprite } from '@inlet/react-pixi';\nimport * as PIXI from 'pixi.js';\nimport { QuestStoreState } from 'store/types/quest';\nimport { AdventurerStoreState } from 'store/types/adventurer';\nimport { Point } from 'pixi.js';\n\ninterface Props {\n  quest: QuestStoreState;\n  position: Point;\n  selected?: boolean;\n  encounterActive?: boolean;\n  onClick?: (quest: QuestStoreState) => void;\n  leader: AdventurerStoreState;\n}\nconst CIRCLE_DIAMETER = 256; // = avatar size / 2\n\nconst QuestMarker = (props: Props) => {\n  const { quest, leader, encounterActive, position, onClick, selected } = props;\n  const image = selected ? '/img/world/map-marker-selected.png' : '/img/world/map-marker.png';\n\n  const avatar = useRef<PIXI.Sprite>(null);\n  // Mask has to be a child of the avatar in order to move with it\n  useEffect(() => {\n    const sprite = avatar.current as PIXI.Sprite;\n\n    const maskGraphics = new PIXI.Graphics();\n    maskGraphics.beginFill(0xBADA55);\n    maskGraphics.drawCircle(0, 0, CIRCLE_DIAMETER * 1);\n    maskGraphics.endFill();\n\n    sprite.mask = maskGraphics;\n    sprite.addChild(maskGraphics);\n  }, [avatar]);\n\n  return (\n    <Sprite\n      image={`${process.env.PUBLIC_URL}${image}`}\n      name={quest.name}\n      x={position.x}\n      y={position.y}\n      interactive={true}\n      buttonMode={true}\n      scale={new Point(0.1, 0.1)}\n      anchor={new Point(0.5, 1)}\n      pointerdown={() => {\n        if(onClick) {\n          onClick(quest);\n        }\n      }}\n    >\n      { leader && (\n      <Sprite\n        image={`${process.env.PUBLIC_URL}${leader.avatarImg}`}\n        name=\"avatar\"\n        anchor={new Point(0.5, 0.5)}\n        x={0}\n        y={-396}\n        scale={new Point(0.66, 0.66)}\n        ref={avatar}\n      />)}\n      {encounterActive && (\n      <Sprite\n        image={`${process.env.PUBLIC_URL}/img/world/quest-alert.png`}\n        name=\"quest-alert\"\n        anchor={new Point(0.5, 1)}\n        x={180}\n        y={-396}\n        scale={new Point(2, 2)}\n      />\n      )}\n    </Sprite>\n  )\n}\n\nexport default QuestMarker;\n","import React from \"react\";\nimport { Graphics } from '@inlet/react-pixi';\nimport { Point } from \"pixi.js\";\n\ninterface Props {\n  positions: Point[];\n}\n\nconst QuestLine = (props: Props) => {\n  const { positions } = props;\n  if (props.positions.length > 2) {\n    return <Graphics\n      name=\"questline\"\n      x={0}\n      y={0}\n      draw={graphics => {\n        graphics.lineStyle(3, 0xFF3300);\n        graphics.moveTo(positions[0].x, positions[0].y);\n\n        let i = 0;\n        for (i = 1; i < positions.length - 2; i ++) {\n          const xc = (positions[i].x + positions[i + 1].x) / 2;\n          const yc = (positions[i].y + positions[i + 1].y) / 2;\n          graphics.quadraticCurveTo(positions[i].x, positions[i].y, xc, yc);\n        }\n        graphics.quadraticCurveTo(positions[i].x, positions[i].y, positions[i+1].x, positions[i+1].y);\n        graphics.endFill();\n      }}\n    />;\n  }\n  return null;\n}\n\nexport default QuestLine;\n","import React, { useEffect, useRef, useCallback, useState } from \"react\";\nimport { Stage, Sprite } from '@inlet/react-pixi';\nimport { Viewport as PixiViewport } from \"pixi-viewport\";\nimport { useDispatch, useSelector } from 'react-redux'\nimport { QuestStoreState } from \"store/types/quest\";\nimport { lerpLocation } from 'utils/pixiJs';\nimport { QuestDefinition, QuestNodeType, QuestNode } from \"definitions/quests/types\";\nimport Viewport from '../../pixi/Viewport';\n// import MapGrid from './MapGrid';\nimport QuestMarker from './QuestMarker';\nimport { AdventurerStoreState } from 'store/types/adventurer';\nimport QuestLine from './QuestLine';\nimport { MAX_WIDTH as WIDTH } from 'components/App';\nimport { getDefinition } from 'definitions/quests';\nimport { TextManager } from 'global/TextManager';\nimport { getQuestLeader } from 'store/helpers/storeHelpers';\nimport { StoreState } from 'store/types';\nimport { useActiveQuests, useQuest } from 'hooks/store/quests';\nimport { setCombat } from 'store/actions/quests';\nimport { useHistory } from 'react-router-dom';\nimport { getWorldLink } from 'utils/routing';\nimport { Point } from 'pixi.js';\nimport { Allegiance } from 'store/types/scene';\nimport './styles/worldMap.scss';\n\nconst FULL_HEIGHT = 1024;\nconst SMALL_HEIGHT = 64;   // Used when QuestPanel is open\nconst WORLD_WIDTH = 1500;\nconst WORLD_HEIGHT = 1061;\nconst GRID_WIDTH = 10;    // width or height of each node location in pixels\n\nexport interface Props {\n  selectedQuestName?: string;\n  smallMap: boolean;\n  onPartyClick: (questName: string) => void;\n  retrieveWorldViewRef: () => React.RefObject<HTMLDivElement>;\n}\n\nconst WorldMap = (props: Props) => {\n  const { retrieveWorldViewRef, smallMap } = props;\n  const questSelector = useCallback(\n    (state: StoreState) => state.quests.find((q) => q.name === props.selectedQuestName),\n    [props.selectedQuestName]\n  );\n\n  const selectedQuest = useSelector<StoreState, QuestStoreState | undefined>(questSelector);\n  const adventurers = useSelector<StoreState, AdventurerStoreState[]>((store) => store.adventurers);\n  const activeQuests = useActiveQuests();\n  const history = useHistory();\n\n  const handlePartyClick = (name: string) => {\n    props.onPartyClick(name);\n  };\n\n  const handleClose = () => {\n    history.push(getWorldLink());\n  }\n\n  // useEffect(() => {\n  //   const onScroll = (e: WheelEvent) => {\n  //     // When the map is big, scrolling the mouse is just used for zoom, not for actual scrolling\n  //     if (!smallMap) {\n  //       e.preventDefault();\n  //     }\n  //   }\n  //   window.addEventListener(\"wheel\", onScroll, {passive: false} );\n  //   return () => {\n  //     window.removeEventListener(\"wheel\", onScroll);\n  //   };\n  // }, [smallMap]);\n\n\n  const [canvasWidth, setCanvasWidth] = useState(WIDTH);\n  const [canvasHeight, setCanvasHeight] = useState(FULL_HEIGHT);\n\n  useEffect(() => {\n    // This will set the dimensions of the canvas tot that of the parent (worldview)\n    const resize = () => {\n      const worldView = retrieveWorldViewRef();\n      const worldViewWidth = worldView.current?.clientWidth || WIDTH;\n      const worldViewHeight = worldView.current?.clientHeight || FULL_HEIGHT;\n\n      setCanvasWidth(worldViewWidth);\n      if (smallMap) {\n        if (worldViewWidth < 576) {\n          // Small screens\n          setCanvasHeight(SMALL_HEIGHT / 2);\n        } else {\n          setCanvasHeight(SMALL_HEIGHT);\n        }\n      }\n      else {\n        setCanvasHeight(worldViewHeight);\n      }\n    }\n    resize();\n    window.addEventListener(\"resize\", resize);\n    return () => {\n      window.removeEventListener(\"resize\", resize);\n    };\n  }, [retrieveWorldViewRef, smallMap]);\n\n  useEffect(() => {\n    if (selectedQuest) {\n      focusOnQuestingParty(selectedQuest);\n    } else {\n      const viewport = viewportRef.current;\n      const point = nodeLocationToPoint({ x: 0, y: 0 });\n      viewport?.moveCenter(point.x, point.y);\n    }\n  }, [selectedQuest, canvasHeight]);\n\n  const viewportRef = useRef<PixiViewport>(null);\n  useEffect(() => {\n    // focus on center of the map\n    if (viewportRef.current) {\n      const viewport = viewportRef.current;\n      const point = nodeLocationToPoint({ x: 0, y: 0 });\n      viewport.moveCenter(point.x / 2, point.y / 2 + 10);\n    }\n  }, [canvasWidth]);\n\n  const renderQuestlines = () => {\n    return activeQuests.map((quest) => {\n      const previousPositions = getPreviousPositions(quest);\n      return (\n        <QuestLine positions={previousPositions} key={quest.name} />\n      );\n    });\n  };\n\n  const renderMarkers = () => {\n    return activeQuests.map((quest) => {\n      const location = getQuestWorldLocation(quest);\n      const currentPosition = nodeLocationToPoint(location);\n      const leader = getQuestLeader(adventurers, quest) ?? adventurers[0];\n      const questDefinition: QuestDefinition = getDefinition(quest.name);\n      const progress: number = Math.floor(quest.progress);\n      const questNode: QuestNode = questDefinition.nodes[progress];\n\n      return (\n        <QuestMarker\n          quest={quest}\n          leader={leader}\n          position={currentPosition}\n          key={quest.name}\n          selected={quest === selectedQuest}\n          encounterActive={questNode.type === QuestNodeType.encounter}\n          onClick={(q) => handlePartyClick(q.name)}\n        />\n      );\n    });\n  };\n\n\n  // puts the given party in the center of the map\n  const focusOnQuestingParty = (quest: QuestStoreState) => {\n    const viewport = viewportRef.current;\n    if (viewport) {\n      const partyLocation = getQuestWorldLocation(quest);\n      const point = nodeLocationToPoint(partyLocation);\n      viewport.moveCenter(point.x, point.y);\n    }\n  }\n\n  const handleMapClick = () => {\n    /// todo: close map\n    // if(smallMap === true && selectedQuest) {\n    //   props.onPartyClick(selectedQuest.name);\n    // }\n  }\n\n  const options = {\n    autoDensity: true,\n    sharedLoader: true,\n    width: canvasWidth,\n    height: canvasHeight,\n  }\n\n  return (\n    <div className=\"world-map\">\n      <Stage width={canvasWidth} height={canvasHeight} options={options}>\n        <Viewport screenWidth={canvasWidth} screenHeight={canvasHeight} worldWidth={WORLD_WIDTH} worldHeight={WORLD_HEIGHT} ref={viewportRef} >\n          <Sprite\n            image={`${process.env.PUBLIC_URL}/img/world/francesca-baerald-fbaerald-angeloumap-lowres.jpg`}\n            interactive={true}\n            pointerdown={handleMapClick}\n          >\n            {renderQuestlines()}\n            {renderMarkers()}\n          </Sprite>\n          {/* <MapGrid width={WORLD_WIDTH} height={WORLD_HEIGHT} gridWidth={GRID_WIDTH} /> */}\n        </Viewport>\n      </Stage>\n      {props.selectedQuestName && (\n        <div className=\"title\">\n          <span>\n            <DebugToggleCombat questName={props.selectedQuestName} />\n            {TextManager.getQuestTitle(props.selectedQuestName)}\n            {` | `}\n            {selectedQuest?.sceneName ? TextManager.getQuestSceneTitle(selectedQuest) : \"...\"}\n          </span>\n          <span onClick={handleClose} className=\"close\">x</span>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default WorldMap;\n\nconst getQuestWorldLocation = (quest: QuestStoreState): { x: number; y: number; } => {\n  const questDefinition = getDefinition(quest.name);\n  const roundedProgress = Math.floor(quest.progress);\n  const lastNode = questDefinition.nodes[roundedProgress];\n\n  const nextNode = questDefinition.nodes[roundedProgress + 1];\n  if (!nextNode) {\n    // We've reached the last node\n    return lastNode;\n  }\n  return lerpLocation(lastNode, nextNode, quest.progress - roundedProgress);\n};\n\n// Node locations work on a centered coordinate system\nconst nodeLocationToPoint = (location: { x: number; y: number; }) => {\n  const x = location.x * GRID_WIDTH + WORLD_WIDTH / 2;\n  const y = location.y * GRID_WIDTH + WORLD_HEIGHT / 2;\n  return new Point(x, y);\n}\n\nconst getPreviousPositions = (quest: QuestStoreState) => {\n  const positions: Point[] = [];\n  const questDefinition = getDefinition(quest.name);\n\n  for (let i = 0; i < quest.progress; i++) {\n    positions.push(nodeLocationToPoint(questDefinition.nodes[i]))\n  }\n  const lastPosition = nodeLocationToPoint(getQuestWorldLocation(quest));\n  positions.push(lastPosition);\n  return positions;\n}\n\n\n// temporary\nconst DebugToggleCombat = ({ questName }: {questName: string}) => {\n  const quest = useQuest(questName);\n  const dispatch = useDispatch();\n\n  if (quest.scene?.combat && quest.scene.turn !== undefined) {\n    return (\n      <button onClick={() => dispatch(setCombat(questName, false))}>\n        combat: on ({Allegiance[quest.scene.turn]})\n      </button>\n    );\n  }\n  return (\n    <button onClick={() => dispatch(setCombat(questName, true))}>\n      combat: off\n    </button>\n  )\n}\n","import { PixiComponent } from \"@inlet/react-pixi\";\nimport * as PIXI  from 'pixi.js';\nimport { TiledLayerData, TiledTilesetData } from 'constants/tiledMapData';\nimport { findTileset } from \"utils/tilemap\";\nimport { CompositeRectTileLayer } from \"@pixi/tilemap\";\n\n\ninterface Props  {\n  horizontalTiles: number;\n  layer: TiledLayerData;\n  tilesets: TiledTilesetData[];\n  spritesheets: {[key: string]: PIXI.Spritesheet}\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst RectTileLayer = PixiComponent<Props, any>(\"RectTileLayer\", {\n  create(_props: Props) {\n    const tileLayer = new CompositeRectTileLayer();\n    return tileLayer;\n  },\n\n  applyProps(instance, oldProps: Props, props: Props) {\n    const {layer, tilesets, horizontalTiles, spritesheets} = props;\n    if (!layer.data) {\n      return;\n    }\n    for (let i = 0; i < layer.data.length; i++) {\n      const tileset = findTileset(layer.data[i], tilesets);\n      if (!tileset) continue;\n\n      const w = tileset.tilewidth;\n      const h = tileset.tileheight;\n      const x = (i % horizontalTiles) * w;\n      const y = Math.floor(i / horizontalTiles) * h;\n      const spritesheet = spritesheets[tileset.name];\n\n      if (layer.data[i] > 0) {\n        const spriteId = `${tileset.name}-${layer.data[i]}`;\n        if (!spritesheet.textures[spriteId]) {\n          console.log(spritesheet)\n          console.log(spriteId)\n          continue;\n        }\n        instance.addFrame(spritesheet.textures[spriteId], x, y);\n      }\n    }\n  }\n});\n\nexport default RectTileLayer;\n\n\n","import { PixiComponent } from \"@inlet/react-pixi\";\nimport * as PIXI from 'pixi.js';\nimport { TiledTilesetData } from 'constants/tiledMapData';\nimport { SceneObject } from 'store/types/scene';\nimport { findTileset } from \"utils/tilemap\";\nimport { CompositeRectTileLayer } from \"@pixi/tilemap\";\n\ninterface Props  {\n  objects: SceneObject[];\n  tilesets: TiledTilesetData[];\n  spritesheets: {[key: string]: PIXI.Spritesheet}\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any \nconst ObjectTileLayer = PixiComponent<Props, any>(\"ObjectTileLayer\", {\n  create(_props: Props) {\n    const tileLayer = new CompositeRectTileLayer();\n    return tileLayer;\n  },\n\n  applyProps(instance, _oldProps: Props, props: Props) {\n    const {objects, tilesets, spritesheets} = props;\n    if (!objects.length) {\n      return;\n    }\n    instance.clear();\n    if (!objects) return;\n\n    objects.forEach((object) => {\n      if (!object.gid) return; // todo!\n      const tileset = findTileset(object.gid, tilesets);\n      if (!tileset) return;\n\n      const x = object.x;\n      const y = object.y - tileset.tileheight;\n      const spritesheet = spritesheets[tileset.name];\n\n      // todo: add sprites!\n      const spriteId = `${tileset.name}-${object.gid}`;\n      instance.addFrame(spritesheet.textures[spriteId], x, y);\n    \n    });\n  }\n});\n\nexport default ObjectTileLayer;\n\n","import { PixiComponent, applyDefaultProps, AnimatedSprite } from '@inlet/react-pixi';\nimport * as PIXI from 'pixi.js';\n\nconst SpriteAnimated = PixiComponent<React.ComponentProps<typeof AnimatedSprite>, PIXI.AnimatedSprite>('SpriteAnimated', {\n  create: ({ textures, name }) => {\n    if (!textures?.[0]) {\n      console.warn(`Something went wrong with ${name}`)\n    }\n    const animatedSprite = new PIXI.AnimatedSprite(textures || [], true);\n    return animatedSprite;\n  },\n  applyProps: (instance, oldProps, newProps) => {\n    if(oldProps.textures !== newProps.textures){\n      applyDefaultProps(instance, oldProps, newProps);\n      instance.gotoAndPlay(0);\n    }\n  },\n});\n\n// export default memo(SpriteAnimated);\nexport default SpriteAnimated;\n\n","import React from \"react\";\nimport { Container, Graphics, Text } from \"@inlet/react-pixi\";\nimport { useAdventurerState } from \"hooks/store/adventurers\";\nimport { ActorObject, Allegiance } from \"store/types/scene\";\n// unused\ninterface Props {\n  actor: ActorObject;\n  tileWidth: number;\n}\n\nconst MARGIN = 4;\n\nconst useActorStatsInfo = (actor: ActorObject) => {\n    const adventurer = useAdventurerState(actor.name); // is possibly null\n    if (actor.allegiance === Allegiance.player) {\n        return adventurer.name;\n    }\n    return actor.name; // enemy name\n}\n\nconst ActorStats = (props: Props) => {\n    const { tileWidth, actor } = props;\n\n    // const mask = useRef<PIXI.Graphics>(null);\n    const name = useActorStatsInfo(actor);\n    return (\n        <Container y={-40}>\n            <Text\n                y={-10}\n                x={MARGIN}\n                anchor={[0, 1]}\n                text={`${name} (${actor.ap})`}\n                style={{\n                    fontFamily : 'Gabriela',\n                    fontSize: 18,\n                    fill : 0xffffff,\n                    align : 'center',\n                    wordWrap: true,\n                    wordWrapWidth: tileWidth,\n                    dropShadow: true,\n                    dropShadowAngle: 0.9,\n                    dropShadowBlur: 10,\n                    dropShadowDistance: 0\n                }}\n                // mask={mask.current}\n            />\n            {/* <Graphics\n                name=\"mask\"\n                ref={mask}\n                draw={mask => {\n                    mask.beginFill (0x003c1b);\n                    mask.drawRect(MARGIN, -30, tileWidth - 2 * MARGIN, 22);\n                    mask.endFill();\n                }}\n            /> */}\n            {/* healthbar */}\n            <Graphics\n                name=\"background\"\n                draw={graphics => {\n                    graphics.beginFill (0x003c1b);\n                    graphics.drawRect(0, 0, tileWidth, 6);\n                    graphics.endFill();\n                }}\n            />\n            <Graphics\n                name=\"foreground\"\n                draw={graphics => {\n                    graphics.beginFill (0x006b22);\n                    graphics.drawRect(0, 0, actor.health, 6);\n                    graphics.endFill();\n                }}\n            />\n        </Container>\n    )\n}\n\nexport default ActorStats\n","import { useEffect } from \"react\";\nimport { Orientation } from \"./SceneActor\";\n\nexport const useRandomOrientation = (enabled: boolean, orientation: Orientation, setOrientation: React.Dispatch<React.SetStateAction<Orientation>>) => {\n  useEffect(() => {\n    if (!enabled) return;\n\n    // Idle animation\n    // Randomly turn left or right\n    const randomOrientation = () => {\n      const left = Math.random() < .5;\n      if (orientation === Orientation.north && left) {\n        setOrientation(Orientation.northWest);\n      }\n      else if (orientation === Orientation.northWest && left) {\n        setOrientation(Orientation.west);\n      }\n      else if (orientation === Orientation.west && left) {\n        setOrientation(Orientation.southWest);\n      }\n      else if (orientation === Orientation.southWest && left) {\n        setOrientation(Orientation.south);\n      }\n      else if (orientation === Orientation.south && left) {\n        setOrientation(Orientation.southEast);\n      }\n      else if (orientation === Orientation.southEast && left) {\n        setOrientation(Orientation.east);\n      }\n      else if (orientation === Orientation.east && left) {\n        setOrientation(Orientation.northEast);\n      }\n      else if (orientation === Orientation.northEast && left) {\n        setOrientation(Orientation.north);\n      }\n      if (orientation === Orientation.north && !left) {\n        setOrientation(Orientation.northEast);\n      }\n      else if (orientation === Orientation.northEast && !left) {\n        setOrientation(Orientation.east);\n      }\n      else if (orientation === Orientation.east && !left) {\n        setOrientation(Orientation.southEast);\n      }\n      else if (orientation === Orientation.southEast && !left) {\n        setOrientation(Orientation.south);\n      }\n      else if (orientation === Orientation.south && !left) {\n        setOrientation(Orientation.southWest);\n      }\n      else if (orientation === Orientation.southWest && !left) {\n        setOrientation(Orientation.west);\n      }\n      else if (orientation === Orientation.west && !left) {\n        setOrientation(Orientation.northWest);\n      }\n      else if (orientation === Orientation.northWest && !left) {\n        setOrientation(Orientation.north);\n      }\n    }\n    const minDuration = 2000;\n    const maxDuration = 4000;\n    const duration = minDuration + Math.random() * maxDuration;\n    const interval = setInterval(randomOrientation, duration);\n    return () => clearInterval(interval);\n  }, [enabled]);\n}\n","import { Container, Graphics } from '@inlet/react-pixi';\nimport React, { useRef, memo } from 'react';\nimport { ActorObject } from 'store/types/scene';\nimport SceneActor, { Props as SceneActorProps } from './SceneActor';\nimport { Container as PixiContainer } from 'pixi.js';\n\ninterface Props  {\n  actor: ActorObject;\n  selected: boolean;\n  spritesheetPath: string;\n}\n\n// The adventurers avatar on the scene\nconst SceneAdventurer = (props: Props & Omit<SceneActorProps, 'children'|'name'>) => {\n  const {\n    controller,\n    location,\n    actor,\n    selected,\n    spritesheetPath,\n  } = props;\n  const {tileWidth, tileHeight} = controller.getTileDimensions();\n\n  const ref = useRef<PixiContainer>(null);\n\n  return (\n    <Container ref={ref}>\n      <SceneActor\n        actor={actor}\n        controller={controller}\n        spritesheetPath={spritesheetPath}\n        location={location}\n        idleAnimation={Math.random() < 0.5}\n      >\n        {selected && (\n          <Graphics\n            name=\"selectioncircle\"\n            draw={graphics => {\n              const line = 3;\n              graphics.lineStyle(line, 0xFFFFFF);\n              graphics.drawCircle(tileWidth / 2, tileHeight / 2, tileWidth / 2 - line);\n              graphics.endFill();\n            }}\n          />\n        )}\n      </SceneActor>\n    </Container>\n  )\n}\n\nexport default memo(SceneAdventurer);\n","import React from \"react\";\nimport { Container } from \"@inlet/react-pixi\";\nimport { Allegiance, isActorObject, SceneObject } from \"store/types/scene\";\nimport SceneAdventurer from \"./SceneAdventurer\";\nimport { BaseSceneController } from \"mechanics/scenes/BaseSceneController\";\nimport { TiledObjectType } from \"utils/tilemap\";\nimport SceneActor from \"./SceneActor\";\n\ninterface Props {\n  objects: SceneObject[];\n  controller: BaseSceneController<unknown>;\n  selectedActorId: string;\n}\n\nconst ObjectSpriteLayer = (props: Props) => {\n  const { objects, controller } = props;\n\n  return (\n    <Container>\n      {objects.map((object) => {\n        const { location, name } = object;\n        const { adventurerId, spritesheet } = object.properties as { [key: string]: string};\n        switch (object.type) {\n          case TiledObjectType.actor: {\n            if (isActorObject(object)) {\n              if (object.allegiance === Allegiance.player) {\n                return (\n                  <SceneAdventurer\n                    location={location}\n                    controller={controller}\n                    actor={object}\n                    key={adventurerId}\n                    spritesheetPath={spritesheet}\n                    selected={props.selectedActorId === name }\n                  />\n                )\n              }\n              else if (object.allegiance === Allegiance.enemy) {\n                return (\n                  <SceneActor\n                    actor={object}\n                    controller={controller}\n                    spritesheetPath={spritesheet}\n                    location={location}\n                    key={object.name}\n                    idleAnimation={Math.random() < 0.5}\n                    lookAt={[4, 3]}\n                  />\n                );\n              }\n            }\n            break;\n          }\n          default:\n            return null;\n        }\n        return null;\n      })}\n    </Container>\n  )\n}\n\nexport default ObjectSpriteLayer;\n","import React, { PropsWithChildren } from 'react';\nimport { TiledMapData, TiledLayerData, TiledLayerType } from 'constants/tiledMapData';\nimport { Container } from '@inlet/react-pixi';\nimport RectTileLayer from 'components/pixi/tile/RectTileLayer';\nimport * as PIXI from 'pixi.js';\nimport ObjectTileLayer from 'components/pixi/tile/ObjectTileLayer';\nimport { SceneObject } from 'store/types/scene';\nimport ObjectSpriteLayer from './ObjectSpriteLayer';\nimport { BaseSceneController } from 'mechanics/scenes/BaseSceneController';\nimport { Props as SceneProps } from \"./Scene\";\n\ninterface Props extends SceneProps {\n  basePath: string;\n  data: TiledMapData;\n  spritesheets: {[key: string]: PIXI.Spritesheet}\n  objects: SceneObject[];\n  controller: BaseSceneController<unknown>;\n}\n\nconst Tilemap = (props: PropsWithChildren<Props>) => {\n  const { data, objects, controller, spritesheets, selectedActorId } = props;\n\n  return (\n    <Container >\n      {data.layers\n        .filter(l => l.visible)\n        .map(layer => {\n          if (layer.type === TiledLayerType.objectgroup) {\n            const { tileObjects, spriteObjects} = getLayerObjects(objects, layer);\n            return (\n              <React.Fragment key={layer.name}>\n                { !!tileObjects.length && (\n                  <ObjectTileLayer\n                    objects={tileObjects}\n                    tilesets={data.tilesets || []}\n                    spritesheets={spritesheets}\n                  />\n                )}\n                { !!spriteObjects.length && (\n                  <ObjectSpriteLayer\n                    key={layer.name}\n                    objects={spriteObjects || []}\n                    controller={controller}\n                    selectedActorId={selectedActorId}\n                  />\n                )}\n              </React.Fragment>\n            )\n          }\n          if (layer.type === TiledLayerType.tilelayer) {\n            return (\n              <RectTileLayer\n                key={layer.name}\n                layer={layer}\n                horizontalTiles={data.width}\n                tilesets={data.tilesets}\n                spritesheets={spritesheets}\n              />\n            )\n          }\n          return null;\n        })\n      }\n    </Container>\n  );\n}\n\nexport default Tilemap;\n\nconst getLayerObjects = (objects: SceneObject[], layer: TiledLayerData) => {\n  return objects.reduce<{tileObjects: SceneObject[], spriteObjects: SceneObject[]}>((acc, value) => {\n    if (value.layerId === layer.id) {\n      if (value.gid !== undefined) {\n        acc.tileObjects.push(value);\n      } else if (value.properties.isSprite === true) {\n        acc.spriteObjects.push(value);\n      }\n    }\n    return acc;\n  }, { tileObjects: [], spriteObjects: [] });\n}\n","import { useState, useEffect } from \"react\";\nimport { loadResource } from \"utils/pixiJs\";\nimport { TiledTilesetData } from 'constants/tiledMapData';\nimport { SpritesheetData, SpriteData } from 'constants/spritesheetData';\nimport { Spritesheet } from \"pixi.js\";\n\nconst useTilesetsLoader = (basePath: string) => {\n  const [tileSpritesheets, setTilesets] = useState<{[key: string]: Spritesheet}>({});\n  const [data, setData] = useState<TiledTilesetData[]>();\n\n  const loadTilesets = (value: TiledTilesetData[]) => {\n    setData(value);\n  };\n\n  useEffect(() => {\n    if (!data) return;\n    const nextTileset = nextTilesetToload(data, tileSpritesheets);\n    if (!nextTileset) return;\n\n    const tilesetName = nextTileset.name;\n    const image = nextTileset.image.substring(nextTileset.image.indexOf(\"/\"))\n    loadResource(`${basePath}/${image}`, (resource) => {\n      if (!resource) return;\n      if (resource.error) {\n        throw new Error(`Loading ${basePath}/${image}\\n${resource.error}`);\n      }\n      const spritesheetData = parseSpritesheetData(nextTileset);\n      if (!resource.texture) throw new Error(`No texure found ${basePath}/${image}`)\n      const spritesheet = new Spritesheet(resource.texture, spritesheetData);\n\n      spritesheet.parse(() => {\n        const newTilesets = {\n          ...tileSpritesheets,\n          [tilesetName]: spritesheet\n        }\n        setTilesets(newTilesets);\n      })\n    });\n  }, [data, basePath, tileSpritesheets]);\n\n  const loadComplete = !!data && nextTilesetToload(data, tileSpritesheets) === undefined;\n\n  return {\n    loadComplete,\n    loadTilesets,\n    tileSpritesheets\n  }\n}\n\nexport default useTilesetsLoader;\n\n// Returns a TiledTilesetData that has not been loaded into tilesetsTextures yet\nconst nextTilesetToload = (tilesets: TiledTilesetData[], tilesetsTextures: {[key: string]: Spritesheet}) => {\n  return tilesets.find((t) => {\n    return !tilesetsTextures[t.name];\n  })\n}\n\n\nconst parseSpritesheetData = (tileset: TiledTilesetData): SpritesheetData => {\n  const columns = tileset.columns;\n\n  const frames: { [name: string]: SpriteData } = {};\n  for (let i = 0; i < tileset.tilecount; i++) {\n    const w = tileset.tilewidth;\n    const h = tileset.tileheight;\n    const x = (i % columns) * w;\n    const y = Math.floor(i / columns) * h;\n\n    frames[`${tileset.name}-${i + tileset.firstgid}`] = {\n      frame: {x, y, w, h},\n      spriteSourceSize: {x, y, w, h},\n      rotated: false,\n      trimmed: false,\n      sourceSize: { w, h}\n    };\n  }\n  const image = tileset.image;\n  const size = { w: tileset.imagewidth, h: tileset.imageheight };\n  return {\n    frames,\n    meta: {\n      image,\n      size,\n      scale: \"1\"\n    }\n  };\n}\n","import { SceneControllerContext } from 'components/world/QuestPanel/context/SceneControllerContext';\nimport React, { useContext, useMemo, useState } from 'react';\nimport { SceneActionType } from 'store/types/scene';\nimport { locationEquals } from 'utils/tilemap';\nimport { ActionIntent } from '../SceneUI';\nimport Segment from './Segment';\nimport \"./styles/combatUIWidget.scss\";\n\ninterface Props {\n  location: [number, number];\n  selectedActorId: string;\n  actionIntent?: ActionIntent;\n  onActionChange: (action?: SceneActionType) => void;\n}\n\n// CombatUIWidget shows a circle\nconst CombatUIWidget = (props: Props) => {\n  const {location, actionIntent, onActionChange,selectedActorId} = props;\n  const controller = useContext(SceneControllerContext);\n  if (!controller) throw Error(\"No scene controller\");\n  const {tileWidth, tileHeight} = controller.getTileDimensions();\n  const transform = `translate(${tileWidth * location[0]}px, ${tileHeight * location[1]}px)`;\n  // const [collapsed, setCollapsed] = useState(true);\n\n  // const actorLocation = useMemo(() => {\n  //   return controller.getSceneActor(selectedActorId)?.location;\n  // }, []);\n\n  // const handleMouseMove = (e: React.MouseEvent) => {\n  //   e.preventDefault();\n  //   e.stopPropagation();\n  // }\n\n  // const handleMouseOver = () => {\n  //   if (!locationEquals(location, actorLocation ?? [0, 0])){\n  //     // cant expand the widget when on the current location of the actor\n  //     setCollapsed(false);\n  //   }\n  // }\n\n  // const handleMouseOut = () => {\n  //   setCollapsed(true); // todo enable\n  // }\n\n  // const handleSegmentActivate = (action: SceneActionType) => {\n  //   onActionChange(action);\n\n  //   // const ap = controller.calculateWalkApCosts(location, location);\n  // }\n\n  // const handleSegmentDeactivate = (_action: SceneActionType) => {\n  //   onActionChange(undefined);\n  //   // setText(\"\") // todo enable\n  // }\n\n  return (\n    <div\n      className='combat-ui-widget'\n      style={{ transform }}\n    >\n      {/* <div className=\"info\" style={{ width: tileWidth }}>\n        {getText(actionIntent)}\n      </div> */}\n    </div>\n  )\n}\n\nexport default CombatUIWidget;\n\nconst getText = (actionIntent?: ActionIntent) => {\n  if (!actionIntent) return null;\n  if (actionIntent.action === SceneActionType.move) {\n    if (!actionIntent.path?.length) {\n      // no path possible\n      return null;\n    }\n    const insufficient = (actionIntent.actorAP || 0) < (actionIntent.apCost || 0);\n    return (\n      <>\n      <span>\n        Move\n      </span>\n      <span className={`${(insufficient) ? \"insufficient\": \"\"}`}>\n        {` ${actionIntent.apCost}`}AP\n      </span>\n      </>\n    );\n  }\n  if (actionIntent.action === SceneActionType.slash) {\n    if (!actionIntent.path?.length) {\n      // no path possible\n      return null;\n    }\n    const insufficient = (actionIntent.actorAP || 0) < (actionIntent.apCost || 0);\n    return (\n      <>\n      <span>\n        Slash\n      </span>\n      <span className={`${(insufficient) ? \"insufficient\": \"\"}`}>\n        {` ${actionIntent.apCost}`}AP\n      </span>\n      </>\n    );\n  }\n  if (actionIntent.action === SceneActionType.shoot) {\n    // todo: check range!\n    const insufficient = (actionIntent.actorAP || 0) < (actionIntent.apCost || 0);\n    return (\n      <>\n      <span>\n        Ranged atk\n      </span>\n      <span className={`${(insufficient) ? \"insufficient\": \"\"}`}>\n        {` ${actionIntent.apCost}`}AP\n      </span>\n      </>\n    );\n  }\n  return \"?\";\n}\n\n","import React from 'react';\nimport { SceneControllerContext } from 'components/world/QuestPanel/context/SceneControllerContext';\nimport { useContext } from 'react';\nimport { SceneActionType } from 'store/types/scene';\nimport \"./styles/normalUICursor.scss\";\n\ninterface Props {\n  location: [number, number];\n}\n\nconst NormalUICursor = (props: Props) => {\n  const {location} = props;\n  const controller = useContext(SceneControllerContext);\n\n  let blocked = controller?.locationIsBlocked(location) ?? false;\n  let action = SceneActionType.move;\n  if (blocked) {\n    // todo: can we have interactive tiles that are NOT blocking?\n    const object = controller?.getObjectAtLocation(location);\n    if (object?.properties.interactive){\n      // We're at an interactive object\n      action = SceneActionType.interact;\n      blocked = false;\n    }\n  }\n  const {tileWidth, tileHeight} = controller?.getTileDimensions() ?? { tileWidth: 64, tileHeight: 64 };\n  const transform = `translate(${tileWidth * location[0]}px, ${tileHeight * location[1]}px)`;\n  const backgroundImage = images[action];\n  const width = tileWidth;\n  const height = tileHeight;\n  return (\n    <div\n      className={`normal-ui-cursor ${blocked ? \"invalid\" : \"\"}`}\n      style={{ transform, backgroundImage, width, height }}\n    />\n  )\n}\n\nexport default NormalUICursor;\n\nconst images = {\n  [SceneActionType.move]: `url(${process.env.PUBLIC_URL}/img/ui/icons/icons/walking-boot.svg)`,\n  [SceneActionType.interact]: `url(${process.env.PUBLIC_URL}/img/ui/icons/icons/sunken-eye.svg)`\n}\n","import { useEffect, useRef } from 'react';\nimport { BubbleLayer, BubbleManager, BubbleType, EVENT_BUBBLE_ADDED } from 'global/BubbleManager';\nimport { Point } from 'pixi.js';\nimport './styles/bubbles.scss';\n\ntype Props = {\n  layer: BubbleLayer\n}\n// Bubbles can be added by calling BubbleManager.addBubble\n// BubbleManager will inform whenever the something is added\n// The bubbles themselves will fade out via css transition\nconst Bubbles = (props: Props) => {\n  const ref = useRef<HTMLDivElement>(null);\n  const timeouts = useRef<NodeJS.Timeout[]>([])\n\n  const bubbleAdded = (text: string, point: Point, type?: BubbleType, layer?: BubbleLayer) => {\n    if (layer === props.layer){\n      const bubble = document.createElement('div');\n      bubble.innerHTML = `${text}`;\n      bubble.className = `bubble${type !== undefined && ` type-${BubbleType[type]}`}`;\n      bubble.style.left = `${point.x}px`;\n      bubble.style.top = `${point.y}px`;\n      ref.current?.appendChild(bubble);\n\n      const timeout = setTimeout(() => {\n        timeouts.current = timeouts.current.filter((t: NodeJS.Timeout) => t !== timeout)\n        ref.current?.removeChild(bubble)\n      }, 2000);\n      // Keep track of running timeouts in case this component gets unmounted\n      timeouts.current.push(timeout)\n    }\n  }\n\n  useEffect(() => {\n    BubbleManager.instance.addListener(EVENT_BUBBLE_ADDED, bubbleAdded);\n    return () => {\n      BubbleManager.instance.removeListener(EVENT_BUBBLE_ADDED, bubbleAdded);\n    }\n  }, []);\n\n  useEffect(() => {\n    return () => {\n      timeouts.current.forEach(t => clearTimeout(t));\n    }\n  }, [])\n\n  return (\n    <div className=\"bubbles\" ref={ref} />\n  )\n}\n\nexport default Bubbles;\n","import { SceneControllerContext } from 'components/world/QuestPanel/context/SceneControllerContext';\nimport { ContextType } from 'constants/context';\nimport { LongPressDetectEvents, useLongPress } from 'use-long-press';\nimport { TooltipManager } from 'global/TooltipManager';\nimport { useQuest } from 'hooks/store/quests';\nimport { AP_COST_SHOOT } from 'mechanics/combat';\nimport { Point } from 'pixi.js';\nimport React, {\n  PropsWithChildren,\n  useCallback,\n  useContext,\n  useEffect,\n  useRef,\n  useState\n} from 'react';\nimport { SceneActionType } from 'store/types/scene';\nimport { locationEquals } from 'utils/tilemap';\nimport CombatUIWidget from './CombatUIWidget';\nimport NormalUICursor from './NormalUICursor';\nimport { convertMouseOrTouchCoords, MouseOrTouchEvent } from 'utils/interaction';\nimport Bubbles from 'components/ui/bubbles/Bubbles';\nimport { BubbleLayer } from 'global/BubbleManager';\nimport \"./styles/sceneUI.scss\";\n\nexport interface Props {\n  sceneWidth: number;\n  sceneHeight: number;\n  selectedActorId: string;\n  actionIntent?: ActionIntent;\n\n  onMouseDown?: (location: [number, number]) => void;\n  onSetActionIntent: (intent?: ActionIntent) => void;\n}\n\nexport interface ActionIntent {\n  action: SceneActionType.move | SceneActionType.slash | SceneActionType.interact | SceneActionType.shoot;\n  from: [number, number];\n  to: [number, number];\n  apCost?: number;\n  actor: string;\n  actorAP?: number;\n  path?: [number, number][];  // is undefined when path is invalid\n}\n\n// This thing scales itself based on the canvas which should be a sibling of this component\nconst SceneUI = (props: PropsWithChildren<Props>) => {\n  const {\n    children,\n    selectedActorId,\n    actionIntent,\n    sceneWidth,\n    sceneHeight,\n    onMouseDown,\n    onSetActionIntent\n  } = props;\n  const ref = useRef<HTMLDivElement>(null);\n  const mouseDown = useRef(false);\n  const scale = useRef(1);\n  const controller = useContext(SceneControllerContext);\n  const quest = useQuest(controller?.questName ?? \"\");\n  const scene = quest.scene;\n  const { combat } = scene ?? {};\n  const [cursorLocation, setCursorLocation] = useState<[number, number]>();\n\n  useEffect(() => {\n    // Scale the html element together with the sibling canvas\n    const handleResize = () => {\n      if (!ref.current) return;\n      const canvas = ref.current.parentNode?.querySelector(\"canvas\");\n      if (!canvas) throw Error(\"No canvas found as sibling of SceneUI\");\n\n      const currentWidth = canvas?.clientWidth;\n      scale.current = currentWidth/sceneWidth;\n      ref.current.style.transform = `scale(${scale.current})`;\n      ref.current.style.width = `${sceneWidth}px`;\n      ref.current.style.height = `${sceneHeight}px`;\n    }\n    window.addEventListener(\"resize\", handleResize);\n    handleResize();\n    return () => {\n      window.removeEventListener(\"resize\", handleResize);\n    };\n  }, [sceneHeight, sceneWidth]);\n\n  const handleMouseMove = (e: MouseOrTouchEvent<HTMLDivElement>) => {\n    if (mouseDown.current) {\n      const location = findLocation(e) ?? [0, 0];\n      if (controller?.locationIsOutOfBounds(location)) {\n        setCursorLocation(undefined);\n        onSetActionIntent(undefined);\n        return;\n      }\n      if (!cursorLocation || !locationEquals(location, cursorLocation)){\n        setCursorLocation(location);\n      }\n    }\n  }\n\n  const handleMouseDown = (e: MouseOrTouchEvent ) => {\n    const location = findLocation(e);\n    if (location) onMouseDown?.(location);\n\n    mouseDown.current = true;\n    e.preventDefault();\n  }\n\n  const bind = useLongPress((e) => {\n    if (e){\n      handleClick(e as React.MouseEvent<HTMLDivElement>);\n      e.preventDefault();\n      e.stopPropagation();\n    }\n  }, {\n    onStart: (e) => { handleMouseDown(e as MouseOrTouchEvent<HTMLDivElement>);},\n    onMove: (e) => { handleMouseMove(e as MouseOrTouchEvent<HTMLDivElement>)},\n    captureEvent: true,\n    cancelOnMovement: 8,\n    detect: LongPressDetectEvents.BOTH\n  });\n\n\n  const handleClick = (e: React.MouseEvent<HTMLDivElement>) => {\n    const location = findLocation(e);\n    if (!controller || !location || !(e.target instanceof Element)) return;\n    const object = controller.getObjectAtLocation(location);\n    if (!object || object.type !== \"actor\") return;\n\n    // Show context tooltip\n    const { tileWidth, tileHeight } = controller.getTileDimensions();\n    const width = tileWidth * scale.current;\n    const height = tileHeight * scale.current;\n    const rect = (e.target).getBoundingClientRect();\n    const x = (location[0] * width) + (rect.left ?? 0);\n    const y = (location[1] * height) + (rect.top ?? 0);\n    const domRect = DOMRect.fromRect({ x, y, width, height });\n\n    TooltipManager.showContextTooltip(ContextType.actor, object, domRect, \"\");\n    e.stopPropagation()\n  }\n\n  const handleMouseUp = (e: MouseOrTouchEvent<HTMLDivElement>) => {\n    bind.onMouseUp(e as unknown as React.MouseEvent<Element, MouseEvent>);\n    mouseDown.current = false;\n\n    setCursorLocation(undefined); // uncomment to debug\n    if (!actionIntent) {\n      return\n    }\n    const selectedActorLocation = controller?.getSceneActor(selectedActorId)?.location;\n    if (selectedActorLocation && cursorLocation && !locationEquals(selectedActorLocation, cursorLocation)){\n      controller?.actorAttemptAction(selectedActorId, actionIntent.action, actionIntent.to);\n    }\n    onSetActionIntent?.(undefined);\n    e.stopPropagation();\n  }\n\n  const handleCombatActionChange = useCallback((action?: SceneActionType) => { // todo: beter name, not just combat\n    if (!action) {\n      onSetActionIntent(undefined);\n      return;\n    }\n    const {\n      location: from = [0, 0],\n      ap: actorAP,\n    } = controller?.getSceneActor(selectedActorId) ?? {};\n    const to = cursorLocation ?? [0, 0];\n    switch (action){\n      case SceneActionType.move:\n        case SceneActionType.slash: {\n        const path = controller?.findPath(from, to);\n        const apCost = combat ? controller?.calculateWalkApCosts(from, to) : undefined;\n\n        onSetActionIntent({\n          action,\n          from,\n          to,\n          apCost,\n          actor: selectedActorId,\n          actorAP,\n          path,\n        })\n      }\n      break;\n      case SceneActionType.interact: {\n        const path = controller?.findPathNearest(from, to, true);\n        const apCost = 0; // can only inspect out of combat?\n\n        onSetActionIntent({\n          action,\n          from,\n          to,\n          apCost,\n          actor: selectedActorId,\n          actorAP,\n          path,\n        })\n      }\n      break;\n      case SceneActionType.shoot: {\n        const apCost = AP_COST_SHOOT;\n\n        onSetActionIntent({\n          action,\n          from,\n          to,\n          apCost,\n          actor: selectedActorId,\n          actorAP,\n        })\n      }\n    }\n  }, [combat, controller, cursorLocation, onSetActionIntent, selectedActorId]);\n\n  useEffect(() => {\n    if (!combat && cursorLocation !== undefined) {\n      // Handle change of cursor when not in combat\n      let action = SceneActionType.move;\n      const object = controller?.getObjectAtLocation(cursorLocation);\n      if(object?.properties.interactive){\n        // We're at an interactive object\n        action = SceneActionType.interact;\n      }\n      handleCombatActionChange(action);\n    }\n  }, [cursorLocation, handleCombatActionChange, combat, controller]);\n\n  const findLocation = (e: MouseOrTouchEvent) => {\n    if (e.target instanceof Element) {\n      const {\n        x,\n        y\n      } = convertMouseOrTouchCoords(e);\n      const rect = (e.target).getBoundingClientRect();\n      const convertedX = (x - rect.left) / scale.current;\n      const convertedY = (y - rect.top) / scale.current;\n\n      return controller?.pointToSceneLocation(new Point(convertedX, convertedY));\n    }\n    throw new Error(\"You didnt give me the correct event\")\n  }\n\n  return (\n    <div\n      ref={ref}\n      className=\"scene-ui\"\n      {...bind}\n      onMouseUp={handleMouseUp}\n      onTouchEnd={handleMouseUp}\n    >\n      {children}\n      {!scene?.combat && cursorLocation && (\n        <NormalUICursor location={cursorLocation} />\n      )}\n      {scene?.combat && cursorLocation && (\n        <CombatUIWidget\n          location={cursorLocation}\n          selectedActorId={selectedActorId}\n          actionIntent={actionIntent}\n          onActionChange={handleCombatActionChange}\n        />\n      )}\n      <Bubbles layer={BubbleLayer.scene} />\n    </div>\n  )\n}\n\nexport default SceneUI;\n","import { hasOwnProperty } from \"./typescript\";\n\nexport type MouseOrTouchEvent<T = HTMLElement> = React.MouseEvent<T> | React.TouchEvent<T>\n\n// Normalizes `clientX` and `clientY` props from either a mouse or a touch event\nexport const convertMouseOrTouchCoords = (e: MouseOrTouchEvent) => {\n  if (hasOwnProperty(e, 'clientX') && hasOwnProperty(e, 'clientY')){\n    return { x: e.clientX, y: e.clientY };\n  }\n  if (hasOwnProperty(e, 'touches')) {\n    const touch = e.touches[0];\n    if (touch) {\n      return { x: touch.clientX, y: touch.clientY };\n    }\n  }\n  return { x: NaN, y: NaN };\n}\n\n","import { PixiComponent, applyDefaultProps, Graphics } from \"@inlet/react-pixi\";\nimport { LineStyle } from 'pixi.js';\nimport { Point } from \"pixi.js\";\nimport * as PIXI from \"pixi.js\";\n\ninterface Props  {\n  points?: Point[];\n  style?:  Partial<LineStyle>;\n  dash?: number;\n  gap?: number;\n  speed?: number; // positive to move forward, negative to move backward, 0 to not move at all\n}\n\n/**\n * Draws a dashed line along a path\n */\nconst DashedLine = PixiComponent<React.ComponentProps<typeof Graphics> & Props, PIXI.Graphics>(\"DashedLine\", {\n  create: () => {\n    return new PIXI.Graphics();\n  },\n\n  applyProps: (instance: PIXI.Graphics, oldProps: Props, newProps: Props) => {\n    const {\n      points = [],\n      dash = 10,\n      gap = 5,\n      speed = 40,\n      style,\n      ...newP\n    } = newProps;\n\n    // apply rest props to PIXI.Graphics\n    applyDefaultProps(instance, oldProps, newP);\n    instance.clear();\n\n    const draw = () => {\n\n      if(instance.destroyed) {\n        // component is unmounted, cancel drawing the line\n        return;\n      }\n\n      instance.clear();\n      instance.lineStyle(style?.width ?? 10, style?.color, style?.alpha, style?.alignment, style?.native);\n      const offsetPercentage = (Date.now() % (10000/speed) + 1) / Math.abs(10000/speed);\n\n      let dashLeft = 0;\n      let gapLeft = 0;\n      if (offsetPercentage > 0) {\n        const progressOffset = (dash + gap) * offsetPercentage * (speed < -1 ? 1 : -1) ;\n        if (progressOffset < dash) {\n          dashLeft = dash - progressOffset;\n        } else {\n          gapLeft = gap - (progressOffset - dash);\n        }\n      }\n      const rotatedpoints = [];\n      for (const point of points) {\n        const p = point.clone();\n        const cosAngle = Math.cos(instance.rotation);\n        const sinAngle = Math.sin(instance.rotation);\n        const dx = p.x;\n        const dy = p.y;\n        p.x = (dx * cosAngle - dy * sinAngle);\n        p.y = (dx * sinAngle + dy * cosAngle);\n        rotatedpoints.push(p);\n      }\n\n      for (let i = 0; i < rotatedpoints.length - 1; i++) {\n        const p1 = rotatedpoints[i];\n        const p2 = rotatedpoints[i + 1];\n        const dx = p2.x - p1.x;\n        const dy = p2.y - p1.y;\n        const len = Math.sqrt(dx * dx + dy * dy);\n        const normal = {\n          x: dx / len,\n          y: dy / len\n        };\n        let progressOnLine = 0;\n\n        instance.moveTo(p1.x + gapLeft * normal.x, p1.y + gapLeft * normal.y);\n        while (progressOnLine <= len) {\n          progressOnLine += gapLeft;\n          if (dashLeft > 0) {\n            progressOnLine += dashLeft;\n          } else {\n            progressOnLine += dash;\n          }\n          if (progressOnLine > len) {\n            dashLeft = progressOnLine - len;\n            progressOnLine = len;\n          } else {\n            dashLeft = 0;\n          }\n          instance.lineTo(p1.x + progressOnLine * normal.x, p1.y + progressOnLine * normal.y);\n          progressOnLine += gap;\n          if (progressOnLine > len && dashLeft === 0) {\n            gapLeft = progressOnLine - len;\n          } else {\n            gapLeft = 0;\n            instance.moveTo(p1.x + progressOnLine * normal.x, p1.y + progressOnLine * normal.y);\n          }\n        }\n      }\n      if (speed !== 0) {\n        requestAnimationFrame(draw);\n      }\n    }\n    draw();\n  },\n});\n\nexport default DashedLine;\n","import React from 'react';\nimport DashedLine from 'components/pixi/DashedLine';\nimport { Point } from 'pixi.js';\nimport { SceneActionType } from 'store/types/scene';\nimport { ActionIntent } from './ui/SceneUI'\nimport { Graphics } from '@inlet/react-pixi';\n\nexport interface Props {\n  actionIntent: ActionIntent;\n  tileWidth: number;\n  tileHeight: number;\n}\n\nconst ActionPreview = (props: Props) => {\n  const {actionIntent, tileWidth, tileHeight} = props;\n  const convert = (p: number[]) => new Point(p[0] * (tileWidth) + (tileWidth / 2), p[1] * (tileHeight) + (tileHeight / 2));\n\n  switch (actionIntent.action){\n    case SceneActionType.move:\n    case SceneActionType.interact:\n    case SceneActionType.slash: {\n      if (!actionIntent.path){\n        return null;\n      }\n      const converted = [\n        convert(actionIntent.from),\n        ...actionIntent.path.map(p => convert(p))\n      ];\n      const valid = (!actionIntent.apCost) || actionIntent.apCost <= (actionIntent.actorAP || 0);\n\n      return (\n        <DashedLine\n          points={converted}\n          dash={10}\n          gap={15}\n          speed={20}\n          rotation={0}\n          style={{\n            width: 6,\n            color: valid ? 0xffffff : 0x8b0000,\n            alpha: 1,\n          }}\n        />\n      )\n    }\n    case SceneActionType.shoot: {\n      // draw arrow: https://math.stackexchange.com/questions/1314006/drawing-an-arrow\n      const valid = (!actionIntent.apCost) || actionIntent.apCost <= (actionIntent.actorAP || 0);\n      const from = convert(actionIntent.from);\n      const to = convert(actionIntent.to);\n      return (\n        <Graphics\n          name=\"line\"\n          draw={graphics => {\n            graphics.lineStyle(4, valid ? 0xcb8c06 : 0x8b0000, 1)\n            graphics.moveTo(from.x, from.y)\n            graphics.lineTo(to.x, to.y);\n            graphics.endFill();\n          }}\n        />\n      )\n    }\n    default:\n      return null;\n  }\n}\n\nexport default ActionPreview;\n","import { useMemo } from 'react';\nimport { StoreState } from 'store/types';\nimport { useSelector } from 'react-redux';\nimport { LogChannel, LogEntry } from 'store/types/logEntry';\nimport { createSelector } from 'reselect';\n\nconst getLog = (state: StoreState) => state.log;\n\n// Returns the game log from redux store\nexport const useLog = () => {\n  const log = useSelector<StoreState, LogEntry[]>(store => store.log);\n  return log;\n}\n\nexport const useQuestLog = (questId: string) => {\n  const selectMemoized = useMemo(() => {\n    const selectQuestLogEntries = createSelector(\n      [getLog],\n      (log: LogEntry[]) => { return log.filter((l) => l.channel === LogChannel.quest && l.channelContext === questId) }\n    )\n    return selectQuestLogEntries;\n  }, [questId]);\n\n  return useSelector<StoreState, LogEntry[]>(selectMemoized);\n}\n\n","import { useEffect } from 'react';\nimport { useQuestLog } from 'hooks/store/useLog';\n\ninterface Props {\n  questId: string;\n}\n\nconst SceneLog = (props: Props) => {\n  const log = useQuestLog(props.questId);\n  useEffect(() => {\n    const lastLog = log.shift();\n    if ((lastLog?.time || 0) > Date.now() - 1000) {\n      // console.log(lastLog?.key)\n    }\n  }, [log]);\n  return null;\n}\n\nexport default SceneLog;","import { enqueueSceneAction, startTurn } from \"store/actions/quests\";\nimport { AnyAction } from \"redux\";\nimport { ActorObject, Allegiance, SceneAction, SceneActionType } from \"store/types/scene\";\nimport { locationEquals } from \"utils/tilemap\";\nimport { BaseSceneController, movementDuration } from \"./BaseSceneController\";\n\n\nexport class CombatController {\n  static sceneController?: BaseSceneController<unknown>;\n  protected static unsubscriber: () => void;\n\n  static initialize(sceneController: BaseSceneController<unknown>) {\n    this.sceneController = sceneController;\n\n    const storeChange = this.handleStoreChange.bind(this)\n    this.unsubscriber = sceneController.store.subscribe(storeChange);\n    // const selectQuest = createSelector(\n    //   [getQuests],\n    //   (quests: QuestStoreState[]) => { return quests.find(q => q.name === sceneController.questName) }\n    // )\n  }\n\n  static destroy() {\n    this.unsubscriber?.()\n  }\n\n  static handleStoreChange() {\n    if (!this.sceneController) return\n    // const questState = this.getQuestStoreState()\n    const adventurers = this.sceneController.sceneAdventurers;\n    const enemies = this.sceneController.sceneEnemies;\n    const quest = this.sceneController.quest;\n    if (adventurers && enemies && quest && quest.scene && !quest.scene.actionQueue?.length){\n      const totalAdventurerAp = adventurers.reduce((acc, value) => acc + value.ap, 0)\n      const { scene } = quest;\n      const { turn } = scene;\n\n      // No AP for the player left, switch to enemy turn\n      if (totalAdventurerAp === 0 && turn === Allegiance.player) {\n\n        this.dispatch(startTurn(quest.name, Allegiance.enemy));\n        return\n      }\n\n\n      if (turn === Allegiance.enemy && scene.actionQueue?.length === 0) {\n        const totalEnemiesAp = enemies.reduce((acc, value) => acc + value.ap, 0)\n\n        if (totalEnemiesAp === 0) {\n          // No more AP left for the enemy, player turn\n          this.dispatch(startTurn(quest.name, Allegiance.player, this.sceneController.getAdventurers()));\n          return\n        }\n\n        const enemy = this.findEnemyWithAp()\n        if (enemy && enemy.location) {\n          const target = this.findNearestActor(enemy.location, Allegiance.player);\n          if (!target || !target.location) return // no target? did everyone die?\n          const path = this.sceneController.findPath(enemy.location, target.location);\n\n          path?.forEach((l, index) => {\n            if (index >= enemy.ap - 1) return;\n            const sceneAction: SceneAction = {\n              actionType: SceneActionType.move,\n              actorId: enemy.name,\n              target: l as [number, number],\n              endsAt: movementDuration * (index + 1) + performance.now()\n            };\n            this.dispatch(enqueueSceneAction(quest.name, sceneAction));\n          });\n        }\n      }\n    }\n  }\n\n  static getQuestStoreState() {\n    return this.sceneController?.store.getState().quests.find(q => q.name === this.sceneController?.questName)\n  }\n\n  /** Finds the actor nearest to `from`, but not ON from */\n  static findNearestActor(from: [number, number], allegiance?: Allegiance) {\n    if (!this.sceneController) return undefined;\n    const actors = this.sceneController.sceneActors;\n    let distance = Number.MAX_VALUE;\n    let actor: ActorObject | undefined;\n    actors?.forEach(a => {\n      if (!a.location || !this.sceneController || locationEquals(a.location, from)) return\n      const steps = this.sceneController.findPath(from, a.location)?.length;\n      if (steps !== undefined && steps < distance) {\n        if (allegiance === undefined || a.allegiance === allegiance) {\n          distance = steps;\n          actor = a;\n        }\n      }\n    })\n    return actor\n  }\n\n  /** Find next enemy with ap */\n  static findEnemyWithAp() {\n    if (!this.sceneController) return undefined;\n    const actors = this.sceneController.sceneActors;\n    return actors?.find(a => a.allegiance === Allegiance.enemy && a.ap > 0)\n  }\n\n  static dispatch(action: AnyAction) {\n    this.sceneController?.store.dispatch(action);\n  }\n}\n","import React, { useState, useEffect } from \"react\";\nimport AdventurerTabstrip from './AdventurerTabstrip';\nimport { createSelectAdventurersOnQuest } from 'store/selectors/adventurers';\nimport { useSelector, useDispatch } from 'react-redux';\nimport QuestDetails from './QuestDetails';\nimport { useHistory } from 'react-router';\nimport { getWorldLink } from 'utils/routing';\nimport LootCache from './modals/LootCache';\nimport { useQuest } from 'hooks/store/quests';\nimport { setActiveSceneInteractionModal } from 'store/actions/quests';\nimport Situation from './modals/Situation';\nimport SceneControllerContextProvider from './context/SceneControllerContext';\nimport CombatBar from './CombatBar';\nimport AdventurerPanel from 'components/ui/adventurer/AdventurerPanel';\nimport { AdventurerSectionSelection } from \"components/ui/adventurer/AdventurerPanel\";\nimport \"./styles/questPanel.scss\";\n\nenum Layout {\n  auto,     // horizontal on large screens, vertical on small screens\n  vertical,\n  horizontal\n}\n\ninterface Props {\n  questName: string;\n  layout?: Layout;\n}\n\nconst QuestPanel = (props: Props) => {\n  const history = useHistory();\n  const dispatch = useDispatch();\n  const {layout = Layout.auto} = props;\n  const adventurers = useSelector(createSelectAdventurersOnQuest(props.questName));\n  const leader = adventurers[0];\n  const [selectedAdventurerId, setSelectedAdventurerID] = useState<string>(leader?.id);\n\n  const quest = useQuest(props.questName);\n  const activeInteractionModal = quest?.scene?.activeInteractionModal;\n\n  const handleAdventurerSelected = (adventurerId: string) => {\n    setSelectedAdventurerID(adventurerId);\n  }\n\n  const handleCloseLootCacheModal = () => {\n    dispatch(setActiveSceneInteractionModal(props.questName));\n  }\n\n  useEffect(() => {\n    if (!adventurers.length) {\n      // no adventurers, something went wrong, perhaps invalid url\n      // bounce back to world\n      history.push(getWorldLink());\n     }\n  }, [adventurers.length, history]);\n  if (!adventurers.length) return null;\n\n  return (\n    <SceneControllerContextProvider questName={props.questName}>\n      { quest?.scene?.combat && <CombatBar questName={props.questName} selectedAdventurerId={selectedAdventurerId}/>}\n      <div className={`quest-panel quest-panel-${Layout[layout]}`}>\n        <div className=\"quest-area\">\n          <QuestDetails\n            questName={props.questName}\n            selectedActorId={selectedAdventurerId}\n            setSelectedActor={handleAdventurerSelected}\n          />\n          { activeInteractionModal && activeInteractionModal.type === 'lootCache' && (\n            <div className=\"modal\" onClick={handleCloseLootCacheModal}>\n              <LootCache\n                cacheName={activeInteractionModal.lootCache}\n                adventurerId={selectedAdventurerId}\n                onClose={handleCloseLootCacheModal}\n              />\n            </div>\n          )}\n          { activeInteractionModal && activeInteractionModal.type === 'situation' && (\n            <div className=\"modal\" onClick={handleCloseLootCacheModal}>\n              <Situation\n                situation={activeInteractionModal.situation}\n                adventurerId={selectedAdventurerId}\n                onClose={handleCloseLootCacheModal}\n              />\n            </div>\n          )}\n        </div>\n        <div className=\"party-area\">\n          <AdventurerTabstrip\n            adventurers={adventurers}\n            selectedAdventurerId={selectedAdventurerId}\n            onAdventurerTabSelected={handleAdventurerSelected}\n            disabled={activeInteractionModal !== undefined}\n          />\n          <div className=\"adventurer-details\">\n            <AdventurerSectionSelection />\n            { selectedAdventurerId && (\n              <AdventurerPanel\n                adventurerId={selectedAdventurerId}\n                questName={props.questName}\n              />\n            )}\n          </div>\n        </div>\n      </div>\n    </SceneControllerContextProvider>\n  )\n}\n\nexport default QuestPanel;\n","import React, { useRef, useEffect, useContext, useState } from \"react\";\nimport { Container, Graphics } from '@inlet/react-pixi';\nimport { useQuestScene } from 'hooks/store/quests';\nimport Tilemap from './Tilemap';\nimport BridgedStage from 'components/pixi/util/BridgedStage';\nimport useTilesetsLoader from 'hooks/useTilesetsLoader';\nimport { SceneControllerContext } from '../../context/SceneControllerContext';\nimport SceneUI, { ActionIntent } from './ui/SceneUI';\nimport ActionPreview from './ActionPreview';\nimport { isAdventurer } from \"store/types/scene\";\nimport SceneLog from \"./SceneLog\";\nimport { CombatController } from \"mechanics/scenes/CombatController\";\nimport { Rectangle } from \"pixi.js\";\nimport { useSettings } from \"hooks/store/settings\";\nimport \"./styles/scene.scss\";\n\nexport interface Props {\n  selectedActorId: string;\n  setSelectedActor: (id: string) => void;\n}\n\nconst Scene = (props: Props) => {\n  const settings = useSettings();\n  const {selectedActorId, setSelectedActor } = props;\n  const controller = useContext(SceneControllerContext);\n  if (!controller) throw new Error(\"No controller found\")\n  const mapData = controller.mapData;\n  const basePath = controller.basePath;\n  if (!basePath) throw new Error(\"No basePath found\")\n\n  const {\n    loadComplete,\n    loadTilesets,\n    tileSpritesheets\n  } = useTilesetsLoader(basePath);\n\n  const ref = useRef<HTMLDivElement>(null);\n  const scene = useQuestScene(controller.questName);\n  const combat = scene?.combat === true;\n  const {tileWidth, tileHeight} = controller.getTileDimensions();\n  const [currentActionIntent, setCurrentActionIntent] = useState<ActionIntent>();\n\n  useEffect(() => {\n    if (combat) {\n      CombatController.initialize(controller)\n    }\n    return () => {\n      CombatController.destroy();\n    }\n  }, [combat]);\n\n  useEffect(() => {\n    if (!mapData) return;\n    loadTilesets(mapData.tilesets);\n  }, [loadTilesets, mapData]);\n\n  const handleUIMouseDown = (location: [number, number]) => {\n    const actor = controller.getObjectAtLocation(location);\n    if (actor && isAdventurer(actor) && actor?.name) {\n      // We can click on adventurers\n      props.setSelectedActor(actor.name);\n    }\n  }\n\n  if (!loadComplete || !mapData || !scene) {\n    return <div>loading scene...</div>\n  }\n\n  const sceneWidth = mapData.width * mapData.tilewidth;\n  const sceneHeight = mapData.height * mapData.tileheight;\n  return (\n    <div className=\"scene\" ref={ref}>\n      <BridgedStage width={sceneWidth} height={sceneHeight} >\n        <Container\n          interactive={true}\n          hitArea={new Rectangle(0, 0, sceneWidth, sceneHeight)}\n        >\n          <Tilemap\n            basePath={basePath}\n            data={mapData}\n            spritesheets={tileSpritesheets}\n            objects={scene.objects}\n            controller={controller}\n            selectedActorId={selectedActorId}\n            setSelectedActor={setSelectedActor}\n          />\n          { currentActionIntent && (<ActionPreview actionIntent={currentActionIntent} tileWidth={tileWidth} tileHeight={tileHeight}/>)}\n          {settings.debugSceneShowPathable && (\n            <Graphics\n              name=\"blocked-tiles\"\n              draw={graphics => {\n                const line = 3;\n                for (let y = 0; y < mapData.height; y++) {\n                  for (let x = 0; x < mapData.width; x++) {\n                    const blocked = controller.locationIsBlocked([x, y]);\n\n                    if (blocked) {\n                      graphics.lineStyle(line, 0xFF0000);\n                    } else {\n                      graphics.lineStyle(line, 0xFFFFFF);\n                    }\n                    graphics.drawRect(x * tileWidth, y * tileHeight, tileWidth, tileHeight);\n                    graphics.endFill();\n                  }\n                }\n              }}\n            />\n          )}\n        </Container>\n      </BridgedStage>\n      {settings.debugSceneShowActionQueue && (\n        <div style={{ position: 'absolute', bottom: 0}}>\n          <h2>ActionQueue</h2>\n          <ul>\n            {scene.actionQueue && scene.actionQueue.map((action) => (\n              <li key={JSON.stringify(action)}>{JSON.stringify(action)}</li>\n            ))}\n          </ul>\n        </div>\n      )}\n      <SceneUI\n        sceneWidth={sceneWidth}\n        sceneHeight={sceneHeight}\n        selectedActorId={selectedActorId}\n        actionIntent={currentActionIntent}\n        onMouseDown={handleUIMouseDown}\n        onSetActionIntent={setCurrentActionIntent}\n      />\n      <SceneLog questId={controller.questName} />\n    </div>\n  );\n}\n\nexport default Scene;\n","import React from 'react';\nimport { useQuest } from 'hooks/store/quests';\nimport { getDefinition } from 'definitions/quests';\nimport { QuestDefinition } from 'definitions/quests/types';\nimport { TextManager } from 'global/TextManager';\nimport './styles/onTheRoad.scss';\n\nexport interface Props {\n  questName: string;\n}\n\n/* Shows the most recent log on a questnode */\nconst OnTheRoad = (props: Props) => {\n  const quest = useQuest(props.questName);\n  const questDefinition: QuestDefinition = getDefinition(quest.name);\n  let progress: number = Math.floor(quest.progress);\n  do {\n    const log = questDefinition.nodes[progress].log;\n    if (log) {\n      return (\n        <div>\n          <p>{`${TextManager.get(log)}`}</p>\n        </div>\n      )\n    }\n    progress--;\n  } while (progress >= 0);\n  return <h1 className=\"on-the-road questname\">{TextManager.getQuestTitle(quest.name)}</h1>;\n}\n\nexport default OnTheRoad;\n","import React from 'react';\nimport Scene from 'components/world/QuestPanel/QuestDetails/scene/Scene';\nimport { useQuest } from 'hooks/store/quests';\nimport OnTheRoad from './OnTheRoad';\n\nexport interface Props {\n  questName: string;\n  selectedActorId: string;\n  setSelectedActor: (id: string) => void;\n}\n\nconst QuestDetails = (props: Props) => {\n  const quest = useQuest(props.questName);\n\n  if (!quest.sceneName) {\n    return <OnTheRoad questName={props.questName} />;\n  }\n  return (\n    <Scene {...props} />\n  );\n}\n\nexport default QuestDetails;\n","import * as React from \"react\";\nimport { DragType } from \"constants/dragging\";\nimport { ConnectDropTarget, DropTarget, DropTargetConnector, DropTargetMonitor, DropTargetSpec } from \"react-dnd\";\nimport AdventurerAvatar, { Props as AdventurerAvatarProps}  from '../AdventurerAvatar';\nimport { InventoryItemDragInfo } from \"components/ui/items/DraggableItemIcon\";\nimport \"./styles/droppableadventureravatar.scss\";\n\nconst dropTarget: DropTargetSpec<Props> = {\n  drop(props: Props, monitor: DropTargetMonitor) {\n    props.onDrop(monitor.getItem());\n  },\n  canDrop(_props: Props, _monitor: DropTargetMonitor)  {\n    return true; // todo: can't drop on yourself\n  },\n};\n\nexport interface Props extends AdventurerAvatarProps {\n  onDrop: (dragInfo: InventoryItemDragInfo) => void;\n}\n\nexport interface DropSourceProps {\n  canDrop: boolean;\n  isOver: boolean;\n  connectDropTarget: ConnectDropTarget;\n}\n\nconst collect = (connect: DropTargetConnector, monitor: DropTargetMonitor) => ({\n  canDrop: monitor.canDrop(),\n  connectDropTarget: connect.dropTarget(),\n  isOver: monitor.isOver(),\n});\n\n/**\n * The AdventurerAvatar displays the avatar of an adventurer in the party screen\n */\nconst DroppableAdventurerAvatar = (props: Props & DropSourceProps) => {\n  const { connectDropTarget } = props;\n\n  return connectDropTarget(\n    <div className=\"droppable-adventurer-avatar\">\n      <AdventurerAvatar\n        adventurer={props.adventurer}\n        onClick={props.onClick }\n      />\n    </div>,\n  );\n}\n\nexport default DropTarget<Props, DropSourceProps>(\n  DragType.ITEM,\n  dropTarget,\n  collect,\n)(DroppableAdventurerAvatar);\n","import React, { useRef, useContext } from \"react\";\nimport gsap from 'gsap';\nimport DraggableItemsList from 'components/ui/items/DraggableItemsList';\nimport { TextManager } from 'global/TextManager';\nimport { DragSourceType } from 'constants/dragging';\nimport { SceneControllerContext } from '../../context/SceneControllerContext';\nimport { useAdventurerState } from 'hooks/store/adventurers';\nimport Button from 'components/ui/buttons/Button';\nimport { adventurerFreeInventorySlots } from 'store/helpers/storeHelpers';\nimport Icon from 'components/ui/common/Icon';\nimport { InventoryItemDragInfo } from \"components/ui/items/DraggableItemIcon\";\nimport DroppableAdventurerAvatar from \"components/ui/adventurer/DroppableAdventurerAvatar\";\nimport \"../styles/modal.scss\";\nimport \"../styles/lootCache.scss\";\n\ninterface Props {\n  cacheName: string;\n  adventurerId: string;\n  onClose: () => void;\n}\n\nconst LootCache = (props: Props) => {\n  const controller = useContext(SceneControllerContext);\n\n  const adventurer = useAdventurerState(props.adventurerId);\n  const freeSlots = adventurerFreeInventorySlots(adventurer);\n  const ref = useRef<HTMLDivElement>(null);\n\n  if (!controller) {\n    return null;\n  }\n  const cache = controller.getLootCache(props.cacheName);\n  if (!cache) {\n    return null;\n  }\n\n  const handleTakeGold = (e: React.MouseEvent) => {\n    e.stopPropagation();\n    // todo: animate gold flying away\n\n    controller.takeGoldFromCache(props.cacheName);\n  }\n\n  const handleTakeAllItems = (e: React.MouseEvent) => {\n    e.stopPropagation();\n    if (ref.current) {\n      ref.current.querySelectorAll(\".items-list .item-icon\").forEach((el, index) => {\n        if (index >= freeSlots) return;\n        el.classList.add(\"taking\");\n      });\n      gsap.to(\".items-list .item-icon.taking\", {\n        right: \"-50vw\",\n        stagger: {\n          each: 0.1,\n          ease: \"power2.inOut\",\n        },\n        onComplete: () => {\n          for (let i = 0; i < freeSlots; i++) {\n            controller.takeItemFromCache(0, props.cacheName, props.adventurerId);\n          }\n        }\n      });\n    }\n  }\n\n  const handleDrop = (item: InventoryItemDragInfo) => {\n    controller.takeItemFromCache(item.inventorySlot ?? 0, props.cacheName, props.adventurerId);\n  }\n\n  return (\n    <div className={`interaction-modal loot-cache`} ref={ref}>\n      <div className=\"header\">\n        <div className=\"title\">\n          {TextManager.get(cache.title, { adventurer: adventurer.name })}\n        </div>\n        <div className=\"close\" onClick={props.onClose} />\n      </div>\n      { cache.items.length > 0 && (\n        <div className=\"content\">\n          <div className=\"items\">\n            <DraggableItemsList\n              items={cache.items}\n              sourceType={DragSourceType.lootCache}\n              sourceId={props.cacheName}\n            />\n          </div>\n          <div className=\"adventurer\">\n            <DroppableAdventurerAvatar adventurer={adventurer} onDrop={handleDrop} />\n            <Button onClick={handleTakeAllItems} disabled={freeSlots === 0} size=\"small\">\n              {TextManager.get(\"quest-common-loot-cache-take-all\")}\n            </Button>\n          </div>\n        </div>\n      )}\n      { !!cache.gold && (\n        <div className=\"content\">\n          <div className=\"gold\">\n            <Icon\n              image=\"img/resources/gold.png\"\n              size=\"medium\"\n            />\n            {TextManager.get(\"quest-common-loot-cache-gold\", { gold: cache.gold })}\n          </div>\n          <div className=\"take-gold\">\n            <Button onClick={handleTakeGold} size=\"small\">\n              {TextManager.get(\"quest-common-loot-cache-take\")}\n            </Button>\n          </div>\n        </div>\n      )}\n    </div>\n  )\n}\n\nexport default LootCache;\n","import React, { MouseEvent, useRef, useContext } from \"react\";\nimport { TextManager } from 'global/TextManager';\nimport { SceneControllerContext } from '../../context/SceneControllerContext';\nimport Button from 'components/ui/buttons/Button';\nimport \"../styles/situation.scss\";\nimport \"../styles/modal.scss\";\n\ninterface Props {\n  situation: string;\n  adventurerId: string;\n  onClose: () => void;\n}\n\nconst Situation = (props: Props) => {\n  const controller = useContext(SceneControllerContext);\n  const ref = useRef<HTMLDivElement>(null);\n  const situation = controller?.getSituation(props.situation, props.adventurerId);\n  if (!situation) return null;\n\n  const { title, choices, text } = situation;\n  const handleChoiceClick = (e: MouseEvent<HTMLButtonElement>) => {\n    const choice = e.currentTarget.getAttribute('data-option');\n    if (!choice || !controller) return\n    controller.handleSituationOptionClick(props.situation, choice, props.adventurerId);\n    e.stopPropagation();\n  }\n\n  const handleClose = (e: MouseEvent<HTMLDivElement>) => {\n    props.onClose();\n    e.stopPropagation();\n  }\n  return (\n    <div className={`interaction-modal situation`} ref={ref}>\n      <div className=\"header\">\n        <div className=\"title\">\n          {TextManager.get(title)}\n        </div>\n        <div className=\"close\" onClick={handleClose} />\n      </div>\n      <div className=\"content\">\n      { text && (<div className=\"text\">{TextManager.get(text)}</div>)}\n      { choices?.map(choice => (\n        <Button key={choice} data-option={choice} onClick={handleChoiceClick}>{TextManager.get(choice)}</Button>\n      ))}\n    </div>\n    </div>\n  )\n}\n\nexport default Situation;","import React, { useContext } from \"react\";\nimport { useSelector } from 'react-redux';\nimport { createSelectAdventurersOnQuest } from 'store/selectors/adventurers';\nimport { SceneControllerContext } from '../context/SceneControllerContext';\nimport AdventurerAvatar from 'components/ui/adventurer/AdventurerAvatar';\nimport { TextManager } from 'global/TextManager';\nimport Button from 'components/ui/buttons/Button';\nimport { IconSize } from 'components/ui/common/Icon';\nimport \"./styles/combatBar.scss\";\n\ninterface Props {\n  questName: string;\n  selectedAdventurerId?: string;\n}\n\nconst CombatBar = (props: Props) => {\n  const {selectedAdventurerId} = props;\n  const adventurers = useSelector(createSelectAdventurersOnQuest(props.questName));\n  const controller = useContext(SceneControllerContext);\n\n  return (\n    <div className=\"combat-bar\">\n      <div className=\"title\">\n        {TextManager.get(\"ui-combat-bar-title\")}\n      </div>\n      <div className=\"adventurers\">\n        {adventurers.map(a => (\n          <div key={a.id} className={`adventurer ${selectedAdventurerId === a.id ? \"selected\" : \"\"}`}>\n            <AdventurerAvatar adventurer={a} size={IconSize.smallest}/>\n            <div className=\"ap\">\n              {controller?.getSceneActor(a.id)?.ap || 0} AP\n            </div>\n          </div>\n        ))}\n      </div>\n      <Button size=\"small\" onClick={() => controller?.endTurn()}>End turn</Button>\n    </div>\n  )\n}\n\nexport default CombatBar;\n","import Tab from \"components/ui/tabs/Tab\";\nimport Tabstrip from \"components/ui/tabs/Tabstrip\";\nimport {LogChannel, LogEntry} from \"store/types/logEntry\";\nimport {TextManager} from \"global/TextManager\";\nimport {useEffect, useState} from 'react';\nimport Button from 'components/ui/buttons/Button';\nimport { useLog } from \"hooks/store/useLog\";\nimport { useActiveQuestNames } from \"hooks/store/quests\";\nimport { useLocation } from \"react-router-dom\";\nimport { getQuestLink, getTownLink } from \"utils/routing\";\nimport \"./styles/simplelog.scss\";\n\n// eslint-disable-next-line @typescript-eslint/no-empty-interface\nexport interface Props {\n}\n\nenum ChannelType {\n  all,\n  town,\n  quest,\n}\n\ninterface ChannelDefinition {\n  label: string;\n  tabType: ChannelType;\n  tabId: string;\n  channelContext?: string;\n}\n\nconst SimpleLog = () => {\n  const [expanded, setExpanded] = useState(false);\n  const [selectedTabId, setSelectedTabId] = useState<\"all\" | \"town\" | string>(\"all\");\n\n  const logEntries = useLog();\n  const activeQuestNames = useActiveQuestNames();\n  const location = useLocation<{pathname: string}>();\n\n  useEffect(() => {\n    if (location.pathname === getTownLink()){\n      setSelectedTabId(\"town\");\n      return;\n    }\n    activeQuestNames.forEach(q => {\n      if (location.pathname === getQuestLink(q)){\n        setSelectedTabId(`quest-${q}`);\n      }\n    })\n  }, [activeQuestNames, location]);\n\n  const channels: ChannelDefinition[]=[{\n    label: TextManager.get(\"ui-log-tab-all\"),\n    tabId: \"all\",\n    tabType: ChannelType.all,\n  }, {\n    label: TextManager.get(\"ui-log-tab-town\"),\n    tabId: \"town\",\n    tabType: ChannelType.town,\n  }];\n\n  const handleTabSelected = (tabId: string) => {\n    setSelectedTabId(tabId);\n  }\n\n  const handleToggleExpand=() => {\n    setExpanded(!expanded);\n  }\n\n  activeQuestNames.forEach((questName) => {\n    channels.push({\n      channelContext: questName,\n      label: TextManager.getQuestTitle(questName),\n      tabId: `quest-${questName}`,\n      tabType: ChannelType.quest,\n    });\n  });\n\n  let displayEntries: LogEntry[] = [];\n  const currentTab = channels.find((t) => t.tabId === selectedTabId);\n\n  switch (currentTab?.tabType) {\n    case ChannelType.all:\n      // All the things\n      displayEntries = logEntries;\n      break;\n\n    case ChannelType.town:\n      // Only town\n      displayEntries = logEntries.filter((lE) => lE.channel === LogChannel.town);\n      break;\n\n    case ChannelType.quest:\n      // Only the selected quest\n      displayEntries = logEntries.filter((lE) => lE.channel === LogChannel.quest && lE.channelContext === currentTab.channelContext);\n      break;\n  }\n\n  const getLogEntryRow = (logEntry: LogEntry) => {\n    const text = TextManager.get(logEntry.key, logEntry.context);\n    return (\n      <div className=\"entry\" key={logEntry.time}>\n        {text}\n      </div>\n    );\n  };\n\n  return (\n    <div className={`log${expanded ? \" expanded\" : \"\"}`}>\n      <div className=\"tab-bar\">\n        <Tabstrip className=\"tabs\" onTabSelected={handleTabSelected} activeTab={selectedTabId}>\n          {channels.map((tab) => {\n            return <Tab id={tab.tabId} key={tab.tabId}>{tab.label}</Tab>;\n          })}\n        </Tabstrip>\n        <Button\n          className=\"expand-button\"\n          onClick={handleToggleExpand}\n          square={true}\n          size=\"medium\"\n          text={expanded ? \"▼\" : \"▲\"}\n        />\n      </div>\n      <div className=\"log-entries\">\n        {displayEntries.map((entry) => getLogEntryRow(entry))}\n      </div>\n    </div>\n  );\n}\n\nexport default SimpleLog;\n","import WorldMap from \"components/world/WorldMap\";\nimport React, { useEffect, useRef } from \"react\";\nimport { Channel, MixMode, SoundManager } from \"global/SoundManager\";\nimport QuestPanel from './QuestPanel';\nimport { useRouteMatch, useHistory } from 'react-router';\nimport { getQuestLink, getWorldLink } from 'utils/routing';\nimport \"./styles/worldView.scss\";\n\n// eslint-disable-next-line @typescript-eslint/no-empty-interface\nexport interface Props {\n}\n\n/**\n * WorldView shows the map and QuestPanel\n * @param props\n */\nconst WorldView = () => {\n  const worldMapRef = useRef<HTMLDivElement>(null);\n  const match = useRouteMatch<{questname: string}>(`${getWorldLink()}/:questname`);\n  const selectedQuestName = match?.params.questname;\n  const history = useHistory();\n\n  useEffect(() => {\n    SoundManager.addSound(\"music/world\", \"sound/music/TheLoomingBattle.ogg\", () => {\n      SoundManager.playSound(\"music/world\", Channel.music, true, MixMode.fade, true);\n    })\n  }, []);\n\n  // const handleMapMove = (distance: number, angle: number) => {\n  //   const compassEl = compassRef!.current!;\n  //   const compassTextEl = compassEl.firstElementChild! as HTMLElement;\n\n  //   // Rotate the compass\n  //   compassEl.style.transform = `rotate(${angle - (Math.PI / 2)}rad)`;\n  //   compassEl.style.opacity = distance > 10 ? \"1\" : \"0\";\n  //   compassTextEl.style.transform = `rotate(${-angle + (Math.PI / 2)}rad)`;\n  //   compassTextEl.innerHTML = `${distance.toFixed(0)}`;\n  // };\n\n  // const handleCompassClick = () => {\n  //   //setScrollToPosition(new Vector2(1, 1));\n  // };\n\n  const handlePartyClick = (questName: string) => {\n    // if (questName === selectedQuestName) {\n    //   history.push(getWorldLink());\n    // } else {\n      history.push(getQuestLink(questName));\n    // }\n    SoundManager.playSound(\"ui/buttonClick\");\n  };\n\n  const handleRetrieveWorldViewRef = () => {\n    return worldMapRef;\n  }\n\n  return (\n    <div className=\"world-view\" ref={worldMapRef}>\n      {/* <div className=\"compass\" ref={compassRef} onClick={handleCompassClick}>\n        <div className=\"distance\"/>\n      </div> */}\n      <WorldMap\n        selectedQuestName={selectedQuestName}\n        // onMapMove={handleMapMove}\n        smallMap={selectedQuestName != null}\n        onPartyClick={handlePartyClick}\n        retrieveWorldViewRef={handleRetrieveWorldViewRef}\n      />\n      { selectedQuestName && (\n        <QuestPanel questName={selectedQuestName} />\n      )}\n    </div>\n  );\n};\n\nexport default WorldView;\n","import React, { PropsWithChildren, useEffect, useRef, useState } from 'react';\nimport { TooltipManager } from 'global/TooltipManager';\nimport { InfoWindow } from 'components/ui/modals/InfoWindow';\nimport './styles/tooltip.scss';\n\nconst ARROW_SIZE = 8; // warning: sync to tooltip.css var\nconst PADDING = 8;\n\nexport interface Props {\n  referenceRect: DOMRect;  // place tooltip in reference to this rect\n  placement?: Placement;\n  className?: string;\n}\n\nexport enum Placement {\n  bottom,\n  top,\n  left,\n  right,\n}\n\nexport const Tooltip = (props: PropsWithChildren<Props>) => {\n  const { children, referenceRect } = props;\n  let { className = \"\" } = props;\n  const ref = useRef<HTMLDivElement>(null);\n  const [placement, setPlacement] = useState<Placement>(props.placement || Placement.bottom);\n\n  const [containerRect, setContainerRect] = useState<DOMRect>(); // This is the\n\n  useEffect(() => {\n    // Reposition if needed\n    const tooltipElement = ref.current;\n    if (!tooltipElement) return;\n    if (!containerRect || !containerRect) return;\n    const tooltipRect = tooltipElement.getBoundingClientRect();\n\n    // Flip vertically\n    switch (placement) {\n      case Placement.top:\n        if (tooltipRect.top - tooltipRect.height - ARROW_SIZE - PADDING < containerRect.top) {\n          // Too high, place underneath\n          setPlacement(Placement.bottom);\n          return;\n        }\n        break;\n      case Placement.bottom:\n        if (tooltipRect.top + tooltipRect.height + ARROW_SIZE + PADDING > containerRect.height) {\n          // Too low, place top\n          setPlacement(Placement.top);\n          return;\n        }\n        break;\n    }\n    tooltipElement.style.opacity = \"1\"; // animated through css\n\n    const contentElement = tooltipElement.querySelector(\".tooltip-content\") as HTMLElement;\n    if (tooltipRect.left < containerRect.left + PADDING) {\n      // Check left bounding edge\n      const offset = containerRect.left - tooltipRect.left + PADDING;\n      contentElement.style.transform = `translateX(${offset}px)`;\n    } else if (tooltipRect.right > containerRect.right - PADDING) {\n      // Check right bounding edge\n      const offset = tooltipRect.right - containerRect.right + PADDING;\n      contentElement.style.transform = `translateX(${-offset}px)`;\n    } else {\n      contentElement.style.transform = '';\n    }\n\n  }, [setPlacement, containerRect, placement, referenceRect]);\n\n  const resize = () => {\n    TooltipManager.clear();\n  }\n\n  useEffect(() => {\n    setContainerRect(ref.current?.closest('.app')?.getBoundingClientRect());\n\n    window.addEventListener(\"resize\", resize);\n    return () => {\n      window.removeEventListener(\"resize\", resize);\n    };\n  }, []);\n\n\n  let x = 0;\n  let y = 0;\n\n  if (containerRect) {\n    switch (placement) {\n      case Placement.bottom:\n        x = referenceRect.left - containerRect.left + referenceRect.width / 2;\n        y = referenceRect.top - containerRect.top + referenceRect.height;\n        className += \" tooltip-bottom\";\n        break;\n      case Placement.top:\n        x = referenceRect.left - containerRect.left + referenceRect.width / 2;\n        y = referenceRect.top - containerRect.top;\n        className += \" tooltip-top\";\n        break;\n    }\n  }\n\n  return (\n    <div className={`tooltip ${className}`}\n      style={{\n        left: x,\n        opacity: 0,\n        top: y,\n      }}\n      ref={ref}\n    >\n      <div className=\"tooltip-arrow\" />\n      <InfoWindow className=\"tooltip-content\">\n        {children}\n      </InfoWindow>\n    </div>\n  );\n}\n\nexport default Tooltip;\n","import * as React from \"react\";\nimport { useDispatch } from 'react-redux';\nimport { Structure } from 'definitions/structures';\nimport { subtractGold } from 'store/actions/gold';\nimport { startBuildingStructure, finishBuildingStructure } from 'store/actions/structures';\nimport { startTask } from 'store/actions/tasks';\nimport { TaskType } from 'store/types/task';\nimport { Deed, getDefinition as getDeedDefinition} from 'definitions/items/deeds';\nimport useGoldState from 'hooks/store/useGoldState';\nimport { useStructureDefinition, useStructureState } from 'hooks/store/structures';\nimport { StructureState } from 'store/types/structure';\nimport { TextManager } from 'global/TextManager';\nimport Button from 'components/ui/buttons/Button';\nimport { Item } from \"definitions/items/types\";\n\ninterface Props {\n  item: Item<Deed>;\n}\n\nconst DeedContent = (props: Props) => {\n  const { item } = props;\n  const definition = getDeedDefinition(item.type)\n  const dispatch = useDispatch();\n\n  const gold = useGoldState();\n  const structureDefinition = useStructureDefinition(definition.structure);\n  const enoughGold = structureDefinition.cost.gold || 0 <= gold;\n  const structureStoreState = useStructureState(definition.structure);\n  const canBeBuilt = structureStoreState.state === StructureState.NotBuilt;\n  const disabled = !canBeBuilt || !enoughGold;\n  const subtext = TextManager.getItemSubtext(item.type);\n\n  const handleStartConstruction = (structure: Structure) => {\n\n    dispatch(subtractGold(structureDefinition.cost.gold || 0));\n    dispatch(startBuildingStructure(structure));\n\n    const callbacks = [ finishBuildingStructure(structure) ];\n    const time = structureDefinition.cost.time;\n    const start = startTask(TaskType.buildStructure,\n      `${structure}.build`,\n      \"town\",\n      time ?? 0,\n      callbacks);\n    dispatch(start);\n  }\n  return (\n    <div>\n      { subtext && (<p className=\"subtext\">{`\"${subtext}\"`}</p>)}\n      <Button\n        disabled={disabled}\n        size=\"small\"\n        onClick={() => handleStartConstruction(definition.structure)}\n      >\n        Start construction ({ structureDefinition.cost.gold } gold)\n      </Button>\n    </div>\n  );\n\n}\n\nexport default DeedContent;\n","import * as time from \"utils/format/time\";\n\nexport const STUDY_TIME = time.TWO_MINUTES;","import * as React from \"react\";\nimport { ItemType } from 'definitions/items/types';\nimport { getDefinition as getProductionDefinition, getProductionStructureForItem } from 'definitions/production';\nimport { useStructureState } from 'hooks/store/structures';\nimport { Structure } from 'definitions/structures';\nimport { ProducableItem, ProductionStructureStoreState, StructureState } from 'store/types/structure';\nimport { getDefinition as getItemDefinition } from 'definitions/items';\nimport { Link } from 'react-router-dom';\nimport { getStructureLink } from 'utils/routing';\nimport { TextManager } from 'global/TextManager';\nimport { useStudyingTasksStateByStructure } from 'hooks/store/useTasksState';\nimport { startTask } from 'store/actions/tasks';\nimport { TaskType } from 'store/types/task';\nimport { useDispatch } from 'react-redux';\nimport { addItemToToProduces } from 'store/actions/structures';\nimport { formatDuration } from 'utils/format/time';\nimport { STUDY_TIME } from 'mechanics/studying';\nimport Button from 'components/ui/buttons/Button';\n\ninterface Props {\n  item: ProducableItem;\n}\n\nconst ProduceOrStudy = (props: Props) => {\n  const structure = getProductionStructureForItem(props.item);\n  const itemDefinition = getItemDefinition(props.item);\n  if (itemDefinition.unique) {\n    return (\n      <p>Unique item</p>\n    )\n  }\n  if (!structure) {\n    return null;\n  }\n  return (\n    <ProducedAtStructure item={props.item} structure={structure} />\n  )\n}\n// refactor 2021-02-19 becomes 'CraftedAtStructure'\nconst ProducedAtStructure = (props: Props & { structure: Structure}) => {\n  const {structure} = props;\n  const structureStore: ProductionStructureStoreState = useStructureState(structure);\n  const studyTasks = useStudyingTasksStateByStructure(structure);\n  const dispatch = useDispatch();\n\n  if (!structure) {\n    return null;\n  }\n\n  // const structureDefinition = getStructureDefinition<ProductionStructureDefinition>(structure);\n  // Can already be produced\n  if (structureStore.produces.some((item: ItemType) => item === props.item)){\n    return (\n      <p>Constructed at:&nbsp;\n        <Link to={getStructureLink(structure)} >\n          { TextManager.getStructureName(structure) }\n        </Link>\n      </p>\n    )\n  }\n\n  // Currently studied\n  const task = studyTasks.find(sT => sT.name === props.item);\n  if (task) {\n    return (\n      <p>\n        <Link to={getStructureLink(structure)} >\n          {TextManager.get(\"ui-tooltip-study-currently-studying\")}\n        </Link>\n        {formatDuration(task.timeRemaining, true)}\n      </p>\n    )\n  }\n\n  // Cant study because the structure is not high lvl enough\n  const productionDefinition = getProductionDefinition(props.item);\n  if (structureStore.level < (productionDefinition.levelRequired || 0) || structureStore.state !== StructureState.Built) {\n\n    return (\n      <p className=\"invalid\">\n        {TextManager.get(\"ui-tooltip-study-requires-structure-level\", { structure, level: (productionDefinition.levelRequired || 0) + 1})}\n      </p>\n    )\n  }\n\n  const startStudy = () => {\n    const callbacks = [\n      addItemToToProduces(props.structure, props.item)\n    ];\n\n    const studyTime = STUDY_TIME;\n    const start = startTask(TaskType.studyItem,\n      props.item,\n      `${structure}.study`,\n      studyTime,\n      callbacks);\n    dispatch(start);\n  }\n\n  return (\n    <p>\n      <Button onClick={startStudy} size=\"small\">\n        {TextManager.get(\"ui-tooltip-study-start-study\")}\n      </Button>\n      Start studying this item at {' '}\n      <Link to={getStructureLink(structure)} >\n        { TextManager.getStructureName(structure) }\n      </Link>\n    </p>\n  );\n}\n\nexport default ProduceOrStudy;\n","import { Fragment } from \"react\";\nimport { DamageDefinition } from \"definitions/items/weapons\";\nimport { TextManager } from \"global/TextManager\";\n\ninterface Props {\n  damage: DamageDefinition;\n}\n\nconst DamageList = (props: Props) => {\n  const { damage } = props;\n  return (\n    <dl>\n      {Object.entries(damage).map(([dmgType, damage]) => (\n        <Fragment key={dmgType}>\n          <dd>{TextManager.get(`damage-type-${dmgType}`)}</dd>\n          <dt>{damage}</dt>\n        </Fragment>\n      ))}\n    </dl>\n  )\n}\n\nexport default DamageList;\n","import { Effect, EffectType } from \"definitions/effects/types\";\nimport { TextManager } from \"global/TextManager\";\n\n// todo: move somewhere else\nconst getEffectDescription = ( effect: Effect) => {\n\n  switch (effect.type) {\n    case EffectType.attributeIncrease: {\n      const attribute = TextManager.getAttributeName(effect.attribute);\n      const percentage = (effect.factor * 100 - 100).toFixed( );\n\n      return TextManager.getEffectDescription(effect, { attribute, percentage });\n    }\n    case EffectType.healthDecreaseOverTime: {\n      const interval = (effect.interval / 1000).toFixed( );\n      return TextManager.getEffectDescription(effect, { interval });\n    }\n    case EffectType.healthDecreaseOnMove: {\n      return TextManager.getEffectDescription(effect)\n    }\n  }\n}\nexport default getEffectDescription;\n","import { Effect } from 'definitions/effects/types';\nimport getEffectDescription from '../TempEffectContext/getEffectDescription';\n\ninterface Props {\n  effects: Effect[];\n}\n\n// Displays list of effects\nconst Effects = (props: Props) => {\n  const { effects } = props;\n  // const definition = getApparelDefinition(item.type)\n\n  return (\n    <ul>\n      {effects.map((e, i) => (\n        <li key={`${e.type}${i}`}>\n          {getEffectDescription(e)}\n        </li>\n      ))}\n    </ul>\n  );\n};\n\nexport default Effects;\n","import { getDefinition as getWeaponDefinition, WeaponTypeDefinition, WeaponType, Weapon } from 'definitions/items/weapons';\nimport { TextManager } from 'global/TextManager';\nimport ProduceOrStudy from '../ProduceOrStudy';\nimport { Item } from \"definitions/items/types\";\nimport DamageList from \"./DamageList\";\nimport Effects from \"../Effects\";\n\ninterface Props {\n  item: Item<Weapon>;\n}\n\nconst WeaponContent = (props: Props) => {\n  const { item } = props;\n  const definition = getWeaponDefinition(item.type)\n\n  const subtext = TextManager.getItemSubtext(item.type);\n  const weaponType = TextManager.getWeaponType(definition.weaponType);\n  const { classification } = WeaponTypeDefinition[definition.weaponType];\n  const classificationText = TextManager.getWeaponClassification(classification);\n\n  return (\n    <>\n      <div className=\"subheader\">{weaponType}\n        {definition.weaponType !== WeaponType.shield && (` (${classificationText})`)}\n      </div>\n      <hr />\n      { definition.damage && <DamageList damage={definition.damage} /> }\n      { !!(definition.effects?.length) && (\n        <Effects effects={definition.effects}/>\n      )}\n      <hr />\n      <ProduceOrStudy item={item.type} />\n      { subtext && (\n        <>\n          <hr />\n          <p className=\"secondary\">{`\"${subtext}\"`}</p>\n        </>\n      )}\n    </>\n  );\n\n}\n\nexport default WeaponContent;\n","import { TextManager } from 'global/TextManager';\nimport { Apparel, getDefinition as getApparelDefinition } from 'definitions/items/apparel';\nimport ProduceOrStudy from './ProduceOrStudy';\nimport { Item } from \"definitions/items/types\";\nimport Effects from \"./Effects\";\n\ninterface Props {\n  item: Item<Apparel>;\n}\n\nconst ApparelContent = (props: Props) => {\n  const { item } = props;\n  const definition = getApparelDefinition(item.type)\n\n  const { damageReduction } = definition;\n  const subtext = TextManager.getItemSubtext(item.type);\n  const equipmentSlot = TextManager.getEquipmentSlot(definition.equipmentType);\n  const { durability = 1 } = item;\n\n  return (\n    <>\n      <div className=\"subheader\">{`${equipmentSlot}`}</div>\n      { subtext && (<p className=\"secondary\">{`\"${subtext}\"`}</p>)}\n      <hr />\n      { damageReduction && <p> { TextManager.get(\"ui-tooltip-damage-reduction\", { damageReduction }) } </p> }\n      { !!(definition.effects?.length) && (\n        <Effects effects={definition.effects}/>\n      )}\n      <dl>\n        <dt>{TextManager.get(\"ui-tooltip-durability\")}</dt>\n        <dd>{(durability * 100).toFixed(0)}%</dd>\n      </dl>\n      <ProduceOrStudy item={item.type} />\n    </>\n  );\n};\n\nexport default ApparelContent;\n","import * as React from \"react\";\nimport { TextManager } from 'global/TextManager';\nimport { Consumable } from \"definitions/items/consumables\";\nimport { ItemSource } from \"constants/items\";\nimport { Item } from \"definitions/items/types\";\n\n\ninterface Props {\n  item: Item<Consumable>;\n  source?: ItemSource;\n}\n\nconst ConsumableContent = (props: Props) => {\n  const { item } = props;\n  const subtext = TextManager.getItemSubtext(item.type);\n\n  return (\n    <div>\n      { subtext && (<p className=\"subtext\">{`\"${subtext}\"`}</p>)}\n    </div>\n  );\n\n}\n\nexport default ConsumableContent;\n","import * as React from \"react\";\nimport { Apparel, isApparel } from \"definitions/items/apparel\";\nimport { Deed, isDeed } from \"definitions/items/deeds\";\nimport { Item } from \"definitions/items/types\";\nimport { isWeapon, Weapon } from \"definitions/items/weapons\";\nimport DeedContent from './DeedContent';\nimport WeaponContent from './WeaponContent';\nimport ApparelContent from './ApparelContent';\nimport { TextManager } from 'global/TextManager';\nimport { Consumable, isConsumable } from \"definitions/items/consumables\";\nimport ConsumableContent from \"./ConsumableContent\";\nimport { ItemSource } from \"constants/items\";\n\nexport interface Props {\n  item: Item;\n  source?: ItemSource;\n}\n\nconst ItemContext = (props: Props) => {\n  const { item, source } = props;\n\n  if (isDeed(item.type)) {\n    return <DeedContent item={item as Item<Deed>} />;\n  }\n  if (isWeapon(item.type)) {\n    return <WeaponContent item={item as Item<Weapon>} />;\n  }\n  if (isApparel(item.type)) {\n    return <ApparelContent item={item as Item<Apparel>} />;\n  }\n  if (isConsumable(item.type)) {\n    return <ConsumableContent item={item as Item<Consumable>} source={source} />;\n  }\n  const subtext = TextManager.getItemSubtext(item.type);\n  return (subtext && (<p className=\"subtext\">{`\"${subtext}\"`}</p>)) || null;\n}\nexport default ItemContext;\n","import * as React from \"react\";\nimport { TextManager } from 'global/TextManager';\nimport { useSelector } from 'react-redux';\nimport { StoreState } from 'store/types';\nimport { StructuresStoreState } from 'store/types/structures';\nimport { Resource } from 'definitions/resources';\nimport { getStructureByResource, getDefinition } from 'definitions/structures';\nimport { StructureState, StructureStoreState } from 'store/types/structure';\nimport { ResourceStructureLevelDefinition, ResourceStructureDefinition } from 'definitions/structures/types';\nimport { useMaxResourcesState, useResourcesState } from 'hooks/store/resources';\nimport { formatNumber } from 'utils/format/number';\nimport useGoldState from 'hooks/store/useGoldState';\nimport { useWorkersFreeState, useWorkersState } from 'hooks/store/useWorkersState';\nimport ReactMarkdown from \"react-markdown\";\nimport './resourceContext.scss';\n\nexport interface Props {\n  info: string;\n}\n\nconst ResourceContext = (props: Props) => {\n\n  const resource = props.info;\n  const resourcesState = useResourcesState();\n  const goldState = useGoldState();\n  const workersState = useWorkersState();\n  const workersFreeState = useWorkersFreeState();\n  const structureStates = useSelector<StoreState, StructuresStoreState>(store => store.structures);\n  const maxResources = useMaxResourcesState();\n\n  const renderProducedBy = () => {\n    const structure = getStructureByResource(resource as Resource);\n    const structureState: StructureStoreState = structureStates[structure];\n    if (structureState.state !== StructureState.Built) {\n      return (\n        <span>\n          {TextManager.get(\"ui-tooltip-resource-produce-row-notbuilt\", {\n            structure: TextManager.getStructureName(structure)\n          })}\n        </span>\n      )\n    }\n    const structureDefinition = getDefinition<ResourceStructureDefinition>(structure);\n    const levelDefinition: ResourceStructureLevelDefinition = structureDefinition.levels[structureState.level];\n    const amount = levelDefinition.generates[resource as Resource];\n\n    return (\n      <span className=\"produced\">\n        <ReactMarkdown components={{ p: \"span\" }}>\n          {TextManager.get(\"ui-tooltip-resource-produce-row\", {\n            structure,\n            amount\n          })}\n        </ReactMarkdown>\n      </span>\n    )\n  }\n\n  switch (resource) {\n    case Resource.fabric:\n    case Resource.food:\n    case Resource.iron:\n    case Resource.leather:\n    case Resource.stone:\n    case Resource.wood: {\n      const amount = formatNumber(resourcesState[resource] ?? 0, 0);\n      const full = (resourcesState[resource] ?? 0) >= (maxResources?.[resource] ?? 0);\n      return (\n        <div className=\"resource-context\">\n          <hr />\n          <div className=\"subheader\">\n            {TextManager.get(`ui-tooltip-resource-quantity`, { amount } )}\n          </div>\n          <div>\n            {renderProducedBy()}\n          </div>\n          { full && (\n            <div className=\"warning-full\">\n              {TextManager.get(`ui-tooltip-resource-warehouse-full`, { resource })}\n            </div>\n          )}\n          <hr />\n          <p className=\"secondary\">\n            {TextManager.get(`resource-${resource}-info`)}\n          </p>\n        </div>\n      )\n    }\n    case \"gold\": {\n      const amount = goldState;\n      return (\n        <>\n          <div className=\"resource-context\">\n            <div>\n              {TextManager.get(`ui-tooltip-resource-quantity`, { amount } )}\n            </div>\n            <p className=\"secondary\">\n              {` ${TextManager.get(`resource-${resource}-info`)}`}\n            </p>\n          </div>\n        </>\n      )\n    }\n    case \"workers\": {\n      const free = workersFreeState;\n      const total = workersState;\n      return (\n        <>\n          <div className=\"resource-context\">\n            <div>\n              {TextManager.get(`ui-tooltip-workers-quantity`, { free, total } )}\n            </div>\n            <p className=\"secondary\">\n            {` ${TextManager.get(`resource-${resource}-info`)}`}\n            </p>\n          </div>\n        </>\n      )\n    }\n    default:\n      throw new Error(\"Uknow value \" + resource);\n  }\n\n}\nexport default ResourceContext;\n","import React, { ComponentProps, PropsWithChildren } from 'react';\nimport './styles/infoWindow.scss';\n\nexport interface Props {\n  className?: string;\n}\n\n// An InfoWindow is a semi transparant black square. It is used for tooltips\n// and InfoModal\nexport const InfoWindow = (props: PropsWithChildren<Props> & ComponentProps<\"div\">) => {\n  const { className, children, ...otherProps } = props;\n  return (\n    <div\n      {...otherProps}\n      className={`info-window ${className || \"\"}`}\n    >\n      {children}\n    </div>\n  )\n}\n","import * as React from \"react\";\nimport * as PIXI from 'pixi.js';\nimport {AppContextProps} from \"hoc/withAppContext\";\nimport {useRef, useState, createContext, useEffect } from \"react\";\nimport {DndProvider } from \"react-dnd\";\nimport {HTML5Backend } from 'react-dnd-html5-backend';\nimport {Link, Redirect, Route, Switch, HashRouter} from \"react-router-dom\";\nimport {ErrorBoundary} from 'react-error-boundary'\nimport {PixiPlugin } from 'gsap/all';\nimport {gsap } from 'gsap';\nimport {SoundManager} from \"global/SoundManager\";\nimport {TextManager} from \"global/TextManager\";\nimport debounce from \"debounce\";\nimport TownView from 'components/town/TownView';\nimport Toasts from 'components/ui/toasts/Toasts';\nimport Topbar from 'components/ui/topbar/Topbar';\nimport WorldView from 'components/world/WorldView';\nimport SimpleLog from 'components/log/SimpleLog';\nimport ContextTooltip from 'components/ui/tooltip/ContextTooltip';\nimport {TooltipManager } from 'global/TooltipManager';\nimport {getWorldLink, getTownLink } from 'utils/routing';\nimport { restartGame } from 'index';\nimport Button, { ButtonColor } from 'components/ui/buttons/Button';\nimport Bubbles from \"components/ui/bubbles/Bubbles\";\nimport { BubbleLayer } from \"global/BubbleManager\";\nimport ErrorModal from \"components/ui/error/ErrorModal\";\nimport \"./styles/app.scss\";\n\nPixiPlugin.registerPIXI(PIXI);\ngsap.registerPlugin(PixiPlugin);\n\n\ndeclare global {\n  interface Window { __PIXI_INSPECTOR_GLOBAL_HOOK__: { register: (x: { PIXI: typeof PIXI }) => void }; }\n}\nif (process.env.NODE_ENV === \"development\") {\n  // Register pixi inspector chrome plugin\n  // https://chrome.google.com/webstore/detail/pixijs-devtools/aamddddknhcagpehecnhphigffljadon\n  window.__PIXI_INSPECTOR_GLOBAL_HOOK__?.register({ PIXI: PIXI });\n}\n\nexport enum View {\n  Town,\n  World,\n}\n\nexport const MAX_WIDTH = 960;\nexport const AppContext = createContext<AppContextProps | null>(null);\n\n\nconst App = () => {\n  const containerRef = useRef<HTMLDivElement>(null);\n\n  const [activeWindows, setActiveWindows] = useState<React.ReactElement[]>([]);\n\n  const handleViewButtonClick = () => {\n    SoundManager.playSound(\"ui/buttonClick\");\n  };\n\n  const handleRestartClick = () => {\n    restartGame();\n\n  };\n\n  const renderTownView = () => <TownView />;\n  const renderWorldView = () => <WorldView />;\n\n  const handleWindowOpened = (window: React.ReactElement) => {\n    setActiveWindows([\n      ...activeWindows || [],\n      window,\n    ]);\n  };\n\n  /**\n   * Closes all windows\n   */\n  const handleWindowClose = () => {\n    setActiveWindows([]);\n  };\n\n  /**\n   * Closes the top window of the stack\n   */\n  const handleWindowBack = () => {\n    if (activeWindows && activeWindows.length) {\n      setActiveWindows(activeWindows.slice(0, -1));\n    }\n  };\n\n  const renderWindow = (): React.ReactElement | null => {\n    if (!activeWindows.length) {\n      return null;\n    }\n\n    const topWindow = activeWindows[activeWindows.length - 1];\n    const commonWindowProps = {\n      onClose: handleWindowClose,\n      onBack: handleWindowBack,\n      backEnabled: activeWindows.length > 1,\n      closeEnabled: true,\n    };\n\n    const element = React.cloneElement(topWindow, commonWindowProps);\n    return element;\n  };\n\n  useEffect(() => {\n    SoundManager.addSound(\"ui/buttonClick\", \"sound/ui/button-click.ogg\");\n    SoundManager.addSound(\"ui/equip\", \"sound/ui/equip.mp3\");\n    SoundManager.addSound(\"ui/error\", \"sound/ui/error.ogg\");\n    SoundManager.addSound(\"ui/levelUp\", \"sound/ui/level-up.ogg\");\n    SoundManager.addSound(\"ui/toast\", \"sound/ui/toast.ogg\");\n\n    SoundManager.addSound(\"scene/drinking\", \"sound/scene/drinking.ogg\");\n  }, []);\n\n  const handleAppClick = () => {\n    TooltipManager.clear();\n  };\n\n  useEffect(() => {\n    const handleScroll = debounce(() => {\n      TooltipManager.clear();\n    }, 100);\n    window.addEventListener(\"scroll\", handleScroll);\n    window.addEventListener(\"wheel\", handleScroll);\n    return () => {\n      window.removeEventListener(\"resize\", handleScroll);\n      window.removeEventListener(\"wheel\", handleScroll);\n    };\n  }, []);\n\n  return (\n    <ErrorBoundary\n      FallbackComponent={ErrorModal}\n    >\n      <AppContext.Provider value={{\n        onOpenWindow: handleWindowOpened,\n        onCloseWindow: handleWindowClose,\n      }} >\n        <div\n          className=\"app\"\n          ref={containerRef}\n          style={{\n            maxWidth: MAX_WIDTH\n          }}\n          onClick={handleAppClick}\n        >\n          {/* <QuestRepaintTester /> */}\n          <DndProvider backend={HTML5Backend}>\n          <HashRouter>\n            <Topbar />\n            <div className=\"control-bar\">\n              <Switch>\n                <Route path=\"/\" exact={true} >\n                  <Redirect from=\"/\" to={getWorldLink()} />\n                </Route>\n                <Route path={getWorldLink()}>\n                  <Link to={getTownLink()}>\n                    <Button onClick={() => handleViewButtonClick()} color=\"green\"> {TextManager.get(`ui-view-button-town`)} </Button>\n                  </Link>\n                </Route>\n                <Route path={getTownLink()}>\n                  <Link to={getWorldLink()}>\n                    <Button onClick={() => handleViewButtonClick()}  > {TextManager.get(`ui-view-button-world`)} </Button>\n                  </Link>\n                </Route>\n              </Switch>\n              {` | `}\n              <Button onClick={() => handleRestartClick()} color={ButtonColor.purple} > Restart! </Button>\n            </div>\n            <Switch>\n              <Route path={getTownLink()} render={renderTownView} />\n              <Route path={getWorldLink()} render={renderWorldView} />\n            </Switch>\n            <SimpleLog/>\n            {renderWindow()}\n            <ContextTooltip />\n            <Toasts />\n            <Bubbles layer={BubbleLayer.general} />\n          </HashRouter>\n          </DndProvider>\n        </div>\n      </AppContext.Provider>\n    </ErrorBoundary>\n  );\n};\n\nexport default App;\n","import * as React from \"react\";\nimport { TextManager } from 'global/TextManager';\nimport { TraitDefinition } from 'definitions/traits/types';\n import './styles/traitContext.scss';\n\nexport interface Props {\n  traitDefinition: TraitDefinition;\n}\n\nconst TraitContext = (props: Props) => {\n\n  const {traitDefinition} = props;\n\n  return (\n    <div className=\"trait-context\">\n      <div className=\"description\">\n        {TextManager.getTraitDescription(traitDefinition.trait)}\n      </div>\n      { traitDefinition.hasEffect && (\n      <div className=\"effect\">\n        {TextManager.getTraitEffect(traitDefinition.trait)}\n\n      </div>)}\n    </div>\n  )\n}\nexport default TraitContext;\n","import { Fragment } from 'react';\nimport { TextManager } from 'global/TextManager';\nimport { AttributeSource, AttributeSourceType, ExtendedAttribute } from 'mechanics/adventurers/attributes';\nimport { roundIfNeeded } from 'utils/format/number';\nimport { Attribute } from 'store/types/adventurer';\nimport './styles/attributeContext.scss';\n\nexport interface Props {\n  extendedAttribute: ExtendedAttribute;\n}\n\nconst AttributeContext = (props: Props) => {\n  const { extendedAttribute } = props;\n  console.log(extendedAttribute)\n  return (\n    <div className=\"attribute-context\">\n      <hr />\n      <div className=\"mechanics\">\n        {TextManager.getAttributeMechanics(extendedAttribute.attribute)}\n      </div>\n      <hr />\n      <dl className=\"values\">\n        {extendedAttribute.components.map((eAC, i) => {\n          const origin = renderOrigin(eAC.origin, extendedAttribute.attribute);\n          return (\n            <Fragment key={eAC.origin.type + i}>\n              <dt title={origin}>{origin}</dt>\n              <dd className={eAC.origin.type === AttributeSourceType.base ? \"base\" : \"additional\"}>{roundIfNeeded(eAC.value)}</dd>\n            </Fragment>\n          )\n        })}\n      </dl>\n      <hr />\n      <div className=\"description\">\n        {TextManager.getAttributeDescription(extendedAttribute.attribute)}\n      </div>\n    </div>\n  )\n}\nexport default AttributeContext;\n\nconst renderOrigin = (origin: AttributeSource, attribute: Attribute) => {\n  switch (origin.type) {\n    case AttributeSourceType.base:\n      return `base ${TextManager.getAttributeName(attribute)}`;\n    case AttributeSourceType.tempEffect:\n      return \"soma\"; // todo: split out which tempEffect\n    case AttributeSourceType.item:\n      return TextManager.getItemName(origin.item);\n  }\n}\n","import * as React from \"react\";\nimport { calculateDodge, calculateInitialAP } from \"mechanics/combat\";\nimport { AttributesStoreState } from \"store/types/adventurer\"\n\ninterface Props {\n  basicAttributes: AttributesStoreState;\n  level: number;\n}\n\nconst CombatAttributes = (props: Props) => {\n  const { basicAttributes, level } = props;\n  return (\n    <>\n      <div>\n        AP each turn: {calculateInitialAP(basicAttributes, level)}\n      </div>\n      <div>\n          Dodge: {calculateDodge(basicAttributes)}%\n      </div>\n    </>\n  )\n}\n\nexport default CombatAttributes;\n","import * as React from \"react\";\nimport { useAdventurerState } from \"hooks/store/adventurers\";\nimport { ActorObject } from \"store/types/scene\";\nimport Attributes from \"components/ui/adventurer/AdventurerPanel/Attributes\";\nimport { xpToLevel } from \"mechanics/adventurers/levels\";\nimport { TextManager } from \"global/TextManager\";\nimport CombatAttributes from \"./CombatAttributes\";\nimport { useMemo } from \"react\";\nimport { calculateEffectiveAttributesExtended } from \"mechanics/adventurers/attributes\";\n\ninterface Props {\n  actorObject: ActorObject\n}\n\nconst AdventurerContext = (props: Props) => {\n  const { actorObject } = props;\n  const adventurer = useAdventurerState(actorObject.name);\n  const { name, xp, basicAttributes } = adventurer;\n  const level = xpToLevel(xp);\n  const extendedAttributes = useMemo(() => calculateEffectiveAttributesExtended(adventurer), [adventurer]);\n\n  return (\n    <div>\n      <div className=\"name-and-level\">\n        <div className=\"name\">\n          {name}\n        </div>\n        <div className=\"level\">\n          {TextManager.get(\"ui-tooltip-actor-level\", { level })}\n        </div>\n      </div>\n      <Attributes attributes={extendedAttributes} small />\n      <CombatAttributes basicAttributes={basicAttributes} level={level} />\n    </div>\n  )\n}\n\nexport default AdventurerContext;\n","import { ActorObject } from \"store/types/scene\";\nimport { getDefinition } from \"definitions/enemies\";\nimport { EnemyType } from \"definitions/enemies/types\";\nimport { TextManager } from \"global/TextManager\";\nimport Attributes from \"components/ui/adventurer/AdventurerPanel/Attributes\";\nimport CombatAttributes from \"./CombatAttributes\";\nimport { generateBaseAttributes } from \"mechanics/adventurers/attributes\";\n\ninterface Props {\n  actorObject: ActorObject\n}\n\nconst EnemyContext = (props: Props) => {\n  const { actorObject } = props;\n  const definition = getDefinition(actorObject.name as EnemyType)\n  const level = actorObject.level ?? 1\n  const attributesExtended = generateBaseAttributes(definition.attributes);\n\n  return (\n    <div>\n      <div className=\"name-and-level\">\n        <div className=\"name\">\n          {TextManager.getEnemyName(actorObject.name as EnemyType)}\n        </div>\n        <div className=\"level\">\n          {TextManager.get(\"ui-tooltip-actor-level\", { level })}\n        </div>\n      </div>\n      <Attributes attributes={attributesExtended} small />\n      <CombatAttributes basicAttributes={definition.attributes} level={level} />\n    </div>\n  )\n}\n\nexport default EnemyContext;\n","import * as React from \"react\";\nimport { ActorObject, Allegiance } from \"store/types/scene\";\nimport AdventurerContext from \"./AdventurerContext\";\nimport EnemyContext from \"./EnemyContext\";\nimport './styles/actorContext.scss';\n\n\ninterface Props {\n  actorObject: ActorObject\n}\n\n// Shows stuff relevant for combat\nconst ActorContext = (props: Props) => {\n  const { actorObject } = props;\n  return (\n    <div className=\"actor-context\">\n      {actorObject.allegiance === Allegiance.player && (<AdventurerContext actorObject={actorObject} />)}\n      {actorObject.allegiance === Allegiance.enemy && (<EnemyContext actorObject={actorObject} />)}\n    </div>\n  )\n}\n\nexport default ActorContext;\n","import { TempEffect, TempEffectType } from \"definitions/tempEffects/types\";\nimport { TextManager } from \"global/TextManager\";\n\n\nconst getTempEffectDescription = (effect: TempEffect) => {\n\n  switch (effect.type) {\n    case TempEffectType.burning: {\n      const interval = (effect.interval / 1000).toFixed( );\n      return TextManager.getTempEffectDescription(effect, { interval });\n    }\n\n    case TempEffectType.brokenLegs:\n      return TextManager.getTempEffectDescription(effect);\n\n      case TempEffectType.soma: {\n      const percentage = (effect.factor * 100 - 100).toFixed( );\n      return TextManager.getTempEffectDescription(effect, { percentage });\n    }\n  }\n}\nexport default getTempEffectDescription;\n","import { TextManager } from 'global/TextManager';\nimport getTempEffectDescription from './getTempEffectDescription';\nimport { TempEffect } from 'definitions/tempEffects/types';\nimport './styles/effectContext.scss';\n\nexport interface Props {\n  effect: TempEffect;\n}\n\nconst EffectContext = (props: Props) => {\n  const { effect } = props;\n  const { charges } = effect;\n  return (\n    <div className=\"effect-context\">\n      <hr />\n\n      <div className=\"description\">\n         { getTempEffectDescription(effect)}\n      </div>\n      { /* show time remaining */ }\n      { charges && (\n        <div>\n          {TextManager.get(charges === 1 ? \"ui-tooltip-effect-one-charge-remains\" : \"ui-tooltip-effect-n-charges-remain\", { charges }) }\n        </div>\n      )}\n      <hr />\n      <div className=\"flavor secondary\">\n        {TextManager.getTempEffectFlavor(effect)}\n      </div>\n    </div>\n  )\n}\nexport default EffectContext;\n","import { ReactNode, useEffect, useState } from 'react';\nimport { ContextType } from 'constants/context';\nimport { TooltipManager, Context, EVENT_CONTEXT_UPDATED } from 'global/TooltipManager';\nimport { TextManager } from 'global/TextManager';\nimport ItemContext from './context/ItemContext';\nimport { ItemDefinition, Item } from 'definitions/items/types';\nimport { Resource } from 'definitions/resources';\nimport ResourceContext from './context/ResourceContext';\nimport Tooltip from '../Tooltip';\nimport { TraitDefinition } from 'definitions/traits/types';\nimport TraitContext from './context/TraitContext';\nimport { WeaponType } from 'definitions/items/weapons';\nimport { Rarity } from 'constants/items';\nimport { getDefinition } from 'definitions/items';\nimport AttributeContext from './context/AttributeContext';\nimport { ActorObject } from 'store/types/scene';\nimport ActorContext from './context/ActorContext';\nimport TempEffectContext from './context/TempEffectContext';\nimport { ExtendedAttribute } from 'mechanics/adventurers/attributes';\nimport { TempEffect } from 'definitions/tempEffects/types';\nimport './styles/contextTooltip.scss';\n\n// A contextual popup showing what you just clicked.\n// Can be an Item, Resource, Trait, skill, etc\nconst ContextTooltip = () => {\n\n  const [selectedContext, setSelectedContext] = useState<Context | undefined>();\n\n  const tooltipUpdated = (context: Context | undefined) => {\n    setSelectedContext(context);\n  }\n  useEffect(() => {\n    TooltipManager.instance.addListener(EVENT_CONTEXT_UPDATED, tooltipUpdated);\n    return () => {\n      TooltipManager.instance.removeListener(EVENT_CONTEXT_UPDATED, tooltipUpdated);\n    }\n  }, []);\n  if (!selectedContext) { return null; }\n\n  const { info, type, className, source } = selectedContext;\n  const renderContent = () => {\n    switch (type) {\n      case ContextType.actor: {\n        return (\n          <ActorContext actorObject={info as ActorObject} />\n        );\n      }\n      case ContextType.attribute: {\n        const extendedAttribute = info as ExtendedAttribute;\n        const name = TextManager.getAttributeName(extendedAttribute.attribute);\n        return (\n          <>\n            <div className=\"header\">\n              <div className=\"name effect\">{name}</div>\n              <div className=\"secondary\">\n                { TextManager.get(\"ui-tooltip-attribute\")}\n              </div>\n            </div>\n            <AttributeContext extendedAttribute={extendedAttribute} />\n          </>\n        );\n      }\n      case ContextType.tempEffect: {\n        const effect = info as TempEffect;\n        const name = TextManager.getTempEffectName(effect);\n        return (\n          <>\n            <div className=\"header\">\n              <div className=\"name effect\">{name}</div>\n              <div className=\"secondary\">\n                { TextManager.get(\"ui-tooltip-effect\")}\n              </div>\n            </div>\n            <TempEffectContext effect={effect} />\n          </>\n        );\n      }\n      case ContextType.resource: {\n        const name = TextManager.getResourceName(info as Resource);\n        return (\n          <>\n            <div className=\"header\">\n              <div className=\"name resource\">{name}</div>\n              <div className=\"secondary\">\n                { TextManager.get(\"ui-tooltip-resource-resource\")}\n              </div>\n            </div>\n            <ResourceContext info={info as string} />\n          </>\n        );\n      }\n      case ContextType.item: {\n        const item = info as Item;\n        const name = TextManager.getItemName(item.type);\n        const itemDefinition = getDefinition(item.type) as ItemDefinition;\n        return (\n          <>\n            <div className=\"header\">\n              <div className={`name item ${getItemNameClassName(itemDefinition)}`}>{name}</div>\n              <div className=\"secondary\">\n                {TextManager.getItemCategory(itemDefinition.itemCategory)}\n              </div>\n            </div>\n            <ItemContext item={item} source={source} />\n          </>\n        );\n      }\n      case ContextType.trait: {\n        const traitDefinition = info as TraitDefinition;\n        const name = TextManager.getTraitName(traitDefinition.trait);\n        return (\n          <>\n            <div className=\"name trait\">\n              {TextManager.get(\"ui-tooltip-type-trait\")}\n              {name}\n            </div>\n            <TraitContext traitDefinition={traitDefinition} />\n          </>\n        );\n      }\n      case ContextType.skill: {\n        const skill = info as WeaponType;\n        const name = TextManager.getSkillName(skill);\n        return (\n          <>\n            <div className=\"name skill\">\n              {TextManager.get(\"ui-tooltip-type-skill\")}\n              {name}\n            </div>\n            { TextManager.getSkillInfo(skill)}\n          </>\n        );\n      }\n      case ContextType.component: {\n        const component = info as ReactNode;\n        return component;\n      }\n      default: {\n        throw new Error(`Unknown context type ${selectedContext.type}`)\n      }\n    }\n  }\n\n  return (\n    <Tooltip referenceRect={selectedContext.referenceRect} className={className}>\n      <div className=\"context-tooltip\">\n        {renderContent()}\n      </div>\n    </Tooltip>\n  )\n}\nexport default ContextTooltip;\n\nexport const getItemNameClassName = (item: ItemDefinition): string => {\n  const {rarity} = item;\n  switch (rarity) {\n    case Rarity.common:\n      return \"item-name-common\";\n    case Rarity.uncommon:\n      return \"item-name-uncommon\";\n    case Rarity.rare:\n      return \"item-name-rare\";\n    case Rarity.epic:\n      return \"item-name-epic\";\n    case Rarity.legendary:\n      return \"item-name-legendary\";\n  }\n  return \"item-name-common\";\n};\n","import { Effect, EffectType } from \"definitions/effects/types\"\nimport { Attribute, attributeList } from \"store/types/adventurer\"\nimport { TempEffect, TempEffectType } from \"./types\"\n\nexport type EffectDefinition = {\n  harmful: boolean;\n}\n\n// given all props of TempEffect of\nexport const createTempEffect = <T extends TempEffect> (tempEffect: Omit<T, 'effects'>) => {\n  return {\n    ...tempEffect,\n    effects: getEffects(tempEffect)\n  }\n}\n\nexport const getEffects = <T extends TempEffect> (tempEffect: Omit<T, 'effects'>): Effect[] => {\n  const t = tempEffect as T;\n  switch (t.type) {\n    case TempEffectType.brokenLegs: {\n      return [{\n        type: EffectType.healthDecreaseOnMove,\n        damage: t.damage\n      }]\n    }\n    case TempEffectType.burning: {\n      return [{\n        type: EffectType.healthDecreaseOverTime,\n        interval: t.interval,\n        damage: t.damage\n      }]\n    }\n    case TempEffectType.soma: {\n      return attributeList.map((attribute: Attribute) => ({\n        type: EffectType.attributeIncrease,\n        attribute,\n        factor: t.factor\n      }))\n    }\n    default:\n      return [];\n  }\n}\n\n// const all = {\n//   [EffectType.attributeIncrease]: {\n//     harmful: false\n//   },\n//   [EffectType.brokenLegs]: {\n//     harmful: true\n//   },\n//   [EffectType.burning]: {\n//     harmful: true\n//   },\n//   [EffectType.soma]: {\n//     harmful: false\n//   }\n// };\n\n// export default all;\n// export function getDefinition(effectType: EffectType): EffectDefinition {\n//   return all[effectType] as unknown as EffectDefinition;\n// }\n","import { AdventurerAction } from \"store/actions/adventurers\";\nimport { EquipmentSlotType } from \"components/ui/adventurer/EquipmentSlot\";\nimport { Reducer } from \"redux\";\nimport { AdventurerColor, AdventurerStoreState, AttributesStoreState } from \"store/types/adventurer\";\nimport { Trait } from 'definitions/traits/types';\nimport { WeaponType } from 'definitions/items/weapons';\nimport { levelToXp, MAX_XP } from \"mechanics/adventurers/levels\";\nimport { Action } from \"store/actions\";\nimport { getDefinition, isConsumable } from \"definitions/items/consumables\";\nimport { Item } from \"definitions/items/types\";\nimport { Effect } from \"definitions/effects/types\";\nimport { calculateBaseHitpoints } from \"mechanics/adventurers/hitpoints\";\nimport { TempEffectBrokenLegs, TempEffectBurning, TempEffectType } from \"definitions/tempEffects/types\";\nimport { createTempEffect } from \"definitions/tempEffects\";\n\n\nconst generateRandomAttributes = (): AttributesStoreState => {\n  return {\n    str: Math.floor(Math.random() * 3) + 9,\n    for: Math.floor(Math.random() * 3) + 9,\n    int: Math.floor(Math.random() * 3) + 9,\n    agi: Math.floor(Math.random() * 3) + 9\n  };\n};\nconst generateAttributesHealthAndXp = (level = 1) => {\n  const basicAttributes = generateRandomAttributes();\n  const xp = levelToXp(level) + (Math.random() * levelToXp(level + 1));\n  const health = 20 + Math.random() * (calculateBaseHitpoints(level, basicAttributes.for) - 20);\n  return {\n    basicAttributes,\n    xp,\n    health,\n  }\n}\nconst avatarImgBasePath = \"/img/avatars\";\nconst spritesheetBasePath = \"img/scene/actors/\";\n\n\n// Create a bunch of guys for debugging\nexport const initialAdventurers: AdventurerStoreState[] = [{\n  id: \"c4a5d270\",\n  equipment: {\n    [EquipmentSlotType.head]: { type: \"apparel/cowl\", durability: 0.25 },\n    [EquipmentSlotType.chest]: { type: \"apparel/chest\", durability: 0.5 },\n    [EquipmentSlotType.hands]: { type: \"apparel/clothGloves\" },\n    [EquipmentSlotType.shoulders]: { type: \"apparel/shoulders2\" },\n    [EquipmentSlotType.legs]: { type: \"apparel/pants2\" },\n    [EquipmentSlotType.feet]: { type: \"apparel/boots3\" },\n    [EquipmentSlotType.mainHand]: { type: \"weapon/longbow\" },\n    [EquipmentSlotType.offHand]: { type: \"ammunition/basicArrows\", quantity: 200 }\n    // offHand: Item.indomitableCarapace\n  },\n  ...generateAttributesHealthAndXp(),\n  room: 0,\n  name: \"Sasha Falcon\",\n  flavor: true,\n  traits: [Trait.houseMaddox, Trait.gloomy],\n  avatarImg: `${avatarImgBasePath}/female/f_14.png`,\n  spritesheetPath: `${spritesheetBasePath}elf-bow.json`,\n  color: AdventurerColor.purple,\n  skills: {\n    [WeaponType.crossbow]: 10,\n    [WeaponType.bow]: 10\n  },\n  tempEffects: [],\n  inventory: [ { type: \"deed/lumbermill\" }, null, { type: \"weapon/simpleCrossbow\" }, { type: \"weapon/dagger\" }, { type: \"weapon/khopesh\" }, null, { type: \"weapon/steelSword\" }, null,  { type: \"consumable/lesserSoma\" }, { type: \"consumable/minorSoma\" }, { type: \"consumable/greaterManaPotion\" },  { type: \"consumable/majorHealthPotion\" },  null,  { type: \"weapon/steelShield\" },  null,  null,  null,  null],\n}, {\n  id: \"2e655832\",\n  equipment: {\n    [EquipmentSlotType.feet]: { type: \"apparel/boots2\" },\n    [EquipmentSlotType.mainHand]: { type: \"weapon/simpleCrossbow\" },\n    [EquipmentSlotType.offHand]: { type: \"ammunition/crossbowBolts\", quantity: 150 }\n  },\n  ...generateAttributesHealthAndXp(),\n  name: \"Addison Chilson\",\n  flavor: true,\n\n  room: 1,\n  avatarImg: `${avatarImgBasePath}/male/m_05.png`,\n  spritesheetPath: `${spritesheetBasePath}elf-bow.json`,\n  color: AdventurerColor.teal,\n  traits: [Trait.houseHouston],\n  skills: {\n    [WeaponType.crossbow]: 12,\n    [WeaponType.staff]: 13\n  },\n  tempEffects: [],\n  inventory: [ { type: \"weapon/simpleCrossbow\" }, null, { type: \"consumable/greaterSoma\" }, null, null, null, { type: \"apparel/boots1\" }, { type: \"apparel/chainmailHood\"} , { type: \"apparel/nomadHelmet\" }, { type: \"apparel/plateChest4\" }, null, { type: \"weapon/buckler\" }, null, null, null,  null,  null,  null,  null,  null,  null,  null,  null, { type: \"apparel/plateHelmet\" }, { type: \"apparel/cowl\" }]\n}, {\n  id: \"ec6f1050\",\n  equipment: {\n    [EquipmentSlotType.feet]: { type: \"apparel/boots3\" },\n    [EquipmentSlotType.mainHand]: { type: \"weapon/warhammer\" }\n    // offHand: Item.aegisOfValor\n  },\n  ...generateAttributesHealthAndXp(),\n  name: \"Zackary 'bone bag' Morris\",\n  flavor: true,\n\n  room: 2,\n  traits: [Trait.gloomy],\n  skills: {\n    [WeaponType.sword]: 12,\n    [WeaponType.hammer]: 6\n  },\n  avatarImg: `${avatarImgBasePath}/male/m_09.png`,\n  spritesheetPath: `${spritesheetBasePath}skeleton.json`,\n  color: AdventurerColor.black,\n  tempEffects: [\n    createTempEffect<TempEffectBrokenLegs>({\n      type: TempEffectType.brokenLegs,\n      damage: 10,\n      charges: 10\n    }),\n    createTempEffect<TempEffectBurning>({\n      type: TempEffectType.burning,\n      damage: 10,\n      interval: 500\n    })\n  ],\n  // tempEffects: [{\n  //   type: EffectType.healthDecreaseOnMove,\n  //   lastTick: Date.now(),\n  //   damage: 10,\n  //   charges: 10\n  // }, {\n  //   type: EffectType.healthDecreaseOverTime,\n  //   lastTick: Date.now(),\n  //   damage: 4,\n  //   interval: 5000\n  // }],\n  inventory: [{ type: \"weapon/greatswordOfGwai\" }, null, null, null, { type: \"weapon/berserkerShield\" }],\n}, {\n  id: \"d299f98a\",\n  ...generateAttributesHealthAndXp(),\n  equipment: {\n    [EquipmentSlotType.mainHand]: { type: \"weapon/steelSword\" }\n  },\n  name: \"Mike Keith\",\n  flavor: true,\n\n  room: 4,\n  avatarImg: `${avatarImgBasePath}/male/m_19.png`,\n  spritesheetPath: `${spritesheetBasePath}knight-sword.json`,\n  traits: [Trait.arrowFinder],\n  skills: {\n    [WeaponType.sword]: 13\n  },\n  tempEffects: [],\n  inventory: [ null, null, null, null, { type: \"weapon/khopesh\" }, { type: \"apparel/hornedHelmet\" }, { type: \"weapon/woodenBulwark\"} ],\n}, {\n  id: \"96c686c3\",\n  equipment: {},\n  ...generateAttributesHealthAndXp(),\n  name: \"Wayne Monroe\",\n  flavor: true,\n\n  room: 5,\n  avatarImg: `${avatarImgBasePath}/male/m_08.png`,\n  spritesheetPath: `${spritesheetBasePath}orc-axe.json`,\n  traits: [Trait.houseMonroe, Trait.arrowFinder],\n  skills: {\n    [WeaponType.axe]: 12\n  },\n  tempEffects: [],\n  inventory: [ null, null, null, { type: \"weapon/goldenShield\" }],\n}, {\n  id: \"250d1a9d\",\n  ...generateAttributesHealthAndXp(),\n  name: \"Alexis Ortiz \",\n  flavor: true,\n\n  room: 9,\n  avatarImg: `${avatarImgBasePath}/female/f_10.png`,\n  spritesheetPath: `${spritesheetBasePath}knight-sword.json`,\n  inventory: [ null, null, null, null, null ],\n  skills: {\n    [WeaponType.axe]: 10\n  },\n  equipment: {\n    [EquipmentSlotType.mainHand]: { type: \"weapon/longbow\" },\n    [EquipmentSlotType.offHand]: { type: \"ammunition/basicArrows\", quantity: 50 }\n  },\n  tempEffects: []\n}, {\n  id: \"169384ef\",\n  ...generateAttributesHealthAndXp(),\n  name: \"Karlee Nolan\",\n  flavor: true,\n\n  room: 3,\n  avatarImg: `${avatarImgBasePath}/female/f_16.png`,\n  spritesheetPath: `${spritesheetBasePath}troll-sword.json`,\n  inventory: [ { type: \"weapon/greatswordOfGwai\" }, null, null, null ],\n  skills: {\n    [WeaponType.axe]: 10\n  },\n  equipment: {\n    [EquipmentSlotType.mainHand]: { type: \"weapon/simpleCrossbow\" },\n    [EquipmentSlotType.offHand]: { type: \"ammunition/crossbowBolts\", quantity: 40 }\n  },\n  tempEffects: []\n}, {\n  id: \"f22d66cb\",\n  ...generateAttributesHealthAndXp(),\n  equipment: {},\n  name: \"Gylbarde the Earnest\",\n\n  room: 8,\n  avatarImg: `${avatarImgBasePath}/male/m_09.png`,\n  spritesheetPath: `${spritesheetBasePath}knight-sword.json`,\n  inventory: [ null, null, null, null, null ],\n  skills: {\n    [WeaponType.axe]: 13\n  },\n  tempEffects: []\n}, {\n  id: \"36c686c1\",\n  equipment: {},\n  ...generateAttributesHealthAndXp(),\n  name: \"Lanslet of the Water\",\n\n  room: 6,\n  avatarImg: `${avatarImgBasePath}/male/m_26.png`,\n  spritesheetPath: `${spritesheetBasePath}knight-sword.json`,\n  inventory: [ { type: \"weapon/greatswordOfGwai\" }, null, null, null, { type: \"apparel/shoulders1\" }, { type: \"apparel/fedora\" }, { type: \"apparel/greaves2\" }],\n  skills: {\n    [WeaponType.axe]: 3\n  },\n  tempEffects: []\n}, {\n  id: \"12c613d4\",\n  equipment: {},\n  ...generateAttributesHealthAndXp(),\n  name: \"Tedric the Bold\",\n\n  room: 7,\n  avatarImg: `${avatarImgBasePath}/male/m_33.png`,\n  spritesheetPath: `${spritesheetBasePath}knight-sword.json`,\n  inventory: [ { type: \"weapon/greatswordOfGwai\" }, null, null, null ],\n  skills: {\n    [WeaponType.axe]: 10\n  },\n  tempEffects: [\n    createTempEffect<TempEffectBrokenLegs>({\n      type: TempEffectType.brokenLegs,\n      damage: 8,\n      charges: 10\n    })\n  ]\n}, {\n  id: \"5a402ef1\",\n  equipment: {\n    [EquipmentSlotType.head]: { type: \"apparel/crimsonRogueCoif\", durability: 0.25 },\n    [EquipmentSlotType.chest]: { type: \"apparel/crimsonRogueTunic\", durability: 0.5 },\n    [EquipmentSlotType.hands]: { type: \"apparel/crimsonRogueGrips\" },\n    [EquipmentSlotType.shoulders]: { type: \"apparel/crimsonRogueSpaulders\" },\n    [EquipmentSlotType.legs]: { type: \"apparel/crimsonRogueBritches\" },\n    [EquipmentSlotType.feet]: { type: \"apparel/crimsonRogueBoots\" },\n    [EquipmentSlotType.mainHand]: { type: \"weapon/dagger\" },\n    [EquipmentSlotType.offHand]: { type: \"weapon/dagger\" }\n  },\n  ...generateAttributesHealthAndXp(),\n  room: 11,\n  name: \"Allynna Nerilar\",\n  flavor: true,\n  traits: [Trait.houseMaddox, Trait.gloomy],\n  avatarImg: `${avatarImgBasePath}/female/f_21.png`,\n  spritesheetPath: `${spritesheetBasePath}elf-bow.json`,\n  color: AdventurerColor.purple,\n  skills: {\n    [WeaponType.knife]: 15,\n    [WeaponType.bow]: 11\n  },\n  tempEffects: [],\n  inventory: [ { type: \"deed/lumbermill\" }, null, { type: \"weapon/simpleCrossbow\" }, { type: \"weapon/dagger\" }, { type: \"weapon/khopesh\" }, null, { type: \"weapon/steelSword\" }, null,  { type: \"consumable/lesserSoma\" }, { type: \"consumable/minorSoma\" }, { type: \"consumable/greaterManaPotion\" },  { type: \"consumable/majorHealthPotion\" },  null,  { type: \"weapon/steelShield\" },  null,  null,  null,  null],\n}];\n\n// TODO: To generate a random 11 digit number, use: Math.random().toString(36).substring(2)\n\nexport const adventurers: Reducer<AdventurerStoreState[], AdventurerAction> = (state: AdventurerStoreState[] = initialAdventurers, action: Action) => {\n\n  switch (action.type) {\n    // Changes adventurers health\n    case \"modifyHealth\": {\n      return state.map((adventurer: AdventurerStoreState) => {\n        if (adventurer.id === action.adventurerId) {\n          const health = adventurer.health += action.amount;\n          return {\n            ...adventurer,\n            health,\n          };\n        }\n        return adventurer;\n      });\n    }\n\n    // Moves an item from one inventory slot to another\n    case \"consumeItem\": {\n      const { adventurerId, fromSlot } = action;\n      const adventurer = state.find((a) => a.id === adventurerId);\n      if (!adventurer) {\n        throw new Error(`No adventurer ${adventurerId} found`)\n      }\n      let { health } = adventurer;\n      const consumable = adventurer.inventory[fromSlot];\n      if (!consumable || !isConsumable(consumable.type)) {\n        throw new Error(`No potion found at index ${fromSlot} `)\n      }\n      const definition = getDefinition(consumable.type);\n      // todo: 2021-09-02 Drink potions\n      switch (definition.category) {\n        case \"health\":\n          health = Math.min((definition.effect ?? 0) + health, 100);\n          break;\n        case \"soma\":\n          // handled by effects middleware\n          console.log(`${adventurer.name} drinks a soma potion`);\n          break;\n        case \"mana\":\n          console.log(`${adventurer.name} drinks a mana potion`);\n          break;\n      }\n\n      // take item from the inventory\n      const inventory = adventurer.inventory.map((element, index) => index !== fromSlot ? element : null);\n      return state.map((element: AdventurerStoreState) => {\n        if (element === adventurer) {\n          return {\n            ...element,\n            health,\n            inventory,\n          };\n        }\n        return element;\n      });\n    }\n    // Moves an  item from one inventory slot to another\n    case \"moveItemInInventory\": {\n      const { adventurerId, fromSlot, toSlot } = action;\n      const adventurer = state.find((a) => a.id === adventurerId);\n      if (!adventurer) {\n        throw new Error(`No adventurer ${adventurerId} found`)\n      }\n      const inventory = adventurer.inventory.map((element, index) => {\n        if (index === fromSlot) { return adventurer.inventory[toSlot]; }\n        if (index === toSlot) { return adventurer.inventory[fromSlot]; }\n        return element;\n      });\n\n      return state.map((element: AdventurerStoreState) => {\n        if (element === adventurer) {\n          return {\n            ...element,\n            inventory,\n          };\n        }\n        return element;\n      });\n    }\n\n    case \"moveItemToOtherAdventurer\": {\n      // Moves an item from one adventurer to another\n      const { adventurerId: fromAdventurerId, fromSlot, toAdventurerId } = action;\n      const fromAdventurer = state.find((a) => a.id === fromAdventurerId);\n      if (!fromAdventurer) return state\n      const item = fromAdventurer.inventory[fromSlot];\n\n      return state.map((element: AdventurerStoreState) => {\n        if (element.id === fromAdventurerId) {\n          // Clear out the item from this adventurer\n          const inventory = element.inventory.concat();\n          inventory[fromSlot] = null;\n          return {\n            ...element,\n            inventory,\n          };\n        } else if (element.id === toAdventurerId) {\n          // Find first empty slot, add there\n          const inventory = element.inventory.concat();\n          const index = inventory.findIndex((slot) => slot === null);\n          inventory[index] = item;\n          // todo: what if there is no room?\n          return {\n            ...element,\n            inventory,\n          };\n        }\n        return element;\n      });\n    }\n\n    case \"addItemToInventory\": {\n      const { item } = action;\n      let { toSlot } = action;\n\n      return state.map((element: AdventurerStoreState) => {\n        if (element.id === action.adventurerId) {\n          const inventory = element.inventory.concat();\n          if (toSlot === null || toSlot === undefined) {\n            toSlot = inventory.findIndex((val) => (val === null || val === undefined));\n          }\n          inventory[toSlot] = item;\n          // todo: check if no space\n          return {\n            ...element,\n            inventory,\n          };\n        }\n        return element;\n      });\n    }\n\n    case \"removeItemFromInventory\": {\n      const { fromSlot } = action;\n\n      return state.map((adventurer: AdventurerStoreState) => {\n        if (adventurer.id === action.adventurerId) {\n          const inventory = adventurer.inventory.map((element, index) => index !== fromSlot ? element : null);\n          return {\n            ...adventurer,\n            inventory,\n          };\n        }\n        return adventurer;\n      });\n    }\n\n\n    case \"changeItemQuantity\": {\n      // Change quantity of an item in invntory\n      const { slot, quantity } = action;\n\n      return state.map((adventurer: AdventurerStoreState) => {\n        if (adventurer.id === action.adventurerId) {\n          const inventory = adventurer.inventory.map((item, index) => index !== slot ? item : ({\n            ...item,\n            quantity\n          }) as Item);\n          return {\n            ...adventurer,\n            inventory,\n          };\n        }\n        return adventurer;\n      });\n    }\n\n    case \"assignEquipment\": {\n      // Assigns equipment to an adventurer\n      const { equipmentSlot, item, } = action;\n      return state.map((adventurer: AdventurerStoreState) => {\n        if (adventurer.id === action.adventurerId) {\n          return {\n            ...adventurer,\n            equipment: {\n              ...adventurer.equipment,\n              [equipmentSlot]: item,\n            },\n          };\n        }\n        return adventurer;\n      });\n    }\n\n    case \"removeEquipment\": {\n      // Assigns equipment to an adventurer\n      const { equipmentSlot } = action;\n\n      return state.map((adventurer: AdventurerStoreState) => {\n        if (adventurer.id === action.adventurerId) {\n          return {\n            ...adventurer,\n            equipment: {\n              ...adventurer.equipment,\n              [equipmentSlot]: null,\n            },\n          };\n        }\n        return adventurer;\n      });\n    }\n\n    case \"changeEquipmentQuantity\": {\n      // Change quantity of an item equipped\n      const { equipmentSlot, quantity } = action;\n\n      return state.map((adventurer: AdventurerStoreState) => {\n        if (adventurer.id === action.adventurerId) {\n          return {\n            ...adventurer,\n            equipment: {\n              ...adventurer.equipment,\n              [equipmentSlot]: {\n                ...adventurer.equipment[equipmentSlot],\n                quantity\n              },\n            },\n          };\n        }\n        return adventurer;\n      });\n    }\n\n    case \"addTempEffect\": {\n      // adds an effect\n      return state.map((adventurer: AdventurerStoreState) => {\n        if (adventurer.id === action.adventurerId) {\n          return {\n            ...adventurer,\n            tempEffects: [\n              action.tempEffect,\n              ...adventurer.tempEffects,\n            ]\n          };\n        }\n        return adventurer;\n      });\n    }\n\n    case \"decreaseEffectCharge\": {\n      // decreases charges of given effect by 1\n      return state.map((adventurer: AdventurerStoreState) => {\n        if (adventurer.id === action.adventurerId) {\n          return {\n            ...adventurer,\n            tempEffects: adventurer.tempEffects.map((tE) => ({\n              ...tE,\n              effects: tE.effects.reduce<Effect[]>((acc, value) => {\n                if (value === action.effect) {\n                  // if charges is < 2 remove from list\n                  if (value.charges && value.charges > 1) {\n                    const charges = value.charges - 1;\n                    acc.push({\n                      ...value,\n                      charges,\n                    });\n                  }\n                }\n                else {\n                  acc.push(value);\n                }\n                return acc;\n              }, [])\n            }))\n          }\n        }\n        return adventurer;\n      });\n    }\n\n    case \"renameAdventurer\": {\n      // Rename adventurer\n      const { name } = action;\n      return state.map((adventurer: AdventurerStoreState) => {\n        if (adventurer.id === action.adventurerId) {\n          return {\n            ...adventurer,\n            name\n          };\n        }\n        return adventurer;\n      });\n    }\n\n    case \"setBasicAttributes\": {\n      // Used for debugging only, update BA of an adventurer\n      const { basicAttributes } = action;\n      return state.map((adventurer: AdventurerStoreState) => {\n        if (adventurer.id === action.adventurerId) {\n          return {\n            ...adventurer,\n            basicAttributes\n          };\n        }\n        return adventurer;\n      });\n    }\n\n    case \"addXp\": {\n      // Adds xp\n      const { xp } = action;\n      return state.map((adventurer: AdventurerStoreState) => {\n        if (adventurer.id === action.adventurerId) {\n          return {\n            ...adventurer,\n            xp: Math.min(adventurer.xp + xp, MAX_XP)\n          };\n        }\n        return adventurer;\n      });\n    }\n\n  }\n  return state\n  // debug: this will auto-increase the levels of every adventurer at every tick\n  // return state.map((adventurer: AdventurerStoreState) => {\n  //   return {\n  //     ...adventurer,\n  //     xp: adventurer.xp + 1\n  //   };\n  // });\n};\n","import { Reducer } from \"redux\";\nimport { EngineStoreState } from \"store/types/engine\";\nimport { HARVEST_INTERVAL } from \"mechanics/gameTick/harvest\";\nimport { GameAction } from \"store/actions/game\";\n\n/**\n * reducer\n * @param state\n * @param action\n */\nexport const engine: Reducer<EngineStoreState, GameAction> = (state = getInitialEngineState(), action) => {\n  switch (action.type) {\n    case \"startGame\": {\n      return {\n        ...state,\n        gameStarted: Date.now()\n      };\n    }\n    case \"gameTick\": {\n\n      // Keep track of the last time resources were produced\n      const resourcesToAdd = action.resources;\n      const lastProducedUpdate = resourcesToAdd === null ? state.lastProducedUpdate : Date.now();\n\n      // Keep track of last harvest\n      const lastHarvest = action.harvest === null || !Object.keys(action.harvest).length ? state.lastHarvest : Date.now();\n\n      const previousTick = state.lastTick;\n\n      return {\n        ...state,\n        previousTick,\n        lastProducedUpdate,\n        lastTick: Date.now(),\n        lastHarvest\n      };\n    }\n\n    case \"reduceTime\": {\n      if (action.percentage < 0 || action.percentage > 100) return state;\n      switch (action.time) {\n        case \"harvest\": {\n          const timeLeft = HARVEST_INTERVAL - (Date.now() - state.lastHarvest);\n\n          const delta = timeLeft * (action.percentage / 100);\n          return {\n            ...state,\n            lastHarvest: state.lastHarvest - delta\n          }\n        }\n      }\n      return state;\n    }\n  }\n  return state;\n};\n\nexport const getInitialEngineState = () => {\n  return {\n    gameStarted: undefined,\n    previousTick: Date.now(),\n    lastTick: Date.now(),\n    lastProducedUpdate: Date.now(),\n    lastHarvest: Date.now()\n  }\n};\n","import { Reducer } from \"redux\";\nimport { GameAction } from \"store/actions/game\";\nimport { GameStoreState } from \"store/types/game\";\nimport * as Version from \"constants/version\";\n\nconst initial: GameStoreState = {\n  version: Version.asInt\n}\n/**\n * reducer\n * @param state\n * @param action\n */\nexport const game: Reducer<GameStoreState, GameAction> = (state = initial, action) => {\n  switch (action.type) {\n    // when user dismisses the warning about version incompatibility\n    case \"ignoreVersionDiff\": {\n      return {\n        ...state,\n        ignoreVersionDiff: Version.asInt\n      }\n    }\n  }\n  return state;\n};\n","import { GoldAction } from \"store/actions/gold\";\nimport { Reducer } from \"redux\";\n\n/**\n * reducer\n * @param state\n * @param action\n */\nexport const gold: Reducer<number, GoldAction> = (state = initialGoldState, action) => {\n  switch (action.type) {\n    case \"addGold\":\n      // Adds (or subtract, if negative) gold from the players gold supply\n      return state + action.amount;\n  }\n  return state;\n};\n\nexport const initialGoldState = 40;\n","\nimport { StockpileAction } from \"store/actions/stockpile\";\nimport { Reducer } from \"redux\";\nimport { ItemType, ItemCategory, Item } from \"definitions/items/types\";\nimport allItems, { canStackItem, getAllItemsByCategory } from \"definitions/items\";\nimport { StockpileStoreState } from \"store/types/stockpile\";\nimport { getDefinition } from \"definitions/structures\";\nimport { getDefinition as getItemDefinition } from \"definitions/items\";\nimport { WarehouseStructureDefinition } from \"definitions/structures/types\";\n\n// Items in warehouse\nexport const getInitialStockpile = (): StockpileStoreState => {\n  // Generate some random stuff\n  const result: StockpileStoreState = {\n    \"ammunition\": [],\n    \"apparel\": [],\n    \"deed\": [],\n    \"herb\": [],\n    \"material\": [],\n    \"mineral\": [],\n    \"consumable\": [],\n    \"questItem\": [],\n    \"trinket\": [],\n    \"weapon\": [],\n  };\n\n  const { maxStockpile } = getDefinition<WarehouseStructureDefinition>(\"warehouse\").levels[0];\n  Object.keys(result).forEach((itemCategoryName: string) => {\n    const itemCategory = ItemCategory[itemCategoryName as keyof typeof ItemCategory];\n    for (let i = 0; i < maxStockpile; i++) {\n      if (Math.random() < .5) {\n        result[itemCategoryName as keyof typeof result].push(null)\n      } else {\n        const randomItem: Item = { type: getRandomItemTypeByCategory(itemCategory) };\n        if (canStackItem(itemCategory)){\n          randomItem.quantity = Math.floor(Math.random() * 100);\n        }\n        const category = result[itemCategoryName as keyof typeof result] as Item[];\n        category.push(randomItem);\n      }\n    }\n  })\n  return result;\n}\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nconst getRandomItem = (): ItemType => {\n  const all = Object.keys(allItems)\n  const randomIndex = Math.floor(Math.random() * all.length);\n  return all[randomIndex] as ItemType;\n}\n\nconst getRandomItemTypeByCategory = (itemCategory: ItemCategory): ItemType => {\n  const all = getAllItemsByCategory(itemCategory)\n  const randomIndex = Math.floor(Math.random() * all.length);\n  return all[randomIndex] as ItemType;\n}\n\n/**\n * reducer\n * @param state\n * @param action\n */\nexport const stockpile: Reducer<StockpileStoreState, StockpileAction> = (state = getInitialStockpile(), action) => {\n  switch (action.type) {\n    case \"addItem\": {\n      const definition = getItemDefinition(action.item.type)\n      // toSlot is optional\n      const { item } = action;\n      let { toSlot } = (action);\n      const stockpileCategory = ItemCategory[definition.itemCategory] as keyof StockpileStoreState\n\n      if (toSlot === undefined) {\n        toSlot = state[stockpileCategory].findIndex((slot) => slot === null);  // find first empty element\n        if (toSlot === -1) {\n          // Still not found. Add at end\n          // todo: [07/07/2019] GAME DESIGN\n          return {\n            ...state,\n            [stockpileCategory]: [\n              ...state[stockpileCategory],\n              item\n            ]\n          };\n        }\n      }\n      return {\n        ...state,\n        [stockpileCategory]: state[stockpileCategory].map((element, index) => index === toSlot ? item : element)\n      };\n    }\n\n    case \"moveItemInWarehouse\": {\n      const {\n        itemCategory,\n        fromSlot,\n        toSlot,\n      } = action;\n      const stockpileCategory = ItemCategory[itemCategory] as keyof StockpileStoreState\n\n      return {\n        ...state,\n        [stockpileCategory]: state[stockpileCategory].map((element, index) => {\n          if (index === fromSlot) { return state[stockpileCategory][toSlot]; }\n          if (index === toSlot) { return state[stockpileCategory][fromSlot]; }\n          return element;\n        })\n      };\n    }\n    case \"removeItem\": {\n      const { itemCategory, fromSlot } = action;\n      const stockpileCategory = ItemCategory[itemCategory] as keyof StockpileStoreState\n\n        return {\n        ...state,\n        [stockpileCategory]: state[stockpileCategory].map((element, index) => index !== fromSlot ? element : null)\n      };\n    }\n\n    // // Adds slots with 'null' to the end\n    // case ActionType.addStockpileSlots: {\n    //   const {\n    //     slots,\n    //   } = (action as AddStockpileSlotsAction);\n\n    //   return [\n    //     ...state,\n    //     ...Array(slots).fill(null)\n    //   ];\n    // }\n  }\n\n  return state;\n};\n","import { GameAction } from \"store/actions/game\";\nimport {  LogAction } from \"store/actions/log\";\nimport { LogUpdate } from \"mechanics/gameTick/quests\";\nimport { Reducer } from \"redux\";\nimport { LogEntry } from \"store/types/logEntry\";\n\n/**\n * reducer\n * @param state\n * @param action\n */\nexport const log: Reducer<LogEntry[]> = (state: LogEntry[] = initialLogState, action: GameAction | LogAction) => {\n  switch (action.type) {\n    case \"addLogEntry\": {\n      const {entry, channel, channelContext} = action;\n      const {key, context} = entry;\n      const time = Date.now();\n      return [{\n          channel,\n          channelContext,\n          context,\n          key,\n          time,\n        },\n        ...state,\n      ];\n    }\n    case \"gameTick\": {\n      if (!action.log.length) {\n        return state;\n      }\n\n      // Add log entries\n      const logEntries = action.log.map((lU: LogUpdate): LogEntry => {\n        return {\n          ...lU,\n          time: Date.now(),\n        };\n      });\n      return [\n        ...logEntries,\n        ...state,\n      ];\n    }\n  }\n  return state;\n};\n\nexport const initialLogState = [];\n","import { Reducer } from \"redux\";\nimport { QuestStatus, QuestStoreState } from \"store/types/quest\";\nimport { Allegiance, isActorObject, isAdventurer, isEnemy, SceneActionType } from 'store/types/scene';\nimport { QuestDefinition } from 'definitions/quests/types';\nimport { getDefinition } from 'definitions/quests';\nimport { initialQuestVars } from 'definitions/quests/kill10Boars/questVars';\nimport deepmerge from \"deepmerge\";\nimport { Action } from \"store/actions\";\nimport { calculateInitialAP, ENEMY_BASE_AP } from \"mechanics/combat\";\nimport { xpToLevel } from \"mechanics/adventurers/levels\";\n\nexport const initialQuestState: QuestStoreState[] = [{\n  name: \"kill10Boars\",\n  status: QuestStatus.active,\n  party: [\n    \"c4a5d270\",\n    \"2e655832\",\n    \"ec6f1050\",\n    \"d299f98a\",\n  ],\n  progress: 0,\n  questVars: initialQuestVars,\n  encounterResults: [],\n  icon: \"sigil1.png\",\n// }, {\n//   name: \"retrieveMagicAmulet\",\n//   party: [],\n//   status: QuestStatus.available,\n//   progress: 0,\n//   questVars: {},\n//   encounterResults: [],\n//   icon: \"sigil2.png\",\n//   reward: {\n//     gold: 4,\n//     items: [ Item.deedForWeaponsmith ],\n//   },\n}];\n\n/**\n * reducer\n * @param state\n * @param action\n */\nexport const quests: Reducer<QuestStoreState[]> = (state: QuestStoreState[] = initialQuestState, action: Action): QuestStoreState[] => {\n  switch (action.type) {\n    // Launches quest. Sets state to active, assigns adventurers\n    case \"launchQuest\": {\n      const party = action.assignedAventurers\n        .filter((adventurer) => !!adventurer)\n        .map((adventurer) => adventurer.id);\n\n      return state.map((qss) => {\n        if (qss.name === action.questName) {\n          const questDefinition: QuestDefinition = getDefinition(action.questName);\n          const questVars = questDefinition.getInitialQuestVars(qss);\n\n          return {\n            ...qss,\n            status: QuestStatus.active,\n            party,\n            questVars\n          };\n        }\n        return qss;\n      });\n    }\n\n    case \"exitEncounter\": {\n      return state.map((qss) => {\n        if (qss.name === action.questName) {\n          const progress = qss.progress + 1;\n          // const questDefinition: QuestDefinition = questDefinitions[qss.name];\n          // const nextNode = questDefinition.nodes[Math.floor(progress)];\n\n          return {\n            ...qss,\n            progress,\n            scene: undefined,\n            sceneName: undefined\n          };\n        }\n        return qss;\n      });\n    }\n\n    // Updates the questvars\n    case \"updateQuestVars\": {\n      return state.map((qss) => {\n        if (qss.name === action.questName) {\n          return {\n            ...qss,\n            // todo: sort this out\n            // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n            // @ts-ignore\n            questVars: deepmerge(qss.questVars, action.vars, { arrayMerge: overwriteMerge })\n          };\n        }\n        return qss;\n      });\n    }\n\n    // case \"updateEncounterResult\":\n    //   return updateEncounterResult(state, action as UpdateEncounterResultAction);\n\n    // case \"startEncounter\":\n    //   return startEncounter(state, action as StartEncounterAction);\n\n    // To change scene, set scene name. The scenecontroller will load the scene data and art assets\n    // and call setScene reducer\n    case \"setSceneName\": {\n      return state.map((qss) => {\n        if (qss.name === action.questName) {\n          return {\n            ...qss,\n            sceneName: action.sceneName,\n            sceneNamePrev: qss.sceneName,\n            scene: undefined\n          };\n        }\n        return qss;\n      });\n    }\n\n    case \"setScene\": {\n      return state.map((qss) => {\n        if (qss.name === action.questName) {\n          return {\n            ...qss,\n            scene: action.scene\n          };\n        }\n        return qss;\n      });\n    }\n\n    // Enqueues a scene action on this quest\n    case \"enqueueSceneAction\": {\n      return state.map((qss) => {\n        if (qss.name === action.questName) {\n          const scene = qss.scene;\n          if (!scene) throw new Error(\"Something broke. No scene\");\n          scene.actionQueue = [\n            ...scene.actionQueue ?? [],\n            action.sceneAction\n          ];\n\n          return {\n            ...qss,\n            scene\n          };\n        }\n        return qss;\n      });\n    }\n\n    // next action on scene is completed\n    case \"completeSceneAction\": {\n      return state.map((qss) => {\n        if (qss.name === action.questName) {\n          const scene = qss.scene;\n          if (!scene || !scene.actionQueue) throw new Error(\"Something broke. No scene\");\n          const sceneAction = scene.actionQueue[0];\n          if (!sceneAction) return qss;\n\n          switch (sceneAction.actionType) {\n            case SceneActionType.move: {\n              scene.objects = scene.objects.map((a) => {\n                if (isActorObject(a) && a.name === sceneAction.actorId) {\n                  return {\n                    ...a,\n                    location: sceneAction.target\n                  };\n                }\n                return a;\n              })\n            }\n          }\n\n          // pop first action of the stack\n          scene.actionQueue = scene.actionQueue.filter((_, i) => i > 0);\n\n          return {\n            ...qss,\n            scene\n          };\n        }\n        return qss;\n      });\n    }\n\n    case \"setCombat\": {\n      const { combat } = action;\n      return state.map((qss) => {\n        if (qss.name === action.questName && qss.scene) {\n          const scene = {\n            ...qss.scene,\n            combat,\n            turn: combat ? Allegiance.player : undefined,\n          };\n          return {\n            ...qss,\n            scene\n          };\n        }\n        return qss;\n      });\n    }\n\n    case \"endPlayerTurn\": {\n      return state.map((qss) => {\n        if (qss.name === action.questName) {\n          const scene = qss.scene;\n          if (!scene) throw new Error(\"Something broke. No scene\");\n\n          scene.objects = scene.objects.map(o => {\n            if (isActorObject(o)) {\n              const ap = 0;\n              return {\n                ...o,\n                ap\n              };\n            }\n            return o;\n          })\n\n          return {\n            ...qss,\n            scene\n          };\n        }\n        return qss;\n      });\n    }\n\n    case \"startTurn\": {\n      // Starts a combat turn, either for Player or Enemy\n      return state.map((qss) => {\n        if (qss.name === action.questName) {\n          if (!qss.scene) throw new Error(\"Something broke. No scene\");\n          const { turn } = action;\n          const scene = qss.scene;\n\n          if (turn === Allegiance.player) {\n            scene.objects = scene.objects.map(o => {\n              if (isAdventurer(o)) {\n                const adventurerInStore = action.adventurers?.find(a => a.id === o.name)\n                if (adventurerInStore){\n                  const level = xpToLevel(adventurerInStore.xp);\n                  const ap = calculateInitialAP(adventurerInStore.basicAttributes, level);\n                  return {\n                    ...o,\n                    ap\n                  };\n                }\n                return o;\n              }\n              return o;\n            })\n          } else if (turn === Allegiance.enemy) {\n            scene.objects = scene.objects.map(o => {\n              if (isEnemy(o)) {\n                const ap = ENEMY_BASE_AP;\n                return {\n                  ...o,\n                  ap\n                };\n              }\n              return o;\n            })\n          }\n\n          return {\n            ...qss,\n            scene: {\n              ...scene,\n              turn\n            }\n          };\n        }\n        return qss;\n      });\n    }\n\n    case \"setActorAp\": {\n      return state.map((qss) => {\n        if (qss.name === action.questName) {\n          const scene = qss.scene;\n          if (!scene) throw new Error(\"Something broke. No scene\");\n\n          scene.objects = scene.objects.map(o => {\n            if (isActorObject(o) && o.name === action.actor) {\n              const ap = action.ap;\n              return {\n                ...o,\n                ap\n              };\n            }\n            return o;\n          })\n\n          return {\n            ...qss,\n            scene\n          };\n        }\n        return qss;\n      });\n    }\n\n    case \"deductActorAp\": {\n      return state.map((qss) => {\n        if (qss.name === action.questName) {\n          const scene = qss.scene;\n          if (!scene) throw new Error(\"Something broke. No scene\");\n\n          scene.objects = scene.objects.map(o => {\n            if (isActorObject(o) && o.name === action.actor) {\n              const ap = o.ap - action.ap;\n              return {\n                ...o,\n                ap\n              };\n            }\n            return o;\n          })\n\n          return {\n            ...qss,\n            scene\n          };\n        }\n        return qss;\n      });\n    }\n\n    // case \"updateSceneObjectAction\": {\n    //   return state.map((qss) => {\n    //     if (qss.name === action.questName) {\n    //       const scene = qss.scene;\n    //       if (!scene) throw new Error(\"Something broke. No scene\");\n\n    //       scene.objects = scene.objects.map(tO => {\n    //         if (tO.id === action.id) {\n    //           return {\n    //             ...tO,\n    //             ...action.object\n    //           }\n    //         }\n    //         return tO;\n    //       })\n\n    //       return {\n    //         ...qss,\n    //         scene\n    //       };\n    //     }\n    //     return qss;\n    //   });\n    // }\n\n    case \"setActiveSceneInteractionModal\": {\n      return state.map((qss: QuestStoreState) => {\n        if (qss.name === action.questName && qss.scene) {\n          qss.scene.activeInteractionModal = action.sceneInteractionModal\n        }\n        return qss;\n      });\n    }\n\n    case \"gameTick\": {\n      const questsToUpdate = action.quests;\n      if (!questsToUpdate.length) {\n        return state;\n      }\n\n      return state.map((qss) => {\n        const questToUpdate = questsToUpdate.find((q) => q.name === qss.name);\n        if (questToUpdate) {\n          const progress = questToUpdate.progress;\n          // const currentEncounter = questToUpdate.currentEncounter;\n\n          return {\n            ...qss,\n            progress,\n            // currentEncounter,\n          };\n        }\n        return qss;\n      });\n    }\n  }\n  return state;\n};\n\nconst overwriteMerge = (_: [], sourceArray: []) => sourceArray\n\n","import { Reducer } from \"redux\";\nimport { ResourceStoreState } from \"store/types/resources\";\nimport { Resource } from \"definitions/resources\";\nimport { ResourcesAction } from \"store/actions/resources\";\nimport { GameAction } from \"store/actions/game\";\n\nexport const resources: Reducer<ResourceStoreState, ResourcesAction | GameAction> = (state = initialResourcesState, action) => {\n\n  const addResources = (resourcesToAdd: ResourceStoreState) => {\n    // todo: Check if warehouse can hold it\n    return Object.keys(state).reduce<ResourceStoreState>((acc, value) => {\n      const resource = value as Resource;\n      acc[resource] = (state[resource] ?? 0) + (resourcesToAdd[resource] || 0);\n      return acc;\n    }, {});\n  };\n\n  switch (action.type) {\n    case \"addResources\": {\n      const resourcesToAdd = action.resources;\n      return addResources(resourcesToAdd);\n    }\n    case \"removeResources\": {\n      const resourcesToRemove = action.resources;\n      return Object.keys(state).reduce<ResourceStoreState>((acc, value) => {\n        const resource = value as Resource;\n        acc[resource] = (state[resource] ?? 0) - (resourcesToRemove[resource] || 0);\n        return acc;\n      }, {});\n    }\n\n    case \"gameTick\": {\n      const resourcesToAdd = action.resources;\n      if (resourcesToAdd === null) {\n        return state;\n      }\n      return addResources(resourcesToAdd);\n    }\n  }\n  return state;\n};\n\nexport const initialResourcesState: ResourceStoreState = {\n  fabric: 0,\n  food: 0,\n  iron: 10,\n  leather: 0,\n  stone: 0,\n  wood: 10,\n};\n","import { Reducer } from \"redux\";\nimport { State as seedrandomStateType } from \"seedrandom\";\nimport { GameAction } from \"store/actions/game\";\n\nexport const initialRngState = {};\n/**\n * reducer\n * @param state\n * @param action\n */\nexport const rngState: Reducer<seedrandomStateType, GameAction> = (state = initialRngState, action) => {\n  if (action.type === \"gameTick\" && action.rngState != null) {\n    state = Object.assign({}, action.rngState);\n  }\n  return state;\n};\n","import { Reducer } from \"redux\";\nimport { SettingsAction } from \"store/actions/settings\";\nimport { SettingsState } from \"store/types/settings\";\n\n/**\n * reducer\n * @param state\n * @param action\n */\nexport const settings: Reducer<SettingsState, SettingsAction> = (state = initialSettingsState, action) => {\n  switch (action.type) {\n    case \"setSetting\": {\n      return {\n        ...state,\n        [action.setting]: action.value\n      }\n    }\n  }\n  return state;\n};\n\nexport const initialSettingsState: SettingsState = {\n  verboseCombatLog: false,\n  debugAllowAdventurerEdit: false,\n  debugSceneShowPathable: false,\n  debugSceneShowActionQueue: false,\n};\n","import { Reducer } from \"redux\";\nimport { isProductionStructure, isResourceStructure, ResourceStructure, Structure } from \"definitions/structures\";\nimport { ProductionStructureStoreState, StructureState, StructureStoreState } from \"store/types/structure\";\nimport { StructuresStoreState } from \"store/types/structures\";\nimport { StructuresAction } from \"store/actions/structures\";\nimport { GameAction } from \"store/actions/game\";\nimport { Item } from \"definitions/items/types\";\n\n/**\n * reducer\n * @param state\n * @param action\n */\nexport const structures: Reducer<StructuresStoreState, StructuresAction | GameAction> = (state = initialStructuresState, action) => {\n  switch (action.type) {\n    case \"startBuildingStructure\": {\n      return updateStructureState(state, action.structure, StructureState.Building);\n    }\n\n    case \"finishBuildingStructure\": {\n      return updateStructureState(state, action.structure, StructureState.Built);\n    }\n\n    case \"upgradeStructure\": {\n      // Upgrade to next level\n      const level = state[action.structure].level + 1;\n      const structureStore: StructureStoreState = {\n        ...state[action.structure],\n        level,\n      };\n      return {\n        ...state,\n        [action.structure]: structureStore,\n      };\n    }\n\n    case \"increaseWorkers\": {\n      const { workers: workersToAdd } = action;\n      const workers = state[action.structure].workers + workersToAdd;\n      const structureStore: StructureStoreState = {\n        ...state[action.structure],\n        workers,\n      };\n      return {\n        ...state,\n        [action.structure]: structureStore,\n      };\n    }\n\n    case \"decreaseWorkers\": {\n      const { workers: workersToRemove } = action;\n      const workers = state[action.structure].workers - workersToRemove;\n      const structureStore: StructureStoreState = {\n        ...state[action.structure],\n        workers,\n      };\n      return {\n        ...state,\n        [action.structure]: structureStore,\n      };\n    }\n\n    case \"setStructureState\": {\n      const { state: structureState } = action;\n      return updateStructureState(state, action.structure, structureState);\n    }\n\n    case \"addItemToToProduces\": {\n      // Adds given item to a structures' `produces` list\n      if (!isProductionStructure(action.structure)){\n        return state;\n      }\n      const { item } = action;\n      const produces = [\n        ...(state[action.structure] as ProductionStructureStoreState).produces,\n        item\n      ];\n      const structureStore: ProductionStructureStoreState = {\n        ...state[action.structure],\n        produces,\n      };\n      return {\n        ...state,\n        [action.structure]: structureStore,\n      };\n    }\n\n    case \"removeItemFromHarvest\": {\n      // Should always be false but typescript doesnt know that\n      if (!isResourceStructure(action.structure)) return state;\n      const harvest = state[action.structure].harvest?.filter((h, i) => (i !== action.index));\n      return {\n        ...state,\n        [action.structure]: {\n          ...state[action.structure],\n          harvest\n        }\n      }\n    }\n\n    case \"gameTick\": {\n      if (!action.harvest || !Object.keys(action.harvest)?.length) {\n        return state;\n      }\n      // Copies harvest from harvest into structure\n      return Object.keys(state).reduce<StructuresStoreState>((acc, structureAsString) => {\n        const structure = structureAsString as Structure;\n        if (isResourceStructure(structure) && action.harvest?.[structure]?.length){\n          const harvest: Item[] = (action.harvest[structure] ?? []).map(type => ({ type }))\n          acc[structure as ResourceStructure].harvest = [\n            ...(acc[structure as ResourceStructure].harvest ?? []),\n            ...harvest\n          ]\n        }\n        return acc;\n      }, state);\n    }\n  }\n  return state;\n};\n\nconst updateStructureState = (state: StructuresStoreState, structure: Structure, structureState: StructureState) => {\n  const structureStore: StructureStoreState = {\n    ...state[structure],\n    state: structureState,\n  };\n  return {\n    ...state,\n    [structure]: structureStore,\n  };\n};\n\nconst structureInitialState: StructureStoreState = {\n  level: 0,\n  state: StructureState.NotBuilt,\n  workers: 0,\n};\n\nexport const initialStructuresState: StructuresStoreState = {\n  alchemist: { ...structureInitialState, produces: [ ] },\n  armoursmith: { ...structureInitialState, produces: [ \"apparel/boots1\" ] },\n  garden: { level: 0, workers: 0, state: StructureState.Built  }, // TODO: change back to NotBuilt\n  lumberMill: structureInitialState,\n  mine: { level: 0, workers: 0, state: StructureState.NotBuilt  },\n  quarry: structureInitialState,\n  tavern: { level: 2, workers: 0, state: StructureState.Built },\n  tannery: structureInitialState,\n  warehouse: { level: 0, workers: 0, state: StructureState.Built},\n  weaponsmith:  { ...structureInitialState, produces: [ \"weapon/simpleCrossbow\", \"weapon/dagger\" ] },\n  weaver: structureInitialState,\n  workshop: { ...structureInitialState, produces: [ \"questItem/torch\", \"questItem/sandwich\" ] },\n};\n","\nimport { TaskAction } from \"store/actions/tasks\";\nimport { Reducer } from \"redux\";\nimport { TaskStoreState } from \"store/types/task\";\nimport { TasksStoreState } from \"store/types/tasks\";\nimport { GameAction } from \"store/actions/game\";\n\n/**\n * Tasks reducer\n * @param state\n * @param action\n */\nexport const tasks: Reducer<TasksStoreState, TaskAction | GameAction> = (state: TasksStoreState = initialTasksState, action) => {\n  switch (action.type) {\n    case \"start\": {\n    // Adds a new task to the running tasks\n      const task: TaskStoreState = createTask(action);\n      const running = state.running.concat(task);\n      return {\n        ...state,\n        running,\n      };\n    }\n    case \"gameTick\": {\n      // Will update all tasks in `running`. If a running task expires it is placed in `complete`\n      // Note that completed tasks must be handled BEFORE the next call to ActionType.update, because\n      // this list is recreated every time\n      const now: number = Date.now();\n      const running: TaskStoreState[] = [];\n      const completed: TaskStoreState[] = [];\n      state.running.forEach((t) => {\n        const end = now + t.timeRemaining;\n        const progress = (now - t.startTime) / (end - t.startTime);\n        const timeRemaining = t.timeRemaining - (now - t.lastTick);\n        const task = {\n          ...t,\n          progress,\n          lastTick: now,\n          timeRemaining,\n        };\n        if (timeRemaining < 0) {\n          completed.push(task);\n        } else {\n          running.push(task);\n        }\n      });\n\n      return {\n        running,\n        completed,\n      };\n    }\n    case \"reduceTime\": {\n      if (action.percentage < 0 || action.percentage > 100) return state;\n      if (action.time === \"task\") {\n        const running: TaskStoreState[] = [];\n        state.running.forEach((t) => {\n          const timeRemaining = t.timeRemaining / 100 * action.percentage;\n          if (t.name === action.what) {\n            const task = {\n              ...t,\n              timeRemaining,\n            };\n            running.push(task);\n          } else {\n            running.push(t);\n          }\n        });\n        return {\n          ...state,\n          running,\n        };\n      }\n      return state;\n    }\n  }\n  return state;\n};\n\nconst createTask = (action: TaskAction): TaskStoreState => {\n  return {\n    name: action.name,\n    origin: action.origin,\n    type: action.taskType,\n    callbacks: action.callbacks,\n    timeRemaining: action.time,\n    startTime: Date.now(),\n    lastTick: Date.now(),\n    progress: 0,\n  };\n};\n\nexport const initialTasksState: TasksStoreState = {\n  completed: [],\n  running: [],\n};\n","import { Reducer } from \"redux\";\nimport { WorkersAction } from \"store/actions/workers\";\n\n/**\n * reducer\n * @param state\n * @param action\n */\nexport const workers: Reducer<number, WorkersAction> = (state = initialWorkersState, action) => {\n  switch (action.type) {\n    case \"addWorkers\":\n      // Adds (or subtract, if negative) from the players workers\n      return state + action.value;\n  }\n  return state;\n};\n\nexport const initialWorkersState = 13;\n","import { combineReducers } from \"redux\";\nimport { StoreState } from \"store/types\"\nimport { adventurers, initialAdventurers } from \"./adventurers\";\nimport { engine, getInitialEngineState } from \"./engine\";\nimport { game } from \"./game\";\nimport { gold, initialGoldState } from \"./gold\";\nimport { getInitialStockpile, stockpile } from \"./stockpile\";\nimport { initialLogState, log } from \"./log\";\nimport { initialQuestState, quests } from \"./quests\";\nimport { initialResourcesState, resources } from \"./resources\";\nimport { initialRngState, rngState } from \"./rngState\";\nimport { initialSettingsState, settings } from \"./settings\";\nimport { initialStructuresState, structures } from \"./structures\";\nimport { initialTasksState, tasks } from \"./tasks\";\nimport { initialWorkersState, workers } from \"./workers\";\n\nexport default combineReducers<StoreState>({\n  adventurers,\n  engine,\n  game,\n  gold,\n  stockpile,\n  log,\n  quests,\n  resources,\n  rngState,\n  settings,\n  structures,\n  tasks,\n  workers,\n});\n\nexport const createInitialStore = () => ({\n  adventurers: initialAdventurers,\n  engine: getInitialEngineState(),\n  gold: initialGoldState,\n  stockpile: getInitialStockpile(),\n  log: initialLogState,\n  quests: initialQuestState,\n  resources: initialResourcesState,\n  rngState: initialRngState,\n  settings: initialSettingsState,\n  structures: initialStructuresState,\n  tasks: initialTasksState,\n  workers: initialWorkersState\n})\n","import { collectEffects } from 'definitions/effects'\nimport { Effect, EffectType } from 'definitions/effects/types'\nimport { getDefinition, isConsumable } from 'definitions/items/consumables'\nimport { createTempEffect } from 'definitions/tempEffects'\nimport { TempEffectSoma, TempEffectType } from 'definitions/tempEffects/types'\nimport { Middleware } from 'redux'\nimport { Action } from 'store/actions'\nimport { addTempEffect, decreaseEffectCharge, modifyHealth } from 'store/actions/adventurers'\nimport { StoreState } from 'store/types'\nimport { SceneActionType } from 'store/types/scene'\nimport { lastAdventurerAction, AppMiddlewareAPI } from './utils'\n\nexport const effectsMiddleware: Middleware<\n  unknown, // Most middleware do not modify the dispatch return value\n  StoreState\n> = (storeApi: AppMiddlewareAPI) => next => (action: Action) => {\n  const state = storeApi.getState()\n\n  for (const adventurer of state.adventurers) {\n    const lastAction = lastAdventurerAction(adventurer, action, storeApi);\n    const effects = collectEffects(adventurer);\n    effects.forEach(effect => {\n      switch (effect.type) {\n        case EffectType.healthDecreaseOnMove: {\n          // Broken legs effect reduces health at every move\n          if (lastAction === SceneActionType.move) {\n            storeApi.dispatch(modifyHealth(adventurer.id, -5));\n\n            effectTick(storeApi, effect, adventurer.id);\n          }\n        }\n      }\n    })\n  }\n\n  switch (action.type) {\n    case \"consumeItem\": {\n      // Apply effect after consuming item\n      const { adventurerId, fromSlot } = action;\n      const adventurer = state.adventurers.find((a) => a.id === adventurerId);\n      if (!adventurer) {\n        throw new Error(`No adventurer ${adventurerId} found`)\n      }\n      const consumable = adventurer.inventory[fromSlot];\n      if (!consumable || !isConsumable(consumable.type)) {\n        throw new Error(`No potion found at index ${fromSlot} `)\n      }\n      const definition = getDefinition(consumable.type);\n      switch (definition.category) {\n        case \"soma\": {\n          const tempEffect = createTempEffect<TempEffectSoma>({\n            type: TempEffectType.soma,\n            factor: definition.effect ?? 1\n          });\n          storeApi.dispatch(addTempEffect(adventurerId, tempEffect));\n        }\n      }\n    }\n  }\n\n  next(action);\n}\n\nconst effectTick = (storeApi: AppMiddlewareAPI, effect: Effect, adventurerId: string) => {\n  if (effect.charges) {\n    storeApi.dispatch(decreaseEffectCharge(adventurerId, effect))\n  }\n}\n\n","import { createStore, compose, DeepPartial, applyMiddleware, Middleware, AnyAction, Store } from \"redux\";\nimport { Persistor, persistReducer, persistStore } from \"redux-persist\";\nimport localForage from 'localforage';\nimport rootReducer from \"store/reducers/index\";\nimport { asInt } from \"constants/version\";\nimport { storeIsRehydrated } from 'store/helpers/storeHelpers';\nimport { StoreState } from 'store/types';\nimport { effectsMiddleware } from \"store/middleware/effects\";\nimport { traitsMiddleware } from \"store/middleware/traits\";\n\ndeclare global {\n  interface Window {\n    __REDUX_DEVTOOLS_EXTENSION_COMPOSE__?: typeof compose;\n  }\n}\n\nexport const PERSIST_KEY = \"root\";\n\nexport const persistConfig = {\n  key: PERSIST_KEY,\n  storage: localForage,\n  version: asInt,\n};\n\nconst persistedReducer = persistReducer<StoreState, AnyAction>(persistConfig, rootReducer);\n\ninterface ConfigureStoreResult {\n  store: Store;\n  persistor: Persistor;\n  isHydrated: boolean;\n}\n\n// all middlewares\nconst middlewares: Middleware[] = [\n  effectsMiddleware,\n  traitsMiddleware\n]\nconst middlewareEnhancer = applyMiddleware(...middlewares)\nconst composeEnhancers = (window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose)(middlewareEnhancer)\n\n/**\n * Configures the redux store\n */\nconst configureStore = async (initial: DeepPartial<StoreState> = {}): Promise<ConfigureStoreResult> => {\n\n  return new Promise((resolve, _reject) => {\n    const store = createStore(\n      persistedReducer,\n      // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n      // @ts-ignore\n      initial,\n      composeEnhancers,\n    );\n    const persistor = persistStore(store, undefined, () => {\n      const isHydrated = storeIsRehydrated(store.getState());\n      resolve({ store, persistor, isHydrated }) ;\n    });\n  });\n};\n\nexport default configureStore;\n","import { MiddlewareAPI, Dispatch } from 'redux'\nimport { Action } from \"store/actions\";\nimport { findQuestByAdventurer } from 'store/helpers/storeHelpers';\nimport { StoreState } from 'store/types';\nimport { AdventurerStoreState } from \"store/types/adventurer\";\n\nexport type AppMiddlewareAPI = MiddlewareAPI<Dispatch<Action>, StoreState>\n\n/**\n * If the adventurer just completed a scene action returns the corresponding SceneActionType\n */\nexport const lastAdventurerAction = (adventurer: AdventurerStoreState, action: Action, storeApi: AppMiddlewareAPI) => {\n  if (action.type === \"completeSceneAction\") {\n    const state = storeApi.getState();\n    const quest = findQuestByAdventurer(adventurer, state.quests);\n    const action = quest?.scene?.actionQueue?.[0];\n    if (action?.actorId === adventurer.id) {\n      return quest?.scene?.actionQueue?.[0].actionType\n    }\n  }\n}\n\n","import { Middleware } from 'redux'\nimport { Action } from 'store/actions'\nimport { StoreState } from 'store/types'\nimport { /*lastAdventurerAction, */ AppMiddlewareAPI } from './utils'\n\nexport const traitsMiddleware: Middleware<\n  unknown,\n  StoreState\n> = (_storeApi: AppMiddlewareAPI) => next => (action: Action) => {\n  // const state = storeApi.getState()\n\n  //for (const adventurer of state.adventurers) {\n    // const lastAction = lastAdventurerAction(adventurer, action, storeApi);\n    // (adventurer.traits ?? []).forEach(trait => {\n\n    // })\n  //}\n  next(action);\n}\n\n","import { restartGame } from \"index\";\nimport localforage from \"localforage\";\nimport { useEffect, useState } from \"react\";\nimport { FallbackProps } from \"react-error-boundary\";\nimport { getStoredState } from \"redux-persist\";\nimport { persistConfig } from \"utils/configureStore\";\nimport { InfoWindow } from \"../modals/InfoWindow\";\nimport Tab from \"../tabs/Tab\";\nimport Tabstrip from \"../tabs/Tabstrip\";\nimport \"./styles/errorModal.scss\";\n\nconst ErrorModal = (props: FallbackProps) => {\n  const {error, resetErrorBoundary} = props;\n  const [selectedTabId, setSelectedTabId] = useState<\"stack\" | \"store\">(\"stack\");\n  const [state, setState] = useState<string>(\"(no store state found)\");\n\n  const handleTabSelected = (tabId: typeof selectedTabId) => {\n    setSelectedTabId(tabId);\n  }\n\n  const handleReset = () => {\n    restartGame();\n    localforage.clear();\n    resetErrorBoundary();\n  }\n\n  useEffect(() => {\n    (async () => {\n      const initState = await getStoredState(persistConfig)\n      setState(JSON.stringify(initState, undefined, 2))\n    })()\n  })\n\n  return (\n    <div className=\"error\">\n      <InfoWindow className=\"error-modal\" title=\"\">\n        <h2 className=\"title\" >\n          Something went horribly wrong\n        </h2>\n        <div className=\"content\">\n          <pre>{error.message}</pre>\n\n        <Tabstrip className=\"tabs\" onTabSelected={handleTabSelected} activeTab={selectedTabId}>\n          <Tab id={\"stack\"}>Stack</Tab>\n          <Tab id={\"store\"}>Store</Tab>\n        </Tabstrip>\n        { selectedTabId === \"stack\" && (\n          <pre>{error.stack}</pre>\n        )}\n        { selectedTabId === \"store\" && (\n          <pre>{state}</pre>\n        )}\n        <button onClick={handleReset}>Try again</button>\n      </div>\n      </InfoWindow>\n    </div>\n  )\n}\n\nexport default ErrorModal;\n","/* eslint-disable @typescript-eslint/no-non-null-assertion */\nimport { RESOURCE_INTERVAL } from 'mechanics/resources';\nimport { Resource } from 'definitions/resources';\nimport { getDefinition, Structure } from \"definitions/structures\";\nimport { ResourceStructureDefinition, ResourceStructureLevelDefinition, StructureType } from \"definitions/structures/types\";\nimport { getTimeMultiplier, TimeType } from 'mechanics/time';\nimport { selectMaxResources } from 'store/selectors/resources';\nimport { StoreState } from \"store/types\";\nimport { ResourceStoreState } from \"store/types/resources\";\nimport { StructuresStoreState } from \"store/types/structures\";\n\n\n /*\n  * Calculates how many resources are generated by the in the town.\n  * Will return a ResourceStoreState with the amount of each resource to add  */\nconst getProducedResources = (lastProducedUpdate: number, store: StoreState): ResourceStoreState | null => {\n  const structures: StructuresStoreState = store.structures;\n  const result: ResourceStoreState = {};\n  const timeMultiplier = getTimeMultiplier(TimeType.resourceGeneration);\n\n  // this function can run at different intervals\n  // faster or slower than once a minute\n  // we will multiply the resource amount by the factor to normalize\n  const factor = ((Date.now() - lastProducedUpdate) / (RESOURCE_INTERVAL / timeMultiplier));\n  const maxResources = selectMaxResources(store);\n\n  const handleStructure = (structure: string) => {\n    const structureDefinition = getDefinition(structure as Structure);\n\n    if (structureDefinition.type === StructureType.resource) {\n      const resourceStructureDefinition = structureDefinition as ResourceStructureDefinition;\n      const level: number = structures[structure as Structure].level;\n      const levelDefinition: ResourceStructureLevelDefinition = resourceStructureDefinition.levels[level];\n\n      // Store all the resources that this structure will generate this tick into `result`\n      Object.keys(levelDefinition.generates).reduce((accumulator: ResourceStoreState, key: string) => {\n        const resource = key as Resource;\n\n        const amount: number = levelDefinition.generates[resource]! * structures[structure as Structure].workers * factor;\n        accumulator[resource] = (accumulator[resource] || 0) + amount;\n        return accumulator;\n      }, result);\n    }\n  };\n\n  if (factor < 1) {\n    return null;\n  }\n  // Calculate what each structure generates. Stores in `result`.\n  Object.keys(structures).forEach((structure) => handleStructure(structure));\n\n  // Check if the warehouse can actually hold it\n  Object.keys(result).forEach((key: string) => {\n    const resource = key as Resource;\n    if (result[resource]) {\n      if (store.resources[resource]! + result[resource]! >= maxResources[resource]!) {\n        result[resource] = maxResources[resource]! - (store.resources[resource]!);\n      }\n    }\n    // console.log(`Adding: ${resource} ${result[resource]} factor ${factor}`);\n  });\n\n  return result;\n};\n\n\nexport default getProducedResources;\n","import { TextEntry } from \"constants/text\";\nimport { getDefinition } from \"definitions/quests\";\nimport { QuestDefinition, QuestNodeType } from 'definitions/quests/types';\n\nimport { Store } from \"redux\";\nimport { StoreState } from \"store/types\";\nimport { LogChannel } from \"store/types/logEntry\";\nimport { QuestStatus, QuestStoreState } from \"store/types/quest\";\nimport { ToastManager } from 'global/ToastManager';\nimport { TextManager } from 'global/TextManager';\nimport { Type } from 'components/ui/toasts/Toast';\nimport { getQuestLink } from 'utils/routing';\nimport { setSceneName } from 'store/actions/quests';\nimport { getQuestLeader } from 'store/helpers/storeHelpers';\nimport { getTimeMultiplier, TimeType } from 'mechanics/time';\n\nexport interface QuestUpdate {\n  name: string;\n  progress: number;\n}\n\nexport interface LogUpdate extends TextEntry {\n  key: string;\n  channel: LogChannel;\n  channelContext?: string;\n}\n\ninterface QuestGameTickResponse {\n  questUpdates: QuestUpdate[];\n  logUpdates: LogUpdate[];\n}\n\nconst getQuestUpdates = (delta: number, store: Store<StoreState>): QuestGameTickResponse => {\n\n  const speed = 4;  // in nodes per minute\n  const timeMultiplier = getTimeMultiplier(TimeType.questProgress);\n  const MS_PER_MINUTE = 60000;\n  const log: LogUpdate[] = [];\n  const quests: QuestUpdate[] = [];\n  const state: StoreState = store.getState();\n\n  // Will set the scene name on the given quest\n  // SceneControllerContextProvider will detect this and load the scene data\n  const initializeScene = (quest: QuestStoreState, sceneName: string) => {\n    store.dispatch(setSceneName(quest.name, sceneName));\n\n    const questTitle = TextManager.getQuestTitle(quest.name);\n    const leader = getQuestLeader(state.adventurers, quest);\n    ToastManager.addToast(questTitle, Type.questEncounter, leader?.avatarImg, getQuestLink(quest.name));\n  }\n\n  // Moves the quest line progress. Only if currently at a 'nothing' node\n  // Otherwise the player has to do something to move the quest along\n  state.quests.forEach((quest: QuestStoreState) => {\n    if (quest.status !== QuestStatus.active) {\n      return;\n    }\n    const questDefinition: QuestDefinition = getDefinition(quest.name);\n    const currentProgress = quest.progress;\n    const currentNodeIndex = Math.floor(currentProgress);\n    const currentNode = questDefinition.nodes[currentNodeIndex];\n\n    if (currentNode.type === QuestNodeType.encounter) {\n      if (quest.sceneName === undefined) {\n        // This happens when the first node is an encounter. Initialize it right away\n        initializeScene(quest, currentNode.startScene)\n      }\n    }\n    if (currentNode.type === QuestNodeType.nothing) {\n      // Currently at a 'nothing' node\n      const progressIncrease = (delta / (MS_PER_MINUTE / timeMultiplier)) * speed;\n      // todo: [15/07/2019] speed could be different for each party\n      let nextProgress = Math.min(currentProgress + progressIncrease, questDefinition.nodes.length - 1);\n      const nodesPassed = Math.floor(nextProgress) - currentNodeIndex;\n      for (let i = 1; i <= nodesPassed; i++) {\n        // Loop through all the nodes we've passed since last tick\n        const nextNode = questDefinition.nodes[currentNodeIndex + i];\n        if (nextNode.type === QuestNodeType.encounter) {\n          // We've hit an encounter node. set the progress to here and stop looking at other nodes\n          initializeScene(quest, nextNode.startScene);\n\n          // Add quest to log\n          if (nextNode.log) {\n            log.push({\n              channel: LogChannel.quest,\n              channelContext: quest.name,\n              key: nextNode.log,\n            });\n          }\n          // Dont overshoot the encounter node\n          nextProgress = currentProgress + i;\n\n          break;\n        } else if (nextNode.type === QuestNodeType.nothing) {\n          if (nextNode.log) {\n            log.push({\n              channel: LogChannel.quest,\n              channelContext: quest.name,\n              key: nextNode.log,\n            });\n          }\n        }\n      }\n      quests.push({\n        name: quest.name,\n        progress: nextProgress,\n      });\n    }\n  });\n  return {\n    logUpdates: log,\n    questUpdates: quests,\n  };\n};\n\nexport default getQuestUpdates;\n","import { State as seedrandomStateType } from \"seedrandom\";\nimport * as Random from \"utils/random\";\n\nconst getRngState = (): seedrandomStateType | null => {\n  if (Random.dirty) {\n    return Random.state();\n  }\n  return null;\n};\n\nexport default getRngState;\n","// In production, we register a service worker to serve assets from local cache.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on the 'N+1' visit to a page, since previously\n// cached resources are updated in the background.\n\n// To learn more about the benefits of this model, read https://goo.gl/KwvDNy.\n// This link also includes instructions on opting out of this behavior.\n\nconst isLocalhost = Boolean(\n  window.location.hostname === \"localhost\" ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === \"[::1]\" ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/,\n    ),\n);\n\nexport default function register() {\n  if (process.env.NODE_ENV === \"production\" && \"serviceWorker\" in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.toString(),\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebookincubator/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener(\"load\", () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Lets check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            \"This web app is being served cache-first by a service \" +\n              \"worker. To learn more, visit https://goo.gl/SC7cgQ\",\n          );\n        });\n      } else {\n        // Is not local host. Just register service worker\n        registerValidSW(swUrl);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then((registration) => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker) {\n          installingWorker.onstatechange = () => {\n            if (installingWorker.state === \"installed\") {\n              if (navigator.serviceWorker.controller) {\n                // At this point, the old content will have been purged and\n                // the fresh content will have been added to the cache.\n                // It's the perfect time to display a 'New content is\n                // available; please refresh.' message in your web app.\n                console.log(\"New content is available; please refresh.\");\n              } else {\n                // At this point, everything has been precached.\n                // It's the perfect time to display a\n                // 'Content is cached for offline use.' message.\n                console.log(\"Content is cached for offline use.\");\n              }\n            }\n          };\n        }\n      };\n    })\n    .catch((error) => {\n      console.error(\"Error during service worker registration:\", error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then((response) => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      if (\n        response.status === 404 ||\n        (response.headers.get(\"content-type\") ?? \"\").indexOf(\"javascript\") === -1\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then((registration) => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl);\n      }\n    })\n    .catch(() => {\n      console.log(\n        \"No internet connection found. App is running in offline mode.\",\n      );\n    });\n}\n\nexport function unregister() {\n  if (\"serviceWorker\" in navigator) {\n    navigator.serviceWorker.ready.then((registration) => {\n      registration.unregister();\n    });\n  }\n}\n","import { TaskStoreState, TaskType } from 'store/types/task';\nimport { TasksStoreState } from 'store/types/tasks';\nimport { AnyAction, Dispatch } from \"redux\";\nimport { ToastManager } from 'global/ToastManager';\nimport { TextManager } from 'global/TextManager';\nimport { Type } from 'components/ui/toasts/Toast';\nimport { getDefinition } from 'definitions/items';\nimport { ItemType } from 'definitions/items/types';\n\nexport const processCompletedTasks = (tasks: TasksStoreState, dispatch: Dispatch<AnyAction>) => {\n  const handleCompletedTask = (task: TaskStoreState) => {\n    // Fire all callbacks\n    task.callbacks.forEach((action) => dispatch(action));\n\n    switch (task.type) {\n      case TaskType.craftItem: {\n        const type = task.name as ItemType;\n        const item = { type }\n        const title = TextManager.get(\"common-item-crafted\", { item });\n        const definition = getDefinition(type);\n        ToastManager.addToast(title, Type.itemCrafted, definition.iconImg);\n        break;\n      }\n    }\n  };\n\n  tasks.completed.forEach((task) => handleCompletedTask(task));\n};\n","import * as ReactDOM from \"react-dom\";\nimport { Provider } from \"react-redux\";\nimport { Store, AnyAction, DeepPartial } from \"redux\";\nimport { Persistor } from \"redux-persist\";\nimport localforage from 'localforage';\nimport { gameTick, ignoreVersionDiff, startGame } from \"store/actions/game\";\nimport { addLogText } from \"store/actions/log\";\nimport * as Version from \"./constants/version\";\nimport App from \"./components/App\";\nimport getProducedResources from \"./mechanics/gameTick/producedResources\";\nimport getQuestUpdates, { LogUpdate } from \"./mechanics/gameTick/quests\";\nimport getRngState from \"./mechanics/gameTick/rngState\";\nimport registerServiceWorker from \"./registerServiceWorker\";\nimport configureStore from \"./utils/configureStore\";\nimport * as Random from \"./utils/random\";\nimport { TextManager } from \"./global/TextManager\";\nimport { loadResourceAsync } from 'utils/pixiJs';\nimport { processCompletedTasks } from 'mechanics/gameTick/tasks';\nimport { StoreState } from 'store/types';\nimport { createInitialStore } from \"store/reducers\";\nimport getHarvest from \"mechanics/gameTick/harvest\";\nimport { convertIntToSemVer } from \"utils/version\";\nimport \"./index.css\";\n\nconst TICK_INTERVAL = 2500;\nlet persistor: Persistor;\n\nconst initGame = async () => {\n  const texts = await loadResourceAsync(`${process.env.PUBLIC_URL}/lang/en.json`);\n  if (texts) {\n    TextManager.init(texts.data);\n  }\n  Random.init(\"GILLESROX2\");\n\n  setupStore();\n};\n\n/**\n * Attemps to read persisted store state. Calls `runGame`\n */\nconst setupStore = async (initial: DeepPartial<StoreState> = {}) => {\n  const storeConfiguration = await configureStore(initial);\n  const { store, isHydrated } = storeConfiguration;\n  persistor = storeConfiguration.persistor;\n\n  if (!isHydrated) {\n    startNewGame(store);\n  } else {\n    continueGame();\n  }\n  runGame(store);\n}\n\n/**\n * Gets called when a player starts a new game\n * @param store\n */\nconst startNewGame = (store: Store<StoreState, AnyAction>) => {\n  store.dispatch(startGame());\n  store.dispatch(addLogText(\"test-game-welcome\"));\n  // todo: here is a good place to launch a tutorial or something\n\n  console.log(`Starting new GAME (version ${Version.default})`);\n};\n\n\n/**\n * Continue playing earlier persisted store\n * @param store\n */\nconst continueGame = () => {\n  console.log(`Continuing existing GAME (version ${Version.default})`);\n};\n\n/**\n * Loads a saved game from a file\n */\nconst loadGame = async (state: StoreState) => {\n  // todo: implement in MenuWindow!\n  await persistor.pause();\n  await configureStore(state);\n  // runGame(store); // no need if we are refreshing the page anyway\n\n  // We have to cause the page to reinitialize and all react components to remount\n  // eslint-disable-next-line no-restricted-globals\n  location.reload();\n}\n\nconst restartGame = () => {\n  persistor.pause();\n  // eslint-disable-next-line no-restricted-globals\n  if(confirm('Are you sure you wish to reset all your progress?')){\n    clearTimeout(interval);\n    persistor.purge();\n    localforage.clear();\n\n    setupStore(createInitialStore());\n    // eslint-disable-next-line no-restricted-globals\n    location.reload();\n    // location.href = `#${getTownLink()}`;\n    console.clear();\n  }\n  persistor.persist();\n}\n\nlet interval: NodeJS.Timeout; // main game tick\nconst runGame = (store: Store<StoreState, AnyAction>) => {\n  const gameVersion = store.getState().game?.version;\n  if (gameVersion < Version.asInt && store.getState().game?.ignoreVersionDiff !== Version.asInt) {\n    if (!confirm(`This game was initialized with version ${convertIntToSemVer(gameVersion)} which is older than the current client (${Version.default}). This might cause problems. Continue anyway? \\n\\n(pressing cancel will reset progress) `)) {\n      restartGame();\n      return\n    }\n    store.dispatch(ignoreVersionDiff());\n\n  }\n  clearTimeout(interval);\n\n  ReactDOM.render((\n    <Provider store={store}>\n      <App />\n    </Provider>\n    ),\n    document.getElementById(\"root\") as HTMLElement,\n  );\n  registerServiceWorker();\n\n  const gameLoop = () => {\n    const state: StoreState = store.getState();\n    const delta = Date.now() - state.engine.lastTick;\n\n    const logs: LogUpdate[] = [];\n    const resourcesUpdates = getProducedResources(state.engine.lastProducedUpdate, state);\n    const harvestUpdates = getHarvest(state);\n    const rngState = getRngState();\n    const { questUpdates, logUpdates } = getQuestUpdates(delta, store);\n    logs.push(...logUpdates);\n\n    store.dispatch(gameTick(delta, rngState, resourcesUpdates, questUpdates, harvestUpdates, logs));\n\n    processCompletedTasks(state.tasks, store.dispatch);\n  };\n\n  interval = setInterval(gameLoop, TICK_INTERVAL);\n};\n\nexport {runGame, restartGame, loadGame};\n\ninitGame();\n"],"sourceRoot":""}