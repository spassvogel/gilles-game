(this["webpackJsonpgilles-game"]=this["webpackJsonpgilles-game"]||[]).push([[0],{116:function(e,t,n){e.exports=n(247)},142:function(e,t,n){},163:function(e,t,n){},208:function(e,t,n){},209:function(e,t,n){},210:function(e,t,n){},211:function(e,t,n){},212:function(e,t,n){},213:function(e,t,n){},214:function(e,t,n){},215:function(e,t,n){},217:function(e,t,n){},218:function(e,t,n){},219:function(e,t,n){},220:function(e,t,n){},221:function(e,t,n){},222:function(e,t,n){},223:function(e,t,n){},224:function(e,t,n){},225:function(e,t,n){},226:function(e,t,n){},228:function(e,t,n){},236:function(e,t){},237:function(e,t,n){},238:function(e,t,n){},239:function(e,t,n){},240:function(e,t,n){},241:function(e,t,n){},242:function(e,t,n){},243:function(e,t,n){},244:function(e,t,n){},247:function(e,t,n){"use strict";n.r(t);var r,a,o,c=n(17),i=n(31),s=n.n(i),u=n(45),l=n(100),m=n.n(l);!function(e){e.clearCombatAction="clearCombatAction",e.startCombatAction="startCombatAction",e.moveActor="moveActor"}(r||(r={})),function(e){e[e.player=0]="player",e[e.enemy=1]="enemy"}(a||(a={})),function(e){e.move="move",e.slash="slash",e.shoot="shoot"}(o||(o={}));var d,p,f,g={actors:[{allegiance:a.player,health:100,location:[3,5],name:"c4a5d270",remainingAP:5},{allegiance:a.player,health:100,location:[4,6],name:"2e655832",remainingAP:4}],turn:a.player},v=function(e,t){var n,c,i=t.getState().combat;if(i.action&&i.action.endsAt<Date.now())if(i.turn===a.enemy);else if(i.turn===a.player){switch(i.action.type){case o.move:t.dispatch((n=i.action.actor,c=i.action.target,{type:r.moveActor,actor:n,location:c})),t.dispatch({type:r.clearCombatAction})}return{action:null}}return null},h=n(0),b=n.n(h),y=n(52),w=n(6);function O(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:p.common,r=arguments.length>3?arguments[3]:void 0;return{type:f.addLogEntry,key:e,channel:n,channelContext:r,context:t}}!function(e){e.gameTick="gameTick"}(d||(d={})),function(e){e[e.common=0]="common",e[e.town=1]="town",e[e.quest=2]="quest"}(p||(p={})),function(e){e.addLogEntry="addLogEntry"}(f||(f={}));var k,j,E,T=function(e){var t=e.split(".").map((function(e){return Number(e)}));if(3!==t.length)throw new Error("Received invalid version string: ".concat(e));t.forEach((function(e){if(e>=1024)throw new Error("Version string invalid, ".concat(e," is too large"))}));for(var n=0,r=0;r<3;r++)n|=t[r]<<10*r;return n}("0.0.4"),I=n(2),C=n(4),x=n(10),N=n(11),S=n(15),q=n(13),D=n(14),A=(n(142),function(e){var t=e.className||"";return h.createElement("div",{className:"ui-button widgets-squareiconbutton ".concat(t),onClick:function(t){e.onClick&&e.onClick(t)}},e.text)}),R=(n(83),function(e){var t=(e.active?"active":"")+(e.className||"");return h.createElement("li",{className:"widget-tab ".concat(t),onClick:function(t){e.onClick&&e.onClick(t)}},e.children)}),P=function(e){var t=null;e.children&&e.children.length&&(t=e.children[0].props.id);var n=Object(h.useState)(t),r=Object(C.a)(n,2),a=r[0],o=r[1],c=e.className||"",i=b.a.Children.map(e.children,(function(e){return b.a.cloneElement(e,{active:e.props.id===a,onClick:function(){s(e.props.id)}})})),s=function(t){o(t),e.onTabSelected&&e.onTabSelected(t)};return b.a.createElement("ul",{className:"widget-tabstrip ".concat(c),onClick:function(t){e.onClick&&e.onClick(t)}},i)};!function(e){e[e.deed=0]="deed",e[e.apparel=1]="apparel",e[e.material=2]="material",e[e.questItem=3]="questItem",e[e.trinket=4]="trinket",e[e.weapon=5]="weapon"}(k||(k={})),function(e){e.deedForLumbermill="deedForLumbermill",e.deedForWeaponsmith="deedForWeaponsmith",e.boots1="boots1",e.boots2="boots2",e.boots3="boots3",e.chainmailHood="chainmailHood",e.chest="chest",e.clothGloves="clothGloves",e.cowl="cowl",e.fedora="fedora",e.druidChest="druidChest",e.druidFeet="druidFeet",e.druidHands="druidHands",e.druidHead="druidHead",e.druidLegs="druidLegs",e.greaves1="greaves1",e.greaves2="greaves2",e.hornedHelmet="hornedHelmet",e.leatherGloves="leatherGloves",e.nomadHelmet="nomadHelmet",e.pants1="pants1",e.pants2="pants2",e.plateChest1="plateChest1",e.plateChest2="plateChest2",e.plateChest3="plateChest3",e.plateChest4="plateChest4",e.plateGloves1="plateGloves1",e.plateGloves2="plateGloves2",e.plateHelmet="plateHelmet",e.platePants="platePants",e.plateShoulders1="plateShoulders1",e.plateShoulders2="plateShoulders2",e.robe="robe",e.shoulders1="shoulders1",e.shoulders2="shoulders2",e.shoulders3="shoulders3",e.vest="vest",e.arrowheads="arrowheads",e.bolts="bolts",e.buckle="buckle",e.chain="chain",e.cogs="cogs",e.gem="gem",e.gunpowder="gunpowder",e.ingot="ingot",e.nails="nails",e.poisonVial="poisonVial",e.ribbon="ribbon",e.rope="rope",e.scales="scales",e.spring="spring",e.thread="thread",e.blueprints="blueprints",e.crate="crate",e.dynamite="dynamite",e.eye="eye",e.feather="feather",e.food="food",e.heart="heart",e.horn="horn",e.key="key",e.letters="letters",e.lockPicks="lockPicks",e.oil="oil",e.orcFinger="orcFinger",e.plans="plans",e.purpleGems="purpleGems",e.runestone="runestone",e.sandwich="sandwich",e.teeth="teeth",e.tooth="tooth",e.torch="torch",e.tusk="tusk",e.vase="vase",e.vial="vial",e.weeds="weeds",e.ring="ring",e.magicAmulet="magicAmulet",e.battleAxe="battleAxe",e.brassKnuckles="brassKnuckles",e.cleaver="cleaver",e.club="club",e.crossbow="crossbow",e.dagger="dagger",e.flail="flail",e.greatswordOfGwai="greatswordOfGwai",e.khopesh="khopesh",e.longbow="longbow",e.mace="mace",e.morningStar="morningStar",e.poisonedDagger="poisonedDagger",e.ravenStaff="ravenStaff",e.savageStaff="savageStaff",e.spear="spear",e.sword="sword",e.warhammer="warhammer"}(j||(j={}));var M,W=k.apparel,L="/img/items/apparel/";!function(e){e[e.feet=0]="feet",e[e.hands=1]="hands",e[e.chest=2]="chest",e[e.legs=3]="legs",e[e.head=4]="head",e[e.shoulders=5]="shoulders"}(M||(M={}));var H,B=(E={},Object(I.a)(E,j.boots1,{item:j.boots1,equipmentType:M.feet,itemType:W,subText:"These boots are made for questin'",iconImg:"".concat(L,"boots_1.png")}),Object(I.a)(E,j.boots2,{item:j.boots2,equipmentType:M.feet,itemType:W,subText:"",iconImg:"".concat(L,"boots_2.png")}),Object(I.a)(E,j.boots3,{item:j.boots3,equipmentType:M.feet,itemType:W,subText:"",iconImg:"".concat(L,"boots_3.png")}),Object(I.a)(E,j.chainmailHood,{item:j.chainmailHood,equipmentType:M.head,itemType:W,subText:"",iconImg:"".concat(L,"chainmail_hood.png"),armorRating:3}),Object(I.a)(E,j.chest,{item:j.chest,equipmentType:M.chest,itemType:W,subText:"",iconImg:"".concat(L,"chest_1.png"),armorRating:2}),Object(I.a)(E,j.clothGloves,{item:j.clothGloves,equipmentType:M.hands,itemType:W,subText:"",iconImg:"".concat(L,"cloth_gloves.png")}),Object(I.a)(E,j.cowl,{item:j.cowl,equipmentType:M.head,itemType:W,subText:"",iconImg:"".concat(L,"cowl.png"),armorRating:20}),Object(I.a)(E,j.druidChest,{item:j.druidHands,equipmentType:M.chest,itemType:W,subText:"",iconImg:"".concat(L,"druid-chest.png")}),Object(I.a)(E,j.druidFeet,{item:j.druidFeet,equipmentType:M.feet,itemType:W,subText:"",iconImg:"".concat(L,"druid-feet.png")}),Object(I.a)(E,j.druidHands,{item:j.druidHands,equipmentType:M.hands,itemType:W,subText:"",iconImg:"".concat(L,"druid-hands.png")}),Object(I.a)(E,j.druidHead,{item:j.druidHead,equipmentType:M.head,itemType:W,subText:"",iconImg:"".concat(L,"druid-head.png")}),Object(I.a)(E,j.druidLegs,{item:j.druidLegs,equipmentType:M.legs,itemType:W,subText:"",iconImg:"".concat(L,"druid-legs.png")}),Object(I.a)(E,j.fedora,{item:j.fedora,equipmentType:M.head,itemType:W,subText:"I study the blade",iconImg:"".concat(L,"fedora.png")}),Object(I.a)(E,j.greaves1,{item:j.greaves1,equipmentType:M.hands,itemType:W,subText:"",iconImg:"".concat(L,"greaves_1.png"),armorRating:10}),Object(I.a)(E,j.greaves2,{item:j.greaves2,equipmentType:M.hands,itemType:W,subText:"",iconImg:"".concat(L,"greaves_2.png")}),Object(I.a)(E,j.hornedHelmet,{item:j.hornedHelmet,equipmentType:M.head,itemType:W,subText:"",iconImg:"".concat(L,"horned_helmet.png")}),Object(I.a)(E,j.leatherGloves,{item:j.leatherGloves,equipmentType:M.hands,itemType:W,subText:"",iconImg:"".concat(L,"leather_gloves.png")}),Object(I.a)(E,j.nomadHelmet,{item:j.nomadHelmet,equipmentType:M.head,itemType:W,subText:"",iconImg:"".concat(L,"nomad_helmet.png")}),Object(I.a)(E,j.pants1,{item:j.pants1,equipmentType:M.legs,itemType:W,subText:"",iconImg:"".concat(L,"pants_1.png"),armorRating:10}),Object(I.a)(E,j.pants2,{item:j.pants2,equipmentType:M.legs,itemType:W,subText:"",iconImg:"".concat(L,"pants_2.png")}),Object(I.a)(E,j.plateChest1,{item:j.plateChest1,equipmentType:M.chest,itemType:W,subText:"",iconImg:"".concat(L,"plate_chest_1.png")}),Object(I.a)(E,j.plateChest2,{item:j.plateChest2,equipmentType:M.chest,itemType:W,subText:"",iconImg:"".concat(L,"plate_chest_2.png")}),Object(I.a)(E,j.plateChest3,{item:j.plateChest3,equipmentType:M.chest,itemType:W,subText:"",iconImg:"".concat(L,"plate_chest_3.png")}),Object(I.a)(E,j.plateChest4,{item:j.plateChest4,equipmentType:M.chest,itemType:W,subText:"",iconImg:"".concat(L,"plate_chest_4.png")}),Object(I.a)(E,j.plateGloves1,{item:j.plateGloves1,equipmentType:M.hands,itemType:W,subText:"",iconImg:"".concat(L,"plate_gloves_1.png")}),Object(I.a)(E,j.plateGloves2,{item:j.plateGloves2,equipmentType:M.hands,itemType:W,subText:"",iconImg:"".concat(L,"plate_gloves_2.png")}),Object(I.a)(E,j.plateHelmet,{item:j.plateHelmet,equipmentType:M.head,itemType:W,subText:"",iconImg:"".concat(L,"plate_helmet_1.png")}),Object(I.a)(E,j.platePants,{item:j.platePants,equipmentType:M.legs,itemType:W,subText:"",iconImg:"".concat(L,"plate_pants1.png")}),Object(I.a)(E,j.plateShoulders1,{item:j.plateShoulders1,equipmentType:M.shoulders,itemType:W,subText:"",iconImg:"".concat(L,"plate_shoulders_1.png")}),Object(I.a)(E,j.plateShoulders2,{item:j.plateShoulders2,equipmentType:M.shoulders,itemType:W,subText:"",iconImg:"".concat(L,"plate_shoulders_2.png")}),Object(I.a)(E,j.robe,{item:j.robe,equipmentType:M.chest,itemType:W,subText:"",iconImg:"".concat(L,"robe_1.png")}),Object(I.a)(E,j.shoulders1,{item:j.shoulders1,equipmentType:M.shoulders,itemType:W,subText:"",iconImg:"".concat(L,"shoulders_1.png")}),Object(I.a)(E,j.shoulders2,{item:j.shoulders2,equipmentType:M.shoulders,itemType:W,subText:"",iconImg:"".concat(L,"shoulders_2.png")}),Object(I.a)(E,j.shoulders3,{item:j.shoulders3,equipmentType:M.shoulders,itemType:W,subText:"",iconImg:"".concat(L,"shoulders_3.png")}),Object(I.a)(E,j.vest,{item:j.vest,equipmentType:M.chest,itemType:W,subText:"",iconImg:"".concat(L,"vest_1.png")}),E),_=B;!function(e){e[e.resource=0]="resource",e[e.production=1]="production",e[e.tavern=2]="tavern",e[e.warehouse=3]="warehouse"}(H||(H={}));var G,F,U={type:H.production,cost:{gold:40,time:4e3},levels:[{displayName:"structure-alchemist-name",workerCapacity:2,cost:{gold:0},produces:[]},{displayName:"structure-alchemist-name",workerCapacity:5,cost:{gold:30},produces:[]},{displayName:"structure-alchemist-name",workerCapacity:10,cost:{gold:50},produces:[]}]},Q=n(68),V=(n(143),function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"milliseconds";return Q.duration(e,t).format("d [days] h [hours] m [min] s [sec]",{trim:"both"})}),z={item:j.boots1,cost:{resources:{wood:2,iron:15},time:18e5}},K={item:j.chest,cost:{resources:{wood:10,iron:45},time:36e5}},X={item:j.cowl,cost:{resources:{iron:15},time:36e5}},J={cost:{gold:40,time:4e3},type:H.production,levels:[{displayName:"structure-armoursmith-name",workerCapacity:2,cost:{gold:0},produces:[z]},{displayName:"structure-armoursmith-name",workerCapacity:5,cost:{gold:30},produces:[z,K]},{displayName:"structure-armoursmith-name",workerCapacity:10,cost:{gold:50},produces:[z,K,X]}]},Y={type:H.resource,cost:{gold:40,time:4e3},levels:[{displayName:"structure-garden-name",workerCapacity:2,cost:{gold:0},generates:{food:2}},{displayName:"structure-garden-name",workerCapacity:5,cost:{gold:30},generates:{food:2}},{displayName:"structure-garden-name",workerCapacity:10,cost:{gold:50},generates:{food:2}}]},Z={type:H.resource,cost:{gold:31,time:5e3},levels:[{displayName:"structure-lumber-mill-name",workerCapacity:2,cost:{gold:0},generates:{wood:2}},{displayName:"structure-lumber-mill-name",workerCapacity:5,cost:{gold:30},generates:{wood:2}},{displayName:"structure-lumber-mill-name",workerCapacity:10,cost:{gold:50},generates:{wood:2}}]},$={cost:{gold:40,time:4e3},type:H.resource,levels:[{displayName:"structure-mine-name",workerCapacity:2,cost:{gold:0},generates:{iron:2}},{displayName:"structure-mine-name",workerCapacity:5,cost:{gold:30},generates:{iron:2}},{displayName:"structure-mine-name",workerCapacity:10,cost:{gold:50},generates:{iron:2}}]},ee={cost:{gold:40,time:4e3},type:H.resource,levels:[{displayName:"structure-quarry-name",workerCapacity:2,cost:{gold:0},generates:{stone:2}},{displayName:"structure-quarry-name",workerCapacity:5,cost:{gold:30},generates:{stone:4}},{displayName:"structure-quarry-name",workerCapacity:10,cost:{gold:50},generates:{stone:6}}]},te={cost:{gold:40,time:4e3},type:H.resource,levels:[{displayName:"structure-tannery-name",workerCapacity:2,cost:{gold:0},generates:{leather:2}},{displayName:"structure-tannery-name",workerCapacity:5,cost:{gold:30},generates:{leather:5}},{displayName:"structure-tannery-name",workerCapacity:10,cost:{gold:50},generates:{leather:7}}]},ne={cost:{gold:40,time:4e3},type:H.tavern,levels:[{displayName:"structure-tavern-name",workerCapacity:2,cost:{gold:0},rooms:10},{displayName:"structure-tavern-name",workerCapacity:5,cost:{gold:30},rooms:12},{displayName:"structure-tavern-name",workerCapacity:10,cost:{gold:50},rooms:15}]},re={cost:{gold:40,time:4e3},type:H.warehouse,levels:[{displayName:"structure-warehouse-name",workerCapacity:2,cost:{gold:0},maxResources:{fabric:200,food:200,iron:200,leather:200,stone:200,wood:200}},{displayName:"structure-warehouse-name",workerCapacity:5,cost:{gold:30},maxResources:{fabric:500,food:500,iron:500,leather:500,stone:500,wood:500}},{displayName:"structure-warehouse-name",workerCapacity:10,cost:{gold:50},maxResources:{fabric:1e3,food:1e3,iron:1e3,leather:1e3,stone:1e3,wood:1e3}}]},ae={item:j.crossbow,cost:{resources:{wood:20,iron:5},time:18e5}},oe={item:j.longbow,cost:{resources:{wood:40,iron:5},time:36e5}},ce={item:j.poisonedDagger,cost:{resources:{wood:50,iron:15},materials:[j.poisonVial],time:36e5}},ie={item:j.dagger,cost:{resources:{wood:10,iron:10},time:36e5}},se={item:j.sword,cost:{resources:{wood:10,iron:30},time:36e5}},ue={item:j.khopesh,cost:{resources:{wood:15,iron:40},time:12e4}},le={type:H.production,cost:{gold:40,time:4e3},levels:[{displayName:"structure-weaponsmith-name",workerCapacity:2,cost:{gold:0},produces:[ae,ie]},{displayName:"structure-weaponsmith-name",workerCapacity:5,cost:{gold:30},produces:[ae,ie,oe]},{displayName:"structure-weaponsmith-name",workerCapacity:10,cost:{gold:50},produces:[ae,ie,oe,se,ue]},{displayName:"structure-weaponsmith-name",workerCapacity:14,cost:{gold:50},produces:[ae,ie,oe,se,ue,ce]}]},me={cost:{gold:40,time:4e3},type:H.resource,levels:[{displayName:"structure-weaver-name",workerCapacity:2,cost:{gold:0},generates:{fabric:2}},{displayName:"structure-weaver-name",workerCapacity:5,cost:{gold:30},generates:{fabric:5}},{displayName:"structure-weaver-name",workerCapacity:10,cost:{gold:50},generates:{fabric:7}}]},de={item:j.torch,cost:{resources:{wood:2,fabric:1},time:6e4}},pe={item:j.sandwich,cost:{resources:{food:1},time:3e4}},fe={type:H.production,cost:{gold:40,time:4e3},levels:[{displayName:"structure-workshop-name",workerCapacity:2,cost:{gold:0},produces:[de,pe]},{displayName:"structure-workshop-name",workerCapacity:5,cost:{gold:30},produces:[]},{displayName:"structure-workshop-name",workerCapacity:10,cost:{gold:50},produces:[]},{displayName:"structure-workshop-name",workerCapacity:14,cost:{gold:50},produces:[]}]};(F=G||(G={})).alchemist="alchemist",F.armoursmith="armoursmith",F.garden="garden",F.lumberMill="lumberMill",F.mine="mine",F.quarry="quarry",F.tavern="tavern",F.tannery="tannery",F.warehouse="warehouse",F.weaponsmith="weaponsmith",F.weaver="weaver",F.workshop="workshop";var ge={alchemist:U,armoursmith:J,garden:Y,lumberMill:Z,mine:$,quarry:ee,tavern:ne,tannery:te,warehouse:re,weaponsmith:le,weaver:me,workshop:fe};function ve(e){return ge[e]}var he,be,ye,we,Oe,ke,je=k.deed,Ee={deedForLumbermill:{item:j.deedForLumbermill,structure:G.lumberMill,itemType:je,subText:"It allows for the construction of a lumber mill",iconImg:"/img/items/deeds/deed.png"},deedForWeaponsmith:{item:j.deedForWeaponsmith,structure:G.weaponsmith,itemType:je,subText:"It allows for the construction of a weaponsmith",iconImg:"/img/items/deeds/deed.png"}},Te=k.material,Ie="/img/items/materials/",Ce=(he={},Object(I.a)(he,j.arrowheads,{item:j.arrowheads,itemType:Te,iconImg:"".concat(Ie,"arrowheads.png")}),Object(I.a)(he,j.bolts,{item:j.bolts,itemType:Te,iconImg:"".concat(Ie,"bolts.png")}),Object(I.a)(he,j.buckle,{item:j.buckle,itemType:Te,iconImg:"".concat(Ie,"buckle.png")}),Object(I.a)(he,j.chain,{item:j.chain,itemType:Te,iconImg:"".concat(Ie,"chain.png")}),Object(I.a)(he,j.cogs,{item:j.cogs,itemType:Te,iconImg:"".concat(Ie,"cogs.png")}),Object(I.a)(he,j.gem,{item:j.gem,itemType:Te,iconImg:"".concat(Ie,"gem.png")}),Object(I.a)(he,j.ingot,{item:j.ingot,itemType:Te,iconImg:"".concat(Ie,"ingot.png")}),Object(I.a)(he,j.nails,{item:j.nails,itemType:Te,iconImg:"".concat(Ie,"nails.png")}),Object(I.a)(he,j.poisonVial,{item:j.poisonVial,itemType:Te,iconImg:"".concat(Ie,"poison-vial.png")}),Object(I.a)(he,j.ribbon,{item:j.ribbon,itemType:Te,iconImg:"".concat(Ie,"ribbon.png")}),Object(I.a)(he,j.rope,{item:j.rope,itemType:Te,iconImg:"".concat(Ie,"rope.png")}),Object(I.a)(he,j.gem,{item:j.gem,itemType:Te,iconImg:"".concat(Ie,"gem.png")}),Object(I.a)(he,j.gunpowder,{item:j.gunpowder,itemType:Te,iconImg:"".concat(Ie,"gunpowder.png")}),Object(I.a)(he,j.scales,{item:j.scales,itemType:Te,iconImg:"".concat(Ie,"scales.png")}),Object(I.a)(he,j.spring,{item:j.spring,itemType:Te,iconImg:"".concat(Ie,"spring.png")}),Object(I.a)(he,j.thread,{item:j.thread,itemType:Te,iconImg:"".concat(Ie,"thread.png")}),he),xe=k.questItem,Ne="/img/items/quest-items/",Se=(be={},Object(I.a)(be,j.blueprints,{item:j.blueprints,itemType:xe,iconImg:"".concat(Ne,"blueprints.png")}),Object(I.a)(be,j.crate,{item:j.crate,itemType:xe,iconImg:"".concat(Ne,"crate.png")}),Object(I.a)(be,j.dynamite,{item:j.dynamite,itemType:xe,iconImg:"".concat(Ne,"dynamite.png")}),Object(I.a)(be,j.eye,{item:j.eye,itemType:xe,iconImg:"".concat(Ne,"eye.png")}),Object(I.a)(be,j.feather,{item:j.feather,itemType:xe,iconImg:"".concat(Ne,"feather.png")}),Object(I.a)(be,j.food,{item:j.food,itemType:xe,iconImg:"".concat(Ne,"food.png")}),Object(I.a)(be,j.heart,{item:j.heart,itemType:xe,iconImg:"".concat(Ne,"heart.png")}),Object(I.a)(be,j.horn,{item:j.horn,itemType:xe,iconImg:"".concat(Ne,"horn.png")}),Object(I.a)(be,j.key,{item:j.key,itemType:xe,iconImg:"".concat(Ne,"key.png")}),Object(I.a)(be,j.letters,{item:j.letters,itemType:xe,iconImg:"".concat(Ne,"letters.png")}),Object(I.a)(be,j.lockPicks,{item:j.lockPicks,itemType:xe,iconImg:"".concat(Ne,"lock-picks.png")}),Object(I.a)(be,j.oil,{item:j.oil,itemType:xe,iconImg:"".concat(Ne,"oil.png")}),Object(I.a)(be,j.orcFinger,{item:j.orcFinger,itemType:xe,iconImg:"".concat(Ne,"orc-finger.png")}),Object(I.a)(be,j.plans,{item:j.plans,itemType:xe,iconImg:"".concat(Ne,"plans.png")}),Object(I.a)(be,j.purpleGems,{item:j.purpleGems,itemType:xe,iconImg:"".concat(Ne,"purple-gems.png")}),Object(I.a)(be,j.runestone,{item:j.runestone,itemType:xe,iconImg:"".concat(Ne,"runestone.png")}),Object(I.a)(be,j.sandwich,{item:j.sandwich,itemType:xe,iconImg:"".concat(Ne,"sandwich.png")}),Object(I.a)(be,j.teeth,{item:j.teeth,itemType:xe,iconImg:"".concat(Ne,"teeth.png")}),Object(I.a)(be,j.tooth,{item:j.tooth,itemType:xe,iconImg:"".concat(Ne,"tooth.png")}),Object(I.a)(be,j.torch,{item:j.torch,itemType:xe,iconImg:"".concat(Ne,"torch.png")}),Object(I.a)(be,j.tusk,{item:j.tusk,itemType:xe,iconImg:"".concat(Ne,"tusk.png")}),Object(I.a)(be,j.vase,{item:j.vase,itemType:xe,iconImg:"".concat(Ne,"vase.png")}),Object(I.a)(be,j.vial,{item:j.vial,itemType:xe,iconImg:"".concat(Ne,"vial.png")}),Object(I.a)(be,j.weeds,{item:j.weeds,itemType:xe,iconImg:"".concat(Ne,"weeds.png")}),be),qe=k.trinket,De=(ye={},Object(I.a)(ye,j.magicAmulet,{item:j.magicAmulet,itemType:qe,iconImg:"".concat("/img/items/trinkets/","magic_amulet.png")}),Object(I.a)(ye,j.ring,{item:j.ring,itemType:qe,iconImg:"".concat("/img/items/trinkets/","ring.png")}),ye),Ae=k.weapon,Re="/img/items/weapons/";!function(e){e[e.axe=0]="axe",e[e.bow=1]="bow",e[e.club=2]="club",e[e.crossbow=3]="crossbow",e[e.fist=4]="fist",e[e.flail=5]="flail",e[e.hammer=6]="hammer",e[e.melee=7]="melee",e[e.knife=8]="knife",e[e.staff=9]="staff",e[e.sword=10]="sword",e[e.poleArm=11]="poleArm"}(Oe||(Oe={})),function(e){e.kinetic="kinetic"}(ke||(ke={}));var Pe=(we={},Object(I.a)(we,j.battleAxe,{item:j.battleAxe,itemType:Ae,weaponType:Oe.axe,subText:"It's an axe for battle",iconImg:"".concat(Re,"battle_axe.png"),damage:Object(I.a)({},ke.kinetic,20)}),Object(I.a)(we,j.brassKnuckles,{item:j.brassKnuckles,itemType:Ae,weaponType:Oe.melee,subText:" Brass knuckles are pieces of metal shaped to fit around the knuckles.",iconImg:"".concat(Re,"brass_knuckles.png"),damage:Object(I.a)({},ke.kinetic,10)}),Object(I.a)(we,j.crossbow,{item:j.crossbow,itemType:Ae,weaponType:Oe.crossbow,subText:"Shoots and reloads fast",iconImg:"".concat(Re,"crossbow.png"),damage:Object(I.a)({},ke.kinetic,3)}),Object(I.a)(we,j.cleaver,{item:j.cleaver,itemType:Ae,weaponType:Oe.knife,subText:"A cleaver is a large knife that varies in its shape but usually resembles a rectangular-bladed hatchet.",iconImg:"".concat(Re,"cleaver.png"),damage:Object(I.a)({},ke.kinetic,5)}),Object(I.a)(we,j.club,{item:j.club,itemType:Ae,weaponType:Oe.club,subText:"A club is among the simplest of all weapons: a short staff or stick, usually made of wood, wielded as a weapon",iconImg:"".concat(Re,"club.png"),damage:Object(I.a)({},ke.kinetic,8)}),Object(I.a)(we,j.dagger,{item:j.dagger,itemType:Ae,weaponType:Oe.knife,subText:"Excellent for ritual sacrifice and cheese platters",iconImg:"".concat(Re,"dagger.png"),damage:Object(I.a)({},ke.kinetic,8)}),Object(I.a)(we,j.flail,{item:j.flail,itemType:Ae,weaponType:Oe.flail,subText:"A flail is a weapon consisting of a striking head attached to a handle by a flexible rope, strap, or chain. ",iconImg:"".concat(Re,"flail.png"),damage:Object(I.a)({},ke.kinetic,15)}),Object(I.a)(we,j.greatswordOfGwai,{item:j.greatswordOfGwai,itemType:Ae,weaponType:Oe.sword,subText:"Finer steel was seldom forged",iconImg:"".concat(Re,"greatsword-gwai.png"),unique:!0,damage:Object(I.a)({},ke.kinetic,25)}),Object(I.a)(we,j.khopesh,{item:j.khopesh,itemType:Ae,weaponType:Oe.sword,subText:"Dafuq is this. Can I get garlic sauce with that?",iconImg:"".concat(Re,"khopesh.png"),damage:Object(I.a)({},ke.kinetic,15)}),Object(I.a)(we,j.longbow,{item:j.longbow,itemType:Ae,weaponType:Oe.bow,subText:"A deadly killer from long range",iconImg:"".concat(Re,"longbow.png"),damage:Object(I.a)({},ke.kinetic,2)}),Object(I.a)(we,j.mace,{item:j.mace,itemType:Ae,weaponType:Oe.club,subText:"A mace is a blunt weapon, a type of club or virge that uses a heavy head on the end of a handle to deliver powerful blows.",iconImg:"".concat(Re,"mace.png"),damage:Object(I.a)({},ke.kinetic,15)}),Object(I.a)(we,j.morningStar,{item:j.morningStar,itemType:Ae,weaponType:Oe.club,subText:"A morning star is any of several medieval club-like weapons consisting of a shaft with an attached ball adorned with one or more spikes.",iconImg:"".concat(Re,"morning-star.png"),damage:Object(I.a)({},ke.kinetic,13)}),Object(I.a)(we,j.poisonedDagger,{item:j.poisonedDagger,itemType:Ae,weaponType:Oe.knife,subText:"Excellent for ritual sacrifice and cheese platters",iconImg:"".concat(Re,"poisoned-dagger.png"),damage:Object(I.a)({},ke.kinetic,12)}),Object(I.a)(we,j.ravenStaff,{item:j.ravenStaff,itemType:Ae,weaponType:Oe.staff,subText:"Kaa, kaa!",iconImg:"".concat(Re,"raven-staff.png"),damage:Object(I.a)({},ke.kinetic,13)}),Object(I.a)(we,j.savageStaff,{item:j.savageStaff,itemType:Ae,weaponType:Oe.staff,subText:"Savage dude",iconImg:"".concat(Re,"savage-staff.png"),damage:Object(I.a)({},ke.kinetic,8)}),Object(I.a)(we,j.spear,{item:j.spear,itemType:Ae,weaponType:Oe.poleArm,subText:"A spear is a pole weapon consisting of a shaft, usually of wood, with a pointed head. ",iconImg:"".concat(Re,"sword.png"),damage:Object(I.a)({},ke.kinetic,10)}),Object(I.a)(we,j.sword,{item:j.sword,itemType:Ae,weaponType:Oe.sword,subText:"An elegant weapon for a more civilized age",iconImg:"".concat(Re,"sword.png"),damage:Object(I.a)({},ke.kinetic,14)}),Object(I.a)(we,j.warhammer,{item:j.warhammer,itemType:Ae,weaponType:Oe.hammer,subText:"A war hammer is a late medieval weapon of war intended for close combat action, whose design resembles the hammer",iconImg:"".concat(Re,"warhammer.png"),damage:Object(I.a)({},ke.kinetic,16)}),we);function Me(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var We=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Me(n,!0).forEach((function(t){Object(I.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Me(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},Ee,{},_,{},Ce,{},Se,{},De,{},Pe),Le=We;function He(e){return We[e]}var Be=n(33),_e=function(){function e(){Object(x.a)(this,e)}return Object(N.a)(e,null,[{key:"init",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.texts=e,this.templates={},t&&this.compileAll(),this.initialized=!0}},{key:"get",value:function(e,t){if(!this.initialized)throw new Error("Error ".concat(this," not initialized!"));var n=this.getTemplate(e);return n?n(t):(console.error("Key '".concat(e,"' not found in TextManager")),"<<'".concat(e,"' missing>>"))}},{key:"getTextEntry",value:function(e){return this.get(e.key,e.context)}},{key:"getTemplate",value:function(e){var t=this.templates[e];return!t&&this.texts[e]&&(this.compile(e,this.texts[e]),t=this.templates[e]),t}},{key:"getQuestTitle",value:function(e){return this.get("quest-".concat(e,"-title"))}},{key:"getQuestDescription",value:function(e){return this.get("quest-".concat(e,"-description"))}},{key:"getResourceName",value:function(e){return this.get("resource-".concat(e,"-name"))}},{key:"getItemName",value:function(e){var t=k[He(e).itemType];return this.get("item-".concat(t,"-").concat(e,"-name"))}},{key:"getStructureName",value:function(e){return this.get("structure-".concat(e,"-name"))}},{key:"compileAll",value:function(){var e=this;Object.keys(this.texts).forEach((function(t){e.compile(t,e.texts[t])}))}},{key:"compile",value:function(e,t){var n=Be.compile(t);this.templates[e]=n}}]),e}();_e.initialized=!1,_e.texts=void 0,_e.templates=void 0,Be.registerHelper("item:name",(function(e,t){if(!Le[e])return new Be.SafeString("<<ITEM DEFINITION NOT FOUND: ".concat(e,">>"));switch(t){case"aA":return Fe(e);case"aD":case"aU":return Qe(e);default:var n=Le[e].name;return new Be.SafeString(n)}})),Be.registerHelper("structure:name",(function(e){var t=_e.get("structure-".concat(e,"-name"));return new Be.SafeString(t)}));var Ge,Fe=function(e){return Ue(e)},Ue=function(e){var t=_e.getItemName(e),n=_e.getTemplate("common-article-undefined");return new Be.SafeString("".concat(n({noun:t})))},Qe=function(e){var t=_e.getItemName(e),n=_e.getTemplate("common-article-defined");return new Be.SafeString("".concat(n({noun:t})))};n(163);!function(e){e[e.all=0]="all",e[e.town=1]="town",e[e.quest=2]="quest"}(Ge||(Ge={}));var Ve,ze=function(e){function t(e){var n;return Object(x.a)(this,t),(n=Object(S.a)(this,Object(q.a)(t).call(this,e))).state={expanded:!1,selectedTabId:"all"},n}return Object(D.a)(t,e),Object(N.a)(t,[{key:"render",value:function(){var e=this,t=[{label:_e.get("common-log-tab-all"),tabId:"all",tabType:Ge.all},{label:_e.get("common-log-tab-town"),tabId:"town",tabType:Ge.town}];this.props.questNames.forEach((function(e){t.push({channelContext:e,label:_e.getQuestTitle(e),tabId:"quest-".concat(e),tabType:Ge.quest})}));var n=[],r=t.find((function(t){return t.tabId===e.state.selectedTabId}));switch(r.tabType){case Ge.all:n=this.props.logEntries;break;case Ge.town:n=this.props.logEntries.filter((function(e){return e.channel===p.town}));break;case Ge.quest:n=this.props.logEntries.filter((function(e){return e.channel===p.quest&&e.channelContext===r.channelContext}))}var a=t.map((function(e){return h.createElement(R,{id:e.tabId,key:e.tabId},e.label)}));return h.createElement("div",{className:"log ".concat(this.state.expanded?"expanded":"")},h.createElement("div",{className:"tab-bar"},h.createElement(P,{className:"tabs",onTabSelected:function(t){return e.handleTabSelected(t)}},a),h.createElement(A,{className:"expand-button",onClick:function(){return e.handleToggleExpand()},text:this.state.expanded?"\u25bc":"\u25b2"})),h.createElement("div",{className:"log-entries"},n.map((function(e){return function(e){var t=_e.get(e.key,e.context);return h.createElement("div",{className:"entry",key:e.time},t)}(e)}))))}},{key:"handleTabSelected",value:function(e){this.setState({selectedTabId:e})}},{key:"handleToggleExpand",value:function(){this.setState({expanded:!this.state.expanded})}}]),t}(h.Component),Ke=n(37);!function(e){e[e.unavailable=0]="unavailable",e[e.available=1]="available",e[e.active=2]="active",e[e.completed=3]="completed"}(Ve||(Ve={}));var Xe,Je=function(e){return e.log},Ye=Object(Ke.a)([function(e){return e.quests}],(function(e){return e.filter((function(e){return e.status===Ve.active})).map((function(e){return e.name}))})),Ze=function(e,t){return Object(Ke.a)([Je],(function(e){return e.find((function(e){return e.channel===p.quest&&e.channelContext===t}))}))(e)},$e=Object(w.b)((function(e){return{logEntries:e.log,questNames:Ye(e)}}),(function(e){return{}}))(ze),et=n(34);!function(e){e[e.NotBuilt=0]="NotBuilt",e[e.Building=1]="Building",e[e.Built=2]="Built"}(Xe||(Xe={}));var tt,nt,rt,at={level:0,state:Xe.NotBuilt,workers:0};!function(e){e[e.town=0]="town",e[e.world=1]="world"}(tt||(tt={})),function(e){e[e.buttonClick=0]="buttonClick",e[e.error=1]="error"}(nt||(nt={}));var ot={},ct=null,it={},st=function(){function e(){Object(x.a)(this,e)}return Object(N.a)(e,null,[{key:"loadMedia",value:function(e){rt=e}},{key:"addSounds",value:function(e){Object.entries(e).forEach((function(e){var t=Object(C.a)(e,2),n=t[0],r=t[1];it[n]=rt.find((function(e){return e.url===r})).content}))}},{key:"playSound",value:function(e){it[e].play()}},{key:"addMusicTrack",value:function(e,t){var n=rt.find((function(e){return e.url===t}));if(!n)throw new Error("No sound found at ".concat(t));ot.hasOwnProperty(e)||(ot[e]=n.content)}},{key:"playMusicTrack",value:function(e){null!==ct&&ot[ct].fade(1,0,500);var t=ot[e];t.playing()||(t.loop(!0),t.play()),t.fade(0,1,500),ct=e}}]),e}(),ut=(n(208),function(e){function t(e){var n;return Object(x.a)(this,t),(n=Object(S.a)(this,Object(q.a)(t).call(this,e))).anim=void 0,n.handleStructureClick=function(e){n.props.onStructureClick&&n.props.onStructureClick(G[e.target.name()])},n.handleBackgroundClick=function(){n.props.onStructureClick&&n.props.onStructureClick(null)},n.state={images:{}},st.addMusicTrack(tt.town,"sound/music/Soliloquy.mp3"),n}return Object(D.a)(t,e),Object(N.a)(t,[{key:"componentDidMount",value:function(){this.playMusic()}},{key:"componentWillUnmount",value:function(){this.anim&&this.anim.stop(),delete this.anim}},{key:"render",value:function(){var e=this,t=Object.keys(G).map((function(t,n){var r=ve(t),a=e.props.structures[t];if(a.state===Xe.NotBuilt)return null;var o=r.levels[a.level],c=_e.get(o.displayName);return h.createElement(et.Text,{name:t,key:t,text:"\u2588 ".concat(c," (level ").concat(a.level+1,")"),x:100,y:90*n+100,fontSize:80,fill:"white",onClick:e.handleStructureClick})}));return console.log("rendered the town"),h.createElement(et.Stage,{width:1024,height:768,scale:{x:.4,y:.4}},h.createElement(et.Layer,{name:"background",onClick:this.handleBackgroundClick},h.createElement(et.Image,{image:this.imgSrc("img/town/sky.jpg")})),h.createElement(et.Layer,{name:"town"},h.createElement(et.Image,{name:"warehouse",image:this.imgSrc("img/town/tavern.png"),x:15,y:1057,shadowBlur:15,shadowColor:"red",shadowEnabled:!0,strokeWidth:30,ref:function(e){lt(e)}}),h.createElement(et.Image,{name:G.warehouse,image:this.imgSrc("img/town/lighthouse.png"),ref:function(e){lt(e)}}),h.createElement(et.Image,{name:"lumberMill",image:this.imgSrc("img/town/mill.png"),x:947,y:1384,shadowBlur:15,ref:function(e){lt(e)}}),t))}},{key:"imgSrc",value:function(e){var t=this.props.media.find((function(t){return t.url===e}));if(void 0===t)throw Error("Could not find image with url ".concat(e));return t.content}},{key:"playMusic",value:function(){st.playMusicTrack(tt.town)}}]),t}(h.Component)),lt=function(e){},mt=ut,dt=function(e){return function(t){function n(){return Object(x.a)(this,n),Object(S.a)(this,Object(q.a)(n).apply(this,arguments))}return Object(D.a)(n,t),Object(N.a)(n,[{key:"render",value:function(){var t=this;return h.createElement(Oa.Consumer,null,(function(n){return h.createElement(e,Object.assign({},t.props,n))}))}}]),n}(h.Component)},pt=n(16);var ft,gt,vt=Object(pt.c)(Object(w.b)((function(e,t){return{structures:e.structures}}),(function(e,t){return{}})),dt)(mt);function ht(e){return{type:ft.addGold,amount:e}}function bt(e){return{type:ft.addGold,amount:-e}}function yt(e){return{type:gt.addResources,resources:e}}!function(e){e.addGold="addGold"}(ft||(ft={})),function(e){e.addResources="addResources",e.removeResources="removeResources"}(gt||(gt={}));n(47),n(209);var wt,Ot,kt=function(e){var t=e.itemsInInventory,n=(e.className||"")+" itemsbox",r=e.items.reduce((function(e,t){return e[t]||(e[t]=0),e[t]++,e}),{}),a=Object.keys(r).map((function(e){var n=e,a=r[e],o="item";a>(t?t.filter((function(e){return e===n})).length:0)&&(o+=" missing");var c=Le[n];return h.createElement("li",{className:o,key:n},h.createElement("div",{className:"icon common-icon-smallest",style:{backgroundImage:"url(".concat(c.iconImg,")")}}),h.createElement("div",{className:"name"},"".concat(_e.getItemName(n)," (").concat(a,")")))}));return h.createElement("ul",{className:n},a)},jt=Object(w.b)((function(e,t){var n=[],r=Object(c.a)(e.items);return t.items.forEach((function(e){var t=r.findIndex((function(t){return t===e}));if(t>-1){var a=r.splice(t,1),o=Object(C.a)(a,1)[0];o&&n.push(o)}})),{itemsInInventory:n}}))(kt);!function(e){e.wood="wood",e.iron="iron",e.stone="stone",e.leather="leather",e.fabric="fabric",e.food="food"}(Ot||(Ot={}));var Et,Tt,It=(wt={},Object(I.a)(wt,Ot.wood,{resource:Ot.wood,iconImg:"/img/resources/wood.png"}),Object(I.a)(wt,Ot.iron,{resource:Ot.iron,iconImg:"/img/resources/iron.png"}),Object(I.a)(wt,Ot.stone,{resource:Ot.stone,iconImg:"/img/resources/stone.png"}),Object(I.a)(wt,Ot.leather,{resource:Ot.leather,iconImg:"/img/resources/leather.png"}),Object(I.a)(wt,Ot.fabric,{resource:Ot.fabric,iconImg:"/img/resources/fabric.png"}),Object(I.a)(wt,Ot.food,{resource:Ot.food,iconImg:"/img/resources/food.png"}),wt),Ct=(n(67),function(e){var t=e.sufficientResources,n=(e.className||"")+" resourcesbox",r=Object.keys(e.resources).map((function(n){var r="resource";t&&!t[n]&&(r+=" insufficient");var a=It[n];if(!a)throw new Error("No resource description found for ".concat(n));return h.createElement("li",{className:r,key:n},h.createElement("div",{className:"icon",style:{backgroundImage:"url(".concat(a.iconImg,")")}}),h.createElement("div",{className:"name"},_e.getResourceName(n)),h.createElement("div",{className:"amount"},e.resources[n]))}));return h.createElement("ul",{className:n},r)}),xt=Object(w.b)((function(e,t){var n={};return Object.keys(t.resources).forEach((function(r){n[r]=e.resources[r]>=t.resources[r]})),{sufficientResources:n}}))(Ct),Nt=function(e,t){if(t>6)throw new Error("Cannot possibly have more than ".concat(6," on one item!"));return e-.1*e*(t-1)};!function(e){e[e.item=0]="item"}(Et||(Et={})),function(e){e[e.smallest=0]="smallest",e[e.small=1]="small",e[e.medium=2]="medium",e[e.big=3]="big",e[e.biggest=4]="biggest"}(Tt||(Tt={}));var St=function e(t){switch(t){case Tt.smallest:return"common-icon-smallest";case Tt.small:return"common-icon-small";case Tt.medium:return"common-icon-medium";case Tt.big:return"common-icon-big";case Tt.biggest:return"common-icon-biggest"}return e(Tt.medium)},qt=(n(210),function(e){var t=e.item,n=He(t),r=h.useContext(Oa),a=h.useRef(null);n||console.warn("could not find definition for ".concat(t));var o="item-icon "+St(e.size);return h.createElement("div",{className:o,onClick:function(n){if(!1!==e.showContext){var o=n.currentTarget.getBoundingClientRect();r.onContextualObjectActivated(Et.item,He(t),a,o)}e.onClick&&e.onClick(n)},style:{backgroundImage:"url(".concat(n.iconImg,")")}})}),Dt=(n(211),function(e){var t,n,r,a=(t=e.progress||0,n=0,t>(r=1)?r:t<n?n:t);return h.createElement("div",{className:"progressbar"},h.createElement("div",{className:"progressbar-label"},e.label),h.createElement("div",{className:"progressbar-info",style:{width:"".concat(100*a,"%")}},"  "))});n(212);var At,Rt,Pt,Mt=function(e){var t;return t=null==e.max?e.value:h.createElement("span",null,e.value," / ",h.createElement("span",{className:"max"},e.max)),h.createElement("div",{className:"updownvalue"},h.createElement("label",null," ",e.label),t,h.createElement("i",{className:"arrow up"+(e.upDisabled?" disabled":""),onClick:function(t){e.onUp&&!e.upDisabled&&e.onUp(t)}}),h.createElement("i",{className:"arrow down"+(e.downDisabled?" disabled":""),onClick:function(t){e.onDown&&!e.downDisabled&&e.onDown(t)}}))},Wt=(n(213),function(e){var t=Object(h.useState)(),n=Object(C.a)(t,2),r=n[0],a=n[1],o=Object(h.useState)(0),c=Object(C.a)(o,2),i=c[0],s=c[1],u=ve(e.type);if(!u)throw new Error("No definition found for structure ".concat(e.type,"\n            with type ProductionStructureDefinition."));var l=e.level||0,m=u.levels[l],d=_e.getStructureName(e.type);return h.createElement("details",{open:!0,className:"productionstructureview"},h.createElement("summary",null,d),h.createElement("section",null,function(){var t=e.gold,n=u.levels[l+1],r=null!=n?n.cost.gold||0:-1,a=null!=n&&t>=r,o="Upgrade! (".concat(r<0?"max":r+" gold",")");return h.createElement("div",null,h.createElement("label",null,"level:"),l+1+" / "+u.levels.length,h.createElement("button",{style:{float:"right"},onClick:function(t){e.onUpgrade&&e.onUpgrade(r,l+1)},disabled:!a},o))}(),h.createElement("div",null,"craft:"),h.createElement("div",{className:"crafting-area"},h.createElement("ul",{className:"vertical-tab-bar"},m.produces.map((function(e){return h.createElement("li",{key:"craft".concat(e.item),onClick:function(t){t.stopPropagation(),a(e.item)},className:r===e.item?"selected":""},h.createElement(qt,{item:e.item}),_e.getItemName(e.item))}))),function(){var t=r;if(!t)return null;var n=m.produces.find((function(e){return e.item===t})),a=e.resources||{},o=n.cost.resources,c=Object.keys(o).some((function(e){return o[e]>a[e]})),u=!1,l=n.cost.materials;l&&(u=l.some((function(t){return-1===e.items.indexOf(t)})));var d=c||u||i<1,p=Le[t],f=null;return l&&(f=h.createElement(jt,{items:l})),h.createElement("div",{className:"crafting-details"},"Craft a ",_e.getItemName(p.item),h.createElement("div",{className:"crafting-costs"},h.createElement("fieldset",null,h.createElement(xt,{resources:o})),h.createElement("fieldset",null,f)),h.createElement("div",{style:{display:"flex "}},h.createElement(Mt,{value:i,label:"Workers: ",onUp:function(e){e.stopPropagation(),s(i+1)},onDown:function(e){e.stopPropagation(),s(i-1)},upDisabled:i>=e.workersFree||i>=6,downDisabled:i<1}),"\xa0",function(e){if(0===i)return"";var t=Nt(e,i),n=V(t);return" Crafting time: ".concat(n)}(n.cost.time||0)),h.createElement("div",null,h.createElement("button",{disabled:d,onClick:function(t){t.stopPropagation(),e.onCraft&&(e.onCraft(n,i),s(0))}},"Craft")))}()),h.createElement("fieldset",null,h.createElement("legend",null,"Currently crafting:"),(e.tasks||[]).map((function(e){return h.createElement(Dt,{key:"".concat(e.name).concat(e.startTime),label:"".concat(e.name," (").concat(V(e.timeRemaining),")"),progress:e.progress})})))))});function Lt(e,t){return{type:At.addItem,item:e,toSlot:t}}function Ht(e){return{type:Rt.finishBuildingStructure,structure:e}}function Bt(e){return{type:Rt.upgradeStructure,structure:e}}function _t(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return{type:Rt.increaseWorkers,structure:e,workers:t}}function Gt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return{type:Rt.decreaseWorkers,structure:e,workers:t}}function Ft(e,t,n,r,a){return{type:Pt.start,taskType:e,name:t,origin:n,time:r,callbacks:a}}!function(e){e.addItem="addItem",e.moveItemInWarehouse="moveItemInWarehouse",e.removeItem="removeItem"}(At||(At={})),function(e){e.upgradeStructure="upgradeStructure",e.increaseWorkers="increaseWorkers",e.decreaseWorkers="decreaseWorkers",e.startBuildingStructure="startBuildingStructure",e.finishBuildingStructure="finishBuildingStructure",e.setStructureState="setStructureState"}(Rt||(Rt={})),function(e){e.start="startTask",e.update="updateTasks"}(Pt||(Pt={}));var Ut,Qt=Object(Ke.a)([function(e){return e.structures},function(e){return e.workers}],(function(e,t){return t-Object.keys(e).map((function(t){return e[t]})).reduce((function(e,t){return e+t.workers}),0)}));!function(e){e[e.buildStructure=0]="buildStructure",e[e.craftItem=1]="craftItem"}(Ut||(Ut={}));var Vt=Object(w.b)((function(e,t){var n=e.structures[t.type],r=e.tasks.running.filter((function(e){return e.origin==="".concat(t.type,".craft")}));return{gold:e.gold,items:e.items,level:n.level,resources:e.resources,tasks:r,workersFree:Qt(e)}}),(function(e,t){return{onCraft:function(n,r){var a,o=Nt(n.cost.time||0,r);e((a=n.cost.resources||{},{type:gt.removeResources,resources:a})),e(_t(t.type,r));var c=[Lt(n.item),Gt(t.type,r)],i=Ft(Ut.craftItem,n.item,"".concat(t.type,".craft"),o,c);e(i)},onUpgrade:function(n,r){e(bt(n)),e(Bt(t.type)),r++,e(O("log-town-upgrade-structure-complete",{level:r,structure:t.type},p.town))}}}))(Wt),zt=function(e){var t=ve(e.type);if(!t)throw new Error("No definition found for structure ".concat(e.type," with type ResourceStructureDefinition."));var n=e.level||0,r=t.levels[n],a=_e.getStructureName(e.type);return h.createElement("details",{open:!0,className:"structureview"},h.createElement("summary",null,a),h.createElement("section",null,function(){var t=e.workers===r.workerCapacity||(e.workersFree||0)<1,n=0===e.workers;return h.createElement(Mt,{label:"workers:",value:e.workers,max:r.workerCapacity,upDisabled:t,downDisabled:n,onDown:function(){e.onWorkersDown&&e.onWorkersDown()},onUp:function(){e.onWorkersUp&&e.onWorkersUp()}})}(),function(){var r=e.gold||0,a=t.levels[n+1],o=null!=a?a.cost.gold||0:-1,c=null!=a&&r>=o,i="Upgrade! (".concat(o<0?"max":o+" gold",")");return h.createElement("div",null,h.createElement("label",null,"level:"),n+1+" / "+t.levels.length,h.createElement("button",{style:{float:"right"},onClick:function(t){e.onUpgrade&&e.onUpgrade(o,n+1)},disabled:!c},i))}(),function(){var t=r.generates,n=Object.keys(t).reduce((function(n,r){return t[r]&&n.push("".concat(t[r]," x ").concat(e.workers," = ").concat(t[r]*(e.workers||0)," ").concat(r)),n}),[]).join(",");return h.createElement("div",null,"Generates (every minute): ",h.createElement("br",null),n)}()))};var Kt,Xt=Object(w.b)((function(e,t){var n=e.structures[t.type];if(!n)throw new Error("No structure '".concat(t.type,"' found in the store!"));return{gold:e.gold,level:n.level,workers:n.workers,workersFree:Qt(e)}}),(function(e,t){return{onUpgrade:function(n,r){e(bt(n)),e(Bt(t.type)),r++,e(O("log-town-upgrade-structure-complete",{level:r,structure:t.type},p.town))},onWorkersDown:function(){e(Gt(t.type))},onWorkersUp:function(){e(_t(t.type))}}}))(zt);function Jt(e){return{type:Kt.advanceQuest,questName:e}}function Yt(e,t){return{type:Kt.startEncounter,questName:e,encounter:t}}!function(e){e.launchQuest="launchQuest",e.advanceQuest="advanceQuest",e.updateQuestVars="updateQuestVars",e.updateEncounterResult="updateEncounterResult",e.startEncounter="startEncounter",e.updateQuests="updateQuests"}(Kt||(Kt={}));var Zt,$t="adventurer",en="item";!function(e){e[e.adventurerInventory=0]="adventurerInventory",e[e.warehouse=1]="warehouse",e[e.tavern=2]="tavern",e[e.adventurerEquipment=3]="adventurerEquipment"}(Zt||(Zt={}));var tn=n(250),nn=(n(214),function(e){var t=e.adventurer,n=(e.className||"")+" avatar";return h.createElement("div",{className:n,style:{backgroundImage:"url(".concat(t.avatarImg,")")},onClick:function(){e.onClick&&e.onClick(e.adventurer.id)}},h.createElement("div",{className:"sizer"}),e.displayName&&h.createElement("div",{className:"name"},t.name))}),rn=(n(215),{beginDrag:function(e){return{adventurer:e.adventurer,sourceId:e.sourceId,sourceType:Zt.adventurerInventory}}});var an,on,cn=function(e){function t(){return Object(x.a)(this,t),Object(S.a)(this,Object(q.a)(t).apply(this,arguments))}return Object(D.a)(t,e),Object(N.a)(t,[{key:"render",value:function(){var e=this.props,t=e.isDragging,n=e.connectDragSource,r="draggable-adventurer-avatar";return e.disabled&&(r+=" disabled"),t&&(r+=" dragging"),n(h.createElement("div",{className:r},h.createElement(nn,this.props)))}}]),t}(h.Component),sn=Object(tn.a)($t,rn,(function(e,t){return{connectDragSource:e.dragSource(),isDragging:t.isDragging()}}))(cn);!function(e){e.backstabbed="backstabbed",e.goblinHouseHallway="goblinHouseHallway",e.goblinHouseOutside="goblinHouseOutside",e.theBigTree="theBigTree"}(an||(an={})),function(e){e[e.nothing=0]="nothing",e[e.encounter=1]="encounter",e[e.combat=2]="combat",e[e.boss=3]="boss"}(on||(on={}));var un={kill10Boars:{nodes:[{x:0,y:1,type:on.nothing,log:"quest-kill10Boars-node0"},{x:0,y:2,type:on.nothing,log:"quest-kill10Boars-node1"},{x:0,y:3,type:on.encounter,encounter:an.goblinHouseOutside},{x:1,y:3,type:on.nothing,log:"quest-kill10Boars-node4"},{x:1,y:3,type:on.nothing},{x:2,y:3,type:on.nothing},{x:3,y:3,type:on.encounter,encounter:an.backstabbed},{x:4,y:4,type:on.nothing,log:"The party spots a boss"},{x:5,y:4,type:on.boss}]},retrieveMagicAmulet:{requiredItems:[j.torch,j.torch,j.torch,j.sandwich,j.sandwich],nodes:[{x:0,y:1,type:on.nothing},{x:1,y:1,type:on.nothing,log:"Papa loves mambo"},{x:1,y:1,type:on.nothing,log:"Mama loves mambo"},{x:1,y:1,type:on.nothing,log:"Look at 'em sway with it"},{x:1,y:1,type:on.nothing,log:"gettin' so gay with it"},{x:1,y:1,type:on.nothing},{x:1,y:1,type:on.nothing},{x:0,y:2,type:on.encounter,encounter:an.theBigTree},{x:1,y:1,type:on.nothing},{x:1,y:1,type:on.nothing},{x:1,y:1,type:on.nothing},{x:1,y:1,type:on.nothing},{x:1,y:1,type:on.nothing},{x:1,y:1,type:on.nothing},{x:1,y:1,type:on.nothing},{x:1,y:1,type:on.nothing},{x:1,y:1,type:on.nothing},{x:2,y:1,type:on.encounter,encounter:an.backstabbed},{x:3,y:1,type:on.boss}]}},ln=un;function mn(e){return un[e]}var dn=n(251),pn=(n(217),function(e){function t(){return Object(x.a)(this,t),Object(S.a)(this,Object(q.a)(t).apply(this,arguments))}return Object(D.a)(t,e),Object(N.a)(t,[{key:"render",value:function(){var e=this.props,t=e.isOver,n=e.canDrop,r="droppable-adventurer-slot";return t?r+=" active-drop":n&&(r+=" can-drop"),(0,e.connectDropTarget)(h.createElement("div",{className:r}))}}]),t}(h.Component)),fn=Object(dn.a)($t,{drop:function(e,t){e.onDrop(t.getItem())},canDrop:function(e,t){return!0}},(function(e,t){return{canDrop:t.canDrop(),connectDropTarget:e.dropTarget(),isOver:t.isOver()}}))(pn),gn=(n(218),function(e){return h.createElement("ul",{className:"assign-adventurers"},function(){for(var t=[],n=function(n){var r=void 0,a="";if(!!e.assignedAventurers[n]){var o=e.assignedAventurers[n];r=h.createElement(nn,{adventurer:o,displayName:!1,onClick:function(){return e.onRemoveAdventurer(n)}}),a="has-adventurer"}else r=h.createElement(fn,{onDrop:function(t){e.onAddEventurer(t,n)}});t.push(h.createElement("li",{key:"slot".concat(n),className:a}," ",r," "))},r=0;r<e.availableSlots;r++)n(r);return t}())}),vn=(n(219),function(e){var t=e.availableQuests.map((function(t){var n="img/sigils/".concat(t.icon),r="quest"+(t.name===e.selectedQuestName?" selected":"");return h.createElement("li",{key:t.name,className:r,onClick:function(){e.onQuestClick(t.name)}},h.createElement("div",{className:"icon",style:{backgroundImage:"url(".concat(n,")")}}),h.createElement("div",{className:"title"},_e.getQuestTitle(t.name)," "))})),n=function(t){return!t.requiredItems||t.requiredItems.every((function(n){var r=t.requiredItems.filter((function(e){return e===n})).length;return e.items.filter((function(e){return e===n})).length>=r}))};return h.createElement("div",{className:"quest-board"},h.createElement("h2",null," ",_e.get("structure-tavern-title-quest-board")),h.createElement("ul",{className:"quest-list"},t),function(){if(!e.selectedQuestName)return null;var t=e.availableQuests.find((function(t){return t.name===e.selectedQuestName}));if(!t)return h.createElement("div",null," ",_e.get("structure-tavern-quest-launched")," ");var r=mn(t.name),a=e.assignedAventurers.filter((function(e){return null!==e})).length>=3,o=n(r),c=a&&o;return h.createElement("div",{className:"quest-details"},_e.getQuestDescription(e.selectedQuestName),h.createElement(gn,{availableSlots:5,assignedAventurers:e.assignedAventurers,onRemoveAdventurer:e.onRemoveAdventurer,onAddEventurer:e.onAddAdventurer}),h.createElement(jt,{items:r.requiredItems||[]}),h.createElement("button",{disabled:!c,onClick:function(){return e.onLaunchQuest()}},_e.get("structure-tavern-button-launch-quest")))}())});var hn,bn=Object(w.b)((function(e,t){return{items:e.items}}))(vn);n(220);function yn(e,t,n){return{type:hn.moveItemInInventory,adventurerId:e,fromSlot:t,toSlot:n}}function wn(e,t,n){return{type:hn.addItemToInventory,adventurerId:e,item:t,toSlot:n}}function On(e,t){return{type:hn.removeItemFromInventory,adventurerId:e,fromSlot:t}}function kn(e,t,n){return{type:hn.assignEquipment,adventurerId:e,item:n,equipmentSlot:t}}function jn(e,t){return{type:hn.removeEquipment,adventurerId:e,equipmentSlot:t}}!function(e){e.moveItemInInventory="moveItemInInventory",e.moveItemToOtherAdventurer="moveItemToOtherAdventurer",e.moveItemFromWarehouseToAdventurer="moveItemFromWarehouseToAdventurer",e.addItemToInventory="addItemToInventory",e.removeItemFromInventory="removeItemFromInventory",e.assignEquipment="assignEquipment",e.removeEquipment="removeEquipment"}(hn||(hn={}));n(221);var En,Tn=function(e){function t(){return Object(x.a)(this,t),Object(S.a)(this,Object(q.a)(t).apply(this,arguments))}return Object(D.a)(t,e),Object(N.a)(t,[{key:"render",value:function(){var e=this.props,t=e.item,n=e.onClick,r=e.isDragging,a=e.connectDragSource,o=e.size;return r?null:a(h.createElement("div",null,h.createElement(qt,{item:t,onClick:function(e){n&&n(e)},size:o})))}}]),t}(h.Component),In=Object(tn.a)(en,{beginDrag:function(e){return{inventorySlot:e.index,item:e.item,sourceId:e.sourceId,sourceType:e.sourceType}}},(function(e,t){return{connectDragSource:e.dragSource(),isDragging:t.isDragging()}}))(Tn),Cn=(n(222),{drop:function(e,t){e.onDrop(t.getItem())},canDrop:function(e,t){var n=t.getItem().item;return xn(n,e.type)}}),xn=function(e,t){switch(t){case En.chest:return Sn(e,M.chest);case En.feet:return Sn(e,M.feet);case En.hands:return Sn(e,M.hands);case En.head:return Sn(e,M.head);case En.legs:return Sn(e,M.legs);case En.mainHand:case En.offHand:return He(e).itemType===k.weapon;default:return!1}};!function(e){e[e.feet=0]="feet",e[e.hands=1]="hands",e[e.chest=2]="chest",e[e.legs=3]="legs",e[e.head=4]="head",e[e.shoulders=5]="shoulders",e[e.mainHand=6]="mainHand",e[e.offHand=7]="offHand"}(En||(En={}));var Nn=Object(dn.a)(en,Cn,(function(e,t){return{canDrop:t.canDrop(),connectDropTarget:e.dropTarget(),isOver:t.isOver()}}))((function(e){var t=e.isOver,n=e.canDrop,r="grey";return t&&n?r="green":n&&(r="orange"),(0,e.connectDropTarget)(h.createElement("div",{className:"equipment-slot",style:{borderColor:r},title:En[e.type]},e.children))})),Sn=function(e,t){var n=He(e);return n.itemType===k.apparel&&n.equipmentType===t},qn=(n(223),{drop:function(e,t){e.onDrop(t.getItem())},canDrop:function(e,t){var n=t.getItem();return n.sourceType!==Zt.adventurerEquipment||(null==e.item||xn(e.item,n.inventorySlot))}}),Dn=function(e){function t(){return Object(x.a)(this,t),Object(S.a)(this,Object(q.a)(t).apply(this,arguments))}return Object(D.a)(t,e),Object(N.a)(t,[{key:"render",value:function(){var e=this.props,t=e.isOver,n=e.canDrop,r=e.connectDropTarget,a=t&&n,o=["inventory-item",St(this.props.size)];return a?o.push("drop-active"):n&&o.push("drop-possible"),r(h.createElement("div",{className:o.join(" ")},this.props.children))}}]),t}(h.Component),An=Object(dn.a)(en,qn,(function(e,t){return{canDrop:t.canDrop(),connectDropTarget:e.dropTarget(),isOver:t.isOver()}}))(Dn),Rn=dt((function(e){for(var t=[],n=function(n){var r=void 0,a=e.items[n];a&&(r=h.createElement(In,{index:n,sourceId:e.sourceId,sourceType:e.sourceType,item:a}));var o=h.createElement(An,{key:"inventory-slot-".concat(n),item:a,size:e.iconSize,onDrop:function(t){if((t.inventorySlot!==n||t.sourceType!==e.sourceType||t.sourceId!==e.sourceId)&&e.onDropItem){var r=t.inventorySlot;e.onDropItem(t.item,r,n,t.sourceType,t.sourceId)}}},r);t.push(o)},r=0;r<e.items.length;r++)n(r);return h.createElement("div",{className:"inventory"},t)})),Pn=function(e){var t=h.useContext(Oa),n=e.adventurer,r=Object.keys(n.stats).map((function(e){var t=n.stats[e];return h.createElement("div",{key:"".concat(n.id,"-").concat(e)}," ",h.createElement("b",null,e),": ",t.toFixed(1)," ")})),a=function(r){var a=n.equipment[En[r]],o=null;if(a){var c=h.createRef();o=h.createElement(In,{index:r,sourceId:n.id,sourceType:Zt.adventurerEquipment,item:a,onClick:function(e){var n=e.currentTarget.getBoundingClientRect();t.onContextualObjectActivated(Et.item,He(a),c,n),e.stopPropagation()},ref:c,size:Tt.medium})}return h.createElement(h.Fragment,null,h.createElement(Nn,{onDrop:function(t){return function(t,r){var a=t.item;switch(t.sourceType){case Zt.adventurerInventory:e.onRemoveItemFromInventory(n.id,t.inventorySlot),e.onAssignEquipment(n.id,r,a);var o=n.equipment[En[r]];o&&e.onAddItemToInventory(n.id,o,t.inventorySlot);break;case Zt.adventurerEquipment:e.onAssignEquipment(n.id,r,a);var c=n.equipment[En[r]],i=t.inventorySlot;c?e.onAssignEquipment(n.id,i,c):e.onRemoveEquipment(n.id,i)}}(t,r)},type:r},o),h.createElement("span",{className:"info"},_e.get("ui-equipmentslot-".concat(En[r]))))},o=h.createElement("ul",null,h.createElement("li",null,a(En.head)),h.createElement("li",null,a(En.shoulders)),h.createElement("li",null,a(En.chest)),h.createElement("li",null,a(En.hands)),h.createElement("li",null,a(En.legs)),h.createElement("li",null,a(En.feet)),h.createElement("li",null,a(En.mainHand)),h.createElement("li",null,a(En.offHand)));return h.createElement("div",{className:"adventurer-info"},h.createElement("div",{className:"left"},h.createElement("div",{className:"name"},h.createElement("b",null,n.name)),h.createElement("div",{className:"attributes"},r),h.createElement("div",{className:"equipment"},o)),h.createElement("div",{className:"right"},h.createElement(Rn,{sourceType:Zt.adventurerInventory,sourceId:n.id,items:n.inventory,onDropItem:function(t,r,a,o,c){switch(o){case Zt.adventurerInventory:e.onMoveItemInInventory&&e.onMoveItemInInventory(n.id,r,a);break;case Zt.adventurerEquipment:e.onAddItemToInventory&&e.onRemoveEquipment&&e.onAddItemToInventory(n.id,t,a);var i=n.inventory[a];i?e.onAssignEquipment(n.id,r,i):e.onRemoveEquipment(n.id,r)}}})))},Mn=(n(224),function(e){var t=null;!1!==e.backEnabled&&(t=h.createElement(A,{className:"back-button",onClick:function(t){e.onBack&&e.onBack()},text:"<"}));var n=null;return!1!==e.closeEnabled&&(n=h.createElement(A,{className:"close-button",onClick:function(t){e.onClose&&e.onClose()},text:"x"})),h.createElement("div",{className:"window"},h.createElement("div",{className:"header"},t,h.createElement("h3",null,e.title),n),e.children)}),Wn=function(e){return function(t){function n(){return Object(x.a)(this,n),Object(S.a)(this,Object(q.a)(n).apply(this,arguments))}return Object(D.a)(n,t),Object(N.a)(n,[{key:"render",value:function(){return h.createElement(Mn,this.props,h.createElement(e,this.props))}}]),n}(h.Component)},Ln=Object(pt.c)(Wn,Object(w.b)((function(e,t){return{adventurer:e.adventurers.find((function(e){return e.id===t.adventurerId}))}}),(function(e){return{onAddItemToInventory:function(t,n,r){var a=wn(t,n,r);e(a)},onAssignEquipment:function(t,n,r){var a=kn(t,n,r);e(a)},onMoveItemInInventory:function(t,n,r){var a=yn(t,n,r);e(a)},onRemoveEquipment:function(t,n){var r=jn(t,n);e(r)},onRemoveItemFromInventory:function(t,n){var r=On(t,n);e(r)}}})))(Pn),Hn=function(e){var t=h.useState([]),n=Object(C.a)(t,2),r=n[0],a=n[1],o=h.useState(null),i=Object(C.a)(o,2),s=i[0],u=i[1],l=h.useContext(Oa),m=ve(G.tavern),d=e.level||0,p=m.levels[d],f=_e.getStructureName(G.tavern),g=p.rooms,v=e.quests.filter((function(e){return e.status===Ve.available})),b=function(t){return Object.values(e.quests).find((function(e){return e.party.indexOf(t)>-1}))},y=function(e){var t=h.createElement(Ln,{adventurerId:e.id,title:e.name});l.onOpenWindow(t)};return h.createElement("details",{open:!0,className:"tavernstructureview"},h.createElement("summary",null,f),function(){var t=e.gold,n=m.levels[d+1],r=null!=n?n.cost.gold||0:-1,a=null!=n&&t>=r,o="Upgrade! (".concat(r<0?"max":r+" gold",")");return h.createElement("div",null,h.createElement("label",null,"level:"),d+1+" / "+m.levels.length,h.createElement("button",{style:{float:"right"},onClick:function(t){e.onUpgrade&&e.onUpgrade(r,d+1)},disabled:!a},o))}(),h.createElement("section",null,function(){for(var t=[],n=function(n){var a=e.adventurers.find((function(e){return e.room===n})),o=null;if(a){var c=a.name,i=r.indexOf(a)>-1,s=b(a.id);s&&(c+=" (on a quest)"),o=[h.createElement(sn,{disabled:i||null!=s,adventurer:a,className:"adventurer-icon",sourceId:"tavern",key:"avatar:".concat(a.id)}),h.createElement("a",{key:a.id,onClick:function(){return y(a)}}," ",c)]}else o="(empty room)";t.push(h.createElement("div",{key:"room".concat(n),className:"room"},o))},a=0;a<g;a++)n(a);return h.createElement("div",{className:"rooms"},h.createElement("h2",null,"Rooms"),t)}(),h.createElement(bn,{availableQuests:v,selectedQuestName:s,assignedAventurers:r,onQuestClick:function(e){return function(e){u(s===e?null:e),a([])}(e)},onAddAdventurer:function(e,t){return function(e,t){if("tavern"===e.sourceId){var n=Object(c.a)(r);n[t]=e.adventurer,a(n)}}(e,t)},onRemoveAdventurer:function(e){return function(e){var t=Object(c.a)(r);delete t[e],a(t)}(e)},onLaunchQuest:function(){e.onLaunchQuest(s,r)}})))};var Bn=Object(w.b)((function(e,t){var n=e.structures[G.tavern];return{adventurers:e.adventurers,gold:e.gold,level:n.level,quests:e.quests}}),(function(e,t){return{onLaunchQuest:function(t,n){e(function(e,t){return{type:Kt.launchQuest,questName:e,assignedAventurers:t}}(t,n))},onUpgrade:function(t,n){e(bt(t)),e(Bt(G.tavern)),n++,e(O("log-town-upgrade-structure-complete",{level:n,structure:G.tavern},p.town))}}}))(Hn),_n=function(e){var t=e.sufficientResources,n=e.resources,r=e.deltaResources,a=(e.className||"")+" resourcesbox",o=Object.keys(n).map((function(n){var a="resource";t&&!t[n]&&(a+=" insufficient");var o,c=It[n],i=e.resources[n];if(!c)throw new Error("No resource description found for ".concat(n));return r[n]&&(o=h.createElement("span",{className:"animate-up"},"+ ".concat(r[n].toFixed(2)))),h.createElement("li",{className:a,key:n},h.createElement("div",{className:"icon common-icon-smallest",style:{backgroundImage:"url(".concat(c.iconImg,")")}}),h.createElement("div",{className:"name"},_e.getResourceName(n)),h.createElement("div",{className:"amount"},i.toFixed(1)),h.createElement("div",{className:"max"}," / ".concat(e.maxResources[n])),h.createElement("div",{className:"delta"},o))}));return h.createElement("ul",{className:a},o)},Gn=function(e){var t=Object(h.useRef)();return Object(h.useEffect)((function(){t.current=e})),t.current},Fn={fabric:0,food:0,iron:60,leather:0,stone:0,wood:40},Un={fabric:0,food:0,iron:0,leather:0,stone:0,wood:0},Qn=(n(225),Object(w.b)((function(e,t){return{adventurer:e.adventurers.find((function(e){return e.id===t.adventurerId}))}}),(function(e){return{onAddItemToInventory:function(t,n,r){var a=wn(t,n,r);e(a)},onAssignEquipment:function(t,n,r){var a=kn(t,n,r);e(a)},onMoveItemInInventory:function(t,n,r){var a=yn(t,n,r);e(a)},onRemoveEquipment:function(t,n){var r=jn(t,n);e(r)},onRemoveItemFromInventory:function(t,n){var r=On(t,n);e(r)}}}))(Pn)),Vn=Zt.warehouse,zn=function(e){var t=Object(h.useState)(),n=Object(C.a)(t,2),r=n[0],a=n[1],o=Object(h.useState)(Un),c=Object(C.a)(o,2),i=c[0],s=c[1],u=Gn(e.resources),l=Object(h.useRef)(null);Object(h.useEffect)((function(){var t=Object.keys(e.resources).reduce((function(t,n){return u&&u[n]&&(t[n]=e.resources[n]-u[n]),t}),{});s(t)}),[e.resources]),Object(h.useEffect)((function(){if(l.current){var e=l.current;e.classList.remove("animate"),setTimeout((function(){l&&e.classList.add("animate")}),200)}}),[i]);var m=ve(G.warehouse);if(!m)throw new Error("No definition found for structure ".concat(G.warehouse," with type StructureDefinition."));var d=e.level,p=_e.getStructureName(G.warehouse);return h.createElement("details",{open:!0,className:"warehouse-structureview"},h.createElement("summary",null,p),function(){var t=e.gold,n=m.levels[d+1],r=null!=n?n.cost.gold||0:-1,a=null!=n&&t>=r,o="Upgrade! (".concat(r<0?"max":r+" gold",")");return h.createElement("div",null,h.createElement("label",null,"level:"),d+1+" / "+m.levels.length,h.createElement("button",{style:{float:"right"},onClick:function(t){e.onUpgrade&&e.onUpgrade(r,d+1)},disabled:!a},o))}(),h.createElement("fieldset",{className:"resources",ref:l},h.createElement("legend",null,"Resources"),h.createElement(_n,{resources:e.resources,maxResources:e.maxResources,deltaResources:i})),h.createElement(Rn,{sourceType:Vn,items:e.items,onDropItem:function(t,n,r,a,o){switch(a){case Vn:e.onMoveItemInWarehouse&&e.onMoveItemInWarehouse(n,r);break;case Zt.adventurerInventory:e.onMoveItemFromAdventurer&&e.onMoveItemFromAdventurer(o,t,n,r)}}}),h.createElement("h3",null,"Adventurers"),h.createElement("div",null,h.createElement(P,{className:"adventurers-tabstrip",onTabSelected:function(e){a(e)}},e.adventurersInTown.map((function(e){return t=e,h.createElement(R,{id:t.id,key:t.id},h.createElement(nn,{adventurer:t,className:"common-icon-small"}));var t}))),h.createElement("div",{className:"adventurer-inventory"},r?h.createElement(Qn,{adventurerId:r}):null)))},Kn=function(e){return e.adventurers},Xn=function(e){return e.quests},Jn=(Object(Ke.a)([Kn,Xn],(function(e,t){var n=[],r=function(t){return e.find((function(e){return e.id===t}))},a=Object.values(t).reduce((function(e,t){var a=t.party.map((function(e){return r(e)}));return t.status===Ve.active&&(e[t.name]=a),n.push.apply(n,Object(c.a)(a)),e}),{});return a.solo=e.filter((function(e){return-1===n.indexOf(e)})),a})),Object(Ke.a)([Kn,Xn],(function(e,t){var n=t.reduce((function(e,t){return t.status===Ve.active&&e.push.apply(e,Object(c.a)(t.party)),e}),[]);return e.filter((function(e){return-1===n.indexOf(e.id)}))})));var Yn=Object(w.b)((function(e,t){var n=e.structures[G.warehouse],r=ve(G.warehouse),a=n.level,o=r.levels[a],c=Jn(e);if(!n)throw new Error("No structure '".concat(G.warehouse,"' found in the store!"));return{adventurersInTown:c,gold:e.gold,items:e.items,level:a,maxResources:o.maxResources,resources:e.resources,workers:n.workers,workersFree:Qt(e)}}),(function(e,t){return{onMoveItemFromAdventurer:function(t,n,r,a){var o=On(t,r);e(o);var c=Lt(n,a);e(c)},onMoveItemInWarehouse:function(t,n){e(function(e,t){return{type:At.moveItemInWarehouse,fromSlot:e,toSlot:t}}(t,n))},onMoveItemInInventory:function(t,n,r){var a=yn(t,n,r);e(a)},onMoveItemToAdventurer:function(t,n,r,a){var o=function(e){return{type:At.removeItem,fromSlot:e}}(r);e(o);var c=wn(t,n,a);e(c)},onUpgrade:function(t,n){e(bt(t)),e(Bt(G.warehouse)),n++,e(O("log-town-upgrade-structure-complete",{level:n,structure:G.warehouse},p.town))}}}))(zn),Zn=(n(226),function(e){var t;if(e.structures[e.structure].state===Xe.Building){var n=e.buildTask?e.buildTask.progress:1;t=h.createElement("div",null,h.createElement(Dt,{label:"Building...",progress:n}))}else t=function(e){switch(ve(e).type){case H.production:return h.createElement(Vt,{type:e});case H.resource:return h.createElement(Xt,{type:e});case H.warehouse:return h.createElement(Yn,null);case H.tavern:return h.createElement(Bn,null);default:return h.createElement("div",null," ",e," ")}}(e.structure);return h.createElement("fieldset",{className:"structure-details"},h.createElement("legend",null,"Structure"),t)});var $n=Object(pt.c)(Object(w.b)((function(e,t){return{buildTask:e.tasks.running.filter((function(e){return"town"===e.origin&&e.name==="".concat(t.structure,".build")}))[0],structures:e.structures}}),(function(e){return{onCheatGold:function(t){return e(ht(t))},onCheatResources:function(t){return e(yt(t))}}})),Wn)(Zn),er=n(36),tr=n(1),nr=n(103),rr=new tr.Vector3(-50,150,50),ar=function(e){var t=Object(er.c)().camera,n=Object(h.useRef)();Object(h.useEffect)((function(){var e=new nr.a(t);if(e.enableDamping=!0,e.dampingFactor=.05,e.screenSpacePanning=!0,e.minDistance=1,e.maxDistance=250,e.maxPolarAngle=Math.PI/2,e.target=new tr.Vector3(0,0,0),n.current=e,t.position.copy(rr),localStorage.getItem("worldpos")){var r=JSON.parse(localStorage.getItem("worldpos"));r&&(t.position.copy(r.cam),e.target.copy(r.target))}}),[t]),Object(h.useEffect)((function(){if(n.current&&e.scrollToPosition){var r=e.scrollToPosition,a=r.x,o=r.y,c=new tr.Vector3(a,0,o);n.current.target=c,t.position.copy(new tr.Vector3(a+rr.x,rr.y,rr.z+o))}return function(){n.current&&(n.current.enabled=!1)}}),[e.scrollToPosition]),Object(er.b)((function(){n.current&&n.current.update(),r.current,e.onCameraMove(t,n.current),localStorage.setItem("worldpos",JSON.stringify({cam:t.position,target:n.current.target}))}),!1),Object(h.useEffect)((function(){return function(){}}),[t.position]);var r=Object(h.useRef)(!1);return Object(h.useEffect)((function(){var e=function(){r.current=!0},t=function(){r.current=!1};return document.addEventListener("mousedown",e),document.addEventListener("mouseup",t),function(){document.removeEventListener("mousedown",e),document.removeEventListener("mouseup",t)}}),[]),null},or=function(e){var t=new tr.SphereGeometry(5,32,32),n=new tr.MeshBasicMaterial({color:"purple"});return t?b.a.createElement("mesh",{name:e.name,position:e.position,onClick:function(t){e.onClick&&e.onClick(t.object)},geometry:t,material:n}):null};var cr,ir=function(e){var t=Object(er.c)().scene;return Object(h.useEffect)((function(){window.scene||(window.scene=t),window.THREE=tr}),[]),null},sr=n(114),ur=n(113),lr=n(106),mr=function(e){var t=Object(h.useState)(),n=Object(C.a)(t,2),r=n[0],a=n[1];return Object(h.useEffect)((function(){e.toLowerCase().endsWith("obj")?(new lr.a).load(e,(function(e){})):e.toLowerCase().endsWith("dae")?(new sr.a).load(e,(function(e){var t=new tr.Group;t.children.push(e.scene),a(t)})):e.toLowerCase().endsWith("fbx")?(new ur.a).load(e,(function(e){a(e)}),void 0,(function(t){console.error("Error loading model ".concat(e),t)})):console.error("Unknown format for model ".concat(e))}),[e]),r},dr=b.a.forwardRef((function(e,t){var n="models/terrain/terrain-grass.dae",r=Object(h.useMemo)((function(){return(new tr.TextureLoader).load("models/terrain/grass1.png")}),["models/terrain/grass1.png"]),a=mr(n),o=Object(h.useMemo)((function(){return a?a.children[0].children[0].geometry:null}),[a]);return r&&(r.wrapS=r.wrapT=tr.RepeatWrapping),o&&r?b.a.createElement("mesh",{name:"Model (".concat(n,")"),scale:e.scale||[1,1,1],rotation:e.rotation,ref:t},b.a.createElement("meshBasicMaterial",{attach:"material",fog:!0},b.a.createElement("primitive",{attach:"map",object:r})),b.a.createElement("bufferGeometry",Object.assign({attach:"geometry"},o))):null})),pr=b.a.forwardRef((function(e,t){var n=fr(e.size||new tr.Vector3(1,1,1)),r=new tr.BoxGeometry(n.x,n.y,n.z),a=new tr.MeshBasicMaterial({color:e.color||"green"});return r?b.a.createElement("mesh",{name:e.name,position:e.position,onClick:function(t){e.onClick&&e.onClick(t.object)},geometry:r,material:a,ref:t}):null})),fr=function(e){if(e instanceof tr.Vector3)return e;var t=Object(C.a)(e,3),n=t[0],r=t[1],a=t[2];return new tr.Vector3(n,r,a)},gr=function(e){var t=mr(e.url),n=Object(h.useMemo)((function(){return t?t.children[0].geometry:null}),[t]),r=Object(h.useMemo)((function(){return(new tr.TextureLoader).load("models/world/human/Textures/RTS_human_atlas_4096.png")}),["models/world/human/Textures/RTS_human_atlas_4096.png"]);return n&&r?b.a.createElement("mesh",{name:"Model (".concat(e.url,")"),position:e.position,scale:[.01,.01,.01]},b.a.createElement("meshBasicMaterial",{attach:"material",fog:!0,map:r}),b.a.createElement("bufferGeometry",Object.assign({attach:"geometry"},n))):null},vr=n(107),hr=n.n(vr),br=[Math.PI/180*-90,0,0],yr=[40,40,40],wr=new tr.Vector3(0,0,0),Or=function(e){hr()(e);var t=Object(h.useRef)(null),n=Object(h.useRef)(e.activeQuests.map((function(){return Object(h.createRef)()})));return Object(h.useEffect)((function(){console.log(n.current[0].current),n.current.map((function(e){var n=e.current;if(n){var r=Ir(n.position,t.current);n.position.copy(r)}}))}),[e.activeQuests,t]),b.a.createElement(er.a,{style:{height:690,width:648},camera:{fov:10}},b.a.createElement(ir,null),b.a.createElement(ar,{onCameraMove:function(t){var n=kr(t,e.compassCenter),r=n.x,a=n.z,o=new tr.Vector2(r,a),c=o.distanceTo(new tr.Vector2(wr.x,wr.z)),i=o.angle();e.onMapMove(c,i)},scrollToPosition:e.scrollToPosition}),b.a.createElement(dr,{rotation:br,scale:yr,ref:t}),b.a.createElement(or,{onClick:function(e){},position:[62,0,14],name:"party1"}),(console.log("rendering parties"),e.activeQuests.map((function(t,r){var a=jr(t);return b.a.createElement(pr,{key:t.name,size:[1,1,1],position:a,color:t.name===e.selectedQuest?"white":"red",onClick:function(){return n=t.name,void e.onPartyClick(n);var n},ref:n.current[r]})}))),b.a.createElement(pr,{size:[1,1,1],position:[0,0,1],color:"blue"}),b.a.createElement(pr,{size:[1,1,1],position:[1,0,2],color:"blue"}),b.a.createElement(gr,{url:"models/world/human/house_atlas.fbx",position:[10,0,0]}),b.a.createElement(gr,{url:"models/world/human/smithy_atlas.fbx",position:[20,0,10]}))},kr=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=new tr.Vector3;r.set(t.x/648*2-1,-t.y/690*2+1,.5),r.unproject(e);var a=r.sub(e.position).normalize(),o=(n-e.position.y)/a.y;return e.position.clone().add(a.multiplyScalar(o))},jr=function(e){var t=mn(e.name),n=Math.floor(e.progress),r=t.nodes[n],a=new tr.Vector3(r.x,0,r.y),o=t.nodes[n+1];if(!o)return a;var c=new tr.Vector3(o.x,0,o.y);return a.lerp(c,e.progress-n)},Er=new tr.Vector3(0,-1,0),Tr=new tr.Raycaster,Ir=function(e,t){var n=e.clone();Tr.set(new tr.Vector3(e.x,10,e.y),Er);var r=Tr.intersectObject(t);return r.length>0&&r[0].distance>0&&(n.y=r[0].point.y),n},Cr=(n(228),function(e){function t(){return Object(x.a)(this,t),Object(S.a)(this,Object(q.a)(t).apply(this,arguments))}return Object(D.a)(t,e),Object(N.a)(t,[{key:"render",value:function(){return(0,this.props.connectDropTarget)(h.createElement("div",{className:"droppable-adventurer-avatar"},h.createElement(nn,{adventurer:this.props.adventurer,onClick:this.props.onClick})))}}]),t}(h.Component)),xr=Object(dn.a)(en,{drop:function(e,t){e.onDrop(t.getItem())},canDrop:function(e,t){return!0}},(function(e,t){return{canDrop:t.canDrop(),connectDropTarget:e.dropTarget(),isOver:t.isOver()}}))(Cr),Nr=function(e,t){return t.party.map((function(t){return Sr(e,t)}))},Sr=function(e,t){return e.adventurers.find((function(e){return e.id===t}))},qr=function(e){return!!e.rngState},Dr=n(108),Ar=n.n(Dr);function Rr(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return e=Math.ceil(e),t=Math.floor(t),Math.floor(function(){if(!cr)throw new Error("Call init() before random()");return Pr=!0,cr()}()*(t-e+1))+e}var Pr=!1,Mr=function(){function e(t,n){Object(x.a)(this,e),this.questName=void 0,this.store=void 0,this.questName=t,this.store=n}return Object(N.a)(e,[{key:"getAdventurerWithHighest",value:function(e){return Nr(this.store,this.quest).concat().sort((function(t,n){return n.stats[e]-t.stats[e]}))[0]}},{key:"getAdventurerWithLowest",value:function(e){return Nr(this.store,this.quest).concat().sort((function(t,n){return t.stats[e]-n.stats[e]}))[0]}},{key:"getRandomAdventurer",value:function(){return this.adventurers[Rr(0,this.adventurers.length)]}},{key:"questVars",get:function(){return this.quest.questVars}},{key:"quest",get:function(){var e=this;return this.store.quests.find((function(t){return t.name===e.questName}))}},{key:"adventurers",get:function(){return Nr(this.store,this.quest)}}]),e}(),Wr={},Lr={name:an.backstabbed,getOracle:function(e,t){return new Mr(e,t)},getDescription:function(e){return{key:"encounter-backstabbed-description"}},getOptions:function(e){return{fight:"Fight the brigands",flight:"Run away!"}},answer:function(e,t,n){switch(e){case"flight":return"You run away like a pussy";case"fight":var r=t.getRandomAdventurer();return n(wn(r.id,j.deedForWeaponsmith)),"The party fights off the rogues. One of them drops a document. ".concat(r.name," picks it up");default:throw new Error("Unhandled option '".concat(e))}}},Hr={name:an.goblinHouseOutside,getOracle:function(e,t){return new Mr(e,t)},getDescription:function(e){return{key:"encounter-goblinHouseOutside-description"}},getOptions:function(e){return{investigate:"Investigate",leave:"Keep walking"}},answer:function(e,t,n){t.store,t.questVars;var r=t.quest;switch(e){case"investigate":return n(Yt(r.name,an.goblinHouseHallway)),"The party coutiously opens the door and goes inside";case"leave":return n(Yt(r.name,an.goblinHouseHallway)),"The party coutiously opens the door and goes inside";default:throw new Error("Unhandled option ".concat(e))}}},Br={backstabbed:Lr,goblinHouseHallway:{name:an.goblinHouseHallway,getOracle:function(e,t){return new Mr(e,t)},getDescription:function(e){return{key:"encounter-goblinHouseHallway-description"}},getOptions:function(e){return{investigate:"Go inside the house",leave:"Leave the premise"}},answer:function(e,t,n){t.store,t.questVars,t.quest;switch(e){case"walkAround":return"Your party walks around the tree";case"leave":return n(Jt(t.questName)),"The party escapes the house unscathed";default:throw new Error("Unhandled option ".concat(e))}}},goblinHouseOutside:Hr,theBigTree:{name:an.theBigTree,getOracle:function(e,t){return new Mr(e,t)},getDescription:function(e){return{key:"encounter-thebigtree-description"}},getOptions:function(e){var t=e.getAdventurerWithHighest("strength");return{walkAround:"Walk around the tree",lift:"Lift the tree (".concat(t.name,")")}},answer:function(e,t,n){var r=t.questVars,a=t.quest;switch(e){case"walkAround":return"Your party walks around the tree";case"lift":var o=t.getAdventurerWithHighest("strength");r.treeState="lifted",n(function(e,t){return{type:Kt.updateQuestVars,questName:e,vars:t}}(a.name,r));var c=Rr(2,5);return n(ht(c)),"".concat(o.name," heaves and lifts the heavy tree, moving it aside. Underneath your party finds ").concat(c," gold coins");default:throw new Error("Unhandled option ".concat(e))}}}},_r=Br;n(237);var Gr=function(e){function t(e){var n;return Object(x.a)(this,t),(n=Object(S.a)(this,Object(q.a)(t).call(this,e))).getAvatars=function(){return n.props.adventurers.map((function(e){var t=n.state.selectedAdventurer===e.id;return b.a.createElement(xr,{key:"".concat(e.id,"-avatar"),className:t?" selected":"",adventurer:e,onClick:function(){return n.handleAvatarClick(e.id)},onDrop:function(t){var r=n.state.selectedAdventurer;if(e.id!==r&&n.props.onMoveItemToOtherAdventurer){var a=t.inventorySlot;n.props.onMoveItemToOtherAdventurer(r,a,e.id)}}})}))},n.getBottomPart=function(){if(n.state.selectedAdventurer){var e=n.props.adventurers.find((function(e){return e.id===n.state.selectedAdventurer}));return n.getAdventurerInfo(e)}var t=n.props.quest,r=mn(t.name),a=Math.floor(t.progress),o=r.nodes[a],c=b.a.createElement("p",null),i=b.a.createElement("p",null);switch(o.type){case on.nothing:c=b.a.createElement("div",null," ",n.props.lastLog&&_e.getTextEntry(n.props.lastLog)," ");break;case on.encounter:var s=n.props.store,u=function(e){return Br[e]}(t.currentEncounter),l=u.getOracle(t.name,s),m=u.getDescription(l),d=_e.getTextEntry(m);c=b.a.createElement("div",null,b.a.createElement("p",null," ",d," "));var p=u.getOptions(l);i=b.a.createElement("ul",null,Object.keys(p).map((function(e){return b.a.createElement("li",{key:e},b.a.createElement("button",{onClick:function(){return n.handleEncounterOptionClick(u,e,l)}},e),p[e])})));break;case on.boss:c=b.a.createElement("p",null," ","Boss fight!"," ")}return b.a.createElement("div",{className:"questlog"},c,b.a.createElement("div",{className:"actions"},i))},n.state={selectedAdventurer:null},n}return Object(D.a)(t,e),Object(N.a)(t,[{key:"render",value:function(){return b.a.createElement("div",{className:"partywindow"},b.a.createElement("div",{className:"avatars"},this.getAvatars()),this.getBottomPart())}},{key:"componentDidUpdate",value:function(e){e.quest!==this.props.quest&&this.setState({selectedAdventurer:null})}},{key:"getAdventurerInfo",value:function(e){return e?b.a.createElement(Qn,{adventurerId:e.id}):null}},{key:"handleAvatarClick",value:function(e){this.state.selectedAdventurer===e&&(e=null),this.setState({selectedAdventurer:e})}},{key:"handleEncounterOptionClick",value:function(e,t,n){var r=e.answer(t,n,this.props.onDispatch);this.props.onUpdateEncounterResult(this.props.quest.progress,r)}}]),t}(b.a.Component);var Fr=Object(pt.c)(Object(w.b)((function(e,t){return{adventurers:Nr(e,t.quest),lastLog:Ze(e,t.quest.name),store:e}}),(function(e,t){return{onAdvanceQuest:function(t){e(Jt(t))},onDispatch:e,onMoveItemInInventory:function(t,n,r){var a=yn(t,n,r);e(a)},onMoveItemToOtherAdventurer:function(t,n,r){var a=function(e,t,n,r){return{type:hn.moveItemToOtherAdventurer,adventurerId:e,fromSlot:t,toAdventurerId:n,toSlot:r}}(t,n,r);e(a)},onUpdateEncounterResult:function(n,r){var a=function(e,t,n){return{type:Kt.updateEncounterResult,questName:e,nodeIndex:t,result:n}}(t.quest.name,n,r);e(a)}}})),Wn)(Gr),Ur=(n(238),function(e){var t=Object(h.useRef)(null),n=Object(h.useState)(),r=Object(C.a)(n,2),a=r[0],o=r[1],c=Object(h.useState)(),i=Object(C.a)(c,2),s=i[0],u=i[1],l=b.a.useContext(Oa);Object(h.useEffect)((function(){st.addMusicTrack(tt.world,"sound/music/TheLoomingBattle.ogg"),st.playMusicTrack(tt.world)}),[]);var m=Object(h.useMemo)((function(){return e.quests.filter((function(e){return e.status===Ve.active}))}),[e.quests]);return b.a.createElement("div",{className:"realworldview"},b.a.createElement("div",{className:"compass",ref:t,onClick:function(){o(new tr.Vector2(1,1))}},b.a.createElement("div",{className:"distance"})),b.a.createElement(Or,{quests:e.quests,activeQuests:m,selectedQuest:s,compassCenter:new tr.Vector2(525,585),scrollToPosition:a,onMapMove:function(e,n){var r=t.current,a=r.firstElementChild;r.style.transform="rotate(".concat(n-Math.PI/2,"rad)"),r.style.opacity=e>10?"1":"0",a.style.transform="rotate(".concat(-n+Math.PI/2,"rad)"),a.innerHTML="".concat(e.toFixed(0))},onPartyClick:function(t){u(t),console.log(t);var n=e.quests.find((function(e){return e.name===t})),r=_e.getQuestTitle(n.name),a=b.a.createElement(Fr,{quest:n,title:r});l.onOpenWindow(a)}}))});var Qr,Vr=Object(w.b)((function(e,t){return{quests:e.quests}}),(function(e,t){return{onAdvanceQuest:function(e){}}}))(Ur);n(239);!function(e){e[e.bottom=0]="bottom",e[e.top=1]="top",e[e.left=2]="left",e[e.right=3]="right"}(Qr||(Qr={}));var zr,Kr=["img/terrain/mountains512.png","img/town/effects/plasma_beam_heavy_green.png","img/town/effects/smoke.png","img/town/sky.jpg","img/town/lighthouse.png","img/town/tavern.png","img/town/mill.png","sound/fx/button-click.ogg","sound/fx/error.ogg","sound/music/Soliloquy.mp3","sound/music/TheLoomingBattle.ogg"],Xr=n(249),Jr=n(112),Yr=n(49),Zr=n(38);!function(e){e.addWorkers="addWorkers"}(zr||(zr={}));n(99);var $r,ea=function(e){function t(e){var n;return Object(x.a)(this,t),(n=Object(S.a)(this,Object(q.a)(t).call(this,e))).itemSelectRef=void 0,n.handleCheatGold=function(e){var t=n.state.gold;n.props.onCheatGold&&n.props.onCheatGold(t)},n.handleCheatWorkers=function(e){var t=n.state.workers;n.props.onCheatWorkers&&n.props.onCheatWorkers(t)},n.handleCheatResources=function(e){n.props.onCheatResources&&n.props.onCheatResources(n.state.resources)},n.handleCheatItem=function(e){var t=n.itemSelectRef.current.value;n.props.onCheatItem&&n.props.onCheatItem(t)},n.handleChangeStructureState=function(e,t){n.props.onCheatStructureState&&n.props.onCheatStructureState(e,t?Xe.Built:Xe.NotBuilt)},n.handleChangeGold=function(e){var t=Number(e.target.value);n.setState({gold:t})},n.handleChangeWorkers=function(e){var t=Number(e.target.value);n.setState({workers:t})},n.handleChangeResources=function(e){var t=Number(e.target.checked);n.setState({resources:t})},n.state={gold:50,resources:50,workers:10},n.itemSelectRef=h.createRef(),n}return Object(D.a)(t,e),Object(N.a)(t,[{key:"render",value:function(){var e=this,t=Object.keys(this.props.structures).map((function(t){return function(t){var n=ve(t),r=e.props.structures[t],a=n.levels[r.level],o=_e.get(a.displayName);return h.createElement("div",{className:"label-dropdown",key:t},h.createElement("label",{title:t},"".concat(o)),h.createElement("input",{key:t,type:"checkbox",checked:e.props.structures[t].state===Xe.Built,onChange:function(){return e.handleChangeStructureState(t,e.props.structures[t].state!==Xe.Built)}}))}(t)})),n=function(e){return h.createElement("option",{value:e,key:e},_e.getItemName(e))},r=Object.keys(k).filter((function(e){return!isNaN(e)})).map((function(e){return h.createElement("optgroup",{label:k[e],key:e},function(e){return Object.keys(j).filter((function(t){return He(t).itemType==e})).map((function(e){return n(e)}))}(e))}));return h.createElement("div",{className:"cheat-box"},h.createElement("div",{className:"label-numberbox-button"},h.createElement("label",null,"Gold"),h.createElement("input",{type:"number",value:this.state.gold,style:{width:"50px"},onChange:this.handleChangeGold}),h.createElement("button",{onClick:this.handleCheatGold},"Add")),h.createElement("div",{className:"label-numberbox-button"},h.createElement("label",null,"Workers"),h.createElement("input",{type:"number",value:this.state.workers,style:{width:"50px"},onChange:this.handleChangeWorkers}),h.createElement("button",{onClick:this.handleCheatWorkers},"Add")),h.createElement("div",{className:"label-numberbox-button"},h.createElement("label",null,"Resources"),h.createElement("input",{type:"number",value:this.state.resources,style:{width:"50px"},onChange:this.handleChangeResources}),h.createElement("button",{onClick:this.handleCheatResources},"Add")),h.createElement("div",{className:"label-numberbox-button"},h.createElement("label",null,"Items"),h.createElement("select",{style:{width:"150px"},ref:this.itemSelectRef},r),h.createElement("button",{onClick:this.handleCheatItem},"Add")),t)}}]),t}(h.Component),ta=[Ot.food,Ot.wood,Ot.stone,Ot.fabric,Ot.leather],na=Object(pt.c)(Object(w.b)((function(e){return{structures:e.structures}}),(function(e){return{onCheatGold:function(t){e(ht(t)),e(O("common-cheat-gold-added",{amount:t},p.common))},onCheatItem:function(t){e(Lt(t)),e(O("common-cheat-item-added",{item:t},p.common))},onCheatResources:function(t){var n=ta.reduce((function(e,n){return e[n]=t,e}),{});e(yt(n)),e(O("common-cheat-resources-added",{amount:t},p.common))},onCheatStructureState:function(t,n){return e(function(e,t){return{type:Rt.setStructureState,structure:e,state:t}}(t,n))},onCheatWorkers:function(t){var n;e((n=t,{type:zr.addWorkers,value:n})),e(O("common-cheat-workers-added",{amount:t},p.common))}}})),Wn)(ea),ra=function(e){function t(e){var n;return Object(x.a)(this,t),(n=Object(S.a)(this,Object(q.a)(t).call(this,e))).state={},n}return Object(D.a)(t,e),Object(N.a)(t,[{key:"render",value:function(){var e=this;return h.createElement("div",{className:"menu"},h.createElement("ul",null,h.createElement("li",{onClick:function(){var t=h.createElement(na,{title:"Cheats"});e.props.onOpenWindow(t)}},"Cheats!")))}}]),t}(h.Component),aa=Object(pt.c)(Wn,dt)(ra),oa=(n(240),function(e){var t=function(e,t,n){return h.createElement("li",{title:n,key:n},h.createElement("div",{className:"icon common-icon-smallest",style:{backgroundImage:"url(".concat(e,")")}}),h.createElement("div",{className:"amount"},t.toFixed(0)))},n=ta.map((function(n){return t(It[n].iconImg,e.resources[n],_e.getResourceName(n))}));return n.push(t("/img/resources/worker.png",e.workersFree,"workers"),t("/img/resources/gold.png",e.gold,"gold")),h.createElement("ul",{className:"resourcebar"},n)}),ca=Object(w.b)((function(e){return{gold:e.gold,resources:e.resources,workers:e.workers,workersFree:Qt(e)}}))(oa),ia=(n(241),Object(pt.c)(Object(w.b)((function(e){return{}})),Zr.f,dt)((function(e){return h.createElement("div",{className:"topbar"},h.createElement("div",{className:"topbar-left"},h.createElement(ca,null)),h.createElement("div",{className:"topbar-right"},h.createElement("div",{className:"hamburger",onClick:function(t){var n=h.createElement(aa,{title:"Menu"});e.onOpenWindow(n)}},"\u2630")))}))),sa=(n(242),n(110)),ua=function(e){function t(){return Object(x.a)(this,t),Object(S.a)(this,Object(q.a)(t).apply(this,arguments))}return Object(D.a)(t,e),Object(N.a)(t,[{key:"render",value:function(){var e=this.props,t=e.itemsLoaded,n=e.itemsTotal;return h.createElement("div",null," ","Loading (".concat(Math.floor((t||0)/(n||0)*100),")%")," ")}}]),t}(h.Component);!function(e){e[e.image=0]="image",e[e.sound=1]="sound"}($r||($r={}));var la=function(e){function t(e){var n;return Object(x.a)(this,t),(n=Object(S.a)(this,Object(q.a)(t).call(this,e))).loadMedia=function(){n.setState({itemsLoaded:0});var e=n.props.manifest.map((function(e){return n.loadItem(e).catch((function(e){return console.error(e)}))}));Promise.all(e).then((function(e){n.props.onLoadComplete&&n.props.onLoadComplete(ma),n.setState({completed:!0})}))},n.loadItem=function(){var e=Object(u.a)(s.a.mark((function e(t){var r,a,o,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ma.some((function(e){return e.url===t}))&&console.warn("Loading media with url ".concat(t," more than once! Will overwrite.")),(r=pa(t))!==$r.image){e.next=7;break}return e.next=5,da(t);case 5:o=e.sent,a={content:o,mediaType:r,url:t};case 7:if(r===$r.sound&&(c=new sa.Howl({src:[t]}),a={content:c,mediaType:r,url:t}),!a){e.next=14;break}return ma.push(a),n.setState({itemsLoaded:n.state.itemsLoaded+1}),e.abrupt("return",a);case 14:throw new Error("Unknown error while trying to load ".concat(t));case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.state={completed:!1,itemsLoaded:0},n}return Object(D.a)(t,e),Object(N.a)(t,[{key:"componentDidMount",value:function(){this.loadMedia()}},{key:"componentDidUpdate",value:function(e){}},{key:"componentWillUnmount",value:function(){}},{key:"render",value:function(){var e=this.props,t=e.children,n=e.manifest,r=this.state.completed,a=h.createElement(ua,{itemsLoaded:this.state.itemsLoaded,itemsTotal:n.length});return r?t:a}}]),t}(h.Component),ma=[],da=function(e){var t=new Image;return t.src=e,new Promise((function(e,n){function r(){t.naturalWidth?e(t):n(null),t.removeEventListener("load",r),t.removeEventListener("error",r)}t.naturalWidth?e(t):t.complete?n(null):(t.addEventListener("load",r),t.addEventListener("error",r))}))},pa=function(e){if((e=e.toLowerCase()).endsWith("png")||e.endsWith("jpg")||e.endsWith("gif"))return $r.image;if(e.endsWith("mp3")||e.endsWith("ogg")||e.endsWith("wav"))return $r.sound;throw Error("Could not determine type for ".concat(e))};var fa,ga,va=Object(w.b)((function(e,t){return{store:e}}),(function(e,t){return{handleStartConstruction:function(t){var n=ve(t);e(bt(n.cost.gold||0)),e(function(e){return{type:Rt.startBuildingStructure,structure:e}}(t));var r=[Ht(t)],a=n.cost.time,o=Ft(Ut.buildStructure,"".concat(t,".build"),"town",a,r);e(o)}}}))((function(e){var t,n=e.info;switch(n.itemType){case k.deed:var r=e.store.gold,a=n,o=ve(a.structure),c=o.cost.gold||0<=r,i=!(e.store.structures[a.structure].state===Xe.NotBuilt)||!c;return h.createElement("div",null,h.createElement("p",null,' " ',n.subText,' " '),h.createElement("button",{disabled:i,onClick:function(){return e.handleStartConstruction(a.structure)}},"Start construction (",o.cost.gold," gold)"));case k.weapon:var s=(t=n.item,Pe[t]);return h.createElement(h.Fragment,null,h.createElement("p",null,' " ',n.subText,' " '),h.createElement("p",null," damage: ",s.damage[ke.kinetic]," "));case k.apparel:var u=function(e){return B[e]}(n.item);return h.createElement(h.Fragment,null,h.createElement("p",null,' " ',n.subText,' " '),u.armorRating&&h.createElement("p",null," armor: ",u.armorRating," "));default:return h.createElement("p",null,' " ',n.subText,' " ')}})),ha=(n(243),function(e){function t(){return Object(x.a)(this,t),Object(S.a)(this,Object(q.a)(t).apply(this,arguments))}return Object(D.a)(t,e),Object(N.a)(t,[{key:"render",value:function(){var e,t=this.props.info,n=this.props.type;switch(t||(t={iconImg:"/img/items/deeds/deed.png",item:j.deedForWeaponsmith,itemType:k.weapon,subText:"It allows for the construction of a weaponsmith"}),n){case Et.item:default:e=h.createElement(va,{info:t})}var r=_e.getItemName(t.item);return h.createElement("div",{className:"contextbox"},h.createElement("div",null,r," "),e)}},{key:"componentDidUpdate",value:function(){}}]),t}(h.Component)),ba=(fa=ha,function(e){var t=h.useRef(null),n=h.useState(e.placement||Qr.bottom),r=Object(C.a)(n,2),a=r[0],o=r[1],c=e.containerRect,i=e.referenceRect;h.useEffect((function(){var e=t.current,n=e.getBoundingClientRect();switch(a){case Qr.top:if(n.top-n.height-8-8<c.top)return void o(Qr.bottom);break;case Qr.bottom:if(n.top+n.height+8+8>c.height)return void o(Qr.top)}if(e.style.opacity="1",n.left<c.left+8){var r=c.left-n.left+8;e.querySelector(".popup-content").style.transform="translateX(".concat(r,"px)")}if(n.right>c.right-8){var i=n.right-c.right+8;e.querySelector(".popup-content").style.transform="translateX(".concat(-i,"px)")}}),[a]);var s=0,u=0,l="";switch(a){case Qr.bottom:s=i.left-c.left+i.width/2,u=i.top-c.top+i.height,l="popup-bottom";break;case Qr.top:s=i.left-c.left+i.width/2,u=i.top-c.top,l="popup-top"}return h.createElement("div",{className:"popup ".concat(l),style:{left:s,opacity:0,top:u},ref:t},h.createElement("div",{className:"popup-arrow"}),h.createElement("div",{className:"popup-content"},h.createElement(fa,e)))});!function(e){e[e.Town=0]="Town",e[e.World=1]="World"}(ga||(ga={}));var ya=860,wa=648,Oa=h.createContext(null),ka=function(e){var t=Object(h.useRef)(null),n=Object(h.useState)(),r=Object(C.a)(n,2),a=r[0],o=r[1],i=Object(h.useState)(),s=Object(C.a)(i,2),u=s[0],l=s[1],m=Object(h.useState)([]),d=Object(C.a)(m,2),p=d[0],f=d[1],g=Object(h.useState)(),v=Object(C.a)(g,2),b=(v[0],v[1],Object(h.useState)([])),y=Object(C.a)(b,2),w=y[0],O=y[1],k=function(){st.playSound(nt.buttonClick)},j=function(e){if(e){var t=_e.getStructureName(e),n=h.createElement($n,{structure:e,title:t});E(n)}},E=function(e){O([].concat(Object(c.a)(w||[]),[e]))},T=function(){O([])},x=function(){w&&w.length&&O(w.slice(0,-1))},N=function(){if(t.current){window.innerHeight<ya?t.current.style.transform="scale(".concat(window.innerHeight/ya,") translateX(-50%)"):t.current.style.transform="scale(1) translateX(-50%)";var e=t.current.getBoundingClientRect();l(e)}};return Object(h.useEffect)((function(){return window.addEventListener("resize",N),N(),function(){window.removeEventListener("resize",N)}}),[]),h.createElement(Oa.Provider,{value:{media:p,onContextualObjectActivated:function(e,t,n,r){o({contextInfo:t,contextType:e,contextRect:r})},onOpenWindow:E}},h.createElement("div",{className:"app",ref:t,style:{width:wa,height:ya},onClick:function(){a&&o(void 0)}},h.createElement(Xr.a,{backend:Jr.a},h.createElement(Yr.a,null,h.createElement(la,{manifest:Kr,onLoadComplete:function(e){var t,n=e.filter((function(e){return e.mediaType===$r.sound}));st.loadMedia(n),st.addSounds((t={},Object(I.a)(t,nt.buttonClick,"sound/fx/button-click.ogg"),Object(I.a)(t,nt.error,"sound/fx/error.ogg"),t)),f(e)}},h.createElement(ia,null),h.createElement(Zr.a,{from:"/",to:"world"}),h.createElement(Zr.b,{path:"/world",component:function(){return h.createElement(Yr.b,{to:"/town"},h.createElement("button",{onClick:function(){return k()}}," ",_e.get("common-view-button-town")," "))}}),h.createElement(Zr.b,{path:"/town",component:function(){return h.createElement(Yr.b,{to:"/world"},h.createElement("button",{onClick:function(){return k()}}," ",_e.get("common-view-button-world")," "))}})," | ",h.createElement("button",{onClick:function(){return e.persistor.purge(),void window.location.reload()},style:{color:"red"}}," Restart! "),h.createElement(Zr.b,{path:"/town",component:function(){return h.createElement(vt,{onStructureClick:j})}}),h.createElement(Zr.b,{path:"/world",component:function(){return h.createElement(Vr,null)}}),h.createElement($e,null),function(){if(!w.length)return null;var e=w[w.length-1],t={onClose:T,onBack:x,backEnabled:w.length>1,closeEnabled:!0};return h.cloneElement(e,t)}(),function(){if(!a)return null;var e=a.contextType,t=a.contextInfo,n=a.contextRect;return h.createElement(ba,{type:e,info:t,containerRect:u,referenceRect:n,placement:Qr.bottom})}())))))};var ja=Object(w.b)((function(e,t){return{}}),(function(e,t){return{}}))(ka),Ea=(n(244),function(e){var t=ve(G.warehouse),n=e.structures[G.warehouse].level;return t.levels[n].maxResources}),Ta=function(e,t){var n=t.structures,r={},a=e/6e4,o=Ea(t);return Object.keys(n).forEach((function(e){return function(e){var t=ve(e);if(t.type===H.resource){var o=t,c=n[e].level,i=o.levels[c];Object.keys(i.generates).reduce((function(t,r){var o=i.generates[r]*n[e].workers*a;return t[r]=(t[r]||0)+o,t}),r)}}(e)})),Object.keys(r).forEach((function(e){r[e]&&t.resources[e]+r[e]>=o[e]&&(r[e]=o[e]-t.resources[e])})),r};function Ia(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ca(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ia(n,!0).forEach((function(t){Object(I.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ia(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var xa=function(e,t){var n=[],r=[];return t.quests.forEach((function(t){if(t.status===Ve.active){var a=ln[t.name],o=t.progress,c=Math.floor(o);if(a.nodes[c].type===on.nothing){for(var i=e/6e4*4,s=Math.min(o+i,a.nodes.length-1),u=Math.floor(s)-c,l=t.currentEncounter,m=1;m<=u;m++){var d=a.nodes[c+m];if(d.type===on.encounter){var f=_r[d.encounter],g=Wr[t.name];s=c+m,l=d.encounter,n.push(Ca({channel:p.quest,channelContext:t.name},f.getDescription(g)));break}d.type===on.nothing&&(l=null,d.log&&n.push({channel:p.quest,channelContext:t.name,key:d.log}))}r.push({currentEncounter:l,name:t.name,progress:s})}}})),{logUpdates:n,questUpdates:r}},Na=function(){return Pr?(Pr=!1,cr.state()):null},Sa=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function qa(){if("serviceWorker"in navigator){if(new URL("/gilles-game",window.location.toString()).origin!==window.location.origin)return;window.addEventListener("load",(function(){var e="".concat("/gilles-game","/service-worker.js");Sa?(!function(e){fetch(e).then((function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):Da(e)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")}))):Da(e)}))}}function Da(e){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var t=e.installing;t&&(t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}function Aa(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ra(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Aa(n,!0).forEach((function(t){Object(I.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Aa(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Pa=function(){return{strength:100*Math.random(),perception:100*Math.random(),endurance:100*Math.random(),charisma:100*Math.random(),intelligenge:100*Math.random(),agility:100*Math.random(),luck:100*Math.random()}},Ma=[{id:"c4a5d270",equipment:{chest:j.chest,head:j.cowl},stats:Pa(),health:100*Math.random(),room:0,name:"Ximena Maddox",avatarImg:"/img/avatars/andy-victorovych-a1.jpg",inventory:[j.deedForLumbermill,null,j.crossbow,j.dagger,j.khopesh,null,j.sword,null,null,null,null,null,null,null,null,null]},{id:"2e655832",equipment:{},stats:Pa(),name:"Donte Houston",health:100*Math.random(),room:1,avatarImg:"/img/avatars/andy-victorovych-a2.jpg",inventory:[j.crossbow,null,null,null,null,j.boots1,j.chainmailHood,j.nomadHelmet,j.plateChest4,null,null,null,null,null,null,null,null,null,null,null,null,null,j.plateHelmet,j.cowl]},{id:"ec6f1050",equipment:{},stats:Pa(),name:"Zackary Morris",health:100*Math.random(),room:2,avatarImg:"/img/avatars/andy-victorovych-a3.jpg",inventory:[j.greatswordOfGwai,null,null,null]},{id:"d299f98a",stats:Pa(),equipment:{},name:"Mike Keith",health:100*Math.random(),room:4,avatarImg:"/img/avatars/andy-victorovych-a4.jpg",inventory:[null,null,null,null,j.khopesh,j.hornedHelmet]},{id:"96c686c3",equipment:{},stats:Pa(),name:"Wayne Monroe",health:100*Math.random(),room:5,avatarImg:"/img/avatars/andy-victorovych-a5.jpg",inventory:[null,null,null]},{id:"250d1a9d",stats:Pa(),equipment:{},name:"Mike Keith",health:100*Math.random(),room:9,avatarImg:"/img/avatars/andy-victorovych-a6.jpg",inventory:[null,null,null,null,null]},{id:"169384ef",equipment:{},stats:Pa(),name:"Karlee Nolan",health:100*Math.random(),room:3,avatarImg:"/img/avatars/andy-victorovych-a7.jpg",inventory:[j.greatswordOfGwai,null,null,null]},{id:"f22d66cb",stats:Pa(),equipment:{},name:"Gylbarde the Earnest",health:100*Math.random(),room:8,avatarImg:"/img/avatars/andy-victorovych-a8.jpg",inventory:[null,null,null,null,null]},{id:"36c686c1",equipment:{},stats:Pa(),name:"Lanslet of the Water",health:100*Math.random(),room:6,avatarImg:"/img/avatars/andy-victorovych-a9.jpg",inventory:[j.greatswordOfGwai,null,null,null,j.shoulders1,j.fedora,j.greaves2]},{id:"12c613d4",equipment:{},stats:Pa(),name:"Tedric the Bold",health:100*Math.random(),room:7,avatarImg:"/img/avatars/andy-victorovych-a10.jpg",inventory:[j.greatswordOfGwai,null,null,null]}];function Wa(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function La(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Wa(n,!0).forEach((function(t){Object(I.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Wa(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ha={lastTick:Date.now()};function Ba(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ba(n,!0).forEach((function(t){Object(I.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ba(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ga=[null,null,null,j.dagger,j.deedForWeaponsmith];function Fa(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var Ua=function(e,t){if(!t.log.length)return e;var n=t.log.map((function(e){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Fa(n,!0).forEach((function(t){Object(I.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Fa(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e,{time:Date.now()})}));return[].concat(Object(c.a)(n),Object(c.a)(e))};function Qa(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Va(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Qa(n,!0).forEach((function(t){Object(I.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Qa(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var za,Ka=[{name:"kill10Boars",status:Ve.active,party:["c4a5d270","2e655832","ec6f1050","d299f98a"],progress:0,questVars:{},encounterResults:[],icon:"sigil1.png",currentEncounter:null},{name:"retrieveMagicAmulet",party:[],status:Ve.available,progress:0,questVars:{},encounterResults:[],icon:"sigil2.png",currentEncounter:null,reward:{gold:4,items:[j.deedForWeaponsmith]}}],Xa=function(e,t){var n=t.assignedAventurers.filter((function(e){return!!e})).map((function(e){return e.id}));return e.map((function(e){return e.name===t.questName?Va({},e,{status:Ve.active,party:n}):e}))},Ja=function(e,t){return e.map((function(e){if(e.name===t.questName){var n=e.progress+1;ln[e.name];return Va({},e,{progress:n})}return e}))},Ya=function(e,t){return e.map((function(e){return e.name===t.questName?Va({},e,{currentEncounter:t.encounter}):e}))},Za=function(e,t){var n=t.quests;return n.length?e.map((function(e){var t=n.find((function(t){return t.name===e.name}));if(t){var r=t.progress,a=t.currentEncounter;return Va({},e,{progress:r,currentEncounter:a})}return e})):e},$a=function(e,t){return e.map((function(e){return e.name===t.questName?Va({},e,{questVars:Object.assign({},e.questVars,t.vars)}):e}))},eo=function(e,t){return e.map((function(e){if(e.name===t.questName){var n=e.encounterResults.concat();return n[t.nodeIndex]=t.result,Va({},e,{encounterResults:n})}return e}))},to=(za={},Object(I.a)(za,G.alchemist,{level:0,workers:1,state:Xe.NotBuilt}),Object(I.a)(za,G.armoursmith,at),Object(I.a)(za,G.garden,{level:0,workers:0,state:Xe.Built}),Object(I.a)(za,G.lumberMill,at),Object(I.a)(za,G.mine,{level:0,workers:0,state:Xe.NotBuilt}),Object(I.a)(za,G.quarry,at),Object(I.a)(za,G.tavern,{level:0,workers:0,state:Xe.Built}),Object(I.a)(za,G.tannery,at),Object(I.a)(za,G.warehouse,{level:0,workers:0,state:Xe.Built}),Object(I.a)(za,G.weaponsmith,{level:0,workers:0,state:Xe.Built}),Object(I.a)(za,G.weaver,at),Object(I.a)(za,G.workshop,at),za);function no(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ro(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?no(n,!0).forEach((function(t){Object(I.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):no(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ao=function(e,t,n){var r=ro({},e[t],{state:n});return ro({},e,Object(I.a)({},t,r))},oo={completed:[],running:[]};function co(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function io(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?co(n,!0).forEach((function(t){Object(I.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):co(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var so=function(e){return{name:e.name,origin:e.origin,type:e.taskType,callbacks:e.callbacks,timeRemaining:e.time,startTime:Date.now(),lastTick:Date.now(),progress:0}},uo=Object(pt.b)({adventurers:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ma,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case hn.moveItemInInventory:var n=t,r=n.adventurerId,a=n.fromSlot,o=n.toSlot,c=e.find((function(e){return e.id===r})),i=c.inventory.map((function(e,t){return t===a?c.inventory[o]:t===o?c.inventory[a]:e}));return e.map((function(e){return e===c?Ra({},e,{inventory:i}):e}));case hn.moveItemToOtherAdventurer:var s=t,u=s.adventurerId,l=s.fromSlot,m=s.toAdventurerId,d=e.find((function(e){return e.id===u})),p=d.inventory[l];return e.map((function(e){if(e.id===u){var t=e.inventory.concat();return t[l]=null,Ra({},e,{inventory:t})}if(e.id===m){var n=e.inventory.concat(),r=n.findIndex((function(e){return null===e}));return n[r]=p,Ra({},e,{inventory:n})}return e}));case hn.addItemToInventory:var f=t,g=f.item;return e.map((function(e){if(e.id===t.adventurerId){var n=e.inventory.concat(),r=t.toSlot;return null===r&&(r=n.findIndex((function(e){return null===e||void 0===e}))),n[r]=g,Ra({},e,{inventory:n})}return e}));case hn.removeItemFromInventory:var v=t,h=v.fromSlot;return e.map((function(e){if(e.id===t.adventurerId){var n=e.inventory.map((function(e,t){return t!==h?e:null}));return Ra({},e,{inventory:n})}return e}));case hn.assignEquipment:var b=t,y=b.equipmentSlot,w=b.item;return e.map((function(e){return e.id===t.adventurerId?Ra({},e,{equipment:Ra({},e.equipment,Object(I.a)({},En[y],w))}):e}));case hn.removeEquipment:var O=t,k=O.equipmentSlot;return e.map((function(e){return e.id===t.adventurerId?Ra({},e,{equipment:Ra({},e.equipment,Object(I.a)({},En[k],null))}):e}))}return e},combat:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case r.startCombatAction:var n=t;return La({},e,{action:{actor:n.actor,endsAt:n.endsAt,target:n.target,type:n.combatType}});case r.moveActor:var a=t,o=e.actors.map((function(e){return e.name===a.actor?La({},e,{location:a.location}):e}));return La({},e,{actors:o});case r.clearCombatAction:return La({},e,{action:void 0})}return e},engine:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ha,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case d.gameTick:return _a({},e,{lastTick:Date.now()})}return e},gold:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case ft.addGold:return e+t.amount}return e},items:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ga,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case At.addItem:var n=t,r=n.item,a=t,o=a.toSlot;return void 0===o&&-1===(o=e.findIndex((function(e){return null===e})))?[].concat(Object(c.a)(e),[r]):e.map((function(e,t){return t===o?r:e}));case At.moveItemInWarehouse:var i=t,s=i.fromSlot,u=i.toSlot;return e.map((function(t,n){return n===s?null:n===u?e[s]:t}));case At.removeItem:var l=t,m=l.fromSlot;return e.map((function(e,t){return t!==m?e:null}))}return e},log:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case f.addLogEntry:var n=t,r=n.key,a=n.channel,o=n.channelContext,i=n.context,s=Date.now();return[{channel:a,channelContext:o,context:i,key:r,time:s}].concat(Object(c.a)(e));case d.gameTick:return Ua(e,t)}return e},quests:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ka,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Kt.launchQuest:return Xa(e,t);case Kt.advanceQuest:return Ja(e,t);case Kt.updateQuestVars:return $a(e,t);case Kt.updateEncounterResult:return eo(e,t);case Kt.startEncounter:return Ya(e,t);case d.gameTick:return Za(e,t)}return e},resources:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Fn,t=arguments.length>1?arguments[1]:void 0,n=function(t){return Object.keys(e).reduce((function(n,r){return n[r]=e[r]+(t[r]||0),n}),{})};switch(t.type){case gt.addResources:var r=t.resources;return n(r);case gt.removeResources:var a=t.resources;return Object.keys(e).reduce((function(t,n){return t[n]=e[n]-(a[n]||0),t}),{});case d.gameTick:var o=t.resources;return n(o)}return e},rngState:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;return t.type===d.gameTick&&null!=t.rngState&&(e=Object.assign({},t.rngState)),e},structures:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:to,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Rt.startBuildingStructure:return ao(e,t.structure,Xe.Building);case Rt.finishBuildingStructure:return ao(e,t.structure,Xe.Built);case Rt.upgradeStructure:var n=e[t.structure].level+1,r=ro({},e[t.structure],{level:n});return ro({},e,Object(I.a)({},t.structure,r));case Rt.increaseWorkers:var a=t,o=a.workers,c=e[t.structure].workers+o,i=ro({},e[t.structure],{workers:c});return ro({},e,Object(I.a)({},t.structure,i));case Rt.decreaseWorkers:var s=t,u=s.workers,l=e[t.structure].workers-u,m=ro({},e[t.structure],{workers:l});return ro({},e,Object(I.a)({},t.structure,m));case Rt.setStructureState:var d=t,p=d.state;return ao(e,t.structure,p)}return e},tasks:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:oo,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Pt.start:var n=so(t),r=e.running.concat(n);return io({},e,{running:r});case d.gameTick:var a=Date.now(),o=[],c=[];return e.running.forEach((function(e){var t=a+e.timeRemaining,n=(a-e.startTime)/(t-e.startTime),r=e.timeRemaining-(a-e.lastTick),i=io({},e,{progress:n,lastTick:a,timeRemaining:r});r<0?c.push(i):o.push(i)})),{running:o,completed:c}}return e},workers:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:13,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case zr.addWorkers:return e+t.value}return e}}),lo=n(74),mo=n(111),po={key:"root",storage:n.n(mo).a,version:T},fo=Object(lo.a)(po,uo),go=Object(u.a)(s.a.mark((function e(){var t,n=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},e.abrupt("return",new Promise((function(e,n){var r=Object(pt.d)(fo,t,window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__()),a=Object(lo.b)(r,void 0,(function(){var t=qr(r.getState());e({store:r,persistor:a,isHydrated:t})}))})));case 2:case"end":return e.stop()}}),e)}))),vo=function(){var e=Object(u.a)(s.a.mark((function e(){var t,n,r,a,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.a.get("lang/en-US.json");case 2:return t=e.sent,n=t.data,_e.init(n),c="GILLESROX2",Pr=!0,cr=Ar()(c,{state:!0}),e.next=8,go();case 8:r=e.sent,a=r.store,o=r.persistor,r.isHydrated?bo(a):ho(a),yo(a,o);case 14:case"end":return e.stop()}var c}),e)})));return function(){return e.apply(this,arguments)}}(),ho=function(e){e.dispatch(O("test-game-welcome")),console.log("Starting new GILLES-IDLE-GAME (version ".concat("0.0.4",")"))},bo=function(e){console.log("Continuing existing GILLES-IDLE-GAME (version ".concat("0.0.4",")"))},yo=function(e,t){y.render(h.createElement(w.a,{store:e},h.createElement(ja,{persistor:t})),document.getElementById("root")),qa();var n=function(t){t.completed.forEach((function(t){return function(t){t.callbacks.forEach((function(t){return e.dispatch(t)}))}(t)}))};setInterval((function(){var t=e.getState(),r=Date.now()-t.engine.lastTick,a=[],o=Ta(r,t),i=Na();v(r,e);var s=xa(r,t),u=s.questUpdates,l=s.logUpdates;a.push.apply(a,Object(c.a)(l)),e.dispatch(function(e,t,n,r,a){return{type:d.gameTick,delta:e,rngState:t,resources:n,quests:r,log:a}}(r,i,o,u,a)),n(t.tasks)}),2500)};vo()},47:function(e,t,n){},67:function(e,t,n){},83:function(e,t,n){},99:function(e,t,n){}},[[116,1,2]]]);
//# sourceMappingURL=main.175bd58d.chunk.js.map