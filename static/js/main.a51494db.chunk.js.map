{"version":3,"sources":["definitions/items/types.ts","global/TextManager.ts","utils/format/time.ts","definitions/structures/index.ts","definitions/structures/alchemist.ts","definitions/structures/armoursmith.ts","definitions/structures/garden.ts","definitions/structures/lumberMill.ts","definitions/structures/mine.ts","definitions/structures/quarry.ts","definitions/structures/tannery.ts","definitions/structures/tavern.ts","definitions/structures/warehouse.ts","definitions/structures/weaponsmith.ts","definitions/structures/weaver.ts","definitions/structures/workshop.ts","components/ui/adventurer/EquipmentSlot/index.tsx","definitions/quests/types.ts","global/SoundManager.ts","store/types/scene.ts","constants/items.ts","components/ui/common/Icon/index.tsx","store/actions/quests.ts","utils/routing.ts","definitions/resources.ts","definitions/structures/types.ts","definitions/items/weapons.ts","constants/dragging.ts","store/actions/adventurers.ts","global/ToastManager.tsx","components/ui/toasts/Toast.tsx","store/types/logEntry.ts","utils/tilemap.ts","definitions/items/deeds.ts","definitions/items/materials.ts","definitions/items/questItems.ts","definitions/items/trinkets.ts","definitions/items/index.ts","store/types/combat.ts","definitions/quests/kill10Boars/index.ts","definitions/quests/index.ts","definitions/quests/retrieveMagicAmulet/index.ts","store/actions/log.ts","store/helpers/storeHelpers.ts","utils/math.ts","utils/pixiJs.ts","store/actions/gold.ts","constants/tiledMapData.ts","global/SceneControllerManager.ts","definitions/items/apparel.ts","definitions/quests/kill10Boars/questVars.ts","store/actions/game.ts","store/actions/combat.ts","constants/version.ts","utils/version.ts","store/types/structure.ts","mechanics/gameTick/combat.ts","utils/hitAreaShapes.ts","components/town/structures/LumberMill/index.tsx","components/pixi/ParticleEmitter.ts","components/town/structures/Tavern/index.tsx","hoc/withAppContext.tsx","components/town/structures/Generic/index.tsx","components/town/Legenda/index.tsx","components/pixi/Viewport.tsx","components/App/styles/img/cursors/dwarven_gauntlet_extra_6.png","components/town/TownStage.tsx","components/ui/buttons/Button/index.tsx","components/town/Clouds.tsx","components/town/TownView.tsx","components/ui/toasts/Toasts.tsx","store/actions/resources.ts","store/actions/structures.ts","components/ui/window/Window.tsx","hoc/withWindow.tsx","components/ui/window/windows/SettingsWindow.tsx","constants/resources.ts","store/actions/items.ts","store/actions/index.ts","mechanics/time.ts","constants/context.ts","global/TooltipManager.ts","components/ui/items/ItemIcon/index.tsx","components/ui/common/Select/index.tsx","store/types/quest.ts","components/ui/window/windows/CheatWindow.tsx","utils/game.ts","components/ui/window/windows/MenuWindow.tsx","utils/format/number.ts","hooks/store/useGoldState.ts","store/selectors/resources.ts","hooks/store/resources.ts","store/selectors/workers.ts","hooks/store/useWorkersState.ts","components/ui/topbar/Resourcebar.tsx","components/ui/topbar/Topbar.tsx","components/world/WorldMap/QuestMarker.tsx","components/world/WorldMap/QuestLine.tsx","utils/reselect.ts","hooks/store/quests.ts","components/world/WorldMap/index.tsx","store/types/adventurer.ts","components/world/QuestPanel/QuestDetails/scene/SceneActor.tsx","components/ui/tabs/Tabstrip.tsx","components/ui/tabs/Tab.tsx","components/ui/adventurer/AdventurerAvatar/index.tsx","components/world/QuestPanel/AdventurerTabstrip.tsx","store/selectors/adventurers.ts","components/pixi/tile/RectTileLayer.tsx","components/pixi/tile/ObjectTileLayer.tsx","components/pixi/tile/SpriteAnimated.tsx","components/world/QuestPanel/QuestDetails/scene/SceneAdventurer.tsx","components/world/QuestPanel/QuestDetails/scene/ObjectSpriteLayer.tsx","components/world/QuestPanel/QuestDetails/scene/Tilemap.tsx","components/pixi/util/BridgedStage.tsx","hooks/useTilesetsLoader.ts","components/ui/loading/LoadingSpinner.tsx","hooks/usePrevious.ts","components/world/QuestPanel/context/SceneControllerContext.tsx","components/world/QuestPanel/QuestDetails/scene/ui/CombatUIWidget/Segment.tsx","components/world/QuestPanel/QuestDetails/scene/ui/CombatUIWidget/index.tsx","components/world/QuestPanel/QuestDetails/scene/ui/NormalUICursor.tsx","components/world/QuestPanel/QuestDetails/scene/ui/SceneUI.tsx","components/pixi/DashedLine.ts","components/world/QuestPanel/QuestDetails/scene/ActionPreview.tsx","hooks/store/useLog.ts","components/world/QuestPanel/QuestDetails/scene/SceneLog.tsx","components/world/QuestPanel/QuestDetails/scene/Scene.tsx","components/world/QuestPanel/QuestDetails/OnTheRoad.tsx","components/world/QuestPanel/QuestDetails/index.tsx","components/ui/items/DraggableItemIcon.tsx","components/ui/items/DraggableItemsList/index.tsx","hooks/store/adventurers.ts","components/world/QuestPanel/modals/LootCache/index.tsx","components/world/QuestPanel/modals/Situation/index.tsx","components/world/QuestPanel/CombatBar/index.tsx","components/ui/inventory/InventorySlot.tsx","components/ui/inventory/Inventory.tsx","hooks/store/useStockpileState.ts","hooks/actions/useItemActions.ts","components/ui/adventurer/AdventurerPanel/AdventurerSkills/index.tsx","mechanics/adventurers/levels.ts","components/ui/common/progress/PlainProgressbar.tsx","components/ui/adventurer/AdventurerPanel/Level.tsx","definitions/traits/types.ts","components/ui/adventurer/AdventurerPanel/ApIndicator.tsx","definitions/traits/index.ts","components/ui/adventurer/AdventurerPanel/AdventurerTraits/index.tsx","components/world/QuestPanel/index.tsx","components/ui/adventurer/AdventurerPanel/AdventurerEquipment/Guy/index.tsx","components/ui/adventurer/AdventurerPanel/AdventurerEquipment/index.tsx","components/ui/adventurer/AdventurerPanel/index.tsx","components/log/SimpleLog.tsx","components/world/WorldView.tsx","store/actions/tasks.ts","store/types/task.ts","hooks/store/useStructureState.ts","components/ui/tooltip/ContextTooltip/context/ItemContext/DeedContent.tsx","definitions/production/weaponsmith.ts","definitions/production/armoursmith.ts","components/ui/tooltip/Tooltip/index.tsx","definitions/production/workshop.ts","definitions/production/alchemist.ts","definitions/production/index.ts","store/selectors/tasks.ts","hooks/store/useTasksState.ts","mechanics/studying.ts","components/ui/tooltip/ContextTooltip/context/ItemContext/ProduceOrStudy.tsx","components/ui/tooltip/ContextTooltip/context/ItemContext/WeaponContent.tsx","components/ui/tooltip/ContextTooltip/context/ItemContext/ApparelContent.tsx","components/ui/tooltip/ContextTooltip/context/ItemContext/index.tsx","components/ui/tooltip/ContextTooltip/context/ResourceContext/index.tsx","components/ui/modals/InfoWindow/index.tsx","components/ui/common/progress/TickingProgressbar.tsx","components/ui/tooltip/ContextTooltip/context/TraitContext/index.tsx","components/ui/tooltip/ContextTooltip/index.tsx","hooks/store/engine.ts","components/structures/StructureViewHeader.tsx","components/structures/StructureLevel.tsx","components/structures/production/UpgradeHelpModal.tsx","components/ui/common/UpDownValue/index.tsx","components/ui/items/ItemsBox.tsx","components/structures/production/ResourcesCost.tsx","mechanics/crafting.ts","components/structures/production/CraftingDetails.tsx","components/structures/production/CraftingArea.tsx","components/structures/production/ProductionStructureView.tsx","components/structures/warehouse/ResourcesBox.tsx","store/types/resources.ts","components/structures/warehouse/UpgradeHelpModal.tsx","components/structures/warehouse/WarehouseStructureView.tsx","components/ui/adventurer/DroppableAdventurerSlot/index.tsx","components/structures/tavern/AssignAdventurers.tsx","components/structures/tavern/QuestBoard.tsx","components/structures/tavern/rooms/AdventurerButton.tsx","components/ui/adventurer/DraggableAdventurerAvatar/index.tsx","components/App/index.tsx","components/structures/tavern/rooms/RoomWithAdventurer.tsx","components/structures/tavern/rooms/RoomEmpty.tsx","components/structures/tavern/rooms/RoomList.tsx","components/structures/tavern/UpgradeHelpModal.tsx","components/structures/tavern/TavernStructureView.tsx","components/structures/resource/UpgradeHelpModal.tsx","components/structures/resource/ResourceGenerationRow.tsx","components/structures/resource/ResourceStructureView.tsx","components/town/StructureDetailsView/index.tsx","utils/random.ts","mechanics/gameTick/producedResources.ts","mechanics/gameTick/quests.ts","mechanics/gameTick/rngState.ts","registerServiceWorker.ts","index.tsx","store/reducers/adventurers.ts","store/reducers/engine.ts","store/reducers/gold.ts","store/reducers/items.ts","store/reducers/log.ts","store/reducers/quests.ts","store/reducers/resources.ts","store/reducers/rngState.ts","store/reducers/structures.ts","store/types/structures.ts","store/reducers/tasks.ts","store/reducers/workers.ts","store/reducers/index.ts","store/reducers/combat.ts","utils/configureStore.ts","mechanics/gameTick/tasks.ts","constants/text.ts","mechanics/scenes/BaseSceneController.ts","definitions/quests/kill10Boars/encounters/dungeon.ts"],"names":["ItemType","Item","TextManager","texts","precompile","this","templates","compileAll","initialized","key","context","result","getDefault","console","error","Error","template","getTemplate","textEntry","get","compile","slotType","toKebab","EquipmentSlotType","name","type","item","itemType","getDefinition","structure","trait","Type","WeaponType","weaponClass","WeaponClassification","Object","keys","forEach","value","Handlebars","article","itemArticleAuto","itemArticleDefined","resource","itemArticleUndefined","getItemName","articleTemplate","noun","FIVE_SECONDS","ONE_MINUTE","TWO_MINUTES","THREE_MINUTES","FOUR_MINUTES","HALF_HOUR","ONE_HOUR","ONE_DAY","ONE_YEAR","formatDuration","ms","short","timeUnitsList","unit","amount","time","Math","abs","output","el","tmp","floor","push","join","Structure","alchemist","StructureType","production","cost","gold","levels","displayName","workerCapacity","unlocks","armoursmith","boots1","chest","cowl","garden","generates","food","lumberMill","wood","mine","iron","quarry","stone","tannery","leather","tavern","rooms","warehouse","maxResources","fabric","maxStockpile","weaponsmith","poisonedDagger","weaver","workshop","all","getStructureByResource","Resource","dropTarget","drop","props","monitor","onDrop","getItem","canDrop","itemAndEquipmentSlotMatch","equipmentSlotType","feet","hands","head","legs","checkEquipment","mainHand","offHand","itemDefinition","weapon","WeaponTypeDefinition","weaponType","classification","oneHanded","shield","DropTarget","DragType","ITEM","connect","connectDropTarget","isOver","borderColor","className","style","title","children","equipmentType","apparel","QuestNodeType","Channel","MixMode","Music","STORAGE_KEY_VOLUME","SoundManager","music","localforage","ui","scene","_channelVolume","_initialized","gameSound","files","complete","_sounds","loader","Loader","map","file","add","load","_","resources","values","filter","Boolean","r","sound","channel","loop","mixMode","singleInstance","storePosition","init","pixiSound","getSound","volume","_currentSound","oldSoundInfo","instance","once","progress","duration","_storedPositions","start","play","fade","gsap","to","onComplete","destroy","from","stop","on","length","random","filters","_filter","setItem","TelephoneFilter","SceneActionType","isActorObject","object","TiledObjectType","actor","isAdventurer","allegiance","Allegiance","player","getSpritesheetPaths","objects","Array","Set","o","properties","isSprite","spritesheet","Rarity","IconSize","Border","Icon","image","size","border","restProps","sizeClassName","backgroundImage","process","borderClassName","smallest","small","medium","big","biggest","none","ActionType","launchQuest","questName","assignedAventurers","exitEncounter","quest","updateQuestVars","vars","setSceneName","sceneName","setScene","enqueueSceneAction","sceneAction","completeSceneAction","setCombat","combat","setActiveSceneInteractionModal","sceneInteractionModal","getWorldLink","getQuestLink","getTownLink","getStructureLink","iconImg","WeaponAbility","basePath","DamageType","axe","abilities","cut","bow","shoot","club","swing","parry","crossbow","aimedShot","fist","flail","hammer","knife","staff","twoHanded","sword","poleArm","block","weaponDefinitions","aegisOfValor","rarity","legendary","arbalest","epic","damage","kinetic","battleAxe","common","berserkerShield","brassKnuckles","buckler","cleaver","dagger","uncommon","falchion","rare","goldenShield","greatswordOfGwai","unique","halbert","huntingBow","indomitableCarapace","javelin","khopesh","legionnaireSword","longbow","mace","morningStar","paintedBuckler","pikeStaff","ravenStaff","scythe","savageStaff","simpleCrossbow","spear","steelShield","steelSword","warhammer","woodenBulwark","DragSourceType","ADVENTURER","moveItemInInventory","adventurerId","fromSlot","toSlot","addItemToInventory","removeItemFromInventory","assignEquipment","equipmentSlot","removeEquipment","renameAdventurer","EVENT_TOASTS_UPDATED","ToastManager","icon","link","stack","Date","now","emit","playSound","setTimeout","toast","lifeTime","_instance","EventEmitter","Toast","achievementUnlocked","history","useHistory","typeText","getToastType","onClick","LogChannel","parseProperties","reduce","acc","findTileset","gid","tilesets","tileset","i","firstgid","addAllTilesInLayerToList","list","layer","columns","data","tile","index","x","y","locationEquals","a","b","deed","deedForLumbermill","deedForWeaponsmith","material","arrowheads","bolts","buckle","chain","cogs","gem","ingot","nails","poisonVial","ribbon","rope","gunpowder","scales","spring","thread","questItem","questItemDefinitions","blueprints","crate","dynamite","dragonEye","eye","feather","heart","horn","letters","lockPicks","oil","orcFinger","plans","purpleGems","runestone","sandwich","teeth","tooth","torch","tusk","vase","vial","weeds","trinket","trinketDefinitions","magicAmulet","ring","deeds","materials","questItems","trinkets","weapons","CombatActionType","barBrawl","actors","health","location","remainingAP","turn","kill10Boars","getQuestVars","questStore","questVars","getInitialQuestVars","_questStore","initialQuestVars","nodes","nothing","log","encounter","startScene","retrieveMagicAmulet","baz","zux","requiredItems","addLogText","channelContext","entry","addLogEntry","adventurersOnQuest","adventurers","party","id","findAdventurerById","getQuestLeader","leaderId","find","adventurerFreeInventorySlots","adventurer","inventory","storeIsRehydrated","store","undefined","engine","gameStarted","lerp","n1","n2","alpha","lerpLocation","point1","point2","loadResourceAsync","path","PIXI","shared","Promise","resolve","reject","loadResource","callback","addGold","subtractGold","TiledLayerType","Orientation","RenderOrder","SceneControllerManager","controllerType","controllerTypes","require","boots2","damageReduction","boots3","chainmailHood","clothGloves","druidChest","druidHands","druidFeet","druidHead","druidLegs","fedora","greaves1","greaves2","hornedHelmet","leatherGloves","nomadHelmet","pants1","pants2","plateChest1","plateChest2","plateChest3","plateChest4","plateGloves1","plateGloves2","plateHelmet","platePants","plateShoulders1","shoulders","plateShoulders2","robe","shoulders1","shoulders2","shoulders3","vest","dungeon","entered","entrance","chestOpen","items","hallway","doorOpen","version","asInt","semVer","parts","split","part","Number","numericVersion","convertSemVerToInt","StructureState","updateCombat","delta","getState","action","endsAt","enemy","move","dispatch","moveActor","target","clearCombatAction","HitAreaShapes","shapes","sprite","definition","shape","some","contains","LumberMill","hitAreaShapes","atlas","useState","textures","setTextures","selected","STRUCTURE_HIGHLIGHT_FILTER","app","useApp","useEffect","rotation","setRotation","useTick","position","interactive","buttonMode","pointertap","onStructureClick","hitArea","texture","anchor","ParticleEmitter","PixiComponent","create","applyProps","oldProps","newProps","config","newP","applyDefaultProps","emitter","_emitter","particles","elapsed","performance","tick","_raf","requestAnimationFrame","update","willUnmount","cancelAnimationFrame","Tavern","smoke","withAppContext","WrappedComponent","AppContext","Consumer","Component","Generic","Legenda","structures","orderedStructures","match","useRouteMatch","renderText","params","toString","getStructureName","state","NotBuilt","Viewport","forwardRef","ref","cursor","renderer","plugins","interaction","cursorStyles","pointer","PixiComponentViewport","viewport","PixiViewport","screenWidth","screenHeight","worldWidth","worldHeight","ticker","event","minScale","maxScale","drag","pinch","wheel","clamp","direction","clampZoom","decelerate","TownStage","innerRef","useRef","useImperativeHandle","current","godray","enabled","horizontalFactor","utils","normalize","right","verticalFactor","bottom","factor","max","gain","lacunarity","onScroll","e","preventDefault","window","addEventListener","passive","removeEventListener","width","height","options","ButtonSize","ButtonColor","autoDensity","sharedLoader","GodrayFilter","Clouds","speed","randomCloud","cloud","setCloud","setX","randomY","setY","OutlineFilter","selectedStructure","viewportRef","dragging","addSound","tween","thickness","yoyo","repeat","pause","kill","stopPropagation","handleStructureClick","useSelector","zoomPercent","getStructurePosition","moveCenter","MAX_WIDTH","canvasWidth","setCanvasWidth","canvasHeight","setCanvasHeight","resize","worldViewWidth","clientWidth","worldViewHeight","clientHeight","reverse","StructureComponent","getStructure","polygons","Point","Toasts","activeToasts","setActiveToasts","toastsUpdated","addListener","removeListener","toastConfig","Button","color","square","text","otherProps","blue","auto","replace","Window","musicFiltered","backEnabled","_e","onBack","closeEnabled","onClose","withWindow","React","compose","getChannelControls","slider","currentTarget","parentNode","lastChild","setChannelVolume","role","aria-label","min","step","onChange","linear","parseFloat","pow","defaultValue","sqrt","getChannelVolume","open","RESOURCE_INTERVAL","resourceOrder","addResources","finishBuildingStructure","upgradeStructure","increaseWorkers","workers","addItemToToProduces","TimeType","addItemToWarehouse","addItem","removeItemFromWarehouse","removeItem","addStockpileSlots","slots","ContextType","cheatTimeMultiplier","getTimeMultiplier","cheat","EVENT_CONTEXT_UPDATED","TooltipManager","info","originRect","referenceRect","deepEquals","lastContext","clear","ItemIcon","getIconClassName","showContext","getBoundingClientRect","showContextTooltip","DefaultSelect","styles","control","provided","minHeight","boxShadow","isFocused","container","_state","flex","option","padding","placeholder","whiteSpace","valueContainer","marginTop","indicatorsContainer","QuestStatus","cheats","setCheats","selectedItem","setSelectedItem","useDispatch","timeMultiplier","setTimeMultiplier","onCheatStructureState","setStructureState","onCheatWorkers","addWorkers","handleChangeStructureState","checked","Built","addToast","useMemo","k","isNaN","parseInt","typeKey","label","subtext","getItemSubtext","_evt","onCheatGold","onCheatResources","Select","formatGroupLabel","formatOptionLabel","onCheatItem","setCheatTimeMultiplier","structureDef","getStructureDefinition","structureStore","levelDef","level","getStructureRow","encryptor","createEncryptor","storeState","loadedStore","setLoadedStore","handleClickLoad","loadGame","game","onCloseWindow","onOpenWindow","document","createElement","JSON","stringify","encrypted","encrypt","setAttribute","encodeURIComponent","click","saveGame","fileReader","FileReader","onload","decrypt","parse","decryptSavedGame","readAsText","disabled","formatNumber","input","digits","SI_SYMBOL","tier","log10","toFixed","suffix","scale","scaled","useGoldState","selectMaxResources","createSelector","useResourcesState","selectFreeWorkers","useWorkersFreeState","Resourcebar","goldState","storeResources","workersFree","createItem","resourceDescription","resourceDescriptions","Topbar","useContext","persistor","QuestMarker","leader","encounterActive","avatar","maskGraphics","beginFill","drawCircle","CIRCLE_DIAMETER","endFill","mask","addChild","pointerdown","avatarImg","QuestLine","positions","draw","graphics","lineStyle","moveTo","xc","yc","quadraticCurveTo","createStringArraySelector","createSelectorCreator","defaultMemoize","stringArrayEqual","getQuests","quests","getQuestNames","q","getQuestStatus","status","getActiveQuests","active","useQuest","questSelector","useCallback","AdventurerColor","WorldMap","retrieveWorldViewRef","smallMap","selectedQuestName","selectedQuest","activeQuests","selectMemoized","useActiveQuests","WIDTH","worldView","SMALL_HEIGHT","focusOnQuestingParty","point","nodeLocationToPoint","partyLocation","getQuestWorldLocation","previousPositions","getPreviousPositions","currentPosition","questDefinition","questNode","onPartyClick","getQuestTitle","roundedProgress","lastNode","nextNode","WORLD_WIDTH","WORLD_HEIGHT","lastPosition","DebugToggleCombat","Tabstrip","activeTab","Children","child","cloneElement","handleTabClick","tabId","onTabSelected","Tab","AdventurerAvatar","AdventurerTabstrip","onAdventurerTabSelected","selectedAdventurerId","getAdventurers","createSelectAdventurersOnQuest","foundInParty","groupedAdventurers","foundAdventurers","indexOf","val","RectTileLayer","_props","CompositeRectTileLayer","horizontalTiles","spritesheets","w","tilewidth","h","tileheight","spriteId","addFrame","ObjectTileLayer","_oldProps","SpriteAnimated","gotoAndPlay","SceneActor","controller","idleAnimation","spritesheetPath","lookAt","rest","getTileDimensions","tileWidth","tileHeight","actorRef","previousAction","actionQueueSelector","actionQueue","actorId","animation","setAnimation","determineOrientation","nextAction","setOrientation","north","northEast","east","southEast","south","southWest","west","northWest","actionType","moveComplete","actorMoved","killTweensOf","ease","pixi","slash","interact","actorInteract","frames","setFrames","indexed","frame","orientation","flipped","bearing","calculateBearing","interval","setInterval","left","clearInterval","getFrames","black","createColorReplaceFilter","BLUES","BLACK","orange","ORANGE","purple","PURPLE","red","REDS","teal","TEALS","white","WHITE","yellow","YELLOW","animationSpeed","isPlaying","pivot","memo","origin","destination","angle","atan2","round","PI","replacements","MultiColorReplaceFilter","SceneAdventurer","ObjectSpriteLayer","selectedActorId","Tilemap","layers","l","visible","objectgroup","getLayerObjects","tileObjects","spriteObjects","Fragment","tilelayer","layerId","BridgedStage","useTilesetsLoader","tileSpritesheets","setTilesets","setData","nextTileset","nextTilesetToload","tilesetName","spritesheetData","parseSpritesheetData","Spritesheet","newTilesets","loadComplete","loadTilesets","tilesetsTextures","t","tilecount","spriteSourceSize","rotated","trimmed","sourceSize","meta","imagewidth","imageheight","LoadingSpinner","usePrevious","SceneControllerContext","createContext","SceneControllerContextProvider","useStore","loaded","setLoaded","previousQuestVars","getSceneController","dataLoading","loadData","createScene","sceneEntered","updateScene","Provider","Segment","onActivate","onDeactivate","activated","rot","transform","background","zIndex","onMouseOver","onMouseOut","src","segmentWidth","alt","CombatUIWidget","actionIntent","onActionChange","collapsed","setCollapsed","handleSegmentActivate","handleSegmentDeactivate","_action","onMouseMove","getText","insufficient","actorAP","apCost","NormalUICursor","blocked","locationIsBlocked","getObjectAtLocation","images","SceneUI","sceneWidth","sceneHeight","onMouseDown","onSetActionIntent","mouseDown","cursorLocation","setCursorLocation","handleResize","canvas","querySelector","currentWidth","handleCombatActionChange","getSceneActor","ap","findPath","calculateWalkApCosts","findPathNearest","findLocation","Element","rect","clientX","clientY","top","pointToSceneLocation","locationIsOutOfBounds","onMouseUp","selectedActorLocation","actorAttemptAction","DashedLine","points","dash","gap","_destroy","alignment","native","offsetPercentage","dashLeft","gapLeft","progressOffset","rotatedpoints","p","clone","cosAngle","cos","sinAngle","sin","dx","dy","p1","p2","len","normal","progressOnLine","lineTo","ActionPreview","convert","converted","valid","getLog","SceneLog","questId","useQuestLog","lastLog","shift","Scene","setSelectedActor","mapData","currentActionIntent","setCurrentActionIntent","Rectangle","OnTheRoad","QuestDetails","DragSource","beginDrag","inventorySlot","sourceId","sourceType","connectDragSource","dragSource","isDragging","DraggableItemsList","useAdventurersInTown","getAdventurersInTown","useAdventurerState","adventurerSelector","LootCache","freeSlots","cache","getLootCache","cacheName","lootCache","querySelectorAll","classList","stagger","each","takeItemFromCache","takeGoldFromCache","Situation","situation","getSituation","choices","handleChoiceClick","choice","getAttribute","handleSituationOptionClick","data-option","CombatBar","dragInfo","adventurerEquipment","classNames","Inventory","contents","slot","iconSize","onDropItem","useStockpileState","stockpile","useItemDropActions","sceneController","dropItemEquipment","actions","adventurerInventory","existingEquipment","equipment","dropItemInventory","otherItem","dropItemWarehouse","moveItemInWarehouse","AdventurerSkills","skills","s","skill","handleClick","getSkillName","renderSkill","levelToXp","Direction","PlainProgressbar","animationTime","previousProgress","transition","Trait","Level","xp","currentLevel","xpToLevel","currentLevelXp","nextLevel","nextLevelXp","dingAnimationRunning","setDingAnimationRunning","lastState","lastAdventurer","lastDingAnimationRunning","next","ApIndicator","arrowFinder","hasEffect","gloomy","houseHouston","houseMaddox","houseMonroe","Layout","AdventurerTraits","renderTrait","last","traitDefinition","getTraitName","traits","Guy","findDR","useAdventurerDamageReduction","renderDamageReduction","dR","AdventurerEquipment","onDropItemEquipment","getEquipmentSlot","EquipmentSlot","AdventurerPanel","horizontalMode","levelBar","ChannelType","QuestPanel","layout","setSelectedAdventurerID","activeInteractionModal","handleAdventurerSelected","handleCloseLootCacheModal","WorldView","worldMapRef","questname","TaskType","SimpleLog","expanded","setExpanded","selectedTabId","setSelectedTabId","logEntries","activeQuestNames","questNameSelector","names","statuses","useActiveQuestNames","useLocation","pathname","channels","tabType","town","displayEntries","currentTab","lE","tab","logEntry","getLogEntryRow","startTask","taskType","callbacks","useStructureState","structureSelector","DeedContent","structureDefinition","enoughGold","handleStartConstruction","startBuildingStructure","buildStructure","weaponsmithProduction","levelRequired","Placement","armoursmithProduction","workshopProduction","alchemistProduction","getTasks","tasks","useCraftingTasksStateByStructure","running","createSelectCraftingTasksByStructure","useStudyingTasksStateByStructure","createSelectStudyingTasksByStructure","useUpgradeTasksStateByStructure","createSelectUpgradeTasksByStructure","STUDY_TIME","ProducedAtStructure","studyTasks","produces","task","sT","timeRemaining","productionDefinition","getProductionDefinition","studyTime","studyItem","ProduceOrStudy","getItemDefinition","WeaponContent","getWeaponType","classificationText","getWeaponClassification","ApparelContent","ItemContext","ResourceContext","resourcesState","workersState","workersFreeState","structureStates","full","structureState","renderProducedBy","free","total","InfoWindow","Tooltip","placement","setPlacement","containerRect","setContainerRect","tooltipElement","tooltipRect","opacity","contentElement","offset","closest","TraitContext","getTraitDescription","getTraitEffect","ContextTooltip","selectedContext","setSelectedContext","tooltipUpdated","getResourceName","getItemNameClassName","getSkillInfo","component","renderContent","useEngine","TickingProgressbar","previousTick","useDelta","animate","setAnimate","increasing","decreasing","StructureViewHeader","StructureLevel","onHelpClicked","addUpgradeCallbacks","nextLevelCost","canUpgrade","upgradeText","upgradeTasks","startTime","handleUpgrade","UpgradeHelpModal","renderRow","UpDownValue","displayValue","upDisabled","onUp","downDisabled","onDown","ItemsBox","aggregate","itemsInInventory","tmpWarehouse","tmpItems","found","findIndex","splice","removed","listItems","listItemClass","itemDescription","ResourcesCost","sufficientResources","calculateProductionTime","CraftingDetails","stockpileState","workersAssigned","setWorkersAssigned","costResources","missingAtLeastOneResource","missingAtLeastOneItem","costMaterials","handleCraft","craftingTime","removeResources","craftItem","asNumber","makeTimeString","CraftingArea","handleSelectCraftingItem","ProductionStructureView","craftingTasks","studyingTasks","content","deltaResources","empty","res","WAREHOUSE","WarehouseStructureView","adventurersInTown","selectedAdventurer","setSelectedAdventurer","resourcesDelta","setResourcesDelta","previousResources","resourcesRef","structuresState","remove","levelDefinition","currentLevelDefinition","_monitor","AssignAdventurers","onAdventurerClicked","onAdventurerDropped","availableSlots","slotsContent","QuestBoard","checkEnoughItems","every","amountRequired","availableQuests","onQuestClick","fullParty","enoughItems","canLaunch","getQuestDescription","onRemoveAdventurer","onLaunchQuest","getQuestDetails","AdventurerButton","onAddAdventurer","isAssigned","emptySlot","getEmptySlot","spec","View","RoomWithAdventurer","onQuest","assigned","SOURCE_ID","prompt","RoomEmpty","RoomList","roomCount","handleAdventurerClick","roomContent","room","TavernStructureView","setAassignedAdventurers","setSelectedQuest","getAvailableQuests","available","handleAddAdventurer","copy","handleRemoveAdventurer","handleQuestClick","questTitle","questLaunched","ResourceGenerationRow","lastProducedUpdate","ResourceStructureView","decreaseWorkers","buildTask","Building","PixiPlugin","registerPIXI","registerPlugin","generator","App","containerRef","activeWindows","setActiveWindows","handleViewButtonClick","selectStructure","handleWindowOpened","handleWindowClose","handleWindowBack","slice","handleScroll","debounce","maxWidth","DndProvider","backend","HTML5Backend","exact","restartGame","render","topWindow","commonWindowProps","renderWindow","getProducedResources","resourceGeneration","resourceStructureDefinition","accumulator","handleStructure","getQuestUpdates","questProgress","currentProgress","currentNodeIndex","progressIncrease","nextProgress","nodesPassed","questEncounter","logUpdates","questUpdates","dirty","getRngState","Random","isLocalhost","hostname","register","navigator","URL","swUrl","fetch","then","response","headers","serviceWorker","ready","registration","unregister","reload","registerValidSW","catch","checkValidServiceWorker","onupdatefound","installingWorker","installing","onstatechange","generateRandomAttributes","strength","dexterity","intelligence","avatarImgBasePath","spritesheetBasePath","initialAdventurers","basicAttributes","baseAP","getInitialEngineState","lastTick","initialGoldState","getItemsInitialState","randomItem","randomEnum","anEnum","enumValues","initialLogState","gameTick","lU","initialQuestState","encounterResults","questStoreState","qss","deductActorAp","updateSceneObjectAction","tO","questsToUpdate","questToUpdate","deepmerge","arrayMerge","overwriteMerge","updateEncounterResult","concat","nodeIndex","destinationArray","sourceArray","initialResourcesState","initialRngState","updateStructureState","upgradeStructureState","workersToAdd","workersToRemove","structureInitialState","initialStructuresState","createTask","initialTasksState","completed","initialWorkersState","combineReducers","element","moveItemToOtherAdventurer","fromAdventurerId","toAdventurerId","fromAdventurer","addXP","startCombatAction","addAction","combatType","moveAction","GameActionType","startGame","resourcesToAdd","fill","resourcesToRemove","rngState","assign","end","persistConfig","storage","localForage","persistedReducer","persistReducer","rootReducer","configureStore","initial","_reject","createStore","__REDUX_DEVTOOLS_EXTENSION__","persistStore","isHydrated","processCompletedTasks","itemCrafted","handleCompletedTask","initGame","seed","seedrandom","setupStore","storeConfiguration","continueGame","startNewGame","runGame","purge","href","confirm","clearTimeout","ReactDOM","getElementById","registerServiceWorker","logs","resourcesUpdates","isTextEntry","test","movementDuration","BaseSceneController","aStar","dataLoadComplete","jsonPath","blockedTiles","substr","lastIndexOf","loadSound","sounds","promises","createBlockedTiles","createAStar","sceneObjects","createObjects","blocksMovement","_actor","exit","loadScene","node","interactWithObject","warn","interactAction","pop","meleeAction","_object","_name","itemIndex","getAdventurerById","_situation","_adventurerId","_option","convertIn","convertOut","includeLast","grid","getGrid","getGridNodes","matrix","c","getIsWalkable","tempAStar","AStarFinder","includeStartNode","heuristic","weight","sceneActors","sA","row","objectLayers","objectLayer","adventurerStart","enemySpawn","updated","getTextEntry","questUpdate","DungeonEncounterSceneController","DungeonEntranceSceneController","getAdventurerByActor","DungeonHallwaySceneController","discardItem","registerSceneController"],"mappings":"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,SACrB,CACCzE,EAAG,EACHC,EAAG,EACHlW,KAAMyH,IAAciT,SACrB,CACCzE,EAAG,GACHC,EAAG,EACHlW,KAAMyH,IAAciT,SACrB,CACCzE,EAAG,GACHC,EAAG,EACHlW,KAAMyH,IAAciT,SACrB,CACCzE,EAAG,GACHC,EAAG,EACHlW,KAAMyH,IAAciT,SACrB,CACCzE,EAAG,GACHC,EAAG,EACHlW,KAAMyH,IAAciT,SACrB,CACCzE,EAAG,GACHC,EAAG,EACHlW,KAAMyH,IAAciT,SACrB,CACCzE,EAAG,GACHC,EAAG,EACHlW,KAAMyH,IAAciT,SACrB,CACCzE,EAAG,GACHC,EAAG,EACHlW,KAAMyH,IAAciT,SACrB,CACCzE,EAAG,GACHC,EAAG,EACHlW,KAAMyH,IAAciT,SACrB,CACCzE,EAAG,GACHC,EAAG,EACHlW,KAAMyH,IAAciT,SACrB,CACCzE,EAAG,GACHC,EAAG,EACHlW,KAAMyH,IAAciT,SACrB,CACCzE,EAAG,GACHC,EAAG,EACHlW,KAAMyH,IAAciT,SACrB,CACCzE,EAAG,GACHC,EAAG,EACHlW,KAAMyH,IAAciT,SACrB,CACCzE,EAAG,EACHC,EAAG,EACHlW,KAAMyH,IAAciT,SACrB,CACCzE,EAAG,EACHC,EAAG,EACHlW,KAAMyH,IAAciT,SACrB,CACCzE,EAAG,EACHC,EAAG,EACHlW,KAAMyH,IAAcmT,UACpBC,WAAY,mBACb,CACC5E,EAAG,EACHC,EAAG,EACHlW,KAAMyH,IAAciT,SACrB,CACCzE,EAAG,EACHC,EAAG,EACHlW,KAAMyH,IAAciT,SACrB,CACCzE,EAAG,EACHC,EAAG,EACHlW,KAAMyH,IAAciT,SACrB,CACCzE,EAAG,EACHC,EAAG,EACHlW,KAAMyH,IAAciT,SACrB,CACCzE,EAAG,EACHC,EAAG,EACHlW,KAAMyH,IAAciT,SACrB,CACCzE,EAAG,EACHC,EAAG,EACHlW,KAAMyH,IAAciT,SACrB,CACCzE,EAAG,EACHC,EAAG,EACHlW,KAAMyH,IAAciT,SACrB,CACCzE,EAAG,EACHC,EAAG,EACHlW,KAAMyH,IAAciT,SACrB,CACCzE,EAAG,EACHC,EAAG,EACHlW,KAAMyH,IAAciT,SACrB,CACCzE,EAAG,EACHC,EAAG,EACHlW,KAAMyH,IAAcmT,UACpBC,WAAY,mBACb,CACC5E,EAAG,EACHC,EAAG,EACHlW,KAAMyH,IAAciT,YD/IrB,SAASva,EAA2BwN,GAIvC,OAAOzI,EAAIyI,K,6BE9Bf,0GAGYF,EAHZ,QAaO,SAASyN,EAAWlc,EAAaC,GAAqG,IAAtFqK,EAAqF,uDAA/D0L,IAAWjE,OAAQoK,EAA4C,uCAClIC,EAAmB,CACrBpc,MACAC,WAEJ,MAAO,CACHe,KAAMyN,EAAW4N,YACjBD,QACA9R,UACA6R,kBAID,SAASE,EAAYD,GAAwG,IAAtF9R,EAAqF,uDAA/D0L,IAAWjE,OAAQoK,EAA4C,uCAC/H,MAAO,CACHnb,KAAMyN,EAAW4N,YACjBD,QACA9R,UACA6R,mB,SA5BI1N,K,2BAAAA,M,oCCAZ,wIAKO,IAAM6N,EAAqB,SAACC,EAAqCzN,GACpE,OAAOA,EAAM0N,MAAM7S,KAAI,SAAC8S,GAAD,OAAgBC,EAAmBH,EAAaE,OAG9DE,EAAiB,SAACJ,EAAqCzN,GAChE,IAAM8N,EAAW9N,EAAM0N,MAAM,GAC7B,OAAOE,EAAmBH,EAAaK,IAG9BF,EAAqB,SAACH,EAAqCE,GACpE,OAAOF,EAAYM,MAAK,SAACzF,GAAD,OAAOA,EAAEqF,KAAOA,MAM/BK,EAA+B,SAACC,GACzC,OAAOA,EAAWC,UAAU9S,QAAO,SAAAsM,GAAC,OAAU,OAANA,KAAYxK,QAG3CiR,EAAoB,SAACC,GAE9B,YAAqCC,KAAzB,OAALD,QAAK,IAALA,OAAA,EAAAA,EAAOE,OAAOC,e,yKC/BZC,EAAO,SAACC,EAAaC,EAAaC,GAC3C,OAAOF,EAAKE,GAASD,EAAKD,ICOjBG,EAAe,SAACC,EAAkBC,EAAkBH,GAG7D,MAAO,CAAExG,EAFCqG,EAAKK,EAAO1G,EAAG2G,EAAO3G,EAAGwG,GAEvBvG,EADFoG,EAAKK,EAAOzG,EAAG0G,EAAO1G,EAAGuG,KAQhC,SAAeI,EAAtB,kC,4CAAO,WAAiCC,GAAjC,eAAA1G,EAAA,6DACG3N,EAASsU,KAAKrU,OAAOsU,OADxB,kBAEI,IAAIC,SAAkC,SAACC,EAASC,GAC/C1U,EAAOO,UAAU8T,GACjBI,EAAQzU,EAAOO,UAAU8T,IAGzBrU,EAAOI,IAAIiU,GAAMhU,MAAK,SAACC,EAAGC,GACjBA,EAAU8T,GAGXI,EAAQlU,EAAU8T,IAFlBK,WATb,4C,sBAkBA,IAAMC,EAAe,SAACN,EAAcO,GACvC,IAAM5U,EAASsU,KAAKrU,OAAOsU,OACvBvU,EAAOO,UAAU8T,GACjBO,EAAS5U,EAAOO,UAAU8T,IAG9BrU,EAAOI,IAAIiU,GAAMhU,MAAK,SAACC,EAAGC,GAAgBqU,EAASrU,EAAU8T,S,iCCvC1D,IAAKrP,EAQL,SAAS6P,EAAQjb,GACpB,MAAO,CACHrC,KAAMyN,EAAW6P,QACjBjb,UAGD,SAASkb,EAAalb,GACzB,MAAO,CACHrC,KAAMyN,EAAW6P,QACjBjb,QAASA,GAlBjB,sG,SACYoL,K,mBAAAA,M,iEC6DL,IAAK+P,EAWPC,EAOAC,EAlBL,kC,SAAYF,K,sBAAAA,E,2BAAAA,M,cAWPC,K,wBAAAA,E,sBAAAA,E,sBAAAA,E,uBAAAA,M,cAOAC,K,mBAAAA,E,uBAAAA,E,iBAAAA,E,sBAAAA,M,yFC9EiBC,EAAtB,4GAII,SAA+BhQ,EAAmBO,EAAmB0P,GACjEhf,KAAKif,gBAAL,UAAwBlQ,EAAxB,YAAqCO,IAAe0P,IAL5D,gCAWI,SAA0BjQ,EAAmBO,EAAmBgO,GAC5D,IAAKtd,KAAKsd,MAAL,UAAcvO,EAAd,YAA2BO,IAAc,CAC1C,IAAKtP,KAAKif,gBAAL,UAAwBlQ,EAAxB,YAAqCO,IACtC,MAAM,IAAI5O,MAAJ,uCAA0CqO,EAA1C,YAAuDO,IAEjEtP,KAAKsd,MAAL,UAAcvO,EAAd,YAA2BO,IAAe,IAAItP,KAAKif,gBAAL,UAAwBlQ,EAAxB,YAAqCO,KAAagO,EAAOvO,GAE3G,OAAO/O,KAAKsd,MAAL,UAAcvO,EAAd,YAA2BO,MAlB1C,mCAqBI,SAA6BP,EAAmBO,UACrCtP,KAAKsd,MAAL,UAAcvO,EAAd,YAA2BO,QAtB1C,KAAsByP,EACXzB,MAAyD,GAD9CyB,EAEXE,gBAA+D,GAwB1EC,EAAQ,M,oGC1BF5d,EAAW3B,IAASiJ,QACpByH,EAAW,sBAgBX/J,GAAsC,mBACvC1G,IAAKkF,OAAS,CACXzD,KAAMzB,IAAKkF,OACX6D,cAAezH,IAAkBgG,KACjC5F,WACA6O,QAAQ,GAAD,OAAKE,EAAL,iBAL6B,cAOvCzQ,IAAKuf,OAAS,CACX9d,KAAMzB,IAAKuf,OACXxW,cAAezH,IAAkBgG,KACjC5F,WACA8d,gBAAiB,EACjBjP,QAAQ,GAAD,OAAKE,EAAL,iBAZ6B,cAcvCzQ,IAAKyf,OAAS,CACXhe,KAAMzB,IAAKyf,OACX1W,cAAezH,IAAkBgG,KACjC5F,WACA8d,gBAAiB,EACjBjP,QAAQ,GAAD,OAAKE,EAAL,iBAnB6B,cAqBvCzQ,IAAK0f,cAAgB,CAClBje,KAAMzB,IAAK0f,cACX3W,cAAezH,IAAkBkG,KACjC9F,WACA6O,QAAQ,GAAD,OAAKE,EAAL,sBACP+O,gBAAiB,IA1BmB,cA4BvCxf,IAAKmF,MAAQ,CACV1D,KAAMzB,IAAKmF,MACX4D,cAAezH,IAAkB6D,MACjCzD,WACA6O,QAAQ,GAAD,OAAKE,EAAL,eACP+O,gBAAiB,IAjCmB,cAmCvCxf,IAAK2f,YAAc,CAChBle,KAAMzB,IAAK2f,YACX5W,cAAezH,IAAkBiG,MACjC7F,WACA6O,QAAQ,GAAD,OAAKE,EAAL,oBACP+O,gBAAiB,IAxCmB,cA0CvCxf,IAAKoF,KAAO,CACT3D,KAAMzB,IAAKoF,KACX2D,cAAezH,IAAkBkG,KACjC9F,WACA6O,QAAQ,GAAD,OAAKE,EAAL,YACP+O,gBAAiB,IA/CmB,cAiDvCxf,IAAK4f,WAAa,CACfne,KAAMzB,IAAK6f,WACX9W,cAAezH,IAAkB6D,MACjCzD,WACA6O,QAAQ,GAAD,OAAKE,EAAL,qBArD6B,cAuDvCzQ,IAAK8f,UAAY,CACdre,KAAMzB,IAAK8f,UACX/W,cAAezH,IAAkBgG,KACjC5F,WACA6O,QAAQ,GAAD,OAAKE,EAAL,oBA3D6B,cA6DvCzQ,IAAK6f,WAAa,CACfpe,KAAMzB,IAAK6f,WACX9W,cAAezH,IAAkBiG,MACjC7F,WACA6O,QAAQ,GAAD,OAAKE,EAAL,qBAjE6B,cAmEvCzQ,IAAK+f,UAAY,CACdte,KAAMzB,IAAK+f,UACXhX,cAAezH,IAAkBkG,KACjC9F,WACA6O,QAAQ,GAAD,OAAKE,EAAL,oBAvE6B,cAyEvCzQ,IAAKggB,UAAY,CACdve,KAAMzB,IAAKggB,UACXjX,cAAezH,IAAkBmG,KACjC/F,WACA6O,QAAQ,GAAD,OAAKE,EAAL,oBA7E6B,cA+EvCzQ,IAAKigB,OAAS,CACXxe,KAAMzB,IAAKigB,OACXlX,cAAezH,IAAkBkG,KACjC9F,WACA6O,QAAQ,GAAD,OAAKE,EAAL,gBAnF6B,cAqFvCzQ,IAAKkgB,SAAW,CACbze,KAAMzB,IAAKkgB,SACXnX,cAAezH,IAAkBgG,KACjC5F,WACA6O,QAAQ,GAAD,OAAKE,EAAL,iBACP+O,gBAAiB,IA1FmB,cA4FvCxf,IAAKmgB,SAAW,CACb1e,KAAMzB,IAAKmgB,SACXpX,cAAezH,IAAkBiG,MACjC7F,WACA6O,QAAQ,GAAD,OAAKE,EAAL,mBAhG6B,cAkGvCzQ,IAAKogB,aAAe,CACjB3e,KAAMzB,IAAKogB,aACXrX,cAAezH,IAAkBkG,KACjC9F,WACA6O,QAAQ,GAAD,OAAKE,EAAL,uBAtG6B,cAwGvCzQ,IAAKqgB,cAAgB,CAClB5e,KAAMzB,IAAKqgB,cACXtX,cAAezH,IAAkBiG,MACjC7F,WACA6O,QAAQ,GAAD,OAAKE,EAAL,wBA5G6B,cA8GvCzQ,IAAKsgB,YAAc,CAChB7e,KAAMzB,IAAKsgB,YACXvX,cAAezH,IAAkBkG,KACjC9F,WACA6O,QAAQ,GAAD,OAAKE,EAAL,sBAlH6B,cAoHvCzQ,IAAKugB,OAAS,CACX9e,KAAMzB,IAAKugB,OACXxX,cAAezH,IAAkBmG,KACjC/F,WACA6O,QAAQ,GAAD,OAAKE,EAAL,eACP+O,gBAAiB,IAzHmB,cA2HvCxf,IAAKwgB,OAAS,CACX/e,KAAMzB,IAAKwgB,OACXzX,cAAezH,IAAkBmG,KACjC/F,WACA6O,QAAQ,GAAD,OAAKE,EAAL,eACP+O,gBAAiB,IAhImB,cAkIvCxf,IAAKygB,YAAc,CAChBhf,KAAMzB,IAAKygB,YACX1X,cAAezH,IAAkB6D,MACjCzD,WACA6O,QAAQ,GAAD,OAAKE,EAAL,uBAtI6B,cAwIvCzQ,IAAK0gB,YAAc,CAChBjf,KAAMzB,IAAK0gB,YACX3X,cAAezH,IAAkB6D,MACjCzD,WACA6O,QAAQ,GAAD,OAAKE,EAAL,uBA5I6B,cA8IvCzQ,IAAK2gB,YAAc,CAChBlf,KAAMzB,IAAK2gB,YACX5X,cAAezH,IAAkB6D,MACjCzD,WACA6O,QAAQ,GAAD,OAAKE,EAAL,uBAlJ6B,cAoJvCzQ,IAAK4gB,YAAc,CAChBnf,KAAMzB,IAAK4gB,YACX7X,cAAezH,IAAkB6D,MACjCzD,WACA6O,QAAQ,GAAD,OAAKE,EAAL,uBAxJ6B,cA0JvCzQ,IAAK6gB,aAAe,CACjBpf,KAAMzB,IAAK6gB,aACX9X,cAAezH,IAAkBiG,MACjC7F,WACA6O,QAAQ,GAAD,OAAKE,EAAL,wBA9J6B,cAgKvCzQ,IAAK8gB,aAAe,CACjBrf,KAAMzB,IAAK8gB,aACX/X,cAAezH,IAAkBiG,MACjC7F,WACA6O,QAAQ,GAAD,OAAKE,EAAL,wBApK6B,cAsKvCzQ,IAAK+gB,YAAc,CAChBtf,KAAMzB,IAAK+gB,YACXhY,cAAezH,IAAkBkG,KACjC9F,WACA6O,QAAQ,GAAD,OAAKE,EAAL,wBA1K6B,cA4KvCzQ,IAAKghB,WAAa,CACfvf,KAAMzB,IAAKghB,WACXjY,cAAezH,IAAkBmG,KACjC/F,WACA6O,QAAQ,GAAD,OAAKE,EAAL,sBAhL6B,cAkLvCzQ,IAAKihB,gBAAkB,CACpBxf,KAAMzB,IAAKihB,gBACXlY,cAAezH,IAAkB4f,UACjCxf,WACA6O,QAAQ,GAAD,OAAKE,EAAL,2BAtL6B,cAwLvCzQ,IAAKmhB,gBAAkB,CACpB1f,KAAMzB,IAAKmhB,gBACXpY,cAAezH,IAAkB4f,UACjCxf,WACA6O,QAAQ,GAAD,OAAKE,EAAL,2BA5L6B,cA8LvCzQ,IAAKohB,KAAO,CACT3f,KAAMzB,IAAKohB,KACXrY,cAAezH,IAAkB6D,MACjCzD,WACA6O,QAAQ,GAAD,OAAKE,EAAL,gBAlM6B,cAoMvCzQ,IAAKqhB,WAAa,CACf5f,KAAMzB,IAAKqhB,WACXtY,cAAezH,IAAkB4f,UACjCxf,WACA6O,QAAQ,GAAD,OAAKE,EAAL,qBAxM6B,cA0MvCzQ,IAAKshB,WAAa,CACf7f,KAAMzB,IAAKshB,WACXvY,cAAezH,IAAkB4f,UACjCxf,WACA6O,QAAQ,GAAD,OAAKE,EAAL,mBACP+O,gBAAiB,IA/MmB,cAiNvCxf,IAAKuhB,WAAa,CACf9f,KAAMzB,IAAKuhB,WACXxY,cAAezH,IAAkB4f,UACjCxf,WACA6O,QAAQ,GAAD,OAAKE,EAAL,qBArN6B,cAuNvCzQ,IAAKwhB,KAAO,CACT/f,KAAMzB,IAAKwhB,KACXzY,cAAezH,IAAkB6D,MACjCzD,WACA6O,QAAQ,GAAD,OAAKE,EAAL,gBA3N6B,GAiOrC,SAAS9O,EAA2CqH,GACvD,OAAOtC,EAAIsC,GAHAtC,O,iCCpPf,6CAuBasV,EAAyC,CAClDyF,QAAS,CACLC,SAAS,EACTC,SAAU,CACNC,WAAW,EACXzc,MAAO,CACH0D,MAAO,iCACPgZ,MAAO,CACH7hB,IAAKsgB,YACLtgB,IAAKma,MACLna,IAAK0Y,WACL1Y,IAAKigB,QAETrb,KAAM,MAUdkd,QAAS,CACL3c,MAAO,CACH0D,MAAO,iCACPgZ,MAAO,CAAE7hB,IAAKQ,MAElBohB,WAAW,EACXG,UAAU,M,01NC/CV9S,E,4FAAAA,K,oBAAAA,E,uBAAAA,M,SCDAA,E,QCAN+S,EAAU,QAEDA,IACFC,ECEqB,SAACC,GAE/B,IAAMC,EAAQD,EAAOE,MAAM,KAAKjY,KAAI,SAACkY,GAAD,OAAUC,OAAOD,MAErD,GAAqB,IAAjBF,EAAM3V,OACN,MAAM,IAAI1L,MAAJ,2CAA8CohB,IAIxDC,EAAM/f,SAAQ,SAACigB,GACX,GAAIA,GAAQ,KACR,MAAM,IAAIvhB,MAAJ,kCAAqCuhB,EAArC,qBAKd,IAFA,IAAIE,EAAiB,EAEZvL,EAAI,EAAGA,EAAI,EAAGA,IACnBuL,GAAkBJ,EAAMnL,IAAU,GAAJA,EAElC,OAAOuL,EDrBkBC,CAAmBR,I,SDHpC/S,K,sCAAAA,E,sCAAAA,E,uBAAAA,M,SGFAwT,E,QCuCGC,EA9BM,SAACC,EAAejF,GACjC,IACM1N,EADQ0N,EAAMkF,WACC5S,OACrB,GAAIA,EAAO6S,QACQ7S,EAAO6S,OACXC,OAAStN,KAAKC,MACrB,GAAIzF,EAAOyL,OAASpO,IAAW0V,YAMxB,GAAI/S,EAAOyL,OAASpO,IAAWC,OAAQ,CAC1C,OAAQ0C,EAAO6S,OAAOrhB,MAClB,KAAK2Z,IAAiB6H,KAClBtF,EAAMuF,SJMvB,SAAmB/V,EAAeqO,GACrC,MAAO,CACH/Z,KAAMyN,EAAWiU,UACjBhW,QACAqO,YIV+B2H,CAAUlT,EAAO6S,OAAO3V,MAAO8C,EAAO6S,OAAOM,SAC5DzF,EAAMuF,SJenB,CACHzhB,KAAMyN,EAAWmU,oBIXT,MAAO,CACHP,OAAQ,MAKxB,OAAO,M,+HDpCCJ,O,uBAAAA,I,uBAAAA,I,kBAAAA,M,iCECSY,E,WAGjB,aAAiF,IAArEC,EAAoE,uDAAlB,GAAIC,EAAc,uDAAL,IAAK,yBAFzED,YAEyE,EAE9EljB,KAAKkjB,OAASA,EAAOC,GAAQpZ,KAAI,SAACqZ,GAChC,IAAMC,EAAkBD,EAAWC,MACnC,OAAO,IAAIlF,UAAakF,M,4CAS5B,WAAwB,IAAfhM,EAAc,uDAAV,EAAGC,EAAO,uDAAH,EAClB,SAAStX,KAAKkjB,QAAiC,IAAvBljB,KAAKkjB,OAAO9W,SAElCpM,KAAKkjB,OAAOI,MAAK,SAAAD,GAAK,OAAIA,EAAME,SAASlM,EAAGC,U,qCC2CrCkM,EA/CI,SAAC7c,GAAkB,IAC3B8c,EAAiB9c,EAAjB8c,cACDjiB,EAAY2C,IAAUiB,WACtBse,EAAK,UAAMrV,IAAN,gCAAoD7M,EAApD,SAHsB,EAIDmiB,qBAJC,mBAI1BC,EAJ0B,KAIhBC,EAJgB,KAK3BvX,EAAU3F,EAAMmd,SAAW,CAACC,IAA8B,GAE1DC,EAAMC,mBAEZC,qBAAU,WACN1F,YAAakF,GAAO,SAACphB,GACbA,GACAuhB,EAAYvhB,EAASshB,eAG9B,CAACI,EAAKA,EAAIna,OAAQ6Z,IAfY,MAiBDC,mBAAS,GAjBR,mBAiB1BQ,EAjB0B,KAiBhBC,EAjBgB,KAqBjC,OAHAC,mBAAQ,SAAC9B,GAAD,OAA8B6B,GAAY,SAAA5Z,GAAC,OAAIA,EA3B9B,IA2B0D+X,QAG9EqB,EAED,cAAC,SAAD,CACIziB,KAAMK,EACN8iB,SAAU3d,EAAM2d,SAChBC,aAAa,EACbC,YAAY,EACZC,WAAY,WACR9d,EAAM+d,iBAAiBljB,IAE3BmjB,QAASlB,EACTnX,QAASA,EACTsY,QAAShB,EAAS,iBAVtB,SAYI,cAAC,SAAD,CACIziB,KAAK,SACLyjB,QAAShB,EAAS,cAClBiB,OAAQ,IAAI1G,QAAW,GAAK,IAC5B9G,EAAG,GACHC,EAAG,GACH6M,SAAUA,MApBA,M,0BCwBXW,EAjDSC,wBAAsF,kBAAmB,CAC7HC,OAD6H,WAE3H,OAAO,IAAI7G,qBAGb8G,WAL6H,SAKlH5Z,EAAU6Z,EAAiBC,GAAkB,IAAD,OAC7CpX,EAA2BoX,EAA3BpX,MAAOqX,EAAoBD,EAApBC,OAAWC,EAD2B,YAClBF,EADkB,oBAIrDG,4BAAkBja,EAAU6Z,EAAUG,GAEtC,IAAIE,EAAWvlB,KAA4CwlB,SAC3D,IAAKD,EAAS,CACZA,EAAU,IAAIE,IACZpa,EACA,CAAC8S,UAAalS,KAAK8B,IACnBqX,GAGF,IAAIM,EAAUC,YAAYtQ,MAc1BkQ,EAAQjQ,MAAO,EAZF,SAAPsQ,IACH,EAA4CC,KAAOC,sBAAsBF,GAC1E,IAAMvQ,EAAMsQ,YAAYtQ,MAMxBkQ,EAAQQ,OAAyB,MAAjB1Q,EAAMqQ,IAEtBA,EAAUrQ,EAKZuQ,GAED5lB,KAA4CwlB,SAAWD,GAG1DS,YAzC6H,WA0CtHhmB,KAA4CwlB,WAC9CxlB,KAA4CwlB,SAASlQ,MAAO,EAC7D2Q,qBAAsBjmB,KAA4C6lB,UCf3DK,EA5BA,SAACvf,GAAkB,IACvB8c,EAA2B9c,EAA3B8c,cAAea,EAAY3d,EAAZ2d,SAChB9iB,EAAY2C,IAAUyB,OACtB0G,EAAU3F,EAAMmd,SAAW,CAACC,IAA8B,GAEhE,OACI,eAAC,YAAD,CAAWO,SAAUA,EAArB,UACI,cAAC,SAAD,CACInjB,KAAMK,EACN+iB,aAAa,EACbC,YAAY,EACZC,WAAY,WACR9d,EAAM+d,iBAAiBljB,IAE3B8K,QAASA,EACTqY,QAASlB,EACT1V,MAAK,UAAKM,IAAL,gCAAmD7M,EAAnD,UAET,cAAC,EAAD,CACIL,KAAK,QACLkW,EAAG,IACHC,GAAI,EACJvJ,MAAK,UAAKM,IAAL,uCACL+W,OAAQe,Q,uBC5BXC,EAAiB,SAAiDC,GAG3E,mKACI,WAAiB,IAAD,OACZ,OACI,cAACC,GAAWC,SAAZ,UACK,SAAClmB,GAAD,OAAkB,cAACgmB,EAAD,2BAAsB,EAAK1f,OAAYtG,WAJ1E,GAAiCmmB,cC+BtBC,GA9BC,SAAC9f,GAAkB,IACxBnF,EAAkEmF,EAAlEnF,UAAW8iB,EAAuD3d,EAAvD2d,SAAUb,EAA6C9c,EAA7C8c,cAAeK,EAA8Bnd,EAA9Bmd,SAAUY,EAAoB/d,EAApB+d,iBAC/CpY,EAAUwX,EAAW,CAACC,IAA8B,GAM1D,OACI,cAAC,SAAD,CACI5iB,KAAMK,EACN8iB,SAAUA,EACVC,aAAa,EACbC,YAAY,EACZC,WAViB,WACrBC,EAAiBljB,IAUbmjB,QAASlB,EACTnX,QAASA,EACTyB,MAAK,UAAKM,IAAL,gCAAmD7M,EAAnD,WCkCFklB,I,OAlDC,SAAC/f,GAAkB,IACxBggB,EAAchgB,EAAdggB,WACDC,EAAoB,CACtBziB,IAAUkC,SACVlC,IAAUqB,OACVrB,IAAUyB,OACVzB,IAAUuB,QACVvB,IAAUC,UACVD,IAAUc,OACVd,IAAU+B,YACV/B,IAAUU,YACVV,IAAU2B,UACV3B,IAAUmB,KACVnB,IAAUiB,WACVjB,IAAUiC,QAERygB,EAAQC,YAAa,UAAyB7W,cAAzB,gBAErB8W,EAAa,SAACvlB,GAChB,OAAS,OAALqlB,QAAK,IAALA,OAAA,EAAAA,EAAOG,OAAOxlB,aAAcA,EAAUylB,WAElC,sBAAM1e,UAAU,cAAhB,mBAAkC1I,IAAYqnB,iBAAiB1lB,MAInE,cAAC,IAAD,CAAMsK,GAAIoE,YAAiB1O,GAA3B,mBACQ3B,IAAYqnB,iBAAiB1lB,OAK7C,OACI,qBAAK+G,UAAU,UAAf,SACI,6BACCqe,EAAkB7c,KAAI,SAACvI,GAEpB,OAD4CmlB,EAAWnlB,GACpC2lB,QAAU9E,EAAe+E,SACjC,KAGP,6BACKL,EAAWvlB,IADPA,Y,6BCrCvB6lB,GAAWC,sBAAmD,SAAC3gB,EAAO4gB,GAC1E,IAAMvD,EAAMC,mBACZ,GAAID,EAAK,CAEL,IAAMwD,EAAM,eCtBH,q3DDsBG,YACZxD,EAAIyD,SAASC,QAAQC,YAAYC,aAAaC,QAAUL,EAE5D,OAAO,cAACM,GAAD,yBAAuB9D,IAAKA,GAASrd,GAArC,IAA4C4gB,IAAKA,QAE1DF,GAAS3iB,YAAc,cAMvB,IAAMojB,GAAwB/C,wBAAc,WAAY,CACtDC,OAAQ,SAACre,GACP,IAAMohB,EAAW,IAAIC,KAAa,CAChCC,YAAathB,EAAMshB,YACnBC,aAAcvhB,EAAMuhB,aACpBC,WAAYxhB,EAAMwhB,WAClBC,YAAazhB,EAAMyhB,YACnBC,OAAQ1hB,EAAMqd,IAAIqE,OAClBV,YAAahhB,EAAMqd,IAAIyD,SAASC,QAAQC,cAG1CI,EAAS5b,GAAG,WAAW,SAACmc,GAAe3hB,EAAMwP,SAASxP,EAAMwP,QAAQmS,MAVvB,MAezC3hB,EAFF4hB,gBAb2C,MAahC,EAbgC,IAezC5hB,EADF6hB,gBAd2C,MAchC,EAdgC,EAyB7C,OARAT,EACGU,OACAC,QACAC,QACAC,MAAM,CAAEC,UAAW,QACnBC,UAAU,CAAEP,WAAUC,aACtBO,aAEIhB,KAGIV,ME9CT2B,GAAY1B,sBAAmD,SAAC3gB,EAAiC4gB,GAAkC,IAEjI7e,EAKA/B,EALA+B,SACAuf,EAIAthB,EAJAshB,YACAC,EAGAvhB,EAHAuhB,aACAC,EAEAxhB,EAFAwhB,WACAC,EACAzhB,EADAyhB,YAGEa,EAAWC,iBAAqB,MAkCtC,OAhCAC,8BAAoB5B,GAAK,WAErB,OAAO0B,EAASG,WAIpBlF,qBAAU,WAEN,GADAmF,GAAOC,SAAU,EACdL,EAASG,QAAS,CAEjB,IAAMrB,EAAWkB,EAASG,QAC1BrB,EAAS5b,GAAG,SAAS,WACjB,IAAMod,EAAmB1d,IAAK2d,MAAMC,UAAU1B,EAASE,YAAaE,EAAYJ,EAAS2B,OACnFC,EAAiB9d,IAAK2d,MAAMC,UAAUrB,EAAaL,EAASG,aAAcH,EAAS6B,QACnFC,EAASlmB,KAAKmmB,IAAIP,EAAmBI,EAAiB,GAAI,GAEhEN,GAAOU,KAAQF,EACfR,GAAOW,WAAa,IACpBX,GAAOC,QAAUD,GAAOU,KAAO,KAIvC,IAAME,EAAW,SAACC,GAEdA,EAAEC,kBAGN,OADAC,OAAOC,iBAAiB,QAASJ,EAAU,CAACK,SAAS,IAC9C,WACHF,OAAOG,oBAAoB,QAASN,MAEzC,CAAC7B,EAAaD,IAGb,cAAC,QAAD,CAAOqC,MAAOvC,EAAawC,OAAQvC,EAAcwC,QAASA,GAA1D,SACI,cAAC,GAAD,CACIzC,YAAaA,EACbC,aAAcA,EACdC,WAAYA,EACZC,YAAaA,EACbb,IAAK0B,EALT,SAMI,cAAC,SAAD,CACI9nB,KAAK,aACL4M,MAAK,UAAKM,IAAL,uCACL/B,QAAS,CAAC+c,IAHd,SAKK3gB,WAOrBsgB,GAAUtkB,YAAc,YAETskB,IC7EH2B,GAOAC,GDsEG5B,MAET0B,GAAU,CACZG,aAAa,EACbC,cAAc,GAGLzB,GAAS,IAAI0B,KEpDXC,GA5BA,SAACrkB,GAAkB,IAAD,EACPA,EAAdskB,aADqB,MACb,EADa,IAEHtH,mBAASuH,MAFN,mBAEtBC,EAFsB,KAEfC,EAFe,KAGvBrd,EAAK,UAAMM,IAAN,mCAAuD8c,EAAvD,QAHkB,EAIXxH,oBAAU,KAJC,mBAItBtM,EAJsB,KAInBgU,EAJmB,OAKX1H,mBAAS2H,MALE,mBAKtBhU,EALsB,KAKnBiU,EALmB,KAiB7B,OAVAlH,mBAAQ,SAAC9B,GACDlL,EAAI1Q,EAAMwhB,YACVkD,EAAK,IAAuB,IAAhB1nB,KAAK0I,UACjBkf,EAAKD,MACLF,EAASF,OAETG,EAAKhU,EAAI4T,GAAS1I,GAAS,OAK/B,cAAC,SAAD,CACIphB,KAAI,gBAAWgqB,GACfpd,MAAOA,EACP8P,MAAO,GACPxG,EAAGA,EACHC,EAAGA,KAOT4T,GAAc,kBAAMvnB,KAAKK,MAAsB,EAAhBL,KAAK0I,UAAgB,GACpDif,GAAU,kBAAuB,IAAjB3nB,KAAK0I,SAAkB,KCPhC0X,GAA6B,IAAIyH,IAAc,EAAG,UA8IhDpF,MA5IE,SAACzf,GACd,IAAMkgB,EAAQC,YAAa,UAAyB7W,cAAzB,gBACrBwb,EAAiB,OAAG5E,QAAH,IAAGA,OAAH,EAAGA,EAAOG,OAAOxlB,UAClC+lB,EAAM2B,iBAAuB,MAC7BwC,EAAcxC,iBAAqB,MACnCyC,EAAWzC,kBAAO,GAExBhF,qBAAU,WACNhb,IAAa0iB,SAAS,aAAc,6BAA6B,WAC7D1iB,IAAaqM,UAAU,aAAczM,IAAQK,OAAO,EAAMJ,IAAQ6C,MAAM,QAE7E,IAEHsY,qBAAU,WACN,IAAM2H,EAAQhgB,IAAKC,GAAGiY,GAA4B,CAC9CvY,SAAU,GACVsgB,UAAW,EACXC,MAAM,EACNC,QAAS,IAEb,OAAO,WACHH,EAAMI,MAAM,GACZJ,EAAMK,UAEX,IAEHhI,qBAAU,WACN,GAAGwH,EAAYtC,QAAS,CAEpB,IAAMrB,EAAW2D,EAAYtC,QAC7BrB,EAAS5b,GAAG,cAAc,SAAC+d,GACvByB,EAASvC,SAAU,EACnBc,EAAE5B,MAAM6D,qBAEZpE,EAAS5b,GAAG,YAAY,WAAQwf,EAASvC,SAAU,QAExD,IAEH,IAAMgD,EAAuB,SAAC5qB,GACrBmqB,EAASvC,SACVziB,EAAM+d,iBAAiBljB,IAIzBmlB,EAAa0F,aAA8C,SAAClF,GAC9D,OAAOA,EAAMR,cAyCjBzC,qBAAU,WACN,GAAIuH,GAAqBC,EAAYtC,QAAS,CAC1C,IAAMrB,EAAW2D,EAAYtC,QAC7BrB,EAASuE,YAAY,GACrB,IAAMhI,EAAWiI,GAAqBd,GACtC1D,EAASyE,WAAWlI,MAEzB,CAACmH,IA7F6C,MA+FX9H,mBAAS8I,IA/FE,mBA+F1CC,EA/F0C,KA+F7BC,EA/F6B,OAgGThJ,mBA1G7B,MAUsC,mBAgG1CiJ,EAhG0C,KAgG5BC,EAhG4B,KAmHjD,OAjBA3I,qBAAU,WAEN,IAAM4I,EAAS,WAAO,IAAD,IACXC,GAAiB,UAAAxF,EAAI6B,eAAJ,eAAa4D,cAAeP,GAC7CQ,GAAkB,UAAA1F,EAAI6B,eAAJ,eAAa8D,eAhHlC,KAkHHP,EAAeI,GACfF,EAAgBI,IAIpB,OAFAH,IACA1C,OAAOC,iBAAiB,SAAUyC,GAC3B,WACH1C,OAAOG,oBAAoB,SAAUuC,MAE1C,IAIC,sBAAKvkB,UAAU,YAAYgf,IAAKA,EAAhC,UACI,cAAC,GAAD,CAASZ,WAAYA,IACrB,eAAC,GAAD,CACIsB,YAAayE,EACbxE,aAAc0E,EACdzE,WAlII,KAmIJC,YAlIK,KAmILb,IAAKmE,EALT,UAOI,cAAC,GAAD,CAAQvD,WAAYuE,IA5EF,CACtBvoB,IAAUkC,SACVlC,IAAUqB,OACVrB,IAAUyB,OACVzB,IAAUuB,QACVvB,IAAUC,UACVD,IAAUc,OACVd,IAAU+B,YACV/B,IAAUU,YACVV,IAAU2B,UACV3B,IAAUmB,KACVnB,IAAUiB,WACVjB,IAAUiC,QAEW+mB,UAAUpjB,KAAI,SAACvI,GAEpC,GAD4CmlB,EAAWnlB,GACpC2lB,QAAU9E,EAAe+E,SACxC,OAAO,KAIX,IAAMgG,EAAqBC,GAAa7rB,GAClC8iB,EAAWiI,GAAqB/qB,GAChCiiB,EAAgB,IAAIR,EAAcqK,EAAU9rB,GAClD,OACI,cAAC4rB,EAAD,CACI9I,SAAUA,EACV9iB,UAAWA,EACXiiB,cAAeA,EACfiB,iBAAkB0H,EAElBtI,SAAU2H,IAAsBjqB,GAD3BA,MAgDT,cAAC,GAAD,CAAQ2mB,WAAYuE,aAe9BW,GAAe,SAAC7rB,GAClB,OAAQA,GACJ,KAAK2C,IAAUkC,SACf,KAAKlC,IAAUqB,OACf,KAAKrB,IAAUuB,QACf,KAAKvB,IAAUC,UACf,KAAKD,IAAUc,OACf,KAAKd,IAAU+B,YACf,KAAK/B,IAAUU,YACf,KAAKV,IAAU2B,UACf,KAAK3B,IAAUmB,KACf,KAAKnB,IAAUiC,OACX,OAAOqgB,GACX,KAAKtiB,IAAUiB,WACX,OAAOoe,EACX,KAAKrf,IAAUyB,OACX,OAAOsgB,IAIbqG,GAAuB,SAAC/qB,GAC1B,IAAI6V,EACAC,EACJ,OAAQ9V,GACJ,KAAK2C,IAAUkC,SACXgR,EAAI,IACJC,EAAI,IACJ,MACJ,KAAKnT,IAAUqB,OACX6R,EAAI,IACJC,EAAI,IACJ,MACJ,KAAKnT,IAAUuB,QACX2R,EAAI,IACJC,EAAI,IACJ,MACJ,KAAKnT,IAAUyB,OACXyR,EAAI,IACJC,EAAI,IACJ,MACJ,KAAKnT,IAAUC,UACXiT,EAAI,IACJC,EAAI,IACJ,MACJ,KAAKnT,IAAUc,OACXoS,EAAI,IACJC,EAAI,IACJ,MACJ,KAAKnT,IAAU+B,YACXmR,EAAI,IACJC,EAAI,IACJ,MACJ,KAAKnT,IAAUU,YACXwS,EAAI,IACJC,EAAI,IACJ,MACJ,KAAKnT,IAAU2B,UACXuR,EAAI,IACJC,EAAI,IACJ,MACJ,KAAKnT,IAAUiB,WACXiS,EAAI,IACJC,EAAI,IACJ,MACJ,KAAKnT,IAAUmB,KACX+R,EAAI,IACJC,EAAI,IACJ,MACJ,KAAKnT,IAAUiC,OACXiR,EAAI,IACJC,EAAI,IAGZ,OAAO,IAAI6G,KAAKoP,MAAMlW,EAAGC,I,kBCzNdkW,I,OAxBA,WAAO,IAAD,EAEuB7J,mBAAwB,IAF/C,mBAEV8J,EAFU,KAEIC,EAFJ,KAIXC,EAAgB,SAACxY,GACfA,GAAOuY,EAAgBvY,IAU/B,OAPA+O,qBAAU,WAEN,OADAlP,KAAa3J,SAASuiB,YAAY7Y,KAAsB4Y,GACjD,WACH3Y,KAAa3J,SAASwiB,eAAe9Y,KAAsB4Y,MAEhE,IAGC,qBAAKplB,UAAU,SAAf,SACMklB,EAAa1jB,KAAI,SAAC+jB,GAAD,OACf,cAACjY,GAAA,EAAD,eAAkCiY,GAAtBA,EAAYpqB,a,iBHtB5BinB,O,eAAAA,I,iBAAAA,I,mBAAAA,I,kBAAAA,Q,cAOAC,K,YAAAA,E,gBAAAA,E,eAAAA,Q,KAiBZ,IIxBY/b,GCGAA,GLiDGkf,GA5BA,SAACpnB,GAAmD,IAAD,EACtDqnB,EAAuCrnB,EAAvCqnB,MAAOC,EAAgCtnB,EAAhCsnB,OAAQC,EAAwBvnB,EAAxBunB,KAASC,EAD8B,YACfxnB,EADe,2BAOxD4B,EAAY,0BACZ5B,EAAM4B,WAAa,GADP,4BAEY,kBAAVylB,EAAqBA,EAAQpD,GAAW,OAACoD,QAAD,IAACA,IAASpD,GAAYwD,MAFhE,4BAGiB,kBAAfznB,EAAMqH,KAAoBrH,EAAMqH,KAAO2c,GAAU,UAAChkB,EAAMqH,YAAP,QAAe2c,GAAW0D,MAH7E,qBAIZJ,EAAS,gBAAkB,GAJf,UAKhBK,QAAQ,SAAU,KAEpB,OACI,kDACQH,GADR,IAEI5lB,UAAWA,EACX4N,QAfY,SAAC+T,GAA4C,IAAD,EAC5D,UAAAvjB,EAAMwP,eAAN,cAAAxP,EAAgBujB,IAWhB,SAKI,mCACOgE,GAAQA,GACTA,GAAQvnB,EAAM+B,gBMsBjB6lB,GAvDA,SAAC5nB,GAyBZ,OAPAud,qBAAU,WAEN,OADAhb,IAAaslB,eAAgB,EACtB,WACHtlB,IAAaslB,eAAgB,MAKjC,sBAAKjmB,UAAY,SAAjB,UACI,sBAAKA,UAAY,SAAjB,WAC4B,IAAtB5B,EAAM8nB,aACJ,cAAC,GAAD,CACIlmB,UAAU,cACV4N,QArBD,SAACuY,GACZ/nB,EAAMgoB,SACD,OAALhoB,QAAK,IAALA,KAAOgoB,SAEPzlB,IAAaqM,UAAU,oBAkBX0Y,QAAQ,EACRjgB,KAAM,SACNggB,MAAM,SACNE,KAAK,MAGb,6BAAMvnB,EAAM8B,SACa,IAAvB9B,EAAMioB,cACJ,cAAC,GAAD,CACIrmB,UAAU,eACV4N,QAxCA,SAACuY,GACb/nB,EAAMkoB,UACD,OAALloB,QAAK,IAALA,KAAOkoB,UAEP3lB,IAAaqM,UAAU,oBAqCX0Y,QAAQ,EACRjgB,KAAM,SACNggB,MAAM,SACNE,KAAK,SAIfvnB,EAAM+B,aC/DPomB,I,OAAa,SAAuCzI,GAC7D,mKAEI,WACI,OAAO,cAAC,GAAD,2BAAarmB,KAAK2G,OAAlB,aACH,cAAC0f,EAAD,eAAuBrmB,KAAK2G,eAJxC,GAAgCooB,e,SCwDrBC,I,OAAAA,aACXF,GADWE,EArDQ,WAEnB,IAAMC,EAAqB,SAACvkB,GAmBxB,OACI,8BACI,gCAAQ5B,IAAQ4B,KAChB,wBAAQyL,QAhBQ,SAAC+T,GAA4C,IAAD,EAC1DgF,EAAM,UAAIhF,EAAEiF,cAAoCC,kBAA1C,aAAG,EAAmDC,UAC9DH,GACArjB,IAAKC,GAAGojB,EAAQ,CACZ1jB,SAAU,GACVvJ,MAAO,EACP8J,WAAY,WACR7C,IAAaomB,iBAAiB5kB,EAAS,OAS/C,SACI,sBAAM6kB,KAAK,MAAMC,aAAW,OAA5B,4BAEJ,uBACIpuB,KAAK,QACLquB,IAAI,IACJ3F,IAAI,IACJ4F,KAAK,OACLC,SA7Be,SAACzF,GACxB,IAAM0F,EAASC,WAAW3F,EAAEnH,OAAO9gB,OAC7B8Z,EAAMpY,KAAKmsB,IAAIF,EAAQ,GAC7B1mB,IAAaomB,iBAAiB5kB,EAASqR,IA2B/BgU,aAAY,UAAKpsB,KAAKqsB,KAAK9mB,IAAa+mB,iBAAiBvlB,WAMzE,OACI,qBAAKnC,UAAU,kBAAf,SACI,0BAAS2nB,MAAS,EAAO3nB,UAAU,QAAnC,UACI,mDACA,oCACK0mB,EAAmBnmB,IAAQO,IAC3B4lB,EAAmBnmB,IAAQQ,OAC3B2lB,EAAmBnmB,IAAQK,mB,4CCnDnCgnB,GAAoBvtB,KAGpBwtB,GAAgB,CACzB5pB,KAASrB,KACTqB,KAASnB,KACTmB,KAASjB,KACTiB,KAASf,MACTe,KAASR,OACTQ,KAASb,S,QLON,SAAS0qB,GAAajmB,GACzB,MAAO,CACHhJ,KAAMyN,GAAWwhB,aACjBjmB,aCgBD,SAASkmB,GAAwB9uB,GACpC,MAAO,CACHJ,KAAMyN,GAAWyhB,wBACjB9uB,aAID,SAAS+uB,GAAiB/uB,GAC7B,MAAO,CACHJ,KAAMyN,GAAW0hB,iBACjB/uB,aAKD,SAASgvB,GAAgBhvB,GAAuD,IAAjCivB,EAAgC,uDAAtB,EAC5D,MAAO,CACHrvB,KAAMyN,GAAW2hB,gBACjBhvB,YACAivB,WAqBD,SAASC,GAAoBlvB,EAAsBH,GACtD,MAAO,CACHD,KAAMyN,GAAW6hB,oBACjBlvB,YACAH,S,SD9EIwN,K,4BAAAA,E,mCAAAA,Q,cCGAA,K,oCAAAA,E,kCAAAA,E,kCAAAA,E,gDAAAA,E,kDAAAA,E,sCAAAA,E,2CAAAA,Q,SKHAA,GCDAA,GCHA8hB,G,SF8BL,SAASC,GAAmBvvB,EAAYmT,GAC3C,MAAO,CACHpT,KAAMyN,GAAWgiB,QACjBxvB,OACAmT,UAYD,SAASsc,GAAwBvc,GACpC,MAAO,CACHnT,KAAMyN,GAAWkiB,WACjBxc,YAID,SAASyc,GAAkBC,GAC9B,MAAO,CACH7vB,KAAMyN,GAAWmiB,kBACjBC,U,SApDIpiB,K,kBAAAA,E,0CAAAA,E,wBAAAA,E,uCAAAA,Q,cCDAA,K,yBAAAA,Q,cCHA8hB,O,iCAAAA,I,2CAAAA,I,kBAAAA,Q,KAOZ,ICDYO,GDCRC,GAAsB,EAKbC,GAAoB,SAAChwB,GAC9B,OAAQA,GACL,KAAKuvB,GAASU,MAIb,QACI,OAAOF,M,SCbPD,O,eAAAA,I,iBAAAA,I,uBAAAA,I,iBAAAA,I,0BAAAA,Q,gDCKCI,GAAwB,wBAKxBC,GAAb,6KAII,SAA2BnwB,EAAmBowB,EAAmBC,EAAwBlpB,GACrF,IAAMlI,EAAU,CAAEe,OAAMowB,OAAME,cAAeD,EAAYlpB,aAEtDopB,KAAWtxB,EAASL,KAAK4xB,aACxB5xB,KAAK6xB,SAEL7xB,KAAKqL,SAASiK,KAAKgc,GAAuBjxB,GAC1CL,KAAK4xB,YAAcvxB,KAX/B,mBAeI,WACIL,KAAKqL,SAASiK,KAAKgc,QAAuB/T,GAC1Cvd,KAAK4xB,iBAAcrU,IAjB3B,oBAoBI,WACI,OAAOvd,KAAK2V,cArBpB,G,QAAqCC,GAAxB2b,GACM5b,UAAY,IAAI4b,GADtBA,GAEMK,iB,eCiCJE,I,OAnCE,SAACnrB,GAAkB,IACxBtF,EAAesF,EAAftF,KAAM2M,EAASrH,EAATqH,KACRvG,EAAiBlG,aAAcF,GAErC,IAAKoG,EAED,KAAK,iCAAL,OAAwCpG,GAG5C,IAaMkH,EAAS,oBAAgBwpB,GAAiBtqB,EAAemK,QAAhD,YAA2DzD,GAAcH,IAExF,OACI,qBAAKzF,UAAWA,EAAhB,SACI,cAACuF,GAAA,EAAD,CACIC,MAAOtG,EAAe0I,QACtBnC,KAAMrH,EAAMqH,KACZmI,QApBQ,SAACmS,GACjB,IAA0B,IAAtB3hB,EAAMqrB,YAAuB,CAC7B,IACMP,EADUnJ,EAAM6G,cACI8C,wBAC1BV,GAAeW,mBAAmBhB,GAAY7vB,KAAME,aAAcF,GAAOowB,GACzEnJ,EAAM6D,kBAGNxlB,EAAMwP,SACNxP,EAAMwP,QAAQmS,UAoBpByJ,GAAmB,SAAnBA,EAAoBngB,GACtB,OAAQA,GACJ,KAAKjE,KAAOwE,OACR,MAAO,mBACX,KAAKxE,KAAO8E,SACR,MAAO,qBACX,KAAK9E,KAAOgF,KACR,MAAO,iBACX,KAAKhF,KAAOoE,KACR,MAAO,iBACX,KAAKpE,KAAOkE,UACR,MAAO,sBAEf,OAAOkgB,EAAiBpkB,KAAOwE,SAG7BhE,GAAgB,SAAhBA,EAAiBH,GACnB,OAAQA,GACJ,KAAKJ,KAASW,SACV,MAAO,0BACX,KAAKX,KAASY,MACV,MAAO,uBACX,KAAKZ,KAASa,OACV,MAAO,wBACX,KAAKb,KAASc,IACV,MAAO,qBACX,KAAKd,KAASe,QACV,MAAO,yBAEf,OAAOR,EAAcP,KAASa,S,UC/E5B0jB,GAAgB,SAACxrB,GACnB,OAAO,cAAC,KAAD,aACHyrB,OAAQ,CACJC,QAAS,SAACC,EAAUnL,GAAX,mBAAC,eACHmL,GADE,IAELC,UAAW,UACX9H,OAAQ,OACR+H,UAAW,IACXvkB,OAAQkZ,EAAMsL,UAAY,mBAAqB,oBAC/C,SAAU,CACNxkB,OAAQ,uBAGhBykB,UAAW,SAACJ,EAAUK,GAAX,mBAAC,eACLL,GADI,IAEPM,KAAM,KAEVC,OAAQ,SAACP,GAAD,mBAAC,eACFA,GADC,IAEJQ,QAAS,cAEbC,YAAa,SAACT,GAAD,mBAAC,eACPA,GADM,IAETU,WAAY,YAEhBC,eAAgB,SAACX,GAAD,mBAAC,eACVA,GADS,IAEZY,UAAW,UAEfC,oBAAqB,SAACb,GAAD,mBAAC,eACfA,GADc,IAEjBY,UAAW,OAEX,IAAO,CACHJ,QAAS,YAKjBnsB,KAGZwrB,GAAcztB,YAAc,gBAEbytB,IC7CHiB,GD6CGjB,MEgNArD,I,OAAAA,IAjOK,WAAO,IAAD,EAEMnL,mBAAS,CACjCnf,KAAM,GACN4F,UAAW,GACXqmB,QAAS,KALS,mBAEf4C,EAFe,KAEPC,EAFO,OAOkB3P,qBAPlB,mBAOf4P,EAPe,KAODC,EAPC,KAQhB3Q,EAAW4Q,cARK,EASsB9P,mBAASyN,GAAkBT,GAASU,QAT1D,mBASfqC,EATe,KASCC,EATD,KAgChBC,EAAwB,SAACpyB,EAAsB2lB,GACjDtE,EbMD,SAA2BrhB,EAAsB2lB,GACpD,MAAO,CACH/lB,KAAMyN,GAAWglB,kBACjBryB,YACA2lB,SaVS0M,CAAkBryB,EAAW2lB,KAGpC2M,EAAiB,SAACrwB,GPxDrB,IAAoBxB,EOyDnB4gB,GPzDmB5gB,EOyDCwB,EPxDjB,CACHrC,KAAMyN,GAAWklB,WACjB9xB,WOuDA4gB,EAASvG,YAAW,6BAA8B,CAAE7Y,UAAU2S,KAAWjE,UAGvEwU,EAAa0F,aAA8C,SAAA/O,GAAK,OAAIA,EAAMqJ,cA2D1EqN,EAA6B,SAACxyB,EAAsByyB,GACtDL,EAAsBpyB,EAAWyyB,EAAU5R,EAAe6R,MAAQ7R,EAAe+E,UAC7E6M,EACAjf,KAAamf,SAAb,cAA6Bt0B,IAAYqnB,iBAAiB1lB,GAA1D,mBAAuFE,KAAK2vB,OAE5Frc,KAAamf,SAAb,cAA6Bt0B,IAAYqnB,iBAAiB1lB,GAA1D,uBAA2FE,KAAK2vB,QAkClG5P,EAAQ2S,mBAAQ,kBAAOtyB,OAAOC,KAAKpC,MACpC2K,QAAO,SAAA+pB,GAAC,OAAKC,MAAMC,SAASF,OAC5BtqB,KAAI,SAACyqB,GAEF,MAAO,CACHC,MAFS90B,KAAS60B,GAGlBvyB,MAAO,GACPyyB,QAAS,GACThK,QAAS5oB,OAAOC,KAAKnC,MAChB0K,QAAO,SAACjJ,GAAD,OAAkBE,aAAcF,GAAcC,UAAiCkzB,KACtFzqB,KAAI,SAAC1I,GAAD,MAAmB,CACpBY,MAAOZ,EACPozB,MAAO50B,IAAY2C,YAAYnB,GAC/BqzB,QAAS70B,IAAY80B,eAAetzB,aAKrD,IAEH,OACI,sBAAKkH,UAAU,eAAf,UACI,sBAAKA,UAAU,yBAAf,UACI,yCACA,uBAAOnH,KAAK,SACRa,MAAOoxB,EAAO7uB,KACdgE,MAAO,CAAEgiB,MAAO,QAChBmF,SAzDS,SAACrH,GACtB,IAAM7kB,EAASye,OAAO2N,WAAWvH,EAAMvF,OAAO9gB,OAC9CqxB,EAAU,2BACHD,GADE,IAEL7uB,KAAMf,QAsDF,wBAAQ0S,QAnGI,SAACye,GACrB,IAAMnxB,EAAS4vB,EAAO7uB,MA1DN,SAACf,GACjBof,EAASnE,aAAQjb,IACjBof,EAASvG,YAAW,0BAA2B,CAAE7Y,UAAU2S,KAAWjE,SAyDtE0iB,CAAYpxB,GAEZ,IAAMyqB,EAAOruB,IAAYiB,IAAI,0BAA2B,CAAE2C,WAE1DuR,KAAamf,SAASjG,EAAMxsB,KAAK2vB,MADpB,4BA8FL,oBAEJ,sBAAK9oB,UAAU,yBAAf,UACI,4CACA,uBAAOnH,KAAK,SACRa,MAAOoxB,EAAO5C,QACdjoB,MAAO,CAAEgiB,MAAO,QAChBmF,SAzDY,SAACrH,GACzB,IAAM7kB,EAASye,OAAO2N,WAAWvH,EAAMvF,OAAO9gB,OAC9CqxB,EAAU,2BACHD,GADE,IAEL5C,QAAShtB,QAsDL,wBAAQ0S,QAlGO,SAACye,GACxB,IAAMnxB,EAAS4vB,EAAO5C,QACtBqD,EAAerwB,GACf,IAAMyqB,EAAOruB,IAAYiB,IAAI,6BAA8B,CAAE2C,WAE7DuR,KAAamf,SAASjG,EAAMxsB,KAAK2vB,MADpB,8BA8FL,oBAEJ,sBAAK9oB,UAAU,yBAAf,UACI,8CACA,uBAAOnH,KAAK,SACRa,MAAOoxB,EAAOjpB,UACd5B,MAAO,CAAEgiB,MAAO,QAChBmF,SAzDc,SAACrH,GAC3B,IAAM7kB,EAASye,OAAO2N,WAAWvH,EAAMvF,OAAO9gB,OAC9CqxB,EAAU,2BACHD,GADE,IAELjpB,UAAW3G,QAsDP,wBAAQ0S,QAlGS,SAACye,IAhEL,SAACnxB,GAEtB,IAAM2G,EAAYgmB,GAAc9Z,QAAO,SAACC,EAAyBjU,GAE7D,OADAiU,EAAIjU,GAAYmB,EACT8S,IACR,IAEHsM,EAASwN,GAAajmB,IACtByY,EAASvG,YAAW,+BAAgC,CAAE7Y,UAAU2S,KAAWjE,SAyD3E2iB,CAAiBzB,EAAOjpB,WACxB,IAAM8jB,EAAOruB,IAAYiB,IAAI,+BAAgC,CAAE2C,OAAQ4vB,EAAOjpB,YAC9E4K,KAAamf,SAASjG,EAAMxsB,KAAK2vB,QA+FzB,oBAEJ,sBAAK9oB,UAAU,yBAAf,UACI,0CACA,cAACwsB,GAAD,CACIhC,YAAa,+BACbpD,SAAU,SAACzF,GAAD,OAAOsJ,EAAe,OAACtJ,QAAD,IAACA,OAAD,EAACA,EAAGjoB,QACpC+yB,iBAAkB,SAAC9d,GAAD,OACd,sBAAK3O,UAAU,aAAf,UACI,qBAAKA,UAAU,mBAAf,SAAmC2O,EAAKud,QACxC,sBAAKlsB,UAAU,mBAAf,UAAmC2O,EAAKwT,QAAQte,OAAhD,gBAGR6oB,kBAAmB,SAAApC,GAAM,OACrB,sBAAKtqB,UAAU,cAAf,UACI,cAAC,GAAD,CAAUlH,KAAMwxB,EAAO5wB,MAAe+L,KAAMJ,KAASW,WACrD,sBAAKhG,UAAU,aAAf,UACKsqB,EAAO4B,MACR,+BAAQ5B,EAAyC6B,iBAI7DhK,QAASjJ,IACb,cAAC,GAAD,CAAQtL,QAnHI,SAACye,GACrB,IAAMvzB,EAAOkyB,GA5EG,SAAClyB,GACjBwhB,EAAS+N,GAAmBvvB,IAC5BwhB,EAASvG,YAAW,0BAA2B,CAAEjb,QAAQ+U,KAAWjE,SA2EpE+iB,CAAY7zB,GAEZ,IAAM6sB,EAAOruB,IAAYiB,IAAI,0BAA2B,CAAEO,SACpD4T,EAAO1T,aAAcF,GAAM8O,QACjC6E,KAAamf,SAASjG,EAAMxsB,KAAK2vB,MAAOpc,IA6GhC,oBAEJ,sBAAK1M,UAAU,oBAAf,UACI,0CACA,uBACInH,KAAK,QACLquB,IAAI,IAAI3F,IAAI,KAAK7nB,MAAOyxB,EAAgBhE,KAAM,EAC9CC,SAhFmB,SAACrH,GAChC,IAAMrmB,EAAQigB,OAAO2N,WAAWvH,EAAMvF,OAAO9gB,OAC7C0xB,EAAkB1xB,GN9JY,SAACA,GACnCkvB,GAAsBlvB,EM8JlBkzB,CAAuBlzB,MA+EdyxB,EAPL,aASA,8BACI,8CAEF5xB,OAAOC,KAAK4kB,GAAY5c,KAAI,SAACvI,GAAD,OAjLd,SAACA,GACrB,IAAM4zB,EAAeC,YAAuB7zB,GACtC8zB,EAAsC3O,EAAWnlB,GACjD+zB,EAAWH,EAAa3wB,OAAO6wB,EAAeE,OAE9C9wB,EAAc7E,IAAYiB,IAAIy0B,EAAS7wB,aAE7C,OACI,sBACI6D,UAAU,iBADd,UAII,uBAAOE,MAAOjH,EAAd,mBACQkD,KAER,uBAEItD,KAAK,WACL6yB,QAASqB,EAAenO,QAAU9E,EAAe6R,MACjDvE,SAAU,kBAAMqE,EAA2BxyB,EAAW8zB,EAAenO,QAAU9E,EAAe6R,SAHzF1yB,KANJA,GAuKoCi0B,CAAgBj0B,a,UCxPnEk0B,GAAYC,2BADN,oBCyFG3G,I,OAAAA,aACXF,GACA1I,EAFW4I,EAlEF,SAACroB,GAEV,IAAMivB,EAAavJ,aAAwB,SAAAlF,GAAK,OAAIA,KAFJ,EAGVxD,qBAHU,mBAGzCkS,EAHyC,KAG5BC,EAH4B,KAmB1CC,EAAe,uCAAG,sBAAAve,EAAA,yDACfqe,EADe,wDAEpBC,OAAevY,GAFK,SAIdyY,GAASH,GAJK,OAKpB7gB,KAAamf,SAASt0B,IAAYiB,IAAI,kBAAmBY,KAAKu0B,KAAM,iCACpEtvB,EAAMuvB,gBANc,2CAAH,qDAuBrB,OACI,sBAAK3tB,UAAU,OAAf,UACI,4BACI,cAAC,GAAD,CAAQ4N,QAxCM,WACtB,IAAMiU,EAAS,cAAC,GAAD,CAAa3hB,MAAM,WAClC9B,EAAMwvB,aAAa/L,IAsCX,uBAEJ,4BACI,cAAC,GAAD,CAAQjU,QAtCQ,WACxB,IAAMiU,EAAS,cAAC,GAAD,CAAgB3hB,MAAM,aACrC9B,EAAMwvB,aAAa/L,IAoCX,wBAEJ,qCACI,mDACA,6DAEI,cAAC,GAAD,CAAQjU,QAvCA,YDnCJ,SAACyf,GACrB,IAAMpe,EAAI4e,SAASC,cAAc,KAC3BnI,EAAOoI,KAAKC,UAAUX,GACtBY,EAAYd,GAAUe,QAAQvI,GAEpC1W,EAAEkf,aAAa,OAAQ,gCAAkCC,mBAAmBH,IAC5Ehf,EAAEkf,aAAa,WAFE,uBAGjBlf,EAAEof,QC6BCC,CAASjB,IAsCI,qBAEJ,+DAEI,uBAAOx0B,KAAK,OAAOuuB,SA7BV,SAACzF,GACtB,IAAM4M,EAAa,IAAIC,WACvBD,EAAWE,OAAS,WAChB,IACM7P,ED3Cc,SAACqP,GAC7B,IAAMtI,EAAOwH,GAAUuB,QAAQT,GAC/B,OAAOF,KAAKY,MAAMhJ,GCyCKiJ,CADGL,EAAWx2B,QAG7Bw1B,EAAe3O,IAEnB2P,EAAWM,WAAWlN,EAAEnH,OAAOrZ,MAAO,OAsB1B,cAAC,GAAD,CAAQyM,QAAS4f,EAAiBsB,UAAWxB,EAA7C,+BCpFPyB,GAAe,SAACC,GAAuC,IAAxBC,EAAuB,uDAAd,EAC3CC,EAAY,CAAC,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,KAG1CC,EAAO/zB,KAAKg0B,MAAMJ,GAAS,EAAI,EAErC,GAAY,IAATG,EAAY,OAAOH,EAAMK,QAAQJ,GAGpC,IAAMK,EAASJ,EAAUC,GACnBI,EAAQn0B,KAAKmsB,IAAI,GAAW,EAAP4H,GAGrBK,EAASR,EAAQO,EAGvB,OAAOC,EAAOH,QAAQJ,GAAUK,GCRrBG,GAJM,WACjB,OAAO3L,aAAgC,SAAA/O,GAAK,OAAIA,EAAM9Y,S,SCY7CyzB,GAAqBC,aAAe,CAZvB,SAAC/Q,GACvB,OAAOA,EAAMR,WAAWxiB,IAAU2B,WAAW0vB,SAI5B,SAACA,GAGlB,OAF4Bj0B,YAA4C4C,IAAU2B,WACHrB,OAAO+wB,GAC/DzvB,gBCPdoyB,GAAoB,WAC7B,OAAO9L,aAA4C,SAAA/O,GAAK,OAAIA,EAAMlT,cCUzDguB,GAAoBF,aAAe,CAX1B,SAAC/Q,GAAD,OAAuBA,EAAMR,YAChC,SAACQ,GAAD,OAAuBA,EAAMsJ,WAEnB,SAAC9J,EAAkC8J,GAK5D,OAAOA,EAHa3uB,OAAOC,KAAK4kB,GAAY5c,KAAI,SAAC5I,GAAD,OAAUwlB,EAAWxlB,MAChEmV,QAAO,SAACC,EAAatU,GAAd,OAA6CsU,EAAOtU,EAAMwuB,UAAS,MCFtE4H,GAAsB,WAC/B,OAAOhM,YAAgC+L,KCuD5BE,I,OA7CK,WAEhB,IAAMC,EAAYP,KACZQ,EAAiBL,KACjBM,EAAcJ,KAEdK,EAAa,SAACzjB,EAAcxR,EAAgBrC,GAU9C,OACI,qBAAe+U,QATC,SAACmS,GAEjB,IACMmJ,EADUnJ,EAAM6G,cACI8C,wBAC1BV,GAAeW,mBAAmBhB,GAAY5uB,SAAUlB,EAAMqwB,GAC9DnJ,EAAM6D,mBAIN,UACI,cAACre,GAAA,EAAD,CACIC,MAAOkH,EACPjH,KAAK,aAET,qBAAKzF,UAAU,SAAf,SACM+uB,GAAa7zB,EAAQ,OANtBrC,IAYXgJ,EAAYgmB,GAAcrmB,KAAI,SAACzH,GAAc,IAAD,EACxCq2B,EAAsBC,KAAqBt2B,GACjD,OAAOo2B,EAAWC,EAAoBxoB,QAArB,UAA8BqoB,EAAel2B,UAA7C,QAA0D,EAAGA,MAQlF,OALA8H,EAAUnG,KACNy0B,EAAW,4BAA6BD,EAAa,WACrDC,EAAW,0BAA2BH,EAAW,SAIjD,oBAAIhwB,UAAU,cAAd,SACM6B,MC/BCyuB,I,OAnBA,SAAClyB,GACZ,IAAMtG,EAAUy4B,qBAAWxS,IAO3B,OACI,sBAAK/d,UAAY,SAAjB,UACI,qBAAKA,UAAY,cAAjB,SACI,cAAC,GAAD,MAEJ,qBAAKA,UAAY,eAAjB,SACI,qBAAKA,UAAY,YAAY4N,QAXrB,SAACuY,GACjB,IAAMtE,EAAS,cAAC,GAAD,CAAM3hB,MAAQ,OAAOswB,UAAWpyB,EAAMoyB,YACrD14B,EAAQ81B,aAAa/L,IASb,2B,SCgDD4O,GA1DK,SAACryB,GAAkB,IAC3BuI,EAAgEvI,EAAhEuI,MAAO+pB,EAAyDtyB,EAAzDsyB,OAAQC,EAAiDvyB,EAAjDuyB,gBAAiB5U,EAAgC3d,EAAhC2d,SAAUnO,EAAsBxP,EAAtBwP,QAC5CpI,EADkEpH,EAAbmd,SAClC,qCAAuC,4BAE1DqV,EAASjQ,iBAAoB,MAcnC,OAZAhF,qBAAU,WACN,IAAMf,EAASgW,EAAO/P,QAEhBgQ,EAAe,IAAIjb,WACzBib,EAAaC,UAAU,UACvBD,EAAaE,WAAW,EAAG,EAAGC,KAC9BH,EAAaI,UAEbrW,EAAOsW,KAAOL,EACdjW,EAAOuW,SAASN,KACjB,CAACD,IAGA,eAAC,SAAD,CACIprB,MAAK,UAAKM,KAAL,OAA8BN,GACnC5M,KAAM+N,EAAM/N,KACZkW,EAAGiN,EAASjN,EACZC,EAAGgN,EAAShN,EACZiN,aAAa,EACbC,YAAY,EACZsT,MAAO,IAAI3Z,QAAW,GAAK,IAC3B0G,OAAQ,IAAI1G,QAAW,GAAK,GAC5Bwb,YAAa,WACNxjB,GACCA,EAAQjH,IAXpB,UAeM+pB,GACF,cAAC,SAAD,CACIlrB,MAAK,UAAKM,IAAL,YAA+B4qB,EAAOW,WAC3Cz4B,KAAK,SACL0jB,OAAQ,IAAI1G,QAAW,GAAK,IAC5B9G,EAAG,EACHC,GAAI,IACJwgB,MAAO,IAAI3Z,QAAW,IAAM,KAC5BoJ,IAAK4R,IAERD,GACD,cAAC,SAAD,CACInrB,MAAK,UAAKM,IAAL,8BACLlN,KAAK,cACL0jB,OAAQ,IAAI1G,QAAW,GAAK,GAC5B9G,EAAG,IACHC,GAAI,IACJwgB,MAAO,IAAI3Z,QAAW,EAAG,SClC1B0b,GA1BG,SAAClzB,GAAkB,IACzBmzB,EAAcnzB,EAAdmzB,UACR,OAAInzB,EAAMmzB,UAAU1tB,OAAS,EAClB,cAAC,WAAD,CACHjL,KAAK,YACLkW,EAAG,EACHC,EAAG,EACHyiB,KAAM,SAAAC,GACFA,EAASC,UAAU,EAAG,UACtBD,EAASE,OAAOJ,EAAU,GAAGziB,EAAGyiB,EAAU,GAAGxiB,GAE7C,IAAIV,EAAI,EACR,IAAKA,EAAI,EAAGA,EAAIkjB,EAAU1tB,OAAS,EAAGwK,IACtC,CACI,IAAMujB,GAAML,EAAUljB,GAAGS,EAAIyiB,EAAUljB,EAAI,GAAGS,GAAK,EAC7C+iB,GAAMN,EAAUljB,GAAGU,EAAIwiB,EAAUljB,EAAI,GAAGU,GAAK,EACnD0iB,EAASK,iBAAiBP,EAAUljB,GAAGS,EAAGyiB,EAAUljB,GAAGU,EAAG6iB,EAAIC,GAElEJ,EAASK,iBAAiBP,EAAUljB,GAAGS,EAAGyiB,EAAUljB,GAAGU,EAAGwiB,EAAUljB,EAAE,GAAGS,EAAGyiB,EAAUljB,EAAE,GAAGU,GAC3F0iB,EAASR,aAId,M,4Bb3BCpG,O,6BAAAA,I,yBAAAA,I,mBAAAA,I,0BAAAA,Q,mBcACkH,GAA4BC,aAGvCC,KACAC,MCCIC,GAAY,SAACvT,GAAD,OAAuBA,EAAMwT,QACzCC,GAAgB,SAACzT,GAAD,OAAuBA,EAAMwT,OAAO5wB,KAAI,SAAA8wB,GAAC,OAAIA,EAAE15B,SAC/D25B,GAAiB,SAAC3T,GAAD,OAAuBA,EAAMwT,OAAO5wB,KAAI,SAAA8wB,GAAC,OAAIA,EAAEE,WAGhEC,GAAkB,SAACL,GAErB,OAAOA,EAAOrwB,QAAO,SAACuwB,GAAD,OAAOA,EAAEE,SAAW3H,GAAY6H,WAI5CC,GAAW,SAACnsB,GACrB,IAAMosB,EAAgBC,uBAClB,SAACjU,GAAD,OAAuBA,EAAMwT,OAAO1d,MAAK,SAAC4d,GAAD,OAAOA,EAAE15B,OAAS4N,OAC3D,CAACA,IAGL,OADcsd,YAAyC8O,I,gBCA3D/Q,OAAOjM,KAAOA,EACd,ICHYkd,GCEPxc,GFuLUyc,GAzKE,SAAC30B,GAAkB,IACxB40B,EAAmC50B,EAAnC40B,qBAAsBC,EAAa70B,EAAb60B,SACxBL,EAAgBC,uBAClB,SAACjU,GAAD,OAAuBA,EAAMwT,OAAO1d,MAAK,SAAC4d,GAAD,OAAOA,EAAE15B,OAASwF,EAAM80B,uBACjE,CAAC90B,EAAM80B,oBAGLC,EAAgBrP,YAAqD8O,GACrExe,EAAc0P,aAAgD,SAAC/O,GAAD,OAAWA,EAAMX,eAC/Egf,EDZqB,WAC3B,IAAMC,EAAiBxH,mBAAQ,WAM3B,OALqB8D,aACjB,CAACwC,IACDM,MAIL,IAEH,OAAO3O,YAA2CuP,GCE7BC,GACf9lB,EAAUC,cAVe,EAkCO2N,mBAASmY,IAlChB,mBAkCxBpP,EAlCwB,KAkCXC,EAlCW,OAmCShJ,mBAhDxB,MAae,mBAmCxBiJ,EAnCwB,KAmCVC,EAnCU,KAqC/B3I,qBAAU,WAEN,IAAM4I,EAAS,WAAO,IAAD,IACXiP,EAAYR,IACZxO,GAAiB,UAAAgP,EAAU3S,eAAV,eAAmB4D,cAAe8O,GACnD7O,GAAkB,UAAA8O,EAAU3S,eAAV,eAAmB8D,eAvDnC,KAyDRP,EAAeI,GAIPF,EAHJ2O,EACIzO,EAAiB,IAEDiP,GA5Df,GAkEW/O,IAKxB,OAFAH,IACA1C,OAAOC,iBAAiB,SAAUyC,GAC3B,WACH1C,OAAOG,oBAAoB,SAAUuC,MAE1C,CAACyO,EAAsBC,IAE1BtX,qBAAU,WACN,GAAIwX,EACAO,EAAqBP,OAClB,CACH,IAAM3T,EAAW2D,EAAYtC,QACvB8S,EAAQC,GAAoB,CAAE9kB,EAAG,EAAGC,EAAG,IAC7CyQ,EAASyE,WAAW0P,EAAM7kB,EAAG6kB,EAAM5kB,MAExC,CAACokB,EAAe9O,IAEnB,IAAMlB,EAAcxC,iBAAqB,MACzChF,qBAAU,WAEN,GAAIwH,EAAYtC,QAAS,CACrB,IAAMrB,EAAW2D,EAAYtC,QACvB8S,EAAQC,GAAoB,CAAE9kB,EAAG,EAAGC,EAAG,IAC7CyQ,EAASyE,WAAW0P,EAAM7kB,EAAI,EAAG6kB,EAAM5kB,EAAI,EAAI,OAEpD,CAACoV,IAEJ,IAkCMuP,EAAuB,SAAC/sB,GAC1B,IAAM6Y,EAAW2D,EAAYtC,QAC7B,GAAIrB,EAAU,CACV,IAAMqU,EAAgBC,GAAsBntB,GACtCgtB,EAAQC,GAAoBC,GAClCrU,EAASyE,WAAW0P,EAAM7kB,EAAG6kB,EAAM5kB,KAWrCoT,EAAU,CACZG,aAAa,EACbC,cAAc,EACdN,MAAOkC,EACPjC,OAAQmC,GAEZ,OACI,sBAAKrkB,UAAU,YAAf,UACI,cAAC,QAAD,CAAOiiB,MAAOkC,EAAajC,OAAQmC,EAAclC,QAASA,EAA1D,SACI,cAAC,GAAD,CAAUzC,YAAayE,EAAaxE,aAAc0E,EAAczE,WA1J5D,KA0JqFC,YAzJpF,KAyJ+Gb,IAAKmE,EAAzH,SACI,eAAC,SAAD,CACI3d,MAAK,UAAKM,IAAL,+DACLkW,aAAa,EACboV,YApBG,aAiBP,UA3DLgC,EAAa5xB,KAAI,SAACmF,GACrB,IAAMotB,EAAoBC,GAAqBrtB,GAC/C,OACI,cAAC,GAAD,CAAW4qB,UAAWwC,GAAwBptB,EAAM/N,SAMrDw6B,EAAa5xB,KAAI,SAACmF,GACrB,IAAMiM,EAAWkhB,GAAsBntB,GACjCstB,EAAkBL,GAAoBhhB,GACtC8d,EAASlc,aAAeJ,EAAazN,GACrCutB,EAAmCl7B,aAAc2N,EAAM/N,MACvDoK,EAAmB5H,KAAKK,MAAMkL,EAAM3D,UACpCmxB,EAAuBD,EAAgB5gB,MAAMtQ,GAEnD,OACI,cAAC,GAAD,CACI2D,MAAOA,EACP+pB,OAAQA,EACR3U,SAAUkY,EAEV1Y,SAAU5U,IAAUwsB,EACpBxC,gBAAiBwD,EAAUt7B,OAASyH,KAAcmT,UAClD7F,QAAS,SAAC0kB,GAAD,OAlGC15B,EAkGuB05B,EAAE15B,UAjG/CwF,EAAMg2B,aAAax7B,GADE,IAACA,IA+FL+N,EAAM/N,gBAgDlBwF,EAAM80B,mBACH,sBAAKlzB,UAAU,QAAf,UACI,iCACI,cAAC,GAAD,CAAmBwG,UAAWpI,EAAM80B,oBACnC57B,IAAY+8B,cAAcj2B,EAAM80B,sBAErC,sBAAMtlB,QAjJF,WAChBJ,EAAQ9R,KAAK8L,gBAgJ2BxH,UAAU,QAAtC,sBAUd8zB,GAAwB,SAACntB,GAC3B,IAAMutB,EAAkBl7B,aAAc2N,EAAM/N,MACtC07B,EAAkBl5B,KAAKK,MAAMkL,EAAM3D,UACnCuxB,EAAWL,EAAgB5gB,MAAMghB,GAEjCE,EAAWN,EAAgB5gB,MAAMghB,EAAkB,GACzD,OAAKE,EAIEjf,YAAagf,EAAUC,EAAU7tB,EAAM3D,SAAWsxB,GAF9CC,GAMTX,GAAsB,SAAChhB,GACzB,IAAM9D,EAnMS,GAmML8D,EAAS9D,EAAiB2lB,IAC9B1lB,EApMS,GAoML6D,EAAS7D,EAAiB2lB,MACpC,OAAO,IAAI9e,QAAW9G,EAAGC,IAGvBilB,GAAuB,SAACrtB,GAI1B,IAHA,IAAM4qB,EAA0B,GAC1B2C,EAAkBl7B,aAAc2N,EAAM/N,MAEnCyV,EAAI,EAAGA,EAAI1H,EAAM3D,SAAUqL,IAChCkjB,EAAU71B,KAAKk4B,GAAoBM,EAAgB5gB,MAAMjF,KAE7D,IAAMsmB,EAAef,GAAoBE,GAAsBntB,IAE/D,OADA4qB,EAAU71B,KAAKi5B,GACRpD,GAKLqD,GAAoB,SAAC,GAAwC,IAAD,EAArCpuB,EAAqC,EAArCA,UACnBG,EAAQgsB,GAASnsB,GACjB8T,EAAW4Q,cAEjB,iBAAIvkB,EAAM5F,aAAV,aAAI,EAAasG,QAET,wBAAQuG,QAAS,kBAAM0M,EAASlT,aAAUZ,GAAW,KAArD,wBAIJ,wBAAQoH,QAAS,kBAAM0M,EAASlT,aAAUZ,GAAW,KAArD,0BG7MOquB,I,OAlCE,SAACz2B,GAAkB,IAAD,EACJA,EAApB02B,iBADwB,MACZ,KADY,GAE1BA,GAAa12B,EAAM+B,UAAY/B,EAAM+B,SAG1C,IAAMH,EAAS,UAAM5B,EAAM4B,WAAZ,OAAyB5B,EAAM0wB,SAAW,YAAc,IACjE3uB,EAAWqmB,IAAMuO,SAASvzB,IAAIpD,EAAM+B,UAAU,SAAC60B,GAKjD,OAJ4CxO,IAAMyO,aAAaD,EAAO,CAClEtC,OAAQsC,EAAM52B,MAAMkW,KAAOwgB,EAC3BlnB,QAAS,WAAQsnB,EAAeF,EAAM52B,MAAMkW,UAK9C4gB,EAAiB,SAACC,GAChB/2B,EAAMg3B,gBAAoC,IAAnBh3B,EAAM0wB,UAC7B1wB,EAAMg3B,cAAcD,IAW5B,OACI,oBAAIn1B,UAAS,0BAAcA,QAAd,IAAcA,IAAa,IAAM4N,QAR9B,SAAC+T,GACjBhhB,IAAaqM,UAAU,kBACnB5O,EAAMwP,SACNxP,EAAMwP,QAAQ+T,IAKlB,SACKxhB,MCnBEk1B,GAdH,SAACj3B,GACT,IAKM4B,GAAc5B,EAAMs0B,OAAU,SAAW,KAAOt0B,EAAM4B,WAAa,IACzE,OACI,oBAAIA,UAAS,uBAAkBA,GAAa4N,QAP5B,SAAC+T,GACbvjB,EAAMwP,SACNxP,EAAMwP,QAAQ+T,IAKlB,SACKvjB,EAAM+B,YCoBJm1B,I,OAvBU,SAACl3B,GAAkB,IAEpCwW,EAEAxW,EAFAwW,WACAnP,EACArH,EADAqH,KAGEzF,EAAS,UAAO5B,EAAM4B,WAAa,GAA1B,WAOf,OACI,cAACuF,GAAA,EAAD,CACIvF,UAAWA,EACXwF,MAAOoP,EAAWyc,UAClB5rB,KAAMA,EACNmI,QAVY,WACZxP,EAAMwP,SACNxP,EAAMwP,QAAQxP,EAAMwW,WAAWN,SCc5BihB,GAzBY,SAACn3B,GAAkB,IACnCgW,EAAwChW,EAAxCgW,YAAaohB,EAA2Bp3B,EAA3Bo3B,wBAYpB,OACI,cAAC,GAAD,CACIx1B,UAAU,uBACVo1B,cAb4B,SAACrpB,GACjC,IAAM6I,EAAaxW,EAAMgW,YAAYM,MAAK,SAAAzF,GAAC,OAAIA,EAAEqF,KAAOvI,KACxDypB,EAAwB5gB,EAAWN,KAY/BwgB,UAAW12B,EAAMq3B,qBACjB3G,SAAU1wB,EAAM0wB,SAJpB,SAMK1a,EAAY5S,KAAI,SAACyN,GAAD,OAZI2F,EAYuB3F,EAXhD,cAAC,GAAD,CAAKqF,GAAIM,EAAWN,GAApB,SACI,cAAC,GAAD,CAAkBM,WAAYA,EAAYnP,KAAMJ,KAASa,UADhC0O,EAAWN,IADhB,IAACM,QCd3B8gB,GAAiB,SAAC9W,GAAD,OAA+CA,EAAMxK,aACtE+d,GAAY,SAACvT,GAAD,OAA0CA,EAAMwT,QA2CrDuD,IAPkChG,aAAe,CAC1D+F,GACAvD,KApC4B,SAAC/d,EAAqCge,GAClE,IAAMwD,EAAuC,GAGvCC,EAAqBt8B,OAAOuI,OAAOswB,GAAQrkB,QAAgD,SAACC,EAAKtU,GACnG,IAAMo8B,EAAmB3hB,aAAmBC,EAAa1a,GAMzD,OALIA,EAAM84B,SAAW3H,GAAY6H,SAE7B1kB,EAAItU,EAAMd,MAAQk9B,GAEtBF,EAAal6B,KAAb,MAAAk6B,EAAY,YAASE,IACd9nB,IACR,IAMH,OAFA6nB,EAAkB,KAAYzhB,EAAYrS,QAAO,SAACkN,GAAD,OAAoC,IAA7B2mB,EAAaG,QAAQ9mB,MAEtE4mB,KAuBmC,SAACrvB,GAM3C,OAAOmpB,aAAe,CAClB+F,GACAvD,KAP0B,SAAC/d,EAAqCge,GAChE,IAAMzrB,EAAQyrB,EAAO1d,MAAK,SAAA4d,GAAC,OAAIA,EAAE15B,OAAS4N,KAC1C,OAAO2N,aAAmBC,EAAazN,Q,IAWRgpB,aAAe,CAClD+F,GACAvD,KApCyB,SAAC/d,EAAqCge,GAE/D,IAAMje,EAAqBie,EAAOrkB,QAAiB,SAACC,EAAKgoB,GAIrD,OAHIA,EAAIxD,SAAW3H,GAAY6H,QAC3B1kB,EAAItS,KAAJ,MAAAsS,EAAG,YAASgoB,EAAI3hB,QAEbrG,IACR,IAEH,OAAOoG,EAAYrS,QAAO,SAACkN,GAAD,OAA6C,IAAtCkF,EAAmB4hB,QAAQ9mB,EAAEqF,U,2BCGnD2hB,GA7BOzZ,wBAA0B,gBAAiB,CAC7DC,OAD6D,SACtDyZ,GAEH,OADkB,IAAIC,MAI1BzZ,WAN6D,SAMlD5Z,EAAU6Z,EAAiBve,GAAe,IAC1CqQ,EAAkDrQ,EAAlDqQ,MAAON,EAA2C/P,EAA3C+P,SAAUioB,EAAiCh4B,EAAjCg4B,gBAAiBC,EAAgBj4B,EAAhBi4B,aACzC,GAAK5nB,EAAME,KAGX,IAAK,IAAIN,EAAI,EAAGA,EAAII,EAAME,KAAK9K,OAAQwK,IAAK,CACxC,IAAMD,EAAUH,aAAYQ,EAAME,KAAKN,GAAIF,GAC3C,GAAKC,EAAL,CAEA,IAAMkoB,EAAIloB,EAAQmoB,UACZC,EAAIpoB,EAAQqoB,WACZ3nB,EAAKT,EAAI+nB,EAAmBE,EAC5BvnB,EAAI3T,KAAKK,MAAM4S,EAAI+nB,GAAmBI,EACtCrxB,EAAckxB,EAAajoB,EAAQxV,MAEzC,GAAI6V,EAAME,KAAKN,GAAK,EAAG,CACnB,IAAMqoB,EAAQ,UAAMtoB,EAAQxV,KAAd,YAAsB6V,EAAME,KAAKN,IAC/CvL,EAAS6zB,SAASxxB,EAAYkW,SAASqb,GAAW5nB,EAAGC,SCYtD6nB,GA/BSpa,wBAA0B,kBAAmB,CACjEC,OADiE,SAC1DyZ,GAEH,OADkB,IAAIC,MAI1BzZ,WANiE,SAMtD5Z,EAAU+zB,EAAkBz4B,GAAe,IAC3CyG,EAAmCzG,EAAnCyG,QAASsJ,EAA0B/P,EAA1B+P,SAAUkoB,EAAgBj4B,EAAhBi4B,aACrBxxB,EAAQhB,SAGbf,EAASwmB,QACJzkB,GAELA,EAAQpL,SAAQ,SAAC4K,GACb,GAAKA,EAAO6J,IAAZ,CACA,IAAME,EAAUH,aAAY5J,EAAO6J,IAAKC,GACxC,GAAKC,EAAL,CAEA,IAAMU,EAAIzK,EAAOyK,EACXC,EAAI1K,EAAO0K,EAAIX,EAAQqoB,WACvBtxB,EAAckxB,EAAajoB,EAAQxV,MAGnC89B,EAAQ,UAAMtoB,EAAQxV,KAAd,YAAsByL,EAAO6J,KAC3CpL,EAAS6zB,SAASxxB,EAAYkW,SAASqb,GAAW5nB,EAAGC,Y,SC5BlD+nB,GAdQta,wBAAgF,iBAAkB,CACzHC,OAAQ,YAAmB,IAAhBpB,EAAe,EAAfA,SAEP,OADuB,IAAIzF,iBAAoByF,GAAY,IAAI,IAGjEqB,WAAY,SAAC5Z,EAAU6Z,EAAUC,GAC5BD,EAAStB,WAAauB,EAASvB,WAChC0B,4BAAkBja,EAAU6Z,EAAUC,GACtC9Z,EAASi0B,YAAY,O,mBTWfjE,O,eAAAA,I,aAAAA,I,eAAAA,I,mBAAAA,I,mBAAAA,I,iBAAAA,I,iBAAAA,I,oBAAAA,Q,cCEPxc,K,UAAAA,E,eAAAA,E,SAAAA,E,eAAAA,E,UAAAA,E,eAAAA,E,SAAAA,E,gBAAAA,Q,KAYL,I,GAAM0gB,GAAa,SAAC54B,GAA8E,IAAD,EAUzFA,EARAwU,gBAFyF,MAE9E,CAAC,EAAG,GAF0E,EAGzFqkB,EAOA74B,EAPA64B,WACAC,EAMA94B,EANA84B,cACAzR,EAKArnB,EALAqnB,MACAtlB,EAIA/B,EAJA+B,SACAg3B,EAGA/4B,EAHA+4B,gBACAC,EAEAh5B,EAFAg5B,OACGC,EATsF,YAUzFj5B,EAVyF,2FAW7D64B,EAAWK,oBAApCC,EAXsF,EAWtFA,UAAWC,EAX2E,EAW3EA,WACZC,EAAW9W,iBAAuB,MAClC+W,EAAiB/W,mBACjBrG,EAAW4Q,cACXvkB,EAAQgsB,GAASv0B,EAAM64B,WAAWzwB,WAClCmxB,EAAsB9E,uBAAY,WAAO,IAAD,EAC1C,OAAI,UAAClsB,EAAM5F,aAAP,aAAC,EAAa62B,aAGXjxB,EAAM5F,MAAO62B,YAAY71B,QAAO,SAAAkN,GAAC,OAAIA,EAAE4oB,UAAYz5B,EAAMxF,QAFrD,KAIf,CAAC+N,EAAM5F,MAAO3C,EAAMxF,OACdg/B,EAAc9T,YAAuC6T,GAvBkC,EAwB3Dvc,mBAAS,SAxBkD,mBAwBtF0c,EAxBsF,KAwB3EC,EAxB2E,KAyBvFzU,EAAQ3C,mBAGdhF,qBAAU,WACN,GAAK8b,EAAL,CAIA,IAAMO,EAAuB,WACrBplB,EAAS,KAAOqlB,EAAWzd,OAAO,IAAM5H,EAAS,GAAKqlB,EAAWzd,OAAO,GACxE0d,EAAe5hB,GAAY6hB,OAEtBvlB,EAAS,GAAKqlB,EAAWzd,OAAO,IAAM5H,EAAS,GAAKqlB,EAAWzd,OAAO,GAC3E0d,EAAe5hB,GAAY8hB,WAEtBxlB,EAAS,GAAKqlB,EAAWzd,OAAO,IAAM5H,EAAS,KAAOqlB,EAAWzd,OAAO,GAC7E0d,EAAe5hB,GAAY+hB,MAEtBzlB,EAAS,GAAKqlB,EAAWzd,OAAO,IAAM5H,EAAS,GAAKqlB,EAAWzd,OAAO,GAC3E0d,EAAe5hB,GAAYgiB,WAEtB1lB,EAAS,KAAOqlB,EAAWzd,OAAO,IAAM5H,EAAS,GAAKqlB,EAAWzd,OAAO,GAC7E0d,EAAe5hB,GAAYiiB,OAEtB3lB,EAAS,GAAKqlB,EAAWzd,OAAO,IAAM5H,EAAS,GAAKqlB,EAAWzd,OAAO,GAC3E0d,EAAe5hB,GAAYkiB,WAEtB5lB,EAAS,GAAKqlB,EAAWzd,OAAO,IAAM5H,EAAS,KAAOqlB,EAAWzd,OAAO,GAC7E0d,EAAe5hB,GAAYmiB,MAEtB7lB,EAAS,GAAKqlB,EAAWzd,OAAO,IAAM5H,EAAS,GAAKqlB,EAAWzd,OAAO,IAC3E0d,EAAe5hB,GAAYoiB,YAG7BT,EAAaL,EAAY,GAC/B,GAAIK,GAAcA,IAAeP,EAAe7W,QAAS,CAErD,OAAQoX,EAAWU,YACf,KAAKx0B,KAAgBkW,KACjB,IAAMue,EAAe,WACjBte,EAASnT,aAAoB/I,EAAM64B,WAAWzwB,YAC9CpI,EAAM64B,WAAW4B,WAAWz6B,EAAMxF,KAAMq/B,EAAWzd,SAEjDvX,GAAYg1B,EAAW9d,OAASiD,YAAYtQ,OAAS,IACvD7J,EAAW,GACX21B,IAIJZ,IACAD,EAAa,QACbz0B,IAAKw1B,aAAarB,EAAS5W,SAC3ByC,EAAMzC,QAAUvd,IAAKC,GAAGk0B,EAAS5W,QAAS,CACtC5d,WACA81B,KAAM,SACNC,KAAM,CACFlqB,EAAGmpB,EAAWzd,OAAO,GAAK+c,EAC1BxoB,EAAGkpB,EAAWzd,OAAO,GAAKgd,GAE9Bh0B,WAAYo1B,IAEhB,MAEJ,KAAKz0B,KAAgB80B,MACjBjB,IACAD,EAAa,UACbp3B,IAAaqM,UAAU,cAAezM,IAAQQ,OAAO,EAAOP,IAAQ8B,gBAKpE2K,YAJuB,WACnB8qB,EAAa,SACbzd,EAASnT,aAAoB/I,EAAM64B,WAAWzwB,cAEvB,KAC3B,MAEJ,KAAKrC,KAAgB+0B,SACjBjC,EAAWkC,cAAc/6B,EAAMxF,KAAMq/B,EAAWzd,QAChDF,EAASnT,aAAoB/I,EAAM64B,WAAWzwB,YAItDkxB,EAAe7W,QAAUoX,MAE9B,CAAC3d,EAAUid,EAAWC,EAAYI,EAAax5B,EAAM64B,WAAY74B,EAAMxF,KAAMga,EAAUqkB,IAE1Ftb,qBAAU,WACN,OAAO,WAAO,IAAD,EACT,UAAA2H,EAAMzC,eAAN,SAAe8C,UAEpB,IAjH0F,MAmH9EkI,mBAAQ,WAGnB,OAFAkM,EAAa,SAEN,CACHjpB,EAAG8D,EAAS,GAAK2kB,EACjBxoB,EAAG6D,EAAS,GAAK4kB,KAEtB,CAAC5kB,EAAU2kB,EAAWC,IAPlB1oB,EAnHsF,EAmHtFA,EAAGC,EAnHmF,EAmHnFA,EAnHmF,EA4HjEqM,mBAAgD,MA5HiB,mBA4HtFge,EA5HsF,KA4H9EC,EA5H8E,KA8H7F1d,qBAAU,WAAO,IAAD,EACZ,GAAKwb,EAAL,CAEA,KAAI,UAACvhB,KAAKrU,OAAOsU,OAAOhU,UAAUs1B,UAA9B,aAAC,EAA+C9b,UAChD,MAAM,IAAIljB,MAAJ,0BAA6Bg/B,IAEvC,IACMmC,EADY//B,OAAOC,KAAKoc,KAAKrU,OAAOsU,OAAOhU,UAAUs1B,GAAiB9b,UAClDtN,QAAO,SAACC,EAAUurB,GAIxC,IAAM1hC,EAAM0hC,EAAMxT,QAAQ,SAAU,IAKpC,OAJK/X,EAAInW,KACPmW,EAAInW,GAAO,IAEbmW,EAAInW,GAAK6D,KAAKka,KAAKrU,OAAOsU,OAAOhU,UAAUs1B,GAAiB9b,SAAUke,IAC/DvrB,IACR,IACHqrB,EAAUC,MACX,CAACnC,IAjJyF,MAmJvD/b,mBAAsB9E,GAAY6hB,OAnJqB,mBAmJtFqB,EAnJsF,KAmJzEtB,EAnJyE,KAqJvFuB,EAAU9Y,kBAAO,GAKvBhF,qBAAU,WACN,QAAe3G,IAAXoiB,EAAsB,CACtB,IAAMsC,EAAUC,GAAiB/mB,EAAUwkB,GAC3Cc,EAAewB,MAEpB,CAAC9mB,EAAUwkB,IAEdzb,qBAAU,WAXS,IAACjiB,IAYL8/B,IAAgBljB,GAAYkiB,WAAagB,IAAgBljB,GAAYmiB,MAAQe,IAAgBljB,GAAYoiB,UAXpHe,EAAQ5Y,QAAUnnB,IAYnB,CAAC8/B,IAEJ7d,qBAAU,WAEN,GAAKub,IAAmBE,EAAxB,CAIA,IAqDMn0B,EAFc,IACA,IACW7H,KAAK0I,SAC9B81B,EAAWC,aAtDS,WACtB,IAAMC,EAAO1+B,KAAK0I,SAAW,GACzB01B,IAAgBljB,GAAY6hB,OAAS2B,EACrC5B,EAAe5hB,GAAYoiB,WAEtBc,IAAgBljB,GAAYoiB,WAAaoB,EAC9C5B,EAAe5hB,GAAYmiB,MAEtBe,IAAgBljB,GAAYmiB,MAAQqB,EACzC5B,EAAe5hB,GAAYkiB,WAEtBgB,IAAgBljB,GAAYkiB,WAAasB,EAC9C5B,EAAe5hB,GAAYiiB,OAEtBiB,IAAgBljB,GAAYiiB,OAASuB,EAC1C5B,EAAe5hB,GAAYgiB,WAEtBkB,IAAgBljB,GAAYgiB,WAAawB,EAC9C5B,EAAe5hB,GAAY+hB,MAEtBmB,IAAgBljB,GAAY+hB,MAAQyB,EACzC5B,EAAe5hB,GAAY8hB,WAEtBoB,IAAgBljB,GAAY8hB,WAAa0B,GAC9C5B,EAAe5hB,GAAY6hB,OAE3BqB,IAAgBljB,GAAY6hB,OAAU2B,EAGjCN,IAAgBljB,GAAY8hB,WAAc0B,EAG1CN,IAAgBljB,GAAY+hB,MAASyB,EAGrCN,IAAgBljB,GAAYgiB,WAAcwB,EAG1CN,IAAgBljB,GAAYiiB,OAAUuB,EAGtCN,IAAgBljB,GAAYkiB,WAAcsB,EAG1CN,IAAgBljB,GAAYmiB,MAASqB,EAGrCN,IAAgBljB,GAAYoiB,WAAcoB,GAC/C5B,EAAe5hB,GAAY6hB,OAH3BD,EAAe5hB,GAAYoiB,WAH3BR,EAAe5hB,GAAYmiB,MAH3BP,EAAe5hB,GAAYkiB,WAH3BN,EAAe5hB,GAAYiiB,OAH3BL,EAAe5hB,GAAYgiB,WAH3BJ,EAAe5hB,GAAY+hB,MAH3BH,EAAe5hB,GAAY8hB,aA2Ban1B,GAChD,OAAO,kBAAM82B,cAAcH,OAC5B,CAAC9B,EAAWZ,EAAesC,EAAapC,IAE3C,IAAM4C,EAAYnH,uBAAY,WAG1B,OAAQ2G,GACJ,KAAKljB,GAAYoiB,UACb,MAAM,GAAN,OAJO,IAIP,OAAmBZ,EAAnB,YAAgCxhB,GAAY8hB,WAChD,KAAK9hB,GAAYmiB,KACb,MAAM,GAAN,OANO,IAMP,OAAmBX,EAAnB,YAAgCxhB,GAAY+hB,MAChD,KAAK/hB,GAAYkiB,UACb,MAAM,GAAN,OARO,IAQP,OAAmBV,EAAnB,YAAgCxhB,GAAYgiB,WAChD,QACI,MAAM,GAAN,OAVO,IAUP,OAAmBR,EAAnB,YAAgC0B,MAEzC,CAAC1B,EAAW0B,IAETz1B,EAAU8nB,mBAAuB,WACnC,OAAQpG,GACJ,KAAKqN,GAAgBmH,MACjB,MAAO,CAACC,GAAyBC,GAAOC,KAC5C,KAAKtH,GAAgBuH,OACjB,MAAO,CAACH,GAAyBC,GAAOG,KAC5C,KAAKxH,GAAgByH,OACjB,MAAO,CAACL,GAAyBC,GAAOK,KAC5C,KAAK1H,GAAgB2H,IACjB,MAAO,CAACP,GAAyBC,GAAOO,KAC5C,KAAK5H,GAAgB6H,KACjB,MAAO,CAACT,GAAyBC,GAAOS,KAC5C,KAAK9H,GAAgB+H,MACjB,MAAO,CAACX,GAAyBC,GAAOW,KAC5C,KAAKhI,GAAgBiI,OACjB,MAAO,CAACb,GAAyBC,GAAOa,KAE5C,KAAKlI,GAAgBjN,KACrB,QACI,MAAO,MAEhB,CAACJ,IAEJ,OACI,eAAC,YAAD,yBAAW3W,EAAGA,EAAGC,EAAGA,EAAGiQ,IAAKyY,GAAcJ,GAA1C,cACMF,GAAmBiC,GACjB,cAAC,GAAD,CACI6B,eAAgB,GAChBriC,KAAK,SACLsiC,WAAW,EACX7f,SAAU+d,EAAOY,KACjBlrB,EAAG,GACHC,EAAG,GACHwgB,MAAO,CAAEkK,EAAQ5Y,SAAW,EAAI,EAAI,GACpCvE,OAAQ,CAAC,GAAI,IACb6e,MAAO,CAAC,EAAG,GACXp3B,QAASA,IAGhB5D,OAKEi7B,kBAAKpE,IAGd2C,GAAmB,SAAC0B,EAA0BC,GAChD,IAAMC,EAAQngC,KAAKogC,MAAMF,EAAY,GAAKD,EAAO,GAAIC,EAAY,GAAKD,EAAO,IACvEtjC,EAASqD,KAAKqgC,OAAOF,GAAS,EAAIngC,KAAKsgC,GAAK,GAAK,GAAK,GAE5D,MADqB,CAACplB,GAAY+hB,KAAM/hB,GAAYgiB,UAAWhiB,GAAYiiB,MAAOjiB,GAAYkiB,UAAWliB,GAAYmiB,KAAMniB,GAAYoiB,UAAWpiB,GAAY6hB,MAAO7hB,GAAY8hB,WAC7JrgC,IAGlBmiC,GAA2B,SAACx2B,EAAgBH,GAC9C,IAAMo4B,EAAej4B,EAAKlC,KAAI,SAACw0B,EAAKnnB,GAChC,MAAO,CACHnL,EAAKmL,GAAQtL,EAAGsL,OAGxB,OAAO,IAAI+sB,KAAwBD,EAAc,MAG/CxB,GAAQ,CACV,KACA,KACA,MACA,OAGEO,GAAO,CACT,QACA,QACA,QACA,UAGEE,GAAQ,CACV,MACA,MACA,OACA,SAGEJ,GAAS,CACX,QACA,QACA,QACA,UAGEF,GAAS,CACX,QACA,SACA,SACA,UAGEF,GAAQ,CACV,OACA,QACA,QACA,SAGEU,GAAQ,CACV,QACA,QACA,SACA,UAGEE,GAAS,CACX,SACA,SACA,SACA,USjYEa,GAAkB,SAACz9B,GAA6D,IAE9E64B,EAKA74B,EALA64B,WACArkB,EAIAxU,EAJAwU,SACA7G,EAGA3N,EAHA2N,aACAwP,EAEAnd,EAFAmd,SACA4b,EACA/4B,EADA+4B,gBAN6E,EAQjDF,EAAWK,oBAApCC,EAR0E,EAQ1EA,UAAWC,EAR+D,EAQ/DA,WAEZxY,EAAM2B,iBAAuB,MAEnC,OACI,cAAC,YAAD,CAAW3B,IAAKA,EAAhB,SACI,cAAC,GAAD,CACIpmB,KAAMmT,EACNkrB,WAAYA,EACZE,gBAAiBA,EACjBvkB,SAAUA,EACVskB,cAAe97B,KAAK0I,SAAW,GALnC,SAOKyX,GACG,cAAC,WAAD,CACI3iB,KAAK,kBACL44B,KAAM,SAAAC,GAEFA,EAASC,UADI,EACY,UACzBD,EAASV,WAAWwG,EAAY,EAAGC,EAAa,EAAGD,EAAY,EAFlD,GAGb9F,EAASR,kBAStBmK,kBAAKS,ICeLC,GAhDW,SAAC19B,GAAkB,IACjCyG,EAAwBzG,EAAxByG,QAASoyB,EAAe74B,EAAf64B,WAEjB,OACI,cAAC,YAAD,UACKpyB,EAAQrD,KAAI,SAAC6C,GAAY,IACduO,EAAmBvO,EAAnBuO,SAAUha,EAASyL,EAATzL,KADG,EAEiByL,EAAOY,WAArC8G,EAFa,EAEbA,aAAc5G,EAFD,EAECA,YACtB,OAAQd,EAAOxL,MACX,KAAKyL,KAAgBC,MACjB,GAAIH,aAAcC,GAAS,CACvB,GAAIA,EAAOI,aAAeC,IAAWC,OACjC,OACI,cAAC,GAAD,CACIiO,SAAUA,EACVqkB,WAAYA,EACZlrB,aAAcA,EAEdorB,gBAAiBhyB,EACjBoW,SAAUnd,EAAM29B,kBAAoBnjC,GAF/BmT,GAMZ,GAAI1H,EAAOI,aAAeC,IAAW0V,MACtC,OACI,cAAC,GAAD,CACIxhB,KAAMyL,EAAOzL,MAAQ,GACrBq+B,WAAYA,EACZE,gBAAiBhyB,EACjByN,SAAUA,EAEVskB,cAAe97B,KAAK0I,SAAW,GAC/BszB,OAAQ,CAAC,EAAG,IAFP/yB,EAAOzL,MAO5B,MAEJ,QACI,OAAO,KAEf,OAAO,WCURojC,GAhDC,SAAC59B,GAAqC,IAC1CuQ,EAA6DvQ,EAA7DuQ,KAAM9J,EAAuDzG,EAAvDyG,QAASoyB,EAA8C74B,EAA9C64B,WAAYZ,EAAkCj4B,EAAlCi4B,aAAc0F,EAAoB39B,EAApB29B,gBAEjD,OACI,cAAC,YAAD,UACKptB,EAAKstB,OACDl6B,QAAO,SAAAm6B,GAAC,OAAIA,EAAEC,WACd36B,KAAI,SAAAiN,GACD,GAAIA,EAAM5V,OAASwd,KAAe+lB,YAAa,CAAC,IAAD,EACLC,GAAgBx3B,EAAS4J,GAAvD6tB,EADmC,EACnCA,YAAaC,EADsB,EACtBA,cACrB,OACI,eAAC,IAAMC,SAAP,aACQF,EAAYz4B,QACZ,cAAC,GAAD,CACIgB,QAASy3B,EACTnuB,SAAUQ,EAAKR,UAAY,GAC3BkoB,aAAcA,MAGlBkG,EAAc14B,QACd,cAAC,GAAD,CAEIgB,QAAS03B,GAAiB,GAC1BtF,WAAYA,EACZ8E,gBAAiBA,GAHZttB,EAAM7V,QAVF6V,EAAM7V,MAmBnC,OAAI6V,EAAM5V,OAASwd,KAAeomB,UAE1B,cAAC,GAAD,CAEIhuB,MAAOA,EACP2nB,gBAAiBznB,EAAKsT,MACtB9T,SAAUQ,EAAKR,SACfkoB,aAAcA,GAJT5nB,EAAM7V,MAQhB,WASrByjC,GAAkB,SAACx3B,EAAwB4J,GAC7C,OAAO5J,EAAQkJ,QAAmE,SAACC,EAAKtU,GAQpF,OAPIA,EAAMgjC,UAAYjuB,EAAM6F,UACNU,IAAdtb,EAAMwU,IACNF,EAAIsuB,YAAY5gC,KAAKhC,IACgB,IAA9BA,EAAMuL,WAAWC,UACxB8I,EAAIuuB,cAAc7gC,KAAKhC,IAGxBsU,IACR,CAAEsuB,YAAa,GAAIC,cAAe,MCxD1BI,GAfM,SAACv+B,GAA+C,IACzD+B,EAA2B/B,EAA3B+B,SAAawF,EAD2C,YAC7BvH,EAD6B,cAEhE,OACI,cAAC,IAAkB4f,SAAnB,UACK,gBAAGjJ,EAAH,EAAGA,MAAH,OACG,cAAC,QAAD,2BAAWpP,GAAX,aACI,cAAC,IAAD,CAAUoP,MAAOA,EAAjB,SACK5U,WCgCVy8B,GA1CW,SAAC90B,GAAsB,IAAD,EACJsT,mBAA4C,IADxC,mBACrCyhB,EADqC,KACnBC,EADmB,OAEpB1hB,qBAFoB,mBAErCzM,EAFqC,KAE/BouB,EAF+B,KAmC5C,OA3BAphB,qBAAU,WACN,GAAKhN,EAAL,CACA,IAAMquB,EAAcC,GAAkBtuB,EAAMkuB,GAC5C,GAAKG,EAAL,CAEA,IAAME,EAAcF,EAAYpkC,KAEhCqd,YAAa,GAAD,OAAInO,EAAJ,YAAgBk1B,EAAYx3B,QAAS,SAACzL,GAC9C,GAAKA,EAAL,CACA,GAAIA,EAAS7B,MACT,MAAM,IAAIC,MAAJ,kBAAqB2P,EAArB,aAAkC/N,EAAS7B,QAErD,IAAMilC,EAAkBC,GAAqBJ,GACvC73B,EAAc,IAAIyQ,KAAKynB,YAAYtjC,EAASsiB,QAAS8gB,GAE3Dh4B,EAAYwpB,OAAM,WACd,IAAM2O,EAAW,2BACVT,GADU,mBAEZK,EAAc/3B,IAEnB23B,EAAYQ,cAGrB,CAAC3uB,EAAM7G,EAAU+0B,IAIb,CACHU,eAHmB5uB,QAAsDqG,IAA9CioB,GAAkBtuB,EAAMkuB,GAInDW,aAjCiB,SAAC9jC,GAClBqjC,EAAQrjC,IAiCRmjC,qBAOFI,GAAoB,SAAC9uB,EAA8BsvB,GACrD,OAAOtvB,EAASuG,MAAK,SAACgpB,GAClB,OAAQD,EAAiBC,EAAE9kC,UAK7BwkC,GAAuB,SAAChvB,GAI1B,IAHA,IAAMM,EAAUN,EAAQM,QAElB0qB,EAAyC,GACtC/qB,EAAI,EAAGA,EAAID,EAAQuvB,UAAWtvB,IAAK,CACxC,IAAMioB,EAAIloB,EAAQmoB,UACZC,EAAIpoB,EAAQqoB,WACZ3nB,EAAKT,EAAIK,EAAW4nB,EACpBvnB,EAAI3T,KAAKK,MAAM4S,EAAIK,GAAW8nB,EAEpC4C,EAAO,GAAD,OAAIhrB,EAAQxV,KAAZ,YAAoByV,EAAID,EAAQE,WAAc,CAChDirB,MAAO,CAACzqB,IAAGC,IAAGunB,IAAGE,KACjBoH,iBAAkB,CAAC9uB,IAAGC,IAAGunB,IAAGE,KAC5BqH,SAAS,EACTC,SAAS,EACTC,WAAY,CAAEzH,IAAGE,MAKzB,MAAO,CACH4C,SACA4E,KAAM,CACFx4B,MALM4I,EAAQ5I,MAMdC,KALK,CAAE6wB,EAAGloB,EAAQ6vB,WAAYzH,EAAGpoB,EAAQ8vB,aAMzC3O,MAAO,K,UCnEJ4O,I,OAZQ,WAEnB,OACI,qBAAKn+B,UAAU,kBAAf,SACC,YAAI8E,MAHK,IAGStD,KAAI,SAACmgB,EAAGtT,GAAJ,OACnB,qBAAKrO,UAAU,OAAf,SACI,qBAAKA,UAAU,WADQqO,UCCxB+vB,GAPK,SAAI1kC,GACpB,IAAMslB,EAAM2B,mBAIZ,OAHAhF,qBAAU,WACRqD,EAAI6B,QAAUnnB,IACb,CAACA,IACGslB,EAAI6B,SCCFwd,GAAyBC,wBAAmD,MAwD1EC,GAlDwB,SAACngC,GAAqC,IAClEoI,EAAuBpI,EAAvBoI,UAAWrG,EAAY/B,EAAZ+B,SACZ4U,EAAQypB,cAF0D,EAG5CpjB,oBAAkB,GAH0B,mBAGjEqjB,EAHiE,KAGzDC,EAHyD,KAKlE/3B,EADaoO,EAAMkF,WACAmY,OAAO1d,MAAK,SAAA4d,GAAC,OAAIA,EAAE15B,OAAS4N,KAC9CzF,EAA+B4F,EAA/B5F,MAAOgG,EAAwBJ,EAAxBI,UAAWmM,EAAavM,EAAbuM,UACnByrB,EAAoBP,GAAYlrB,GAEhC+jB,EAAapL,mBAAQ,WACvB,OAAK9kB,EAGEyP,KAAuBooB,mBAAmBp4B,EAAWO,EAAWgO,GAF5D,OAGZ,CAACvO,EAAWO,EAAWgO,IAwB1B,OAtBA4G,qBAAU,WAEN,GADA+iB,GAAU,GACN33B,GAAakwB,IAAeA,EAAW4H,YAAa,CAUpD5H,EAAW6H,UATa,WACpBJ,GAAU,IAGL39B,GAASk2B,IACVA,EAAW8H,cACX9H,EAAW+H,sBAKxB,CAAC/H,EAAYzwB,EAAWzF,EAAOgG,IAElC4U,qBAAU,WACFzI,IAAcyrB,GAAqB1H,GACnCA,EAAWgI,gBAEhB,CAAChI,EAAY0H,EAAmBzrB,KAE/B+jB,IAAeA,EAAW4H,aAAgBJ,EAM1C,cAACJ,GAAuBa,SAAxB,CAAiCxlC,MAAOu9B,EAAxC,SACK92B,IALD,cAAC,GAAD,KCSGg/B,GArDC,SAAC/gC,GAAkB,IACxBsO,EAA6CtO,EAA7CsO,KAAM0yB,EAAuChhC,EAAvCghC,WAAYC,EAA2BjhC,EAA3BihC,aAAcC,EAAalhC,EAAbkhC,UAIjCC,EAAM1T,mBAAQ,WAChB,OAAQztB,EAAM2d,UACV,IAAK,IAAK,OAAO,IACjB,IAAK,KAAM,OAAO,IAClB,IAAK,IAAK,OAAO,GACjB,IAAK,KAAM,OAAO,GAClB,QAAS,OAAO,KAErB,CAAC3d,EAAM2d,WAEJwT,EAAQ+P,EAAY,aAAe,GACnCr/B,EAAK,aACPu/B,UAAU,aAAD,OAfQ,GAeR,eAAkChI,GAAlC,eAAuEjI,EAAvE,mBAAuFgQ,EAAvF,2BAA6GD,EAAY,GAAK,GAA9H,OACTG,WAAW,OAAD,OAAS35B,IAAT,0CACVmc,MAjBiB,GAkBjBC,OAjBkB,IAkBdod,GAAa,CAAEI,OAAQ,IAa/B,OACI,qBACIz/B,MAAOA,EACPD,UAAU,UACV2/B,YAAaP,EACbQ,WAAYP,EAJhB,SAMI,qBACIQ,IAAKnzB,EACLzM,MAAO,CACHu/B,UAAU,WAAD,OAAaD,EAAb,QACTtd,MAAO6d,IAEXC,IAAI,QC2BLC,I,OArEQ,SAAC5hC,GAAkB,IAC/BwU,EAA0CxU,EAA1CwU,SAAUqtB,EAAgC7hC,EAAhC6hC,aAAcC,EAAkB9hC,EAAlB8hC,eADM,EAElB3P,qBAAW8N,IACa/G,oBAApCC,EAH8B,EAG9BA,UAAWC,EAHmB,EAGnBA,WACZgI,EAAS,oBAAgBjI,EAAY3kB,EAAS,GAArC,eAA8C4kB,EAAa5kB,EAAS,GAApE,OAJsB,EAKHwI,oBAAS,GALN,mBAK9B+kB,EAL8B,KAKnBC,EALmB,KAoB/BC,EAAwB,SAACnmB,GAC3BgmB,EAAehmB,IAMbomB,EAA0B,SAACC,GAC7BL,OAAelrB,IAKnB,OACI,sBACIhV,UAAS,2BAAsBmgC,EAAY,YAAc,YACzDlgC,MAAO,CAAEu/B,aACTgB,YA9BgB,SAAC7e,GACrBA,EAAEC,iBACFD,EAAEiC,mBA6BE+b,YA1BgB,WACpBS,GAAa,IA0BTR,WAvBe,aAkBnB,UAOI,cAAC,GAAD,CACI7jB,SAAS,IACTrP,KAAI,UAAK5G,IAAL,+CACJs5B,WAAY,kBAAMiB,EAAsBl8B,KAAgB80B,QACxDoG,aAAc,kBAAMiB,EAAwBn8B,KAAgB80B,QAC5DqG,WAAuB,OAAZW,QAAY,IAAZA,OAAA,EAAAA,EAAc/lB,UAAW/V,KAAgB80B,QAExD,cAAC,GAAD,CACIld,SAAS,KACTrP,KAAI,UAAK5G,IAAL,4CACJw5B,WAAW,IAEf,cAAC,GAAD,CACIvjB,SAAS,IACTrP,KAAI,UAAK5G,IAAL,+CACJs5B,WAAY,kBAAMiB,EAAsBl8B,KAAgBkW,OACxDglB,aAAc,kBAAMiB,EAAwBn8B,KAAgBkW,OAC5DilB,WAAuB,OAAZW,QAAY,IAAZA,OAAA,EAAAA,EAAc/lB,UAAW/V,KAAgBkW,OAExD,cAAC,GAAD,CAAS0B,SAAS,KAAKrP,KAAI,UAAK5G,IAAL,6CAAwEw5B,WAAW,IAC9G,cAAC,GAAD,CAASvjB,SAAS,IAAIrP,KAAI,UAAK5G,IAAL,4CAAuEw5B,WAAW,IAC5G,qBAAKt/B,UAAU,OAAOC,MAAO,CAAEgiB,MAAOsV,GAAtC,SACKkJ,GAAQR,UAQnBQ,GAAU,SAACR,GACb,IAAKA,EAAc,OAAO,KAC1B,GAAIA,EAAa/lB,SAAW/V,KAAgBkW,KAAM,CAAC,IAAD,EAC9C,KAAI,UAAC4lB,EAAatqB,YAAd,aAAC,EAAmB9R,QAEpB,OAAO,KAEX,IAAM68B,GAAgBT,EAAaU,SAAW,IAAMV,EAAaW,QAAU,GAC3E,OACI,qCACA,wCAGA,uBAAM5gC,UAAS,UAAM0gC,EAAgB,eAAgB,IAArD,qBACST,EAAaW,QADtB,WAMR,GAAIX,EAAa/lB,SAAW/V,KAAgB80B,MAAO,CAAC,IAAD,EAC/C,KAAI,UAACgH,EAAatqB,YAAd,aAAC,EAAmB9R,QAEpB,OAAO,KAEX,IAAM68B,GAAgBT,EAAaU,SAAW,IAAMV,EAAaW,QAAU,GAC3E,OACI,qCACA,yCAGA,uBAAM5gC,UAAS,UAAM0gC,EAAgB,eAAgB,IAArD,qBACST,EAAaW,QADtB,WAMR,MAAO,KCpFIC,I,OA5BQ,SAACziC,GAAkB,IAC/BwU,EAAYxU,EAAZwU,SACDqkB,EAAa1G,qBAAW8N,IAE1ByC,EAAU7J,EAAW8J,kBAAkBnuB,GACvCsH,EAAS/V,KAAgBkW,KAC7B,GAAIymB,EAAS,CAET,IAAMz8B,EAAS4yB,EAAW+J,oBAAoBpuB,IAC9C,OAAIvO,QAAJ,IAAIA,OAAJ,EAAIA,EAAQY,WAAW+W,eAEnB9B,EAAS/V,KAAgB+0B,SACzB4H,GAAU,GAZmB,MAeL7J,EAAWK,oBAApCC,EAf8B,EAe9BA,UAAWC,EAfmB,EAenBA,WACZgI,EAAS,oBAAgBjI,EAAY3kB,EAAS,GAArC,eAA8C4kB,EAAa5kB,EAAS,GAApE,OACT/M,EAAkBo7B,GAAO/mB,GACzB+H,EAAQsV,EACRrV,EAASsV,EACf,OACI,qBACIx3B,UAAS,2BAAsB8gC,EAAU,UAAY,IACrD7gC,MAAO,CAAEu/B,YAAW35B,kBAAiBoc,QAAOC,cAOlD+e,IAAM,sBACP98B,KAAgBkW,KADT,cACwBvU,IADxB,iEAEP3B,KAAgB+0B,SAFT,cAE2BpzB,IAF3B,mDCuJGo7B,I,OAlKC,SAAC9iC,GAAqC,IAE9C+B,EAOA/B,EAPA+B,SACA47B,EAMA39B,EANA29B,gBACAkE,EAKA7hC,EALA6hC,aACAkB,EAIA/iC,EAJA+iC,WACAC,EAGAhjC,EAHAgjC,YACAC,EAEAjjC,EAFAijC,YACAC,EACAljC,EADAkjC,kBAEEtiB,EAAM2B,iBAAuB,MAC7B4gB,EAAY5gB,kBAAO,GACnB4O,EAAQ5O,iBAAO,GACfsW,EAAa1G,qBAAW8N,IAExBt9B,EADQ4xB,GAASsE,EAAWzwB,WACdzF,MACbsG,EAAUtG,EAAVsG,OAhB0C,EAiBL+T,qBAjBK,mBAiB1ComB,EAjB0C,KAiB1BC,EAjB0B,KAmBjD9lB,qBAAU,WAEN,IAAM+lB,EAAe,WAAO,IAAD,EACvB,GAAK1iB,EAAI6B,QAAT,CACA,IAAM8gB,EAAM,UAAG3iB,EAAI6B,QAAQgG,kBAAf,aAAG,EAAwB+a,cAAc,UACrD,IAAKD,EAAQ,MAAMxpC,MAAM,yCAEzB,IAAM0pC,EAAY,OAAGF,QAAH,IAAGA,OAAH,EAAGA,EAAQld,YAC7B8K,EAAM1O,QAAUghB,EAAaV,EAC7BniB,EAAI6B,QAAQ5gB,MAAMu/B,UAAlB,gBAAuCjQ,EAAM1O,QAA7C,KACA7B,EAAI6B,QAAQ5gB,MAAMgiB,MAAlB,UAA6Bkf,EAA7B,MACAniB,EAAI6B,QAAQ5gB,MAAMiiB,OAAlB,UAA8Bkf,EAA9B,QAIJ,OAFAvf,OAAOC,iBAAiB,SAAU4f,GAClCA,IACO,WACH7f,OAAOG,oBAAoB,SAAU0f,MAE1C,CAACN,EAAaD,IAEjB,IAmCMW,EAA2BjP,uBAAY,SAAC3Y,GAC1C,GAAKA,EAAL,CADuE,MAQnE+c,EAAW8K,cAAchG,GAR0C,IAMnEnpB,SAAUlP,OANyD,MAMlD,CAAC,EAAG,GAN8C,EAO/Di9B,EAP+D,EAOnEqB,GAEEz+B,EAAKi+B,EAEX,OAAQtnB,GACJ,KAAK/V,KAAgBkW,KACrB,KAAKlW,KAAgB80B,MACjB,IAAMtjB,EAAOshB,EAAWgL,SAASv+B,EAAMH,GACjCq9B,EAASv5B,EAAS4vB,EAAWiL,qBAAqBx+B,EAAMH,QAAMyR,EACpEssB,EAAkB,CACdpnB,SACAxW,OACAH,KACAq9B,SACAD,UACAhrB,SAGR,MACA,KAAKxR,KAAgB+0B,SACjB,IAAMvjB,EAAOshB,EAAWkL,gBAAgBz+B,EAAMH,GAAI,GAElD+9B,EAAkB,CACdpnB,SACAxW,OACAH,KACAq9B,OALW,EAMXD,UACAhrB,eAjCR2rB,OAAkBtsB,KAqCvB,CAAC3N,EAAQ4vB,EAAYuK,EAAgBF,EAAmBvF,IAE3DpgB,qBAAU,WACN,IAAKtU,QAA6B2N,IAAnBwsB,EAA8B,CAEzC,IAAItnB,EAAS/V,KAAgBkW,KACvBhW,EAAS4yB,EAAW+J,oBAAoBQ,IAC9C,OAAGn9B,QAAH,IAAGA,OAAH,EAAGA,EAAQY,WAAW+W,eAElB9B,EAAS/V,KAAgB+0B,UAE7B4I,EAAyB5nB,MAE9B,CAACsnB,EAAgBM,EAA0Bz6B,EAAQ4vB,IAGtD,IAAMmL,EAAe,SAACzgB,GAClB,GAAIA,EAAEnH,kBAAkB6nB,QAAQ,CAC5B,IAAMC,EAAQ3gB,EAAEnH,OAAQkP,wBAClB5a,GAAK6S,EAAE4gB,QAAUD,EAAKxI,MAAQvK,EAAM1O,QACpC9R,GAAK4S,EAAE6gB,QAAUF,EAAKG,KAAOlT,EAAM1O,QACzC,OAAOoW,EAAWyL,qBAAqB,IAAI9sB,KAAKoP,MAAMlW,EAAGC,IAE7D,MAAM,IAAI5W,MAAM,wCAGpB,OACI,sBACI6mB,IAAKA,EACLhf,UAAU,WACVwgC,YAxGgB,SAAC7e,GACrB,GAAI4f,EAAU1gB,QAAS,CACnB,IAAMjO,EAAWwvB,EAAazgB,GAE9B,GAAIsV,EAAW0L,sBAAsB/vB,GAGjC,OAFA6uB,OAAkBzsB,QAClBssB,OAAkBtsB,GAGjBwsB,GAAmBxyB,aAAe4D,EAAU4uB,IAC7CC,EAAkB7uB,KA+FtByuB,YA1FgB,SAAC1f,GACrB,IAAM/O,EAAWwvB,EAAazgB,GACnB,OAAX0f,QAAW,IAAXA,KAAczuB,GACd2uB,EAAU1gB,SAAU,GAwFhB+hB,UArFc,SAACzc,GAInB,GAHAob,EAAU1gB,SAAU,EAEpB4gB,OAAkBzsB,GACbirB,EAAL,CAGA,IAAM4C,EAAwB5L,EAAW8K,cAAchG,GAAkBnpB,SACrEiwB,GAAyBrB,IAAmBxyB,aAAe6zB,EAAuBrB,IAClFvK,EAAW6L,mBAAmB/G,EAAiBkE,EAAa/lB,OAAQ+lB,EAAa18B,IAEpE,OAAjB+9B,QAAiB,IAAjBA,UAAoBtsB,KAqEpB,UAOK7U,GACCY,EAAMsG,QAAUm6B,GACd,cAAC,GAAD,CAAgB5uB,SAAU4uB,IAE7BzgC,EAAMsG,QAAUm6B,GACb,cAAC,GAAD,CACI5uB,SAAU4uB,EACVvB,aAAcA,EACdC,eAAgB4B,S,SClErBiB,GAnGIvmB,wBAA4E,aAAc,CACzGC,OADyG,WAErG,OAAO,IAAI7G,YAGf8G,WALyG,SAK9F5Z,EAAU6Z,EAAiBC,GAAkB,IAAD,SAQ/CA,EANAomB,cAF+C,MAEtC,GAFsC,IAQ/CpmB,EALAqmB,YAH+C,MAGxC,GAHwC,IAQ/CrmB,EAJAsmB,WAJ+C,MAIzC,EAJyC,IAQ/CtmB,EAHA8F,aAL+C,MAKvC,GALuC,EAM/CziB,EAEA2c,EAFA3c,MACG6c,EAP4C,YAQ/CF,EAR+C,yCAWnDG,4BAAkBja,EAAU6Z,EAAUG,GACtCha,EAASwmB,SAEI,SAAPkI,IACF,IAAI,EAAuC2R,SAA3C,CAIArgC,EAASwmB,QACTxmB,EAAS4uB,UAAT,OAAmBzxB,QAAnB,IAAmBA,OAAnB,EAAmBA,EAAOgiB,MAA1B,OAAiChiB,QAAjC,IAAiCA,OAAjC,EAAiCA,EAAOwlB,MAAxC,OAA+CxlB,QAA/C,IAA+CA,OAA/C,EAA+CA,EAAOqV,MAAtD,OAA6DrV,QAA7D,IAA6DA,OAA7D,EAA6DA,EAAOmjC,UAApE,OAA+EnjC,QAA/E,IAA+EA,OAA/E,EAA+EA,EAAOojC,QACtF,IAAMC,GAAoBz2B,KAAKC,OAAS,IAAM4V,GAAS,GAAKtnB,KAAKC,IAAI,IAAMqnB,GAEvE6gB,EAAW,EACXC,EAAU,EACd,GAAIF,EAAmB,EAAG,CACtB,IAAMG,GAAkBR,EAAOC,GAAOI,GAAoB5gB,GAAS,EAAI,GAAK,GACxE+gB,EAAiBR,EACjBM,EAAWN,EAAOQ,EAElBD,EAAUN,GAAOO,EAAiBR,GAG1C,IAnBe,EAmBTS,EAAgB,GAnBP,eAoBKV,GApBL,IAoBf,2BAA4B,CAAC,IACnBW,EADkB,QACRC,QACVC,EAAWzoC,KAAK0oC,IAAIhhC,EAAS8Y,UAC7BmoB,EAAW3oC,KAAK4oC,IAAIlhC,EAAS8Y,UAC7BqoB,EAAKN,EAAE70B,EACPo1B,EAAKP,EAAE50B,EACb40B,EAAE70B,EAAKm1B,EAAKJ,EAAWK,EAAKH,EAC5BJ,EAAE50B,EAAKk1B,EAAKF,EAAWG,EAAKL,EAC5BH,EAAchoC,KAAKioC,IA5BR,8BA+Bf,IAAK,IAAIt1B,EAAI,EAAGA,EAAIq1B,EAAc7/B,OAAS,EAAGwK,IAAK,CAC/C,IAAM81B,EAAKT,EAAcr1B,GACnB+1B,EAAKV,EAAcr1B,EAAI,GACvB41B,EAAKG,EAAGt1B,EAAIq1B,EAAGr1B,EACfo1B,EAAKE,EAAGr1B,EAAIo1B,EAAGp1B,EACfs1B,EAAMjpC,KAAKqsB,KAAKwc,EAAKA,EAAKC,EAAKA,GAC/BI,EAAS,CACXx1B,EAAGm1B,EAAKI,EACRt1B,EAAGm1B,EAAKG,GAERE,EAAiB,EAGrB,IADAzhC,EAAS6uB,OAAOwS,EAAGr1B,EAAI00B,EAAUc,EAAOx1B,EAAGq1B,EAAGp1B,EAAIy0B,EAAUc,EAAOv1B,GAC5Dw1B,GAAkBF,GACrBE,GAAkBf,GAEde,GADAhB,EAAW,EACOA,EAEAN,GAEDoB,GACjBd,EAAWgB,EAAiBF,EAC5BE,EAAiBF,GAEjBd,EAAW,EAEfzgC,EAAS0hC,OAAOL,EAAGr1B,EAAIy1B,EAAiBD,EAAOx1B,EAAGq1B,EAAGp1B,EAAIw1B,EAAiBD,EAAOv1B,IACjFw1B,GAAkBrB,GACGmB,GAAoB,IAAbd,EACxBC,EAAUe,EAAiBF,GAE3Bb,EAAU,EACV1gC,EAAS6uB,OAAOwS,EAAGr1B,EAAIy1B,EAAiBD,EAAOx1B,EAAGq1B,EAAGp1B,EAAIw1B,EAAiBD,EAAOv1B,IAI/E,IAAV2T,IACC,EAAuCpF,KAAOC,sBAAsBiU,KAG7EA,IAGJ/T,YA7FyG,WA8FpGhmB,KAAuC0rC,UAAW,EACnDzlB,qBAAsBjmB,KAAuC6lB,SCnEtDmnB,GApCO,SAACrmC,GAAkB,IAChC6hC,EAAuC7hC,EAAvC6hC,aAAc1I,EAAyBn5B,EAAzBm5B,UAAWC,EAAcp5B,EAAdo5B,WAEhC,OAAQyI,EAAa/lB,QACnB,KAAK/V,KAAgBkW,KACrB,KAAKlW,KAAgB+0B,SACrB,KAAK/0B,KAAgB80B,MACnB,IAAKgH,EAAatqB,KAChB,OAAO,KAET,IAAM+uB,EAAU,SAACf,GAAD,OAAiB,IAAI/tB,KAAKoP,MAAM2e,EAAE,GAAMpM,EAAcA,EAAY,EAAIoM,EAAE,GAAMnM,EAAeA,EAAa,IACpHmN,EAAS,CACXD,EAAQzE,EAAav8B,OADV,mBAERu8B,EAAatqB,KAAKnU,KAAI,SAAAmiC,GAAC,OAAIe,EAAQf,QAEpCiB,GAAU3E,EAAaW,QAAWX,EAAaW,SAAWX,EAAaU,SAAW,GAExF,OACE,cAAC,GAAD,CACEqC,OAAQ2B,EACR1B,KAAM,GACNC,IAAK,GACLxgB,MAAO,GACP9G,SAAU,EACV3b,MAAO,CACLgiB,MAAO,EACPwD,MAAOmf,EAAQ,SAAW,QAC1BtvB,MAAO,KAIf,QACE,OAAO,OCrCPuvB,GAAS,SAACjmB,GAAD,OAAuBA,EAAMpL,KCY7BsxB,GAXE,SAAC1mC,GACd,IAAMoV,EDMiB,SAACuxB,GACxB,IAAM1R,EAAiBxH,mBAAQ,WAK3B,OAJ8B8D,aAC1B,CAACkV,KACD,SAACrxB,GAAsB,OAAOA,EAAIzR,QAAO,SAACm6B,GAAD,OAAOA,EAAE/5B,UAAY0L,KAAWlH,OAASu1B,EAAEloB,iBAAmB+wB,UAG5G,CAACA,IAEJ,OAAOjhB,YAAoCuP,GCf/B2R,CAAY5mC,EAAM2mC,SAO9B,OANAppB,qBAAU,WACN,IAAMspB,EAAUzxB,EAAI0xB,QACR,OAAPD,QAAO,IAAPA,KAAS9pC,KAAa0R,KAAKC,QAGjC,CAAC0G,IACG,MCyGI2xB,I,OAnGD,SAAC/mC,GAAkB,I5BOHoI,E4BNnBu1B,EAAsC39B,EAAtC29B,gBAAiBqJ,EAAqBhnC,EAArBgnC,iBAClBnO,EAAa1G,qBAAW8N,IACxBgH,EAAUpO,EAAWoO,QACrBv9B,EAAWmvB,EAAWnvB,SAJA,EAUxB80B,GAAkB90B,GAHlBy1B,EAPwB,EAOxBA,aACAC,EARwB,EAQxBA,aACAX,EATwB,EASxBA,iBAGE7d,EAAM2B,iBAAuB,MAC7B5f,G5BNoByF,E4BMEywB,EAAWzwB,U5BLzBsd,aACV,SAAA/O,GAAK,uBAAIA,EAAMqd,OAAO1d,MAAK,SAAC4d,GAAD,OAAOA,EAAE15B,OAAS4N,YAAxC,aAAI,EAAgDzF,U4BTjC,EAcIk2B,EAAWK,oBAApCC,EAdqB,EAcrBA,UAAWC,EAdU,EAcVA,WAdU,EAe0Bpc,qBAf1B,mBAerBkqB,EAfqB,KAeAC,EAfA,KAiB5B5pB,qBAAU,WACD0pB,GACL7H,EAAa6H,EAAQl3B,YACtB,CAACqvB,EAAc6H,IAUlB,IAAK9H,IAAiB8H,IAAYtkC,EAC9B,OAAO,mDAGX,IAAMogC,EAAakE,EAAQpjB,MAAQojB,EAAQ9O,UACrC6K,EAAciE,EAAQnjB,OAASmjB,EAAQ5O,WAC7C,OACI,sBAAKz2B,UAAU,QAAQgf,IAAKA,EAA5B,UACI,cAAC,GAAD,CAAciD,MAAOkf,EAAYjf,OAAQkf,EAAzC,SACI,eAAC,YAAD,CACIplB,aAAa,EACbI,QAAS,IAAIxG,KAAK4vB,UAAU,EAAG,EAAGrE,EAAYC,GAFlD,UAII,cAAC,GAAD,CACIt5B,SAAUA,EACV6G,KAAM02B,EACNhP,aAAcwG,EACdh4B,QAAS9D,EAAM8D,QACfoyB,WAAYA,EACZ8E,gBAAiBA,EACjBqJ,iBAAkBA,IAEpBE,GAAwB,cAAC,GAAD,CAAerF,aAAcqF,EAAqB/N,UAAWA,EAAWC,WAAYA,IAtDvG,WADD,MAyFd,cAAC,GAAD,CACI2J,WAAYA,EACZC,YAAaA,EACbrF,gBAAiBA,EACjBkE,aAAcqF,EACdjE,YArEc,SAACzuB,GACvB,IAAMrO,EAAQ0yB,EAAW+J,oBAAoBpuB,GACzCrO,GAASC,aAAaD,KAAtB,OAAgCA,QAAhC,IAAgCA,OAAhC,EAAgCA,EAAO3L,OAEvCwF,EAAMgnC,iBAAiB7gC,EAAM3L,OAkEzB0oC,kBAAmBiE,IAEvB,cAAC,GAAD,CAAUR,QAAS9N,EAAWzwB,iBCrF3Bi/B,I,OAlBG,SAACrnC,GACf,IAAMuI,EAAQgsB,GAASv0B,EAAMoI,WACvB0tB,EAAmCl7B,aAAc2N,EAAM/N,MACzDoK,EAAmB5H,KAAKK,MAAMkL,EAAM3D,UACxC,EAAG,CACC,IAAMwQ,EAAM0gB,EAAgB5gB,MAAMtQ,GAAUwQ,IAC5C,GAAIA,EACA,OACI,8BACI,sCAAOlc,IAAYiB,IAAIib,QAInCxQ,UACKA,GAAY,GACrB,OAAO,oBAAIhD,UAAU,wBAAd,SAAuC1I,IAAY+8B,cAAc1tB,EAAM/N,UCLnE8sC,GAXM,SAACtnC,GAGlB,OAFcu0B,GAASv0B,EAAMoI,WAElBO,UAIP,cAAC,GAAD,eAAW3I,IAHJ,cAAC,GAAD,CAAWoI,UAAWpI,EAAMoI,a,mBCuC3C,IAwBem/B,gBAAkCjmC,KAASC,KA9CG,CACzDimC,UADyD,SAC/CxnC,GAEN,MAAO,CACHynC,cAAeznC,EAAMyQ,MACrB/V,KAAMsF,EAAMtF,KACZgtC,SAAU1nC,EAAM0nC,SAChBC,WAAY3nC,EAAM2nC,eAQ9B,SAAiBnmC,EAA8BvB,GAC3C,MAAO,CACH2nC,kBAAmBpmC,EAAQqmC,aAC3BC,WAAY7nC,EAAQ6nC,gBA4BbP,EAxBW,SAACvnC,GAAmC,IAElDtF,EAAuDsF,EAAvDtF,KAAM8U,EAAiDxP,EAAjDwP,QAASs4B,EAAwC9nC,EAAxC8nC,WAAYF,EAA4B5nC,EAA5B4nC,kBAAmBvgC,EAASrH,EAATqH,KAMtD,OAAIygC,EAEO,KAGJF,EACH,8BACI,cAAC,GAAD,CACIltC,KAAMA,EACN8U,QAdQ,SAACmS,GACbnS,GACAA,EAAQmS,IAaJta,KAAMA,UC7BP0gC,I,OA1BY,SAAC/nC,GACxB,IAAM4B,GAAa5B,EAAM4B,WAAa,IAAK,cAE3C,OACI,oBAAIA,UAAWA,EAAf,SACK5B,EAAM8a,MAAM1X,KAAI,SAAC1I,EAAM+V,GAAP,OACb,qBAEI7O,UAAU,OAFd,UAII,cAAC,GAAD,CACIlH,KAAMA,EACN+V,MAAOA,EACPi3B,SAAU1nC,EAAM0nC,SAChBC,WAAY3nC,EAAM2nC,aAEtB,sBAAK/lC,UAAU,OAAf,UACI,mBAAGA,UAAU,OAAb,SAAqB1I,IAAY2C,YAAYnB,KAC7C,mBAAGkH,UAAU,UAAb,SAAwB1I,IAAY80B,eAAetzB,UAZ3D,UACYA,GADZ,OACmB+V,W,UCFtBu3B,GAAuB,WAChC,IAAMhyB,EAAc0P,aAAgD,SAAA/O,GAAK,OAAIA,EAAMX,eAC7Ege,EAAStO,aAA2C,SAAA/O,GAAK,OAAIA,EAAMqd,UAMzE,OAJ0BvG,mBAAQ,WAC9B,OAlBqB,SAACzX,EAAqCge,GAE/D,IAAMje,EAAqBie,EAAOrkB,QAAiB,SAACC,EAAKgoB,GAIrD,OAHIA,EAAIxD,SAAW3H,GAAY6H,QAC3B1kB,EAAItS,KAAJ,MAAAsS,EAAG,YAASgoB,EAAI3hB,QAEbrG,IACR,IAEH,OAAOoG,EAAYrS,QAAO,SAACkN,GAAD,OAA6C,IAAtCkF,EAAmB4hB,QAAQ9mB,EAAEqF,OASnD+xB,CAAqBjyB,EAAage,KAC1C,CAAChe,EAAage,KAMRkU,GAAqB,SAACv6B,GAC/B,IAAMw6B,EAAqB1T,uBACvB,SAACjU,GAAD,OAAuBA,EAAMxK,YAAYM,MAAK,SAAC4d,GAAD,OAAOA,EAAEhe,KAAOvI,OAC9D,CAACA,IAEL,OAAO+X,YAA8CyiB,IC+D1CC,I,cAlFG,SAACpoC,GACf,IAAM64B,EAAa1G,qBAAW8N,IACxBzpB,EAAa0xB,GAAmBloC,EAAM2N,cACtC06B,EAAY9xB,aAA6BC,GACzCoK,EAAM2B,iBAAuB,MAC7B+lB,EAAQzP,EAAW0P,aAAavoC,EAAMwoC,WAE5C,IAAKF,EACD,OAAO,KA6BX,OACI,sBAAK1mC,UAAS,+BAAkCgf,IAAKA,EAArD,UACI,sBAAKhf,UAAU,SAAf,UACI,qBAAKA,UAAU,QAAf,SACK1I,IAAYiB,IAAImuC,EAAMxmC,MAAO,CAAE0U,WAAYA,EAAWhc,SAE3D,qBAAKoH,UAAU,QAAQ4N,QAASxP,EAAMkoB,aAExCogB,EAAMxtB,MAAMrV,OAAS,GACnB,sBAAK7D,UAAU,UAAf,UACI,qBAAKA,UAAU,QAAf,SACI,cAAC,GAAD,CACIkZ,MAAOwtB,EAAMxtB,MACb6sB,WAAYn6B,KAAei7B,UAC3Bf,SAAU1nC,EAAMwoC,cAGxB,sBAAK5mC,UAAU,aAAf,UACI,cAAC,GAAD,CAAkB4U,WAAYA,IAC9B,cAAC,GAAD,CAAQhH,QAtCD,SAAC+T,GACxBA,EAAEiC,kBACF5E,EAAI6B,QAASimB,iBAAiB,qBAAqBrtC,SAAQ,SAAC8B,EAAIsT,GACxDA,GAAS43B,GACblrC,EAAGwrC,UAAUrlC,IAAI,aAErB4B,IAAKC,GAAG,2BAA4B,CAChC4d,MAAO,QACP6lB,QAAS,CACPC,KAAM,GACNlO,KAAM,gBAERv1B,WAAY,WACR,IAAK,IAAI6K,EAAI,EAAGA,EAAIo4B,EAAWp4B,IAC3B4oB,EAAWiQ,kBAAkB,EAAG9oC,EAAMwoC,UAAWxoC,EAAM2N,kBAwBd+iB,SAAwB,IAAd2X,EAAiBhhC,KAAK,QAArE,SACKnO,IAAYiB,IAAI,8CAK7BmuC,EAAMzqC,MACN,sBAAK+D,UAAU,UAAf,UACI,sBAAKA,UAAU,OAAf,UACI,cAACuF,GAAA,EAAD,CACIC,MAAM,yBACNC,KAAK,WAERnO,IAAYiB,IAAI,+BAAgC,CAAE0D,KAAMyqC,EAAMzqC,UAEnE,qBAAK+D,UAAU,YAAf,SACI,cAAC,GAAD,CAAQ4N,QA7DL,SAAC+T,GACpBA,EAAEiC,kBAGFqT,EAAWkQ,kBAAkB/oC,EAAMwoC,YAyDcnhC,KAAK,QAAtC,SACKnO,IAAYiB,IAAI,4CC7C9B6uC,I,OAnCG,SAAChpC,GACf,IAAM64B,EAAa1G,qBAAW8N,IACxBrf,EAAM2B,iBAAuB,MAC7B0mB,EAAYpQ,EAAWqQ,aAAalpC,EAAMipC,UAAWjpC,EAAM2N,cACjE,IAAKs7B,EAAW,OAAO,KAJS,IAMxBnnC,EAAyBmnC,EAAzBnnC,MAAOqnC,EAAkBF,EAAlBE,QAAS5hB,EAAS0hB,EAAT1hB,KAClB6hB,EAAoB,SAAC7lB,GACvB,IAAM8lB,EAAS9lB,EAAEiF,cAAc8gB,aAAa,eAC5CzQ,EAAW0Q,2BAA2BvpC,EAAMipC,UAAWI,EAAQrpC,EAAM2N,cACrE4V,EAAEiC,mBAON,OACI,sBAAK5jB,UAAS,8BAAiCgf,IAAKA,EAApD,UACI,sBAAKhf,UAAU,SAAf,UACI,qBAAKA,UAAU,QAAf,SACK1I,IAAYiB,IAAI2H,KAErB,qBAAKF,UAAU,QAAQ4N,QAVf,SAAC+T,GACjBvjB,EAAMkoB,UACN3E,EAAEiC,wBAUE,sBAAK5jB,UAAU,UAAf,UACE2lB,GAAS,qBAAK3lB,UAAU,OAAf,SAAuB1I,IAAYiB,IAAIotB,KADlD,OAEE4hB,QAFF,IAEEA,OAFF,EAEEA,EAAS/lC,KAAI,SAAAimC,GAAM,OACjB,cAAC,GAAD,CAAqBG,cAAaH,EAAQ75B,QAAS45B,EAAnD,SAAuElwC,IAAYiB,IAAIkvC,IAA1EA,cCDdI,I,OAzBG,SAACzpC,GAAkB,IAC1Bq3B,EAAwBr3B,EAAxBq3B,qBACDrhB,EAAc0P,YAAY6R,GAA+Bv3B,EAAMoI,YAC/DywB,EAAa1G,qBAAW8N,IAE9B,OACI,sBAAKr+B,UAAU,aAAf,UACI,qBAAKA,UAAU,QAAf,SACK1I,IAAYiB,IAAI,yBAErB,qBAAKyH,UAAU,cAAf,SACKoU,EAAY5S,KAAI,SAAAyN,GAAC,aACd,sBAAgBjP,UAAS,qBAAgBy1B,IAAyBxmB,EAAEqF,GAAK,WAAa,IAAtF,UACI,cAAC,GAAD,CAAkBM,WAAY3F,EAAGxJ,KAAMJ,KAASW,WAChD,sBAAKhG,UAAU,KAAf,WACK,UAAAi3B,EAAW8K,cAAc9yB,EAAEqF,WAA3B,eAAgC0tB,KAAM,EAD3C,WAFM/yB,EAAEqF,SAQpB,cAAC,GAAD,CAAQ7O,KAAK,QAAb,2B,UC1BNvH,GAAoC,CACtCC,KADsC,SACjCC,EAAcC,GACfD,EAAME,OAAOD,EAAQE,YAEzBC,QAJsC,SAI9BJ,EAAcC,GAClB,IAAMypC,EAAkCzpC,EAAQE,UAChD,OAAIupC,EAAS/B,aAAen6B,KAAem8B,sBAClB,MAAd3pC,EAAMtF,MAAgB2F,aAA0BL,EAAMtF,KAAMgvC,EAASjC,kBAoDzEpmC,gBACXC,KAASC,KACTzB,IApCY,SAAC0B,EAA8BvB,GAA/B,MAA+D,CAC3EG,QAASH,EAAQG,UACjBqB,kBAAmBD,EAAQ1B,aAC3B4B,OAAQzB,EAAQyB,YA+BLL,EAzBO,SAACrB,GAAuD,IAEtE0B,EAGA1B,EAHA0B,OACAtB,EAEAJ,EAFAI,QACAqB,EACAzB,EADAyB,kBAIEmoC,EAAa,CACf,kBASJ,OAZiBloC,GAAUtB,EAOvBwpC,EAAWtsC,KAAK,eACT8C,GACPwpC,EAAWtsC,KAAK,iBAGbmE,EACH,qBAAKG,UAAWgoC,EAAWrsC,KAAK,KAAhC,SACMyC,EAAM+B,eCGL8nC,I,OA7CG,SAAC7pC,GAEf,IADA,IAAMsqB,EAAQ,GADkB,WAEvBra,GACL,IAAI65B,OAAQ,EACNpvC,EAAOsF,EAAM8a,MAAM7K,GAYrBvV,IACAovC,EACI,cAAC,GAAD,CACIr5B,MAAOR,EACPy3B,SAAU1nC,EAAM0nC,SAChBC,WAAY3nC,EAAM2nC,WAClBjtC,KAAMA,KAKlB,IAAMqvC,EACF,cAAC,GAAD,CAEIrvC,KAAMA,EACN2M,KAAMrH,EAAMgqC,SACZ9pC,OA3BW,SAACwpC,GAChB,IAAIA,EAASjC,gBAAkBx3B,GAAKy5B,EAAS/B,aAAe3nC,EAAM2nC,YAAc+B,EAAShC,WAAa1nC,EAAM0nC,WAIxG1nC,EAAMiqC,WAAY,CAAC,IACGr8B,EAAY87B,EAA3BjC,cACPznC,EAAMiqC,WAAWP,EAAShvC,KAAMkT,EAAWqC,EAAGy5B,EAAS/B,WAAY+B,EAAShC,YAgBhF,SAMKoC,GANL,yBAC2B75B,IAQ/Bqa,EAAMhtB,KAAKysC,IAnCN95B,EAAI,EAAGA,EAAIjQ,EAAM8a,MAAMrV,OAAQwK,IAAM,EAArCA,GAqCT,OACI,qBAAKrO,UAAS,oBAAe5B,EAAM4B,UAAY5B,EAAM4B,UAAY,IAAjE,SACK0oB,M,SCrDE4f,GAJW,WACtB,OAAOxkB,aAAuC,SAAA/O,GAAK,OAAIA,EAAMwzB,cC6KlDC,GA/JY,WACvB,IAAMluB,EAAW4Q,cACXud,EAAkBlY,qBAAW8N,IAC7BkK,EAAYD,KAqJlB,MAAO,CACHI,kBAnJsB,SAACZ,EAAiCrvC,EAA6Bmc,GACrF,IAAM9b,EAAOgvC,EAAShvC,KAChB6vC,EAAoB,GAI1B,OAFAhoC,IAAaqM,UAAU,YAEf86B,EAAS/B,YAEb,KAAKn6B,KAAeg9B,oBAChBD,EAAQjtC,KAEJyQ,aAAwByI,EAAWN,GAAIwzB,EAASjC,eAEhDz5B,aAAgBwI,EAAWN,GAAI7b,EAAUK,IAG7C,IAAM+vC,EAAoBj0B,EAAWk0B,UAAUrwC,GAC3CowC,GAEAF,EAAQjtC,KAAKwQ,aAAmB0I,EAAWN,GAAIu0B,EAAmBf,EAASjC,gBAE/E,MAGJ,KAAKj6B,KAAerO,UAChBorC,EAAQjtC,KACJ6sB,GAAwBuf,EAASjC,eACjCz5B,aAAgBwI,EAAWN,GAAI7b,EAAUK,IAG7C,IAAM+vC,EAAoBj0B,EAAWk0B,UAAUrwC,GAC3CowC,GAEAF,EAAQjtC,KAAK2sB,GAAmBwgB,EAAmBf,EAASjC,gBAEhE,MAIJ,KAAKj6B,KAAem8B,oBAChBY,EAAQjtC,KACJ0Q,aAAgBwI,EAAWN,GAAI7b,EAAUK,IAG7C,IAAM+vC,EAAoBj0B,EAAWk0B,UAAUrwC,GACzCuT,EAAW87B,EAASjC,cACtBgD,EAEAF,EAAQjtC,KAAK0Q,aAAgBwI,EAAWN,GAAItI,EAAU68B,IAGtDF,EAAQjtC,KAAK4Q,aAAgBsI,EAAWN,GAAItI,IAKxD28B,EAAQlvC,SAAQ,SAAAwV,GAAC,OAAIqL,EAASrL,OA4F9B85B,kBAxFsB,SAACjwC,EAAYkT,EAAkBC,EAAgB85B,EAA4BnxB,EAAkCkxB,GACnI,IAAM6C,EAAoB,GAC1B,OAAQ5C,GAEJ,KAAKn6B,KAAeg9B,oBAChBD,EAAQjtC,KAAKoQ,aAAoB8I,EAAWN,GAAItI,EAAUC,IAC1D,MAGJ,KAAKL,KAAerO,UAChBorC,EAAQjtC,KACJ6sB,GAAwBvc,GACxBE,aAAmB0I,EAAWN,GAAIxb,EAAMmT,IAE5C,IAAM+8B,EAAYp0B,EAAWC,UAAU5I,GACnC+8B,GACAL,EAAQjtC,KACJ2sB,GAAmB2gB,EAAWh9B,IAGtC,MAIJ,KAAKJ,KAAem8B,oBAChBY,EAAQjtC,KACJwQ,aAAmB0I,EAAWN,GAAIxb,EAAMmT,IAG5C,IAAM48B,EAAoBj0B,EAAWC,UAAU5I,GAC3C48B,EAEAF,EAAQjtC,KAAK0Q,aAAgBwI,EAAWN,GAAItI,EAAU68B,IAGtDF,EAAQjtC,KAAK4Q,aAAgBsI,EAAWN,GAAItI,IAEhD,MAIJ,KAAKJ,KAAei7B,UACZ4B,GAAmB3C,GAEnB2C,EAAgBvB,kBAAkBl7B,EAAU85B,EAAUlxB,EAAWN,GAAIrI,GAIjF08B,EAAQlvC,SAAQ,SAAAwV,GAAC,OAAIqL,EAASrL,OAyC9Bg6B,kBArCsB,SAACnwC,EAAYkT,EAAkBC,EAAgB85B,EAA4BD,GACjG,IAAM6C,EAAoB,GAE1B,OAAQ5C,GAEJ,KAAKn6B,KAAerO,UAChBorC,EAAQjtC,K9DzGjB,SAA6BsQ,EAAkBC,GAClD,MAAO,CACHpT,KAAMyN,GAAW4iC,oBACjBl9B,WACAC,U8DsGYi9B,CAAoBl9B,EAAUC,IAElC,IAAM+8B,EAAYT,EAAUt8B,GACxB+8B,GACAL,EAAQjtC,KACJwQ,aAAmB45B,EAAWkD,EAAWh9B,IAGjD,MAGJ,KAAKJ,KAAeg9B,oBAChBD,EAAQjtC,KACJyQ,aAAwB25B,EAAW95B,GACnCqc,GAAmBvvB,EAAMmT,IAE7B,IAAM+8B,EAAYT,EAAUt8B,GACxB+8B,GACAL,EAAQjtC,KACJwQ,aAAmB45B,EAAWkD,EAAWh9B,IAMzD28B,EAAQlvC,SAAQ,SAAAwV,GAAC,OAAIqL,EAASrL,SCpHvBk6B,I,OA1CU,SAAC/qC,GAAkB,IAAD,EACjCwW,EAAa0xB,GAAmBloC,EAAM2N,cAyB5C,OAAI,OAAC6I,QAAD,IAACA,OAAD,EAACA,EAAYw0B,QAIb,qCACI,4BAAI9xC,IAAYiB,IAAI,qCACpB,oBAAIyH,UAAU,oBAAd,mBACKzG,OAAOC,KAAKob,EAAWw0B,eAD5B,aACK,EAAgC5nC,KAAI,SAAC6nC,GAElC,OAhCI,SAACC,GAEjB,IAAMC,EAAc,SAACxpB,GACjB,IACMmJ,EADUnJ,EAAM6G,cACI8C,wBAC1BV,GAAeW,mBAAmBhB,GAAY2gB,MAAOA,EAAOpgB,GAC5DnJ,EAAM6D,mBAEV,OACI,cAAC,WAAD,UACI,qBAAIhW,QAAS27B,EAAb,UACI,sBAAMvpC,UAAU,QAAQ4N,QAAS27B,EAAjC,SACKjyC,IAAYkyC,aAAaF,KAE9B,+BACK10B,EAAWw0B,OAAOE,SANhBA,GAuBAG,CADmBJ,WAP/B,OCjCR,SAASK,GAAUzc,GACtB,OAAO7xB,KAAKmsB,IAAI0F,EAPH,GAOqB,G,ICJ1B0c,G,iBAAAA,O,2BAAAA,I,4BAAAA,Q,KAaZ,IAiBeC,GAjBU,SAACxrC,GAAkB,IAmB7B43B,EAAa9O,EAAa3F,EAnBE,EACGnjB,EAAlC4B,iBAD+B,MACnB,GADmB,EACf6pC,EAAkBzrC,EAAlByrC,cAClBC,EAAmBnpB,iBAAO,GAC1B3d,GAgBKgzB,EAhBoB53B,EAAM4E,UAAY,EAgBzBkkB,EAhB4B,EAiB7C8O,GAD8BzU,EAhBkB,GAiBpCA,EAAMyU,EAAM9O,EAAMA,EAAM8O,GAd3C,OADA8T,EAAiBjpB,QAAU7d,EAEvB,sBAAKhD,UAAS,sBAAiBA,GAA/B,UACI,qBAAKA,UAAU,oBAAf,SAAoC5B,EAAM8tB,QAC1C,qBAAKlsB,UAAU,kBAAkBC,MAAK,aAClCgiB,MAAM,GAAD,OAAgB,IAAXjf,EAAL,MACD6mC,GAAiB,CAACE,WAAW,SAAD,OAAWF,EAAX,qBCdhD,ICRYG,G,GDsDGC,GA9CD,SAAC7rC,GAAkB,IACrB2N,EAAiB3N,EAAjB2N,aACAm+B,EAAO5D,GAAmBv6B,GAA1Bm+B,GACFC,EFdH,SAAmBD,GACtB,OAAO9uC,KAAKK,MAHC,GAGgBL,KAAKqsB,KAAKyiB,IEalBE,CAAUF,GACzBG,EAAiBX,GAAUS,GAC3BG,EAAYH,EAAe,EAC3BI,EAAcb,GAAUY,GANF,EAO4BlvB,oBAAS,GAPrC,mBAOrBovB,EAPqB,KAOCC,EAPD,KAStBC,EAAYtM,GAAY,CAAE+L,eAAcE,iBAAgBC,YAAWC,gBACnEI,EAAiBvM,GAAYryB,GAEnC4P,qBAAU,WAAO,IAAD,EACRgvB,IAAmB5+B,EACnB0+B,GAAwB,GAEnBH,GAAS,iBAAII,QAAJ,IAAIA,OAAJ,EAAIA,EAAWJ,iBAAf,QAA4B,KAC1C3pC,IAAaqM,UAAU,cACvBy9B,GAAwB,GAExBx9B,YAAW,WACPw9B,GAAwB,KACzB,QAER,CAAC1+B,EAAc4+B,EAAf,OAA+BD,QAA/B,IAA+BA,OAA/B,EAA+BA,EAAWJ,UAAWA,IAExD,IAAMM,EAA2BxM,GAAYoM,GAEvCxnC,EAAW6oB,mBAAQ,WACrB,OAAO2e,EAAuB,GAAKN,EAAKG,IAAmBE,EAAcF,KAC1E,CAACA,EAAgBG,EAAsBD,EAAaL,IAEvD,OACI,sBAAKlqC,UAAU,QAAf,mBACWmqC,EACN,cAAC,GAAD,CACGnnC,SAAUA,EACV6mC,cAAec,IAAmB5+B,GAAiB6+B,EAAiC,EAAN,IAC9E1e,MAAOse,EAAwBlzC,IAAYiB,IAAI,kCAAoCjB,IAAYiB,IAAI,iCAAkC,CACjI2xC,GAAI9uC,KAAKK,MAAMyuC,EAAKG,GACpBQ,KAAMN,EAAcF,UEtBzBS,GAjBK,SAAC1sC,GAAkB,IAAD,EAC5BuI,EAAQgsB,GAASv0B,EAAMoI,WACvBywB,EAAa1G,qBAAW8N,IAExB2D,EAAKnW,mBAAQ,WAAO,IAAD,EACrB,OAAKoL,IACE,UAAAA,EAAW8K,cAAc3jC,EAAMwW,WAAWN,WAA1C,eAA+C0tB,KAD9B,OAEzB,CAAC/K,EAAY74B,EAAMwW,WAAWN,KAEjC,OAAI,OAAC3N,QAAD,IAACA,GAAD,UAACA,EAAO5F,aAAR,aAAC,EAAcsG,QAIf,+BAAO/P,IAAYiB,IAAI,kCAAmC,CAAEypC,SAHrD,M,iBDnBHgI,K,0BAAAA,E,gBAAAA,E,4BAAAA,E,0BAAAA,E,2BAAAA,Q,KEHZ,IAAMjsC,IAAG,sBACJisC,GAAMe,YAAc,CACjB7xC,MAAO8wC,GAAMe,YACbC,WAAW,IAHV,gBAKJhB,GAAMiB,OAAS,CACZ/xC,MAAO8wC,GAAMiB,OACbD,WAAW,IAPV,gBASJhB,GAAMkB,aAAe,CAClBhyC,MAAO8wC,GAAMkB,eAVZ,gBAYJlB,GAAMmB,YAAc,CACjBjyC,MAAO8wC,GAAMmB,cAbZ,gBAeJnB,GAAMoB,YAAc,CACjBlyC,MAAO8wC,GAAMoB,cAhBZ,ICWT,ICGKC,GD+BUC,GAlCU,SAACltC,GACtB,IAAMwW,EAAa0xB,GAAmBloC,EAAM2N,cAEtCw/B,EAAc,SAACryC,EAAcsyC,GAC/B,IAAMC,EDKP,SAAuBvyC,GAC1B,OAAO6E,GAAI7E,GCNiBF,CAAcE,GAOtC,OACI,eAAC,WAAD,WACI,oBAAI0U,QARQ,SAACmS,GACjB,IACMmJ,EADUnJ,EAAM6G,cACI8C,wBAC1BV,GAAeW,mBAAmBhB,GAAYzvB,MAAOuyC,EAAiBviB,GACtEnJ,EAAM6D,mBAIF,SACKtsB,IAAYo0C,aAAaxyC,MAE5BsyC,GAAS,OAJAtyC,IASvB,OAAI,OAAC0b,QAAD,IAACA,OAAD,EAACA,EAAY+2B,QAIb,qCACI,4BAAIr0C,IAAYiB,IAAI,qCACpB,oBAAIyH,UAAU,oBAAd,SACK4U,EAAW+2B,OAAOnqC,KAAI,SAACk8B,EAAGrvB,GAAJ,OAASk9B,EAAY7N,EAAGrvB,IAAMuG,EAAW+2B,OAAQ9nC,OAAQ,WANjF,MEIA+nC,I,OA5BH,SAACxtC,GAAkB,IAGrByY,EjB8BkC,SAAC9K,GAAqD,IAAD,EACvF6I,EAAa0xB,GAAmBv6B,GAChC8/B,EAAS,SAAChzC,GACZ,IAAMC,EAAuB8b,EAAWk0B,UAAUjwC,GAClD,OAAKC,GACEE,aAAcF,GAAM+d,iBADT,GAGtB,OAAO,EAAP,kBACKle,KAAkBA,KAAkBkG,MAAQgtC,EAAOlzC,KAAkBkG,OAD1E,eAEKlG,KAAkBA,KAAkB6D,OAASqvC,EAAOlzC,KAAkB6D,QAF3E,eAGK7D,KAAkBA,KAAkBiG,OAASitC,EAAOlzC,KAAkBiG,QAH3E,eAIKjG,KAAkBA,KAAkB4f,WAAaszB,EAAOlzC,KAAkB4f,YAJ/E,eAKK5f,KAAkBA,KAAkBmG,MAAQ+sC,EAAOlzC,KAAkBmG,OAL1E,eAMKnG,KAAkBA,KAAkBgG,MAAQktC,EAAOlzC,KAAkBgG,OAN1E,EiBrCwBmtC,CAFD1tC,EAAhB2N,cAGDggC,EAAwB,SAAC3rC,GAC3B,IAAM4rC,EAAKn1B,EAAgBle,KAAkByH,IAC7C,OAAK4rC,EAID,qBAAKhsC,UAAWrH,KAAkByH,GAAlC,SACK4rC,GADkD5rC,GAHhD,MASf,OACI,qBAAIJ,UAAU,MAAd,UACM+rC,EAAsBpzC,KAAkBkG,MACxCktC,EAAsBpzC,KAAkB6D,OACxCuvC,EAAsBpzC,KAAkBiG,OACxCmtC,EAAsBpzC,KAAkB4f,WACxCwzB,EAAsBpzC,KAAkBmG,MACxCitC,EAAsBpzC,KAAkBgG,WCyBvCstC,I,OA1Ca,SAAC7tC,GAAkB,IACnCwW,EAAoCxW,EAApCwW,WAAYs3B,EAAwB9tC,EAAxB8tC,oBAEdC,EAAmB,SAAC1zC,GAEtB,IAAMK,EAAyB8b,EAAWk0B,UAAUrwC,GAEpD,OACI,qBAAIuH,UAAWrH,KAAkBF,GAAjC,UACI,cAAC2zC,GAAA,EAAD,CACI9tC,OAAQ,SAACwpC,GAAD,OAAqCoE,EAAoBpE,EAAUrvC,IAC3EI,KAAMJ,EAFV,SAIKK,GACG,cAAC,GAAD,CACI+V,MAAOpW,EACPqtC,SAAUlxB,EAAWN,GACrByxB,WAAYn6B,KAAem8B,oBAC3BjvC,KAAMA,EACN2M,KAAMJ,KAASa,WAI3B,sBAAMlG,UAAU,OAAhB,SAAwB1I,IAAY60C,iBAAiB1zC,SAIjE,OACI,qBAAIuH,UAAU,uBAAd,UACKmsC,EAAiBxzC,KAAkBkG,MACnCstC,EAAiBxzC,KAAkB6D,OACnC2vC,EAAiBxzC,KAAkBiG,OACnCutC,EAAiBxzC,KAAkB4f,WACnC4zB,EAAiBxzC,KAAkBmG,MACnCqtC,EAAiBxzC,KAAkBgG,MACnCwtC,EAAiBxzC,KAAkBqG,UACnCmtC,EAAiBxzC,KAAkBsG,SACpC,cAAC,GAAD,CAAK8M,aAAc6I,EAAWN,UCyC3B+3B,I,OAnES,SAACjuC,GAAkB,IAEnC2N,EAOA3N,EAPA2N,aACAvF,EAMApI,EANAoI,UACA8lC,EAKAluC,EALAkuC,eAJkC,EASlCluC,EAJAxF,YALkC,WASlCwF,EAHAmuC,gBANkC,WASlCnuC,EAFAutC,cAPkC,WASlCvtC,EADAgrC,cARkC,SAUhCx0B,EAAa0xB,GAAmBv6B,GAVA,EAmBlCy8B,KAFAE,EAjBkC,EAiBlCA,kBACAK,EAlBkC,EAkBlCA,kBAUJ,OACI,sBAAK/oC,UAAS,0BAAsBssC,EAAiB,cAAgB,IAArE,UACI,sBAAKtsC,UAAU,OAAf,UACI,sBAAKA,UAAU,OAAf,UACMpH,GACE,sBAAKoH,UAAU,OAAf,UACK4U,EAAWhc,KACX4N,GAAa,cAAC,GAAD,CAAaA,UAAWA,EAAWoO,WAAYA,OAGnE23B,GAAY,cAAC,GAAD,CAAOxgC,aAAc6I,EAAWN,KAE5Cq3B,GAAU,cAAC,GAAD,CAAkB5/B,aAAc6I,EAAWN,KACrD80B,GAAU,cAAC,GAAD,CAAkBr9B,aAAc6I,EAAWN,QAK3D,qBAAKtU,UAAU,YAAf,SACI,cAAC,GAAD,CACI4U,WAAYA,EACZs3B,oBA5BY,SAACpE,EAAiCrvC,GAC9DiwC,EAAkBZ,EAAUrvC,EAAUmc,WAgClC,qBAAK5U,UAAU,QAAf,SACI,cAAC,GAAD,CACI+lC,WAAYn6B,KAAeg9B,oBAC3B9C,SAAUlxB,EAAWN,GACrB4E,MAAOtE,EAAWC,UAClB7U,UAAU,kBACVqoC,WApCgB,SAACvvC,EAAYkT,EAAkBC,EAAgB85B,EAA4BD,GACvGiD,EAAkBjwC,EAAMkT,EAAUC,EAAQ85B,EAAYnxB,EAAYkxB,a,iBHrCrEuF,O,eAAAA,I,uBAAAA,I,4BAAAA,Q,KAWL,IITKmB,GJuFUC,GA9EI,SAACruC,GAAkB,IAAD,IAC3BoP,EAAUC,cACV6M,EAAW4Q,cAFgB,EAGF9sB,EAAxBsuC,cAH0B,MAGjBrB,GAAOvlB,KAHU,EAI3B1R,EAAc0P,YAAY6R,GAA+Bv3B,EAAMoI,YAC/DkqB,EAAStc,EAAY,GALM,EAMuBgH,mBAAQ,OAASsV,QAAT,IAASA,OAAT,EAASA,EAAQpc,IANhD,mBAM1BmhB,EAN0B,KAMJkX,EANI,KAQ3BhmC,EAAQgsB,GAASv0B,EAAMoI,WACvBomC,EAAsB,OAAGjmC,QAAH,IAAGA,GAAH,UAAGA,EAAO5F,aAAV,aAAG,EAAc6rC,uBAEvCC,EAA2B,SAAC9gC,GAC9B4gC,EAAwB5gC,IAGtB+gC,EAA4B,WAC9BxyB,EAAShT,aAA+BlJ,EAAMoI,aAUlD,OAPAmV,qBAAU,WACDvH,EAAYvQ,QAGb2J,EAAQ9R,KAAK8L,iBAElB,CAAC4M,EAAYvQ,OAAQ2J,IACnB4G,EAAYvQ,OAGb,eAAC,GAAD,CAAgC2C,UAAWpI,EAAMoI,UAAjD,WACW,OAALG,QAAK,IAALA,GAAA,UAAAA,EAAO5F,aAAP,eAAcsG,SAAU,cAAC,GAAD,CAAWb,UAAWpI,EAAMoI,UAAWivB,qBAAsBA,IACvF,sBAAKz1B,UAAS,kCAA6BqrC,GAAOqB,IAAlD,UACI,sBAAK1sC,UAAU,aAAf,UACI,cAAC,GAAD,CACIwG,UAAWpI,EAAMoI,UACjBu1B,gBAAiBtG,EACjB2P,iBAAkByH,IAEpBD,GAA0D,cAAhCA,EAAuB/zC,MAC/C,qBAAKmH,UAAU,QAAQ4N,QAASk/B,EAAhC,SACI,cAAC,GAAD,CACIlG,UAAWgG,EAAuB/F,UAClC96B,aAAc0pB,EACdnP,QAASwmB,MAInBF,GAA0D,cAAhCA,EAAuB/zC,MAC/C,qBAAKmH,UAAU,QAAQ4N,QAASk/B,EAAhC,SACI,cAAC,GAAD,CACIzF,UAAWuF,EAAuBvF,UAClCt7B,aAAc0pB,EACdnP,QAASwmB,SAKzB,sBAAK9sC,UAAU,aAAf,UACI,cAAC,GAAD,CACIoU,YAAaA,EACbqhB,qBAAsBA,EACtBD,wBAAyBqX,EACzB/d,cAAqC9Z,IAA3B43B,IAEd,qBAAK5sC,UAAU,qBAAf,SACMy1B,GACE,cAAC,GAAD,CACI1pB,aAAc0pB,EACdjvB,UAAWpI,EAAMoI,uBA1Cb,MKsBrBumC,I,OA3DG,WACd,IAAMC,EAAcrsB,iBAAuB,MACrCrC,EAAQC,YAAa,UAAyB/W,cAAzB,gBACrB0rB,EAAiB,OAAG5U,QAAH,IAAGA,OAAH,EAAGA,EAAOG,OAAOwuB,UAClCz/B,EAAUC,cAEhBkO,qBAAU,WACNhb,IAAa0iB,SAAS,cAAe,oCAAoC,WACrE1iB,IAAaqM,UAAU,cAAezM,IAAQK,OAAO,EAAMJ,IAAQ6C,MAAM,QAE9E,IA8BH,OACI,sBAAKrD,UAAU,aAAagf,IAAKguB,EAAjC,UAII,cAAC,GAAD,CACI9Z,kBAAmBA,EAEnBD,SAA+B,MAArBC,EACVkB,aAtBa,SAAC5tB,GAIlBgH,EAAQ9R,KAAK+L,YAAajB,IAE9B7F,IAAaqM,UAAU,mBAiBfgmB,qBAduB,WAC/B,OAAOga,KAeD9Z,GACE,cAAC,GAAD,CAAY1sB,UAAW0sB,S,iBDnDlCsZ,O,aAAAA,I,eAAAA,I,kBAAAA,Q,KAeL,IE7BYlmC,GCFA4mC,GHmIGC,GApGG,WAAO,IAAD,EAEY/xB,oBAAS,GAFrB,mBAEbgyB,EAFa,KAEHC,EAFG,OAGsBjyB,mBAAkC,OAHxD,mBAGbkyB,EAHa,KAGEC,EAHF,KAKdC,E3B5BM1pB,aAAoC,SAAA/O,GAAK,OAAIA,EAAMvB,O2B6BzDi6B,ErDUyB,WAC/B,IAAMC,EAAoB7hB,mBAAQ,kBAAMkG,GACpC,CAACM,GAAeE,KAChB,SAACob,EAAiBC,GAAlB,OAA8CD,EAAM5rC,QAAO,SAACH,EAAWiN,GAAZ,OAA8B++B,EAAS/+B,KAAWgc,GAAY6H,eAC1H,IACH,OAAO5O,YAAkC4pB,GqDfhBG,GACnBj7B,EAAWk7B,cAEjBnyB,qBAAU,WACF/I,EAASm7B,WAAarmC,cAI1B+lC,EAAiBh0C,SAAQ,SAAA64B,GACjB1f,EAASm7B,WAAatmC,YAAa6qB,IACnCib,EAAiB,SAAD,OAAUjb,OAL9Bib,EAAiB,UAQtB,CAACE,EAAkB76B,IAEtB,IAAMo7B,EAA8B,CAAC,CACjC9hB,MAAO50B,IAAYiB,IAAI,kBACvB48B,MAAO,MACP8Y,QAASzB,GAAYzuC,KACtB,CACCmuB,MAAO50B,IAAYiB,IAAI,mBACvB48B,MAAO,OACP8Y,QAASzB,GAAY0B,OAWzBT,EAAiBh0C,SAAQ,SAAC+M,GACtBwnC,EAAStyC,KAAK,CACVsY,eAAgBxN,EAChB0lB,MAAO50B,IAAY+8B,cAAc7tB,GACjC2uB,MAAM,SAAD,OAAW3uB,GAChBynC,QAASzB,GAAY7lC,WAI7B,IAAIwnC,EAA6B,GAC3BC,EAAaJ,EAASt5B,MAAK,SAACgpB,GAAD,OAAOA,EAAEvI,QAAUmY,KAEpD,cAAQc,QAAR,IAAQA,OAAR,EAAQA,EAAYH,SAChB,KAAKzB,GAAYzuC,IAEbowC,EAAiBX,EACjB,MAEJ,KAAKhB,GAAY0B,KAEbC,EAAiBX,EAAWzrC,QAAO,SAACssC,GAAD,OAAQA,EAAGlsC,UAAY0L,KAAWqgC,QACrE,MAEJ,KAAK1B,GAAY7lC,MAEbwnC,EAAiBX,EAAWzrC,QAAO,SAACssC,GAAD,OAAQA,EAAGlsC,UAAY0L,KAAWlH,OAAS0nC,EAAGr6B,iBAAmBo6B,EAAWp6B,kBAavH,OACI,sBAAKhU,UAAS,aAAQotC,EAAW,YAAc,IAA/C,UACI,sBAAKptC,UAAU,UAAf,UACI,cAAC,GAAD,CAAUA,UAAU,OAAOo1B,cAjDb,SAACD,GACvBoY,EAAiBpY,IAgDoDL,UAAWwY,EAAxE,SACKU,EAASxsC,KAAI,SAAC8sC,GACX,OAAO,cAAC,GAAD,CAAKh6B,GAAIg6B,EAAInZ,MAAb,SAAqCmZ,EAAIpiB,OAAhBoiB,EAAInZ,YAG5C,cAAC,GAAD,CACIn1B,UAAU,gBACV4N,QApDS,WACrBy/B,GAAaD,IAoDD1nB,QAAQ,EACRjgB,KAAK,SACLkgB,KAAMynB,EAAW,SAAM,cAG/B,qBAAKptC,UAAU,cAAf,SACKmuC,EAAe3sC,KAAI,SAACyS,GAAD,OA1BT,SAACs6B,GACpB,IAAM5oB,EAAOruB,IAAYiB,IAAIg2C,EAAS12C,IAAK02C,EAASz2C,SACpD,OACI,qBAAKkI,UAAU,QAAf,SACK2lB,GADuB4oB,EAASpzC,MAuBFqzC,CAAev6B,YE9GvD,SAASw6B,GAAUC,EACA91C,EAAcyiC,EAAgBlgC,EAAcwzC,GAClE,MAAO,CACH91C,KAAMyN,GAAWnD,MACjBurC,WACA91C,OACAyiC,SACAlgC,OACAwzC,aElBO,SAASC,GAAiD31C,GACrE,IAAM41C,EAAoBhc,uBACtB,SAACjU,GAAD,OAAuBA,EAAMR,WAAWnlB,KACxC,CAACA,IAEL,OAAO6qB,YAA2B+qB,I,SFR1BvoC,K,kBAAAA,E,sBAAAA,Q,cCFA4mC,O,mCAAAA,I,uCAAAA,I,yBAAAA,I,0BAAAA,Q,KEgBZ,I,MAyCe4B,GAzCK,SAAC1wC,GAAkB,IAC3B6qB,EAAS7qB,EAAT6qB,KACF3O,EAAW4Q,cAEXjvB,EAAOwzB,KACPsf,EAAsB/1C,YAAciwB,EAAKhwB,WACzC+1C,EAAaD,EAAoB/yC,KAAKC,MAAQ,GAAKA,EAGnD6yB,IAFsB8f,GAAkB3lB,EAAKhwB,WACZ2lB,QAAU9E,EAAe+E,YAC/BmwB,EAC3B7iB,EAAU70B,IAAY80B,eAAenD,EAAKnwB,MAE1Cm2C,EAA0B,SAACh2C,GAE7BqhB,EAASlE,aAAa24B,EAAoB/yC,KAAKC,MAAQ,IACvDqe,ErFFD,SAAgCrhB,GACnC,MAAO,CACHJ,KAAMyN,GAAW4oC,uBACjBj2C,aqFDSi2C,CAAuBj2C,IAEhC,IAAM01C,EAAY,CAAE5mB,GAAwB9uB,IACtCkC,EAAO4zC,EAAoB/yC,KAAKb,KAChCgI,EAAQsrC,GAAUvB,GAASiC,eAAV,UAChBl2C,EADgB,UAEnB,OACAkC,EACAwzC,GACJr0B,EAASnX,IAEb,OACI,gCACMgpB,GAAY,mBAAGnsB,UAAU,UAAb,oBAA4BmsB,EAA5B,OACd,eAAC,GAAD,CACI2C,SAAUA,EACVrpB,KAAK,QACLmI,QAAS,kBAAMqhC,EAAwBhmB,EAAKhwB,YAHhD,iCAK0B81C,EAAoB/yC,KAAKC,KALnD,gB,SCzCNmzC,IAA4D,sBAC7D/3C,KAAK+R,aAAe,CACjBtQ,KAAMzB,KAAK+R,aACXimC,cAAe,EACfrzC,KAAM,CACF6F,UAAW,CAAE/E,KAAM,GAAIE,KAAM,GAC7B7B,KAAMA,QANgD,gBAS7D9D,KAAKkS,SAAW,CACbzQ,KAAMzB,KAAKkS,SACXvN,KAAM,CACF6F,UAAW,CAAE/E,KAAM,GAAIE,KAAM,GAC7B7B,KAAMA,QAbgD,gBAgB7D9D,KAAKsS,UAAY,CACd7Q,KAAMzB,KAAKsS,UACX3N,KAAM,CACF6F,UAAW,CAAE/E,KAAM,GAAIE,KAAM,GAC7B7B,KAAMA,QApBgD,gBAuB7D9D,KAAKwS,gBAAkB,CACpB/Q,KAAMzB,KAAKwS,gBACXwlC,cAAe,EACfrzC,KAAM,CACF6F,UAAW,CAAE/E,KAAM,GAAIE,KAAM,GAC7B7B,KAAMA,QA5BgD,gBA+B7D9D,KAAKyS,cAAgB,CAClBhR,KAAMzB,KAAKyS,cACX9N,KAAM,CACF6F,UAAW,CAAE/E,KAAM,GAAIE,KAAM,GAC7B7B,KAAMA,QAnCgD,gBAsC7D9D,KAAKiU,eAAiB,CACnBxS,KAAMzB,KAAKiU,eACXtP,KAAM,CACF6F,UAAW,CAAE/E,KAAM,GAAIE,KAAM,GAC7B7B,KAAMA,QA1CgD,gBA6C7D9D,KAAK2S,QAAU,CACZlR,KAAMzB,KAAK2S,QACXhO,KAAM,CACF6F,UAAW,CAAE/E,KAAM,GAAIE,KAAM,IAC7B7B,KAAMA,QAjDgD,gBAoD7D9D,KAAKgR,KAAO,CACTvP,KAAMzB,KAAKgR,KACXrM,KAAM,CACF6F,UAAW,CAAE/E,KAAM,IACnB3B,KAAMA,QAxDgD,gBA2D7D9D,KAAK4S,OAAS,CACXnR,KAAMzB,KAAK4S,OACXjO,KAAM,CACF6F,UAAW,CAAE/E,KAAM,GAAIE,KAAM,IAC7B7B,KAAMA,QA/DgD,gBAkE7D9D,KAAKsR,MAAQ,CACV7P,KAAMzB,KAAKsR,MACX3M,KAAM,CACF6F,UAAW,CAAE/E,KAAM,GAAIE,KAAM,IAC7B7B,KAAMA,QAtEgD,gBAyE7D9D,KAAKgT,aAAe,CACjBvR,KAAMzB,KAAKgT,aACXglC,cAAe,EACfrzC,KAAM,CACF6F,UAAW,CAAE/E,KAAM,GAAIE,KAAM,GAC7B7B,KAAMA,QA9EgD,gBAiF7D9D,KAAKsT,QAAU,CACZ7R,KAAMzB,KAAKsT,QACX3O,KAAM,CACF6F,UAAW,CAAE/E,KAAM,GAAIE,KAAM,IAC7B7B,KAAMA,KAAgBA,QArFgC,gBAwF7D9D,KAAKuT,QAAU,CACZ9R,KAAMzB,KAAKuT,QACX5O,KAAM,CACF6F,UAAW,CAAE/E,KAAM,GAAIE,KAAM,IAC7B7B,KAAOA,QA5F+C,gBA+F7D9D,KAAKyT,QAAU,CACZhS,KAAMzB,KAAKyT,QACX9O,KAAM,CACF6F,UAAW,CAAE/E,KAAM,GAAIE,KAAM,GAC7B7B,KAAMA,QAnGgD,gBAsG7D9D,KAAK0T,KAAO,CACTjS,KAAMzB,KAAK0T,KACX/O,KAAM,CACF6F,UAAW,CAAE/E,KAAM,GAAIE,KAAM,IAC7B7B,KAAMA,QA1GgD,gBA6G7D9D,KAAK2T,YAAc,CAChBlS,KAAMzB,KAAK2T,YACXhP,KAAM,CACF6F,UAAW,CAAE/E,KAAM,GAAIE,KAAM,IAC7B7B,KAAMA,QAjHgD,gBAoH7D9D,KAAK4T,eAAiB,CACnBnS,KAAMzB,KAAK4T,eACXjP,KAAM,CACF6F,UAAW,CAAE/E,KAAM,GAAIE,KAAM,IAC7B7B,KAAMA,KAAgBA,QAxHgC,gBA2H7D9D,KAAKuG,eAAiB,CACnB9E,KAAMzB,KAAKuG,eACX5B,KAAM,CACF6F,UAAW,CAAE/E,KAAM,GAAIE,KAAM,IAC7BoV,UAAW,CAAE/a,KAAK0Y,YAClB5U,KAAMA,QAhIgD,gBAmI7D9D,KAAK8T,WAAa,CACfrS,KAAMzB,KAAK8T,WACXnP,KAAM,CACF6F,UAAW,CAAE/E,KAAM,GAAIE,KAAM,GAAIJ,KAAM,GACvCzB,KAAMA,QAvIgD,gBA0I7D9D,KAAKgU,YAAc,CAChBvS,KAAMzB,KAAKgU,YACXrP,KAAM,CACF6F,UAAW,CAAE/E,KAAM,GAAIE,KAAM,GAAIJ,KAAM,GACvCzB,KAAMA,QA9IgD,gBAiJ7D9D,KAAKkU,MAAQ,CACVzS,KAAMzB,KAAKkU,MACXvP,KAAM,CACF6F,UAAW,CAAE/E,KAAM,GAAIE,KAAM,IAC7B7B,KAAMA,QArJgD,gBAwJ7D9D,KAAKmU,YAAc,CAChB1S,KAAMzB,KAAKmU,YACXxP,KAAM,CACF6F,UAAW,CAAE/E,KAAM,GAAIE,KAAM,IAC7B7B,KAAMA,QA5JgD,gBA+J7D9D,KAAKoU,WAAa,CACf3S,KAAMzB,KAAKoU,WACXzP,KAAM,CACF6F,UAAW,CAAE/E,KAAM,GAAIE,KAAM,IAC7B7B,KAAOA,QAnK+C,gBAsK7D9D,KAAKqU,UAAY,CACd5S,KAAMzB,KAAKqU,UACX1P,KAAM,CACF6F,UAAW,CAAE/E,KAAM,GAAIE,KAAM,IAC7B7B,KAAOA,QA1K+C,gBA6K7D9D,KAAKsU,cAAgB,CAClB7S,KAAMzB,KAAKsU,cACX3P,KAAM,CACF6F,UAAW,CAAE/E,KAAM,GAAIE,KAAM,IAC7B7B,KAAOA,QAjL+C,IAqLnDi0C,MCpLf,I,GCOYE,GDoVGC,IA3VqD,sBAC/Dl4C,KAAKkF,OAAS,CACXzD,KAAMzB,KAAKkF,OACXP,KAAM,CACF6F,UAAW,CACP/E,KAAM,GACNE,KAAM,IAEV7B,KAAMA,QARkD,gBAW/D9D,KAAKuf,OAAS,CACX9d,KAAMzB,KAAKuf,OACX5a,KAAM,CACF6F,UAAW,CACP/E,KAAM,GACNE,KAAM,IAEV7B,KAAMA,MAEVk0C,cAAe,IApB6C,gBAsB/Dh4C,KAAKyf,OAAS,CACXhe,KAAMzB,KAAKyf,OACX9a,KAAM,CACF6F,UAAW,CACP/E,KAAM,GACNE,KAAM,IAEV7B,KAAMA,MAEVk0C,cAAe,IA/B6C,gBAiC/Dh4C,KAAK0f,cAAgB,CAClBje,KAAMzB,KAAK0f,cACX/a,KAAM,CACF6F,UAAW,CACP/E,KAAM,GACNE,KAAM,IAEV7B,KAAMA,QAxCkD,gBA2C/D9D,KAAKmF,MAAQ,CACV1D,KAAMzB,KAAKmF,MACXR,KAAM,CACF6F,UAAW,CACP/E,KAAM,GACNE,KAAM,IAEV7B,KAAMA,QAlDkD,gBAqD/D9D,KAAK2f,YAAc,CAChBle,KAAMzB,KAAK2f,YACXhb,KAAM,CACF6F,UAAW,CACP/E,KAAM,GACNE,KAAM,IAEV7B,KAAMA,QA5DkD,gBA+D/D9D,KAAKoF,KAAO,CACT3D,KAAMzB,KAAKoF,KACXT,KAAM,CACF6F,UAAW,CACP/E,KAAM,GACNE,KAAM,IAEV7B,KAAMA,QAtEkD,gBAyE/D9D,KAAK4f,WAAa,CACfne,KAAMzB,KAAK6f,WACXlb,KAAM,CACF6F,UAAW,CACP/E,KAAM,GACNE,KAAM,IAEV7B,KAAMA,MAEVk0C,cAAe,IAlF6C,gBAoF/Dh4C,KAAK8f,UAAY,CACdre,KAAMzB,KAAK8f,UACXnb,KAAM,CACF6F,UAAW,CACP/E,KAAM,GACNE,KAAM,IAEV7B,KAAMA,MAEVk0C,cAAe,IA7F6C,gBA+F/Dh4C,KAAK6f,WAAa,CACfpe,KAAMzB,KAAK6f,WACXlb,KAAM,CACF6F,UAAW,CACP/E,KAAM,GACNE,KAAM,IAEV7B,KAAMA,MAEVk0C,cAAe,IAxG6C,gBA0G/Dh4C,KAAK+f,UAAY,CACdte,KAAMzB,KAAK+f,UACXpb,KAAM,CACF6F,UAAW,CACP/E,KAAM,GACNE,KAAM,IAEV7B,KAAMA,MAEVk0C,cAAe,IAnH6C,gBAqH/Dh4C,KAAKggB,UAAY,CACdve,KAAMzB,KAAKggB,UACXrb,KAAM,CACF6F,UAAW,CACP/E,KAAM,GACNE,KAAM,IAEV7B,KAAMA,MAEVk0C,cAAe,IA9H6C,gBAgI/Dh4C,KAAKigB,OAAS,CACXxe,KAAMzB,KAAKigB,OACXtb,KAAM,CACF6F,UAAW,CACP/E,KAAM,GACNE,KAAM,IAEV7B,KAAMA,QAvIkD,gBA0I/D9D,KAAKkgB,SAAW,CACbze,KAAMzB,KAAKkgB,SACXvb,KAAM,CACF6F,UAAW,CACP/E,KAAM,GACNE,KAAM,IAEV7B,KAAMA,QAjJkD,gBAoJ/D9D,KAAKmgB,SAAW,CACb1e,KAAMzB,KAAKmgB,SACXxb,KAAM,CACF6F,UAAW,CACP/E,KAAM,GACNE,KAAM,IAEV7B,KAAMA,QA3JkD,gBA8J/D9D,KAAKogB,aAAe,CACjB3e,KAAMzB,KAAKogB,aACXzb,KAAM,CACF6F,UAAW,CACP/E,KAAM,GACNE,KAAM,IAEV7B,KAAMA,QArKkD,gBAwK/D9D,KAAKqgB,cAAgB,CAClB5e,KAAMzB,KAAKqgB,cACX1b,KAAM,CACF6F,UAAW,CACP/E,KAAM,GACNE,KAAM,IAEV7B,KAAMA,QA/KkD,gBAkL/D9D,KAAKsgB,YAAc,CAChB7e,KAAMzB,KAAKsgB,YACX3b,KAAM,CACF6F,UAAW,CACP/E,KAAM,GACNE,KAAM,IAEV7B,KAAMA,QAzLkD,gBA4L/D9D,KAAKugB,OAAS,CACX9e,KAAMzB,KAAKugB,OACX5b,KAAM,CACF6F,UAAW,CACP/E,KAAM,GACNE,KAAM,IAEV7B,KAAMA,QAnMkD,gBAsM/D9D,KAAKwgB,OAAS,CACX/e,KAAMzB,KAAKwgB,OACX7b,KAAM,CACF6F,UAAW,CACP/E,KAAM,GACNE,KAAM,IAEV7B,KAAMA,QA7MkD,gBAgN/D9D,KAAKygB,YAAc,CAChBhf,KAAMzB,KAAKygB,YACX9b,KAAM,CACF6F,UAAW,CACP/E,KAAM,GACNE,KAAM,IAEV7B,KAAMA,QAvNkD,gBA0N/D9D,KAAK0gB,YAAc,CAChBjf,KAAMzB,KAAK0gB,YACX/b,KAAM,CACF6F,UAAW,CACP/E,KAAM,GACNE,KAAM,IAEV7B,KAAMA,QAjOkD,gBAoO/D9D,KAAK2gB,YAAc,CAChBlf,KAAMzB,KAAK2gB,YACXhc,KAAM,CACF6F,UAAW,CACP/E,KAAM,GACNE,KAAM,IAEV7B,KAAMA,QA3OkD,gBA8O/D9D,KAAK4gB,YAAc,CAChBnf,KAAMzB,KAAK4gB,YACXjc,KAAM,CACF6F,UAAW,CACP/E,KAAM,GACNE,KAAM,IAEV7B,KAAMA,QArPkD,gBAwP/D9D,KAAK6gB,aAAe,CACjBpf,KAAMzB,KAAK6gB,aACXlc,KAAM,CACF6F,UAAW,CACP/E,KAAM,GACNE,KAAM,IAEV7B,KAAMA,QA/PkD,gBAkQ/D9D,KAAK8gB,aAAe,CACjBrf,KAAMzB,KAAK8gB,aACXnc,KAAM,CACF6F,UAAW,CACP/E,KAAM,GACNE,KAAM,IAEV7B,KAAMA,QAzQkD,gBA4Q/D9D,KAAK+gB,YAAc,CAChBtf,KAAMzB,KAAK+gB,YACXpc,KAAM,CACF6F,UAAW,CACP/E,KAAM,GACNE,KAAM,IAEV7B,KAAMA,QAnRkD,gBAsR/D9D,KAAKghB,WAAa,CACfvf,KAAMzB,KAAKghB,WACXrc,KAAM,CACF6F,UAAW,CACP/E,KAAM,GACNE,KAAM,IAEV7B,KAAMA,QA7RkD,gBAgS/D9D,KAAKihB,gBAAkB,CACpBxf,KAAMzB,KAAKihB,gBACXtc,KAAM,CACF6F,UAAW,CACP/E,KAAM,GACNE,KAAM,IAEV7B,KAAMA,QAvSkD,gBA0S/D9D,KAAKmhB,gBAAkB,CACpB1f,KAAMzB,KAAKmhB,gBACXxc,KAAM,CACF6F,UAAW,CACP/E,KAAM,GACNE,KAAM,IAEV7B,KAAMA,QAjTkD,gBAoT/D9D,KAAKohB,KAAO,CACT3f,KAAMzB,KAAKohB,KACXzc,KAAM,CACF6F,UAAW,CAAE/E,KAAM,GAAIE,KAAM,IAC7B7B,KAAMA,QAxTkD,gBA2T/D9D,KAAKqhB,WAAa,CACf5f,KAAMzB,KAAKqhB,WACX1c,KAAM,CACF6F,UAAW,CAAE/E,KAAM,GAAIE,KAAM,IAC7B7B,KAAMA,QA/TkD,gBAmU/D9D,KAAKshB,WAAa,CACf7f,KAAMzB,KAAKshB,WACX3c,KAAM,CACF6F,UAAW,CAAE/E,KAAM,GAAIE,KAAM,IAC7B7B,KAAMA,QAvUkD,gBA2U/D9D,KAAKuhB,WAAa,CACf9f,KAAMzB,KAAKuhB,WACX5c,KAAM,CACF6F,UAAW,CAAE/E,KAAM,GAAIE,KAAM,IAC7B7B,KAAMA,QA/UkD,gBAmV/D9D,KAAKwhB,KAAO,CACT/f,KAAMzB,KAAKwhB,KACX7c,KAAM,CACF6F,UAAW,CAAE/E,KAAM,GAAIE,KAAM,IAC7B7B,KAAMA,QAvVkD,IEgBrDq0C,IAhBgD,sBAC1Dn4C,KAAKqa,MAAQ,CACV5Y,KAAMzB,KAAKqa,MACX1V,KAAM,CACF6F,UAAW,CAAE/E,KAAM,EAAGW,OAAQ,GAC9BtC,KAAMA,QAL6C,gBAQ1D9D,KAAKka,SAAW,CACbzY,KAAMzB,KAAKka,SACXvV,KAAM,CACF6F,UAAW,CAAEjF,KAAM,GACnBzB,KAAMA,KAAkB,KAZ2B,ICChDs0C,GAFoD,GCoB7D1xC,GAAG,mDACF0xC,IACAF,IACAH,IACAI,IAGMx2C,GAAgB,SAACF,GAC1B,OAAOiF,GAAIjF,IC7BT42C,GAAW,SAAC9wB,GAAD,OAAuBA,EAAM+wB,OCOjCC,GAAmC,SAAC32C,GAC7C,OAAO6qB,YDJyC,SAAC7qB,GAIjD,OAAO02B,aAAe,CAClB+f,KAJ6B,SAACC,GAC9B,OAAOA,EAAME,QAAQ9tC,QAAO,SAACi0B,GAAD,OAASA,EAAIqF,SAAJ,UAAkBpiC,EAAlB,gBCEtB62C,CAAqC72C,KAI/C82C,GAAmC,SAAC92C,GAC7C,OAAO6qB,YDGyC,SAAC7qB,GAIjD,OAAO02B,aAAe,CAClB+f,KAJ6B,SAACC,GAC9B,OAAOA,EAAME,QAAQ9tC,QAAO,SAACi0B,GAAD,OAASA,EAAIqF,SAAJ,UAAkBpiC,EAAlB,gBCLtB+2C,CAAqC/2C,KAI/Cg3C,GAAkC,SAACh3C,GAC5C,OAAO6qB,YDWwC,SAAC7qB,GAIhD,OAAO02B,aAAe,CAClB+f,KAJ4B,SAACC,GAC7B,OAAOA,EAAME,QAAQ9tC,QAAO,SAACi0B,GAAD,OAASA,EAAIp9B,OAAJ,UAAgBK,EAAhB,kBCbtBi3C,CAAoCj3C,KCrB9Ck3C,GAAah1C,KCqCpBi1C,GAAsB,SAAChyC,GAA4C,IAC9DnF,EAAamF,EAAbnF,UACD8zB,EAAgD6hB,GAAkB31C,GAClEo3C,EAAaN,GAAiC92C,GAC9CqhB,EAAW4Q,cAEjB,IAAKjyB,EACD,OAAO,KAKX,GAAI8zB,EAAeujB,SAASv1B,MAAK,SAACjiB,GAAD,OAAgBA,IAASsF,EAAMtF,QAC5D,OACI,oDACI,cAAC,IAAD,CAAMyK,GAAIoE,YAAiB1O,GAA3B,SACM3B,IAAYqnB,iBAAiB1lB,QAO/C,IAAMs3C,EAAOF,EAAW37B,MAAK,SAAA87B,GAAE,OAAIA,EAAG53C,OAASwF,EAAMtF,QACrD,GAAIy3C,EACA,OACI,8BACI,cAAC,IAAD,CAAMhtC,GAAIoE,YAAiB1O,GAA3B,SACK3B,IAAYiB,IAAI,yCAEpBsC,aAAe01C,EAAKE,eAAe,MAMhD,IAAMC,EAAuBC,GAAwBvyC,EAAMtF,MAC3D,GAAIi0B,EAAeE,OAASyjB,EAAqBrB,eAAiB,IAAMtiB,EAAenO,QAAU9E,EAAe6R,MAE5G,OACI,mBAAG3rB,UAAU,UAAb,SACK1I,IAAYiB,IAAI,4CAA6C,CAAEU,YAAWg0B,OAAQyjB,EAAqBrB,eAAiB,GAAK,MAmB1I,OACI,4BACI,cAAC,GAAD,CAAQzhC,QAhBG,WACf,IAAM+gC,EAAY,CACdxmB,GAAoB/pB,EAAMnF,UAAWmF,EAAMtF,OAGzC83C,EAAYT,GACZhtC,EAAQsrC,GAAUvB,GAAS2D,UAC7BzyC,EAAMtF,KADa,UAEhBG,EAFgB,UAGnB23C,EACAjC,GACJr0B,EAASnX,IAKwBsC,KAAK,QAAlC,SACKnO,IAAYiB,IAAI,qCAMlBu4C,GArFQ,SAAC1yC,GACpB,IJf0CtF,EIepCG,GJfoCH,EIeMsF,EAAMtF,KJdlD22C,GAAoB32C,GACb8C,IAAUC,UAEjB0zC,GAAsBz2C,GACf8C,IAAUU,YAEjB8yC,GAAsBt2C,GACf8C,IAAU+B,YAEjB6xC,GAAmB12C,GACZ8C,IAAUkC,SAEd,MIIP,OADuBizC,aAAkB3yC,EAAMtF,MAC5ByR,OAEX,4CAGHtR,EAID,cAAC,GAAD,CAAqBH,KAAMsF,EAAMtF,KAAMG,UAAWA,IAH3C,MCHA+3C,GApBO,SAAC5yC,GAAkB,IAC7B6qB,EAAS7qB,EAAT6qB,KACFkD,EAAU70B,IAAY80B,eAAenD,EAAKnwB,MAC1CuG,EAAa/H,IAAY25C,cAAchoB,EAAK5pB,YAC1CC,EAAmBF,KAAqB6pB,EAAK5pB,YAA7CC,eACF4xC,EAAqB55C,IAAY65C,wBAAwB7xC,GAE/D,OACI,qCACI,gCAAMD,EACH4pB,EAAK5pB,aAAejG,KAAWoG,QAA/B,YAA+C0xC,EAA/C,QAED/kB,GAAY,mBAAGnsB,UAAU,UAAb,oBAA4BmsB,EAA5B,OACZlD,EAAKxf,QAAU,0CAAcwf,EAAKxf,OAAO1B,KAAW2B,SAArC,OACjB,cAAC,GAAD,CAAgB5Q,KAAMmwB,EAAKnwB,WCCxBs4C,GAfQ,SAAChzC,GAAkB,IAC9B6qB,EAAS7qB,EAAT6qB,KACApS,EAAoBoS,EAApBpS,gBACFsV,EAAU70B,IAAY80B,eAAenD,EAAKnwB,MAC1CuT,EAAgB/U,IAAY60C,iBAAiBljB,EAAK7oB,eACxD,OACI,qCACI,wCAASiM,KACP8f,GAAY,mBAAGnsB,UAAU,UAAb,oBAA4BmsB,EAA5B,OACZtV,GAAmB,kCAAMvf,IAAYiB,IAAI,8BAA+B,CAAEse,oBAAvD,OACrB,cAAC,GAAD,CAAgB/d,KAAMmwB,EAAKnwB,WCexBu4C,I,OAnBK,SAACjzC,GAEjB,IAAM6qB,EAAO7qB,EAAM6qB,KACnB,OAAQA,EAAKlwB,UACT,KAAK3B,KAAS+X,KACX,OAAO,cAAC,GAAD,CAAa8Z,KAAMA,IAE7B,KAAK7xB,KAAS+H,OACV,OAAO,cAAC,GAAD,CAAe8pB,KAAMA,IAEhC,KAAK7xB,KAASiJ,QACV,OAAO,cAAC,GAAD,CAAgB4oB,KAAMA,IAEjC,QACI,IAAMkD,EAAU70B,IAAY80B,eAAenD,EAAKnwB,MAChD,OAAQqzB,GAAY,mBAAGnsB,UAAU,UAAb,oBAA4BmsB,EAA5B,QAAiD,QCgGlEmlB,I,OAzGS,SAAClzC,GAErB,IAAMrE,EAAWqE,EAAM6qB,KACjBsoB,EAAiB3hB,KACjBI,EAAYP,KACZ+hB,E9EpBC1tB,aAAgC,SAAA/O,GAAK,OAAIA,EAAMmT,W8EqBhDupB,EAAmB3hB,KACnB4hB,EAAkB5tB,aAA8C,SAAA/O,GAAK,OAAIA,EAAMqJ,cAC/E5gB,EhFjBCsmB,YAA4C4L,IgFkDnD,OAAQ31B,GACJ,KAAKkE,KAASR,OACd,KAAKQ,KAASrB,KACd,KAAKqB,KAASjB,KACd,KAAKiB,KAASb,QACd,KAAKa,KAASf,MACd,KAAKe,KAASnB,KACV,IAAM5B,EAAS6zB,GAAawiB,EAAex3C,GAAY,GACjD43C,EAAOJ,EAAex3C,IAAcyD,EAAazD,GACvD,OACI,sBAAKiG,UAAU,mBAAf,UACI,qBAAKA,UAAU,OAAf,SACK1I,IAAYiB,IAAZ,mBAA4BwB,EAA5B,YAEL,8BACKzC,IAAYiB,IAAZ,+BAAgD,CAAE2C,aAEvD,8BAhDS,WACrB,IAAMjC,EAAY+E,YAAuBjE,GACnC63C,EAAsCF,EAAgBz4C,GAC5D,GAAI24C,EAAehzB,QAAU9E,EAAe6R,MACxC,OACI,+BACKr0B,IAAYiB,IAAI,2CAA4C,CACzDU,UAAW3B,IAAYqnB,iBAAiB1lB,OAKxD,IAEMiC,EAFsBlC,YAA2CC,GACOiD,OAAO01C,EAAe3kB,OACrEtwB,UAAU5C,GAEnC0f,EAAQniB,IAAYiB,IAAI,kCAAmC,CAC7DU,UAAW,UACXiC,WACDue,MAAM,WACT,OACI,uBAAMzZ,UAAU,WAAhB,UACKyZ,EAAM,GACP,cAAC,IAAD,CAAMlW,GAAIoE,YAAiB1O,GAA3B,SACM3B,IAAYqnB,iBAAiB1lB,KAElCwgB,EAAM,MAuBEo4B,KAEHF,GACE,qBAAK3xC,UAAU,eAAf,SACK1I,IAAYiB,IAAZ,qCAAsD,CAAEwB,kBAM7E,IAAK,OACD,IAAMmB,EAAS80B,EACf,OACI,qCACI,qBAAKhwB,UAAU,mBAAf,SACI,qBAAKA,UAAU,OAAf,oBACS1I,IAAYiB,IAAZ,mBAA4BwB,EAA5B,eAGb,8BACKzC,IAAYiB,IAAZ,+BAAgD,CAAE2C,gBAKnE,IAAK,UACD,IAAM42C,EAAOL,EACPM,EAAQP,EACd,OACI,qCACI,qBAAKxxC,UAAU,mBAAf,SACG,qBAAKA,UAAU,OAAf,oBACM1I,IAAYiB,IAAZ,mBAA4BwB,EAA5B,eAGT,8BACKzC,IAAYiB,IAAZ,8BAA+C,CAAEu5C,OAAMC,eAKxE,QACI,MAAM,IAAI55C,MAAM,eAAiB4B,MCjHhCi4C,I,OAAa,SAAC5zC,GAA6D,IAC5E4B,EAAuC5B,EAAvC4B,UAAWG,EAA4B/B,EAA5B+B,SAAaylB,EADmD,YACpCxnB,EADoC,0BAEnF,OACI,+CACQwnB,GADR,IAEI5lB,UAAS,sBAAiBA,GAAa,IAF3C,SAIKG,O,iBZFDmvC,O,mBAAAA,I,aAAAA,I,eAAAA,I,kBAAAA,Q,KAOL,IafK3F,GbiHGsI,GAlGQ,SAAC7zC,GAAqC,IACjD+B,EAA4B/B,EAA5B+B,SAAUgpB,EAAkB/qB,EAAlB+qB,cADsC,EAE/B/qB,EAAnB4B,iBAFkD,MAEtC,GAFsC,EAGlDgf,EAAM2B,iBAAuB,MAHqB,EAItBvF,mBAAoBhd,EAAM8zC,WAAa5C,GAAUjuB,QAJ3B,mBAIjD6wB,EAJiD,KAItCC,EAJsC,OAMd/2B,qBANc,mBAMjDg3B,EANiD,KAMlCC,EANkC,KAQxD12B,qBAAU,WAEN,IAAM22B,EAAiBtzB,EAAI6B,QAC3B,GAAKyxB,GACAF,EAAL,CACA,IAAMG,EAAcD,EAAe5oB,wBAGnC,OAAQwoB,GACJ,KAAK5C,GAAU7M,IACX,GAAI8P,EAAY9P,IAAM8P,EAAYrwB,OAlC/B,EACH,EAiCkEkwB,EAAe3P,IAG7E,YADA0P,EAAa7C,GAAUjuB,QAG3B,MACJ,KAAKiuB,GAAUjuB,OACX,GAAIkxB,EAAY9P,IAAM8P,EAAYrwB,OAzC/B,EACH,EAwCkEkwB,EAAelwB,OAG7E,YADAiwB,EAAa7C,GAAU7M,KAKnC6P,EAAeryC,MAAMuyC,QAAU,IAE/B,IAAMC,EAAiBH,EAAe1Q,cAAc,oBACpD,GAAI2Q,EAAYzY,KAAOsY,EAAetY,KAlD9B,EAkD8C,CAElD,IAAM4Y,EAASN,EAAetY,KAAOyY,EAAYzY,KApD7C,EAqDJ2Y,EAAexyC,MAAMu/B,UAArB,qBAA+CkT,EAA/C,YACG,GAAIH,EAAYpxB,MAAQixB,EAAejxB,MAtDtC,EAsDuD,CAE3D,IAAMuxB,EAASH,EAAYpxB,MAAQixB,EAAejxB,MAxD9C,EAyDJsxB,EAAexyC,MAAMu/B,UAArB,sBAAgDkT,EAAhD,YAEAD,EAAexyC,MAAMu/B,UAAY,MAGtC,CAAC2S,EAAcC,EAAeF,EAAW/oB,IAE5C,IAAM5E,EAAS,WACXyE,GAAeM,SAGnB3N,qBAAU,WAAO,IAAD,IAIZ,OAHA02B,EAAgB,UAACrzB,EAAI6B,eAAL,iBAAC,EAAa8xB,QAAQ,eAAtB,aAAC,EAA8BjpB,yBAE/C7H,OAAOC,iBAAiB,SAAUyC,GAC3B,WACH1C,OAAOG,oBAAoB,SAAUuC,MAE1C,IAGH,IAAIzV,EAAI,EACJC,EAAI,EAER,GAAIqjC,EACA,OAAQF,GACJ,KAAK5C,GAAUjuB,OACXvS,EAAIqa,EAAc2Q,KAAOsY,EAAetY,KAAO3Q,EAAclH,MAAQ,EACrElT,EAAIoa,EAAcsZ,IAAM2P,EAAe3P,IAAMtZ,EAAcjH,OAC3DliB,GAAa,kBACb,MACJ,KAAKsvC,GAAU7M,IACX3zB,EAAIqa,EAAc2Q,KAAOsY,EAAetY,KAAO3Q,EAAclH,MAAQ,EACrElT,EAAIoa,EAAcsZ,IAAM2P,EAAe3P,IACvCziC,GAAa,eAKzB,OACI,sBAAKA,UAAS,kBAAaA,GACvBC,MAAO,CACH65B,KAAMhrB,EACN0jC,QAAS,EACT/P,IAAK1zB,GAETiQ,IAAKA,EANT,UAQI,qBAAKhf,UAAU,kBACf,cAAC,GAAD,CAAYA,UAAU,kBAAtB,SACKG,QcvFFyyC,I,OAjBM,SAACx0C,GAAkB,IAE7BqtC,EAAmBrtC,EAAnBqtC,gBAEP,OACI,sBAAKzrC,UAAU,gBAAf,UACI,qBAAKA,UAAU,cAAf,SACK1I,IAAYu7C,oBAAoBpH,EAAgBvyC,SAEnDuyC,EAAgBT,WAClB,qBAAKhrC,UAAU,SAAf,SACK1I,IAAYw7C,eAAerH,EAAgBvyC,cC8E7C65C,I,OAjFQ,WAAO,IAAD,EAEqB33B,qBAFrB,mBAElB43B,EAFkB,KAEDC,EAFC,KAInBC,EAAiB,SAACp7C,GACpBm7C,EAAmBn7C,IAQvB,GANA6jB,qBAAU,WAEN,OADAqN,GAAelmB,SAASuiB,YAAY0D,GAAuBmqB,GACpD,WACHlqB,GAAelmB,SAASwiB,eAAeyD,GAAuBmqB,MAEnE,KACEF,EAAmB,OAAO,KAbN,IAejB/pB,EAA0B+pB,EAA1B/pB,KAAMpwB,EAAoBm6C,EAApBn6C,KAAMmH,EAAcgzC,EAAdhzC,UA0DpB,OACI,cAAC,GAAD,CAASmpB,cAAe6pB,EAAgB7pB,cAAenpB,UAAWA,EAAlE,SACI,qBAAKA,UAAU,kBAAf,SA3Dc,WAClB,OAAQnH,GACJ,KAAK8vB,GAAY5uB,SACb,IAAMnB,EAAOtB,IAAY67C,gBAAgBlqB,GACzC,OACI,qCACI,qBAAKjpB,UAAU,gBAAf,SAAgCpH,IAChC,cAAC,GAAD,CAAiBqwB,KAAMA,OAInC,KAAKN,GAAY7vB,KACb,IAAMF,EAAOtB,IAAY2C,YAAagvB,EAAwBnwB,MACxDoG,EAAiB+pB,EACvB,OACI,qCACI,qBAAKjpB,UAAS,oBAAeozC,GAAqBl0C,IAAlD,SAAsEtG,IACtE,cAAC,GAAD,CAAaqwB,KAAM/pB,OAI/B,KAAKypB,GAAYzvB,MACb,IAAMuyC,EAAkBxiB,EAClBrwB,EAAOtB,IAAYo0C,aAAaD,EAAgBvyC,OACtD,OACI,qCACI,sBAAK8G,UAAU,aAAf,UACK1I,IAAYiB,IAAI,yBAChBK,KAEL,cAAC,GAAD,CAAc6yC,gBAAiBA,OAI3C,KAAK9iB,GAAY2gB,MACb,IAAMA,EAAQrgB,EACRrwB,EAAOtB,IAAYkyC,aAAaF,GACtC,OACI,qCACI,sBAAKtpC,UAAU,aAAf,UACK1I,IAAYiB,IAAI,yBAChBK,KAEHtB,IAAY+7C,aAAa/J,MAIvC,KAAK3gB,GAAY2qB,UAEb,OADkBrqB,EAGtB,QACI,MAAM,IAAI9wB,MAAJ,+BAAkC66C,EAAgBn6C,QAQvD06C,SAOJH,GAAuB,SAACt6C,GAEjC,OADiBA,EAAVuQ,QAEH,KAAKjE,KAAOwE,OACR,MAAO,mBACX,KAAKxE,KAAO8E,SACR,MAAO,qBACX,KAAK9E,KAAOgF,KACR,MAAO,iBACX,KAAKhF,KAAOoE,KACR,MAAO,iBACX,KAAKpE,KAAOkE,UACR,MAAO,sBAEf,MAAO,oB,SC5GEkqC,GAAY,WACrB,OAAO1vB,aAA0C,SAAA/O,GAAK,OAAIA,EAAME,Y,SHDxD00B,O,2BAAAA,I,4BAAAA,Q,KAaZ,IA6Be8J,GA7BY,SAACr1C,GAAkB,IAAD,EACiBA,EAAlD4B,iBADiC,MACrB,GADqB,EACjBksB,EAAkC9tB,EAAlC8tB,MAAO5L,EAA2BliB,EAA3BkiB,UADU,EACiBliB,EAAhB4E,gBADD,MACY,EADZ,EAEnC8mC,EAAmB1L,GAAYp7B,IAAa,EAE5CgX,EGbc,WACpB,IAAM/E,EAASu+B,KACf,OAAO3mC,KAAKC,MAAQmI,EAAOy+B,aHWbC,GAJ2B,EAQXv4B,oBAAS,GARE,mBAQlCw4B,EARkC,KAQzBC,EARyB,KAmBzC,OATAl4B,qBAAU,WACNk4B,OACmB7+B,IAAdsL,GACAA,IAAcqpB,GAAUmK,YAAc9wC,EAAW8mC,GACjDxpB,IAAcqpB,GAAUoK,YAAc/wC,EAAW8mC,KAEvD,CAACxpB,EAAWtd,IAIX,cAAC,GAAD,CACIA,SAAUA,EACVkpB,MAAOA,EACPlsB,UAAWA,EACX6pC,cAAe+J,EAAU55B,EAAQ,KI1B9Bg6B,I,OATa,SAAC51C,GAEzB,OACI,qBAAK4B,UAAS,oDAA+C5B,EAAMnF,eCuF5Dg7C,I,OAzEQ,SAAC71C,GAAkB,IAElCnF,EAGAmF,EAHAnF,UACAi7C,EAEA91C,EAFA81C,cACAC,EACA/1C,EADA+1C,oBAEE75B,EAAW4Q,cACXjvB,EAAOwzB,KAGPxC,EADiB2hB,GAAkB31C,GACJg0B,MAG/Bqd,EAFsBtxC,YAAcoF,EAAMnF,WAEViD,OAAO+wB,EAAQ,GAC/CmnB,EAA8B,MAAb9J,EAAoBA,EAAUtuC,KAAKC,MAAQ,GAAK,EACjEo4C,EAA0B,MAAb/J,GAAqBruC,GAAQm4C,EAC1CE,EAA2B,MAAbhK,EAAoBhzC,IAAYiB,IAAI,4BAA8BjB,IAAYiB,IAAI,uBAAwB,CAAEyD,KAAMo4C,EAAennB,MAAOA,EAAQ,IAE9JsnB,EAAetE,GAAgCh3C,GAsBrD,GAAIs7C,EAAa1wC,OAAQ,CACrB,IAAM65B,EAAI6W,EAAa,GACvB,OACI,cAAC,GAAD,CAEIv0C,UAAU,YACVksB,MAAK,UAAK50B,IAAYiB,IAAI,sCAArB,aAA+DsC,aAAe6iC,EAAE+S,eAAhF,KACLztC,SAAU06B,EAAE16B,UAJhB,UACY06B,EAAE9kC,MADd,OACqB8kC,EAAE8W,YAQ/B,OACI,sBAAKx0C,UAAU,0BAAf,UACI,kCACK1I,IAAYiB,IAAI,sBACf00B,EAAQ,KAEd,cAAC,GAAD,CACIjtB,UAAU,UACV4N,QAAS,YAxCC,SAAC5R,GAAkB,IAAD,EACpCse,EAASlE,aAAapa,IAEtB,IAAM2yC,EAAS,uBACY,OAAnBwF,QAAmB,IAAnBA,OAAA,EAAAA,EAAsBlnB,EAAQ,KAAM,IAD7B,CAEXjF,GAAiB/uB,GACjB8a,YAAW,sCAAuC,CAC9CkZ,MAAOA,EAAQ,EACfh0B,aACD4U,KAAWqgC,QAEZ/yC,EAAI,UAAGmvC,EAAUtuC,KAAKb,YAAlB,QAA0B,EAC9BgI,EAAQsrC,GAAUvB,GAASllB,iBAAV,UAChB/uB,EADgB,YAEnB,OACAkC,EACAwzC,GACJr0B,EAASnX,GAuBesxC,CAAcL,IAC9BtlB,UAAWulB,EAHf,SAIUC,IAEK,MAAbhK,GACE,cAAC,GAAD,CAAQtqC,UAAU,OAAO0lB,QAAQ,EAAM9X,QAASsmC,EAAhD,oBC9CDQ,I,OA7BU,SAACt2C,GAAkB,IAChC6uB,EAAqB7uB,EAArB6uB,MAAOh0B,EAAcmF,EAAdnF,UAETqxC,EADqDtxC,YAAcC,GACnCiD,OAAO+wB,EAAQ,GAQrD,OACI,sBAAKjtB,UAAU,gCAAf,UACI,sBAAKA,UAAU,MAAf,UACI,6BAAK1I,IAAYiB,IAAI,kCAAmC,CAAEU,gBAC1D,sBAAK+G,UAAU,OAAf,UACI,kCACK1I,IAAYiB,IAAI,sCAAuC,CAAE0D,KAAMquC,EAAUtuC,KAAKC,SAEjFquC,EAAUtuC,KAAKb,MAAQ,kCAAUN,aAAeyvC,EAAUtuC,KAAKb,cAGzE,qBAAK6E,UAAU,UAAf,SACKsqC,EAAUjuC,QAAQmF,KAAI,SAAA1I,GAAI,OAlBrB,SAACA,GACf,OACI,cAAC,GAAD,CAAqBA,KAAMA,EAAM2M,KAAMJ,KAASY,OAAjCnN,GAgBoB67C,CAAUt9C,KAAKyB,cCS/C87C,I,OA/BK,SAACx2C,GACjB,IAQIy2C,EAQJ,OANIA,EADa,MAAbz2C,EAAMmjB,IACSnjB,EAAM1E,MAEN,iCACT0E,EAAM1E,MADG,MACO,sBAAMsG,UAAU,MAAhB,SAAwB5B,EAAMmjB,SAIpD,sBAAKvhB,UAAU,cAAf,UACI,sCAAU5B,EAAM8tB,SACd2oB,EACF,mBAAG70C,UAAa,YAAc5B,EAAM02C,WAAa,YAAc,IAC3DlnC,QArBK,SAAC+T,GACVvjB,EAAM22C,OAAS32C,EAAM02C,YAAc12C,EAAM22C,KAAKpzB,MAsB9C,mBAAG3hB,UAAW,cAAgB5B,EAAM42C,aAAe,YAAc,IAC7DpnC,QApBO,SAAC+T,GACZvjB,EAAM62C,SAAW72C,EAAM42C,cAAgB52C,EAAM62C,OAAOtzB,WC0DjDuzB,I,OA5DE,SAAC92C,GAAkB,IACxB8a,EAAU9a,EAAV8a,MACFlZ,GAAa5B,EAAM4B,WAAa,IAAM,aACtCm1C,EAAYj8B,EAAMnL,QAAgC,SAACC,EAAKtU,GAK1D,OAJKsU,EAAItU,KACLsU,EAAItU,GAAS,GAEjBsU,EAAItU,KACGsU,IACR,IAEGu6B,EAAYD,KACZ8M,EAA2BvpB,mBAAQ,WACrC,IAAMwpB,EAAY,YAAQ9M,GACpB+M,EAAmB,GAWzB,OAVAp8B,EAAMzf,SAAQ,SAACX,GACX,IAAMy8C,EAAQF,EAAaG,WAAU,SAACnnC,GAAD,OAAOA,IAAMvV,KAClD,GAAIy8C,GAAS,EAAG,OAEQF,EAAaI,OAAOF,EAAO,GAAvCG,EAFI,oBAGRA,GACAJ,EAAS55C,KAAKg6C,OAInBJ,IACR,CAACp8B,EAAOqvB,IAGLoN,EAAYp8C,OAAOC,KAAK27C,GAAW3zC,KAAI,SAAC3J,GAC1C,IAAMiB,EAAOjB,EACPqD,EAASi6C,EAAUt9C,GACrB+9C,EAAgB,OAIhB16C,GADsBk6C,EAAmBA,EAAiBrzC,QAAO,SAACsM,GAAD,OAAOA,IAAMvV,KAAM+K,OAAS,KAE7F+xC,GAAiB,YAErB,IAAMC,EAAkB78C,aAAcF,GACtC,OACI,qBAAIkH,UAAW41C,EAAf,UACI,cAACrwC,GAAA,EAAD,CACIC,MAAOqwC,EAAgBjuC,QACvBnC,KAAK,aAET,qBAAKzF,UAAU,OAAf,mBACS1I,IAAY2C,YAAYnB,GADjC,aAC4CoC,EAD5C,SAL+BpC,MAY3C,OACI,oBAAIkH,UAAWA,EAAf,SACK21C,MCOEG,I,OA9DO,SAAC13C,GAAkB,IAEjCyD,EACAzD,EADAyD,UAGEouB,EAAiBL,KACjBmmB,EAAsBlqB,mBAAQ,WAChC,OAAOtyB,OAAOC,KAAKqI,GAAWkM,QAAiC,SAACC,EAAKtU,GACjE,IAAMK,EAAWL,EAGjB,OADAsU,EAAItU,GAASu2B,EAAel2B,IAAc8H,EAAU9H,GAC7CiU,IACR,MACJ,CAACnM,EAAWouB,IAETjwB,GAAa5B,EAAM4B,WAAa,IAAM,kBACtC21C,EAAYp8C,OAAOC,KAAK4E,EAAMyD,WAAWL,KAAI,SAAC3J,GAChD,IAAMkC,EAAWlC,EACb+9C,EAAgB,WAChBG,IAAwBA,EAAoBh8C,KAC5C67C,GAAiB,iBAErB,IAAMxlB,EAAsBC,KAAqBt2B,GACjD,IAAKq2B,EACD,MAAM,IAAIj4B,MAAJ,4CAA+C4B,IAWzD,OACI,qBACIiG,UAAW41C,EADf,UAII,cAACrwC,GAAA,EAAD,CACIC,MAAO4qB,EAAoBxoB,QAC3BnC,KAAK,WACLmI,QAhBQ,SAACmS,GAEjB,IACMmJ,EADUnJ,EAAM6G,cACI8C,wBAC1BV,GAAeW,mBAAmBhB,GAAY5uB,SAAUA,EAAUmvB,GAClEnJ,EAAM6D,qBAaF,qBAAK5jB,UAAU,OAAf,SACK1I,IAAY67C,gBAAgBp5C,KAEjC,qBAAKiG,UAAU,SAAf,SACM5B,EAAMyD,UAAU9H,OAXjBA,MAiBjB,OACI,oBAAIiG,UAAWA,EAAf,SACK21C,MCtEAK,GAA0B,SAAC76C,EAAc+sB,GAClD,GAAIA,EAR4B,EAS5B,MAAM,IAAI/vB,MAAJ,yCATsB,EAStB,kBAGV,OAAOgD,EAAQ,GAAKA,GAAQ+sB,EAAU,IC4H3B+tB,GA5GS,SAAC73C,GAAkB,IAC/BtF,EAAoBsF,EAApBtF,KAAMG,EAAcmF,EAAdnF,UACRqhB,EAAW4Q,cACXqmB,EAAiB3hB,KACjBsmB,EAAiB5N,KACjBpY,EAAcJ,KALkB,EAMQ1U,mBAAiB,GANzB,mBAM/B+6B,EAN+B,KAMdC,EANc,KAShC9F,EAAWK,GAAwB73C,GAEnCu9C,EAAgB/F,EAASt0C,KAAK6F,UAC9By0C,EAA4B/8C,OAAOC,KAAK68C,GAEzCt7B,MAAK,SAACljB,GAAU,IAAMkC,EAAoBlC,EAAiB,OAAOw+C,EAAct8C,GAAaw3C,EAAex3C,MAE7Gw8C,GAAwB,EACtBC,EAAgBlG,EAASt0C,KAAKoW,UAChCokC,IACAD,EAAwBC,EAAcz7B,MAAK,SAAC1M,GAAD,OAA4C,IAA/B6nC,EAAengB,QAAQ1nB,OAGnF,IAAMygB,EAAWwnB,GAA6BC,GAAyBJ,EAAkB,EA6BnFM,EAAc,SAAC/F,EAA4CxoB,GAC7D,IjHtDwBrmB,EiHsDlB60C,EAAeV,GAAwBtF,EAAqB10C,KAAKb,MAAQ,EAAG+sB,GAClF5N,GjHvDwBzY,EiHuDC6uC,EAAqB10C,KAAK6F,WAAa,GjHtD7D,CACHhJ,KAAMyN,GAAWqwC,gBACjB90C,eiHqDAyY,EAAS2N,GAAgBhvB,EAAWivB,IAEpC,IAAMymB,EAAY,CACdtmB,GAAmBqoB,EAAqB53C,MACxCmvB,GAAgBhvB,EAAWivB,IAEzB/kB,EAAQsrC,GAAUvB,GAAS0J,UAC7BlG,EAAqB53C,KADF,UAEhBG,EAFgB,UAGnBy9C,EACA/H,GACJr0B,EAASnX,IAGb,OACI,sBAAKnD,UAAU,mBAAf,UACM1I,IAAYiB,IAAI,kCAAmC,CAACO,SACtD,sBAAKkH,UAAU,iBAAf,UACI,mCACI,cAAC,GAAD,CAAe6B,UAAWw0C,MAE9B,mCACKG,GAAiB,cAAC,GAAD,CAAUt9B,MAAOs9B,SAG3C,sBAAKx2C,UAAU,YAAf,UACI,gCACI,cAAC,GAAD,CACItG,MAAOy8C,EACPjqB,MAAO50B,IAAYiB,IAAI,mCACvBw8C,KA3CH,SAACpzB,GACdA,EAAEiC,kBACFwyB,EAAmBD,EAAkB,IA0CrBlB,OAvCD,SAACtzB,GAChBA,EAAEiC,kBACFwyB,EAAmBD,EAAkB,IAsCrBrB,WACIqB,GAAmBjmB,GACnBimB,GDpHQ,ECsHZnB,aAAcmB,EAAkB,IAjE7B,SAACU,GACpB,GAAwB,IAApBV,EACA,MAAO,GAEX,IAAMO,EAAeV,GAAwBa,EAAUV,GACjDh7C,EAAON,aAAe67C,GAC5B,OAAOp/C,IAAYiB,IAAI,wCAAyC,CAAE4C,SA6DpD27C,CAAexG,EAASt0C,KAAKb,MAAQ,MAE3C,8BACI,cAAC,GAAD,CACI2zB,SAAUA,EACV9uB,UAAU,QACV4N,QAhEA,SAAC+T,GACjBA,EAAEiC,kBAEF6yB,EAAYnG,EAAU6F,GACtBC,EAAmB,IAyDP,SAKK9+C,IAAYiB,IAAI,4CCnF1Bw+C,GA/BM,SAAC34C,GAAkB,IAC7BnF,EAAamF,EAAbnF,UAD4B,EAEKmiB,qBAFL,mBAE5B4P,EAF4B,KAEdC,EAFc,KAI7BoC,EAA4CuhB,GAAkB31C,GAKpE,OACI,qCACI,yCACA,sBAAK+G,UAAU,gBAAf,UACI,oBAAIA,UAAU,mBAAd,SACKqtB,EAAWijB,SAAS9uC,KAAI,SAAC1I,GAAD,OACrB,qBAEI8U,QAAS,kBAZA,SAAC9U,GAC9BmyB,EAAgBnyB,GAWmBk+C,CAAyBl+C,IACxCkH,UAAWgrB,IAAiBlyB,EAAO,WAAa,GAHpD,UAKI,cAAC,GAAD,CAAUA,KAAMA,EAAM2M,KAAMJ,KAASW,WACnC1O,IAAY2C,YAAYnB,KAN9B,eACiBA,SASvBkyB,GAAgB,cAAC,GAAD,CAAiBlyB,KAAMkyB,EAAc/xB,UAAWA,WCkDnEg+C,I,OAnEiB,SAAC74C,GAAkB,IACxCnF,EAAamF,EAAbnF,UACDg0B,EAAQ2hB,GAAkB31C,GAAWg0B,MAErCiqB,EAAgBtH,GAAiC32C,GACjDk+C,EAAgBpH,GAAiC92C,GAEjD81C,EAAsB/1C,YAA6CoF,EAAMnF,WAC/E,IAAK81C,EACD,MAAM,IAAI52C,MAAJ,4CAA+CiG,EAAMnF,UAArD,2DAkBV,OAEI,cADA,CACA,sBACI,cAAC,GAAD,CAAqBA,UAAWmF,EAAMnF,YACtC,qBAAK+G,UAAY,4BAAjB,SACI,oCACI,cAAC,GAAD,CACI/G,UAAWA,EACXi7C,cAtBM,SAACn0B,GACvB,IACMmJ,EADUnJ,EAAM6G,cACI8C,wBACpB0tB,EAAU,cAAC,GAAD,CAAkBnqB,MAAOA,EAAOh0B,UAAWA,IAC3D+vB,GAAeW,mBAAmBhB,GAAY2qB,UAAW8D,EAASluB,EAAY,6BAE9EnJ,EAAM6D,mBAiBUuwB,oBAdW,SAAC7J,GAE5B,OAD4ByE,EAAoB7yC,OAAOouC,GAC5BjuC,QAAQmF,KAAI,SAAA1I,GAAI,OAAIqvB,GAAoBlvB,EAAWH,SAclE,cAAC,GAAD,CAAcG,UAAWA,IACzB,qCACI,iCAAS3B,IAAYiB,IAAI,sCACxB2+C,EAAc11C,KAAI,SAACk8B,GAAD,OACf,cAAC,GAAD,CAEIxR,MAAK,UAAK50B,IAAY2C,YAAYyjC,EAAE9kC,MAA/B,aAAiDiC,aAAe6iC,EAAE+S,eAAlE,KACLztC,SAAU06B,EAAE16B,UAHhB,UACY06B,EAAE9kC,MADd,OACqB8kC,EAAE8W,kBAM9B2C,EAActzC,OAAS,GACxB,qCACI,iCAASvM,IAAYiB,IAAI,sCACxB4+C,EAAc31C,KAAI,SAACk8B,GAAD,OACf,cAAC,GAAD,CAEIxR,MAAK,UAAK50B,IAAY2C,YAAYyjC,EAAE9kC,MAA/B,aAAiDiC,aAAe6iC,EAAE+S,eAAlE,KACLztC,SAAU06B,EAAE16B,UAHhB,UACY06B,EAAE9kC,MADd,OACqB8kC,EAAE8W,4BCgBpC32B,I,OAAAA,GAhEM,SAACzf,GAAoC,IAElDyD,EAEAzD,EAFAyD,UACAw1C,EACAj5C,EADAi5C,eAEEj5B,EAAa0F,aAA8C,SAAA/O,GAAK,OAAIA,EAAMqJ,cAC1Epe,EAAS,wBAAqB5B,EAAM4B,WAAa,IAEvD,OACI,qBAAKA,UAAWA,EAAhB,SAEQzG,OAAOC,KAAKqI,GAAWL,KAAI,SAAC9H,GACxB,IAOIsgB,EAPEjgB,EAAWL,EACX02B,EAAsBC,KAAqBt2B,GAC3CmB,EAASkD,EAAMyD,UAAU9H,GAC/B,IAAKq2B,EACD,MAAM,IAAIj4B,MAAJ,4CAA+C4B,IAIrDs9C,EAAet9C,KACfigB,EAAQ,sBAAMha,UAAU,aAAhB,qBACGq3C,EAAet9C,GAAWs1B,QAAQ,OAIjD,IAAMp2B,EAAY+E,YAAuBC,KAASlE,IAK5C43C,EAAOz2C,GAAUkD,EAAMZ,aAAazD,GAC1C,OACI,eAAC,WAAD,WACI,cAACwL,GAAA,EAAD,CAAMC,MAAO4qB,EAAoBxoB,QAASnC,KAAK,aAC/C,qBAAKzF,UAAU,OAAf,SACM1I,IAAY67C,gBAAgBp5C,KAElC,qBAAKiG,UAAS,gBAAW2xC,EAAO,QAAU,IAA1C,SACM5iB,GAAa7zB,EAAQ,KAE3B,qBAAK8E,UAAU,MAAf,sBACY5B,EAAMZ,aAAazD,MAE/B,qBAAKiG,UAAU,QAAf,SACMga,IAEN,qBAAKha,UAAU,YAAf,SACMoe,EAAWnlB,GAAW2lB,QAAU9E,EAAe6R,MAC7C,cAAC,IAAD,CAAMpoB,GAAIoE,YAAiB1O,GAAY2U,QArB5B,WACvBxP,EAAMuvB,iBAoBM,SACMr2B,IAAYiB,IAAI,0CAA2C,CAACU,gBAGlE3B,IAAYiB,IAAI,0CAA2C,CAACU,kBApBnDc,YCjDhCu9C,GAA4B,CACrC75C,OAAQ,EACRb,KAAM,EACNI,KAAM,EACNI,QAAS,EACTF,MAAO,EACPJ,KAAM,GCkDK43C,I,OAtDU,SAACt2C,GAAkB,IAChC6uB,EAAU7uB,EAAV6uB,MACF8hB,EAAoD/1C,YAAc4C,IAAU2B,WAE5E4sC,EAAe4E,EAAoB7yC,OAAO+wB,GAC1Cqd,EAAYyE,EAAoB7yC,OAAO+wB,EAAQ,GAgBrD,OACI,sBAAKjtB,UAAU,+BAAf,UACI,sBAAKA,UAAU,MAAf,UACI,6BAAK1I,IAAYiB,IAAI,kCAAmC,CAAEU,UAAW2C,IAAU2B,cAC/E,sBAAKyC,UAAU,OAAf,UACI,kCACK1I,IAAYiB,IAAI,sCAAuC,CAAE0D,KAAMquC,EAAUtuC,KAAKC,SAEjFquC,EAAUtuC,KAAKb,MAAQ,kCAAUN,aAAeyvC,EAAUtuC,KAAKb,cAGzE,sBAAK6E,UAAU,mBAAf,UACI,qBAAKA,UAAU,WACf,qBAAKA,UAAU,SAAf,SACK1I,IAAYiB,IAAI,yDAErB,qBAAKyH,UAAU,gBAAf,SACK1I,IAAYiB,IAAI,yCAA0C,CACvD00B,MAAOA,EAAQ,MAGvB,qBAAKjtB,UAAU,WACf,qBAAKA,UAAU,gBAAf,SACC1I,IAAYiB,IAAI,yCAA0C,CACnD00B,MAAOA,EAAQ,MAGtB1zB,OAAOC,KAAK8wC,EAAU9sC,cAAcgE,KAAI,SAAA+1C,GAAG,OAzCtC,SAACx9C,GACf,IAAMq2B,EAAsBC,KAAqBt2B,GAEjD,OACI,eAAC,WAAD,WACI,8BAAK,cAACwL,GAAA,EAAD,CAAMC,MAAO4qB,EAAoBxoB,QAASnC,KAAK,eACpD,8BAAMnO,IAAY67C,gBAAgBp5C,KAClC,qBAAKiG,UAAU,SAAf,SAAyBmqC,EAAa3sC,aAAazD,KACnD,qBAAKiG,UAAU,QAAf,oBACA,qBAAKA,UAAU,SAAf,SAAyBsqC,EAAU9sC,aAAazD,OAL/BA,GAqC+B46C,CAAU4C,cC7BpEC,I,OAAY5rC,KAAerO,WAqHlBk6C,GAnHgB,WAAO,IAAD,EAE3BC,EAAoBtR,KAFO,EAGmBhrB,mBAAQ,UAASs8B,EAAkB,UAA3B,aAAS,EAAsBpjC,IAH1D,mBAG1BqjC,EAH0B,KAGNC,EAHM,KAI3B/1C,EAAY+tB,KAJe,EAKWxU,mBAA6Bk8B,IALxC,mBAK1BO,EAL0B,KAKVC,EALU,KAM3BC,EAAoB3Z,GAAYv8B,GAChCm2C,EAAer3B,iBAA4B,MAC3Cu1B,EAAiB5N,KACjB2P,EAAkBn0B,aAA8C,SAAA/O,GAAK,OAAIA,EAAMqJ,cAC9E6qB,EAAqBT,KAArBS,kBAEPttB,qBAAU,WAEN,IAAM3B,EAAQzgB,OAAOC,KAAKqI,GAAWkM,QAA2B,SAACC,EAAKtU,GAClE,IAAMK,EAAWL,EAKjB,OAJIq+C,GAAqBA,EAAkBh+C,KAEvCiU,EAAIjU,GAAY8H,EAAU9H,GAAag+C,EAAkBh+C,IAEtDiU,IACR,IAEH8pC,EAAkB99B,KACnB,CAACnY,EAAWk2C,IAEfp8B,qBAAU,WACN,GAAKq8B,EAAan3B,QAAlB,CAGA,IAAM7B,EAAMg5B,EAAan3B,QACzB7B,EAAI+nB,UAAUmR,OAAO,WACrBjrC,YAAW,WACH+qC,GACAh5B,EAAI+nB,UAAUrlC,IAAI,aAEvB,QACJ,CAACm2C,IAEJ,IAAM9I,EAAsB/1C,YAA4C4C,IAAU2B,WAClF,IAAKwxC,EACD,MAAM,IAAI52C,MAAJ,4CAA+CyD,IAAU2B,UAAzD,oCAGV,IAAMq0C,EAAiBhD,GAAkBhzC,IAAU2B,WAC7C46C,EAAqDpJ,EAAoB7yC,OAAO01C,EAAe3kB,OA4BrG,OACI,sBAAKjtB,UAAU,0BAAf,UACI,cAAC,GAAD,CAAgB/G,UAAW2C,IAAU2B,UAAW22C,cApB9B,SAACn0B,GACvB,IACMmJ,EADUnJ,EAAM6G,cACI8C,wBACpB0tB,EAAU,cAAC,GAAD,CAAkBnqB,MAAO2kB,EAAe3kB,QACxDjE,GAAeW,mBAAmBhB,GAAY2qB,UAAW8D,EAASluB,EAAY,6BAE9EnJ,EAAM6D,mBAcgFuwB,oBAX3D,SAAC7J,GAC5B,IAAM8N,EAAyBrJ,EAAoB7yC,OAAO01C,EAAe3kB,OAGzE,MAAO,CACHxE,GAHwBsmB,EAAoB7yC,OAAOouC,GACrB5sC,aAAe06C,EAAuB16C,kBASpE,2BAAUsC,UAAU,YAAYgf,IAAKg5B,EAArC,UACI,iCAAS1gD,IAAYiB,IAAI,sCACzB,cAAC,GAAD,CACIsJ,UAAWA,EACXuc,WAAY65B,EACZz6C,aAAc26C,EAAgB36C,aAC9B65C,eAAgBQ,OAGxB,6BAAKvgD,IAAYiB,IAAI,sCACrB,cAAC,GAAD,CACIwtC,WAAYyR,GACZx3C,UAAU,kBACVkZ,MAAOg9B,EACP7N,WA3CoB,SAACvvC,EAAYkT,EAAkBC,EAAgB85B,EAA4BD,GACvGmD,EAAkBnwC,EAAMkT,EAAUC,EAAQ85B,EAAYD,MA4ClD,6BAAKxuC,IAAYiB,IAAI,wCACrB,gCACI,cAAC,GAAD,CACI6b,YAAasjC,EACbjiB,qBAAsBkiB,EACtBniB,wBA9CoB,SAACL,GACjCyiB,EAAsBziB,MA+Cd,qBAAKn1B,UAAU,uBAAf,SACM23C,GACE,cAAC,GAAD,CACI5rC,aAAc4rC,EACdrL,gBAAgB,EAChBX,QAAQ,EACRvC,QAAQ,aCvFrB3pC,I,OAAAA,aACXC,KAASmM,WAhD6B,CACtC1N,KADsC,SACjCC,EAAcC,GACfD,EAAME,OAAOD,EAAQE,YAEzBC,QAJsC,SAI9B03B,EAAemiB,GACnB,OAAO,KAcC,SAACz4C,EAA8BvB,GAA/B,MAA+D,CAC3EG,QAASH,EAAQG,UACjBqB,kBAAmBD,EAAQ1B,aAC3B4B,OAAQzB,EAAQyB,YAyBLL,EApBiB,SAACrB,GAAoC,IAE7D0B,EAGA1B,EAHA0B,OACAtB,EAEAJ,EAFAI,QAIAwB,EAAY,4BAQhB,OANIF,EACAE,GAAa,eACNxB,IACPwB,GAAa,cAGVH,EAVHzB,EADAyB,mBAYA,qBAAKG,UAAcA,SCkBZs4C,I,OA/CW,SAACl6C,GAsCvB,OACI,oBACI4B,UAAU,qBADd,SAtCiB,WAEjB,IADA,IAAM0oB,EAAuB,GADN,WAEdra,GACL,IAAI+oC,OAAO,EACPp3C,EAAY,GAGhB,KAFwB5B,EAAMqI,mBAAmB4H,GAE9B,CACf,IAAMuG,EAAaxW,EAAMqI,mBAAmB4H,GAC5C+oC,EACI,cAAC,GAAD,CACIxiC,WAAYA,EACZzY,aAAa,EACbsJ,KAAMJ,KAASY,MACf2H,QAAS,kBAAMxP,EAAMm6C,oBAAoB3jC,MAGjD5U,EAAY,sBAEZo3C,EACI,cAAC,GAAD,CACI94C,OAAQ,SAACxF,GAAqCsF,EAAMo6C,oBAAoB1/C,EAAMuV,MAI1Fqa,EAAMhtB,KACF,oBAEIsE,UAAWA,EAFf,SAIKo3C,GAJL,cACgB/oC,MAzBfA,EAAI,EAAGA,EAAIjQ,EAAMq6C,eAAgBpqC,IAAM,EAAvCA,GAgCT,OAAOqa,EAODgwB,OCmDCC,I,OAjFI,SAACv6C,GAEhB,IAAM8a,EAAQ4K,aAAuC,SAAAlF,GAAK,OAAIA,EAAM2pB,aAyC9DqQ,EAAmB,SAAC1kB,GACtB,OAAKA,EAAgBpgB,eAGdogB,EAAgBpgB,cAAc+kC,OAAM,SAAC//C,GAAgB,IAAD,EACjDggD,EAAc,UAAI5kB,EAAgBpgB,qBAApB,aAAG,EAAiC/R,QAAO,SAACsM,GAAD,OAAOA,IAAMvV,KAAM+K,OAClF,OAAOqV,EAAMnX,QAAO,SAACsM,GAAD,OAAOA,IAAMvV,KAAM+K,SAAhC,OAA2Ci1C,QAA3C,IAA2CA,IAAkB,OAK5E,OACI,sBAAK94C,UAAU,cAAf,UACI,6BACK1I,IAAYiB,IAAI,2CAErB,oBAAIyH,UAAU,aAAd,SACK5B,EAAM26C,gBAAgBv3C,KAAI,SAAC8wB,GACxB,IAAMtyB,EAAS,gBAAasyB,EAAE15B,OAASwF,EAAM80B,kBAAqB,YAAc,IAChF,OACI,qBACIlzB,UAAWA,EACX4N,QAAS,WAAOxP,EAAM46C,aAAa1mB,EAAE15B,OAFzC,UAII,qBACIoH,UAAU,OACVC,MAAO,CAAC4F,gBAAgB,OAAD,OAASC,IAAT,QAE3B,sBAAK9F,UAAU,QAAf,UAAyB1I,IAAY+8B,cAAc/B,EAAE15B,MAArD,SARK05B,EAAE15B,WA3DP,WACpB,IAAKwF,EAAM80B,kBACP,OAAO,KAEX,IAAMvsB,EAAQvI,EAAM26C,gBAAgBrkC,MAAK,SAAC4d,GAAD,OAAOA,EAAE15B,OAASwF,EAAM80B,qBACjE,IAAKvsB,EACD,OACI,oCAAQrP,IAAYiB,IAAI,sCAAxB,OAGR,IAAM27B,EAAkBl7B,aAAc2N,EAAM/N,MAGtCqgD,EAAY76C,EAAMqI,mBAAmB1E,QAAO,SAACkN,GAAD,OAAa,OAANA,KAAYpL,QAjC7C,EAmClBq1C,EAAcN,EAAiB1kB,GAE/BilB,EAAYF,GAAaC,EAE/B,OACI,sBAAKl5C,UAAU,gBAAf,UACK1I,IAAY8hD,oBAAoBh7C,EAAM80B,mBACvC,cAAC,GAAD,CACIulB,eA5CW,EA6CXhyC,mBAAoBrI,EAAMqI,mBAC1B8xC,oBAAqBn6C,EAAMi7C,mBAC3Bb,oBAAqBp6C,EAAMo6C,sBAE/B,cAAC,GAAD,CAAUt/B,MAAQgb,EAAgBpgB,eAAiB,KACnD,cAAC,GAAD,CAAQgb,UAAWqqB,EAAWvrC,QAAY,kBAAMxP,EAAMk7C,iBAAtD,SACKhiD,IAAYiB,IAAI,gDA0CvBghD,QChDCC,I,OA3CU,SAACp7C,GAAkB,IAEpCwW,EAKAxW,EALAwW,WACAnO,EAIArI,EAJAqI,mBACAD,EAGApI,EAHAoI,UACAizC,EAEAr7C,EAFAq7C,gBACAJ,EACAj7C,EADAi7C,mBAGEK,EAAajzC,EAAmBsvB,QAAQnhB,IAAe,EACvDjO,EAAQrP,IAAY+8B,cAAc7tB,GAWxC,OAAIkzC,EAEI,cAAC,GAAD,CAAQ9rC,QANU,WACtByrC,EAAmBzkC,IAKqB5U,UAAU,oBAA9C,SACI1I,IAAYiB,IAAI,4CD1BD,IC+BvBkO,EAAmB1E,OAAOC,SAAS6B,OAE/B,cAAC,GAAD,CAAQirB,UAAU,EAAM9uB,UAAU,oBAAlC,SACK1I,IAAYiB,IAAI,sDAKzB,cAAC,GAAD,CAAQqV,QAzBW,WACnB,IAAM+rC,EAAYC,GAAanzC,GAC/BgzC,EAAgB7kC,EAAY+kC,IAuBM35C,UAAU,oBAA5C,SACK1I,IAAYiB,IAAI,wCAAyC,CAAEoO,cAQlEizC,GAAe,SAACnzC,GAClB,IAAK,IAAI4H,EAAI,EAAGA,EDjDW,ECiDUA,IACjC,IAAK5H,EAAmB4H,GACpB,OAAOA,EAGf,OAAO,GC1CLwrC,I,OAAgF,CAClFjU,UADkF,SACxExnC,GAEN,MAAO,CACHwW,WAAYxW,EAAMwW,WAClBkxB,SAAU1nC,EAAM0nC,SAChBC,WAAYn6B,KAAeg9B,wBAevC,ICnBYkR,GD4CGnU,gBAA0DjmC,KAASmM,WAAYguC,IAhC9F,SAAiBj6C,EAA8BvB,GAC3C,MAAO,CACH2nC,kBAAmBpmC,EAAQqmC,aAC3BC,WAAY7nC,EAAQ6nC,gBA6BbP,EAzBmB,SAACvnC,GAA2D,IAElF8nC,EAA4C9nC,EAA5C8nC,WAAYF,EAAgC5nC,EAAhC4nC,kBAChBhmC,EAAY,8BAYhB,OAboD5B,EAAb0wB,WAGnC9uB,GAAa,aAEbkmC,IACAlmC,GAAa,aAOVgmC,EACH,qBAAKhmC,UAAcA,EAAnB,SACI,cAAC,GAAD,eAES5B,UEoBN27C,GAhEY,SAAC37C,GAAkB,IAEtCwW,EAQAxW,EARAwW,WACAolC,EAOA57C,EAPA47C,QACAvzC,EAMArI,EANAqI,mBACA2mC,EAKAhvC,EALAgvC,SACAla,EAIA90B,EAJA80B,kBACAtlB,EAGAxP,EAHAwP,QACA6rC,EAEAr7C,EAFAq7C,gBACAJ,EACAj7C,EADAi7C,mBAGE/+B,EAAW4Q,cACX+uB,EAAWxzC,EAAmBsvB,QAAQnhB,IAAe,EAU3D,OACI,qCACI,sBACI5U,UAAS,eAAUotC,EAAW,WAAa,IAC3Cx/B,QAAS,kBAAMA,EAAQgH,IAF3B,UAII,cAAC,GAAD,CACIka,SAAUmrB,GAAYD,EACtBplC,WAAYA,EACZ5U,UAAU,kBACV8lC,SAAUoU,IAJd,iBAKmBtlC,EAAWN,KAE9B,gCACI,kCACKM,EAAWhc,OAEhB,yBAASoH,UAAU,aAAnB,SACGg6C,GAAY1iD,IAAYiB,IAAI,uCAGnC,sBAAMyH,UAAU,SAAS4N,QA7BhB,SAAC+T,GAClBA,EAAEiC,kBACF,IAAMhrB,EAAOuhD,OAAO,iBAAkBvlC,EAAWhc,MAC7CA,GAAQA,IAASgc,EAAWhc,MAC5B0hB,EAAS/N,aAAiBqI,EAAWN,GAAI1b,KAyBrC,uBAEFw0C,GACE,sBAAKptC,UAAU,qBAAf,UACI,cAAC,GAAD,CAAiB+L,aAAc6I,EAAWN,GAAI1b,MAAM,KAChDohD,GAAW9mB,GACX,cAAC,GAAD,CACIte,WAAYA,EACZnO,mBAAoBA,EACpBD,UAAW0sB,EACXumB,gBAAiBA,EACjBJ,mBAAoBA,WChEjCe,GARG,WACd,OACI,qBAAKp6C,UAAU,OAAf,2BCuEOq6C,I,OA5DE,SAACj8C,GA0Bd,IA1BgC,IAE5Bk8C,EAMAl8C,EANAk8C,UACAlmC,EAKAhW,EALAgW,YACA3N,EAIArI,EAJAqI,mBACAysB,EAGA90B,EAHA80B,kBACAumB,EAEAr7C,EAFAq7C,gBACAJ,EACAj7C,EADAi7C,mBAP2B,EASqBj+B,qBATrB,mBASxBu8B,EATwB,KASJC,EATI,KAiBzB2C,EAAwB,SAAC3lC,GACvB+iC,IAAuB/iC,EAAWN,GAClCsjC,OAAsB5iC,GAEtB4iC,EAAsBhjC,EAAWN,KAInCkmC,EAA6B,GAzBJ,WA0BtBnsC,GACL,IAAMuG,EAAaR,EAAYM,MAAK,SAACzF,GAAD,OAAOA,EAAEwrC,OAASpsC,KACtD,IAAKuG,EAID,OAHA4lC,EAAY9+C,KACR,cAAC,GAAD,iBAAuB2S,KAE3B,WAEJ,IAvB0BtC,EAuBpBiuC,GAvBoBjuC,EAuBa6I,EAAWN,KAtB3C/a,OAAOuI,OAAO1D,EAAMg0B,QAAQ1d,MAAK,SAAC/N,GACrC,OAAOA,EAAM0N,MAAM0hB,QAAQhqB,IAAiB,MAuBhDyuC,EAAY9+C,KACR,cAAC,GAAD,CAEIkZ,WAAYA,EACZnO,mBAAoBA,EACpBysB,kBAAmBA,EACnBka,SAAUuK,IAAuB/iC,EAAWN,GAC5C0lC,QAASA,EAETpsC,QAAS2sC,EACTd,gBAAiBA,EACjBJ,mBAAoBA,GATfzkC,EAAWN,MAZnBjG,EAAI,EAAGA,EAAIisC,EAAWjsC,IAAK,EAA3BA,GA0BT,OACI,sBAAKrO,UAAU,YAAf,UACI,6BAAK1I,IAAYiB,IAAI,+BACnBiiD,OCjBC9F,I,OA7CU,SAACt2C,GAAkB,IAChC6uB,EAAU7uB,EAAV6uB,MACF8hB,EAAiD/1C,YAAc4C,IAAUyB,QAEzE8sC,EAAe4E,EAAoB7yC,OAAO+wB,GAC1Cqd,EAAYyE,EAAoB7yC,OAAO+wB,EAAQ,GAGrD,OACI,sBAAKjtB,UAAU,4BAAf,UACI,sBAAKA,UAAU,MAAf,UACI,6BAAK1I,IAAYiB,IAAI,kCAAmC,CAAEU,UAAW2C,IAAUyB,WAC/E,sBAAK2C,UAAU,OAAf,UACI,kCACK1I,IAAYiB,IAAI,sCAAuC,CAAE0D,KAAMquC,EAAUtuC,KAAKC,SAEjFquC,EAAUtuC,KAAKb,MAAQ,kCAAUN,aAAeyvC,EAAUtuC,KAAKb,cAGzE,sBAAK6E,UAAU,iBAAf,UACI,qBAAKA,UAAU,WACf,qBAAKA,UAAU,SAAf,SACK1I,IAAYqnB,iBAAiB/iB,IAAUyB,UAE5C,qBAAK2C,UAAU,gBAAf,SACK1I,IAAYiB,IAAI,yCAA0C,CACvD00B,MAAOA,EAAQ,MAGvB,qBAAKjtB,UAAU,WACf,qBAAKA,UAAU,gBAAf,SACK1I,IAAYiB,IAAI,yCAA0C,CACvD00B,MAAOA,EAAQ,MAGvB,8BAAK,cAAC1nB,GAAA,EAAD,CAAMC,MAAM,+BAA+BC,KAAK,eACrD,8BAAMnO,IAAYiB,IAAI,+BACtB,qBAAKyH,UAAU,SAAf,SAAyBmqC,EAAa7sC,QACtC,qBAAK0C,UAAU,QAAf,oBACA,qBAAKA,UAAU,SAAf,SAAyBsqC,EAAUhtC,gBC5BtC48C,I,OAAY,UA+FVQ,GA5Fa,WACxB,IAAMztB,EAAQ2hB,GAAkBhzC,IAAUyB,QAAQ4vB,MAC5C7Y,EAAc0P,aAAgD,SAAA/O,GAAK,OAAIA,EAAMX,eAC7Ege,EAAStO,aAA2C,SAAA/O,GAAK,OAAIA,EAAMqd,UAH3C,EAKwBhX,mBAAiC,IALzD,mBAKvB3U,EALuB,KAKHk0C,EALG,OAMYv/B,qBANZ,mBAMvB+X,EANuB,KAMRynB,EANQ,KASxBzC,EADsBn/C,YAAyC4C,IAAUyB,QACHnB,OAAO+wB,GAE7E3S,EAAW4Q,cAMX2vB,EAAqBzoB,EAAOrwB,QAAO,SAACuwB,GAAD,OAAOA,EAAEE,SAAW3H,GAAYiwB,aAmBnEC,EAAsB,SAACnmC,EAAkC/F,GAC3D,IAAMmsC,EAAI,YAAQv0C,GAClBu0C,EAAKnsC,GAAS+F,EACd+lC,EAAwBK,IAGtBC,EAAyB,SAACrmC,GAC5B,IAAM/F,EAAQpI,EAAmBsvB,QAAQnhB,GACnComC,EAAI,YAAQv0C,UACXu0C,EAAKnsC,GACZ8rC,EAAwBK,IAmB5B,OACI,sBAAKh7C,UAAU,wBAAf,UACI,cAAC,GAAD,CAAgB/G,UAAW2C,IAAUyB,OAAQ62C,cAX3B,SAACn0B,GACvB,IACMmJ,EADUnJ,EAAM6G,cACI8C,wBACpB0tB,EAAU,cAAC,GAAD,CAAkBnqB,MAAOA,IACzCjE,GAAeW,mBAAmBhB,GAAY2qB,UAAW8D,EAASluB,EAAY,6BAE9EnJ,EAAM6D,qBAMF,oCACI,cAAC,GAAD,CACI02B,UAAWnC,EAAgB76C,MAC3B8W,YAAaA,EACb3N,mBAAoBA,EACpB2rB,OAAQA,EACRc,kBAAmBC,EACnBsmB,gBAAiBsB,EACjB1B,mBAAoB4B,IAExB,cAAC,GAAD,CACIlC,gBAAiB8B,EACjB3nB,kBAAmBC,EACnB1sB,mBAAoBA,EACpBuyC,aAAc,SAACpgD,GAAD,OA/DL,SAACA,GAElBgiD,EADAznB,IAAkBv6B,OACDoc,EAEApc,GAIrB+hD,EAAwB,IAuDoBO,CAAiBtiD,IACjD4/C,oBArDgB,SAAC1/C,EAAgC+V,GACzD/V,EAAKgtC,WAAaoU,IAClBa,EAAoBjiD,EAAK8b,WAAY/F,IAoD7BwqC,mBAAoB4B,EACpB3B,cApCU,WACtB,IArCmB9yC,EAqCb20C,EAAa7jD,IAAY+8B,cAAclB,GACvCzC,EAASjqB,EAAmB,GAClCgG,KAAamf,SAASuvB,EAAYhiD,KAAKiiD,cAAvC,OAAsD1qB,QAAtD,IAAsDA,OAAtD,EAAsDA,EAAQW,UAAW5pB,YAAa0rB,IAvCnE3sB,EAwCL2sB,EAvCd7Y,EAAS/T,aAAYC,EAAWC,cCkCzBiuC,I,OA3DU,SAACt2C,GAAkB,IAChC6uB,EAAqB7uB,EAArB6uB,MAAOh0B,EAAcmF,EAAdnF,UACT81C,EAAmD/1C,YAAcC,GAEjEkxC,EAAe4E,EAAoB7yC,OAAO+wB,GAC1Cqd,EAAYyE,EAAoB7yC,OAAO+wB,EAAQ,GAkBrD,OACI,sBAAKjtB,UAAU,8BAAf,UACI,sBAAKA,UAAU,MAAf,UACI,6BAAK1I,IAAYiB,IAAI,kCAAmC,CAAEU,gBAC1D,sBAAK+G,UAAU,OAAf,UACI,kCACK1I,IAAYiB,IAAI,sCAAuC,CAAE0D,KAAMquC,EAAUtuC,KAAKC,SAEjFquC,EAAUtuC,KAAKb,MAAQ,kCAAUN,aAAeyvC,EAAUtuC,KAAKb,cAGzE,sBAAK6E,UAAU,0BAAf,UACI,qBAAKA,UAAU,WACf,qBAAKA,UAAU,WACf,qBAAKA,UAAU,gBAAf,SACK1I,IAAYiB,IAAI,yCAA0C,CACvD00B,MAAOA,EAAQ,MAGvB,qBAAKjtB,UAAU,WACf,qBAAKA,UAAU,gBAAf,SACC1I,IAAYiB,IAAI,yCAA0C,CACnD00B,MAAOA,EAAQ,MAGvB,8BAAK,cAAC1nB,GAAA,EAAD,CAAMC,MAAO,4BAA6BC,KAAK,eACpD,8BAAMnO,IAAYiB,IAAI,+CACtB,qBAAKyH,UAAU,SAAf,SAAyBmqC,EAAa/tC,iBACtC,qBAAK4D,UAAU,QAAf,oBACA,qBAAKA,UAAU,SAAf,SAAyBsqC,EAAUluC,iBAClC7C,OAAOC,KAAK8wC,EAAU3tC,WAAW6E,KAAI,SAAA+1C,GAAG,OA9CnC,SAACx9C,GACf,IAAMq2B,EAAsBC,KAAqBt2B,GAEjD,OACI,eAAC,WAAD,WACI,8BAAK,cAACwL,GAAA,EAAD,CAAMC,MAAO4qB,EAAoBxoB,QAASnC,KAAK,eACpD,8BACInO,IAAYiB,IAAI,wDAAyD,CAAEwB,eAE/E,qBAAKiG,UAAU,SAAf,SAAyBmqC,EAAaxtC,UAAU5C,KAChD,qBAAKiG,UAAU,QAAf,oBACA,qBAAKA,UAAU,SAAf,SAAyBsqC,EAAU3tC,UAAU5C,OAP5BA,GA0C4B46C,CAAU4C,cCVxD8D,GAvCe,SAACj9C,GAAkB,IACtCnF,EAAuBmF,EAAvBnF,UAAWc,EAAYqE,EAAZrE,SACZkb,EAASu+B,KAF6B,EAGnB5E,GAAkB31C,GAApCg0B,EAHqC,EAGrCA,MAAO/E,EAH8B,EAG9BA,QACR6mB,EAAsB/1C,YAA2CoF,EAAMnF,WAC7E,IAAK81C,EACD,MAAM,IAAI52C,MAAJ,4CAA+CiG,EAAMnF,UAArD,4CAEV,IACM0D,EADoDoyC,EAAoB7yC,OAAO+wB,GACnDtwB,UAAU5C,IAAa,EACnDigB,EAAQ4N,IAAqB/a,KAAKC,MAAQmI,EAAOqmC,oBACjDlrB,EAAsBC,KAAqBt2B,GAEjD,OACI,sBAAKiG,UAAU,0BAAf,UACI,sBAAKA,UAAU,OAAf,UACI,cAACuF,GAAA,EAAD,CAAMC,MAAO4qB,EAAoBxoB,QAAUnC,KAAK,aAChD,8BACKnO,IAAYiB,IAAI,kCAAmC,CAChD2C,OAAQyB,EACR5C,kBAIVmuB,EAAU,GACZ,cAAC,GAAD,CACIloB,UAAU,aACVsgB,UAAWqpB,GAAUoK,WACrB7nB,MAAK,UAAK50B,IAAYiB,IAAI,uCAAwC,CAC9D2C,OAAQyB,EAAYurB,EACpBnuB,WACAoB,KAAMN,aAAemf,MAEzBhX,SAAUgX,EAAQ4N,MAEnBM,GAAW5wB,IAAYiB,IAAI,wCC6B3BgjD,I,OA1De,SAACn9C,GAAkB,IACtCnF,EAAamF,EAAbnF,UADqC,EAInB21C,GAAkB31C,GAApCg0B,EAJqC,EAIrCA,MAAO/E,EAJ8B,EAI9BA,QACR6mB,EAAsB/1C,YAA2CoF,EAAMnF,WAC7E,IAAK81C,EACD,MAAM,IAAI52C,MAAJ,4CAA+CiG,EAAMnF,UAArD,4CAEV,IAAMk/C,EAAoDpJ,EAAoB7yC,OAAO+wB,GAC/EiD,EAAcpM,aAAgC,SAAC/O,GAAD,OAAW8a,GAAkB9a,MAG3EuF,EAAW4Q,cAUX4pB,EAAa5sB,IAAYiwB,EAAgB/7C,iBAAmB8zB,GAAe,GAAK,EAChF8kB,EAA2B,IAAZ9sB,EAWrB,OACI,qCACI,cAAC,GAAD,CAAqBjvB,UAAWmF,EAAMnF,YACtC,qBAAK+G,UAAU,0BAAf,SACI,oCACI,cAAC,GAAD,CAAgB/G,UAAWA,EAAWi7C,cAd5B,SAACn0B,GACvB,IACMmJ,EADUnJ,EAAM6G,cACI8C,wBACpB0tB,EAAU,cAAC,GAAD,CAAkBnqB,MAAOA,EAAOh0B,UAAWA,IAC3D+vB,GAAeW,mBAAmBhB,GAAY2qB,UAAW8D,EAASluB,EAAY,6BAE9EnJ,EAAM6D,qBASM,cAAC,GAAD,CACIsI,MAAO50B,IAAYiB,IAAI,mCACvBmB,MAAOwuB,EACP3G,IAAK42B,EAAgB/7C,eACrB04C,WAAYA,EACZE,aAAcA,EACdC,OAjCM,WACtB36B,EpIsBD,SAAyBrhB,GAAuD,IAAjCivB,EAAgC,uDAAtB,EAC5D,MAAO,CACHrvB,KAAMyN,GAAWk1C,gBACjBviD,YACAivB,WoI1BSszB,CAAgBp9C,EAAMnF,aAiCf87C,KA9BI,WACpBz6B,EAAS2N,GAAgB7pB,EAAMnF,eA+BjBM,OAAOC,KAAK2+C,EAAgBx7C,WAAW6E,KAAI,SAAAS,GAAC,OAAI,cAAC,GAAD,CAAuBhJ,UAAWA,EAAWc,SAAUkI,GAAoBA,gBCLlIskB,I,OAAAA,IA/Cc,SAACnoB,GAC1B,IACMq9C,EADQ33B,aAAyC,SAAA/O,GAAK,OAAIA,EAAM46B,SAC9CE,QAAQ9tC,QAAO,SAACi0B,GAAD,MACnC,SAAAA,EAAIqF,QAAqBrF,EAAIp9B,OAAJ,UAAgBwF,EAAMnF,UAAtB,aAAyC,GAChE24C,EAAiBhD,GAAkBxwC,EAAMnF,WAoC/C,OACI,qBAAK+G,UAAU,oBAAf,SAnCkB,WAClB,GAAI4xC,EAAehzB,QAAU9E,EAAe4hC,SACxC,OAAKD,EAED,qBAAKz7C,UAAU,WAAf,SACI,cAAC,GAAD,CACIgD,SAAUy4C,EAAUz4C,SACpBkpB,MAAK,uBAAkBrxB,aAAe4gD,EAAUhL,eAA3C,SALM,KAYvB,OADiDz3C,YAAcoF,EAAMnF,WACzCJ,MACxB,KAAKiD,KAAcC,WACf,OAAO,cAAC,GAAD,CAAyB9C,UAAWmF,EAAMnF,YAErD,KAAK6C,KAAc/B,SACf,OAAO,cAAC,GAAD,CAAuBd,UAAWmF,EAAMnF,YAEnD,KAAK6C,KAAcyB,UACf,OAAO,cAAC,GAAD,IAEX,KAAKzB,KAAcuB,OACf,OAAO,cAAC,GAAD,IAEX,QACI,OAAO,oCAAQe,EAAMnF,UAAd,QAQbs6C,S,OTvCdoI,IAAWC,aAAahmC,MACxBtS,IAAKu4C,eAAeF,K,SAER7B,O,eAAAA,I,kBAAAA,Q,KAUL,IUrCHgC,GVqCS53B,GAAY,IACZnG,GAAaugB,wBAAsC,MAkJjDyd,GA/IH,SAAC39C,GACT,IAAM49C,EAAer7B,iBAAuB,MADlB,EAGgBvF,mBAA+B,IAH/C,mBAGnB6gC,EAHmB,KAGJC,EAHI,KAKpBC,EAAwB,WAC1Bx7C,IAAaqM,UAAU,mBAQrBovC,EAAkB,SAACnjD,GACrB,GAAIA,EAAW,CACX,IAAMkD,EAAc7E,IAAYqnB,iBAAiB1lB,GAGjDojD,EADe,cAAC,GAAD,CAAsBpjD,UAAWA,EAAWiH,MAAO/D,KAGlEwE,IAAaqM,UAAU,oBAOzBqvC,EAAqB,SAACx6B,GACxBq6B,EAAiB,GAAD,mBACTD,GAAiB,IADR,CAEZp6B,MAOFy6B,EAAoB,WACtBJ,EAAiB,KAMfK,EAAmB,WACjBN,GAAiBA,EAAcp4C,QAC/Bq4C,EAAiBD,EAAcO,MAAM,GAAI,KAqBjD7gC,qBAAU,WACNhb,IAAa0iB,SAAS,iBAAkB,6BACxC1iB,IAAa0iB,SAAS,WAAY,sBAClC1iB,IAAa0iB,SAAS,WAAY,sBAClC1iB,IAAa0iB,SAAS,aAAc,yBACpC1iB,IAAa0iB,SAAS,WAAY,wBACnC,IAkBH,OAZA1H,qBAAU,WACN,IAAM8gC,EAAeC,KAAS,WAC1B1zB,GAAeM,UAChB,KAGH,OAFAzH,OAAOC,iBAAiB,SAAU26B,GAClC56B,OAAOC,iBAAiB,QAAS26B,GAC1B,WACH56B,OAAOG,oBAAoB,SAAUy6B,GACrC56B,OAAOG,oBAAoB,QAASy6B,MAEzC,IAGC,cAAC1+B,GAAWmhB,SAAZ,CAAqBxlC,MAAO,CACxBk0B,aAAcyuB,EACd1uB,cAAe2uB,GAFnB,SAII,qBACIt8C,UAAU,MACVgf,IAAKg9B,EACL/7C,MAAO,CACH08C,SAAUz4B,IAEdtW,QA3BW,WACnBob,GAAeM,SAoBX,SASI,cAACszB,EAAA,EAAD,CAAaC,QAASC,IAAtB,SACA,eAAC,IAAD,WACI,cAAC,GAAD,CAAQtsB,UAAWpyB,EAAMoyB,YACzB,sBAAKxwB,UAAU,cAAf,UACI,eAAC,IAAD,WACI,cAAC,IAAD,CAAO2V,KAAK,IAAIonC,OAAO,EAAvB,SACI,cAAC,IAAD,CAAUr5C,KAAK,IAAIH,GAAIiE,kBAE3B,cAAC,IAAD,CAAOmO,KAAMnO,cAAb,SACI,cAAC,IAAD,CAAMjE,GAAImE,cAAV,SACI,eAAC,GAAD,CAAQkG,QAAS,kBAAMuuC,KAAyB12B,MAAM,QAAtD,cAAgEnuB,IAAYiB,IAAZ,uBAAhE,WAGR,cAAC,IAAD,CAAOod,KAAMjO,cAAb,SACI,cAAC,IAAD,CAAMnE,GAAIiE,cAAV,SACI,eAAC,GAAD,CAAQoG,QAAS,kBAAMuuC,KAAvB,cAAoD7kD,IAAYiB,IAAZ,wBAApD,cAZhB,MAiBI,cAAC,GAAD,CAAQqV,QAAS,WApHjCovC,MAoH6Dv3B,MAAOpD,GAAYkY,OAAhE,2BAEJ,eAAC,IAAD,WACI,cAAC,IAAD,CAAO5kB,KAAMjO,cAAeu1C,OAxGzB,kBAAM,cAAC,GAAD,CAAU9gC,iBAAkBigC,OAyGrC,cAAC,IAAD,CAAOzmC,KAAMnO,cAAgBy1C,OAxGzB,kBAAM,cAAC,GAAD,UA0Gd,cAAC,GAAD,IAjFK,WACjB,IAAKhB,EAAcp4C,OACf,OAAO,KAGX,IAAMq5C,EAAYjB,EAAcA,EAAcp4C,OAAS,GACjDs5C,EAAoB,CACtB72B,QAASg2B,EACTl2B,OAAQm2B,EACRr2B,YAAa+1B,EAAcp4C,OAAS,EACpCwiB,cAAc,GAIlB,OADgBG,eAAmB02B,EAAWC,GAqEjCC,GACD,cAAC,GAAD,IACA,cAAC,GAAD,cWjHLC,GAnDc,SAAC/B,EAA4BvmC,GACtD,IAAMqJ,EAAmCrJ,EAAMqJ,WACzCrmB,EAA6B,GAC7BozB,EAAiBtC,GAAkBT,GAASk1B,oBAK5Ch8B,GAAWzU,KAAKC,MAAQwuC,IAAuB1zB,GAAoBuD,GACnE3tB,EAAekyB,GAAmB3a,GAqBxC,OAAIuM,EAAS,EACF,MAGX/nB,OAAOC,KAAK4kB,GAAY3kB,SAAQ,SAACR,GAAD,OAvBR,SAACA,GACrB,IAAM81C,EAAsB/1C,YAAcC,GAE1C,GAAI81C,EAAoBl2C,OAASiD,KAAc/B,SAAU,CACrD,IAAMwjD,EAA8BxO,EAC9B9hB,EAAgB7O,EAAWnlB,GAAwBg0B,MACnDkrB,EAAoDoF,EAA4BrhD,OAAO+wB,GAG7F1zB,OAAOC,KAAK2+C,EAAgBx7C,WAAWoR,QAAO,SAACyvC,EAAiC3lD,GAC5E,IAAMkC,EAAWlC,EAEXqD,EAAiBi9C,EAAgBx7C,UAAU5C,GAAaqkB,EAAWnlB,GAAwBivB,QAAU5G,EAE3G,OADAk8B,EAAYzjD,IAAayjD,EAAYzjD,IAAa,GAAKmB,EAChDsiD,IACRzlD,IAQoC0lD,CAAgBxkD,MAG/DM,OAAOC,KAAKzB,GAAQ0B,SAAQ,SAAC5B,GACzB,IAAMkC,EAAWlC,EACbE,EAAOgC,IACHgb,EAAMlT,UAAU9H,GAAahC,EAAOgC,IAAcyD,EAAazD,KAC/DhC,EAAOgC,GAAYyD,EAAazD,GAAcgb,EAAMlT,UAAU9H,OAMnEhC,ICyCI2lD,GAtES,SAAC1jC,EAAejF,GAEpC,IACMoW,EAAiBtC,GAAkBT,GAASu1B,eAE5CnqC,EAAmB,GACnB4e,EAAwB,GACxBxT,EAAoB7J,EAAMkF,WAyDhC,OAtDA2E,EAAMwT,OAAO34B,SAAQ,SAACkN,GAClB,GAAIA,EAAM6rB,SAAW3H,GAAY6H,OAAjC,CAGA,IAAMwB,EAAmCl7B,aAAc2N,EAAM/N,MACvDglD,EAAkBj3C,EAAM3D,SACxB66C,EAAmBziD,KAAKK,MAAMmiD,GAEpC,GADoB1pB,EAAgB5gB,MAAMuqC,GAC1BhlD,OAASyH,KAAciT,QAAS,CAM5C,IAJA,IAAMuqC,EAAoB9jC,GAhBZ,IAgBqCmR,GAlB7C,EAoBF4yB,EAAe3iD,KAAK8rB,IAAI02B,EAAkBE,EAAkB5pB,EAAgB5gB,MAAMzP,OAAS,GACzFm6C,EAAc5iD,KAAKK,MAAMsiD,GAAgBF,EACtCxvC,EAAI,EAAGA,GAAK2vC,EAAa3vC,IAAK,CAEnC,IAAMmmB,EAAWN,EAAgB5gB,MAAMuqC,EAAmBxvC,GAC1D,GAAImmB,EAAS37B,OAASyH,KAAcmT,UAAW,CAG3CsB,EAAMuF,SAASxT,aAAaH,EAAM/N,KAAM47B,EAAS9gB,aAEjD,IAAMynC,EAAa7jD,IAAY+8B,cAAc1tB,EAAM/N,MAC7C83B,EAASlc,aAAeoK,EAAMxK,YAAazN,GACjD8F,KAAamf,SAASuvB,EAAYhiD,KAAK8kD,eAAvC,OAAuDvtB,QAAvD,IAAuDA,OAAvD,EAAuDA,EAAQW,UAAW5pB,YAAad,EAAM/N,OAGzF47B,EAAShhB,KACTA,EAAI9X,KAAK,CACLyG,QAAS0L,KAAWlH,MACpBqN,eAAgBrN,EAAM/N,KACtBf,IAAK28B,EAAShhB,MAItBuqC,EAAeH,EAAkBvvC,EAEjC,MACOmmB,EAAS37B,OAASyH,KAAciT,SACnCihB,EAAShhB,KACTA,EAAI9X,KAAK,CACLyG,QAAS0L,KAAWlH,MACpBqN,eAAgBrN,EAAM/N,KACtBf,IAAK28B,EAAShhB,MAK9B4e,EAAO12B,KAAK,CACR9C,KAAM+N,EAAM/N,KACZoK,SAAU+6C,SAIf,CACHG,WAAY1qC,EACZ2qC,aAAc/rB,I,qBF9Ef,IAWIgsB,IAAQ,EGrBJC,GAPK,WAChB,OAAIC,IHuBJF,IAAQ,EACDtC,GAAUl9B,SGrBV,MCIL2/B,GAAcv8C,QACW,cAA7B6f,OAAOjP,SAAS4rC,UAEe,UAA7B38B,OAAOjP,SAAS4rC,UAEhB38B,OAAOjP,SAAS4rC,SAASlgC,MACvB,2DAIS,SAASmgC,KACtB,GAA6C,kBAAmBC,UAAW,CAMzE,GAJkB,IAAIC,IACpB74C,IACA+b,OAAOjP,SAAS8L,YAEJ2c,SAAWxZ,OAAOjP,SAASyoB,OAIvC,OAGFxZ,OAAOC,iBAAiB,QAAQ,WAC9B,IAAM88B,EAAK,UAAM94C,IAAN,sBAEPy4C,KAmDV,SAAiCK,GAE/BC,MAAMD,GACHE,MAAK,SAACC,GAGiB,MAApBA,EAASvsB,SACwD,IAAjEusB,EAASC,QAAQzmD,IAAI,gBAAiBw9B,QAAQ,cAG9C2oB,UAAUO,cAAcC,MAAMJ,MAAK,SAACK,GAClCA,EAAaC,aAAaN,MAAK,WAC7Bj9B,OAAOjP,SAASysC,eAKpBC,GAAgBV,MAGnBW,OAAM,WACLtnD,QAAQub,IACN,oEAvEAgsC,CAAwBZ,GAIxBF,UAAUO,cAAcC,MAAMJ,MAAK,WACjC7mD,QAAQub,IACN,gHAMJ8rC,GAAgBV,OAMxB,SAASU,GAAgBV,GACvBF,UAAUO,cACPR,SAASG,GACTE,MAAK,SAACK,GACLA,EAAaM,cAAgB,WAC3B,IAAMC,EAAmBP,EAAaQ,WAClCD,IACFA,EAAiBE,cAAgB,WACA,cAA3BF,EAAiB9gC,QACf8/B,UAAUO,cAAchoB,WAK1Bh/B,QAAQub,IAAI,6CAKZvb,QAAQub,IAAI,6CAOvB+rC,OAAM,SAACrnD,GACND,QAAQC,MAAM,4CAA6CA,M,mBC1D7Ds4B,GAkFAoJ,G,UCpFEimB,GAA2B,WAC7B,MAAO,CACHC,SAAU1kD,KAAKK,MAAsB,EAAhBL,KAAK0I,UAAgB,EAC1Ci8C,UAAW3kD,KAAKK,MAAsB,EAAhBL,KAAK0I,UAAgB,EAC3Ck8C,aAAc5kD,KAAKK,MAAsB,EAAhBL,KAAK0I,UAAgB,EAC9C6O,OAAQvX,KAAKK,MAAsB,EAAhBL,KAAK0I,UAAgB,IAI1Cm8C,GAAoB,cACpBC,GAAsB,oBAKfC,GAA6C,CAAC,CACvD7rC,GAAI,WACJw0B,WAAS,sBACJnwC,KAAkBkG,KAAOxH,KAAKoF,MAD1B,gBAEJ9D,KAAkB6D,MAAQnF,KAAKmF,OAF3B,gBAGJ7D,KAAkBiG,MAAQvH,KAAK2f,aAH3B,gBAIJre,KAAkB4f,UAAYlhB,KAAKshB,YAJ/B,gBAKJhgB,KAAkBmG,KAAOzH,KAAKwgB,QAL1B,gBAMJlf,KAAkBgG,KAAOtH,KAAKyf,QAN1B,IASTspC,gBAAiBP,KACjBltC,OAAwB,IAAhBvX,KAAK0I,SACbomC,GAAIR,GAAU,GACd2W,OAAQ,EACR5F,KAAM,EACN7hD,KAAM,gBACN+yC,OAAQ,CAAC3B,GAAMmB,YAAanB,GAAMiB,QAClC5Z,UAAU,GAAD,OAAK4uB,GAAL,oBACT9oB,gBAAgB,GAAD,OAAK+oB,GAAL,gBACfz6B,MAAOqN,GAAgByH,OACvB6O,QAAM,sBACDhwC,KAAWoP,SAAW,IADrB,gBAEDpP,KAAW+O,IAAM,IAFhB,IAKN0M,UAAW,CAAExd,KAAK+X,kBAAmB,KAAM/X,KAAKiU,eAAgBjU,KAAK4S,OAAQ5S,KAAKuT,QAAS,KAAMvT,KAAKoU,WAAY,KAAO,KAAO,KAAO,KAAOpU,KAAKmU,YAAc,KAAO,KAAO,KAAO,OACvL,CACC8I,GAAI,WACJw0B,UAAU,gBACLnwC,KAAkBgG,KAAOtH,KAAKuf,QAEnCwpC,gBAAiBP,KACjBjnD,KAAM,gBACN+Z,OAAwB,IAAhBvX,KAAK0I,SACbomC,GAAoB,IAAhB9uC,KAAK0I,SACTu8C,OAAQ,EACR5F,KAAM,EACNppB,UAAU,GAAD,OAAK4uB,GAAL,kBACT9oB,gBAAgB,GAAD,OAAK+oB,GAAL,gBACfz6B,MAAOqN,GAAgB6H,KACvBgR,OAAQ,CAAC3B,GAAMkB,cACf9B,QAAM,sBACDhwC,KAAWoP,SAAW,IADrB,gBAEDpP,KAAW0P,MAAQ,IAFlB,IAKN+L,UAAW,CAAExd,KAAKiU,eAAgB,KAAM,KAAM,KAAM,KAAMjU,KAAKkF,OAAQlF,KAAK0f,cAAe1f,KAAKsgB,YAAatgB,KAAK4gB,YAAa,KAAM5gB,KAAK0S,QAAS,KAAM,KAAM,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAM1S,KAAK+gB,YAAa/gB,KAAKoF,OACrP,CACC6X,GAAI,WACJw0B,UAAU,gBACLnwC,KAAkBgG,KAAOtH,KAAKyf,QAGnCspC,gBAAiBP,KACjBjnD,KAAM,4BACN+Z,OAAwB,IAAhBvX,KAAK0I,SACbomC,GAAoB,IAAhB9uC,KAAK0I,SACTu8C,OAAQ,EACR5F,KAAM,EACN9O,OAAQ,CAAC3B,GAAMiB,QACf7B,QAAM,sBACDhwC,KAAW4P,MAAQ,IADlB,gBAED5P,KAAWwP,OAAS,GAFnB,IAINyoB,UAAU,GAAD,OAAK4uB,GAAL,kBACT9oB,gBAAgB,GAAD,OAAK+oB,GAAL,iBACfz6B,MAAOqN,GAAgBmH,MACvBplB,UAAW,CAAExd,KAAKiT,iBAAkB,KAAM,KAAM,KAAMjT,KAAKwS,kBAC5D,CACCyK,GAAI,WACJ8rC,gBAAiBP,KACjB/W,UAAW,GACXlwC,KAAM,aACN+Z,OAAwB,IAAhBvX,KAAK0I,SACbomC,GAAoB,IAAhB9uC,KAAK0I,SACTu8C,OAAQ,EACR5F,KAAM,EACNppB,UAAU,GAAD,OAAK4uB,GAAL,kBACT9oB,gBAAgB,GAAD,OAAK+oB,GAAL,qBACfvU,OAAQ,CAAC3B,GAAMe,aACf3B,OAAO,gBACFhwC,KAAW4P,MAAQ,IAExB6L,UAAW,CAAE,KAAM,KAAM,KAAM,KAAMxd,KAAKuT,QAASvT,KAAKogB,aAAcpgB,KAAKsU,gBAC5E,CACC2I,GAAI,WACJw0B,UAAW,GACXsX,gBAAiBP,KACjBjnD,KAAM,eACN+Z,OAAwB,IAAhBvX,KAAK0I,SACbomC,GAAoB,IAAhB9uC,KAAK0I,SACTu8C,OAAQ,EACR5F,KAAM,EACNppB,UAAU,GAAD,OAAK4uB,GAAL,kBACT9oB,gBAAgB,GAAD,OAAK+oB,GAAL,gBACfvU,OAAQ,CAAC3B,GAAMoB,YAAapB,GAAMe,aAClC3B,OAAO,gBACFhwC,KAAW4O,IAAM,IAEtB6M,UAAW,CAAE,KAAM,KAAM,KAAMxd,KAAKgT,eACrC,CACCiK,GAAI,WACJ8rC,gBAAiBP,KACjB/W,UAAW,GACXlwC,KAAM,gBACN+Z,OAAwB,IAAhBvX,KAAK0I,SACbomC,GAAoB,IAAhB9uC,KAAK0I,SACTu8C,OAAQ,EACR5F,KAAM,EACNppB,UAAU,GAAD,OAAK4uB,GAAL,oBACT9oB,gBAAgB,GAAD,OAAK+oB,GAAL,qBACfrrC,UAAW,CAAE,KAAM,KAAM,KAAM,KAAM,MACrCu0B,OAAO,gBACFhwC,KAAW4O,IAAM,KAEvB,CACCsM,GAAI,WACJw0B,UAAW,GACXsX,gBAAiBP,KACjBjnD,KAAM,eACN+Z,OAAwB,IAAhBvX,KAAK0I,SACbomC,GAAoB,IAAhB9uC,KAAK0I,SACTu8C,OAAQ,EACR5F,KAAM,EACNppB,UAAU,GAAD,OAAK4uB,GAAL,oBACT9oB,gBAAgB,GAAD,OAAK+oB,GAAL,oBACfrrC,UAAW,CAAExd,KAAKiT,iBAAkB,KAAM,KAAM,MAChD8+B,OAAO,gBACFhwC,KAAW4O,IAAM,KAEvB,CACCsM,GAAI,WACJ8rC,gBAAiBP,KACjB/W,UAAW,GACXlwC,KAAM,uBACN+Z,OAAwB,IAAhBvX,KAAK0I,SACbomC,GAAoB,IAAhB9uC,KAAK0I,SACTu8C,OAAQ,EACR5F,KAAM,EACNppB,UAAU,GAAD,OAAK4uB,GAAL,kBACT9oB,gBAAgB,GAAD,OAAK+oB,GAAL,qBACfrrC,UAAW,CAAE,KAAM,KAAM,KAAM,KAAM,MACrCu0B,OAAO,gBACFhwC,KAAW4O,IAAM,KAEvB,CACCsM,GAAI,WACJw0B,UAAW,GACXsX,gBAAiBP,KACjBjnD,KAAM,uBACN+Z,OAAwB,IAAhBvX,KAAK0I,SACbomC,GAAoB,IAAhB9uC,KAAK0I,SACTu8C,OAAQ,EAER5F,KAAM,EACNppB,UAAU,GAAD,OAAK4uB,GAAL,kBACT9oB,gBAAgB,GAAD,OAAK+oB,GAAL,qBACfrrC,UAAW,CAAExd,KAAKiT,iBAAkB,KAAM,KAAM,KAAMjT,KAAKqhB,WAAYrhB,KAAKigB,OAAQjgB,KAAKmgB,UACzF4xB,OAAO,gBACFhwC,KAAW4O,IAAM,IAEvB,CACCsM,GAAI,WACJw0B,UAAW,GACXsX,gBAAiBP,KACjBjnD,KAAM,kBACN+Z,OAAwB,IAAhBvX,KAAK0I,SACbomC,GAAoB,IAAhB9uC,KAAK0I,SACTu8C,OAAQ,EACR5F,KAAM,EACNppB,UAAU,GAAD,OAAK4uB,GAAL,kBACT9oB,gBAAgB,GAAD,OAAK+oB,GAAL,qBACfrrC,UAAW,CAAExd,KAAKiT,iBAAkB,KAAM,KAAM,MAChD8+B,OAAO,gBACFhwC,KAAW4O,IAAM,MCpLbs4C,GAAwB,WACjC,MAAO,CACHprC,iBAAaF,EACb0+B,aAAc7mC,KAAKC,MACnByzC,SAAU1zC,KAAKC,MACfwuC,mBAAoBzuC,KAAKC,QCvBpB0zC,GAAmB,GCTnBC,GAAuB,WAIhC,IAFA,IAAM1oD,EAAS,GACP2F,EAAiB1E,YAA4C4C,IAAU2B,WAAWrB,OAAO,GAAzFwB,aACC2Q,EAAI,EAAGA,EAAI3Q,EAAc2Q,IAC9B,GAAIjT,KAAK0I,SAAW,GAChB/L,EAAO2D,KAAK,UACT,CACH,IAAMglD,EAAaC,GAAWtpD,MAC9BU,EAAO2D,KAAKglD,GAGpB,OAAO3oD,GAGL4oD,GAAa,SAAIC,GACnB,IAAMC,EAActnD,OAAOuI,OAAO8+C,GAElC,OAAOC,EADazlD,KAAKK,MAAML,KAAK0I,SAAW+8C,EAAWh9C,UCQjDi9C,GAAkB,GAEzBC,GAAW,SAACniC,EAAmB1E,GACjC,IAAKA,EAAO1G,IAAI3P,OACZ,OAAO+a,EAIX,IAAM4uB,EAAatzB,EAAO1G,IAAIhS,KAAI,SAACw/C,GAC/B,OAAO,2BACAA,GADP,IAEI7lD,KAAM0R,KAAKC,WAGnB,MAAM,GAAN,mBACO0gC,GADP,YAEO5uB,K,+BCzBEqiC,GAAuC,CAAC,CACjDroD,KAAM,cACN45B,OAAQ3H,GAAY6H,OACpBre,MAAO,CACH,WACA,WACA,WACA,YAEJrR,SAAU,EACVkQ,UAAWG,KACX6tC,iBAAkB,GAClBx0C,KAAM,eAsEJnG,GAAc,SAAC46C,EAAoCjnC,GACrD,IAAM7F,EAAQ6F,EAAOzT,mBAChB1E,QAAO,SAAC6S,GAAD,QAAkBA,KACzBpT,KAAI,SAACoT,GAAD,OAAgBA,EAAWN,MAEpC,OAAO6sC,EAAgB3/C,KAAI,SAAC4/C,GACxB,GAAIA,EAAIxoD,OAASshB,EAAO1T,UAAW,CAC/B,IACM0M,EADmCla,aAAckhB,EAAO1T,WAC5B2M,oBAAoBiuC,GAEtD,OAAO,2BACAA,GADP,IAEI5uB,OAAQ3H,GAAY6H,OACpBre,QACAnB,cAGR,OAAOkuC,MAIT16C,GAAgB,SAACkY,EAA0B1E,GAC7C,OAAO0E,EAAMpd,KAAI,SAAC4/C,GACd,GAAIA,EAAIxoD,OAASshB,EAAO1T,UAAW,CAC/B,IAAMxD,EAAWo+C,EAAIp+C,SAAW,EAIhC,OAAO,2BACAo+C,GADP,IAEIp+C,WACAjC,WAAOiU,EACPjO,eAAWiO,IAGnB,OAAOosC,MAmBTt6C,GAAe,SAAC8X,EAA0B1E,GAC5C,OAAO0E,EAAMpd,KAAI,SAAC4/C,GACd,OAAIA,EAAIxoD,OAASshB,EAAO1T,UACb,2BACA46C,GADP,IAEIr6C,UAAWmT,EAAOnT,UAClBhG,WAAOiU,IAGRosC,MAITp6C,GAAW,SAAC4X,EAA0B1E,GACxC,OAAO0E,EAAMpd,KAAI,SAAC4/C,GACd,OAAIA,EAAIxoD,OAASshB,EAAO1T,UACb,2BACA46C,GADP,IAEIrgD,MAAOmZ,EAAOnZ,QAGfqgD,MAKTn6C,GAAqB,SAAC2X,EAA0B1E,GAClD,OAAO0E,EAAMpd,KAAI,SAAC4/C,GACd,GAAIA,EAAIxoD,OAASshB,EAAO1T,UAAW,CAC/B,IAAMzF,EAAQqgD,EAAIrgD,MAClB,IAAKA,EAAO,MAAM,IAAI5I,MAAM,6BAG5B,OAFA4I,EAAM62B,YAAN,sBAAwB72B,EAAM62B,aAAe,IAA7C,CAAiD1d,EAAOhT,cAEjD,2BACAk6C,GADP,IAEIrgD,UAGR,OAAOqgD,MAKTj6C,GAAsB,SAACyX,EAA0B1E,GACnD,OAAO0E,EAAMpd,KAAI,SAAC4/C,GACd,GAAIA,EAAIxoD,OAASshB,EAAO1T,UAAW,CAC/B,IAAMzF,EAAQqgD,EAAIrgD,MAClB,IAAKA,EAAO,MAAM,IAAI5I,MAAM,6BAC5B,IAAM+O,EAAcnG,EAAM62B,YAAa,GACvC,IAAK1wB,EAAa,OAAOk6C,EAEzB,OAAQl6C,EAAYyxB,YAChB,KAAKx0B,KAAgBkW,KACjBtZ,EAAM8D,QAAU9D,EAAM8D,QAAQrD,KAAI,SAACyN,GAC/B,OAAI7K,aAAc6K,IAAMA,EAAErW,OAASsO,EAAY2wB,QACpC,2BACA5oB,GADP,IAEI2D,SAAU1L,EAAYsT,SAGvBvL,KAUnB,OAJAlO,EAAM62B,YAAN,YACO72B,EAAM62B,YAAa4kB,MAAM,IAGzB,2BACA4E,GADP,IAEIrgD,UAGR,OAAOqgD,MAKTh6C,GAAY,SAACwX,EAA0B1E,GAA6B,IAC/D7S,EAAU6S,EAAV7S,OACP,OAAOuX,EAAMpd,KAAI,SAAC4/C,GACd,GAAIA,EAAIxoD,OAASshB,EAAO1T,UAAW,CAC/B,IAAMzF,EAAK,2BAAQqgD,EAAIrgD,OAAZ,IAAoBsG,WAC/B,OAAO,2BACA+5C,GADP,IAEIrgD,UAGR,OAAOqgD,MAITC,GAAgB,SAACziC,EAA0B1E,GAC7C,OAAO0E,EAAMpd,KAAI,SAAC4/C,GACd,GAAIA,EAAIxoD,OAASshB,EAAO1T,UAAW,CAC/B,IAAMzF,EAAQqgD,EAAIrgD,MAClB,IAAKA,EAAO,MAAM,IAAI5I,MAAM,6BAc5B,OAAO,2BACAipD,GADP,IAEIrgD,UAGR,OAAOqgD,MAITE,GAA0B,SAAC1iC,EAA0B1E,GACvD,OAAO0E,EAAMpd,KAAI,SAAC4/C,GACd,GAAIA,EAAIxoD,OAASshB,EAAO1T,UAAW,CAC/B,IAAMzF,EAAQqgD,EAAIrgD,MAClB,IAAKA,EAAO,MAAM,IAAI5I,MAAM,6BAY5B,OAVA4I,EAAM8D,QAAU9D,EAAM8D,QAAQrD,KAAI,SAAA+/C,GAC9B,OAAIA,EAAGjtC,KAAO4F,EAAO5F,GACV,2BACAitC,GACArnC,EAAO7V,QAGXk9C,KAGJ,2BACAH,GADP,IAEIrgD,UAGR,OAAOqgD,MAKTL,GAAW,SAACniC,EAA0B1E,GACxC,IAAMsnC,EAAiBtnC,EAAOkY,OAC9B,OAAKovB,EAAe39C,OAIb+a,EAAMpd,KAAI,SAAC4/C,GACd,IAAMK,EAAgBD,EAAe9sC,MAAK,SAAC4d,GAAD,OAAOA,EAAE15B,OAASwoD,EAAIxoD,QAChE,GAAI6oD,EAAe,CACf,IAAMz+C,EAAWy+C,EAAcz+C,SAG/B,OAAO,2BACAo+C,GADP,IAEIp+C,aAIR,OAAOo+C,KAfAxiC,GAmBThY,GAAkB,SAACgY,EAA0B1E,GAC/C,OAAO0E,EAAMpd,KAAI,SAAC4/C,GACd,OAAIA,EAAIxoD,OAASshB,EAAO1T,UACb,2BACA46C,GADP,IAKIluC,UAAWwuC,KAAUN,EAAIluC,UAAWgH,EAAOrT,KAAM,CAAE86C,WAAYC,OAGhER,MAITS,GAAwB,SAACjjC,EAA0B1E,GACrD,OAAO0E,EAAMpd,KAAI,SAAC4/C,GACd,GAAIA,EAAIxoD,OAASshB,EAAO1T,UAAW,CAC/B,IAAM06C,EAAmBE,EAAIF,iBAAiBY,SAE9C,OADAZ,EAAiBhnC,EAAO6nC,WAAa7nC,EAAOniB,OACrC,2BACAqpD,GADP,IAEIF,qBAGR,OAAOE,MAIT95C,GAAiC,SAACsX,EAA0B1E,GAC9D,OAAO0E,EAAMpd,KAAI,SAAC4/C,GAId,OAHIA,EAAIxoD,OAASshB,EAAO1T,WAAa46C,EAAIrgD,QACrCqgD,EAAIrgD,MAAM6rC,uBAAyB1yB,EAAO3S,uBAEvC65C,MAgETQ,GAAiB,SAACI,EAAyBC,GAA1B,OAAiDA,GC3X3DC,GAA4C,CACrDzkD,OAAQ,EACRb,KAAM,EACNI,KAAM,GACNI,QAAS,EACTF,MAAO,EACPJ,KAAM,IClDGqlD,IAAkB,ECoCzBC,GAAuB,SAACxjC,EAA6B3lB,EAAsB24C,GAC7E,IAAM7kB,EAAmC,2BAClCnO,EAAM3lB,IAD4B,IAErC2lB,MAAOgzB,IAEX,OAAO,2BACAhzB,GADP,mBAEK3lB,EAAY8zB,KAIfs1B,GAAwB,SAACzjC,EAA6B1E,GACxD,IAAM+S,EAAQrO,EAAM1E,EAAOjhB,WAAWg0B,MAAQ,EACxCF,EAAmC,2BAClCnO,EAAM1E,EAAOjhB,YADqB,IAErCg0B,UAEJ,OAAO,2BACArO,GADP,mBAEK1E,EAAOjhB,UAAY8zB,KAKtB9E,GAAkB,SAACrJ,EAA6B1E,GAA+B,IAChEooC,EAAiBpoC,EAA1BgO,QACFA,EAAUtJ,EAAM1E,EAAOjhB,WAAWivB,QAAUo6B,EAC5Cv1B,EAAmC,2BAClCnO,EAAM1E,EAAOjhB,YADqB,IAErCivB,YAEJ,OAAO,2BACAtJ,GADP,mBAEK1E,EAAOjhB,UAAY8zB,KAItByuB,GAAkB,SAAC58B,EAA6B1E,GAA+B,IAChEqoC,EAAoBroC,EAA7BgO,QACFA,EAAUtJ,EAAM1E,EAAOjhB,WAAWivB,QAAUq6B,EAC5Cx1B,EAAmC,2BAClCnO,EAAM1E,EAAOjhB,YADqB,IAErCivB,YAEJ,OAAO,2BACAtJ,GADP,mBAEK1E,EAAOjhB,UAAY8zB,KAItB5E,GAAsB,SAACvJ,EAA6B1E,GAEtD,ICzEkCjhB,EDyERihB,EAAOjhB,aCxEZ2C,IAAUC,WAC3B5C,IAAc2C,IAAUU,aACxBrD,IAAc2C,IAAU+B,aACxB1E,IAAc2C,IAAUkC,SDsExB,OAAO8gB,EC1EsB,IAAC3lB,ED6E1BH,EAASohB,EAATphB,KACFw3C,EAAQ,sBACN1xB,EAAM1E,EAAOjhB,WAA6Cq3C,UADpD,CAEVx3C,IAEEi0B,EAA6C,2BAC5CnO,EAAM1E,EAAOjhB,YAD+B,IAE/Cq3C,aAEJ,OAAO,2BACA1xB,GADP,mBAEK1E,EAAOjhB,UAAY8zB,KAKfy1B,GAA6C,CACtDv1B,MAAO,EACPrO,MAAO9E,EAAe+E,SACtBqJ,QAAS,GAGAu6B,IAA4C,sBACpD7mD,IAAUC,UAD0C,2BACxB2mD,IADwB,IACDlS,SAAU,MADT,gBAEpD10C,IAAUU,YAF0C,2BAEvBkmD,IAFuB,IAEAlS,SAAU,CAAEj5C,KAAKkF,WAFjB,gBAGpDX,IAAUc,OAAS,CAAEuwB,MAAO,EAAG/E,QAAS,EAAGtJ,MAAO9E,EAAe6R,QAHb,gBAIpD/vB,IAAUiB,WAAa2lD,IAJ6B,gBAKpD5mD,IAAUmB,KAAO,CAAEkwB,MAAO,EAAG/E,QAAS,EAAGtJ,MAAO9E,EAAe+E,WALX,gBAMpDjjB,IAAUqB,OAASulD,IANiC,gBAOpD5mD,IAAUyB,OAAS,CAAE4vB,MAAO,EAAG/E,QAAS,EAAGtJ,MAAO9E,EAAe6R,QAPb,gBAQpD/vB,IAAUuB,QAAUqlD,IARgC,gBASpD5mD,IAAU2B,UAAY,CAAE0vB,MAAO,EAAG/E,QAAS,EAAGtJ,MAAO9E,EAAe6R,QAThB,gBAUpD/vB,IAAU+B,YAV0C,2BAUtB6kD,IAVsB,IAUClS,SAAU,CAAEj5C,KAAKiU,eAAgBjU,KAAK4S,WAVvC,gBAWpDrO,IAAUiC,OAAS2kD,IAXiC,gBAYpD5mD,IAAUkC,SAZ0C,2BAYzB0kD,IAZyB,IAYFlS,SAAU,CAAEj5C,KAAKqa,MAAOra,KAAKka,aAZ3B,IE9DnDmxC,GAAa,SAACxoC,GAChB,MAAO,CACHthB,KAAMshB,EAAOthB,KACbyiC,OAAQnhB,EAAOmhB,OACfxiC,KAAMqhB,EAAOw0B,SACbC,UAAWz0B,EAAOy0B,UAClB8B,cAAev2B,EAAO/e,KACtBq5C,UAAW3nC,KAAKC,MAChByzC,SAAU1zC,KAAKC,MACf9J,SAAU,IAIL2/C,GAAqC,CAC9CC,UAAW,GACX/S,QAAS,ICtDAgT,GAAsB,GCDpBC,gBAA4B,CACvC1uC,YZ4MmE,WACQ,IAA3EwK,EAA0E,uDAA1CuhC,GAAoBjmC,EAAsB,uCAE1E,OAAQA,EAAOrhB,MAEX,KAAKyN,KAAWwF,oBAAsB,IAAD,EAK5BoO,EAHDnO,EAF6B,EAE7BA,aACAC,EAH6B,EAG7BA,SACAC,EAJ6B,EAI7BA,OAEE2I,EAAagK,EAAMlK,MAAK,SAACzF,GAAD,OAAOA,EAAEqF,KAAOvI,KACxC8I,EAAYD,EAAWC,UAAUrT,KAAI,SAACuhD,EAASl0C,GACjD,OAAIA,IAAU7C,EAAmB4I,EAAWC,UAAU5I,GAClD4C,IAAU5C,EAAiB2I,EAAWC,UAAU7I,GAC7C+2C,KAGX,OAAOnkC,EAAMpd,KAAI,SAACuhD,GACd,OAAIA,IAAYnuC,EACL,2BACAmuC,GADP,IAEIluC,cAGDkuC,KAIf,KAAKz8C,KAAW08C,0BAA2B,MAMlC9oC,EAHa+oC,EAHqB,EAGnCl3C,aACAC,EAJmC,EAInCA,SACAk3C,EALmC,EAKnCA,eAGEC,EAAiBvkC,EAAMlK,MAAK,SAACzF,GAAD,OAAOA,EAAEqF,KAAO2uC,KAC5CnqD,EAAOqqD,EAAetuC,UAAU7I,GAEtC,OAAO4S,EAAMpd,KAAI,SAACuhD,GACd,GAAIA,EAAQzuC,KAAO2uC,EAAkB,CAEjC,IAAMpuC,EAAYkuC,EAAQluC,UAAUitC,SAEpC,OADAjtC,EAAU7I,GAAY,KACf,2BACA+2C,GADP,IAEIluC,cAED,GAAIkuC,EAAQzuC,KAAO4uC,EAAgB,CAEtC,IAAMruC,EAAYkuC,EAAQluC,UAAUitC,SAC9BjzC,EAAQgG,EAAU2gC,WAAU,SAACrN,GAAD,OAAmB,OAATA,KAG5C,OAFAtzB,EAAUhG,GAAS/V,EAEZ,2BACAiqD,GADP,IAEIluC,cAGR,OAAOkuC,KAIf,KAAKz8C,KAAW4F,mBAAqB,IAAD,EACfgO,EAATphB,EADwB,EACxBA,KAER,OAAO8lB,EAAMpd,KAAI,SAACuhD,GACd,GAAIA,EAAQzuC,KAAO4F,EAAOnO,aAAc,CACpC,IAAM8I,EAAYkuC,EAAQluC,UAAUitC,SAChC71C,EAAUiO,EAA2BjO,OAMzC,OALe,OAAXA,QAA8B+I,IAAX/I,IACnBA,EAAS4I,EAAU2gC,WAAU,SAACxf,GAAD,OAAkB,OAARA,QAAwBhhB,IAARghB,MAE3DnhB,EAAU5I,GAAWnT,EAEd,2BACAiqD,GADP,IAEIluC,cAGR,OAAOkuC,KAIf,KAAKz8C,KAAW6F,wBAA0B,IAAD,EAChB+N,EAAblO,EAD6B,EAC7BA,SAER,OAAO4S,EAAMpd,KAAI,SAACoT,GACd,GAAIA,EAAWN,KAAO4F,EAAOnO,aAAc,CACvC,IAAM8I,EAAYD,EAAWC,UAAUrT,KAAI,SAACuhD,EAASl0C,GAAV,OAAoBA,IAAU7C,EAAW+2C,EAAU,QAC9F,OAAO,2BACAnuC,GADP,IAEIC,cAGR,OAAOD,KAIf,KAAKtO,KAAW8F,gBAAiB,MAEG8N,EAAxB7N,EAFqB,EAErBA,cAAevT,EAFM,EAENA,KACvB,OAAO8lB,EAAMpd,KAAI,SAACoT,GACd,OAAIA,EAAWN,KAAO4F,EAAOnO,aAClB,2BACA6I,GADP,IAEIk0B,UAAU,2BACHl0B,EAAWk0B,WADT,mBAEJnwC,KAAkB0T,GAAiBvT,MAIzC8b,KAIf,KAAKtO,KAAWgG,gBAAiB,MAEH4N,EAAlB7N,EAFqB,EAErBA,cACR,OAAOuS,EAAMpd,KAAI,SAACoT,GACd,OAAIA,EAAWN,KAAO4F,EAAOnO,aAClB,2BACA6I,GADP,IAEIk0B,UAAU,2BACHl0B,EAAWk0B,WADT,mBAEJnwC,KAAkB0T,GAAiB,SAIzCuI,KAGf,KAAKtO,KAAWiG,iBAAkB,MAEb2N,EAATthB,EAFsB,EAEtBA,KACR,OAAOgmB,EAAMpd,KAAI,SAACoT,GACd,OAAIA,EAAWN,KAAO4F,EAAOnO,aAClB,2BACA6I,GADP,IAEIhc,SAGDgc,KAGf,KAAKtO,KAAW88C,MAAO,MAEJlpC,EAAPgwB,EAFW,EAEXA,GACR,OAAOtrB,EAAMpd,KAAI,SAACoT,GACd,OAAIA,EAAWN,KAAO4F,EAAOnO,aAClB,2BACA6I,GADP,IAEIs1B,GAAIt1B,EAAWs1B,GAAKA,IAGrBt1B,KAcnB,OAAOgK,GYrXPvX,OCT6C,WAA4D,IAA3DuX,EAA0D,uDAAhCnM,IAAUyH,EAAsB,uCACxG,OAAQA,EAAOrhB,MACX,KAAKyN,EAAW+8C,kBACZ,IAAMC,EAAYppC,EAElB,OAAO,2BACA0E,GADP,IAEI1E,OAAQ,CACJ3V,MAAO++C,EAAU/+C,MACjB4V,OAAQmpC,EAAUnpC,OAClBK,OAAQ8oC,EAAU9oC,OAClB3hB,KAAMyqD,EAAUC,cAI5B,KAAKj9C,EAAWiU,UACZ,IAAMipC,EAAatpC,EAGbxH,EAASkM,EAAMlM,OAAOlR,KAAI,SAACyN,GAC7B,OAAIA,EAAErW,OAAS4qD,EAAWj/C,MACf,2BACA0K,GADP,IAEI2D,SAAU4wC,EAAW5wC,WAGtB3D,KAGX,OAAO,2BACA2P,GADP,IAEIlM,WAGR,KAAKpM,EAAWmU,kBAEZ,OAAO,2BACAmE,GADP,IAEI1E,YAAQlF,IAIpB,OAAO4J,GDhCP3J,OXV6C,WAA2E,IAA1E2J,EAAyE,uDAA/C0hC,KAAyBpmC,EAAsB,uCACvH,OAAQA,EAAOrhB,MACX,KAAK4qD,EAAeC,UAChB,OAAO,2BACA9kC,GADP,IAEI1J,YAAarI,KAAKC,QAG1B,KAAK22C,EAAe1C,SAGhB,IAAM4C,EAAkBzpC,EAA0BrY,UAC5Cy5C,EAAwC,OAAnBqI,EAA0B/kC,EAAM08B,mBAAqBzuC,KAAKC,MAC/E4mC,EAAe90B,EAAM2hC,SAE3B,OAAO,2BACA3hC,GADP,IAEI80B,eACA4H,qBACAiF,SAAU1zC,KAAKC,QAI3B,OAAO8R,GWZP3iB,KVZiC,WAA0D,IAAzD2iB,EAAwD,uDAAxC4hC,GAAkBtmC,EAAsB,uCAC1F,OAAQA,EAAOrhB,MACX,KAAKyN,KAAW6P,QAEZ,OAAOyI,EAAS1E,EAA4Bhf,OAEpD,OAAO0jB,GUOP2pB,UTayC,WAAuE,IAAtE3pB,EAAqE,uDAA9C6hC,KAAwBvmC,EAAsB,uCAC/G,OAAQA,EAAOrhB,MACX,KAAKyN,GAAWgiB,QAAS,MAEHpO,EAAVphB,EAFa,EAEbA,KAFa,EAGHohB,EAAZjO,EAHe,EAGfA,OACN,YAAe+I,IAAX/I,IAEgB,KADhBA,EAAS2S,EAAM42B,WAAU,SAACrN,GAAD,OAAmB,OAATA,MAIzB,GAAN,mBAAYvpB,GAAZ,CAAmB9lB,IAGpB8lB,EAAMpd,KAAI,SAACuhD,EAASl0C,GAAV,OAAoBA,IAAU5C,EAASnT,EAAOiqD,KAGnE,KAAKz8C,GAAW4iC,oBAAsB,IAAD,EAI5BhvB,EAFDlO,EAF6B,EAE7BA,SACAC,EAH6B,EAG7BA,OAGJ,OAAO2S,EAAMpd,KAAI,SAACuhD,EAASl0C,GACvB,OAAIA,IAAU7C,EAAmB4S,EAAM3S,GACnC4C,IAAU5C,EAAiB2S,EAAM5S,GAC9B+2C,KAGf,KAAKz8C,GAAWkiB,WAAa,IAAD,EACFtO,EAAdlO,EADgB,EAChBA,SAER,OAAO4S,EAAMpd,KAAI,SAACuhD,EAASl0C,GAAV,OAAoBA,IAAU7C,EAAW+2C,EAAU,QAIxE,KAAKz8C,GAAWmiB,kBAAoB,IAAD,EAG1BvO,EADDwO,EAF2B,EAE3BA,MAGJ,MAAM,GAAN,mBACO9J,GADP,YAEO9Z,MAAM4jB,GAAOk7B,KAAK,QAKjC,OAAOhlC,GS5DPpL,IRXoC,WAA6D,IAA5DoL,EAA2D,uDAAvCkiC,GAAiB5mC,EAAsB,uCAChG,OAAQA,EAAOrhB,MACX,KAAKyN,IAAW4N,YAAc,IAAD,EACiBgG,EAAnCjG,EADkB,EAClBA,MAAO9R,EADW,EACXA,QAAS6R,EADE,EACFA,eAChBnc,EAAgBoc,EAAhBpc,IAAKC,EAAWmc,EAAXnc,QACNqD,EAAO0R,KAAKC,MAClB,MAAM,CAAE,CACA3K,UACA6R,iBACAlc,UACAD,MACAsD,SALR,mBAOOyjB,IAGX,KAAK6kC,EAAe1C,SAChB,OAAOA,GAASniC,EAAO1E,GAE/B,OAAO0E,GQPPwT,OPiC8C,WAA0F,IAAzFxT,EAAwF,uDAA7DqiC,GAAmB/mC,EAA0C,uCACvI,OAAQA,EAAOrhB,MACX,KAAKyN,KAAWC,YACZ,OAAOA,GAAYqY,EAAO1E,GAE9B,KAAK5T,KAAWI,cACZ,OAAOA,GAAckY,EAAO1E,GAEhC,KAAK5T,KAAWM,gBAEZ,OAAOA,GAAgBgY,EAAO1E,GAElC,KAAK5T,KAAWu7C,sBACZ,OAAOA,GAAsBjjC,EAAO1E,GAKxC,KAAK5T,KAAWQ,aACZ,OAAOA,GAAa8X,EAAO1E,GAE/B,KAAK5T,KAAWU,SACZ,OAAOA,GAAS4X,EAAO1E,GAE3B,KAAK5T,KAAWW,mBACZ,OAAOA,GAAmB2X,EAAO1E,GAErC,KAAK5T,KAAWa,oBACZ,OAAOA,GAAoByX,EAAO1E,GAEtC,KAAK5T,KAAWc,UACZ,OAAOA,GAAUwX,EAAO1E,GAE5B,KAAK5T,KAAW+6C,cACZ,OAAOA,GAAcziC,EAAO1E,GAEhC,KAAK5T,KAAWg7C,wBACZ,OAAOA,GAAwB1iC,EAAO1E,GAE1C,KAAK5T,KAAWgB,+BACZ,OAAOA,GAA+BsX,EAAO1E,GAEjD,KAAKupC,EAAe1C,SACjB,OAAOA,GAASniC,EAAO1E,GAG9B,OAAO0E,GO9EP/c,UNbkD,WACyC,IADxC+c,EACuC,uDADXsjC,GAC5BhoC,EAAuC,uCAEpF4N,EAAe,SAAC67B,GAElB,OAAOpqD,OAAOC,KAAKolB,GAAO7Q,QAA2B,SAACC,EAAKtU,GACvD,IAAMK,EAAWL,EAEjB,OADAsU,EAAIjU,GAAY6kB,EAAM7kB,IAAc4pD,EAAe5pD,IAAa,GACzDiU,IACR,KAGP,OAAQkM,EAAOrhB,MACX,KAAKyN,GAAWwhB,aACZ,IAAM67B,EAAkBzpC,EAAwBrY,UAChD,OAAOimB,EAAa67B,GAExB,KAAKr9C,GAAWqwC,gBACZ,IAAMkN,EAAqB3pC,EAAwBrY,UACnD,OAAOtI,OAAOC,KAAKolB,GAAO7Q,QAA2B,SAACC,EAAKtU,GACvD,IAAMK,EAAWL,EAEjB,OADAsU,EAAIjU,GAAY6kB,EAAM7kB,IAAc8pD,EAAkB9pD,IAAa,GAC5DiU,IACR,IAGP,KAAKy1C,EAAe1C,SAChB,IAAM4C,EAAkBzpC,EAA0BrY,UAClD,OAAuB,OAAnB8hD,EACO/kC,EAEJkJ,EAAa67B,GAG5B,OAAO/kC,GMpBPklC,SLf6D,WAAsE,IAArEllC,EAAoE,uDAAvCujC,GAAiBjoC,EAAsB,uCAIlI,OAHIA,EAAOrhB,OAASyN,EAAWy6C,UAA+B,MAAnB7mC,EAAO4pC,WAC9CllC,EAAQrlB,OAAOwqD,OAAO,GAAI7pC,EAAO4pC,WAE9BllC,GKYPR,WJdgE,WAA8E,IAA7EQ,EAA4E,uDAA9C6jC,GAAwBvoC,EAAsB,uCAC7I,OAAQA,EAAOrhB,MACX,KAAKyN,GAAW4oC,uBACZ,OAAOkT,GAAqBxjC,EAAO1E,EAAOjhB,UAAW6gB,EAAe4hC,UAExE,KAAKp1C,GAAWyhB,wBACZ,OAAOq6B,GAAqBxjC,EAAO1E,EAAOjhB,UAAW6gB,EAAe6R,OAExE,KAAKrlB,GAAW0hB,iBACZ,OAAOq6B,GAAsBzjC,EAAO1E,GAExC,KAAK5T,GAAW2hB,gBACZ,OAAOA,GAAgBrJ,EAAO1E,GAElC,KAAK5T,GAAWk1C,gBACZ,OAAOA,GAAgB58B,EAAO1E,GAElC,KAAK5T,GAAWglB,kBAAoB,IAAD,EACGpR,EAAnB03B,EADgB,EACvBhzB,MACR,OAAOwjC,GAAqBxjC,EAAO1E,EAAOjhB,UAAW24C,GAEzD,KAAKtrC,GAAW6hB,oBACZ,OAAOA,GAAoBvJ,EAAO1E,GAG1C,OAAO0E,GIVP+wB,MFf2C,WAAqE,IAApE/wB,EAAmE,uDAA1C+jC,GAAmBzoC,EAAuB,uCAC/G,OAAQA,EAAOrhB,MACX,KAAKyN,GAAWnD,MAEZ,IAAMotC,EAAuBmS,GAAWxoC,GAClC21B,EAAUjxB,EAAMixB,QAAQiS,OAAOvR,GACrC,OAAO,2BACA3xB,GADP,IAEIixB,YAGR,KAAK4T,EAAe1C,SAIhB,IAAMj0C,EAAcD,KAAKC,MACnB+iC,EAA4B,GAC5B+S,EAA8B,GAkBpC,OAjBAhkC,EAAMixB,QAAQp2C,SAAQ,SAACikC,GACnB,IAAMsmB,EAAMl3C,EAAM4wB,EAAE+S,cACdztC,GAAY8J,EAAM4wB,EAAE8W,YAAcwP,EAAMtmB,EAAE8W,WAC1C/D,EAAgB/S,EAAE+S,eAAiB3jC,EAAM4wB,EAAE6iB,UAC3ChQ,EAAI,2BACH7S,GADG,IAEN16B,WACAu9C,SAAUzzC,EACV2jC,kBAEAA,EAAgB,EAChBmS,EAAUlnD,KAAK60C,GAEfV,EAAQn0C,KAAK60C,MAId,CACHV,UACA+S,aAIZ,OAAOhkC,GEzBPsJ,QDpBoC,WAA6D,IAA5DtJ,EAA2D,uDAA3CikC,GAAqB3oC,EAAsB,uCAChG,OAAQA,EAAOrhB,MACX,KAAKyN,GAAWklB,WAEZ,OAAO5M,EAAS1E,EAA+BxgB,MAEvD,OAAOklB,KGNLqlC,GAAgB,CAClBpsD,IAAK,OACLqsD,QAASC,IACT9qC,QAASC,GAGP8qC,GAAmBC,aAAsCJ,GAAeK,IA2B/DC,GAhBK,uCAAG,wCAAAt1C,EAAA,6DAAOu1C,EAAP,+BAA0C,GAA1C,kBACZ,IAAI1uC,SAAQ,SAACC,EAAS0uC,GACzB,IAAM1vC,EAAQ2vC,aACVN,GAGAI,EACC3iC,OAAe8iC,8BAAiC9iC,OAAe8iC,gCAE9Dn0B,EAAYo0B,aAAa7vC,OAAOC,GAAW,WAC7C,IAAM6vC,EAAa/vC,aAAkBC,EAAMkF,YAC3ClE,EAAQ,CAAEhB,QAAOyb,YAAWq0B,sBAXjB,2CAAH,qDChBPC,GAAwB,SAACnV,EAAwBr1B,GAgB1Dq1B,EAAMiT,UAAUnpD,SAAQ,SAAC82C,GAAD,OAfI,SAACA,GAIzB,OAFAA,EAAK5B,UAAUl1C,SAAQ,SAACygB,GAAD,OAAYI,EAASJ,MAEpCq2B,EAAK13C,MACT,KAAKq0C,GAAS0J,UACV,IAAM99C,EAAOy3C,EAAK33C,KACZsH,EAAQ5I,IAAYiB,IAAI,sBAAuB,CAAEO,SACjD+hB,EAAa7hB,aAAcF,GACjC2T,KAAamf,SAAS1rB,EAAO/G,KAAK4rD,YAAalqC,EAAWjT,UAMpCo9C,CAAoBzU,OhBIpD0U,I,OAAQ,uCAAG,4BAAAh2C,EAAA,sEACOyG,YAAkB,GAAD,OAAI5P,IAAJ,kBADxB,QACPvO,EADO,SAGTD,IAAYkL,KAAKjL,EAAMoX,ML7BVu2C,EK+BL,aL9BZ9G,IAAQ,EACRtC,GAAYqJ,KAAWD,EAAM,CAACtmC,OAAO,IK+BrCwmC,KAPa,iCL1BG,IAACF,IK0BJ,OAAH,sDAaRE,GAAU,uCAAG,8CAAAn2C,EAAA,6DAAOu1C,EAAP,+BAA0C,GAA1C,SACkBD,GAAeC,GADjC,OACTa,EADS,OAEPtwC,EAAsBswC,EAAtBtwC,MAAO8vC,EAAeQ,EAAfR,WACfr0B,GAAY60B,EAAmB70B,UAE1Bq0B,EAGDS,KAFAC,GAAaxwC,GAIjBywC,GAAQzwC,GAVO,2CAAH,qDAiBVwwC,GAAe,SAACxwC,GAClBA,EAAMuF,ShK1CC,CACHzhB,KAAMyN,EAAWo9C,YgK0CrB3uC,EAAMuF,SAASvG,YAAW,sBAI1B9b,QAAQub,IAAR,qCAA0C6F,EAA1C,OAQEisC,GAAe,WAEjBrtD,QAAQub,IAAR,4CAAiD6F,EAAjD,OAMEoU,GAAQ,uCAAG,WAAO7O,GAAP,iBAAA3P,EAAA,sEAEPuhB,GAAUi1B,QAFH,uBAGWlB,GAAe3lC,GAH1B,gBAGL7J,EAHK,EAGLA,MACRywC,GAAQzwC,GAIRnC,SAAS8yC,KAAT,WAAoBl+C,eARP,2CAAH,sDAWRw1C,GAAc,WAEb2I,QAAQ,uDACPC,aAAahsB,IACbpJ,GAAUi1B,QACV5kD,IAAYyoB,QAEZ87B,GapEiC,CACrChxC,YAAa+rC,GACb94C,OAAQoL,IACRwC,OAAQqrC,KACRrkD,KAAMukD,GACNjY,UAAWkY,KACXjtC,IAAKstC,GACL1uB,OAAQ6uB,GACRp/C,UAAWqgD,GACX4B,SAAU3B,GACV/jC,WAAYqkC,GACZ9S,MAAOgT,GACPz6B,QAAS26B,Kb0DLjwC,SAASysC,SAGTpnD,QAAQqxB,UAMVk8B,GAAU,SAACzwC,GACb6wC,aAAahsB,IAEbisB,SACI,cAAC,IAAD,CAAU9wC,MAAOA,EAAjB,SACI,cAAC,GAAD,CAAKyb,UAAWA,OAGpB3C,SAASi4B,eAAe,SAE5BC,KAkBAnsB,GAAWC,aAhBM,WACb,IAAMjb,EAAoB7J,EAAMkF,WAC1BD,EAAQnN,KAAKC,MAAQ8R,EAAM3J,OAAOsrC,SAElCyF,EAAoB,GACpBC,EAAmB5I,GAAqBz+B,EAAM3J,OAAOqmC,mBAAoB18B,GACzEklC,EAAWzF,KACjBtkC,EAAaC,EAAOjF,GAPD,MAQkB2oC,GAAgB1jC,EAAOjF,GAApDopC,EARW,EAQXA,aAAcD,EARH,EAQGA,WACtB8H,EAAKtqD,KAAL,MAAAsqD,EAAI,YAAS9H,IAEbnpC,EAAMuF,ShK9GP,SAAkBN,EACrB8pC,EACAjiD,EACAuwB,EACA5e,GAEA,MAAO,CACH3a,KAAMyN,EAAWy6C,SACjB/mC,QACA8pC,WACAjiD,YACAuwB,SACA5e,OgKkGeutC,CAAS/mC,EAAO8pC,EAAUmC,EAAkB9H,EAAc6H,IAEzElB,GAAsBlmC,EAAM+wB,MAAO56B,EAAMuF,YA7G3B,OAoHtB2qC,M,uUiBzIO,SAASiB,EAAYC,GACxB,MAA2B,kBAAbA,EAAKtuD,I,2ECmBjBuuD,EAAmB,IAKZC,EAAb,WAYI,WAAYtxC,EAAqCvO,GAAoB,yBAV9DA,eAU6D,OAT7D6+B,aAS6D,OAR7DihB,WAQ6D,OAP7DznB,aAAc,EAO+C,KAN7D0nB,kBAAmB,EAM0C,KAJ1DC,cAI0D,OAH1DzxC,WAG0D,OAF1D0xC,aAAmC,GAGzChvD,KAAKsd,MAAQA,EACbtd,KAAK+O,UAAYA,EAdzB,0CAiBI,WACI,OAAK/O,KAAK+uD,SACJ,GAAN,OAAU1gD,IAAV,YAAoCrO,KAAK+uD,SAASE,OAAO,EAAGjvD,KAAK+uD,SAASG,YAAY,OAD3D,OAlBnC,sBAwBI,SAASzwC,GAAuB,IAAD,OAC3B,GAAIze,KAAK8uD,iBACL,OAAOrwC,IAEX,IAAKze,KAAK+uD,SACN,MAAM,IAAIruD,MAAM,wBAEpBV,KAAKonC,aAAc,EAEnB,IAAM+nB,EAAS,uCAAG,WAAO1kD,EAAkBf,GAAzB,SAAA8N,EAAA,+EACP,IAAI6G,SAAQ,SAACC,EAAS0uC,GACzB9jD,IAAa0iB,SAASnhB,EAAOf,GAAO,SAAC0lD,GACjC9wC,EAAQ8wC,UAHF,2CAAH,wDAOTC,EAAW,CACbF,EAAU,YAAa,CAAC,yBAA0B,2BAClDA,EAAU,iBAAkB,CAAC,+BAAgC,+BAAgC,iCAC7FA,EAAU,kBAAmB,CAAC,gCAAiC,gCAAiC,kCAChGA,EAAU,mBAAoB,CAAC,uCAC/BA,EAAU,cAAe,CAAC,2BAA4B,2BAA4B,2BAA4B,6BAC9GA,EAAU,iBAAkB,CAAC,yBAC7BlxC,YAAkB,GAAD,OAAI5P,IAAJ,YAA8BrO,KAAK+uD,YAGxD1wC,QAAQ/X,IAAI+oD,GAAUhI,KAAtB,sBAA2B,oCAAA7vC,EAAA,sDACjBlV,EAAW6b,KAAKrU,OAAOsU,OAAOhU,UAAnB,UAAgCiE,IAAhC,YAA0D,EAAK0gD,WAChF,EAAKnhB,QAAUtrC,EAAS4U,KAGxB,EAAKo4C,qBACL,EAAKT,MAAQ,EAAKU,cAGZ3wB,EAAezxB,YAAoB,EAAKqiD,aAAapjD,OAAS,EAAKojD,aAAe,EAAKC,iBATtE,cAUL7wB,GAVK,gEAUb1gB,EAVa,kBAWbD,YAAkBC,GAXL,+IAcvB,EAAK4wC,kBAAmB,EACxB,EAAK1nB,aAAc,EACnB3oB,IAhBuB,mEAlDnC,gCAsEI,SAAmBrR,GAA0B,IAAD,SACxCpN,KAAKgvD,aAAe,GACpB,UAAAhvD,KAAK4tC,eAAL,SAAcpJ,OAAOl6B,QAAO,SAAA0M,GAAK,OAAIA,EAAM0tB,WAAS1iC,SAAQ,SAAAgV,GACpDA,EAAMxJ,YAAcwJ,EAAMxJ,WAAW8V,MAAK,SAAA4oB,GAAC,MAAe,mBAAXA,EAAE/qC,OAAyC,IAAZ+qC,EAAEjqC,UAChF6U,YAAyB,EAAKk4C,aAAch4C,EAAOA,EAAMwT,UAG1D,OAAPpd,QAAO,IAAPA,KAASpL,SAAQ,SAAAuL,IACsB,IAAhCA,EAAEC,WAAWkiD,gBAA2BniD,EAAE4N,UACzC,EAAK6zC,aAAa/qD,KAAKsJ,EAAE4N,eA/EzC,yBAqFI,WACI,IAAM/N,EAAUpN,KAAKyvD,gBAErBzvD,KAAKwnC,YAAYp6B,GADF,KAvFvB,yBA2FI,WAAwF,IAA5EA,EAA2E,uDAAlDpN,KAAKwvD,aAAc5/C,EAA+B,uDAAb5P,KAAK4P,OACrEtG,EAAK,2BACJtJ,KAAKkP,MAAM5F,OADP,IAEP8D,UACAwC,WAEJ5P,KAAK6iB,SAAStT,YAASvP,KAAK+O,UAAWzF,IAEvCtJ,KAAKsvD,mBAAmBliD,GAGpBpN,KAAK4tC,UACL5tC,KAAK6uD,MAAQ7uD,KAAKuvD,iBAvG9B,0BA2GI,cA3GJ,+BAgHI,WAAqB,IAAD,IAChB,MAAO,CACHzvB,WAAW,UAAA9/B,KAAK4tC,eAAL,eAAc9O,YAAa,EACtCiB,YAAY,UAAA//B,KAAK4tC,eAAL,eAAc5O,aAAc,KAnHpD,wBAuHI,SAAW2wB,EAAgBx0C,GAEvB,IAAM0oB,EAAc7jC,KAAKupC,oBAAoBpuB,GAC7C,GAAK0oB,GAEDA,EAAYziC,OAASyL,IAAgB+iD,KAErC,GAAI/rB,EAAYr2B,WAAWqiD,UACvB7vD,KAAK6iB,SAASxT,YAAarP,KAAK+O,UAAW80B,EAAYr2B,WAAWqiD,gBAC/D,CAEH,IAAMz4C,EAAQzT,KAAKK,MAAMhE,KAAKkP,MAAM3D,UAAY,EAE1CukD,EADavuD,YAAcvB,KAAK+O,WACd8M,MAAMzE,GAC1B04C,EAAK/zC,KAEL/b,KAAK6iB,SAASvG,YAAWwzC,EAAK/zC,IAAK,KAAM3F,IAAWlH,MAAOlP,KAAK+O,YAEpE/O,KAAK6iB,SAAS5T,YAAcjP,KAAK+O,eAzIjD,2BA8II,SAAcqxB,EAAiBjlB,GAC3B,IAAMrO,EAAQ9M,KAAKsqC,cAAclK,GAC3BxzB,EAAS5M,KAAKupC,oBAAoBpuB,GAEnCvO,EAML5M,KAAK+vD,mBAAmBjjD,EAAOF,GAJ3BpM,QAAQwvD,KAAK,qBApJzB,gCA2JI,SAAmB5vB,EAAiBh/B,EAAuByiC,GAAgC,IAAD,OAGhF/2B,EAAQ9M,KAAKsqC,cAAclK,GAC1BjlB,EAAYrO,EAAZqO,SAEP,OAAQ/Z,GACJ,KAAKsL,IAAgBkW,KAEjB,IAAM1E,EAAOle,KAAKwqC,SAASrvB,EAAW0oB,GAEtC,GAAI7jC,KAAK4P,OAAQ,CACK9C,EAAMy9B,GACH,OAAJrsB,QAAI,IAAJA,KAAM9R,OAKvB,OAAJ8R,QAAI,IAAJA,KAAMlc,SAAQ,SAACyiC,EAAGrtB,GACd,IAAM3H,EAA2B,CAC7ByxB,WAAYx0B,IAAgBkW,KAC5Bwd,UACArd,OAAQ0hB,EACR/hB,OAAQisC,GAAoBv3C,EAAQ,GAAKuO,YAAYtQ,OAEzD,EAAKwN,SAASrT,YAAmB,EAAKT,UAAWU,OAErD,MAEJ,KAAK/C,IAAgB+0B,SACjB,IAAMvjB,EAAOle,KAAK0qC,gBAAgBvvB,EAAW0oB,GACzC,OAAJ3lB,QAAI,IAAJA,KAAMlc,SAAQ,SAACyiC,EAAGrtB,GACd,IAAM20C,EAA0B,CAC5B7qB,WAAYx0B,IAAgBkW,KAC5Bwd,UACArd,OAAQ0hB,EACR/hB,OAAQisC,GAAoBv3C,EAAQ,GAAKuO,YAAYtQ,OAEzD,EAAKwN,SAASrT,YAAmB,EAAKT,UAAWg9C,OAGrD,IAAMkE,EAA8B,CAChC/uB,WAAYx0B,IAAgB+0B,SAC5BrB,UACArd,OAAQ8gB,EACRnhB,OAAQisC,EAAmBzwC,EAAK9R,OAASuZ,YAAYtQ,OAEzDrV,KAAK6iB,SAASrT,YAAmBxP,KAAK+O,UAAWkhD,IACjD,MAEJ,KAAKvjD,IAAgB80B,MAEjB,IAAMtjB,EAAOle,KAAKwqC,SAASrvB,EAAW0oB,GAChC9gB,EAAM,OAAG7E,QAAH,IAAGA,OAAH,EAAGA,EAAMgyC,MACrB,IAAKhyC,IAAS6E,EAEV,OAIA,OAAJ7E,QAAI,IAAJA,KAAMlc,SAAQ,SAACyiC,EAAGrtB,GACd,IAAM20C,EAA0B,CAC5B7qB,WAAYx0B,IAAgBkW,KAC5Bwd,UACArd,OAAQ0hB,EACR/hB,OAAQisC,GAAoBv3C,EAAQ,GAAKuO,YAAYtQ,OAEzD,EAAKwN,SAASrT,YAAmB,EAAKT,UAAWg9C,OAErD,IAAMoE,EAA2B,CAC7BjvB,WAAY9/B,EACZg/B,UACArd,SACAL,OAAQisC,GAAoBzwC,EAAK9R,OAAS,GAAKuZ,YAAYtQ,OAE/DrV,KAAK6iB,SAASrT,YAAmBxP,KAAK+O,UAAWohD,OAtOjE,gCA4OI,SAAmBR,EAAqBS,MA5O5C,kCAiPI,SAAsBl0B,GAAsC,IAAD,IACvD,OAAI,UAACl8B,KAAK4tC,eAAN,aAAC,EAAc9O,aAAa,UAAC9+B,KAAK4tC,eAAN,aAAC,EAAc5O,YAGxC,CAACr7B,KAAKK,MAAMk4B,EAAM7kB,EAAIrX,KAAK4tC,QAAQ9O,WAAYn7B,KAAKK,MAAMk4B,EAAM5kB,EAAItX,KAAK4tC,QAAQ9O,YAF7E,CAAC,EAAG,KAnPvB,+BAyPI,SAAkB3jB,GACd,OAAOnb,KAAKgvD,aAAa1rC,MAAK,SAACmhB,GAAD,OAAOltB,YAAektB,EAAGtpB,QA1P/D,mCA8PI,SAAsBA,GAClB,OAAKnb,KAAK4tC,UAEHzyB,EAAS,GAAK,GAAKA,EAAS,GAAK,GACpCA,EAAS,IAAMnb,KAAK4tC,QAAQpjB,OAC5BrP,EAAS,IAAMnb,KAAK4tC,QAAQnjB,UAnQxC,0BAuQI,SAAa4lC,MAvQjB,+BA4QI,SAAkBlvD,GAEd,IAAMiuC,EAAYpvC,KAAKkvC,aAAa/tC,GAChCiuC,GACApvC,KAAK6iB,SAASnE,YAAQ0wB,EAAU5qC,MAAQ,MAhRpD,+BAoRI,SAAkB8rD,EAAmBnvD,EAAcmT,EAAsBE,GAErE,IAAM46B,EAAYpvC,KAAKkvC,aAAa/tC,GACpC,GAAKiuC,EAAL,CAEA,IAAM/tC,EAAO+tC,EAAU3tB,MAAM6uC,GAC7BtwD,KAAK6iB,SAASpO,YAAmBH,EAAcjT,EAAMmT,OA1R7D,yBA6RI,SAAYnT,EAAYiT,GACpB,IAAM6I,EAAand,KAAKuwD,kBAAkBj8C,GACpCg8C,EAAS,OAAGnzC,QAAH,IAAGA,OAAH,EAAGA,EAAYC,UAAUkhB,QAAQj9B,QAC9Bkc,IAAd+yC,GACAtwD,KAAK6iB,SAASnO,YAAwBJ,EAAcg8C,MAjShE,0BAqSI,SAAaE,EAAoBC,MArSrC,wCA0SI,SAA2BD,EAAoBE,EAAiBD,MA1SpE,sBAkTI,SAAS7sB,EAA0B7gB,GAA2B,IAAD,EACzD,iBAAO/iB,KACF6uD,aADL,aAAO,EACKrkB,SAASmmB,EAAU/sB,GAAS+sB,EAAU5tC,IAC7ChZ,IAAI6mD,KArTjB,6BA8TI,SAAuBhtB,EAA0B7gB,GAAgD,IAAD,EAArB8tC,EAAqB,wDAEtFC,EAAI,UAAG9wD,KAAK6uD,aAAR,aAAG,EAAYkC,UAAUC,eACnC,IAAKF,EAAM,MAAO,GAClB,IAAMG,EAASH,EAAK/mD,KAAI,SAAAS,GAAC,OAAIA,EAAET,KAAI,SAAAmnD,GAAC,OAAKA,EAAEC,gBAAkB,EAAI,QACjEF,EAAOluC,EAAO,IAAIA,EAAO,IAAM,EAC/B,IAAMquC,EAAY,IAAIC,cAAY,CAC9BP,KAAM,CACFG,UAEJK,kBAAkB,EAClBC,UAAW,YACXC,OAAQ,KAEZ,OAAOJ,EAAU5mB,SAASmmB,EAAU/sB,GAAS+sB,EAAU5tC,IAClDhZ,IAAI6mD,GACJ7L,MAAM,EAAG8L,OAActzC,GAAa,KA9UjD,kCAoVI,SAAqBtR,EAAwBH,GAAuB,IAAD,EAC/D,OAAO,UAAA9L,KAAKwqC,SAASv+B,EAAMH,UAApB,eAAyBM,SAAU,IArVlD,2BAwVI,SAAqBg0B,GACjB,OAAOpgC,KAAKyxD,YAAYx0C,MAAK,SAAAy0C,GAAE,OAAIA,EAAGvwD,OAASi/B,OAzVvD,iCA4VI,SAA2BjlB,GAA6B,IAAD,IACnD,iBAAOnb,KAAKkP,MAAM5F,aAAlB,iBAAO,EAAkB8D,eAAzB,aAAO,EAA2B6P,MAAK,SAAA1P,GAAC,OAAIA,EAAE4N,UAAY5D,YAAehK,EAAE4N,SAAUA,QA7V7F,yBAgWI,WACI,IAAM81C,EAAqB,GAC3B,GAAIjxD,KAAK4tC,QACL,IAAK,IAAIt2B,EAAI,EAAGA,EAAItX,KAAK4tC,QAAQnjB,OAAQnT,IAAK,CAE1C,IADA,IAAMq6C,EAAgB,GACbt6C,EAAI,EAAGA,EAAIrX,KAAK4tC,QAAQpjB,MAAOnT,IAAK,CACzC,IAAM8D,EAA6B,CAAC9D,EAAGC,GACjC+xB,EAAUrpC,KAAKspC,kBAAkBnuB,GACvCw2C,EAAI1tD,KAAKolC,EAAU,EAAI,GAE3B4nB,EAAOhtD,KAAK0tD,GAGpB,OAAO,IAAIN,cAAY,CACnBP,KAAM,CACFG,UAEJK,kBAAkB,EAClBC,UAAW,YACXC,OAAQ,OAnXpB,2BAwXI,WAA0C,IAAD,OACrC,IAAKxxD,KAAK4tC,QACN,MAAM,IAAIltC,MAAM,cAEpB,IAAMkxD,EAAe5xD,KAAK4tC,QAAQpJ,OAAOl6B,QAAO,SAAA0M,GAAK,OAAIA,EAAM5V,OAASwd,IAAe+lB,eACjFv3B,EAAyB,GACzBuP,EAAc3c,KAAKi+B,iBAgDzB,OA/CA2zB,EAAa5vD,SAAQ,SAAA6vD,GACjBA,EAAYzkD,QAAQkJ,QAAO,SAACC,EAAqBtU,GAA4B,IAAD,IAGlEuL,EAAa6I,YAAgBpU,EAAMuL,YACnC2N,EAA6B,CAC/BlZ,EAAMoV,IAAK,YAAKu2B,eAAL,eAAc9O,YAAa,IACrC78B,EAAMqV,GAAKrV,EAAMwU,IAAMxU,EAAMwoB,OAAS,MAAO,YAAKmjB,eAAL,eAAc5O,aAAc,IAG1EpyB,EAA0B,2BACvB3K,GADuB,IAE1BgjC,QAAS4sB,EAAYh1C,GACrBrP,aACA2N,aAGJ,GAAIvO,EAAOxL,OAASyL,IAAgBilD,gBAAiB,CACjD,IAAM30C,EAAaR,EAAYuzC,MAC3B/yC,GACAvQ,EAAOxL,KAAOyL,IAAgBC,MAC1BH,YAAcC,KACdA,EAAOzL,KAAOgc,EAAWN,GACzBjQ,EAAOI,WAAaC,IAAWC,OAC/BN,EAAOY,WAAW8G,aAAe6I,EAAWN,GAC5CjQ,EAAOY,WAAWC,UAAW,EAC7Bb,EAAOY,WAAWE,YAAcyP,EAAWuiB,kBAI/C9yB,EAAS,UAENA,EAAOxL,OAASyL,IAAgBklD,aACvCnlD,EAAOxL,KAAOyL,IAAgBC,MAC1BH,YAAcC,KACdA,EAAOI,WAAaC,IAAW0V,MAC/B/V,EAAOY,WAAWC,UAAW,EAC7Bb,EAAOY,WAAWE,YAAlB,UA1aI,oBA0aJ,sBAOR,OAHId,GACA2J,EAAItS,KAAK2I,GAEN2J,IACRnJ,MAEAA,IA9af,kBAkbI,WAAwB,IAAD,EACnB,SAAQ,UAACpN,KAAKkP,MAAM5F,aAAZ,aAAC,EAAkBsG,UAnbnC,wBAsbI,WAA2C,IAAD,EACtC,OAAO,UAAA5P,KAAKkP,MAAM5F,aAAX,eAAkB8D,UAAW,KAvb5C,uBA0bI,WACI,OAAOpN,KAAKwvD,aAAallD,OAAoBqC,OA3brD,iBA+bI,WAAuB,IAAD,OAElB,OADmB3M,KAAKsd,MAAMkF,WACZmY,OAAO1d,MAAK,SAAA4d,GAAC,OAAIA,EAAE15B,OAAS,EAAK4N,eAjc3D,qBAocI,WACI,OAAO/O,KAAKkP,MAAMuM,YArc1B,6BAycI,SAA0Bu2C,GACtBhyD,KAAK6iB,SAAS1T,YAAgBnP,KAAK+O,UAAWijD,MA1ctD,4BA6cI,WACI,IAAMp8B,EAAa51B,KAAKsd,MAAMkF,WAC9B,OAAO9F,YAAmBkZ,EAAWjZ,YAAa3c,KAAKkP,SA/c/D,kCAkdI,SAA+BpC,GAE3B,OADmB9M,KAAKsd,MAAMkF,WACZ7F,YAAYM,MAAK,SAAAzF,GAAC,OAAIA,EAAEqF,KAAO/P,EAAM3L,UApd/D,+BAudI,SAA4B0b,GAExB,OADmB7c,KAAKsd,MAAMkF,WACZ7F,YAAYM,MAAK,SAAAzF,GAAC,OAAIA,EAAEqF,KAAOA,OAzdzD,yBA4dI,SAAsB0a,EAA2BtiB,GAAsC,IAAvBQ,EAAsB,wDAC5E5U,EAAuB4tD,EAAYl3B,GAASA,EAAQ,CAACn3B,IAAKm3B,GAC1D9uB,EAAQ5I,IAAYoyD,aAAapxD,GACnC4U,GACAT,IAAamf,SAAS1rB,EAAO/G,IAAKwwD,YAAaj9C,EAAMjF,YAAahQ,KAAK+O,YAE3E/O,KAAK6iB,SAASpG,YAAY5b,EAAWuV,IAAWlH,MAAOlP,KAAK+O,cAlepE,sBAseI,SAAmB0T,GACfziB,KAAKsd,MAAMuF,SAASJ,OAve5B,KAkfMkuC,EAAY,SAAClsB,GAAD,MAA0B,CAAEptB,EAAGotB,EAAE,GAAIntB,EAAGmtB,EAAE,KACtDmsB,EAAa,SAACr5B,GAAD,MAAuC,CAACA,EAAM,GAAIA,EAAM,K,gBCjgBrE46B,E,4HAAwCvD,GA2BjCwD,EAAb,4MACIrD,SAAW,iCADf,kDAGI,SAAa5kD,GACT,OAAOnK,KAAKyb,UAAU4F,QAAQE,SAASxc,QAJ/C,+BAOI,SAAkB5D,GACd,yEAAwBA,GACxBnB,KAAKmP,gBAAgB,CACjBkS,QAAS,CAAEE,SAAU,CAAExc,MAAO,CAAEP,KAAM,SAVlD,+BAcI,SAAkB8rD,EAAmBnvD,EAAcmT,EAAsBE,GACrE,yEAAwB87C,EAAWnvD,EAAMmT,EAAcE,GACvD,IAAM46B,EAAYpvC,KAAKkvC,aAAa/tC,GACpC,GAAIiuC,EAAU,CACV,IAAM3tB,EAAQ2tB,EAAU3tB,MAAMnX,QAAO,SAACH,EAAQiN,GAAT,OAA2BA,IAAUk5C,KAC1EtwD,KAAKmP,gBAAgB,CACjBkS,QAAS,CAAEE,SAAU,CAAExc,MAAO,CAAE0c,gBApBhD,yBAyBI,WAAwF,IAAD,OAA3ErU,EAA2E,uDAAlDpN,KAAKwvD,aAAc5/C,EAA+B,uDAAb5P,KAAK4P,OAC3ExC,EAAUA,EAAQrD,KAAI,SAAAwD,GAClB,OAAOA,EAAEpM,MACL,IAAK,QACD,OAAO,2BACAoM,GADP,IAEIkJ,IAAK,EAAKgF,UAAU4F,QAAQE,SAASC,UAhErC,GADE,KAqEd,OAAOjU,KAEX,mEAAkBH,EAASwC,KArCnC,gCAwCI,SAAmB9C,EAAoBF,GACnC,OAAQA,EAAOzL,MAEX,IAAK,QACD,IAAKnB,KAAKyb,UAAU4F,QAAQE,SAASC,UAAW,CAAC,IAAD,EAEtC3gB,EAAY,CAAET,IAAK,uCAAwCC,QAAS,CAAE8c,WAD5D,UAAGnd,KAAKqyD,qBAAqBvlD,UAA7B,aAAG,EAAkC3L,OAErDnB,KAAKkyD,YAAYrxD,EAAW,gCAE5Bb,KAAKmP,gBAAgB,CACjBkS,QAAS,CAAEE,SAAU,CAAEC,WAAW,MAI1CxhB,KAAKsd,MAAMuF,SAAShT,YAA+B7P,KAAK+O,UAAW,CAC/D3N,KAAM,YACNguC,UAAWxiC,EAAOzL,QAEtB,MAEJ,IAAK,QACDnB,KAAKsd,MAAMuF,SAAShT,YAA+B7P,KAAK+O,UAAW,CAC/D3N,KAAM,YACNwuC,UAAW,WAIvB,0EAAyB9iC,EAAOF,KAnExC,0BAsEI,WACS5M,KAAKyb,UAAU4F,QAAQC,SACxBthB,KAAKkyD,YAAY,gDAxE7B,0BA6EI,SAAatiB,EAAmBt7B,GAoBhB,OAAO,oEAAmBs7B,EAAWt7B,KAjGzD,wCAqGI,SAA2Bk8C,EAAoBE,EAAiBD,QArGpE,GAAoD0B,GA4HvCG,EAAb,4MACIvD,SAAW,iCADf,kDAGI,SAAa5kD,GACT,OAAOnK,KAAKyb,UAAU4F,QAAQK,QAAQ3c,QAJ9C,0BAOI,cAPJ,gCAWI,SAAmB+H,EAAoBF,GACnC,OAAQA,EAAOzL,MAEX,IAAK,QACD,IAAKnB,KAAKyb,UAAU4F,QAAQK,QAAQF,UAAW,CAAC,IAAD,EAErC3gB,EAAY,CAAET,IAAK,uCAAwCC,QAAS,CAAE8c,WAD5D,UAAGnd,KAAKqyD,qBAAqBvlD,UAA7B,aAAG,EAAkC3L,OAErDnB,KAAKkyD,YAAYrxD,EAAW,gCAE5Bb,KAAKmP,gBAAgB,CACjBkS,QAAS,CAAEK,QAAS,CAAEF,WAAW,MAIzCxhB,KAAKsd,MAAMuF,SAAShT,YAA+B7P,KAAK+O,UAAW,CAC/D3N,KAAM,YACNguC,UAAWxiC,EAAOzL,QAEtB,MACJ,IAAK,QACInB,KAAKyb,UAAU4F,QAAQK,QAAQC,UAChC3hB,KAAKsd,MAAMuF,SAAShT,YAA+B7P,KAAK+O,UAAW,CAC/D3N,KAAM,YACNwuC,UAAW,UAGnB,MACJ,IAAK,UACD5vC,KAAKkyD,YAAY,8CAGzB,0EAAyBplD,EAAOF,KA1CxC,0BA6CI,SAAagjC,EAAmBt7B,GAC5B,OAAQs7B,GACJ,IAAK,OACD,IAAMzyB,EAAand,KAAKuwD,kBAAkBj8C,GAC1C,OAAI6I,GAAcA,EAAWC,UAAUkG,MAAK,SAAA1M,GAAC,OAAIA,IAAMhX,IAAKQ,OAEjD,CACHqI,MAAO,0CACPqnC,QAAS,CACL,oCAIL,CACHrnC,MAAO,0CACPylB,KAAM,qDAGd,QACI,OAAO,oEAAmB0hB,EAAWt7B,MAhErD,wCAqEI,SAA2Bs7B,EAAmB/c,EAAgBve,GAG1D,OAAQs7B,GACJ,IAAK,OAAS,IAAD,EAET5vC,KAAKmP,gBAAgB,CACjBkS,QAAS,CAAEK,QAAS,CAAEC,UAAU,MAGpCzY,IAAaqM,UAAU,iBAAkBzM,IAAQQ,OAAO,EAAOP,IAAQ8B,gBAEvE7K,KAAKuyD,YAAY3yD,IAAKQ,IAAKkU,GAC3B,IACMzT,EAAY,CAAET,IAAK,sCAAuCC,QAAS,CAAE8c,WAD3D,UAAGnd,KAAKuwD,kBAAkBj8C,UAA1B,aAAG,EAAsCnT,OAEzDnB,KAAKkyD,YAAYrxD,EAAW,gCAE5Bb,KAAK6iB,SAAShT,YAA+B7P,KAAK+O,eAtFlE,+BA4FI,SAAkBuhD,EAAmBnvD,EAAcmT,EAAsBE,GACrE,yEAAwB87C,EAAWnvD,EAAMmT,EAAcE,GACvD,IAAM46B,EAAYpvC,KAAKkvC,aAAa/tC,GACpC,GAAIiuC,EAAU,CACV,IAAM3tB,EAAQ2tB,EAAU3tB,MAAMnX,QAAO,SAACH,EAAQiN,GAAT,OAA2BA,IAAUk5C,KAC1EtwD,KAAKmP,gBAAgB,CACjBkS,QAAS,CAAEK,QAAS,CAAE3c,MAAO,CAAE0c,gBAlG/C,yBAuGI,WAAwF,IAAD,OAA3ErU,EAA2E,uDAAlDpN,KAAKwvD,aAAc5/C,EAA+B,uDAAb5P,KAAK4P,OAC3ExC,EAAUA,EAAQrD,KAAI,SAAAwD,GAClB,OAAOA,EAAEpM,MACL,IAAK,QACD,OAAO,2BACAoM,GADP,IAEIkJ,IAAK,EAAKgF,UAAU4F,QAAQK,QAAQF,UA1QpC,GADE,KA8QV,IAAK,QACD,GAAK,EAAK/F,UAAU4F,QAAQK,QAAQC,SAAU,CAC1C,IAAMnU,EAAU,2BAAQD,EAAEC,YAAV,IAAsBkiD,gBAAgB,EAAOnrC,aAAa,IAC1E,MAA0B,UAAtBhX,EAAEC,WAAWyU,KACN,2BAAK1U,GAAZ,IAAekJ,IA9Qd,IA8QyCjJ,eAEnC,2BAAKD,GAAZ,IAAekJ,IA/Qd,IA+QyCjJ,eAG9C,MAA0B,UAAtBD,EAAEC,WAAWyU,KACN,2BAAK1U,GAAZ,IAAekJ,IAtRZ,MAwRI,2BAAKlJ,GAAZ,IAAekJ,IAvRZ,MA4RnB,OAAOlJ,KAEX,mEAAkBH,EAASwC,OAnInC,GAAmDuiD,GAuInDpzC,IAAuByzC,wBAAwB,cAAe,mBAAoBJ,GAClFrzC,IAAuByzC,wBAAwB,cAAe,kBAAmBF,K","file":"static/js/main.a51494db.chunk.js","sourcesContent":["import { Rarity } from 'constants/items';\n\nexport enum ItemType {\n    deed,\n    apparel,\n    material,\n    questItem,\n    trinket,\n    weapon,\n}\n\n// the string must correspond to a named export in /items/index.tsx\nexport enum Item {\n    // deeds\n    deedForLumbermill = \"deedForLumbermill\",\n    deedForWeaponsmith = \"deedForWeaponsmith\",\n\n    // equipment\n    boots1 = \"boots1\",\n    boots2 = \"boots2\",\n    boots3 = \"boots3\",\n    chainmailHood = \"chainmailHood\",\n    chest = \"chest\",\n    clothGloves = \"clothGloves\",\n    cowl = \"cowl\",\n    fedora = \"fedora\",\n    druidChest = \"druidChest\",\n    druidFeet = \"druidFeet\",\n    druidHands = \"druidHands\",\n    druidHead = \"druidHead\",\n    druidLegs = \"druidLegs\",\n    greaves1 = \"greaves1\",\n    greaves2 = \"greaves2\",\n    hornedHelmet = \"hornedHelmet\",\n    leatherGloves = \"leatherGloves\",\n    nomadHelmet = \"nomadHelmet\",\n    pants1 = \"pants1\",\n    pants2 = \"pants2\",\n    plateChest1 = \"plateChest1\",\n    plateChest2 = \"plateChest2\",\n    plateChest3 = \"plateChest3\",\n    plateChest4 = \"plateChest4\",\n    plateGloves1 = \"plateGloves1\",\n    plateGloves2 = \"plateGloves2\",\n    plateHelmet = \"plateHelmet\",\n    platePants = \"platePants\",\n    plateShoulders1 = \"plateShoulders1\",\n    plateShoulders2 = \"plateShoulders2\",\n    robe = \"robe\",\n    shoulders1 = \"shoulders1\",\n    shoulders2 = \"shoulders2\",\n    shoulders3 = \"shoulders3\",\n    vest = \"vest\",\n\n    // materials\n    arrowheads = \"arrowheads\",\n    bolts = \"bolts\",\n    buckle = \"buckle\",\n    chain = \"chain\",\n    cogs = \"cogs\",\n    gem = \"gem\",\n    gunpowder = \"gunpowder\",\n    ingot = \"ingot\",\n    nails = \"nails\",\n    poisonVial = \"poisonVial\",\n    ribbon = \"ribbon\",\n    rope = \"rope\",\n    scales = \"scales\",\n    spring = \"spring\",\n    thread = \"thread\",\n\n    // quest-items\n    blueprints = \"blueprints\",\n    crate = \"crate\",\n    dragonEye = \"dragonEye\",\n    dynamite = \"dynamite\",\n    eye = \"eye\",\n    feather = \"feather\",\n    food = \"food\",\n    heart = \"heart\",\n    horn = \"horn\",\n    key = \"key\",\n    letters = \"letters\",\n    lockPicks = \"lockPicks\",\n    oil = \"oil\",\n    orcFinger = \"orcFinger\",\n    plans = \"plans\",\n    purpleGems = \"purpleGems\",\n    runestone = \"runestone\",\n    sandwich = \"sandwich\",\n    teeth = \"teeth\",\n    tooth = \"tooth\",\n    torch = \"torch\",\n    tusk = \"tusk\",\n    vase = \"vase\",\n    vial = \"vial\",\n    weeds = \"weeds\",\n\n    // trinkets\n    ring = \"ring\",\n    magicAmulet = \"magicAmulet\",\n\n    // weapons\n    aegisOfValor = \"aegisOfValor\",\n    arbalest = \"arbalest\",\n    battleAxe = \"battleAxe\",\n    berserkerShield = \"berserkerShield\",\n    brassKnuckles = \"brassKnuckles\",\n    buckler = \"buckler\",\n    cleaver = \"cleaver\",\n    club = \"club\",\n    dagger = \"dagger\",\n    falchion = \"falchion\",\n    flail = \"flail\",\n    goldenShield = \"goldenShield\",\n    greatswordOfGwai = \"greatswordOfGwai\",\n    halbert = \"halbert\",\n    huntingBow = \"huntingBow\",\n    indomitableCarapace = \"indomitableCarapace\",\n    javelin = \"javelin\",\n    khopesh = \"khopesh\",\n    legionnaireSword = \"legionnaireSword\",\n    longbow = \"longbow\",\n    mace = \"mace\",\n    morningStar = \"morningStar\",\n    paintedBuckler = \"paintedBuckler\",\n    poisonedDagger = \"poisonedDagger\",\n    pikeStaff = \"pikeStaff\",\n    ravenStaff = \"ravenStaff\",\n    scythe = \"scythe\",\n    savageStaff = \"savageStaff\",\n    simpleCrossbow = \"simpleCrossbow\",\n    spear = \"spear\",\n    steelShield = \"steelShield\",\n    steelSword = \"steelSword\",\n    warhammer = \"warhammer\",\n    woodenBulwark = \"woodenBulwark\"\n}\n\n\nexport interface ItemDefinition {\n    item: Item;\n    itemType: ItemType;\n    iconImg: string;\n    rarity?: Rarity;\n//    articleUndefined?: string;  // Key to text\n    unique?: boolean;           // Indicate that this item is unique.\n                                // Not actually enforced by anything,\n                                // but used to generate the article ('a' or 'the')\n}\n","import { paramCase as toKebab} from \"text-param-case\";\nimport { TextEntry } from \"constants/text\";\nimport { getDefinition } from \"definitions/items\";\nimport { Item, ItemType } from \"definitions/items/types\";\nimport { Resource } from \"definitions/resources\";\nimport { Structure } from \"definitions/structures\";\nimport * as Handlebars from \"handlebars\";\nimport { Trait } from 'definitions/traits/types';\nimport { Type } from 'components/ui/toasts/Toast';\nimport { EquipmentSlotType } from 'components/ui/adventurer/EquipmentSlot';\nimport { WeaponType, WeaponClassification } from 'definitions/items/weapons';\n\nexport abstract class TextManager {\n\n    public static init(texts: {[key: string]: string}, precompile = true) {\n        this.texts = texts;\n        this.templates = {};\n        if (precompile) {\n            this.compileAll();\n        }\n        this.initialized = true;\n    }\n\n//    public static addTexts(texts: Record<string, string>)\n    public static get(key: string, context?: unknown): string {\n        const result = this.getDefault(key, context);\n        if (result === null) {\n            // tslint:disable-next-line: no-console\n            console.error(`Key '${key}' not found in TextManager`);\n            return `<<'${key}' missing>>`;\n        } else {\n            return result;\n        }\n    }\n\n    // Will return `null` when no text found, otherwise will return the text\n    public static getDefault(key: string, context?: unknown): string|null {\n        if (!this.initialized) {\n            throw new Error(`Error ${this} not initialized!`);\n        }\n        const template = this.getTemplate(key);\n        if (!template) {\n            return null;\n        }\n        return template(context);\n    }\n\n    public static getTextEntry(textEntry: TextEntry): string {\n        return this.get(textEntry.key, textEntry.context);\n    }\n\n    public static getTemplate(key: string) {\n        let template = this.templates[key];\n        if (!template && this.texts[key]) {\n            // Template not found but key is defined. Needs to be compiled\n            this.compile(key, this.texts[key]);\n            template = this.templates[key];\n        }\n        return template;\n    }\n\n    public static getEquipmentSlot(slotType: EquipmentSlotType) {\n        return this.get(`ui-equipmentslot-${toKebab(EquipmentSlotType[slotType])}`);\n    }\n\n    public static getQuestTitle(name: string) {\n        return this.get(`quest-${toKebab(name)}-title`);\n    }\n\n    public static getQuestDescription(name: string) {\n        return this.get(`quest-${toKebab(name)}-description`);\n    }\n\n    public static getResourceName(type: Resource) {\n        return this.get(`resource-${type}-name`);\n    }\n\n    public static getItemName(item: Item): string {\n        const itemType = ItemType[getDefinition(item).itemType];\n        return this.get(`item-${toKebab(itemType)}-${toKebab(item)}-name`);\n    }\n    public static getItemSubtext(item: Item): string|null {\n        const itemType = ItemType[getDefinition(item).itemType];\n        return this.getDefault(`item-${toKebab(itemType)}-${toKebab(item)}-subtext`);\n    }\n\n    public static getStructureName(structure: Structure): string {\n        return this.get(`structure-${toKebab(structure)}-name`);\n    }\n\n    public static getTraitName(trait: Trait): string {\n        return this.get(`trait-${toKebab(trait)}-name`);\n    }\n\n    public static getTraitDescription(trait: Trait): string {\n        return this.get(`trait-${toKebab(trait)}-description`);\n    }\n\n    public static getTraitEffect(trait: Trait): string {\n        return this.get(`trait-${toKebab(trait)}-effect`);\n    }\n\n    public static getToastType(type: Type): string {\n        return this.get(`ui-toast-type-${toKebab(Type[type])}`);\n    }\n\n    public static getWeaponType(type: WeaponType) {\n        return this.get(`ui-weapon-type-${toKebab(WeaponType[type])}`);\n    }\n\n    public static getSkillName(type: WeaponType) {\n        return this.get(`skill-${toKebab(WeaponType[type])}-name`);\n    }\n\n    public static getSkillInfo(type: WeaponType) {\n        return this.get(`skill-${toKebab(WeaponType[type])}-info`);\n    }\n\n    static getWeaponClassification(weaponClass: WeaponClassification) {\n        return this.get(`ui-weapon-class-${toKebab(WeaponClassification[weaponClass])}`);\n    }\n\n    private static initialized = false;\n    private static texts: Record<string, string>;\n    private static templates: Record<string, Handlebars.TemplateDelegate<unknown>>;\n\n    private static compileAll() {\n        Object.keys(this.texts).forEach((key: string) =>  {\n            this.compile(key, this.texts[key]);\n        });\n    }\n\n    private static compile(key: string, value: string) {\n        const template = Handlebars.compile(value);\n        this.templates[key] = template;\n    }\n}\n\nHandlebars.registerHelper(\"item:name\", (item: Item, article?: string) => {\n    if (!getDefinition(item)) {\n        return new Handlebars.SafeString(`<<ITEM DEFINITION NOT FOUND: ${item}>>`);\n    }\n    switch (article) {\n        case \"aA\":  // article Auto\n            return itemArticleAuto(item);\n        case \"aD\":  // article Defined \"a sword\"\n            return itemArticleDefined(item);\n        case \"aU\":  // article Defined \"the sword\"\n            return itemArticleDefined(item);\n        default:\n            // No article\n            // const name = itemDefinitions[item].name;\n            return new Handlebars.SafeString(item);\n    }\n});\n\nHandlebars.registerHelper(\"structure:name\", (structure: string) => {\n    const name = TextManager.get(`structure-${toKebab(structure)}-name`);\n    return new Handlebars.SafeString(name);\n});\n\nHandlebars.registerHelper(\"resource:name\", (resource: string) => {\n    const name = TextManager.get(`resource-${resource}-name`);\n    return new Handlebars.SafeString(name);\n});\n\nconst itemArticleAuto = (item: Item) => {\n    return itemArticleUndefined(item);\n};\n\nconst itemArticleUndefined = (item: Item) => {\n    const name = TextManager.getItemName(item);\n    const articleTemplate = TextManager.getTemplate(\"common-article-undefined\");\n    return new Handlebars.SafeString(`${articleTemplate({ noun: name})}`);\n};\n\nconst itemArticleDefined = (item: Item) => {\n    const name = TextManager.getItemName(item);\n    const articleTemplate = TextManager.getTemplate(\"common-article-defined\");\n    return new Handlebars.SafeString(`${articleTemplate({ noun: name})}`);\n};\n","import { TextManager } from 'global/TextManager';\n\nexport const ONE_SECOND = 1000;\nexport const TWO_SECONDS = 2000;\nexport const THREE_SECONDS = 3000;\nexport const FOUR_SECONDS = 4000;\nexport const FIVE_SECONDS = 5000;\n// ...\nexport const TEN_SECONDS = 10000;\nexport const TWENTY_SECONDS = 20000;\nexport const THIRTY_SECONDS = 30000;\n\nexport const ONE_MINUTE = 60000;\nexport const TWO_MINUTES = 120000;\nexport const THREE_MINUTES = 180000;\nexport const FOUR_MINUTES = 240000;\n\nexport const HALF_HOUR = ONE_MINUTE * 30;\nexport const ONE_HOUR = ONE_MINUTE * 60;\nexport const ONE_DAY = ONE_HOUR * 24;\nexport const ONE_YEAR = ONE_DAY * 265.25;\n\nexport const formatDuration = (ms: number, short?: boolean): string => {\n    const timeUnitsList = [\n        { unit: short? 'y' : 'year', amount: ONE_YEAR },\n        { unit: short? 'd' : 'day', amount: ONE_DAY },\n        { unit: short? 'h' : 'hour', amount: ONE_HOUR },\n        { unit: short? 'm' : 'minute', amount: ONE_MINUTE },\n        { unit: short? 's': 'second', amount: ONE_SECOND },\n    ]\n    let time = Math.abs(ms);\n    const output: string[] = [];\n    timeUnitsList.forEach((el) => {\n        const tmp = Math.floor(time / el.amount);\n        time -= tmp * el.amount\n        if (tmp !== 0) {\n            const unit = TextManager.get(`common-time-${el.unit}${tmp > 1 && !short ? \"-plural\": \"\"}`);\n            output.push(`${tmp}${unit}`);\n        }\n    })\n    return output.join(\" \");\n}\n","// tslint:disable:object-literal-sort-keys\n\nimport alchemist from \"./alchemist\";\nimport armoursmith from \"./armoursmith\";\nimport garden from \"./garden\";\nimport lumberMill from \"./lumberMill\";\nimport mine from \"./mine\";\nimport quarry from \"./quarry\";\nimport tannery from \"./tannery\";\nimport tavern from \"./tavern\";\nimport { StructureDefinition } from \"./types\";\nimport warehouse from \"./warehouse\";\nimport weaponsmith from \"./weaponsmith\";\nimport weaver from \"./weaver\";\nimport workshop from \"./workshop\";\nimport { Resource } from 'definitions/resources';\n\nexport enum Structure {\n    alchemist = \"alchemist\",\n    armoursmith = \"armoursmith\",\n    garden = \"garden\",\n    lumberMill = \"lumberMill\",\n    mine = \"mine\",\n    quarry = \"quarry\",\n    tavern = \"tavern\",\n    tannery = \"tannery\",\n    warehouse = \"warehouse\",\n    weaponsmith = \"weaponsmith\",\n    weaver = \"weaver\",\n    workshop = \"workshop\",\n}\n\nconst all = {\n    alchemist,\n    armoursmith,\n    garden,\n    lumberMill,\n    mine,\n    quarry,\n    tavern,\n    tannery,\n    warehouse,\n    weaponsmith,\n    weaver,\n    workshop,\n};\n\nexport default all;\n\nexport function getDefinition<T extends StructureDefinition>(structure: Structure): T {\n    return all[structure] as unknown as T;\n}\n\nexport function getStructureByResource(resource: Resource) : Structure {\n    switch (resource) {\n        case Resource.fabric:\n            return Structure.weaver;\n        case Resource.food:\n            return Structure.garden;\n        case Resource.iron:\n            return Structure.mine;\n        case Resource.leather:\n            return Structure.tannery;\n        case Resource.stone:\n            return Structure.quarry;\n        case Resource.wood:\n            return Structure.lumberMill;\n    }\n}\n","// tslint:disable:object-literal-sort-keys\nimport { ONE_MINUTE, TWO_MINUTES } from 'utils/format/time';\nimport { ProductionStructureDefinition, StructureType } from \"./types\";\nconst alchemist: ProductionStructureDefinition = {\n    type: StructureType.production,\n    cost: {\n        gold: 40,\n        time: 4000,\n    },\n    levels: [{\n        displayName: \"structure-alchemist-name\",\n        // level 1:\n        workerCapacity: 2,\n        cost: {\n            gold: 0,\n        },\n        unlocks: [],\n    }, {\n        // level 2:\n        displayName: \"structure-alchemist-name\",\n        workerCapacity: 5,\n        cost: {\n            gold: 30,\n            time: ONE_MINUTE\n        },\n        unlocks: [],\n    }, {\n        // level 3:\n        displayName: \"structure-alchemist-name\",\n        workerCapacity: 10,\n        cost: {\n             gold: 50,\n             time: TWO_MINUTES\n        },\n        unlocks: [],\n    }],\n};\n\nexport default alchemist;\n","// tslint:disable:object-literal-sort-keys\n\nimport { ProductionStructureDefinition, StructureType } from \"./types\";\nimport { Item } from 'definitions/items/types';\nimport { ONE_MINUTE, TWO_MINUTES } from 'utils/format/time';\n\nconst armoursmith: ProductionStructureDefinition = {\n    cost: {\n        gold: 40,\n        time: 4000,\n    },\n    type: StructureType.production,\n    levels: [{\n        // level 1:\n        displayName: \"structure-armoursmith-name\",\n        workerCapacity: 2,\n        cost: {\n            gold: 0,\n        },\n        unlocks: [ Item.boots1 ],\n    }, {\n        // level 2:\n        displayName: \"structure-armoursmith-name\",\n        workerCapacity: 5,\n        cost: {\n            gold: 30,\n            time: ONE_MINUTE\n        },\n        unlocks: [ Item.chest ],\n    }, {\n        // level 3:\n        displayName: \"structure-armoursmith-name\",\n        workerCapacity: 10,\n        cost: {\n            gold: 50,\n            time: TWO_MINUTES\n        },\n        unlocks: [ Item.cowl],\n    }],\n};\nexport default armoursmith;\n","// tslint:disable:object-literal-sort-keys\nimport { ONE_MINUTE, TWO_MINUTES } from 'utils/format/time';\nimport { ResourceStructureDefinition, StructureType } from \"./types\";\n\nconst garden: ResourceStructureDefinition = {\n    type: StructureType.resource,\n    cost: {\n        gold: 40,\n        time: 4000,\n    },\n    levels: [{\n        displayName: \"structure-garden-name\",\n        // level 1:\n        workerCapacity: 2,\n        cost: {\n            gold: 0,\n        },\n        generates: { food: 2 },\n    }, {\n        displayName: \"structure-garden-name\",\n        // level 2:\n        workerCapacity: 5,\n        cost: {\n            gold: 30,\n            time: ONE_MINUTE\n        },\n        generates: { food: 4 },\n    }, {\n        // level 3:\n        displayName: \"structure-garden-name\",\n        workerCapacity: 10,\n        cost: {\n            gold: 50,\n            time: TWO_MINUTES\n        },\n        generates: { food: 8 },\n    }],\n};\n\nexport default garden;\n","// tslint:disable:object-literal-sort-keys\n\nimport { ResourceStructureDefinition, StructureType } from \"./types\";\nimport { HALF_HOUR, ONE_MINUTE, TWO_MINUTES } from 'utils/format/time';\n\nconst lumberMill: ResourceStructureDefinition = {\n    type: StructureType.resource,\n    cost: {\n        gold: 31,\n        time: HALF_HOUR,\n    },\n    levels: [{\n        // level 0:\n        displayName: \"structure-lumber-mill-name\",\n        workerCapacity: 2,\n        cost: {\n            gold: 0,\n        },\n        generates: { wood: 2 },\n    }, {\n        // level 1:\n        displayName: \"structure-lumber-mill-name\",\n        workerCapacity: 5,\n        cost: {\n            gold: 30,\n            time: ONE_MINUTE\n        },\n        generates: { wood: 2 },\n    }, {\n        // level 2:\n        displayName: \"structure-lumber-mill-name\",\n        workerCapacity: 10,\n        cost: {\n            gold: 50,\n            time: TWO_MINUTES\n        },\n        generates: { wood: 2 },\n    }],\n};\n\nexport default lumberMill;\n","// tslint:disable:object-literal-sort-keys\nimport { ONE_MINUTE, TWO_MINUTES } from 'utils/format/time';\nimport { ResourceStructureDefinition, StructureType } from \"./types\";\n\nconst mine: ResourceStructureDefinition = {\n    cost: {\n        gold: 40,\n        time: 4000,\n    },\n    type: StructureType.resource,\n    levels: [{\n        displayName: \"structure-mine-name\",\n        // level 0:\n        workerCapacity: 2,\n        cost: {\n            gold: 0,\n        },\n        generates: { iron: 2 },\n    }, {\n        displayName: \"structure-mine-name\",\n        // level 1:\n        workerCapacity: 5,\n        cost: {\n            gold: 30,\n            time: ONE_MINUTE\n        },\n        generates: { iron: 2 },\n    }, {\n        displayName: \"structure-mine-name\",\n        // level 2:\n        workerCapacity: 10,\n        cost: {\n            gold: 50,\n            time: TWO_MINUTES\n        },\n        generates: { iron: 2 },\n    }],\n};\nexport default mine;\n","// tslint:disable:object-literal-sort-keys\nimport { ONE_MINUTE, TWO_MINUTES } from 'utils/format/time';\nimport { ResourceStructureDefinition, StructureType } from \"./types\";\n\nconst quarry: ResourceStructureDefinition = {\n    cost: {\n        gold: 40,\n        time: 4000,\n    },\n    type: StructureType.resource,\n    levels: [{\n        displayName: \"structure-quarry-name\",\n        // level 1:\n        workerCapacity: 2,\n        cost: {\n            gold: 0,\n        },\n        generates: { stone: 2 },\n    }, {\n        // level 2:\n        displayName: \"structure-quarry-name\",\n        workerCapacity: 5,\n        cost: {\n            gold: 30,\n            time: ONE_MINUTE\n        },\n        generates: { stone: 4 },\n    }, {\n        // level 3:\n        displayName: \"structure-quarry-name\",\n        workerCapacity: 10,\n        cost: {\n            gold: 50,\n            time: TWO_MINUTES\n        },\n        generates: { stone: 6 },\n    }],\n};\n\nexport default quarry;\n","// tslint:disable:object-literal-sort-keys\n\nimport { ONE_MINUTE, TWO_MINUTES } from 'utils/format/time';\nimport { ResourceStructureDefinition, StructureType } from \"./types\";\n\nconst tannery: ResourceStructureDefinition = {\n    cost: {\n        gold: 40,\n        time: 4000,\n    },\n    type: StructureType.resource,\n    levels: [{\n        displayName: \"structure-tannery-name\",\n        // level 1:\n        workerCapacity: 2,\n        cost: {\n            gold: 0,\n        },\n        generates: { leather: 2 },\n    }, {\n        // level 2:\n        displayName: \"structure-tannery-name\",\n        workerCapacity: 5,\n        cost: {\n            gold: 30,\n            time: ONE_MINUTE\n        },\n        generates: { leather: 5 },\n    }, {\n        // level 3:\n        displayName: \"structure-tannery-name\",\n        workerCapacity: 10,\n        cost: {\n            gold: 50,\n            time: TWO_MINUTES\n        },\n        generates: { leather: 7 },\n    }],\n};\n\nexport default tannery;\n","// tslint:disable:object-literal-sort-keys\n\nimport { ONE_MINUTE, TWO_MINUTES } from 'utils/format/time';\nimport { StructureType, TavernStructureDefinition } from \"./types\";\n\nconst tavern: TavernStructureDefinition = {\n    cost: {\n        gold: 40,\n        time: 4000,\n    },\n    type: StructureType.tavern,\n    levels: [{\n        displayName: \"structure-tavern-name\",\n        // level 1:\n        workerCapacity: 2,\n        cost: {\n             gold: 0,\n        },\n        rooms: 10,\n    }, {\n        // level 2:\n        displayName: \"structure-tavern-name\",\n        workerCapacity: 5,\n        cost: {\n            gold: 30,\n            time: ONE_MINUTE\n        },\n        rooms: 12,\n    }, {\n        // level 3:\n        displayName: \"structure-tavern-name\",\n        workerCapacity: 10,\n        cost: {\n             gold: 50,\n             time: TWO_MINUTES\n        },\n        rooms: 15,\n    }],\n};\n\nexport default tavern;\n","// tslint:disable:object-literal-sort-keys\n\nimport { FOUR_MINUTES, TWO_MINUTES } from 'utils/format/time';\nimport {  StructureType, WarehouseStructureDefinition } from \"./types\";\n\nconst warehouse: WarehouseStructureDefinition = {\n    cost: {\n        gold: 40,\n        time: 4000,\n    },\n    type: StructureType.warehouse,\n    levels: [{\n        displayName: \"structure-warehouse-name\",\n        // level 1:\n        workerCapacity: 2,\n        cost: {\n            gold: 0,\n        },\n        maxResources: {\n            fabric: 200,\n            food: 200,\n            iron: 200,\n            leather: 200,\n            stone: 200,\n            wood: 200,\n        },\n        maxStockpile: 16\n    }, {\n        // level 2:\n        displayName: \"structure-warehouse-name\",\n        workerCapacity: 5,\n        cost: {\n            gold: 13,\n            time: FOUR_MINUTES\n        },\n        maxResources: {\n            fabric: 500,\n            food: 500,\n            iron: 500,\n            leather: 500,\n            stone: 500,\n            wood: 500,\n        },\n        maxStockpile: 32\n    }, {\n        // level 3:\n        displayName: \"structure-warehouse-name\",\n        workerCapacity: 10,\n        cost: {\n            gold: 50,\n            time: TWO_MINUTES * 5\n        },\n        maxResources: {\n            fabric: 1000,\n            food: 1000,\n            iron: 1000,\n            leather: 1000,\n            stone: 1000,\n            wood: 1000,\n        },\n        maxStockpile: 48\n    }],\n};\n\nexport default warehouse;\n","// tslint:disable:object-literal-sort-keys\nimport { ProductionStructureDefinition, StructureType } from \"./types\";\nimport { Item } from 'definitions/items/types';\nimport { ONE_MINUTE, THREE_MINUTES, TWO_MINUTES } from 'utils/format/time';\n\nconst weaponsmith: ProductionStructureDefinition = {\n    type: StructureType.production,\n    cost: {\n        gold: 40,\n        time: 4000,\n    },\n    levels: [{\n        // level 1:\n        displayName: \"structure-weaponsmith-name\",\n        workerCapacity: 2,\n        cost: {\n            gold: 0,\n        },\n        unlocks: [],\n    }, {\n        // level 2:\n        displayName: \"structure-weaponsmith-name\",\n        workerCapacity: 5,\n        cost: {\n            gold: 30,\n            time: ONE_MINUTE\n        },\n        unlocks: [],\n    }, {\n        // level 3:\n        displayName: \"structure-weaponsmith-name\",\n        workerCapacity: 10,\n        cost: {\n            gold: 50,\n            time: TWO_MINUTES\n\n        },\n        unlocks: [],\n    }, {\n        // level 4:\n        displayName: \"structure-weaponsmith-name\",\n        workerCapacity: 14,\n        cost: {\n            gold: 50,\n            time: THREE_MINUTES\n        },\n        unlocks: [Item.poisonedDagger],\n    }],\n};\nexport default weaponsmith;\n","// tslint:disable:object-literal-sort-keys\nimport { ONE_MINUTE, THREE_MINUTES } from 'utils/format/time';\nimport { ResourceStructureDefinition, StructureType } from \"./types\";\n\nconst weaver: ResourceStructureDefinition = {\n    cost: {\n        gold: 40,\n        time: 4000,\n    },\n    type: StructureType.resource,\n    levels: [{\n        displayName: \"structure-weaver-name\",\n        // level 0:\n        workerCapacity: 2,\n        cost: {\n            gold: 0,\n        },\n        generates: { fabric: 2 },\n    }, {\n        displayName: \"structure-weaver-name\",\n        // level 1:\n        workerCapacity: 5,\n        cost: {\n            gold: 30,\n            time: ONE_MINUTE\n        },\n        generates: { fabric: 5 },\n    }, {\n        displayName: \"structure-weaver-name\",\n        // level 2:\n        workerCapacity: 10,\n        cost: {\n            gold: 50,\n            time: THREE_MINUTES\n        },\n        generates: { fabric: 7 },\n    }],\n};\n\nexport default weaver;\n","// tslint:disable:object-literal-sort-keys\nimport { ONE_MINUTE, THREE_MINUTES, TWO_MINUTES } from 'utils/format/time';\nimport { ProductionStructureDefinition, StructureType } from \"./types\";\n\nconst workshop: ProductionStructureDefinition = {\n    type: StructureType.production,\n    cost: {\n        gold: 40,\n        time: 4000,\n    },\n    levels: [{\n        // level 1:\n        displayName: \"structure-workshop-name\",\n        workerCapacity: 2,\n        cost: {\n            gold: 0,\n        },\n        unlocks: [ ],\n    }, {\n        // level 2:\n        displayName: \"structure-workshop-name\",\n        workerCapacity: 5,\n        cost: {\n            gold: 30,\n            time: ONE_MINUTE\n        },\n        unlocks: [],\n    }, {\n        // level 3:\n        displayName: \"structure-workshop-name\",\n        workerCapacity: 10,\n        cost: {\n            gold: 50,\n            time: TWO_MINUTES\n        },\n        unlocks: [],\n    }, {\n        // level 4:\n        displayName: \"structure-workshop-name\",\n        workerCapacity: 14,\n        cost: {\n            gold: 50,\n            time: THREE_MINUTES\n        },\n        unlocks: [],\n    }],\n};\nexport default workshop;\n","// https://github.com/react-dnd/react-dnd/pull/1244\nimport * as React from \"react\";\nimport { ConnectDropTarget, DropTarget, DropTargetConnector, DropTargetMonitor, DropTargetSpec } from \"react-dnd\";\nimport { DragType } from \"constants/dragging\";\nimport { getDefinition } from \"definitions/items\";\nimport { ApparelDefinition } from \"definitions/items/apparel\";\nimport { Item, ItemType } from \"definitions/items/types\";\nimport { WeaponDefinition, WeaponTypeDefinition, WeaponClassification } from 'definitions/items/weapons';\nimport { InventoryItemDragInfo } from 'components/ui/items/DraggableItemIcon';\nimport \"./styles/equipmentslot.scss\";\n\nconst dropTarget: DropTargetSpec<Props> = {\n    drop(props: Props, monitor: DropTargetMonitor) {\n        props.onDrop(monitor.getItem());\n    },\n    canDrop(props: Props, monitor: DropTargetMonitor)  {\n        const item = monitor.getItem().item;\n\n        return itemAndEquipmentSlotMatch(item, props.type);\n    },\n};\n\nexport enum EquipmentSlotType {\n    feet,\n    hands,\n    chest,\n    legs,\n    head,\n    shoulders,\n    mainHand,\n    offHand,\n}\n\n// Returns true if item can be slotted in equipmentSlotType\nexport const itemAndEquipmentSlotMatch = (item: Item, equipmentSlotType: EquipmentSlotType) => {\n    switch (equipmentSlotType) {\n        case EquipmentSlotType.chest:\n        case EquipmentSlotType.feet:\n        case EquipmentSlotType.hands:\n        case EquipmentSlotType.head:\n        case EquipmentSlotType.legs:\n            return checkEquipment(item, equipmentSlotType);\n        case EquipmentSlotType.mainHand:\n        case EquipmentSlotType.offHand: {\n            const itemDefinition: WeaponDefinition = getDefinition(item) as WeaponDefinition;\n            if (itemDefinition.itemType !== ItemType.weapon) {\n                return false;\n            }\n            const { classification } = WeaponTypeDefinition[itemDefinition.weaponType];\n            switch (classification) {\n                case WeaponClassification.oneHanded:\n                    return true;\n                case WeaponClassification.mainHand:\n                    return equipmentSlotType === EquipmentSlotType.mainHand;\n                case WeaponClassification.offHand:\n                case WeaponClassification.shield:\n                    return equipmentSlotType === EquipmentSlotType.offHand;\n            }\n\n            // todo: prevent shields to be equipped in main hand\n            return true;\n        }\n        default:\n            return false;\n    }\n};\n\nexport interface Props {\n    type: EquipmentSlotType;\n    onDrop: (item: InventoryItemDragInfo) => void;\n}\n\nexport interface DropSourceProps {\n    canDrop: boolean;\n    isOver: boolean;\n    connectDropTarget: ConnectDropTarget;\n}\n\nconst collect = (connect: DropTargetConnector, monitor: DropTargetMonitor) => ({\n    canDrop: monitor.canDrop(),\n    connectDropTarget: connect.dropTarget(),\n    isOver: monitor.isOver(),\n});\n\n/**\n * The EquipmentSlot displays a slot in which an item can be placed.\n */\nconst EquipmentSlot = (props: React.PropsWithChildren<Props & DropSourceProps>) => {\n    const {\n        isOver,\n        canDrop,\n        connectDropTarget,\n    } = props;\n    const isActive = isOver && canDrop;\n    let borderColor = \"grey\";\n    if (isActive) {\n        borderColor = \"green\";\n    } else if (canDrop) {\n        borderColor = \"orange\";\n    }\n\n    return connectDropTarget(\n        <div className = \"equipment-slot\" style = { { borderColor }} title={EquipmentSlotType[props.type]}>\n            { props.children }\n        </div>,\n    );\n};\n\nexport default DropTarget<Props, DropSourceProps>(\n    DragType.ITEM,\n    dropTarget,\n    collect,\n)(EquipmentSlot);\n\nconst checkEquipment = (item: Item, equipmentType: EquipmentSlotType) => {\n    const itemDefinition = getDefinition(item);\n    if (itemDefinition.itemType !== ItemType.apparel) {\n        return false;\n    }\n    return (itemDefinition as ApparelDefinition).equipmentType === equipmentType;\n};\n","import { QuestStoreState } from 'store/types/quest';\nimport { Item } from 'definitions/items/types';\n\nexport enum QuestNodeType {\n    nothing = 0,    // Nothing much going on here\n    encounter = 1,\n    // combat = 2,     // Not implemented\n    // boss = 3,\n}\n\n// eslint-disable-next-line @typescript-eslint/ban-types\nexport interface QuestDefinition<TQuestVars = unknown> {\n    nodes: QuestNode[];\n    requiredItems?: Item[];\n    getQuestVars: (questStoreState: QuestStoreState) => TQuestVars;\n    getInitialQuestVars: (questStoreState: QuestStoreState) => TQuestVars;\n}\n\ntype AllNodeTypes = {\n    x: number;\n    y: number;\n    log?: string;   \n}\n\nexport type QuestNode  =\n    | AllNodeTypes & { type: QuestNodeType.nothing}\n    | AllNodeTypes & { type: QuestNodeType.encounter, startScene: string}\n","import localforage from 'localforage';\nimport sound from 'pixi-sound';\nimport {gsap } from 'gsap';\nimport { Loader } from 'pixi.js';\n\nexport enum Channel {\n    music,\n    ui,\n    scene\n}\n\nexport enum MixMode {\n    singleInstance,     // Only one sound plays at the same time in this channel\n    layered,            // Multiple sounds can play in this channel\n    fade                // Fades out currently playing sound on this channel and fades new music in\n}\n\nexport enum Music {\n    town,\n    world,\n}\n\nexport type GameSound =\n    \"ui/buttonClick\" |\n    \"ui/equip\" |\n    \"ui/error\" |\n    \"ui/levelUp\" |\n    \"ui/toast\" |\n    \"music/town\" |\n    \"music/world\" |\n    \"scene/bow\" |\n    \"scene/doorOpen\" |\n    \"scene/meleeHit\" |\n    \"scene/metalBash\" |\n    \"scene/shieldBash\" |\n    \"scene/swish\"\n;\n\ntype SoundInfo = {\n    instance: sound.IMediaInstance;\n    gameSound: GameSound;\n    pixiSound: sound.Sound;\n    storePosition?: boolean;\n}\n\nconst DEFAULT_MUSIC_VOLUME = 0;\nconst DEFAULT_UI_VOLUME = 1;\nconst DEFAULT_SCENE_VOLUME = 1;\nconst STORAGE_KEY_VOLUME = \"channelVolume\";\n\nexport class SoundManager {\n    private static _sounds: { [key: string]: sound.Sound[] } = {};\n    private static _currentSound: { [key: number]: SoundInfo } = {};    // per channel\n    private static _storedPositions: { [key: string]: number } = {};\n    \n    private static _channelVolume: {[key: number]: number} = {};\n    private static _initialized = false;\n    private static _filter = new sound.filters.TelephoneFilter() \n\n    public static async init() {\n        // Attempt to fetch volumes from storage. If not set, revert to defaults\n        this._channelVolume = {\n            [(Channel.music)]: await localforage.getItem(`${STORAGE_KEY_VOLUME}-${Channel.music}`) ?? DEFAULT_MUSIC_VOLUME,\n            [(Channel.ui)]: await localforage.getItem(`${STORAGE_KEY_VOLUME}-${Channel.ui}`) ?? DEFAULT_UI_VOLUME,\n            [(Channel.scene)]: await localforage.getItem(`${STORAGE_KEY_VOLUME}-${Channel.scene}`) ?? DEFAULT_SCENE_VOLUME,\n        }\n        this._initialized = true;\n    }\n\n\n    public static async addSound(gameSound: GameSound, files: string[] | string, complete?: (sounds: sound.Sound[]) => void) {\n        if (typeof files === \"string\") {\n            files = [files];\n        }\n        if(this._sounds[gameSound]) {\n            // Sound already loaded. Great.\n            complete?.(this._sounds[gameSound]);\n            return;\n        }\n\n        const loader = new Loader();\n        files.map((file) => loader.add(file));\n        loader.load((_, resources) => {\n            if (resources) {\n                // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n                this._sounds[gameSound] = Object.values(resources!).filter(Boolean).map(r => r!.sound!)!;\n                complete?.(this._sounds[gameSound]);\n            }\n        });\n    }\n\n    /**\n     * Plays a sound. The sound needs to be loaded through `addSound` first!\n     * @param gameSound the GameSound to play\n     * @param channel channel to play the sound on\n     * @param loop true to make the sound repeat\n     * @param mixMode how to mix in the new sound into the channel\n     * @param storePosition Store position of current sound on this channel in order to resume\n     */\n    public static async playSound(gameSound: GameSound, channel: Channel = Channel.ui, loop = false, mixMode: MixMode = MixMode.singleInstance, storePosition = false) {\n        if (!this._initialized) {\n            await this.init();\n        }\n\n       // \n\n        const pixiSound = this.getSound(gameSound);\n        pixiSound.volume = this._channelVolume[channel];\n        pixiSound.loop = loop;\n\n        if (this._currentSound[channel]?.storePosition) {\n            // Did we have to store the position of the current sound?\n            const oldSoundInfo = this._currentSound[channel];\n            // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n            // @ts-ignore https://github.com/pixijs/pixi-sound/issues/111\n            oldSoundInfo.instance.once('progress', (progress: number , duration: number) => {\n                this._storedPositions[oldSoundInfo.gameSound] = progress * duration;\n            });\n        }\n        const start = this._storedPositions[gameSound] ?? 0;\n        const instance = await pixiSound.play({ start });\n\n        if (this._currentSound[channel]) {\n            if (mixMode === MixMode.fade) {\n                // Fade out current sound on this channel and fade in new sound\n                const oldSoundInfo = this._currentSound[channel];\n                gsap.to(oldSoundInfo.instance, { volume: 0, duration: .75, onComplete: () => {\n                    oldSoundInfo.instance.destroy();\n                }});\n                // Fade in the new sound\n                gsap.from(instance, { volume: 0, duration: 0.75 });\n            }\n            else if (mixMode === MixMode.singleInstance) {\n                this._currentSound[channel].instance.stop();\n            }\n        }\n        this._currentSound[channel] = { instance, gameSound, pixiSound, storePosition };\n        instance.on('end', () => {\n            this._currentSound[channel].instance.destroy();\n            delete this._currentSound[channel];\n        });\n    }\n\n    protected static getSound(sound: GameSound): sound.Sound {\n        if (!this._sounds[sound]?.length) {\n            throw new Error(`No sound found for ${sound}`);\n        }\n        if (this._sounds[sound].length === 1) {\n            return this._sounds[sound][0];\n        }\n        else {\n            return this._sounds[sound][Math.floor(Math.random() * this._sounds[sound].length)];\n        }\n    }\n\n    public static set musicFiltered(value: boolean) {\n        if(this._currentSound[Channel.music]) {\n            this._currentSound[Channel.music].pixiSound.filters = value ? [ this._filter ] : []\n        }\n    }\n\n    static getChannelVolume(channel: Channel): number {\n        return this._channelVolume[channel];\n    }\n\n    static setChannelVolume(channel: Channel, volume:number) {\n        this._channelVolume[channel] = volume;\n        if(this._currentSound[channel]?.instance) {\n            this._currentSound[channel].instance.volume = volume;\n        }\n        localforage.setItem(`${STORAGE_KEY_VOLUME}-${channel}`, volume);\n    }\n}\n","import { TiledObjectData } from 'constants/tiledMapData';\nimport { Item } from 'definitions/items/types';\nimport { Merge } from 'type-fest';\nimport { TiledObjectType } from 'utils/tilemap';\nimport { Allegiance } from './combat';\n\n\nexport interface SceneStoreState {\n    objects: SceneObject[];\n    actionQueue?: SceneAction[];\n    activeInteractionModal?: SceneInteractionModal;\n    combat: boolean;\n}\n\nexport type SceneObject = Merge<TiledObjectData, {\n    layerId: number;\n    properties: { [key: string]: string | boolean | number };\n    location?: [number, number];\n}>;\n\nexport type ActorObject = SceneObject & {\n    ap: number;                     // Remaining AP\n    health: number;\n    allegiance: Allegiance;\n};\n\n// Type guard\nexport const isActorObject = (object: SceneObject): object is ActorObject => {\n    return object.type === TiledObjectType.actor;\n}\n\nexport const isAdventurer = (object: SceneObject): boolean => {\n    return isActorObject(object) && object.allegiance === Allegiance.player;\n}\n\n // export type Actor = SceneObject & {\n//     type: \"actor\";\n//     //allegiance: Allegiance;\n//     health: number;\n//     //remainingAP: number;\n// }\n\nexport type SceneInteractionModal =\n| { type: 'lootCache', lootCache: string }\n| { type: 'situation', situation: string }\n\nexport interface LootCache {\n    title: string;\n    items: Item[];\n    gold?: number;\n    open?: boolean;\n}\n\nexport interface SceneAction {\n    actionType: SceneActionType;\n    actorId: string;\n    target: [number, number];\n    endsAt: number;\n}\n\nexport enum SceneActionType {\n    move = \"move\",\n    interact = \"interact\",\n    attack = \"attack\",\n    slash = \"slash\"\n}\n\nexport const getSpritesheetPaths = (objects: SceneObject[]) => {\n    return Array.from(\n        new Set<string>(\n            objects.filter(o => o.properties.isSprite)\n                .map(o => o.properties.spritesheet as string)\n        )\n    );\n}","\nexport enum Rarity {\n    // gray = common, green = uncommon, blue = rare, purple = epic, orange = legendary\n    common,\n    uncommon,\n    rare,\n    epic,\n    legendary\n}\n","import * as React from \"react\";\nimport { PropsWithChildren } from 'react';\nimport \"./styles/icon.scss\";\n\nexport interface Props {\n    image: string;\n    size?: IconSizeType;\n    className?: string;\n    border?: Border | keyof typeof Border;\n}\n\nexport enum IconSize {\n    smallest = \"smallest\",\n    small = \"small\",\n    medium = \"medium\",\n    big = \"big\",\n    biggest = \"biggest\"\n}\n\ntype IconSizeType = IconSize | keyof typeof IconSize;\n\nexport enum Border {\n    none = \"none\",\n    gold = \"gold\"\n}\n\nconst Icon = (props: PropsWithChildren<Props> & React.ComponentProps<\"div\">) => {\n    const {\n        image,\n        size,\n        children,\n        className = \"\",\n        border = \"none\",\n        ...restProps\n    } = props;\n    return (\n        <div\n            className={`icon ${sizeClassName((typeof size === \"string\") ? IconSize[size] : size)} ${className}`}\n            {...restProps}\n            style={{\n                backgroundImage: `url(${process.env.PUBLIC_URL}${image})`,\n            }}\n        >\n            {children}\n            { border !== \"none\" && border && (\n                <div className={`border ${borderClassName((typeof border === \"string\") ? Border[border] : border)} `}/>\n            )}\n        </div>\n    );\n};\n\nexport default Icon;\n\n\nconst sizeClassName = (size?: IconSize): string => {\n    switch (size) {\n        case IconSize.smallest:\n            return \"size-smallest\";\n        case IconSize.small:\n            return \"size-small\";\n        case IconSize.medium:\n            return \"size-medium\";\n        case IconSize.big:\n            return \"size-big\";\n        case IconSize.biggest:\n            return \"size-biggest\";\n    }\n    return sizeClassName(IconSize.medium);\n};\n\nconst borderClassName = (border?: Border): string => {\n    switch (border) {\n        case Border.gold:\n            return \"border-gold\";\n        case Border.none:\n        default:\n            return \"\";\n    }\n}","import { Action } from \"redux\";\nimport { AdventurerStoreState } from \"store/types/adventurer\";\nimport { SceneAction, SceneStoreState, SceneObject, SceneInteractionModal } from \"store/types/scene\";\nimport { Item } from 'definitions/items/types';\nimport { PartialDeep } from \"type-fest\";\n\n// tslint:disable:object-literal-sort-keys\n\nexport enum ActionType {\n    launchQuest = \"launchQuest\",                            // Embark upon a new quest\n    updateQuestVars = \"updateQuestVars\",                    // ?\n    updateEncounterResult = \"updateEncounterResult\",        // unused?\n    startEncounter = \"startEncounter\",                      // unused! remove\n    setSceneName = \"setSceneName\",                          // Sets name of the current scene of a quest\n    setScene = \"setScene\",                                  // Fills in the scene of a quest\n    exitEncounter = \"exitEncounter\",                        // Encounter is complete, leave scene and continue on quest\n    enqueueSceneAction = \"enqueueSceneAction\",\n    completeSceneAction = \"completeSceneAction\",\n    setCombat = \"setCombat\",                                // Sets combat status\n    deductActorAp = \"deductActorAp\",\n    updateSceneObjectAction = \"updateSceneObjectAction\",    // Updates a tile object on the scene. Can update any property except 'id'\n    setActiveSceneInteractionModal = \"setActiveSceneInteractionModal\",     // Sets the active  modal\n}\n\nexport interface QuestAction extends Action<ActionType> {\n    questName: string;\n}\n\nexport interface QuestVarsAction extends QuestAction {\n    vars: PartialDeep<unknown>;\n}\n\nexport interface QuestLaunchAction extends QuestAction {\n    assignedAventurers: AdventurerStoreState[];\n}\n\nexport interface SetSceneNameAction extends QuestAction {\n    sceneName: string;\n}\n\nexport interface SetSceneAction extends QuestAction {\n    scene: SceneStoreState;\n}\n\nexport interface EnqueueSceneActionAction extends QuestAction {\n    sceneAction: SceneAction;\n}\n\nexport interface DeductActorApAction extends QuestAction {\n    actor: string;\n    ap: number;\n}\n\nexport interface SetCombatAction extends QuestAction {\n    combat: boolean;\n}\n\nexport interface UpdateEncounterResultAction extends QuestAction {\n    nodeIndex: number;\n    result: string;\n}\n\nexport interface SetActiveSceneInteractionModalAction extends QuestAction {\n    sceneInteractionModal?: SceneInteractionModal;\n}\n\nexport interface TakeItemFromCacheAction extends QuestAction {\n    cacheName: string;\n    item: Item;\n}\n\nexport interface UpdateSceneObjectAction extends QuestAction {\n    id: number;\n    object: Partial<Omit<SceneObject, 'id'>>;\n}\n\nexport function launchQuest(questName: string, assignedAventurers: AdventurerStoreState[]): QuestLaunchAction {\n    return {\n        type: ActionType.launchQuest,\n        questName,\n        assignedAventurers,\n    };\n}\n\n/** Completes the current encounter so the party can continue the quest */\nexport function exitEncounter(quest: string): QuestAction {\n    return {\n        type: ActionType.exitEncounter,\n        questName: quest,\n    };\n}\n\nexport function updateQuestVars(quest: string, vars: PartialDeep<unknown>): QuestVarsAction {\n    return {\n        type: ActionType.updateQuestVars,\n        questName: quest,\n        vars,\n    };\n}\n\n// Scene stuff\n\nexport function setSceneName(questName: string, sceneName: string): SetSceneNameAction {\n    return {\n        type: ActionType.setSceneName,\n        questName,\n        sceneName,\n    };\n}\n\nexport function setScene(questName: string, scene: SceneStoreState): SetSceneAction {\n    return {\n        type: ActionType.setScene,\n        questName,\n        scene,\n    };\n}\n\nexport function enqueueSceneAction(quest: string, sceneAction: SceneAction): EnqueueSceneActionAction {\n    return {\n        type: ActionType.enqueueSceneAction,\n        questName: quest,\n        sceneAction,\n    };\n}\n\nexport function completeSceneAction(quest: string): QuestAction {\n    return {\n        type: ActionType.completeSceneAction,\n        questName: quest,\n    };\n}\n\nexport function setCombat(quest: string, combat: boolean): SetCombatAction {\n    return {\n        type: ActionType.setCombat,\n        questName: quest,\n        combat\n    };\n}\n\nexport function deductActorAp(quest: string, actor: string, ap: number): DeductActorApAction {\n    return {\n        type: ActionType.deductActorAp,\n        questName: quest,\n        actor,\n        ap\n    };\n}\n\n// export const updateSceneObject = (questName: string, id: number, object: Partial<Omit<SceneObject, 'id'>>): UpdateSceneObjectAction => {\n//     return {\n//         type: ActionType.updateSceneObjectAction,\n//         questName,\n//         id,\n//         object\n//     };\n// }\n\nexport function updateEncounterResult(quest: string, nodeIndex: number, result: string): UpdateEncounterResultAction {\n    return {\n        type: ActionType.updateEncounterResult,\n        questName: quest,\n        nodeIndex,\n        result,\n    };\n}\n\nexport const setActiveSceneInteractionModal = (questName: string, sceneInteractionModal?: SceneInteractionModal): SetActiveSceneInteractionModalAction => {\n   return {\n       type: ActionType.setActiveSceneInteractionModal,\n       questName,\n       sceneInteractionModal\n   }\n}\n","// Utilities for routing\n\nimport { Structure } from 'definitions/structures';\n\nexport const getWorldLink = () => `/world`;\nexport const getQuestLink = (questName: string) => `${getWorldLink()}/${questName}`;\n\nexport const getTownLink = () => `/town`;\nexport const getStructureLink = (structure: Structure) => `${getTownLink()}/${structure}`;\n","// tslint:disable: object-literal-sort-keys\nexport enum Resource {\n    wood = \"wood\",\n    iron = \"iron\",\n    stone = \"stone\",\n    leather = \"leather\",\n    fabric = \"fabric\",\n    food = \"food\",\n}\n\n\nexport interface ResourceDefinition {\n    resource: Resource;\n    iconImg: string;\n}\n\nconst all = {\n    [Resource.wood]: {\n        resource: Resource.wood,\n        iconImg: \"/img/resources/wood.png\",\n    },\n    [Resource.iron]: {\n        resource: Resource.iron,\n        iconImg: \"/img/resources/iron.png\",\n    },\n    [Resource.stone]: {\n        resource: Resource.stone,\n        iconImg: \"/img/resources/stone.png\",\n    },\n    [Resource.leather]: {\n        resource: Resource.leather,\n        iconImg: \"/img/resources/leather.png\",\n    },\n    [Resource.fabric]: {\n        resource: Resource.fabric,\n        iconImg: \"/img/resources/fabric.png\",\n    },\n    [Resource.food]: {\n        resource: Resource.food,\n        iconImg: \"/img/resources/food.png\",\n    },\n};\n\nexport default all;","import { ResourceStoreState } from \"store/types/resources\";\nimport { CostStoreState } from \"../production/types\";\nimport { Item } from 'definitions/items/types';\n\nexport enum StructureType {\n    resource,\n    production,\n    tavern,\n    warehouse,\n}\n\nexport interface StructureDefinition {\n    type: StructureType;\n    cost: CostStoreState;\n    levels: StructureLevelDefinition[];\n}\n\nexport interface StructureLevelDefinition {\n    displayName: string;          // At this moment we can potentially support different names depending on the level\n                                  // of the structure. But this is not implemented because I feel it can cause confusion\n                                  // todo: REMOVE\n    cost: CostStoreState;         // in gold\n    workerCapacity: number;       // number of workers that can work at this structure at this level\n}\n\nexport interface ResourceStructureDefinition extends StructureDefinition {\n    levels: ResourceStructureLevelDefinition[];\n}\n\nexport interface ResourceStructureLevelDefinition extends StructureLevelDefinition {\n    generates: ResourceStoreState;\n}\n\nexport interface ProductionStructureDefinition extends StructureDefinition {\n    levels: ProductionStructureLevelDefinition[];\n}\n\nexport interface ProductionStructureLevelDefinition extends StructureLevelDefinition {\n    unlocks: Item[];\n}\n\nexport interface WarehouseStructureDefinition extends StructureDefinition {\n    levels: WarehouseStructureLevelDefinition[];\n}\n\nexport interface WarehouseStructureLevelDefinition extends StructureLevelDefinition {\n    maxResources: ResourceStoreState;\n    maxStockpile: number;\n}\n\n// tslint:disable-next-line:no-empty-interface\nexport interface TavernStructureDefinition extends StructureDefinition {\n    levels: TavernStructureLevelDefinition[];\n}\n\nexport interface TavernStructureLevelDefinition extends StructureLevelDefinition {\n    rooms: number;\n}\n","// tslint:disable:object-literal-sort-keys\nimport { Item, ItemDefinition, ItemType } from \"./types\";\nimport { Rarity } from 'constants/items';\n\nconst itemType = ItemType.weapon;\nconst basePath = \"/img/items/weapons/\";\n\nexport enum WeaponType {\n    axe = \"axe\",\n    bow = \"bow\",\n    club = \"club\",\n    crossbow = \"crossbow\",\n    fist = \"fist\",\n    flail = \"flail\",\n    hammer = \"hammer\",\n    knife = \"knife\",\n    staff = \"staff\",\n    shield = \"shield\",\n    sword = \"sword\",\n    poleArm = \"poleArm\",\n}\n\nexport enum WeaponAbility {\n    aimedShot,\n    swing,\n    block,\n    cut,\n    cleave,\n    shoot,\n    slash,\n    parry,\n}\n\nexport enum WeaponClassification {\n    oneHanded,  // Can be used in main hand or off hand\n    mainHand,   // Can only be used in main hand\n    offHand,    // Can only be used in the off hand\n    twoHanded,  // Can be used in the main hand and will disable off hand from being used\n    shield      // ?\n    // add 'ranged'?\n}\n\nexport const WeaponTypeDefinition = {\n    [WeaponType.axe]: {\n        classification: WeaponClassification.oneHanded,\n        abilities: [WeaponAbility.cut],\n    },\n    [WeaponType.bow]: {\n        classification: WeaponClassification.oneHanded,\n        abilities: [WeaponAbility.shoot]\n    },\n    [WeaponType.club]: {\n        classification: WeaponClassification.oneHanded,\n        abilities: [WeaponAbility.swing, WeaponAbility.parry]\n    },\n    [WeaponType.crossbow]: {\n        classification: WeaponClassification.mainHand,\n        abilities: [WeaponAbility.aimedShot, WeaponAbility.shoot]\n    },\n    [WeaponType.fist]: {\n        classification: WeaponClassification.oneHanded,\n        abilities: [WeaponAbility.swing]\n    },\n    [WeaponType.flail]: {\n        classification: WeaponClassification.mainHand,\n        abilities: [WeaponAbility.swing, WeaponAbility.parry]\n    },\n    [WeaponType.hammer]: {\n        classification: WeaponClassification.oneHanded,\n        abilities: [WeaponAbility.swing, WeaponAbility.parry]\n    },\n    [WeaponType.knife]: {\n        classification: WeaponClassification.oneHanded,\n        abilities: [WeaponAbility.cut, WeaponAbility.parry]\n    },\n    [WeaponType.staff]: {\n        classification: WeaponClassification.twoHanded,\n        abilities: [WeaponAbility.swing, WeaponAbility.parry]\n    },\n    [WeaponType.sword]: {\n        classification: WeaponClassification.oneHanded,\n        abilities: [WeaponAbility.swing, WeaponAbility.parry]\n    },\n    [WeaponType.poleArm]: {\n        classification: WeaponClassification.twoHanded,\n        abilities: [WeaponAbility.swing, WeaponAbility.parry]\n    },\n    [WeaponType.shield]: {\n        classification: WeaponClassification.shield,\n        abilities: [WeaponAbility.block]\n    }\n}\n\nexport enum DamageType {\n    kinetic = \"kinetic\",\n}\n\nexport interface DamageDefinition {\n    [DamageType.kinetic]: number | undefined;\n}\n\n\n// tslint:disable-next-line:no-empty-interface\nexport interface WeaponDefinition extends ItemDefinition {\n    weaponType: WeaponType;\n    damage?: DamageDefinition;\n}\n\nconst weaponDefinitions: Record<string, WeaponDefinition> = {\n    [Item.aegisOfValor]: {\n        item: Item.aegisOfValor,\n        itemType,\n        weaponType: WeaponType.shield,\n        rarity: Rarity.legendary,\n        iconImg: `${basePath}aegis-of-valor.png`,\n    },\n    [Item.arbalest]: {\n        item: Item.arbalest,\n        itemType,\n        weaponType: WeaponType.crossbow,\n        rarity: Rarity.epic,\n        iconImg: `${basePath}arbalest.png`,\n        damage: { [DamageType.kinetic]: 40 },\n    },\n    [Item.battleAxe]: {\n        item: Item.battleAxe,\n        itemType,\n        weaponType: WeaponType.axe,\n        rarity: Rarity.common,\n        iconImg: `${basePath}battle_axe.png`,\n        damage: { [DamageType.kinetic]: 20 },\n    },\n    [Item.berserkerShield]: {\n        item: Item.berserkerShield,\n        itemType,\n        weaponType: WeaponType.shield,\n        rarity: Rarity.epic,\n        iconImg: `${basePath}berserker-shield.png`,\n    },\n    [Item.brassKnuckles]: {\n        item: Item.brassKnuckles,\n        itemType,\n        weaponType: WeaponType.fist,\n        iconImg: `${basePath}brass_knuckles.png`,\n        rarity: Rarity.common,\n        damage: { [DamageType.kinetic]: 10 },\n    },\n    [Item.buckler]: {\n        item: Item.buckler,\n        itemType,\n        weaponType: WeaponType.shield,\n        rarity: Rarity.common,\n        iconImg: `${basePath}buckler.png`,\n    },\n    [Item.cleaver]: {\n        item: Item.cleaver,\n        itemType,\n        weaponType: WeaponType.knife,\n        iconImg: `${basePath}cleaver.png`,\n        rarity: Rarity.common,\n        damage: { [DamageType.kinetic]: 5 },\n    },\n    [Item.club]: {\n        item: Item.club,\n        itemType,\n        weaponType: WeaponType.club,\n        iconImg: `${basePath}club.png`,\n        rarity: Rarity.common,\n        damage: { [DamageType.kinetic]: 8 },\n    },\n    [Item.dagger]: {\n        item: Item.dagger,\n        itemType,\n        weaponType: WeaponType.knife,\n        iconImg: `${basePath}dagger.png`,\n        rarity: Rarity.uncommon,\n        damage: { [DamageType.kinetic]: 8 },\n    },\n    [Item.falchion]: {\n        item: Item.flail,\n        itemType,\n        weaponType: WeaponType.sword,\n        iconImg: `${basePath}falchion.png`,\n        rarity: Rarity.rare,\n        damage: { [DamageType.kinetic]: 12 },\n    },\n    [Item.flail]: {\n        item: Item.flail,\n        itemType,\n        weaponType: WeaponType.flail,\n        iconImg: `${basePath}flail.png`,\n        rarity: Rarity.uncommon,\n        damage: { [DamageType.kinetic]: 15 },\n    },\n    [Item.goldenShield]: {\n        item: Item.goldenShield,\n        itemType,\n        weaponType: WeaponType.shield,\n        rarity: Rarity.rare,\n        iconImg: `${basePath}golden-shield.png`,\n    },\n    [Item.greatswordOfGwai]: {\n        item: Item.greatswordOfGwai,\n        itemType,\n        weaponType: WeaponType.sword,\n        iconImg: `${basePath}greatsword-gwai.png`,\n        unique: true,\n        rarity: Rarity.legendary,\n        damage: { [DamageType.kinetic]: 25 },\n    },\n    [Item.halbert]: {\n        item: Item.halbert,\n        itemType,\n        weaponType: WeaponType.poleArm,\n        iconImg: `${basePath}halbert.png`,\n        rarity: Rarity.rare,\n        damage: { [DamageType.kinetic]: 12 },\n    },\n    [Item.huntingBow]: {\n        item: Item.huntingBow,\n        itemType,\n        weaponType: WeaponType.bow,\n        iconImg: `${basePath}hunting-bow.png`,\n        rarity: Rarity.common,\n        damage: { [DamageType.kinetic]: 3 },\n    },\n    [Item.indomitableCarapace]: {\n        item: Item.indomitableCarapace,\n        itemType,\n        weaponType: WeaponType.shield,\n        rarity: Rarity.epic,\n        unique: true,\n        iconImg: `${basePath}indomitable-carapace.png`,\n    },\n    [Item.javelin]: {\n        item: Item.javelin,\n        itemType,\n        weaponType: WeaponType.poleArm,\n        iconImg: `${basePath}javelin.png`,\n        rarity: Rarity.epic,\n        damage: { [DamageType.kinetic]: 25 },\n    },\n    [Item.khopesh]: {\n        item: Item.khopesh,\n        itemType,\n        weaponType: WeaponType.sword,\n        iconImg: `${basePath}khopesh.png`,\n        rarity: Rarity.epic,\n        damage: { [DamageType.kinetic]: 15 },\n    },\n    [Item.legionnaireSword]: {\n        item: Item.legionnaireSword,\n        itemType,\n        weaponType: WeaponType.sword,\n        iconImg: `${basePath}legionnaire-sword.png`,\n        rarity: Rarity.rare,\n        damage: { [DamageType.kinetic]: 8 },\n    },\n    [Item.longbow]: {\n        item: Item.longbow,\n        itemType,\n        weaponType: WeaponType.bow,\n        iconImg: `${basePath}longbow.png`,\n        rarity: Rarity.rare,\n        damage: { [DamageType.kinetic]: 2 },\n    },\n    [Item.mace]: {\n        item: Item.mace,\n        itemType,\n        weaponType: WeaponType.club,\n        iconImg: `${basePath}mace.png`,\n        rarity: Rarity.rare,\n        damage: { [DamageType.kinetic]: 15 },\n    },\n    [Item.morningStar]: {\n        item: Item.morningStar,\n        itemType,\n        weaponType: WeaponType.club,\n        iconImg: `${basePath}morning-star.png`,\n        rarity: Rarity.uncommon,\n        damage: { [DamageType.kinetic]: 13 },\n    },\n    [Item.paintedBuckler]: {\n        item: Item.paintedBuckler,\n        itemType,\n        weaponType: WeaponType.shield,\n        iconImg: `${basePath}painted-buckler.png`,\n    },\n    [Item.poisonedDagger]: {\n        item: Item.poisonedDagger,\n        itemType,\n        weaponType: WeaponType.knife,\n        iconImg: `${basePath}poisoned-dagger.png`,\n        rarity: Rarity.epic,\n        damage: { [DamageType.kinetic]: 12 },\n    },\n    [Item.pikeStaff]: {\n        item: Item.pikeStaff,\n        itemType,\n        weaponType: WeaponType.poleArm,\n        iconImg: `${basePath}pike-staff.png`,\n        rarity: Rarity.uncommon,\n        damage: { [DamageType.kinetic]: 22 },\n    },\n    [Item.ravenStaff]: {\n        item: Item.ravenStaff,\n        itemType,\n        weaponType: WeaponType.staff,\n        iconImg: `${basePath}raven-staff.png`,\n        rarity: Rarity.epic,\n        damage: { [DamageType.kinetic]: 13 },\n    },\n    [Item.scythe]: {\n        item: Item.scythe,\n        itemType,\n        weaponType: WeaponType.poleArm,\n        iconImg: `${basePath}scythe.png`,\n        rarity: Rarity.common,\n        damage: { [DamageType.kinetic]: 5 },\n    },\n    [Item.savageStaff]: {\n        item: Item.savageStaff,\n        itemType,\n        weaponType: WeaponType.staff,\n        iconImg: `${basePath}savage-staff.png`,\n        rarity: Rarity.epic,\n        damage: { [DamageType.kinetic]: 8 },\n    },\n    [Item.simpleCrossbow]: {\n        item: Item.simpleCrossbow,\n        itemType,\n        weaponType: WeaponType.crossbow,\n        iconImg: `${basePath}crossbow.png`,\n        rarity: Rarity.common,\n        damage: { [DamageType.kinetic]: 3 },\n    },\n    [Item.spear]: {\n        item: Item.spear,\n        itemType,\n        weaponType: WeaponType.poleArm,\n        iconImg: `${basePath}sword.png`,\n        rarity: Rarity.rare,\n        damage: { [DamageType.kinetic]: 10 },\n    },\n    [Item.steelShield]: {\n        item: Item.steelShield,\n        itemType,\n        weaponType: WeaponType.shield,\n        rarity: Rarity.rare,\n        iconImg: `${basePath}steel-shield.png`,\n    },\n    [Item.steelSword]: {\n        item: Item.steelSword,\n        itemType,\n        weaponType: WeaponType.sword,\n        iconImg: `${basePath}steel-sword.png`,\n        rarity: Rarity.uncommon,\n        damage: { [DamageType.kinetic]: 14 },\n    },\n    [Item.warhammer]: {\n        item: Item.warhammer,\n        itemType,\n        weaponType: WeaponType.hammer,\n        iconImg: `${basePath}warhammer.png`,\n        rarity: Rarity.rare,\n        damage: { [DamageType.kinetic]: 16 },\n    },\n    [Item.woodenBulwark]: {\n        item: Item.woodenBulwark,\n        itemType,\n        weaponType: WeaponType.shield,\n        rarity: Rarity.common,\n        iconImg: `${basePath}wooden-bulwark.png`,\n    },\n};\nexport default weaponDefinitions;\n\nexport function getDefinition<T extends WeaponDefinition>(weapon: string): T {\n    return weaponDefinitions[weapon] as T;\n}\n","\n// Things that can be dragged\nexport const DragType = {\n    ADVENTURER: \"adventurer\",   // Adventurer avatar\n    ITEM: \"item\",               // A game 'item' (equipment, etc)\n};\n\n// Source, where it comes from\nexport enum DragSourceType {\n    adventurerInventory,\n    warehouse,\n    tavern,\n    adventurerEquipment,\n    lootCache\n}\n","import { EquipmentSlotType } from \"components/ui/adventurer/EquipmentSlot\";\nimport { Item } from \"definitions/items/types\";\nimport { Action } from \"redux\";\n\n// tslint:disable:object-literal-sort-keys\nexport enum ActionType {\n    moveItemInInventory = \"moveItemInInventory\",\n    moveItemToOtherAdventurer = \"moveItemToOtherAdventurer\",\n    moveItemFromWarehouseToAdventurer = \"moveItemFromWarehouseToAdventurer\",\n    addItemToInventory = \"addItemToInventory\",\n    removeItemFromInventory = \"removeItemFromInventory\",\n    assignEquipment = \"assignEquipment\",\n    removeEquipment = \"removeEquipment\",\n    renameAdventurer = \"renameAdventurer\",\n    addXP = \"addXP\",\n}\n\nexport interface AdventurerAction extends Action<ActionType> {\n    adventurerId: string;\n}\n\nexport interface InventoryAction extends AdventurerAction {\n    item: Item;\n    toSlot?: number;\n}\n\nexport interface MoveItemInInventoryAction extends AdventurerAction {\n    fromSlot: number;\n    toSlot: number;\n}\n\nexport interface RemoveItemFromInventoryAction extends AdventurerAction {\n    fromSlot: number;\n}\n\nexport interface MoveItemToOtherAdventurerAction extends AdventurerAction {\n    fromSlot: number;\n    toSlot?: number;\n    toAdventurerId: string;\n}\n\nexport interface AssignEquipmentAction extends AdventurerAction {\n    item: Item;\n    equipmentSlot: EquipmentSlotType;\n}\nexport interface RemoveEquipmentAction extends AdventurerAction {\n    equipmentSlot: EquipmentSlotType;\n}\n\nexport interface RenameAdventurerAction extends AdventurerAction {\n    name: string;\n}\n\nexport interface AddXPAction extends AdventurerAction {\n    xp: number;\n}\n\nexport function moveItemInInventory(adventurerId: string, fromSlot: number, toSlot: number):\n    MoveItemInInventoryAction {\n    return {\n        type: ActionType.moveItemInInventory,\n        adventurerId,\n        fromSlot,\n        toSlot,\n    };\n}\n\n/**\n * Moves the an item from one adventurers' inventory to another\n * @param fromAdventurerId adventurer whose inventory to take the item from\n * @param fromSlot index of the inventory item\n * @param toAdventurerId player who to give the item to\n */\nexport function moveItemToOtherAdventurer(fromAdventurerId: string,\n                                          fromSlot: number,\n                                          toAdventurerId: string, toSlot?: number): MoveItemToOtherAdventurerAction {\n    return {\n        type: ActionType.moveItemToOtherAdventurer,\n        adventurerId: fromAdventurerId,\n        fromSlot,\n        toAdventurerId,\n        toSlot,\n    };\n}\n\n// If slot is not provided, will take the first empty slot\nexport function addItemToInventory(adventurerId: string, item: Item, toSlot?: number): InventoryAction {\n    return {\n        type: ActionType.addItemToInventory,\n        adventurerId,\n        item,\n        toSlot,\n    };\n}\n\nexport function removeItemFromInventory(adventurerId: string, fromSlot: number): RemoveItemFromInventoryAction {\n    return {\n        type: ActionType.removeItemFromInventory,\n        adventurerId,\n        fromSlot,\n    };\n}\n\nexport function assignEquipment(adventurerId: string, equipmentSlot: EquipmentSlotType, item: Item): AssignEquipmentAction {\n    return {\n        type: ActionType.assignEquipment,\n        adventurerId,\n        item,\n        equipmentSlot,\n    };\n}\n\nexport function removeEquipment(adventurerId: string, equipmentSlot: EquipmentSlotType): RemoveEquipmentAction {\n    return {\n        type: ActionType.removeEquipment,\n        adventurerId,\n        equipmentSlot,\n    };\n}\n\nexport function renameAdventurer(adventurerId: string, name: string): RenameAdventurerAction {\n    return {\n        type: ActionType.renameAdventurer,\n        adventurerId,\n        name,\n    };\n}\n\nexport function addXp(adventurerId: string, xp: number): AddXPAction {\n    return {\n        type: ActionType.addXP,\n        adventurerId,\n        xp,\n    };\n}\n","import { FIVE_SECONDS } from 'utils/format/time';\nimport { Type } from 'components/ui/toasts/Toast';\nimport EventEmitter from \"events\";\nimport TypedEmitter from \"typed-emitter\";\nimport { SoundManager} from './SoundManager';\n\nexport interface ToastConfig {\n    time: number;\n    title: string;\n    type?: Type;\n    icon?: string;\n    link?: string;\n}\n\nexport const EVENT_TOASTS_UPDATED = \"toast\";\ninterface ToastEvents {\n    [EVENT_TOASTS_UPDATED]: (context: ToastConfig[] | undefined) => void;\n}\nexport class ToastManager extends (EventEmitter as new () => TypedEmitter<ToastEvents>) {\n    private static _instance = new ToastManager();\n\n    private static stack: ToastConfig[] = [];\n    private static lifeTime = FIVE_SECONDS; // Time each toast lives\n                                            // also update CSS animation!\n\n    static addToast(title: string, type?: Type, icon?: string, link?: string) {\n\n        this.stack = [...this.stack, {\n            time: Date.now(),\n            title,\n            type,\n            icon,\n            link\n        }];\n\n        this.instance.emit(EVENT_TOASTS_UPDATED, this.stack);\n\n        SoundManager.playSound(\"ui/toast\");\n\n        setTimeout(() => {\n            // Remove all popups that have expired\n            this.stack = this.stack.filter((toast) => {\n                return Date.now() - toast.time < this.lifeTime\n            });\n            this.instance.emit(EVENT_TOASTS_UPDATED, this.stack);\n\n        }, this.lifeTime);\n    }\n\n    static get instance() {\n        return this._instance;\n    }\n}","import React from 'react';\nimport { TextManager } from 'global/TextManager';\nimport { ToastConfig } from 'global/ToastManager';\nimport { useHistory } from 'react-router';\nimport Icon from 'components/ui/common/Icon';\n\ntype Props = ToastConfig;\n\nexport enum Type {\n    achievementUnlocked,\n    cheat,\n    game,\n    itemCrafted,\n    questCompleted,\n    questEncounter,\n    questLaunched,\n    questUpdate,\n}\n\nconst Toast = (props: Props) => {\n    const {\n        title,\n        type = Type.achievementUnlocked,\n        icon = \"/img/items/quest-items/dragon-eye.png\",\n        link\n    } = props;\n    const history = useHistory();\n\n    const handleClick = () => {\n        if (link) {\n            history.push(link);\n        }\n    }\n\n    const typeText = TextManager.getToastType(type);\n    return (\n        <div className={`toast ${link ? \"withlink\" : \"\"}`} onClick={handleClick}>\n            <div className=\"label type\">{typeText}</div>\n            <div className=\"label title\">{title}</div>\n            <Icon size=\"big\" image={icon} className=\"toast-icon\" border=\"gold\" />\n            <div className=\"banner\"/>\n        </div>\n    );\n}\n\nexport default Toast;","import { TextEntry } from \"constants/text\";\n\nexport enum LogChannel {\n    common,         // Only visible in 'all'\n    town,           // Visible in 'all' and town\n    quest,          // Visible in 'all' and the appropriate quest tab\n}\n\nexport interface LogEntry extends TextEntry {\n    time: number;\n    channel: LogChannel;\n    channelContext?: string;\n}\n","import { TiledProperty, TiledLayerData, TiledTilesetData } from 'constants/tiledMapData';\n\n\n// Unpack array of properties into key/value object for fast retrieval\nexport const parseProperties = (properties?: TiledProperty[]): {[key: string]: string | boolean | number } => {\n    if (!properties) return {};\n    return properties.reduce((acc: {[key: string]: string | boolean | number}, value: TiledProperty) => {\n        acc[value.name] = value.value;\n        return acc;\n    }, {});\n}\n\nexport enum TiledObjectType {\n    adventurerStart = \"adventurerStart\",\n    exit = \"exit\",\n    actor = \"actor\",\n    enemySpawn = \"enemySpawn\",\n}\n\n// finds tileset based on gid\nexport const findTileset = (gid: number, tilesets: TiledTilesetData[]): TiledTilesetData | undefined => {\n    let tileset;\n    for (let i = tilesets.length - 1; i >= 0; i--) {\n        tileset = tilesets[i];\n        if (tileset.firstgid <= gid) {\n            break;\n        }\n    }\n    return tileset;\n}\n/** Add tiles in this layer to list */\nexport const addAllTilesInLayerToList = (list: [number, number][], layer: TiledLayerData, columns: number): void => {\n    layer.data.reduce((acc: [number, number][], tile, index) => {\n        if (tile > 0) {\n            const x = (index % columns);\n            const y = Math.floor(index / columns);\n            acc.push([x, y]);\n        }\n        return acc;\n    }, list);\n}\n\nexport const locationEquals = (a: [number, number], b: [number, number]): boolean => {\n    return a[0] === b[0] && a[1] === b[1];\n}","import { Structure } from \"../structures\";\nimport { Item, ItemDefinition, ItemType } from \"./types\";\n\nconst itemType = ItemType.deed;\nexport interface DeedDefinition extends ItemDefinition {\n    structure: Structure;\n}\n\nexport const deedForLumbermill: DeedDefinition = {\n    item: Item.deedForLumbermill,\n    structure: Structure.lumberMill,\n    itemType,\n    iconImg: \"/img/items/deeds/deed.png\",\n};\n\nexport const deedForWeaponsmith: DeedDefinition = {\n    item: Item.deedForWeaponsmith,\n    structure: Structure.weaponsmith,\n    itemType,\n    iconImg: \"/img/items/deeds/deed.png\",\n};\n\nconst all = {\n    deedForLumbermill,\n    deedForWeaponsmith,\n};\n\n\nexport default all;","// tslint:disable:object-literal-sort-keys\n\nimport { Item, ItemType } from \"./types\";\n\nconst itemType = ItemType.material;\nconst basePath = \"/img/items/materials/\";\n\nconst all = {\n    [Item.arrowheads]: {\n        item: Item.arrowheads,\n        itemType,\n        iconImg: `${basePath}arrowheads.png`,\n    },\n    [Item.bolts]: {\n        item: Item.bolts,\n        itemType,\n        iconImg: `${basePath}bolts.png`,\n    },\n    [Item.buckle]: {\n        item: Item.buckle,\n        itemType,\n        iconImg: `${basePath}buckle.png`,\n    },\n    [Item.chain]: {\n        item: Item.chain,\n        itemType,\n        iconImg: `${basePath}chain.png`,\n    },\n    [Item.cogs]: {\n        item: Item.cogs,\n        itemType,\n        iconImg: `${basePath}cogs.png`,\n    },\n    [Item.gem]: {\n        item: Item.gem,\n        itemType,\n        iconImg: `${basePath}gem.png`,\n    },\n    [Item.ingot]: {\n        item: Item.ingot,\n        itemType,\n        iconImg: `${basePath}ingot.png`,\n    },\n    [Item.nails]: {\n        item: Item.nails,\n        itemType,\n        iconImg: `${basePath}nails.png`,\n    },\n    [Item.poisonVial]: {\n        item: Item.poisonVial,\n        itemType,\n        iconImg: `${basePath}poison-vial.png`,\n    },\n    [Item.ribbon]: {\n        item: Item.ribbon,\n        itemType,\n        iconImg: `${basePath}ribbon.png`,\n    },\n    [Item.rope]: {\n        item: Item.rope,\n        itemType,\n        iconImg: `${basePath}rope.png`,\n    },\n    [Item.gem]: {\n        item: Item.gem,\n        itemType,\n        iconImg: `${basePath}gem.png`,\n    },\n    [Item.gunpowder]: {\n        item: Item.gunpowder,\n        itemType,\n        iconImg: `${basePath}gunpowder.png`,\n    },\n    [Item.scales]: {\n        item: Item.scales,\n        itemType,\n        iconImg: `${basePath}scales.png`,\n    },\n    [Item.spring]: {\n        item: Item.spring,\n        itemType,\n        iconImg: `${basePath}spring.png`,\n    },\n    [Item.thread]: {\n        item: Item.thread,\n        itemType,\n        iconImg: `${basePath}thread.png`,\n    },\n};\n\nexport default all;\n","// tslint:disable:object-literal-sort-keys\n\nimport { Item, ItemDefinition, ItemType } from \"./types\";\n\nconst itemType = ItemType.questItem;\nconst basePath = \"/img/items/quest-items/\";\n\nconst questItemDefinitions: Record<string, ItemDefinition> = {\n    [Item.blueprints]: {\n        item: Item.blueprints,\n        itemType,\n        iconImg: `${basePath}blueprints.png`,\n    },\n    [Item.crate]: {\n        item: Item.crate,\n        itemType,\n        iconImg: `${basePath}crate.png`,\n    },\n    [Item.dynamite]: {\n        item: Item.dynamite,\n        itemType,\n        iconImg: `${basePath}dynamite.png`,\n    },\n    [Item.dragonEye]: {\n        item: Item.dragonEye,\n        itemType,\n        iconImg: `${basePath}dragon-eye.png`,\n    },\n    [Item.eye]: {\n        item: Item.eye,\n        itemType,\n        iconImg: `${basePath}eye.png`,\n    },\n    [Item.feather]: {\n        item: Item.feather,\n        itemType,\n        iconImg: `${basePath}feather.png`,\n    },\n    [Item.food]: {\n        item: Item.food,\n        itemType,\n        iconImg: `${basePath}food.png`,\n    },\n    [Item.heart]: {\n        item: Item.heart,\n        itemType,\n        iconImg: `${basePath}heart.png`,\n    },\n    [Item.horn]: {\n        item: Item.horn,\n        itemType,\n        iconImg: `${basePath}horn.png`,\n    },\n    [Item.key]: {\n        item: Item.key,\n        itemType,\n        iconImg: `${basePath}key.png`,\n    },\n    [Item.letters]: {\n        item: Item.letters,\n        itemType,\n        iconImg: `${basePath}letters.png`,\n    },\n    [Item.lockPicks]: {\n        item: Item.lockPicks,\n        itemType,\n        iconImg: `${basePath}lock-picks.png`,\n    },\n    [Item.oil]: {\n        item: Item.oil,\n        itemType,\n        iconImg: `${basePath}oil.png`,\n    },\n    [Item.orcFinger]: {\n        item: Item.orcFinger,\n        itemType,\n        iconImg: `${basePath}orc-finger.png`,\n    },\n    [Item.plans]: {\n        item: Item.plans,\n        itemType,\n        iconImg: `${basePath}plans.png`,\n    },\n    [Item.purpleGems]: {\n        item: Item.purpleGems,\n        itemType,\n        iconImg: `${basePath}purple-gems.png`,\n    },\n    [Item.runestone]: {\n        item: Item.runestone,\n        itemType,\n        iconImg: `${basePath}runestone.png`,\n    },\n    [Item.sandwich]: {\n        item: Item.sandwich,\n        itemType,\n        iconImg: `${basePath}sandwich.png`,\n    },\n    [Item.teeth]: {\n        item: Item.teeth,\n        itemType,\n        iconImg: `${basePath}teeth.png`,\n    },\n    [Item.tooth]: {\n        item: Item.tooth,\n        itemType,\n        iconImg: `${basePath}tooth.png`,\n    },\n    [Item.torch]: {\n        item: Item.torch,\n        itemType,\n        iconImg: `${basePath}torch.png`,\n    },\n    [Item.tusk]: {\n        item: Item.tusk,\n        itemType,\n        iconImg: `${basePath}tusk.png`,\n    },\n    [Item.vase]: {\n        item: Item.vase,\n        itemType,\n        iconImg: `${basePath}vase.png`,\n    },\n    [Item.vial]: {\n        item: Item.vial,\n        itemType,\n        iconImg: `${basePath}vial.png`,\n    },\n    [Item.weeds]: {\n        item: Item.weeds,\n        itemType,\n        iconImg: `${basePath}weeds.png`,\n    },\n};\n\nexport default questItemDefinitions;\n","// tslint:disable:object-literal-sort-keys\n\nimport { Item, ItemDefinition, ItemType } from \"./types\";\n\nconst itemType = ItemType.trinket;\nconst basePath = \"/img/items/trinkets/\";\n\nconst trinketDefinitions: Record<string, ItemDefinition> = {\n    [Item.magicAmulet]: {\n        item: Item.magicAmulet,\n        itemType,\n        iconImg: `${basePath}magic_amulet.png`,\n    },\n    [Item.ring]: {\n        item: Item.ring,\n        itemType,\n        iconImg: `${basePath}ring.png`,\n    },\n};\n\nexport default trinketDefinitions;\n","import apparel from \"./apparel\";\nimport deeds from \"./deeds\";\nimport materials from \"./materials\";\nimport questItems from \"./questItems\";\nimport trinkets from \"./trinkets\";\nimport { Item, ItemDefinition } from \"./types\";\nimport weapons from \"./weapons\";\n\nconst all = {\n    ...deeds,\n    ...apparel,\n    ...materials,\n    ...questItems,\n    ...trinkets,\n    ...weapons,\n};\n\nexport default all;\n\nexport function getDefinition(item: Item): ItemDefinition {\n\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore\n    return all[item];\n}\n","export interface CombatStoreState {\n    actors: Actor[];\n    turn: Allegiance;\n    action?: CombatAction;\n}\n\nexport interface Actor {\n    name: string;\n    allegiance: Allegiance;\n    location: number[];\n    health: number;\n    remainingAP: number;\n}\n\nexport enum Allegiance {\n    player,\n    enemy,\n}\n\nexport interface CombatAction {\n    type: CombatActionType;\n    actor: string;\n    target: [number, number];\n    endsAt: number;\n}\n\nexport enum CombatActionType {\n    move = \"move\",\n    slash = \"slash\",\n    shoot = \"shoot\",\n}\n\nexport const barBrawl: CombatStoreState = {\n    actors: [{\n        allegiance: Allegiance.player,\n        health: 100,\n        location: [3, 5],\n        name: \"c4a5d270\",\n        remainingAP: 5,\n    }, {\n        allegiance: Allegiance.player,\n        health: 100,\n        location: [4, 6],\n        name: \"2e655832\",\n        remainingAP: 4,\n    }],\n    turn: Allegiance.player,\n};\n","import { QuestStoreState } from 'store/types/quest';\nimport { QuestDefinition, QuestNodeType } from '../types';\nimport { initialQuestVars, Kill10BoarsQuestVars } from './questVars';\n\n\nconst kill10Boars: QuestDefinition<Kill10BoarsQuestVars> = {\n    getQuestVars: (questStore: QuestStoreState) => questStore.questVars as Kill10BoarsQuestVars,\n    getInitialQuestVars: (_questStore: QuestStoreState) => {\n        return initialQuestVars;\n    },\n    nodes: [{\n        x: 0,\n        y: 1,\n        type: QuestNodeType.nothing,\n        log: \"quest-kill10-boars-node0\",\n    }, {\n    //     x: 0,\n    //     y: 2,\n    //     type: QuestNodeType.nothing,\n    // }, {\n    //     x: 0,\n    //     y: 3,\n    //     type: QuestNodeType.nothing,\n    // }, {\n    //     x: 0,\n    //     y: 4,\n    //     type: QuestNodeType.nothing,\n    // }, {\n        x: 0,\n        y: 3,\n        type: QuestNodeType.encounter,\n        // log: \"quest-kill10-boars-enter-dungeon\",\n        startScene: \"dungeon.entrance\"\n    }, {\n        x: 1,\n        y: 3,\n        type: QuestNodeType.nothing,\n        log: \"quest-kill10-boars-leave-dungeon\",\n    }, {\n        x: 1,\n        y: 3,\n        type: QuestNodeType.nothing,\n        log: \"quest-kill10-boars-left-dungeon\"\n    }, {\n        x: 2,\n        y: 3,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 3,\n        y: 3,\n        type: QuestNodeType.encounter,\n        startScene: \"dungeon.hallway\"\n\n        //encounter: Encounter.backstabbed,\n    }, {\n        x: 4,\n        y: 4,\n        type: QuestNodeType.nothing,\n        log: \"The party spots a boss\",\n    }, {\n        x: 5,\n        y: 4,\n        type: QuestNodeType.nothing,\n    }],\n};\n\nexport default kill10Boars;","import kill10Boars from './kill10Boars';\r\nimport retrieveMagicAmulet from './retrieveMagicAmulet';\r\nimport { QuestDefinition } from './types';\r\n\r\n// tslint:disable:object-literal-sort-keys\r\n\r\n\r\n\r\n\r\n\r\n// const fulruhmRaid: QuestDefinition = {\r\n//     nodes: [{\r\n//         x: -4,\r\n//         y: -1,\r\n//         type: QuestNodeType.nothing,\r\n//     }, {\r\n//         x: -4,\r\n//         y: -1,\r\n//         type: QuestNodeType.nothing,\r\n\r\nconst all = {\r\n    kill10Boars,\r\n    retrieveMagicAmulet,\r\n};\r\n\r\nexport default all;\r\n\r\nexport function getDefinition<T = unknown>(questName: string): QuestDefinition<T> {\r\n    \r\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n    // @ts-ignore\r\n    return all[questName];\r\n}\r\n","import { QuestStoreState } from 'store/types/quest';\nimport { Item } from 'definitions/items/types';\nimport { QuestDefinition, QuestNodeType } from '../types';\n\nexport interface RetrieveMagicAmuletQuestVars {\n    baz: boolean;\n    zux: number;\n}\n\nconst retrieveMagicAmulet: QuestDefinition<RetrieveMagicAmuletQuestVars> = {\n    getQuestVars: (questStore: QuestStoreState) => questStore.questVars as RetrieveMagicAmuletQuestVars,\n    getInitialQuestVars: (_questStore: QuestStoreState) => {\n        const vars: RetrieveMagicAmuletQuestVars = {\n            baz: false,\n            zux: 13\n        }\n        return vars;\n    },\n    requiredItems: [\n        Item.torch,\n        Item.torch,\n        Item.torch,\n        Item.sandwich,\n        Item.sandwich,\n    ],\n    nodes: [{\n        x: 0,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 1,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 2,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 3,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 4,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 5,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 7,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 8,\n        y: 2,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 8,\n        y: 3,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 9,\n        y: 3,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 10,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 10,\n        y: 2,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 10,\n        y: 3,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 10,\n        y: 4,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 11,\n        y: 5,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 12,\n        y: 6,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 12,\n        y: 7,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 13,\n        y: 8,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 12,\n        y: 8,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 12,\n        y: 9,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 11,\n        y: 8,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 10,\n        y: 8,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 9,\n        y: 8,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 8,\n        y: 9,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 7,\n        y: 8,\n        type: QuestNodeType.encounter,\n        startScene: \"dungeon.hallway\"\n    }, {\n        x: 8,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 1,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 1,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 1,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 1,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 1,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 1,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 1,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 1,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 2,\n        y: 1,\n        type: QuestNodeType.encounter,\n        startScene: \"dungeon.hallway\"\n    }, {\n        x: 3,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }],\n};\n\nexport default retrieveMagicAmulet;","import { Action } from \"redux\";\nimport { LogChannel } from \"store/types/logEntry\";\nimport { TextEntry } from 'constants/text';\n\nexport enum ActionType {\n    addLogEntry = \"addLogEntry\",\n}\n\nexport interface AddLogEntryAction extends Action<ActionType> {\n    entry: TextEntry;\n    channel: LogChannel;\n    channelContext?: string;\n}\n\nexport function addLogText(key: string, context?: any, channel: LogChannel = LogChannel.common, channelContext?: string): AddLogEntryAction {\n    const entry: TextEntry = {\n        key,\n        context\n    };\n    return {\n        type: ActionType.addLogEntry,\n        entry,\n        channel,\n        channelContext,\n    };\n}\n\nexport function addLogEntry(entry: TextEntry, channel: LogChannel = LogChannel.common, channelContext?: string): AddLogEntryAction {\n    return {\n        type: ActionType.addLogEntry,\n        entry,\n        channel,\n        channelContext,\n    };\n}\n","import { StoreState } from \"store/types\";\nimport { AdventurerStoreState } from \"store/types/adventurer\";\nimport { QuestStoreState } from \"store/types/quest\";\n\n// export const adventurersInParty = (store: StoreState, partyId: string): AdventurerStoreState[] => {\n//     const party: PartyStoreState = store.parties[partyId];\n//     return party.adventurers.map((id: string) => findAdventurerById(store, id)!);\n// };\n\nexport const adventurersOnQuest = (adventurers: AdventurerStoreState[], quest: QuestStoreState): AdventurerStoreState[] => {\n    return quest.party.map((id: string) => findAdventurerById(adventurers, id)!);\n};\n\nexport const getQuestLeader = (adventurers: AdventurerStoreState[], quest: QuestStoreState): AdventurerStoreState | undefined => {\n    const leaderId = quest.party[0];\n    return findAdventurerById(adventurers, leaderId);\n}\n\nexport const findAdventurerById = (adventurers: AdventurerStoreState[], id: string): AdventurerStoreState | undefined => {\n    return adventurers.find((a) => a.id === id);\n};\n\n/**\n * Returns the amount of free inventory slots on this adventurer\n */\nexport const adventurerFreeInventorySlots = (adventurer: AdventurerStoreState): number => {\n    return adventurer.inventory.filter(i => i === null).length;\n};\n\nexport const storeIsRehydrated = (store: StoreState): boolean => {\n    // Returns a value indicating whether this store is fresh or rehydrated\n    return store?.engine.gameStarted !== undefined;\n};\n\n","export const lerp = (n1: number,  n2: number,  alpha: number): number => {\n    return n1 + alpha * (n2 - n1);\n}","import { LoaderResource } from 'pixi.js';\nimport { lerp } from './math';\n\ninterface Location {\n    x: number;\n    y: number;\n}\n\nexport const lerpLocation = (point1: Location, point2: Location, alpha: number): Location => {\n    const x = lerp(point1.x, point2.x, alpha);\n    const y = lerp(point1.y, point2.y, alpha);\n    return { x, y };\n}\n\n\n/**\n * Uses the shared pixi loader to load a resource\n */\nexport async function loadResourceAsync(path: string): Promise<LoaderResource|undefined> {\n    const loader = PIXI.Loader.shared;\n    return new Promise<LoaderResource|undefined>((resolve, reject) => {\n        if (loader.resources[path]) {\n            resolve(loader.resources[path]);\n        }\n        else {\n            loader.add(path).load((_, resources) => {\n                if (!resources[path]) {\n                    reject()\n                } else {\n                    resolve(resources[path]);\n                }                \n            });\n        }\n    });\n}\n\nexport const loadResource = (path: string, callback: (resource: LoaderResource|undefined) => void): void => {\n    const loader = PIXI.Loader.shared;\n    if (loader.resources[path]) {\n        callback(loader.resources[path]);\n        return;\n    }\n    loader.add(path).load((_, resources) => { callback(resources[path])});\n}","import { Action } from \"redux\";\n\n// tslint:disable:object-literal-sort-keys\nexport enum ActionType {\n    addGold = \"addGold\",\n}\n\nexport interface ModifyGoldAction extends Action<ActionType> {\n    amount: number;\n}\n\nexport function addGold(amount: number): ModifyGoldAction {\n    return {\n        type: ActionType.addGold,\n        amount,\n    };\n}\nexport function subtractGold(amount: number): ModifyGoldAction {\n    return {\n        type: ActionType.addGold,\n        amount: -amount,\n    };\n}\n","export interface TiledMapData {\n    width: number;\n    height: number;\n    tilewidth: number;\n    tileheight: number;\n    infinite: boolean;\n    backgroundcolor: string | null;\n    orientation: Orientation;\n    renderorder: RenderOrder;\n    tilesets: TiledTilesetData[];\n    layers: TiledLayerData[];\n}\n\nexport interface TiledTilesetData {\n    columns: number;\n    firstgid: number;\n    source: string;\n    image: string;\n    imagewidth: number;\n    imageheight: number;\n    tilewidth: number;\n    tileheight: number;\n    tilecount: number;\n    name: string;\n    margin: number; // todo:\n    spacing: number; // todo\n    tiles?: TileData[];\n}\n\nexport interface TileData {\n    id: number,\n    image: string;\n    properties?: TiledProperty[];\n}\n\nexport interface TiledLayerData {\n    data: number[];\n    objects: TiledObjectData[];\n    type: TiledLayerType;\n    height: number;\n    id: number;\n    name: string;\n    opacity: number; // not supported atm\n    visible: boolean;\n    x: number;\n    y: number;\n    width: number;\n    properties?: TiledProperty[];\n}\n\nexport interface TiledObjectData {\n    gid?: number;\n    id: number;\n    name?: string;\n    properties?: TiledProperty[];\n    polygon?: { x: number, y: number}[];\n    type: string;\n    visible: boolean;\n    width: number;\n    height: number;\n    x: number;\n    y: number;\n}\n\nexport enum TiledLayerType {\n    tilelayer = \"tilelayer\",\n    objectgroup = \"objectgroup\"\n}\n\nexport interface TiledProperty {\n    name: string,\n    type: string,\n    value: string | number | boolean;\n}\n\nenum Orientation {\n    orthagonal = \"orthagonal\",\n    isometric = \"isometric\",\n    staggered = \"staggered\",\n    hexagonal = \"hexagonal\"\n}\n\nenum RenderOrder {\n    rightUp = \"right-up\",\n    rightDown = \"right-down\",\n    leftUp = \"left-up\",\n    leftDown = \"left-down\"\n}","import { Store, AnyAction } from \"redux\";\nimport { StoreState } from 'store/types';\nimport { BaseSceneController } from 'mechanics/scenes/BaseSceneController';\n\nexport abstract class SceneControllerManager {\n    static store: { [key: string]: BaseSceneController<unknown> } = {};\n    static controllerTypes: {[key: string]: typeof BaseSceneController} = {};\n\n    static registerSceneController(questName: string, sceneName: string, controllerType: typeof BaseSceneController) {\n        this.controllerTypes[`${questName}.${sceneName}`] = controllerType;\n    }\n\n    /**\n     * Gets the scenecontroller for scene. Creates it if it doesnt exist\n     */\n    static getSceneController(questName: string, sceneName: string, store: Store<StoreState, AnyAction>): BaseSceneController<unknown> {\n        if (!this.store[`${questName}.${sceneName}`]) {\n            if (!this.controllerTypes[`${questName}.${sceneName}`]) {\n                throw new Error(`No controller registered for ${questName}.${sceneName}`);\n            }\n            this.store[`${questName}.${sceneName}`] = new this.controllerTypes[`${questName}.${sceneName}`](store, questName);\n        }\n        return this.store[`${questName}.${sceneName}`];\n    }\n\n    static destroySceneConroller(questName: string, sceneName: string, ) {\n        delete this.store[`${questName}.${sceneName}`];\n    }\n}\n\nrequire('definitions/quests/kill10Boars/encounters/dungeon');\n","// tslint:disable:object-literal-sort-keys\nimport { Item, ItemDefinition, ItemType } from \"./types\";\nimport { EquipmentSlotType } from 'components/ui/adventurer/EquipmentSlot';\n\nconst itemType = ItemType.apparel;\nconst basePath = \"/img/items/apparel/\";\n\n// export enum EquipmentSlotType {\n//     feet,\n//     hands,\n//     chest,\n//     legs,\n//     head,\n//     shoulders,\n// }\n\nexport interface ApparelDefinition extends ItemDefinition {\n    equipmentType: EquipmentSlotType;\n    damageReduction?: number;\n}\n\nconst all: Record<string, ApparelDefinition> = {\n    [Item.boots1]: {\n        item: Item.boots1,\n        equipmentType: EquipmentSlotType.feet,\n        itemType,\n        iconImg: `${basePath}boots_1.png`,\n    },\n    [Item.boots2]: {\n        item: Item.boots2,\n        equipmentType: EquipmentSlotType.feet,\n        itemType,\n        damageReduction: 1,\n        iconImg: `${basePath}boots_2.png`,\n    },\n    [Item.boots3]: {\n        item: Item.boots3,\n        equipmentType: EquipmentSlotType.feet,\n        itemType,\n        damageReduction: 2,\n        iconImg: `${basePath}boots_3.png`,\n    },\n    [Item.chainmailHood]: {\n        item: Item.chainmailHood,\n        equipmentType: EquipmentSlotType.head,\n        itemType,\n        iconImg: `${basePath}chainmail_hood.png`,\n        damageReduction: 3,\n    },\n    [Item.chest]: {\n        item: Item.chest,\n        equipmentType: EquipmentSlotType.chest,\n        itemType,\n        iconImg: `${basePath}chest_1.png`,\n        damageReduction: 2,\n    },\n    [Item.clothGloves]: {\n        item: Item.clothGloves,\n        equipmentType: EquipmentSlotType.hands,\n        itemType,\n        iconImg: `${basePath}cloth_gloves.png`,\n        damageReduction: 1\n    },\n    [Item.cowl]: {\n        item: Item.cowl,\n        equipmentType: EquipmentSlotType.head,\n        itemType,\n        iconImg: `${basePath}cowl.png`,\n        damageReduction: 2,\n    },\n    [Item.druidChest]: {\n        item: Item.druidHands,\n        equipmentType: EquipmentSlotType.chest,\n        itemType,\n        iconImg: `${basePath}druid-chest.png`,\n    },\n    [Item.druidFeet]: {\n        item: Item.druidFeet,\n        equipmentType: EquipmentSlotType.feet,\n        itemType,\n        iconImg: `${basePath}druid-feet.png`,\n    },\n    [Item.druidHands]: {\n        item: Item.druidHands,\n        equipmentType: EquipmentSlotType.hands,\n        itemType,\n        iconImg: `${basePath}druid-hands.png`,\n    },\n    [Item.druidHead]: {\n        item: Item.druidHead,\n        equipmentType: EquipmentSlotType.head,\n        itemType,\n        iconImg: `${basePath}druid-head.png`,\n    },\n    [Item.druidLegs]: {\n        item: Item.druidLegs,\n        equipmentType: EquipmentSlotType.legs,\n        itemType,\n        iconImg: `${basePath}druid-legs.png`,\n    },\n    [Item.fedora]: {\n        item: Item.fedora,\n        equipmentType: EquipmentSlotType.head,\n        itemType,\n        iconImg: `${basePath}fedora.png`,\n    },\n    [Item.greaves1]: {\n        item: Item.greaves1,\n        equipmentType: EquipmentSlotType.feet,\n        itemType,\n        iconImg: `${basePath}greaves_1.png`,\n        damageReduction: 2,\n    },\n    [Item.greaves2]: {\n        item: Item.greaves2,\n        equipmentType: EquipmentSlotType.hands,\n        itemType,\n        iconImg: `${basePath}greaves_2.png`,\n    },\n    [Item.hornedHelmet]: {\n        item: Item.hornedHelmet,\n        equipmentType: EquipmentSlotType.head,\n        itemType,\n        iconImg: `${basePath}horned_helmet.png`,\n    },\n    [Item.leatherGloves]: {\n        item: Item.leatherGloves,\n        equipmentType: EquipmentSlotType.hands,\n        itemType,\n        iconImg: `${basePath}leather_gloves.png`,\n    },\n    [Item.nomadHelmet]: {\n        item: Item.nomadHelmet,\n        equipmentType: EquipmentSlotType.head,\n        itemType,\n        iconImg: `${basePath}nomad_helmet.png`,\n    },\n    [Item.pants1]: {\n        item: Item.pants1,\n        equipmentType: EquipmentSlotType.legs,\n        itemType,\n        iconImg: `${basePath}pants_1.png`,\n        damageReduction: 3,\n    },\n    [Item.pants2]: {\n        item: Item.pants2,\n        equipmentType: EquipmentSlotType.legs,\n        itemType,\n        iconImg: `${basePath}pants_2.png`,\n        damageReduction: 3\n    },\n    [Item.plateChest1]: {\n        item: Item.plateChest1,\n        equipmentType: EquipmentSlotType.chest,\n        itemType,\n        iconImg: `${basePath}plate_chest_1.png`,\n    },\n    [Item.plateChest2]: {\n        item: Item.plateChest2,\n        equipmentType: EquipmentSlotType.chest,\n        itemType,\n        iconImg: `${basePath}plate_chest_2.png`,\n    },\n    [Item.plateChest3]: {\n        item: Item.plateChest3,\n        equipmentType: EquipmentSlotType.chest,\n        itemType,\n        iconImg: `${basePath}plate_chest_3.png`,\n    },\n    [Item.plateChest4]: {\n        item: Item.plateChest4,\n        equipmentType: EquipmentSlotType.chest,\n        itemType,\n        iconImg: `${basePath}plate_chest_4.png`,\n    },\n    [Item.plateGloves1]: {\n        item: Item.plateGloves1,\n        equipmentType: EquipmentSlotType.hands,\n        itemType,\n        iconImg: `${basePath}plate_gloves_1.png`,\n    },\n    [Item.plateGloves2]: {\n        item: Item.plateGloves2,\n        equipmentType: EquipmentSlotType.hands,\n        itemType,\n        iconImg: `${basePath}plate_gloves_2.png`,\n    },\n    [Item.plateHelmet]: {\n        item: Item.plateHelmet,\n        equipmentType: EquipmentSlotType.head,\n        itemType,\n        iconImg: `${basePath}plate_helmet_1.png`,\n    },\n    [Item.platePants]: {\n        item: Item.platePants,\n        equipmentType: EquipmentSlotType.legs,\n        itemType,\n        iconImg: `${basePath}plate_pants1.png`,\n    },\n    [Item.plateShoulders1]: {\n        item: Item.plateShoulders1,\n        equipmentType: EquipmentSlotType.shoulders,\n        itemType,\n        iconImg: `${basePath}plate_shoulders_1.png`,\n    },\n    [Item.plateShoulders2]: {\n        item: Item.plateShoulders2,\n        equipmentType: EquipmentSlotType.shoulders,\n        itemType,\n        iconImg: `${basePath}plate_shoulders_2.png`,\n    },\n    [Item.robe]: {\n        item: Item.robe,\n        equipmentType: EquipmentSlotType.chest,\n        itemType,\n        iconImg: `${basePath}robe_1.png`,\n    },\n    [Item.shoulders1]: {\n        item: Item.shoulders1,\n        equipmentType: EquipmentSlotType.shoulders,\n        itemType,\n        iconImg: `${basePath}shoulders_1.png`,\n    },\n    [Item.shoulders2]: {\n        item: Item.shoulders2,\n        equipmentType: EquipmentSlotType.shoulders,\n        itemType,\n        iconImg: `${basePath}shoulders_2.png`,\n        damageReduction: 2\n    },\n    [Item.shoulders3]: {\n        item: Item.shoulders3,\n        equipmentType: EquipmentSlotType.shoulders,\n        itemType,\n        iconImg: `${basePath}shoulders_3.png`,\n    },\n    [Item.vest]: {\n        item: Item.vest,\n        equipmentType: EquipmentSlotType.chest,\n        itemType,\n        iconImg: `${basePath}vest_1.png`,\n    },\n};\n\nexport default all;\n\nexport function getDefinition<T extends ApparelDefinition>(apparel: string): T {\n    return all[apparel] as T;\n}\n","import { Item } from 'definitions/items/types';\nimport { LootCache } from 'store/types/scene';\n\nexport interface Kill10BoarsQuestVars {\n    dungeon: {\n        entered: boolean,\n        entrance: {\n            chestOpen: boolean,\n            chest: LootCache,\n        }\n        hallway: {\n            doorOpen: boolean,\n            chestOpen: boolean,\n            chest: LootCache,\n        }\n        // situations: {\n        //     altar: {\n        //         candleLit: boolean\n        //     },\n        // }\n    }\n}\n\nexport const initialQuestVars: Kill10BoarsQuestVars = {\n    dungeon: {\n        entered: false,\n        entrance: {\n            chestOpen: false,\n            chest: {\n                title: \"encounter-dungeon-caches-chest\",\n                items: [\n                    Item.nomadHelmet,\n                    Item.teeth,\n                    Item.poisonVial,\n                    Item.fedora,\n                ],\n                gold: 100\n            },\n            // altar: {\n            //     title: \"quest-kill10-boars-dungeonentrance-altar\",\n            //     items: [\n            //         Item.bolts,\n            //         Item.letters\n            //     ]\n            // },\n        },\n        hallway: {\n            chest: {\n                title: \"encounter-dungeon-caches-chest\",\n                items: [ Item.key ]\n            },\n            chestOpen: false,\n            doorOpen: false\n        }\n    }\n}","import { LogUpdate, QuestUpdate } from \"mechanics/gameTick/quests\";\r\nimport { Action } from \"redux\";\r\nimport { State as seedrandomStateType } from \"seedrandom\";\r\nimport { ResourceStoreState } from \"store/types/resources\";\r\n\r\nexport enum ActionType {\r\n    gameTick = \"gameTick\",\r\n    startGame = \"startGame\"\r\n}\r\nexport interface GameTickAction extends Action<ActionType> {\r\n    delta: number;\r\n    rngState: seedrandomStateType | null;\r\n    resources: ResourceStoreState | null;\r\n    quests: QuestUpdate[];\r\n    log: LogUpdate[];\r\n}\r\n\r\nexport function startGame(): Action {\r\n    return {\r\n        type: ActionType.startGame,\r\n    };\r\n}\r\n\r\nexport function gameTick(delta: number,\r\n    rngState: seedrandomStateType | null,\r\n    resources: ResourceStoreState | null,\r\n    quests: QuestUpdate[],\r\n    log: LogUpdate[],\r\n): GameTickAction {\r\n    return {\r\n        type: ActionType.gameTick,\r\n        delta,\r\n        rngState,\r\n        resources,\r\n        quests,\r\n        log,\r\n    };\r\n}\r\n","// tslint:disable:object-literal-sort-keys\nimport { Action } from \"redux\";\nimport { CombatActionType } from \"store/types/combat\";\n\nexport enum ActionType {\n    clearCombatAction = \"clearCombatAction\",\n    startCombatAction = \"startCombatAction\",\n    moveActor = \"moveActor\",\n}\n\nexport interface AddCombatActionAction extends Action<ActionType> {\n    combatType: CombatActionType;\n    actor: string;\n    target: [number, number];\n    endsAt: number;\n}\n\nexport interface MoveActorAction extends Action<ActionType> {\n    actor: string;\n    location: [number, number];\n}\n\nexport function startCombatAction(type: CombatActionType, actor: string, target: [number, number], endsAt: number): AddCombatActionAction {\n    return {\n        type: ActionType.startCombatAction,\n        combatType: type,\n        actor,\n        target,\n        endsAt,\n    };\n}\n\nexport function moveActor(actor: string, location: [number, number]): MoveActorAction {\n    return {\n        type: ActionType.moveActor,\n        actor,\n        location,\n    };\n}\n\nexport function clearCombatAction(): Action<ActionType> {\n    // currently there is only one combat possible. so only one needs to be cleared\n    return {\n        type: ActionType.clearCombatAction,\n    };\n}\n","import { convertSemVerToInt } from \"utils/version\";\n\n// <MAJOR>.<MINOR>.<RELEASE>\n\nconst version = \"0.0.6\";\n\nexport default version;\nexport const asInt: number = convertSemVerToInt(version);\n","/**\n * Convert a sematic versioning string into an 32-bit integer.\n *\n * Make sure the input string is compatible with the standard found\n * at semver.org. Since this only uses 10-bit per major/minor/patch version,\n * the highest possible SemVer string would be 1023.1023.1023.\n * @param  {string} semVer SemVer string\n * @return {number}         Numeric version\n */\nexport const convertSemVerToInt = (semVer: string): number => {\n    // Split a given version string into three parts.\n    const parts = semVer.split(\".\").map((part) => Number(part));\n    // Check if we got exactly three parts, otherwise throw an error.\n    if (parts.length !== 3) {\n        throw new Error(`Received invalid version string: ${semVer}`);\n    }\n    // Make sure that no part is larger than 1023 or else it\n    // won't fit into a 32-bit integer.\n    parts.forEach((part: number) => {\n        if (part >= 1024) {\n            throw new Error(`Version string invalid, ${part} is too large`);\n        }\n    });\n    let numericVersion = 0;\n    // Shift all parts either 0, 10 or 20 bits to the left.\n    for (let i = 0; i < 3; i++) {\n        numericVersion |= parts[i] << i * 10;\n    }\n    return numericVersion;\n};\n\n/**\n * Converts a 32-bit integer into a semantic versioning (SemVer) compatible string.\n * @param  {number} version Numeric version\n * @return {string}   SemVer string\n */\nexport const convertIntToSemVer = (version: number): string => {\n    // Works by shifting the numeric version to the right and then masking it\n    // with 0b1111111111 (or 1023 in decimal).\n    // eslint-disable-next-line no-mixed-operators\n    return `${version & 1023}.${version >> 10 & 1023}.${version >> 20 & 1023}`;\n};\n","import { Item } from 'definitions/items/types';\n\nexport enum StructureState {\n    NotBuilt,\n    Building,\n    Built,\n}\n\nexport interface StructureStoreState {\n    level: number;\n    workers: number;\n    state: StructureState;\n}\n\nexport interface ProductionStructureStoreState extends StructureStoreState {\n    produces: Item[];\n}\n","import { clearCombatAction, moveActor } from \"store/actions/combat\";\nimport { Store } from \"redux\";\nimport { StoreState } from \"store/types\";\nimport { Allegiance, CombatAction, CombatActionType } from \"store/types/combat\";\n\n// tslint:disable-next-line: no-empty-interface\nexport interface CombatUpdate  {\n    // todo: maybe this is not needed\n    action: CombatAction | null;\n}\n\nconst updateCombat = (delta: number, store: Store<StoreState>): CombatUpdate | null => {\n    const state = store.getState();\n    const combat = state.combat;\n    if (combat.action) {\n        const action = combat.action;\n        if (action.endsAt < Date.now()) {\n            if (combat.turn === Allegiance.enemy) {\n                /* if (apLeft(enemy))\n                determine next action\n                else\n                players turn now\n                */\n            } else if (combat.turn === Allegiance.player) {\n                switch (combat.action.type) {\n                    case CombatActionType.move:\n                        store.dispatch(moveActor(combat.action.actor, combat.action.target));\n                        store.dispatch(clearCombatAction());\n                        break;\n                    default:\n                        break;\n                }\n                return {\n                    action: null,\n                };\n            }\n        }\n    }\n    return null;\n};\n\nexport default updateCombat;\n","import * as PIXI from 'pixi.js';\n// Adapted from https://github.com/explooosion/hitarea-shapes/blob/master/src/index.js\n\nexport default class HitAreaShapes {\n    public shapes: PIXI.Polygon[];\n\n    constructor(shapes: { [key: string]: { shape: number[]}[] } = {}, sprite = \"0\") {\n      \n      this.shapes = shapes[sprite].map((definition: { shape: number[]; }) => {\n        const shape: number[] = definition.shape;\n        return new PIXI.Polygon(shape);\n      });\n    }\n    \n    /**\n     * Called by hitArea\n     * @param {number} x\n     * @param {number} y\n     */\n    contains(x = 0, y = 0) {\n      return (!this.shapes || this.shapes.length === 0)\n      ? false\n      : this.shapes.some(shape => shape.contains(x, y));\n    }\n}\n","import React, { useState, useEffect } from 'react';\nimport { Structure } from 'definitions/structures';\nimport { Sprite, useApp, useTick } from '@inlet/react-pixi';\nimport HitAreaShapes from 'utils/hitAreaShapes';\nimport * as PIXI from 'pixi.js';\nimport { ITextureDictionary } from 'pixi.js';\nimport { STRUCTURE_HIGHLIGHT_FILTER } from 'components/town/TownView';\nimport { loadResource } from 'utils/pixiJs';\n\nconst BLADE_ROTATION_SPEED = 0.01;\n\nexport interface Props {\n    onStructureClick: (structure: Structure | null) => void;\n    position: PIXI.Point;\n    selected?: boolean;\n    hitAreaShapes: HitAreaShapes;\n}\n\nconst LumberMill = (props: Props) => {\n    const {hitAreaShapes} = props;\n    const structure = Structure.lumberMill;\n    const atlas = `${process.env.PUBLIC_URL}/img/town/town-alpha/${structure}.json`;\n    const [textures, setTextures] = useState<ITextureDictionary>();\n    const filters = props.selected ? [STRUCTURE_HIGHLIGHT_FILTER] : [];\n\n    const app = useApp();\n\n    useEffect(() => {\n        loadResource(atlas, (resource) => {\n            if (resource) {\n                setTextures(resource.textures);\n            }\n        })\n    }, [app, app.loader, atlas]);\n\n    const [rotation, setRotation] = useState(0);\n    useTick((delta:number | undefined) => setRotation(r => r + (BLADE_ROTATION_SPEED * delta!)));\n\n\n    if (!textures) return null;\n    return (\n        <Sprite\n            name={structure}\n            position={props.position}\n            interactive={true}\n            buttonMode={true}\n            pointertap={() => {\n                props.onStructureClick(structure);\n            }}\n            hitArea={hitAreaShapes}\n            filters={filters}\n            texture={textures[\"structure.png\"]}\n        >\n            <Sprite\n                name=\"blades\"\n                texture={textures[\"blades.png\"]}\n                anchor={new PIXI.Point(0.5, 0.5)}\n                x={15}\n                y={10}\n                rotation={rotation}\n            />\n        </Sprite>\n    )\n}\n\nexport default LumberMill;","import { PixiComponent, applyDefaultProps, Container } from \"@inlet/react-pixi\";\nimport * as PIXI  from 'pixi.js';\nimport * as particles from 'pixi-particles';\n\ninterface Props  {\n    image: string;\n    config: particles.OldEmitterConfig | particles.EmitterConfig;\n}\n\ninterface InternalParticleEmitter {\n  _emitter: particles.Emitter;\n  _raf: number;\n}\n\nconst ParticleEmitter = PixiComponent<Props & React.ComponentProps<typeof Container>, PIXI.ParticleContainer>(\"ParticleEmitter\", {\n    create() {\n      return new PIXI.ParticleContainer();\n    },\n\n    applyProps(instance, oldProps: Props, newProps: Props) {\n      const { image, config, ...newP } = newProps;\n\n      // apply rest props to PIXI.ParticleContainer\n      applyDefaultProps(instance, oldProps, newP);\n\n      let emitter = (this as unknown as InternalParticleEmitter)._emitter;\n      if (!emitter) {\n        emitter = new particles.Emitter(\n          instance,\n          [PIXI.Texture.from(image)],\n          config\n        );\n\n        let elapsed = performance.now();\n\n        const tick = () => {\n          (this as unknown as InternalParticleEmitter)._raf = requestAnimationFrame(tick);\n          const now = performance.now();\n          // const amp = Math.random() * 5 + 15;\n          // const amp = 15;\n          // const freq = 0.0015;\n          // emitter.acceleration.x = (Math.sin((elapsed * freq)) * amp) + 15;\n\n          emitter.update((now - elapsed) * 0.0003);\n\n          elapsed = now;\n        };\n        emitter.emit = true;\n        // emitter.update(00.2);\n\n        tick();\n      }\n      (this as unknown as InternalParticleEmitter)._emitter = emitter;\n    },\n\n    willUnmount() {\n      if ((this as unknown as InternalParticleEmitter)._emitter) {\n        (this as unknown as InternalParticleEmitter)._emitter.emit = false;\n        cancelAnimationFrame((this as unknown as InternalParticleEmitter)._raf);\n      }\n    }\n});\n\nexport default ParticleEmitter;","import React from \"react\";\nimport { Sprite, Container } from '@inlet/react-pixi';\nimport { Structure } from 'definitions/structures';\nimport HitAreaShapes from 'utils/hitAreaShapes';\nimport smoke from './smoke.json';\nimport ParticleEmitter from 'components/pixi/ParticleEmitter';\nimport { STRUCTURE_HIGHLIGHT_FILTER } from 'components/town/TownView';\n\nexport interface Props {\n    onStructureClick: (structure: Structure | null) => void;\n    position: PIXI.Point;\n    selected?: boolean;\n    hitAreaShapes: HitAreaShapes;\n}\n\nconst Tavern = (props: Props) => {\n    const {hitAreaShapes, position} = props;\n    const structure = Structure.tavern;\n    const filters = props.selected ? [STRUCTURE_HIGHLIGHT_FILTER] : [];\n\n    return (\n        <Container position={position}>\n            <Sprite\n                name={structure}\n                interactive={true}\n                buttonMode={true}\n                pointertap={() => {\n                    props.onStructureClick(structure);\n                }}\n                filters={filters}\n                hitArea={hitAreaShapes}\n                image={`${process.env.PUBLIC_URL}/img/town/town-alpha/${structure}.png`}\n            />\n            <ParticleEmitter\n                name=\"smoke\"\n                x={107}\n                y={-2}\n                image={`${process.env.PUBLIC_URL}/img/town/effects/smokeparticle.png`}\n                config={smoke}\n            />\n        </Container>\n    )\n}\nexport default Tavern;","import { AppContext } from \"components/App\";\nimport * as React from \"react\";\nimport { Component, ComponentType } from 'react';\n\n// Sharing context within the entire App\nexport interface AppContextProps {\n    onOpenWindow: (window: React.ReactElement) => void;\n    onCloseWindow: () => void;\n}\n\nexport const withAppContext = <TWrappedComponentProps extends AppContextProps>(WrappedComponent: ComponentType<TWrappedComponentProps>) => {\n    type WrappedComponentPropsExceptProvided = Exclude<keyof TWrappedComponentProps, keyof AppContextProps>;\n    type ForwardedProps = Pick<TWrappedComponentProps, WrappedComponentPropsExceptProvided>;\n    return class WithContext extends Component<ForwardedProps> {\n        public render() {\n            return (\n                <AppContext.Consumer>\n                    {(context: any) => <WrappedComponent {...this.props } {...context} />}\n                </AppContext.Consumer>\n            );\n        }\n    };\n};\n","import React from 'react';\nimport { Structure } from 'definitions/structures';\nimport { Sprite } from '@inlet/react-pixi';\nimport HitAreaShapes from 'utils/hitAreaShapes';\nimport { STRUCTURE_HIGHLIGHT_FILTER } from 'components/town/TownView';\n\nexport interface Props {\n    onStructureClick: (structure: Structure | null) => void;\n    position: PIXI.Point;\n    selected?: boolean;\n    structure: Structure;\n    hitAreaShapes: HitAreaShapes;\n}\n\nconst Generic = (props: Props) => {\n    const {structure, position, hitAreaShapes, selected, onStructureClick} = props;\n    const filters = selected ? [STRUCTURE_HIGHLIGHT_FILTER] : [];\n\n    const handlePointerTap = () => {\n        onStructureClick(structure);\n    };\n\n    return (\n        <Sprite\n            name={structure}\n            position={position}\n            interactive={true}\n            buttonMode={true}\n            pointertap={handlePointerTap}\n            hitArea={hitAreaShapes}\n            filters={filters}\n            image={`${process.env.PUBLIC_URL}/img/town/town-alpha/${structure}.png`}\n        >\n            {/* <Graphics\n                name=\"hitarea\"\n                draw={graphics => {\n                    graphics.beginFill(0xffffff);\n                    hitAreaShapes.shapes.map(shape => graphics.drawPolygon(shape))\n                    graphics.endFill();\n                }}\n            /> */}\n        </Sprite>\n    );\n}\nexport default Generic;","import React from \"react\";\nimport { StructuresStoreState } from 'store/types/structures';\nimport { Structure } from 'definitions/structures';\nimport { StructureStoreState, StructureState } from 'store/types/structure';\nimport { Link } from 'react-router-dom';\nimport { getStructureLink, getTownLink } from 'utils/routing';\nimport { TextManager } from 'global/TextManager';\nimport { useRouteMatch } from 'react-router';\nimport \"./styles/legenda.scss\";\n\ninterface Props {\n    structures: StructuresStoreState;\n}\n\n// Legenda with clickable names of structures\nconst Legenda = (props: Props) => {\n    const {structures} = props;\n    const orderedStructures = [\n        Structure.workshop,\n        Structure.quarry,\n        Structure.tavern,\n        Structure.tannery,\n        Structure.alchemist,\n        Structure.garden,\n        Structure.weaponsmith,\n        Structure.armoursmith,\n        Structure.warehouse,\n        Structure.mine,\n        Structure.lumberMill,\n        Structure.weaver,\n    ];\n    const match = useRouteMatch<{structure: string}>(`${getTownLink()}/:structure`);\n\n    const renderText = (structure: Structure) => {\n        if (match?.params.structure === structure.toString()) {\n            return (\n                <span className=\"highlighted\">{`${TextManager.getStructureName(structure)}`}</span>\n            )\n        }\n        return (\n            <Link to={getStructureLink(structure)} >\n                {`${TextManager.getStructureName(structure)}`}\n            </Link>\n        )\n    }\n\n    return (\n        <div className=\"legenda\">\n            <ul>\n            {orderedStructures.map((structure) => {\n                const structureStore: StructureStoreState = structures[structure];\n                if (structureStore.state === StructureState.NotBuilt) {\n                    return null;\n                }\n                return (\n                    <li key={structure}>\n                        {renderText(structure)}\n                    </li>\n                );\n            })}\n            </ul>\n        </div>\n    );\n}\n\nexport default Legenda;","import React, { forwardRef, PropsWithChildren } from \"react\";\nimport { Viewport as PixiViewport, ClickEventData } from \"pixi-viewport\";\nimport { PixiComponent, useApp } from \"@inlet/react-pixi\";\nimport gauntlet from \"components/App/styles/img/cursors/dwarven_gauntlet_extra_6.png\";\n\ninterface Props {\n  onClick?(event: ClickEventData): void;\n  screenWidth: number,\n  screenHeight: number,\n  worldWidth: number,\n  worldHeight: number,\n  minScale?: number;\n  maxScale?: number;\n}\n\n/** Viewport leverages pixi-viewport to create a pannable map\n * https://davidfig.github.io/pixi-viewport/jsdoc/\n */\nconst Viewport = forwardRef<PixiViewport, PropsWithChildren<Props>>((props, ref) => {\n  const app = useApp();\n  if (app) {\n      // Perhaps this is better moved somewhere else\n      const cursor = `url('${gauntlet}'), auto`;\n      app.renderer.plugins.interaction.cursorStyles.pointer = cursor;\n  }\n  return <PixiComponentViewport app={app} {...props} ref={ref} />;\n})\nViewport.displayName = 'DisplayName';\n\ninterface PixiComponentProps {\n    app: PIXI.Application;\n}\n\nconst PixiComponentViewport = PixiComponent(\"Viewport\", {\n  create: (props: PixiComponentProps & Props) => {\n    const viewport = new PixiViewport({\n      screenWidth: props.screenWidth,\n      screenHeight: props.screenHeight,\n      worldWidth: props.worldWidth,\n      worldHeight: props.worldHeight,\n      ticker: props.app.ticker,\n      interaction: props.app.renderer.plugins.interaction,\n      // the interaction module is important for wheel to work properly when renderer.view is placed or scaled\n    });\n    viewport.on(\"clicked\", (event) => { if(props.onClick) props.onClick(event) });\n\n    const {\n      minScale = 1,\n      maxScale = 2\n    } = props;\n\n    viewport\n      .drag()\n      .pinch()\n      .wheel()\n      .clamp({ direction: 'all' })\n      .clampZoom({ minScale, maxScale })\n      .decelerate();\n\n    return viewport;\n  }\n});\nexport default Viewport;\n","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAgCAYAAAABtRhCAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAB3RJTUUH3gMODzc3YHmYGgAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAE50lEQVRIx7WXW0wcVRjHfzO7y16YZbfAytACvbjU1hqkLVZMbbSXBEPUNjX6YDYanwYfTXzxrb7qm0lTJ018QhOjaWI0trFYbRoqpYVuwy2UpRS2lAF22YUdtuxt1ofKCIXShaZfMjm37+Q33zn/cxMURWHRVFXNAyiKIvCMTFwKO6Ne4ONPTpngZwoE6Lx6FYCDhwLPDLoMeKPtV8b6ewkEAssiVVU1v/gtLS+dhnUDFUUResZvUhLXuNF+ZVmkBw8F6B+4b5avXR8x82fUC+uCWhoaGsxCV1fXKZelGOvMNPcXspw9+zV60s3MzAweTwXJZBLJXYXPt8XMJ5NJbgX/pqGh4ctCgNalBUVRhId/u5tsQqf9UpDGxkZCoRCtra2mX2trK5qmAZhpoWZdrTIvCOyQihn8/RydsQSVm6uQJAnZ6zV9MjYbkUgEAL/fj6p+my9kOYmPViiKIgQn+8mLIv1jowSONtN0+OgyGEAkEkHXdTRNQ5Kkjal0qY3MJciLIsdOvslYXy9xbXxZu67rAEiSZOafCtgzfpM8Al2/deDEwJZOrYAu2lNFqKpq/rPjLTTtbWY0Psu1jovUVm7Hmk1jS6eYmXooEiH//0pYj3BWFc2RukM4HpxHMAz6x0aRvT1scfsYT0yTTwnEtXEsuQzxhbQ5j08F/O7H0+zz+ThQWsK52yGuBNs5XPcqllwOVzrOjv2HsZaXsuv1OtySnYSeort7kE+Vt56o1FWBo7EollwGQ7Sww13McHyWbE8n9VVVNLzWzMDkXSYGujl/uY1wNIamaciybO4+a0FXXRbd04P8PHydu/EYtmwaSy7NaCzOi0eO09F5kfk7/bhSSZ4T8zQ2NiLLMgCyLPPe+5+vudWtqlJFUYRF8MhsHNHIcXKnn86rfxK8P4Etk8G5kKR4YZ758F1OnDixrP9aUHGt8V6ExlMLbLP7GBoeAkGkxuWhKJfFlUoiJRNE7o0TCARM8UiS9NgjTnySqhRFEUZmR/jm5l9YsynGolG0RJQqpwd7OoU0P0dqZJD0TJyWlhZzU/D7/Txfe2wFVCxUzttLPNyaGEc0svx0+zZVW/cD4Eo/wJuIkevtwZiKLhteWZZXQAsGdk9PscluRzByODxlnL78Aw17mpDdZdizGUr0GNEbndRvKeeD5rcpLy83oRWVjeuLUFEUYTQ+jMfpwutw4CgpJVmzm6/++QVDtFDpLkU0DLxzUabbB6ir9vHGtp3mxi5JkhmluJ6zzONw/pfaMUSR0HyaL6530zYRBmBz7QFqj9YhSQ5efsXPQjxS2MJ/nJUUS8zEZ/G4nPSEQgyHLj08kCehtQuqy66w94/vEfIGNaVliEYGr6No40AAj9OBkDcYHmpb0RaO9hGO9lFdtodubQqAovQCG1IpgGgYlNlsbCqyrekXjvaZ+SlD3Dgwoc9hyWU4WP1SQf6lNbXouo6u6+ZtvmCgoihCcErDks2QCA3w4YF3ngjz+/1omsbkRMfG5nBkdoQ7bjeEe9hVVsZHe5u4FB7nXqTX9Kmvf5eKys3IskwwGGR4qG3ZW0VY+pgpxFRVze/zvcBWbylep5OMzY5hsVLsLiFd5MTqq+DedJRQKLQCtiHg0uv91k21uF1uPE4XhsVC1monlsqSmE8yOdGx6itsQ8BHwavN9+P6/Avf+1eTf20QhwAAAABJRU5ErkJggg==\"","\nimport React, { useRef, useEffect, PropsWithChildren, forwardRef, useImperativeHandle } from \"react\";\nimport { Sprite, Stage } from '@inlet/react-pixi';\nimport { Viewport as PixiViewport} from 'pixi-viewport';\nimport { GodrayFilter } from 'pixi-filters';\nimport Viewport from 'components/pixi/Viewport';\nimport { gsap } from 'gsap';\n\nexport interface Props {\n    screenWidth: number;\n    screenHeight: number;\n    worldWidth: number;\n    worldHeight: number;\n}\n\n\nconst TownStage = forwardRef<PixiViewport, PropsWithChildren<Props>>((props: PropsWithChildren<Props>, ref: React.Ref<PixiViewport>) => {\n    const {\n        children,\n        screenWidth,\n        screenHeight,\n        worldWidth,\n        worldHeight\n    } = props;\n\n    const innerRef = useRef<PixiViewport>(null);\n\n    useImperativeHandle(ref, () => {\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        return innerRef.current!\n    });\n\n\n    useEffect(() => {\n        godray.enabled = false;\n        if(innerRef.current) {\n\n            const viewport = innerRef.current;\n            viewport.on(\"moved\", () => {\n                const horizontalFactor = gsap.utils.normalize(viewport.screenWidth, worldWidth, viewport.right);\n                const verticalFactor = gsap.utils.normalize(worldHeight, viewport.screenHeight, viewport.bottom);\n                const factor = Math.max(horizontalFactor * verticalFactor - .4, 0);\n\n                godray.gain =  factor;\n                godray.lacunarity = 2.4;\n                godray.enabled = godray.gain > 0;\n            })\n        }\n\n        const onScroll = (e: WheelEvent) => {\n            // Scrolling the mouse is just used for zoom, not for actual scrolling\n            e.preventDefault();\n        }\n        window.addEventListener(\"wheel\", onScroll, {passive: false});\n        return () => {\n            window.removeEventListener(\"wheel\", onScroll);\n        };\n    }, [worldHeight, worldWidth]);\n\n    return (\n        <Stage width={screenWidth} height={screenHeight} options={options} >\n            <Viewport\n                screenWidth={screenWidth}\n                screenHeight={screenHeight}\n                worldWidth={worldWidth}\n                worldHeight={worldHeight}\n                ref={innerRef}>\n                <Sprite\n                    name=\"background\"\n                    image={`${process.env.PUBLIC_URL}/img/town/town-alpha/background.png`}\n                    filters={[godray]}\n                >\n                    {children}\n                </Sprite>\n            </Viewport>\n        </Stage>\n\n    )\n});\nTownStage.displayName = \"TownStage\";\n\nexport default TownStage;\n\nconst options = {\n    autoDensity: true,\n    sharedLoader: true\n}\n\nexport const godray = new GodrayFilter();\n","import * as React from \"react\";\nimport { PropsWithChildren } from 'react';\nimport './styles/button.scss';\n\nexport enum ButtonSize {\n    auto, // will select either medium or small, depending on screen size\n    large,\n    medium,\n    small,\n}\n\nexport enum ButtonColor {\n    blue = \"blue\",\n    purple = \"purple\",\n    green = \"green\"\n}\n\nexport type Props = PropsWithChildren<{\n    text?: string;\n    color?: ButtonColor | keyof typeof ButtonColor; // Can use enum or string\n    size?: ButtonSize | keyof typeof ButtonSize; // Can use enum or string\n    className?: string;\n    disabled?: boolean;\n    square?: boolean;\n    onClick?: React.MouseEventHandler<Element>;\n}>\n\n\nconst Button = (props: React.ComponentProps<'button'> & Props) => {\n    const { color, square, text, ...otherProps } = props;\n\n    const handleClick = (e: React.MouseEvent<HTMLButtonElement>) => {\n        props.onClick?.(e)\n    };\n\n    const className = `button\n        ${props.className || \"\"}\n        button-${typeof color === \"string\" ? color : ButtonColor[color ?? ButtonColor.blue]}\n        button-${typeof props.size === \"string\" ? props.size : ButtonSize[props.size ?? ButtonSize.auto]}\n        ${square ? \"button-square\" : \"\"}\n    `.replace(/\\n\\s*/g, \" \");\n\n    return (\n        <button\n            {...otherProps}\n            className={className}\n            onClick={handleClick}\n        >\n            <span>\n                {!!text && text}\n                {!text && props.children}\n            </span>\n        </button>\n    );\n};\n\nexport default Button;\n","import { Sprite, useTick } from '@inlet/react-pixi';\nimport React, { useState } from 'react';\n\ninterface Props {\n    worldWidth: number;\n    speed?: number;\n}\n\nconst Clouds = (props: Props) => {\n    const { speed = 1 } = props;\n    const [cloud, setCloud] = useState(randomCloud());\n    const image = `${process.env.PUBLIC_URL}/img/town/clouds/cloud-0${cloud}.png`;\n    const [x, setX] = useState(-2000);\n    const [y, setY] = useState(randomY());\n\n    useTick((delta:number | undefined) => {\n        if (x > props.worldWidth){\n            setX(2000 - Math.random() * 1000);\n            setY(randomY());\n            setCloud(randomCloud());\n        } else {\n            setX(x + speed * (delta || 1));\n        }\n    });\n\n    return (\n        <Sprite\n            name={`cloud ${cloud}`}\n            image={image}\n            alpha={0.8}\n            x={x}\n            y={y}\n        />\n    );\n}\n\nexport default Clouds;\n\nconst randomCloud = () => Math.floor(Math.random() * 2) + 1;\nconst randomY = () => Math.random() * -300 - 200;","import React, { useRef, useEffect, useState } from \"react\";\r\nimport { Structure } from 'definitions/structures';\r\nimport { StructuresStoreState } from 'store/types/structures';\r\nimport { SoundManager, Channel, MixMode } from 'global/SoundManager';\r\nimport { useRouteMatch } from 'react-router';\r\nimport {OutlineFilter} from '@pixi/filter-outline';\r\nimport { getTownLink } from 'utils/routing';\r\nimport { StructureState, StructureStoreState } from 'store/types/structure';\r\nimport { useSelector } from 'react-redux';\r\nimport { StoreState } from 'store/types';\r\nimport { gsap } from 'gsap';\r\nimport { MAX_WIDTH } from 'components/App';\r\nimport HitAreaShapes from 'utils/hitAreaShapes';\r\nimport polygons from './hitAreas.json';\r\nimport LumberMill from './structures/LumberMill';\r\nimport Tavern from './structures/Tavern';\r\nimport { withAppContext, AppContextProps } from 'hoc/withAppContext';\r\nimport Generic from './structures/Generic';\r\nimport Legenda from './Legenda';\r\nimport \"./styles/townView.scss\"\r\nimport TownStage from './TownStage';\r\nimport { Viewport as PixiViewport } from \"pixi-viewport\";\r\nimport Clouds from './Clouds';\r\n\r\nconst HEIGHT = 1079;\r\nconst WORLD_WIDTH = 1024;\r\nconst WORLD_HEIGHT = 1600;\r\n\r\nexport interface Props {\r\n    onStructureClick: (structure: Structure | null) => void;\r\n}\r\n\r\nexport const STRUCTURE_HIGHLIGHT_FILTER = new OutlineFilter(8, 0xffcc00);\r\n\r\nconst TownView = (props: Props & AppContextProps) => {\r\n    const match = useRouteMatch<{structure: string}>(`${getTownLink()}/:structure`);\r\n    const selectedStructure = match?.params.structure;\r\n    const ref = useRef<HTMLDivElement>(null);\r\n    const viewportRef = useRef<PixiViewport>(null);\r\n    const dragging = useRef(false);\r\n\r\n    useEffect(() => {\r\n        SoundManager.addSound(\"music/town\", \"sound/music/Soliloquy.mp3\", () => {\r\n            SoundManager.playSound(\"music/town\", Channel.music, true, MixMode.fade, true);\r\n        })\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        const tween = gsap.to(STRUCTURE_HIGHLIGHT_FILTER, {\r\n            duration: .6,\r\n            thickness: 2,\r\n            yoyo: true,\r\n            repeat: -1\r\n        });\r\n        return () => {\r\n            tween.pause(0);\r\n            tween.kill();\r\n        }\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        if(viewportRef.current) {\r\n\r\n            const viewport = viewportRef.current;\r\n            viewport.on(\"drag-start\", (e) => {\r\n                dragging.current = true;\r\n                e.event.stopPropagation();\r\n            });\r\n            viewport.on(\"drag-end\", () => { dragging.current = false; });\r\n        }\r\n    }, []);\r\n\r\n    const handleStructureClick = (structure: Structure | null) => {\r\n        if (!dragging.current) {\r\n            props.onStructureClick(structure);\r\n        }\r\n    }\r\n\r\n    const structures = useSelector<StoreState, StructuresStoreState>((state: StoreState) => {\r\n        return state.structures;\r\n    });\r\n\r\n    const renderStructures = () => {\r\n        const orderedStructures = [\r\n            Structure.workshop,\r\n            Structure.quarry,\r\n            Structure.tavern,\r\n            Structure.tannery,\r\n            Structure.alchemist,\r\n            Structure.garden,\r\n            Structure.weaponsmith,\r\n            Structure.armoursmith,\r\n            Structure.warehouse,\r\n            Structure.mine,\r\n            Structure.lumberMill,\r\n            Structure.weaver,\r\n        ]\r\n        return orderedStructures.reverse().map((structure) => {\r\n            const structureStore: StructureStoreState = structures[structure];\r\n            if (structureStore.state === StructureState.NotBuilt) {\r\n                return null;\r\n            }\r\n            // todo: refactor into seperate components\r\n\r\n            const StructureComponent = getStructure(structure);\r\n            const position = getStructurePosition(structure);\r\n            const hitAreaShapes = new HitAreaShapes(polygons, structure as string);\r\n            return (\r\n                <StructureComponent\r\n                    position={position}\r\n                    structure={structure}\r\n                    hitAreaShapes={hitAreaShapes}\r\n                    onStructureClick={handleStructureClick}\r\n                    key={structure}\r\n                    selected={selectedStructure === structure}\r\n                />\r\n            );\r\n        });\r\n    }\r\n\r\n    useEffect(() => {\r\n        if (selectedStructure && viewportRef.current) {\r\n            const viewport = viewportRef.current;\r\n            viewport.zoomPercent(0);\r\n            const position = getStructurePosition(selectedStructure as Structure);\r\n            viewport.moveCenter(position);\r\n        }\r\n    }, [selectedStructure]);\r\n\r\n    const [canvasWidth, setCanvasWidth] = useState(MAX_WIDTH);\r\n    const [canvasHeight, setCanvasHeight] = useState(HEIGHT);\r\n\r\n    useEffect(() => {\r\n        // This will set the dimensions of the canvas tot that of the townview\r\n        const resize = () => {\r\n            const worldViewWidth = ref.current?.clientWidth || MAX_WIDTH;\r\n            const worldViewHeight = ref.current?.clientHeight || HEIGHT;\r\n\r\n            setCanvasWidth(worldViewWidth);\r\n            setCanvasHeight(worldViewHeight);\r\n        }\r\n        resize();\r\n        window.addEventListener(\"resize\", resize);\r\n        return () => {\r\n            window.removeEventListener(\"resize\", resize);\r\n        };\r\n    }, []);\r\n\r\n\r\n    return (\r\n        <div className=\"town-view\" ref={ref}>\r\n            <Legenda structures={structures} />\r\n            <TownStage\r\n                screenWidth={canvasWidth}\r\n                screenHeight={canvasHeight}\r\n                worldWidth={WORLD_WIDTH}\r\n                worldHeight={WORLD_HEIGHT}\r\n                ref={viewportRef}\r\n            >\r\n                <Clouds worldWidth={canvasWidth} />\r\n                {renderStructures()}\r\n                <Clouds worldWidth={canvasWidth} />\r\n            </TownStage>\r\n            {/* { selectedStructure && (\r\n                <StructureDetailsView\r\n                    structure={selectedStructure}\r\n                    title={TextManager.getStructureName(selectedStructure)}\r\n                    onClose={() => handleStructureClick(null)}\r\n                />\r\n            )} */}\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default withAppContext(TownView);\r\n\r\nconst getStructure = (structure: Structure) => {\r\n    switch (structure) {\r\n        case Structure.workshop:\r\n        case Structure.quarry:\r\n        case Structure.tannery:\r\n        case Structure.alchemist:\r\n        case Structure.garden:\r\n        case Structure.weaponsmith:\r\n        case Structure.armoursmith:\r\n        case Structure.warehouse:\r\n        case Structure.mine:\r\n        case Structure.weaver:\r\n            return Generic;\r\n        case Structure.lumberMill:\r\n            return LumberMill;\r\n        case Structure.tavern:\r\n            return Tavern;\r\n    }\r\n}\r\n\r\nconst getStructurePosition = (structure: Structure) => {\r\n    let x;\r\n    let y;\r\n    switch (structure) {\r\n        case Structure.workshop:\r\n            x = 373;\r\n            y = 610;\r\n            break;\r\n        case Structure.quarry:\r\n            x = 632;\r\n            y = 633;\r\n            break;\r\n        case Structure.tannery:\r\n            x = 372;\r\n            y = 460;\r\n            break;\r\n        case Structure.tavern:\r\n            x = 500;\r\n            y = 469;\r\n            break;\r\n        case Structure.alchemist:\r\n            x = 411;\r\n            y = 371;\r\n            break;\r\n        case Structure.garden:\r\n            x = 822;\r\n            y = 689;\r\n            break;\r\n        case Structure.weaponsmith:\r\n            x = 449;\r\n            y = 460;\r\n            break;\r\n        case Structure.armoursmith:\r\n            x = 473;\r\n            y = 442;\r\n            break;\r\n        case Structure.warehouse:\r\n            x = 471;\r\n            y = 130;\r\n            break;\r\n        case Structure.lumberMill:\r\n            x = 403;\r\n            y = 320;\r\n            break;\r\n        case Structure.mine:\r\n            x = 183;\r\n            y = 527;\r\n            break;\r\n        case Structure.weaver:\r\n            x = 484;\r\n            y = 333;\r\n            break;\r\n    }\r\n    return new PIXI.Point(x, y);\r\n}","import React, { useEffect, useState } from 'react';\nimport { ToastManager, ToastConfig, EVENT_TOASTS_UPDATED } from 'global/ToastManager';\nimport Toast from './Toast';\nimport './styles/toasts.scss';\n\n// Toasts can be added by calling ToastManager.addToast\n// ToastManager will inform whenever the something is added to the list of toasts via EVENT_TOASTS_UPDATED\n// The toasts themselves will fade out via css transition\nconst Toasts = () => {\n\n    const [activeToasts, setActiveToasts] = useState<ToastConfig[]>([]);\n\n    const toastsUpdated = (stack?: ToastConfig[]) => {\n        if (stack) setActiveToasts(stack);\n    }\n\n    useEffect(() => {\n        ToastManager.instance.addListener(EVENT_TOASTS_UPDATED, toastsUpdated);\n        return () => {\n            ToastManager.instance.removeListener(EVENT_TOASTS_UPDATED, toastsUpdated);\n        }\n    }, []);\n\n    return (\n        <div className=\"toasts\" > \n            { activeToasts.map((toastConfig) => (\n                <Toast key={toastConfig.time} {...toastConfig}/>\n            ))}\n        </div>\n    )\n}\n\nexport default Toasts;","// tslint:disable:object-literal-sort-keys\nimport { Action } from \"redux\";\nimport { ResourceStoreState } from \"store/types/resources\";\n\nexport enum ActionType {\n    addResources = \"addResources\",\n    removeResources = \"removeResources\",\n}\n\nexport interface AddResources extends Action<ActionType> {\n    resources: ResourceStoreState;\n}\n\nexport function addResource(resource: string, value: number): AddResources {\n    return addResources({\n        [resource]: value,\n    });\n}\n\nexport function addResources(resources: ResourceStoreState): AddResources {\n    return {\n        type: ActionType.addResources,\n        resources,\n    };\n}\n\nexport function removeResources(resources: ResourceStoreState): AddResources {\n    return {\n        type: ActionType.removeResources,\n        resources,\n    };\n}\n","// tslint:disable:object-literal-sort-keys\n\nimport { Structure } from \"definitions/structures\";\nimport { Action } from \"redux\";\nimport { StructureState } from \"store/types/structure\";\nimport { Item } from 'definitions/items/types';\n\nexport enum ActionType {\n    upgradeStructure = \"upgradeStructure\",\n    increaseWorkers = \"increaseWorkers\",\n    decreaseWorkers = \"decreaseWorkers\",\n    startBuildingStructure = \"startBuildingStructure\",\n    finishBuildingStructure = \"finishBuildingStructure\",\n    setStructureState = \"setStructureState\",\n    addItemToToProduces = \"addItemToToProduces\",\n}\n\nexport interface StructureAction extends Action<ActionType> {\n    structure: Structure;\n}\nexport interface StructureStateAction extends StructureAction {\n    state: StructureState;\n}\nexport interface AddItemToProducesAction extends StructureAction {\n    item: Item;\n}\n\nexport interface WorkerCountAction extends StructureAction {\n    workers: number;\n}\n\nexport function startBuildingStructure(structure: Structure): StructureAction {\n    return {\n        type: ActionType.startBuildingStructure,\n        structure,\n    };\n}\n\nexport function finishBuildingStructure(structure: Structure): StructureAction {\n    return {\n        type: ActionType.finishBuildingStructure,\n        structure,\n    };\n}\n\nexport function upgradeStructure(structure: Structure): StructureAction {\n    return {\n        type: ActionType.upgradeStructure,\n        structure,\n    };\n}\n\n// Increases workers used by given structure by given amount\nexport function increaseWorkers(structure: Structure, workers = 1): WorkerCountAction {\n    return {\n        type: ActionType.increaseWorkers,\n        structure,\n        workers,\n    };\n}\n\n// Decreases workers used by given structure by given amount\nexport function decreaseWorkers(structure: Structure, workers = 1): WorkerCountAction {\n    return {\n        type: ActionType.decreaseWorkers,\n        structure,\n        workers,\n    };\n}\n\nexport function setStructureState(structure: Structure, state: StructureState): StructureStateAction {\n    return {\n        type: ActionType.setStructureState,\n        structure,\n        state,\n    };\n}\n\nexport function addItemToToProduces(structure: Structure, item: Item): AddItemToProducesAction {\n    return {\n        type: ActionType.addItemToToProduces,\n        structure,\n        item,\n    };\n}\n","import * as React from \"react\";\nimport { SoundManager} from 'global/SoundManager';\nimport Button from '../buttons/Button';\nimport { PropsWithChildren, useEffect } from \"react\";\n\n// todo: refactor using WindowManager [30/03/2020]\nexport interface Props {\n    title: string;\n    backEnabled?: boolean;\n    closeEnabled?: boolean;\n    onClose?: () => void;\n    onBack?: () => void;\n}\n\n/**\n *\n */\nconst Window = (props: PropsWithChildren<Props>) => {\n\n    const handleClose = (_e: React.MouseEvent) => {\n        if (props.onClose) {\n            props?.onClose();\n\n            SoundManager.playSound(\"ui/buttonClick\");\n        }\n    };\n\n    const handleBack = (_e: React.MouseEvent) => {\n        if (props.onBack) {\n            props?.onBack();\n\n            SoundManager.playSound(\"ui/buttonClick\");\n        }\n    };\n\n    useEffect(() => {\n        SoundManager.musicFiltered = true;\n        return () => {\n            SoundManager.musicFiltered = false;\n        }\n    })\n\n    return (\n        <div className = \"window\">\n            <div className = \"header\">\n                { props.backEnabled !== false && (\n                    <Button\n                        className=\"back-button\"\n                        onClick={handleBack}\n                        square={true}\n                        size={\"medium\"}\n                        color=\"purple\"\n                        text=\"<\"\n                    />\n                )}\n                <h3>{ props.title }</h3>\n                { props.closeEnabled !== false && (\n                    <Button\n                        className=\"close-button\"\n                        onClick={handleClose}\n                        square={true}\n                        size={\"medium\"}\n                        color=\"purple\"\n                        text=\"x\"\n                    />\n                )}\n            </div>\n            { props.children }\n        </div>\n    );\n};\n\nexport default Window;\n","import Window, { Props } from \"components/ui/window/Window\";\nimport * as React from \"react\";\nimport \"components/ui/window/styles/window.scss\";\n\nexport const withWindow = <TWrappedComponentProps extends Props>(WrappedComponent: React.ComponentType<TWrappedComponentProps>) => {\n    return class WithWindow extends React.Component<TWrappedComponentProps> {\n\n        public render() {\n            return <Window { ...this.props } >\n                <WrappedComponent { ...this.props } />\n            </Window>;\n        }\n    };\n};\n","import * as React from \"react\";\r\nimport { compose } from \"redux\";\r\nimport { ChangeEvent } from 'react';\r\nimport gsap from 'gsap';\r\nimport { Channel, SoundManager } from 'global/SoundManager';\r\nimport { withWindow } from \"hoc/withWindow\";\r\nimport \"./styles/settings.scss\";\r\n\r\nconst SettingsWindow = () => {\r\n\r\n    const getChannelControls = (channel: Channel) => {\r\n        const handleVolumeChange = (e: ChangeEvent<HTMLInputElement>) => {\r\n            const linear = parseFloat(e.target.value);\r\n            const log = Math.pow(linear, 2);\r\n            SoundManager.setChannelVolume(channel, log);\r\n        };\r\n        const handleMuteClick = (e: React.MouseEvent<HTMLButtonElement>) => {\r\n            const slider = (e.currentTarget as HTMLButtonElement).parentNode?.lastChild;\r\n            if (slider) {\r\n                gsap.to(slider, {\r\n                    duration: .5,\r\n                    value: 0,\r\n                    onComplete: () => {\r\n                        SoundManager.setChannelVolume(channel, 0);\r\n                    }\r\n                });\r\n            }\r\n        }\r\n\r\n        return (\r\n            <p>\r\n                <label>{Channel[channel]}</label>\r\n                <button onClick={handleMuteClick}>\r\n                    <span role=\"img\" aria-label=\"Mute\">🔇</span>\r\n                </button>\r\n                <input\r\n                    type=\"range\"\r\n                    min=\"0\"\r\n                    max=\"1\"\r\n                    step=\"0.05\"\r\n                    onChange={handleVolumeChange}\r\n                    defaultValue={`${Math.sqrt(SoundManager.getChannelVolume(channel))}`}\r\n                />\r\n            </p>\r\n        )\r\n    }\r\n\r\n    return (\r\n        <div className=\"settings-window\">\r\n            <details open = { true } className=\"sound\" >\r\n                <summary>Sound volume</summary>\r\n                <section>\r\n                    {getChannelControls(Channel.ui)}\r\n                    {getChannelControls(Channel.scene)}\r\n                    {getChannelControls(Channel.music)}\r\n                </section>\r\n            </details>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default compose(\r\n    withWindow,\r\n)(SettingsWindow);\r\n","import { Resource } from \"definitions/resources\";\nimport { ONE_MINUTE } from 'utils/format/time';\n\nexport const RESOURCE_INTERVAL = ONE_MINUTE; // every minute constitutes a resource tick.\n\n// Whenever a list of resource is shown, use this order\nexport const resourceOrder = [\n    Resource.food,\n    Resource.wood,\n    Resource.iron,\n    Resource.stone,\n    Resource.fabric,\n    Resource.leather,\n];\n","import { Item } from \"definitions/items/types\";\nimport { Action } from \"redux\";\n\n// tslint:disable:object-literal-sort-keys\nexport enum ActionType {\n    addItem = \"addItem\",\n    moveItemInWarehouse = \"moveItemInWarehouse\",\n    removeItem = \"removeItem\",\n    addStockpileSlots = \"addStockpileSlots\"\n}\n\nexport interface MoveItemInWarehouseAction extends Action<ActionType> {\n    fromSlot: number;\n    toSlot: number;\n}\n\nexport interface AddAction extends Action {\n    item: Item;\n    toSlot?: number;\n}\n\nexport interface RemoveItemFromWarehouseAction extends Action {\n    fromSlot: number;\n}\nexport interface AddStockpileSlotsAction extends Action {\n    slots: number;\n}\n\n// Adds one Item to the warehouse\n// slot is optional, will take the first empty slot if not provided\nexport function addItemToWarehouse(item: Item, toSlot?: number): AddAction {\n    return {\n        type: ActionType.addItem,\n        item,\n        toSlot,\n    };\n}\n\n// When an Item is moved from one slot to the other in the warehouse\nexport function moveItemInWarehouse(fromSlot: number, toSlot: number): MoveItemInWarehouseAction {\n    return {\n        type: ActionType.moveItemInWarehouse,\n        fromSlot,\n        toSlot,\n    };\n}\nexport function removeItemFromWarehouse(fromSlot: number): RemoveItemFromWarehouseAction {\n    return {\n        type: ActionType.removeItem,\n        fromSlot,\n    };\n}\n\nexport function addStockpileSlots(slots: number): AddStockpileSlotsAction {\n    return {\n        type: ActionType.addStockpileSlots,\n        slots,\n    };\n}\n","import { Action } from \"redux\";\n\n// todo this should go somewhere else\nexport enum ActionType {\n    addWorkers = \"addWorkers\",\n}\n\nexport interface ModifyWorkersAction extends Action<ActionType> {\n    value: number;\n}\n\nexport function addWorkers(value: number): ModifyWorkersAction {\n    return {\n        type: ActionType.addWorkers,\n        value,\n    };\n}\nexport function subtractWorkers(value: number): ModifyWorkersAction {\n    return {\n        type: ActionType.addWorkers,\n        value: -value,\n    };\n}\n","export enum TimeType {\n    questProgress,          // progress on the worldmap\n    resourceGeneration,\n    cheat\n}\n// todo: should come from store?\n\nlet cheatTimeMultiplier = 1;\nexport const setCheatTimeMultiplier = (value: number) => {\n    cheatTimeMultiplier = value;\n}\n\nexport const getTimeMultiplier = (type: TimeType): number => {\n    switch (type) {\n       case TimeType.cheat:\n            return cheatTimeMultiplier;\n        // todo: implement different multipliers for different timetypes?\n        // the idea is to have speed boosts in different areas of the game\n        default:\n            return cheatTimeMultiplier;\n    }\n}\n\n","import { ReactNode } from 'react';\nimport { ItemDefinition } from \"definitions/items/types\";\nimport { WeaponType } from 'definitions/items/weapons';\nimport { TraitDefinition } from 'definitions/traits/types';\n\n// Things that can be shown on the ContextPopup\nexport enum ContextType {\n    item,\n    trait,\n    resource,\n    skill,\n    component\n}\n\nexport type ContextInfo = ItemDefinition | TraitDefinition | WeaponType | string | ReactNode;\n","import { ContextInfo, ContextType } from 'constants/context';\nimport deepEquals from 'deep-equal';\nimport EventEmitter from \"events\";\nimport TypedEmitter from \"typed-emitter\";\nexport interface Context {\n    type: ContextType;\n    info: ContextInfo;\n    referenceRect: ClientRect;\n    className?: string;\n}\n\nexport const EVENT_CONTEXT_UPDATED = \"tooltipContextUpdated\";\ninterface TooltipEvents {\n    [EVENT_CONTEXT_UPDATED]: (context: Context | undefined) => void;\n}\n\nexport class TooltipManager extends (EventEmitter as new () => TypedEmitter<TooltipEvents>) {\n    private static _instance = new TooltipManager();\n    private static lastContext: Context | undefined;\n\n    static showContextTooltip (type: ContextType, info: ContextInfo, originRect: ClientRect, className?: string) {\n        const context = { type, info, referenceRect: originRect, className };\n\n        if(deepEquals(context, this.lastContext)) {\n            this.clear();\n        } else {\n            this.instance.emit(EVENT_CONTEXT_UPDATED, context);\n            this.lastContext = context;\n        }\n    }\n\n    static clear() {\n        this.instance.emit(EVENT_CONTEXT_UPDATED, undefined);\n        this.lastContext = undefined;\n    }\n\n    static get instance() {\n        return this._instance;\n    }\n}\n","import * as React from \"react\";\nimport { ContextType } from \"constants/context\";\nimport { Rarity } from \"constants/items\";\nimport { getDefinition } from \"definitions/items\";\nimport { Item } from \"definitions/items/types\";\nimport { TooltipManager } from 'global/TooltipManager';\nimport Icon, { IconSize } from 'components/ui/common/Icon';\nimport \"./styles/itemIcon.scss\";\n\nexport interface Props {\n    item: Item;\n    onClick?: (event: React.MouseEvent) => void;\n    size?: IconSize;\n    showContext?: boolean;\n}\n\nconst ItemIcon = (props: Props) => {\n    const { item, size } = props;\n    const itemDefinition = getDefinition(item);\n\n    if (!itemDefinition) {\n        // tslint:disable-next-line: no-console\n        throw (`could not find definition for ${item}`);\n    }\n\n    const handleClick = (event: React.MouseEvent) => {\n        if (props.showContext !== false) {\n            const origin = (event.currentTarget as HTMLElement);\n            const originRect = origin.getBoundingClientRect();\n            TooltipManager.showContextTooltip(ContextType.item, getDefinition(item), originRect);\n            event.stopPropagation();\n        }\n\n        if (props.onClick) {\n            props.onClick(event);\n        }\n    };\n\n    const className = `item-icon ${getIconClassName(itemDefinition.rarity)} ${sizeClassName(size)}`;\n\n    return (\n        <div className={className}>\n            <Icon\n                image={itemDefinition.iconImg}\n                size={props.size}\n                onClick={handleClick}\n            />\n        </div>\n    );\n};\n\nexport default ItemIcon;\n\n\nconst getIconClassName = (rarity?: Rarity): string => {\n    switch (rarity) {\n        case Rarity.common:\n            return \"item-icon-common\";\n        case Rarity.uncommon:\n            return \"item-icon-uncommon\";\n        case Rarity.rare:\n            return \"item-icon-rare\";\n        case Rarity.epic:\n            return \"item-icon-epic\";\n        case Rarity.legendary:\n            return \"item-icon-legendary\";\n    }\n    return getIconClassName(Rarity.common);\n};\n\nconst sizeClassName = (size?: IconSize): string => {\n    switch (size) {\n        case IconSize.smallest:\n            return \"item-icon-size-smallest\";\n        case IconSize.small:\n            return \"item-icon-size-small\";\n        case IconSize.medium:\n            return \"item-icon-size-medium\";\n        case IconSize.big:\n            return \"item-icon-size-big\";\n        case IconSize.biggest:\n            return \"item-icon-size-biggest\";\n    }\n    return sizeClassName(IconSize.medium);\n};","import React from 'react';\nimport Select, { Props} from 'react-select';\n\n\nconst DefaultSelect = (props: Props) => {\n    return <Select\n        styles={{\n            control: (provided, state) => ({\n                ...provided,\n                minHeight: 'inherit',\n                height: '32px',\n                boxShadow: '0',\n                border: state.isFocused ? '1px solid orange' : '1px solid #B1B1B1',\n                ':hover': {\n                    border: '1px solid orange'\n                }             \n            }),\n            container: (provided, _state) => ({\n                ...provided,\n                flex: 1\n            }),\n            option: (provided) => ({\n                ...provided,\n                padding: '4px 12px',\n            }),\n            placeholder: (provided) => ({\n                ...provided,\n                whiteSpace: 'nowrap'\n            }), \n            valueContainer: (provided) => ({\n                ...provided,\n                marginTop: '-2px'\n            }), \n            indicatorsContainer: (provided) => ({\n                ...provided,\n                marginTop: '-2px',\n\n                'div': {\n                    padding: '4px'\n                }\n            }),\n            \n        }}\n        {...props}\n    />\n}\nDefaultSelect.displayName = \"DefaultSelect\";\n\nexport default DefaultSelect;","import { Item } from \"definitions/items/types\";\nimport { SceneStoreState } from './scene';\n\nexport enum QuestStatus {\n    unavailable,\n    available,  // on the quest board\n    active,\n    completed,\n    // todo: failed?\n}\n\nexport interface QuestReward {\n    gold?: number;\n    items?: Item[];\n}\n\nexport interface QuestStoreState {\n    name: string;\n    status: QuestStatus;\n    party: string[];                // list of adventurer ids\n    progress: number;               // Which questnode the party is at currently\n    questVars: unknown;           // \n    encounterResults: string[];     // Store what option the place chose during an encounter // OBSOLETE\n    icon: string;\n\n    reward?: QuestReward;\n    scene?: SceneStoreState;\n    sceneName?: string;\n}\n","import * as React from \"react\";\r\nimport { useMemo,  useState } from 'react';\r\nimport { getDefinition } from \"definitions/items\";\r\nimport { Item, ItemType } from \"definitions/items/types\";\r\nimport { getDefinition as getStructureDefinition, Structure } from \"definitions/structures\";\r\nimport { StructureState, StructureStoreState } from \"store/types/structure\";\r\nimport { StructuresStoreState } from \"store/types/structures\";\r\nimport { TextManager } from \"global/TextManager\";\r\nimport { ToastManager } from 'global/ToastManager';\r\nimport { Type } from 'components/ui/toasts/Toast';\r\nimport { useDispatch, useSelector } from 'react-redux';\r\nimport { addLogText } from 'store/actions/log';\r\nimport { LogChannel } from 'store/types/logEntry';\r\nimport { resourceOrder } from 'constants/resources';\r\nimport { ResourceStoreState } from 'store/types/resources';\r\nimport { addResources } from 'store/actions/resources';\r\nimport { setStructureState } from 'store/actions/structures';\r\nimport { StoreState } from 'store/types';\r\nimport { addGold } from 'store/actions/gold';\r\nimport { addItemToWarehouse } from 'store/actions/items';\r\nimport { withWindow } from 'hoc/withWindow';\r\nimport { addWorkers } from 'store/actions';\r\nimport { getTimeMultiplier, setCheatTimeMultiplier, TimeType } from 'mechanics/time';\r\nimport ItemIcon from \"components/ui/items/ItemIcon\";\r\nimport { IconSize } from \"components/ui/common/Icon\";\r\nimport Button from \"components/ui/buttons/Button\";\r\nimport Select from \"components/ui/common/Select\";\r\nimport \"./styles/cheat.scss\";\r\n\r\n\r\n\r\nconst CheatWindow = () => {\r\n\r\n    const [cheats, setCheats] = useState({\r\n        gold: 50,\r\n        resources: 50,\r\n        workers: 10,\r\n    });\r\n    const [selectedItem, setSelectedItem] = useState<string|null>();\r\n    const dispatch = useDispatch();\r\n    const [timeMultiplier, setTimeMultiplier] = useState(getTimeMultiplier(TimeType.cheat));\r\n\r\n    const onCheatGold = (amount: number) => {\r\n        dispatch(addGold(amount));\r\n        dispatch(addLogText(\"common-cheat-gold-added\", { amount }, LogChannel.common));\r\n    };\r\n\r\n    const onCheatItem = (item: Item) => {\r\n        dispatch(addItemToWarehouse(item));\r\n        dispatch(addLogText(\"common-cheat-item-added\", { item }, LogChannel.common));\r\n    };\r\n\r\n    const onCheatResources = (amount: number) => {\r\n        // Create ResourceStoreState where value of each resource is `amount`\r\n        const resources = resourceOrder.reduce((acc: ResourceStoreState, resource) => {\r\n            acc[resource] = amount;\r\n            return acc;\r\n        }, {});\r\n\r\n        dispatch(addResources(resources));\r\n        dispatch(addLogText(\"common-cheat-resources-added\", { amount }, LogChannel.common));\r\n    };\r\n\r\n    const onCheatStructureState = (structure: Structure, state: StructureState) => {\r\n        dispatch(setStructureState(structure, state))\r\n    }\r\n\r\n    const onCheatWorkers = (amount: number) => {\r\n        dispatch(addWorkers(amount));\r\n        dispatch(addLogText(\"common-cheat-workers-added\", { amount }, LogChannel.common));\r\n    };\r\n\r\n    const structures = useSelector<StoreState, StructuresStoreState>(store => store.structures);\r\n\r\n    const getStructureRow = (structure: Structure) => {\r\n        const structureDef = getStructureDefinition(structure);\r\n        const structureStore: StructureStoreState = structures[structure];\r\n        const levelDef = structureDef.levels[structureStore.level];\r\n\r\n        const displayName = TextManager.get(levelDef.displayName);\r\n\r\n        return (\r\n            <div\r\n                className=\"label-dropdown\"\r\n                key={structure}\r\n            >\r\n                <label title={structure}>\r\n                    {`${displayName}`}\r\n                </label>\r\n                <input\r\n                    key={structure}\r\n                    type=\"checkbox\"\r\n                    checked={structureStore.state === StructureState.Built}\r\n                    onChange={() => handleChangeStructureState(structure, structureStore.state !== StructureState.Built)}\r\n                />\r\n            </div>\r\n        );\r\n    };\r\n\r\n    const handleCheatGold = (_evt: React.MouseEvent<HTMLButtonElement>) => {\r\n        const amount = cheats.gold;\r\n        onCheatGold(amount);\r\n\r\n        const text = TextManager.get(\"common-cheat-gold-added\", { amount });\r\n        const icon = \"/img/resources/gold.png\";\r\n        ToastManager.addToast(text, Type.cheat, icon);\r\n    }\r\n\r\n    const handleCheatWorkers = (_evt: React.MouseEvent<HTMLButtonElement>) => {\r\n        const amount = cheats.workers;\r\n        onCheatWorkers(amount);\r\n        const text = TextManager.get(\"common-cheat-workers-added\", { amount });\r\n        const icon = \"/img/resources/worker.png\";\r\n        ToastManager.addToast(text, Type.cheat, icon);\r\n    }\r\n\r\n    const handleCheatResources = (_evt: React.MouseEvent<HTMLButtonElement>) => {\r\n        onCheatResources(cheats.resources);\r\n        const text = TextManager.get(\"common-cheat-resources-added\", { amount: cheats.resources });\r\n        ToastManager.addToast(text, Type.cheat);\r\n    }\r\n\r\n    const handleCheatItem = (_evt: React.MouseEvent<HTMLButtonElement>) => {\r\n        const item = selectedItem as Item;\r\n        onCheatItem(item);\r\n\r\n        const text = TextManager.get(\"common-cheat-item-added\", { item });\r\n        const icon = getDefinition(item).iconImg;\r\n        ToastManager.addToast(text, Type.cheat, icon);\r\n    }\r\n\r\n    const handleChangeStructureState = (structure: Structure, checked: boolean) => {\r\n        onCheatStructureState(structure, checked ? StructureState.Built : StructureState.NotBuilt);\r\n        if (checked) {\r\n            ToastManager.addToast(`The ${TextManager.getStructureName(structure)} is constructed`, Type.cheat);\r\n        } else {\r\n            ToastManager.addToast(`The ${TextManager.getStructureName(structure)} is not constructed`, Type.cheat);\r\n        }\r\n    }\r\n\r\n    const handleChangeGold = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n        const amount = Number.parseFloat(event.target.value);\r\n        setCheats({\r\n            ...cheats,\r\n            gold: amount,\r\n        });\r\n    }\r\n\r\n    const handleChangeWorkers = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n        const amount = Number.parseFloat(event.target.value);\r\n        setCheats({\r\n            ...cheats,\r\n            workers: amount,\r\n        });\r\n    }\r\n\r\n    const handleChangeResources = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n        const amount = Number.parseFloat(event.target.value);\r\n        setCheats({\r\n            ...cheats,\r\n            resources: amount,\r\n        });\r\n    }\r\n\r\n    const handleChangeTimeMultiplier = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n        const value = Number.parseFloat(event.target.value);\r\n        setTimeMultiplier(value)\r\n        setCheatTimeMultiplier(value);\r\n    }\r\n\r\n    const items = useMemo(() => (Object.keys(ItemType)\r\n        .filter(k => !isNaN(parseInt(k))) // such a weird way to unumerate an enum.. sigh\r\n        .map((typeKey: string) => {\r\n            const type = ItemType[typeKey as unknown as number] as unknown as ItemType;\r\n            return {\r\n                label: type as unknown as ItemType,\r\n                value: \"\",\r\n                subtext: \"\",\r\n                options: Object.keys(Item)\r\n                    .filter((item: string) => getDefinition(item as Item).itemType as unknown as string == typeKey)\r\n                    .map((item: string) => ({\r\n                        value: item,\r\n                        label: TextManager.getItemName(item as Item),\r\n                        subtext: TextManager.getItemSubtext(item as Item),\r\n                    })\r\n                )\r\n            }\r\n        })\r\n    ), []);\r\n\r\n    return (\r\n        <div className=\"cheat-window\">\r\n            <div className=\"label-numberbox-button\">\r\n                <label>Gold</label>\r\n                <input type=\"number\"\r\n                    value={cheats.gold}\r\n                    style={{ width: \"50px\" }}\r\n                    onChange={handleChangeGold} />\r\n                <button onClick={handleCheatGold}>Add</button>\r\n            </div>\r\n            <div className=\"label-numberbox-button\">\r\n                <label>Workers</label>\r\n                <input type=\"number\"\r\n                    value={cheats.workers}\r\n                    style={{ width: \"50px\" }}\r\n                    onChange={handleChangeWorkers} />\r\n                <button onClick={handleCheatWorkers}>Add</button>\r\n            </div>\r\n            <div className=\"label-numberbox-button\">\r\n                <label>Resources</label>\r\n                <input type=\"number\"\r\n                    value={cheats.resources}\r\n                    style={{ width: \"50px\" }}\r\n                    onChange={handleChangeResources} />\r\n                <button onClick={handleCheatResources}>Add</button>\r\n            </div>\r\n            <div className=\"label-numberbox-button\">\r\n                <label>Items</label>\r\n                <Select\r\n                    placeholder={\"Find item in any category...\"}                   \r\n                    onChange={(e) => setSelectedItem(e?.value)}\r\n                    formatGroupLabel={(data) => (\r\n                        <div className=\"item-group\">\r\n                            <div className=\"item-group-label\">{data.label}</div>\r\n                            <div className=\"item-group-count\">{data.options.length} items</div>\r\n                        </div>\r\n                    )}\r\n                    formatOptionLabel={option => (\r\n                        <div className=\"item-option\">\r\n                            <ItemIcon item={option.value as Item} size={IconSize.smallest} />\r\n                            <div className=\"item-label\">\r\n                                {option.label}\r\n                                <span>{(option as unknown as { subtext: string}).subtext}</span>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                    options={items} />\r\n                <Button onClick={handleCheatItem}>Add</Button>\r\n            </div>\r\n            <div className=\"label-range-value\">\r\n                <label>Speed</label>\r\n                <input\r\n                    type=\"range\"\r\n                    min=\"1\" max=\"10\" value={timeMultiplier} step={1}\r\n                    onChange={handleChangeTimeMultiplier}\r\n                />\r\n                {timeMultiplier}x speed\r\n            </div>\r\n            <div>\r\n                <h2>Structures</h2>\r\n            </div>\r\n            { Object.keys(structures).map((structure) => getStructureRow(structure as Structure))}\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default withWindow(CheatWindow);\r\n\r\n","import { createEncryptor } from 'simple-encryptor';\nimport { StoreState } from 'store/types';\nconst key = \"P5mw}jD>5c6Y]yqy\";\nconst encryptor = createEncryptor(key);\n\nexport const saveGame = (storeState: StoreState) => {\n    const a = document.createElement('a');\n    const text = JSON.stringify(storeState);\n    const encrypted = encryptor.encrypt(text);\n    const filename = \"Gidletown save.json\";\n    a.setAttribute('href', 'data:text/json;charset=utf-8,' + encodeURIComponent(encrypted));\n    a.setAttribute('download', filename);\n    a.click();\n}\n\nexport const decryptSavedGame = (encrypted: string) : StoreState => {\n    const text = encryptor.decrypt(encrypted);\n    return JSON.parse(text);\n}","import { Props as WindowProps } from \"components/ui/window/Window\";\r\nimport { AppContextProps, withAppContext } from \"hoc/withAppContext\";\r\nimport { withWindow } from \"hoc/withWindow\";\r\nimport * as React from \"react\";\r\nimport { compose } from \"redux\";\r\nimport SettingsWindow from './SettingsWindow';\r\nimport CheatWindow from './CheatWindow';\r\nimport { useSelector } from 'react-redux';\r\nimport { StoreState } from 'store/types';\r\nimport { Persistor } from 'redux-persist';\r\nimport { loadGame } from 'index';\r\nimport { useState } from 'react';\r\nimport { ToastManager } from 'global/ToastManager';\r\nimport { Type } from 'components/ui/toasts/Toast';\r\nimport { TextManager } from 'global/TextManager';\r\nimport Button from 'components/ui/buttons/Button';\r\nimport { decryptSavedGame, saveGame } from \"utils/game\";\r\nimport \"./styles/menu.scss\";\r\n\r\n// tslint:disable-next-line:no-empty-interface\r\nexport interface Props {\r\n    persistor: Persistor;\r\n}\r\n\r\ntype AllProps = Props & WindowProps;\r\nconst Menu = (props: AllProps & AppContextProps) => {\r\n\r\n    const storeState = useSelector<StoreState>(state => state);\r\n    const [loadedStore, setLoadedStore] = useState<StoreState>();\r\n\r\n    const handleClickCheats = () => {\r\n        const window = <CheatWindow title=\"Cheats\" />;\r\n        props.onOpenWindow(window);\r\n    };\r\n\r\n    const handleClickSettings = () => {\r\n        const window = <SettingsWindow title=\"Settings\" />;\r\n        props.onOpenWindow(window);\r\n    };\r\n\r\n    const handleClickSave = () => {\r\n       saveGame(storeState as StoreState);\r\n    }\r\n\r\n    const handleClickLoad = async () => {\r\n        if (!loadedStore) return;\r\n        setLoadedStore(undefined);\r\n\r\n        await loadGame(loadedStore);\r\n        ToastManager.addToast(TextManager.get(\"ui-game-loaded\"), Type.game, \"/img/items/misc/magic-eye.png\");\r\n        props.onCloseWindow();\r\n\r\n    }\r\n\r\n    const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const fileReader = new FileReader();\r\n        fileReader.onload = () => {\r\n            const encrypted = fileReader.result! as string;\r\n            const state =  decryptSavedGame(encrypted)\r\n\r\n            setLoadedStore(state);\r\n        }\r\n        fileReader.readAsText(e.target.files![0]);\r\n    }\r\n\r\n\r\n\r\n    return (\r\n        <div className=\"menu\">\r\n            <p>\r\n                <Button onClick={handleClickCheats}>Cheats!</Button>\r\n            </p>\r\n            <p>\r\n                <Button onClick={handleClickSettings}>Settings</Button>\r\n            </p>\r\n            <fieldset>\r\n                <legend>Save and load</legend>\r\n                <section>\r\n                    Save game to disk:&nbsp;\r\n                    <Button onClick={handleClickSave}>Save</Button>\r\n                </section>\r\n                <section>\r\n                    Load game from disk:&nbsp;\r\n                    <input type=\"file\" onChange={handleFileChange} />\r\n                    <Button onClick={handleClickLoad} disabled={!loadedStore}>Load</Button>\r\n                </section>\r\n            </fieldset>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default compose(\r\n    withWindow,\r\n    withAppContext,\r\n)(Menu) as React.ComponentType<AllProps>;\r\n","export const formatNumber = (input: number, digits = 1): string => {\n    const SI_SYMBOL = [\"\", \"k\", \"M\", \"G\", \"T\", \"P\", \"E\"];\n\n    // what tier? (determines SI symbol)\n    const tier = Math.log10(input) / 3 | 0;\n    // if zero, we don't need a suffix\n    if(tier === 0) return input.toFixed(digits);\n\n    // get suffix and determine scale\n    const suffix = SI_SYMBOL[tier];\n    const scale = Math.pow(10, tier * 3);\n\n    // scale the number\n    const scaled = input / scale;\n\n    // format number and add suffix\n    return scaled.toFixed(digits) + suffix;\n}","import { StoreState } from 'store/types';\nimport { useSelector } from 'react-redux';\n\n// Returns the gold from redux store\nconst useGoldState = () => {\n    return useSelector<StoreState, number>(store => store.gold);\n}\n\nexport default useGoldState;","import { getDefinition, Structure } from \"definitions/structures\";\nimport { WarehouseStructureDefinition, WarehouseStructureLevelDefinition } from \"definitions/structures/types\";\nimport { createSelector } from 'reselect';\nimport { StoreState } from \"store/types\";\n\nconst getWarehouseLevel = (state: StoreState) => {\n    return state.structures[Structure.warehouse].level;\n}\n\n\nconst maxResources = (level: number) => {\n    const structureDefinition = getDefinition<WarehouseStructureDefinition>(Structure.warehouse);\n    const levelDefinition: WarehouseStructureLevelDefinition = structureDefinition.levels[level];\n    return levelDefinition.maxResources;\n}\n\n// Selects a ResourceStoreState with maximum stockpile of each resource the warehouse supports\nexport const selectMaxResources = createSelector([\n    getWarehouseLevel],\n    maxResources,\n);","import { StoreState } from 'store/types';\nimport { useSelector } from 'react-redux';\nimport { ResourceStoreState } from 'store/types/resources';\nimport { selectMaxResources } from 'store/selectors/resources';\n\n// Returns the resources from redux store\nexport const useResourcesState = () => {\n    return useSelector<StoreState, ResourceStoreState>(store => store.resources);\n}\n\n// Returns the maximum of each resource that the warehouse can hold\nexport const useMaxResourcesState = () => {\n    return useSelector<StoreState, ResourceStoreState>(selectMaxResources);\n}","import { Structure } from \"definitions/structures\";\nimport { createSelector } from \"reselect\";\nimport { StoreState } from \"store/types\";\nimport { StructureStoreState } from \"store/types/structure\";\nimport { StructuresStoreState } from \"store/types/structures\";\n\nconst getStructures = (state: StoreState) => state.structures;\nconst getWorkers = (state: StoreState) => state.workers;\n\nconst calculateFreeWorkers = (structures: StructuresStoreState, workers: number) => {\n    // Add up all the workers used by all structures in town\n    const workersUsed = Object.keys(structures).map((name) => structures[name as Structure])\n        .reduce((acc: number, value: StructureStoreState) => acc += value.workers, 0);\n\n    return workers - workersUsed;\n};\n\nexport const selectFreeWorkers = createSelector([\n    getStructures,\n    getWorkers],\n    calculateFreeWorkers,\n);\n","import { StoreState } from 'store/types';\nimport { useSelector } from 'react-redux';\nimport { selectFreeWorkers } from 'store/selectors/workers';\n\n// Returns all the workers from redux store\nexport const useWorkersState = () => {\n    return useSelector<StoreState, number>(store => store.workers);\n}\n\n// Returns all the workers not working on something from redux store\nexport const useWorkersFreeState = () => {\n    return useSelector<StoreState, number>(selectFreeWorkers);\n}\n\n","import { resourceOrder } from \"constants/resources\";\nimport resourceDescriptions from \"definitions/resources\";\nimport * as React from \"react\";\nimport { ResourceStoreState } from \"store/types/resources\";\nimport { formatNumber } from 'utils/format/number';\nimport { TooltipManager } from 'global/TooltipManager';\nimport { ContextType } from 'constants/context';\nimport useGoldState from 'hooks/store/useGoldState';\nimport { useResourcesState } from 'hooks/store/resources';\nimport { useWorkersFreeState } from 'hooks/store/useWorkersState';\nimport Icon from 'components/ui/common/Icon';\nimport \"./styles/resourcebar.scss\";\n\nexport interface StateProps  {\n    gold: number;\n    workers: number;    // total\n    workersFree: number;\n    resources: ResourceStoreState;\n}\n\n/** Shown on top in the UI */\nconst Resourcebar = () => {\n\n    const goldState = useGoldState();\n    const storeResources = useResourcesState();\n    const workersFree = useWorkersFreeState();\n\n    const createItem = (icon: string, amount: number, type: string) => {\n\n        const handleClick = (event: React.MouseEvent) => {\n\n            const origin = (event.currentTarget as HTMLElement);\n            const originRect = origin.getBoundingClientRect();\n            TooltipManager.showContextTooltip(ContextType.resource, type, originRect);\n            event.stopPropagation();\n        };\n\n        return (\n            <li key={type} onClick={handleClick}>\n                <Icon\n                    image={icon}\n                    size=\"smallest\"\n                />\n                <div className=\"amount\">\n                    { formatNumber(amount, 0) }\n                </div>\n            </li>\n        )\n    };\n\n    const resources = resourceOrder.map((resource) => {\n        const resourceDescription = resourceDescriptions[resource];\n        return createItem(resourceDescription.iconImg, storeResources[resource] ?? 0, resource);\n    });\n\n    resources.push(\n        createItem(\"/img/resources/worker.png\", workersFree, \"workers\"),\n        createItem(\"/img/resources/gold.png\", goldState, \"gold\"),\n    );\n\n    return (\n        <ul className=\"resourcebar\">\n            { resources }\n        </ul>\n    );\n};\nexport default Resourcebar;\n","import Menu from \"components/ui/window/windows/MenuWindow\";\nimport * as React from \"react\";\nimport Resourcebar from './Resourcebar';\nimport { useContext } from 'react';\nimport { AppContext } from 'components/App';\nimport { Persistor } from 'redux-persist';\nimport \"./styles/topbar.scss\";\n\ninterface Props {\n    persistor: Persistor;\n}\n\nconst Topbar = (props: Props) => {\n    const context = useContext(AppContext)!;\n\n    const handleClick = (_e: React.MouseEvent<HTMLDivElement, MouseEvent>) => {\n        const window = <Menu title = \"Menu\" persistor={props.persistor} />;\n        context.onOpenWindow(window);\n    };\n\n    return (\n        <div className = \"topbar\">\n            <div className = \"topbar-left\">\n                <Resourcebar />\n            </div>\n            <div className = \"topbar-right\">\n                <div className = \"hamburger\" onClick = { handleClick }>☰</div>\n            </div>\n        </div>\n    );\n}\nexport default Topbar;","import React, { useRef, useEffect } from 'react';\nimport { Sprite } from '@inlet/react-pixi';\nimport * as PIXI from 'pixi.js';\nimport { QuestStoreState } from 'store/types/quest';\nimport { AdventurerStoreState } from 'store/types/adventurer';\n\ninterface Props {\n    quest: QuestStoreState;\n    position: PIXI.Point;\n    selected?: boolean;\n    encounterActive?: boolean;\n    onClick?: (quest: QuestStoreState) => void;\n    leader: AdventurerStoreState;\n}\nconst CIRCLE_DIAMETER = 256; // = avatar size / 2\n\nconst QuestMarker = (props: Props) => {\n    const { quest, leader, encounterActive, position, onClick, selected } = props;\n    const image = selected ? '/img/world/map-marker-selected.png' : '/img/world/map-marker.png';\n\n    const avatar = useRef<PIXI.Sprite>(null);\n    // Mask has to be a child of the avatar in order to move with it\n    useEffect(() => {\n        const sprite = avatar.current as PIXI.Sprite;\n\n        const maskGraphics = new PIXI.Graphics();\n        maskGraphics.beginFill(0xBADA55);\n        maskGraphics.drawCircle(0, 0, CIRCLE_DIAMETER * 1);\n        maskGraphics.endFill();\n\n        sprite.mask = maskGraphics;\n        sprite.addChild(maskGraphics);\n    }, [avatar]);\n\n    return (\n        <Sprite\n            image={`${process.env.PUBLIC_URL}${image}`}\n            name={quest.name}\n            x={position.x}\n            y={position.y}\n            interactive={true}\n            buttonMode={true}\n            scale={new PIXI.Point(0.1, 0.1)}\n            anchor={new PIXI.Point(0.5, 1)}\n            pointerdown={() => {\n                if(onClick) {\n                    onClick(quest);\n                }\n            }}\n        >\n            { leader && (\n            <Sprite\n                image={`${process.env.PUBLIC_URL}/${leader.avatarImg}`}\n                name=\"avatar\"\n                anchor={new PIXI.Point(0.5, 0.5)}\n                x={0}\n                y={-396}\n                scale={new PIXI.Point(0.66, 0.66)}\n                ref={avatar}\n            />)}\n            {encounterActive && (\n            <Sprite\n                image={`${process.env.PUBLIC_URL}/img/world/quest-alert.png`}\n                name=\"quest-alert\"\n                anchor={new PIXI.Point(0.5, 1)}\n                x={180}\n                y={-396}\n                scale={new PIXI.Point(2, 2)}\n            />\n            )}\n        </Sprite>\n    )\n}\n\nexport default QuestMarker;","import React from \"react\";\nimport { Graphics } from '@inlet/react-pixi';\n\ninterface Props {\n    positions: PIXI.Point[];\n}\n\nconst QuestLine = (props: Props) => {\n    const { positions } = props;\n    if (props.positions.length > 2) {\n        return <Graphics\n            name=\"questline\"\n            x={0}\n            y={0}\n            draw={graphics => {\n                graphics.lineStyle(3, 0xFF3300);\n                graphics.moveTo(positions[0].x, positions[0].y);\n\n                let i = 0;\n                for (i = 1; i < positions.length - 2; i ++)\n                {\n                    const xc = (positions[i].x + positions[i + 1].x) / 2;\n                    const yc = (positions[i].y + positions[i + 1].y) / 2;\n                    graphics.quadraticCurveTo(positions[i].x, positions[i].y, xc, yc);\n                }\n                graphics.quadraticCurveTo(positions[i].x, positions[i].y, positions[i+1].x, positions[i+1].y);\n                graphics.endFill();\n            }}\n        />;\n    }\n    return null;\n}\n\nexport default QuestLine;","import { createSelectorCreator, defaultMemoize } from 'reselect';\nimport stringArrayEqual from 'string-arrays-equal';\n\nexport const createStringArraySelector = createSelectorCreator<string>(\n  // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n  // @ts-ignore: https://github.com/reduxjs/reselect/issues/384\n  defaultMemoize,\n  stringArrayEqual\n);","import { useCallback, useMemo } from 'react';\nimport { StoreState } from 'store/types';\nimport { useSelector } from 'react-redux';\nimport { QuestStatus, QuestStoreState } from 'store/types/quest';\nimport { createSelector } from 'reselect';\nimport { createStringArraySelector } from 'utils/reselect';\nimport { SceneStoreState } from 'store/types/scene';\n\nconst getQuests = (state: StoreState) => state.quests;\nconst getQuestNames = (state: StoreState) => state.quests.map(q => q.name);\nconst getQuestStatus = (state: StoreState) => state.quests.map(q => q.status);\n\n\nconst getActiveQuests = (quests: QuestStoreState[]) => {\n    // returns the names of the active quests\n    return quests.filter((q) => q.status === QuestStatus.active);\n};\n\n// Returns the quest from redux store\nexport const useQuest = (questName: string) => {\n    const questSelector = useCallback(\n        (state: StoreState) => state.quests.find((q) => q.name === questName)!,\n        [questName]\n    );\n    const quest = useSelector<StoreState, QuestStoreState>(questSelector);\n    return quest;\n}\n\nexport const useQuestScene = (questName: string) => {\n    const scene = useSelector<StoreState, SceneStoreState | undefined>(\n        store => store.quests.find((q) => q.name === questName)?.scene)\n    return scene;\n}\n\n// Returns the active quests from the store\nexport const useActiveQuests = () => {\n    const selectMemoized = useMemo(() => {\n        const activeQuests = createSelector(\n            [getQuests],\n            getActiveQuests,\n        );\n\n        return activeQuests;\n    }, []);\n\n    return useSelector<StoreState, QuestStoreState[]>(selectMemoized);\n}\n\n// Returns the active quests from the store\nexport const useActiveQuestNames = () => {\n    const questNameSelector = useMemo(() => createStringArraySelector(\n        [getQuestNames, getQuestStatus],\n        (names: string[], statuses: QuestStatus[]) => names.filter((_: string, index: number) => statuses[index] === QuestStatus.active)\n    ), []);\n    return useSelector<StoreState, string[]>(questNameSelector);\n}\n","import * as PIXI from 'pixi.js';\r\nimport React, { useEffect, useRef, useCallback, useState } from \"react\";\r\nimport { Stage, Sprite } from '@inlet/react-pixi';\r\nimport { Viewport as PixiViewport } from \"pixi-viewport\";\r\nimport { useDispatch, useSelector } from 'react-redux'\r\nimport { QuestStoreState } from \"store/types/quest\";\r\nimport { lerpLocation } from 'utils/pixiJs';\r\nimport { QuestDefinition, QuestNodeType, QuestNode } from \"definitions/quests/types\";\r\nimport Viewport from '../../pixi/Viewport';\r\n// import MapGrid from './MapGrid';\r\nimport QuestMarker from './QuestMarker';\r\nimport { AdventurerStoreState } from 'store/types/adventurer';\r\nimport QuestLine from './QuestLine';\r\nimport { MAX_WIDTH as WIDTH } from 'components/App';\r\nimport { getDefinition } from 'definitions/quests';\r\nimport { TextManager } from 'global/TextManager';\r\nimport { getQuestLeader } from 'store/helpers/storeHelpers';\r\nimport { StoreState } from 'store/types';\r\nimport { useActiveQuests, useQuest } from 'hooks/store/quests';\r\nimport { setCombat } from 'store/actions/quests';\r\nimport { useHistory } from 'react-router-dom';\r\nimport { getWorldLink } from 'utils/routing';\r\nimport './styles/worldMap.scss';\r\n\r\nwindow.PIXI = PIXI; // workaround for pixi-tilemap\r\nconst FULL_HEIGHT = 1024;\r\nconst SMALL_HEIGHT = 64;   // Used when QuestPanel is open\r\nconst WORLD_WIDTH = 1500;\r\nconst WORLD_HEIGHT = 1061;\r\nconst GRID_WIDTH = 10;      // width or height of each node location in pixels\r\n\r\nexport interface Props {\r\n    selectedQuestName?: string;\r\n    smallMap: boolean;\r\n    onPartyClick: (questName: string) => void;\r\n    retrieveWorldViewRef: () => React.RefObject<HTMLDivElement>;\r\n}\r\n\r\nconst WorldMap = (props: Props) => {\r\n    const { retrieveWorldViewRef, smallMap } = props;\r\n    const questSelector = useCallback(\r\n        (state: StoreState) => state.quests.find((q) => q.name === props.selectedQuestName),\r\n        [props.selectedQuestName]\r\n    );\r\n\r\n    const selectedQuest = useSelector<StoreState, QuestStoreState | undefined>(questSelector);\r\n    const adventurers = useSelector<StoreState, AdventurerStoreState[]>((store) => store.adventurers);\r\n    const activeQuests = useActiveQuests();\r\n    const history = useHistory();\r\n\r\n    const handlePartyClick = (name: string) => {\r\n        props.onPartyClick(name);\r\n    };\r\n\r\n    const handleClose = () => {\r\n        history.push(getWorldLink());\r\n    }\r\n\r\n    // useEffect(() => {\r\n    //     const onScroll = (e: WheelEvent) => {\r\n    //         // When the map is big, scrolling the mouse is just used for zoom, not for actual scrolling\r\n    //         if (!smallMap) {\r\n    //             e.preventDefault();\r\n    //         }\r\n    //     }\r\n    //     window.addEventListener(\"wheel\", onScroll, {passive: false} );\r\n    //     return () => {\r\n    //         window.removeEventListener(\"wheel\", onScroll);\r\n    //     };\r\n    // }, [smallMap]);\r\n\r\n\r\n    const [canvasWidth, setCanvasWidth] = useState(WIDTH);\r\n    const [canvasHeight, setCanvasHeight] = useState(FULL_HEIGHT);\r\n\r\n    useEffect(() => {\r\n        // This will set the dimensions of the canvas tot that of the parent (worldview)\r\n        const resize = () => {\r\n            const worldView = retrieveWorldViewRef();\r\n            const worldViewWidth = worldView.current?.clientWidth || WIDTH;\r\n            const worldViewHeight = worldView.current?.clientHeight || FULL_HEIGHT;\r\n\r\n            setCanvasWidth(worldViewWidth);\r\n            if (smallMap) {\r\n                if (worldViewWidth < 576) {\r\n                    // Small screens\r\n                    setCanvasHeight(SMALL_HEIGHT / 2);\r\n                } else {\r\n                    setCanvasHeight(SMALL_HEIGHT);\r\n                }\r\n            }\r\n            else {\r\n                setCanvasHeight(worldViewHeight);\r\n            }\r\n        }\r\n        resize();\r\n        window.addEventListener(\"resize\", resize);\r\n        return () => {\r\n            window.removeEventListener(\"resize\", resize);\r\n        };\r\n    }, [retrieveWorldViewRef, smallMap]);\r\n\r\n    useEffect(() => {\r\n        if (selectedQuest) {\r\n            focusOnQuestingParty(selectedQuest);\r\n        } else {\r\n            const viewport = viewportRef.current!;\r\n            const point = nodeLocationToPoint({ x: 0, y: 0 });\r\n            viewport.moveCenter(point.x, point.y);\r\n        }\r\n    }, [selectedQuest, canvasHeight])\r\n\r\n    const viewportRef = useRef<PixiViewport>(null);\r\n    useEffect(() => {\r\n        // focus on center of the map\r\n        if (viewportRef.current) {\r\n            const viewport = viewportRef.current;\r\n            const point = nodeLocationToPoint({ x: 0, y: 0 });\r\n            viewport.moveCenter(point.x / 2, point.y / 2 + 10);\r\n        }\r\n    }, [canvasWidth]);\r\n\r\n    const renderQuestlines = () => {\r\n        return activeQuests.map((quest) => {\r\n            const previousPositions = getPreviousPositions(quest);\r\n            return (\r\n                <QuestLine positions={previousPositions} key={quest.name} />\r\n            );\r\n        });\r\n    };\r\n\r\n    const renderMarkers = () => {\r\n        return activeQuests.map((quest) => {\r\n            const location = getQuestWorldLocation(quest);\r\n            const currentPosition = nodeLocationToPoint(location);\r\n            const leader = getQuestLeader(adventurers, quest)!;\r\n            const questDefinition: QuestDefinition = getDefinition(quest.name);\r\n            const progress: number = Math.floor(quest.progress);\r\n            const questNode: QuestNode = questDefinition.nodes[progress];\r\n\r\n            return (\r\n                <QuestMarker\r\n                    quest={quest}\r\n                    leader={leader}\r\n                    position={currentPosition}\r\n                    key={quest.name}\r\n                    selected={quest === selectedQuest}\r\n                    encounterActive={questNode.type === QuestNodeType.encounter}\r\n                    onClick={(q) => handlePartyClick(q.name)}\r\n                />\r\n            );\r\n        });\r\n    };\r\n\r\n\r\n    // puts the given party in the center of the map\r\n    const focusOnQuestingParty = (quest: QuestStoreState) => {\r\n        const viewport = viewportRef.current;\r\n        if (viewport) {\r\n            const partyLocation = getQuestWorldLocation(quest);\r\n            const point = nodeLocationToPoint(partyLocation);\r\n            viewport.moveCenter(point.x, point.y);\r\n        }\r\n    }\r\n\r\n    const handleMapClick = () => {\r\n        /// todo: close map\r\n        // if(smallMap === true && selectedQuest) {\r\n        //     props.onPartyClick(selectedQuest.name);\r\n        // }\r\n    }\r\n\r\n    const options = {\r\n        autoDensity: true,\r\n        sharedLoader: true,\r\n        width: canvasWidth,\r\n        height: canvasHeight,\r\n    }\r\n    return (\r\n        <div className=\"world-map\">\r\n            <Stage width={canvasWidth} height={canvasHeight} options={options}>\r\n                <Viewport screenWidth={canvasWidth} screenHeight={canvasHeight} worldWidth={WORLD_WIDTH} worldHeight={WORLD_HEIGHT} ref={viewportRef} >\r\n                    <Sprite\r\n                        image={`${process.env.PUBLIC_URL}/img/world/francesca-baerald-fbaerald-angeloumap-lowres.jpg`}\r\n                        interactive={true}\r\n                        pointerdown={handleMapClick}\r\n                    >\r\n                        {renderQuestlines()}\r\n                        {renderMarkers()}\r\n                    </Sprite>\r\n                    {/* <MapGrid width={WORLD_WIDTH} height={WORLD_HEIGHT} gridWidth={GRID_WIDTH} /> */}\r\n                </Viewport>\r\n            </Stage>\r\n            {props.selectedQuestName && (\r\n                <div className=\"title\">\r\n                    <span>\r\n                        <DebugToggleCombat questName={props.selectedQuestName} />\r\n                        {TextManager.getQuestTitle(props.selectedQuestName)}\r\n                    </span>\r\n                    <span onClick={handleClose} className=\"close\">x</span>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\n\r\nexport default WorldMap;\r\n\r\nconst getQuestWorldLocation = (quest: QuestStoreState): { x: number; y: number; } => {\r\n    const questDefinition = getDefinition(quest.name);\r\n    const roundedProgress = Math.floor(quest.progress);\r\n    const lastNode = questDefinition.nodes[roundedProgress];\r\n\r\n    const nextNode = questDefinition.nodes[roundedProgress + 1];\r\n    if (!nextNode) {\r\n        // We've reached the last node\r\n        return lastNode;\r\n    }\r\n    return lerpLocation(lastNode, nextNode, quest.progress - roundedProgress);\r\n};\r\n\r\n// Node locations work on a centered coordinate system\r\nconst nodeLocationToPoint = (location: { x: number; y: number; }) => {\r\n    const x = location.x * GRID_WIDTH + WORLD_WIDTH / 2;\r\n    const y = location.y * GRID_WIDTH + WORLD_HEIGHT / 2;\r\n    return new PIXI.Point(x, y);\r\n}\r\n\r\nconst getPreviousPositions = (quest: QuestStoreState) => {\r\n    const positions: PIXI.Point[] = [];\r\n    const questDefinition = getDefinition(quest.name);\r\n\r\n    for (let i = 0; i < quest.progress; i++) {\r\n        positions.push(nodeLocationToPoint(questDefinition.nodes[i]))\r\n    }\r\n    const lastPosition = nodeLocationToPoint(getQuestWorldLocation(quest));\r\n    positions.push(lastPosition);\r\n    return positions;\r\n}\r\n\r\n\r\n// temporary\r\nconst DebugToggleCombat = ({ questName }: {questName: string}) => {\r\n    const quest = useQuest(questName);\r\n    const dispatch = useDispatch();\r\n\r\n    if (quest.scene?.combat) {\r\n        return (\r\n            <button onClick={() => dispatch(setCombat(questName, false))}>combat: on</button>\r\n        );\r\n    }\r\n    return (\r\n        <button onClick={() => dispatch(setCombat(questName, true))}>\r\n            combat: off\r\n        </button>\r\n    )\r\n}","import { EquipmentSlotType } from \"components/ui/adventurer/EquipmentSlot\";\nimport { Item } from \"definitions/items/types\";\nimport { Trait } from 'definitions/traits/types';\n\nexport interface AdventurerStoreState {\n    id: string;\n    name: string;\n    avatarImg: string;\n    spritesheetPath: string;            // Path to JSON of spritesheet to use in scenes\n    color?: AdventurerColor;\n    traits?: Trait[];\n    health: number;                     // When this reaches zero, the adventurer is dead\n    xp: number;\n    baseAP: number;                     // Amount of AP this adventurer has\n\n    equipment: EquipmentStoreState;     // equipment\n    inventory: (null | Item)[];\n    basicAttributes: BasicAttributesStoreState;\n    skills: SkillsStoreState;           //\n    room: number;                       // Adventurer is lodged in this room in the tavern\n}\n\nexport enum AdventurerColor {\n    blue,\n    red,\n    teal,\n    purple,\n    orange,\n    black,\n    white,\n    yellow\n}\n\nexport interface EquipmentStoreState {\n    [EquipmentSlotType.head]?: Item;\n    [EquipmentSlotType.shoulders]?: Item;\n    [EquipmentSlotType.chest]?: Item;\n    [EquipmentSlotType.hands]?: Item;\n    [EquipmentSlotType.legs]?: Item;\n    [EquipmentSlotType.feet]?: Item;\n    [EquipmentSlotType.mainHand]?: Item;\n    [EquipmentSlotType.offHand]?: Item;\n    // [EquipmentSlotType.sideArm]?: Item;\n}\n\nexport interface BasicAttributesStoreState {\n    strength: number;\n    dexterity: number;\n    intelligence: number;\n    health: number;\n}\n\nexport interface SkillsStoreState {\n    [key: string]: number\n}\n","import React, { useMemo,  useEffect, useRef, useCallback, PropsWithChildren, useState, memo } from 'react';\nimport { gsap } from 'gsap';\nimport { Container } from '@inlet/react-pixi';\nimport { MultiColorReplaceFilter } from 'pixi-filters';\nimport { SceneActionType, SceneAction } from 'store/types/scene';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { completeSceneAction } from 'store/actions/quests';\nimport { StoreState } from 'store/types';\nimport { BaseSceneController } from 'mechanics/scenes/BaseSceneController';\nimport SpriteAnimated from '../../../../pixi/tile/SpriteAnimated';\nimport { Channel, MixMode, SoundManager } from 'global/SoundManager';\nimport { AdventurerColor } from 'store/types/adventurer';\nimport { useQuest } from 'hooks/store/quests';\n\nexport interface Props  {\n    name: string;\n    spritesheetPath: string;\n    color?: AdventurerColor;\n    controller: BaseSceneController<unknown>;\n    location?: [number, number]; // tile coordinate space\n    lookAt?: [number, number];\n    idleAnimation?: boolean;    // Only when lookAt is undefined, will randomly turn around\n}\n\nenum Orientation {\n    north = \"n\",\n    northEast = \"ne\",\n    east = \"e\",\n    southEast = \"se\",\n    south = \"s\",\n    southWest = \"sw\",\n    west = \"w\",\n    northWest = \"nw\"\n}\n\n// This is a wrapper that exposes a location property. Will set x and y on children\nconst SceneActor = (props: PropsWithChildren<Props> & React.ComponentProps<typeof Container>) => {\n    const {\n        location = [0, 0],\n        controller,\n        idleAnimation,\n        color,\n        children,\n        spritesheetPath,\n        lookAt,\n        ...rest\n    } = props;\n    const {tileWidth, tileHeight} = controller.getTileDimensions();\n    const actorRef = useRef<PIXI.Container>(null);\n    const previousAction = useRef<SceneAction>();\n    const dispatch = useDispatch();\n    const quest = useQuest(props.controller.questName);\n    const actionQueueSelector = useCallback(() => {\n        if (!quest.scene?.actionQueue) {\n            return [];\n        }\n        return quest.scene!.actionQueue.filter(a => a.actorId === props.name);\n    },\n    [quest.scene, props.name]);\n    const actionQueue = useSelector<StoreState, SceneAction[]>(actionQueueSelector);\n    const [animation, setAnimation] = useState(\"stand\");\n    const tween = useRef<gsap.core.Tween>();\n\n    // Handle actions\n    useEffect(() => {\n        if (!actorRef) {\n            return;\n        }\n        // Determines orientation based on where the target is\n        const determineOrientation = () => {\n            if (location[0] === nextAction.target[0] && location[1] > nextAction.target[1]) {\n                setOrientation(Orientation.north);\n            }\n            else if (location[0] < nextAction.target[0] && location[1] > nextAction.target[1]) {\n                setOrientation(Orientation.northEast);\n            }\n            else if (location[0] < nextAction.target[0] && location[1] === nextAction.target[1]) {\n                setOrientation(Orientation.east);\n            }\n            else if (location[0] < nextAction.target[0] && location[1] < nextAction.target[1]) {\n                setOrientation(Orientation.southEast);\n            }\n            else if (location[0] === nextAction.target[0] && location[1] < nextAction.target[1]) {\n                setOrientation(Orientation.south);\n            }\n            else if (location[0] > nextAction.target[0] && location[1] < nextAction.target[1]) {\n                setOrientation(Orientation.southWest);\n            }\n            else if (location[0] > nextAction.target[0] && location[1] === nextAction.target[1]) {\n                setOrientation(Orientation.west);\n            }\n            else if (location[0] > nextAction.target[0] && location[1] > nextAction.target[1]) {\n                setOrientation(Orientation.northWest);\n            }\n        }\n        const nextAction = actionQueue[0];\n        if (nextAction && nextAction !== previousAction.current) {\n            // console.log(`next action is ${nextAction.target} (${nextAction.actionType}), \\ncurrent location is: ${location}\\nprev action was ${previousAction?.current?.target} `)\n            switch (nextAction.actionType) {\n                case SceneActionType.move: {\n                    const moveComplete = () => {\n                        dispatch(completeSceneAction(props.controller.questName));\n                        props.controller.actorMoved(props.name, nextAction.target);\n                    }\n                    const duration = (nextAction.endsAt - performance.now()) / 1000;\n                    if (duration < 0) {\n                        moveComplete();\n                    }\n\n                    // determine orientation\n                    determineOrientation();\n                    setAnimation(\"walk\");\n                    gsap.killTweensOf(actorRef.current);\n                    tween.current = gsap.to(actorRef.current, {\n                        duration,\n                        ease: \"linear\",\n                        pixi: {\n                            x: nextAction.target[0] * tileWidth,\n                            y: nextAction.target[1] * tileHeight\n                        },\n                        onComplete: moveComplete\n                    });\n                    break;\n                }\n                case SceneActionType.slash: {\n                    determineOrientation();\n                    setAnimation(\"attack\");\n                    SoundManager.playSound(\"scene/swish\", Channel.scene, false, MixMode.singleInstance);\n                    const attackComplete = () => {\n                        setAnimation(\"stand\");\n                        dispatch(completeSceneAction(props.controller.questName));\n                    }\n                    setTimeout(attackComplete, 1000);\n                    break;\n                }\n                case SceneActionType.interact: {\n                    controller.actorInteract(props.name, nextAction.target);\n                    dispatch(completeSceneAction(props.controller.questName));\n                    break;\n                }\n            }\n            previousAction.current = nextAction;\n        }\n    }, [dispatch, tileWidth, tileHeight, actionQueue, props.controller, props.name, location, controller]);\n\n    useEffect(() => {\n        return () => {\n            tween.current?.kill();\n        }\n    }, []);\n\n    const {x, y} = useMemo(() => {\n        setAnimation(\"stand\")\n\n        return {\n            x: location[0] * tileWidth,\n            y: location[1] * tileHeight,\n        };\n    }, [location, tileWidth, tileHeight]);\n\n    const [frames, setFrames] = useState<{ [key: string]: PIXI.Texture[]}|null>(null);\n\n    useEffect(() => {\n        if (!spritesheetPath) return;\n\n        if (!PIXI.Loader.shared.resources[spritesheetPath]?.textures){\n            throw new Error(`No textures for ${spritesheetPath}`);\n        }\n        const allFrames = Object.keys(PIXI.Loader.shared.resources[spritesheetPath].textures!);\n        const indexed = allFrames.reduce((acc: any, frame: string) => {\n            // frames are in the format of: 'stand-n', 'walk0-ne', 'walk1-ne' etc\n            // create a mapping with arrays keyed by the part without the number,\n            // eg: 'stand-n': [TEXTURE:stand-n] and 'walk-ne': [TEXTURE:walk0-ne, TEXTURE:walk1-ne]\n            const key = frame.replace(/[0-9]/g, '');\n            if (!acc[key]) {\n              acc[key] = [];\n            }\n            acc[key].push(PIXI.Loader.shared.resources[spritesheetPath].textures![frame]);\n            return acc;\n        }, {});\n        setFrames(indexed);\n    }, [spritesheetPath])\n\n    const [orientation, setOrientation] = useState<Orientation>(Orientation.north);\n    // const [flipped, setFlipped] = useState(false);\n    const flipped = useRef(false);\n    const setFlipped = (value:boolean) => {\n        flipped.current = value;\n    }\n\n    useEffect(() => {\n        if (lookAt !== undefined) {\n            const bearing = calculateBearing(location, lookAt);\n            setOrientation(bearing);\n        }\n    }, [location, lookAt])\n\n    useEffect(() => {\n        setFlipped(orientation === Orientation.southWest || orientation === Orientation.west || orientation === Orientation.northWest)\n    }, [orientation]);\n\n    useEffect(() => {\n        // Todo: move to custom hook\n        if (!idleAnimation || !!lookAt) return;\n\n        // Idle animation\n        // Randomly turn left or right\n        const randomOrientation = () => {\n            const left = Math.random() < .5;\n            if (orientation === Orientation.north && left) {\n                setOrientation(Orientation.northWest);\n            }\n            else if (orientation === Orientation.northWest && left) {\n                setOrientation(Orientation.west);\n            }\n            else if (orientation === Orientation.west && left) {\n                setOrientation(Orientation.southWest);\n            }\n            else if (orientation === Orientation.southWest && left) {\n                setOrientation(Orientation.south);\n            }\n            else if (orientation === Orientation.south && left) {\n                setOrientation(Orientation.southEast);\n            }\n            else if (orientation === Orientation.southEast && left) {\n                setOrientation(Orientation.east);\n            }\n            else if (orientation === Orientation.east && left) {\n                setOrientation(Orientation.northEast);\n            }\n            else if (orientation === Orientation.northEast && left) {\n                setOrientation(Orientation.north);\n            }\n            if (orientation === Orientation.north && !left) {\n                setOrientation(Orientation.northEast);\n            }\n            else if (orientation === Orientation.northEast && !left) {\n                setOrientation(Orientation.east);\n            }\n            else if (orientation === Orientation.east && !left) {\n                setOrientation(Orientation.southEast);\n            }\n            else if (orientation === Orientation.southEast && !left) {\n                setOrientation(Orientation.south);\n            }\n            else if (orientation === Orientation.south && !left) {\n                setOrientation(Orientation.southWest);\n            }\n            else if (orientation === Orientation.southWest && !left) {\n                setOrientation(Orientation.west);\n            }\n            else if (orientation === Orientation.west && !left) {\n                setOrientation(Orientation.northWest);\n            }\n            else if (orientation === Orientation.northWest && !left) {\n                setOrientation(Orientation.north);\n            }\n        }\n        const minDuration = 2000;\n        const maxDuration = 4000;\n        const duration = minDuration + Math.random() * maxDuration;\n        const interval = setInterval(randomOrientation, duration);\n        return () => clearInterval(interval);\n    }, [animation, idleAnimation, orientation, lookAt])\n\n    const getFrames = useCallback(() => {\n        const prefix = '';\n        // const prefix = `${spritesheet.data.meta.image}-`;\n        switch (orientation) {\n            case Orientation.northWest:\n                return `${prefix}${animation}-${Orientation.northEast}`;\n            case Orientation.west:\n                return `${prefix}${animation}-${Orientation.east}`;\n            case Orientation.southWest:\n                return `${prefix}${animation}-${Orientation.southEast}`;\n            default:\n                return `${prefix}${animation}-${orientation}`;\n        }\n    }, [animation, orientation]);\n\n    const filters = useMemo<PIXI.Filter[]>(() => {\n        switch (color) {\n            case AdventurerColor.black:\n                return [createColorReplaceFilter(BLUES, BLACK)];\n            case AdventurerColor.orange:\n                return [createColorReplaceFilter(BLUES, ORANGE)];\n            case AdventurerColor.purple:\n                return [createColorReplaceFilter(BLUES, PURPLE)];\n            case AdventurerColor.red:\n                return [createColorReplaceFilter(BLUES, REDS)];\n            case AdventurerColor.teal:\n                return [createColorReplaceFilter(BLUES, TEALS)];\n            case AdventurerColor.white:\n                return [createColorReplaceFilter(BLUES, WHITE)];\n            case AdventurerColor.yellow:\n                return [createColorReplaceFilter(BLUES, YELLOW)];\n\n            case AdventurerColor.blue:\n            default:\n                return [];\n        }\n    }, [color])\n\n    return (\n        <Container x={x} y={y} ref={actorRef} {...rest}>\n            { spritesheetPath && frames && (\n                <SpriteAnimated\n                    animationSpeed={0.1}\n                    name=\"sprite\"\n                    isPlaying={true}\n                    textures={frames[getFrames()]}\n                    x={50}\n                    y={30}\n                    scale={[(flipped.current ? -1 : 1), 1]}\n                    anchor={[.5, .5]}\n                    pivot={[0, 0]}\n                    filters={filters}\n                />\n            )}\n            {children}\n        </Container>\n    )\n};\n\nexport default memo(SceneActor);\n\n// Calculates an orientation that origin would be in if it was looking at destination\nconst calculateBearing = (origin: [number, number], destination: [number, number]) => {\n    const angle = Math.atan2(destination[1] - origin[1], destination[0] - origin[0]);\n    const result = Math.round((angle / (2 * Math.PI / 8) + 8) % 8);\n    const orientations = [Orientation.east, Orientation.southEast, Orientation.south, Orientation.southWest, Orientation.west, Orientation.northWest, Orientation.north, Orientation.northEast];\n    return orientations[result];\n}\n\nconst createColorReplaceFilter = (from: number[], to: number[]) => {\n    const replacements = from.map((val, index) => {\n        return [\n            from[index], to[index]\n        ]\n    });\n    return new MultiColorReplaceFilter(replacements, 0.15);\n}\n\nconst BLUES = [\n    0x000e5f,\n    0x00227f,\n    0x0038a5,\n    0x0055cc,\n];\n\nconst REDS = [\n    0x570800,\n    0x700c00,\n    0x901000,\n    0xb51700\n];\n\nconst TEALS = [\n    0x00330d,\n    0x00653a,\n    0x08936f,\n    0x30bea5\n];\n\nconst PURPLE = [\n    0x3b0d3a,\n    0x641d5e,\n    0x884696,\n    0xaa61bd\n];\n\nconst ORANGE = [\n    0x802d0c,\n    0xaa4a12,\n    0xd16d11,\n    0xf59717\n];\n\nconst BLACK = [\n    0x0d0d1a,\n    0x1a1b2b,\n    0x25263a,\n    0x35354c\n];\n\nconst WHITE = [\n    0x30375e,\n    0x676993,\n    0xa9aac2,\n    0xe6e6e6\n];\n\nconst YELLOW = [\n    0xc28600,\n    0xd6ae10,\n    0xe9d333,\n    0xfdf959\n];","import React from \"react\";\nimport { Props as TabProps } from \"./Tab\";\nimport { SoundManager} from 'global/SoundManager';\nimport \"./styles/tabstrip.scss\";\n\nexport interface Props {\n    className?: string;\n    children: React.ReactElement<TabProps>[] |  React.ReactElement<TabProps>;\n    activeTab?: string;\n    disabled?: boolean;\n    onClick?: React.MouseEventHandler<Element>;\n    onTabSelected?: (tabId: string) => void;\n}\n\nconst Tabstrip = (props: Props) => {\n    const {activeTab = null} = props;\n    if (!activeTab && props.children && props.children) {\n        //activeTab = props.children[0].props.id;\n    }\n    const className = `${props.className}${(props.disabled ? \" disabled\" : \"\")}`;\n    const children = React.Children.map(props.children, (child: React.ReactElement<TabProps>) => {\n        const clone: React.ReactElement<TabProps> = React.cloneElement(child, {\n            active: child.props.id === activeTab,\n            onClick: () => { handleTabClick(child.props.id); }\n        });\n        return clone;\n    });\n\n    const handleTabClick = (tabId: string) => {\n        if (props.onTabSelected && props.disabled !== true) {\n            props.onTabSelected(tabId);\n        }\n    };\n\n    const handleClick = (e: React.MouseEvent<Element>) => {\n        SoundManager.playSound(\"ui/buttonClick\");\n        if (props.onClick) {\n            props.onClick(e);\n        }\n    };\n\n    return (\n        <ul className={`tabstrip ${className ?? \"\"}`} onClick={handleClick}>\n            {children}\n        </ul>\n    );\n};\n\nexport default Tabstrip;\n","import * as React from \"react\";\n\nexport interface Props {\n    id: string;\n    className?: string;\n    onClick?: React.MouseEventHandler<Element>;\n    active?: boolean;\n}\n\n\nconst Tab = (props: React.PropsWithChildren<Props>) => {\n    const handleClick = (e: React.MouseEvent<HTMLLIElement>) => {\n        if (props.onClick) {\n            props.onClick(e);\n        }\n    };\n    const className = ((props.active) ? \"active\" : \"\") + (props.className || \"\");\n    return (\n        <li className={`tabstrip-tab ${className}`} onClick={handleClick}>\n            {props.children}\n        </li>\n    );\n};\n\nexport default Tab;\n","import Icon, { IconSize } from 'components/ui/common/Icon';\nimport * as React from \"react\";\nimport { AdventurerStoreState } from \"store/types/adventurer\";\nimport \"./styles/adventureravatar.scss\";\n\nexport interface Props {\n    adventurer: AdventurerStoreState;\n    className?: string;\n    displayName?: boolean;\n    onClick?: (adventurerId: string) => void;\n    size?: IconSize;\n}\n\n/**\n * The AdventurerAvatar displays the avatar of an adventurer\n */\nconst AdventurerAvatar = (props: Props) => {\n    const {\n        adventurer,\n        size\n    } = props;\n\n    const className = `${(props.className || \"\")} avatar`;\n\n    const handleClick = () => {\n        if (props.onClick) {\n            props.onClick(props.adventurer.id);\n        }\n    };\n    return (\n        <Icon\n            className={className}\n            image={adventurer.avatarImg}\n            size={size}\n            onClick={handleClick}\n        />\n    );\n};\n\nexport default AdventurerAvatar;\n","import React from \"react\";\nimport Tabstrip from 'components/ui/tabs/Tabstrip';\nimport { AdventurerStoreState } from 'store/types/adventurer';\nimport Tab from 'components/ui/tabs/Tab';\nimport AdventurerAvatar from 'components/ui/adventurer/AdventurerAvatar';\nimport { IconSize } from 'components/ui/common/Icon';\n\ninterface Props {\n    adventurers: AdventurerStoreState[];\n    selectedAdventurerId?: string;\n    onAdventurerTabSelected: (adventurerId: string) => void;\n    disabled?: boolean;\n}\n\n// Shows adventurer portraits in a tabstrip\nconst AdventurerTabstrip = (props: Props) => {\n    const {adventurers, onAdventurerTabSelected} = props;\n\n    const handleAdventurerTabSelected = (adventurerId: string) => {\n        const adventurer = props.adventurers.find(a => a.id === adventurerId)!;\n        onAdventurerTabSelected(adventurer.id);\n    }\n\n    const renderAdventurerTab = (adventurer: AdventurerStoreState) => (\n        <Tab id={adventurer.id} key={adventurer.id}>\n            <AdventurerAvatar adventurer={adventurer} size={IconSize.medium}/>\n        </Tab>\n    );\n    return (\n        <Tabstrip\n            className=\"adventurers-tabstrip\"\n            onTabSelected={handleAdventurerTabSelected}\n            activeTab={props.selectedAdventurerId}\n            disabled={props.disabled}\n        >\n            {adventurers.map((a) => renderAdventurerTab(a))}\n        </Tabstrip>\n    )\n}\n\nexport default AdventurerTabstrip;","import { createSelector } from \"reselect\";\nimport { adventurersOnQuest } from 'store/helpers/storeHelpers';\nimport { StoreState } from 'store/types';\nimport { AdventurerStoreState } from \"store/types/adventurer\";\nimport { QuestStatus, QuestStoreState } from 'store/types/quest';\n\n// maybe this is not used anymore?\n\n// Store accessors\nconst getAdventurers = (state: StoreState): AdventurerStoreState[] => state.adventurers;\nconst getQuests = (state: StoreState): QuestStoreState[] => state.quests;\n\nconst groupAdventurersByQuest = (adventurers: AdventurerStoreState[], quests: QuestStoreState[]): Record<string, AdventurerStoreState[]> => {\n    const foundInParty: AdventurerStoreState[] = []; // store the adventurers in parties in a temp array\n\n\n    const groupedAdventurers = Object.values(quests).reduce<{[key: string]: AdventurerStoreState[]}>((acc, value) => {\n        const foundAdventurers = adventurersOnQuest(adventurers, value);\n        if (value.status === QuestStatus.active) {\n            // Only active quests\n            acc[value.name] = foundAdventurers;\n        }\n        foundInParty.push(...foundAdventurers);\n        return acc;\n    }, {});\n\n    // Add a special group called 'solo' for those adventurers not in a party\n    const soloKey = \"solo\";\n    groupedAdventurers[soloKey] = adventurers.filter((a) => foundInParty.indexOf(a) === -1);\n\n    return groupedAdventurers;\n};\n\nconst getAdventurersInTown = (adventurers: AdventurerStoreState[], quests: QuestStoreState[]): AdventurerStoreState[] => {\n    // Get an array of all adventurer ids on any active quest\n    const adventurersOnQuest = quests.reduce<string[]>((acc, val: QuestStoreState) => {\n        if (val.status === QuestStatus.active) {\n            acc.push(...val.party);\n        }\n        return acc;\n    }, []);\n\n    return adventurers.filter((a) => adventurersOnQuest.indexOf(a.id) === -1);\n};\n\n/** Returns an object keyed by active quests whose value is a list of AdventurerStoreState */\nexport const selectAdventurersGroupedByQuest = createSelector([\n    getAdventurers,\n    getQuests],\n    groupAdventurersByQuest,\n);\n\n/** Returns a selector keyed by active quests whose value is a list of AdventurerStoreState */\nexport const createSelectAdventurersOnQuest = (questName: string) => {\n    const getAdventurersOnQuest = (adventurers: AdventurerStoreState[], quests: QuestStoreState[]): AdventurerStoreState[] => {\n        const quest = quests.find(q => q.name === questName)!;\n        return adventurersOnQuest(adventurers, quest);\n    };\n\n    return createSelector([\n        getAdventurers,\n        getQuests],\n        getAdventurersOnQuest,\n    );\n}\n\n/** Returns an object keyed by active quests whose value is a list of AdventurerStoreState */\nexport const selectAdventurersInTown = createSelector([\n    getAdventurers,\n    getQuests],\n    getAdventurersInTown,\n);\n","import { PixiComponent } from \"@inlet/react-pixi\";\nimport * as PIXI  from 'pixi.js';\nimport { TiledLayerData, TiledTilesetData } from 'constants/tiledMapData';\nimport { CompositeRectTileLayer } from 'pixi-tilemap';\nimport { findTileset } from \"utils/tilemap\";\n\n\ninterface Props  {\n    horizontalTiles: number;\n    layer: TiledLayerData;\n    tilesets: TiledTilesetData[];\n    spritesheets: {[key: string]: PIXI.Spritesheet}\n}\n\n// cant get this to work with pixi-tilemap :/\n// eslint-disable-next-line @typescript-eslint/no-explicit-any \nconst RectTileLayer = PixiComponent<Props, any>(\"RectTileLayer\", {\n    create(_props: Props) {\n        const tileLayer = new CompositeRectTileLayer();\n        return tileLayer;\n    },\n\n    applyProps(instance, oldProps: Props, props: Props) {\n        const {layer, tilesets, horizontalTiles, spritesheets} = props;\n        if (!layer.data) {\n            return;\n        }\n        for (let i = 0; i < layer.data.length; i++) {\n            const tileset = findTileset(layer.data[i], tilesets);\n            if (!tileset) continue;\n\n            const w = tileset.tilewidth;\n            const h = tileset.tileheight;\n            const x = (i % horizontalTiles) * w;\n            const y = Math.floor(i / horizontalTiles) * h;\n            const spritesheet = spritesheets[tileset.name];\n\n            if (layer.data[i] > 0) {\n                const spriteId = `${tileset.name}-${layer.data[i]}`;\n                instance.addFrame(spritesheet.textures[spriteId], x, y);\n            }\n        }\n    }\n});\n\nexport default RectTileLayer;\n\n\n","import { PixiComponent } from \"@inlet/react-pixi\";\nimport * as PIXI from 'pixi.js';\nimport { TiledTilesetData } from 'constants/tiledMapData';\nimport { SceneObject } from 'store/types/scene';\nimport { CompositeRectTileLayer } from 'pixi-tilemap';\nimport { findTileset } from \"utils/tilemap\";\n\n// window.PIXI = PIXI;\nimport 'pixi-tilemap';\n\n\n\ninterface Props  {\n    objects: SceneObject[];\n    tilesets: TiledTilesetData[];\n    spritesheets: {[key: string]: PIXI.Spritesheet}\n}\n\n// cant get this to work with pixi-tilemap :/\n// eslint-disable-next-line @typescript-eslint/no-explicit-any \nconst ObjectTileLayer = PixiComponent<Props, any>(\"ObjectTileLayer\", {\n    create(_props: Props) {\n        const tileLayer = new CompositeRectTileLayer();\n        return tileLayer;\n    },\n\n    applyProps(instance, _oldProps: Props, props: Props) {\n        const {objects, tilesets, spritesheets} = props;\n        if (!objects.length) {\n            return;\n        }\n        instance.clear();\n        if (!objects) return;\n\n        objects.forEach((object) => {\n            if (!object.gid) return; // todo!\n            const tileset = findTileset(object.gid, tilesets);\n            if (!tileset) return;\n\n            const x = object.x;\n            const y = object.y - tileset.tileheight;\n            const spritesheet = spritesheets[tileset.name];\n\n            // todo: add sprites!\n            const spriteId = `${tileset.name}-${object.gid}`;\n            instance.addFrame(spritesheet.textures[spriteId], x, y);\n      \n        });\n    }\n});\n\nexport default ObjectTileLayer;\n\n","import { PixiComponent, applyDefaultProps, AnimatedSprite } from '@inlet/react-pixi';\nimport * as PIXI from 'pixi.js';\n\nconst SpriteAnimated = PixiComponent<React.ComponentProps<typeof AnimatedSprite>, PIXI.AnimatedSprite>('SpriteAnimated', {\ncreate: ({ textures }) => {\n    const animatedSprite = new PIXI.AnimatedSprite(textures || [], true);\n    return animatedSprite;\n  },\n  applyProps: (instance, oldProps, newProps) => {\n    if(oldProps.textures !== newProps.textures){\n      applyDefaultProps(instance, oldProps, newProps);\n      instance.gotoAndPlay(0);\n    }\n  },\n});\n\n// export default memo(SpriteAnimated);\nexport default SpriteAnimated;\n\n","import { Container, Graphics } from '@inlet/react-pixi';\nimport React, { useRef, memo } from 'react';\nimport SceneActor, { Props as SceneActorProps } from './SceneActor';\n\ninterface Props  {\n    adventurerId: string;\n    selected: boolean;\n    spritesheetPath: string;\n}\n\n// The adventurers avatar on the scene\nconst SceneAdventurer = (props: Props & Omit<SceneActorProps, 'children'|'name'>) => {\n    const {\n        controller,\n        location,\n        adventurerId,\n        selected,\n        spritesheetPath,\n    } = props;\n    const {tileWidth, tileHeight} = controller.getTileDimensions();\n\n    const ref = useRef<PIXI.Container>(null);\n\n    return (\n        <Container ref={ref}>\n            <SceneActor\n                name={adventurerId}\n                controller={controller}\n                spritesheetPath={spritesheetPath}\n                location={location}\n                idleAnimation={Math.random() < 0.5}\n            >\n                {selected && (\n                    <Graphics\n                        name=\"selectioncircle\"\n                        draw={graphics => {\n                            const line = 3;\n                            graphics.lineStyle(line, 0xFFFFFF);\n                            graphics.drawCircle(tileWidth / 2, tileHeight / 2, tileWidth / 2 - line);\n                            graphics.endFill();\n                        }}\n                    />\n                )}\n            </SceneActor>\n        </Container>\n    )\n}\n\nexport default memo(SceneAdventurer);\n","import React from \"react\";\nimport { Container } from \"@inlet/react-pixi\";\nimport { isActorObject, SceneObject } from \"store/types/scene\";\nimport SceneAdventurer from \"./SceneAdventurer\";\nimport { BaseSceneController } from \"mechanics/scenes/BaseSceneController\";\nimport { TiledObjectType } from \"utils/tilemap\";\nimport { Allegiance } from \"store/types/combat\";\nimport SceneActor from \"./SceneActor\";\n\ninterface Props {\n  objects: SceneObject[];\n  controller: BaseSceneController<unknown>;\n  selectedActorId: string;\n}\n\nconst ObjectSpriteLayer = (props: Props) => {\n    const { objects, controller } = props;\n\n    return (\n        <Container>\n            {objects.map((object) => {\n                const { location, name } = object;\n                const { adventurerId, spritesheet } = object.properties as { [key: string]: string};\n                switch (object.type) {\n                    case TiledObjectType.actor: {\n                        if (isActorObject(object)) {\n                            if (object.allegiance === Allegiance.player) {\n                                return (\n                                    <SceneAdventurer\n                                        location={location}\n                                        controller={controller}\n                                        adventurerId={adventurerId}\n                                        key={adventurerId}\n                                        spritesheetPath={spritesheet}\n                                        selected={props.selectedActorId === name }\n                                    />\n                                )\n                            }\n                            else if (object.allegiance === Allegiance.enemy) {\n                                return (\n                                    <SceneActor\n                                        name={object.name || \"\"}\n                                        controller={controller}\n                                        spritesheetPath={spritesheet}\n                                        location={location}\n                                        key={object.name}\n                                        idleAnimation={Math.random() < 0.5}\n                                        lookAt={[4, 3]}\n                                    />\n                                );\n                            }\n                        }\n                        break;\n                    }\n                    default:\n                        return null;\n                }\n                return null;\n            })}\n        </Container>\n    )\n}\n\nexport default ObjectSpriteLayer;","import React, { PropsWithChildren } from 'react';\nimport { TiledMapData, TiledLayerData, TiledLayerType } from 'constants/tiledMapData';\nimport { Container } from '@inlet/react-pixi';\nimport RectTileLayer from 'components/pixi/tile/RectTileLayer';\nimport * as PIXI from 'pixi.js';\nimport ObjectTileLayer from 'components/pixi/tile/ObjectTileLayer';\nimport { SceneObject } from 'store/types/scene';\nimport ObjectSpriteLayer from './ObjectSpriteLayer';\nimport { BaseSceneController } from 'mechanics/scenes/BaseSceneController';\nimport { Props as SceneProps } from \"./Scene\";\n\ninterface Props extends SceneProps {\n    basePath: string;\n    data: TiledMapData;\n    spritesheets: {[key: string]: PIXI.Spritesheet}\n    objects: SceneObject[];\n    controller: BaseSceneController<unknown>;\n}\n\nconst Tilemap = (props: PropsWithChildren<Props>) => {\n    const { data, objects, controller, spritesheets, selectedActorId } = props;\n\n    return (\n        <Container >\n            {data.layers\n                .filter(l => l.visible)\n                .map(layer => {\n                    if (layer.type === TiledLayerType.objectgroup) {\n                        const { tileObjects, spriteObjects} = getLayerObjects(objects, layer);\n                        return (\n                            <React.Fragment key={layer.name}>\n                                { !!tileObjects.length && (\n                                    <ObjectTileLayer\n                                        objects={tileObjects}\n                                        tilesets={data.tilesets || []}\n                                        spritesheets={spritesheets}\n                                    />\n                                )}\n                                { !!spriteObjects.length && (\n                                    <ObjectSpriteLayer\n                                        key={layer.name}\n                                        objects={spriteObjects || []}\n                                        controller={controller}\n                                        selectedActorId={selectedActorId}\n                                    />\n                                )}\n                            </React.Fragment>\n                        )\n                    }\n                    if (layer.type === TiledLayerType.tilelayer) {\n                        return (\n                            <RectTileLayer\n                                key={layer.name}\n                                layer={layer}\n                                horizontalTiles={data.width}\n                                tilesets={data.tilesets}\n                                spritesheets={spritesheets}\n                            />\n                        )\n                    }\n                    return null;\n                })\n            }\n        </Container>\n    );\n}\n\nexport default Tilemap;\n\nconst getLayerObjects = (objects: SceneObject[], layer: TiledLayerData) => {\n    return objects.reduce<{tileObjects: SceneObject[], spriteObjects: SceneObject[]}>((acc, value) => {\n        if (value.layerId === layer.id) {\n            if (value.gid !== undefined) {\n                acc.tileObjects.push(value);\n            } else if (value.properties.isSprite === true) {\n                acc.spriteObjects.push(value);\n            }\n        }\n        return acc;\n    }, { tileObjects: [], spriteObjects: [] });\n}\n","import React from \"react\";\nimport { ReactReduxContext, Provider } from 'react-redux';\nimport { Stage } from '@inlet/react-pixi';\n\n// Contexts are not passed through the reconcilers with the new Context API.\n// This means we lose the redux context\n// Create a wrapper component that consumes the context and provides it again in the new reconciler context:\n// https://github.com/inlet/react-pixi/issues/77\nconst BridgedStage = (props: React.ComponentProps<typeof Stage>) => {\n    const { children, ...restProps } = props;\n    return (\n        <ReactReduxContext.Consumer>\n            {({ store }) => (\n                <Stage {...restProps}>\n                    <Provider store={store}>\n                        {children}\n                    </Provider>\n                </Stage>\n            )}\n        </ReactReduxContext.Consumer>\n    );\n}\n\nexport default BridgedStage;\n","import { useState, useEffect } from \"react\";\nimport { loadResource } from \"utils/pixiJs\";\nimport { TiledTilesetData } from 'constants/tiledMapData';\nimport { SpritesheetData, SpriteData } from 'constants/spritesheetData';\n\nconst useTilesetsLoader = (basePath: string) => {\n    const [tileSpritesheets, setTilesets] = useState<{[key: string]: PIXI.Spritesheet}>({});\n    const [data, setData] = useState<TiledTilesetData[]>();\n\n    const loadTilesets = (value: TiledTilesetData[]) => {\n        setData(value);\n    };\n\n    useEffect(() => {\n        if (!data) return;\n        const nextTileset = nextTilesetToload(data, tileSpritesheets);\n        if (!nextTileset) return;\n\n        const tilesetName = nextTileset.name;\n\n        loadResource(`${basePath}/${nextTileset.image}`, (resource) => {\n            if (!resource) return;\n            if (resource.error) {\n                throw new Error(`Loading ${basePath}\\n${resource.error}`);\n            }\n            const spritesheetData = parseSpritesheetData(nextTileset);\n            const spritesheet = new PIXI.Spritesheet(resource.texture, spritesheetData);\n\n            spritesheet.parse(() => {\n                const newTilesets = {\n                    ...tileSpritesheets,\n                    [tilesetName]: spritesheet\n                }\n                setTilesets(newTilesets);\n            })\n        });\n    }, [data, basePath, tileSpritesheets]);\n\n    const loadComplete = !!data && nextTilesetToload(data, tileSpritesheets) === undefined;\n\n    return {\n        loadComplete,\n        loadTilesets,\n        tileSpritesheets\n    }\n}\n\nexport default useTilesetsLoader;\n\n// Returns a TiledTilesetData that has not been loaded into tilesetsTextures yet\nconst nextTilesetToload = (tilesets: TiledTilesetData[], tilesetsTextures: {[key: string]: PIXI.Spritesheet}) => {\n    return tilesets.find((t) => {\n        return !tilesetsTextures[t.name];\n    })\n}\n\n\nconst parseSpritesheetData = (tileset: TiledTilesetData): SpritesheetData => {\n    const columns = tileset.columns;\n\n    const frames: { [name: string]: SpriteData } = {};\n    for (let i = 0; i < tileset.tilecount; i++) {\n        const w = tileset.tilewidth;\n        const h = tileset.tileheight;\n        const x = (i % columns) * w;\n        const y = Math.floor(i / columns) * h;\n\n        frames[`${tileset.name}-${i + tileset.firstgid}`] = {\n            frame: {x, y, w, h},\n            spriteSourceSize: {x, y, w, h},\n            rotated: false,\n            trimmed: false,\n            sourceSize: { w, h}\n        };\n    }\n    const image = tileset.image;\n    const size = { w: tileset.imagewidth, h: tileset.imageheight };\n    return {\n        frames,\n        meta: {\n            image,\n            size,\n            scale: 1\n        }\n    };\n}\n","import React from 'react';\nimport \"./styles/loadingSpinner.scss\";\n\nconst LoadingSpinner = () => {\n    const rings = 5;\n    return (\n        <div className=\"loading-spinner\">\n        {[...Array(rings)].map((e, i) => (\n            <div className=\"ring\" key={i}>\n                <div className=\"inner\"/>\n            </div>\n        ))}\n        </div>\n    );\n}\nexport default LoadingSpinner;","import { useEffect, useRef } from \"react\";\r\n\r\nconst usePrevious = <T>(value: T): T|undefined => {\r\n    const ref = useRef<T>();\r\n    useEffect(() => {\r\n      ref.current = value;\r\n    }, [value]);\r\n    return ref.current;\r\n};\r\nexport default usePrevious;\r\n","import React, { createContext, PropsWithChildren, useState, useMemo, useEffect } from 'react';\nimport { useStore } from 'react-redux';\nimport { SceneControllerManager } from 'global/SceneControllerManager';\nimport { BaseSceneController } from 'mechanics/scenes/BaseSceneController';\nimport { StoreState } from 'store/types';\nimport LoadingSpinner from 'components/ui/loading/LoadingSpinner';\nimport usePrevious from 'hooks/usePrevious';\n\nexport const SceneControllerContext = createContext<BaseSceneController<unknown> | null>(null);\n\nexport interface Props {\n    questName: string;\n}\n\nconst SceneControllerContextProvider = (props: PropsWithChildren<Props>) => {\n    const {questName, children} = props;\n    const store = useStore<StoreState>();\n    const [loaded, setLoaded] = useState<boolean>(false);\n    const storeState = store.getState();\n    const quest = storeState.quests.find(q => q.name === questName)!;\n    const {scene, sceneName, questVars} = quest;\n    const previousQuestVars = usePrevious(questVars);\n\n    const controller = useMemo(() => {\n        if (!sceneName) {\n            return null;\n        }\n        return SceneControllerManager.getSceneController(questName, sceneName, store);\n    }, [questName, sceneName, store]);\n\n    useEffect(() => {\n        setLoaded(false);\n        if (sceneName && controller && !controller.dataLoading) {\n            const loadingComplete = () => {\n                setLoaded(true);\n\n                // If the store has no scene for this quest yet, create and store it!\n                if (!scene && controller) {\n                    controller.createScene();\n                    controller.sceneEntered();\n                }\n            }\n            controller.loadData(loadingComplete);\n        }\n    }, [controller, questName, scene, sceneName]);\n\n    useEffect(() => {\n        if (questVars !== previousQuestVars && controller) {\n            controller.updateScene();\n        }\n    }, [controller, previousQuestVars, questVars]);\n\n    if (controller && (controller.dataLoading || !loaded)) {\n        return (\n            <LoadingSpinner />\n        );\n    }\n    return (\n        <SceneControllerContext.Provider value={controller}>\n            {children}\n        </SceneControllerContext.Provider>\n    );\n};\n\nexport default SceneControllerContextProvider;","import React, { useMemo } from 'react';\n\ninterface Props {\n    position: \"w\" | \"sw\" | \"s\" | \"se\" | \"e\";\n    icon?: string;\n    activated: boolean;\n    onActivate?: () => void;\n    onDeactivate?: () => void;\n}\n\nconst Segment = (props: Props) => {\n    const {icon, onActivate, onDeactivate, activated} = props;\n    const segmentWidth = 32;\n    const segmentHeight = 46;\n    const tileHeight = 100;\n    const rot = useMemo(() => {\n        switch (props.position) {\n            case \"w\": return 180;\n            case \"sw\": return 135;\n            case \"s\": return 90;\n            case \"se\": return 45;\n            default: return 0;\n        }\n    }, [props.position]);\n\n    const scale = activated ? 'scale(1.2)' : '';\n    const style = {\n        transform: `translate(${segmentWidth}px, ${tileHeight/2 - segmentHeight/2}px) ${scale} rotate(${rot}deg) translateX(${activated ? 36 : 44}px)`,\n        background: `url(${process.env.PUBLIC_URL}/img/scene/ui/combat/ring-segment.svg)`,\n        width: segmentWidth,\n        height: segmentHeight,\n        ...(activated && { zIndex: 2})\n    }\n    // const rotate = true;\n    // useEffect(() => {\n    //     if (rotate){\n    //         setTimeout(() => {\n    //             console.log(rot)\n    //             setRot(rot + 1)\n    //         }, 3)\n    //     }\n\n    // }, [rot]);\n\n    return (\n        <div\n            style={style}\n            className=\"segment\"\n            onMouseOver={onActivate}\n            onMouseOut={onDeactivate}\n        >\n            <img\n                src={icon}\n                style={{\n                    transform: `rotate(-${rot}deg)`,\n                    width: segmentWidth - 4\n                }}\n                alt=\"\"\n            />\n        </div>\n    )\n}\n\nexport default Segment;\n\n\n","import { SceneControllerContext } from 'components/world/QuestPanel/context/SceneControllerContext';\nimport React, { useContext, useState } from 'react';\nimport { SceneActionType } from 'store/types/scene';\nimport { ActionIntent } from '../SceneUI';\nimport Segment from './Segment';\nimport \"./styles/combatUIWidget.scss\";\n\ninterface Props {\n    location: [number, number];\n    actionIntent?: ActionIntent;\n\n    onActionChange: (action?: SceneActionType) => void;\n}\n\n// CombatUIWidget shows a circle\nconst CombatUIWidget = (props: Props) => {\n    const {location, actionIntent, onActionChange} = props;\n    const controller = useContext(SceneControllerContext)!;\n    const {tileWidth, tileHeight} = controller.getTileDimensions();\n    const transform = `translate(${tileWidth * location[0]}px, ${tileHeight * location[1]}px)`;\n    const [collapsed, setCollapsed] = useState(true);\n\n    const handleMouseMove = (e: React.MouseEvent) => {\n        e.preventDefault();\n        e.stopPropagation();\n    }\n\n    const handleMouseOver = () => {\n        setCollapsed(false);\n    }\n\n    const handleMouseOut = () => {\n        // setCollapsed(true); // todo enable\n    }\n\n    const handleSegmentActivate = (action: SceneActionType) => {\n        onActionChange(action);\n\n        // const ap = controller.calculateWalkApCosts(location, location);\n\n    }\n\n    const handleSegmentDeactivate = (_action: SceneActionType) => {\n        onActionChange(undefined);\n        // setText(\"\") // todo enablee\n    }\n\n\n    return (\n        <div\n            className={`combat-ui-widget ${collapsed ? \"collapsed\" : \"expanded\"}`}\n            style={{ transform }}\n            onMouseMove={handleMouseMove}\n            onMouseOver={handleMouseOver}\n            onMouseOut={handleMouseOut}\n        >\n            <Segment\n                position=\"w\"\n                icon={`${process.env.PUBLIC_URL}/img/scene/ui/combat/icons/knife-thrust.svg`}\n                onActivate={() => handleSegmentActivate(SceneActionType.slash)}\n                onDeactivate={() => handleSegmentDeactivate(SceneActionType.slash)}\n                activated={actionIntent?.action === SceneActionType.slash}\n            />\n            <Segment\n                position=\"sw\"\n                icon={`${process.env.PUBLIC_URL}/img/scene/ui/combat/icons/high-shot.svg`}\n                activated={false}\n            />\n            <Segment\n                position=\"s\"\n                icon={`${process.env.PUBLIC_URL}/img/scene/ui/combat/icons/walking-boot.svg`}\n                onActivate={() => handleSegmentActivate(SceneActionType.move)}\n                onDeactivate={() => handleSegmentDeactivate(SceneActionType.move)}\n                activated={actionIntent?.action === SceneActionType.move}\n            />\n            <Segment position=\"se\" icon={`${process.env.PUBLIC_URL}/img/scene/ui/combat/icons/sunken-eye.svg`} activated={false}/>\n            <Segment position=\"e\" icon={`${process.env.PUBLIC_URL}/img/scene/ui/combat/icons/crosshair.svg`} activated={false}/>\n            <div className=\"info\" style={{ width: tileWidth }}>\n                {getText(actionIntent)}\n            </div>\n        </div>\n    )\n}\n\nexport default CombatUIWidget;\n\nconst getText = (actionIntent?: ActionIntent) => {\n    if (!actionIntent) return null;\n    if (actionIntent.action === SceneActionType.move) {\n        if (!actionIntent.path?.length) {\n            // no path possible\n            return null;\n        }\n        const insufficient = (actionIntent.actorAP || 0) < (actionIntent.apCost || 0);\n        return (\n            <>\n            <span>\n                Move\n            </span>\n            <span className={`${(insufficient) ? \"insufficient\": \"\"}`}>\n                {` ${actionIntent.apCost}`}AP\n            </span>\n            </>\n        );\n    }\n    if (actionIntent.action === SceneActionType.slash) {\n        if (!actionIntent.path?.length) {\n            // no path possible\n            return null;\n        }\n        const insufficient = (actionIntent.actorAP || 0) < (actionIntent.apCost || 0);\n        return (\n            <>\n            <span>\n                Slash\n            </span>\n            <span className={`${(insufficient) ? \"insufficient\": \"\"}`}>\n                {` ${actionIntent.apCost}`}AP\n            </span>\n            </>\n        );\n    }\n    return \"?\";\n}","import React from 'react';\nimport { SceneControllerContext } from 'components/world/QuestPanel/context/SceneControllerContext';\nimport { useContext } from 'react';\nimport { SceneActionType } from 'store/types/scene';\nimport \"./styles/normalUICursor.scss\";\n\ninterface Props {\n    location: [number, number];\n}\n\nconst NormalUICursor = (props: Props) => {\n    const {location} = props;\n    const controller = useContext(SceneControllerContext)!;\n\n    let blocked = controller.locationIsBlocked(location);\n    let action = SceneActionType.move;\n    if (blocked) {\n        // todo: can we have interactive tiles that are NOT blocking?\n        const object = controller.getObjectAtLocation(location);\n        if (object?.properties.interactive){\n            // We're at an interactive object\n            action = SceneActionType.interact;\n            blocked = false;\n        }\n    }\n    const {tileWidth, tileHeight} = controller.getTileDimensions();\n    const transform = `translate(${tileWidth * location[0]}px, ${tileHeight * location[1]}px)`;\n    const backgroundImage = images[action];\n    const width = tileWidth;\n    const height = tileHeight;\n    return (\n        <div\n            className={`normal-ui-cursor ${blocked ? \"invalid\" : \"\"}`}\n            style={{ transform, backgroundImage, width, height }}\n        />\n    )\n}\n\nexport default NormalUICursor;\n\nconst images = {\n    [SceneActionType.move]:  `url(${process.env.PUBLIC_URL}/img/scene/ui/combat/icons/walking-boot.svg)`,\n    [SceneActionType.interact]: `url(${process.env.PUBLIC_URL}/img/scene/ui/combat/icons/sunken-eye.svg)`\n}","import { SceneControllerContext } from 'components/world/QuestPanel/context/SceneControllerContext';\nimport { useQuest } from 'hooks/store/quests';\nimport React, { PropsWithChildren, useCallback, useContext, useEffect, useRef, useState } from 'react';\nimport { SceneActionType } from 'store/types/scene';\nimport { locationEquals } from 'utils/tilemap';\nimport CombatUIWidget from './CombatUIWidget';\nimport NormalUICursor from './NormalUICursor';\nimport \"./styles/sceneUI.scss\";\n\nexport interface Props {\n    sceneWidth: number;\n    sceneHeight: number;\n    selectedActorId: string;\n    actionIntent?: ActionIntent;\n\n    onMouseDown?: (location: [number, number]) => void;\n    onSetActionIntent: (intent?: ActionIntent) => void;\n}\n\nexport interface ActionIntent {\n    action: SceneActionType.move | SceneActionType.slash | SceneActionType.interact;\n    from: [number, number];\n    to: [number, number];\n    apCost?: number;\n    actorAP?: number;\n    path?: [number, number][];  // is undefined when path is invalid\n}\n\n// This thing scales itself based on the canvas which should be a sibling of this component\nconst SceneUI = (props: PropsWithChildren<Props>) => {\n    const {\n        children,\n        selectedActorId,\n        actionIntent,\n        sceneWidth,\n        sceneHeight,\n        onMouseDown,\n        onSetActionIntent\n    } = props;\n    const ref = useRef<HTMLDivElement>(null);\n    const mouseDown = useRef(false);\n    const scale = useRef(1);\n    const controller = useContext(SceneControllerContext)!;\n    const quest = useQuest(controller.questName);\n    const scene = quest.scene!;\n    const {combat} = scene;\n    const [cursorLocation, setCursorLocation] = useState<[number, number]>();\n\n    useEffect(() => {\n        // Scale the html element together with the sibling canvas\n        const handleResize = () => {\n            if (!ref.current) return;\n            const canvas = ref.current.parentNode?.querySelector(\"canvas\");\n            if (!canvas) throw Error(\"No canvas found as sibling of SceneUI\");\n\n            const currentWidth = canvas?.clientWidth;\n            scale.current = currentWidth/sceneWidth;\n            ref.current.style.transform = `scale(${scale.current})`;\n            ref.current.style.width = `${sceneWidth}px`;\n            ref.current.style.height = `${sceneHeight}px`;\n        }\n        window.addEventListener(\"resize\", handleResize);\n        handleResize();\n        return () => {\n            window.removeEventListener(\"resize\", handleResize);\n        };\n    }, [sceneHeight, sceneWidth]);\n\n    const handleMouseMove = (e: React.MouseEvent<HTMLDivElement>) => {\n        if (mouseDown.current) {\n            const location = findLocation(e);\n\n            if (controller.locationIsOutOfBounds(location)) {\n                setCursorLocation(undefined);\n                onSetActionIntent(undefined);\n                return;\n            }\n            if (!cursorLocation || !locationEquals(location, cursorLocation)){\n                setCursorLocation(location);\n            }\n        }\n    }\n\n    const handleMouseDown = (e: React.MouseEvent<HTMLDivElement>) => {\n        const location = findLocation(e);\n        onMouseDown?.(location);\n        mouseDown.current = true;\n    }\n\n    const handleMouseUp = (_e: React.MouseEvent<HTMLDivElement>) => {\n        mouseDown.current = false;\n\n        setCursorLocation(undefined); // todo: uncomment to debug\n        if (!actionIntent) {\n            return\n        }\n        const selectedActorLocation = controller.getSceneActor(selectedActorId)!.location;\n        if (selectedActorLocation && cursorLocation && !locationEquals(selectedActorLocation, cursorLocation)){\n            controller.actorAttemptAction(selectedActorId, actionIntent.action, actionIntent.to);\n        }\n        onSetActionIntent?.(undefined);\n    }\n\n    const handleCombatActionChange = useCallback((action?: SceneActionType) => { // todo: beter name, not just combat\n        if (!action) {\n            onSetActionIntent(undefined);\n            return;\n        }\n        const {\n            location: from = [0, 0],\n            ap: actorAP,\n        } = controller.getSceneActor(selectedActorId)!;\n        const to = cursorLocation!;\n\n        switch (action){\n            case SceneActionType.move:\n            case SceneActionType.slash: {\n                const path = controller.findPath(from, to);\n                const apCost = combat ? controller.calculateWalkApCosts(from, to) : undefined;\n                onSetActionIntent({\n                    action,\n                    from,\n                    to,\n                    apCost,\n                    actorAP,\n                    path,\n                })\n            }\n            break;\n            case SceneActionType.interact: {\n                const path = controller.findPathNearest(from, to, true);\n                const apCost = 0; // can only inspect out of combat?\n                onSetActionIntent({\n                    action,\n                    from,\n                    to,\n                    apCost,\n                    actorAP,\n                    path,\n                })\n            }\n        }\n    }, [combat, controller, cursorLocation, onSetActionIntent, selectedActorId]);\n\n    useEffect(() => {\n        if (!combat && cursorLocation !== undefined) {\n            // Handle change of cursor when not in combat\n            let action = SceneActionType.move;\n            const object = controller.getObjectAtLocation(cursorLocation);\n            if(object?.properties.interactive){\n                // We're at an interactive object\n                action = SceneActionType.interact;\n            }\n            handleCombatActionChange(action);\n        }\n    }, [cursorLocation, handleCombatActionChange, combat, controller])\n\n\n    const findLocation = (e: React.MouseEvent) => {\n        if (e.target instanceof Element){\n            const rect = (e.target).getBoundingClientRect();\n            const x = (e.clientX - rect.left) / scale.current;\n            const y = (e.clientY - rect.top) / scale.current;\n            return controller.pointToSceneLocation(new PIXI.Point(x, y));\n        }\n        throw new Error(\"You didnt give me the correct event\")\n    }\n\n    return (\n        <div\n            ref={ref}\n            className=\"scene-ui\"\n            onMouseMove={handleMouseMove}\n            onMouseDown={handleMouseDown}\n            onMouseUp={handleMouseUp}\n        >\n            {children}\n            {!scene.combat && cursorLocation && (\n                <NormalUICursor location={cursorLocation} />\n            )}\n            {scene.combat && cursorLocation && (\n                <CombatUIWidget\n                    location={cursorLocation}\n                    actionIntent={actionIntent}\n                    onActionChange={handleCombatActionChange}\n                />\n            )}\n        </div>\n    )\n}\n\nexport default SceneUI;","import { PixiComponent, applyDefaultProps, Graphics } from \"@inlet/react-pixi\";\nimport * as PIXI  from 'pixi.js';\n\ninterface Props  {\n    points?: PIXI.Point[];\n    style?:  Partial<PIXI.LineStyle>;\n    dash?: number;\n    gap?: number;\n    speed?: number; // positive to move forward, negative to move backward, 0 to not move at all\n}\n\ninterface InternalDashedLine {\n    _destroy: boolean;\n    _raf: number;\n}\n\n/**\n * Draws a dashed line along a path\n */\nconst DashedLine = PixiComponent<React.ComponentProps<typeof Graphics> & Props, PIXI.Graphics>(\"DashedLine\", {\n    create() {\n        return new PIXI.Graphics();\n    },\n\n    applyProps(instance, oldProps: Props, newProps: Props) {\n        const {\n            points = [],\n            dash = 10,\n            gap = 5,\n            speed = 40,\n            style,\n            ...newP\n        } = newProps;\n\n        // apply rest props to PIXI.Graphics\n        applyDefaultProps(instance, oldProps, newP);\n        instance.clear();\n\n        const draw = () => {\n            if((this as unknown as InternalDashedLine)._destroy){\n                return;\n            }\n\n            instance.clear();\n            instance.lineStyle(style?.width, style?.color, style?.alpha, style?.alignment, style?.native);\n            const offsetPercentage = (Date.now() % (10000/speed) + 1) / Math.abs(10000/speed);\n\n            let dashLeft = 0;\n            let gapLeft = 0;\n            if (offsetPercentage > 0) {\n                const progressOffset = (dash + gap) * offsetPercentage * (speed < -1 ? 1 : -1) ;\n                if (progressOffset < dash) {\n                    dashLeft = dash - progressOffset;\n                } else {\n                    gapLeft = gap - (progressOffset - dash);\n                }\n            }\n            const rotatedpoints = [];\n            for (const point of points) {\n                const p = point.clone();\n                const cosAngle = Math.cos(instance.rotation);\n                const sinAngle = Math.sin(instance.rotation);\n                const dx = p.x;\n                const dy = p.y;\n                p.x = (dx * cosAngle - dy * sinAngle);\n                p.y = (dx * sinAngle + dy * cosAngle);\n                rotatedpoints.push(p);\n            }\n\n            for (let i = 0; i < rotatedpoints.length - 1; i++) {\n                const p1 = rotatedpoints[i];\n                const p2 = rotatedpoints[i + 1];\n                const dx = p2.x - p1.x;\n                const dy = p2.y - p1.y;\n                const len = Math.sqrt(dx * dx + dy * dy);\n                const normal = {\n                    x: dx / len,\n                    y: dy / len\n                };\n                let progressOnLine = 0;\n\n                instance.moveTo(p1.x + gapLeft * normal.x, p1.y + gapLeft * normal.y);\n                while (progressOnLine <= len) {\n                    progressOnLine += gapLeft;\n                    if (dashLeft > 0) {\n                        progressOnLine += dashLeft;\n                    } else {\n                        progressOnLine += dash;\n                    }\n                    if (progressOnLine > len) {\n                        dashLeft = progressOnLine - len;\n                        progressOnLine = len;\n                    } else {\n                        dashLeft = 0;\n                    }\n                    instance.lineTo(p1.x + progressOnLine * normal.x, p1.y + progressOnLine * normal.y);\n                    progressOnLine += gap;\n                    if (progressOnLine > len && dashLeft === 0) {\n                        gapLeft = progressOnLine - len;\n                    } else {\n                        gapLeft = 0;\n                        instance.moveTo(p1.x + progressOnLine * normal.x, p1.y + progressOnLine * normal.y);\n                    }\n                }\n            }\n            if (speed !== 0) {\n                (this as unknown as InternalDashedLine)._raf = requestAnimationFrame(draw);\n            }\n        }\n        draw();\n    },\n\n    willUnmount() {\n        (this as unknown as InternalDashedLine)._destroy = true;\n        cancelAnimationFrame((this as unknown as InternalDashedLine)._raf);\n    }\n});\n\nexport default DashedLine;","import DashedLine from 'components/pixi/DashedLine';\nimport React from 'react';\nimport { SceneActionType } from 'store/types/scene';\nimport { ActionIntent } from './ui/SceneUI'\n\nexport interface Props {\n  actionIntent: ActionIntent;\n  tileWidth: number;\n  tileHeight: number;\n}\n\nconst ActionPreview = (props: Props) => {\n  const {actionIntent, tileWidth, tileHeight} = props;\n\n  switch (actionIntent.action){\n    case SceneActionType.move:\n    case SceneActionType.interact:\n    case SceneActionType.slash: {\n      if (!actionIntent.path){\n        return null;\n      }\n      const convert = (p: number[]) => new PIXI.Point(p[0] * (tileWidth) + (tileWidth / 2), p[1] * (tileHeight) + (tileHeight / 2));\n      const converted = [\n          convert(actionIntent.from),\n          ...actionIntent.path.map(p => convert(p))\n      ];\n      const valid = (!actionIntent.apCost) || actionIntent.apCost <= (actionIntent.actorAP || 0);\n\n      return (\n        <DashedLine\n          points={converted}\n          dash={10}\n          gap={15}\n          speed={20}\n          rotation={0}\n          style={{\n            width: 6,\n            color: valid ? 0xffffff : 0x8b0000,\n            alpha: 1,\n          }}\n        />)\n    }\n    default:\n      return null;\n  }\n}\n\nexport default ActionPreview;","import { useMemo } from 'react';\nimport { StoreState } from 'store/types';\nimport { useSelector } from 'react-redux';\nimport { LogChannel, LogEntry } from 'store/types/logEntry';\nimport { createSelector } from 'reselect';\n\nconst getLog = (state: StoreState) => state.log;\n\n// Returns the game log from redux store\nexport const useLog = () => {\n    const log = useSelector<StoreState, LogEntry[]>(store => store.log);\n    return log;\n}\n\nexport const useQuestLog = (questId: string) => {\n    const selectMemoized = useMemo(() => {\n        const selectQuestLogEntries = createSelector(\n            [getLog],\n            (log: LogEntry[]) => { return log.filter((l) => l.channel === LogChannel.quest && l.channelContext === questId) }\n        )\n        return selectQuestLogEntries;\n    }, [questId]);\n\n    return useSelector<StoreState, LogEntry[]>(selectMemoized);\n}\n\n","import { useEffect } from 'react';\nimport { useQuestLog } from 'hooks/store/useLog';\n\ninterface Props {\n    questId: string;\n}\n\nconst SceneLog = (props: Props) => {\n    const log = useQuestLog(props.questId);\n    useEffect(() => {\n        const lastLog = log.shift();\n        if ((lastLog?.time || 0) > Date.now() - 1000) {\n            // console.log(lastLog?.key)\n        }\n    }, [log]);\n    return null;\n}\n\nexport default SceneLog;","import React, { useRef, useEffect, useContext, useState } from \"react\";\nimport { Container, Graphics } from '@inlet/react-pixi';\nimport { useQuestScene } from 'hooks/store/quests';\nimport Tilemap from './Tilemap';\nimport BridgedStage from 'components/pixi/util/BridgedStage';\nimport useTilesetsLoader from 'hooks/useTilesetsLoader';\nimport { SceneControllerContext } from '../../context/SceneControllerContext';\nimport SceneUI, { ActionIntent } from './ui/SceneUI';\nimport ActionPreview from './ActionPreview';\nimport { isAdventurer } from \"store/types/scene\";\nimport SceneLog from \"./SceneLog\";\nimport \"./styles/scene.scss\";\n\nexport interface Props {\n    selectedActorId: string;\n    setSelectedActor: (id: string) => void;\n}\n\nconst DEBUG_ACTIONQUEUE = false;\nconst DEBUG_BLOCKEDTILES = false;\n\nconst Scene = (props: Props) => {\n    const {selectedActorId, setSelectedActor } = props;\n    const controller = useContext(SceneControllerContext)!;\n    const mapData = controller.mapData!;\n    const basePath = controller.basePath!;\n\n    const {\n        loadComplete,\n        loadTilesets,\n        tileSpritesheets\n    } = useTilesetsLoader(basePath);\n\n    const ref = useRef<HTMLDivElement>(null);\n    const scene = useQuestScene(controller.questName);\n    const {tileWidth, tileHeight} = controller.getTileDimensions();\n    const [currentActionIntent, setCurrentActionIntent] = useState<ActionIntent>();\n\n    useEffect(() => {\n        if (!mapData) return;\n        loadTilesets(mapData.tilesets);\n    }, [loadTilesets, mapData]);\n\n    const handleUIMouseDown = (location: [number, number]) => {\n        const actor = controller.getObjectAtLocation(location);\n        if (actor && isAdventurer(actor) && actor?.name) {\n            // We can click on adventurers\n            props.setSelectedActor(actor.name);\n        }\n    }\n\n    if (!loadComplete || !mapData || !scene) {\n        return <div>loading scene...</div>\n    }\n\n    const sceneWidth = mapData.width * mapData.tilewidth;\n    const sceneHeight = mapData.height * mapData.tileheight;\n    return (\n        <div className=\"scene\" ref={ref}>\n            <BridgedStage width={sceneWidth} height={sceneHeight} >\n                <Container\n                    interactive={true}\n                    hitArea={new PIXI.Rectangle(0, 0, sceneWidth, sceneHeight)}\n                >\n                    <Tilemap\n                        basePath={basePath}\n                        data={mapData}\n                        spritesheets={tileSpritesheets}\n                        objects={scene.objects}\n                        controller={controller}\n                        selectedActorId={selectedActorId}\n                        setSelectedActor={setSelectedActor}\n                    />\n                    { currentActionIntent && (<ActionPreview actionIntent={currentActionIntent} tileWidth={tileWidth} tileHeight={tileHeight}/>)}\n                    {DEBUG_BLOCKEDTILES && (\n                        <Graphics\n                            name=\"selectioncircle\"\n                            draw={graphics => {\n                                const line = 3;\n                                for (let y = 0; y < mapData.height; y++) {\n                                    for (let x = 0; x < mapData.width; x++) {\n                                        const blocked = controller.locationIsBlocked([x, y]);\n\n                                        if (blocked) {\n                                            graphics.lineStyle(line, 0xFF0000);\n                                        } else {\n                                            graphics.lineStyle(line, 0xFFFFFF);\n                                        }\n                                        graphics.drawRect(x * tileWidth, y * tileHeight, tileWidth, tileHeight);\n                                        graphics.endFill();\n                                    }\n                                }\n                            }}\n                        />\n                    )}\n                </Container>\n            </BridgedStage>\n            {DEBUG_ACTIONQUEUE && (\n                <div style={{ position: 'absolute', bottom: 0}}>\n                    <h2>ActionQueue</h2>\n                    <ul>\n                        {scene.actionQueue && scene.actionQueue.map((action) => (\n                            <li key={JSON.stringify(action)}>{JSON.stringify(action)}</li>\n                        ))}\n                    </ul>\n                </div>\n            )}\n            <SceneUI\n                sceneWidth={sceneWidth}\n                sceneHeight={sceneHeight}\n                selectedActorId={selectedActorId}\n                actionIntent={currentActionIntent}\n                onMouseDown={handleUIMouseDown}\n                onSetActionIntent={setCurrentActionIntent}\n            />\n            <SceneLog questId={controller.questName} />\n        </div>\n    );\n}\n\nexport default Scene;\n","import React from 'react';\nimport { useQuest } from 'hooks/store/quests';\nimport { getDefinition } from 'definitions/quests';\nimport { QuestDefinition } from 'definitions/quests/types';\nimport { TextManager } from 'global/TextManager';\nimport './styles/onTheRoad.scss';\n\nexport interface Props {\n    questName: string;\n}\n\n/* Shows the most recent log on a questnode */\nconst OnTheRoad = (props: Props) => {\n    const quest = useQuest(props.questName);\n    const questDefinition: QuestDefinition = getDefinition(quest.name);\n    let progress: number = Math.floor(quest.progress);\n    do {\n        const log = questDefinition.nodes[progress].log;\n        if (log) {\n            return (\n                <div>\n                    <p>{`${TextManager.get(log)}`}</p>\n                </div>\n            )\n        }\n        progress--;\n    } while (progress >= 0);\n    return <h1 className=\"on-the-road questname\">{TextManager.getQuestTitle(quest.name)}</h1>;\n}\n\nexport default OnTheRoad;","import React from 'react';\nimport Scene from 'components/world/QuestPanel/QuestDetails/scene/Scene';\nimport { useQuest } from 'hooks/store/quests';\nimport OnTheRoad from './OnTheRoad';\n\nexport interface Props {\n    questName: string;\n    selectedActorId: string;\n    setSelectedActor: (id: string) => void;\n}\n\nconst QuestDetails = (props: Props) => {\n    const quest = useQuest(props.questName);\n\n    if (!quest.sceneName) {\n        return <OnTheRoad questName={props.questName} />;\n    }\n    return (\n        <Scene {...props} />\n    );\n}\n\nexport default QuestDetails;","import * as React from \"react\";\r\nimport { IconSize } from 'components/ui/common/Icon';\r\nimport { DragSourceType, DragType } from \"constants/dragging\";\r\nimport { Item } from \"definitions/items/types\";\r\nimport ItemIcon from \"./ItemIcon\";\r\nimport { ConnectDragSource, DragSource, DragSourceConnector, DragSourceMonitor, DragSourceSpec } from \"react-dnd\";\r\n\r\nexport interface Props {\r\n    index: number;\r\n    item: Item;\r\n    sourceType: DragSourceType;\r\n    sourceId?: string;\r\n    size?: IconSize;\r\n    onClick?: (event: React.MouseEvent) => void;\r\n}\r\n\r\ninterface CollectedProps {\r\n    isDragging: boolean;\r\n    connectDragSource: ConnectDragSource;\r\n}\r\n\r\nexport interface InventoryItemDragInfo {\r\n    item: Item;\r\n    inventorySlot?: number;\r\n    sourceId?: string;\r\n    sourceType: DragSourceType;\r\n}\r\n\r\n/**\r\n * Specifies the drag source contract.\r\n * Only `beginDrag` function is required.\r\n */\r\nconst source: DragSourceSpec<Props, InventoryItemDragInfo> = {\r\n    beginDrag(props: Props) {\r\n        // Return the data describing the dragged item\r\n        return {\r\n            inventorySlot: props.index,\r\n            item: props.item,\r\n            sourceId: props.sourceId,\r\n            sourceType: props.sourceType,\r\n        };\r\n    },\r\n};\r\n\r\n/**\r\n * Specifies which props to inject into your component.\r\n */\r\nfunction collect(connect: DragSourceConnector, monitor: DragSourceMonitor) {\r\n    return {\r\n        connectDragSource: connect.dragSource(),\r\n        isDragging: monitor.isDragging(),\r\n    };\r\n}\r\n\r\nconst DraggableItemIcon = (props: Props & CollectedProps) => {\r\n\r\n    const { item, onClick, isDragging, connectDragSource, size } = props;\r\n    const handleClick = (event: React.MouseEvent) => {\r\n        if (onClick) {\r\n            onClick(event);\r\n        }\r\n    };\r\n    if (isDragging) {\r\n        // TODO: can show some sort of empty state?\r\n        return null;\r\n    }\r\n    // The wrapping div is needed by ReactDnD\r\n    return connectDragSource((\r\n        <div>\r\n            <ItemIcon\r\n                item={item}\r\n                onClick={handleClick}\r\n                size={size}\r\n            />\r\n        </div>\r\n    ));\r\n}\r\n\r\nexport default DragSource<Props, CollectedProps>(DragType.ITEM, source, collect)(DraggableItemIcon);\r\n","import { Item } from \"definitions/items/types\";\nimport * as React from \"react\";\nimport { TextManager } from \"global/TextManager\";\nimport { DragSourceType } from 'constants/dragging';\nimport DraggableItemIcon from '../DraggableItemIcon';\nimport \"./styles/itemsList.scss\";\n\nexport interface Props {\n    className?: string;\n    items: Item[];\n    sourceType: DragSourceType;\n    sourceId?: string;\n}\n\n/**\n * The ItemsList displays a list of items vertically. Shows icon and description\n */\nconst DraggableItemsList = (props: Props) => {\n    const className = (props.className || \"\")+ \" items-list\";\n\n    return (\n        <ul className={className} >\n            {props.items.map((item, index)=> (\n                <li\n                    key={`${item}${index}`}\n                    className=\"item\"\n                >\n                    <DraggableItemIcon\n                        item={item}\n                        index={index}\n                        sourceId={props.sourceId}\n                        sourceType={props.sourceType}\n                    />\n                    <div className=\"text\">\n                        <p className=\"name\">{TextManager.getItemName(item)}</p>\n                        <p className=\"subtext\">{TextManager.getItemSubtext(item)}</p>\n                    </div>\n                </li>\n            ))}\n        </ul>\n    );\n};\n\nexport default DraggableItemsList;\n","import { AdventurerStoreState } from 'store/types/adventurer';\nimport { QuestStoreState, QuestStatus } from 'store/types/quest';\nimport { StoreState } from 'store/types';\nimport { useSelector } from 'react-redux';\nimport { useMemo, useCallback } from 'react';\nimport { EquipmentSlotType } from 'components/ui/adventurer/EquipmentSlot';\nimport { Item } from 'definitions/items/types';\nimport { getDefinition } from 'definitions/items/apparel';\n\nconst getAdventurersInTown = (adventurers: AdventurerStoreState[], quests: QuestStoreState[]): AdventurerStoreState[] => {\n    // Get an array of all adventurer ids on any active quest\n    const adventurersOnQuest = quests.reduce<string[]>((acc, val: QuestStoreState) => {\n        if (val.status === QuestStatus.active) {\n            acc.push(...val.party);\n        }\n        return acc;\n    }, []);\n\n    return adventurers.filter((a) => adventurersOnQuest.indexOf(a.id) === -1);\n};\n\n/** Returns all the adventurers currently not on a mission */\nexport const useAdventurersInTown = () => {\n    const adventurers = useSelector<StoreState, AdventurerStoreState[]>(store => store.adventurers);\n    const quests = useSelector<StoreState, QuestStoreState[]>(store => store.quests);\n\n    const adventurersInTown = useMemo(() => {\n        return getAdventurersInTown(adventurers, quests)\n    }, [adventurers, quests]);\n\n    return adventurersInTown;\n}\n\n/** Returns the adventurer from store */\nexport const useAdventurerState = (adventurerId: string) => {\n    const adventurerSelector = useCallback(\n        (state: StoreState) => state.adventurers.find((q) => q.id === adventurerId)!,\n        [adventurerId]\n    );\n    return useSelector<StoreState, AdventurerStoreState>(adventurerSelector);\n}\n\n/* Returns a map keyed by EquipmentSlotType with DR of an adventurer.\n   0 if nothing worn or if item does not have DR */\nexport const useAdventurerDamageReduction = (adventurerId: string): { [key: string]: number } => {\n    const adventurer = useAdventurerState(adventurerId);\n    const findDR = (type: EquipmentSlotType) => {\n        const item: Item|undefined = adventurer.equipment[type as EquipmentSlotType];\n        if (!item) return 0;\n        return getDefinition(item).damageReduction || 0;\n    }\n    return {\n        [EquipmentSlotType[EquipmentSlotType.head]]: findDR(EquipmentSlotType.head),\n        [EquipmentSlotType[EquipmentSlotType.chest]]: findDR(EquipmentSlotType.chest),\n        [EquipmentSlotType[EquipmentSlotType.hands]]: findDR(EquipmentSlotType.hands),\n        [EquipmentSlotType[EquipmentSlotType.shoulders]]: findDR(EquipmentSlotType.shoulders),\n        [EquipmentSlotType[EquipmentSlotType.legs]]: findDR(EquipmentSlotType.legs),\n        [EquipmentSlotType[EquipmentSlotType.feet]]: findDR(EquipmentSlotType.feet),\n    }\n}\n\n\n\n","import React, { useRef, useContext } from \"react\";\nimport gsap from 'gsap';\nimport DraggableItemsList from 'components/ui/items/DraggableItemsList';\nimport { TextManager } from 'global/TextManager';\nimport AdventurerAvatar from 'components/ui/adventurer/AdventurerAvatar';\nimport { DragSourceType } from 'constants/dragging';\nimport { SceneControllerContext } from '../../context/SceneControllerContext';\nimport { useAdventurerState } from 'hooks/store/adventurers';\nimport Button from 'components/ui/buttons/Button';\nimport { adventurerFreeInventorySlots } from 'store/helpers/storeHelpers';\nimport Icon from 'components/ui/common/Icon';\nimport \"../styles/lootCache.scss\";\nimport \"../styles/modal.scss\";\n\ninterface Props {\n    cacheName: string;\n    adventurerId: string;\n    onClose: () => void;\n}\n\nconst LootCache = (props: Props) => {\n    const controller = useContext(SceneControllerContext)!;\n    const adventurer = useAdventurerState(props.adventurerId);\n    const freeSlots = adventurerFreeInventorySlots(adventurer);\n    const ref = useRef<HTMLDivElement>(null);\n    const cache = controller.getLootCache(props.cacheName);\n\n    if (!cache) {\n        return null;\n    }\n\n    const handleTakeGold = (e: React.MouseEvent) => {\n        e.stopPropagation();\n        // todo: animate gold flying away\n\n        controller.takeGoldFromCache(props.cacheName);\n    }\n\n    const handleTakeAllItems = (e: React.MouseEvent) => {\n        e.stopPropagation();\n        ref.current!.querySelectorAll(\".items-list .item\").forEach((el, index) => {\n            if (index >= freeSlots) return;\n            el.classList.add(\"taking\");\n        });\n        gsap.to(\".items-list .item.taking\", {\n            right: \"-100%\",\n            stagger: {\n              each: 0.1,\n              ease: \"power2.inOut\",\n            },\n            onComplete: () => {\n                for (let i = 0; i < freeSlots; i++) {\n                    controller.takeItemFromCache(0, props.cacheName, props.adventurerId);\n                }\n            }\n        });\n    }\n    return (\n        <div className={`interaction-modal loot-cache`} ref={ref}>\n            <div className=\"header\">\n                <div className=\"title\">\n                    {TextManager.get(cache.title, { adventurer: adventurer.name })}\n                </div>\n                <div className=\"close\" onClick={props.onClose} />\n            </div>\n            { cache.items.length > 0 && (\n                <div className=\"content\">\n                    <div className=\"items\">\n                        <DraggableItemsList\n                            items={cache.items}\n                            sourceType={DragSourceType.lootCache}\n                            sourceId={props.cacheName}\n                        />\n                    </div>\n                    <div className=\"adventurer\">\n                        <AdventurerAvatar adventurer={adventurer}/>\n                        <Button onClick={handleTakeAllItems} disabled={freeSlots === 0} size=\"small\">\n                            {TextManager.get(\"quest-common-loot-cache-take-all\")}\n                        </Button>\n                    </div>\n                </div>\n            )}\n            { !!cache.gold && (\n                <div className=\"content\">\n                    <div className=\"gold\">\n                        <Icon\n                            image=\"img/resources/gold.png\"\n                            size=\"medium\"\n                        />\n                        {TextManager.get(\"quest-common-loot-cache-gold\", { gold: cache.gold })}\n                    </div>\n                    <div className=\"take-gold\">\n                        <Button onClick={handleTakeGold} size=\"small\">\n                            {TextManager.get(\"quest-common-loot-cache-take\")}\n                        </Button>\n                    </div>\n                </div>\n            )}\n        </div>\n    )\n}\n\nexport default LootCache;","import React, { MouseEvent, useRef, useContext } from \"react\";\nimport { TextManager } from 'global/TextManager';\nimport { SceneControllerContext } from '../../context/SceneControllerContext';\nimport Button from 'components/ui/buttons/Button';\nimport \"../styles/situation.scss\";\nimport \"../styles/modal.scss\";\n\ninterface Props {\n    situation: string;\n    adventurerId: string;\n    onClose: () => void;\n}\n\nconst Situation = (props: Props) => {\n    const controller = useContext(SceneControllerContext)!;\n    const ref = useRef<HTMLDivElement>(null);\n    const situation = controller.getSituation(props.situation, props.adventurerId);\n    if (!situation) return null;\n\n    const { title, choices, text } = situation;\n    const handleChoiceClick = (e: MouseEvent<HTMLButtonElement>) => {\n        const choice = e.currentTarget.getAttribute('data-option')!;\n        controller.handleSituationOptionClick(props.situation, choice, props.adventurerId);\n        e.stopPropagation();\n    }\n\n    const handleClose = (e: MouseEvent<HTMLDivElement>) => {\n        props.onClose();\n        e.stopPropagation();\n    }\n    return (\n        <div className={`interaction-modal situation`} ref={ref}>\n            <div className=\"header\">\n                <div className=\"title\">\n                    {TextManager.get(title)}\n                </div>\n                <div className=\"close\" onClick={handleClose} />\n            </div>\n            <div className=\"content\">\n            { text && (<div className=\"text\">{TextManager.get(text)}</div>)}\n            { choices?.map(choice => (\n                <Button key={choice} data-option={choice} onClick={handleChoiceClick}>{TextManager.get(choice)}</Button>\n            ))}\n        </div>\n        </div>\n    )\n}\n\nexport default Situation;","import React, { useContext } from \"react\";\nimport { useSelector } from 'react-redux';\nimport { createSelectAdventurersOnQuest } from 'store/selectors/adventurers';\nimport { SceneControllerContext } from '../context/SceneControllerContext';\nimport AdventurerAvatar from 'components/ui/adventurer/AdventurerAvatar';\nimport { TextManager } from 'global/TextManager';\nimport Button from 'components/ui/buttons/Button';\nimport { IconSize } from 'components/ui/common/Icon';\nimport \"./styles/combatBar.scss\";\n\ninterface Props {\n    questName: string;\n    selectedAdventurerId?: string;\n}\n\nconst CombatBar = (props: Props) => {\n    const {selectedAdventurerId} = props;\n    const adventurers = useSelector(createSelectAdventurersOnQuest(props.questName));\n    const controller = useContext(SceneControllerContext)!;\n\n    return (\n        <div className=\"combat-bar\">\n            <div className=\"title\">\n                {TextManager.get(\"ui-combat-bar-title\")}\n            </div>\n            <div className=\"adventurers\">\n                {adventurers.map(a => (\n                    <div key={a.id} className={`adventurer ${selectedAdventurerId === a.id ? \"selected\" : \"\"}`}>\n                        <AdventurerAvatar adventurer={a} size={IconSize.smallest}/>\n                        <div className=\"ap\">\n                            {controller.getSceneActor(a.id)?.ap || 0} AP\n                        </div>\n                    </div>\n                ))}\n            </div>\n            <Button size=\"small\">End turn</Button>\n        </div>\n    )\n}\n\nexport default CombatBar;\n","import * as React from \"react\";\r\nimport { PropsWithChildren } from 'react';\r\nimport { DragSourceType, DragType } from \"constants/dragging\";\r\nimport { Item } from \"definitions/items/types\";\r\nimport { ConnectDropTarget, DropTarget, DropTargetConnector, DropTargetMonitor, DropTargetSpec } from \"react-dnd\";\r\nimport { InventoryItemDragInfo } from '../items/DraggableItemIcon';\r\nimport { IconSize } from '../common/Icon';\r\nimport { itemAndEquipmentSlotMatch } from '../adventurer/EquipmentSlot';\r\n\r\nconst dropTarget: DropTargetSpec<Props> = {\r\n    drop(props: Props, monitor: DropTargetMonitor) {\r\n        props.onDrop(monitor.getItem());\r\n    },\r\n    canDrop(props: Props, monitor: DropTargetMonitor) {\r\n        const dragInfo: InventoryItemDragInfo = monitor.getItem();\r\n        if (dragInfo.sourceType === DragSourceType.adventurerEquipment) {\r\n            return props.item == null || itemAndEquipmentSlotMatch(props.item, dragInfo.inventorySlot!);\r\n        }\r\n        return true;\r\n    },\r\n};\r\n\r\nexport interface Props {\r\n    item: Item | null;\r\n    onDrop: (info: InventoryItemDragInfo) => void;\r\n    size?: IconSize;\r\n}\r\n\r\nexport interface DropSourceProps {\r\n    canDrop: boolean;\r\n    isOver: boolean;\r\n    connectDropTarget: ConnectDropTarget;\r\n}\r\n\r\nconst collect = (connect: DropTargetConnector, monitor: DropTargetMonitor) => ({\r\n    canDrop: monitor.canDrop(),\r\n    connectDropTarget: connect.dropTarget(),\r\n    isOver: monitor.isOver(),\r\n});\r\n\r\n/**\r\n * The InventorySlot displays a slot in which an item can be placed.\r\n */\r\nconst InventorySlot = (props: PropsWithChildren<Props> & DropSourceProps) => {\r\n    const {\r\n        isOver,\r\n        canDrop,\r\n        connectDropTarget,\r\n    } = props;\r\n    const isActive = isOver && canDrop;\r\n\r\n    const classNames = [\r\n        \"inventory-item\",\r\n    ];\r\n\r\n    if (isActive) {\r\n        classNames.push(\"drop-active\");\r\n    } else if (canDrop) {\r\n        classNames.push(\"drop-possible\");\r\n    }\r\n\r\n    return connectDropTarget(\r\n        <div className={classNames.join(\" \")}>\r\n            { props.children }\r\n        </div>,\r\n    );\r\n}\r\n\r\nexport default DropTarget<Props, DropSourceProps>(\r\n    DragType.ITEM,\r\n    dropTarget,\r\n    collect,\r\n)(InventorySlot);\r\n","import * as React from \"react\";\nimport { DragSourceType } from \"constants/dragging\";\nimport {Item} from \"definitions/items/types\";\nimport InventorySlot from \"./InventorySlot\";\nimport DraggableItemIcon, { InventoryItemDragInfo } from '../items/DraggableItemIcon';\nimport \"./styles/inventory.scss\";\nimport { IconSize } from '../common/Icon';\n\nexport interface Props {\n    items: (Item|null)[];\n    sourceId?: string;   // who does this inventory belong to?\n    sourceType: DragSourceType;\n    iconSize?: IconSize;\n    onDropItem: (item: Item, fromSlot: number, toSlot: number, sourceType: DragSourceType, sourceId?: string) => void;\n    className?: string;\n}\n\n/**\n * Inventory is used to show Items. They can be dragged about\n * @param props\n */\nconst Inventory = (props: Props) => {\n    const slots = [];\n    for (let i = 0; i < props.items.length; i++) {\n        let contents;\n        const item = props.items[i];\n        const handleDrop = (dragInfo: InventoryItemDragInfo) => {\n            if (dragInfo.inventorySlot === i && dragInfo.sourceType === props.sourceType && dragInfo.sourceId === props.sourceId) {\n                // TODO: Swap items?!\n                return;\n            }\n            if (props.onDropItem) {\n                const {inventorySlot: fromSlot} = dragInfo;\n                props.onDropItem(dragInfo.item, fromSlot!, i, dragInfo.sourceType, dragInfo.sourceId);\n           }\n        };\n\n        if (item) {\n            contents = (\n                <DraggableItemIcon\n                    index={i}\n                    sourceId={props.sourceId}\n                    sourceType={props.sourceType}\n                    item={item}\n                />\n            );\n       }\n\n        const slot = (\n            <InventorySlot\n                key={`inventory-slot-${i}`}\n                item={item}\n                size={props.iconSize}\n                onDrop={handleDrop}\n            >\n                {contents}\n            </InventorySlot>\n        );\n        slots.push(slot);\n   }\n    return (\n        <div className={`inventory ${props.className ? props.className : \"\"}`}>\n            {slots}\n        </div>\n    );\n};\nexport default Inventory;\n","import { StoreState } from 'store/types';\nimport { useSelector } from 'react-redux';\nimport { Item } from 'definitions/items/types';\n\n// Returns the gold from redux store\nconst useStockpileState = () => {\n    return useSelector<StoreState, (Item|null)[]>(store => store.stockpile);\n}\n\nexport default useStockpileState;","import { useContext } from 'react';\nimport { useDispatch } from 'react-redux';\nimport { Action } from \"redux\";\nimport { removeItemFromInventory, assignEquipment, addItemToInventory, removeEquipment, moveItemInInventory } from 'store/actions/adventurers';\nimport { removeItemFromWarehouse, addItemToWarehouse, moveItemInWarehouse } from 'store/actions/items';\nimport { EquipmentSlotType } from 'components/ui/adventurer/EquipmentSlot';\nimport { Item } from 'definitions/items/types';\nimport { DragSourceType } from 'constants/dragging';\nimport { AdventurerStoreState } from 'store/types/adventurer';\nimport useStockpileState from 'hooks/store/useStockpileState';\nimport { SceneControllerContext } from 'components/world/QuestPanel/context/SceneControllerContext';\nimport { InventoryItemDragInfo } from 'components/ui/items/DraggableItemIcon';\nimport { SoundManager } from 'global/SoundManager';\n\n/* Exposes\n- dropItemEquipment,\n- dropItemInventory,\n- dropItemWarehouse\nto use in various places in the UI when an item is dropped somewhere\n*/\nconst useItemDropActions = () => {\n    const dispatch = useDispatch();\n    const sceneController = useContext(SceneControllerContext);  // is only available when in a scene\n    const stockpile = useStockpileState();\n\n    // When an item gets dropped on equipment slot\n    const dropItemEquipment = (dragInfo: InventoryItemDragInfo, slotType: EquipmentSlotType, adventurer: AdventurerStoreState) => {\n        const item = dragInfo.item;\n        const actions: Action[] = [];\n\n        SoundManager.playSound(\"ui/equip\");\n\n        switch (dragInfo.sourceType) {\n            // Dragged from inventory\n            case DragSourceType.adventurerInventory: {\n                actions.push(\n                    // Item gets removed from inventory\n                    removeItemFromInventory(adventurer.id, dragInfo.inventorySlot!),\n                    // Item gets assigned to an equipment slot\n                    assignEquipment(adventurer.id, slotType, item),\n                );\n\n                const existingEquipment = adventurer.equipment[slotType as EquipmentSlotType];\n                if (existingEquipment) {\n                    // There is already an item in this slot. Place in inventory\n                    actions.push(addItemToInventory(adventurer.id, existingEquipment, dragInfo.inventorySlot!));\n                }\n                break;\n            }\n            // Dragged from warehouse.\n            case DragSourceType.warehouse: {\n                actions.push(\n                    removeItemFromWarehouse(dragInfo.inventorySlot!),\n                    assignEquipment(adventurer.id, slotType, item),\n                );\n\n                const existingEquipment = adventurer.equipment[slotType as EquipmentSlotType];\n                if (existingEquipment) {\n                    // There is already an item in this slot. Place in warehouse\n                    actions.push(addItemToWarehouse(existingEquipment, dragInfo.inventorySlot!));\n                }\n                break;\n            }\n\n            // Dragged from equipment slot (only applicable to weapons)\n            case DragSourceType.adventurerEquipment: {\n                actions.push(\n                    assignEquipment(adventurer.id, slotType, item)\n                );\n\n                const existingEquipment = adventurer.equipment[slotType as EquipmentSlotType];\n                const fromSlot = dragInfo.inventorySlot!;\n                if (existingEquipment) {\n                    // Another weapon was there, switch them\n                    actions.push(assignEquipment(adventurer.id, fromSlot, existingEquipment),)\n                } else {\n                    // Clear the slot where it came from\n                    actions.push(removeEquipment(adventurer.id, fromSlot));\n                }\n                break;\n            }\n        }\n        actions.forEach(a => dispatch(a));\n    };\n\n    // When an item gets dropped on an adventurer inventory\n    const dropItemInventory = (item: Item, fromSlot: number, toSlot: number, sourceType: DragSourceType, adventurer: AdventurerStoreState, sourceId?: string): void => {\n        const actions: Action[] = [];\n        switch (sourceType) {\n            // Drag from one inventory slot to another\n            case DragSourceType.adventurerInventory:\n                actions.push(moveItemInInventory(adventurer.id, fromSlot, toSlot))\n                break;\n\n            // Dragged from warehouse\n            case DragSourceType.warehouse: {\n                actions.push(\n                    removeItemFromWarehouse(fromSlot),\n                    addItemToInventory(adventurer.id, item, toSlot),\n                )\n                const otherItem = adventurer.inventory[toSlot];\n                if (otherItem) {\n                    actions.push(\n                        addItemToWarehouse(otherItem, fromSlot)\n                    )\n                }\n                break;\n            }\n\n            // Drag from equipment slot\n            case DragSourceType.adventurerEquipment: {\n                actions.push(\n                    addItemToInventory(adventurer.id, item, toSlot)\n                );\n\n                const existingEquipment = adventurer.inventory[toSlot];\n                if (existingEquipment) {\n                    // Was dropped on another piece of equipment in inventory, switch them\n                    actions.push(assignEquipment(adventurer.id, fromSlot, existingEquipment));\n                } else {\n                    // Clear the slot where it came from\n                    actions.push(removeEquipment(adventurer.id, fromSlot));\n                }\n                break;\n            }\n\n            // Dragged from lootCache on a scene\n            case DragSourceType.lootCache: {\n                if (sceneController && sourceId) {\n                    // Let the scene controller handle this action\n                    sceneController.takeItemFromCache(fromSlot, sourceId, adventurer.id, toSlot);\n                }\n            }\n        }\n        actions.forEach(a => dispatch(a));\n    };\n\n    // When an item gets dropped on the warehouse inventory\n    const dropItemWarehouse = (item: Item, fromSlot: number, toSlot: number, sourceType: DragSourceType, sourceId?: string): void => {\n        const actions: Action[] = [];\n\n        switch (sourceType) {\n            // Dragged from the warehouse itself\n            case DragSourceType.warehouse: {\n                actions.push(\n                    moveItemInWarehouse(fromSlot, toSlot)\n                )\n                const otherItem = stockpile[toSlot];\n                if (otherItem) {\n                    actions.push(\n                        addItemToInventory(sourceId!, otherItem, fromSlot)\n                    )\n                }\n                break;\n            }\n            // Dragged from an adventurer inventory\n            case DragSourceType.adventurerInventory: {\n                actions.push(\n                    removeItemFromInventory(sourceId!, fromSlot),\n                    addItemToWarehouse(item, toSlot)\n                )\n                const otherItem = stockpile[toSlot];\n                if (otherItem) {\n                    actions.push(\n                        addItemToInventory(sourceId!, otherItem, fromSlot)\n                    )\n                }\n                break;\n            }\n        }\n        actions.forEach(a => dispatch(a));\n    };\n    return {\n        dropItemEquipment,\n        dropItemInventory,\n        dropItemWarehouse\n    }\n}\n\nexport default useItemDropActions;","import React, { Fragment } from \"react\";\nimport { useAdventurerState } from 'hooks/store/adventurers';\nimport { TextManager } from 'global/TextManager';\nimport { ContextType } from 'constants/context';\nimport { TooltipManager } from 'global/TooltipManager';\nimport { WeaponType } from 'definitions/items/weapons';\nimport './styles/adventurerSkills.scss';\n\ninterface Props {\n    adventurerId: string;\n}\n\nconst AdventurerSkills = (props: Props) => {\n    const adventurer = useAdventurerState(props.adventurerId);\n\n    const renderSkill = (skill: WeaponType) => {\n        // const traitDefinition = getDefinition(trait);\n        const handleClick = (event: React.MouseEvent) => {\n            const origin = (event.currentTarget as HTMLElement);\n            const originRect = origin.getBoundingClientRect();\n            TooltipManager.showContextTooltip(ContextType.skill, skill, originRect);\n            event.stopPropagation();\n        };\n        return (\n            <Fragment key={skill}>\n                <li onClick={handleClick}>\n                    <span className=\"skill\" onClick={handleClick}>\n                        {TextManager.getSkillName(skill)}\n                    </span>\n                    <span>\n                        {adventurer.skills[skill]}\n                    </span>\n                    {/* {TextManager.getTraitName(trait)} */}\n                </li>\n            </Fragment>\n        )\n    };\n\n    if (!adventurer?.skills) {\n        return null;\n    }\n    return (\n        <>\n            <p>{TextManager.get(\"ui-adventurer-info-skills-title\")}</p>\n            <ul className=\"adventurer-skills\">\n                {Object.keys(adventurer.skills)?.map((s) => {\n                    const skill: WeaponType = s as WeaponType;\n                    return renderSkill(skill);\n                })}\n            </ul>\n        </>\n    )\n}\n\nexport default AdventurerSkills;","const CONSTANT = 0.5;\n\nexport function xpToLevel(xp: number) {\n    return Math.floor(CONSTANT * Math.sqrt(xp));\n}\n\nexport function levelToXp(level: number) {\n    return Math.pow(level / CONSTANT, 2);\n}\n\n// print out required xp\n// for(let i = 1; i < 20; i++) {\n//     console.log(levelToXp(i))\n// }","import React, { useRef } from 'react';\nimport \"./styles/progressbar.scss\";\n\nexport enum Direction {\n    increasing,\n    decreasing\n}\n\nexport interface Props {\n    progress?: number;     // between 0 and 1\n    label?: string;\n    className?: string;\n    direction?: Direction; // only used to prevent the bar from animating back to the start state\n    animationTime?: number;\n}\n\nconst PlainProgressbar = (props: Props) => {\n    const { className = \"\", animationTime } = props;\n    const previousProgress = useRef(0);\n    const progress: number = clamp(props.progress || 0, 0, 1);\n\n    previousProgress.current = progress;\n    return (\n        <div className={`progressbar ${className}`}>\n            <div className=\"progressbar-label\">{props.label}</div>\n            <div className=\"progressbar-bar\" style= {{\n                width: `${progress * 100}%`,\n                ...(animationTime && {transition: `width ${animationTime}ms linear`})\n            }}/>\n        </div>\n    );\n};\n\nexport default PlainProgressbar;\n\nfunction clamp(val: number, min: number, max: number): number {\n    return val > max ? max : val < min ? min : val;\n}\n","import * as React from \"react\";\nimport { levelToXp, xpToLevel } from 'mechanics/adventurers/levels';\nimport PlainProgressbar from 'components/ui/common/progress/PlainProgressbar';\nimport { TextManager } from 'global/TextManager';\nimport { useEffect, useMemo, useState } from \"react\";\nimport usePrevious from \"hooks/usePrevious\";\nimport { useAdventurerState } from \"hooks/store/adventurers\";\nimport { SoundManager } from \"global/SoundManager\";\n\nexport interface Props {\n    adventurerId: string;\n}\n\nconst Level = (props: Props) => {\n    const { adventurerId } = props;\n    const { xp } = useAdventurerState(adventurerId);\n    const currentLevel = xpToLevel(xp);\n    const currentLevelXp = levelToXp(currentLevel); // start\n    const nextLevel = currentLevel + 1;\n    const nextLevelXp = levelToXp(nextLevel);\n    const [dingAnimationRunning, setDingAnimationRunning] = useState(false)\n\n    const lastState = usePrevious({ currentLevel, currentLevelXp, nextLevel, nextLevelXp })\n    const lastAdventurer = usePrevious(adventurerId);\n\n    useEffect(() => {\n        if (lastAdventurer !== adventurerId) {\n            setDingAnimationRunning(false)\n        }\n        else if (nextLevel > (lastState?.nextLevel ?? 0)) {\n            SoundManager.playSound(\"ui/levelUp\");\n            setDingAnimationRunning(true);\n\n            setTimeout(() => {\n                setDingAnimationRunning(false)\n            }, 2000)\n        }\n    }, [adventurerId, lastAdventurer, lastState?.nextLevel, nextLevel])\n\n    const lastDingAnimationRunning = usePrevious(dingAnimationRunning);\n\n    const progress = useMemo(() => {\n        return dingAnimationRunning ? 1 : (xp - currentLevelXp) / (nextLevelXp - currentLevelXp)\n    }, [currentLevelXp, dingAnimationRunning, nextLevelXp, xp]);\n\n    return (\n        <div className=\"level\">\n            Level {currentLevel}\n            {<PlainProgressbar\n                progress={progress}\n                animationTime={lastAdventurer === adventurerId && !lastDingAnimationRunning ? 300 : 0}\n                label={dingAnimationRunning ?  TextManager.get(\"ui-adventurer-info-xp-level-up\") : TextManager.get(\"ui-adventurer-info-xp-progress\", {\n                    xp: Math.floor(xp - currentLevelXp),\n                    next: nextLevelXp - currentLevelXp\n                })}\n            />}\n        </div>\n    )\n}\nexport default Level;\n","export interface TraitDefinition {\n    trait: Trait;\n    hasEffect?: boolean;\n}\n\nexport enum Trait {\n    arrowFinder = \"arrowFinder\",\n    gloomy = \"gloomy\",\n    houseHouston = \"houseHouston\",\n    houseMaddox = \"houseMaddox\",\n    houseMonroe = \"houseMonroe\",\n}\n\n","import React, { useContext, useMemo } from \"react\";\nimport { SceneControllerContext } from 'components/world/QuestPanel/context/SceneControllerContext';\nimport { TextManager } from 'global/TextManager';\nimport { useQuest } from 'hooks/store/quests';\nimport { AdventurerStoreState } from 'store/types/adventurer';\n\nexport interface Props {\n    adventurer: AdventurerStoreState;\n    questName?: string;\n}\n\n/** Used when AdventurerPanel is used in Quest view\n * todo: move outside of /world\n */\nconst ApIndicator = (props: Props) => {\n    const quest = useQuest(props.questName!);\n    const controller = useContext(SceneControllerContext)!;\n\n    const ap = useMemo(() => {\n        if (!controller) return null;\n        return controller.getSceneActor(props.adventurer.id)?.ap || null;\n    }, [controller, props.adventurer.id]);\n\n    if (!quest?.scene?.combat) {\n        return null;\n    }\n    return (\n        <span>{TextManager.get(\"ui-adventurer-info-ap-remaining\", { ap })}</span>\n    );\n}\n\nexport default ApIndicator;","import { TraitDefinition, Trait } from './types';\n\nconst all = {\n    [Trait.arrowFinder]: {\n        trait: Trait.arrowFinder,\n        hasEffect: true\n    },\n    [Trait.gloomy]: {\n        trait: Trait.gloomy,\n        hasEffect: true\n    },\n    [Trait.houseHouston]: {\n        trait: Trait.houseHouston,\n    },\n    [Trait.houseMaddox]: {\n        trait: Trait.houseMaddox,\n    },\n    [Trait.houseMonroe]: {\n        trait: Trait.houseMonroe,\n    }\n};\n\nexport function getDefinition(trait: Trait): TraitDefinition {\n    return all[trait];\n}","import React, { Fragment } from \"react\";\nimport { useAdventurerState } from 'hooks/store/adventurers';\nimport { Trait } from 'definitions/traits/types';\nimport './styles/adventurerTraits.scss';\nimport { getDefinition } from 'definitions/traits';\nimport { TextManager } from 'global/TextManager';\nimport { ContextType } from 'constants/context';\nimport { TooltipManager } from 'global/TooltipManager';\n\ninterface Props {\n    adventurerId: string;\n}\n\nconst AdventurerTraits = (props: Props) => {\n    const adventurer = useAdventurerState(props.adventurerId);\n\n    const renderTrait = (trait: Trait, last: boolean) => {\n        const traitDefinition = getDefinition(trait);\n        const handleClick = (event: React.MouseEvent) => {\n            const origin = (event.currentTarget as HTMLElement);\n            const originRect = origin.getBoundingClientRect();\n            TooltipManager.showContextTooltip(ContextType.trait, traitDefinition, originRect);\n            event.stopPropagation();\n        };\n        return (\n            <Fragment key={trait}>\n                <li onClick={handleClick}>\n                    {TextManager.getTraitName(trait)}\n                </li>\n                {!last && (', ')}\n            </Fragment>\n        )\n    };\n\n    if (!adventurer?.traits) {\n        return null;\n    }\n    return (\n        <>\n            <p>{TextManager.get(\"ui-adventurer-info-traits-title\")}</p>\n            <ul className=\"adventurer-traits\">\n                {adventurer.traits.map((t, i)=> renderTrait(t, i === adventurer.traits!.length -1))}\n            </ul>\n        </>\n    )\n}\n\nexport default AdventurerTraits;","import React, { useState, useEffect } from \"react\";\nimport AdventurerTabstrip from './AdventurerTabstrip';\nimport { createSelectAdventurersOnQuest } from 'store/selectors/adventurers';\nimport { useSelector, useDispatch } from 'react-redux';\nimport QuestDetails from './QuestDetails';\nimport { useHistory } from 'react-router';\nimport { getWorldLink } from 'utils/routing';\nimport LootCache from './modals/LootCache';\nimport { useQuest } from 'hooks/store/quests';\nimport { setActiveSceneInteractionModal } from 'store/actions/quests';\nimport Situation from './modals/Situation';\nimport SceneControllerContextProvider from './context/SceneControllerContext';\nimport CombatBar from './CombatBar';\nimport AdventurerPanel from 'components/ui/adventurer/AdventurerPanel';\nimport \"./styles/questPanel.scss\";\n\nenum Layout {\n    auto,       // horizontal on large screens, vertical on small screens\n    vertical,\n    horizontal\n}\n\ninterface Props {\n    questName: string;\n    layout?: Layout;\n}\n\nconst QuestPanel = (props: Props) => {\n    const history = useHistory();\n    const dispatch = useDispatch();\n    const {layout = Layout.auto} = props;\n    const adventurers = useSelector(createSelectAdventurersOnQuest(props.questName));\n    const leader = adventurers[0];\n    const [selectedAdventurerId, setSelectedAdventurerID] = useState<string>(leader?.id);\n\n    const quest = useQuest(props.questName);\n    const activeInteractionModal = quest?.scene?.activeInteractionModal;\n\n    const handleAdventurerSelected = (adventurerId: string) => {\n        setSelectedAdventurerID(adventurerId);\n    }\n\n    const handleCloseLootCacheModal = () => {\n        dispatch(setActiveSceneInteractionModal(props.questName));\n    }\n\n    useEffect(() => {\n        if (!adventurers.length) {\n            // no adventurers, something went wrong, perhaps invalid url\n            // bounce back to world\n            history.push(getWorldLink());\n       }\n    }, [adventurers.length, history]);\n    if (!adventurers.length) return null;\n\n    return (\n        <SceneControllerContextProvider questName={props.questName}>\n            { quest?.scene?.combat && <CombatBar questName={props.questName} selectedAdventurerId={selectedAdventurerId}/>}\n            <div className={`quest-panel quest-panel-${Layout[layout]}`}>\n                <div className=\"quest-area\">\n                    <QuestDetails\n                        questName={props.questName}\n                        selectedActorId={selectedAdventurerId}\n                        setSelectedActor={handleAdventurerSelected}\n                    />\n                    { activeInteractionModal && activeInteractionModal.type === 'lootCache' && (\n                        <div className=\"modal\" onClick={handleCloseLootCacheModal}>\n                            <LootCache\n                                cacheName={activeInteractionModal.lootCache}\n                                adventurerId={selectedAdventurerId}\n                                onClose={handleCloseLootCacheModal}\n                            />\n                        </div>\n                    )}\n                    { activeInteractionModal && activeInteractionModal.type === 'situation' && (\n                        <div className=\"modal\" onClick={handleCloseLootCacheModal}>\n                            <Situation\n                                situation={activeInteractionModal.situation}\n                                adventurerId={selectedAdventurerId}\n                                onClose={handleCloseLootCacheModal}\n                            />\n                        </div>\n                    )}\n                </div>\n                <div className=\"party-area\">\n                    <AdventurerTabstrip\n                        adventurers={adventurers}\n                        selectedAdventurerId={selectedAdventurerId}\n                        onAdventurerTabSelected={handleAdventurerSelected}\n                        disabled={activeInteractionModal !== undefined}\n                    />\n                    <div className=\"adventurer-details\">\n                        { selectedAdventurerId && (\n                            <AdventurerPanel\n                                adventurerId={selectedAdventurerId}\n                                questName={props.questName}\n                            />\n                        )}\n                    </div>\n                </div>\n            </div>\n        </SceneControllerContextProvider>\n    )\n}\n\nexport default QuestPanel;\n","import React from \"react\";\nimport './styles/guy.scss';\nimport { EquipmentSlotType } from 'components/ui/adventurer/EquipmentSlot';\nimport { useAdventurerDamageReduction } from 'hooks/store/adventurers';\n\n\nexport interface Props {\n    adventurerId: string\n}\n\n// A silhouette of a person with the Damage Reduction numbers\nconst Guy = (props: Props) => {\n    const {adventurerId} = props;\n\n    const damageReduction = useAdventurerDamageReduction(adventurerId);\n    const renderDamageReduction = (equipmentType: EquipmentSlotType) => {\n        const dR = damageReduction[EquipmentSlotType[equipmentType]];\n        if (!dR) {\n            return null;\n        }\n        return (\n            <div className={EquipmentSlotType[equipmentType]} key={equipmentType}>\n                {dR}\n            </div>\n        )\n    }\n\n    return (\n        <li className=\"guy\">\n            {(renderDamageReduction(EquipmentSlotType.head))}\n            {(renderDamageReduction(EquipmentSlotType.chest))}\n            {(renderDamageReduction(EquipmentSlotType.hands))}\n            {(renderDamageReduction(EquipmentSlotType.shoulders))}\n            {(renderDamageReduction(EquipmentSlotType.legs))}\n            {(renderDamageReduction(EquipmentSlotType.feet))}\n        </li>\n    )\n}\n\nexport default Guy;","import React from \"react\";\nimport { AdventurerStoreState } from 'store/types/adventurer';\nimport EquipmentSlot, { EquipmentSlotType } from 'components/ui/adventurer/EquipmentSlot';\nimport { Item } from 'definitions/items/types';\nimport DraggableItemIcon, { InventoryItemDragInfo } from 'components/ui/items/DraggableItemIcon';\nimport { DragSourceType } from 'constants/dragging';\nimport { TextManager } from 'global/TextManager';\nimport { IconSize } from 'components/ui/common/Icon';\nimport Guy from './Guy';\nimport './styles/adventurerEquipment.scss';\n\nexport interface Props {\n    adventurer: AdventurerStoreState\n    onDropItemEquipment: (dragInfo: InventoryItemDragInfo, slotType: EquipmentSlotType) => void;\n}\n\n// Shows the gear an adventurer is wearing\nconst AdventurerEquipment = (props: Props) => {\n    const { adventurer, onDropItemEquipment } = props;\n\n    const getEquipmentSlot = (slotType: EquipmentSlotType) => {\n        // returns EquipmentSlot\n        const item: Item | undefined = adventurer.equipment[slotType];\n\n        return (\n            <li className={EquipmentSlotType[slotType]}>\n                <EquipmentSlot\n                    onDrop={(dragInfo: InventoryItemDragInfo) => onDropItemEquipment(dragInfo, slotType)}\n                    type={slotType}\n                >\n                    {item && (\n                        <DraggableItemIcon\n                            index={slotType}\n                            sourceId={adventurer.id}\n                            sourceType={DragSourceType.adventurerEquipment}\n                            item={item}\n                            size={IconSize.medium}\n                        />\n                    )}\n                </EquipmentSlot>\n                <span className=\"info\">{TextManager.getEquipmentSlot(slotType)}</span>\n            </li>\n        );\n    };\n    return (\n        <ul className=\"adventurer-equipment\">\n            {getEquipmentSlot(EquipmentSlotType.head)}\n            {getEquipmentSlot(EquipmentSlotType.chest)}\n            {getEquipmentSlot(EquipmentSlotType.hands)}\n            {getEquipmentSlot(EquipmentSlotType.shoulders)}\n            {getEquipmentSlot(EquipmentSlotType.legs)}\n            {getEquipmentSlot(EquipmentSlotType.feet)}\n            {getEquipmentSlot(EquipmentSlotType.mainHand)}\n            {getEquipmentSlot(EquipmentSlotType.offHand)}\n            <Guy adventurerId={adventurer.id} />\n        </ul>\n    )\n}\n\nexport default AdventurerEquipment;","import React, {  } from \"react\";\nimport { DragSourceType } from 'constants/dragging';\nimport Inventory from 'components/ui/inventory/Inventory';\nimport useItemDropActions from 'hooks/actions/useItemActions';\nimport { EquipmentSlotType } from 'components/ui/adventurer/EquipmentSlot';\nimport { InventoryItemDragInfo } from 'components/ui/items/DraggableItemIcon';\nimport { Item } from 'definitions/items/types';\nimport AdventurerSkills from './AdventurerSkills';\nimport { useAdventurerState } from 'hooks/store/adventurers';\nimport Level from 'components/ui/adventurer/AdventurerPanel/Level';\nimport ApIndicator from './ApIndicator';\nimport AdventurerTraits from './AdventurerTraits';\nimport AdventurerEquipment from './AdventurerEquipment';\nimport \"./styles/adventurerPanel.scss\";\n\nexport interface Props {\n    adventurerId: string;\n    questName?: string;\n    horizontalMode?: boolean;\n\n    name?: boolean; // whether to show the adventurer name\n    levelBar?: boolean; // whether to show the level bar\n    traits?: boolean; // whether to show traits\n    skills?: boolean; // whether to show skills\n}\n\n/** Vertical panel showing adventurer info\n */\nconst AdventurerPanel = (props: Props) => {\n    const {\n        adventurerId,\n        questName,\n        horizontalMode,\n        name = true,\n        levelBar = true,\n        traits = true,\n        skills = true\n    } = props;\n    const adventurer = useAdventurerState(adventurerId);\n    // const renderAttributes = () => Object.keys(adventurer.stats).map((stat) => {\n    //     const value: number = adventurer.stats[stat];\n    //     return <div key={`${adventurer.id}-${stat}`} > <b>{stat}</b>: {value.toFixed(1)} </div>;\n    // });\n\n    const {\n        dropItemEquipment,\n        dropItemInventory\n    } = useItemDropActions();\n\n    const handleDropItemEquipment = (dragInfo: InventoryItemDragInfo, slotType: EquipmentSlotType) => {\n        dropItemEquipment(dragInfo, slotType, adventurer);\n    };\n    const handleDropItemInventory = (item: Item, fromSlot: number, toSlot: number, sourceType: DragSourceType, sourceId?: string) => {\n        dropItemInventory(item, fromSlot, toSlot, sourceType, adventurer, sourceId);\n    }\n\n    return (\n        <div className={`adventurer-panel${(horizontalMode ? \" horizontal\" : \"\")}`}>\n            <div className=\"left\">\n                <div className=\"info\">\n                    { name && (\n                        <div className=\"name\">\n                            {adventurer.name}\n                            {questName && <ApIndicator questName={questName} adventurer={adventurer} />}\n                        </div>\n                    )}\n                    { levelBar && <Level adventurerId={adventurer.id}/> }\n\n                    { traits && <AdventurerTraits adventurerId={adventurer.id}/> }\n                    { skills && <AdventurerSkills adventurerId={adventurer.id}/> }\n                    {/* <div className=\"renderAttributes\">\n                        {renderAttributes()}\n                    </div> */}\n                </div>\n                <div className=\"equipment\">\n                    <AdventurerEquipment\n                        adventurer={adventurer}\n                        onDropItemEquipment={handleDropItemEquipment}\n                    />\n                </div>\n\n            </div>\n            <div className=\"right\">\n                <Inventory\n                    sourceType={DragSourceType.adventurerInventory}\n                    sourceId={adventurer.id}\n                    items={adventurer.inventory}\n                    className=\"inventory-small\"\n                    onDropItem={handleDropItemInventory}\n                />\n            </div>\n        </div>\n    )\n}\n\nexport default AdventurerPanel;\n","import Tab from \"components/ui/tabs/Tab\";\r\nimport Tabstrip from \"components/ui/tabs/Tabstrip\";\r\nimport * as React from \"react\";\r\nimport {LogChannel, LogEntry} from \"store/types/logEntry\";\r\nimport {TextManager} from \"global/TextManager\";\r\nimport {useEffect, useState} from 'react';\r\nimport Button from 'components/ui/buttons/Button';\r\nimport { useLog } from \"hooks/store/useLog\";\r\nimport { useActiveQuestNames } from \"hooks/store/quests\";\r\nimport { useLocation } from \"react-router-dom\";\r\nimport { getQuestLink, getTownLink } from \"utils/routing\";\r\nimport \"./styles/simplelog.scss\";\r\n\r\n// tslint:disable-next-line:no-empty-interface\r\n// eslint-disable-next-line @typescript-eslint/no-empty-interface\r\nexport interface Props {\r\n}\r\n\r\nenum ChannelType {\r\n    all,\r\n    town,\r\n    quest,\r\n}\r\n\r\ninterface ChannelDefinition {\r\n    label: string;\r\n    tabType: ChannelType;\r\n    tabId: string;\r\n    channelContext?: string;\r\n}\r\n\r\n// const activeQuestNames: string[] = [];\r\n\r\nconst SimpleLog = () => {\r\n\r\n    const [expanded, setExpanded] = useState(false);\r\n    const [selectedTabId, setSelectedTabId] = useState<\"all\" | \"town\" | string>(\"all\");\r\n\r\n    const logEntries = useLog();\r\n    const activeQuestNames = useActiveQuestNames();\r\n    const location = useLocation<{pathname: string}>();\r\n\r\n    useEffect(() => {\r\n        if (location.pathname === getTownLink()){\r\n            setSelectedTabId(\"town\");\r\n            return;\r\n        }\r\n        activeQuestNames.forEach(q => {\r\n            if (location.pathname === getQuestLink(q)){\r\n                setSelectedTabId(`quest-${q}`);\r\n            }\r\n        })\r\n    }, [activeQuestNames, location]);\r\n\r\n    const channels: ChannelDefinition[]=[{\r\n        label: TextManager.get(\"ui-log-tab-all\"),\r\n        tabId: \"all\",\r\n        tabType: ChannelType.all,\r\n    }, {\r\n        label: TextManager.get(\"ui-log-tab-town\"),\r\n        tabId: \"town\",\r\n        tabType: ChannelType.town,\r\n    }];\r\n\r\n    const handleTabSelected = (tabId: string) => {\r\n        setSelectedTabId(tabId);\r\n    }\r\n\r\n    const handleToggleExpand=() => {\r\n        setExpanded(!expanded);\r\n    }\r\n\r\n    activeQuestNames.forEach((questName) => {\r\n        channels.push({\r\n            channelContext: questName,\r\n            label: TextManager.getQuestTitle(questName),\r\n            tabId: `quest-${questName}`,\r\n            tabType: ChannelType.quest,\r\n        });\r\n    });\r\n\r\n    let displayEntries: LogEntry[] = [];\r\n    const currentTab = channels.find((t) => t.tabId === selectedTabId);\r\n\r\n    switch (currentTab?.tabType) {\r\n        case ChannelType.all:\r\n            // All the things\r\n            displayEntries = logEntries;\r\n            break;\r\n\r\n        case ChannelType.town:\r\n            // Only town\r\n            displayEntries = logEntries.filter((lE) => lE.channel === LogChannel.town);\r\n            break;\r\n\r\n        case ChannelType.quest:\r\n            // Only the selected quest\r\n            displayEntries = logEntries.filter((lE) => lE.channel === LogChannel.quest && lE.channelContext === currentTab.channelContext);\r\n            break;\r\n    }\r\n\r\n    const getLogEntryRow = (logEntry: LogEntry) => {\r\n        const text = TextManager.get(logEntry.key, logEntry.context);\r\n        return (\r\n            <div className=\"entry\" key={logEntry.time}>\r\n                {text}\r\n            </div>\r\n        );\r\n    };\r\n\r\n    return (\r\n        <div className={`log${expanded ? \" expanded\" : \"\"}`}>\r\n            <div className=\"tab-bar\">\r\n                <Tabstrip className=\"tabs\" onTabSelected={handleTabSelected} activeTab={selectedTabId}>\r\n                    {channels.map((tab) => {\r\n                        return <Tab id={tab.tabId} key={tab.tabId}>{tab.label}</Tab>;\r\n                    })}\r\n                </Tabstrip>\r\n                <Button\r\n                    className=\"expand-button\"\r\n                    onClick={handleToggleExpand}\r\n                    square={true}\r\n                    size=\"medium\"\r\n                    text={expanded ? \"▼\" : \"▲\"}\r\n                />\r\n            </div>\r\n            <div className=\"log-entries\">\r\n                {displayEntries.map((entry) => getLogEntryRow(entry))}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default SimpleLog;\r\n","import WorldMap from \"components/world/WorldMap\";\r\nimport React, { useEffect, useRef } from \"react\";\r\nimport { Channel, MixMode, SoundManager } from \"global/SoundManager\";\r\nimport QuestPanel from './QuestPanel';\r\nimport { useRouteMatch, useHistory } from 'react-router';\r\nimport { getQuestLink, getWorldLink } from 'utils/routing';\r\nimport \"./styles/worldView.scss\";\r\n\r\n// eslint-disable-next-line @typescript-eslint/no-empty-interface\r\nexport interface Props {\r\n}\r\n\r\n/**\r\n * WorldView shows the map and QuestPanel\r\n * @param props\r\n */\r\nconst WorldView = () => {\r\n    const worldMapRef = useRef<HTMLDivElement>(null);\r\n    const match = useRouteMatch<{questname: string}>(`${getWorldLink()}/:questname`);\r\n    const selectedQuestName = match?.params.questname;\r\n    const history = useHistory();\r\n\r\n    useEffect(() => {\r\n        SoundManager.addSound(\"music/world\", \"sound/music/TheLoomingBattle.ogg\", () => {\r\n            SoundManager.playSound(\"music/world\", Channel.music, true, MixMode.fade, true);\r\n        })\r\n    }, []);\r\n\r\n    // const handleMapMove = (distance: number, angle: number) => {\r\n    //     const compassEl = compassRef!.current!;\r\n    //     const compassTextEl = compassEl.firstElementChild! as HTMLElement;\r\n\r\n    //     // Rotate the compass\r\n    //     compassEl.style.transform = `rotate(${angle - (Math.PI / 2)}rad)`;\r\n    //     compassEl.style.opacity = distance > 10 ? \"1\" : \"0\";\r\n    //     compassTextEl.style.transform = `rotate(${-angle + (Math.PI / 2)}rad)`;\r\n    //     compassTextEl.innerHTML = `${distance.toFixed(0)}`;\r\n    // };\r\n\r\n    // const handleCompassClick = () => {\r\n    //     //setScrollToPosition(new Vector2(1, 1));\r\n    // };\r\n\r\n    const handlePartyClick = (questName: string) => {\r\n        // if (questName === selectedQuestName) {\r\n        //     history.push(getWorldLink());\r\n        // } else {\r\n            history.push(getQuestLink(questName));\r\n        // }\r\n        SoundManager.playSound(\"ui/buttonClick\");\r\n    };\r\n\r\n    const handleRetrieveWorldViewRef = () => {\r\n        return worldMapRef;\r\n    }\r\n\r\n    return (\r\n        <div className=\"world-view\" ref={worldMapRef}>\r\n            {/* <div className=\"compass\" ref={compassRef} onClick={handleCompassClick}>\r\n                <div className=\"distance\"/>\r\n            </div> */}\r\n            <WorldMap\r\n                selectedQuestName={selectedQuestName}\r\n                // onMapMove={handleMapMove}\r\n                smallMap={selectedQuestName != null}\r\n                onPartyClick={handlePartyClick}\r\n                retrieveWorldViewRef={handleRetrieveWorldViewRef}\r\n            />\r\n            { selectedQuestName && (\r\n                <QuestPanel questName={selectedQuestName} />\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default WorldView;\r\n","// tslint:disable:object-literal-sort-keys\nimport { Action, AnyAction } from \"redux\";\nimport { TaskType } from \"store/types/task\";\n\nexport enum ActionType {\n    start = \"startTask\",\n    update = \"updateTasks\",\n}\n\nexport interface AddAction extends Action<ActionType> {\n    taskType: TaskType;\n    name: string;\n    origin: string;\n    time: number;\n    callbacks: AnyAction[];\n}\n\nexport function startTask(taskType: TaskType,\n                          name: string, origin: string, time: number, callbacks: AnyAction[]): AddAction {\n    return {\n        type: ActionType.start,\n        taskType,\n        name,\n        origin,\n        time,\n        callbacks,\n    };\n}\n","import { AnyAction } from \"redux\";\n\nexport enum TaskType {\n    buildStructure,\n    upgradeStructure,\n    craftItem,\n    studyItem\n}\n\nexport interface TaskStoreState {\n    type: TaskType;\n    name: string;\n    origin: string;\n    startTime: number;        // time the task was scheduled\n    lastTick: number;         // time of last tick\n    timeRemaining: number;\n    progress: number;         // value between 0 and 1 indicating progress\n    callbacks: AnyAction[];\t  // actions to dispatch on complete\n}\n","import { useCallback } from 'react';\nimport { StoreState } from 'store/types';\nimport { useSelector } from 'react-redux';\nimport { Structure } from 'definitions/structures';\nimport { StructureStoreState } from 'store/types/structure';\n\n// Returns the structure state from redux store\nexport default function useStructureState<T extends StructureStoreState>(structure: Structure): T {\n    const structureSelector = useCallback(\n        (state: StoreState) => state.structures[structure] as T,\n        [structure]\n    );\n    return useSelector<StoreState, T>(structureSelector);\n}\n","import * as React from \"react\";\nimport { useDispatch } from 'react-redux';\nimport { Structure, getDefinition } from 'definitions/structures';\nimport { subtractGold } from 'store/actions/gold';\nimport { startBuildingStructure, finishBuildingStructure } from 'store/actions/structures';\nimport { startTask } from 'store/actions/tasks';\nimport { TaskType } from 'store/types/task';\nimport { DeedDefinition } from 'definitions/items/deeds';\nimport useGoldState from 'hooks/store/useGoldState';\nimport useStructureState from 'hooks/store/useStructureState';\nimport { StructureState } from 'store/types/structure';\nimport { TextManager } from 'global/TextManager';\nimport Button from 'components/ui/buttons/Button';\n\ninterface Props {\n    info: DeedDefinition;\n}\n\nconst DeedContent = (props: Props) => {\n    const { info } = props;\n    const dispatch = useDispatch();\n\n    const gold = useGoldState();\n    const structureDefinition = getDefinition(info.structure);\n    const enoughGold = structureDefinition.cost.gold || 0 <= gold;\n    const structureStoreState = useStructureState(info.structure);\n    const canBeBuilt = structureStoreState.state === StructureState.NotBuilt;\n    const disabled = !canBeBuilt || !enoughGold;\n    const subtext = TextManager.getItemSubtext(info.item);\n\n    const handleStartConstruction = (structure: Structure) => {\n\n        dispatch(subtractGold(structureDefinition.cost.gold || 0));\n        dispatch(startBuildingStructure(structure));\n\n        const callbacks = [ finishBuildingStructure(structure) ];\n        const time = structureDefinition.cost.time!;\n        const start = startTask(TaskType.buildStructure,\n            `${structure}.build`,\n            \"town\",\n            time,\n            callbacks);\n        dispatch(start);\n    }\n    return (\n        <div>\n            { subtext && (<p className=\"subtext\">{`\"${subtext}\"`}</p>)}\n            <Button\n                disabled={disabled}\n                size=\"small\"\n                onClick={() => handleStartConstruction(info.structure)}\n            >\n                Start construction ({ structureDefinition.cost.gold } gold)\n            </Button>\n        </div>\n    );\n\n}\n\nexport default DeedContent;","// tslint:disable:object-literal-sort-keys\n\nimport * as time from \"utils/format/time\";\nimport { Item } from \"../items/types\";\nimport { ProductionDefinition } from \"./types\";\n\nconst weaponsmithProduction: {[key: string]: ProductionDefinition} = {\n    [Item.aegisOfValor]: {\n        item: Item.aegisOfValor,\n        levelRequired: 3,\n        cost: {\n            resources: { wood: 20, iron: 5 },\n            time: time.HALF_HOUR,\n        },\n    },\n    [Item.arbalest]: {\n        item: Item.arbalest,\n        cost: {\n            resources: { wood: 20, iron: 5 },\n            time: time.HALF_HOUR,\n        },\n    },\n    [Item.battleAxe]: {\n        item: Item.battleAxe,\n        cost: {\n            resources: { wood: 20, iron: 5 },\n            time: time.HALF_HOUR,\n        },\n    },\n    [Item.berserkerShield]: {\n        item: Item.berserkerShield,\n        levelRequired: 2,\n        cost: {\n            resources: { wood: 20, iron: 5 },\n            time: time.HALF_HOUR,\n        },\n    },\n    [Item.brassKnuckles]: {\n        item: Item.brassKnuckles,\n        cost: {\n            resources: { wood: 20, iron: 5 },\n            time: time.HALF_HOUR,\n        },\n    },\n    [Item.simpleCrossbow]: {\n        item: Item.simpleCrossbow,\n        cost: {\n            resources: { wood: 20, iron: 5 },\n            time: time.HALF_HOUR,\n        },\n    },\n    [Item.cleaver]: {\n        item: Item.cleaver,\n        cost: {\n            resources: { wood: 10, iron: 15 },\n            time: time.HALF_HOUR,\n        },\n    },\n    [Item.club]: {\n        item: Item.club,\n        cost: {\n            resources: { wood: 30,},\n            time: time.HALF_HOUR,\n        },\n    },\n    [Item.dagger]: {\n        item: Item.dagger,\n        cost: {\n            resources: { wood: 10, iron: 10},\n            time: time.ONE_HOUR,\n        },\n    },\n    [Item.flail]: {\n        item: Item.flail,\n        cost: {\n            resources: { wood: 10, iron: 10},\n            time: time.ONE_HOUR,\n        },\n    },\n    [Item.goldenShield]: {\n        item: Item.goldenShield,\n        levelRequired: 2,\n        cost: {\n            resources: { wood: 20, iron: 5 },\n            time: time.HALF_HOUR,\n        },\n    },\n    [Item.javelin]: {\n        item: Item.javelin,\n        cost: {\n            resources: { wood: 20, iron: 10},\n            time: time.ONE_HOUR + time.HALF_HOUR,\n        },\n    },\n    [Item.khopesh]: {\n        item: Item.khopesh,\n        cost: {\n            resources: { wood: 15, iron: 40},\n            time:  time.TWO_MINUTES,\n        },\n    },\n    [Item.longbow]: {\n        item: Item.longbow,\n        cost: {\n            resources: { wood: 40, iron: 5},\n            time: time.ONE_HOUR,\n        },\n    },\n    [Item.mace]: {\n        item: Item.mace,\n        cost: {\n            resources: { wood: 15, iron: 10},\n            time: time.ONE_HOUR,\n        },\n    },\n    [Item.morningStar]: {\n        item: Item.morningStar,\n        cost: {\n            resources: { wood: 15, iron: 15},\n            time: time.ONE_HOUR,\n        },\n    },\n    [Item.paintedBuckler]: {\n        item: Item.paintedBuckler,\n        cost: {\n            resources: { wood: 20, iron: 10},\n            time: time.ONE_HOUR + time.HALF_HOUR,\n        },\n    },\n    [Item.poisonedDagger]: {\n        item: Item.poisonedDagger,\n        cost: {\n            resources: { wood: 50, iron: 15},\n            materials: [ Item.poisonVial ],\n            time: time.ONE_HOUR,\n        },\n    },\n    [Item.ravenStaff]: {\n        item: Item.ravenStaff,\n        cost: {\n            resources: { wood: 15, iron: 10, food: 5},\n            time: time.ONE_HOUR,\n        },\n    },\n    [Item.savageStaff]: {\n        item: Item.savageStaff,\n        cost: {\n            resources: { wood: 15, iron: 10, food: 5},\n            time: time.ONE_HOUR,\n        },\n    },\n    [Item.spear]: {\n        item: Item.spear,\n        cost: {\n            resources: { wood: 15, iron: 15},\n            time: time.ONE_HOUR,\n        },\n    },\n    [Item.steelShield]: {\n        item: Item.steelShield,\n        cost: {\n            resources: { wood: 15, iron: 15},\n            time: time.ONE_HOUR,\n        },\n    },\n    [Item.steelSword]: {\n        item: Item.steelSword,\n        cost: {\n            resources: { wood: 10, iron: 30},\n            time:  time.ONE_HOUR,\n        },\n    },\n    [Item.warhammer]: {\n        item: Item.warhammer,\n        cost: {\n            resources: { wood: 10, iron: 30},\n            time:  time.ONE_HOUR,\n        },\n    },\n    [Item.woodenBulwark]: {\n        item: Item.woodenBulwark,\n        cost: {\n            resources: { wood: 10, iron: 30},\n            time:  time.ONE_HOUR,\n        },\n    },\n};\nexport default weaponsmithProduction;\n\nexport function getDefinition(item: Item) {\n    return weaponsmithProduction[item];\n}\n","// tslint:disable:object-literal-sort-keys\n\nimport * as time from \"utils/format/time\";\nimport {    Item} from \"../items/types\";\nimport {  ProductionDefinition } from \"./types\";\n\n// todo: real values for costs\nconst armoursmithProduction: { [key: string]: ProductionDefinition } = {\n    [Item.boots1]: {\n        item: Item.boots1,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        },\n    },\n    [Item.boots2]: {\n        item: Item.boots2,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        },\n        levelRequired: 2\n    },\n    [Item.boots3]: {\n        item: Item.boots3,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        },\n        levelRequired: 3\n    },\n    [Item.chainmailHood]: {\n        item: Item.chainmailHood,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    [Item.chest]: {\n        item: Item.chest,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    [Item.clothGloves]: {\n        item: Item.clothGloves,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        },\n    },\n    [Item.cowl]: {\n        item: Item.cowl,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    [Item.druidChest]: {\n        item: Item.druidHands,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        },\n        levelRequired: 2\n    },\n    [Item.druidFeet]: {\n        item: Item.druidFeet,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        },\n        levelRequired: 2\n    },\n    [Item.druidHands]: {\n        item: Item.druidHands,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        },\n        levelRequired: 2\n    },\n    [Item.druidHead]: {\n        item: Item.druidHead,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        },\n        levelRequired: 2\n    },\n    [Item.druidLegs]: {\n        item: Item.druidLegs,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        },\n        levelRequired: 2\n    },\n    [Item.fedora]: {\n        item: Item.fedora,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    [Item.greaves1]: {\n        item: Item.greaves1,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    [Item.greaves2]: {\n        item: Item.greaves2,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    [Item.hornedHelmet]: {\n        item: Item.hornedHelmet,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    [Item.leatherGloves]: {\n        item: Item.leatherGloves,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    [Item.nomadHelmet]: {\n        item: Item.nomadHelmet,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    [Item.pants1]: {\n        item: Item.pants1,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    [Item.pants2]: {\n        item: Item.pants2,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    [Item.plateChest1]: {\n        item: Item.plateChest1,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    [Item.plateChest2]: {\n        item: Item.plateChest2,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    [Item.plateChest3]: {\n        item: Item.plateChest3,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    [Item.plateChest4]: {\n        item: Item.plateChest4,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    [Item.plateGloves1]: {\n        item: Item.plateGloves1,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    [Item.plateGloves2]: {\n        item: Item.plateGloves2,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    [Item.plateHelmet]: {\n        item: Item.plateHelmet,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    [Item.platePants]: {\n        item: Item.platePants,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    [Item.plateShoulders1]: {\n        item: Item.plateShoulders1,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    [Item.plateShoulders2]: {\n        item: Item.plateShoulders2,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        },\n    },\n    [Item.robe]: {\n        item: Item.robe,\n        cost: {\n            resources: { wood: 10, iron: 45},\n            time: time.ONE_HOUR,\n        }\n    },\n    [Item.shoulders1]: {\n        item: Item.shoulders1,\n        cost: {\n            resources: { wood: 10, iron: 45},\n            time: time.ONE_HOUR,\n        }\n\n    },\n    [Item.shoulders2]: {\n        item: Item.shoulders2,\n        cost: {\n            resources: { wood: 10, iron: 45},\n            time: time.ONE_HOUR,\n        }\n\n    },\n    [Item.shoulders3]: {\n        item: Item.shoulders3,\n        cost: {\n            resources: { wood: 10, iron: 45},\n            time: time.ONE_HOUR,\n        }\n\n    },\n    [Item.vest]: {\n        item: Item.vest,\n        cost: {\n            resources: { wood: 10, iron: 45},\n            time: time.ONE_HOUR,\n        }\n    },\n};\nexport default armoursmithProduction;\n","import React, { PropsWithChildren, useEffect, useRef, useState } from 'react';\nimport { TooltipManager } from 'global/TooltipManager';\nimport { InfoWindow } from 'components/ui/modals/InfoWindow';\nimport './styles/tooltip.scss';\n\nconst ARROW_SIZE = 8; // warning: sync to tooltip.css var\nconst PADDING = 8;\n\nexport interface Props {\n    referenceRect: ClientRect;  // place tooltip in reference to this rect\n    placement?: Placement;\n    className?: string;\n}\n\nexport enum Placement {\n    bottom,\n    top,\n    left,\n    right,\n}\n\nexport const Tooltip = (props: PropsWithChildren<Props>) => {\n    const { children, referenceRect } = props;\n    let { className = \"\" } = props;\n    const ref = useRef<HTMLDivElement>(null);\n    const [placement, setPlacement] = useState<Placement>(props.placement || Placement.bottom);\n\n    const [containerRect, setContainerRect] = useState<ClientRect>(); // This is the\n\n    useEffect(() => {\n        // Reposition if needed\n        const tooltipElement = ref.current;\n        if (!tooltipElement) return;\n        if (!containerRect) return;\n        const tooltipRect = tooltipElement.getBoundingClientRect();\n\n        // Flip vertically\n        switch (placement) {\n            case Placement.top:\n                if (tooltipRect.top - tooltipRect.height - ARROW_SIZE - PADDING < containerRect!.top) {\n                    // Too high, place underneath\n                    setPlacement(Placement.bottom);\n                    return;\n                }\n                break;\n            case Placement.bottom:\n                if (tooltipRect.top + tooltipRect.height + ARROW_SIZE + PADDING > containerRect!.height) {\n                    // Too low, place top\n                    setPlacement(Placement.top);\n                    return;\n                }\n                break;\n        }\n        tooltipElement.style.opacity = \"1\"; // animated through css\n\n        const contentElement = tooltipElement.querySelector(\".tooltip-content\") as HTMLElement;\n        if (tooltipRect.left < containerRect!.left + PADDING) {\n            // Check left bounding edge\n            const offset = containerRect!.left - tooltipRect.left + PADDING;\n            contentElement.style.transform = `translateX(${offset}px)`;\n        } else if (tooltipRect.right > containerRect!.right - PADDING) {\n            // Check right bounding edge\n            const offset = tooltipRect.right - containerRect!.right + PADDING;\n            contentElement.style.transform = `translateX(${-offset}px)`;\n        } else {\n            contentElement.style.transform = '';\n        }\n\n    }, [setPlacement, containerRect, placement, referenceRect]);\n\n    const resize = () => {\n        TooltipManager.clear();\n    }\n\n    useEffect(() => {\n        setContainerRect(ref.current?.closest('.app')?.getBoundingClientRect());\n\n        window.addEventListener(\"resize\", resize);\n        return () => {\n            window.removeEventListener(\"resize\", resize);\n        };\n    }, []);\n\n\n    let x = 0;\n    let y = 0;\n\n    if (containerRect) {\n        switch (placement) {\n            case Placement.bottom:\n                x = referenceRect.left - containerRect!.left + referenceRect.width / 2;\n                y = referenceRect.top - containerRect!.top + referenceRect.height;\n                className += \" tooltip-bottom\";\n                break;\n            case Placement.top:\n                x = referenceRect.left - containerRect!.left + referenceRect.width / 2;\n                y = referenceRect.top - containerRect!.top;\n                className += \" tooltip-top\";\n                break;\n        }\n    }\n\n    return (\n        <div className={`tooltip ${className}`}\n            style={{\n                left: x,\n                opacity: 0,\n                top: y,\n            }}\n            ref={ref}\n        >\n            <div className=\"tooltip-arrow\" />\n            <InfoWindow className=\"tooltip-content\">\n                {children}\n            </InfoWindow>\n        </div>\n    );\n}\n\nexport default Tooltip;\n","// tslint:disable:object-literal-sort-keys\n\nimport * as time from \"utils/format/time\";\nimport { Item } from \"../items/types\";\nimport { ProductionDefinition } from \"./types\";\n\n\nconst workshopProduction: {[key: string]: ProductionDefinition} = {\n    [Item.torch]: {\n        item: Item.torch,\n        cost: {\n            resources: { wood: 2, fabric: 1 },\n            time: time.ONE_MINUTE,\n        },\n    },\n    [Item.sandwich]: {\n        item: Item.sandwich,\n        cost: {\n            resources: { food: 1 },\n            time: time.ONE_MINUTE / 2,\n        },\n    }\n};\nexport default workshopProduction;\n\n","// tslint:disable:object-literal-sort-keys\n\n// import * as time from \"utils/time\";\n// import { Item } from \"../items/types\";\nimport { ProductionDefinition } from \"./types\";\n\nconst alchemistProduction: {[key: string]: ProductionDefinition} = {\n};\nexport default alchemistProduction;\n\n","import weaponsmithProduction from './weaponsmith'\nimport armoursmithProduction from './armoursmith'\nimport { Structure } from 'definitions/structures';\nimport { Item } from 'definitions/items/types';\nimport { ProductionDefinition } from './types';\nimport workshopProduction from './workshop';\nimport alchemistProduction from './alchemist';\n\n// Returns the structure that produces given Item, or null if this Item is not produced anywhere\nexport const getProductionStructureForItem = (item: Item): Structure | null => {\n    if (alchemistProduction[item]){\n        return Structure.alchemist;\n    }\n    if (armoursmithProduction[item]){\n        return Structure.armoursmith;\n    }\n    if (weaponsmithProduction[item]){\n        return Structure.weaponsmith;\n    }\n    if (workshopProduction[item]){\n        return Structure.workshop;\n    }\n    return null;\n}\n\n\nconst all = {\n    ...alchemistProduction,\n    ...armoursmithProduction,\n    ...weaponsmithProduction,\n    ...workshopProduction\n};\n\nexport const getDefinition = (item: Item): ProductionDefinition => {\n    return all[item];\n}\n\n\n","import { createSelector } from \"reselect\";\nimport { StoreState } from \"store/types\";\nimport { TasksStoreState } from 'store/types/tasks';\nimport { Structure } from 'definitions/structures';\n\nconst getTasks = (state: StoreState) => state.tasks;\n\n/*\n * Returns a selector for the store that selects all crafting tasks running for given structure */\nexport const createSelectCraftingTasksByStructure = (structure: Structure) => {\n    const craftingTasksByStructure = (tasks: TasksStoreState) => {\n        return tasks.running.filter((val) => val.origin === `${structure}.craft`);\n    };\n    return createSelector([\n        getTasks],\n        craftingTasksByStructure,\n    );\n}\n\n/*\n * Returns a selector for the store that selects all study tasks running for given structure */\nexport const createSelectStudyingTasksByStructure = (structure: Structure) => {\n    const studyingTasksByStructure = (tasks: TasksStoreState) => {\n        return tasks.running.filter((val) => val.origin === `${structure}.study`);\n    };\n    return createSelector([\n        getTasks],\n        studyingTasksByStructure,\n    );\n}\n\n/*\n * Returns a selector for the store that selects all upgrade tasks running for given structure \n * Typically 0 or 1 */\nexport const createSelectUpgradeTasksByStructure = (structure: Structure) => {\n    const upgradeTasksByStructure = (tasks: TasksStoreState) => {\n        return tasks.running.filter((val) => val.name === `${structure}.upgrade`);\n    };\n    return createSelector([\n        getTasks],\n        upgradeTasksByStructure,\n    );\n}\n","import { useSelector } from 'react-redux';\nimport { TasksStoreState } from 'store/types/tasks';\nimport { createSelectCraftingTasksByStructure, createSelectStudyingTasksByStructure, createSelectUpgradeTasksByStructure } from 'store/selectors/tasks';\nimport { Structure } from 'definitions/structures';\nimport { StoreState } from 'store/types';\n\n// Returns all the tasks from redux store\nexport const useTasksState = () => {\n    return useSelector<StoreState, TasksStoreState>(store => store.tasks);\n}\n\n// Returns all running crafting tasks for given structure\nexport const useCraftingTasksStateByStructure = (structure: Structure) => {\n    return useSelector(createSelectCraftingTasksByStructure(structure));\n}\n\n// Returns all running crafting tasks for given structure\nexport const useStudyingTasksStateByStructure = (structure: Structure) => {\n    return useSelector(createSelectStudyingTasksByStructure(structure));\n}\n\n// Returns all running update tasks for given structure\nexport const useUpgradeTasksStateByStructure = (structure: Structure) => {\n    return useSelector(createSelectUpgradeTasksByStructure(structure));\n}\n\n","import * as time from \"utils/format/time\";\n\nexport const STUDY_TIME = time.TWO_MINUTES;","import * as React from \"react\";\nimport { Item } from 'definitions/items/types';\nimport { getDefinition as getProductionDefinition, getProductionStructureForItem } from 'definitions/production';\nimport useStructureState from 'hooks/store/useStructureState';\nimport { Structure } from 'definitions/structures';\nimport { ProductionStructureStoreState, StructureState } from 'store/types/structure';\nimport { getDefinition as getItemDefinition } from 'definitions/items';\nimport { Link } from 'react-router-dom';\nimport { getStructureLink } from 'utils/routing';\nimport { TextManager } from 'global/TextManager';\nimport { useStudyingTasksStateByStructure } from 'hooks/store/useTasksState';\nimport { startTask } from 'store/actions/tasks';\nimport { TaskType } from 'store/types/task';\nimport { useDispatch } from 'react-redux';\nimport { addItemToToProduces } from 'store/actions/structures';\nimport { formatDuration } from 'utils/format/time';\nimport { STUDY_TIME } from 'mechanics/studying';\nimport Button from 'components/ui/buttons/Button';\n\ninterface Props {\n    item: Item;\n}\n\nconst ProduceOrStudy = (props: Props) => {\n    const structure = getProductionStructureForItem(props.item);\n    const itemDefinition = getItemDefinition(props.item);\n    if (itemDefinition.unique) {\n        return (\n            <p>Unique item</p>\n        )\n    }\n    if (!structure) {\n        return null;\n    }\n    return (\n        <ProducedAtStructure item={props.item} structure={structure} />\n    )\n}\n\nconst ProducedAtStructure = (props: Props & { structure: Structure}) => {\n    const {structure} = props;\n    const structureStore: ProductionStructureStoreState = useStructureState(structure);\n    const studyTasks = useStudyingTasksStateByStructure(structure);\n    const dispatch = useDispatch();\n\n    if (!structure) {\n        return null;\n    }\n\n    // const structureDefinition = getStructureDefinition<ProductionStructureDefinition>(structure);\n    // Can already be produced\n    if (structureStore.produces.some((item: Item) => item === props.item)){\n        return (\n            <p>Constructed at:&nbsp;\n                <Link to={getStructureLink(structure)} >\n                    { TextManager.getStructureName(structure) }\n                </Link>\n            </p>\n        )\n    }\n\n    // Currently studied\n    const task = studyTasks.find(sT => sT.name === props.item);\n    if (task) {\n        return (\n            <p>\n                <Link to={getStructureLink(structure)} >\n                    {TextManager.get(\"ui-tooltip-study-currently-studying\")}\n                </Link>\n                {formatDuration(task.timeRemaining, true)}\n            </p>\n        )\n    }\n\n    // Cant study because the structure is not high lvl enough\n    const productionDefinition = getProductionDefinition(props.item);\n    if (structureStore.level < (productionDefinition.levelRequired || 0) || structureStore.state !== StructureState.Built) {\n\n        return (\n            <p className=\"invalid\">\n                {TextManager.get(\"ui-tooltip-study-requires-structure-level\", { structure, level: (productionDefinition.levelRequired || 0) + 1})}\n            </p>\n        )\n    }\n\n    const startStudy = () => {\n        const callbacks = [\n            addItemToToProduces(props.structure, props.item)\n        ];\n\n        const studyTime = STUDY_TIME;\n        const start = startTask(TaskType.studyItem,\n            props.item,\n            `${structure}.study`,\n            studyTime,\n            callbacks);\n        dispatch(start);\n    }\n\n    return (\n        <p>\n            <Button onClick={startStudy} size=\"small\">\n                {TextManager.get(\"ui-tooltip-study-start-study\")}\n            </Button>\n        </p>\n    );\n}\n\nexport default ProduceOrStudy;","import * as React from \"react\";\nimport { WeaponDefinition, DamageType, WeaponTypeDefinition, WeaponType } from 'definitions/items/weapons';\nimport { TextManager } from 'global/TextManager';\nimport ProduceOrStudy from './ProduceOrStudy';\n\ninterface Props {\n    info: WeaponDefinition;\n}\n\nconst WeaponContent = (props: Props) => {\n    const { info } = props;\n    const subtext = TextManager.getItemSubtext(info.item);\n    const weaponType = TextManager.getWeaponType(info.weaponType);\n    const { classification } = WeaponTypeDefinition[info.weaponType];\n    const classificationText = TextManager.getWeaponClassification(classification);\n\n    return (\n        <>\n            <div>{weaponType}\n              {info.weaponType !== WeaponType.shield && (` (${classificationText})`)}\n            </div>\n            { subtext && (<p className=\"subtext\">{`\"${subtext}\"`}</p>)}\n            { info.damage && <p> damage: { info.damage[DamageType.kinetic] } </p>}\n            <ProduceOrStudy item={info.item} />\n        </>\n    );\n\n}\n\nexport default WeaponContent;","import * as React from \"react\";\nimport { TextManager } from 'global/TextManager';\nimport { ApparelDefinition } from 'definitions/items/apparel';\nimport ProduceOrStudy from './ProduceOrStudy';\n\ninterface Props {\n    info: ApparelDefinition;\n}\n\nconst ApparelContent = (props: Props) => {\n    const { info } = props;\n    const { damageReduction } = info;\n    const subtext = TextManager.getItemSubtext(info.item);\n    const equipmentSlot = TextManager.getEquipmentSlot(info.equipmentType);\n    return (\n        <>\n            <div>{`${equipmentSlot}`}</div>\n            { subtext && (<p className=\"subtext\">{`\"${subtext}\"`}</p>)}\n            { damageReduction && <p> { TextManager.get(\"ui-tooltip-damage-reduction\", { damageReduction}) } </p> }\n            <ProduceOrStudy item={info.item} />\n        </>\n    );\n};\n\nexport default ApparelContent;","import * as React from \"react\";\nimport { ApparelDefinition } from \"definitions/items/apparel\";\nimport { DeedDefinition } from \"definitions/items/deeds\";\nimport { ItemDefinition, ItemType } from \"definitions/items/types\";\nimport { WeaponDefinition } from \"definitions/items/weapons\";\nimport DeedContent from './DeedContent';\nimport WeaponContent from './WeaponContent';\nimport ApparelContent from './ApparelContent';\nimport { TextManager } from 'global/TextManager';\nimport \"./styles/itemContext.scss\";\n\nexport interface Props {\n    info: ItemDefinition;\n}\n\nconst ItemContext = (props: Props) => {\n\n    const info = props.info;\n    switch (info.itemType) {\n        case ItemType.deed:\n           return <DeedContent info={info as DeedDefinition} />;\n\n        case ItemType.weapon:\n            return <WeaponContent info={info as WeaponDefinition} />;\n\n        case ItemType.apparel:\n            return <ApparelContent info={info as ApparelDefinition} />;\n\n        default: {\n            const subtext = TextManager.getItemSubtext(info.item);\n            return (subtext && (<p className=\"subtext\">{`\"${subtext}\"`}</p>)) || null;\n        }\n    }\n}\nexport default ItemContext;","import * as React from \"react\";\nimport { TextManager } from 'global/TextManager';\nimport { useSelector } from 'react-redux';\nimport { StoreState } from 'store/types';\nimport { StructuresStoreState } from 'store/types/structures';\nimport { Resource } from 'definitions/resources';\nimport { getStructureByResource, getDefinition } from 'definitions/structures';\nimport { StructureState, StructureStoreState } from 'store/types/structure';\nimport { getStructureLink } from 'utils/routing';\nimport { Link } from 'react-router-dom';\nimport { ResourceStructureLevelDefinition, ResourceStructureDefinition } from 'definitions/structures/types';\nimport { useMaxResourcesState, useResourcesState } from 'hooks/store/resources';\nimport { formatNumber } from 'utils/format/number';\nimport useGoldState from 'hooks/store/useGoldState';\nimport { useWorkersFreeState, useWorkersState } from 'hooks/store/useWorkersState';\nimport './resourceContext.scss';\n\nexport interface Props {\n    info: string;\n}\n\nconst ResourceContext = (props: Props) => {\n\n    const resource = props.info;\n    const resourcesState = useResourcesState();\n    const goldState = useGoldState();\n    const workersState = useWorkersState();\n    const workersFreeState = useWorkersFreeState();\n    const structureStates = useSelector<StoreState, StructuresStoreState>(store => store.structures);\n    const maxResources = useMaxResourcesState();\n\n    const renderProducedBy = () => {\n        const structure = getStructureByResource(resource as Resource);\n        const structureState: StructureStoreState = structureStates[structure];\n        if (structureState.state !== StructureState.Built) {\n            return (\n                <span>\n                    {TextManager.get(\"ui-tooltip-resource-produce-row-notbuilt\", {\n                        structure: TextManager.getStructureName(structure)\n                    })}\n                </span>\n            )\n        }\n        const structureDefinition = getDefinition<ResourceStructureDefinition>(structure);\n        const levelDefinition: ResourceStructureLevelDefinition = structureDefinition.levels[structureState.level];\n        const amount = levelDefinition.generates[resource as Resource];\n        // Split the string at {{structure}}\n        const split = TextManager.get(\"ui-tooltip-resource-produce-row\", {\n            structure: \"%SPLIT%\",\n            amount\n        }).split(\"%SPLIT%\");\n        return (\n            <span className=\"produced\">\n                {split[0]}\n                <Link to={getStructureLink(structure)} >\n                    { TextManager.getStructureName(structure) }\n                </Link>\n                {split[1]}\n            </span>\n        )\n    }\n\n    switch (resource) {\n        case Resource.fabric:\n        case Resource.food:\n        case Resource.iron:\n        case Resource.leather:\n        case Resource.stone:\n        case Resource.wood: {\n            const amount = formatNumber(resourcesState[resource]!, 0);\n            const full = resourcesState[resource]! >= maxResources[resource]!;\n            return (\n                <div className=\"resource-context\">\n                    <div className=\"info\">\n                        {TextManager.get(`resource-${resource}-info`)}\n                    </div>\n                    <div>\n                        {TextManager.get(`ui-tooltip-resource-quantity`, { amount } )}\n                    </div>\n                    <div>\n                        {renderProducedBy()}\n                    </div>\n                    { full && (\n                        <div className=\"warning-full\">\n                            {TextManager.get(`ui-tooltip-resource-warehouse-full`, { resource })}\n                        </div>\n                    )}\n                </div>\n            )\n        }\n        case \"gold\": {\n            const amount = goldState;\n            return (\n                <>\n                    <div className=\"resource-context\">\n                        <div className=\"info\">\n                            {` ${TextManager.get(`resource-${resource}-info`)}`}\n                        </div>\n                    </div>\n                    <div>\n                        {TextManager.get(`ui-tooltip-resource-quantity`, { amount } )}\n                    </div>\n                </>\n            )\n        }\n        case \"workers\": {\n            const free = workersFreeState;\n            const total = workersState;\n            return (\n                <>\n                    <div className=\"resource-context\">\n                       <div className=\"info\">\n                        {` ${TextManager.get(`resource-${resource}-info`)}`}\n                        </div>\n                    </div>\n                    <div>\n                        {TextManager.get(`ui-tooltip-workers-quantity`, { free, total } )}\n                    </div>\n                </>\n            )\n        }\n        default:\n            throw new Error(\"Uknow value \" + resource);\n    }\n\n}\nexport default ResourceContext;","import React, { ComponentProps, PropsWithChildren } from 'react';\nimport './styles/infoWindow.scss';\n\nexport interface Props {\n    className?: string;\n}\n\n// An InfoWindow is a semi transparant black square. It is used for tooltips\n// and InfoModal\nexport const InfoWindow = (props: PropsWithChildren<Props> & ComponentProps<\"div\">) => {\n    const { className, children, ...otherProps } = props;\n    return (\n        <div\n            {...otherProps}\n            className={`info-window ${className || \"\"}`}\n        >\n            {children}\n        </div>\n    )\n}\n","import * as React from \"react\";\nimport { useDelta } from 'hooks/store/engine';\nimport { useEffect, useState } from 'react';\nimport PlainProgressbar from \"./PlainProgressbar\";\nimport usePrevious from \"hooks/usePrevious\";\n\nexport enum Direction {\n    increasing,\n    decreasing\n}\n\nexport interface Props {\n    progress: number;     // between 0 and 1\n    label?: string;\n    className?: string;\n    direction?: Direction; // only used to prevent the bar from animating back to the start state\n    animate?: boolean;\n}\n\nconst TickingProgressbar = (props: Props) => {\n    const { className = \"\", label, direction, progress = 0} = props;\n    const previousProgress = usePrevious(progress) || 0;\n    // We use the delta time since last tick to animate\n    const delta = useDelta();\n\n    // If we have a direction defined and we're going the other direction, dont animate\n    // because we've basically reset the progress bar and we just want to animate in one direction\n    const [animate, setAnimate] = useState(false);\n\n    useEffect(() => {\n        setAnimate(\n             direction === undefined ||\n            (direction === Direction.increasing && progress > previousProgress) ||\n            (direction === Direction.decreasing && progress < previousProgress)\n        );\n    }, [direction, progress]); // see https://github.com/facebook/react/issues/20752\n\n    // previousProgress.current = progress;\n    return (\n        <PlainProgressbar\n            progress={progress}\n            label={label}\n            className={className}\n            animationTime={animate ? delta : 0}\n        />\n    );\n};\n\nexport default TickingProgressbar;\n","import * as React from \"react\";\nimport { TextManager } from 'global/TextManager';\nimport { TraitDefinition } from 'definitions/traits/types';\n import './styles/traitContext.scss';\n\nexport interface Props {\n    traitDefinition: TraitDefinition;\n}\n\nconst TraitContext = (props: Props) => {\n\n    const {traitDefinition} = props;\n\n    return (\n        <div className=\"trait-context\">\n            <div className=\"description\">\n                {TextManager.getTraitDescription(traitDefinition.trait)}\n            </div>\n            { traitDefinition.hasEffect && (\n            <div className=\"effect\">\n                {TextManager.getTraitEffect(traitDefinition.trait)}\n\n            </div>)}\n        </div>\n    )\n}\nexport default TraitContext;","import React, { ReactNode, useEffect, useState } from 'react';\nimport { ContextType } from 'constants/context';\nimport { TooltipManager, Context, EVENT_CONTEXT_UPDATED } from 'global/TooltipManager';\nimport { TextManager } from 'global/TextManager';\nimport ItemContext from './context/ItemContext';\nimport { ItemDefinition } from 'definitions/items/types';\nimport { Resource } from 'definitions/resources';\nimport ResourceContext from './context/ResourceContext';\nimport Tooltip from '../Tooltip';\nimport { TraitDefinition } from 'definitions/traits/types';\nimport TraitContext from './context/TraitContext';\nimport { WeaponType } from 'definitions/items/weapons';\nimport { Rarity } from 'constants/items';\nimport './styles/contextTooltip.scss';\n\n// A contextual popup showing what you just clicked.\n// Can be an Item, Resource, Trait, skill\nconst ContextTooltip = () => {\n\n    const [selectedContext, setSelectedContext] = useState<Context | undefined>();\n\n    const tooltipUpdated = (context: Context | undefined) => {\n        setSelectedContext(context);\n    }\n    useEffect(() => {\n        TooltipManager.instance.addListener(EVENT_CONTEXT_UPDATED, tooltipUpdated);\n        return () => {\n            TooltipManager.instance.removeListener(EVENT_CONTEXT_UPDATED, tooltipUpdated);\n        }\n    }, []);\n    if (!selectedContext) { return null; }\n\n    const { info, type, className } = selectedContext;\n    const renderContent = () => {\n        switch (type) {\n            case ContextType.resource: {\n                const name = TextManager.getResourceName(info as Resource);\n                return (\n                    <>\n                        <div className=\"name resource\">{name}</div>\n                        <ResourceContext info={info as string} />\n                    </>\n                );\n            }\n            case ContextType.item: {\n                const name = TextManager.getItemName((info as ItemDefinition).item);\n                const itemDefinition = info as ItemDefinition;\n                return (\n                    <>\n                        <div className={`name item ${getItemNameClassName(itemDefinition)}`}>{name}</div>\n                        <ItemContext info={itemDefinition} />\n                    </>\n                );\n            }\n            case ContextType.trait: {\n                const traitDefinition = info as TraitDefinition;\n                const name = TextManager.getTraitName(traitDefinition.trait);\n                return (\n                    <>\n                        <div className=\"name trait\">\n                            {TextManager.get(\"ui-tooltip-type-trait\")}\n                            {name}\n                        </div>\n                        <TraitContext traitDefinition={traitDefinition} />\n                    </>\n                );\n            }\n            case ContextType.skill: {\n                const skill = info as WeaponType;\n                const name = TextManager.getSkillName(skill);\n                return (\n                    <>\n                        <div className=\"name skill\">\n                            {TextManager.get(\"ui-tooltip-type-skill\")}\n                            {name}\n                        </div>\n                        { TextManager.getSkillInfo(skill)}\n                    </>\n                );\n            }\n            case ContextType.component: {\n                const component = info as ReactNode;\n                return component;\n            }\n            default: {\n                throw new Error(`Unknown context type ${selectedContext.type}`)\n            }\n        }\n    }\n\n    return (\n        <Tooltip referenceRect={selectedContext.referenceRect} className={className}>\n            <div className=\"context-tooltip\">\n                {renderContent()}\n            </div>\n        </Tooltip>\n    )\n}\nexport default ContextTooltip;\n\nexport const getItemNameClassName = (item: ItemDefinition): string => {\n    const {rarity} = item;\n    switch (rarity) {\n        case Rarity.common:\n            return \"item-name-common\";\n        case Rarity.uncommon:\n            return \"item-name-uncommon\";\n        case Rarity.rare:\n            return \"item-name-rare\";\n        case Rarity.epic:\n            return \"item-name-epic\";\n        case Rarity.legendary:\n            return \"item-name-legendary\";\n    }\n    return \"item-name-common\";\n};\n","\nimport { StoreState } from 'store/types';\nimport { useSelector } from 'react-redux';\nimport { EngineStoreState } from 'store/types/engine';\n\n// Returns the 'engine' part from redux store\nexport const useEngine = () => {\n    return useSelector<StoreState, EngineStoreState>(store => store.engine);\n}\n\nexport const useDelta = () => {\n    const engine = useEngine();\n    return Date.now() - engine.previousTick;\n}","import React from \"react\";\nimport { Structure } from 'definitions/structures';\nimport \"./styles/structureViewHeader.scss\";\n\ninterface Props {\n    structure: Structure;\n}\n\nconst StructureViewHeader = (props: Props) => {\n    // const displayName = TextManager.getStructureName(props.structure);\n    return (\n        <div className={`structureview-header structureview-header-${props.structure}`}>\n            {/* <h1 className=\"app-h1-white\">{displayName}</h1> */}\n        </div>\n    );\n}\n\nexport default StructureViewHeader;","import * as React from \"react\";\nimport { AnyAction } from \"redux\";\nimport { TextManager } from 'global/TextManager';\nimport { subtractGold } from 'store/actions/gold';\nimport { addLogText } from 'store/actions/log';\nimport { LogChannel } from 'store/types/logEntry';\nimport { getDefinition, Structure } from 'definitions/structures';\nimport useGoldState from 'hooks/store/useGoldState';\nimport { useDispatch } from 'react-redux';\nimport { upgradeStructure } from 'store/actions/structures';\nimport useStructureState from 'hooks/store/useStructureState';\nimport Button from 'components/ui/buttons/Button';\nimport { startTask } from 'store/actions/tasks';\nimport { TaskType } from 'store/types/task';\nimport { useUpgradeTasksStateByStructure } from 'hooks/store/useTasksState';\nimport { formatDuration } from 'utils/format/time';\nimport \"./styles/structureLevel.scss\";\nimport { TickingProgressbar } from \"components/ui/common/progress\";\n\nexport interface Props {\n    structure: Structure;\n    onHelpClicked?: (e: React.MouseEvent) => void;\n    addUpgradeCallbacks?: (level: number) => AnyAction[]; // add custom actions after upgrade is done\n}\n\nconst StructureLevel = (props: Props) => {\n    const {\n        structure,\n        onHelpClicked,\n        addUpgradeCallbacks\n    } = props;\n    const dispatch = useDispatch();\n    const gold = useGoldState();\n\n    const structureState = useStructureState(structure);\n    const level: number = structureState.level;\n    const structureDefinition = getDefinition(props.structure);\n\n    const nextLevel = structureDefinition.levels[level + 1];\n    const nextLevelCost = (nextLevel != null ? nextLevel.cost.gold || 0 : -1);\n    const canUpgrade = nextLevel != null && gold >= nextLevelCost;\n    const upgradeText = nextLevel == null ? TextManager.get(\"ui-structure-upgrade-max\") : TextManager.get(\"ui-structure-upgrade\", { cost: nextLevelCost, level: level + 2 });\n\n    const upgradeTasks = useUpgradeTasksStateByStructure(structure);\n\n    const handleUpgrade = (cost: number) => {\n        dispatch(subtractGold(cost));\n\n        const callbacks = [\n            ...(addUpgradeCallbacks?.(level + 1) || []),\n            upgradeStructure(structure),\n            addLogText(\"log-town-upgrade-structure-complete\", {\n                level: level + 1,\n                structure,\n            }, LogChannel.town)\n        ];\n        const time = nextLevel.cost.time ?? 0;\n        const start = startTask(TaskType.upgradeStructure,\n            `${structure}.upgrade`,\n            \"town\",\n            time,\n            callbacks);\n        dispatch(start);\n    }\n\n    if (upgradeTasks.length) {\n        const t = upgradeTasks[0];\n        return (\n            <TickingProgressbar\n                key={`${t.name}${t.startTime}`}\n                className=\"upgrading\" // todo: margin: 8\n                label={`${TextManager.get(\"structure-upgrade-button-upgrading\")} (${formatDuration(t.timeRemaining)})`}\n                progress={t.progress}\n            />\n        )\n    }\n\n    return (\n        <div className=\"upgrade-stucture-button\">\n            <label>\n                {TextManager.get(\"ui-structure-level\")}\n                { level + 1 }\n            </label>\n            <Button\n                className=\"upgrade\"\n                onClick={() => {handleUpgrade(nextLevelCost)}}\n                disabled={!canUpgrade}>\n                    { upgradeText }\n            </Button>\n            { nextLevel != null && (\n                <Button className=\"help\" square={true} onClick={onHelpClicked}>\n                    ?\n                </Button>\n            )}\n        </div>\n    );\n};\n\nexport default StructureLevel;","import * as React from \"react\";\nimport { getDefinition, Structure } from 'definitions/structures';\nimport { formatDuration } from 'utils/format/time';\nimport { ProductionStructureDefinition } from 'definitions/structures/types';\nimport { IconSize } from 'components/ui/common/Icon';\nimport { TextManager } from 'global/TextManager';\nimport { Item } from 'definitions/items/types';\nimport ItemIcon from 'components/ui/items/ItemIcon';\nimport \"./styles/upgradeHelpModal.scss\"\n\nexport interface Props  {\n    structure: Structure;\n    level: number;\n}\n\nconst UpgradeHelpModal = (props: Props) => {\n    const { level, structure } = props;\n    const structureDefinition: ProductionStructureDefinition = getDefinition(structure);\n    const nextLevel = structureDefinition.levels[level + 1];\n\n    const renderRow = (item: Item) => {\n        return (\n            <ItemIcon key={item} item={item} size={IconSize.small} />\n        )\n    }\n\n    return (\n        <div className=\"production-upgrade-help-modal\">\n            <div className=\"top\">\n                <h3>{TextManager.get(\"ui-structure-help-upgrade-title\", { structure } )}</h3>\n                <div className=\"cost\">\n                    <section>\n                        {TextManager.get(\"ui-structure-help-upgrade-cost-gold\", { gold: nextLevel.cost.gold})}\n                    </section>\n                    { nextLevel.cost.time && <section>{formatDuration(nextLevel.cost.time)}</section> }\n                </div>\n            </div>\n            <div className=\"unlocks\">\n                {nextLevel.unlocks.map(item => renderRow(Item[item]))}\n            </div>\n        </div>\n    )\n}\n\nexport default UpgradeHelpModal;","// Todo: come up with a less retarded name\nimport * as React from \"react\";\nimport \"./styles/updownvalue.scss\";\n\nexport interface DispatchProps {\n    onUp?: (e: React.MouseEvent) => void;\n    onDown?: (e: React.MouseEvent) => void;\n}\nexport interface Props extends DispatchProps {\n    label?: string;\n    value?: number;\n    max?: number;\n    upDisabled?: boolean;\n    downDisabled?: boolean;\n}\n\nconst UpDownValue = (props: Props) => {\n    const handleUp = (e: React.MouseEvent) => {\n        if (props.onUp && !props.upDisabled) { props.onUp(e); }\n    };\n\n    const handleDown = (e: React.MouseEvent) => {\n        if (props.onDown && !props.downDisabled) { props.onDown(e); }\n    };\n\n    let displayValue;\n    if (props.max == null) {\n        displayValue = props.value;\n    } else {\n        displayValue = <span>\n            { props.value } / <span className=\"max\">{ props.max }</span>\n        </span>;\n    }\n    return (\n        <div className=\"updownvalue\">\n            <label> { props.label }</label>\n            { displayValue }\n            <i className= { \"arrow up\" + (props.upDisabled ? \" disabled\" : \"\" )}\n                onClick= { handleUp }\n            />\n            <i className={\"arrow down\" + (props.downDisabled ? \" disabled\" : \"\")}\n                onClick= { handleDown }\n            />\n        </div>\n    );\n};\n\nexport default UpDownValue;\n","import * as React from \"react\";\nimport { getDefinition } from \"definitions/items\";\nimport { Item } from \"definitions/items/types\";\nimport { TextManager } from \"global/TextManager\";\nimport useStockpileState from 'hooks/store/useStockpileState';\nimport { useMemo } from 'react';\nimport Icon from 'components/ui/common/Icon';\nimport \"./styles/itemsBox.scss\";\n\nexport interface Props {\n    className?: string;\n    items: Item[];\n\n   // itemsInInventory?: Item[]; // Items that are in `items` array and also in inventory\n}\n\n\n/**\n * The ItemsBox displays a list of items, to be used as requirements for something\n */\nconst ItemsBox = (props: Props) => {\n    const { items } = props;\n    const className = (props.className || \"\") + \" items-box\";\n    const aggregate = items.reduce<{[key: string]: number}>((acc, value) => {\n        if (!acc[value]) {\n            acc[value] = 0;\n        }\n        acc[value]++;\n        return acc;\n    }, {});\n\n    const stockpile = useStockpileState();\n    const itemsInInventory: Item[] = useMemo(() => {\n        const tmpWarehouse = [ ...stockpile];\n        const tmpItems: Item[] = [];\n        items.forEach((item: Item) => {\n            const found = tmpWarehouse.findIndex((i) => i === item);\n            if (found > -1) {\n                // Remove the item from tmpWarehouse and add to itemsInInventory\n                const [ removed ] = tmpWarehouse.splice(found, 1);\n                if (removed) {\n                    tmpItems.push(removed);\n                }\n            }\n        });\n        return tmpItems;\n    }, [items, stockpile]);\n\n\n    const listItems = Object.keys(aggregate).map((key: string) => {\n        const item = key as Item;\n        const amount = aggregate[key] as number;\n        let listItemClass = \"item\";\n\n        // Check if we have enough\n        const amountInInventory = itemsInInventory ? itemsInInventory.filter((i) => i === item).length : 0;\n        if (amount > amountInInventory) {\n            listItemClass += \" missing\";\n        }\n        const itemDescription = getDefinition(item);\n        return (\n            <li className={listItemClass} key={item}>\n                <Icon\n                    image={itemDescription.iconImg}\n                    size=\"smallest\"\n                />\n                <div className=\"name\">\n                    { `${TextManager.getItemName(item)} (${ amount })` }\n                </div>\n            </li>\n        );\n    });\n\n    return (\n        <ul className={className} >\n            {listItems}\n        </ul>\n    );\n};\n\nexport default ItemsBox;\n","import { Resource } from \"definitions/resources\";\nimport resourceDescriptions from \"definitions/resources\";\nimport * as React from \"react\";\nimport { ResourceStoreState } from \"store/types/resources\";\nimport { TextManager } from \"global/TextManager\";\nimport { useMemo } from 'react';\nimport { useResourcesState } from 'hooks/store/resources';\nimport Icon from 'components/ui/common/Icon';\nimport { ContextType } from 'constants/context';\nimport { TooltipManager } from 'global/TooltipManager';\nimport \"./styles/resourcesCost.scss\";\n\nexport interface Props {\n    className?: string;\n    resources: ResourceStoreState;\n}\n\n/**\n * \n */\nconst ResourcesCost = (props: Props) => {\n    const {\n        resources,\n    } = props;\n\n    const storeResources = useResourcesState();\n    const sufficientResources = useMemo(() => {\n        return Object.keys(resources).reduce<{[key: string]: boolean}>((acc, value) => {\n            const resource = value as Resource;\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            acc[value] = storeResources[resource]! >= resources[resource]!;\n            return acc;\n        }, {});\n    }, [resources, storeResources]);\n\n    const className = (props.className || \"\") + \" resources-cost\";\n    const listItems = Object.keys(props.resources).map((key: string) => {\n        const resource = key as Resource;\n        let listItemClass = \"resource\";\n        if (sufficientResources && !sufficientResources[resource]) {\n            listItemClass += \" insufficient\";\n        }\n        const resourceDescription = resourceDescriptions[resource];\n        if (!resourceDescription) {\n            throw new Error(`No resource description found for ${resource}`);\n        }\n\n        const handleClick = (event: React.MouseEvent) => {\n\n            const origin = (event.currentTarget as HTMLElement);\n            const originRect = origin.getBoundingClientRect();\n            TooltipManager.showContextTooltip(ContextType.resource, resource, originRect);\n            event.stopPropagation();\n        };\n\n        return (\n            <li\n                className={listItemClass}\n                key={resource}\n            >\n                <Icon\n                    image={resourceDescription.iconImg}\n                    size=\"smallest\"\n                    onClick={handleClick}\n                />\n                <div className=\"name\">\n                    {TextManager.getResourceName(resource as Resource)}\n                </div>\n                <div className=\"amount\" >\n                    { props.resources[resource] }\n                </div>\n            </li>\n        );\n    });\n\n    return (\n        <ul className={className}>\n            {listItems}\n        </ul>\n    );\n};\n\nexport default ResourcesCost;","export const MAX_WORKERS_CRAFTING = 6;\n\n/**\n * Calculates the production time for productionDefinition with given amount of workers\n * @param productionDefinition\n * @param workers\n */\nexport const calculateProductionTime = (time: number, workers: number): number => {\n    if (workers > MAX_WORKERS_CRAFTING) {\n        throw new Error(`Cannot possibly have more than ${MAX_WORKERS_CRAFTING} on one item!`);\n    }\n    // Each additional worker shaves off 10% of the production time\n    return time - (.1 * time * (workers - 1));\n};\n","import React, { useState } from 'react';\nimport { useDispatch } from 'react-redux';\nimport useStockpileState from 'hooks/store/useStockpileState';\nimport Button from 'components/ui/buttons/Button';\nimport UpDownValue from 'components/ui/common/UpDownValue';\nimport ItemsBox from 'components/ui/items/ItemsBox';\nimport ResourcesCost from 'components/structures/production/ResourcesCost';\nimport { Item } from 'definitions/items/types';\nimport { TextManager } from 'global/TextManager';\nimport { useResourcesState } from 'hooks/store/resources';\nimport { useWorkersFreeState } from 'hooks/store/useWorkersState';\nimport { calculateProductionTime, MAX_WORKERS_CRAFTING } from 'mechanics/crafting';\nimport { formatDuration } from 'utils/format/time';\nimport { getDefinition as getProductionDefinition } from \"definitions/production\";\nimport { ProductionDefinition } from 'definitions/production/types';\nimport { addItemToWarehouse } from 'store/actions/items';\nimport { removeResources } from 'store/actions/resources';\nimport { increaseWorkers } from 'store/actions/structures';\nimport { startTask } from 'store/actions/tasks';\nimport { TaskType } from 'store/types/task';\nimport { Structure } from 'definitions/structures';\nimport { Resource } from 'definitions/resources';\n\nexport interface Props {\n    item: Item;\n    structure: Structure;\n}\n\nconst CraftingDetails = (props: Props) => {\n    const { item, structure } = props;\n    const dispatch = useDispatch();\n    const resourcesState = useResourcesState();\n    const stockpileState = useStockpileState();\n    const workersFree = useWorkersFreeState();\n    const [workersAssigned, setWorkersAssigned] = useState<number>(0);\n\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    const produces = getProductionDefinition(item)!;\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    const costResources = produces.cost.resources!;\n    const missingAtLeastOneResource = Object.keys(costResources)\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        .some((key) => { const resource:Resource = key as Resource; return costResources[resource]! > resourcesState[resource]! });\n\n    let missingAtLeastOneItem = false;\n    const costMaterials = produces.cost.materials;\n    if (costMaterials) {\n        missingAtLeastOneItem = costMaterials.some((i: Item) => stockpileState.indexOf(i) === -1);\n    }\n\n    const disabled = missingAtLeastOneResource || missingAtLeastOneItem || workersAssigned < 1;\n    // TODO: [10/07/2019] Perhaps each item can have a number of minimum workers?\n\n    const makeTimeString = (asNumber: number): string => {\n        if (workersAssigned === 0) {\n            return \"\";\n        }\n        const craftingTime = calculateProductionTime(asNumber, workersAssigned);\n        const time = formatDuration(craftingTime);\n        return TextManager.get(\"ui-structure-production-crafting-time\", { time });\n    };\n\n    const handleClick = (e: React.MouseEvent) => {\n        e.stopPropagation();\n\n        handleCraft(produces, workersAssigned);\n        setWorkersAssigned(0);\n    };\n\n    const handleUp = (e: React.MouseEvent) => {\n        e.stopPropagation();\n        setWorkersAssigned(workersAssigned + 1);\n    };\n\n    const handleDown = (e: React.MouseEvent) => {\n        e.stopPropagation();\n        setWorkersAssigned(workersAssigned - 1);\n    };\n\n    const handleCraft = (productionDefinition: ProductionDefinition, workers: number) => {\n        const craftingTime = calculateProductionTime(productionDefinition.cost.time || 0, workers);\n        dispatch(removeResources(productionDefinition.cost.resources || {}));\n        dispatch(increaseWorkers(structure, workers));\n\n        const callbacks = [\n            addItemToWarehouse(productionDefinition.item),\n            increaseWorkers(structure, workers),\n        ];\n        const start = startTask(TaskType.craftItem,\n            productionDefinition.item,\n            `${structure}.craft`,\n            craftingTime,\n            callbacks);\n        dispatch(start);\n    }\n\n    return (\n        <div className=\"crafting-details\">\n            { TextManager.get(\"ui-structure-production-craft-a\", {item}) }\n            <div className=\"crafting-costs\">\n                <fieldset>\n                    <ResourcesCost resources={costResources} />\n                </fieldset>\n                <fieldset>\n                    {costMaterials && <ItemsBox items={costMaterials} />}\n                </fieldset>\n            </div>\n            <div className=\"buttonrow\">\n                <div>\n                    <UpDownValue\n                        value={workersAssigned}\n                        label={TextManager.get(\"ui-structure-production-workers\")}\n                        onUp={handleUp}\n                        onDown={handleDown}\n                        upDisabled={\n                            workersAssigned >= workersFree ||\n                            workersAssigned >= MAX_WORKERS_CRAFTING\n                        }\n                        downDisabled={workersAssigned < 1}\n                    />\n                    { makeTimeString(produces.cost.time || 0)}\n                </div>\n                <div>\n                    <Button\n                        disabled={disabled}\n                        className=\"craft\"\n                        onClick={handleClick}\n                    >\n                        {TextManager.get(\"ui-structure-production-craft\")}\n                    </Button>\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default CraftingDetails;","import React, { useState } from \"react\";\nimport { IconSize } from 'components/ui/common/Icon';\nimport ItemIcon from 'components/ui/items/ItemIcon';\nimport { Item } from 'definitions/items/types';\nimport { Structure } from 'definitions/structures';\nimport { ProductionStructureStoreState } from 'store/types/structure';\nimport useStructureState from 'hooks/store/useStructureState';\nimport { TextManager } from 'global/TextManager';\nimport CraftingDetails from './CraftingDetails';\n\nexport interface Props {\n    structure: Structure;\n}\n\nconst CraftingArea = (props: Props) => {\n    const {structure} = props;\n    const [selectedItem, setSelectedItem] = useState<Item>();\n\n    const storeState: ProductionStructureStoreState = useStructureState(structure) as ProductionStructureStoreState;\n    const handleSelectCraftingItem = (item: Item) => {\n        setSelectedItem(item);\n    };\n\n    return (\n        <>\n            <div>craft:</div>\n            <div className=\"crafting-area\">\n                <ul className=\"vertical-tab-bar\">\n                    {storeState.produces.map((item) => (\n                        <li\n                            key={`craft${item}`}\n                            onClick={() => handleSelectCraftingItem(item)}\n                            className={selectedItem === item ? \"selected\" : \"\"}\n                        >\n                            <ItemIcon item={item} size={IconSize.smallest} />\n                            { TextManager.getItemName(item) }\n                        </li>\n                    ))}\n                </ul>\n                { selectedItem && <CraftingDetails item={selectedItem} structure={structure} /> }\n            </div>\n        </>\n    )\n};\n\nexport default CraftingArea;","import * as React from \"react\";\nimport { Item } from \"definitions/items/types\";\nimport { getDefinition, Structure } from \"definitions/structures\";\nimport { ProductionStructureDefinition } from \"definitions/structures/types\";\nimport { TextManager } from \"global/TextManager\";\nimport { formatDuration } from \"utils/format/time\";\nimport { TickingProgressbar } from 'components/ui/common/progress';\nimport useStructureState from 'hooks/store/useStructureState';\nimport { useCraftingTasksStateByStructure, useStudyingTasksStateByStructure } from 'hooks/store/useTasksState';\nimport StructureViewHeader from '../StructureViewHeader';\nimport StructureLevel from '../StructureLevel';\nimport UpgradeHelpModal from './UpgradeHelpModal';\nimport { TooltipManager } from 'global/TooltipManager';\nimport { ContextType } from 'constants/context';\nimport CraftingArea from './CraftingArea';\nimport { addItemToToProduces } from 'store/actions/structures';\nimport \"./styles/productionStructureView.scss\";\n\nexport interface Props {\n    structure: Structure;\n}\n\nconst ProductionStructureView = (props: Props) => {\n    const {structure} = props;\n    const level = useStructureState(structure).level;\n\n    const craftingTasks = useCraftingTasksStateByStructure(structure);\n    const studyingTasks = useStudyingTasksStateByStructure(structure);\n\n    const structureDefinition = getDefinition<ProductionStructureDefinition>(props.structure);\n    if (!structureDefinition) {\n        throw new Error(`No definition found for structure ${props.structure}\n            with type ProductionStructureDefinition.`);\n    }\n\n    const handleHelpClicked = (event: React.MouseEvent) => {\n        const origin = (event.currentTarget as HTMLElement);\n        const originRect = origin.getBoundingClientRect();\n        const content = <UpgradeHelpModal level={level} structure={structure} />;\n        TooltipManager.showContextTooltip(ContextType.component, content, originRect, \"upgrade-structure-tooltip\");\n\n        event.stopPropagation();\n    }\n\n    const handleUpgradeCallbacks = (nextLevel: number) => {\n        const nextLevelDefinition = structureDefinition.levels[nextLevel];\n        return nextLevelDefinition.unlocks.map(item => addItemToToProduces(structure, item));\n    }\n\n    return (\n        // TODO: abstract some stuff to generic StructureView\n        <>\n            <StructureViewHeader structure={props.structure} />\n            <div className = \"production-structure-view\">\n                <section>\n                    <StructureLevel\n                        structure={structure}\n                        onHelpClicked={handleHelpClicked}\n                        addUpgradeCallbacks={handleUpgradeCallbacks}\n                    />\n                    <CraftingArea structure={structure} />\n                    <fieldset>\n                        <legend>{TextManager.get(\"ui-structure-production-crafting\")}</legend>\n                        {craftingTasks.map((t) => (\n                            <TickingProgressbar\n                                key={`${t.name}${t.startTime}`}\n                                label={`${TextManager.getItemName(t.name as Item)} (${formatDuration(t.timeRemaining)})`}\n                                progress={t.progress}\n                            />\n                        ))}\n                    </fieldset>\n                    {studyingTasks.length > 0 && (\n                    <fieldset>\n                        <legend>{TextManager.get(\"ui-structure-production-studying\")}</legend>\n                        {studyingTasks.map((t) => (\n                            <TickingProgressbar\n                                key={`${t.name}${t.startTime}`}\n                                label={`${TextManager.getItemName(t.name as Item)} (${formatDuration(t.timeRemaining)})`}\n                                progress={t.progress}\n                            />\n                        ))}\n                    </fieldset>\n                    )}\n                </section>\n            </div>\n        </>\n    );\n}\n\nexport default ProductionStructureView;\n","import * as React from \"react\";\r\nimport { Resource } from \"definitions/resources\";\r\nimport resourceDescriptions from \"definitions/resources\";\r\nimport { ResourceStoreState } from \"store/types/resources\";\r\nimport { TextManager } from \"global/TextManager\";\r\nimport { StructuresStoreState } from 'store/types/structures';\r\nimport { getStructureByResource } from 'definitions/structures';\r\nimport { Link } from 'react-router-dom';\r\nimport { getStructureLink } from 'utils/routing';\r\nimport { withAppContext, AppContextProps } from 'hoc/withAppContext';\r\nimport { useSelector } from 'react-redux';\r\nimport { StoreState } from 'store/types';\r\nimport { StructureState } from 'store/types/structure';\r\nimport { formatNumber } from 'utils/format/number';\r\nimport Icon from '../../ui/common/Icon';\r\nimport \"./styles/resourcesBox.scss\";\r\n\r\nexport interface Props {\r\n    className?: string;\r\n    resources: ResourceStoreState;\r\n    structures: StructuresStoreState;\r\n    maxResources: ResourceStoreState;\r\n    deltaResources: ResourceStoreState;\r\n}\r\n\r\n/**\r\n * The ResourcesBox is used in the Warehouse to show a list of resources\r\n */\r\nconst ResourcesBox = (props: Props & AppContextProps) => {\r\n    const {\r\n        resources,\r\n        deltaResources,\r\n    } = props;\r\n    const structures = useSelector<StoreState, StructuresStoreState>(store => store.structures);\r\n    const className = `resources-box ${(props.className || \"\")}`;\r\n\r\n    return (\r\n        <div className={className}>\r\n            {\r\n                Object.keys(resources).map((value: string) => {\r\n                    const resource = value as Resource;\r\n                    const resourceDescription = resourceDescriptions[resource];\r\n                    const amount = props.resources[resource]!;\r\n                    if (!resourceDescription) {\r\n                        throw new Error(`No resource description found for ${resource}`);\r\n                    }\r\n\r\n                    let delta;\r\n                    if (deltaResources[resource]) {\r\n                        delta = <span className=\"animate-up\">\r\n                            { `+ ${deltaResources[resource]!.toFixed(2)}`  }\r\n                        </span>;\r\n                    }\r\n\r\n                    const structure = getStructureByResource(Resource[resource]);\r\n\r\n                    const handleStructureClick=() => {\r\n                        props.onCloseWindow();\r\n                    }\r\n                    const full = amount >= props.maxResources[resource]!;\r\n                    return (\r\n                        <React.Fragment key={resource}>\r\n                            <Icon image={resourceDescription.iconImg} size=\"smallest\"/>\r\n                            <div className=\"name\">\r\n                                { TextManager.getResourceName(resource as Resource) }\r\n                            </div>\r\n                            <div className={`amount${full ? \" full\" : \"\"}`}  >\r\n                                { formatNumber(amount, 0) }\r\n                            </div>\r\n                            <div className=\"max\" >\r\n                                { ` / ${props.maxResources[resource]}` }\r\n                            </div>\r\n                            <div className=\"delta\">\r\n                                { delta }\r\n                            </div>\r\n                            <div className=\"structure\">\r\n                                { structures[structure].state === StructureState.Built ? (\r\n                                    <Link to={getStructureLink(structure)} onClick={handleStructureClick}>\r\n                                        { TextManager.get(\"ui-structure-warehouse-resources-source\", {structure}) }\r\n                                    </Link>\r\n                                ) : (\r\n                                    TextManager.get(\"ui-structure-warehouse-resources-source\", {structure})\r\n                                )}\r\n                            </div>\r\n                        </React.Fragment>\r\n                    )\r\n                })\r\n            }\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default withAppContext(ResourcesBox);\r\n\r\n\r\n","import { Resource } from \"definitions/resources\";\n\n// The keys should be the same as the enum Resource\nexport interface ResourceStoreState {\n    [Resource.wood]?: number;\n    [Resource.iron]?: number;\n    [Resource.stone]?: number;\n    [Resource.leather]?: number;\n    [Resource.fabric]?: number;\n    [Resource.food]?: number;\n}\n\nexport const empty: ResourceStoreState = {\n    fabric: 0,\n    food: 0,\n    iron: 0,\n    leather: 0,\n    stone: 0,\n    wood: 0,\n};\n\n// export type ResourceStoreState = Map<Resource, number>;\n\n// export const empty: ResourceStoreState = new Map([\n//     [Resource.fabric, 0],\n//     [Resource.food, 0],\n//     [Resource.iron, 0],\n//     [Resource.leather, 0],\n//     [Resource.stone, 0],\n//     [Resource.wood, 0],\n// ]);\n","import * as React from \"react\";\nimport { getDefinition, Structure } from 'definitions/structures';\nimport { formatDuration } from 'utils/format/time';\nimport resourceDescriptions from \"definitions/resources\";\nimport { WarehouseStructureDefinition } from 'definitions/structures/types';\nimport { Resource } from 'definitions/resources';\nimport Icon from 'components/ui/common/Icon';\nimport { TextManager } from 'global/TextManager';\nimport \"./styles/upgradeHelpModal.scss\"\n\nexport interface Props  {\n    level: number;\n}\n\nconst UpgradeHelpModal = (props: Props) => {\n    const { level } = props;\n    const structureDefinition: WarehouseStructureDefinition = getDefinition(Structure.warehouse);\n\n    const currentLevel = structureDefinition.levels[level];\n    const nextLevel = structureDefinition.levels[level + 1];\n\n    const renderRow = (resource: Resource) => {\n        const resourceDescription = resourceDescriptions[resource];\n\n        return (\n            <React.Fragment key={resource}>\n                <div><Icon image={resourceDescription.iconImg} size=\"smallest\"/></div>\n                <div>{TextManager.getResourceName(resource)}</div>\n                <div className=\"number\">{currentLevel.maxResources[resource]}</div>\n                <div className=\"arrow\">⟶</div>\n                <div className=\"number\">{nextLevel.maxResources[resource]}</div>\n            </React.Fragment>\n        )\n    }\n\n    return (\n        <div className=\"warehouse-upgrade-help-modal\">\n            <div className=\"top\">\n                <h3>{TextManager.get(\"ui-structure-help-upgrade-title\", { structure: Structure.warehouse} )}</h3>\n                <div className=\"cost\">\n                    <section>\n                        {TextManager.get(\"ui-structure-help-upgrade-cost-gold\", { gold: nextLevel.cost.gold})}\n                    </section>\n                    { nextLevel.cost.time && <section>{formatDuration(nextLevel.cost.time)}</section> }\n                </div>\n            </div>\n            <div className=\"storage-increase\">\n                <div className=\"header\"/>\n                <div className=\"header\">\n                    {TextManager.get(\"ui-structure-warehouse-help-upgrade-header-capacity\")}\n                </div>\n                <div className=\"header number\">\n                    {TextManager.get(\"ui-structure-help-upgrade-header-level\", {\n                        level: level + 1\n                    })}\n                </div>\n                <div className=\"header\"/>\n                <div className=\"header number\">\n                {TextManager.get(\"ui-structure-help-upgrade-header-level\", {\n                        level: level + 2\n                    })}\n                </div>\n                {Object.keys(nextLevel.maxResources).map(res => renderRow(res as Resource))}\n            </div>\n        </div>\n    )\n}\n\nexport default UpgradeHelpModal;","import * as React from \"react\";\r\nimport Inventory from \"components/ui/inventory/Inventory\";\r\nimport ResourcesBox from \"components/structures/warehouse/ResourcesBox\";\r\nimport { DragSourceType } from \"constants/dragging\";\r\nimport { Item } from \"definitions/items/types\";\r\nimport { getDefinition, Structure } from \"definitions/structures\";\r\nimport { WarehouseStructureDefinition, WarehouseStructureLevelDefinition } from \"definitions/structures/types\";\r\nimport usePrevious from \"hooks/usePrevious\";\r\nimport { useEffect, useRef, useState } from \"react\";\r\nimport { empty, ResourceStoreState } from \"store/types/resources\";\r\nimport { StructuresStoreState } from \"store/types/structures\";\r\nimport { TextManager } from \"global/TextManager\";\r\nimport { TooltipManager } from 'global/TooltipManager';\r\nimport AdventurerTabstrip from 'components/world/QuestPanel/AdventurerTabstrip';\r\nimport useStructureState from 'hooks/store/useStructureState';\r\nimport { useResourcesState } from 'hooks/store/resources';\r\nimport useStockpileState from 'hooks/store/useStockpileState';\r\nimport { useSelector } from 'react-redux';\r\nimport { StoreState } from 'store/types';\r\nimport { useAdventurersInTown } from 'hooks/store/adventurers';\r\nimport useItemDropActions from 'hooks/actions/useItemActions';\r\nimport StructureLevel from '../StructureLevel';\r\nimport AdventurerPanel from 'components/ui/adventurer/AdventurerPanel';\r\nimport UpgradeHelpModal from './UpgradeHelpModal';\r\nimport { ContextType } from 'constants/context';\r\nimport { addStockpileSlots } from 'store/actions/items';\r\nimport { Resource } from \"definitions/resources\";\r\nimport \"./styles/warehouseStructureView.scss\";\r\n\r\n// eslint-disable-next-line @typescript-eslint/no-empty-interface\r\nexport interface Props  {\r\n}\r\n\r\nconst WAREHOUSE = DragSourceType.warehouse;\r\n\r\nconst WarehouseStructureView = () => {\r\n\r\n    const adventurersInTown = useAdventurersInTown();\r\n    const [selectedAdventurer, setSelectedAdventurer] = useState<string>(adventurersInTown[0]?.id);\r\n    const resources = useResourcesState();\r\n    const [resourcesDelta, setResourcesDelta] = useState<ResourceStoreState>(empty);    // updating this will trigger animation\r\n    const previousResources = usePrevious(resources);\r\n    const resourcesRef = useRef<HTMLFieldSetElement>(null);\r\n    const stockpileState = useStockpileState();\r\n    const structuresState = useSelector<StoreState, StructuresStoreState>(store => store.structures);\r\n    const {dropItemWarehouse} = useItemDropActions();\r\n\r\n    useEffect(() => {\r\n        // Calculate delta\r\n        const delta = Object.keys(resources).reduce<ResourceStoreState>((acc, value) => {\r\n            const resource = value as Resource;\r\n            if (previousResources && previousResources[resource]) {\r\n                // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\r\n                acc[resource] = resources[resource]! - previousResources[resource]!;\r\n            }\r\n            return acc;\r\n        }, {});\r\n\r\n        setResourcesDelta(delta);\r\n    }, [resources, previousResources]);\r\n\r\n    useEffect(() => {\r\n        if (!resourcesRef.current) {\r\n            return;\r\n        }\r\n        const ref = resourcesRef.current as unknown as HTMLFieldSetElement;\r\n        ref.classList.remove(\"animate\");\r\n        setTimeout(() => {\r\n            if (resourcesRef) {\r\n                ref.classList.add(\"animate\");\r\n            }\r\n        }, 200);\r\n    }, [resourcesDelta]);\r\n\r\n    const structureDefinition = getDefinition<WarehouseStructureDefinition>(Structure.warehouse);\r\n    if (!structureDefinition) {\r\n        throw new Error(`No definition found for structure ${Structure.warehouse} with type StructureDefinition.`);\r\n    }\r\n\r\n    const structureState = useStructureState(Structure.warehouse);\r\n    const levelDefinition: WarehouseStructureLevelDefinition = structureDefinition.levels[structureState.level] as WarehouseStructureLevelDefinition;\r\n\r\n    const handleDropItemWarehouse = (item: Item, fromSlot: number, toSlot: number, sourceType: DragSourceType, sourceId?: string): void => {\r\n        dropItemWarehouse(item, fromSlot, toSlot, sourceType, sourceId);\r\n    }\r\n\r\n    const handleAdventurerTabSelected = (tabId: string) => {\r\n        setSelectedAdventurer(tabId);\r\n    };\r\n\r\n    const handleHelpClicked = (event: React.MouseEvent) => {\r\n        const origin = (event.currentTarget as HTMLElement);\r\n        const originRect = origin.getBoundingClientRect();\r\n        const content = <UpgradeHelpModal level={structureState.level} />;\r\n        TooltipManager.showContextTooltip(ContextType.component, content, originRect, \"upgrade-structure-tooltip\");\r\n\r\n        event.stopPropagation();\r\n    }\r\n\r\n    const handleUpgradeCallbacks = (nextLevel: number) => {\r\n        const currentLevelDefinition = structureDefinition.levels[structureState.level];\r\n        const nextLevelDefinition = structureDefinition.levels[nextLevel];\r\n        const slots = nextLevelDefinition.maxStockpile - currentLevelDefinition.maxStockpile;\r\n        return [\r\n            addStockpileSlots(slots)\r\n        ]\r\n    }\r\n\r\n    return (\r\n        <div className=\"warehouse-structureview\">\r\n            <StructureLevel structure={Structure.warehouse} onHelpClicked={handleHelpClicked} addUpgradeCallbacks={handleUpgradeCallbacks}/>\r\n            <fieldset className=\"resources\" ref={resourcesRef}>\r\n                <legend>{TextManager.get(\"ui-structure-warehouse-resources\")}</legend>\r\n                <ResourcesBox\r\n                    resources={resources}\r\n                    structures={structuresState}\r\n                    maxResources={levelDefinition.maxResources}\r\n                    deltaResources={resourcesDelta}\r\n                />\r\n            </fieldset>\r\n            <h3>{TextManager.get(\"ui-structure-warehouse-stockpile\")}</h3>\r\n            <Inventory\r\n                sourceType={WAREHOUSE}\r\n                className=\"inventory-large\"\r\n                items={stockpileState}\r\n                onDropItem={handleDropItemWarehouse}\r\n            />\r\n            <h3>{TextManager.get(\"ui-structure-warehouse-adventurers\")}</h3>\r\n            <div>\r\n                <AdventurerTabstrip\r\n                    adventurers={adventurersInTown}\r\n                    selectedAdventurerId={selectedAdventurer}\r\n                    onAdventurerTabSelected={handleAdventurerTabSelected}\r\n                />\r\n                <div className=\"adventurer-inventory\">\r\n                    { selectedAdventurer && (\r\n                        <AdventurerPanel\r\n                            adventurerId={selectedAdventurer}\r\n                            horizontalMode={true}\r\n                            traits={false}\r\n                            skills={false}\r\n                        />\r\n                    )}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n\r\n};\r\n\r\nexport default WarehouseStructureView;\r\n","import { DragType } from \"constants/dragging\";\r\nimport * as React from \"react\";\r\nimport { ConnectDropTarget, DropTarget, DropTargetConnector, DropTargetMonitor, DropTargetSpec } from \"react-dnd\";\r\nimport { AdventurerAvatarDragInfo } from \"../DraggableAdventurerAvatar\";\r\nimport \"./styles/droppableadventurerslot.scss\";\r\n\r\nconst dropTarget: DropTargetSpec<Props> = {\r\n    drop(props: Props, monitor: DropTargetMonitor) {\r\n        props.onDrop(monitor.getItem());\r\n    },\r\n    canDrop(_props: Props, _monitor: DropTargetMonitor)  {\r\n        return true; // todo: can't drop on yourself\r\n    },\r\n};\r\n\r\nexport interface Props {\r\n    onDrop: (item: AdventurerAvatarDragInfo) => void;\r\n}\r\n\r\nexport interface DropSourceProps {\r\n    canDrop: boolean;\r\n    isOver: boolean;\r\n    connectDropTarget: ConnectDropTarget;\r\n}\r\n\r\nconst collect = (connect: DropTargetConnector, monitor: DropTargetMonitor) => ({\r\n    canDrop: monitor.canDrop(),\r\n    connectDropTarget: connect.dropTarget(),\r\n    isOver: monitor.isOver(),\r\n});\r\n\r\n/*\r\n * Can drop adventurers on this */\r\nconst DroppableAdventurerSlot = (props: Props & DropSourceProps) => {\r\n    const {\r\n        isOver,\r\n        canDrop,\r\n        connectDropTarget,\r\n    } = props;\r\n    // const isActive = isOver && canDrop;\r\n    let className = \"droppable-adventurer-slot\";\r\n\r\n    if (isOver) {\r\n        className += \" active-drop\";\r\n    } else if (canDrop) {\r\n        className += \" can-drop\";\r\n    }\r\n\r\n    return connectDropTarget(\r\n        <div className = { className }/>\r\n    );\r\n}\r\n\r\nexport default DropTarget<Props, DropSourceProps>(\r\n    DragType.ADVENTURER,\r\n    dropTarget,\r\n    collect,\r\n)(DroppableAdventurerSlot);\r\n","import * as React from \"react\";\nimport { AdventurerStoreState } from \"store/types/adventurer\";\nimport AdventurerAvatar from \"components/ui/adventurer/AdventurerAvatar\";\nimport { AdventurerAvatarDragInfo } from 'components/ui/adventurer/DraggableAdventurerAvatar';\nimport DroppableAdventurerSlot from 'components/ui/adventurer/DroppableAdventurerSlot';\nimport { IconSize } from 'components/ui/common/Icon';\nimport \"./styles/assignadventurers.scss\";\n\nexport interface DispatchProps {\n    onAdventurerDropped: (item: AdventurerAvatarDragInfo, index: number) => void;\n    onAdventurerClicked: (adventurer: AdventurerStoreState) => void;\n}\n\nexport interface Props {\n    availableSlots: number;\n    assignedAventurers: AdventurerStoreState[];\n}\n\n/*\n * Displays a number of slots to drag adventurers to */\nconst AssignAdventurers = (props: Props & DispatchProps) => {\n    const slotsContent = () => {\n        const slots: JSX.Element[] = [];\n        for (let i = 0; i < props.availableSlots; i++) {\n            let content;\n            let className = \"\";\n            const hasAdventurer = !!props.assignedAventurers[i];\n\n            if (hasAdventurer) {\n                const adventurer = props.assignedAventurers[i];\n                content = (\n                    <AdventurerAvatar\n                        adventurer={adventurer}\n                        displayName={false}\n                        size={IconSize.small}\n                        onClick={() => props.onAdventurerClicked(adventurer) }\n                    />\n                );\n                className = \"has-adventurer\";\n            } else {\n                content = (\n                    <DroppableAdventurerSlot\n                        onDrop={(item: AdventurerAvatarDragInfo) => { props.onAdventurerDropped(item, i); }}\n                    />\n                );\n            }\n            slots.push(\n                <li\n                    key={`slot${i}`}\n                    className={className}\n                >\n                    {content}\n                </li>\n            );\n        }\n        return slots;\n    };\n\n    return (\n        <ul\n            className=\"assign-adventurers\"\n        >\n            { slotsContent() }\n        </ul>\n    );\n};\n\nexport default AssignAdventurers;\n","import { Item } from \"definitions/items/types\";\nimport { getDefinition } from \"definitions/quests\";\nimport * as React from \"react\";\nimport { AdventurerStoreState } from \"store/types/adventurer\";\nimport { QuestStoreState } from \"store/types/quest\";\nimport { TextManager } from \"global/TextManager\";\nimport AssignAdventurers from \"./AssignAdventurers\";\nimport { QuestDefinition } from 'definitions/quests/types';\nimport { useSelector } from 'react-redux';\nimport { StoreState } from 'store/types';\nimport Button from 'components/ui/buttons/Button';\nimport ItemsBox from 'components/ui/items/ItemsBox';\nimport { AdventurerAvatarDragInfo } from 'components/ui/adventurer/DraggableAdventurerAvatar';\nimport \"./styles/questboard.scss\";\n\nexport const AVAILABLE_SLOTS = 5;\nconst minimumCountAdventurers = 3;  // we need this many adventurers to start the quest\n\n\n// tslint:disable-next-line: no-empty-interface\n\nexport interface Props {\n    availableQuests: QuestStoreState[];\n    selectedQuestName?: string;       // name of selected quest\n    assignedAventurers: AdventurerStoreState[];\n\n    onQuestClick: (questName: string) => void;\n    onAdventurerDropped: (item: AdventurerAvatarDragInfo, index: number) => void;\n    onRemoveAdventurer: (adventurer: AdventurerStoreState) => void;\n    onLaunchQuest: () => void;\n}\n\nconst QuestBoard = (props: Props) => {\n\n    const items = useSelector<StoreState, (null|Item)[]>(state => state.stockpile);\n\n    const getQuestDetails = () => {\n        if (!props.selectedQuestName) {\n            return null;\n        }\n        const quest = props.availableQuests.find((q) => q.name === props.selectedQuestName);\n        if (!quest) {\n            return (\n                <div> { TextManager.get(\"ui-structure-tavern-quest-launched\") } </div>\n            );\n        }\n        const questDefinition = getDefinition(quest.name);\n\n        // Need a full party to launch\n        const fullParty = props.assignedAventurers.filter((a) => a !== null).length >= minimumCountAdventurers;\n        // Check if we have the required items\n        const enoughItems = checkEnoughItems(questDefinition);\n\n        const canLaunch = fullParty && enoughItems;\n\n        return (\n            <div className=\"quest-details\">\n                {TextManager.getQuestDescription(props.selectedQuestName)}\n                <AssignAdventurers\n                    availableSlots={AVAILABLE_SLOTS}\n                    assignedAventurers={props.assignedAventurers}\n                    onAdventurerClicked={props.onRemoveAdventurer}\n                    onAdventurerDropped={props.onAdventurerDropped}\n                />\n                <ItemsBox items={ questDefinition.requiredItems || [] }/>\n                <Button disabled={!canLaunch} onClick = { () => props.onLaunchQuest() }>\n                    {TextManager.get(\"ui-structure-tavern-button-launch-quest\")}\n                </Button>\n            </div>\n        );\n    };\n\n    /**\n     * Returns true if all the items required by the quest are in the inventory\n     */\n    const checkEnoughItems = (questDefinition: QuestDefinition): boolean => {\n        if (!questDefinition.requiredItems) {\n            return true;\n        }\n        return questDefinition.requiredItems.every((item: Item) => {\n            const amountRequired = (questDefinition.requiredItems)?.filter((i) => i === item).length;\n            return items.filter((i) => i === item).length >= (amountRequired ?? 0);\n        });\n    }\n\n    // quest board, expanded quest info + assign adventurers + launch button\n    return (\n        <div className=\"quest-board\">\n            <h2>\n                {TextManager.get(\"ui-structure-tavern-title-quest-board\")}\n            </h2>\n            <ul className=\"quest-list\">\n                {props.availableQuests.map((q) => {\n                    const className = `quest ${(q.name === props.selectedQuestName) ? \" selected\" : \"\"}`;\n                    return (\n                        <li key={q.name}\n                            className={className}\n                            onClick={() => {props.onQuestClick(q.name);} }\n                        >\n                            <div\n                                className=\"icon\"\n                                style={{backgroundImage: `url(${process.env.PUBLIC_URL})`}}\n                            />\n                            <div className=\"title\">{ TextManager.getQuestTitle(q.name) } </div>\n                        </li>\n                    );\n                })}\n            </ul>\n            { getQuestDetails() }\n        </div>\n    );\n}\n\nexport default QuestBoard;\n","import * as React from \"react\";\nimport { AdventurerStoreState } from 'store/types/adventurer';\nimport { AVAILABLE_SLOTS } from '../QuestBoard';\nimport Button from 'components/ui/buttons/Button';\nimport { TextManager } from 'global/TextManager';\nimport \"./styles/adventurerButton.scss\";\n\nexport interface Props {\n    adventurer: AdventurerStoreState;\n    assignedAventurers: AdventurerStoreState[];  // assigned to a quest in the QuestBoard\n    questName: string;\n\n    onAddAdventurer: (adventurer: AdventurerStoreState, index: number) => void;\n    onRemoveAdventurer: (adventurer: AdventurerStoreState) => void;\n}\n\n// Toggles adventurer participation in a quest\nconst AdventurerButton = (props: Props) => {\n    const {\n        adventurer,\n        assignedAventurers,\n        questName,\n        onAddAdventurer,\n        onRemoveAdventurer\n    } = props;\n\n    const isAssigned = assignedAventurers.indexOf(adventurer) > -1;\n    const quest = TextManager.getQuestTitle(questName);\n\n    const handleAddClick = () => {\n        const emptySlot = getEmptySlot(assignedAventurers);\n        onAddAdventurer(adventurer, emptySlot);\n    };\n\n    const handleRemoveClick = () => {\n        onRemoveAdventurer(adventurer);\n    }\n\n    if (isAssigned) {\n        return (\n            <Button onClick={handleRemoveClick} className=\"adventurer-button\">\n               {TextManager.get(\"ui-structure-tavern-button-leave-quest\")}\n            </Button>\n        );\n    }\n    // Skip holes\n    if (assignedAventurers.filter(Boolean).length === AVAILABLE_SLOTS) {\n        return (\n            <Button disabled={true} className=\"adventurer-button\">\n                {TextManager.get(\"ui-structure-tavern-button-join-quest-full-party\")}\n            </Button>\n        )\n    }\n    return (\n        <Button onClick={handleAddClick}  className=\"adventurer-button\">\n            {TextManager.get(\"ui-structure-tavern-button-join-quest\", { quest })}\n        </Button>\n    )\n}\n\nexport default AdventurerButton;\n\n// Finds the first array index with a falsey value\nconst getEmptySlot = (assignedAventurers: AdventurerStoreState[]) => {\n    for (let i = 0; i < AVAILABLE_SLOTS; i++) {\n        if (!assignedAventurers[i]) {\n            return i;\n        }\n    }\n    return 0;\n}","import { DragSourceType, DragType } from \"constants/dragging\";\r\nimport * as React from \"react\";\r\nimport { ConnectDragSource, DragSource, DragSourceConnector, DragSourceMonitor, DragSourceSpec } from \"react-dnd\";\r\nimport { AdventurerStoreState } from \"store/types/adventurer\";\r\nimport AdventurerAvatar, { Props as AdventurerAvatarProps } from '../AdventurerAvatar';\r\nimport \"./styles/draggableadventureravatar.scss\";\r\n\r\nexport interface Props {\r\n    sourceId?: string;\r\n    onClick?: () => void;\r\n    disabled?: boolean;\r\n}\r\n\r\ninterface CollectedProps {\r\n    isDragging: boolean;\r\n    connectDragSource: ConnectDragSource;\r\n}\r\n\r\nexport interface AdventurerAvatarDragInfo {\r\n    adventurer: AdventurerStoreState;\r\n    sourceId?: string;\r\n}\r\n\r\n/**\r\n * Specifies the drag source contract.\r\n * Only `beginDrag` function is required.\r\n */\r\nconst spec: DragSourceSpec<Props & AdventurerAvatarProps, AdventurerAvatarDragInfo> = {\r\n    beginDrag(props: Props & AdventurerAvatarProps) {\r\n        // Return the data describing the dragged item\r\n        return {\r\n            adventurer: props.adventurer,\r\n            sourceId: props.sourceId,\r\n            sourceType: DragSourceType.adventurerInventory,\r\n        };\r\n    },\r\n};\r\n\r\n/**\r\n * Specifies which props to inject into your component.\r\n */\r\nfunction collect(connect: DragSourceConnector, monitor: DragSourceMonitor) {\r\n    return {\r\n        connectDragSource: connect.dragSource(),\r\n        isDragging: monitor.isDragging(),\r\n    };\r\n}\r\n\r\nconst DraggableAdventurerAvatar = (props: Props & CollectedProps & AdventurerAvatarProps) => {\r\n\r\n    const { isDragging, connectDragSource, disabled } = props;\r\n    let className = \"draggable-adventurer-avatar\";\r\n    if (disabled) {\r\n        className += \" disabled\";\r\n    }\r\n    if (isDragging) {\r\n        className += \" dragging\";\r\n    }\r\n\r\n    /*if (isDragging) {\r\n        // TODO: can show some sort of empty state?\r\n        return null;\r\n    }*/\r\n    return connectDragSource(\r\n        <div className = { className }>\r\n            <AdventurerAvatar\r\n                // Copy all props down to AdventurerAvatar\r\n                { ...props }\r\n            />\r\n        </div>,\r\n    );\r\n}\r\n\r\nexport default DragSource<Props & AdventurerAvatarProps, CollectedProps>(DragType.ADVENTURER, spec, collect)(DraggableAdventurerAvatar);\r\n","import * as React from \"react\";\nimport {AppContextProps} from \"hoc/withAppContext\";\nimport {useRef, useState, createContext, useEffect } from \"react\";\nimport {DndProvider } from \"react-dnd\";\nimport {HTML5Backend } from 'react-dnd-html5-backend';\nimport {Link, Redirect, Route, Switch, HashRouter} from \"react-router-dom\";\nimport {Persistor} from \"redux-persist\";\nimport {PixiPlugin } from 'gsap/all';\nimport {gsap } from 'gsap';\nimport {SoundManager} from \"global/SoundManager\";\nimport {TextManager} from \"global/TextManager\";\nimport {Structure} from \"definitions/structures\";\nimport debounce from \"debounce\";\nimport TownView from 'components/town/TownView';\nimport Toasts from 'components/ui/toasts/Toasts';\nimport Topbar from 'components/ui/topbar/Topbar';\nimport WorldView from 'components/world/WorldView';\nimport SimpleLog from 'components/log/SimpleLog';\nimport ContextTooltip from 'components/ui/tooltip/ContextTooltip';\nimport {TooltipManager } from 'global/TooltipManager';\nimport {getWorldLink, getTownLink } from 'utils/routing';\nimport { restartGame } from 'index';\nimport Button, { ButtonColor } from 'components/ui/buttons/Button';\nimport StructureDetailsView from 'components/town/StructureDetailsView';\nimport \"./styles/app.scss\";\n\nPixiPlugin.registerPIXI(PIXI);\ngsap.registerPlugin(PixiPlugin);\n\nexport enum View {\n    Town,\n    World,\n}\n\nexport interface Props {\n    persistor: Persistor;\n}\n\n\nexport const MAX_WIDTH = 960;\nexport const AppContext = createContext<AppContextProps | null>(null);\n\n\nconst App = (props: Props) => {\n    const containerRef = useRef<HTMLDivElement>(null);\n\n    const [activeWindows, setActiveWindows] = useState<React.ReactElement[]>([]);\n\n    const handleViewButtonClick = () => {\n        SoundManager.playSound(\"ui/buttonClick\");\n    };\n\n    const handleRestartClick = () => {\n        restartGame();\n\n    };\n\n    const selectStructure = (structure: Structure | null) => {\n        if (structure) {\n            const displayName = TextManager.getStructureName(structure);\n\n            const window = <StructureDetailsView structure={structure} title={displayName} />;\n            handleWindowOpened(window);\n\n            SoundManager.playSound(\"ui/buttonClick\");\n       }\n    };\n\n    const renderTownView = () => <TownView onStructureClick={selectStructure} />;\n    const renderWorldView = () => <WorldView />;\n\n    const handleWindowOpened = (window: React.ReactElement) => {\n        setActiveWindows([\n            ...activeWindows || [],\n            window,\n        ]);\n    };\n\n    /**\n     * Closes all windows\n     */\n    const handleWindowClose = () => {\n        setActiveWindows([]);\n    };\n\n    /**\n     * Closes the top window of the stack\n     */\n    const handleWindowBack = () => {\n        if (activeWindows && activeWindows.length) {\n            setActiveWindows(activeWindows.slice(0, -1));\n        }\n    };\n\n    const renderWindow = (): React.ReactElement | null => {\n        if (!activeWindows.length) {\n            return null;\n        }\n\n        const topWindow = activeWindows[activeWindows.length - 1];\n        const commonWindowProps = {\n            onClose: handleWindowClose,\n            onBack: handleWindowBack,\n            backEnabled: activeWindows.length > 1,\n            closeEnabled: true,\n        };\n\n        const element = React.cloneElement(topWindow, commonWindowProps);\n        return element;\n    };\n\n    useEffect(() => {\n        SoundManager.addSound(\"ui/buttonClick\", \"sound/ui/button-click.ogg\");\n        SoundManager.addSound(\"ui/equip\", \"sound/ui/equip.mp3\");\n        SoundManager.addSound(\"ui/error\", \"sound/ui/error.ogg\");\n        SoundManager.addSound(\"ui/levelUp\", \"sound/ui/level-up.ogg\");\n        SoundManager.addSound(\"ui/toast\", \"sound/ui/toast.ogg\");\n    }, []);\n\n    const handleAppClick = () => {\n        TooltipManager.clear();\n    };\n\n    useEffect(() => {\n        const handleScroll = debounce(() => {\n            TooltipManager.clear();\n        }, 100);\n        window.addEventListener(\"scroll\", handleScroll);\n        window.addEventListener(\"wheel\", handleScroll);\n        return () => {\n            window.removeEventListener(\"resize\", handleScroll);\n            window.removeEventListener(\"wheel\", handleScroll);\n        };\n    }, []);\n\n    return (\n        <AppContext.Provider value={{\n            onOpenWindow: handleWindowOpened,\n            onCloseWindow: handleWindowClose,\n        }} >\n            <div\n                className=\"app\"\n                ref={containerRef}\n                style={{\n                    maxWidth: MAX_WIDTH\n                }}\n                onClick={handleAppClick}\n            >\n                {/* <QuestRepaintTester /> */}\n                <DndProvider backend={HTML5Backend}>\n                <HashRouter>\n                    <Topbar persistor={props.persistor} />\n                    <div className=\"control-bar\">\n                        <Switch>\n                            <Route path=\"/\" exact={true} >\n                                <Redirect from=\"/\" to={getWorldLink()} />\n                            </Route>\n                            <Route path={getWorldLink()}>\n                                <Link to={getTownLink()}>\n                                    <Button onClick={() => handleViewButtonClick()} color=\"green\"> {TextManager.get(`ui-view-button-town`)} </Button>\n                                </Link>\n                            </Route>\n                            <Route path={getTownLink()}>\n                                <Link to={getWorldLink()}>\n                                    <Button onClick={() => handleViewButtonClick()}  > {TextManager.get(`ui-view-button-world`)} </Button>\n                                </Link>\n                            </Route>\n                        </Switch>\n                        {` | `}\n                        <Button onClick={() => handleRestartClick()} color={ButtonColor.purple} > Restart! </Button>\n                    </div>\n                    <Switch>\n                        <Route path={getTownLink()} render={renderTownView} />\n                        <Route path={getWorldLink()} render={renderWorldView} />\n                    </Switch>\n                    <SimpleLog/>\n                    {renderWindow()}\n                    <ContextTooltip />\n                    <Toasts />\n                </HashRouter>\n                </DndProvider>\n            </div>\n        </AppContext.Provider>\n    );\n};\n\nexport default App;\n","import React from 'react';\nimport { AdventurerStoreState } from 'store/types/adventurer';\nimport { SOURCE_ID } from '../TavernStructureView';\nimport AdventurerButton from './AdventurerButton';\nimport { TextManager } from 'global/TextManager';\nimport DraggableAdventurerAvatar from 'components/ui/adventurer/DraggableAdventurerAvatar';\nimport AdventurerPanel from 'components/ui/adventurer/AdventurerPanel';\nimport { renameAdventurer } from 'store/actions/adventurers';\nimport { useDispatch } from 'react-redux';\n\nexport interface Props {\n    adventurer: AdventurerStoreState;\n    onQuest: boolean;\n    assignedAventurers: AdventurerStoreState[];\n    expanded: boolean;\n    selectedQuestName?: string;\n\n    onClick: (adventurer: AdventurerStoreState) => void;\n    onAddAdventurer: (adventurer: AdventurerStoreState, index: number) => void;\n    onRemoveAdventurer: (adventurer: AdventurerStoreState) => void;\n}\n\n// Room block that has adventurer\nconst RoomWithAdventurer = (props: Props) => {\n    const {\n        adventurer,\n        onQuest,\n        assignedAventurers,\n        expanded,\n        selectedQuestName,\n        onClick,\n        onAddAdventurer,\n        onRemoveAdventurer\n    } = props;\n\n    const dispatch = useDispatch();\n    const assigned = assignedAventurers.indexOf(adventurer) > -1; // assigned to a quest in the QuestBoard\n\n    const handleRename = (e: React.MouseEvent<HTMLSpanElement>) => {\n        e.stopPropagation();\n        const name = prompt(\"Enter new name\", adventurer.name);\n        if (name && name !== adventurer.name) {\n            dispatch(renameAdventurer(adventurer.id, name));\n        }\n    };\n\n    return (\n        <>\n            <div \n                className={`room ${expanded ? \"expanded\" : \"\"}`}\n                onClick={() => onClick(adventurer)}\n            >\n                <DraggableAdventurerAvatar\n                    disabled={assigned || onQuest}\n                    adventurer={adventurer}\n                    className=\"adventurer-icon\"\n                    sourceId={SOURCE_ID}\n                    key={`avatar:${adventurer.id}`}\n                />\n                <div>\n                    <section>\n                        {adventurer.name}\n                    </section>\n                    <section className=\"on-a-quest\">\n                     {(onQuest) && TextManager.get(\"ui-structure-tavern-on-a-quest\") }\n                    </section>\n                </div>\n                <span className=\"rename\" onClick={handleRename}>rename</span>\n            </div>\n            { expanded && (\n                <div className=\"adventurer-details\">\n                    <AdventurerPanel adventurerId={adventurer.id} name={false} />\n                    { (!onQuest && selectedQuestName) && (\n                        <AdventurerButton\n                            adventurer={adventurer}\n                            assignedAventurers={assignedAventurers}\n                            questName={selectedQuestName}\n                            onAddAdventurer={onAddAdventurer}\n                            onRemoveAdventurer={onRemoveAdventurer}\n                        />\n                    )}\n                </div>\n            )}\n        </>\n    );\n}\n\nexport default RoomWithAdventurer;\n","import React, {  } from 'react';\n\n// eslint-disable-next-line @typescript-eslint/no-empty-interface\nexport interface Props {\n}\n\nconst RoomEmpty = () => {\n    return (\n        <div className=\"room\">\n            (empty room)\n        </div>\n    );\n}\n\nexport default RoomEmpty;\n","import React, { useState } from 'react';\nimport { AdventurerStoreState } from 'store/types/adventurer';\nimport { QuestStoreState } from 'store/types/quest';\nimport RoomWithAdventurer from './RoomWithAdventurer';\nimport RoomEmpty from './RoomEmpty';\nimport { TextManager } from 'global/TextManager';\nimport \"./styles/roomList.scss\";\n\nexport interface Props {\n    roomCount: number;\n    adventurers: AdventurerStoreState[];\n    assignedAventurers: AdventurerStoreState[];\n    quests: QuestStoreState[];\n    selectedQuestName?: string;       // name of selected quest\n\n    onAddAdventurer: (adventurer: AdventurerStoreState, index: number) => void;\n    onRemoveAdventurer: (adventurer: AdventurerStoreState) => void;\n}\n\nconst RoomList = (props: Props) => {\n    const {\n        roomCount,\n        adventurers,\n        assignedAventurers,\n        selectedQuestName,\n        onAddAdventurer,\n        onRemoveAdventurer\n    } = props;\n    const [selectedAdventurer, setSelectedAdventurer] = useState<string>();\n\n    const getQuestByAdventurer = (adventurerId: string): QuestStoreState | undefined => {\n        return Object.values(props.quests).find((quest) => {\n            return quest.party.indexOf(adventurerId) > -1;\n        });\n    };\n\n    const handleAdventurerClick = (adventurer: AdventurerStoreState) => {\n        if (selectedAdventurer === adventurer.id) {\n            setSelectedAdventurer(undefined);\n        } else {\n            setSelectedAdventurer(adventurer.id);\n        }\n    };\n\n    const roomContent: JSX.Element[] = [];\n    for (let i = 0; i < roomCount; i++) {\n        const adventurer = adventurers.find((a) => a.room === i);\n        if (!adventurer) {\n            roomContent.push((\n                <RoomEmpty key={`room${i}`} />\n            ));\n            continue;\n        }\n        const onQuest = !!getQuestByAdventurer(adventurer.id);\n\n        roomContent.push((\n            <RoomWithAdventurer\n                key={adventurer.id}\n                adventurer={adventurer}\n                assignedAventurers={assignedAventurers}\n                selectedQuestName={selectedQuestName}\n                expanded={selectedAdventurer === adventurer.id}\n                onQuest={onQuest}\n\n                onClick={handleAdventurerClick}\n                onAddAdventurer={onAddAdventurer}\n                onRemoveAdventurer={onRemoveAdventurer}\n            />\n        ));\n    }\n\n    return (\n        <div className=\"room-list\">\n            <h2>{TextManager.get(\"ui-structure-tavern-rooms\")}</h2>\n            { roomContent }\n        </div>\n    );\n}\n\nexport default RoomList;","import * as React from \"react\";\nimport { getDefinition, Structure } from 'definitions/structures';\nimport { formatDuration } from 'utils/format/time';\nimport { TavernStructureDefinition } from 'definitions/structures/types';\nimport Icon from 'components/ui/common/Icon';\nimport { TextManager } from 'global/TextManager';\nimport \"./styles/upgradeHelpModal.scss\"\n\nexport interface Props  {\n    level: number;\n}\n\nconst UpgradeHelpModal = (props: Props) => {\n    const { level } = props;\n    const structureDefinition: TavernStructureDefinition = getDefinition(Structure.tavern);\n\n    const currentLevel = structureDefinition.levels[level];\n    const nextLevel = structureDefinition.levels[level + 1];\n\n\n    return (\n        <div className=\"tavern-upgrade-help-modal\">\n            <div className=\"top\">\n                <h3>{TextManager.get(\"ui-structure-help-upgrade-title\", { structure: Structure.tavern} )}</h3>\n                <div className=\"cost\">\n                    <section>\n                        {TextManager.get(\"ui-structure-help-upgrade-cost-gold\", { gold: nextLevel.cost.gold})}\n                    </section>\n                    { nextLevel.cost.time && <section>{formatDuration(nextLevel.cost.time)}</section> }\n                </div>\n            </div>\n            <div className=\"rooms-increase\">\n                <div className=\"header\"/>\n                <div className=\"header\">\n                    {TextManager.getStructureName(Structure.tavern)}\n                </div>\n                <div className=\"header number\">\n                    {TextManager.get(\"ui-structure-help-upgrade-header-level\", {\n                        level: level + 1\n                    })}\n                </div>\n                <div className=\"header\"/>\n                <div className=\"header number\">\n                    {TextManager.get(\"ui-structure-help-upgrade-header-level\", {\n                        level: level + 2\n                    })}\n                </div>\n                <div><Icon image=\"img/ui/structures/tavern.png\" size=\"smallest\"/></div>\n                <div>{TextManager.get(\"ui-structure-tavern-rooms\")}</div>\n                <div className=\"number\">{currentLevel.rooms}</div>\n                <div className=\"arrow\">⟶</div>\n                <div className=\"number\">{nextLevel.rooms}</div>\n            </div>\n        </div>\n    )\n}\n\nexport default UpgradeHelpModal;","import * as React from \"react\";\nimport { getDefinition, Structure} from \"definitions/structures\";\nimport { TavernStructureDefinition, TavernStructureLevelDefinition} from \"definitions/structures/types\";\nimport { AdventurerStoreState} from \"store/types/adventurer\";\nimport { QuestStatus, QuestStoreState} from \"store/types/quest\";\nimport { TextManager} from \"global/TextManager\";\nimport { ToastManager} from 'global/ToastManager';\nimport { Type} from 'components/ui/toasts/Toast';\nimport { getQuestLink} from 'utils/routing';\nimport RoomList from './rooms/RoomList';\nimport { useState} from 'react';\nimport QuestBoard from './QuestBoard';\nimport useStructureState from 'hooks/store/useStructureState';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { StoreState } from 'store/types';\nimport { launchQuest } from 'store/actions/quests';\nimport { AdventurerAvatarDragInfo } from 'components/ui/adventurer/DraggableAdventurerAvatar';\nimport StructureLevel from '../StructureLevel';\nimport UpgradeHelpModal from './UpgradeHelpModal';\nimport { TooltipManager } from 'global/TooltipManager';\nimport { ContextType } from 'constants/context';\nimport \"./styles/tavernStructureView.scss\";\n\nexport const SOURCE_ID = \"tavern\";\n\n// The UI for the tavern\nconst TavernStructureView = () => {\n    const level = useStructureState(Structure.tavern).level;\n    const adventurers = useSelector<StoreState, AdventurerStoreState[]>(store => store.adventurers);\n    const quests = useSelector<StoreState, QuestStoreState[]>(store => store.quests);\n\n    const [assignedAventurers, setAassignedAdventurers] = useState<AdventurerStoreState[]>([]);\n    const [selectedQuest, setSelectedQuest] = useState<string>();\n\n    const structureDefinition = getDefinition<TavernStructureDefinition>(Structure.tavern);\n    const levelDefinition: TavernStructureLevelDefinition = structureDefinition.levels[level];\n\n    const dispatch = useDispatch();\n\n    const onLaunchQuest = (questName: string) => {\n        dispatch(launchQuest(questName, assignedAventurers));\n    };\n\n    const getAvailableQuests = quests.filter((q) => q.status === QuestStatus.available );\n\n    const handleQuestClick = (name: string): void => {\n        if (selectedQuest === name) {\n            setSelectedQuest(undefined);\n        } else {\n            setSelectedQuest(name);\n        }\n\n        // Unassign all adventurers\n        setAassignedAdventurers([]);\n    };\n\n    const handleAdventurerDropped = (item: AdventurerAvatarDragInfo, index: number) => {\n        if (item.sourceId === SOURCE_ID) {\n            handleAddAdventurer(item.adventurer, index)\n        }\n    }\n\n    const handleAddAdventurer = (adventurer: AdventurerStoreState, index: number): void => {\n        const copy = [ ...assignedAventurers];\n        copy[index] = adventurer;\n        setAassignedAdventurers(copy);\n    };\n\n    const handleRemoveAdventurer = (adventurer: AdventurerStoreState): void => {\n        const index = assignedAventurers.indexOf(adventurer);\n        const copy = [ ...assignedAventurers];\n        delete copy[index];\n        setAassignedAdventurers(copy);\n    };\n\n    const handleLaunchQuest = (): void => {\n        const questTitle = TextManager.getQuestTitle(selectedQuest!);\n        const leader = assignedAventurers[0];\n        ToastManager.addToast(questTitle, Type.questLaunched, leader?.avatarImg, getQuestLink(selectedQuest!));\n        onLaunchQuest(selectedQuest!);\n    };\n\n    const handleHelpClicked = (event: React.MouseEvent) => {\n        const origin = (event.currentTarget as HTMLElement);\n        const originRect = origin.getBoundingClientRect();\n        const content = <UpgradeHelpModal level={level} />;\n        TooltipManager.showContextTooltip(ContextType.component, content, originRect, \"upgrade-structure-tooltip\");\n\n        event.stopPropagation();\n    }\n\n    return (\n        <div className=\"tavern-structure-view\">\n            <StructureLevel structure={Structure.tavern} onHelpClicked={handleHelpClicked}/>\n            <section>\n                <RoomList\n                    roomCount={levelDefinition.rooms}\n                    adventurers={adventurers}\n                    assignedAventurers={assignedAventurers}\n                    quests={quests}\n                    selectedQuestName={selectedQuest}\n                    onAddAdventurer={handleAddAdventurer}\n                    onRemoveAdventurer={handleRemoveAdventurer}\n                />\n                <QuestBoard\n                    availableQuests={getAvailableQuests}\n                    selectedQuestName={selectedQuest}\n                    assignedAventurers={assignedAventurers}\n                    onQuestClick={(name: string) => handleQuestClick(name)}\n                    onAdventurerDropped={handleAdventurerDropped}\n                    onRemoveAdventurer={handleRemoveAdventurer}\n                    onLaunchQuest={handleLaunchQuest}\n                />\n            </section>\n        </div>\n    );\n};\n\nexport default TavernStructureView;\n","import * as React from \"react\";\nimport { getDefinition, Structure } from 'definitions/structures';\nimport { formatDuration } from 'utils/format/time';\nimport resourceDescriptions from \"definitions/resources\";\nimport { ResourceStructureDefinition } from 'definitions/structures/types';\nimport { Resource } from 'definitions/resources';\nimport Icon from 'components/ui/common/Icon';\nimport { TextManager } from 'global/TextManager';\nimport \"./styles/upgradeHelpModal.scss\"\n\nexport interface Props  {\n    structure: Structure;\n    level: number;\n}\n\nconst UpgradeHelpModal = (props: Props) => {\n    const { level, structure } = props;\n    const structureDefinition: ResourceStructureDefinition = getDefinition(structure);\n\n    const currentLevel = structureDefinition.levels[level];\n    const nextLevel = structureDefinition.levels[level + 1];\n\n    const renderRow = (resource: Resource) => {\n        const resourceDescription = resourceDescriptions[resource];\n\n        return (\n            <React.Fragment key={resource}>\n                <div><Icon image={resourceDescription.iconImg} size=\"smallest\"/></div>\n                <div>\n                   {TextManager.get(\"ui-structure-resource-help-upgrade-resource-generates\", { resource })}\n                </div>\n                <div className=\"number\">{currentLevel.generates[resource]}</div>\n                <div className=\"arrow\">⟶</div>\n                <div className=\"number\">{nextLevel.generates[resource]}</div>\n            </React.Fragment>\n        )\n    }\n\n    return (\n        <div className=\"resource-upgrade-help-modal\">\n            <div className=\"top\">\n                <h3>{TextManager.get(\"ui-structure-help-upgrade-title\", { structure } )}</h3>\n                <div className=\"cost\">\n                    <section>\n                        {TextManager.get(\"ui-structure-help-upgrade-cost-gold\", { gold: nextLevel.cost.gold})}\n                    </section>\n                    { nextLevel.cost.time && <section>{formatDuration(nextLevel.cost.time)}</section> }\n                </div>\n            </div>\n            <div className=\"grid generates-increase\">\n                <div className=\"header\"/>\n                <div className=\"header\"/>\n                <div className=\"header number\">\n                    {TextManager.get(\"ui-structure-help-upgrade-header-level\", {\n                        level: level + 1\n                    })}\n                </div>\n                <div className=\"header\"/>\n                <div className=\"header number\">\n                {TextManager.get(\"ui-structure-help-upgrade-header-level\", {\n                        level: level + 2\n                    })}\n                </div>\n                <div><Icon image={\"/img/resources/worker.png\"} size=\"smallest\"/></div>\n                <div>{TextManager.get(\"ui-structure-help-upgrade-worker-capacity\")}</div>\n                <div className=\"number\">{currentLevel.workerCapacity}</div>\n                <div className=\"arrow\">⟶</div>\n                <div className=\"number\">{nextLevel.workerCapacity}</div>\n                {Object.keys(nextLevel.generates).map(res => renderRow(res as Resource))}\n            </div>\n        </div>\n    )\n}\n\nexport default UpgradeHelpModal;","import React from 'react';\nimport { getDefinition, Structure } from 'definitions/structures';\nimport { TextManager } from 'global/TextManager';\nimport { useEngine } from 'hooks/store/engine';\nimport { formatDuration } from 'utils/format/time';\nimport { RESOURCE_INTERVAL } from 'constants/resources';\nimport  { Direction } from 'components/ui/common/progress/PlainProgressbar';\nimport { Resource } from 'definitions/resources';\nimport useStructureState from 'hooks/store/useStructureState';\nimport { ResourceStructureDefinition, ResourceStructureLevelDefinition } from 'definitions/structures/types';\nimport Icon from 'components/ui/common/Icon';\nimport resourceDescriptions from \"definitions/resources\";\nimport TickingProgressbar from 'components/ui/common/progress/TickingProgressbar';\n\ninterface Props {\n    structure: Structure;\n    resource: Resource;\n}\n\nconst ResourceGenerationRow = (props: Props) => {\n    const {structure, resource} = props;\n    const engine = useEngine();\n    const {level, workers} = useStructureState(structure);\n    const structureDefinition = getDefinition<ResourceStructureDefinition>(props.structure);\n    if (!structureDefinition) {\n        throw new Error(`No definition found for structure ${props.structure} with type ResourceStructureDefinition.`);\n    }\n    const levelDefinition: ResourceStructureLevelDefinition = structureDefinition.levels[level];\n    const generates = levelDefinition.generates[resource] || 0;\n    const delta = RESOURCE_INTERVAL - (Date.now() - engine.lastProducedUpdate);\n    const resourceDescription = resourceDescriptions[resource];\n\n    return (\n        <div className=\"resource-generation-row\">\n            <div className=\"info\">\n                <Icon image={resourceDescription.iconImg}  size=\"smallest\"/>\n                <div>\n                    {TextManager.get(\"ui-structure-resource-generates\", {\n                        amount: generates,\n                        resource,\n                    })}\n                </div>\n            </div>\n            { workers > 0 &&\n            <TickingProgressbar\n                className=\"generating\"\n                direction={Direction.decreasing}\n                label={`${TextManager.get(\"ui-structure-resource-next-generates\", {\n                    amount: generates * workers,\n                    resource,\n                    time: formatDuration(delta)\n                })}`}\n                progress={delta / RESOURCE_INTERVAL}\n            />}\n            { !workers && TextManager.get(\"ui-structure-resource-no-workers\")}\n        </div>\n    )\n}\nexport default ResourceGenerationRow;","import * as React from \"react\";\nimport { getDefinition, Structure  } from \"definitions/structures\";\nimport { ResourceStructureDefinition, ResourceStructureLevelDefinition } from \"definitions/structures/types\";\nimport UpDownValue from \"components/ui/common/UpDownValue\";\nimport { useSelector, useDispatch } from 'react-redux';\nimport { StoreState } from 'store/types';\nimport { selectFreeWorkers } from 'store/selectors/workers';\nimport { decreaseWorkers, increaseWorkers } from 'store/actions/structures';\nimport StructureViewHeader from '../StructureViewHeader';\nimport { TextManager } from 'global/TextManager';\nimport StructureLevel from '../StructureLevel';\nimport { TooltipManager } from 'global/TooltipManager';\nimport { ContextType } from 'constants/context';\nimport UpgradeHelpModal from './UpgradeHelpModal';\nimport useStructureState from 'hooks/store/useStructureState';\nimport ResourceGenerationRow from './ResourceGenerationRow';\nimport { Resource } from 'definitions/resources';\nimport './styles/resourceStructureView.scss';\n\n\nexport interface Props  {\n    structure: Structure;\n}\n\n// todo: 02/12/2019 [ ] Can show progress bar in resource screen\nconst ResourceStructureView = (props: Props) => {\n    const {structure} = props;\n\n    // Fetch needed values from store\n    const {level, workers} = useStructureState(structure);\n    const structureDefinition = getDefinition<ResourceStructureDefinition>(props.structure);\n    if (!structureDefinition) {\n        throw new Error(`No definition found for structure ${props.structure} with type ResourceStructureDefinition.`);\n    }\n    const levelDefinition: ResourceStructureLevelDefinition = structureDefinition.levels[level];\n    const workersFree = useSelector<StoreState, number>((store) => selectFreeWorkers(store));\n\n    // Reducer dispatch\n    const dispatch = useDispatch();\n    const handleWorkersDown = () => {\n        dispatch(decreaseWorkers(props.structure));\n    }\n\n    const handleWorkersUp = () => {\n        dispatch(increaseWorkers(props.structure));\n    };\n\n\n    const upDisabled = workers === levelDefinition.workerCapacity || (workersFree || 0) < 1;\n    const downDisabled = workers === 0;\n\n    const handleHelpClicked = (event: React.MouseEvent) => {\n        const origin = (event.currentTarget as HTMLElement);\n        const originRect = origin.getBoundingClientRect();\n        const content = <UpgradeHelpModal level={level} structure={structure} />;\n        TooltipManager.showContextTooltip(ContextType.component, content, originRect, \"upgrade-structure-tooltip\");\n\n        event.stopPropagation();\n    }\n\n    return (\n        <>\n            <StructureViewHeader structure={props.structure} />\n            <div className=\"resource-structure-view\">\n                <section>\n                    <StructureLevel structure={structure} onHelpClicked={handleHelpClicked}/>\n                    <UpDownValue\n                        label={TextManager.get(\"ui-structure-production-workers\")}\n                        value={workers}\n                        max={levelDefinition.workerCapacity}\n                        upDisabled={upDisabled}\n                        downDisabled={downDisabled}\n                        onDown={handleWorkersDown}\n                        onUp={handleWorkersUp}\n                    />\n                    { Object.keys(levelDefinition.generates).map(r => <ResourceGenerationRow structure={structure} resource={r as Resource} key={r} />)}\n                </section>\n            </div>\n\n        </>\n    );\n};\n\nexport default ResourceStructureView;\n","\nimport { getDefinition, Structure } from \"definitions/structures\";\nimport { StructureDefinition, StructureType } from \"definitions/structures/types\";\nimport * as React from \"react\";\nimport { StructureState } from \"store/types/structure\";\nimport { useSelector } from 'react-redux';\nimport { StoreState } from 'store/types';\nimport { TasksStoreState } from 'store/types/tasks';\nimport useStructureState from 'hooks/store/useStructureState';\nimport { withWindow } from 'hoc/withWindow';\nimport { Props as WindowProps } from \"components/ui/window/Window\";\nimport { formatDuration } from 'utils/format/time';\nimport { TickingProgressbar } from 'components/ui/common/progress';\nimport ProductionStructureView from 'components/structures/production/ProductionStructureView';\nimport WarehouseStructureView from 'components/structures/warehouse/WarehouseStructureView';\nimport TavernStructureView from 'components/structures/tavern/TavernStructureView';\nimport ResourceStructureView from 'components/structures/resource/ResourceStructureView';\nimport \"./styles/structuredetailsview.scss\";\n\nexport interface Props {\n    structure: Structure;\n}\n\nconst StructureDetailsView = (props: Props & WindowProps) => {\n    const tasks = useSelector<StoreState, TasksStoreState>(store => store.tasks);\n    const buildTask = tasks.running.filter((val) =>\n        val.origin === `town` && val.name === `${props.structure}.build`)[0];\n    const structureState = useStructureState(props.structure);\n\n    const renderContent = () => {\n        if (structureState.state === StructureState.Building) {\n            if (!buildTask) return null;\n            return (\n                <div className=\"building\">\n                    <TickingProgressbar\n                        progress={buildTask.progress}\n                        label={`Building... (${formatDuration(buildTask.timeRemaining)})`}\n                    />\n                </div>\n            );\n        } else {\n\n            const structureDefinition: StructureDefinition = getDefinition(props.structure);\n            switch (structureDefinition.type) {\n                case StructureType.production: {\n                    return <ProductionStructureView structure={props.structure}/>;\n                }\n                case StructureType.resource: {\n                    return <ResourceStructureView structure={props.structure} />;\n                }\n                case StructureType.warehouse: {\n                    return <WarehouseStructureView />;\n                }\n                case StructureType.tavern: {\n                    return <TavernStructureView />;\n                }\n                default: {\n                    return <div> { props.structure } </div>;\n                }\n            }\n        }\n    }\n\n    return (\n        <div className=\"structure-details\">\n            { renderContent() }\n        </div>\n    );\n};\n\nexport default withWindow(StructureDetailsView);\n","import seedrandom from \"seedrandom\";\n\nlet generator: seedrandom.prng;\nexport const init = (seed: string): void => {\n    dirty = true;\n    generator = seedrandom(seed, {state: true});\n}\n\nexport function random(): number {\n    if (!generator) { throw new Error(\"Call init() before random()\"); }\n    dirty = true;\n    return generator();\n}\n\n/**\n * Returns a random integer between min (inclusive) and max (inclusive).\n * The value is no lower than min (or the next integer greater than min\n * if min isn't an integer) and no greater than max (or the next integer\n * lower than max if max isn't an integer).\n */\nexport const randomInt = (min = 0, max = 10): number => {\n    min = Math.ceil(min);\n    max = Math.floor(max);\n    return Math.floor(random() * (max - min + 1)) + min;\n}\n\nexport const state = (): seedrandom.State => {\n    dirty = false;\n    return generator.state();\n}\n\nexport let dirty = false;\n","import { RESOURCE_INTERVAL } from 'constants/resources';\r\nimport { Resource } from 'definitions/resources';\r\nimport { getDefinition, Structure } from \"definitions/structures\";\r\nimport { ResourceStructureDefinition, ResourceStructureLevelDefinition, StructureType } from \"definitions/structures/types\";\r\nimport { getTimeMultiplier, TimeType } from 'mechanics/time';\r\nimport { selectMaxResources } from 'store/selectors/resources';\r\nimport { StoreState } from \"store/types\";\r\nimport { ResourceStoreState } from \"store/types/resources\";\r\nimport { StructuresStoreState } from \"store/types/structures\";\r\n\r\n\r\n /*\r\n  * Calculates how many resources are generated by the in the town.\r\n  * Will return a ResourceStoreState with the amount of each resource to add  */\r\nconst getProducedResources = (lastProducedUpdate: number, store: StoreState): ResourceStoreState|null => {\r\n    const structures: StructuresStoreState = store.structures;\r\n    const result: ResourceStoreState = {};\r\n    const timeMultiplier = getTimeMultiplier(TimeType.resourceGeneration);\r\n\r\n    // this function can run at different intervals\r\n    // faster or slower than once a minute\r\n    // we will multiply the resource amount by the factor to normalize\r\n    const factor = ((Date.now() - lastProducedUpdate) / (RESOURCE_INTERVAL / timeMultiplier));\r\n    const maxResources = selectMaxResources(store);\r\n\r\n    const handleStructure = (structure: string) => {\r\n        const structureDefinition = getDefinition(structure as Structure);\r\n\r\n        if (structureDefinition.type === StructureType.resource) {\r\n            const resourceStructureDefinition = structureDefinition as ResourceStructureDefinition;\r\n            const level: number = structures[structure as Structure].level;\r\n            const levelDefinition: ResourceStructureLevelDefinition = resourceStructureDefinition.levels[level];\r\n\r\n            // Store all the resources that this structure will generate this tick into `result`\r\n            Object.keys(levelDefinition.generates).reduce((accumulator: ResourceStoreState, key: string) => {\r\n                const resource = key as Resource;\r\n\r\n                const amount: number = levelDefinition.generates[resource]! * structures[structure as Structure].workers * factor;\r\n                accumulator[resource] = (accumulator[resource] || 0) + amount;\r\n                return accumulator;\r\n            }, result);\r\n        }\r\n    };\r\n\r\n    if (factor < 1) {\r\n        return null;\r\n    }\r\n    // Calculate what each structure generates. Stores in `result`.\r\n    Object.keys(structures).forEach((structure) => handleStructure(structure));\r\n\r\n    // Check if the warehouse can actually hold it\r\n    Object.keys(result).forEach((key: string) => {\r\n        const resource = key as Resource;\r\n        if (result[resource]) {\r\n            if (store.resources[resource]! + result[resource]! >= maxResources[resource]!) {\r\n                result[resource] = maxResources[resource]! - (store.resources[resource]!);\r\n            }\r\n        }\r\n        // console.log(`Adding: ${resource} ${result[resource]} factor ${factor}`);\r\n    });\r\n\r\n    return result;\r\n};\r\n\r\n\r\nexport default getProducedResources;\r\n","import { TextEntry } from \"constants/text\";\nimport { getDefinition } from \"definitions/quests\";\nimport { QuestDefinition, QuestNodeType } from 'definitions/quests/types';\n\nimport { Store } from \"redux\";\nimport { StoreState } from \"store/types\";\nimport { LogChannel } from \"store/types/logEntry\";\nimport { QuestStatus, QuestStoreState } from \"store/types/quest\";\nimport { ToastManager } from 'global/ToastManager';\nimport { TextManager } from 'global/TextManager';\nimport { Type } from 'components/ui/toasts/Toast';\nimport { getQuestLink } from 'utils/routing';\nimport { setSceneName } from 'store/actions/quests';\nimport { getQuestLeader } from 'store/helpers/storeHelpers';\nimport { getTimeMultiplier, TimeType } from 'mechanics/time';\n\nexport interface QuestUpdate {\n    name: string;\n    progress: number;\n}\n\nexport interface LogUpdate extends TextEntry {\n    key: string;\n    channel: LogChannel;\n    channelContext?: any;\n}\n\ninterface QuestGameTickResponse {\n    questUpdates: QuestUpdate[];\n    logUpdates: LogUpdate[];\n}\n\nconst getQuestUpdates = (delta: number, store: Store<StoreState>): QuestGameTickResponse => {\n\n    const speed = 4;    // in nodes per minute\n    const timeMultiplier = getTimeMultiplier(TimeType.questProgress);\n    const MS_PER_MINUTE = 60000;\n    const log: LogUpdate[] = [];\n    const quests: QuestUpdate[] = [];\n    const state: StoreState = store.getState();\n    // Moves the quest line progress. Only if currently at a 'nothing' node\n    // Otherwise the player has to do something to move the quest along\n    state.quests.forEach((quest: QuestStoreState) => {\n        if (quest.status !== QuestStatus.active) {\n            return;\n        }\n        const questDefinition: QuestDefinition = getDefinition(quest.name);\n        const currentProgress = quest.progress;\n        const currentNodeIndex = Math.floor(currentProgress);\n        const currentNode = questDefinition.nodes[currentNodeIndex];\n        if (currentNode.type === QuestNodeType.nothing) {\n            // Currently at a 'nothing' node\n            const progressIncrease = (delta / (MS_PER_MINUTE / timeMultiplier)) * speed;\n            // todo: [15/07/2019] speed could be different for each party\n            let nextProgress = Math.min(currentProgress + progressIncrease, questDefinition.nodes.length - 1);\n            const nodesPassed = Math.floor(nextProgress) - currentNodeIndex;\n            for (let i = 1; i <= nodesPassed; i++) {\n                // Loop through all the nodes we've passed since last tick\n                const nextNode = questDefinition.nodes[currentNodeIndex + i];\n                if (nextNode.type === QuestNodeType.encounter) {\n                    // We've hit an encounter node. set the progress to here and stop looking at other nodes\n\n                    store.dispatch(setSceneName(quest.name, nextNode.startScene!));\n\n                    const questTitle = TextManager.getQuestTitle(quest.name);\n                    const leader = getQuestLeader(state.adventurers, quest);\n                    ToastManager.addToast(questTitle, Type.questEncounter, leader?.avatarImg, getQuestLink(quest.name));\n\n                    // Add quest to log\n                    if (nextNode.log) {\n                        log.push({\n                            channel: LogChannel.quest,\n                            channelContext: quest.name,\n                            key: nextNode.log,\n                        });\n                    }\n                    // Dont overshoot the encounter node\n                    nextProgress = currentProgress + i;\n\n                    break;\n                } else if (nextNode.type === QuestNodeType.nothing) {\n                    if (nextNode.log) {\n                        log.push({\n                            channel: LogChannel.quest,\n                            channelContext: quest.name,\n                            key: nextNode.log,\n                        });\n                    }\n                }\n            }\n            quests.push({\n                name: quest.name,\n                progress: nextProgress,\n            });\n        }\n    });\n    return {\n        logUpdates: log,\n        questUpdates: quests,\n    };\n};\n\nexport default getQuestUpdates;\n","import { State as seedrandomStateType } from \"seedrandom\";\nimport * as Random from \"utils/random\";\n\nconst getRngState = (): seedrandomStateType | null => {\n    if (Random.dirty) {\n        return Random.state();\n    }\n    return null;\n};\n\nexport default getRngState;\n","// tslint:disable:no-console\n// In production, we register a service worker to serve assets from local cache.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on the 'N+1' visit to a page, since previously\n// cached resources are updated in the background.\n\n// To learn more about the benefits of this model, read https://goo.gl/KwvDNy.\n// This link also includes instructions on opting out of this behavior.\n\nconst isLocalhost = Boolean(\n  window.location.hostname === \"localhost\" ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === \"[::1]\" ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/,\n    ),\n);\n\nexport default function register() {\n  if (process.env.NODE_ENV === \"production\" && \"serviceWorker\" in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL!,\n      window.location.toString(),\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebookincubator/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener(\"load\", () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Lets check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            \"This web app is being served cache-first by a service \" +\n              \"worker. To learn more, visit https://goo.gl/SC7cgQ\",\n          );\n        });\n      } else {\n        // Is not local host. Just register service worker\n        registerValidSW(swUrl);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then((registration) => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker) {\n          installingWorker.onstatechange = () => {\n            if (installingWorker.state === \"installed\") {\n              if (navigator.serviceWorker.controller) {\n                // At this point, the old content will have been purged and\n                // the fresh content will have been added to the cache.\n                // It's the perfect time to display a 'New content is\n                // available; please refresh.' message in your web app.\n                console.log(\"New content is available; please refresh.\");\n              } else {\n                // At this point, everything has been precached.\n                // It's the perfect time to display a\n                // 'Content is cached for offline use.' message.\n                console.log(\"Content is cached for offline use.\");\n              }\n            }\n          };\n        }\n      };\n    })\n    .catch((error) => {\n      console.error(\"Error during service worker registration:\", error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then((response) => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      if (\n        response.status === 404 ||\n        response.headers.get(\"content-type\")!.indexOf(\"javascript\") === -1\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then((registration) => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl);\n      }\n    })\n    .catch(() => {\n      console.log(\n        \"No internet connection found. App is running in offline mode.\",\n      );\n    });\n}\n\nexport function unregister() {\n  if (\"serviceWorker\" in navigator) {\n    navigator.serviceWorker.ready.then((registration) => {\n      registration.unregister();\n    });\n  }\n}\n","import * as React from \"react\";\r\nimport * as ReactDOM from \"react-dom\";\r\nimport { Provider } from \"react-redux\";\r\nimport { Store, AnyAction, DeepPartial } from \"redux\";\r\nimport { Persistor } from \"redux-persist\";\r\nimport localforage from 'localforage';\r\nimport { gameTick, startGame } from \"store/actions/game\";\r\nimport { addLogText } from \"store/actions/log\";\r\nimport version from \"./constants/version\";\r\nimport updateCombat from \"mechanics/gameTick/combat\";\r\nimport App from \"./components/App\";\r\nimport getProducedResources from \"./mechanics/gameTick/producedResources\";\r\nimport getQuestUpdates, { LogUpdate } from \"./mechanics/gameTick/quests\";\r\nimport getRngState from \"./mechanics/gameTick/rngState\";\r\nimport registerServiceWorker from \"./registerServiceWorker\";\r\nimport configureStore from \"./utils/configureStore\";\r\nimport * as Random from \"./utils/random\";\r\nimport { TextManager } from \"./global/TextManager\";\r\nimport { loadResourceAsync } from 'utils/pixiJs';\r\nimport { processCompletedTasks } from 'mechanics/gameTick/tasks';\r\nimport { StoreState } from 'store/types';\r\nimport { getWorldLink } from \"utils/routing\";\r\nimport { createInitialStore } from \"store/reducers\";\r\nimport \"./index.css\";\r\n\r\n// Todo: Refactor into class\r\nconst TICK_INTERVAL = 2500;\r\nlet persistor: Persistor;\r\n\r\nconst initGame = async () => {\r\n    const texts = await loadResourceAsync(`${process.env.PUBLIC_URL}/lang/en.json`);\r\n    if (texts) {\r\n        TextManager.init(texts.data);\r\n    }\r\n    Random.init(\"GILLESROX2\");\r\n\r\n    setupStore();\r\n};\r\n\r\n/**\r\n * Attemps to read persisted store state. Calls `runGame`\r\n */\r\nconst setupStore = async (initial: DeepPartial<StoreState> = {}) => {\r\n    const storeConfiguration = await configureStore(initial);\r\n    const { store, isHydrated } = storeConfiguration;\r\n    persistor = storeConfiguration.persistor;\r\n\r\n    if (!isHydrated) {\r\n        startNewGame(store);\r\n    } else {\r\n        continueGame();\r\n    }\r\n    runGame(store);\r\n}\r\n\r\n/**\r\n * Gets called when a player starts a new game\r\n * @param store\r\n */\r\nconst startNewGame = (store: Store<StoreState, AnyAction>) => {\r\n    store.dispatch(startGame());\r\n    store.dispatch(addLogText(\"test-game-welcome\"));\r\n    // todo: here is a good place to launch a tutorial or something\r\n\r\n    // tslint:disable-next-line:no-console\r\n    console.log(`Starting new GAME (version ${version})`);\r\n};\r\n\r\n\r\n/**\r\n * Continue playing earlier persisted store\r\n * @param store\r\n */\r\nconst continueGame = () => {\r\n    // tslint:disable-next-line:no-console\r\n    console.log(`Continuing existing GAME (version ${version})`);\r\n};\r\n\r\n/**\r\n * Loads a saved game from a file\r\n */\r\nconst loadGame = async (state: StoreState) => {\r\n    // todo: implement in MenuWindow!\r\n    await persistor.purge();\r\n    const { store } = await configureStore(state);\r\n    runGame(store);\r\n\r\n    // We have to cause the page to reinitialize and all react components to remount\r\n    // eslint-disable-next-line no-restricted-globals\r\n    location.href = `#${getWorldLink()}`; // todo: load path from metadata '#/world/kill10Boars';\r\n}\r\n\r\nconst restartGame = () => {\r\n    // eslint-disable-next-line no-restricted-globals\r\n    if(confirm('Are you sure you wish to reset all your progress?')){\r\n        clearTimeout(interval);\r\n        persistor.purge();\r\n        localforage.clear();\r\n\r\n        setupStore(createInitialStore());\r\n        // eslint-disable-next-line no-restricted-globals\r\n        location.reload();\r\n        // location.href = `#${getTownLink()}`;\r\n        // tslint:disable-next-line: no-console\r\n        console.clear();\r\n    }\r\n}\r\n\r\n\r\nlet interval: NodeJS.Timeout;\r\nconst runGame = (store: Store<StoreState, AnyAction>) => {\r\n    clearTimeout(interval);\r\n\r\n    ReactDOM.render((\r\n        <Provider store={store}>\r\n            <App persistor={persistor} />\r\n        </Provider>\r\n        ),\r\n        document.getElementById(\"root\") as HTMLElement,\r\n    );\r\n    registerServiceWorker();\r\n\r\n    const gameLoop = () => {\r\n        const state: StoreState = store.getState();\r\n        const delta = Date.now() - state.engine.lastTick;\r\n\r\n        const logs: LogUpdate[] = [];\r\n        const resourcesUpdates = getProducedResources(state.engine.lastProducedUpdate, state);\r\n        const rngState = getRngState();\r\n        updateCombat(delta, store);\r\n        const { questUpdates, logUpdates } = getQuestUpdates(delta, store);\r\n        logs.push(...logUpdates);\r\n\r\n        store.dispatch(gameTick(delta, rngState, resourcesUpdates, questUpdates, logs));\r\n\r\n        processCompletedTasks(state.tasks, store.dispatch);\r\n    };\r\n\r\n    interval = setInterval(gameLoop, TICK_INTERVAL);\r\n};\r\nexport {runGame, restartGame, loadGame};\r\n\r\ninitGame();\r\n","// tslint:disable:object-literal-sort-keys\nimport {\n    ActionType,\n    AddXPAction,\n    AssignEquipmentAction,\n    InventoryAction,\n    MoveItemInInventoryAction,\n    MoveItemToOtherAdventurerAction,\n    RemoveEquipmentAction,\n    RemoveItemFromInventoryAction,\n    RenameAdventurerAction\n} from \"store/actions/adventurers\";\nimport { EquipmentSlotType } from \"components/ui/adventurer/EquipmentSlot\";\nimport { Item } from \"definitions/items/types\";\nimport { AnyAction, Reducer } from \"redux\";\nimport { AdventurerColor, AdventurerStoreState, BasicAttributesStoreState } from \"store/types/adventurer\";\nimport { Trait } from 'definitions/traits/types';\nimport { WeaponType } from 'definitions/items/weapons';\nimport { levelToXp } from \"mechanics/adventurers/levels\";\n\n/**\n * reducer\n * @param state\n * @param action\n */\nconst generateRandomAttributes = (): BasicAttributesStoreState => {\n    return {\n        strength: Math.floor(Math.random() * 3) + 9,\n        dexterity: Math.floor(Math.random() * 3) + 9,\n        intelligence: Math.floor(Math.random() * 3) + 9,\n        health: Math.floor(Math.random() * 3) + 9\n    };\n};\n\nconst avatarImgBasePath = \"img/avatars\";\nconst spritesheetBasePath = \"img/scene/actors/\";\n\n// offHand]: Item.indomitableCarapace\n\n// Create a bunch of guys for debugging\nexport const initialAdventurers: AdventurerStoreState[] = [{\n    id: \"c4a5d270\",\n    equipment: {\n        [EquipmentSlotType.head]: Item.cowl,\n        [EquipmentSlotType.chest]: Item.chest,\n        [EquipmentSlotType.hands]: Item.clothGloves,\n        [EquipmentSlotType.shoulders]: Item.shoulders2,\n        [EquipmentSlotType.legs]: Item.pants2,\n        [EquipmentSlotType.feet]: Item.boots3\n        // offHand: Item.indomitableCarapace\n    },\n    basicAttributes: generateRandomAttributes(),\n    health: Math.random() * 100,\n    xp: levelToXp(1),\n    baseAP: 6,\n    room: 0,\n    name: \"Ximena Maddox\",\n    traits: [Trait.houseMaddox, Trait.gloomy],\n    avatarImg: `${avatarImgBasePath}/female/f_14.png`,\n    spritesheetPath: `${spritesheetBasePath}elf-bow.json`,\n    color: AdventurerColor.purple,\n    skills: {\n        [WeaponType.crossbow]: 10,\n        [WeaponType.bow]: 10\n    },\n    // tslint:disable-next-line:max-line-length\n    inventory: [ Item.deedForLumbermill, null, Item.simpleCrossbow, Item.dagger, Item.khopesh, null, Item.steelSword, null,  null,  null,  null,  Item.steelShield,  null,  null,  null,  null],\n}, {\n    id: \"2e655832\",\n    equipment: {\n        [EquipmentSlotType.feet]: Item.boots2\n    },\n    basicAttributes: generateRandomAttributes(),\n    name: \"Donte Houston\",\n    health: Math.random() * 100,\n    xp: Math.random() * 100,\n    baseAP: 6,\n    room: 1,\n    avatarImg: `${avatarImgBasePath}/male/m_05.png`,\n    spritesheetPath: `${spritesheetBasePath}elf-bow.json`,\n    color: AdventurerColor.teal,\n    traits: [Trait.houseHouston],\n    skills: {\n        [WeaponType.crossbow]: 12,\n        [WeaponType.staff]: 13\n    },\n    // tslint:disable-next-line:max-line-length\n    inventory: [ Item.simpleCrossbow, null, null, null, null, Item.boots1, Item.chainmailHood, Item.nomadHelmet, Item.plateChest4, null, Item.buckler, null, null, null,  null,  null,  null,  null,  null,  null,  null,  null, Item.plateHelmet, Item.cowl],\n}, {\n    id: \"ec6f1050\",\n    equipment: {\n        [EquipmentSlotType.feet]: Item.boots3\n        // offHand: Item.aegisOfValor\n    },\n    basicAttributes: generateRandomAttributes(),\n    name: \"Zackary \\\"bone bag\\\" Morris\",\n    health: Math.random() * 100,\n    xp: Math.random() * 100,\n    baseAP: 5,\n    room: 2,\n    traits: [Trait.gloomy],\n    skills: {\n        [WeaponType.sword]: 12,\n        [WeaponType.hammer]: 6\n    },\n    avatarImg: `${avatarImgBasePath}/male/m_09.png`,\n    spritesheetPath: `${spritesheetBasePath}skeleton.json`,\n    color: AdventurerColor.black,\n    inventory: [ Item.greatswordOfGwai, null, null, null, Item.berserkerShield ],\n}, {\n    id: \"d299f98a\",\n    basicAttributes: generateRandomAttributes(),\n    equipment: {},\n    name: \"Mike Keith\",\n    health: Math.random() * 100,\n    xp: Math.random() * 100,\n    baseAP: 6,\n    room: 4,\n    avatarImg: `${avatarImgBasePath}/male/m_19.png`,\n    spritesheetPath: `${spritesheetBasePath}knight-sword.json`,\n    traits: [Trait.arrowFinder],\n    skills: {\n        [WeaponType.sword]: 13\n    },\n    inventory: [ null, null, null, null, Item.khopesh, Item.hornedHelmet, Item.woodenBulwark ],\n}, {\n    id: \"96c686c3\",\n    equipment: {},\n    basicAttributes: generateRandomAttributes(),\n    name: \"Wayne Monroe\",\n    health: Math.random() * 100,\n    xp: Math.random() * 100,\n    baseAP: 4,\n    room: 5,\n    avatarImg: `${avatarImgBasePath}/male/m_08.png`,\n    spritesheetPath: `${spritesheetBasePath}orc-axe.json`,\n    traits: [Trait.houseMonroe, Trait.arrowFinder],\n    skills: {\n        [WeaponType.axe]: 12\n    },\n    inventory: [ null, null, null, Item.goldenShield ],\n}, {\n    id: \"250d1a9d\",\n    basicAttributes: generateRandomAttributes(),\n    equipment: {},\n    name: \"Alexis Ortiz \",\n    health: Math.random() * 100,\n    xp: Math.random() * 100,\n    baseAP: 5,\n    room: 9,\n    avatarImg: `${avatarImgBasePath}/female/f_10.png`,\n    spritesheetPath: `${spritesheetBasePath}knight-sword.json`,\n    inventory: [ null, null, null, null, null ],\n    skills: {\n        [WeaponType.axe]: 10\n    },\n}, {\n    id: \"169384ef\",\n    equipment: {},\n    basicAttributes: generateRandomAttributes(),\n    name: \"Karlee Nolan\",\n    health: Math.random() * 100,\n    xp: Math.random() * 100,\n    baseAP: 5,\n    room: 3,\n    avatarImg: `${avatarImgBasePath}/female/f_16.png`,\n    spritesheetPath: `${spritesheetBasePath}troll-sword.json`,\n    inventory: [ Item.greatswordOfGwai, null, null, null ],\n    skills: {\n        [WeaponType.axe]: 10\n    },\n}, {\n    id: \"f22d66cb\",\n    basicAttributes: generateRandomAttributes(),\n    equipment: {},\n    name: \"Gylbarde the Earnest\",\n    health: Math.random() * 100,\n    xp: Math.random() * 100,\n    baseAP: 5,\n    room: 8,\n    avatarImg: `${avatarImgBasePath}/male/m_09.png`,\n    spritesheetPath: `${spritesheetBasePath}knight-sword.json`,\n    inventory: [ null, null, null, null, null ],\n    skills: {\n        [WeaponType.axe]: 13\n    },\n}, {\n    id: \"36c686c1\",\n    equipment: {},\n    basicAttributes: generateRandomAttributes(),\n    name: \"Lanslet of the Water\",\n    health: Math.random() * 100,\n    xp: Math.random() * 100,\n    baseAP: 6,\n\n    room: 6,\n    avatarImg: `${avatarImgBasePath}/male/m_26.png`,\n    spritesheetPath: `${spritesheetBasePath}knight-sword.json`,\n    inventory: [ Item.greatswordOfGwai, null, null, null, Item.shoulders1, Item.fedora, Item.greaves2 ],\n    skills: {\n        [WeaponType.axe]: 3\n    },\n}, {\n    id: \"12c613d4\",\n    equipment: {},\n    basicAttributes: generateRandomAttributes(),\n    name: \"Tedric the Bold\",\n    health: Math.random() * 100,\n    xp: Math.random() * 100,\n    baseAP: 6,\n    room: 7,\n    avatarImg: `${avatarImgBasePath}/male/m_33.png`,\n    spritesheetPath: `${spritesheetBasePath}knight-sword.json`,\n    inventory: [ Item.greatswordOfGwai, null, null, null ],\n    skills: {\n        [WeaponType.axe]: 10\n    },\n}];\n\n// TODO: To generate a random 11 digit number, use: Math.random().toString(36).substring(2)\n\nexport const adventurers: Reducer<AdventurerStoreState[], AnyAction> = (\n    state: AdventurerStoreState[] = initialAdventurers, action: AnyAction) => {\n\n    switch (action.type) {\n        // Moves an  item from one inventory slot to another\n        case ActionType.moveItemInInventory: {\n            const {\n                adventurerId,\n                fromSlot,\n                toSlot,\n            } = (action as MoveItemInInventoryAction);\n            const adventurer = state.find((a) => a.id === adventurerId)!;\n            const inventory = adventurer.inventory.map((element, index) => {\n                if (index === fromSlot) { return adventurer.inventory[toSlot]; }\n                if (index === toSlot) { return adventurer.inventory[fromSlot]; }\n                return element;\n            });\n\n            return state.map((element: AdventurerStoreState) => {\n                if (element === adventurer) {\n                    return {\n                        ...element,\n                        inventory,\n                    };\n                }\n                return element;\n            });\n        }\n\n        case ActionType.moveItemToOtherAdventurer: {\n            // Moves an item from one adventurer to another\n            const {\n                adventurerId: fromAdventurerId,\n                fromSlot,\n                toAdventurerId,\n            } = (action as MoveItemToOtherAdventurerAction);\n\n            const fromAdventurer = state.find((a) => a.id === fromAdventurerId)!;\n            const item = fromAdventurer.inventory[fromSlot];\n\n            return state.map((element: AdventurerStoreState) => {\n                if (element.id === fromAdventurerId) {\n                    // Clear out the item from this adventurer\n                    const inventory = element.inventory.concat();\n                    inventory[fromSlot] = null;\n                    return {\n                        ...element,\n                        inventory,\n                    };\n                } else if (element.id === toAdventurerId) {\n                    // Find first empty slot, add there\n                    const inventory = element.inventory.concat();\n                    const index = inventory.findIndex((slot) => slot === null);\n                    inventory[index] = item;\n                    // todo: what if there is no room?\n                    return {\n                        ...element,\n                        inventory,\n                    };\n                }\n                return element;\n            });\n        }\n\n        case ActionType.addItemToInventory: {\n            const { item } = action as InventoryAction;\n\n            return state.map((element: AdventurerStoreState) => {\n                if (element.id === action.adventurerId) {\n                    const inventory = element.inventory.concat();\n                    let toSlot = (action as InventoryAction).toSlot;\n                    if (toSlot === null || toSlot === undefined) {\n                        toSlot = inventory.findIndex((val) => (val === null || val === undefined));\n                    }\n                    inventory[toSlot!] = item;\n                    // todo: check if no space\n                    return {\n                        ...element,\n                        inventory,\n                    };\n                }\n                return element;\n            });\n        }\n\n        case ActionType.removeItemFromInventory: {\n            const { fromSlot } = action as RemoveItemFromInventoryAction;\n\n            return state.map((adventurer: AdventurerStoreState) => {\n                if (adventurer.id === action.adventurerId) {\n                    const inventory = adventurer.inventory.map((element, index) => index !== fromSlot ? element : null);\n                    return {\n                        ...adventurer,\n                        inventory,\n                    };\n                }\n                return adventurer;\n            });\n        }\n\n        case ActionType.assignEquipment: {\n            // Assigns equipment to an adventurer\n            const { equipmentSlot, item } = action as AssignEquipmentAction;\n            return state.map((adventurer: AdventurerStoreState) => {\n                if (adventurer.id === action.adventurerId) {\n                    return {\n                        ...adventurer,\n                        equipment: {\n                            ...adventurer.equipment,\n                            [EquipmentSlotType[equipmentSlot]]: item,\n                        },\n                    };\n                }\n                return adventurer;\n            });\n        }\n\n        case ActionType.removeEquipment: {\n            // Assigns equipment to an adventurer\n            const { equipmentSlot } = action as RemoveEquipmentAction;\n            return state.map((adventurer: AdventurerStoreState) => {\n                if (adventurer.id === action.adventurerId) {\n                    return {\n                        ...adventurer,\n                        equipment: {\n                            ...adventurer.equipment,\n                            [EquipmentSlotType[equipmentSlot]]: null,\n                        },\n                    };\n                }\n                return adventurer;\n            });\n        }\n        case ActionType.renameAdventurer: {\n            // Rename adventurer\n            const { name } = action as RenameAdventurerAction;\n            return state.map((adventurer: AdventurerStoreState) => {\n                if (adventurer.id === action.adventurerId) {\n                    return {\n                        ...adventurer,\n                        name\n                    };\n                }\n                return adventurer;\n            });\n        }\n        case ActionType.addXP: {\n            // Adds xp\n            const { xp } = action as AddXPAction;\n            return state.map((adventurer: AdventurerStoreState) => {\n                if (adventurer.id === action.adventurerId) {\n                    return {\n                        ...adventurer,\n                        xp: adventurer.xp + xp\n                    };\n                }\n                return adventurer;\n            });\n        }\n\n    }\n\n    // debug: this will auto-increase the levels of every adventurer at every tick\n    // return state.map((adventurer: AdventurerStoreState) => {\n    //     return {\n    //         ...adventurer,\n    //         xp: adventurer.xp + 1\n    //     };\n    // });\n\n    return state;\n};\n","import { ActionType as GameActionType, GameTickAction } from \"store/actions/game\";\r\nimport { AnyAction, Reducer } from \"redux\";\r\nimport { EngineStoreState } from \"store/types/engine\";\r\n\r\n/**\r\n * reducer\r\n * @param state\r\n * @param action\r\n */\r\nexport const engine: Reducer<EngineStoreState> = (state: EngineStoreState = getInitialEngineState(), action: AnyAction) => {\r\n    switch (action.type) {\r\n        case GameActionType.startGame: {\r\n            return {\r\n                ...state,\r\n                gameStarted: Date.now()\r\n            };\r\n        }\r\n        case GameActionType.gameTick: {\r\n\r\n            // Keep track of the last time resources were produced\r\n            const resourcesToAdd = (action as GameTickAction).resources;\r\n            const lastProducedUpdate = resourcesToAdd === null ? state.lastProducedUpdate : Date.now();\r\n            const previousTick = state.lastTick;\r\n\r\n            return {\r\n                ...state,\r\n                previousTick,\r\n                lastProducedUpdate,\r\n                lastTick: Date.now(),\r\n            };\r\n        }\r\n    }\r\n    return state;\r\n};\r\n\r\nexport const getInitialEngineState = () => {\r\n    return {\r\n        gameStarted: undefined,\r\n        previousTick: Date.now(),\r\n        lastTick: Date.now(),\r\n        lastProducedUpdate: Date.now()\r\n    }\r\n};\r\n","import { ActionType, ModifyGoldAction } from \"store/actions/gold\";\nimport { AnyAction, Reducer } from \"redux\";\n\n/**\n * reducer\n * @param state\n * @param action\n */\nexport const gold: Reducer<number> = (state: number = initialGoldState, action: AnyAction) => {\n    switch (action.type) {\n        case ActionType.addGold:\n            // Adds (or subtract, if negative) gold from the players gold supply\n            return state + (action as ModifyGoldAction).amount;\n    }\n    return state;\n};\n\nexport const initialGoldState = 40;","\r\nimport { ActionType, AddAction, AddStockpileSlotsAction, MoveItemInWarehouseAction, RemoveItemFromWarehouseAction } from \"store/actions/items\";\r\nimport { Item } from \"definitions/items/types\";\r\nimport { AnyAction, Reducer } from \"redux\";\r\nimport { getDefinition, Structure } from 'definitions/structures';\r\nimport { WarehouseStructureDefinition } from 'definitions/structures/types';\r\n\r\n// Items in warehouse\r\nexport const getItemsInitialState = () => {\r\n    // Generate some random stuff\r\n    const result = [];\r\n    const { maxStockpile } = getDefinition<WarehouseStructureDefinition>(Structure.warehouse).levels[0];\r\n    for (let i = 0; i < maxStockpile; i++) {\r\n        if (Math.random() < .5) {\r\n            result.push(null)\r\n        } else {\r\n            const randomItem = randomEnum(Item);\r\n            result.push(randomItem);\r\n        }\r\n    }\r\n    return result;\r\n}\r\n\r\nconst randomEnum = <T>(anEnum: T): T[keyof T] => {\r\n    const enumValues = (Object.values(anEnum) as unknown) as T[keyof T][];\r\n    const randomIndex = Math.floor(Math.random() * enumValues.length);\r\n    return enumValues[randomIndex];\r\n}\r\n\r\n/**\r\n * reducer\r\n * @param state\r\n * @param action\r\n */\r\nexport const items: Reducer<(Item|null)[]> = (state: (Item|null)[] = getItemsInitialState(), action: AnyAction) => {\r\n    switch (action.type) {\r\n        case ActionType.addItem: {\r\n            // toSlot is optional\r\n            const { item } = (action as AddAction);\r\n            let { toSlot } = (action as AddAction);\r\n            if (toSlot === undefined) {\r\n                toSlot = state.findIndex((slot) => slot === null);  // find first empty element\r\n                if (toSlot === -1) {\r\n                    // Still not found. Add at end\r\n                    // todo: [07/07/2019] GAME DESIGN\r\n                    return [ ...state, item ];\r\n                }\r\n            }\r\n            return state.map((element, index) => index === toSlot ? item : element);\r\n        }\r\n\r\n        case ActionType.moveItemInWarehouse: {\r\n            const {\r\n                fromSlot,\r\n                toSlot,\r\n            } = (action as MoveItemInWarehouseAction);\r\n\r\n            return state.map((element, index) => {\r\n                if (index === fromSlot) { return state[toSlot]; }\r\n                if (index === toSlot) { return state[fromSlot]; }\r\n                return element;\r\n            });\r\n        }\r\n        case ActionType.removeItem: {\r\n            const { fromSlot } = (action as RemoveItemFromWarehouseAction);\r\n\r\n            return state.map((element, index) => index !== fromSlot ? element : null);\r\n        }\r\n\r\n        // Adds slots with 'null' to the end\r\n        case ActionType.addStockpileSlots: {\r\n            const {\r\n                slots,\r\n            } = (action as AddStockpileSlotsAction);\r\n\r\n            return [\r\n                ...state,\r\n                ...Array(slots).fill(null)\r\n            ];\r\n        }\r\n    }\r\n\r\n    return state;\r\n};\r\n","import { ActionType as GameActionType, GameTickAction } from \"store/actions/game\";\nimport { ActionType, AddLogEntryAction } from \"store/actions/log\";\nimport { LogUpdate } from \"mechanics/gameTick/quests\";\nimport { AnyAction, Reducer } from \"redux\";\nimport { LogEntry } from \"store/types/logEntry\";\n\n/**\n * reducer\n * @param state\n * @param action\n */\nexport const log: Reducer<LogEntry[]> = (state: LogEntry[] = initialLogState, action: AnyAction) => {\n    switch (action.type) {\n        case ActionType.addLogEntry: {\n            const {entry, channel, channelContext} = (action as AddLogEntryAction);\n            const {key, context} = entry;\n            const time = Date.now();\n            return [{\n                    channel,\n                    channelContext,\n                    context,\n                    key,\n                    time,\n                },\n                ...state,\n            ];\n        }\n        case GameActionType.gameTick:\n            return gameTick(state, action as GameTickAction);\n    }\n    return state;\n};\n\nexport const initialLogState = [];\n\nconst gameTick = (state: LogEntry[], action: GameTickAction): LogEntry[] => {\n    if (!action.log.length) {\n        return state;\n    }\n\n    // Add log entries\n    const logEntries = action.log.map((lU: LogUpdate): LogEntry => {\n        return {\n            ...lU,\n            time: Date.now(),\n        };\n    });\n    return [\n        ...logEntries,\n        ...state,\n    ];\n};\n","import { ActionType as GameActionType, GameTickAction } from \"store/actions/game\";\nimport {\n    ActionType,\n    QuestAction,\n    QuestLaunchAction,\n    QuestVarsAction,\n    UpdateEncounterResultAction,\n    EnqueueSceneActionAction,\n    SetSceneNameAction,\n    SetSceneAction,\n    UpdateSceneObjectAction,\n    SetActiveSceneInteractionModalAction,\n    DeductActorApAction,\n    SetCombatAction\n} from \"store/actions/quests\";\nimport { AnyAction, Reducer } from \"redux\";\nimport { QuestStatus, QuestStoreState } from \"store/types/quest\";\nimport { isActorObject, SceneActionType } from 'store/types/scene';\nimport { QuestDefinition } from 'definitions/quests/types';\nimport { getDefinition } from 'definitions/quests';\nimport { initialQuestVars } from 'definitions/quests/kill10Boars/questVars';\nimport deepmerge from \"deepmerge\";\n\n// tslint:disable:object-literal-sort-keys\nexport const initialQuestState: QuestStoreState[] = [{\n    name: \"kill10Boars\",\n    status: QuestStatus.active,\n    party: [\n        \"c4a5d270\",\n        \"2e655832\",\n        \"ec6f1050\",\n        \"d299f98a\",\n    ],\n    progress: 0,\n    questVars: initialQuestVars,\n    encounterResults: [],\n    icon: \"sigil1.png\",\n// }, {\n//     name: \"retrieveMagicAmulet\",\n//     party: [],\n//     status: QuestStatus.available,\n//     progress: 0,\n//     questVars: {},\n//     encounterResults: [],\n//     icon: \"sigil2.png\",\n//     reward: {\n//         gold: 4,\n//         items: [ Item.deedForWeaponsmith ],\n//     },\n}];\n\n/**\n * reducer\n * @param state\n * @param action\n */\nexport const quests: Reducer<QuestStoreState[]> = (state: QuestStoreState[] = initialQuestState, action: AnyAction ): QuestStoreState[] => {\n    switch (action.type) {\n        case ActionType.launchQuest:\n            return launchQuest(state, action as QuestLaunchAction);\n\n        case ActionType.exitEncounter:\n            return exitEncounter(state, action as QuestAction);\n\n        case ActionType.updateQuestVars:\n            // Updates the questvars\n            return updateQuestVars(state, action as QuestVarsAction);\n\n        case ActionType.updateEncounterResult:\n            return updateEncounterResult(state, action as UpdateEncounterResultAction);\n\n        // case ActionType.startEncounter:\n        //     return startEncounter(state, action as StartEncounterAction);\n\n        case ActionType.setSceneName:\n            return setSceneName(state, action as SetSceneNameAction);\n\n        case ActionType.setScene:\n            return setScene(state, action as SetSceneAction);\n\n        case ActionType.enqueueSceneAction:\n            return enqueueSceneAction(state, action as EnqueueSceneActionAction);\n\n        case ActionType.completeSceneAction:\n            return completeSceneAction(state, action as QuestAction);\n\n        case ActionType.setCombat:\n            return setCombat(state, action as SetCombatAction);\n\n        case ActionType.deductActorAp:\n            return deductActorAp(state, action as DeductActorApAction);\n\n        case ActionType.updateSceneObjectAction:\n            return updateSceneObjectAction(state, action as UpdateSceneObjectAction);\n\n        case ActionType.setActiveSceneInteractionModal:\n            return setActiveSceneInteractionModal(state, action as SetActiveSceneInteractionModalAction);\n\n        case GameActionType.gameTick:\n           return gameTick(state, action as GameTickAction);\n\n    }\n    return state;\n};\n\n// Launches quest. Sets state to active, assigns adventurers\nconst launchQuest = (questStoreState: QuestStoreState[], action: QuestLaunchAction) => {\n    const party = action.assignedAventurers\n        .filter((adventurer) => !!adventurer)\n        .map((adventurer) => adventurer.id);\n\n    return questStoreState.map((qss) => {\n        if (qss.name === action.questName) {\n            const questDefinition: QuestDefinition = getDefinition(action.questName);\n            const questVars = questDefinition.getInitialQuestVars(qss);\n\n            return {\n                ...qss,\n                status: QuestStatus.active,\n                party,\n                questVars\n            };\n        }\n        return qss;\n    });\n};\n\nconst exitEncounter = (state: QuestStoreState[], action: QuestAction) => {\n    return state.map((qss) => {\n        if (qss.name === action.questName) {\n            const progress = qss.progress + 1;\n            // const questDefinition: QuestDefinition = questDefinitions[qss.name];\n            // const nextNode = questDefinition.nodes[Math.floor(progress)];\n\n            return {\n                ...qss,\n                progress,\n                scene: undefined,\n                sceneName: undefined\n            };\n        }\n        return qss;\n    });\n};\n\n// const startEncounter = (state: QuestStoreState[], action: StartEncounterAction) => {\n//     const {scene} = action;\n//     return state.map((qss) => {\n//         if (qss.name === action.questName) {\n//             return {\n//                 ...qss,\n//                 scene\n//             };\n//         }\n//         return qss;\n//     });\n// };\n\n// To change scene, set scene name. The scenecontroller will load the scene data and art assets\n// and call setScene reducer\nconst setSceneName = (state: QuestStoreState[], action: SetSceneNameAction) => {\n    return state.map((qss) => {\n        if (qss.name === action.questName) {\n            return {\n                ...qss,\n                sceneName: action.sceneName,\n                scene: undefined\n            };\n        }\n        return qss;\n    });\n};\n\nconst setScene = (state: QuestStoreState[], action: SetSceneAction) => {\n    return state.map((qss) => {\n        if (qss.name === action.questName) {\n            return {\n                ...qss,\n                scene: action.scene\n            };\n        }\n        return qss;\n    });\n};\n\n// Enqueues a scene action on this quest\nconst enqueueSceneAction = (state: QuestStoreState[], action: EnqueueSceneActionAction) => {\n    return state.map((qss) => {\n        if (qss.name === action.questName) {\n            const scene = qss.scene;\n            if (!scene) throw new Error(\"Something broke. No scene\");\n            scene.actionQueue = [...scene.actionQueue || [], action.sceneAction];\n\n            return {\n                ...qss,\n                scene\n            };\n        }\n        return qss;\n    });\n};\n\n// next action on scene is completed\nconst completeSceneAction = (state: QuestStoreState[], action: QuestAction) => {\n    return state.map((qss) => {\n        if (qss.name === action.questName) {\n            const scene = qss.scene;\n            if (!scene) throw new Error(\"Something broke. No scene\");\n            const sceneAction = scene.actionQueue![0];\n            if (!sceneAction) return qss;\n\n            switch (sceneAction.actionType) {\n                case SceneActionType.move: {\n                    scene.objects = scene.objects.map((a) => {\n                        if (isActorObject(a) && a.name === sceneAction.actorId) {\n                            return {\n                                ...a,\n                                location: sceneAction.target\n                            };\n                        }\n                        return a;\n                    })\n                }\n            }\n\n            // pop first action of the stack\n            scene.actionQueue = [\n                ...scene.actionQueue!.slice(1)\n            ];\n\n            return {\n                ...qss,\n                scene\n            };\n        }\n        return qss;\n    });\n};\n\n\nconst setCombat = (state: QuestStoreState[], action: SetCombatAction) => {\n    const {combat} = action;\n    return state.map((qss) => {\n        if (qss.name === action.questName) {\n            const scene = { ...qss.scene!, combat };\n            return {\n                ...qss,\n                scene\n            };\n        }\n        return qss;\n    });\n};\n\nconst deductActorAp = (state: QuestStoreState[], action: DeductActorApAction) => {\n    return state.map((qss) => {\n        if (qss.name === action.questName) {\n            const scene = qss.scene;\n            if (!scene) throw new Error(\"Something broke. No scene\");\n\n            // todo!!\n            // scene.actors = scene.actors.map(a => {\n            //     if (a.id === action.actor) {\n            //         const ap = a.ap - action.ap;\n            //         return {\n            //             ...a,\n            //             ap\n            //         };\n            //     }\n            //     return a;\n            // })\n\n            return {\n                ...qss,\n                scene\n            };\n        }\n        return qss;\n    });\n}\n\nconst updateSceneObjectAction = (state: QuestStoreState[], action: UpdateSceneObjectAction) => {\n    return state.map((qss) => {\n        if (qss.name === action.questName) {\n            const scene = qss.scene;\n            if (!scene) throw new Error(\"Something broke. No scene\");\n\n            scene.objects = scene.objects.map(tO => {\n                if (tO.id === action.id) {\n                    return {\n                        ...tO,\n                        ...action.object\n                    }\n                }\n                return tO;\n            })\n\n            return {\n                ...qss,\n                scene\n            };\n        }\n        return qss;\n    });\n}\n\n\nconst gameTick = (state: QuestStoreState[], action: GameTickAction) => {\n    const questsToUpdate = action.quests;\n    if (!questsToUpdate.length) {\n        return state;\n    }\n\n    return state.map((qss) => {\n        const questToUpdate = questsToUpdate.find((q) => q.name === qss.name);\n        if (questToUpdate) {\n            const progress = questToUpdate.progress;\n            // const currentEncounter = questToUpdate.currentEncounter;\n\n            return {\n                ...qss,\n                progress,\n                // currentEncounter,\n            };\n        }\n        return qss;\n    });\n};\n\nconst updateQuestVars = (state: QuestStoreState[], action: QuestVarsAction)  => {\n    return state.map((qss) => {\n        if (qss.name === action.questName) {\n            return {\n                ...qss,\n                // todo: sort this out\n                // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n                // @ts-ignore\n                questVars: deepmerge(qss.questVars, action.vars, { arrayMerge: overwriteMerge })\n            };\n        }\n        return qss;\n    });\n};\n\nconst updateEncounterResult = (state: QuestStoreState[], action: UpdateEncounterResultAction)  => {\n    return state.map((qss: QuestStoreState) => {\n        if (qss.name === action.questName) {\n            const encounterResults = qss.encounterResults.concat();\n            encounterResults[action.nodeIndex] = action.result;\n            return {\n                ...qss,\n                encounterResults,\n            };\n        }\n        return qss;\n    });\n};\n\nconst setActiveSceneInteractionModal = (state: QuestStoreState[], action: SetActiveSceneInteractionModalAction) => {\n    return state.map((qss: QuestStoreState) => {\n        if (qss.name === action.questName && qss.scene) {\n            qss.scene.activeInteractionModal = action.sceneInteractionModal\n        }\n        return qss;\n    });\n}\n\n// const takeGoldFromCache = (state: QuestStoreState[], action: TakeGoldFromCacheAction) => {\n//     return state.map((qss: QuestStoreState) => {\n//         if (qss.name === action.questName && qss.scene) {\n//             const lootCaches = {\n//                 ...qss.scene?.caches,\n//                 [action.cacheName]: {\n//                     ...qss.scene?.caches[action.cacheName],\n//                     gold: 0\n//                 }\n//             }\n//             qss.scene.caches = lootCaches;\n//         }\n//         return qss;\n//     });\n// }\n\n// const takeItemFromCache = (state: QuestStoreState[], action: TakeItemFromCacheAction) => {\n//     return state.map((qss: QuestStoreState) => {\n//         if (qss.name === action.questName && qss.scene) {\n//             const cache = qss.scene.caches[action.cacheName];\n//             const index = cache.items.indexOf(action.item);\n//             if (index > -1 ) {\n//                 qss.scene.caches[action.cacheName].items = [\n//                     ...cache.items.slice(0, index),\n//                     ...cache.items.slice(index + 1)\n//                 ]\n//             }\n//         }\n//         return qss;\n//     });\n// }\n\n// // Call this when the quest has progressed a node. Will return either `log` or a new array\n// // with all values of `log` and a new value appended\n// const addLogMessage = (log: string[],\n//                        currentNode: QuestNode, nextNode: QuestNode, quest: QuestStoreState): string[] => {\n//     if (currentNode.type === QuestNodeType.nothing && nextNode.type === QuestNodeType.nothing) {\n//         // Moved from a 'nothing' node to a 'nothing' node\n//         // There is no need to flood the log with unimportant messages\n//         return log;\n//     }\n//     switch (nextNode.type) {\n//         case QuestNodeType.nothing:\n//             return [\n//                 ...log,\n//                 \"The party trrrudges on\",\n//             ];\n//         case QuestNodeType.encounter:\n//             const encounter = nextNode.encounter!;\n//             console.log(encounter.getDescription(oracle))\n//             //return log;\n//             return [\n//                 ...log,\n//                 encounter.getDescription(oracle),\n//             ]\n//         default:\n//             return log;\n//     }\n// }\n\nconst overwriteMerge = (destinationArray: any[], sourceArray: any[]) => sourceArray","import { ActionType as GameActionType, GameTickAction } from \"store/actions/game\";\r\nimport { AnyAction, Reducer } from \"redux\";\r\nimport { ActionType, AddResources } from \"store/actions/resources\";\r\nimport { ResourceStoreState } from \"store/types/resources\";\r\nimport { Resource } from \"definitions/resources\";\r\n\r\n/**\r\n * reducer\r\n * @param state\r\n * @param action\r\n */\r\nexport const resources: Reducer<ResourceStoreState> = (state: ResourceStoreState = initialResourcesState,\r\n                                                       action: AnyAction | GameTickAction) => {\r\n\r\n    const addResources = (resourcesToAdd: ResourceStoreState) => {\r\n        // todo: Check if warehouse can hold it\r\n        return Object.keys(state).reduce<ResourceStoreState>((acc, value) => {\r\n            const resource = value as Resource;\r\n            acc[resource] = state[resource]! + (resourcesToAdd[resource] || 0);\r\n            return acc;\r\n        }, {});\r\n    };\r\n\r\n    switch (action.type) {\r\n        case ActionType.addResources: {\r\n            const resourcesToAdd = (action as AddResources).resources;\r\n            return addResources(resourcesToAdd);\r\n        }\r\n        case ActionType.removeResources: {\r\n            const resourcesToRemove = (action as AddResources).resources;\r\n            return Object.keys(state).reduce<ResourceStoreState>((acc, value) => {\r\n                const resource = value as Resource;\r\n                acc[resource] = state[resource]! - (resourcesToRemove[resource] || 0);\r\n                return acc;\r\n            }, {});\r\n        }\r\n\r\n        case GameActionType.gameTick: {\r\n            const resourcesToAdd = (action as GameTickAction).resources;\r\n            if (resourcesToAdd === null) {\r\n                return state;\r\n            }\r\n            return addResources(resourcesToAdd);\r\n        }\r\n    }\r\n    return state;\r\n};\r\n\r\nexport const initialResourcesState: ResourceStoreState = {\r\n    fabric: 0,\r\n    food: 0,\r\n    iron: 10,\r\n    leather: 0,\r\n    stone: 0,\r\n    wood: 10,\r\n};","import { ActionType } from \"store/actions/game\";\nimport { AnyAction, Reducer } from \"redux\";\nimport { State as seedrandomStateType } from \"seedrandom\";\n\nexport const initialRngState = false;\n/**\n * reducer\n * @param state\n * @param action\n */\nexport const rngState: Reducer<seedrandomStateType, AnyAction> = (state: seedrandomStateType = initialRngState, action: AnyAction) => {\n    if (action.type === ActionType.gameTick && action.rngState != null) {\n        state = Object.assign({}, action.rngState);\n    }\n    return state;\n};\n","import { AnyAction, Reducer } from \"redux\";\nimport { ActionType, StructureStateAction, WorkerCountAction, AddItemToProducesAction, StructureAction } from \"store/actions/structures\";\nimport { Structure } from \"definitions/structures\";\nimport { ProductionStructureStoreState, StructureState, StructureStoreState } from \"store/types/structure\";\nimport { isProductionStructure, StructuresStoreState } from \"store/types/structures\";\nimport { Item } from \"definitions/items/types\";\n\n/**\n * reducer\n * @param state\n * @param action\n */\nexport const structures: Reducer<StructuresStoreState, AnyAction> = (state: StructuresStoreState = initialStructuresState, action: AnyAction) => {\n    switch (action.type) {\n        case ActionType.startBuildingStructure: {\n            return updateStructureState(state, action.structure, StructureState.Building);\n        }\n        case ActionType.finishBuildingStructure: {\n            return updateStructureState(state, action.structure, StructureState.Built);\n        }\n        case ActionType.upgradeStructure: {\n            return upgradeStructureState(state, action as StructureAction);\n        }\n        case ActionType.increaseWorkers: {\n            return increaseWorkers(state, action as WorkerCountAction);\n        }\n        case ActionType.decreaseWorkers: {\n            return decreaseWorkers(state, action as WorkerCountAction);\n        }\n        case ActionType.setStructureState: {\n            const { state: structureState } = action as StructureStateAction;\n            return updateStructureState(state, action.structure, structureState);\n        }\n        case ActionType.addItemToToProduces: {\n            return addItemToToProduces(state, action as AddItemToProducesAction)\n        }\n    }\n    return state;\n};\n\nconst updateStructureState = (state: StructuresStoreState, structure: Structure, structureState: StructureState) => {\n    const structureStore: StructureStoreState = {\n        ...state[structure],\n        state: structureState,\n    };\n    return {\n        ...state,\n        [structure]: structureStore,\n    };\n};\n\nconst upgradeStructureState = (state: StructuresStoreState, action: StructureAction) => {\n    const level = state[action.structure].level + 1;\n    const structureStore: StructureStoreState = {\n        ...state[action.structure],\n        level,\n    };\n    return {\n        ...state,\n        [action.structure]: structureStore,\n    };\n\n};\n\nconst increaseWorkers = (state: StructuresStoreState, action: WorkerCountAction) => {\n    const { workers: workersToAdd } = action;\n    const workers = state[action.structure].workers + workersToAdd;\n    const structureStore: StructureStoreState = {\n        ...state[action.structure],\n        workers,\n    };\n    return {\n        ...state,\n        [action.structure]: structureStore,\n    };\n}\n\nconst decreaseWorkers = (state: StructuresStoreState, action: WorkerCountAction) => {\n    const { workers: workersToRemove } = action;\n    const workers = state[action.structure].workers - workersToRemove;\n    const structureStore: StructureStoreState = {\n        ...state[action.structure],\n        workers,\n    };\n    return {\n        ...state,\n        [action.structure]: structureStore,\n    };\n}\n\nconst addItemToToProduces = (state: StructuresStoreState, action: AddItemToProducesAction) => {\n    // Adds given item to a structures' `produces` list\n    if (isProductionStructure(action.structure)){\n        return state;\n    }\n\n    const { item } = action;\n    const produces = [\n        ...(state[action.structure] as ProductionStructureStoreState).produces,\n        item\n    ];\n    const structureStore: ProductionStructureStoreState = {\n        ...state[action.structure],\n        produces,\n    };\n    return {\n        ...state,\n        [action.structure]: structureStore,\n    };\n\n}\n\nexport const structureInitialState: StructureStoreState = {\n    level: 0,\n    state: StructureState.NotBuilt,\n    workers: 0,\n};\n\nexport const initialStructuresState: StructuresStoreState = {\n    [Structure.alchemist]:  { ...structureInitialState, produces: [ ] },\n    [Structure.armoursmith]: { ...structureInitialState, produces: [ Item.boots1 ] },\n    [Structure.garden]: { level: 0, workers: 0, state: StructureState.Built  }, // TODO: change back to NotBuilt\n    [Structure.lumberMill]: structureInitialState,\n    [Structure.mine]: { level: 0, workers: 0, state: StructureState.NotBuilt  },\n    [Structure.quarry]: structureInitialState,\n    [Structure.tavern]: { level: 0, workers: 0, state: StructureState.Built },\n    [Structure.tannery]: structureInitialState,\n    [Structure.warehouse]: { level: 0, workers: 0, state: StructureState.Built},\n    [Structure.weaponsmith]:  { ...structureInitialState, produces: [ Item.simpleCrossbow, Item.dagger ] },\n    [Structure.weaver]: structureInitialState,\n    [Structure.workshop]:  { ...structureInitialState, produces: [ Item.torch, Item.sandwich ] },\n};\n","import { Structure } from \"definitions/structures\";\nimport { ProductionStructureStoreState, StructureStoreState } from \"./structure\";\n\nexport interface StructuresStoreState {\n    [Structure.alchemist]: ProductionStructureStoreState;\n    [Structure.armoursmith]: ProductionStructureStoreState;\n    [Structure.garden]: StructureStoreState;\n    [Structure.lumberMill]: StructureStoreState;\n    [Structure.mine]: StructureStoreState;\n    [Structure.quarry]: StructureStoreState;\n    [Structure.tavern]: StructureStoreState;\n    [Structure.tannery]: StructureStoreState;\n    [Structure.warehouse]: StructureStoreState;\n    [Structure.weaponsmith]: ProductionStructureStoreState;\n    [Structure.weaver]: StructureStoreState;\n    [Structure.workshop]: ProductionStructureStoreState;\n}\n\n// Type guard\nexport const isProductionStructure = (structure: Structure) => {\n    return structure === Structure.alchemist ||\n        structure === Structure.armoursmith ||\n        structure === Structure.weaponsmith ||\n        structure === Structure.workshop;\n}","\nimport { ActionType as GameActionType } from \"store/actions/game\";\nimport {  ActionType, AddAction} from \"store/actions/tasks\";\nimport { AnyAction, Reducer } from \"redux\";\nimport { TaskStoreState } from \"store/types/task\";\nimport {  TasksStoreState } from \"store/types/tasks\";\n\n/**\n * Tasks reducer\n * @param state\n * @param action\n */\nexport const tasks: Reducer<TasksStoreState> = (state: TasksStoreState = initialTasksState, action: AnyAction ) => {\n    switch (action.type) {\n        case ActionType.start: {\n        // Adds a new task to the running tasks\n            const task: TaskStoreState = createTask(action as AddAction);\n            const running = state.running.concat(task);\n            return {\n                ...state,\n                running,\n            };\n        }\n        case GameActionType.gameTick: {\n            // Will update all tasks in `running`. If a running task expires it is placed in `complete`\n            // Note that completed tasks must be handled BEFORE the next call to ActionType.update, because\n            // this list is recreated every time\n            const now: number = Date.now();\n            const running: TaskStoreState[] = [];\n            const completed: TaskStoreState[] = [];\n            state.running.forEach((t) => {\n                const end = now + t.timeRemaining;\n                const progress = (now - t.startTime) / (end - t.startTime);\n                const timeRemaining = t.timeRemaining - (now - t.lastTick);\n                const task = {\n                    ...t,\n                    progress,\n                    lastTick: now,\n                    timeRemaining,\n                };\n                if (timeRemaining < 0) {\n                    completed.push(task);\n                } else {\n                    running.push(task);\n                }\n            });\n\n            return {\n                running,\n                completed,\n            };\n        }\n    }\n    return state;\n};\n\nconst createTask = (action: AddAction): TaskStoreState => {\n    return {\n        name: action.name,\n        origin: action.origin,\n        type: action.taskType,\n        callbacks: action.callbacks,\n        timeRemaining: action.time,\n        startTime: Date.now(),\n        lastTick: Date.now(),\n        progress: 0,\n    };\n};\n\nexport const initialTasksState: TasksStoreState = {\n    completed: [],\n    running: [],\n};","import { AnyAction, Reducer } from \"redux\";\nimport { ActionType, ModifyWorkersAction } from 'store/actions';\n\n/**\n * reducer\n * @param state\n * @param action\n */\nexport const workers: Reducer<number> = (state: number = initialWorkersState, action: AnyAction) => {\n    switch (action.type) {\n        case ActionType.addWorkers:\n            // Adds (or subtract, if negative) from the players workers\n            return state + (action as ModifyWorkersAction).value;\n    }\n    return state;\n};\n\nexport const initialWorkersState = 13;","import { combineReducers } from \"redux\";\nimport { StoreState } from \"store/types\"\nimport { barBrawl } from \"store/types/combat\";\nimport { adventurers, initialAdventurers } from \"./adventurers\";\nimport { combat } from \"./combat\";\nimport { engine, getInitialEngineState } from \"./engine\";\nimport { gold, initialGoldState } from \"./gold\";\nimport { getItemsInitialState, items } from \"./items\";\nimport { initialLogState, log } from \"./log\";\nimport { initialQuestState, quests } from \"./quests\";\nimport { initialResourcesState, resources } from \"./resources\";\nimport { initialRngState, rngState } from \"./rngState\";\nimport { initialStructuresState, structures } from \"./structures\";\nimport { initialTasksState, tasks } from \"./tasks\";\nimport { initialWorkersState, workers } from \"./workers\";\n\nexport default combineReducers<StoreState>({\n    adventurers,\n    combat,\n    engine,\n    gold,\n    stockpile: items,\n    log,\n    quests,\n    resources,\n    rngState,\n    structures,\n    tasks,\n    workers,\n});\n\nexport const createInitialStore = () => ({\n    adventurers: initialAdventurers,\n    combat: barBrawl,\n    engine: getInitialEngineState(),\n    gold: initialGoldState,\n    stockpile: getItemsInitialState(),\n    log: initialLogState,\n    quests: initialQuestState,\n    resources: initialResourcesState,\n    rngState: initialRngState,\n    structures: initialStructuresState,\n    tasks: initialTasksState,\n    workers: initialWorkersState\n})","import { ActionType, AddCombatActionAction, MoveActorAction } from \"store/actions/combat\";\nimport { AnyAction, Reducer } from \"redux\";\nimport { barBrawl, CombatStoreState } from \"store/types/combat\";\n\n/**\n * reducer\n * @param state\n * @param action\n */\nexport const combat: Reducer<CombatStoreState> = (state: CombatStoreState = barBrawl, action: AnyAction) => {\n    switch (action.type) {\n        case ActionType.startCombatAction: {\n            const addAction = action as AddCombatActionAction;\n\n            return {\n                ...state,\n                action: {\n                    actor: addAction.actor,\n                    endsAt: addAction.endsAt,\n                    target: addAction.target,\n                    type: addAction.combatType,\n                },\n            };\n        }\n        case ActionType.moveActor: {\n            const moveAction = action as MoveActorAction;\n\n            // Moves an actor to another position\n            const actors = state.actors.map((a) => {\n                if (a.name === moveAction.actor) {\n                    return {\n                        ...a,\n                        location: moveAction.location,\n                    };\n                }\n                return a;\n            });\n\n            return {\n                ...state,\n                actors,\n            };\n        }\n        case ActionType.clearCombatAction: {\n            // Clears current combat action\n            return {\n                ...state,\n                action: undefined,\n            };\n        }\n    }\n    return state;\n};\n","import { createStore, DeepPartial, AnyAction, Store } from \"redux\";\nimport { Persistor, persistReducer, persistStore } from \"redux-persist\";\nimport localForage from 'localforage';\nimport rootReducer from \"store/reducers/index\";\nimport { asInt } from \"constants/version\";\nimport { storeIsRehydrated } from 'store/helpers/storeHelpers';\nimport { StoreState } from 'store/types';\n\nconst persistConfig = {\n    key: \"root\",\n    storage: localForage,\n    version: asInt,\n};\n\nconst persistedReducer = persistReducer<StoreState, AnyAction>(persistConfig, rootReducer);\n\ninterface ConfigureStoreResult {\n    store: Store;\n    persistor: Persistor;\n    isHydrated: boolean;\n}\n\n/**\n * Configures the redux store\n */\nconst configureStore = async (initial: DeepPartial<StoreState> = {}): Promise<ConfigureStoreResult> => {\n    return new Promise((resolve, _reject) => {\n        const store = createStore(\n            persistedReducer,\n            // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n            // @ts-ignore\n            initial,\n            (window as any).__REDUX_DEVTOOLS_EXTENSION__ && (window as any).__REDUX_DEVTOOLS_EXTENSION__(),\n        );\n        const persistor = persistStore(store, undefined, () => {\n            const isHydrated = storeIsRehydrated(store.getState());\n            resolve({ store, persistor, isHydrated }) ;\n        });\n    });\n};\n\nexport default configureStore;","import { TaskStoreState, TaskType } from 'store/types/task';\nimport { TasksStoreState } from 'store/types/tasks';\nimport { AnyAction, Dispatch } from \"redux\";\nimport { ToastManager } from 'global/ToastManager';\nimport { TextManager } from 'global/TextManager';\nimport { Type } from 'components/ui/toasts/Toast';\nimport { getDefinition } from 'definitions/items';\nimport { Item } from 'definitions/items/types';\n\nexport const processCompletedTasks = (tasks: TasksStoreState, dispatch: Dispatch<AnyAction>) => {\n    const handleCompletedTask = (task: TaskStoreState) => {\n        // Fire all callbacks\n        task.callbacks.forEach((action) => dispatch(action));\n\n        switch (task.type) {\n            case TaskType.craftItem: {\n                const item = task.name as Item;\n                const title = TextManager.get(\"common-item-crafted\", { item });\n                const definition = getDefinition(item);\n                ToastManager.addToast(title, Type.itemCrafted, definition.iconImg);\n                break;\n            }\n        }\n    };\n\n    tasks.completed.forEach((task) => handleCompletedTask(task));\n};","export interface TextEntry {\r\n    key: string;\r\n    context?: unknown;\r\n}\r\n\r\nexport function isTextEntry(test: any): test is TextEntry {\r\n    return typeof test.key === 'string';\r\n}","import { Store, AnyAction, DeepPartial } from \"redux\";\nimport { addAllTilesInLayerToList, locationEquals, TiledObjectType, parseProperties } from 'utils/tilemap';\nimport { StoreState } from 'store/types';\nimport { loadResourceAsync } from 'utils/pixiJs';\nimport { TiledLayerType, TiledMapData, TiledObjectData } from 'constants/tiledMapData';\nimport { AStarFinder } from 'astar-typescript';\nimport { AdventurerStoreState } from 'store/types/adventurer';\nimport { setScene, setSceneName, exitEncounter, enqueueSceneAction, updateQuestVars } from 'store/actions/quests';\nimport { SceneObject, ActorObject, LootCache, SceneActionType, SceneAction, isActorObject, getSpritesheetPaths } from 'store/types/scene';\nimport { ToastManager } from 'global/ToastManager';\nimport { Type } from 'components/ui/toasts/Toast';\nimport { getQuestLink } from 'utils/routing';\nimport { TextEntry, isTextEntry } from 'constants/text';\nimport { TextManager } from 'global/TextManager';\nimport { addLogText, addLogEntry } from 'store/actions/log';\nimport { getDefinition } from 'definitions/quests';\nimport { LogChannel } from 'store/types/logEntry';\nimport { addGold } from 'store/actions/gold';\nimport { addItemToInventory, removeItemFromInventory } from 'store/actions/adventurers';\nimport { adventurersOnQuest } from 'store/helpers/storeHelpers';\nimport { GameSound, SoundManager } from 'global/SoundManager';\nimport { Allegiance } from \"store/types/combat\";\nimport { Item } from \"definitions/items/types\";\n\nconst spritesheetBasePath = \"img/scene/actors/\";\nconst movementDuration = 500; // time every tile movement takes\n\n/**\n * This is a type of God class that knows pretty much everything about a scene\n */\nexport class BaseSceneController<TQuestVars> {\n\n    public questName: string;\n    public mapData?: TiledMapData;\n    public aStar?: AStarFinder;\n    public dataLoading = false;\n    public dataLoadComplete = false;\n\n    protected jsonPath?: string;\n    protected store: Store<StoreState, AnyAction>;\n    protected blockedTiles: [number, number][] = [];\n\n    constructor(store: Store<StoreState, AnyAction>, questName: string) {\n        this.store = store;\n        this.questName = questName;\n    }\n\n    get basePath(): string | null {\n        if (!this.jsonPath) return null;\n        return `${process.env.PUBLIC_URL}/${this.jsonPath.substr(0, this.jsonPath.lastIndexOf('/'))}`;\n    }\n\n\n    // Loads tiles from json, loads all scene assets\n    loadData(callback: () => void) {\n        if (this.dataLoadComplete) {\n            return callback();\n        }\n        if (!this.jsonPath) {\n            throw new Error(\"No jsonPath defined!\");\n        }\n        this.dataLoading = true;\n        // load sounds\n        const loadSound = async (sound: GameSound, files: string[]): Promise<PIXI.sound.Sound[]> => {\n            return new Promise((resolve, _reject) => {\n                SoundManager.addSound(sound, files, (sounds) => {\n                    resolve(sounds);\n                })\n            });\n        }\n        const promises = [\n            loadSound(\"scene/bow\", [\"sound/scene/bow-01.mp3\", \"sound/scene/bow-02.mp3\"]),\n            loadSound(\"scene/meleeHit\", [\"sound/scene/melee-hit-01.mp3\", \"sound/scene/melee-hit-02.mp3\", \"sound/scene/melee-hit-03.mp3\"]),\n            loadSound(\"scene/metalBash\", [\"sound/scene/metal-bash-01.mp3\", \"sound/scene/metal-bash-02.mp3\", \"sound/scene/metal-bash-03.mp3\"]),\n            loadSound(\"scene/shieldBash\", [\"sound/scene/shield-bash-impact.mp3\"]),\n            loadSound(\"scene/swish\", [\"sound/scene/swish-01.mp3\", \"sound/scene/swish-02.mp3\", \"sound/scene/swish-03.mp3\", \"sound/scene/swish-04.mp3\"]),\n            loadSound(\"scene/doorOpen\", [\"sound/scene/door.ogg\"]),\n            loadResourceAsync(`${process.env.PUBLIC_URL}/${this.jsonPath}`)\n        ] as const;\n\n        Promise.all(promises).then(async () => {\n            const resource = PIXI.Loader.shared.resources[`${process.env.PUBLIC_URL}/${this.jsonPath}`];\n            this.mapData = resource.data;\n\n            // Create aStar based on blocked tiles\n            this.createBlockedTiles();\n            this.aStar = this.createAStar();\n\n            // In the case a scene is just created, we dont have this.sceneObjects yet\n            const spritesheets = getSpritesheetPaths(this.sceneObjects.length ? this.sceneObjects : this.createObjects());\n            for(const path of spritesheets) {\n                await loadResourceAsync(path);\n            }\n            // PIXI.utils.clearTextureCache()\n            this.dataLoadComplete = true;\n            this.dataLoading = false;\n            callback();\n        });\n    }\n\n    createBlockedTiles(objects?: SceneObject[]) {\n        this.blockedTiles = [];\n        this.mapData?.layers.filter(layer => layer.visible).forEach(layer => {\n            if (layer.properties && layer.properties.some(p => p.name === 'blocksMovement' && p.value === true)){\n                addAllTilesInLayerToList(this.blockedTiles, layer, layer.width);\n            }\n        });\n        objects?.forEach(o => {\n            if(o.properties.blocksMovement === true && o.location){\n                this.blockedTiles.push(o.location);\n            }\n        });\n    }\n\n    // Constructs the scene and dispatches it to be saved to the store\n    createScene() {\n        const objects = this.createObjects();\n        const combat = false;\n        this.updateScene(objects, combat)\n    }\n\n    updateScene(objects: SceneObject[] = this.sceneObjects, combat: boolean = this.combat) {\n        const scene = {\n            ...this.quest.scene,\n            objects,\n            combat\n        }\n        this.dispatch(setScene(this.questName, scene));\n\n        this.createBlockedTiles(objects);\n\n        // Create aStar based on blocked tiles\n        if (this.mapData) {\n            this.aStar = this.createAStar();\n        }\n    }\n\n    sceneEntered() {\n        // tslint:disable-next-line: no-empty\n    }\n\n    // Convenience function returns an object with tileWidth and tileHeight properties\n    getTileDimensions() {\n        return {\n            tileWidth: this.mapData?.tilewidth || 0,\n            tileHeight: this.mapData?.tileheight || 0\n        }\n    }\n\n    actorMoved(_actor: string, location: [number, number]) {\n        // const object = this.tilemapObjects![`${location[0]},${location[1]}`];\n        const destination = this.getObjectAtLocation(location);\n        if (!destination) return;\n\n        if (destination.type === TiledObjectType.exit) {\n            // We've hit the exit. Should we load another scene?\n            if (destination.properties.loadScene) {\n                this.dispatch(setSceneName(this.questName, destination.properties.loadScene as string))\n            } else {\n                // Or exit the encounter\n                const index = Math.floor(this.quest.progress) + 1;\n                const definition = getDefinition(this.questName);\n                const node = definition.nodes[index];\n                if (node.log) {\n                    // If the next node has a log entry, add it\n                    this.dispatch(addLogText(node.log, null, LogChannel.quest, this.questName));\n                }\n                this.dispatch(exitEncounter(this.questName));\n            }\n        }\n    }\n\n    actorInteract(actorId: string, location: [number, number]) {\n        const actor = this.getSceneActor(actorId);\n        const object = this.getObjectAtLocation(location);\n\n        if (!object) {\n            // tslint:disable-next-line: no-console\n            console.warn(\"No object found\");\n            return;\n        }\n\n        this.interactWithObject(actor, object);\n    }\n\n    actorAttemptAction(actorId: string, type: SceneActionType, destination: [number, number]) {\n        // Tries to perform action on given actor\n\n        const actor = this.getSceneActor(actorId);\n        const {location} = actor;\n\n        switch (type) {\n            case SceneActionType.move: {\n                // Find path to move using aStar\n                const path = this.findPath(location!, destination);\n\n                if (this.combat) {\n                    const remaining = actor.ap || -1;\n                    if (remaining < (path?.length || 0)) {\n                        // return;\n                    }\n                    // this.dispatch(deductActorAp(this.questName, actorId, path?.length || 0));\n                }\n                path?.forEach((l, index) => {\n                    const sceneAction: SceneAction = {\n                        actionType: SceneActionType.move,\n                        actorId,\n                        target: l as [number, number],\n                        endsAt: movementDuration * (index + 1) + performance.now()\n                    };\n                    this.dispatch(enqueueSceneAction(this.questName, sceneAction));\n                });\n                break;\n            }\n            case SceneActionType.interact: {\n                const path = this.findPathNearest(location!, destination);\n                path?.forEach((l, index) => {\n                    const moveAction: SceneAction = {\n                        actionType: SceneActionType.move,\n                        actorId,\n                        target: l as [number, number],\n                        endsAt: movementDuration * (index + 1) + performance.now()\n                    };\n                    this.dispatch(enqueueSceneAction(this.questName, moveAction));\n                });\n\n                const interactAction: SceneAction = {\n                    actionType: SceneActionType.interact,\n                    actorId,\n                    target: destination,\n                    endsAt: movementDuration * path.length + performance.now()\n                };\n                this.dispatch(enqueueSceneAction(this.questName, interactAction));\n                break;\n            }\n            case SceneActionType.slash: {\n                // Find path to move towards the target\n                const path = this.findPath(location!, destination);\n                const target = path?.pop();\n                if (!path || !target) {\n                    // No path possible.. cant do anything now\n                    return;\n                }\n\n                // Walk towards the target\n                path?.forEach((l, index) => {\n                    const moveAction: SceneAction = {\n                        actionType: SceneActionType.move,\n                        actorId,\n                        target: l as [number, number],\n                        endsAt: movementDuration * (index + 1) + performance.now()\n                    };\n                    this.dispatch(enqueueSceneAction(this.questName, moveAction));\n                });\n                const meleeAction: SceneAction = {\n                    actionType: type,\n                    actorId,\n                    target,\n                    endsAt: movementDuration * (path.length + 1) + performance.now()\n                };\n                this.dispatch(enqueueSceneAction(this.questName, meleeAction));\n                // this.dispatch(deductActorAp(this.questName, actorId, path?.length || 0));\n            }\n        }\n    }\n\n    interactWithObject(_actor: ActorObject, _object: SceneObject) {\n        // override\n    }\n\n    // Converts pixel coordinate to scene location\n    pointToSceneLocation (point: PIXI.Point): [number, number] {\n        if (!this.mapData?.tilewidth || !this.mapData?.tileheight) {\n            return [0, 0];\n        }\n        return [Math.floor(point.x / this.mapData.tilewidth), Math.floor(point.y / this.mapData.tilewidth)];\n    }\n\n    // Returns true if the tile is blocked\n    locationIsBlocked(location: [number, number]){\n        return this.blockedTiles.some((l) => locationEquals(l, location));\n    }\n\n    // Returns true if outsie of the bounds of the map\n    locationIsOutOfBounds(location: [number, number]) {\n        if (!this.mapData) return true;\n\n        return location[0] < 0 || location[1] < 0 ||\n            location[0] >= this.mapData.width ||\n            location[1] >= this.mapData.height;\n    }\n\n    // Should be overridden\n    getLootCache(_name: string): LootCache | undefined {\n        // Override this to retrieve LootCache from questvars\n        return;\n    }\n\n    takeGoldFromCache(name: string) {\n        // Override this to remove gold from questvars\n        const lootCache = this.getLootCache(name);\n        if (lootCache){\n            this.dispatch(addGold(lootCache.gold || 0));\n        }\n    }\n\n    takeItemFromCache(itemIndex: number, name: string, adventurerId: string, toSlot?: number) {\n        // Override this to remove items from questvars\n        const lootCache = this.getLootCache(name);\n        if (!lootCache) return;\n\n        const item = lootCache.items[itemIndex];\n        this.dispatch(addItemToInventory(adventurerId, item, toSlot))\n    }\n\n    discardItem(item: Item, adventurerId: string) {\n        const adventurer = this.getAdventurerById(adventurerId);\n        const itemIndex = adventurer?.inventory.indexOf(item);\n        if (itemIndex !== undefined) {\n            this.dispatch(removeItemFromInventory(adventurerId, itemIndex));\n        }\n    }\n\n    getSituation(_situation: string, _adventurerId?: string) : Situation | undefined {\n         return undefined;\n    }\n\n    // eslint-disable-next-line @typescript-eslint/no-empty-function\n    handleSituationOptionClick(_situation: string, _option: string, _adventurerId: string) {\n    }\n\n    /**\n     * Returns a path from two locations on the map\n     * @param origin\n     * @param target\n     */\n    findPath(origin: [number, number], target: [number, number]) {\n        return this\n            .aStar?.findPath(convertIn(origin), convertIn(target))\n            .map(convertOut);\n    }\n\n    /**\n     * Finds a path from origin to a tile next to target (closest from origin)\n     * It doesn't matter if target is unpathable\n     * @param origin\n     * @param target\n     */\n    public findPathNearest(origin: [number, number], target: [number, number], includeLast = false) {\n        // todo; shortcut, if already neighbour, return early\n        const grid = this.aStar?.getGrid().getGridNodes();\n        if (!grid) return [];\n        const matrix = grid.map(r => r.map(c => (c.getIsWalkable() ? 0 : 1)));\n        matrix[target[1]][target[0]] = 0; // make target pathable\n        const tempAStar = new AStarFinder({\n            grid: {\n                matrix\n            },\n            includeStartNode: false,\n            heuristic: \"Manhattan\",\n            weight: 0.2,\n        });\n        return tempAStar.findPath(convertIn(origin), convertIn(target))\n            .map(convertOut)\n            .slice(0, includeLast ? undefined : -1);\n    }\n\n    /**\n     * Calculates the AP costs to walk\n     */\n    calculateWalkApCosts(from: [number, number], to: [number, number]) {\n        return this.findPath(from, to)?.length || 0;\n    }\n\n    public getSceneActor(actorId: string): ActorObject {\n        return this.sceneActors.find(sA => sA.name === actorId)!;\n    }\n\n    public getObjectAtLocation(location: [number, number]) {\n        return this.quest.scene?.objects?.find(o => o.location && locationEquals(o.location, location))\n    }\n\n    protected createAStar() {\n        const matrix: number[][] = [];\n        if (this.mapData){\n            for (let y = 0; y < this.mapData.height; y++) {\n                const row: number[] = [];\n                for (let x = 0; x < this.mapData.width; x++) {\n                    const location: [number, number] = [x, y];\n                    const blocked = this.locationIsBlocked(location);\n                    row.push(blocked ? 1 : 0);\n                }\n                matrix.push(row);\n            }\n        }\n        return new AStarFinder({\n            grid: {\n                matrix\n            },\n            includeStartNode: false,\n            heuristic: \"Manhattan\",\n            weight: 0.2,\n        });\n    }\n\n    // Create SceneObject from this.mapData\n    protected createObjects(): SceneObject[] {\n        if (!this.mapData) {\n            throw new Error(\"No mapData\");\n        }\n        const objectLayers = this.mapData.layers.filter(layer => layer.type === TiledLayerType.objectgroup);\n        const objects: SceneObject[] = [];\n        const adventurers = this.getAdventurers();\n        objectLayers.forEach(objectLayer => {\n            objectLayer.objects.reduce((acc:  SceneObject[], value: TiledObjectData) => {\n\n                // reduce the props array into an object with key/values\n                const properties = parseProperties(value.properties);\n                const location: [number, number] = [\n                    value.x / (this.mapData?.tilewidth || 1),\n                    (value.y - (value.gid ? value.height : 0)) / (this.mapData?.tileheight || 1)\n                ];\n\n                let object: SceneObject | null = {\n                    ...value,\n                    layerId: objectLayer.id,\n                    properties,\n                    location\n                };\n\n                if (object.type === TiledObjectType.adventurerStart) {\n                    const adventurer = adventurers.pop();\n                    if (adventurer) {\n                        object.type = TiledObjectType.actor;\n                        if (isActorObject(object)) { // typeguard, is always true but we need to tell typescript it's an actor\n                            object.name = adventurer.id;\n                            object.allegiance = Allegiance.player;\n                            object.properties.adventurerId = adventurer.id;\n                            object.properties.isSprite = true;\n                            object.properties.spritesheet = adventurer.spritesheetPath;\n                        }\n                    } else {\n                        // Unused player spawn location, dont add\n                        object = null;\n                    }\n                } else if (object.type === TiledObjectType.enemySpawn) {\n                    object.type = TiledObjectType.actor;\n                    if (isActorObject(object)) { // typeguard, is always true but we need to tell typescript it's an actor\n                        object.allegiance = Allegiance.enemy;\n                        object.properties.isSprite = true;\n                        object.properties.spritesheet = `${spritesheetBasePath}troll-sword.json`;\n                    }\n                }\n\n                if (object) {\n                    acc.push(object);\n                }\n                return acc;\n            }, objects);\n        });\n        return objects;\n    }\n\n    // Scene\n    protected get combat() {\n        return !!this.quest.scene?.combat;\n    }\n\n    public get sceneObjects(): SceneObject[]  {\n        return this.quest.scene?.objects || [];\n    }\n\n    public get sceneActors(): ActorObject[] {\n        return this.sceneObjects.filter<ActorObject>(isActorObject);\n    }\n\n    // Quest\n    protected get quest() {\n        const storeState = this.store.getState();\n        return storeState.quests.find(q => q.name === this.questName)!;\n    }\n\n    protected get questVars(): TQuestVars {\n        return this.quest.questVars as unknown as TQuestVars;\n    }\n\n    // Provide questvars to update\n    protected updateQuestVars(updated: DeepPartial<TQuestVars>) {\n        this.dispatch(updateQuestVars(this.questName, updated));\n    }\n\n    protected getAdventurers(): AdventurerStoreState[] {\n        const storeState = this.store.getState();\n        return adventurersOnQuest(storeState.adventurers, this.quest);\n    }\n\n    protected getAdventurerByActor(actor: ActorObject) {\n        const storeState = this.store.getState();\n        return storeState.adventurers.find(a => a.id === actor.name);\n    }\n\n    protected getAdventurerById(id: string) {\n        const storeState = this.store.getState();\n        return storeState.adventurers.find(a => a.id === id);\n    }\n\n    protected questUpdate(input: string | TextEntry, icon?: string, toast = false) : void {\n        const textEntry: TextEntry = isTextEntry(input) ? input : {key: input};\n        const title = TextManager.getTextEntry(textEntry);\n        if (toast) {\n            ToastManager.addToast(title, Type.questUpdate, icon, getQuestLink(this.questName));\n        }\n        this.dispatch(addLogEntry(textEntry, LogChannel.quest, this.questName));\n    }\n\n    // Store\n    protected dispatch(action: AnyAction) {\n        this.store.dispatch(action)\n    }\n}\n\nexport interface Situation {\n    title: string;\n    choices?: string[];\n    text?: string;\n}\n\n// This is the format AStarFind works with\nconst convertIn = (l: [number, number]) => ({ x: l[0], y: l[1] });\nconst convertOut = (input: number[]): [number, number] => [input[0], input[1]];\n","import { BaseSceneController } from 'mechanics/scenes/BaseSceneController';\nimport { SceneControllerManager } from 'global/SceneControllerManager';\nimport { SceneObject, ActorObject, LootCache } from 'store/types/scene';\nimport { setActiveSceneInteractionModal } from 'store/actions/quests';\nimport { Kill10BoarsQuestVars } from '../questVars';\nimport { Item } from 'definitions/items/types';\nimport { Channel, MixMode, SoundManager } from 'global/SoundManager';\n// tslint:disable: max-classes-per-file\n\nconst TILE_CHEST_CLOSED = 33; // todo: take this from json?\nconst TILE_CHEST_OPEN = 34; // todo: take this from json?\nconst TILE_DOOR_UPPER_CLOSED = 121 + 131;\nconst TILE_DOOR_LOWER_CLOSED = 121 + 143;\nconst TILE_DOOR_UPPER_OPEN = 121 + 107;\nconst TILE_DOOR_LOWER_OPEN = 121 + 119;\n\nclass DungeonEncounterSceneController extends BaseSceneController<Kill10BoarsQuestVars>  {\n\n    // getLootCache(name: string): LootCache | undefined {\n    //     return this.questVars.dungeon.lootCaches[name];\n    // }\n\n    // takeGoldFromCache(name: string) {\n    //     super.takeGoldFromCache(name);  // first add gold to inventory\n    //     const lootCache = this.getLootCache(name);\n    //     if (lootCache){\n    //         const questVars = this.questVars;\n    //         questVars.dungeon.lootCaches[name].gold = 0;\n    //         this.store.dispatch(updateQuestVars(this.questName, questVars));\n    //     }\n    // }\n\n    // takeItemFromCache(itemIndex: number, name: string, adventurer: AdventurerStoreState, toSlot?: number) {\n    //     super.takeItemFromCache(itemIndex, name, adventurer, toSlot);\n    //     const lootCache = this.getLootCache(name);\n    //     if (lootCache){\n    //         const questVars = this.questVars;\n    //         const items = questVars.dungeon.lootCaches[name].items.filter((_: any, index: number) => index !== itemIndex);\n    //         questVars.dungeon.lootCaches[name].items = items;\n    //         this.store.dispatch(updateQuestVars(this.questName, questVars));\n    //     }\n    // }\n}\nexport class DungeonEntranceSceneController extends DungeonEncounterSceneController {\n    jsonPath = \"scenes/ork-dungeon-level1.json\";\n\n    getLootCache(_: string): LootCache | undefined {\n        return this.questVars.dungeon.entrance.chest;\n    }\n\n    takeGoldFromCache(name: \"chest\") {\n        super.takeGoldFromCache(name);  // first add gold to inventory\n        this.updateQuestVars({\n            dungeon: { entrance: { chest: { gold: 0 }}}\n        });\n    }\n\n    takeItemFromCache(itemIndex: number, name: string, adventurerId: string, toSlot?: number) {\n        super.takeItemFromCache(itemIndex, name, adventurerId, toSlot);\n        const lootCache = this.getLootCache(name);\n        if (lootCache){\n            const items = lootCache.items.filter((_:Item, index: number) => index !== itemIndex);\n            this.updateQuestVars({\n                dungeon: { entrance: { chest: { items }}}\n            });\n        }\n    }\n\n    updateScene(objects: SceneObject[] = this.sceneObjects, combat: boolean = this.combat) {\n        objects = objects.map(o => {\n            switch(o.name) {\n                case \"chest\": {\n                    return {\n                        ...o,\n                        gid: this.questVars.dungeon.entrance.chestOpen ? TILE_CHEST_OPEN : TILE_CHEST_CLOSED,\n                    }\n                }\n            }\n            return o;\n        });\n        super.updateScene(objects, combat);\n    }\n\n    interactWithObject(actor: ActorObject, object: SceneObject) {\n        switch (object.name) {\n            // todo: I want to share this common stuff with other SceneControllers\n            case \"chest\":\n                if (!this.questVars.dungeon.entrance.chestOpen) {\n                    const adventurer = this.getAdventurerByActor(actor)?.name;\n                    const textEntry = { key: \"quest-common-adventurer-opened-chest\", context: { adventurer } };\n                    this.questUpdate(textEntry, \"/img/items/misc/chest-02.png\");\n\n                    this.updateQuestVars({\n                        dungeon: { entrance: { chestOpen: true }}\n                    })\n                }\n                // display loot modal\n                this.store.dispatch(setActiveSceneInteractionModal(this.questName, {\n                    type: 'lootCache',\n                    lootCache: object.name\n                }));\n                break;\n\n            case \"altar\":\n                this.store.dispatch(setActiveSceneInteractionModal(this.questName, {\n                    type: 'situation',\n                    situation: 'altar'\n                }));\n                break;\n        }\n        super.interactWithObject(actor, object);\n    }\n\n    sceneEntered() {\n        if (!this.questVars.dungeon.entered) {\n            this.questUpdate(\"quest-kill10-boars-enter-dungeon-see-chest\");\n        }\n    }\n\n\n    getSituation(situation: string, adventurerId?: string) {\n        switch (situation) {\n            // case 'altar':\n            //     const questVars = this.questVars;\n            //     if (questVars.dungeon.situations.altar.candleLit) {\n            //         return {\n            //             title: 'quest-kill10-boars-dungeonentrance-altar',\n            //             choices: [\n            //                 \"quest-kill10-boars-dungeonentrance-altar-rummagedrawers\"\n            //             ]\n            //         }f\n            //     }\n            //     return {\n            //         title: 'quest-kill10-boars-dungeonentrance-altar',\n            //         choices: [\n            //             \"quest-kill10-boars-dungeonentrance-altar-lightcandle\",\n            //             \"quest-kill10-boars-dungeonentrance-altar-rummagedrawers\"\n            //         ]\n            //     }\n                default:\n                    return super.getSituation(situation, adventurerId);\n        }\n    }\n\n    handleSituationOptionClick(_situation: string, _option: string, _adventurerId: string) {\n        // switch (situation) {\n            // case 'altar': {\n            //     switch (option) {\n            //         case 'quest-kill10-boars-dungeonentrance-altar-lightcandle':\n            //             const questVars = this.questVars;\n            //             questVars.dungeon.situations.altar.candleLit = true;\n            //             this.store.dispatch(updateQuestVars(this.questName, questVars));\n            //             break;\n\n            //         case 'quest-kill10-boars-dungeonentrance-altar-rummagedrawers':\n            //             // display loot modal!\n            //             this.store.dispatch(setActiveSceneInteractionModal(this.questName, {\n            //                 type: 'lootCache',\n            //                 lootCache: 'altar'\n            //             }));\n            //             break;\n            //     }\n            // }\n        // }\n    }\n}\n\nexport class DungeonHallwaySceneController extends DungeonEncounterSceneController {\n    jsonPath = \"scenes/ork-dungeon-level2.json\";\n\n    getLootCache(_: string): LootCache | undefined {\n        return this.questVars.dungeon.hallway.chest;\n    }\n\n    sceneEntered() {\n        // console.log(\"ENTERED THE HALLWAy\")\n    }\n\n    interactWithObject(actor: ActorObject, object: SceneObject) {\n        switch (object.name) {\n            // todo: I want to share this common stuff with other SceneControllers\n            case \"chest\":\n                if (!this.questVars.dungeon.hallway.chestOpen) {\n                    const adventurer = this.getAdventurerByActor(actor)?.name;\n                    const textEntry = { key: \"quest-common-adventurer-opened-chest\", context: { adventurer } };\n                    this.questUpdate(textEntry, \"/img/items/misc/chest-02.png\");\n\n                    this.updateQuestVars({\n                        dungeon: { hallway: { chestOpen: true }}\n                    })\n                }\n                // display loot modal\n                this.store.dispatch(setActiveSceneInteractionModal(this.questName, {\n                    type: 'lootCache',\n                    lootCache: object.name\n                }));\n                break;\n            case \"door1\":\n                if (!this.questVars.dungeon.hallway.doorOpen) {\n                    this.store.dispatch(setActiveSceneInteractionModal(this.questName, {\n                        type: 'situation',\n                        situation: 'door'\n                    }));\n                }\n                break;\n            case \"latrine\":\n                this.questUpdate(\"quest-kill10-boars-dungeonentrance-latrine\");\n                break;\n        }\n        super.interactWithObject(actor, object);\n    }\n\n    getSituation(situation: string, adventurerId?: string) {\n        switch (situation) {\n            case 'door': {\n                const adventurer = this.getAdventurerById(adventurerId!);\n                if (adventurer && adventurer.inventory.some(i => i === Item.key)) {\n                    // Adventurer has key\n                    return {\n                        title: 'quest-kill10-boars-dungeonentrance-door',\n                        choices: [\n                            \"quest-common-scenerio-door-open\"\n                        ]\n                    }\n                }\n                return {\n                    title: 'quest-kill10-boars-dungeonentrance-door',\n                    text: 'quest-kill10-boars-dungeonentrance-door-needs-key',\n                }\n            }\n            default:\n                return super.getSituation(situation, adventurerId);\n        }\n    }\n    \n\n    handleSituationOptionClick(situation: string, option: string, adventurerId: string) {\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n        // @ts-ignore\n        switch (situation) {\n            case 'door': {\n                // Only one option, to open\n                this.updateQuestVars({\n                    dungeon: { hallway: { doorOpen: true }}\n                });\n\n                SoundManager.playSound(\"scene/doorOpen\", Channel.scene, false, MixMode.singleInstance);\n\n                this.discardItem(Item.key, adventurerId);\n                const adventurer = this.getAdventurerById(adventurerId)?.name;\n                const textEntry = { key: \"quest-common-adventurer-opened-door\", context: { adventurer } };\n                this.questUpdate(textEntry, \"/img/items/misc/chest-02.png\");\n\n                this.dispatch(setActiveSceneInteractionModal(this.questName));\n            }\n        }\n    }\n\n    // Todo: figure out an easier way to do this\n    takeItemFromCache(itemIndex: number, name: string, adventurerId: string, toSlot?: number) {\n        super.takeItemFromCache(itemIndex, name, adventurerId, toSlot);\n        const lootCache = this.getLootCache(name);\n        if (lootCache){\n            const items = lootCache.items.filter((_: any, index: number) => index !== itemIndex);\n            this.updateQuestVars({\n                dungeon: { hallway: { chest: { items }}}\n            });\n        }\n    }\n\n    updateScene(objects: SceneObject[] = this.sceneObjects, combat: boolean = this.combat) {\n        objects = objects.map(o => {\n            switch(o.name) {\n                case \"chest\": {\n                    return {\n                        ...o,\n                        gid: this.questVars.dungeon.hallway.chestOpen ? TILE_CHEST_OPEN : TILE_CHEST_CLOSED,\n                    }\n                }\n                case \"door1\": {\n                    if ( this.questVars.dungeon.hallway.doorOpen) {\n                        const properties = { ...o.properties, blocksMovement: false, interactive: false };\n                        if (o.properties.part === 'upper') {\n                            return { ...o, gid: TILE_DOOR_UPPER_OPEN, properties};\n                        } else {\n                            return { ...o, gid: TILE_DOOR_LOWER_OPEN, properties};\n                        }\n                    } else {\n                        if (o.properties.part === 'upper') {\n                            return { ...o, gid: TILE_DOOR_UPPER_CLOSED };\n                        } else {\n                            return { ...o, gid: TILE_DOOR_LOWER_CLOSED };\n                        }\n                    }\n                }\n            }\n            return o;\n        });\n        super.updateScene(objects, combat);\n    }\n}\n\nSceneControllerManager.registerSceneController(\"kill10Boars\", \"dungeon.entrance\", DungeonEntranceSceneController as any);\nSceneControllerManager.registerSceneController(\"kill10Boars\", \"dungeon.hallway\", DungeonHallwaySceneController as any);\n"],"sourceRoot":""}