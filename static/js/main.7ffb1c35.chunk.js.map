{"version":3,"sources":["definitions/items/types.ts","global/TextManager.ts","utils/format/time.ts","definitions/structures/index.ts","definitions/structures/alchemist.ts","definitions/structures/armoursmith.ts","definitions/structures/garden.ts","definitions/structures/lumberMill.ts","definitions/structures/mine.ts","definitions/structures/quarry.ts","definitions/structures/tannery.ts","definitions/structures/tavern.ts","definitions/structures/warehouse.ts","definitions/structures/weaponsmith.ts","definitions/structures/weaver.ts","definitions/structures/workshop.ts","components/ui/adventurer/EquipmentSlot/index.tsx","definitions/quests/types.ts","components/ui/common/Icon/index.tsx","definitions/resources.ts","constants/items.ts","store/actions/quests.ts","global/SoundManager.ts","definitions/items/weapons.ts","utils/routing.ts","definitions/structures/types.ts","constants/dragging.ts","store/actions/adventurers.ts","store/types/scene.ts","global/ToastManager.tsx","components/ui/toasts/Toast.tsx","definitions/items/deeds.ts","definitions/items/materials.ts","definitions/items/questItems.ts","definitions/items/trinkets.ts","definitions/items/index.ts","store/types/logEntry.ts","definitions/quests/kill10Boars/index.ts","definitions/quests/index.ts","definitions/quests/retrieveMagicAmulet/index.ts","store/actions/log.ts","store/helpers/storeHelpers.ts","utils/tilemap.ts","utils/math.ts","utils/pixiJs.ts","store/actions/gold.ts","global/SceneControllerManager.ts","definitions/items/apparel.ts","global/EventEmitter.ts","definitions/quests/kill10Boars/questVars.ts","constants/tiledMapData.ts","store/actions/combat.ts","store/types/combat.ts","store/actions/game.ts","mechanics/gameTick/combat.ts","components/preloading/Preloader.tsx","constants/version.tsx","utils/version.ts","components/preloading/Indicator.tsx","store/types/structure.ts","components/ui/buttons/Button/index.tsx","utils/hitAreaShapes.ts","components/town/structures/LumberMill/index.tsx","components/pixi/ParticleEmitter.ts","components/town/structures/Tavern/index.tsx","hoc/withAppContext.tsx","components/town/structures/Generic/index.tsx","components/town/Legenda/index.tsx","components/pixi/Viewport.tsx","components/App/styles/img/cursors/dwarven_gauntlet_extra_6.png","components/town/TownStage.tsx","components/town/Clouds.tsx","components/town/TownView.tsx","components/ui/toasts/Toasts.tsx","store/actions/resources.ts","store/actions/structures.ts","components/ui/window/Window.tsx","hoc/withWindow.tsx","components/ui/window/windows/SettingsWindow.tsx","constants/resources.ts","store/actions/items.ts","store/actions/index.ts","mechanics/time.ts","constants/context.ts","components/ui/window/windows/CheatWindow.tsx","components/ui/window/windows/MenuWindow.tsx","utils/format/number.ts","global/TooltipManager.ts","hooks/store/useGoldState.ts","store/selectors/resources.ts","hooks/store/resources.ts","store/selectors/workers.ts","hooks/store/useWorkersState.ts","components/ui/topbar/Resourcebar.tsx","components/ui/topbar/Topbar.tsx","components/world/WorldMap/QuestMarker.tsx","store/types/quest.ts","components/world/WorldMap/QuestLine.tsx","store/selectors/quests.ts","hooks/store/useQuest.ts","components/world/WorldMap/index.tsx","components/world/QuestPanel/QuestDetails/scene/SceneActor.tsx","components/ui/tabs/Tabstrip.tsx","components/ui/tabs/Tab.tsx","components/ui/adventurer/AdventurerAvatar/index.tsx","components/world/QuestPanel/AdventurerTabstrip.tsx","store/selectors/adventurers.ts","components/pixi/tile/RectTileLayer.tsx","components/world/QuestPanel/QuestDetails/scene/Tilemap.tsx","components/pixi/util/BridgedStage.tsx","components/world/QuestPanel/QuestDetails/scene/SpriteAnimated.tsx","components/world/QuestPanel/QuestDetails/scene/ActionPath.tsx","hooks/store/adventurers.ts","components/world/QuestPanel/QuestDetails/scene/ActionPoints.tsx","components/world/QuestPanel/QuestDetails/scene/SceneAdventurer.tsx","hooks/useTilesetsLoader.ts","components/world/QuestPanel/QuestDetails/scene/SceneObjectWrapper.tsx","components/world/QuestPanel/QuestDetails/scene/renderObject.tsx","components/ui/loading/LoadingSpinner.tsx","components/world/QuestPanel/context/SceneControllerContext.tsx","components/world/QuestPanel/QuestDetails/scene/ui/CombatUIWidget/Segment.tsx","components/world/QuestPanel/QuestDetails/scene/ui/CombatUIWidget/index.tsx","components/world/QuestPanel/QuestDetails/scene/ui/NormalUICursor.tsx","components/world/QuestPanel/QuestDetails/scene/ui/SceneUI.tsx","components/pixi/DashedLine.ts","components/world/QuestPanel/QuestDetails/scene/ActionPreview.tsx","components/world/QuestPanel/QuestDetails/scene/Scene.tsx","components/world/QuestPanel/QuestDetails/OnTheRoad.tsx","components/world/QuestPanel/QuestDetails/index.tsx","components/ui/items/ItemIcon/index.tsx","components/ui/items/DraggableItemIcon.tsx","components/ui/items/DraggableItemsList/index.tsx","components/world/QuestPanel/modals/LootCache/index.tsx","components/world/QuestPanel/modals/Situation/index.tsx","components/world/QuestPanel/CombatBar/index.tsx","components/ui/inventory/InventorySlot.tsx","components/ui/inventory/Inventory.tsx","hooks/store/useStockpileState.ts","hooks/actions/useItemActions.ts","components/ui/adventurer/AdventurerPanel/AdventurerSkills/index.tsx","mechanics/adventurers/levels.ts","hooks/store/engine.ts","components/ui/common/Progressbar/index.tsx","components/ui/adventurer/AdventurerPanel/Level.tsx","definitions/traits/types.ts","components/ui/adventurer/AdventurerPanel/ApIndicator.tsx","definitions/traits/index.ts","components/ui/adventurer/AdventurerPanel/AdventurerTraits/index.tsx","components/world/QuestPanel/index.tsx","components/ui/adventurer/AdventurerPanel/AdventurerEquipment/Guy/index.tsx","components/ui/adventurer/AdventurerPanel/AdventurerEquipment/index.tsx","components/ui/adventurer/AdventurerPanel/index.tsx","components/log/SimpleLog.tsx","components/world/WorldView.tsx","store/actions/tasks.ts","store/types/task.ts","hooks/store/useStructureState.ts","components/ui/tooltip/ContextTooltip/context/ItemContext/DeedContent.tsx","definitions/production/weaponsmith.ts","definitions/production/armoursmith.ts","components/ui/tooltip/Tooltip/index.tsx","definitions/production/workshop.ts","definitions/production/alchemist.ts","definitions/production/index.ts","store/selectors/tasks.ts","hooks/store/useTasksState.ts","mechanics/studying.ts","components/ui/tooltip/ContextTooltip/context/ItemContext/ProduceOrStudy.tsx","components/ui/tooltip/ContextTooltip/context/ItemContext/WeaponContent.tsx","components/ui/tooltip/ContextTooltip/context/ItemContext/ApparelContent.tsx","components/ui/tooltip/ContextTooltip/context/ItemContext/index.tsx","components/ui/tooltip/ContextTooltip/context/ResourceContext/index.tsx","components/ui/modals/InfoWindow/index.tsx","components/ui/tooltip/ContextTooltip/context/TraitContext/index.tsx","components/ui/tooltip/ContextTooltip/index.tsx","components/Background/index.tsx","components/App/manifest/app.ts","components/structures/StructureViewHeader.tsx","components/structures/StructureLevel.tsx","components/structures/production/UpgradeHelpModal.tsx","components/ui/common/UpDownValue/index.tsx","components/ui/items/ItemsBox.tsx","components/structures/production/ResourcesCost.tsx","mechanics/crafting.ts","components/structures/production/CraftingDetails.tsx","components/structures/production/CraftingArea.tsx","components/structures/production/ProductionStructureView.tsx","components/structures/warehouse/ResourcesBox.tsx","hooks/usePrevious.ts","store/types/resources.ts","components/structures/warehouse/UpgradeHelpModal.tsx","components/structures/warehouse/WarehouseStructureView.tsx","components/ui/adventurer/DroppableAdventurerSlot/index.tsx","components/structures/tavern/AssignAdventurers.tsx","components/structures/tavern/QuestBoard.tsx","components/structures/tavern/rooms/AdventurerButton.tsx","components/ui/adventurer/DraggableAdventurerAvatar/index.tsx","components/App/index.tsx","components/structures/tavern/rooms/RoomWithAdventurer.tsx","components/structures/tavern/rooms/RoomEmpty.tsx","components/structures/tavern/rooms/RoomList.tsx","components/structures/tavern/UpgradeHelpModal.tsx","components/structures/tavern/TavernStructureView.tsx","components/structures/resource/UpgradeHelpModal.tsx","components/structures/resource/ResourceGenerationRow.tsx","components/structures/resource/ResourceStructureView.tsx","components/town/StructureDetailsView/index.tsx","utils/random.ts","mechanics/gameTick/producedResources.ts","mechanics/gameTick/quests.ts","mechanics/gameTick/rngState.ts","registerServiceWorker.ts","store/reducers/adventurers.ts","index.tsx","store/types/engine.ts","store/reducers/items.ts","store/reducers/log.ts","store/reducers/quests.ts","store/types/structures.ts","store/reducers/structures.ts","store/types/tasks.ts","store/reducers/tasks.ts","store/reducers/index.ts","store/reducers/combat.ts","store/reducers/engine.ts","store/reducers/gold.ts","store/reducers/resources.ts","store/reducers/rngState.ts","store/reducers/workers.ts","utils/configureStore.ts","mechanics/gameTick/tasks.ts","constants/text.ts","mechanics/scenes/BaseSceneController.ts","mechanics/scenes/actionPoints.ts","definitions/quests/kill10Boars/encounters/dungeon.ts"],"names":["ItemType","Item","TextManager","texts","precompile","this","templates","compileAll","initialized","key","context","result","getDefault","console","error","Error","template","getTemplate","textEntry","get","compile","slotType","toKebab","EquipmentSlotType","name","type","item","itemType","getDefinition","structure","trait","Type","WeaponType","weaponClass","WeaponClassification","Object","keys","forEach","value","Handlebars","article","itemDefinitions","itemArticleAuto","itemArticleDefined","resource","itemArticleUndefined","getItemName","articleTemplate","noun","FIVE_SECONDS","ONE_MINUTE","TWO_MINUTES","THREE_MINUTES","FOUR_MINUTES","HALF_HOUR","ONE_HOUR","ONE_DAY","ONE_YEAR","formatDuration","ms","short","timeUnitsList","unit","amount","time","Math","abs","output","el","tmp","floor","push","join","Structure","alchemist","StructureType","production","cost","gold","levels","displayName","workerCapacity","unlocks","armoursmith","boots1","chest","cowl","garden","generates","food","lumberMill","wood","mine","iron","quarry","stone","tannery","leather","tavern","rooms","warehouse","maxResources","fabric","maxStockpile","weaponsmith","poisonedDagger","weaver","workshop","all","getStructureByResource","Resource","dropTarget","drop","props","monitor","onDrop","getItem","canDrop","itemAndEquipmentSlotMatch","equipmentSlotType","feet","hands","head","legs","checkEquipment","mainHand","offHand","itemDefinition","weapon","typeClassifications","weaponType","oneHanded","shield","DropTarget","DragType","ITEM","connect","connectDropTarget","isOver","borderColor","className","style","title","children","equipmentType","apparel","QuestNodeType","IconSize","Border","Icon","image","size","border","restProps","sizeClassName","backgroundImage","process","borderClassName","smallest","small","medium","big","biggest","none","iconImg","Rarity","ActionType","launchQuest","questName","assignedAventurers","exitEncounter","quest","updateQuestVars","vars","setSceneName","sceneName","setScene","scene","enqueueSceneAction","sceneAction","completeSceneAction","setCombat","combat","updateSceneObject","id","object","updateSceneObjectAction","setActiveSceneInteractionModal","sceneInteractionModal","MusicTrack","Sound","media","musicTracks","currentMusicTrack","sounds","STORAGE_KEY_MUSIC_VOLUME","STORAGE_KEY_SOUND_VOLUME","SoundManager","localforage","_musicVolume","_soundVolume","_initialized","m","soundList","entries","find","url","content","sound","howl","volume","soundVolume","play","track","init","hasOwnProperty","fade","musicVolume","nextMusic","playing","loop","setItem","basePath","DamageType","axe","bow","club","crossbow","fist","flail","hammer","knife","staff","twoHanded","sword","poleArm","weaponDefinitions","aegisOfValor","rarity","legendary","arbalest","epic","damage","kinetic","battleAxe","common","berserkerShield","brassKnuckles","buckler","cleaver","dagger","uncommon","goldenShield","rare","greatswordOfGwai","unique","indomitableCarapace","javelin","khopesh","longbow","mace","morningStar","paintedBuckler","ravenStaff","savageStaff","simpleCrossbow","spear","steelShield","warhammer","woodenBulwark","getWorldLink","getQuestLink","getTownLink","getStructureLink","DragSourceType","ADVENTURER","moveItemInInventory","adventurerId","fromSlot","toSlot","addItemToInventory","removeItemFromInventory","assignEquipment","equipmentSlot","removeEquipment","renameAdventurer","SceneActionType","ToastManager","icon","link","stack","Date","now","emit","EVENT_TOASTS_UPDATED","playSound","toast","setTimeout","filter","lifeTime","EventEmitter","Toast","achievementUnlocked","history","useHistory","typeText","getToastType","onClick","deed","deedForLumbermill","deedForWeaponsmith","material","arrowheads","bolts","buckle","chain","cogs","gem","ingot","nails","poisonVial","ribbon","rope","gunpowder","scales","spring","thread","questItem","questItemDefinitions","blueprints","crate","dynamite","dragonEye","eye","feather","heart","horn","letters","lockPicks","oil","orcFinger","plans","purpleGems","runestone","sandwich","teeth","tooth","torch","tusk","vase","vial","weeds","trinket","trinketDefinitions","magicAmulet","ring","deeds","materials","questItems","trinkets","weapons","LogChannel","kill10Boars","getQuestVars","questStore","questVars","getInitialQuestVars","initialQuestVars","nodes","x","y","nothing","log","encounter","startScene","retrieveMagicAmulet","baz","zux","requiredItems","addLogText","channel","channelContext","entry","addLogEntry","adventurersOnQuest","adventurers","party","map","findAdventurerById","getQuestLeader","leaderId","a","adventurerFreeInventorySlots","adventurer","inventory","i","length","storeIsRehydrated","store","undefined","engine","gameStarted","TiledObjectType","getExtendedTilemapObjects","tilemapData","objectLayers","layers","layer","TiledLayerType","objectgroup","objects","objectLayer","reduce","acc","gid","height","location","tilewidth","tileheight","ezProps","parseProperties","properties","extended","addAllTilesInLayerToList","list","columns","data","tile","index","locationEquals","b","lerp","n1","n2","alpha","lerpLocation","point1","point2","loadResourceAsync","path","loader","PIXI","Loader","shared","Promise","resolve","reject","resources","add","load","_","loadResource","callback","addGold","subtractGold","SceneControllerManager","controllerType","controllerTypes","require","boots2","damageReduction","boots3","chainmailHood","clothGloves","druidChest","druidHands","druidFeet","druidHead","druidLegs","fedora","greaves1","greaves2","hornedHelmet","leatherGloves","nomadHelmet","pants1","pants2","plateChest1","plateChest2","plateChest3","plateChest4","plateGloves1","plateGloves2","plateHelmet","platePants","plateShoulders1","shoulders","plateShoulders2","robe","shoulders1","shoulders2","shoulders3","vest","eventEmitter","eventName","listener","events","splice","event","fn","dungeon","entered","lootCaches","items","altar","situations","candleLit","Orientation","RenderOrder","Allegiance","CombatActionType","barBrawl","actors","allegiance","player","health","remainingAP","turn","updateCombat","delta","getState","action","endsAt","enemy","move","dispatch","actor","moveActor","target","clearCombatAction","MediaType","version","asInt","semVer","parts","split","part","Number","numericVersion","convertSemVerToInt","Indicator","itemsLoaded","itemsTotal","StructureState","loadImage","Image","src","check","naturalWidth","removeEventListener","complete","addEventListener","getType","toLowerCase","endsWith","Preloader","useState","completed","setCompleted","setItemsLoaded","useEffect","loadMedia","manifest","promises","loadItem","catch","err","then","results","onLoadComplete","some","warn","mediaType","Howl","ButtonSize","ButtonColor","initialState","level","state","NotBuilt","workers","HitAreaShapes","shapes","sprite","definition","shape","contains","LumberMill","hitAreaShapes","atlas","textures","setTextures","filters","selected","STRUCTURE_HIGHLIGHT_FILTER","app","useApp","rotation","setRotation","useTick","r","position","interactive","buttonMode","pointertap","onStructureClick","hitArea","texture","anchor","ParticleEmitter","PixiComponent","create","applyProps","instance","oldProps","newProps","config","newP","applyDefaultProps","emitter","_emitter","particles","from","elapsed","performance","tick","raf","requestAnimationFrame","update","willUnmount","cancelAnimationFrame","Tavern","smoke","withAppContext","WrappedComponent","AppContext","Consumer","Component","Generic","Legenda","structures","orderedStructures","match","useRouteMatch","renderText","params","toString","getStructureName","to","Viewport","forwardRef","ref","cursor","renderer","plugins","interaction","cursorStyles","pointer","PixiComponentViewport","viewport","PixiViewport","screenWidth","screenHeight","worldWidth","worldHeight","ticker","on","minScale","maxScale","drag","pinch","wheel","clamp","direction","clampZoom","decelerate","TownStage","innerRef","useRef","useImperativeHandle","current","godray","enabled","horizontalFactor","gsap","utils","normalize","right","verticalFactor","bottom","factor","max","gain","lacunarity","onScroll","e","preventDefault","window","passive","width","options","autoDensity","sharedLoader","GodrayFilter","Clouds","speed","randomCloud","cloud","setCloud","setX","randomY","setY","random","OutlineFilter","selectedStructure","viewportRef","dragging","addMusicTrack","town","playMusicTrack","tween","duration","thickness","yoyo","repeat","pause","kill","stopPropagation","handleStructureClick","useSelector","zoomPercent","getStructurePosition","moveCenter","MAX_WIDTH","canvasWidth","setCanvasWidth","canvasHeight","setCanvasHeight","resize","worldViewWidth","clientWidth","worldViewHeight","clientHeight","reverse","StructureComponent","getStructure","polygons","Point","Toasts","activeToasts","setActiveToasts","toastsUpdated","toastConfig","Button","color","square","text","otherProps","blue","auto","replace","Window","backEnabled","onBack","buttonClick","closeEnabled","onClose","withWindow","React","compose","soundSlider","musicSlider","open","onComplete","role","aria-label","min","step","onChange","linear","parseFloat","pow","defaultValue","sqrt","RESOURCE_INTERVAL","resourceOrder","addResources","finishBuildingStructure","upgradeStructure","increaseWorkers","addItemToToProduces","TimeType","addItemToWarehouse","addItem","removeItemFromWarehouse","removeItem","addStockpileSlots","slots","ContextType","cheatTimeMultiplier","getTimeMultiplier","cheat","itemSelectRef","cheats","setCheats","useDispatch","timeMultiplier","setTimeMultiplier","onCheatStructureState","setStructureState","onCheatWorkers","addWorkers","getItemTypeOptions","getItemOption","val","isNaN","label","handleChangeStructureState","checked","Built","addToast","evt","onCheatGold","onCheatResources","onCheatItem","setCheatTimeMultiplier","structureDef","getStructureDefinition","structureStore","levelDef","getStructureRow","storeState","loadedStore","setLoadedStore","handleClickLoad","loadGame","game","onCloseWindow","onOpenWindow","encryptor","createEncryptor","document","createElement","JSON","stringify","encrypted","encrypt","setAttribute","encodeURIComponent","click","fileReader","FileReader","onload","decrypt","obj","parse","readAsText","files","disabled","formatNumber","input","digits","SI_SYMBOL","tier","log10","toFixed","suffix","scale","scaled","TooltipManager","info","originRect","referenceRect","deepEquals","lastContext","clear","EVENT_CONTEXT_UPDATED","useGoldState","selectMaxResources","createSelector","useResourcesState","selectFreeWorkers","useWorkersFreeState","Resourcebar","goldState","storeResources","workersFree","createItem","currentTarget","getBoundingClientRect","showContextTooltip","resourceDescription","resourceDescriptions","Topbar","useContext","persistor","QuestStatus","QuestMarker","leader","encounterActive","avatar","maskGraphics","beginFill","drawCircle","CIRCLE_DIAMETER","endFill","mask","addChild","pointerdown","avatarImg","QuestLine","positions","draw","graphics","lineStyle","moveTo","xc","yc","quadraticCurveTo","selectActiveQuests","quests","q","status","active","useQuest","questSelector","useCallback","WorldMap","retrieveWorldViewRef","smallMap","selectedQuestName","selectedQuest","activeQuests","handlePartyClick","onPartyClick","WIDTH","worldView","SMALL_HEIGHT","focusOnQuestingParty","point","nodeLocationToPoint","partyLocation","getQuestWorldLocation","previousPositions","getPreviousPositions","currentPosition","questDefinition","progress","questNode","getQuestTitle","roundedProgress","lastNode","nextNode","WORLD_WIDTH","WORLD_HEIGHT","lastPosition","DebugToggleCombat","Tabstrip","activeTab","Children","child","cloneElement","handleTabClick","tabId","onTabSelected","Tab","AdventurerAvatar","AdventurerTabstrip","onAdventurerTabSelected","selectedAdventurerId","getAdventurers","getQuests","createSelectAdventurersOnQuest","foundInParty","groupedAdventurers","values","foundAdventurers","indexOf","RectTileLayer","CompositeRectTileLayer","tilesets","horizontalTiles","spritesheets","tileset","findTileset","w","h","spritesheet","spriteId","addFrame","firstgid","Tilemap","l","visible","tilelayer","createTileLayer","BridgedStage","SpriteAnimated","gotoAndPlay","SceneActor","controller","idleAnimation","rest","getTileDimensions","tileWidth","tileHeight","actorRef","previousAction","actionQueueSelector","actionQueue","actorId","animation","setAnimation","spritesheetPath","useMemo","getActorSpritesheetPath","determineOrientation","nextAction","setOrientation","north","northEast","east","southEast","south","southWest","west","northWest","actionType","moveComplete","actorMoved","killTweensOf","ease","pixi","slash","frames","setFrames","indexed","frame","orientation","flipped","interval","setInterval","left","clearInterval","getFrames","animationSpeed","isPlaying","pivot","createColorReplaceFilter","BLUES","PURPLE","memo","replacements","MultiColorReplaceFilter","ActionPath","graphicsRef","drawAction","allowed","grfx","lineTo","parent","useAdventurersInTown","getAdventurersInTown","useAdventurerState","adventurerSelector","ActionPoints","textRef","drawAp","ap","fontFamily","fontSize","fill","align","SceneAdventurer","actionPathRef","actionPointsRef","actorCanInteract","actorInteract","useTilesetsLoader","tileSpritesheets","setTilesets","setData","nextTileset","nextTilesetToload","tilesetName","spritesheetData","parseSpritesheetData","Spritesheet","newTilesets","loadComplete","loadTilesets","tilesetsTextures","t","tilecount","spriteSourceSize","rotated","trimmed","sourceSize","meta","imagewidth","imageheight","SceneObjectWrapper","mapData","renderObject","LoadingSpinner","Array","SceneControllerContext","createContext","SceneControllerContextProvider","useStore","loaded","setLoaded","getSceneController","loadData","createScene","sceneEntered","dataLoaded","Provider","Segment","onActivate","onDeactivate","rot","transform","background","onMouseOver","onMouseOut","segmentWidth","alt","CombatUIWidget","actionIntent","onActionChange","collapsed","setCollapsed","handleSegmentActivate","handleSegmentDeactivate","_action","onMouseMove","getText","insufficient","actorAP","apCost","NormalUICursor","blocked","locationIsBlocked","SceneUI","selectedActorId","sceneWidth","sceneHeight","onMouseDown","onSetActionIntent","mouseDown","cursorLocation","setCursorLocation","handleResize","canvas","parentNode","querySelector","currentWidth","handleCombatActionChange","getActorByAdventurerId","findPath","calculateWalkApCosts","findLocation","Element","rect","clientX","clientY","top","pointToSceneLocation","locationIsOutOfBounds","onMouseUp","selectedActorLocation","actorAttemptAction","DashedLine","points","dash","gap","_destroy","alignment","native","offsetPercentage","dashLeft","gapLeft","progressOffset","rotatedpoints","p","clone","cosAngle","cos","sinAngle","sin","dx","dy","p1","p2","len","normal","progressOnLine","_raf","ActionPreview","convert","converted","valid","Scene","currentActionIntent","setCurrentActionIntent","renderActors","o","setSelectedAdventurer","setSelectedActor","renderActor","Rectangle","OnTheRoad","QuestDetails","ItemIcon","getIconClassName","showContext","DragSource","beginDrag","inventorySlot","sourceId","sourceType","connectDragSource","dragSource","isDragging","DraggableItemsList","getItemSubtext","LootCache","freeSlots","cache","getLootCache","cacheName","lootCache","querySelectorAll","classList","stagger","each","takeItemFromCache","takeGoldFromCache","Situation","situation","getSituation","choices","handleChoiceClick","choice","getAttribute","handleSituationOptionClick","data-option","CombatBar","dragInfo","adventurerEquipment","classNames","Inventory","contents","slot","iconSize","onDropItem","useStockpileState","stockpile","useItemDropActions","sceneController","dropItemEquipment","actions","adventurerInventory","existingEquipment","equipment","dropItemInventory","otherItem","dropItemWarehouse","moveItemInWarehouse","AdventurerSkills","skills","s","skill","handleClick","getSkillName","renderSkill","levelToXp","Direction","useEngine","Progressbar","previousProgress","previousTick","useDelta","animate","setAnimate","increasing","decreasing","transition","Trait","Level","xp","currentLevel","xpToLevel","currentLevelXp","nextLevelXp","next","ApIndicator","arrowFinder","hasEffect","gloomy","houseHouston","houseMaddox","houseMonroe","Layout","AdventurerTraits","renderTrait","last","traitDefinition","getTraitName","traits","Guy","findDR","useAdventurerDamageReduction","renderDamageReduction","dR","AdventurerEquipment","onDropItemEquipment","getEquipmentSlot","EquipmentSlot","AdventurerPanel","horizontalMode","levelBar","ChannelType","QuestPanel","layout","setSelectedAdventurerID","activeInteractionModal","handleAdventurerSelected","handleCloseLootCacheModal","WorldView","worldMapRef","questname","world","TaskType","SimpleLog","expanded","setExpanded","selectedTabId","setSelectedTabId","logEntries","channels","tabType","displayEntries","currentTab","lE","tab","logEntry","getLogEntryRow","startTask","taskType","origin","callbacks","start","useStructureState","structureSelector","DeedContent","structureDefinition","enoughGold","subtext","handleStartConstruction","startBuildingStructure","buildStructure","weaponsmithProduction","levelRequired","Placement","armoursmithProduction","workshopProduction","alchemistProduction","getTasks","tasks","useCraftingTasksStateByStructure","running","createSelectCraftingTasksByStructure","useStudyingTasksStateByStructure","createSelectStudyingTasksByStructure","useUpgradeTasksStateByStructure","createSelectUpgradeTasksByStructure","STUDY_TIME","ProducedAtStructure","studyTasks","produces","task","sT","timeRemaining","productionDefinition","getProductionDefinition","studyTime","studyItem","ProduceOrStudy","getItemDefinition","WeaponContent","getWeaponType","classification","getWeaponClassification","ApparelContent","ItemContext","ResourceContext","resourcesState","workersState","workersFreeState","structureStates","full","structureState","renderProducedBy","free","total","InfoWindow","Tooltip","placement","setPlacement","containerRect","setContainerRect","tooltipElement","tooltipRect","opacity","contentElement","offset","closest","TraitContext","getTraitDescription","getTraitEffect","ContextTooltip","selectedContext","setSelectedContext","tooltipUpdated","getResourceName","getItemNameClassName","getSkillInfo","component","renderContent","Background","fragmentSrc","uniforms","timestamp","resolution","innerWidth","innerHeight","shift","StructureViewHeader","StructureLevel","onHelpClicked","addUpgradeCallbacks","nextLevel","nextLevelCost","canUpgrade","upgradeText","upgradeTasks","startTime","handleUpgrade","UpgradeHelpModal","renderRow","UpDownValue","displayValue","upDisabled","onUp","downDisabled","onDown","ItemsBox","aggregate","accumulator","itemsInInventory","tmpWarehouse","tmpItems","found","findIndex","removed","listItems","listItemClass","itemDescription","itemsDescription","ResourcesCost","sufficientResources","calculateProductionTime","CraftingDetails","stockpileState","workersAssigned","setWorkersAssigned","costResources","missingAtLeastOneResource","missingAtLeastOneItem","costMaterials","handleCraft","craftingTime","removeResources","craftItem","asNumber","makeTimeString","CraftingArea","selectedItem","setSelectedItem","handleSelectCraftingItem","ProductionStructureView","craftingTasks","studyingTasks","deltaResources","usePrevious","empty","res","WAREHOUSE","WarehouseStructureView","adventurersInTown","selectedAdventurer","resourcesDelta","setResourcesDelta","previousResources","resourcesRef","structuresState","remove","levelDefinition","currentLevelDefinition","AssignAdventurers","onAdventurerClicked","onAdventurerDropped","availableSlots","slotsContent","QuestBoard","checkEnoughItems","every","amountRequired","availableQuests","onQuestClick","fullParty","enoughItems","canLaunch","getQuestDescription","onRemoveAdventurer","onLaunchQuest","getQuestDetails","AdventurerButton","onAddAdventurer","isAssigned","Boolean","emptySlot","getEmptySlot","spec","View","RoomWithAdventurer","onQuest","assigned","SOURCE_ID","prompt","RoomEmpty","RoomList","roomCount","handleAdventurerNameClick","roomContent","room","TavernStructureView","setAassignedAdventurers","setSelectedQuest","getAvailableQuests","available","handleAddAdventurer","copy","handleRemoveAdventurer","handleQuestClick","questTitle","questLaunched","ResourceGenerationRow","lastProducedUpdate","ResourceStructureView","decreaseWorkers","buildTask","Building","PixiPlugin","registerPIXI","registerPlugin","generator","App","containerRef","setMedia","activeWindows","setActiveWindows","handleViewButtonClick","selectStructure","handleWindowOpened","handleWindowClose","handleWindowBack","slice","handleScroll","debounce","maxWidth","DndProvider","backend","HTML5Backend","mediaItems","addSounds","margin","exact","restartGame","purple","render","topWindow","commonWindowProps","renderWindow","getProducedResources","resourceGeneration","resourceStructureDefinition","handleStructure","getQuestUpdates","questProgress","questDefinitions","currentProgress","currentNodeIndex","progressIncrease","nextProgress","nodesPassed","questEncounter","logUpdates","questUpdates","dirty","getRngState","Random","isLocalhost","hostname","register","navigator","URL","swUrl","fetch","response","headers","serviceWorker","ready","registration","unregister","reload","registerValidSW","checkValidServiceWorker","onupdatefound","installingWorker","installing","onstatechange","generateRandomAttributes","strength","dexterity","intelligence","avatarImgBasePath","spritesheetBasePath","testState","basicAttributes","baseAP","lastTick","getTestState","randomItem","randomEnum","anEnum","enumValues","gameTick","lU","encounterResults","reward","questStoreState","qss","deductActorAp","tO","questsToUpdate","questToUpdate","assign","updateEncounterResult","concat","nodeIndex","structureInitialState","updateStructureState","createTask","combineReducers","element","moveItemToOtherAdventurer","fromAdventurerId","toAdventurerId","fromAdventurer","startCombatAction","addAction","combatType","moveAction","GameActionType","startGame","resourcesToAdd","resourcesToRemove","rngState","workersToAdd","workersToRemove","end","persistConfig","storage","localForage","persistedReducer","persistReducer","rootReducer","initial","createStore","__REDUX_DEVTOOLS_EXTENSION__","persistStore","isHydrated","processCompletedTasks","itemCrafted","handleCompletedTask","initGame","seed","seedrandom","readPersistedStore","configureStore","storeConfiguration","continueGame","startNewGame","runGame","purge","href","confirm","clearTimeout","ReactDOM","getElementById","registerServiceWorker","logs","resourcesUpdates","isTextEntry","test","BaseSceneController","aStar","tilemapObjects","jsonPath","blockedTiles","spritesheetsMap","Set","createAStar","createObjects","createActors","loadScene","node","interactWithObject","destination","getSceneActor","pop","meleeAction","_actor","_object","itemIndex","option","convertIn","matrix","row","AStarFinder","grid","includeStartNode","heuristic","weight","startLocations","createObject","adventurerStart","exit","sceneActors","sA","getTextEntry","questUpdate","substr","lastIndexOf","DungeonEntranceSceneController","getAdventurerByActor","DungeonHallwaySceneController","registerSceneController"],"mappings":"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","file":"static/js/main.7ffb1c35.chunk.js","sourcesContent":["import { Rarity } from 'constants/items';\n\nexport enum ItemType {\n    deed,\n    apparel,\n    material,\n    questItem,\n    trinket,\n    weapon,\n}\n\n// the string must correspond to a named export in /items/index.tsx\nexport enum Item {\n    // deeds\n    deedForLumbermill = \"deedForLumbermill\",\n    deedForWeaponsmith = \"deedForWeaponsmith\",\n\n    // equipment\n    boots1 = \"boots1\",\n    boots2 = \"boots2\",\n    boots3 = \"boots3\",\n    chainmailHood = \"chainmailHood\",\n    chest = \"chest\",\n    clothGloves = \"clothGloves\",\n    cowl = \"cowl\",\n    fedora = \"fedora\",\n    druidChest = \"druidChest\",\n    druidFeet = \"druidFeet\",\n    druidHands = \"druidHands\",\n    druidHead = \"druidHead\",\n    druidLegs = \"druidLegs\",\n    greaves1 = \"greaves1\",\n    greaves2 = \"greaves2\",\n    hornedHelmet = \"hornedHelmet\",\n    leatherGloves = \"leatherGloves\",\n    nomadHelmet = \"nomadHelmet\",\n    pants1 = \"pants1\",\n    pants2 = \"pants2\",\n    plateChest1 = \"plateChest1\",\n    plateChest2 = \"plateChest2\",\n    plateChest3 = \"plateChest3\",\n    plateChest4 = \"plateChest4\",\n    plateGloves1 = \"plateGloves1\",\n    plateGloves2 = \"plateGloves2\",\n    plateHelmet = \"plateHelmet\",\n    platePants = \"platePants\",\n    plateShoulders1 = \"plateShoulders1\",\n    plateShoulders2 = \"plateShoulders2\",\n    robe = \"robe\",\n    shoulders1 = \"shoulders1\",\n    shoulders2 = \"shoulders2\",\n    shoulders3 = \"shoulders3\",\n    vest = \"vest\",\n\n    // materials\n    arrowheads = \"arrowheads\",\n    bolts = \"bolts\",\n    buckle = \"buckle\",\n    chain = \"chain\",\n    cogs = \"cogs\",\n    gem = \"gem\",\n    gunpowder = \"gunpowder\",\n    ingot = \"ingot\",\n    nails = \"nails\",\n    poisonVial = \"poisonVial\",\n    ribbon = \"ribbon\",\n    rope = \"rope\",\n    scales = \"scales\",\n    spring = \"spring\",\n    thread = \"thread\",\n\n    // quest-items\n    blueprints = \"blueprints\",\n    crate = \"crate\",\n    dragonEye = \"dragonEye\",\n    dynamite = \"dynamite\",\n    eye = \"eye\",\n    feather = \"feather\",\n    food = \"food\",\n    heart = \"heart\",\n    horn = \"horn\",\n    key = \"key\",\n    letters = \"letters\",\n    lockPicks = \"lockPicks\",\n    oil = \"oil\",\n    orcFinger = \"orcFinger\",\n    plans = \"plans\",\n    purpleGems = \"purpleGems\",\n    runestone = \"runestone\",\n    sandwich = \"sandwich\",\n    teeth = \"teeth\",\n    tooth = \"tooth\",\n    torch = \"torch\",\n    tusk = \"tusk\",\n    vase = \"vase\",\n    vial = \"vial\",\n    weeds = \"weeds\",\n\n    // trinkets\n    ring = \"ring\",\n    magicAmulet = \"magicAmulet\",\n\n    // weapons\n    aegisOfValor = \"aegisOfValor\",\n    arbalest = \"arbalest\",\n    battleAxe = \"battleAxe\",\n    berserkerShield = \"berserkerShield\",\n    brassKnuckles = \"brassKnuckles\",\n    buckler = \"buckler\",\n    cleaver = \"cleaver\",\n    club = \"club\",\n    dagger = \"dagger\",\n    flail = \"flail\",\n    goldenShield = \"goldenShield\",\n    greatswordOfGwai = \"greatswordOfGwai\",\n    indomitableCarapace = \"indomitableCarapace\",\n    javelin = \"javelin\",\n    khopesh = \"khopesh\",\n    longbow = \"longbow\",\n    mace = \"mace\",\n    morningStar = \"morningStar\",\n    paintedBuckler = \"paintedBuckler\",\n    poisonedDagger = \"poisonedDagger\",\n    ravenStaff = \"ravenStaff\",\n    savageStaff = \"savageStaff\",\n    simpleCrossbow = \"simpleCrossbow\",\n    spear = \"spear\",\n    steelShield = \"steelShield\",\n    sword = \"sword\",\n    warhammer = \"warhammer\",\n    woodenBulwark = \"woodenBulwark\"\n}\n\n\nexport interface ItemDefinition {\n    item: Item;\n    itemType: ItemType;\n    iconImg: string;\n    rarity?: Rarity;\n//    articleUndefined?: string;  // Key to text\n    unique?: boolean;           // Indicate that this item is unique.\n                                // Not actually enforced by anything,\n                                // but used to generate the article ('a' or 'the')\n}\n","import { paramCase as toKebab} from \"text-param-case\";\nimport { TextEntry } from \"constants/text\";\nimport itemDefinitions, { getDefinition } from \"definitions/items\";\nimport { Item, ItemType } from \"definitions/items/types\";\nimport { Resource } from \"definitions/resources\";\nimport { Structure } from \"definitions/structures\";\nimport * as Handlebars from \"handlebars\";\nimport { Trait } from 'definitions/traits/types';\nimport { Type } from 'components/ui/toasts/Toast';\nimport { EquipmentSlotType } from 'components/ui/adventurer/EquipmentSlot';\nimport { WeaponType, WeaponClassification } from 'definitions/items/weapons';\n\nexport abstract class TextManager {\n\n\n\n    public static init(texts: {[key: string]: string}, precompile = true) {\n        this.texts = texts;\n        this.templates = {};\n        if (precompile) {\n            this.compileAll();\n        }\n        this.initialized = true;\n    }\n\n//    public static addTexts(texts: Record<string, string>)\n    public static get(key: string, context?: any): string {\n        const result = this.getDefault(key, context);\n        if (result === null) {\n            // tslint:disable-next-line: no-console\n            console.error(`Key '${key}' not found in TextManager`);\n            return `<<'${key}' missing>>`;\n        } else {\n            return result;\n        }\n    }\n\n    // Will return `null` when no text found, otherwise will return the text\n    public static getDefault(key: string, context?: any): string|null {\n        if (!this.initialized) {\n            throw new Error(`Error ${this} not initialized!`);\n        }\n        const template = this.getTemplate(key);\n        if (!template) {\n            return null;\n        }\n        return template(context);\n    }\n\n    public static getTextEntry(textEntry: TextEntry): string {\n        return this.get(textEntry.key, textEntry.context);\n    }\n\n    public static getTemplate(key: string) {\n        let template = this.templates[key];\n        if (!template && this.texts[key]) {\n            // Template not found but key is defined. Needs to be compiled\n            this.compile(key, this.texts[key]);\n            template = this.templates[key];\n        }\n        return template;\n    }\n\n    public static getEquipmentSlot(slotType: EquipmentSlotType) {\n        return this.get(`ui-equipmentslot-${toKebab(EquipmentSlotType[slotType])}`);\n    }\n\n    public static getQuestTitle(name: string) {\n        return this.get(`quest-${toKebab(name)}-title`);\n    }\n\n    public static getQuestDescription(name: string) {\n        return this.get(`quest-${toKebab(name)}-description`);\n    }\n\n    public static getResourceName(type: Resource) {\n        return this.get(`resource-${type}-name`);\n    }\n\n    public static getItemName(item: Item): string {\n        const itemType = ItemType[getDefinition(item).itemType];\n        return this.get(`item-${toKebab(itemType)}-${toKebab(item)}-name`);\n    }\n    public static getItemSubtext(item: Item): string|null {\n        const itemType = ItemType[getDefinition(item).itemType];\n        return this.getDefault(`item-${toKebab(itemType)}-${toKebab(item)}-subtext`);\n    }\n\n    public static getStructureName(structure: Structure): string {\n        return this.get(`structure-${toKebab(structure)}-name`);\n    }\n\n    public static getTraitName(trait: Trait): string {\n        return this.get(`trait-${toKebab(trait)}-name`);\n    }\n\n    public static getTraitDescription(trait: Trait): string {\n        return this.get(`trait-${toKebab(trait)}-description`);\n    }\n\n    public static getTraitEffect(trait: Trait): string {\n        return this.get(`trait-${toKebab(trait)}-effect`);\n    }\n\n    public static getToastType(type: Type): string {\n        return this.get(`ui-toast-type-${toKebab(Type[type])}`);\n    }\n\n    public static getWeaponType(type: WeaponType) {\n        return this.get(`ui-weapon-type-${toKebab(WeaponType[type])}`);\n    }\n\n    public static getSkillName(type: WeaponType) {\n        return this.get(`skill-${toKebab(WeaponType[type])}-name`);\n    }\n\n    public static getSkillInfo(type: WeaponType) {\n        return this.get(`skill-${toKebab(WeaponType[type])}-info`);\n    }\n\n    static getWeaponClassification(weaponClass: WeaponClassification) {\n        return this.get(`ui-weapon-class-${toKebab(WeaponClassification[weaponClass])}`);\n    }\n\n    private static initialized = false;\n    private static texts: Record<string, string>;\n    private static templates: Record<string, Handlebars.TemplateDelegate<any>>;\n\n    private static compileAll() {\n        Object.keys(this.texts).forEach((key: string) =>  {\n            this.compile(key, this.texts[key]);\n        });\n    }\n\n    private static compile(key: string, value: string) {\n        const template = Handlebars.compile(value);\n        this.templates[key] = template;\n    }\n}\n\nHandlebars.registerHelper(\"item:name\", (item: Item, article?: string) => {\n    if (!itemDefinitions[item]) {\n        return new Handlebars.SafeString(`<<ITEM DEFINITION NOT FOUND: ${item}>>`);\n    }\n    switch (article) {\n        case \"aA\":  // article Auto\n            return itemArticleAuto(item);\n        case \"aD\":  // article Defined \"a sword\"\n            return itemArticleDefined(item);\n        case \"aU\":  // article Defined \"the sword\"\n            return itemArticleDefined(item);\n        default:\n            // No article\n            // const name = itemDefinitions[item].name;\n            return new Handlebars.SafeString(item);\n    }\n});\n\nHandlebars.registerHelper(\"structure:name\", (structure: string) => {\n    const name = TextManager.get(`structure-${toKebab(structure)}-name`);\n    return new Handlebars.SafeString(name);\n});\n\nHandlebars.registerHelper(\"resource:name\", (resource: string) => {\n    const name = TextManager.get(`resource-${resource}-name`);\n    return new Handlebars.SafeString(name);\n});\n\nconst itemArticleAuto = (item: Item) => {\n    return itemArticleUndefined(item);\n};\n\nconst itemArticleUndefined = (item: Item) => {\n    const name = TextManager.getItemName(item);\n    const articleTemplate = TextManager.getTemplate(\"common-article-undefined\");\n    return new Handlebars.SafeString(`${articleTemplate({ noun: name})}`);\n};\n\nconst itemArticleDefined = (item: Item) => {\n    const name = TextManager.getItemName(item);\n    const articleTemplate = TextManager.getTemplate(\"common-article-defined\");\n    return new Handlebars.SafeString(`${articleTemplate({ noun: name})}`);\n};\n","import { TextManager } from 'global/TextManager';\n\nexport const ONE_SECOND = 1000;\nexport const TWO_SECONDS = 2000;\nexport const THREE_SECONDS = 3000;\nexport const FOUR_SECONDS = 4000;\nexport const FIVE_SECONDS = 5000;\n// ...\nexport const TEN_SECONDS = 10000;\nexport const TWENTY_SECONDS = 20000;\nexport const THIRTY_SECONDS = 30000;\n\nexport const ONE_MINUTE = 60000;\nexport const TWO_MINUTES = 120000;\nexport const THREE_MINUTES = 180000;\nexport const FOUR_MINUTES = 240000;\n\nexport const HALF_HOUR = ONE_MINUTE * 30;\nexport const ONE_HOUR = ONE_MINUTE * 60;\nexport const ONE_DAY = ONE_HOUR * 24;\nexport const ONE_YEAR = ONE_DAY * 265.25;\n\nexport const formatDuration = (ms: number, short?: boolean): string => {\n    const timeUnitsList = [\n        { unit: short? 'y' : 'year', amount: ONE_YEAR },\n        { unit: short? 'd' : 'day', amount: ONE_DAY },\n        { unit: short? 'h' : 'hour', amount: ONE_HOUR },\n        { unit: short? 'm' : 'minute', amount: ONE_MINUTE },\n        { unit: short? 's': 'second', amount: ONE_SECOND },\n    ]\n    let time = Math.abs(ms);\n    const output: string[] = [];\n    timeUnitsList.forEach((el) => {\n        const tmp = Math.floor(time / el.amount);\n        time -= tmp * el.amount\n        if (tmp !== 0) {\n            const unit = TextManager.get(`common-time-${el.unit}${tmp > 1 && !short ? \"-plural\": \"\"}`);\n            output.push(`${tmp}${unit}`);\n        }\n    })\n    return output.join(\" \");\n}\n","// tslint:disable:object-literal-sort-keys\n\nimport alchemist from \"./alchemist\";\nimport armoursmith from \"./armoursmith\";\nimport garden from \"./garden\";\nimport lumberMill from \"./lumberMill\";\nimport mine from \"./mine\";\nimport quarry from \"./quarry\";\nimport tannery from \"./tannery\";\nimport tavern from \"./tavern\";\nimport { StructureDefinition } from \"./types\";\nimport warehouse from \"./warehouse\";\nimport weaponsmith from \"./weaponsmith\";\nimport weaver from \"./weaver\";\nimport workshop from \"./workshop\";\nimport { Resource } from 'definitions/resources';\n\nexport enum Structure {\n    alchemist = \"alchemist\",\n    armoursmith = \"armoursmith\",\n    garden = \"garden\",\n    lumberMill = \"lumberMill\",\n    mine = \"mine\",\n    quarry = \"quarry\",\n    tavern = \"tavern\",\n    tannery = \"tannery\",\n    warehouse = \"warehouse\",\n    weaponsmith = \"weaponsmith\",\n    weaver = \"weaver\",\n    workshop = \"workshop\",\n}\n\nconst all = {\n    alchemist,\n    armoursmith,\n    garden,\n    lumberMill,\n    mine,\n    quarry,\n    tavern,\n    tannery,\n    warehouse,\n    weaponsmith,\n    weaver,\n    workshop,\n};\n\nexport default all;\n\nexport function getDefinition<T extends StructureDefinition>(structure: string): T {\n    return all[structure] as T;\n}\n\nexport function getStructureByResource(resource: Resource) : Structure {\n    switch (resource) {\n        case Resource.fabric:\n            return Structure.weaver;\n        case Resource.food:\n            return Structure.garden;\n        case Resource.iron:\n            return Structure.mine;\n        case Resource.leather:\n            return Structure.tannery;\n        case Resource.stone:\n            return Structure.quarry;\n        case Resource.wood:\n            return Structure.lumberMill;\n    }\n}\n","// tslint:disable:object-literal-sort-keys\nimport { ONE_MINUTE, TWO_MINUTES } from 'utils/format/time';\nimport { ProductionStructureDefinition, StructureType } from \"./types\";\nconst alchemist: ProductionStructureDefinition = {\n    type: StructureType.production,\n    cost: {\n        gold: 40,\n        time: 4000,\n    },\n    levels: [{\n        displayName: \"structure-alchemist-name\",\n        // level 1:\n        workerCapacity: 2,\n        cost: {\n            gold: 0,\n        },\n        unlocks: [],\n    }, {\n        // level 2:\n        displayName: \"structure-alchemist-name\",\n        workerCapacity: 5,\n        cost: {\n            gold: 30,\n            time: ONE_MINUTE\n        },\n        unlocks: [],\n    }, {\n        // level 3:\n        displayName: \"structure-alchemist-name\",\n        workerCapacity: 10,\n        cost: {\n             gold: 50,\n             time: TWO_MINUTES\n        },\n        unlocks: [],\n    }],\n};\n\nexport default alchemist;\n","// tslint:disable:object-literal-sort-keys\n\nimport { ProductionStructureDefinition, StructureType } from \"./types\";\nimport { Item } from 'definitions/items/types';\nimport { ONE_MINUTE, TWO_MINUTES } from 'utils/format/time';\n\nconst armoursmith: ProductionStructureDefinition = {\n    cost: {\n        gold: 40,\n        time: 4000,\n    },\n    type: StructureType.production,\n    levels: [{\n        // level 1:\n        displayName: \"structure-armoursmith-name\",\n        workerCapacity: 2,\n        cost: {\n            gold: 0,\n        },\n        unlocks: [ Item.boots1 ],\n    }, {\n        // level 2:\n        displayName: \"structure-armoursmith-name\",\n        workerCapacity: 5,\n        cost: {\n            gold: 30,\n            time: ONE_MINUTE\n        },\n        unlocks: [ Item.chest ],\n    }, {\n        // level 3:\n        displayName: \"structure-armoursmith-name\",\n        workerCapacity: 10,\n        cost: {\n            gold: 50,\n            time: TWO_MINUTES\n        },\n        unlocks: [ Item.cowl],\n    }],\n};\nexport default armoursmith;\n","// tslint:disable:object-literal-sort-keys\nimport { ONE_MINUTE, TWO_MINUTES } from 'utils/format/time';\nimport { ResourceStructureDefinition, StructureType } from \"./types\";\n\nconst garden: ResourceStructureDefinition = {\n    type: StructureType.resource,\n    cost: {\n        gold: 40,\n        time: 4000,\n    },\n    levels: [{\n        displayName: \"structure-garden-name\",\n        // level 1:\n        workerCapacity: 2,\n        cost: {\n            gold: 0,\n        },\n        generates: { food: 2 },\n    }, {\n        displayName: \"structure-garden-name\",\n        // level 2:\n        workerCapacity: 5,\n        cost: {\n            gold: 30,\n            time: ONE_MINUTE\n        },\n        generates: { food: 4 },\n    }, {\n        // level 3:\n        displayName: \"structure-garden-name\",\n        workerCapacity: 10,\n        cost: {\n            gold: 50,\n            time: TWO_MINUTES\n        },\n        generates: { food: 8 },\n    }],\n};\n\nexport default garden;\n","// tslint:disable:object-literal-sort-keys\n\nimport { ResourceStructureDefinition, StructureType } from \"./types\";\nimport { HALF_HOUR, ONE_MINUTE, TWO_MINUTES } from 'utils/format/time';\n\nconst lumberMill: ResourceStructureDefinition = {\n    type: StructureType.resource,\n    cost: {\n        gold: 31,\n        time: HALF_HOUR,\n    },\n    levels: [{\n        // level 0:\n        displayName: \"structure-lumber-mill-name\",\n        workerCapacity: 2,\n        cost: {\n            gold: 0,\n        },\n        generates: { wood: 2 },\n    }, {\n        // level 1:\n        displayName: \"structure-lumber-mill-name\",\n        workerCapacity: 5,\n        cost: {\n            gold: 30,\n            time: ONE_MINUTE\n        },\n        generates: { wood: 2 },\n    }, {\n        // level 2:\n        displayName: \"structure-lumber-mill-name\",\n        workerCapacity: 10,\n        cost: {\n            gold: 50,\n            time: TWO_MINUTES\n        },\n        generates: { wood: 2 },\n    }],\n};\n\nexport default lumberMill;\n","// tslint:disable:object-literal-sort-keys\nimport { ONE_MINUTE, TWO_MINUTES } from 'utils/format/time';\nimport { ResourceStructureDefinition, StructureType } from \"./types\";\n\nconst mine: ResourceStructureDefinition = {\n    cost: {\n        gold: 40,\n        time: 4000,\n    },\n    type: StructureType.resource,\n    levels: [{\n        displayName: \"structure-mine-name\",\n        // level 0:\n        workerCapacity: 2,\n        cost: {\n            gold: 0,\n        },\n        generates: { iron: 2 },\n    }, {\n        displayName: \"structure-mine-name\",\n        // level 1:\n        workerCapacity: 5,\n        cost: {\n            gold: 30,\n            time: ONE_MINUTE\n        },\n        generates: { iron: 2 },\n    }, {\n        displayName: \"structure-mine-name\",\n        // level 2:\n        workerCapacity: 10,\n        cost: {\n            gold: 50,\n            time: TWO_MINUTES\n        },\n        generates: { iron: 2 },\n    }],\n};\nexport default mine;\n","// tslint:disable:object-literal-sort-keys\nimport { ONE_MINUTE, TWO_MINUTES } from 'utils/format/time';\nimport { ResourceStructureDefinition, StructureType } from \"./types\";\n\nconst quarry: ResourceStructureDefinition = {\n    cost: {\n        gold: 40,\n        time: 4000,\n    },\n    type: StructureType.resource,\n    levels: [{\n        displayName: \"structure-quarry-name\",\n        // level 1:\n        workerCapacity: 2,\n        cost: {\n            gold: 0,\n        },\n        generates: { stone: 2 },\n    }, {\n        // level 2:\n        displayName: \"structure-quarry-name\",\n        workerCapacity: 5,\n        cost: {\n            gold: 30,\n            time: ONE_MINUTE\n        },\n        generates: { stone: 4 },\n    }, {\n        // level 3:\n        displayName: \"structure-quarry-name\",\n        workerCapacity: 10,\n        cost: {\n            gold: 50,\n            time: TWO_MINUTES\n        },\n        generates: { stone: 6 },\n    }],\n};\n\nexport default quarry;\n","// tslint:disable:object-literal-sort-keys\n\nimport { ONE_MINUTE, TWO_MINUTES } from 'utils/format/time';\nimport { ResourceStructureDefinition, StructureType } from \"./types\";\n\nconst tannery: ResourceStructureDefinition = {\n    cost: {\n        gold: 40,\n        time: 4000,\n    },\n    type: StructureType.resource,\n    levels: [{\n        displayName: \"structure-tannery-name\",\n        // level 1:\n        workerCapacity: 2,\n        cost: {\n            gold: 0,\n        },\n        generates: { leather: 2 },\n    }, {\n        // level 2:\n        displayName: \"structure-tannery-name\",\n        workerCapacity: 5,\n        cost: {\n            gold: 30,\n            time: ONE_MINUTE\n        },\n        generates: { leather: 5 },\n    }, {\n        // level 3:\n        displayName: \"structure-tannery-name\",\n        workerCapacity: 10,\n        cost: {\n            gold: 50,\n            time: TWO_MINUTES\n        },\n        generates: { leather: 7 },\n    }],\n};\n\nexport default tannery;\n","// tslint:disable:object-literal-sort-keys\n\nimport { ONE_MINUTE, TWO_MINUTES } from 'utils/format/time';\nimport { StructureType, TavernStructureDefinition } from \"./types\";\n\nconst tavern: TavernStructureDefinition = {\n    cost: {\n        gold: 40,\n        time: 4000,\n    },\n    type: StructureType.tavern,\n    levels: [{\n        displayName: \"structure-tavern-name\",\n        // level 1:\n        workerCapacity: 2,\n        cost: {\n             gold: 0,\n        },\n        rooms: 10,\n    }, {\n        // level 2:\n        displayName: \"structure-tavern-name\",\n        workerCapacity: 5,\n        cost: {\n            gold: 30,\n            time: ONE_MINUTE\n        },\n        rooms: 12,\n    }, {\n        // level 3:\n        displayName: \"structure-tavern-name\",\n        workerCapacity: 10,\n        cost: {\n             gold: 50,\n             time: TWO_MINUTES\n        },\n        rooms: 15,\n    }],\n};\n\nexport default tavern;\n","// tslint:disable:object-literal-sort-keys\n\nimport { FOUR_MINUTES, TWO_MINUTES } from 'utils/format/time';\nimport {  StructureType, WarehouseStructureDefinition } from \"./types\";\n\nconst warehouse: WarehouseStructureDefinition = {\n    cost: {\n        gold: 40,\n        time: 4000,\n    },\n    type: StructureType.warehouse,\n    levels: [{\n        displayName: \"structure-warehouse-name\",\n        // level 1:\n        workerCapacity: 2,\n        cost: {\n            gold: 0,\n        },\n        maxResources: {\n            fabric: 200,\n            food: 200,\n            iron: 200,\n            leather: 200,\n            stone: 200,\n            wood: 200,\n        },\n        maxStockpile: 16\n    }, {\n        // level 2:\n        displayName: \"structure-warehouse-name\",\n        workerCapacity: 5,\n        cost: {\n            gold: 13,\n            time: FOUR_MINUTES\n        },\n        maxResources: {\n            fabric: 500,\n            food: 500,\n            iron: 500,\n            leather: 500,\n            stone: 500,\n            wood: 500,\n        },\n        maxStockpile: 32\n    }, {\n        // level 3:\n        displayName: \"structure-warehouse-name\",\n        workerCapacity: 10,\n        cost: {\n            gold: 50,\n            time: TWO_MINUTES * 5\n        },\n        maxResources: {\n            fabric: 1000,\n            food: 1000,\n            iron: 1000,\n            leather: 1000,\n            stone: 1000,\n            wood: 1000,\n        },\n        maxStockpile: 48\n    }],\n};\n\nexport default warehouse;\n","// tslint:disable:object-literal-sort-keys\nimport { ProductionStructureDefinition, StructureType } from \"./types\";\nimport { Item } from 'definitions/items/types';\nimport { ONE_MINUTE, THREE_MINUTES, TWO_MINUTES } from 'utils/format/time';\n\nconst weaponsmith: ProductionStructureDefinition = {\n    type: StructureType.production,\n    cost: {\n        gold: 40,\n        time: 4000,\n    },\n    levels: [{\n        // level 1:\n        displayName: \"structure-weaponsmith-name\",\n        workerCapacity: 2,\n        cost: {\n            gold: 0,\n        },\n        unlocks: [],\n    }, {\n        // level 2:\n        displayName: \"structure-weaponsmith-name\",\n        workerCapacity: 5,\n        cost: {\n            gold: 30,\n            time: ONE_MINUTE\n        },\n        unlocks: [],\n    }, {\n        // level 3:\n        displayName: \"structure-weaponsmith-name\",\n        workerCapacity: 10,\n        cost: {\n            gold: 50,\n            time: TWO_MINUTES\n\n        },\n        unlocks: [],\n    }, {\n        // level 4:\n        displayName: \"structure-weaponsmith-name\",\n        workerCapacity: 14,\n        cost: {\n            gold: 50,\n            time: THREE_MINUTES\n        },\n        unlocks: [Item.poisonedDagger],\n    }],\n};\nexport default weaponsmith;\n","// tslint:disable:object-literal-sort-keys\nimport { ONE_MINUTE, THREE_MINUTES } from 'utils/format/time';\nimport { ResourceStructureDefinition, StructureType } from \"./types\";\n\nconst weaver: ResourceStructureDefinition = {\n    cost: {\n        gold: 40,\n        time: 4000,\n    },\n    type: StructureType.resource,\n    levels: [{\n        displayName: \"structure-weaver-name\",\n        // level 0:\n        workerCapacity: 2,\n        cost: {\n            gold: 0,\n        },\n        generates: { fabric: 2 },\n    }, {\n        displayName: \"structure-weaver-name\",\n        // level 1:\n        workerCapacity: 5,\n        cost: {\n            gold: 30,\n            time: ONE_MINUTE\n        },\n        generates: { fabric: 5 },\n    }, {\n        displayName: \"structure-weaver-name\",\n        // level 2:\n        workerCapacity: 10,\n        cost: {\n            gold: 50,\n            time: THREE_MINUTES\n        },\n        generates: { fabric: 7 },\n    }],\n};\n\nexport default weaver;\n","// tslint:disable:object-literal-sort-keys\nimport { ONE_MINUTE, THREE_MINUTES, TWO_MINUTES } from 'utils/format/time';\nimport { ProductionStructureDefinition, StructureType } from \"./types\";\n\nconst workshop: ProductionStructureDefinition = {\n    type: StructureType.production,\n    cost: {\n        gold: 40,\n        time: 4000,\n    },\n    levels: [{\n        // level 1:\n        displayName: \"structure-workshop-name\",\n        workerCapacity: 2,\n        cost: {\n            gold: 0,\n        },\n        unlocks: [ ],\n    }, {\n        // level 2:\n        displayName: \"structure-workshop-name\",\n        workerCapacity: 5,\n        cost: {\n            gold: 30,\n            time: ONE_MINUTE\n        },\n        unlocks: [],\n    }, {\n        // level 3:\n        displayName: \"structure-workshop-name\",\n        workerCapacity: 10,\n        cost: {\n            gold: 50,\n            time: TWO_MINUTES\n        },\n        unlocks: [],\n    }, {\n        // level 4:\n        displayName: \"structure-workshop-name\",\n        workerCapacity: 14,\n        cost: {\n            gold: 50,\n            time: THREE_MINUTES\n        },\n        unlocks: [],\n    }],\n};\nexport default workshop;\n","// https://github.com/react-dnd/react-dnd/pull/1244\nimport * as React from \"react\";\nimport { ConnectDropTarget, DropTarget, DropTargetConnector, DropTargetMonitor, DropTargetSpec } from \"react-dnd\";\nimport { DragType } from \"constants/dragging\";\nimport { getDefinition } from \"definitions/items\";\nimport { ApparelDefinition } from \"definitions/items/apparel\";\nimport { Item, ItemType } from \"definitions/items/types\";\nimport { WeaponDefinition, typeClassifications, WeaponClassification } from 'definitions/items/weapons';\nimport { InventoryItemDragInfo } from 'components/ui/items/DraggableItemIcon';\nimport \"./styles/equipmentslot.scss\";\n\nconst dropTarget: DropTargetSpec<Props> = {\n    drop(props: Props, monitor: DropTargetMonitor) {\n        props.onDrop(monitor.getItem());\n    },\n    canDrop(props: Props, monitor: DropTargetMonitor)  {\n        const item = monitor.getItem().item;\n\n        return itemAndEquipmentSlotMatch(item, props.type);\n    },\n};\n\nexport enum EquipmentSlotType {\n    feet,\n    hands,\n    chest,\n    legs,\n    head,\n    shoulders,\n    mainHand,\n    offHand,\n}\n\n// Returns true if item can be slotted in equipmentSlotType\nexport const itemAndEquipmentSlotMatch = (item: Item, equipmentSlotType: EquipmentSlotType) => {\n    switch (equipmentSlotType) {\n        case EquipmentSlotType.chest:\n        case EquipmentSlotType.feet:\n        case EquipmentSlotType.hands:\n        case EquipmentSlotType.head:\n        case EquipmentSlotType.legs:\n            return checkEquipment(item, equipmentSlotType);\n        case EquipmentSlotType.mainHand:\n        case EquipmentSlotType.offHand:\n            const itemDefinition: WeaponDefinition = getDefinition(item) as WeaponDefinition;\n            if (itemDefinition.itemType !== ItemType.weapon) {\n                return false;\n            }\n            const weaponClassification: WeaponClassification = typeClassifications[itemDefinition.weaponType];\n            switch (weaponClassification) {\n                case WeaponClassification.oneHanded:\n                    return true;\n                case WeaponClassification.mainHand:\n                    return equipmentSlotType === EquipmentSlotType.mainHand;\n                case WeaponClassification.offHand:\n                case WeaponClassification.shield:\n                    return equipmentSlotType === EquipmentSlotType.offHand;\n            }\n\n            // todo: prevent shields to be equipped in main hand\n            return true;\n        default:\n            return false;\n    }\n};\n\nexport interface Props {\n    type: EquipmentSlotType;\n    onDrop: (item: InventoryItemDragInfo) => void;\n}\n\nexport interface DropSourceProps {\n    canDrop: boolean;\n    isOver: boolean;\n    connectDropTarget: ConnectDropTarget;\n}\n\nconst collect = (connect: DropTargetConnector, monitor: DropTargetMonitor) => ({\n    canDrop: monitor.canDrop(),\n    connectDropTarget: connect.dropTarget(),\n    isOver: monitor.isOver(),\n});\n\n/**\n * The EquipmentSlot displays a slot in which an item can be placed.\n */\nconst EquipmentSlot = (props: React.PropsWithChildren<Props & DropSourceProps>) => {\n    const {\n        isOver,\n        canDrop,\n        connectDropTarget,\n    } = props;\n    const isActive = isOver && canDrop;\n    let borderColor = \"grey\";\n    if (isActive) {\n        borderColor = \"green\";\n    } else if (canDrop) {\n        borderColor = \"orange\";\n    }\n\n    return connectDropTarget(\n        <div className = \"equipment-slot\" style = { { borderColor }} title={EquipmentSlotType[props.type]}>\n            { props.children }\n        </div>,\n    );\n};\n\nexport default DropTarget<Props, DropSourceProps>(\n    DragType.ITEM,\n    dropTarget,\n    collect,\n)(EquipmentSlot);\n\nconst checkEquipment = (item: Item, equipmentType: EquipmentSlotType) => {\n    const itemDefinition = getDefinition(item);\n    if (itemDefinition.itemType !== ItemType.apparel) {\n        return false;\n    }\n    return (itemDefinition as ApparelDefinition).equipmentType === equipmentType;\n};\n","import { QuestStoreState } from 'store/types/quest';\nimport { Item } from 'definitions/items/types';\n\nexport enum QuestNodeType {\n    nothing = 0,    // Nothing much going on here\n    encounter = 1,\n    // combat = 2,     // Not implemented\n    // boss = 3,\n}\n\nexport interface QuestDefinition<TQuestVars = any> {\n    nodes: QuestNode[];\n    requiredItems?: Item[];\n    getQuestVars: (questStoreState: QuestStoreState) => TQuestVars;\n    getInitialQuestVars: (questStoreState: QuestStoreState) => TQuestVars;\n}\n\ntype AllNodeTypes = {\n    x: number;\n    y: number;\n    log?: string;   \n}\n\nexport type QuestNode  =\n    | AllNodeTypes & { type: QuestNodeType.nothing}\n    | AllNodeTypes & { type: QuestNodeType.encounter, startScene: string}\n","import * as React from \"react\";\nimport { PropsWithChildren } from 'react';\nimport \"./styles/icon.scss\";\n\nexport interface Props {\n    image: string;\n    size?: IconSizeType;\n    className?: string;\n    border?: Border | keyof typeof Border;\n}\n\nexport enum IconSize {\n    smallest = \"smallest\",\n    small = \"small\",\n    medium = \"medium\",\n    big = \"big\",\n    biggest = \"biggest\"\n}\n\ntype IconSizeType = IconSize | keyof typeof IconSize;\n\nexport enum Border {\n    none = \"none\",\n    gold = \"gold\"\n}\n\nconst Icon = (props: PropsWithChildren<Props> & React.ComponentProps<\"div\">) => {\n    const {\n        image,\n        size,\n        children,\n        className = \"\",\n        border = \"none\",\n        ...restProps\n    } = props;\n    return (\n        <div\n            className={`icon ${sizeClassName((typeof size === \"string\") ? IconSize[size] : size)} ${className}`}\n            {...restProps}\n            style={{\n                backgroundImage: `url(${process.env.PUBLIC_URL}${image})`,\n            }}\n        >\n            {children}\n            { border !== \"none\" && border && (\n                <div className={`border ${borderClassName((typeof border === \"string\") ? Border[border] : border)} `}/>\n            )}\n        </div>\n    );\n};\n\nexport default Icon;\n\n\nconst sizeClassName = (size?: IconSize): string => {\n    switch (size) {\n        case IconSize.smallest:\n            return \"size-smallest\";\n        case IconSize.small:\n            return \"size-small\";\n        case IconSize.medium:\n            return \"size-medium\";\n        case IconSize.big:\n            return \"size-big\";\n        case IconSize.biggest:\n            return \"size-biggest\";\n    }\n    return sizeClassName(IconSize.medium);\n};\n\nconst borderClassName = (border?: Border): string => {\n    switch (border) {\n        case Border.gold:\n            return \"border-gold\";\n        case Border.none:\n        default:\n            return \"\";\n    }\n}","// tslint:disable: object-literal-sort-keys\nexport enum Resource {\n    wood = \"wood\",\n    iron = \"iron\",\n    stone = \"stone\",\n    leather = \"leather\",\n    fabric = \"fabric\",\n    food = \"food\",\n}\n\nexport interface ResourceDefinition {\n    resource: Resource;\n    iconImg: string;\n}\n\nconst all = {\n    [Resource.wood]: {\n        resource: Resource.wood,\n        iconImg: \"/img/resources/wood.png\",\n    },\n    [Resource.iron]: {\n        resource: Resource.iron,\n        iconImg: \"/img/resources/iron.png\",\n    },\n    [Resource.stone]: {\n        resource: Resource.stone,\n        iconImg: \"/img/resources/stone.png\",\n    },\n    [Resource.leather]: {\n        resource: Resource.leather,\n        iconImg: \"/img/resources/leather.png\",\n    },\n    [Resource.fabric]: {\n        resource: Resource.fabric,\n        iconImg: \"/img/resources/fabric.png\",\n    },\n    [Resource.food]: {\n        resource: Resource.food,\n        iconImg: \"/img/resources/food.png\",\n    },\n};\n\nexport default all;","\nexport enum Rarity {\n    // gray = common, green = uncommon, blue = rare, purple = epic, orange = legendary\n    common,\n    uncommon,\n    rare,\n    epic,\n    legendary\n}\n","import { Action } from \"redux\";\nimport { AdventurerStoreState } from \"store/types/adventurer\";\nimport { SceneAction, SceneStoreState, SceneObject, SceneInteractionModal } from \"store/types/scene\";\nimport { Item } from 'definitions/items/types';\n\n// tslint:disable:object-literal-sort-keys\n\nexport enum ActionType {\n    launchQuest = \"launchQuest\",                            // Embark upon a new quest\n    updateQuestVars = \"updateQuestVars\",                    // ?\n    updateEncounterResult = \"updateEncounterResult\",        // unused?\n    startEncounter = \"startEncounter\",                      // unused! remove\n    setSceneName = \"setSceneName\",                          // Sets name of the current scene of a quest\n    setScene = \"setScene\",                                  // Fills in the scene of a quest\n    exitEncounter = \"exitEncounter\",                        // Encounter is complete, leave scene and continue on quest\n    enqueueSceneAction = \"enqueueSceneAction\",\n    completeSceneAction = \"completeSceneAction\",\n    setCombat = \"setCombat\",                                // Sets combat status\n    deductActorAp = \"deductActorAp\",\n    updateSceneObjectAction = \"updateSceneObjectAction\",    // Updates a tile object on the scene. Can update any property except 'id'\n    setActiveSceneInteractionModal = \"setActiveSceneInteractionModal\",     // Sets the active  modal\n}\n\nexport interface QuestAction extends Action<ActionType> {\n    questName: string;\n}\n\nexport interface QuestVarsAction extends QuestAction {\n    vars: any;\n}\n\nexport interface QuestLaunchAction extends QuestAction {\n    assignedAventurers: AdventurerStoreState[];\n}\n\nexport interface SetSceneNameAction extends QuestAction {\n    sceneName: string;\n}\n\nexport interface SetSceneAction extends QuestAction {\n    scene: SceneStoreState;\n}\n\nexport interface EnqueueSceneActionAction extends QuestAction {\n    sceneAction: SceneAction;\n}\n\nexport interface DeductActorApAction extends QuestAction {\n    actor: string;\n    ap: number;\n}\n\nexport interface SetCombatAction extends QuestAction {\n    combat: boolean;\n}\n\nexport interface UpdateEncounterResultAction extends QuestAction {\n    nodeIndex: number;\n    result: string;\n}\n\nexport interface SetActiveSceneInteractionModalAction extends QuestAction {\n    sceneInteractionModal?: SceneInteractionModal;\n}\n\nexport interface TakeItemFromCacheAction extends QuestAction {\n    cacheName: string;\n    item: Item;\n}\n\nexport interface UpdateSceneObjectAction extends QuestAction {\n    id: number;\n    object: Partial<Omit<SceneObject, 'id'>>;\n}\n\nexport function launchQuest(questName: string, assignedAventurers: AdventurerStoreState[]): QuestLaunchAction {\n    return {\n        type: ActionType.launchQuest,\n        questName,\n        assignedAventurers,\n    };\n}\n\n/** Completes the current encounter so the party can continue the quest */\nexport function exitEncounter(quest: string): QuestAction {\n    return {\n        type: ActionType.exitEncounter,\n        questName: quest,\n    };\n}\n\nexport function updateQuestVars(quest: string, vars: any): QuestVarsAction {\n    return {\n        type: ActionType.updateQuestVars,\n        questName: quest,\n        vars,\n    };\n}\n\n// Scene stuff\n\nexport function setSceneName(questName: string, sceneName: string): SetSceneNameAction {\n    return {\n        type: ActionType.setSceneName,\n        questName,\n        sceneName,\n    };\n}\n\nexport function setScene(questName: string, scene: SceneStoreState): SetSceneAction {\n    return {\n        type: ActionType.setScene,\n        questName,\n        scene,\n    };\n}\n\nexport function enqueueSceneAction(quest: string, sceneAction: SceneAction): EnqueueSceneActionAction {\n    return {\n        type: ActionType.enqueueSceneAction,\n        questName: quest,\n        sceneAction,\n    };\n}\n\nexport function completeSceneAction(quest: string): QuestAction {\n    return {\n        type: ActionType.completeSceneAction,\n        questName: quest,\n    };\n}\n\nexport function setCombat(quest: string, combat: boolean): SetCombatAction {\n    return {\n        type: ActionType.setCombat,\n        questName: quest,\n        combat\n    };\n}\n\nexport function deductActorAp(quest: string, actor: string, ap: number): DeductActorApAction {\n    return {\n        type: ActionType.deductActorAp,\n        questName: quest,\n        actor,\n        ap\n    };\n}\n\nexport const updateSceneObject = (questName: string, id: number, object: Partial<Omit<SceneObject, 'id'>>): UpdateSceneObjectAction => {\n    return {\n        type: ActionType.updateSceneObjectAction,\n        questName,\n        id,\n        object\n    };\n}\n\nexport function updateEncounterResult(quest: string, nodeIndex: number, result: string): UpdateEncounterResultAction {\n    return {\n        type: ActionType.updateEncounterResult,\n        questName: quest,\n        nodeIndex,\n        result,\n    };\n}\n\nexport const setActiveSceneInteractionModal = (questName: string, sceneInteractionModal?: SceneInteractionModal): SetActiveSceneInteractionModalAction => {\n   return {\n       type: ActionType.setActiveSceneInteractionModal,\n       questName,\n       sceneInteractionModal\n   }\n}\n","import { MediaItem } from \"components/preloading/Preloader\";\nimport { Howl } from \"howler\";\nimport localforage from 'localforage';\n\nexport enum MusicTrack {\n    town,\n    world,\n}\n\nexport enum Sound {\n    buttonClick,\n    error,\n    toast\n}\n\nlet media: MediaItem[];\n\nconst musicTracks: { [key: number]: Howl; } = {};\nlet currentMusicTrack: MusicTrack|null = null;\n\nconst sounds: { [key: number]: Howl; } = {};\nconst DEFAULT_MUSIC_VOLUME = 0;\nconst STORAGE_KEY_MUSIC_VOLUME = \"musicVolume\";\nconst DEFAULT_SOUND_VOLUME = 1;\nconst STORAGE_KEY_SOUND_VOLUME = \"soundVolume\";\n\nexport class SoundManager {\n    private static _musicVolume: number = DEFAULT_MUSIC_VOLUME;\n    private static _soundVolume: number = DEFAULT_SOUND_VOLUME;\n    private static _initialized = false;\n\n    public static async init() {\n        // Attempt to fetch volumes from storage. If not set, revert to defaults\n        this._musicVolume = await localforage.getItem(STORAGE_KEY_MUSIC_VOLUME) || DEFAULT_MUSIC_VOLUME;\n        this._soundVolume = await localforage.getItem(STORAGE_KEY_SOUND_VOLUME) || DEFAULT_SOUND_VOLUME;\n        // if (this._soundVolume === null) this._soundVolume = DEFAULT_SOUND_VOLUME;\n        // if (this._musicVolume === null) this._musicVolume = DEFAULT_MUSIC_VOLUME;\n\n        this._initialized = true;\n    }\n\n    public static loadMedia(m: MediaItem[]) {\n        media = m;\n    }\n\n    public static addSounds(soundList: Record<Sound, string>) {\n        Object.entries(soundList).forEach(([key, value]) => {\n            // todo: assert [10/07/2019 ASSERTS]\n            sounds[key] = media.find((m) => m.url === value)!.content;\n        });\n    }\n\n    public static playSound(sound: Sound) {\n        const howl = sounds[sound];\n        howl.volume(this.soundVolume);\n        howl.play();\n    }\n\n    public static async addMusicTrack(track: MusicTrack, url: string) {\n        if (!media) { return; }\n        if (!this._initialized) {\n            await this.init();\n        }\n\n        const sound = media.find((m) => m.url === url);\n        if (!sound) {\n            throw new Error(`No sound found at ${url}`);\n        }\n        if (!musicTracks.hasOwnProperty(track)) {\n            musicTracks[track] = sound.content as Howl;\n        }\n    }\n\n    /**\n     * Fades out currently playing music and fades new music in\n     * @param track\n     */\n    public static async playMusicTrack(track: MusicTrack) {\n        if (!media) { return; }\n        if (!this._initialized) {\n            await this.init();\n        }\n\n        if (currentMusicTrack !== null) {\n            const currentMusic: Howl = musicTracks[currentMusicTrack];\n            currentMusic.fade(SoundManager.musicVolume, 0, 500);\n        }\n        const nextMusic = musicTracks[track];\n        if (!nextMusic.playing()) {\n            nextMusic.loop(true);\n            nextMusic.play();\n        }\n        nextMusic.fade(0, SoundManager.musicVolume, 500);\n\n        currentMusicTrack = track;\n    }\n\n    static set soundVolume(volume: number) {\n        this._soundVolume = volume;\n        localforage.setItem(STORAGE_KEY_SOUND_VOLUME, volume);\n    }\n\n    static get soundVolume(): number {\n        return this._soundVolume;\n    }\n\n    static set musicVolume(volume: number) {\n        if (currentMusicTrack) {\n            musicTracks[currentMusicTrack].volume(volume);\n        }\n        this._musicVolume = volume;\n        localforage.setItem(STORAGE_KEY_MUSIC_VOLUME, volume);\n    }\n\n    static get musicVolume() : number {\n        return this._musicVolume;\n    }\n}\n","// tslint:disable:object-literal-sort-keys\nimport { Item, ItemDefinition, ItemType } from \"./types\";\nimport { Rarity } from 'constants/items';\n\nconst itemType = ItemType.weapon;\nconst basePath = \"/img/items/weapons/\";\n\nexport enum WeaponType {\n    axe = \"axe\",\n    bow = \"bow\",\n    club = \"club\",\n    crossbow = \"crossbow\",\n    fist = \"fist\",\n    flail = \"flail\",\n    hammer = \"hammer\",\n    knife = \"knife\",\n    staff = \"staff\",\n    shield = \"shield\",\n    sword = \"sword\",\n    poleArm = \"poleArm\",\n}\n\nexport enum WeaponClassification {\n    oneHanded,  // Can be used in main hand or off hand\n    mainHand,   // Can only be used in main hand\n    offHand,    // Can only be used in the off hand\n    twoHanded,  // Can be used in the main hand and will disable off hand from being used\n    shield      // ?\n    // add 'ranged'?\n}\n\nexport const typeClassifications = {\n    [WeaponType.axe]: WeaponClassification.oneHanded,\n    [WeaponType.bow]: WeaponClassification.oneHanded,\n    [WeaponType.club]: WeaponClassification.oneHanded,\n    [WeaponType.crossbow]: WeaponClassification.mainHand,\n    [WeaponType.fist]: WeaponClassification.oneHanded,\n    [WeaponType.flail]: WeaponClassification.mainHand,\n    [WeaponType.hammer]: WeaponClassification.oneHanded,\n    [WeaponType.knife]: WeaponClassification.oneHanded,\n    [WeaponType.staff]: WeaponClassification.twoHanded,\n    [WeaponType.sword]: WeaponClassification.oneHanded,\n    [WeaponType.poleArm]: WeaponClassification.twoHanded,\n    [WeaponType.shield]: WeaponClassification.shield\n}\n\n\nexport enum DamageType {\n    kinetic = \"kinetic\",\n}\n\nexport interface DamageDefinition {\n    [DamageType.kinetic]: number | undefined;\n}\n\n\n// tslint:disable-next-line:no-empty-interface\nexport interface WeaponDefinition extends ItemDefinition {\n    weaponType: WeaponType;\n    damage?: DamageDefinition;\n}\n\nconst weaponDefinitions: Record<string, WeaponDefinition> = {\n    [Item.aegisOfValor]: {\n        item: Item.aegisOfValor,\n        itemType,\n        weaponType: WeaponType.shield,\n        rarity: Rarity.legendary,\n        iconImg: `${basePath}aegis-of-valor.png`,\n    },\n    [Item.arbalest]: {\n        item: Item.arbalest,\n        itemType,\n        weaponType: WeaponType.crossbow,\n        rarity: Rarity.epic,\n        iconImg: `${basePath}arbalest.png`,\n        damage: { [DamageType.kinetic]: 40 },\n    },\n    [Item.battleAxe]: {\n        item: Item.battleAxe,\n        itemType,\n        weaponType: WeaponType.axe,\n        rarity: Rarity.common,\n        iconImg: `${basePath}battle_axe.png`,\n        damage: { [DamageType.kinetic]: 20 },\n    },\n    [Item.berserkerShield]: {\n        item: Item.berserkerShield,\n        itemType,\n        weaponType: WeaponType.shield,\n        rarity: Rarity.epic,\n        iconImg: `${basePath}berserker-shield.png`,\n    },\n    [Item.brassKnuckles]: {\n        item: Item.brassKnuckles,\n        itemType,\n        weaponType: WeaponType.fist,\n        iconImg: `${basePath}brass_knuckles.png`,\n        rarity: Rarity.common,\n        damage: { [DamageType.kinetic]: 10 },\n    },\n    [Item.buckler]: {\n        item: Item.buckler,\n        itemType,\n        weaponType: WeaponType.shield,\n        rarity: Rarity.common,\n        iconImg: `${basePath}buckler.png`,\n    },\n    [Item.cleaver]: {\n        item: Item.cleaver,\n        itemType,\n        weaponType: WeaponType.knife,\n        iconImg: `${basePath}cleaver.png`,\n        rarity: Rarity.common,\n        damage: { [DamageType.kinetic]: 5 },\n    },\n    [Item.club]: {\n        item: Item.club,\n        itemType,\n        weaponType: WeaponType.club,\n        iconImg: `${basePath}club.png`,\n        rarity: Rarity.common,\n        damage: { [DamageType.kinetic]: 8 },\n    },\n    [Item.dagger]: {\n        item: Item.dagger,\n        itemType,\n        weaponType: WeaponType.knife,\n        iconImg: `${basePath}dagger.png`,\n        rarity: Rarity.uncommon,\n        damage: { [DamageType.kinetic]: 8 },\n    },\n    [Item.flail]: {\n        item: Item.flail,\n        itemType,\n        weaponType: WeaponType.flail,\n        iconImg: `${basePath}flail.png`,\n        rarity: Rarity.uncommon,\n        damage: { [DamageType.kinetic]: 15 },\n    },\n    [Item.goldenShield]: {\n        item: Item.goldenShield,\n        itemType,\n        weaponType: WeaponType.shield,\n        rarity: Rarity.rare,\n        iconImg: `${basePath}golden-shield.png`,\n    },\n    [Item.greatswordOfGwai]: {\n        item: Item.greatswordOfGwai,\n        itemType,\n        weaponType: WeaponType.sword,\n        iconImg: `${basePath}greatsword-gwai.png`,\n        unique: true,\n        rarity: Rarity.legendary,\n        damage: { [DamageType.kinetic]: 25 },\n    },\n    [Item.indomitableCarapace]: {\n        item: Item.indomitableCarapace,\n        itemType,\n        weaponType: WeaponType.shield,\n        rarity: Rarity.epic,\n        unique: true,\n        iconImg: `${basePath}indomitable-carapace.png`,\n    },\n    [Item.javelin]: {\n        item: Item.javelin,\n        itemType,\n        weaponType: WeaponType.poleArm,\n        iconImg: `${basePath}javelin.png`,\n        rarity: Rarity.epic,\n        damage: { [DamageType.kinetic]: 25 },\n    },\n    [Item.khopesh]: {\n        item: Item.khopesh,\n        itemType,\n        weaponType: WeaponType.sword,\n        iconImg: `${basePath}khopesh.png`,\n        rarity: Rarity.epic,\n        damage: { [DamageType.kinetic]: 15 },\n    },\n    [Item.longbow]: {\n        item: Item.longbow,\n        itemType,\n        weaponType: WeaponType.bow,\n        iconImg: `${basePath}longbow.png`,\n        rarity: Rarity.rare,\n        damage: { [DamageType.kinetic]: 2 },\n    },\n    [Item.mace]: {\n        item: Item.mace,\n        itemType,\n        weaponType: WeaponType.club,\n        iconImg: `${basePath}mace.png`,\n        rarity: Rarity.rare,\n        damage: { [DamageType.kinetic]: 15 },\n    },\n    [Item.morningStar]: {\n        item: Item.morningStar,\n        itemType,\n        weaponType: WeaponType.club,\n        iconImg: `${basePath}morning-star.png`,\n        rarity: Rarity.uncommon,\n        damage: { [DamageType.kinetic]: 13 },\n    },\n    [Item.paintedBuckler]: {\n        item: Item.paintedBuckler,\n        itemType,\n        weaponType: WeaponType.shield,\n        iconImg: `${basePath}painted-buckler.png`,\n    },\n    [Item.poisonedDagger]: {\n        item: Item.poisonedDagger,\n        itemType,\n        weaponType: WeaponType.knife,\n        iconImg: `${basePath}poisoned-dagger.png`,\n        rarity: Rarity.epic,\n        damage: { [DamageType.kinetic]: 12 },\n    },\n    [Item.ravenStaff]: {\n        item: Item.ravenStaff,\n        itemType,\n        weaponType: WeaponType.staff,\n        iconImg: `${basePath}raven-staff.png`,\n        rarity: Rarity.epic,\n        damage: { [DamageType.kinetic]: 13 },\n    },\n    [Item.savageStaff]: {\n        item: Item.savageStaff,\n        itemType,\n        weaponType: WeaponType.staff,\n        iconImg: `${basePath}savage-staff.png`,\n        rarity: Rarity.epic,\n        damage: { [DamageType.kinetic]: 8 },\n    },\n    [Item.simpleCrossbow]: {\n        item: Item.simpleCrossbow,\n        itemType,\n        weaponType: WeaponType.crossbow,\n        iconImg: `${basePath}crossbow.png`,\n        rarity: Rarity.common,\n        damage: { [DamageType.kinetic]: 3 },\n    },\n    [Item.spear]: {\n        item: Item.spear,\n        itemType,\n        weaponType: WeaponType.poleArm,\n        iconImg: `${basePath}sword.png`,\n        rarity: Rarity.rare,\n        damage: { [DamageType.kinetic]: 10 },\n    },\n    [Item.steelShield]: {\n        item: Item.steelShield,\n        itemType,\n        weaponType: WeaponType.shield,\n        rarity: Rarity.rare,\n        iconImg: `${basePath}steel-shield.png`,\n    },\n    [Item.sword]: {\n        item: Item.sword,\n        itemType,\n        weaponType: WeaponType.sword,\n        iconImg: `${basePath}sword.png`,\n        rarity: Rarity.uncommon,\n        damage: { [DamageType.kinetic]: 14 },\n    },\n    [Item.warhammer]: {\n        item: Item.warhammer,\n        itemType,\n        weaponType: WeaponType.hammer,\n        iconImg: `${basePath}warhammer.png`,\n        rarity: Rarity.rare,\n        damage: { [DamageType.kinetic]: 16 },\n    },\n    [Item.woodenBulwark]: {\n        item: Item.woodenBulwark,\n        itemType,\n        weaponType: WeaponType.shield,\n        rarity: Rarity.common,\n        iconImg: `${basePath}wooden-bulwark.png`,\n    },\n};\nexport default weaponDefinitions;\n\nexport function getDefinition<T extends WeaponDefinition>(weapon: string): T {\n    return weaponDefinitions[weapon] as T;\n}\n","// Utilities for routing \n\nimport { Structure } from 'definitions/structures';\n\nexport const getWorldLink = () => `/world`;\nexport const getQuestLink = (questName: string) => `${getWorldLink()}/${questName}`;\n\nexport const getTownLink = () => `/town`;\nexport const getStructureLink = (structure: Structure) => `${getTownLink()}/${structure}`;\n","import { ResourceStoreState } from \"store/types/resources\";\nimport { CostStoreState } from \"../production/types\";\nimport { Item } from 'definitions/items/types';\n\nexport enum StructureType {\n    resource,\n    production,\n    tavern,\n    warehouse,\n}\n\nexport interface StructureDefinition {\n    type: StructureType;\n    cost: CostStoreState;\n    levels: StructureLevelDefinition[];\n}\n\nexport interface StructureLevelDefinition {\n    displayName: string;          // At this moment we can potentially support different names depending on the level\n                                  // of the structure. But this is not implemented because I feel it can cause confusion\n                                  // todo: REMOVE\n    cost: CostStoreState;         // in gold\n    workerCapacity: number;       // number of workers that can work at this structure at this level\n}\n\nexport interface ResourceStructureDefinition extends StructureDefinition {\n    levels: ResourceStructureLevelDefinition[];\n}\n\nexport interface ResourceStructureLevelDefinition extends StructureLevelDefinition {\n    generates: ResourceStoreState;\n}\n\nexport interface ProductionStructureDefinition extends StructureDefinition {\n    levels: ProductionStructureLevelDefinition[];\n}\n\nexport interface ProductionStructureLevelDefinition extends StructureLevelDefinition {\n    unlocks: Item[];\n}\n\nexport interface WarehouseStructureDefinition extends StructureDefinition {\n    levels: WarehouseStructureLevelDefinition[];\n}\n\nexport interface WarehouseStructureLevelDefinition extends StructureLevelDefinition {\n    maxResources: ResourceStoreState;\n    maxStockpile: number;\n}\n\n// tslint:disable-next-line:no-empty-interface\nexport interface TavernStructureDefinition extends StructureDefinition {\n    levels: TavernStructureLevelDefinition[];\n}\n\nexport interface TavernStructureLevelDefinition extends StructureLevelDefinition {\n    rooms: number;\n}\n","\n// Things that can be dragged\nexport const DragType = {\n    ADVENTURER: \"adventurer\",   // Adventurer avatar\n    ITEM: \"item\",               // A game 'item' (equipment, etc)\n};\n\n// Source, where it comes from\nexport enum DragSourceType {\n    adventurerInventory,\n    warehouse,\n    tavern,\n    adventurerEquipment,\n    lootCache\n}\n","import { EquipmentSlotType } from \"components/ui/adventurer/EquipmentSlot\";\nimport { Item } from \"definitions/items/types\";\nimport { Action } from \"redux\";\n\n// tslint:disable:object-literal-sort-keys\nexport enum ActionType {\n    moveItemInInventory = \"moveItemInInventory\",\n    moveItemToOtherAdventurer = \"moveItemToOtherAdventurer\",\n    moveItemFromWarehouseToAdventurer = \"moveItemFromWarehouseToAdventurer\",\n    addItemToInventory = \"addItemToInventory\",\n    removeItemFromInventory = \"removeItemFromInventory\",\n    assignEquipment = \"assignEquipment\",\n    removeEquipment = \"removeEquipment\",\n    renameAdventurer = \"renameAdventurer\",\n}\n\nexport interface AdventurerAction extends Action<ActionType> {\n    adventurerId: string;\n}\n\nexport interface InventoryAction extends AdventurerAction {\n    item: Item;\n    toSlot?: number;\n}\n\nexport interface MoveItemInInventoryAction extends AdventurerAction {\n    fromSlot: number;\n    toSlot: number;\n}\n\nexport interface RemoveItemFromInventoryAction extends AdventurerAction {\n    fromSlot: number;\n}\n\nexport interface MoveItemToOtherAdventurerAction extends AdventurerAction {\n    fromSlot: number;\n    toSlot?: number;\n    toAdventurerId: string;\n}\n\nexport interface AssignEquipmentAction extends AdventurerAction {\n    item: Item;\n    equipmentSlot: EquipmentSlotType;\n}\nexport interface RemoveEquipmentAction extends AdventurerAction {\n    equipmentSlot: EquipmentSlotType;\n}\n\nexport interface RenameAdventurerAction extends AdventurerAction {\n    name: string;\n}\n\nexport function moveItemInInventory(adventurerId: string, fromSlot: number, toSlot: number):\n    MoveItemInInventoryAction {\n    return {\n        type: ActionType.moveItemInInventory,\n        adventurerId,\n        fromSlot,\n        toSlot,\n    };\n}\n\n/**\n * Moves the an item from one adventurers' inventory to another\n * @param fromAdventurerId adventurer whose inventory to take the item from\n * @param fromSlot index of the inventory item\n * @param toAdventurerId player who to give the item to\n */\nexport function moveItemToOtherAdventurer(fromAdventurerId: string,\n                                          fromSlot: number,\n                                          toAdventurerId: string, toSlot?: number): MoveItemToOtherAdventurerAction {\n    return {\n        type: ActionType.moveItemToOtherAdventurer,\n        adventurerId: fromAdventurerId,\n        fromSlot,\n        toAdventurerId,\n        toSlot,\n    };\n}\n\n// If slot is not provided, will take the first empty slot\nexport function addItemToInventory(adventurerId: string, item: Item, toSlot?: number): InventoryAction {\n    return {\n        type: ActionType.addItemToInventory,\n        adventurerId,\n        item,\n        toSlot,\n    };\n}\n\nexport function removeItemFromInventory(adventurerId: string, fromSlot: number): RemoveItemFromInventoryAction {\n    return {\n        type: ActionType.removeItemFromInventory,\n        adventurerId,\n        fromSlot,\n    };\n}\n\nexport function assignEquipment(adventurerId: string, equipmentSlot: EquipmentSlotType, item: Item): AssignEquipmentAction {\n    return {\n        type: ActionType.assignEquipment,\n        adventurerId,\n        item,\n        equipmentSlot,\n    };\n}\n\nexport function removeEquipment(adventurerId: string, equipmentSlot: EquipmentSlotType): RemoveEquipmentAction {\n    return {\n        type: ActionType.removeEquipment,\n        adventurerId,\n        equipmentSlot,\n    };\n}\n\nexport function renameAdventurer(adventurerId: string, name: string): RenameAdventurerAction {\n    return {\n        type: ActionType.renameAdventurer,\n        adventurerId,\n        name,\n    };\n}\n","import { Item } from 'definitions/items/types';\n\n\nexport interface SceneStoreState {\n    objects: SceneObject[];\n    actors: ActorObject[];\n    actionQueue?: SceneAction[];\n    activeInteractionModal?: SceneInteractionModal;\n    combat: boolean;\n}\n\nexport interface SceneObject {\n    id: number;\n    name?: string;\n    type: string;\n    gid?: number;\n    location: [number, number];\n};\n\nexport type ActorObject = {\n    id: string;                   // todo: refactor to id\n    location: [number, number];     // current location in the scene\n    ap: number;                     // Remaining AP\n};\n\n // export type Actor = SceneObject & {\n//     type: \"actor\";\n//     //allegiance: Allegiance;\n//     health: number;\n//     //remainingAP: number;\n// }\n\nexport type SceneInteractionModal =\n| { type: 'lootCache', lootCache: string }\n| { type: 'situation', situation: string }\n\nexport interface LootCache {\n    title: string;\n    items: Item[];\n    gold?: number;\n}\n\nexport interface SceneAction {\n    actionType: SceneActionType;\n    actorId: string;\n    target: [number, number];\n    endsAt: number;\n}\n\nexport enum SceneActionType {\n    move = \"move\",\n    inspect = \"inspect\",\n    attack = \"attack\",\n    slash = \"slash\"\n}\n","import { FIVE_SECONDS } from 'utils/format/time';\nimport { Type } from 'components/ui/toasts/Toast';\nimport EventEmitter from './EventEmitter';\nimport { SoundManager, Sound } from './SoundManager';\n\nexport interface ToastConfig {\n    time: number;\n    title: string;\n    type?: Type;\n    icon?: string;\n    link?: string;\n}\n\nexport abstract class ToastManager extends EventEmitter<ToastConfig[]>() {\n\n    private static stack: ToastConfig[] = [];\n    private static lifeTime = FIVE_SECONDS; // Time each toast lives\n                                            // also update CSS animation!\n    static EVENT_TOASTS_UPDATED = \"toast\";\n\n    static addToast(title: string, type?: Type, icon?: string, link?: string) {\n\n        this.stack = [...this.stack, {\n            time: Date.now(),\n            title,\n            type,\n            icon,\n            link\n        }];\n\n        this.emit(this.EVENT_TOASTS_UPDATED, this.stack);\n\n        SoundManager.playSound(Sound.toast);\n\n        setTimeout(() => {\n            // Remove all popups that have expired\n            this.stack = this.stack.filter((toast) => {\n                return Date.now() - toast.time < this.lifeTime\n            });\n            this.emit(this.EVENT_TOASTS_UPDATED, this.stack);\n\n        }, this.lifeTime);\n    }\n}","import React from 'react';\nimport { TextManager } from 'global/TextManager';\nimport { ToastConfig } from 'global/ToastManager';\nimport { useHistory } from 'react-router';\nimport Icon from 'components/ui/common/Icon';\n\ntype Props = ToastConfig;\n\nexport enum Type {\n    achievementUnlocked,\n    cheat,\n    game,\n    itemCrafted,\n    questCompleted,\n    questEncounter,\n    questLaunched,\n    questUpdate,\n}\n\nconst Toast = (props: Props) => {\n    const {\n        title,\n        type = Type.achievementUnlocked,\n        icon = \"/img/items/quest-items/dragon-eye.png\",\n        link\n    } = props;\n    const history = useHistory();\n\n    const handleClick = () => {\n        if (link) {\n            history.push(link);\n        }\n    }\n\n    const typeText = TextManager.getToastType(type);\n    return (\n        <div className={`toast ${link ? \"withlink\" : \"\"}`} onClick={handleClick}>\n            <div className=\"label type\">{typeText}</div>\n            <div className=\"label title\">{title}</div>\n            <Icon size=\"big\" image={icon} className=\"toast-icon\" border=\"gold\" />\n            <div className=\"banner\"/>\n        </div>\n    );\n}\n\nexport default Toast;","import { Structure } from \"../structures\";\nimport { Item, ItemDefinition, ItemType } from \"./types\";\n\nconst itemType = ItemType.deed;\n\nexport interface DeedDefinition extends ItemDefinition {\n    structure: Structure;\n}\n\nexport const deedForLumbermill: DeedDefinition = {\n    item: Item.deedForLumbermill,\n    structure: Structure.lumberMill,\n    itemType,\n    iconImg: \"/img/items/deeds/deed.png\",\n};\n\nexport const deedForWeaponsmith: DeedDefinition = {\n    item: Item.deedForWeaponsmith,\n    structure: Structure.weaponsmith,\n    itemType,\n    iconImg: \"/img/items/deeds/deed.png\",\n};\n\nconst all = {\n    deedForLumbermill,\n    deedForWeaponsmith,\n};\n\n\nexport default all;","// tslint:disable:object-literal-sort-keys\n\nimport { Item, ItemType } from \"./types\";\n\nconst itemType = ItemType.material;\nconst basePath = \"/img/items/materials/\";\n\nexport default {\n    [Item.arrowheads]: {\n        item: Item.arrowheads,\n        itemType,\n        iconImg: `${basePath}arrowheads.png`,\n    },\n    [Item.bolts]: {\n        item: Item.bolts,\n        itemType,\n        iconImg: `${basePath}bolts.png`,\n    },\n    [Item.buckle]: {\n        item: Item.buckle,\n        itemType,\n        iconImg: `${basePath}buckle.png`,\n    },\n    [Item.chain]: {\n        item: Item.chain,\n        itemType,\n        iconImg: `${basePath}chain.png`,\n    },\n    [Item.cogs]: {\n        item: Item.cogs,\n        itemType,\n        iconImg: `${basePath}cogs.png`,\n    },\n    [Item.gem]: {\n        item: Item.gem,\n        itemType,\n        iconImg: `${basePath}gem.png`,\n    },\n    [Item.ingot]: {\n        item: Item.ingot,\n        itemType,\n        iconImg: `${basePath}ingot.png`,\n    },\n    [Item.nails]: {\n        item: Item.nails,\n        itemType,\n        iconImg: `${basePath}nails.png`,\n    },\n    [Item.poisonVial]: {\n        item: Item.poisonVial,\n        itemType,\n        iconImg: `${basePath}poison-vial.png`,\n    },\n    [Item.ribbon]: {\n        item: Item.ribbon,\n        itemType,\n        iconImg: `${basePath}ribbon.png`,\n    },\n    [Item.rope]: {\n        item: Item.rope,\n        itemType,\n        iconImg: `${basePath}rope.png`,\n    },\n    [Item.gem]: {\n        item: Item.gem,\n        itemType,\n        iconImg: `${basePath}gem.png`,\n    },\n    [Item.gunpowder]: {\n        item: Item.gunpowder,\n        itemType,\n        iconImg: `${basePath}gunpowder.png`,\n    },\n    [Item.scales]: {\n        item: Item.scales,\n        itemType,\n        iconImg: `${basePath}scales.png`,\n    },\n    [Item.spring]: {\n        item: Item.spring,\n        itemType,\n        iconImg: `${basePath}spring.png`,\n    },\n    [Item.thread]: {\n        item: Item.thread,\n        itemType,\n        iconImg: `${basePath}thread.png`,\n    },\n};\n","// tslint:disable:object-literal-sort-keys\n\nimport { Item, ItemDefinition, ItemType } from \"./types\";\n\nconst itemType = ItemType.questItem;\nconst basePath = \"/img/items/quest-items/\";\n\nconst questItemDefinitions: Record<string, ItemDefinition> = {\n    [Item.blueprints]: {\n        item: Item.blueprints,\n        itemType,\n        iconImg: `${basePath}blueprints.png`,\n    },\n    [Item.crate]: {\n        item: Item.crate,\n        itemType,\n        iconImg: `${basePath}crate.png`,\n    },\n    [Item.dynamite]: {\n        item: Item.dynamite,\n        itemType,\n        iconImg: `${basePath}dynamite.png`,\n    },\n    [Item.dragonEye]: {\n        item: Item.dragonEye,\n        itemType,\n        iconImg: `${basePath}dragon-eye.png`,\n    },\n    [Item.eye]: {\n        item: Item.eye,\n        itemType,\n        iconImg: `${basePath}eye.png`,\n    },\n    [Item.feather]: {\n        item: Item.feather,\n        itemType,\n        iconImg: `${basePath}feather.png`,\n    },\n    [Item.food]: {\n        item: Item.food,\n        itemType,\n        iconImg: `${basePath}food.png`,\n    },\n    [Item.heart]: {\n        item: Item.heart,\n        itemType,\n        iconImg: `${basePath}heart.png`,\n    },\n    [Item.horn]: {\n        item: Item.horn,\n        itemType,\n        iconImg: `${basePath}horn.png`,\n    },\n    [Item.key]: {\n        item: Item.key,\n        itemType,\n        iconImg: `${basePath}key.png`,\n    },\n    [Item.letters]: {\n        item: Item.letters,\n        itemType,\n        iconImg: `${basePath}letters.png`,\n    },\n    [Item.lockPicks]: {\n        item: Item.lockPicks,\n        itemType,\n        iconImg: `${basePath}lock-picks.png`,\n    },\n    [Item.oil]: {\n        item: Item.oil,\n        itemType,\n        iconImg: `${basePath}oil.png`,\n    },\n    [Item.orcFinger]: {\n        item: Item.orcFinger,\n        itemType,\n        iconImg: `${basePath}orc-finger.png`,\n    },\n    [Item.plans]: {\n        item: Item.plans,\n        itemType,\n        iconImg: `${basePath}plans.png`,\n    },\n    [Item.purpleGems]: {\n        item: Item.purpleGems,\n        itemType,\n        iconImg: `${basePath}purple-gems.png`,\n    },\n    [Item.runestone]: {\n        item: Item.runestone,\n        itemType,\n        iconImg: `${basePath}runestone.png`,\n    },\n    [Item.sandwich]: {\n        item: Item.sandwich,\n        itemType,\n        iconImg: `${basePath}sandwich.png`,\n    },\n    [Item.teeth]: {\n        item: Item.teeth,\n        itemType,\n        iconImg: `${basePath}teeth.png`,\n    },\n    [Item.tooth]: {\n        item: Item.tooth,\n        itemType,\n        iconImg: `${basePath}tooth.png`,\n    },\n    [Item.torch]: {\n        item: Item.torch,\n        itemType,\n        iconImg: `${basePath}torch.png`,\n    },\n    [Item.tusk]: {\n        item: Item.tusk,\n        itemType,\n        iconImg: `${basePath}tusk.png`,\n    },\n    [Item.vase]: {\n        item: Item.vase,\n        itemType,\n        iconImg: `${basePath}vase.png`,\n    },\n    [Item.vial]: {\n        item: Item.vial,\n        itemType,\n        iconImg: `${basePath}vial.png`,\n    },\n    [Item.weeds]: {\n        item: Item.weeds,\n        itemType,\n        iconImg: `${basePath}weeds.png`,\n    },\n};\n\nexport default questItemDefinitions;\n","// tslint:disable:object-literal-sort-keys\n\nimport { Item, ItemDefinition, ItemType } from \"./types\";\n\nconst itemType = ItemType.trinket;\nconst basePath = \"/img/items/trinkets/\";\n\nconst trinketDefinitions: Record<string, ItemDefinition> = {\n    [Item.magicAmulet]: {\n        item: Item.magicAmulet,\n        itemType,\n        iconImg: `${basePath}magic_amulet.png`,\n    },\n    [Item.ring]: {\n        item: Item.ring,\n        itemType,\n        iconImg: `${basePath}ring.png`,\n    },\n};\n\nexport default trinketDefinitions;\n","import apparel from \"./apparel\";\nimport deeds from \"./deeds\";\nimport materials from \"./materials\";\nimport questItems from \"./questItems\";\nimport trinkets from \"./trinkets\";\nimport { Item, ItemDefinition } from \"./types\";\nimport weapons from \"./weapons\";\n\nconst all = {\n    ...deeds,\n    ...apparel,\n    ...materials,\n    ...questItems,\n    ...trinkets,\n    ...weapons,\n};\n\nexport default all;\n\nexport function getDefinition(item: Item): ItemDefinition {\n    return all[item];\n}\n","import { TextEntry } from \"constants/text\";\n\nexport enum LogChannel {\n    common,         // Only visible in 'all'\n    town,           // Visible in 'all' and town\n    quest,          // Visible in 'all' and the appropriate quest tab\n}\n\nexport interface LogEntry extends TextEntry {\n    time: number;\n    channel: LogChannel;\n    channelContext?: string;\n}\n","import { QuestStoreState } from 'store/types/quest';\nimport { QuestDefinition, QuestNodeType } from '../types';\nimport { initialQuestVars, Kill10BoarsQuestVars } from './questVars';\n\n\nconst kill10Boars: QuestDefinition<Kill10BoarsQuestVars> = {\n    getQuestVars: (questStore: QuestStoreState) => questStore.questVars as Kill10BoarsQuestVars,\n    getInitialQuestVars: (questStore: QuestStoreState) => {\n        return initialQuestVars;\n    },\n    nodes: [{\n        x: 0,\n        y: 1,\n        type: QuestNodeType.nothing,\n        log: \"quest-kill10-boars-node0\",\n    }, {\n        x: 0,\n        y: 2,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 0,\n        y: 3,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 0,\n        y: 4,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 0,\n        y: 3,\n        type: QuestNodeType.encounter,\n        // log: \"quest-kill10-boars-enter-dungeon\",\n        startScene: \"dungeon.entrance\"\n    }, {\n        x: 1,\n        y: 3,\n        type: QuestNodeType.nothing,\n        log: \"quest-kill10-boars-leave-dungeon\",\n    }, {\n        x: 1,\n        y: 3,\n        type: QuestNodeType.nothing,\n        log: \"quest-kill10-boars-left-dungeon\"\n    }, {\n        x: 2,\n        y: 3,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 3,\n        y: 3,\n        type: QuestNodeType.encounter,\n        startScene: \"dungeon.hallway\"\n\n        //encounter: Encounter.backstabbed,\n    }, {\n        x: 4,\n        y: 4,\n        type: QuestNodeType.nothing,\n        log: \"The party spots a boss\",\n    }, {\n        x: 5,\n        y: 4,\n        type: QuestNodeType.nothing,\n    }],\n};\n\nexport default kill10Boars;","import kill10Boars from './kill10Boars';\r\nimport retrieveMagicAmulet from './retrieveMagicAmulet';\r\nimport { QuestDefinition } from './types';\r\n\r\n// tslint:disable:object-literal-sort-keys\r\n\r\n\r\n\r\n\r\n\r\n// const fulruhmRaid: QuestDefinition = {\r\n//     nodes: [{\r\n//         x: -4,\r\n//         y: -1,\r\n//         type: QuestNodeType.nothing,\r\n//     }, {\r\n//         x: -4,\r\n//         y: -1,\r\n//         type: QuestNodeType.nothing,\r\n\r\nconst all = {\r\n    kill10Boars,\r\n    retrieveMagicAmulet,\r\n};\r\n\r\nexport default all;\r\n\r\nexport function getDefinition<T>(questName: string): QuestDefinition<T> {\r\n    return all[questName];\r\n}\r\n","import { QuestStoreState } from 'store/types/quest';\nimport { Item } from 'definitions/items/types';\nimport { QuestDefinition, QuestNodeType } from '../types';\n\nexport interface RetrieveMagicAmuletQuestVars {\n    baz: boolean;\n    zux: number;\n}\n\nconst retrieveMagicAmulet: QuestDefinition<RetrieveMagicAmuletQuestVars> = {\n    getQuestVars: (questStore: QuestStoreState) => questStore.questVars as RetrieveMagicAmuletQuestVars,\n    getInitialQuestVars: (questStore: QuestStoreState) => {\n        const vars: RetrieveMagicAmuletQuestVars = {\n            baz: false,\n            zux: 13\n        }\n        return vars;\n    },\n    requiredItems: [\n        Item.torch,\n        Item.torch,\n        Item.torch,\n        Item.sandwich,\n        Item.sandwich,\n    ],\n    nodes: [{\n        x: 0,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 1,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 2,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 3,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 4,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 5,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 7,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 8,\n        y: 2,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 8,\n        y: 3,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 9,\n        y: 3,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 10,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 10,\n        y: 2,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 10,\n        y: 3,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 10,\n        y: 4,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 11,\n        y: 5,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 12,\n        y: 6,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 12,\n        y: 7,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 13,\n        y: 8,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 12,\n        y: 8,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 12,\n        y: 9,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 11,\n        y: 8,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 10,\n        y: 8,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 9,\n        y: 8,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 8,\n        y: 9,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 7,\n        y: 8,\n        type: QuestNodeType.encounter,\n        startScene: \"dungeon.hallway\"\n    }, {\n        x: 8,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 1,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 1,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 1,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 1,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 1,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 1,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 1,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 1,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 2,\n        y: 1,\n        type: QuestNodeType.encounter,\n        startScene: \"dungeon.hallway\"\n    }, {\n        x: 3,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }],\n};\n\nexport default retrieveMagicAmulet;","import { Action } from \"redux\";\nimport { LogChannel } from \"store/types/logEntry\";\nimport { TextEntry } from 'constants/text';\n\nexport enum ActionType {\n    addLogEntry = \"addLogEntry\",\n}\n\nexport interface AddLogEntryAction extends Action<ActionType> {\n    entry: TextEntry;\n    channel: LogChannel;\n    channelContext?: string;\n}\n\nexport function addLogText(key: string, context?: any, channel: LogChannel = LogChannel.common, channelContext?: string): AddLogEntryAction {\n    const entry: TextEntry = {\n        key,\n        context\n    };\n    return {\n        type: ActionType.addLogEntry,\n        entry,\n        channel,\n        channelContext,\n    };\n}\n\nexport function addLogEntry(entry: TextEntry, channel: LogChannel = LogChannel.common, channelContext?: string): AddLogEntryAction {\n    return {\n        type: ActionType.addLogEntry,\n        entry,\n        channel,\n        channelContext,\n    };\n}\n","import { StoreState } from \"store/types\";\nimport { AdventurerStoreState } from \"store/types/adventurer\";\nimport { QuestStoreState } from \"store/types/quest\";\n\n// export const adventurersInParty = (store: StoreState, partyId: string): AdventurerStoreState[] => {\n//     const party: PartyStoreState = store.parties[partyId];\n//     return party.adventurers.map((id: string) => findAdventurerById(store, id)!);\n// };\n\nexport const adventurersOnQuest = (adventurers: AdventurerStoreState[], quest: QuestStoreState): AdventurerStoreState[] => {\n    return quest.party.map((id: string) => findAdventurerById(adventurers, id)!);\n};\n\nexport const getQuestLeader = (adventurers: AdventurerStoreState[], quest: QuestStoreState): AdventurerStoreState | undefined => {\n    const leaderId = quest.party[0];\n    return findAdventurerById(adventurers, leaderId);\n}\n\nexport const findAdventurerById = (adventurers: AdventurerStoreState[], id: string): AdventurerStoreState | undefined => {\n    return adventurers.find((a) => a.id === id);\n};\n\n/**\n * Returns the amount of free inventory slots on this adventurer\n */\nexport const adventurerFreeInventorySlots = (adventurer: AdventurerStoreState): number => {\n    return adventurer.inventory.filter(i => i === null).length;\n};\n\nexport const storeIsRehydrated = (store: StoreState): boolean => {\n    // Returns a value indicating whether this store is fresh or rehydrated\n    return store?.engine.gameStarted !== undefined;\n};\n\n","import { TiledMapData, TiledObjectData, TiledLayerType, TiledProperty, TiledLayerData } from 'constants/tiledMapData';\n\n/* Tiled doesnt export the tile location of an Object. This function calculates it based on x and y.\n* Also returns a convenience object with all properties\n*/\nexport const getExtendedTilemapObjects = (tilemapData: TiledMapData) => {\n    const objectLayers = tilemapData.layers.filter(layer => layer.type === TiledLayerType.objectgroup);\n    const objects: { [key: string]: ExtendedTiledObjectData } = {};\n    objectLayers.forEach(objectLayer => {\n        objectLayer.objects.reduce((acc: {[location: string]: ExtendedTiledObjectData}, value: TiledObjectData) => {\n            let {x, y} = value;\n            if (value.gid !== undefined) {\n                y -= value.height; // https://github.com/bjorn/tiled/issues/91\n            }\n            const location: [number, number] = [\n                x / tilemapData.tilewidth,\n                y / tilemapData.tileheight\n            ];\n            // reduce the props array into an object with key/values\n            const ezProps = parseProperties(value.properties);\n            const extended: ExtendedTiledObjectData = {\n                location,\n                ezProps,\n                ...value\n            };\n            acc[`${location[0]},${location[1]}`] = extended; // todo: what if object alraedy exists at this location?\n            return acc;\n        }, objects);\n    });\n    return objects;\n}\n\n// Unpack array of properties into key/value object for fast retrieval\nconst parseProperties = (properties?: TiledProperty[]) => {\n    if (!properties) return;\n    return properties.reduce((acc: {[key: string]: any}, value: TiledProperty) => {\n        acc[value.name] = value.value;\n        return acc;\n    }, {});\n}\n\nexport type ExtendedTiledObjectData = TiledObjectData & {\n    location: [number, number];\n    ezProps?: { [key: string]: any}\n}\n\nexport enum TiledObjectType {\n    adventurerStart = \"adventurerStart\",\n    exit = \"exit\"\n}\n\n/** Add tiles in this layer to list */\nexport const addAllTilesInLayerToList = (list: [number, number][], layer: TiledLayerData, columns: number) => {\n    layer.data.reduce((acc: [number, number][], tile, index) => {\n        if (tile > 0) {\n            const x = (index % columns);\n            const y = Math.floor(index / columns);\n            acc.push([x, y]);\n        }\n        return acc;\n    }, list);\n}\n\nexport const locationEquals = (a: [number, number], b: [number, number]) => {\n    return a[0] === b[0] && a[1] === b[1];\n}","export const lerp = (n1: number,  n2: number,  alpha: number) =>  {\n    return n1 + alpha * (n2 - n1);\n}","import { LoaderResource } from 'pixi.js';\nimport { lerp } from './math';\n\ninterface Location {\n    x: number;\n    y: number;\n}\n\nexport const lerpLocation = (point1: Location, point2: Location, alpha: number): Location => {\n    const x = lerp(point1.x, point2.x, alpha);\n    const y = lerp(point1.y, point2.y, alpha);\n    return { x, y };\n}\n\n\n/**\n * Uses the shared pixi loader to load a resource\n */\nexport async function loadResourceAsync(path: string) {\n    const loader = PIXI.Loader.shared;\n    return new Promise<LoaderResource>((resolve, reject) => {\n        if (loader.resources[path]) {\n            resolve(loader.resources[path]);\n        }\n        else {\n            loader.add(path).load((_, resources) => {\n                resolve(resources[path]);\n            });\n        }\n    });\n}\n\nexport const loadResource = (path: string, callback: (resource: LoaderResource) => void) => {\n    const loader = PIXI.Loader.shared;\n    if (loader.resources[path]) {\n        callback(loader.resources[path]);\n        return;\n    }\n    loader.add(path).load((_, resources) => { callback(resources[path]!)});\n}","import { Action } from \"redux\";\n\n// tslint:disable:object-literal-sort-keys\nexport enum ActionType {\n    addGold = \"addGold\",\n}\n\nexport interface ModifyGoldAction extends Action<ActionType> {\n    amount: number;\n}\n\nexport function addGold(amount: number): ModifyGoldAction {\n    return {\n        type: ActionType.addGold,\n        amount,\n    };\n}\nexport function subtractGold(amount: number): ModifyGoldAction {\n    return {\n        type: ActionType.addGold,\n        amount: -amount,\n    };\n}\n","import { Store, AnyAction } from \"redux\";\nimport { StoreState } from 'store/types';\nimport { BaseSceneController } from 'mechanics/scenes/BaseSceneController';\n\nexport abstract class SceneControllerManager {\n    static store: { [key: string]: BaseSceneController<any> } = {};\n    static controllerTypes = {};\n\n    static registerSceneController(questName: string, sceneName: string, controllerType: typeof BaseSceneController) {\n        this.controllerTypes[`${questName}.${sceneName}`] = controllerType;\n    }\n\n    /**\n     * Gets the scenecontroller for scene. Creates it if it doesnt exist\n     */\n    static getSceneController<TQuestVars>(questName: string, sceneName: string, store: Store<StoreState, AnyAction>): BaseSceneController<TQuestVars> {\n        if (!this.store[`${questName}.${sceneName}`]) {\n            if (!this.controllerTypes[`${questName}.${sceneName}`]) {\n                throw new Error(`No controller registered for ${questName}.${sceneName}`);\n            }\n            this.store[`${questName}.${sceneName}`] = new this.controllerTypes[`${questName}.${sceneName}`](store, questName);\n        }\n        return this.store[`${questName}.${sceneName}`];\n    }\n\n    static destroySceneConroller(questName: string, sceneName: string, ) {\n        delete this.store[`${questName}.${sceneName}`];\n    }\n}\n\n// tslint:disable-next-line: no-var-requires\nrequire('definitions/quests/kill10Boars/encounters/dungeon');\n","// tslint:disable:object-literal-sort-keys\nimport { Item, ItemDefinition, ItemType } from \"./types\";\nimport { EquipmentSlotType } from 'components/ui/adventurer/EquipmentSlot';\n\nconst itemType = ItemType.apparel;\nconst basePath = \"/img/items/apparel/\";\n\n// export enum EquipmentSlotType {\n//     feet,\n//     hands,\n//     chest,\n//     legs,\n//     head,\n//     shoulders,\n// }\n\nexport interface ApparelDefinition extends ItemDefinition {\n    equipmentType: EquipmentSlotType;\n    damageReduction?: number;\n}\n\nconst all: Record<string, ApparelDefinition> = {\n    [Item.boots1]: {\n        item: Item.boots1,\n        equipmentType: EquipmentSlotType.feet,\n        itemType,\n        iconImg: `${basePath}boots_1.png`,\n    },\n    [Item.boots2]: {\n        item: Item.boots2,\n        equipmentType: EquipmentSlotType.feet,\n        itemType,\n        damageReduction: 1,\n        iconImg: `${basePath}boots_2.png`,\n    },\n    [Item.boots3]: {\n        item: Item.boots3,\n        equipmentType: EquipmentSlotType.feet,\n        itemType,\n        damageReduction: 2,\n        iconImg: `${basePath}boots_3.png`,\n    },\n    [Item.chainmailHood]: {\n        item: Item.chainmailHood,\n        equipmentType: EquipmentSlotType.head,\n        itemType,\n        iconImg: `${basePath}chainmail_hood.png`,\n        damageReduction: 3,\n    },\n    [Item.chest]: {\n        item: Item.chest,\n        equipmentType: EquipmentSlotType.chest,\n        itemType,\n        iconImg: `${basePath}chest_1.png`,\n        damageReduction: 2,\n    },\n    [Item.clothGloves]: {\n        item: Item.clothGloves,\n        equipmentType: EquipmentSlotType.hands,\n        itemType,\n        iconImg: `${basePath}cloth_gloves.png`,\n        damageReduction: 1\n    },\n    [Item.cowl]: {\n        item: Item.cowl,\n        equipmentType: EquipmentSlotType.head,\n        itemType,\n        iconImg: `${basePath}cowl.png`,\n        damageReduction: 2,\n    },\n    [Item.druidChest]: {\n        item: Item.druidHands,\n        equipmentType: EquipmentSlotType.chest,\n        itemType,\n        iconImg: `${basePath}druid-chest.png`,\n    },\n    [Item.druidFeet]: {\n        item: Item.druidFeet,\n        equipmentType: EquipmentSlotType.feet,\n        itemType,\n        iconImg: `${basePath}druid-feet.png`,\n    },\n    [Item.druidHands]: {\n        item: Item.druidHands,\n        equipmentType: EquipmentSlotType.hands,\n        itemType,\n        iconImg: `${basePath}druid-hands.png`,\n    },\n    [Item.druidHead]: {\n        item: Item.druidHead,\n        equipmentType: EquipmentSlotType.head,\n        itemType,\n        iconImg: `${basePath}druid-head.png`,\n    },\n    [Item.druidLegs]: {\n        item: Item.druidLegs,\n        equipmentType: EquipmentSlotType.legs,\n        itemType,\n        iconImg: `${basePath}druid-legs.png`,\n    },\n    [Item.fedora]: {\n        item: Item.fedora,\n        equipmentType: EquipmentSlotType.head,\n        itemType,\n        iconImg: `${basePath}fedora.png`,\n    },\n    [Item.greaves1]: {\n        item: Item.greaves1,\n        equipmentType: EquipmentSlotType.feet,\n        itemType,\n        iconImg: `${basePath}greaves_1.png`,\n        damageReduction: 2,\n    },\n    [Item.greaves2]: {\n        item: Item.greaves2,\n        equipmentType: EquipmentSlotType.hands,\n        itemType,\n        iconImg: `${basePath}greaves_2.png`,\n    },\n    [Item.hornedHelmet]: {\n        item: Item.hornedHelmet,\n        equipmentType: EquipmentSlotType.head,\n        itemType,\n        iconImg: `${basePath}horned_helmet.png`,\n    },\n    [Item.leatherGloves]: {\n        item: Item.leatherGloves,\n        equipmentType: EquipmentSlotType.hands,\n        itemType,\n        iconImg: `${basePath}leather_gloves.png`,\n    },\n    [Item.nomadHelmet]: {\n        item: Item.nomadHelmet,\n        equipmentType: EquipmentSlotType.head,\n        itemType,\n        iconImg: `${basePath}nomad_helmet.png`,\n    },\n    [Item.pants1]: {\n        item: Item.pants1,\n        equipmentType: EquipmentSlotType.legs,\n        itemType,\n        iconImg: `${basePath}pants_1.png`,\n        damageReduction: 3,\n    },\n    [Item.pants2]: {\n        item: Item.pants2,\n        equipmentType: EquipmentSlotType.legs,\n        itemType,\n        iconImg: `${basePath}pants_2.png`,\n        damageReduction: 3\n    },\n    [Item.plateChest1]: {\n        item: Item.plateChest1,\n        equipmentType: EquipmentSlotType.chest,\n        itemType,\n        iconImg: `${basePath}plate_chest_1.png`,\n    },\n    [Item.plateChest2]: {\n        item: Item.plateChest2,\n        equipmentType: EquipmentSlotType.chest,\n        itemType,\n        iconImg: `${basePath}plate_chest_2.png`,\n    },\n    [Item.plateChest3]: {\n        item: Item.plateChest3,\n        equipmentType: EquipmentSlotType.chest,\n        itemType,\n        iconImg: `${basePath}plate_chest_3.png`,\n    },\n    [Item.plateChest4]: {\n        item: Item.plateChest4,\n        equipmentType: EquipmentSlotType.chest,\n        itemType,\n        iconImg: `${basePath}plate_chest_4.png`,\n    },\n    [Item.plateGloves1]: {\n        item: Item.plateGloves1,\n        equipmentType: EquipmentSlotType.hands,\n        itemType,\n        iconImg: `${basePath}plate_gloves_1.png`,\n    },\n    [Item.plateGloves2]: {\n        item: Item.plateGloves2,\n        equipmentType: EquipmentSlotType.hands,\n        itemType,\n        iconImg: `${basePath}plate_gloves_2.png`,\n    },\n    [Item.plateHelmet]: {\n        item: Item.plateHelmet,\n        equipmentType: EquipmentSlotType.head,\n        itemType,\n        iconImg: `${basePath}plate_helmet_1.png`,\n    },\n    [Item.platePants]: {\n        item: Item.platePants,\n        equipmentType: EquipmentSlotType.legs,\n        itemType,\n        iconImg: `${basePath}plate_pants1.png`,\n    },\n    [Item.plateShoulders1]: {\n        item: Item.plateShoulders1,\n        equipmentType: EquipmentSlotType.shoulders,\n        itemType,\n        iconImg: `${basePath}plate_shoulders_1.png`,\n    },\n    [Item.plateShoulders2]: {\n        item: Item.plateShoulders2,\n        equipmentType: EquipmentSlotType.shoulders,\n        itemType,\n        iconImg: `${basePath}plate_shoulders_2.png`,\n    },\n    [Item.robe]: {\n        item: Item.robe,\n        equipmentType: EquipmentSlotType.chest,\n        itemType,\n        iconImg: `${basePath}robe_1.png`,\n    },\n    [Item.shoulders1]: {\n        item: Item.shoulders1,\n        equipmentType: EquipmentSlotType.shoulders,\n        itemType,\n        iconImg: `${basePath}shoulders_1.png`,\n    },\n    [Item.shoulders2]: {\n        item: Item.shoulders2,\n        equipmentType: EquipmentSlotType.shoulders,\n        itemType,\n        iconImg: `${basePath}shoulders_2.png`,\n        damageReduction: 2\n    },\n    [Item.shoulders3]: {\n        item: Item.shoulders3,\n        equipmentType: EquipmentSlotType.shoulders,\n        itemType,\n        iconImg: `${basePath}shoulders_3.png`,\n    },\n    [Item.vest]: {\n        item: Item.vest,\n        equipmentType: EquipmentSlotType.chest,\n        itemType,\n        iconImg: `${basePath}vest_1.png`,\n    },\n};\n\nexport default all;\n\nexport function getDefinition<T extends ApparelDefinition>(apparel: string): T {\n    return all[apparel] as T;\n}\n","function eventEmitter<TEventType>() {\n    abstract class EventEmitter {\n        static events = {};\n\n        static addEventListener (eventName: string, listener: (event: TEventType) => void) {\n            this.events[eventName] = this.events[eventName] || [];\n            this.events[eventName].push(listener);\n        }\n\n        static removeEventListener (eventName: string, listener: (event: TEventType) => void) {\n            if (this.events[eventName]) {\n                for (let i = 0; i < this.events[eventName].length; i++) {\n                    if (this.events[eventName][i] === listener) {\n                        this.events[eventName].splice(i, 1);\n                        break;\n                    }\n                };\n            }\n        }\n\n        protected static emit (eventName: string, event: TEventType | undefined) {\n            if (this.events[eventName]) {\n                this.events[eventName].forEach((fn: (event: TEventType | undefined) => any) => fn(event));\n            }\n        }\n    }\n    return EventEmitter;\n}\n\nexport default eventEmitter;","import { Item } from 'definitions/items/types';\nimport { LootCache } from 'store/types/scene';\n\nexport interface Kill10BoarsQuestVars {\n    dungeon: {\n        entered: boolean,\n        lootCaches: {\n            chest: LootCache,\n            altar: LootCache,\n        },\n        situations: {\n            altar: {\n                candleLit: boolean\n            }\n        }\n    }\n}\n\nexport const initialQuestVars: Kill10BoarsQuestVars = {\n    dungeon: {\n        entered: false,\n        lootCaches: {\n            chest: {\n                title: \"encounter-dungeon-caches-chest\",\n                items: [\n                    Item.nomadHelmet,\n                    Item.teeth,\n                    Item.poisonVial,\n                    Item.fedora,\n                ],\n                gold: 100\n            },\n            altar: {\n                title: \"quest-kill10-boars-dungeonentrance-altar\",\n                items: [\n                    Item.bolts,\n                    Item.letters\n                ]\n            }\n        },\n        situations: {\n            altar: {\n                candleLit: false\n            }\n        }\n    }\n}","export interface TiledMapData {\n    width: number;\n    height: number;\n    tilewidth: number;\n    tileheight: number;\n    infinite: boolean;\n    backgroundcolor: string | null;\n    orientation: Orientation;\n    renderorder: RenderOrder;\n    tilesets: TiledTilesetData[];\n    layers: TiledLayerData[];\n}\n\nexport interface TiledTilesetData {\n    columns: number;\n    firstgid: number;\n    source: string;\n    image: string;\n    imagewidth: number;\n    imageheight: number;\n    tilewidth: number;\n    tileheight: number;\n    tilecount: number;\n    name: string;\n    margin: number; // todo:\n    spacing: number; // todo\n    tiles?: TileData[];\n}\n\nexport interface TileData {\n    id: number,\n    image: string;\n    properties?: TiledProperty[];\n}\n\nexport interface TiledLayerData {\n    data: number[];\n    objects: TiledObjectData[];\n    type: TiledLayerType;\n    height: number;\n    id: number;\n    name: string;\n    opacity: number; // not supported atm\n    visible: boolean;\n    x: number;\n    y: number;\n    width: number;\n    properties?: TiledProperty[];\n}\n\nexport interface TiledObjectData {\n    gid?: number;\n    id: number;\n    name: string;\n    properties?: TiledProperty[];\n    polygon?: { x: number, y: number}[];\n    type: string;\n    visible: boolean;\n    width: number;\n    height: number;\n    x: number;\n    y: number;\n}\n\nexport enum TiledLayerType {\n    tilelayer = \"tilelayer\",\n    objectgroup = \"objectgroup\"\n}\n\nexport interface TiledProperty {\n    name: string,\n    type: string,\n    value: any\n}\n\nenum Orientation {\n    orthagonal = \"orthagonal\",\n    isometric = \"isometric\",\n    staggered = \"staggered\",\n    hexagonal = \"hexagonal\"\n}\n\nenum RenderOrder {\n    rightUp = \"right-up\",\n    rightDown = \"right-down\",\n    leftUp = \"left-up\",\n    leftDown = \"left-down\"\n}","// tslint:disable:object-literal-sort-keys\nimport { Action } from \"redux\";\nimport { CombatActionType } from \"store/types/combat\";\n\nexport enum ActionType {\n    clearCombatAction = \"clearCombatAction\",\n    startCombatAction = \"startCombatAction\",\n    moveActor = \"moveActor\",\n}\n\nexport interface AddCombatActionAction extends Action<ActionType> {\n    combatType: CombatActionType;\n    actor: string;\n    target: [number, number];\n    endsAt: number;\n}\n\nexport interface MoveActorAction extends Action<ActionType> {\n    actor: string;\n    location: [number, number];\n}\n\nexport function startCombatAction(type: CombatActionType, actor: string, target: [number, number], endsAt: number): AddCombatActionAction {\n    return {\n        type: ActionType.startCombatAction,\n        combatType: type,\n        actor,\n        target,\n        endsAt,\n    };\n}\n\nexport function moveActor(actor: string, location: [number, number]): MoveActorAction {\n    return {\n        type: ActionType.moveActor,\n        actor,\n        location,\n    };\n}\n\nexport function clearCombatAction(): Action<ActionType> {\n    // currently there is only one combat possible. so only one needs to be cleared\n    return {\n        type: ActionType.clearCombatAction,\n    };\n}\n","export interface CombatStoreState {\n    actors: Actor[];\n    turn: Allegiance;\n    action?: CombatAction;\n}\n\nexport interface Actor {\n    name: string;\n    allegiance: Allegiance;\n    location: number[];\n    health: number;\n    remainingAP: number;\n}\n\nexport enum Allegiance {\n    player,\n    enemy,\n}\n\nexport interface CombatAction {\n    type: CombatActionType;\n    actor: string;\n    target: [number, number];\n    endsAt: number;\n}\n\nexport enum CombatActionType {\n    move = \"move\",\n    slash = \"slash\",\n    shoot = \"shoot\",\n}\n\nexport const barBrawl: CombatStoreState = {\n    actors: [{\n        allegiance: Allegiance.player,\n        health: 100,\n        location: [3, 5],\n        name: \"c4a5d270\",\n        remainingAP: 5,\n    }, {\n        allegiance: Allegiance.player,\n        health: 100,\n        location: [4, 6],\n        name: \"2e655832\",\n        remainingAP: 4,\n    }],\n    turn: Allegiance.player,\n};\n","import { LogUpdate, QuestUpdate } from \"mechanics/gameTick/quests\";\r\nimport { Action } from \"redux\";\r\nimport { State as seedrandomStateType } from \"seedrandom\";\r\nimport { ResourceStoreState } from \"store/types/resources\";\r\n\r\nexport enum ActionType {\r\n    gameTick = \"gameTick\",\r\n    startGame = \"startGame\"\r\n}\r\nexport interface GameTickAction extends Action<ActionType> {\r\n    delta: number;\r\n    rngState: seedrandomStateType | null;\r\n    resources: ResourceStoreState | null;\r\n    quests: QuestUpdate[];\r\n    log: LogUpdate[];\r\n}\r\n\r\nexport function startGame(): Action {\r\n    return {\r\n        type: ActionType.startGame,\r\n    };\r\n}\r\n\r\nexport function gameTick(delta: number,\r\n    rngState: seedrandomStateType | null,\r\n    resources: ResourceStoreState | null,\r\n    quests: QuestUpdate[],\r\n    log: LogUpdate[],\r\n): GameTickAction {\r\n    return {\r\n        type: ActionType.gameTick,\r\n        delta,\r\n        rngState,\r\n        resources,\r\n        quests,\r\n        log,\r\n    };\r\n}\r\n","import { clearCombatAction, moveActor } from \"store/actions/combat\";\nimport { Store } from \"redux\";\nimport { StoreState } from \"store/types\";\nimport { Allegiance, CombatAction, CombatActionType } from \"store/types/combat\";\n\n// tslint:disable-next-line: no-empty-interface\nexport interface CombatUpdate  {\n    // todo: maybe this is not needed\n    action: CombatAction | null;\n}\n\nconst updateCombat = (delta: number, store: Store<StoreState>): CombatUpdate | null => {\n    const state = store.getState();\n    const combat = state.combat;\n    if (combat.action) {\n        const action = combat.action;\n        if (action.endsAt < Date.now()) {\n            if (combat.turn === Allegiance.enemy) {\n                /* if (apLeft(enemy))\n                determine next action\n                else\n                players turn now\n                */\n            } else if (combat.turn === Allegiance.player) {\n                switch (combat.action.type) {\n                    case CombatActionType.move:\n                        store.dispatch(moveActor(combat.action.actor, combat.action.target));\n                        store.dispatch(clearCombatAction());\n                        break;\n                    default:\n                        break;\n                }\n                return {\n                    action: null,\n                };\n            }\n        }\n    }\n    return null;\n};\n\nexport default updateCombat;\n","import { Howl } from \"howler\";\r\nimport * as React from \"react\";\r\nimport Indicator from \"./Indicator\";\r\nimport { useState, useEffect, PropsWithChildren } from 'react';\r\n\r\n// https://medium.com/@jchiam/publishing-a-typescript-react-component-to-npm-d3cc15b8d0a2\r\nexport type Props = PropsWithChildren<{\r\n    manifest: string[];\r\n    onLoadComplete?: (mediaItems: MediaItem[]) => void;\r\n}>\r\n\r\nexport enum MediaType {\r\n    image,\r\n    sound,\r\n}\r\n\r\nexport interface MediaItem {\r\n    url: string;\r\n    mediaType: MediaType;\r\n    content?: HTMLImageElement | Howl;\r\n    sound?: Howl;\r\n}\r\n\r\nconst Preloader = (props: Props) => {\r\n\r\n    const [completed, setCompleted] = useState(false);\r\n    const [itemsLoaded, setItemsLoaded] = useState(0);\r\n\r\n    useEffect(() => {\r\n        loadMedia();\r\n    }, []);\r\n\r\n    const { children, manifest } = props;\r\n\r\n    const loadMedia = () => {\r\n        // todo: what if props get set at runtime\r\n        setItemsLoaded(0);\r\n\r\n        const promises = props.manifest\r\n            .map((url) => loadItem(url)\r\n            // tslint:disable-next-line:no-console\r\n            .catch((err) => console.error(err)));\r\n\r\n        Promise.all(promises).then((results) => {\r\n            if (props.onLoadComplete) {\r\n                props.onLoadComplete(media);\r\n            }\r\n            setCompleted(true);\r\n        });\r\n    }\r\n\r\n    const loadItem = async (url: string): Promise<MediaItem> => {\r\n        if (media.some((m) => m.url === url)) {\r\n            // tslint:disable-next-line:no-console\r\n            console.warn(`Loading media with url ${url} more than once! Will overwrite.`);\r\n        }\r\n        const mediaType = getType(url);\r\n        let item;\r\n        if (mediaType === MediaType.image) {\r\n            const value = await loadImage(url);\r\n            item = {\r\n                content: value,\r\n                mediaType,\r\n                url,\r\n            } ;\r\n        }\r\n        if (mediaType === MediaType.sound) {\r\n            const value = new Howl({\r\n                src: [ `${process.env.PUBLIC_URL}/${url}` ],\r\n            });\r\n            item = {\r\n                content: value,\r\n                mediaType,\r\n                url,\r\n            };\r\n        }\r\n        if (item) {\r\n            media.push(item);\r\n            setItemsLoaded(itemsLoaded + 1);\r\n            return item;\r\n        } else {\r\n            throw new Error(`Unknown error while trying to load ${url}`);\r\n        }\r\n    }\r\n    if (!completed) {\r\n        return (\r\n            <Indicator\r\n                itemsLoaded = { itemsLoaded }\r\n                itemsTotal = { manifest.length }\r\n            />\r\n        );\r\n    }\r\n    return <> {children} </>;\r\n}\r\n\r\nconst media: MediaItem[] = [];\r\n\r\nconst loadImage = (url: string): Promise<HTMLImageElement> => {\r\n    const image = new Image();\r\n    image.src = url;\r\n\r\n    return new Promise((resolve, reject) => {\r\n        if (image.naturalWidth) {\r\n            resolve(image);\r\n        } else if (image.complete) {\r\n            reject(null);\r\n        } else {\r\n            image.addEventListener(\"load\", check);\r\n            image.addEventListener(\"error\", check);\r\n        }\r\n        function check() {\r\n            if (image.naturalWidth) {\r\n                resolve(image);\r\n            } else {\r\n                reject(null);\r\n            }\r\n            image.removeEventListener(\"load\", check);\r\n            image.removeEventListener(\"error\", check);\r\n        }\r\n    });\r\n};\r\n\r\nconst getType = (url: string): MediaType => {\r\n    url = url.toLowerCase();\r\n    if (url.endsWith(\"png\") || url.endsWith(\"jpg\") || url.endsWith(\"gif\")) {\r\n        return MediaType.image;\r\n    }\r\n    if (url.endsWith(\"mp3\") || url.endsWith(\"ogg\") || url.endsWith(\"wav\")) {\r\n        return MediaType.sound;\r\n    }\r\n    throw Error(`Could not determine type for ${url}`);\r\n};\r\n\r\nexport default Preloader;","import { convertSemVerToInt } from \"utils/version\";\n\n// <MAJOR>.<MINOR>.<RELEASE>\n\nconst version = \"0.0.5\";\n\nexport default version;\nexport const asInt: number = convertSemVerToInt(version);\n","// tslint:disable:no-bitwise\n\n/**\n * Convert a sematic versioning string into an 32-bit integer.\n *\n * Make sure the input string is compatible with the standard found\n * at semver.org. Since this only uses 10-bit per major/minor/patch version,\n * the highest possible SemVer string would be 1023.1023.1023.\n * @param  {string} semVer SemVer string\n * @return {number}         Numeric version\n */\nexport const convertSemVerToInt = (semVer: string): number => {\n    // Split a given version string into three parts.\n    const parts = semVer.split(\".\").map((part) => Number(part));\n    // Check if we got exactly three parts, otherwise throw an error.\n    if (parts.length !== 3) {\n        throw new Error(`Received invalid version string: ${semVer}`);\n    }\n    // Make sure that no part is larger than 1023 or else it\n    // won't fit into a 32-bit integer.\n    parts.forEach((part: number) => {\n        if (part >= 1024) {\n            throw new Error(`Version string invalid, ${part} is too large`);\n        }\n    });\n    let numericVersion = 0;\n    // Shift all parts either 0, 10 or 20 bits to the left.\n    for (let i = 0; i < 3; i++) {\n        numericVersion |= parts[i] << i * 10;\n    }\n    return numericVersion;\n};\n\n/**\n * Converts a 32-bit integer into a semantic versioning (SemVer) compatible string.\n * @param  {number} version Numeric version\n * @return {string}   SemVer string\n */\nexport const convertIntToSemVer = (version: number) => {\n    // Works by shifting the numeric version to the right and then masking it\n    // with 0b1111111111 (or 1023 in decimal).\n    // eslint-disable-next-line no-mixed-operators\n    return `${version & 1023}.${version >> 10 & 1023}.${version >> 20 & 1023}`;\n};\n","import * as React from \"react\";\r\n\r\nexport interface Props {\r\n    itemsLoaded?: number;\r\n    itemsTotal?: number;\r\n}\r\n\r\n/**\r\n * Loading indicator\r\n */\r\nconst Indicator = (props: Props) =>  {\r\n    const { itemsLoaded, itemsTotal } = props;\r\n    return <div> { `Loading (${Math.floor((itemsLoaded || 0) / (itemsTotal || 0 ) * 100)})%`} </div>;\r\n}\r\n\r\nexport default Indicator;\r\n","import { Item } from 'definitions/items/types';\n\nexport enum StructureState {\n    NotBuilt,\n    Building,\n    Built,\n}\n\nexport interface StructureStoreState {\n    level: number;\n    workers: number;\n    state: StructureState;\n}\n\nexport const initialState: StructureStoreState = {\n    level: 0,\n    state: StructureState.NotBuilt,\n    workers: 0,\n};\n\nexport interface ProductionStructureStoreState extends StructureStoreState {\n    produces: Item[];\n}\n","import * as React from \"react\";\nimport { PropsWithChildren } from 'react';\nimport './styles/button.scss';\n\nexport enum ButtonSize {\n    auto, // will select either medium or small, depending on screen size\n    large,\n    medium,\n    small,\n}\n\nexport enum ButtonColor {\n    blue = \"blue\",\n    purple = \"purple\",\n    green = \"green\"\n}\n\nexport type Props = PropsWithChildren<{\n    text?: string;\n    color?: ButtonColor | keyof typeof ButtonColor; // Can use enum or string\n    size?: ButtonSize | keyof typeof ButtonSize; // Can use enum or string\n    className?: string;\n    disabled?: boolean;\n    square?: boolean;\n    onClick?: React.MouseEventHandler<Element>;\n}>\n\n\nconst Button = (props: React.ComponentProps<'button'> & Props) => {\n    const { color, size, square, text, ...otherProps } = props;\n\n    const handleClick = (e: React.MouseEvent<HTMLButtonElement>) => {\n        props.onClick?.(e)\n    };\n\n    const className = `button\n        ${props.className || \"\"}\n        button-${typeof color === \"string\" ? color : ButtonColor[color ?? ButtonColor.blue]}\n        button-${typeof props.size === \"string\" ? props.size : ButtonSize[props.size ?? ButtonSize.auto]}\n        ${square ? \"button-square\" : \"\"}\n    `.replace(/\\n\\s*/g, \" \");\n\n    return (\n        <button\n            {...otherProps}\n            className={className}\n            onClick={handleClick}\n        >\n            <span>\n                {!!text && text}\n                {!text && props.children}\n            </span>\n        </button>\n    );\n};\n\nexport default Button;\n","import * as PIXI from 'pixi.js';\n// Adapted from https://github.com/explooosion/hitarea-shapes/blob/master/src/index.js\n\nexport default class HitAreaShapes {\n    public shapes: PIXI.Polygon[];\n\n    constructor(shapes = {}, sprite: string = \"0\") {\n      this.shapes = shapes[sprite].map((definition: { shape: number[]; }) => {\n          const shape: number[] = definition.shape;\n          return new PIXI.Polygon(shape);\n      });\n    }\n\n    /**\n     * Called by hitArea\n     * @param {number} x\n     * @param {number} y\n     */\n    contains(x = 0, y = 0) {\n      return (!this.shapes || this.shapes.length === 0)\n        ? false\n        : this.shapes.some(shape => shape.contains(x, y));\n    }\n  }","import React, { useState, useEffect } from 'react';\nimport { Structure } from 'definitions/structures';\nimport { Sprite, useApp, useTick } from '@inlet/react-pixi';\nimport HitAreaShapes from 'utils/hitAreaShapes';\nimport * as PIXI from 'pixi.js';\nimport { ITextureDictionary } from 'pixi.js';\nimport { STRUCTURE_HIGHLIGHT_FILTER } from 'components/town/TownView';\nimport { loadResource } from 'utils/pixiJs';\n\nconst BLADE_ROTATION_SPEED = 0.01;\n\nexport interface Props {\n    onStructureClick: (structure: Structure | null) => void;\n    position: PIXI.Point;\n    selected?: boolean;\n    hitAreaShapes: HitAreaShapes;\n}\n\nconst LumberMill = (props: Props) => {\n    const {hitAreaShapes} = props;\n    const structure = Structure.lumberMill;\n    const atlas = `${process.env.PUBLIC_URL}/img/town/town-alpha/${structure}.json`;\n    const [textures, setTextures] = useState<ITextureDictionary>();\n    const filters = props.selected ? [STRUCTURE_HIGHLIGHT_FILTER] : [];\n\n    const app = useApp();\n\n    useEffect(() => {\n        loadResource(atlas, (resource) => {\n            setTextures(resource.textures);\n        })\n    }, [app, app.loader, atlas]);\n\n    const [rotation, setRotation] = useState(0);\n    useTick((delta:number | undefined) => setRotation(r => r + (BLADE_ROTATION_SPEED * delta!)));\n\n\n    if (!textures) return null;\n    return (\n        <Sprite\n            name={structure}\n            position={props.position}\n            interactive={true}\n            buttonMode={true}\n            pointertap={() => {\n                props.onStructureClick(structure);\n            }}\n            hitArea={hitAreaShapes}\n            filters={filters}\n            texture={textures[\"structure.png\"]}\n        >\n            <Sprite\n                name=\"blades\"\n                texture={textures[\"blades.png\"]}\n                anchor={new PIXI.Point(0.5, 0.5)}\n                x={15}\n                y={10}\n                rotation={rotation}\n            />\n        </Sprite>\n    )\n}\n\nexport default LumberMill;","import { PixiComponent, applyDefaultProps, Container } from \"@inlet/react-pixi\";\nimport * as PIXI  from 'pixi.js';\nimport * as particles from 'pixi-particles';\n\ninterface Props  {\n    image: string;\n    config: particles.OldEmitterConfig | particles.EmitterConfig;\n};\n\nconst ParticleEmitter = PixiComponent<Props & React.ComponentProps<typeof Container>, PIXI.ParticleContainer>(\"ParticleEmitter\", {\n    create() {\n      return new PIXI.ParticleContainer();\n    },\n\n    applyProps(instance, oldProps: Props, newProps: Props) {\n      const { image, config, ...newP } = newProps;\n\n      // apply rest props to PIXI.ParticleContainer\n      applyDefaultProps(instance, oldProps, newP);\n\n      let emitter = (this as any)._emitter;\n      if (!emitter) {\n        emitter = new particles.Emitter(\n          instance,\n          [PIXI.Texture.from(image)],\n          config\n        );\n\n        let elapsed = performance.now();\n\n        const tick = () => {\n          emitter.raf = requestAnimationFrame(tick);\n          const now = performance.now();\n          // const amp = Math.random() * 5 + 15;\n          // const amp = 15;\n          // const freq = 0.0015;\n          // emitter.acceleration.x = (Math.sin((elapsed * freq)) * amp) + 15;\n\n          emitter.update((now - elapsed) * 0.0003);\n\n          elapsed = now;\n        };\n        emitter.emit = true;\n        // emitter.update(00.2);\n\n        tick();\n      }\n      (this as any)._emitter = emitter;\n    },\n\n    willUnmount() {\n      if ((this as any)._emitter) {\n        (this as any)._emitter.emit = false;\n        cancelAnimationFrame((this as any)._emitter.raf);\n      }\n    }\n});\n\nexport default ParticleEmitter;","import React from \"react\";\nimport { Sprite, Container } from '@inlet/react-pixi';\nimport { Structure } from 'definitions/structures';\nimport HitAreaShapes from 'utils/hitAreaShapes';\nimport smoke from './smoke.json';\nimport ParticleEmitter from 'components/pixi/ParticleEmitter';\nimport { STRUCTURE_HIGHLIGHT_FILTER } from 'components/town/TownView';\n\nexport interface Props {\n    onStructureClick: (structure: Structure | null) => void;\n    position: PIXI.Point;\n    selected?: boolean;\n    hitAreaShapes: HitAreaShapes;\n}\n\nconst Tavern = (props: Props) => {\n    const {hitAreaShapes, position} = props;\n    const structure = Structure.tavern;\n    const filters = props.selected ? [STRUCTURE_HIGHLIGHT_FILTER] : [];\n\n    return (\n        <Container position={position}>\n            <Sprite\n                name={structure}\n                interactive={true}\n                buttonMode={true}\n                pointertap={() => {\n                    props.onStructureClick(structure);\n                }}\n                filters={filters}\n                hitArea={hitAreaShapes}\n                image={`${process.env.PUBLIC_URL}/img/town/town-alpha/${structure}.png`}\n            />\n            <ParticleEmitter\n                name=\"smoke\"\n                x={107}\n                y={-2}\n                image={`${process.env.PUBLIC_URL}/img/town/effects/smokeparticle.png`}\n                config={smoke}\n            />\n        </Container>\n    )\n}\nexport default Tavern;","import { AppContext } from \"components/App\";\nimport { MediaItem } from \"components/preloading/Preloader\";\nimport * as React from \"react\";\nimport { Component, ComponentType } from 'react';\n\n// Sharing context within the entire App\nexport interface AppContextProps {\n    onOpenWindow: (window: React.ReactElement) => void;\n    onCloseWindow: () => void;\n    media: MediaItem[] | null;\n}\n\nexport const withAppContext = <TWrappedComponentProps extends AppContextProps>(WrappedComponent: ComponentType<TWrappedComponentProps>) => {\n    type WrappedComponentPropsExceptProvided = Exclude<keyof TWrappedComponentProps, keyof AppContextProps>;\n    type ForwardedProps = Pick<TWrappedComponentProps, WrappedComponentPropsExceptProvided>;\n    return class WithContext extends Component<ForwardedProps> {\n        public render() {\n            return (\n                <AppContext.Consumer>\n                    {(context: any) => <WrappedComponent {...this.props } {...context} />}\n                </AppContext.Consumer>\n            );\n        }\n    };\n};\n","import React from 'react';\nimport { Structure } from 'definitions/structures';\nimport { Sprite } from '@inlet/react-pixi';\nimport HitAreaShapes from 'utils/hitAreaShapes';\nimport { STRUCTURE_HIGHLIGHT_FILTER } from 'components/town/TownView';\n\nexport interface Props {\n    onStructureClick: (structure: Structure | null) => void;\n    position: PIXI.Point;\n    selected?: boolean;\n    structure: Structure;\n    hitAreaShapes: HitAreaShapes;\n}\n\nconst Generic = (props: Props) => {\n    const {structure, position, hitAreaShapes, selected, onStructureClick} = props;\n    const filters = selected ? [STRUCTURE_HIGHLIGHT_FILTER] : [];\n\n    const handlePointerTap = () => {\n        onStructureClick(structure);\n    };\n\n    return (\n        <Sprite\n            name={structure}\n            position={position}\n            interactive={true}\n            buttonMode={true}\n            pointertap={handlePointerTap}\n            hitArea={hitAreaShapes}\n            filters={filters}\n            image={`${process.env.PUBLIC_URL}/img/town/town-alpha/${structure}.png`}\n        >\n            {/* <Graphics\n                name=\"hitarea\"\n                draw={graphics => {\n                    graphics.beginFill(0xffffff);\n                    hitAreaShapes.shapes.map(shape => graphics.drawPolygon(shape))\n                    graphics.endFill();\n                }}\n            /> */}\n        </Sprite>\n    );\n}\nexport default Generic;","import React from \"react\";\nimport { StructuresStoreState } from 'store/types/structures';\nimport { Structure } from 'definitions/structures';\nimport { StructureStoreState, StructureState } from 'store/types/structure';\nimport { Link } from 'react-router-dom';\nimport { getStructureLink, getTownLink } from 'utils/routing';\nimport { TextManager } from 'global/TextManager';\nimport { useRouteMatch } from 'react-router';\nimport \"./styles/legenda.scss\";\n\ninterface Props {\n    structures: StructuresStoreState;\n}\n\n// Legenda with clickable names of structures\nconst Legenda = (props: Props) => {\n    const {structures} = props;\n    const orderedStructures = [\n        Structure.workshop,\n        Structure.quarry,\n        Structure.tavern,\n        Structure.tannery,\n        Structure.alchemist,\n        Structure.garden,\n        Structure.weaponsmith,\n        Structure.armoursmith,\n        Structure.warehouse,\n        Structure.mine,\n        Structure.lumberMill,\n        Structure.weaver,\n    ];\n    const match = useRouteMatch<{structure: string}>(`${getTownLink()}/:structure`);\n\n    const renderText = (structure: Structure) => {\n        if (match?.params.structure === structure.toString()) {\n            return (\n                <span className=\"highlighted\">{`${TextManager.getStructureName(structure)}`}</span>\n            )\n        }\n        return (\n            <Link to={getStructureLink(structure)} >\n                {`${TextManager.getStructureName(structure)}`}\n            </Link>\n        )\n    }\n\n    return (\n        <div className=\"legenda\">\n            <ul>\n            {orderedStructures.map((structure) => {\n                const structureStore: StructureStoreState = structures[structure];\n                if (structureStore.state === StructureState.NotBuilt) {\n                    return null;\n                }\n                return (\n                    <li key={structure}>\n                        {renderText(structure)}\n                    </li>\n                );\n            })}\n            </ul>\n        </div>\n    );\n}\n\nexport default Legenda;","import React, { forwardRef } from \"react\";\nimport { Viewport as PixiViewport, ClickEventData } from \"pixi-viewport\";\nimport { PixiComponent, useApp } from \"@inlet/react-pixi\";\nimport gauntlet from \"components/App/styles/img/cursors/dwarven_gauntlet_extra_6.png\";\n\ninterface Props {\n  onClick?(event: ClickEventData): void;\n  screenWidth: number,\n  screenHeight: number,\n  worldWidth: number,\n  worldHeight: number,\n  minScale?: number;\n  maxScale?: number;\n}\n\n/** Viewport leverages pixi-viewport to create a pannable map\n * https://davidfig.github.io/pixi-viewport/jsdoc/\n */\nconst Viewport = forwardRef<PixiViewport, any>((props, ref) => {\n  const app = useApp();\n  if (app) {\n      // Perhaps this is better moved somewhere else\n      const cursor = `url('${gauntlet}'), auto`;\n      app.renderer.plugins.interaction.cursorStyles.pointer = cursor;\n  }\n  return <PixiComponentViewport app={app} {...props} ref={ref} />;\n})\n\ninterface PixiComponentProps {\n    app: PIXI.Application;\n}\n\nconst PixiComponentViewport = PixiComponent(\"Viewport\", {\n  create: (props: PixiComponentProps & Props) => {\n    const viewport = new PixiViewport({\n      screenWidth: props.screenWidth,\n      screenHeight: props.screenHeight,\n      worldWidth: props.worldWidth,\n      worldHeight: props.worldHeight,\n      ticker: props.app.ticker,\n      interaction: props.app.renderer.plugins.interaction,\n      // the interaction module is important for wheel to work properly when renderer.view is placed or scaled\n    });\n    viewport.on(\"clicked\", (event) => { if(props.onClick) props.onClick(event) });\n\n    const {\n      minScale = 1,\n      maxScale = 2\n    } = props;\n\n    viewport\n      .drag()\n      .pinch()\n      .wheel()\n      .clamp({ direction: 'all' })\n      .clampZoom({ minScale, maxScale })\n      .decelerate();\n\n    return viewport;\n  }\n});\nexport default Viewport;\n","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAgCAYAAAABtRhCAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAB3RJTUUH3gMODzc3YHmYGgAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAE50lEQVRIx7WXW0wcVRjHfzO7y16YZbfAytACvbjU1hqkLVZMbbSXBEPUNjX6YDYanwYfTXzxrb7qm0lTJ018QhOjaWI0trFYbRoqpYVuwy2UpRS2lAF22YUdtuxt1ofKCIXShaZfMjm37+Q33zn/cxMURWHRVFXNAyiKIvCMTFwKO6Ne4ONPTpngZwoE6Lx6FYCDhwLPDLoMeKPtV8b6ewkEAssiVVU1v/gtLS+dhnUDFUUResZvUhLXuNF+ZVmkBw8F6B+4b5avXR8x82fUC+uCWhoaGsxCV1fXKZelGOvMNPcXspw9+zV60s3MzAweTwXJZBLJXYXPt8XMJ5NJbgX/pqGh4ctCgNalBUVRhId/u5tsQqf9UpDGxkZCoRCtra2mX2trK5qmAZhpoWZdrTIvCOyQihn8/RydsQSVm6uQJAnZ6zV9MjYbkUgEAL/fj6p+my9kOYmPViiKIgQn+8mLIv1jowSONtN0+OgyGEAkEkHXdTRNQ5Kkjal0qY3MJciLIsdOvslYXy9xbXxZu67rAEiSZOafCtgzfpM8Al2/deDEwJZOrYAu2lNFqKpq/rPjLTTtbWY0Psu1jovUVm7Hmk1jS6eYmXooEiH//0pYj3BWFc2RukM4HpxHMAz6x0aRvT1scfsYT0yTTwnEtXEsuQzxhbQ5j08F/O7H0+zz+ThQWsK52yGuBNs5XPcqllwOVzrOjv2HsZaXsuv1OtySnYSeort7kE+Vt56o1FWBo7EollwGQ7Sww13McHyWbE8n9VVVNLzWzMDkXSYGujl/uY1wNIamaciybO4+a0FXXRbd04P8PHydu/EYtmwaSy7NaCzOi0eO09F5kfk7/bhSSZ4T8zQ2NiLLMgCyLPPe+5+vudWtqlJFUYRF8MhsHNHIcXKnn86rfxK8P4Etk8G5kKR4YZ758F1OnDixrP9aUHGt8V6ExlMLbLP7GBoeAkGkxuWhKJfFlUoiJRNE7o0TCARM8UiS9NgjTnySqhRFEUZmR/jm5l9YsynGolG0RJQqpwd7OoU0P0dqZJD0TJyWlhZzU/D7/Txfe2wFVCxUzttLPNyaGEc0svx0+zZVW/cD4Eo/wJuIkevtwZiKLhteWZZXQAsGdk9PscluRzByODxlnL78Aw17mpDdZdizGUr0GNEbndRvKeeD5rcpLy83oRWVjeuLUFEUYTQ+jMfpwutw4CgpJVmzm6/++QVDtFDpLkU0DLxzUabbB6ir9vHGtp3mxi5JkhmluJ6zzONw/pfaMUSR0HyaL6530zYRBmBz7QFqj9YhSQ5efsXPQjxS2MJ/nJUUS8zEZ/G4nPSEQgyHLj08kCehtQuqy66w94/vEfIGNaVliEYGr6No40AAj9OBkDcYHmpb0RaO9hGO9lFdtodubQqAovQCG1IpgGgYlNlsbCqyrekXjvaZ+SlD3Dgwoc9hyWU4WP1SQf6lNbXouo6u6+ZtvmCgoihCcErDks2QCA3w4YF3ngjz+/1omsbkRMfG5nBkdoQ7bjeEe9hVVsZHe5u4FB7nXqTX9Kmvf5eKys3IskwwGGR4qG3ZW0VY+pgpxFRVze/zvcBWbylep5OMzY5hsVLsLiFd5MTqq+DedJRQKLQCtiHg0uv91k21uF1uPE4XhsVC1monlsqSmE8yOdGx6itsQ8BHwavN9+P6/Avf+1eTf20QhwAAAABJRU5ErkJggg==\"","\nimport React, { useRef, useEffect, PropsWithChildren, forwardRef, useImperativeHandle } from \"react\";\nimport { Sprite, Stage } from '@inlet/react-pixi';\nimport { Viewport as PixiViewport} from 'pixi-viewport';\nimport { GodrayFilter } from 'pixi-filters';\nimport Viewport from 'components/pixi/Viewport';\nimport { gsap } from 'gsap';\n\nexport interface Props {\n    screenWidth: number;\n    screenHeight: number;\n    worldWidth: number;\n    worldHeight: number;\n}\n\n\nconst TownStage = forwardRef<any, PropsWithChildren<Props>>((props, ref: React.Ref<PixiViewport>) => {\n    const {\n        children,\n        screenWidth,\n        screenHeight,\n        worldWidth,\n        worldHeight\n    } = props;\n\n    const innerRef = useRef<PixiViewport>(null);\n\n    useImperativeHandle(ref, () => {\n        return innerRef.current!\n    });\n\n\n    useEffect(() => {\n        godray.enabled = false;\n        if(innerRef.current) {\n\n            const viewport = innerRef.current;\n            viewport.on(\"moved\", () => {\n                const horizontalFactor = gsap.utils.normalize(viewport.screenWidth, worldWidth, viewport.right);\n                const verticalFactor = gsap.utils.normalize(worldHeight, viewport.screenHeight, viewport.bottom);\n                const factor = Math.max(horizontalFactor * verticalFactor - .4, 0);;\n\n                godray.gain =  factor;\n                godray.lacunarity = 2.4;\n                godray.enabled = godray.gain > 0;\n            })\n        }\n\n        const onScroll = (e: WheelEvent) => {\n            // Scrolling the mouse is just used for zoom, not for actual scrolling\n            e.preventDefault();\n        }\n        window.addEventListener(\"wheel\", onScroll, {passive: false});\n        return () => {\n            window.removeEventListener(\"wheel\", onScroll);\n        };\n    }, [worldHeight, worldWidth]);\n\n    return (\n        <Stage width={screenWidth} height={screenHeight} options={options} >\n            <Viewport\n                screenWidth={screenWidth}\n                screenHeight={screenHeight}\n                worldWidth={worldWidth}\n                worldHeight={worldHeight}\n                ref={innerRef}>\n                <Sprite\n                    name=\"background\"\n                    image={`${process.env.PUBLIC_URL}/img/town/town-alpha/background.png`}\n                    filters={[godray]}\n                >\n                    {children}\n                </Sprite>\n            </Viewport>\n        </Stage>\n\n    )\n});\n\nexport default TownStage;\n\nconst options = {\n    autoDensity: true,\n    sharedLoader: true\n}\n\nexport const godray = new GodrayFilter();\n","import { Sprite, useTick } from '@inlet/react-pixi';\nimport React, { useState } from 'react';\n\ninterface Props {\n    worldWidth: number;\n    speed?: number;\n}\n\nconst Clouds = (props: Props) => {\n    const { speed = 1 } = props;\n    const [cloud, setCloud] = useState(randomCloud());\n    const image = `${process.env.PUBLIC_URL}/img/town/clouds/cloud-0${cloud}.png`;\n    const [x, setX] = useState(-2000);\n    const [y, setY] = useState(randomY());\n\n    useTick((delta:number | undefined) => {\n        if (x > props.worldWidth){\n            setX(2000 - Math.random() * 1000);\n            setY(randomY());\n            setCloud(randomCloud());\n        } else {\n            setX(x + speed * (delta || 1));\n        }\n    });\n\n    return (\n        <Sprite\n            name={`cloud ${cloud}`}\n            image={image}\n            alpha={0.8}\n            x={x}\n            y={y}\n        />\n    );\n}\n\nexport default Clouds;\n\nconst randomCloud = () => Math.floor(Math.random() * 2) + 1;\nconst randomY = () => Math.random() * -300 - 200;","import React, { useRef, useEffect, useState } from \"react\";\r\nimport { Structure } from 'definitions/structures';\r\nimport { StructuresStoreState } from 'store/types/structures';\r\nimport { SoundManager, MusicTrack } from 'global/SoundManager';\r\nimport { useRouteMatch } from 'react-router';\r\nimport {OutlineFilter} from '@pixi/filter-outline';\r\nimport { getTownLink } from 'utils/routing';\r\nimport { StructureState, StructureStoreState } from 'store/types/structure';\r\nimport { useSelector } from 'react-redux';\r\nimport { StoreState } from 'store/types';\r\nimport { gsap } from 'gsap';\r\nimport { MAX_WIDTH } from 'components/App';\r\nimport HitAreaShapes from 'utils/hitAreaShapes';\r\nimport polygons from './hitAreas.json';\r\nimport LumberMill from './structures/LumberMill';\r\nimport Tavern from './structures/Tavern';\r\nimport { withAppContext, AppContextProps } from 'hoc/withAppContext';\r\nimport Generic from './structures/Generic';\r\nimport Legenda from './Legenda';\r\nimport \"./styles/townView.scss\"\r\nimport TownStage from './TownStage';\r\nimport { Viewport as PixiViewport } from \"pixi-viewport\";\r\nimport Clouds from './Clouds';\r\n\r\nconst HEIGHT = 1079;\r\nconst WORLD_WIDTH = 1024;\r\nconst WORLD_HEIGHT = 1600;\r\n\r\nexport interface Props {\r\n    onStructureClick: (structure: Structure | null) => void;\r\n}\r\n\r\nexport const STRUCTURE_HIGHLIGHT_FILTER = new OutlineFilter(8, 0xffcc00);\r\n\r\nconst TownView = (props: Props & AppContextProps) => {\r\n    const match = useRouteMatch<{structure: string}>(`${getTownLink()}/:structure`);\r\n    const selectedStructure = match?.params.structure;\r\n    const ref = useRef<HTMLDivElement>(null);\r\n    const viewportRef = useRef<PixiViewport>(null);\r\n    const dragging = useRef(false);\r\n\r\n    useEffect(() => {\r\n        SoundManager.addMusicTrack(MusicTrack.town, \"sound/music/Soliloquy.mp3\");\r\n        SoundManager.playMusicTrack(MusicTrack.town);\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        const tween = gsap.to(STRUCTURE_HIGHLIGHT_FILTER, {\r\n            duration: .6,\r\n            thickness: 2,\r\n            yoyo: true,\r\n            repeat: -1\r\n        });\r\n        return () => {\r\n            tween.pause(0);\r\n            tween.kill();\r\n        }\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        if(viewportRef.current) {\r\n\r\n            const viewport = viewportRef.current;\r\n            viewport.on(\"drag-start\", (e) => {\r\n                dragging.current = true;\r\n                e.event.stopPropagation();\r\n            });\r\n            viewport.on(\"drag-end\", () => { dragging.current = false; });\r\n        }\r\n    }, []);\r\n\r\n    const handleStructureClick = (structure: Structure | null) => {\r\n        if (!dragging.current) {\r\n            props.onStructureClick(structure);\r\n        }\r\n    }\r\n    // console.log('rendering town');\r\n\r\n    const structures = useSelector<StoreState, StructuresStoreState>((state: StoreState) => {\r\n        return state.structures;\r\n    });\r\n\r\n\r\n    const renderStructures = () => {\r\n        const orderedStructures = [\r\n            Structure.workshop,\r\n            Structure.quarry,\r\n            Structure.tavern,\r\n            Structure.tannery,\r\n            Structure.alchemist,\r\n            Structure.garden,\r\n            Structure.weaponsmith,\r\n            Structure.armoursmith,\r\n            Structure.warehouse,\r\n            Structure.mine,\r\n            Structure.lumberMill,\r\n            Structure.weaver,\r\n        ]\r\n        return orderedStructures.reverse().map((structure) => {\r\n            const structureStore: StructureStoreState = structures[structure];\r\n            if (structureStore.state === StructureState.NotBuilt) {\r\n                return null;\r\n            }\r\n            // todo: refactor into seperate components\r\n\r\n            const StructureComponent = getStructure(structure);\r\n            const position = getStructurePosition(structure);\r\n            const hitAreaShapes = new HitAreaShapes(polygons, structure);\r\n            return (\r\n                <StructureComponent\r\n                    position={position}\r\n                    structure={structure}\r\n                    hitAreaShapes={hitAreaShapes}\r\n                    onStructureClick={handleStructureClick}\r\n                    key={structure}\r\n                    selected={selectedStructure === structure}\r\n                />\r\n            );\r\n        });\r\n    }\r\n\r\n    useEffect(() => {\r\n        if (selectedStructure && viewportRef.current) {\r\n            const viewport = viewportRef.current;\r\n            viewport.zoomPercent(0);\r\n            const position = getStructurePosition(Structure[selectedStructure]);\r\n            viewport.moveCenter(position);\r\n        }\r\n    }, [selectedStructure]);\r\n\r\n    const [canvasWidth, setCanvasWidth] = useState(MAX_WIDTH);\r\n    const [canvasHeight, setCanvasHeight] = useState(HEIGHT);\r\n\r\n    useEffect(() => {\r\n        // This will set the dimensions of the canvas tot that of the townview\r\n        const resize = () => {\r\n            const worldViewWidth = ref.current?.clientWidth || MAX_WIDTH;\r\n            const worldViewHeight = ref.current?.clientHeight || HEIGHT;\r\n\r\n            setCanvasWidth(worldViewWidth);\r\n            setCanvasHeight(worldViewHeight);\r\n        }\r\n        resize();\r\n        window.addEventListener(\"resize\", resize);\r\n        return () => {\r\n            window.removeEventListener(\"resize\", resize);\r\n        };\r\n    }, []);\r\n\r\n\r\n    return (\r\n        <div className=\"town-view\" ref={ref}>\r\n            <Legenda structures={structures} />\r\n            <TownStage\r\n                screenWidth={canvasWidth}\r\n                screenHeight={canvasHeight}\r\n                worldWidth={WORLD_WIDTH}\r\n                worldHeight={WORLD_HEIGHT}\r\n                ref={viewportRef}\r\n            >\r\n                <Clouds worldWidth={canvasWidth} />\r\n                {renderStructures()}\r\n                <Clouds worldWidth={canvasWidth} />\r\n            </TownStage>\r\n            {/* { selectedStructure && (\r\n                <StructureDetailsView\r\n                    structure={selectedStructure}\r\n                    title={TextManager.getStructureName(selectedStructure)}\r\n                    onClose={() => handleStructureClick(null)}\r\n                />\r\n            )} */}\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default withAppContext(TownView);\r\n\r\nconst getStructure = (structure: Structure) => {\r\n    switch (structure) {\r\n        case Structure.workshop:\r\n        case Structure.quarry:\r\n        case Structure.tannery:\r\n        case Structure.alchemist:\r\n        case Structure.garden:\r\n        case Structure.weaponsmith:\r\n        case Structure.armoursmith:\r\n        case Structure.warehouse:\r\n        case Structure.mine:\r\n        case Structure.weaver:\r\n            return Generic;\r\n        case Structure.lumberMill:\r\n            return LumberMill;\r\n        case Structure.tavern:\r\n            return Tavern;\r\n    }\r\n}\r\n\r\nconst getStructurePosition = (structure: Structure) => {\r\n    let x;\r\n    let y;\r\n    switch (structure) {\r\n        case Structure.workshop:\r\n            x = 373;\r\n            y = 610;\r\n            break;\r\n        case Structure.quarry:\r\n            x = 632;\r\n            y = 633;\r\n            break;\r\n        case Structure.tannery:\r\n            x = 372;\r\n            y = 460;\r\n            break;\r\n        case Structure.tavern:\r\n            x = 500;\r\n            y = 469;\r\n            break;\r\n        case Structure.alchemist:\r\n            x = 411;\r\n            y = 371;\r\n            break;\r\n        case Structure.garden:\r\n            x = 822;\r\n            y = 689;\r\n            break;\r\n        case Structure.weaponsmith:\r\n            x = 449;\r\n            y = 460;\r\n            break;\r\n        case Structure.armoursmith:\r\n            x = 473;\r\n            y = 442;\r\n            break;\r\n        case Structure.warehouse:\r\n            x = 471;\r\n            y = 130;\r\n            break;\r\n        case Structure.lumberMill:\r\n            x = 403;\r\n            y = 320;\r\n            break;\r\n        case Structure.mine:\r\n            x = 183;\r\n            y = 527;\r\n            break;\r\n        case Structure.weaver:\r\n            x = 484;\r\n            y = 333;\r\n            break;\r\n    }\r\n    return new PIXI.Point(x, y);\r\n}","import React, { useEffect, useState } from 'react';\nimport { ToastManager, ToastConfig } from 'global/ToastManager';\nimport Toast from './Toast';\nimport './styles/toasts.scss';\n\n// Toasts can be added by calling ToastManager.addToast\n// ToastManager will inform whenever the something is added to the list of toasts via EVENT_TOASTS_UPDATED\n// The toasts themselves will fade out via css transition\nconst Toasts = () => {\n\n    const [activeToasts, setActiveToasts] = useState<ToastConfig[]>([]);\n\n    const toastsUpdated = (stack: ToastConfig[]) => {\n        setActiveToasts(stack);\n    }\n\n    useEffect(() => {\n        ToastManager.addEventListener(ToastManager.EVENT_TOASTS_UPDATED, toastsUpdated);\n        return () => {\n            ToastManager.removeEventListener(ToastManager.EVENT_TOASTS_UPDATED, toastsUpdated);\n        }\n    }, []);\n\n    return (\n        <div className=\"toasts\" > \n            { activeToasts.map((toastConfig) => (\n                <Toast key={toastConfig.time} {...toastConfig}/>\n            ))}\n        </div>\n    )\n}\n\nexport default Toasts;","// tslint:disable:object-literal-sort-keys\nimport { Action } from \"redux\";\nimport { ResourceStoreState } from \"store/types/resources\";\n\nexport enum ActionType {\n    addResources = \"addResources\",\n    removeResources = \"removeResources\",\n}\n\nexport interface AddResources extends Action<ActionType> {\n    resources: ResourceStoreState;\n}\n\nexport function addResource(resource: string, value: number): AddResources {\n    return addResources({\n        [resource]: value,\n    });\n}\n\nexport function addResources(resources: ResourceStoreState): AddResources {\n    return {\n        type: ActionType.addResources,\n        resources,\n    };\n}\n\nexport function removeResources(resources: ResourceStoreState): AddResources {\n    return {\n        type: ActionType.removeResources,\n        resources,\n    };\n}\n","// tslint:disable:object-literal-sort-keys\n\nimport { Structure } from \"definitions/structures\";\nimport { Action } from \"redux\";\nimport { StructureState } from \"store/types/structure\";\nimport { Item } from 'definitions/items/types';\n\nexport enum ActionType {\n    upgradeStructure = \"upgradeStructure\",\n    increaseWorkers = \"increaseWorkers\",\n    decreaseWorkers = \"decreaseWorkers\",\n    startBuildingStructure = \"startBuildingStructure\",\n    finishBuildingStructure = \"finishBuildingStructure\",\n    setStructureState = \"setStructureState\",\n    addItemToToProduces = \"addItemToToProduces\",\n}\n\nexport interface StructureAction extends Action<ActionType> {\n    structure: Structure;\n}\nexport interface StructureStateAction extends StructureAction {\n    state: StructureState;\n}\nexport interface AddItemToProducesAction extends StructureAction {\n    item: Item;\n}\n\nexport interface WorkerCountAction extends StructureAction {\n    workers: number;\n}\n\nexport function startBuildingStructure(structure: Structure): StructureAction {\n    return {\n        type: ActionType.startBuildingStructure,\n        structure,\n    };\n}\n\nexport function finishBuildingStructure(structure: Structure): StructureAction {\n    return {\n        type: ActionType.finishBuildingStructure,\n        structure,\n    };\n}\n\nexport function upgradeStructure(structure: Structure): StructureAction {\n    return {\n        type: ActionType.upgradeStructure,\n        structure,\n    };\n}\n\n// Increases workers used by given structure by given amount\nexport function increaseWorkers(structure: Structure, workers: number = 1): WorkerCountAction {\n    return {\n        type: ActionType.increaseWorkers,\n        structure,\n        workers,\n    };\n}\n\n// Decreases workers used by given structure by given amount\nexport function decreaseWorkers(structure: Structure, workers: number = 1): WorkerCountAction {\n    return {\n        type: ActionType.decreaseWorkers,\n        structure,\n        workers,\n    };\n}\n\nexport function setStructureState(structure: Structure, state: StructureState): StructureStateAction {\n    return {\n        type: ActionType.setStructureState,\n        structure,\n        state,\n    };\n}\n\nexport function addItemToToProduces(structure: Structure, item: Item): AddItemToProducesAction {\n    return {\n        type: ActionType.addItemToToProduces,\n        structure,\n        item,\n    };\n}\n","import * as React from \"react\";\nimport { SoundManager, Sound } from 'global/SoundManager';\nimport Button from '../buttons/Button';\n\n// todo: refactor using WindowManager [30/03/2020]\nexport interface Props {\n    title: string;\n    backEnabled?: boolean;\n    closeEnabled?: boolean;\n    onClose?: () => void;\n    onBack?: () => void;\n}\n\ntype AllProps = Props;\n\n/**\n *\n */\nconst Window: React.FunctionComponent<AllProps> = (props) => {\n\n    const handleClose = (e: React.MouseEvent) => {\n        if (props.onClose) {\n            props?.onClose();\n\n            SoundManager.playSound(Sound.buttonClick);\n        }\n    };\n\n    const handleBack = (e: React.MouseEvent) => {\n        if (props.onBack) {\n            props?.onBack();\n\n            SoundManager.playSound(Sound.buttonClick);\n        }\n    };\n\n    return (\n        <div className = \"window\">\n            <div className = \"header\">\n                { props.backEnabled !== false && (\n                    <Button\n                        className=\"back-button\"\n                        onClick={handleBack}\n                        square={true}\n                        size={\"medium\"}\n                        color=\"purple\"\n                        text=\"<\"\n                    />\n                )}\n                <h3>{ props.title }</h3>\n                { props.closeEnabled !== false && (\n                    <Button\n                        className=\"close-button\"\n                        onClick={handleClose}\n                        square={true}\n                        size={\"medium\"}\n                        color=\"purple\"\n                        text=\"x\"\n                    />\n                )}\n            </div>\n            { props.children }\n        </div>\n    );\n};\n\nexport default Window;\n","import Window, { Props } from \"components/ui/window/Window\";\nimport * as React from \"react\";\nimport \"components/ui/window/styles/window.scss\";\n\nexport const withWindow = <TWrappedComponentProps extends Props>(WrappedComponent: React.ComponentType<TWrappedComponentProps>) => {\n    return class WithWindow extends React.Component<TWrappedComponentProps> {\n\n        public render() {\n            return <Window { ...this.props } >\n                <WrappedComponent { ...this.props } />\n            </Window>;\n        }\n    };\n};\n","import { withWindow } from \"hoc/withWindow\";\r\nimport * as React from \"react\";\r\nimport { compose } from \"redux\";\r\nimport { ChangeEvent, useRef } from 'react';\r\nimport { SoundManager } from 'global/SoundManager';\r\nimport \"./styles/settings.scss\";\r\nimport gsap from 'gsap';\r\n\r\nconst SettingsWindow = () => {\r\n\r\n    const soundSlider = useRef<HTMLInputElement>(null);\r\n    const musicSlider = useRef<HTMLInputElement>(null);\r\n\r\n    const handleSoundMuteClick = () => {\r\n        gsap.to(soundSlider.current, {\r\n            duration: .5,\r\n            value: 0,\r\n            onComplete: () => {\r\n                SoundManager.soundVolume = 0;\r\n            }\r\n        });\r\n    }\r\n    const handleMusicMuteClick = () => {\r\n        gsap.to(musicSlider.current, {\r\n            duration: .5,\r\n            value: 0,\r\n            onComplete: () => {\r\n                SoundManager.musicVolume = 0;\r\n            }\r\n        });\r\n    }\r\n\r\n    const handleSoundChange = (e: ChangeEvent<HTMLInputElement>) => {\r\n        const linear = parseFloat(e.target.value);\r\n        const log = Math.pow(linear, 2);\r\n        SoundManager.soundVolume = log;\r\n    };\r\n\r\n    const handleMusicChange = (e: ChangeEvent<HTMLInputElement>) => {\r\n        const linear = parseFloat(e.target.value);\r\n        const log = Math.pow(linear, 2);\r\n        SoundManager.musicVolume = log;\r\n    };\r\n\r\n    return (\r\n        <div className=\"settings-window\">\r\n            <details open = { true } className=\"sound\" >\r\n                <summary>Sound</summary>\r\n                <section>\r\n                    <p>\r\n                        <label>Sound</label>\r\n                        <button onClick={handleSoundMuteClick}>\r\n                            <span role=\"img\" aria-label=\"Mute\">🔇</span>\r\n                        </button>\r\n                        <input\r\n                            type=\"range\"\r\n                            min=\"0\"\r\n                            max=\"1\"\r\n                            step=\"0.05\"\r\n                            ref={soundSlider}\r\n                            onChange={handleSoundChange}\r\n                            defaultValue={`${Math.sqrt(SoundManager.soundVolume)}`}\r\n                        />\r\n                    </p>\r\n                    <p>\r\n                        <label>Music</label>\r\n                        <button onClick={handleMusicMuteClick}>\r\n                            <span role=\"img\" aria-label=\"Mute\">🔇</span>\r\n                        </button>\r\n                        <input\r\n                            type=\"range\"\r\n                            min=\"0\"\r\n                            max=\"1\"\r\n                            step=\"0.05\"\r\n                            ref={musicSlider}\r\n                            onChange={handleMusicChange}\r\n                            defaultValue={`${Math.sqrt(SoundManager.musicVolume)}`}\r\n                        />\r\n                    </p>\r\n                </section>\r\n            </details>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default compose(\r\n    withWindow,\r\n)(SettingsWindow);\r\n","import { Resource } from \"definitions/resources\";\nimport { ONE_MINUTE } from 'utils/format/time';\n\nexport const RESOURCE_INTERVAL = ONE_MINUTE; // every minute constitutes a resource tick.\n\n// Whenever a list of resource is shown, use this order\nexport const resourceOrder = [\n    Resource.food,\n    Resource.wood,\n    Resource.iron,\n    Resource.stone,\n    Resource.fabric,\n    Resource.leather,\n];\n","import { Item } from \"definitions/items/types\";\nimport { Action } from \"redux\";\n\n// tslint:disable:object-literal-sort-keys\nexport enum ActionType {\n    addItem = \"addItem\",\n    moveItemInWarehouse = \"moveItemInWarehouse\",\n    removeItem = \"removeItem\",\n    addStockpileSlots = \"addStockpileSlots\"\n}\n\nexport interface MoveItemInWarehouseAction extends Action<ActionType> {\n    fromSlot: number;\n    toSlot: number;\n}\n\nexport interface AddAction extends Action {\n    item: Item;\n    toSlot?: number;\n}\n\nexport interface RemoveItemFromWarehouseAction extends Action {\n    fromSlot: number;\n}\nexport interface AddStockpileSlotsAction extends Action {\n    slots: number;\n}\n\n// Adds one Item to the warehouse\n// slot is optional, will take the first empty slot if not provided\nexport function addItemToWarehouse(item: Item, toSlot?: number): AddAction {\n    return {\n        type: ActionType.addItem,\n        item,\n        toSlot,\n    };\n}\n\n// When an Item is moved from one slot to the other in the warehouse\nexport function moveItemInWarehouse(fromSlot: number, toSlot: number): MoveItemInWarehouseAction {\n    return {\n        type: ActionType.moveItemInWarehouse,\n        fromSlot,\n        toSlot,\n    };\n}\nexport function removeItemFromWarehouse(fromSlot: number): RemoveItemFromWarehouseAction {\n    return {\n        type: ActionType.removeItem,\n        fromSlot,\n    };\n}\n\nexport function addStockpileSlots(slots: number): AddStockpileSlotsAction {\n    return {\n        type: ActionType.addStockpileSlots,\n        slots,\n    };\n}\n","import { Action } from \"redux\";\n\n// todo this should go somewhere else\nexport enum ActionType {\n    addWorkers = \"addWorkers\",\n}\n\nexport interface ModifyWorkersAction extends Action<ActionType> {\n    value: number;\n}\n\nexport function addWorkers(value: number): ModifyWorkersAction {\n    return {\n        type: ActionType.addWorkers,\n        value,\n    };\n}\nexport function subtractWorkers(value: number): ModifyWorkersAction {\n    return {\n        type: ActionType.addWorkers,\n        value: -value,\n    };\n}\n","export enum TimeType {\n    questProgress,          // progress on the worldmap\n    resourceGeneration,\n    cheat\n}\n// todo: should come from store?\n\nlet cheatTimeMultiplier = 1;\nexport const setCheatTimeMultiplier = (value: number) => {\n    cheatTimeMultiplier = value;\n}\n\nexport const getTimeMultiplier = (type: TimeType): number => {\n    switch (type) {\n       case TimeType.cheat:\n            return cheatTimeMultiplier;\n        // todo: implement different multipliers for different timetypes?\n        // the idea is to have speed boosts in different areas of the game\n        default:\n            return cheatTimeMultiplier;\n    }\n}\n\n","import { ReactNode } from 'react';\nimport { ItemDefinition } from \"definitions/items/types\";\nimport { WeaponType } from 'definitions/items/weapons';\nimport { TraitDefinition } from 'definitions/traits/types';\n\n// Things that can be shown on the ContextPopup\nexport enum ContextType {\n    item,\n    trait,\n    resource,\n    skill,\n    component\n}\n\nexport type ContextInfo = ItemDefinition | TraitDefinition | WeaponType | string | ReactNode;\n","import * as React from \"react\";\r\nimport { useRef, useState } from 'react';\r\nimport { getDefinition } from \"definitions/items\";\r\nimport { Item, ItemType } from \"definitions/items/types\";\r\nimport { getDefinition as getStructureDefinition, Structure } from \"definitions/structures\";\r\nimport { StructureState, StructureStoreState } from \"store/types/structure\";\r\nimport { StructuresStoreState } from \"store/types/structures\";\r\nimport { TextManager } from \"global/TextManager\";\r\nimport { ToastManager } from 'global/ToastManager';\r\nimport { Type } from 'components/ui/toasts/Toast';\r\nimport { useDispatch, useSelector } from 'react-redux';\r\nimport { addLogText } from 'store/actions/log';\r\nimport { LogChannel } from 'store/types/logEntry';\r\nimport { resourceOrder } from 'constants/resources';\r\nimport { ResourceStoreState } from 'store/types/resources';\r\nimport { addResources } from 'store/actions/resources';\r\nimport { setStructureState } from 'store/actions/structures';\r\nimport { StoreState } from 'store/types';\r\nimport { addGold } from 'store/actions/gold';\r\nimport { addItemToWarehouse } from 'store/actions/items';\r\nimport { withWindow } from 'hoc/withWindow';\r\nimport { addWorkers } from 'store/actions';\r\nimport { getTimeMultiplier, setCheatTimeMultiplier, TimeType } from 'mechanics/time';\r\nimport \"./styles/cheat.scss\";\r\n\r\n\r\n// tslint:disable-next-line:no-empty-interface\r\nexport interface Props {\r\n}\r\n\r\nconst CheatWindow = (props: Props) => {\r\n\r\n    const itemSelectRef = useRef<HTMLSelectElement>(null);\r\n    const [cheats, setCheats] = useState({\r\n        gold: 50,\r\n        resources: 50,\r\n        workers: 10,\r\n    });\r\n    const dispatch = useDispatch();\r\n    const [timeMultiplier, setTimeMultiplier] = useState(getTimeMultiplier(TimeType.cheat));\r\n\r\n    const onCheatGold = (amount: number) => {\r\n        dispatch(addGold(amount));\r\n        dispatch(addLogText(\"common-cheat-gold-added\", { amount }, LogChannel.common));\r\n    };\r\n\r\n    const onCheatItem = (item: Item) => {\r\n        dispatch(addItemToWarehouse(item));\r\n        dispatch(addLogText(\"common-cheat-item-added\", { item }, LogChannel.common));\r\n    };\r\n\r\n    const onCheatResources = (amount: number) => {\r\n        // Create ResourceStoreState where value of each resource is `amount`\r\n        const resources = resourceOrder.reduce((acc: ResourceStoreState, resource) => {\r\n            acc[resource] = amount;\r\n            return acc;\r\n        }, {});\r\n\r\n        dispatch(addResources(resources));\r\n        dispatch(addLogText(\"common-cheat-resources-added\", { amount }, LogChannel.common));\r\n    };\r\n\r\n    const onCheatStructureState = (structure: Structure, state: StructureState) => {\r\n        dispatch(setStructureState(structure, state))\r\n    }\r\n\r\n    const onCheatWorkers = (amount: number) => {\r\n        dispatch(addWorkers(amount));\r\n        dispatch(addLogText(\"common-cheat-workers-added\", { amount }, LogChannel.common));\r\n    };\r\n\r\n    const structures = useSelector<StoreState, StructuresStoreState>(store => store.structures);\r\n\r\n    const getStructureRow = (structure: Structure) => {\r\n        const structureDef = getStructureDefinition(structure);\r\n        const structureStore: StructureStoreState = structures[structure];\r\n        const levelDef = structureDef.levels[structureStore.level];\r\n\r\n        const displayName = TextManager.get(levelDef.displayName);\r\n\r\n        return (\r\n            <div\r\n                className=\"label-dropdown\"\r\n                key={structure}\r\n            >\r\n                <label title={structure}>\r\n                    {`${displayName}`}\r\n                </label>\r\n                <input\r\n                    key={structure}\r\n                    type=\"checkbox\"\r\n                    checked={structureStore.state === StructureState.Built}\r\n                    onChange={() => handleChangeStructureState(structure, structureStore.state !== StructureState.Built)}\r\n                />\r\n            </div>\r\n        );\r\n    };\r\n\r\n    const getItemTypeOptions = (type: ItemType) => {\r\n        return Object.keys(Item)\r\n            // eslint-disable-next-line eqeqeq\r\n            // tslint:disable-next-line: triple-equals\r\n            .filter((item: string) => getDefinition(item as Item).itemType == type)\r\n            .map((item: string) => getItemOption(item as Item));\r\n    };\r\n\r\n    const getItemOption = (item: Item) => {\r\n        return (\r\n            <option value={item} key={item}>\r\n                { TextManager.getItemName(item)}\r\n            </option>\r\n        );\r\n    };\r\n\r\n    const items = Object.keys(ItemType)\r\n        .filter((val: any) => !isNaN(val))\r\n        .map((type: string) => {\r\n            return (\r\n                <optgroup label={ItemType[type]} key={type}>\r\n                    { getItemTypeOptions(type as unknown as ItemType)}\r\n                </optgroup>\r\n            );\r\n        });\r\n\r\n    const handleCheatGold = (evt: React.MouseEvent<HTMLButtonElement>) => {\r\n        const amount = cheats.gold;\r\n        onCheatGold(amount);\r\n\r\n        const text = TextManager.get(\"common-cheat-gold-added\", { amount });\r\n        const icon = \"/img/resources/gold.png\";\r\n        ToastManager.addToast(text, Type.cheat, icon);\r\n    }\r\n\r\n    const handleCheatWorkers = (evt: React.MouseEvent<HTMLButtonElement>) => {\r\n        const amount = cheats.workers;\r\n        onCheatWorkers(amount);\r\n        const text = TextManager.get(\"common-cheat-workers-added\", { amount });\r\n        const icon = \"/img/resources/worker.png\";\r\n        ToastManager.addToast(text, Type.cheat, icon);\r\n    }\r\n\r\n    const handleCheatResources = (evt: React.MouseEvent<HTMLButtonElement>) => {\r\n        onCheatResources(cheats.resources);\r\n        const text = TextManager.get(\"common-cheat-resources-added\", { amount: cheats.resources });\r\n        ToastManager.addToast(text, Type.cheat);\r\n    }\r\n\r\n    const handleCheatItem = (evt: React.MouseEvent<HTMLButtonElement>) => {\r\n        const item = itemSelectRef.current!.value as Item;\r\n        onCheatItem(item);\r\n\r\n        const text = TextManager.get(\"common-cheat-item-added\", { item });\r\n        const icon = getDefinition(item).iconImg;\r\n        ToastManager.addToast(text, Type.cheat, icon);\r\n    }\r\n\r\n    const handleChangeStructureState = (structure: Structure, checked: boolean) => {\r\n        onCheatStructureState(structure, checked ? StructureState.Built : StructureState.NotBuilt);\r\n        if (checked) {\r\n            ToastManager.addToast(`The ${TextManager.getStructureName(structure)} is constructed`, Type.cheat);\r\n        } else {\r\n            ToastManager.addToast(`The ${TextManager.getStructureName(structure)} is not constructed`, Type.cheat);\r\n        }\r\n    }\r\n\r\n    const handleChangeGold = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n        const amount = Number.parseFloat(event.target.value);\r\n        setCheats({\r\n            ...cheats,\r\n            gold: amount,\r\n        });\r\n    }\r\n\r\n    const handleChangeWorkers = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n        const amount = Number.parseFloat(event.target.value);\r\n        setCheats({\r\n            ...cheats,\r\n            workers: amount,\r\n        });\r\n    }\r\n\r\n    const handleChangeResources = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n        const amount = Number.parseFloat(event.target.value);\r\n        setCheats({\r\n            ...cheats,\r\n            resources: amount,\r\n        });\r\n    }\r\n\r\n    const handleChangeTimeMultiplier = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n        const value = Number.parseFloat(event.target.value);\r\n        setTimeMultiplier(value)\r\n        setCheatTimeMultiplier(value);\r\n    }\r\n\r\n    return (\r\n        <div className=\"cheat-window\">\r\n            <div className=\"label-numberbox-button\">\r\n                <label>Gold</label>\r\n                <input type=\"number\"\r\n                    value={cheats.gold}\r\n                    style={{ width: \"50px\" }}\r\n                    onChange={handleChangeGold} />\r\n                <button onClick={handleCheatGold}>Add</button>\r\n            </div>\r\n            <div className=\"label-numberbox-button\">\r\n                <label>Workers</label>\r\n                <input type=\"number\"\r\n                    value={cheats.workers}\r\n                    style={{ width: \"50px\" }}\r\n                    onChange={handleChangeWorkers} />\r\n                <button onClick={handleCheatWorkers}>Add</button>\r\n            </div>\r\n            <div className=\"label-numberbox-button\">\r\n                <label>Resources</label>\r\n                <input type=\"number\"\r\n                    value={cheats.resources}\r\n                    style={{ width: \"50px\" }}\r\n                    onChange={handleChangeResources} />\r\n                <button onClick={handleCheatResources}>Add</button>\r\n            </div>\r\n            <div className=\"label-numberbox-button\">\r\n                <label>Items</label>\r\n                <select style={{ width: \"150px\" }} ref={itemSelectRef}>\r\n                    {items}\r\n                </select>\r\n                <button onClick={handleCheatItem}>Add</button>\r\n            </div>\r\n            <div className=\"label-range-value\">\r\n                <label>Speed</label>\r\n                <input\r\n                    type=\"range\"\r\n                    min=\"1\" max=\"10\" value={timeMultiplier} step={1}\r\n                    onChange={handleChangeTimeMultiplier}\r\n                />\r\n                {timeMultiplier}x speed\r\n            </div>\r\n            <div>\r\n                <h2>Structures</h2>\r\n            </div>\r\n            { Object.keys(structures).map((structure) => getStructureRow(structure as Structure))}\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default withWindow(CheatWindow);\r\n","import { Props as WindowProps } from \"components/ui/window/Window\";\r\nimport { AppContextProps, withAppContext } from \"hoc/withAppContext\";\r\nimport { withWindow } from \"hoc/withWindow\";\r\nimport * as React from \"react\";\r\nimport { compose } from \"redux\";\r\nimport SettingsWindow from './SettingsWindow';\r\nimport CheatWindow from './CheatWindow';\r\nimport { useSelector } from 'react-redux';\r\nimport { StoreState } from 'store/types';\r\nimport { Persistor } from 'redux-persist';\r\nimport { loadGame } from 'index';\r\nimport { useState } from 'react';\r\nimport { ToastManager } from 'global/ToastManager';\r\nimport { Type } from 'components/ui/toasts/Toast';\r\nimport { TextManager } from 'global/TextManager';\r\nimport { createEncryptor } from 'simple-encryptor';\r\nimport \"./styles/menu.scss\";\r\nimport Button from 'components/ui/buttons/Button';\r\n\r\n// tslint:disable-next-line:no-empty-interface\r\nexport interface Props {\r\n    persistor: Persistor;\r\n}\r\n\r\nconst key = \"P5mw}jD>5c6Y]yqy\";\r\ntype AllProps = Props & WindowProps;\r\nconst Menu = (props: AllProps & AppContextProps) => {\r\n\r\n    const storeState = useSelector<StoreState>(state => state);\r\n    const [loadedStore, setLoadedStore] = useState<StoreState>();\r\n\r\n    const handleClickCheats = () => {\r\n        const window = <CheatWindow title=\"Cheats\" />;\r\n        props.onOpenWindow(window);\r\n    };\r\n\r\n    const handleClickSettings = () => {\r\n        const window = <SettingsWindow title=\"Settings\" />;\r\n        props.onOpenWindow(window);\r\n    };\r\n\r\n    const handleClickSave = () => {\r\n        const encryptor = createEncryptor(key);\r\n        const a = document.createElement('a');\r\n        const text = JSON.stringify(storeState);\r\n        const encrypted = encryptor.encrypt(text);\r\n        const filename = \"Gidletown save.json\";\r\n        a.setAttribute('href', 'data:text/json;cccharset=utf-8,' + encodeURIComponent(encrypted));\r\n        a.setAttribute('download', filename);\r\n        a.click();\r\n    }\r\n\r\n    const handleClickLoad = async () => {\r\n        if (!loadedStore) return;\r\n        setLoadedStore(undefined);\r\n\r\n        await loadGame(loadedStore);\r\n        ToastManager.addToast(TextManager.get(\"ui-game-loaded\"), Type.game, \"/img/items/misc/magic-eye.png\");\r\n        props.onCloseWindow();\r\n\r\n    }\r\n\r\n    const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const encryptor = createEncryptor(key);\r\n        const fileReader = new FileReader();\r\n        fileReader.onload = () => {\r\n            const encrypted = fileReader.result! as string;\r\n            const text = encryptor.decrypt(encrypted);\r\n            const obj: StoreState = JSON.parse(text);\r\n            setLoadedStore(obj);\r\n        }\r\n        fileReader.readAsText(e.target.files![0]);\r\n    }\r\n\r\n\r\n\r\n    return (\r\n        <div className=\"menu\">\r\n            <p>\r\n                <Button onClick={handleClickCheats}>Cheats!</Button>\r\n            </p>\r\n            <p>\r\n                <Button onClick={handleClickSettings}>Settings</Button>\r\n            </p>\r\n            <fieldset>\r\n                <legend>Save and load</legend>\r\n                <section>\r\n                    Save game to disk:&nbsp;\r\n                    <Button onClick={handleClickSave}>Save</Button>\r\n                </section>\r\n                <section>\r\n                    Load game from disk:&nbsp;\r\n                    <input type=\"file\" onChange={handleFileChange} />\r\n                    <Button onClick={handleClickLoad} disabled={!loadedStore}>Load</Button>\r\n                </section>\r\n            </fieldset>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default compose(\r\n    withWindow,\r\n    withAppContext,\r\n)(Menu) as React.ComponentType<AllProps>;\r\n","export const formatNumber = (input: number, digits: number = 1): string => {\n    const SI_SYMBOL = [\"\", \"k\", \"M\", \"G\", \"T\", \"P\", \"E\"];\n\n    // what tier? (determines SI symbol)\n    const tier = Math.log10(input) / 3 | 0;\n    // if zero, we don't need a suffix\n    if(tier === 0) return input.toFixed(digits);\n\n    // get suffix and determine scale\n    const suffix = SI_SYMBOL[tier];\n    const scale = Math.pow(10, tier * 3);\n\n    // scale the number\n    const scaled = input / scale;\n\n    // format number and add suffix\n    return scaled.toFixed(digits) + suffix;\n}","import { ContextInfo, ContextType } from 'constants/context';\nimport deepEquals from 'deep-equal';\nimport EventEmitter from './EventEmitter';\n\nexport interface Context {\n    type: ContextType;\n    info: ContextInfo;\n    referenceRect: ClientRect;\n    className?: string;\n}\n\nexport abstract class TooltipManager extends EventEmitter<Context>() {\n\n    static EVENT_CONTEXT_UPDATED = \"tooltipContextUpdated\";\n    private static lastContext: Context | undefined;\n\n    static showContextTooltip (type: ContextType, info: ContextInfo, originRect: ClientRect, className?: string) {\n        const context = { type, info, referenceRect: originRect, className };\n\n        if(deepEquals(context, this.lastContext)) {\n            this.clear();\n        } else {\n            this.emit(this.EVENT_CONTEXT_UPDATED, context);\n            this.lastContext = context;\n        }\n    }\n\n    static clear() {\n        this.emit(this.EVENT_CONTEXT_UPDATED, undefined);\n        this.lastContext = undefined;\n    }\n}","import { StoreState } from 'store/types';\nimport { useSelector } from 'react-redux';\n\n// Returns the gold from redux store\nconst useGoldState = () => {\n    return useSelector<StoreState, number>(store => store.gold);\n}\n\nexport default useGoldState;","import { getDefinition, Structure } from \"definitions/structures\";\nimport { WarehouseStructureDefinition, WarehouseStructureLevelDefinition } from \"definitions/structures/types\";\nimport { createSelector } from 'reselect';\nimport { StoreState } from \"store/types\";\n\nconst getWarehouseLevel = (state: StoreState) => {\n    return state.structures[Structure.warehouse].level;\n}\n\n\nconst maxResources = (level: number) => {\n    const structureDefinition = getDefinition<WarehouseStructureDefinition>(Structure.warehouse);\n    const levelDefinition: WarehouseStructureLevelDefinition = structureDefinition.levels[level];\n    return levelDefinition.maxResources;\n}\n\n// Selects a ResourceStoreState with maximum stockpile of each resource the warehouse supports\nexport const selectMaxResources = createSelector([\n    getWarehouseLevel],\n    maxResources,\n);","import { StoreState } from 'store/types';\nimport { useSelector } from 'react-redux';\nimport { ResourceStoreState } from 'store/types/resources';\nimport { selectMaxResources } from 'store/selectors/resources';\n\n// Returns the resources from redux store\nexport const useResourcesState = () => {\n    return useSelector<StoreState, ResourceStoreState>(store => store.resources);\n}\n\n// Returns the maximum of each resource that the warehouse can hold\nexport const useMaxResourcesState = () => {\n    return useSelector<StoreState, ResourceStoreState>(selectMaxResources);\n}","import { createSelector } from \"reselect\";\nimport { StoreState } from \"store/types\";\nimport { StructureStoreState } from \"store/types/structure\";\nimport { StructuresStoreState } from \"store/types/structures\";\n\nconst getStructures = (state: StoreState) => state.structures;\nconst getWorkers = (state: StoreState) => state.workers;\n\nconst calculateFreeWorkers = (structures: StructuresStoreState, workers: number) => {\n    // Add up all the workers used by all structures in town\n    const workersUsed = Object.keys(structures).map((name) => structures[name])\n        .reduce((acc: number, value: StructureStoreState) => acc += value.workers, 0);\n\n    return workers - workersUsed;\n};\n\nexport const selectFreeWorkers = createSelector([\n    getStructures,\n    getWorkers],\n    calculateFreeWorkers,\n);\n","import { StoreState } from 'store/types';\nimport { useSelector } from 'react-redux';\nimport { selectFreeWorkers } from 'store/selectors/workers';\n\n// Returns all the workers from redux store\nexport const useWorkersState = () => {\n    return useSelector<StoreState, number>(store => store.workers);\n}\n\n// Returns all the workers not working on something from redux store\nexport const useWorkersFreeState = () => {\n    return useSelector<StoreState, number>(selectFreeWorkers);\n}\n\n","import { resourceOrder } from \"constants/resources\";\nimport resourceDescriptions from \"definitions/resources\";\nimport * as React from \"react\";\nimport { ResourceStoreState } from \"store/types/resources\";\nimport { formatNumber } from 'utils/format/number';\nimport { TooltipManager } from 'global/TooltipManager';\nimport { ContextType } from 'constants/context';\nimport useGoldState from 'hooks/store/useGoldState';\nimport { useResourcesState } from 'hooks/store/resources';\nimport { useWorkersFreeState } from 'hooks/store/useWorkersState';\nimport Icon from 'components/ui/common/Icon';\nimport \"./styles/resourcebar.scss\";\n\nexport interface StateProps  {\n    gold: number;\n    workers: number;    // total\n    workersFree: number;\n    resources: ResourceStoreState;\n}\n\n/** Shown on top in the UI */\nconst Resourcebar = () => {\n\n    const goldState = useGoldState();\n    const storeResources = useResourcesState();\n    const workersFree = useWorkersFreeState();\n\n    const createItem = (icon: string, amount: number, type: string) => {\n\n        const handleClick = (event: React.MouseEvent) => {\n\n            const origin = (event.currentTarget as HTMLElement);\n            const originRect = origin.getBoundingClientRect();\n            TooltipManager.showContextTooltip(ContextType.resource, type, originRect);\n            event.stopPropagation();\n        };\n\n        return (\n            <li key={type} onClick={handleClick}>\n                <Icon\n                    image={icon}\n                    size=\"smallest\"\n                />\n                <div className=\"amount\">\n                    { formatNumber(amount, 0) }\n                </div>\n            </li>\n        )\n    };\n\n    const resources = resourceOrder.map((resource) => {\n        const resourceDescription = resourceDescriptions[resource];\n        return createItem(resourceDescription.iconImg, storeResources[resource as string], resource);\n    });\n\n    resources.push(\n        createItem(\"/img/resources/worker.png\", workersFree, \"workers\"),\n        createItem(\"/img/resources/gold.png\", goldState, \"gold\"),\n    );\n\n    return (\n        <ul className=\"resourcebar\">\n            { resources }\n        </ul>\n    );\n};\nexport default Resourcebar;\n","import Menu from \"components/ui/window/windows/MenuWindow\";\nimport * as React from \"react\";\nimport Resourcebar from './Resourcebar';\nimport { useContext } from 'react';\nimport { AppContext } from 'components/App';\nimport { Persistor } from 'redux-persist';\nimport \"./styles/topbar.scss\";\n\ninterface Props {\n    persistor: Persistor;\n}\n\nconst Topbar = (props: Props) => {\n    const context = useContext(AppContext)!;\n\n    const handleClick = (e: React.MouseEvent<HTMLDivElement, MouseEvent>) => {\n        const window = <Menu title = \"Menu\" persistor={props.persistor} />;\n        context.onOpenWindow(window);\n    };\n\n    return (\n        <div className = \"topbar\">\n            <div className = \"topbar-left\">\n                <Resourcebar />\n            </div>\n            <div className = \"topbar-right\">\n                <div className = \"hamburger\" onClick = { handleClick }>☰</div>\n            </div>\n        </div>\n    );\n}\nexport default Topbar;","import React, { useRef, useEffect } from 'react';\nimport { Sprite } from '@inlet/react-pixi';\nimport { QuestStoreState } from 'store/types/quest';\nimport * as PIXI from 'pixi.js';\nimport { AdventurerStoreState } from 'store/types/adventurer';\nwindow.PIXI = PIXI;\n\ninterface Props {\n    quest: QuestStoreState;\n    position: PIXI.Point;\n    selected?: boolean;\n    encounterActive?: boolean;\n    onClick?: (quest: QuestStoreState) => void;\n    leader: AdventurerStoreState;\n}\nconst CIRCLE_DIAMETER = 256; // = avatar size / 2\n\nconst QuestMarker = (props: Props) => {\n    const { quest, leader, encounterActive, position, onClick, selected } = props;\n    const image = selected ? '/img/world/map-marker-selected.png' : '/img/world/map-marker.png';\n\n    const avatar = useRef<PIXI.Sprite>(null);\n    // Mask has to be a child of the avatar in order to move with it\n    useEffect(() => {\n        const sprite = avatar.current as any as PIXI.Sprite;\n\n        const maskGraphics = new PIXI.Graphics();\n        maskGraphics.beginFill(0xBADA55);\n        maskGraphics.drawCircle(0, 0, CIRCLE_DIAMETER * 1);\n        maskGraphics.endFill();\n\n        sprite.mask = maskGraphics;\n        sprite.addChild(maskGraphics);\n    }, [avatar]);\n\n    return (\n        <Sprite\n            image={`${process.env.PUBLIC_URL}${image}`}\n            name={quest.name}\n            x={position.x}\n            y={position.y}\n            interactive={true}\n            buttonMode={true}\n            scale={new PIXI.Point(0.1, 0.1)}\n            anchor={new PIXI.Point(0.5, 1)}\n            pointerdown={() => {\n                if(onClick) {\n                    onClick(quest);\n                }\n            }}\n        >\n            { leader && (\n            <Sprite\n                image={`${process.env.PUBLIC_URL}/${leader.avatarImg}`}\n                name=\"avatar\"\n                anchor={new PIXI.Point(0.5, 0.5)}\n                x={0}\n                y={-396}\n                scale={new PIXI.Point(0.66, 0.66)}\n                ref={avatar}\n            />)}\n            {encounterActive && (\n            <Sprite\n                image={`${process.env.PUBLIC_URL}/img/world/quest-alert.png`}\n                name=\"quest-alert\"\n                anchor={new PIXI.Point(0.5, 1)}\n                x={180}\n                y={-396}\n                scale={new PIXI.Point(2, 2)}\n            />\n            )}\n        </Sprite>\n    )\n}\n\nexport default QuestMarker;","import { Item } from \"definitions/items/types\";\nimport { SceneStoreState } from './scene';\n\nexport enum QuestStatus {\n    unavailable,\n    available,  // on the quest board\n    active,\n    completed,\n    // todo: failed?\n}\n\nexport interface QuestReward {\n    gold?: number;\n    items?: Item[];\n}\n\nexport interface QuestStoreState {\n    name: string;\n    status: QuestStatus;\n    party: string[];                // list of adventurer ids\n    progress: number;               // Which questnode the party is at currently\n    questVars: any;                 // \n    encounterResults: string[];   // Store what option the place chose during an encounter // OBSOLETE\n    icon: string;\n\n    reward?: QuestReward;\n    scene?: SceneStoreState;\n    sceneName?: string;\n}\n","import React from \"react\";\nimport { Graphics } from '@inlet/react-pixi';\n\ninterface Props {\n    positions: PIXI.Point[];\n}\n\nconst QuestLine = (props: Props) => {\n    const { positions } = props;\n    if (props.positions.length > 2) {\n        return <Graphics\n            name=\"questline\"\n            x={0}\n            y={0}\n            draw={graphics => {\n                graphics.lineStyle(3, 0xFF3300);\n                graphics.moveTo(positions[0].x, positions[0].y);\n\n                let i = 0;\n                for (i = 1; i < positions.length - 2; i ++)\n                {\n                    const xc = (positions[i].x + positions[i + 1].x) / 2;\n                    const yc = (positions[i].y + positions[i + 1].y) / 2;\n                    graphics.quadraticCurveTo(positions[i].x, positions[i].y, xc, yc);\n                }\n                graphics.quadraticCurveTo(positions[i].x, positions[i].y, positions[i+1].x, positions[i+1].y);\n                graphics.endFill();\n            }}\n        />;\n    }\n    return null;\n}\n\nexport default QuestLine;","import { TextEntry } from \"constants/text\";\nimport { createSelector } from \"reselect\";\nimport { StoreState } from \"store/types\";\nimport { LogChannel, LogEntry } from \"store/types/logEntry\";\nimport { QuestStatus, QuestStoreState } from \"store/types/quest\";\n\nconst getQuests = (state: StoreState) => state.quests;\nconst getLog = (state: StoreState) => state.log;\n\nconst activeQuests = (quests: QuestStoreState[]) => {\n    // returns the names of the active quests\n    return quests.filter((q) => q.status === QuestStatus.active).map((q) => q);\n};\n\nexport const selectActiveQuests = createSelector([\n    getQuests],\n    activeQuests,\n);\n\n// /**\n//  * Returns the most recent log entry for a given quest\n//  */\n// export const selectLastQuestLogEntry = (state: StoreState, questName: string) => createSelector([\n//     getLog],\n//     (log: LogEntry[]): TextEntry | undefined => {\n//         const questLog = log.find((l) => l.channel === LogChannel.quest && l.channelContext === questName);\n//         return questLog;\n//     },\n// )(state);\n\n// /**\n//  * Returns all log entries for given quest\n//  */\n// export const selectQuestLogEntries = (state: StoreState, questName: string) => createSelector([\n//     getLog],\n//     (log: LogEntry[]): TextEntry[] | undefined => {\n//         return log.filter((l) => l.channel === LogChannel.quest && l.channelContext === questName);\n//     },\n// )(state);\n","import { useCallback } from 'react';\nimport { StoreState } from 'store/types';\nimport { useSelector } from 'react-redux';\nimport { QuestStoreState } from 'store/types/quest';\n\n// Returns the quest from redux store\nconst useQuest = (questName: string) => {\n    const questSelector = useCallback(\n        (state: StoreState) => state.quests.find((q) => q.name === questName)!,\n        [questName]\n    );\n    const quest = useSelector<StoreState, QuestStoreState>(questSelector);\n    return quest;\n}\n\nexport default useQuest;","import * as PIXI from 'pixi.js';\r\nimport { Stage, Sprite } from '@inlet/react-pixi';\r\nimport { Viewport as PixiViewport } from \"pixi-viewport\";\r\nimport { useDispatch, useSelector } from 'react-redux'\r\n\r\nimport React, { useEffect, useRef, useCallback, useState } from \"react\";\r\nimport { QuestStoreState } from \"store/types/quest\";\r\nimport { lerpLocation } from 'utils/pixiJs';\r\nimport { QuestDefinition, QuestNodeType, QuestNode } from \"definitions/quests/types\";\r\nimport Viewport from '../../pixi/Viewport';\r\nimport MapGrid from './MapGrid';\r\nimport QuestMarker from './QuestMarker';\r\nimport { AdventurerStoreState } from 'store/types/adventurer';\r\nimport QuestLine from './QuestLine';\r\nimport { MAX_WIDTH as WIDTH } from 'components/App';\r\nimport { selectActiveQuests } from 'store/selectors/quests';\r\nimport { getDefinition } from 'definitions/quests';\r\nimport { TextManager } from 'global/TextManager';\r\nimport { getQuestLeader } from 'store/helpers/storeHelpers';\r\nimport { StoreState } from 'store/types';\r\nimport './styles/worldMap.scss';\r\nimport useQuest from 'hooks/store/useQuest';\r\nimport { setCombat } from 'store/actions/quests';\r\n\r\nwindow.PIXI = PIXI; // workaround for pixi-tilemap\r\nconst FULL_HEIGHT = 1024;\r\nconst SMALL_HEIGHT = 64;   // Used when QuestPanel is open\r\nconst WORLD_WIDTH = 1500;\r\nconst WORLD_HEIGHT = 1061;\r\nconst GRID_WIDTH = 10;      // width or height of each node location in pixels\r\n\r\nexport interface Props {\r\n    selectedQuestName?: string;\r\n    smallMap: boolean;\r\n    onPartyClick: (questName: string) => void;\r\n    retrieveWorldViewRef: () => React.RefObject<HTMLDivElement>;\r\n}\r\n\r\nconst WorldMap = (props: Props) => {\r\n    const { retrieveWorldViewRef, smallMap } = props;\r\n    const questSelector = useCallback(\r\n        (state: StoreState) => state.quests.find((q) => q.name === props.selectedQuestName),\r\n        [props.selectedQuestName]\r\n    );\r\n    \r\n    const selectedQuest = useSelector<StoreState, QuestStoreState | undefined>(questSelector);\r\n    const adventurers = useSelector<StoreState, AdventurerStoreState[]>((store) => store.adventurers);\r\n    const activeQuests = useSelector<StoreState, QuestStoreState[]>((store) => selectActiveQuests(store));\r\n\r\n    const handlePartyClick = (name: string) => {\r\n        props.onPartyClick(name);\r\n    };\r\n\r\n    // useEffect(() => {\r\n    //     const onScroll = (e: WheelEvent) => {\r\n    //         // When the map is big, scrolling the mouse is just used for zoom, not for actual scrolling\r\n    //         if (!smallMap) {\r\n    //             e.preventDefault();\r\n    //         }\r\n    //     }\r\n    //     window.addEventListener(\"wheel\", onScroll, {passive: false} );\r\n    //     return () => {\r\n    //         window.removeEventListener(\"wheel\", onScroll);\r\n    //     };\r\n    // }, [smallMap]);\r\n\r\n\r\n    const [canvasWidth, setCanvasWidth] = useState(WIDTH);\r\n    const [canvasHeight, setCanvasHeight] = useState(FULL_HEIGHT);\r\n\r\n    useEffect(() => {\r\n        // This will set the dimensions of the canvas tot that of the parent (worldview)\r\n        const resize = () => {\r\n            const worldView = retrieveWorldViewRef();\r\n            const worldViewWidth = worldView.current?.clientWidth || WIDTH;\r\n            const worldViewHeight = worldView.current?.clientHeight || FULL_HEIGHT;\r\n\r\n            setCanvasWidth(worldViewWidth);\r\n            if (smallMap) {\r\n                if (worldViewWidth < 576) {\r\n                    // Small screens\r\n                    setCanvasHeight(SMALL_HEIGHT / 2);\r\n                } else {\r\n                    setCanvasHeight(SMALL_HEIGHT);\r\n                }\r\n            }\r\n            else {\r\n                setCanvasHeight(worldViewHeight);\r\n            }\r\n        }\r\n        resize();\r\n        window.addEventListener(\"resize\", resize);\r\n        return () => {\r\n            window.removeEventListener(\"resize\", resize);\r\n        };\r\n    }, [retrieveWorldViewRef, smallMap]);\r\n\r\n    useEffect(() => {\r\n        if (selectedQuest) {\r\n            focusOnQuestingParty(selectedQuest);\r\n        }\r\n    }, [selectedQuest, canvasHeight])\r\n\r\n    const viewportRef = useRef<PixiViewport>(null);\r\n    useEffect(() => {\r\n        // focus on center of the map\r\n        if (viewportRef.current) {\r\n            const viewport = viewportRef.current;\r\n            const point = nodeLocationToPoint({ x: 0, y: 0 });\r\n            viewport.moveCenter(point.x / 2, point.y / 2 + 10);\r\n        }\r\n    }, [canvasWidth]);\r\n\r\n    const renderQuestlines = () => {\r\n        return activeQuests.map((quest) => {\r\n            const previousPositions = getPreviousPositions(quest);\r\n            return (\r\n                <QuestLine positions={previousPositions} key={quest.name} />\r\n            );\r\n        });\r\n    };\r\n\r\n    const renderMarkers = () => {\r\n        return activeQuests.map((quest) => {\r\n            const location = getQuestWorldLocation(quest);\r\n            const currentPosition = nodeLocationToPoint(location);\r\n            const leader = getQuestLeader(adventurers, quest)!;\r\n            const questDefinition: QuestDefinition = getDefinition(quest.name);\r\n            const progress: number = Math.floor(quest.progress);\r\n            const questNode: QuestNode = questDefinition.nodes[progress];\r\n\r\n            return (\r\n                <QuestMarker\r\n                    quest={quest}\r\n                    leader={leader}\r\n                    position={currentPosition}\r\n                    key={quest.name}\r\n                    selected={quest === selectedQuest}\r\n                    encounterActive={questNode.type === QuestNodeType.encounter}\r\n                    onClick={(q) => handlePartyClick(q.name)}\r\n                />\r\n            );\r\n        });\r\n    };\r\n\r\n\r\n    // puts the given party in the center of the map\r\n    const focusOnQuestingParty = (quest: QuestStoreState) => {\r\n        const viewport = viewportRef.current;\r\n        if (viewport) {\r\n            const partyLocation = getQuestWorldLocation(quest);\r\n            const point = nodeLocationToPoint(partyLocation);\r\n            viewport.moveCenter(point.x, point.y);\r\n        }\r\n    }\r\n\r\n    const handleMapClick = () => {\r\n        /// todo: close map\r\n        // if(smallMap === true && selectedQuest) {\r\n        //     props.onPartyClick(selectedQuest.name);\r\n        // }\r\n    }\r\n\r\n    const options = {\r\n        autoDensity: true,\r\n        sharedLoader: true,\r\n        width: canvasWidth,\r\n        height: canvasHeight,\r\n    }\r\n    return (\r\n        <div className=\"world-map\">\r\n            <Stage width={canvasWidth} height={canvasHeight} options={options}>\r\n                <Viewport screenWidth={canvasWidth} screenHeight={canvasHeight} worldWidth={WORLD_WIDTH} worldHeight={WORLD_HEIGHT} ref={viewportRef} >\r\n                    <Sprite\r\n                        image={`${process.env.PUBLIC_URL}/img/world/francesca-baerald-fbaerald-angeloumap-lowres.jpg`}\r\n                        interactive={true}\r\n                        pointerdown={handleMapClick}\r\n                    >\r\n                        {renderQuestlines()}\r\n                        {renderMarkers()}\r\n                    </Sprite>\r\n                    {/* <MapGrid width={WORLD_WIDTH} height={WORLD_HEIGHT} gridWidth={GRID_WIDTH} /> */}\r\n                </Viewport>\r\n            </Stage>\r\n            {props.selectedQuestName && (\r\n                <div className=\"title\">\r\n                    <span>\r\n                        <DebugToggleCombat questName={props.selectedQuestName} />\r\n                        {TextManager.getQuestTitle(props.selectedQuestName)}\r\n                    </span>\r\n                    <span onClick={() => handlePartyClick(props.selectedQuestName!)}>x</span>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\n\r\nexport default WorldMap;\r\n\r\nconst getQuestWorldLocation = (quest: QuestStoreState): { x: number; y: number; } => {\r\n    const questDefinition = getDefinition(quest.name);\r\n    const roundedProgress = Math.floor(quest.progress);\r\n    const lastNode = questDefinition.nodes[roundedProgress];\r\n\r\n    const nextNode = questDefinition.nodes[roundedProgress + 1];\r\n    if (!nextNode) {\r\n        // We've reached the last node\r\n        return lastNode;\r\n    }\r\n    return lerpLocation(lastNode, nextNode, quest.progress - roundedProgress);\r\n};\r\n\r\n// Node locations work on a centered coordinate system\r\nconst nodeLocationToPoint = (location: { x: number; y: number; }) => {\r\n    const x = location.x * GRID_WIDTH + WORLD_WIDTH / 2;\r\n    const y = location.y * GRID_WIDTH + WORLD_HEIGHT / 2;\r\n    return new PIXI.Point(x, y);\r\n}\r\n\r\nconst getPreviousPositions = (quest: QuestStoreState) => {\r\n    const positions: PIXI.Point[] = [];\r\n    const questDefinition = getDefinition(quest.name);\r\n\r\n    for (let i = 0; i < quest.progress; i++) {\r\n        positions.push(nodeLocationToPoint(questDefinition.nodes[i]))\r\n    }\r\n    const lastPosition = nodeLocationToPoint(getQuestWorldLocation(quest));\r\n    positions.push(lastPosition);\r\n    return positions;\r\n}\r\n\r\n\r\n// temporary\r\nconst DebugToggleCombat = ({ questName }: {questName: string}) => {\r\n    const quest = useQuest(questName);\r\n    const dispatch = useDispatch();\r\n\r\n    if (quest.scene?.combat) {\r\n        return (\r\n            <button onClick={() => dispatch(setCombat(questName, false))}>combat: on</button>\r\n        );\r\n    }\r\n    return (\r\n        <button onClick={() => dispatch(setCombat(questName, true))}>\r\n            combat: off\r\n        </button>\r\n    )\r\n}","import React, { useMemo,  useEffect, useRef, useCallback, PropsWithChildren, useState, memo } from 'react';\nimport { Container } from '@inlet/react-pixi';\nimport { MultiColorReplaceFilter } from 'pixi-filters';\nimport { SceneActionType, SceneAction } from 'store/types/scene';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { completeSceneAction } from 'store/actions/quests';\nimport { StoreState } from 'store/types';\nimport { gsap } from 'gsap';\nimport { BaseSceneController } from 'mechanics/scenes/BaseSceneController';\nimport SpriteAnimated from './SpriteAnimated';\n\nexport interface Props  {\n    name: string;\n    controller: BaseSceneController<any>;\n    location?: [number, number]; // tile coordinate space\n    idleAnimation?: boolean;\n};\n\nenum Orientation {\n    north = \"n\",\n    northEast = \"ne\",\n    east = \"e\",\n    southEast = \"se\",\n    south = \"s\",\n    southWest = \"sw\",\n    west = \"w\",\n    northWest = \"nw\"\n}\n\n// This is a wrapper that exposes a location property. Will set x and y on children\nconst SceneActor = (props: PropsWithChildren<Props> & React.ComponentProps<typeof Container>) => {\n    const {\n        location = [0, 0],\n        controller,\n        idleAnimation,\n        children,\n        ...rest\n    } = props;\n    const {tileWidth, tileHeight} = controller.getTileDimensions();\n    const actorRef = useRef<PIXI.Container>(null);\n    const previousAction = useRef<SceneAction>();\n    const dispatch = useDispatch();\n\n    const actionQueueSelector = useCallback(\n        (state: StoreState) => {\n            const quest = state.quests.find((q) => q.name === props.controller.questName)!;\n            if (!quest.scene!.actionQueue) {\n                return [];\n            }\n            return quest.scene!.actionQueue.filter(a => a.actorId === props.name);\n        },\n        [props.name, props.controller.questName]\n    );\n    const actionQueue = useSelector<StoreState, SceneAction[]>(actionQueueSelector);\n    const [animation, setAnimation] = useState(\"stand\");\n\n    const spritesheetPath = useMemo(() => {\n        return controller.getActorSpritesheetPath(props.name);\n    }, [controller, props.name]);\n\n    // Handle actions\n    useEffect(() => {\n        if (!actorRef) {\n            return;\n        }\n\n        // Determines orientation based on where the target is\n        const determineOrientation = () => {\n            if (location[0] === nextAction.target[0] && location[1] > nextAction.target[1]) {\n                setOrientation(Orientation.north);\n            }\n            else if (location[0] < nextAction.target[0] && location[1] > nextAction.target[1]) {\n                setOrientation(Orientation.northEast);\n            }\n            else if (location[0] < nextAction.target[0] && location[1] === nextAction.target[1]) {\n                setOrientation(Orientation.east);\n            }\n            else if (location[0] < nextAction.target[0] && location[1] < nextAction.target[1]) {\n                setOrientation(Orientation.southEast);\n            }\n            else if (location[0] === nextAction.target[0] && location[1] < nextAction.target[1]) {\n                setOrientation(Orientation.south);\n            }\n            else if (location[0] > nextAction.target[0] && location[1] < nextAction.target[1]) {\n                setOrientation(Orientation.southWest);\n            }\n            else if (location[0] > nextAction.target[0] && location[1] === nextAction.target[1]) {\n                setOrientation(Orientation.west);\n            }\n            else if (location[0] > nextAction.target[0] && location[1] > nextAction.target[1]) {\n                setOrientation(Orientation.northWest);\n            }\n        }\n        const nextAction = actionQueue[0];\n        if (nextAction) {\n            // console.log(`next action is ${nextAction.target} (${nextAction.actionType}), \\ncurrent location is: ${location}\\nprev action was ${previousAction?.current?.target} `)\n            switch (nextAction.actionType) {\n                case SceneActionType.move: {\n                    const moveComplete = () => {\n                        dispatch(completeSceneAction(props.controller.questName));\n                        props.controller.actorMoved(props.name, nextAction.target);\n                    }\n                    const duration = (nextAction.endsAt - performance.now()) / 1000;\n                    if (duration < 0) {\n                        moveComplete();\n                    }\n\n                    // determine orientation\n                    determineOrientation();\n                    setAnimation(\"walk\");\n                    gsap.killTweensOf(actorRef.current);\n                    gsap.to(actorRef.current, {\n                        duration,\n                        ease: \"linear\",\n                        pixi: {\n                            x: nextAction.target[0] * tileWidth,\n                            y: nextAction.target[1] * tileHeight\n                        },\n                        onComplete: moveComplete\n                    });\n                    break;\n                }\n                case SceneActionType.slash: {\n                    determineOrientation();\n                    setAnimation(\"attack\");\n                    const attackComplete = () => {\n                        setAnimation(\"stand\");\n                        dispatch(completeSceneAction(props.controller.questName));\n                        // props.controller.actorMoved(props.name, nextAction.target); todo\n                    }\n                    setTimeout(attackComplete, 1000);\n                }\n            }\n            previousAction.current = nextAction;\n        }\n\n    }, [dispatch, tileWidth, tileHeight, actionQueue, props.controller, props.name, location]);\n\n    const {x, y} = useMemo(() => {\n        setAnimation(\"stand\")\n\n        return {\n            x: location[0] * tileWidth,\n            y: location[1] * tileHeight,\n        };\n    }, [location, tileWidth, tileHeight]);\n\n    const [frames, setFrames] = useState<{ [key: string]: PIXI.Texture[]}|null>(null);\n\n    useEffect(() => {\n        if (!spritesheetPath) return;\n\n        const allFrames = Object.keys(PIXI.Loader.shared.resources[spritesheetPath].textures!);\n        const indexed = allFrames.reduce((acc: any, frame: string) => {\n            // frames are in the format of: 'stand-n', 'walk0-ne', 'walk1-ne' etc\n            // create a mapping with arrays keyed by the part without the number,\n            // eg: 'stand-n': [TEXTURE:stand-n] and 'walk-ne': [TEXTURE:walk0-ne, TEXTURE:walk1-ne]\n            const key = frame.replace(/[0-9]/g, '');\n            if (!acc[key]) {\n              acc[key] = [];\n            }\n            acc[key].push(PIXI.Loader.shared.resources[spritesheetPath].textures![frame]);\n            return acc;\n        }, {});\n        setFrames(indexed);\n    }, [spritesheetPath])\n\n    const [orientation, setOrientation] = useState<Orientation>(Orientation.north);\n    // const [flipped, setFlipped] = useState(false);\n    const flipped = useRef(false);\n    const setFlipped = (value:boolean) => {\n        flipped.current = value;\n    }\n\n    useEffect(() => {\n        setFlipped(orientation === Orientation.southWest || orientation === Orientation.west || orientation === Orientation.northWest)\n    }, [orientation]);\n\n    useEffect(() => {\n        if (!idleAnimation) return;\n\n        // Idle animation\n        // Randomly turn left or right\n        const randomOrientation = () => {\n            const left = Math.random() < .5;\n            if (orientation === Orientation.north && left) {\n                setOrientation(Orientation.northWest);\n            }\n            else if (orientation === Orientation.northWest && left) {\n                setOrientation(Orientation.west);\n            }\n            else if (orientation === Orientation.west && left) {\n                setOrientation(Orientation.southWest);\n            }\n            else if (orientation === Orientation.southWest && left) {\n                setOrientation(Orientation.south);\n            }\n            else if (orientation === Orientation.south && left) {\n                setOrientation(Orientation.southEast);\n            }\n            else if (orientation === Orientation.southEast && left) {\n                setOrientation(Orientation.east);\n            }\n            else if (orientation === Orientation.east && left) {\n                setOrientation(Orientation.northEast);\n            }\n            else if (orientation === Orientation.northEast && left) {\n                setOrientation(Orientation.north);\n            }\n            if (orientation === Orientation.north && !left) {\n                setOrientation(Orientation.northEast);\n            }\n            else if (orientation === Orientation.northEast && !left) {\n                setOrientation(Orientation.east);\n            }\n            else if (orientation === Orientation.east && !left) {\n                setOrientation(Orientation.southEast);\n            }\n            else if (orientation === Orientation.southEast && !left) {\n                setOrientation(Orientation.south);\n            }\n            else if (orientation === Orientation.south && !left) {\n                setOrientation(Orientation.southWest);\n            }\n            else if (orientation === Orientation.southWest && !left) {\n                setOrientation(Orientation.west);\n            }\n            else if (orientation === Orientation.west && !left) {\n                setOrientation(Orientation.northWest);\n            }\n            else if (orientation === Orientation.northWest && !left) {\n                setOrientation(Orientation.north);\n            }\n        }\n        const minDuration = 2000;\n        const maxDuration = 4000;\n        const duration = minDuration + Math.random() * maxDuration;\n        const interval = setInterval(randomOrientation, duration);\n        return () => clearInterval(interval);\n    }, [animation, idleAnimation, orientation])\n\n    const getFrames = useCallback(() => {\n        const prefix = '';\n        // const prefix = `${spritesheet.data.meta.image}-`;\n        switch (orientation) {\n            case Orientation.northWest:\n                return `${prefix}${animation}-${Orientation.northEast}`;\n            case Orientation.west:\n                return `${prefix}${animation}-${Orientation.east}`;\n            case Orientation.southWest:\n                return `${prefix}${animation}-${Orientation.southEast}`;\n            default:\n                return `${prefix}${animation}-${orientation}`;\n        }\n    }, [animation, orientation]);\n\n    return (\n        <Container x={x} y={y} ref={actorRef} {...rest}>\n            { spritesheetPath && frames && (\n                <SpriteAnimated\n                    animationSpeed={0.1}\n                    name=\"footman\"\n                    isPlaying={true}\n                    textures={frames[getFrames()]}\n                    x={50}\n                    y={30}\n                    scale={[(flipped.current ? -1 : 1), 1]}\n                    anchor={[.5, .5]}\n                    pivot={[0, 0]}\n                    filters={[\n                        createColorReplaceFilter(BLUES, PURPLE)\n                    ]}\n                />\n            )}\n            {children}\n        </Container>\n    )\n};\n\nexport default memo(SceneActor);\n\nconst createColorReplaceFilter = (from: number[], to: number[]) => {\n    const replacements = from.map((val, index) => {\n        return [\n            from[index], to[index]\n        ]\n    });\n    return new MultiColorReplaceFilter(replacements, 0.15);\n}\n\nconst BLUES = [\n    0x000e5f,\n    0x00227f,\n    0x0038a5,\n    0x0055cc,\n];\n\nconst REDS = [\n    0x570800,\n    0x700c00,\n    0x901000,\n    0xb51700\n];\n\nconst TEALS = [\n    0x00330d,\n    0x00653a,\n    0x08936f,\n    0x30bea5\n];\n\nconst PURPLE = [\n    0x3b0d3a,\n    0x641d5e,\n    0x884696,\n    0xaa61bd\n];\n\nconst ORANGE = [\n    0x802d0c,\n    0xaa4a12,\n    0xd16d11,\n    0xf59717\n];\n\nconst BLACK = [\n    0x0d0d1a,\n    0x1a1b2b,\n    0x25263a,\n    0x35354c\n];\n\nconst WHITE = [\n    0x30375e,\n    0x676993,\n    0xa9aac2,\n    0xe6e6e6\n];\n\nconst YELLOW = [\n    0xc28600,\n    0xd6ae10,\n    0xe9d333,\n    0xfdf959\n];","import React from \"react\";\nimport { Props as TabProps } from \"./Tab\";\nimport { SoundManager, Sound } from 'global/SoundManager';\nimport \"./styles/tabstrip.scss\";\n\nexport interface Props {\n    className?: string;\n    onClick?: React.MouseEventHandler<Element>;\n    onTabSelected?: (tabId: string) => void;\n    children: React.ReactElement<TabProps>[] |  React.ReactElement<TabProps>;\n    activeTab?: string;\n    disabled?: boolean;\n}\n\nconst Tabstrip = (props: Props) => {\n    let {activeTab = null} = props;\n    if (!activeTab && props.children && props.children) {\n        activeTab = props.children[0].props.id;\n    }\n    const className = `${props.className} ${(props.disabled ? \"disabled\" : \"\")}`;\n    const children = React.Children.map(props.children, (child: React.ReactElement<TabProps>) => {\n        const clone: React.ReactElement<TabProps> = React.cloneElement(child, {\n            active: child.props.id === activeTab,\n            onClick: () => { handleTabClick(child.props.id); }\n        });\n        return clone;\n    });\n\n    const handleTabClick = (tabId: string) => {\n        if (props.onTabSelected && props.disabled !== true) {\n            props.onTabSelected(tabId);\n        }\n    };\n\n    const handleClick = (e: React.MouseEvent<Element>) => {\n        SoundManager.playSound(Sound.buttonClick);\n        if (props.onClick) {\n            props.onClick(e);\n        }\n    };\n\n    return (\n        <ul className={`tabstrip ${className}`} onClick={handleClick}>\n            {children}\n        </ul>\n    );\n};\n\nexport default Tabstrip;\n","import * as React from \"react\";\n\nexport interface Props {\n    id: string;\n    className?: string;\n    onClick?: React.MouseEventHandler<Element>;\n    active?: boolean;\n    children?: any;\n}\n\ntype AllProps = Props;\n\nconst Tab = (props: AllProps) => {\n    const handleClick = (e: React.MouseEvent<HTMLLIElement>) => {\n        if (props.onClick) {\n            props.onClick(e);\n        }\n    };\n    const className = ((props.active) ? \"active\" : \"\") + (props.className || \"\");\n    return (\n        <li className={`tabstrip-tab ${className}`} onClick={handleClick}>\n            {props.children}\n        </li>\n    );\n};\n\nexport default Tab;\n","import Icon, { IconSize } from 'components/ui/common/Icon';\nimport * as React from \"react\";\nimport { AdventurerStoreState } from \"store/types/adventurer\";\nimport \"./styles/adventureravatar.scss\";\n\nexport interface Props {\n    adventurer: AdventurerStoreState;\n    className?: string;\n    displayName?: boolean;\n    onClick?: (adventurerId: string) => void;\n    size?: IconSize;\n}\n\n/**\n * The AdventurerAvatar displays the avatar of an adventurer\n */\nconst AdventurerAvatar = (props: Props) => {\n    const {\n        adventurer,\n        size\n    } = props;\n\n    const className = `${(props.className || \"\")} avatar`;\n\n    const handleClick = () => {\n        if (props.onClick) {\n            props.onClick(props.adventurer.id);\n        }\n    };\n    return (\n        <Icon\n            className={className}\n            image={adventurer.avatarImg}\n            size={size}\n            onClick={handleClick}\n        />\n    );\n};\n\nexport default AdventurerAvatar;\n","import React from \"react\";\nimport Tabstrip from 'components/ui/tabs/Tabstrip';\nimport { AdventurerStoreState } from 'store/types/adventurer';\nimport Tab from 'components/ui/tabs/Tab';\nimport AdventurerAvatar from 'components/ui/adventurer/AdventurerAvatar';\nimport { IconSize } from 'components/ui/common/Icon';\n\ninterface Props {\n    adventurers: AdventurerStoreState[];\n    selectedAdventurerId?: string;\n    onAdventurerTabSelected: (adventurerId: string) => void;\n    disabled?: boolean;\n}\n\n// Shows adventurer portraits in a tabstrip\nconst AdventurerTabstrip = (props: Props) => {\n    const {adventurers, onAdventurerTabSelected} = props;\n\n    const handleAdventurerTabSelected = (adventurerId: string) => {\n        const adventurer = props.adventurers.find(a => a.id === adventurerId)!;\n        onAdventurerTabSelected(adventurer.id);\n    }\n\n    const renderAdventurerTab = (adventurer: AdventurerStoreState) => (\n        <Tab id={adventurer.id} key={adventurer.id}>\n            <AdventurerAvatar adventurer={adventurer} size={IconSize.small}/>\n        </Tab>\n    );\n    return (\n        <Tabstrip\n            className=\"adventurers-tabstrip\"\n            onTabSelected={handleAdventurerTabSelected}\n            activeTab={props.selectedAdventurerId}\n            disabled={props.disabled}\n        >\n            {adventurers.map((a) => renderAdventurerTab(a))}\n        </Tabstrip>\n    )\n}\n\nexport default AdventurerTabstrip;","import { createSelector } from \"reselect\";\nimport { adventurersOnQuest } from 'store/helpers/storeHelpers';\nimport { StoreState } from 'store/types';\nimport { AdventurerStoreState } from \"store/types/adventurer\";\nimport { QuestStatus, QuestStoreState } from 'store/types/quest';\n\n// maybe this is not used anymore?\n\n// Store accessors\nconst getAdventurers = (state: StoreState): AdventurerStoreState[] => state.adventurers;\nconst getQuests = (state: StoreState): QuestStoreState[] => state.quests;\n\nconst groupAdventurersByQuest = (adventurers: AdventurerStoreState[], quests: QuestStoreState[]): Record<string, AdventurerStoreState[]> => {\n    const foundInParty: AdventurerStoreState[] = []; // store the adventurers in parties in a temp array\n\n\n    const groupedAdventurers = Object.values(quests).reduce((acc, val: QuestStoreState) => {\n        const foundAdventurers = adventurersOnQuest(adventurers, val);\n        if (val.status === QuestStatus.active) {\n            // Only active quests\n            acc[val.name] = foundAdventurers;\n        }\n        foundInParty.push(...foundAdventurers);\n        return acc;\n    }, {});\n\n    // Add a special group called 'solo' for those adventurers not in a party\n    const soloKey = \"solo\";\n    groupedAdventurers[soloKey] = adventurers.filter((a) => foundInParty.indexOf(a) === -1);\n\n    return groupedAdventurers;\n};\n\nconst getAdventurersInTown = (adventurers: AdventurerStoreState[], quests: QuestStoreState[]): AdventurerStoreState[] => {\n    // Get an array of all adventurer ids on any active quest\n    const adventurersOnQuest = quests.reduce<string[]>((acc, val: QuestStoreState) => {\n        if (val.status === QuestStatus.active) {\n            acc.push(...val.party);\n        }\n        return acc;\n    }, []);\n\n    return adventurers.filter((a) => adventurersOnQuest.indexOf(a.id) === -1);\n};\n\n/** Returns an object keyed by active quests whose value is a list of AdventurerStoreState */\nexport const selectAdventurersGroupedByQuest = createSelector([\n    getAdventurers,\n    getQuests],\n    groupAdventurersByQuest,\n);\n\n/** Returns a selector keyed by active quests whose value is a list of AdventurerStoreState */\nexport const createSelectAdventurersOnQuest = (questName: string) => {\n    const getAdventurersOnQuest = (adventurers: AdventurerStoreState[], quests: QuestStoreState[]): AdventurerStoreState[] => {\n        const quest = quests.find(q => q.name === questName)!;\n        return adventurersOnQuest(adventurers, quest);\n    };\n\n    return createSelector([\n        getAdventurers,\n        getQuests],\n        getAdventurersOnQuest,\n    );\n}\n\n/** Returns an object keyed by active quests whose value is a list of AdventurerStoreState */\nexport const selectAdventurersInTown = createSelector([\n    getAdventurers,\n    getQuests],\n    getAdventurersInTown,\n);\n","import { PixiComponent } from \"@inlet/react-pixi\";\nimport * as PIXI  from 'pixi.js';\nimport { TiledLayerData, TiledTilesetData } from 'constants/tiledMapData';\nimport { CompositeRectTileLayer } from 'pixi-tilemap';\n\n\ninterface Props  {\n    // texture: PIXI.Texture;\n    horizontalTiles: number;\n    layer: TiledLayerData;\n    tilesets: TiledTilesetData[];\n    spritesheets: {[key: string]: PIXI.Spritesheet}\n}\n\nconst RectTileLayer = PixiComponent<Props, any>(\"RectTileLayer\", {\n    create(props: Props) {\n        // @ts-ignore\n        const tileLayer = new CompositeRectTileLayer();\n        return tileLayer;\n    },\n\n    applyProps(instance, oldProps: Props, props: Props) {\n        const {layer, tilesets, horizontalTiles, spritesheets} = props;\n        if (!layer.data) {\n            return;\n        }\n        for (let i = 0; i < layer.data.length; i++) {\n            const tileset = findTileset(layer.data[i], tilesets);\n            if (!tileset) continue;\n\n            const w = tileset.tilewidth;\n            const h = tileset.tileheight;\n            const x = (i % horizontalTiles) * w;\n            const y = Math.floor(i / horizontalTiles) * h;\n            const spritesheet = spritesheets[tileset.name];\n\n            if (layer.data[i] > 0) {\n                const spriteId = `${tileset.name}-${layer.data[i]}`;\n                instance.addFrame(spritesheet.textures[spriteId], x, y);\n            }\n        }\n    }\n});\n\nexport default RectTileLayer;\n\n\n// finds tileset based on gid\nconst findTileset = (gid: number, tilesets: TiledTilesetData[]) => {\n    let tileset;\n    for (let i = tilesets.length - 1; i >= 0; i--) {\n        tileset = tilesets[i];\n        if (tileset.firstgid <= gid) {\n            break;\n        }\n    }\n    return tileset;\n}\n","import React from 'react';\nimport { TiledMapData, TiledLayerData, TiledTilesetData, TiledLayerType } from 'constants/tiledMapData';\nimport { Container } from '@inlet/react-pixi';\nimport RectTileLayer from 'components/pixi/tile/RectTileLayer';\nimport * as PIXI from 'pixi.js';\n\ninterface Props {\n    basePath: string;\n    data: TiledMapData;\n    spritesheets: {[key: string]: PIXI.Spritesheet}\n}\n\nconst Tilemap = (props: Props) => {\n    const {data, spritesheets} = props;\n\n    return (\n        <Container >\n            {data.layers\n                .filter(l => l.visible && l.type === TiledLayerType.tilelayer)\n                .map(layer => createTileLayer(layer, data.width, data.tilesets, spritesheets))\n            }\n\n        </Container>\n    );\n}\n\nexport default Tilemap;\n\nconst createTileLayer = (layer: TiledLayerData, horizontalTiles: number, tilesets: TiledTilesetData[], spritesheets: {[key: string]: PIXI.Spritesheet}) => {\n    return (\n        <RectTileLayer\n            key={layer.name}\n            layer={layer}\n            horizontalTiles={horizontalTiles}\n            tilesets={tilesets}\n            spritesheets={spritesheets}\n        />\n    );\n}\n","import React from \"react\";\nimport { ReactReduxContext, Provider } from 'react-redux';\nimport { Stage } from '@inlet/react-pixi';\n\n// Contexts are not passed through the reconcilers with the new Context API.\n// This means we lose the redux context\n// Create a wrapper component that consumes the context and provides it again in the new reconciler context:\n// https://github.com/inlet/react-pixi/issues/77\nconst BridgedStage = (props: React.ComponentProps<typeof Stage>) => {\n    const { children, ...restProps } = props;\n    return (\n        <ReactReduxContext.Consumer>\n            {({ store }) => (\n                <Stage {...restProps}>\n                    <Provider store={store}>\n                        {children}\n                    </Provider>\n                </Stage>\n            )}\n        </ReactReduxContext.Consumer>\n    );\n}\n\nexport default BridgedStage;\n","import { PixiComponent, applyDefaultProps, AnimatedSprite } from '@inlet/react-pixi';\nimport * as PIXI from 'pixi.js';\nimport { memo } from 'react';\n\nconst SpriteAnimated = PixiComponent<React.ComponentProps<typeof AnimatedSprite>, PIXI.AnimatedSprite>('SpriteAnimated', {\ncreate: ({ textures }) => {\n    const animatedSprite = new PIXI.AnimatedSprite(textures || [], true);\n    return animatedSprite;\n  },\n  applyProps: (instance, oldProps, newProps) => {\n    if(oldProps.textures !== newProps.textures){\n      applyDefaultProps(instance, oldProps, newProps);\n      instance.gotoAndPlay(0);\n    }\n  },\n});\n\n// export default memo(SpriteAnimated);\nexport default SpriteAnimated;\n\n","import React, { useRef, forwardRef, useImperativeHandle } from \"react\";\nimport { Graphics } from '@inlet/react-pixi';\n\n// tslint:disable-next-line: no-empty-interface\ninterface Props {\n\n}\n\nexport interface RefActions {\n    drawAction: (from: PIXI.Point, to: PIXI.Point, allowed?: boolean) => void;\n    clear: () => void;\n    parent: PIXI.Container;\n}\n/**\n * ActionPath shows a line previewing the action the user is taking on a scene\n * @param props\n */\nconst ActionPath = forwardRef((props: Props, ref: React.Ref<RefActions>) => {\n    const graphicsRef = useRef<PIXI.Graphics>(null);\n\n    useImperativeHandle(ref, () => {\n        // console.log(graphicsRef.current.parent)\n        return {\n            drawAction: (from: PIXI.Point, to: PIXI.Point, allowed: boolean = true)=> {\n                const grfx = graphicsRef.current;\n                if (!grfx) return;\n                const color = allowed ? 0x00FF00 : 0xFF3300;\n                grfx.clear()\n                    .lineStyle(3, color)\n                    .moveTo(from.x, from.y)\n                    .lineTo(to.x, to.y);\n            },\n            clear: () => {\n                const grfx = graphicsRef.current;\n                grfx?.clear();\n            },\n            parent: graphicsRef.current?.parent!\n        }\n    });\n\n    return (\n        <Graphics\n            name=\"ActionPath\"\n            ref={graphicsRef}\n        />\n    )\n});\n\nexport default ActionPath;\n\n","import { AdventurerStoreState } from 'store/types/adventurer';\nimport { QuestStoreState, QuestStatus } from 'store/types/quest';\nimport { StoreState } from 'store/types';\nimport { useSelector } from 'react-redux';\nimport { useMemo, useCallback } from 'react';\nimport { EquipmentSlotType } from 'components/ui/adventurer/EquipmentSlot';\nimport { Item } from 'definitions/items/types';\nimport { getDefinition } from 'definitions/items/apparel';\n\nconst getAdventurersInTown = (adventurers: AdventurerStoreState[], quests: QuestStoreState[]): AdventurerStoreState[] => {\n    // Get an array of all adventurer ids on any active quest\n    const adventurersOnQuest = quests.reduce<string[]>((acc, val: QuestStoreState) => {\n        if (val.status === QuestStatus.active) {\n            acc.push(...val.party);\n        }\n        return acc;\n    }, []);\n\n    return adventurers.filter((a) => adventurersOnQuest.indexOf(a.id) === -1);\n};\n\n/** Returns all the adventurers currently not on a mission */\nexport const useAdventurersInTown = () => {\n    const adventurers = useSelector<StoreState, AdventurerStoreState[]>(store => store.adventurers);\n    const quests = useSelector<StoreState, QuestStoreState[]>(store => store.quests);\n\n    const adventurersInTown = useMemo(() => {\n        return getAdventurersInTown(adventurers, quests)\n    }, [adventurers, quests]);\n\n    return adventurersInTown;\n}\n\n/** Returns the adventurer from store */\nexport const useAdventurerState = (adventurerId: string) => {\n    const adventurerSelector = useCallback(\n        (state: StoreState) => state.adventurers.find((q) => q.id === adventurerId)!,\n        [adventurerId]\n    );\n    return useSelector<StoreState, AdventurerStoreState>(adventurerSelector);\n}\n\n/* Returns a map keyed by EquipmentSlotType with DR of an adventurer.\n   0 if nothing worn or if item does not have DR */\nexport const useAdventurerDamageReduction = (adventurerId: string): { [key: string]: number } => {\n    const adventurer = useAdventurerState(adventurerId);\n    const findDR = (type: EquipmentSlotType) => {\n        const item: Item = adventurer.equipment[EquipmentSlotType[type]];\n        if (!item) return 0;\n        return getDefinition(item).damageReduction || 0;\n    }\n    return {\n        [EquipmentSlotType[EquipmentSlotType.head]]: findDR(EquipmentSlotType.head),\n        [EquipmentSlotType[EquipmentSlotType.chest]]: findDR(EquipmentSlotType.chest),\n        [EquipmentSlotType[EquipmentSlotType.hands]]: findDR(EquipmentSlotType.hands),\n        [EquipmentSlotType[EquipmentSlotType.shoulders]]: findDR(EquipmentSlotType.shoulders),\n        [EquipmentSlotType[EquipmentSlotType.legs]]: findDR(EquipmentSlotType.legs),\n        [EquipmentSlotType[EquipmentSlotType.feet]]: findDR(EquipmentSlotType.feet),\n    }\n}\n\n\n\n","import React, { useRef, forwardRef, useImperativeHandle } from \"react\";\nimport { Text } from '@inlet/react-pixi';\n\n// deprecated!\n// tslint:disable-next-line: no-empty-interface\ninterface Props {\n    tileWidth: number;\n    tileHeight: number;\n}\n\nexport interface RefActionPoints {\n    drawAp: (location: [number, number], ap: number) => void;\n    clear: () => void;\n    parent: PIXI.Container;\n}\n/**\n * @param props\n */\nconst ActionPoints = forwardRef((props: Props, ref: React.Ref<RefActionPoints>) => {\n    const textRef = useRef<PIXI.Text>(null);\n    const { tileWidth, tileHeight } = props;\n\n    useImperativeHandle(ref, () => {\n        return {\n            drawAp: (location: [number, number], ap: number)=> {\n                if(textRef.current) {\n                    textRef.current.x = tileWidth * location[0] + tileWidth / 2;\n                    textRef.current.y = tileHeight * location[1] + tileHeight / 2;\n                    textRef.current.text = `${ap}`;\n                    textRef.current.visible = true;\n\n                }\n            },\n            clear: () => {\n                if(textRef.current) {\n                    textRef.current.visible = false;\n                }\n            },\n            parent: textRef.current?.parent!\n        }\n    });\n\n    return (\n        <Text\n            name=\"ActionPoints\"\n            ref={textRef}\n            anchor={[0.5, 0.5]}\n            style={\n                {fontFamily : 'Gabriela', fontSize: 42, fill : 0xff1010, align : 'center'}\n            }\n        />\n    )\n});\n\nexport default ActionPoints;\n\n","import { Container, Graphics, Sprite } from '@inlet/react-pixi';\nimport React, { useRef, useEffect, memo } from 'react';\nimport SceneActor, { Props as SceneActorProps } from './SceneActor';\nimport useQuest from 'hooks/store/useQuest';\nimport ActionPath, { RefActions } from './ActionPath';\nimport { useAdventurerState } from 'hooks/store/adventurers';\nimport ActionPoints, { RefActionPoints } from './ActionPoints';\nimport useSceneAdventurerActions from 'hooks/actions/useSceneAdventurerActions';\n\ninterface Props  {\n    adventurerId: string;\n    selected: boolean;\n    setSelectedAdventurer: (actor: string) => void;\n    // setCombatUILocation: (location: [number, number]) => void\n};\n\n// The adventurers avatar on the scene\nconst SceneAdventurer = (props: Props & Omit<SceneActorProps, 'children'|'name'>) => {\n    const {\n        controller,\n        location,\n        adventurerId,\n        selected,\n        // setCombatUILocation,\n    } = props;\n    const {tileWidth, tileHeight} = controller.getTileDimensions();\n\n    const adventurer = useAdventurerState(adventurerId);\n    const ref = useRef<PIXI.Container>(null);\n    \n    // Draw a line to indicate the action to take\n    const actionPathRef = useRef<RefActions>(null);\n    const actionPointsRef = useRef<RefActionPoints>(null);\n    // const {\n    //     adventurerStartDrag,\n    //     adventurerEndDrag,\n    // } = useSceneAdventurerActions(adventurerId, ref, controller, actionPointsRef, setCombatUILocation);\n\n    // const handleAdventurerStartDrag = () => {\n    //     adventurerStartDrag();\n    //     props.setSelectedAdventurer(adventurerId);\n    // }\n\n    // const handleAdventurerEndDrag = (event: PIXI.InteractionEvent) => {\n    //     adventurerEndDrag(event);\n    // }\n\n    return (\n        <Container interactive={true} ref={ref}>\n            <ActionPath ref={actionPathRef} />\n            <ActionPoints ref={actionPointsRef} tileWidth={tileWidth} tileHeight={tileHeight} />\n            <SceneActor\n                name={adventurerId}\n                controller={controller}\n                location={location}\n                interactive={true}\n                // pointerdown={handleAdventurerStartDrag}\n                // pointerup={handleAdventurerEndDrag}\n                // pointerupoutside={handleAdventurerEndDrag}\n                // hitArea={new PIXI.Rectangle(location?.[0], location?.[1], tileWidth, tileHeight)}\n                idleAnimation={Math.random() < 0.5}\n            >\n                {selected && (\n                    <Graphics\n                        name=\"selectioncircle\"\n                        draw={graphics => {\n                            const line = 3;\n                            graphics.lineStyle(line, 0xFFFFFF);\n                            graphics.drawCircle(tileWidth / 2, tileHeight / 2, tileWidth / 2 - line);\n                            graphics.endFill();\n                        }}\n                    />\n                )}\n                {/* <Sprite\n                    y={-80}\n                    image={`${process.env.PUBLIC_URL}/img/scene/actors/wizard.png`}\n                /> */}\n                <Sprite\n                    scale={.1}\n                    anchor={.5}\n                    x={tileWidth / 2}\n                    y={-30}\n                    image={`${process.env.PUBLIC_URL}/${adventurer.avatarImg}`}\n                />\n                { (selected && controller.actorCanInteract(adventurerId)) && (\n                    <Container\n                        interactive={true}\n                        pointerdown={() => {controller.actorInteract(adventurerId)}}\n                    >\n                        {/* <Graphics\n                            draw={graphics => {\n                                graphics.beginFill(0xDE3249);\n                                graphics.drawCircle(tileWidth / 2, tileHeight, tileWidth / 4);\n                                graphics.endFill();\n                            }}\n                        /> */}\n                        <Sprite\n                            image={`${process.env.PUBLIC_URL}/img/scene/ui/background.png`}\n                            width={tileWidth / 2}\n                            height={tileWidth / 2}\n                            y={tileHeight}\n                            x={tileWidth/2}\n                            anchor={.5}\n                        />\n                        <Sprite\n                            image={`${process.env.PUBLIC_URL}/img/scene/ui/interact.png`}\n                            width={tileWidth / 2}\n                            height={tileWidth / 2}\n                            y={tileHeight}\n                            x={tileWidth/2}\n                            anchor={.5}\n                        />\n                    </Container>\n                )}\n            </SceneActor>\n        </Container>\n    )\n}\n\nexport default memo(SceneAdventurer);\n","import { useState, useEffect } from \"react\";\n\nimport { loadResource } from \"utils/pixiJs\";\nimport { TiledTilesetData } from 'constants/tiledMapData';\nimport { SpritesheetData, SpriteData } from 'constants/spritesheetData';\n\nconst useTilesetsLoader = (basePath: string) => {\n    const [tileSpritesheets, setTilesets] = useState<{[key: string]: PIXI.Spritesheet}>({});\n    const [data, setData] = useState<TiledTilesetData[]>();\n\n    const loadTilesets = (value: TiledTilesetData[]) => {\n        setData(value);\n    };\n\n    useEffect(() => {\n        if (!data) return;\n        const nextTileset = nextTilesetToload(data, tileSpritesheets);\n        if (!nextTileset) return;\n\n        const tilesetName = nextTileset.name;\n\n        loadResource(`${basePath}/${nextTileset.image}`, (resource) => {\n            if (resource.error) {\n                throw new Error(`Loading ${basePath}\\n${resource.error}`);\n            }\n            const spritesheetData = parseSpritesheetData(nextTileset);\n            const spritesheet = new PIXI.Spritesheet(resource.texture, spritesheetData);\n\n            spritesheet.parse(() => {\n                const newTilesets = {\n                    ...tileSpritesheets,\n                    [tilesetName]: spritesheet\n                }\n                setTilesets(newTilesets);\n            })\n        });\n    }, [data, basePath, tileSpritesheets]);\n\n    const loadComplete = !!data && nextTilesetToload(data, tileSpritesheets) === undefined;\n\n    return {\n        loadComplete,\n        loadTilesets,\n        tileSpritesheets\n    }\n}\n\nexport default useTilesetsLoader;\n\n// Returns a TiledTilesetData that has not been loaded into tilesetsTextures yet\nconst nextTilesetToload = (tilesets: TiledTilesetData[], tilesetsTextures: {[key: string]: PIXI.Spritesheet}) => {\n    return tilesets.find((t) => {\n        return !tilesetsTextures[t.name];\n    })\n}\n\n\nconst parseSpritesheetData = (tileset: TiledTilesetData): SpritesheetData => {\n    const columns = tileset.columns;\n\n    const frames: { [name: string]: SpriteData } = {};\n    for (let i = 0; i < tileset.tilecount; i++) {\n        const w = tileset.tilewidth;\n        const h = tileset.tileheight;\n        const x = (i % columns) * w;\n        const y = Math.floor(i / columns) * h;\n\n        frames[`${tileset.name}-${i + tileset.firstgid}`] = {\n            frame: {x, y, w, h},\n            spriteSourceSize: {x, y, w, h},\n            rotated: false,\n            trimmed: false,\n            sourceSize: { w, h}\n        };\n    }\n    const image = tileset.image;\n    const size = { w: tileset.imagewidth, h: tileset.imageheight };\n    return {\n        frames,\n        meta: {\n            image,\n            size,\n            scale: 1\n        }\n    };\n}\n","\nimport { Container } from '@inlet/react-pixi';\nimport React, { useMemo, forwardRef, PropsWithChildren } from 'react';\nimport { BaseSceneController } from 'mechanics/scenes/BaseSceneController';\n\ninterface Props {\n  controller: BaseSceneController<any>;\n  location?: [number, number]; // tile coordinate space\n};\n\n// This is a wrapper that exposes a location property. Will set x and y on children\nconst SceneObjectWrapper = forwardRef<PIXI.Container, PropsWithChildren<Props>>((props, ref) => {\n    const {\n        location = [0, 0],\n        controller,\n        children\n    } = props;\n    const tileWidth = controller.mapData?.tilewidth!;\n    const tileHeight = controller.mapData?.tileheight!;\n\n    const {x, y} = useMemo(() => {\n        return {\n            x: location[0] * tileWidth,\n            y: location[1] * tileHeight,\n        };\n    }, [location, tileWidth, tileHeight]);\n\n    return (\n        <Container x={x} y={y} ref={ref}>\n            {children}\n        </Container>\n    )\n});\n\nexport default SceneObjectWrapper;\n","import React, {  } from \"react\";\nimport SceneObjectWrapper from './SceneObjectWrapper';\nimport { SceneObject } from 'store/types/scene';\nimport { BaseSceneController } from 'mechanics/scenes/BaseSceneController';\nimport { Sprite } from '@inlet/react-pixi';\nimport { TiledTilesetData } from 'constants/tiledMapData';\n\nconst renderObject = (object: SceneObject, controller: BaseSceneController<any>, spritesheets: {[key: string]: PIXI.Spritesheet} ) => {\n\n    if (object.gid){\n        // const tilesets = controller.mapData!.tilesets;\n        const tileset = findTileset(object.gid, controller.mapData!.tilesets);\n        const spritesheet = spritesheets[tileset.name]\n        return (\n            <SceneObjectWrapper\n                key={`${object.name}${object.location[0]}${object.location[1]}`}\n                controller={controller}\n                location={object.location}\n            >\n                <Sprite\n                    name={object.name}\n                    texture={spritesheet.textures[`${tileset.name}-${object.gid}`]}\n                />\n            </SceneObjectWrapper>\n        )\n    }\n    return  <div/>\n}\n\nexport default renderObject;\n\nconst findTileset = (gid: number, tilesets: TiledTilesetData[]) => {\n    for (let i = tilesets.length - 1; i >= 0; i--) {\n        if (tilesets[i].firstgid <= gid) {\n            return tilesets[i];\n        }\n    }\n    return tilesets[0];\n}\n","import React from 'react';\nimport \"./styles/loadingSpinner.scss\";\n\nconst LoadingSpinner = () => {\n    const rings = 5;\n    return (\n        <div className=\"loading-spinner\">\n        {[...Array(rings)].map((e, i) => (\n            <div className=\"ring\" key={i}>\n                <div className=\"inner\"/>\n            </div>\n        ))}\n        </div>\n    );\n}\nexport default LoadingSpinner;","import React, { createContext, PropsWithChildren, useState, useMemo, useEffect } from 'react';\nimport { SceneControllerManager } from 'global/SceneControllerManager';\nimport { BaseSceneController } from 'mechanics/scenes/BaseSceneController';\nimport { useStore } from 'react-redux';\nimport { StoreState } from 'store/types';\nimport LoadingSpinner from 'components/ui/loading/LoadingSpinner';\n\nexport const SceneControllerContext = createContext<BaseSceneController<any> | null>(null);\n\nexport interface Props {\n    questName: string;\n}\n\nconst SceneControllerContextProvider = (props: PropsWithChildren<Props>) => {\n    const {questName, children} = props;\n    const store = useStore<StoreState>();\n    const [loaded, setLoaded] = useState<boolean>(false);\n    const storeState = store.getState();\n    const quest = storeState.quests.find(q => q.name === questName)!;\n    const {scene, sceneName} = quest;\n\n    const controller = useMemo(() => {\n        if (!sceneName) {\n            return null;\n        }\n        return SceneControllerManager.getSceneController(questName, sceneName, store);\n    }, [questName, sceneName, store]);\n\n    useEffect(() => {\n        if (sceneName && controller) {\n            setLoaded(false);\n            const loadingComplete = () => {\n                setLoaded(true);\n\n                // If the store has no scene for this quest yet, create and store it!\n                if (!scene && controller) {\n                    controller.createScene();\n                    controller.sceneEntered();\n                }\n            }\n            controller.loadData(loadingComplete);\n        }\n    }, [controller, questName, scene, sceneName]);\n\n    if (controller && (!controller.dataLoaded || !loaded)) {\n        return (\n            <LoadingSpinner />\n        );\n    }\n    return (\n        <SceneControllerContext.Provider value={controller}>\n            {children}\n        </SceneControllerContext.Provider>\n    );\n};\n\nexport default SceneControllerContextProvider;","import React, { useEffect, useMemo, useState } from 'react';\n\ninterface Props {\n    position: \"w\" | \"sw\" | \"s\" | \"se\" | \"e\";\n    icon?: string;\n    onActivate?: () => void;\n    onDeactivate?: () => void;\n}\n\nconst Segment = (props: Props) => {\n    const {icon, onActivate, onDeactivate} = props;\n    const segmentWidth = 32;\n    const segmentHeight = 46;\n    const tileWidth = 100;\n    const tileHeight = 100;\n    const rot = useMemo(() => {\n        switch (props.position) {\n            case \"w\": return 180;\n            case \"sw\": return 135;\n            case \"s\": return 90;\n            case \"se\": return 45;\n            default: return 0;\n        }\n    }, [props.position]);\n\n    const style = {\n        transform: `translate(${segmentWidth}px, ${tileHeight/2 - segmentHeight/2}px) rotate(${rot}deg) translateX(44px)`,\n        background: `url(${process.env.PUBLIC_URL}/img/scene/ui/combat/ring-segment.svg)`,\n        width: segmentWidth,\n        height: segmentHeight\n    }\n\n    // const rotate = true;\n    // useEffect(() => {\n    //     if (rotate){\n    //         setTimeout(() => {\n    //             console.log(rot)\n    //             setRot(rot + 1)\n    //         }, 3)\n    //     }\n\n    // }, [rot]);\n\n    return (\n        <div\n            style={style}\n            className=\"segment\"\n            onMouseOver={onActivate}\n            onMouseOut={onDeactivate}\n        >\n            <img\n                src={icon}\n                style={{\n                    transform: `rotate(-${rot}deg)`,\n                    width: segmentWidth - 4\n                }}\n                alt=\"\"\n            />\n        </div>\n    )\n}\n\nexport default Segment;\n\n\n","import { SceneControllerContext } from 'components/world/QuestPanel/context/SceneControllerContext';\nimport React, { useContext, useEffect, useState } from 'react';\nimport { SceneActionType } from 'store/types/scene';\nimport { ActionIntent } from '../SceneUI';\nimport Segment from './Segment';\nimport \"./styles/combatUIWidget.scss\";\n\ninterface Props {\n    location: [number, number];\n    actionIntent?: ActionIntent;\n\n    onActionChange: (action?: SceneActionType) => void;\n}\n\n// CombatUIWidget shows a circle\nconst CombatUIWidget = (props: Props) => {\n    const {location, actionIntent, onActionChange} = props;\n    const segmentWidth = 32;\n    const segmentHeight = 46;\n    const controller = useContext(SceneControllerContext)!;\n    const {tileWidth, tileHeight} = controller.getTileDimensions();\n    const transform = `translate(${tileWidth * location[0]}px, ${tileHeight * location[1]}px)`;\n    const [collapsed, setCollapsed] = useState(true);\n    // const rotate = true;\n    // useEffect(() => {\n    //     if (rotate){\n    //         setTimeout(() => {\n    //             console.log(rot)\n    //             setRot(rot + 1)\n    //         }, 3)\n    //     }\n\n    // }, [rot]);\n\n    const handleMouseMove = (e: React.MouseEvent) => {\n        e.preventDefault();\n        e.stopPropagation();\n    }\n\n    const handleMouseOver = () => {\n        setCollapsed(false);\n    }\n\n    const handleMouseOut = () => {\n        // setCollapsed(true); // todo enable\n    }\n\n    const handleSegmentActivate = (action: SceneActionType) => {\n        onActionChange(action);\n\n        // const ap = controller.calculateWalkApCosts(location, location);\n\n    }\n\n    const handleSegmentDeactivate = (_action: SceneActionType) => {\n        onActionChange(undefined);\n        //setText(\"\") // todo enablee\n    }\n\n    \n    return (\n        <div\n            className={`combat-ui-widget ${collapsed ? \"collapsed\" : \"expanded\"}`}\n            style={{ transform }}\n            onMouseMove={handleMouseMove}\n            onMouseOver={handleMouseOver}\n            onMouseOut={handleMouseOut}\n        >\n            <Segment\n                position=\"w\"\n                icon={`${process.env.PUBLIC_URL}/img/scene/ui/combat/icons/knife-thrust.svg`}\n                onActivate={() => handleSegmentActivate(SceneActionType.slash)}\n                onDeactivate={() => handleSegmentDeactivate(SceneActionType.slash)}\n            />\n            <Segment position=\"sw\" icon={`${process.env.PUBLIC_URL}/img/scene/ui/combat/icons/high-shot.svg`}/>\n            <Segment\n                position=\"s\"\n                icon={`${process.env.PUBLIC_URL}/img/scene/ui/combat/icons/walking-boot.svg`}\n                onActivate={() => handleSegmentActivate(SceneActionType.move)}\n                onDeactivate={() => handleSegmentDeactivate(SceneActionType.move)}\n            />\n            <Segment position=\"se\" icon={`${process.env.PUBLIC_URL}/img/scene/ui/combat/icons/sunken-eye.svg`}/>\n            <Segment position=\"e\" icon={`${process.env.PUBLIC_URL}/img/scene/ui/combat/icons/crosshair.svg`}/>\n            <div className=\"info\" style={{ width: tileWidth }}>\n                {getText(actionIntent)}\n            </div>\n        </div>\n    )\n}\n\nexport default CombatUIWidget;\n\nconst getText = (actionIntent?: ActionIntent) => {\n    if (!actionIntent) return null;\n    if (actionIntent.action === SceneActionType.move) {\n        if (!actionIntent.path?.length) {\n            // no path possible\n            return null;\n        }\n        const insufficient = (actionIntent.actorAP || 0) < (actionIntent.apCost || 0);\n        return (\n            <>\n            <span>\n                Move\n            </span>\n            <span className={`${(insufficient) ? \"insufficient\": \"\"}`}>\n                {` ${actionIntent.apCost}`}AP\n            </span>\n            </>\n        );\n    }\n    if (actionIntent.action === SceneActionType.slash) {\n        if (!actionIntent.path?.length) {\n            // no path possible\n            return null;\n        }\n        const insufficient = (actionIntent.actorAP || 0) < (actionIntent.apCost || 0);\n        return (\n            <>\n            <span>\n                Slash\n            </span>\n            <span className={`${(insufficient) ? \"insufficient\": \"\"}`}>\n                {` ${actionIntent.apCost}`}AP\n            </span>\n            </>\n        );\n    }\n    return \"?\";\n}","import React from 'react';\nimport { SceneControllerContext } from 'components/world/QuestPanel/context/SceneControllerContext';\nimport { useContext } from 'react';\nimport \"./styles/normalUICursor.scss\";\n\ninterface Props {\n    location: [number, number];\n}\n\nconst NormalUICursor = (props: Props) => {\n    const {location} = props;\n    const controller = useContext(SceneControllerContext)!;\n\n    const blocked = controller.locationIsBlocked(location);\n    const {tileWidth, tileHeight} = controller.getTileDimensions();\n    const transform = `translate(${tileWidth * location[0]}px, ${tileHeight * location[1]}px)`;\n    const backgroundImage = `url(${process.env.PUBLIC_URL}/img/scene/ui/combat/icons/walking-boot.svg)`;\n    const width = tileWidth;\n    const height = tileHeight;\n    return (\n        <div\n            className={`normal-ui-cursor ${blocked ? \"invalid\" : \"\"}`}\n            style={{ transform, backgroundImage, width, height }}\n        />\n    )\n}\n\nexport default NormalUICursor;","import { SceneControllerContext } from 'components/world/QuestPanel/context/SceneControllerContext';\nimport useQuest from 'hooks/store/useQuest';\nimport React, { PropsWithChildren, useCallback, useContext, useEffect, useMemo, useRef, useState } from 'react';\nimport { SceneActionType } from 'store/types/scene';\nimport { locationEquals } from 'utils/tilemap';\nimport CombatUIWidget from './CombatUIWidget';\nimport NormalUICursor from './NormalUICursor';\nimport \"./styles/sceneUI.scss\";\n\nexport interface Props {\n    sceneWidth: number;\n    sceneHeight: number;\n    selectedActorId: string;\n    actionIntent?: ActionIntent;\n\n    onMouseDown?: (location: [number, number]) => void;\n    onSetActionIntent: (intent?: ActionIntent) => void;\n}\n\nexport interface ActionIntent {\n    action: SceneActionType.move | SceneActionType.slash;\n    from: [number, number];\n    to: [number, number];\n    apCost?: number;\n    actorAP?: number;\n    path?: [number, number][];  // is undefined when path is invalid\n}\n\n// This thing scales itself based on the canvas which should be a sibling of this component\nconst SceneUI = (props: PropsWithChildren<Props>) => {\n    const {\n        children,\n        selectedActorId,\n        actionIntent,\n        sceneWidth,\n        sceneHeight,\n        onMouseDown,\n        onSetActionIntent\n    } = props;\n    const ref = useRef<HTMLDivElement>(null);\n    const mouseDown = useRef(false);\n    const scale = useRef(1);\n    const controller = useContext(SceneControllerContext)!;\n    const quest = useQuest(controller.questName);\n    const scene = quest.scene!;\n    const [cursorLocation, setCursorLocation] = useState<[number, number]>();\n\n    useEffect(() => {\n        // Scale the html element together with the sibling canvas\n        const handleResize = () => {\n            if (!ref.current) return;\n            const canvas = ref.current.parentNode?.querySelector(\"canvas\");\n            if (!canvas) throw Error(\"No canvas found as sibling of SceneUI\");\n\n            const currentWidth = canvas?.clientWidth;\n            scale.current = currentWidth/sceneWidth;\n            ref.current.style.transform = `scale(${scale.current})`;\n            ref.current.style.width = `${sceneWidth}px`;\n            ref.current.style.height = `${sceneHeight}px`;\n        }\n        window.addEventListener(\"resize\", handleResize);\n        handleResize();\n        return () => {\n            window.removeEventListener(\"resize\", handleResize);\n        };\n    }, [sceneHeight, sceneWidth]);\n\n    const handleMouseMove = (e: React.MouseEvent<HTMLDivElement>) => {\n        if (mouseDown.current) {\n            const location = findLocation(e);\n\n            if (controller.locationIsOutOfBounds(location)) {\n                setCursorLocation(undefined);\n                onSetActionIntent(undefined);\n                return;\n            }\n            if (!cursorLocation || !locationEquals(location, cursorLocation)){\n                setCursorLocation(location);\n            }\n        }\n    }\n\n    const handleMouseDown = (e: React.MouseEvent<HTMLDivElement>) => {\n        const location = findLocation(e);\n        onMouseDown?.(location);\n        mouseDown.current = true;\n    }\n\n    const handleMouseUp = (e: React.MouseEvent<HTMLDivElement>) => {\n        mouseDown.current = false;\n\n        setCursorLocation(undefined);\n        if (!actionIntent) {\n            return\n        }\n        const selectedActorLocation = controller.getActorByAdventurerId(selectedActorId)!.location;\n        if (selectedActorLocation && cursorLocation && !locationEquals(selectedActorLocation, cursorLocation)){\n            controller.actorAttemptAction(selectedActorId, actionIntent.action, actionIntent.to);\n        }\n        onSetActionIntent?.(undefined);\n    }\n\n    const handleCombatActionChange = useCallback((action?: SceneActionType) => { //todo: beter name, not just combat\n        if (!action) {\n            onSetActionIntent(undefined);\n            return;\n        }\n\n        const {\n            location: from,\n            ap: actorAP,\n        } = controller.getActorByAdventurerId(selectedActorId)!;\n        const to = cursorLocation!;\n\n        switch (action){\n            case SceneActionType.move:\n            case SceneActionType.slash: {\n                const path = controller.findPath(from, to);\n                const apCost = controller.calculateWalkApCosts(from, to);\n\n                onSetActionIntent({\n                    action,\n                    from,\n                    to,\n                    apCost,\n                    actorAP,\n                    path,\n                })\n            }\n        }\n    }, [controller, cursorLocation, onSetActionIntent, selectedActorId]);\n\n    useEffect(() => {\n        if (!scene.combat && cursorLocation !== undefined) {\n            handleCombatActionChange(SceneActionType.move);\n        }\n    }, [cursorLocation, handleCombatActionChange, scene.combat])\n\n\n    // const previewAction = (action: SceneActionType | undefined, target: [number, number]) => {\n\n    //     const selectedActorLocation = controller.getActorByAdventurerId(selectedActorId)!.location;\n\n    //     switch (action) {\n    //         case SceneActionType.move: {\n    //             const path = controller.findPath(selectedActorLocation!, target);\n    //             if (!path) return;\n    //             const convert = (p: number[]) => new PIXI.Point(p[0] * (tileWidth) + (tileWidth / 2), p[1] * (tileHeight) + (tileHeight / 2));\n    //             const start = controller.getActorByAdventurerId(selectedActorId)?.location!;\n    //             const converted = [\n    //                 convert(start),\n    //                 ...path.map(p => convert(p))\n    //             ];\n    //             onSetMovePath?.(converted);\n    //             break;\n    //         }\n\n    //         default: {\n    //             onSetMovePath?.(undefined);\n    //         }\n    //     }\n    // }\n\n    const findLocation = (e: React.MouseEvent) => {\n        if (e.target instanceof Element){\n            const rect = (e.target).getBoundingClientRect();\n            const x = (e.clientX - rect.left) / scale.current;\n            const y = (e.clientY - rect.top) / scale.current;\n            return controller.pointToSceneLocation(new PIXI.Point(x, y));\n        }\n        throw new Error(\"You didnt give me the correct event\")\n    }\n\n    return (\n        <div\n            ref={ref}\n            className=\"scene-ui\"\n            onMouseMove={handleMouseMove}\n            onMouseDown={handleMouseDown}\n            onMouseUp={handleMouseUp}\n        >\n            {children}\n            {!scene.combat && cursorLocation && (\n                <NormalUICursor location={cursorLocation} />\n            )}\n            {scene.combat && cursorLocation && (\n                <CombatUIWidget\n                    location={cursorLocation}\n                    actionIntent={actionIntent}\n                    onActionChange={handleCombatActionChange}\n                />\n            )}\n        </div>\n    )\n}\n\nexport default SceneUI;","import { PixiComponent, applyDefaultProps, Graphics } from \"@inlet/react-pixi\";\nimport * as PIXI  from 'pixi.js';\n\ninterface Props  {\n    points?: PIXI.Point[];\n    style?:  Partial<PIXI.LineStyle>;\n    dash?: number;\n    gap?: number;\n    speed?: number; // positive to move forward, negative to move backward, 0 to not move at all\n};\n\n\n/**\n * Draws a dashed line along a path\n */\nconst DashedLine = PixiComponent<React.ComponentProps<typeof Graphics> & Props, PIXI.Graphics>(\"DashedLine\", {\n    create() {\n        return new PIXI.Graphics();\n    },\n\n    applyProps(instance, oldProps: Props, newProps: Props) {\n        const {\n            points = [],\n            dash = 10,\n            gap = 5,\n            speed = 40,\n            style,\n            ...newP\n        } = newProps;\n\n        // apply rest props to PIXI.Graphics\n        applyDefaultProps(instance, oldProps, newP);\n        instance.clear();\n\n        const draw = () => {\n            if((this as any)._destroy){\n                return;\n            }\n\n            instance.clear();\n            instance.lineStyle(style?.width, style?.color, style?.alpha, style?.alignment, style?.native);\n            const offsetPercentage = (Date.now() % (10000/speed) + 1) / Math.abs(10000/speed);\n\n            let dashLeft = 0;\n            let gapLeft = 0;\n            if (offsetPercentage > 0) {\n                const progressOffset = (dash + gap) * offsetPercentage * (speed < -1 ? 1 : -1) ;\n                if (progressOffset < dash) {\n                    dashLeft = dash - progressOffset;\n                } else {\n                    gapLeft = gap - (progressOffset - dash);\n                }\n            }\n            const rotatedpoints = [];\n            for (const point of points) {\n                const p = point.clone();\n                const cosAngle = Math.cos(instance.rotation);\n                const sinAngle = Math.sin(instance.rotation);\n                const dx = p.x;\n                const dy = p.y;\n                p.x = (dx * cosAngle - dy * sinAngle);\n                p.y = (dx * sinAngle + dy * cosAngle);\n                rotatedpoints.push(p);\n            }\n\n            for (let i = 0; i < rotatedpoints.length - 1; i++) {\n                const p1 = rotatedpoints[i];\n                const p2 = rotatedpoints[i + 1];\n                const dx = p2.x - p1.x;\n                const dy = p2.y - p1.y;\n                const len = Math.sqrt(dx * dx + dy * dy);\n                const normal = {\n                    x: dx / len,\n                    y: dy / len\n                };\n                let progressOnLine = 0;\n\n                instance.moveTo(p1.x + gapLeft * normal.x, p1.y + gapLeft * normal.y);\n                while (progressOnLine <= len) {\n                    progressOnLine += gapLeft;\n                    if (dashLeft > 0) {\n                        progressOnLine += dashLeft;\n                    } else {\n                        progressOnLine += dash;\n                    }\n                    if (progressOnLine > len) {\n                        dashLeft = progressOnLine - len;\n                        progressOnLine = len;\n                    } else {\n                        dashLeft = 0;\n                    }\n                    instance.lineTo(p1.x + progressOnLine * normal.x, p1.y + progressOnLine * normal.y);\n                    progressOnLine += gap;\n                    if (progressOnLine > len && dashLeft === 0) {\n                        gapLeft = progressOnLine - len;\n                    } else {\n                        gapLeft = 0;\n                        instance.moveTo(p1.x + progressOnLine * normal.x, p1.y + progressOnLine * normal.y);\n                    }\n                }\n            }\n            if (speed !== 0) {\n                (this as any)._raf = requestAnimationFrame(draw);\n            }\n        }\n        draw();\n    },\n\n    willUnmount() {\n        (this as any)._destroy = true;\n        cancelAnimationFrame((this as any)._raf);\n    }\n});\n\nexport default DashedLine;","import DashedLine from 'components/pixi/DashedLine';\nimport React, { useContext } from 'react';\nimport { SceneActionType } from 'store/types/scene';\nimport { SceneControllerContext } from '../../context/SceneControllerContext';\nimport { ActionIntent } from './ui/SceneUI'\n\nexport interface Props {\n  actionIntent: ActionIntent;\n  tileWidth: number;\n  tileHeight: number;\n}\n\nconst ActionPreview = (props: Props) => {\n  const {actionIntent, tileWidth, tileHeight} = props;\n\n  switch (actionIntent.action){\n    case SceneActionType.move:\n    case SceneActionType.slash: {\n      if (!actionIntent.path){\n        return null;\n      }\n      const convert = (p: number[]) => new PIXI.Point(p[0] * (tileWidth) + (tileWidth / 2), p[1] * (tileHeight) + (tileHeight / 2));\n      const converted = [\n          convert(actionIntent.from),\n          ...actionIntent.path.map(p => convert(p))\n      ];\n      const valid = (!actionIntent.apCost) || actionIntent.apCost <= (actionIntent.actorAP || 0);\n      return (\n        <DashedLine\n          points={converted}\n          dash={10}\n          gap={15}\n          speed={20}\n          rotation={0}\n          style={{\n            width: 6,\n            color: valid ? 0xffffff : 0x8b0000,\n            alpha: 1,\n          }}\n        />)\n    }\n    default:\n      return null;\n  }\n}\n\nexport default ActionPreview;","import React, { useRef, useEffect, useContext, useCallback, useState } from \"react\";\nimport { Container } from '@inlet/react-pixi';\nimport useQuest from 'hooks/store/useQuest';\nimport Tilemap from './Tilemap';\nimport { ActorObject } from 'store/types/scene';\nimport BridgedStage from 'components/pixi/util/BridgedStage';\nimport SceneAdventurer from './SceneAdventurer';\nimport useTilesetsLoader from 'hooks/useTilesetsLoader';\nimport renderObject from './renderObject';\nimport { SceneControllerContext } from '../../context/SceneControllerContext';\nimport SceneUI, { ActionIntent } from './ui/SceneUI';\nimport { locationEquals } from 'utils/tilemap';\nimport ActionPreview from './ActionPreview';\nimport \"./styles/scene.scss\";\n\nexport interface Props {\n    selectedActorId: string;\n    setSelectedActor: (actor: string) => void;\n}\n\nconst DEBUG_ACTIONQUEUE = false;\n\nconst Scene = (props: Props) => {\n    const {selectedActorId} = props;\n    const controller = useContext(SceneControllerContext)!;\n    const mapData = controller.mapData!;\n    const basePath = controller.basePath!;\n\n    const {\n        loadComplete,\n        loadTilesets,\n        tileSpritesheets\n    } = useTilesetsLoader(basePath);\n\n    const ref = useRef<HTMLDivElement>(null);\n    const quest = useQuest(controller.questName);\n    const {tileWidth, tileHeight} = controller.getTileDimensions();\n    const scene = quest.scene!;\n    const [currentActionIntent, setCurrentActionIntent] = useState<ActionIntent>();\n\n\n    const renderActors = useCallback(() => {\n        const renderActor = (actor: ActorObject) => {\n            const {id, location} = actor;\n            return (\n                <SceneAdventurer\n                    location={location}\n                    controller={controller}\n                    adventurerId={id}\n                    key={id}\n                    selected={props.selectedActorId === id}\n                    setSelectedAdventurer={props.setSelectedActor}\n                />\n            );\n        }\n        return scene?.actors?.map((o) => renderActor(o));\n\n    }, [controller, props.selectedActorId, props.setSelectedActor, scene?.actors])\n\n    useEffect(() => {\n        if (!mapData) return;\n        loadTilesets(mapData.tilesets);\n    }, [loadTilesets, mapData]);\n\n    const handleUIMouseDown = (location: [number, number]) => {\n        const actor = scene.actors.find(a => locationEquals(a.location, location));\n        if (actor) {\n            props.setSelectedActor(actor.id);\n        }\n    }\n\n    if (!loadComplete || !mapData || !scene) {\n        return <div>loading...</div>\n    }\n\n    const sceneWidth = mapData.width * mapData.tilewidth;\n    const sceneHeight = mapData.height * mapData.tileheight;\n    return (\n        <div className=\"scene\" ref={ref}>\n            <BridgedStage width={sceneWidth} height={sceneHeight} >\n                <Container\n                    interactive={true}\n                    hitArea={new PIXI.Rectangle(0, 0, sceneWidth, sceneHeight)}\n                >\n                    <Tilemap\n                        basePath={basePath}\n                        data={mapData}\n                        spritesheets={tileSpritesheets}\n                    />\n                    { scene.objects.map((o) => renderObject(o, controller, tileSpritesheets ))}\n                    { renderActors()}\n                    { currentActionIntent && (<ActionPreview actionIntent={currentActionIntent} tileWidth={tileWidth} tileHeight={tileHeight}/>)}\n                </Container>\n            </BridgedStage>\n            {DEBUG_ACTIONQUEUE && (\n                <div style={{ position: 'absolute', bottom: 0}}>\n                    <h2>ActionQueue</h2>\n                    <ul>\n                        {scene.actionQueue && scene.actionQueue.map((action) => (\n                            <li key={JSON.stringify(action)}>{JSON.stringify(action)}</li>\n                        ))}\n                    </ul>\n                </div>\n            )}\n            <SceneUI\n                sceneWidth={sceneWidth}\n                sceneHeight={sceneHeight}\n                selectedActorId={selectedActorId}\n                actionIntent={currentActionIntent}\n                onMouseDown={handleUIMouseDown}\n                onSetActionIntent={setCurrentActionIntent}\n            />\n        </div>\n    );\n}\n\nexport default Scene;\n","import React from 'react';\nimport useQuest from 'hooks/store/useQuest';\nimport { getDefinition } from 'definitions/quests';\nimport { QuestDefinition } from 'definitions/quests/types';\nimport { TextManager } from 'global/TextManager';\nimport './styles/onTheRoad.scss';\n\nexport interface Props {\n    questName: string;\n}\n\n/* Shows the most recent log on a questnode */\nconst OnTheRoad = (props: Props) => {\n    const quest = useQuest(props.questName);\n    const questDefinition: QuestDefinition = getDefinition(quest.name);\n    let progress: number = Math.floor(quest.progress);\n    do {\n        const log = questDefinition.nodes[progress].log;\n        if (log) {\n            return (\n                <div>\n                    <p>{`${TextManager.get(log)}`}</p>\n                </div>\n            )\n        }\n        progress--;\n    } while (progress >= 0);\n    return <h1 className=\"on-the-road questname\">{TextManager.getQuestTitle(quest.name)}</h1>;\n}\n\nexport default OnTheRoad;","import React from 'react';\nimport Scene from 'components/world/QuestPanel/QuestDetails/scene/Scene';\nimport useQuest from 'hooks/store/useQuest';\nimport OnTheRoad from './OnTheRoad';\n\nexport interface Props {\n    questName: string;\n    selectedActorId: string;\n    setSelectedActor: (id: string) => void;\n}\n\nconst QuestDetails = (props: Props) => {\n    const quest = useQuest(props.questName);\n\n    if (!quest.sceneName) {\n        return <OnTheRoad questName={props.questName} />;\n    }\n    return (\n        <Scene {...props} />\n    );\n}\n\nexport default QuestDetails;","import * as React from \"react\";\nimport { ContextType } from \"constants/context\";\nimport { Rarity } from \"constants/items\";\nimport { getDefinition } from \"definitions/items\";\nimport { Item } from \"definitions/items/types\";\nimport { TooltipManager } from 'global/TooltipManager';\nimport Icon, { IconSize } from 'components/ui/common/Icon';\nimport \"./styles/itemIcon.scss\";\n\nexport interface Props {\n    item: Item;\n    onClick?: (event: React.MouseEvent) => void;\n    size?: IconSize;\n    showContext?: boolean;\n}\n\nconst ItemIcon = (props: Props) => {\n    const { item, size } = props;\n    const itemDefinition = getDefinition(item);\n\n    if (!itemDefinition) {\n        // tslint:disable-next-line: no-console\n        console.warn(`could not find definition for ${item}`);\n    }     // todo: [10/07/2019] assert\n\n    const handleClick = (event: React.MouseEvent) => {\n        if (props.showContext !== false) {\n            const origin = (event.currentTarget as HTMLElement);\n            const originRect = origin.getBoundingClientRect();\n            TooltipManager.showContextTooltip(ContextType.item, getDefinition(item), originRect);\n            event.stopPropagation();\n        }\n\n        if (props.onClick) {\n            props.onClick(event);\n        }\n    };\n\n    const className = `item-icon ${getIconClassName(itemDefinition.rarity)} ${sizeClassName(size)}`;\n\n    return (\n        <div className={className}>\n            <Icon\n                image={itemDefinition.iconImg}\n                size={props.size}\n                onClick={handleClick}\n            />\n        </div>\n    );\n};\n\nexport default ItemIcon;\n\n\nconst getIconClassName = (rarity?: Rarity): string => {\n    switch (rarity) {\n        case Rarity.common:\n            return \"item-icon-common\";\n        case Rarity.uncommon:\n            return \"item-icon-uncommon\";\n        case Rarity.rare:\n            return \"item-icon-rare\";\n        case Rarity.epic:\n            return \"item-icon-epic\";\n        case Rarity.legendary:\n            return \"item-icon-legendary\";\n    }\n    return getIconClassName(Rarity.common);\n};\n\nconst sizeClassName = (size?: IconSize): string => {\n    switch (size) {\n        case IconSize.smallest:\n            return \"item-icon-size-smallest\";\n        case IconSize.small:\n            return \"item-icon-size-small\";\n        case IconSize.medium:\n            return \"item-icon-size-medium\";\n        case IconSize.big:\n            return \"item-icon-size-big\";\n        case IconSize.biggest:\n            return \"item-icon-size-biggest\";\n    }\n    return sizeClassName(IconSize.medium);\n};","import * as React from \"react\";\r\nimport { IconSize } from 'components/ui/common/Icon';\r\nimport { DragSourceType, DragType } from \"constants/dragging\";\r\nimport { Item } from \"definitions/items/types\";\r\nimport ItemIcon from \"./ItemIcon\";\r\nimport { ConnectDragSource, DragSource, DragSourceConnector, DragSourceMonitor, DragSourceSpec } from \"react-dnd\";\r\n\r\nexport interface Props {\r\n    index: number;\r\n    item: Item;\r\n    sourceType: DragSourceType;\r\n    sourceId?: string;\r\n    size?: IconSize;\r\n    onClick?: (event: React.MouseEvent) => void;\r\n}\r\n\r\ninterface CollectedProps {\r\n    isDragging: boolean;\r\n    connectDragSource: ConnectDragSource;\r\n}\r\n\r\nexport interface InventoryItemDragInfo {\r\n    item: Item;\r\n    inventorySlot?: number;\r\n    sourceId?: string;\r\n    sourceType: DragSourceType;\r\n}\r\n\r\n/**\r\n * Specifies the drag source contract.\r\n * Only `beginDrag` function is required.\r\n */\r\nconst source: DragSourceSpec<Props, InventoryItemDragInfo> = {\r\n    beginDrag(props: Props) {\r\n        // Return the data describing the dragged item\r\n        return {\r\n            inventorySlot: props.index,\r\n            item: props.item,\r\n            sourceId: props.sourceId,\r\n            sourceType: props.sourceType,\r\n        };\r\n    },\r\n};\r\n\r\n/**\r\n * Specifies which props to inject into your component.\r\n */\r\nfunction collect(connect: DragSourceConnector, monitor: DragSourceMonitor) {\r\n    return {\r\n        connectDragSource: connect.dragSource(),\r\n        isDragging: monitor.isDragging(),\r\n    };\r\n}\r\n\r\nconst DraggableItemIcon = (props: Props & CollectedProps) => {\r\n\r\n    const { item, onClick, isDragging, connectDragSource, size } = props;\r\n    const handleClick = (event: React.MouseEvent) => {\r\n        if (onClick) {\r\n            onClick(event);\r\n        }\r\n    };\r\n    if (isDragging) {\r\n        // TODO: can show some sort of empty state?\r\n        return null;\r\n    }\r\n    // The wrapping div is needed by ReactDnD\r\n    return connectDragSource((\r\n        <div>\r\n            <ItemIcon\r\n                item={item}\r\n                onClick={handleClick}\r\n                size={size}\r\n            />\r\n        </div>\r\n    ));\r\n}\r\n\r\nexport default DragSource<Props, CollectedProps>(DragType.ITEM, source, collect)(DraggableItemIcon);\r\n","import { Item } from \"definitions/items/types\";\nimport * as React from \"react\";\nimport { TextManager } from \"global/TextManager\";\nimport { DragSourceType } from 'constants/dragging';\nimport DraggableItemIcon from '../DraggableItemIcon';\nimport \"./styles/itemsList.scss\";\n\nexport interface Props {\n    className?: string;\n    items: Item[];\n    sourceType: DragSourceType;\n    sourceId?: string;\n}\n\n/**\n * The ItemsList displays a list of items vertically. Shows icon and description\n */\nconst DraggableItemsList = (props: Props) => {\n    const className = (props.className || \"\")+ \" items-list\";\n\n    return (\n        <ul className={className} >\n            {props.items.map((item, index)=> (\n                <li\n                    key={`${item}${index}`}\n                    className=\"item\"\n                >\n                    <DraggableItemIcon\n                        item={item}\n                        index={index}\n                        sourceId={props.sourceId}\n                        sourceType={props.sourceType}\n                    />\n                    <div className=\"text\">\n                        <p className=\"name\">{TextManager.getItemName(item)}</p>\n                        <p className=\"subtext\">{TextManager.getItemSubtext(item)}</p>\n                    </div>\n                </li>\n            ))}\n        </ul>\n    );\n};\n\nexport default DraggableItemsList;\n","import React, { useRef, useContext } from \"react\";\nimport gsap from 'gsap';\nimport DraggableItemsList from 'components/ui/items/DraggableItemsList';\nimport { TextManager } from 'global/TextManager';\nimport AdventurerAvatar from 'components/ui/adventurer/AdventurerAvatar';\nimport { DragSourceType } from 'constants/dragging';\nimport { SceneControllerContext } from '../../context/SceneControllerContext';\nimport { useAdventurerState } from 'hooks/store/adventurers';\nimport Button from 'components/ui/buttons/Button';\nimport { adventurerFreeInventorySlots } from 'store/helpers/storeHelpers';\nimport Icon from 'components/ui/common/Icon';\nimport \"../styles/lootCache.scss\";\nimport \"../styles/modal.scss\";\n\ninterface Props {\n    cacheName: string;\n    adventurerId: string;\n    onClose: () => void;\n}\n\nconst LootCache = (props: Props) => {\n    const controller = useContext(SceneControllerContext)!;\n    const adventurer = useAdventurerState(props.adventurerId);\n    const freeSlots = adventurerFreeInventorySlots(adventurer);\n    const ref = useRef<HTMLDivElement>(null);\n    const cache = controller.getLootCache(props.cacheName);\n\n    if (!cache) {\n        return null;\n    }\n\n    const handleTakeGold = (e: React.MouseEvent) => {\n        e.stopPropagation();\n        // todo: animate gold flying away\n\n        controller.takeGoldFromCache(props.cacheName);\n    }\n\n    const handleTakeAllItems = (e: React.MouseEvent) => {\n        e.stopPropagation();\n        ref.current!.querySelectorAll(\".items-list .item\").forEach((el, index) => {\n            if (index >= freeSlots) return;\n            el.classList.add(\"taking\");\n        });\n        gsap.to(\".items-list .item.taking\", {\n            right: \"-100%\",\n            stagger: {\n              each: 0.1,\n              ease: \"power2.inOut\",\n            },\n            onComplete: () => {\n                for (let i = 0; i < freeSlots; i++) {\n                    controller.takeItemFromCache(0, props.cacheName, adventurer);\n                }\n            }\n        });\n    }\n\n    return (\n        <div className={`interaction-modal loot-cache`} ref={ref}>\n            <div className=\"header\">\n                <div className=\"title\">\n                    {TextManager.get(cache.title)}\n                </div>\n                <div className=\"close\" onClick={props.onClose} />\n            </div>\n            { cache.items.length > 0 && (\n                <div className=\"content\">\n                    <div className=\"items\">\n                        <DraggableItemsList\n                            items={cache.items}\n                            sourceType={DragSourceType.lootCache}\n                            sourceId={props.cacheName}\n                        />\n                    </div>\n                    <div className=\"adventurer\">\n                        <AdventurerAvatar adventurer={adventurer}/>\n                        <Button onClick={handleTakeAllItems} disabled={freeSlots === 0} size=\"small\">\n                            {TextManager.get(\"quest-common-loot-cache-take-all\")}\n                        </Button>\n                    </div>\n                </div>\n            )}\n            { !!cache.gold && (\n                <div className=\"content\">\n                    <div className=\"gold\">\n                        <Icon\n                            image=\"img/resources/gold.png\"\n                            size=\"medium\"\n                        />\n                        {TextManager.get(\"quest-common-loot-cache-gold\", { gold: cache.gold })}\n                    </div>\n                    <div className=\"take-gold\">\n                        <Button onClick={handleTakeGold} size=\"small\">\n                            {TextManager.get(\"quest-common-loot-cache-take\")}\n                        </Button>\n                    </div>\n                </div>\n            )}\n        </div>\n    )\n}\n\nexport default LootCache;","import React, { MouseEvent, useRef, useContext } from \"react\";\nimport { TextManager } from 'global/TextManager';\nimport { SceneControllerContext } from '../../context/SceneControllerContext';\nimport Button from 'components/ui/buttons/Button';\nimport \"../styles/situation.scss\";\nimport \"../styles/modal.scss\";\n\ninterface Props {\n    situation: string;\n    adventurerId: string;\n    onClose: () => void;\n}\n\nconst Situation = (props: Props) => {\n    const controller = useContext(SceneControllerContext)!;\n    const ref = useRef<HTMLDivElement>(null);\n    const situation = controller.getSituation(props.situation, props.adventurerId);\n    if (!situation) return null;\n\n    const { title, choices } = situation;\n\n    const handleChoiceClick = (e: MouseEvent<HTMLButtonElement>) => {\n        //choice: string\n        const choice = e.currentTarget.getAttribute('data-option')!;\n        controller.handleSituationOptionClick(props.situation, choice);\n        e.stopPropagation();\n    }\n\n    const handleClose = (e: MouseEvent<HTMLDivElement>) => {\n        props.onClose();\n        e.stopPropagation();\n    }\n    return (\n        <div className={`interaction-modal situation`} ref={ref}>\n            <div className=\"header\">\n                <div className=\"title\">\n                    {TextManager.get(title)}\n                </div>\n                <div className=\"close\" onClick={handleClose} />\n            </div>\n             { choices.length > 0 && (\n                <div className=\"content\">\n                    {choices.map(choice => (\n                        <Button key={choice} data-option={choice} onClick={handleChoiceClick}>{TextManager.get(choice)}</Button>\n                    ))}\n                </div>\n            )}\n        </div>\n    )\n}\n\nexport default Situation;","import React, { useContext } from \"react\";\nimport { useSelector } from 'react-redux';\nimport { createSelectAdventurersOnQuest } from 'store/selectors/adventurers';\nimport { SceneControllerContext } from '../context/SceneControllerContext';\nimport AdventurerAvatar from 'components/ui/adventurer/AdventurerAvatar';\nimport { TextManager } from 'global/TextManager';\nimport Button from 'components/ui/buttons/Button';\nimport { IconSize } from 'components/ui/common/Icon';\nimport \"./styles/combatBar.scss\";\n\ninterface Props {\n    questName: string;\n    selectedAdventurerId?: string;\n}\n\nconst CombatBar = (props: Props) => {\n    const {selectedAdventurerId} = props;\n    const adventurers = useSelector(createSelectAdventurersOnQuest(props.questName));\n    const controller = useContext(SceneControllerContext)!;\n\n    return (\n        <div className=\"combat-bar\">\n            <div className=\"title\">\n                {TextManager.get(\"ui-combat-bar-title\")}\n            </div>\n            <div className=\"adventurers\">\n                {adventurers.map(a => (\n                    <div key={a.id} className={`adventurer ${selectedAdventurerId === a.id ? \"selected\" : \"\"}`}>\n                        <AdventurerAvatar adventurer={a} size={IconSize.smallest}/>\n                        <div className=\"ap\">\n                            {controller.getActorByAdventurerId(a.id)?.ap || 0} AP\n                        </div>\n                    </div>\n                ))}\n            </div>\n            <Button size=\"small\">End turn</Button>\n        </div>\n    )\n}\n\nexport default CombatBar;\n","import * as React from \"react\";\r\nimport { PropsWithChildren } from 'react';\r\nimport { DragSourceType, DragType } from \"constants/dragging\";\r\nimport { Item } from \"definitions/items/types\";\r\nimport { ConnectDropTarget, DropTarget, DropTargetConnector, DropTargetMonitor, DropTargetSpec } from \"react-dnd\";\r\nimport { InventoryItemDragInfo } from '../items/DraggableItemIcon';\r\nimport { IconSize } from '../common/Icon';\r\nimport { itemAndEquipmentSlotMatch } from '../adventurer/EquipmentSlot';\r\n\r\nconst dropTarget: DropTargetSpec<Props> = {\r\n    drop(props: Props, monitor: DropTargetMonitor) {\r\n        props.onDrop(monitor.getItem());\r\n    },\r\n    canDrop(props: Props, monitor: DropTargetMonitor) {\r\n        const dragInfo: InventoryItemDragInfo = monitor.getItem();\r\n        if (dragInfo.sourceType === DragSourceType.adventurerEquipment) {\r\n            return props.item == null || itemAndEquipmentSlotMatch(props.item, dragInfo.inventorySlot!);\r\n        }\r\n        return true;\r\n    },\r\n};\r\n\r\nexport interface Props {\r\n    item: Item | null;\r\n    onDrop: (item: any) => void;\r\n    size?: IconSize;\r\n}\r\n\r\nexport interface DropSourceProps {\r\n    canDrop: boolean;\r\n    isOver: boolean;\r\n    connectDropTarget: ConnectDropTarget;\r\n}\r\n\r\nconst collect = (connect: DropTargetConnector, monitor: DropTargetMonitor) => ({\r\n    canDrop: monitor.canDrop(),\r\n    connectDropTarget: connect.dropTarget(),\r\n    isOver: monitor.isOver(),\r\n});\r\n\r\n/**\r\n * The InventorySlot displays a slot in which an item can be placed.\r\n */\r\nconst InventorySlot = (props: PropsWithChildren<Props> & DropSourceProps) => {\r\n    const {\r\n        isOver,\r\n        canDrop,\r\n        connectDropTarget,\r\n    } = props;\r\n    const isActive = isOver && canDrop;\r\n\r\n    const classNames = [\r\n        \"inventory-item\",\r\n    ];\r\n\r\n    if (isActive) {\r\n        classNames.push(\"drop-active\");\r\n    } else if (canDrop) {\r\n        classNames.push(\"drop-possible\");\r\n    }\r\n\r\n    return connectDropTarget(\r\n        <div className={classNames.join(\" \")}>\r\n            { props.children }\r\n        </div>,\r\n    );\r\n}\r\n\r\nexport default DropTarget<Props, DropSourceProps>(\r\n    DragType.ITEM,\r\n    dropTarget,\r\n    collect,\r\n)(InventorySlot);\r\n","import * as React from \"react\";\nimport { DragSourceType } from \"constants/dragging\";\nimport {Item} from \"definitions/items/types\";\nimport InventorySlot from \"./InventorySlot\";\nimport DraggableItemIcon, { InventoryItemDragInfo } from '../items/DraggableItemIcon';\nimport \"./styles/inventory.scss\";\nimport { IconSize } from '../common/Icon';\n\nexport interface Props {\n    items: (Item|null)[];\n    sourceId?: string;   // who does this inventory belong to?\n    sourceType: DragSourceType;\n    iconSize?: IconSize;\n    onDropItem: (item: Item, fromSlot: number, toSlot: number, sourceType: DragSourceType, sourceId?: string) => void;\n    className?: string;\n}\n\n/**\n * Inventory is used to show Items. They can be dragged about\n * @param props\n */\nconst Inventory = (props: Props) => {\n    const slots = [];\n    for (let i = 0; i < props.items.length; i++) {\n        let contents;\n        const item = props.items[i];\n        const handleDrop = (dragInfo: InventoryItemDragInfo) => {\n            if (dragInfo.inventorySlot === i && dragInfo.sourceType === props.sourceType && dragInfo.sourceId === props.sourceId) {\n                // TODO: Swap items?!\n                return;\n            }\n            if (props.onDropItem) {\n                const {inventorySlot: fromSlot} = dragInfo;\n                props.onDropItem(dragInfo.item, fromSlot!, i, dragInfo.sourceType, dragInfo.sourceId);\n           }\n        };\n\n        if (item) {\n            contents = (\n                <DraggableItemIcon\n                    index={i}\n                    sourceId={props.sourceId}\n                    sourceType={props.sourceType}\n                    item={item}\n                />\n            );\n       }\n\n        const slot = (\n            <InventorySlot\n                key={`inventory-slot-${i}`}\n                item={item}\n                size={props.iconSize}\n                onDrop={handleDrop}\n            >\n                {contents}\n            </InventorySlot>\n        );\n        slots.push(slot);\n   }\n    return (\n        <div className={`inventory ${props.className ? props.className : \"\"}`}>\n            {slots}\n        </div>\n    );\n};\nexport default Inventory;\n","import { StoreState } from 'store/types';\nimport { useSelector } from 'react-redux';\nimport { Item } from 'definitions/items/types';\n\n// Returns the gold from redux store\nconst useStockpileState = () => {\n    return useSelector<StoreState, (Item|null)[]>(store => store.stockpile);\n}\n\nexport default useStockpileState;","import { useContext } from 'react';\nimport { useDispatch } from 'react-redux';\nimport { Action } from \"redux\";\nimport { removeItemFromInventory, assignEquipment, addItemToInventory, removeEquipment, moveItemInInventory } from 'store/actions/adventurers';\nimport { removeItemFromWarehouse, addItemToWarehouse, moveItemInWarehouse } from 'store/actions/items';\nimport { EquipmentSlotType } from 'components/ui/adventurer/EquipmentSlot';\nimport { Item } from 'definitions/items/types';\nimport { DragSourceType } from 'constants/dragging';\nimport { AdventurerStoreState } from 'store/types/adventurer';\nimport useStockpileState from 'hooks/store/useStockpileState';\nimport { SceneControllerContext } from 'components/world/QuestPanel/context/SceneControllerContext';\nimport { InventoryItemDragInfo } from 'components/ui/items/DraggableItemIcon';\n\n/* Exposes\n- dropItemEquipment,\n- dropItemInventory,\n- dropItemWarehouse\nto use in various places in the UI when an item is dropped somewhere\n*/\nconst useItemDropActions = () => {\n    const dispatch = useDispatch();\n    const sceneController = useContext(SceneControllerContext);  // is only available when in a scene\n    const stockpile = useStockpileState();\n\n    // When an item gets dropped on equipment slot\n    const dropItemEquipment = (dragInfo: InventoryItemDragInfo, slotType: EquipmentSlotType, adventurer: AdventurerStoreState) => {\n        const item = dragInfo.item;\n        const actions: Action[] = [];\n\n        switch (dragInfo.sourceType) {\n            // Dragged from inventory\n            case DragSourceType.adventurerInventory: {\n                actions.push(\n                    // Item gets removed from inventory\n                    removeItemFromInventory(adventurer.id, dragInfo.inventorySlot!),\n                    // Item gets assigned to an equipment slot\n                    assignEquipment(adventurer.id, slotType, item),\n                );\n\n                const existingEquipment = adventurer.equipment[EquipmentSlotType[slotType]];\n                if (existingEquipment) {\n                    // There is already an item in this slot. Place in inventory\n                    actions.push(addItemToInventory(adventurer.id, existingEquipment, dragInfo.inventorySlot!));\n                }\n                break;\n            }\n            // Dragged from warehouse.\n            case DragSourceType.warehouse: {\n                actions.push(\n                    removeItemFromWarehouse(dragInfo.inventorySlot!),\n                    assignEquipment(adventurer.id, slotType, item),\n                );\n\n                const existingEquipment = adventurer.equipment[EquipmentSlotType[slotType]];\n                if (existingEquipment) {\n                    // There is already an item in this slot. Place in warehouse\n                    actions.push(addItemToWarehouse(existingEquipment, dragInfo.inventorySlot!));\n                }\n                break;\n            }\n\n            // Dragged from equipment slot (only applicable to weapons)\n            case DragSourceType.adventurerEquipment: {\n                actions.push(\n                    assignEquipment(adventurer.id, slotType, item)\n                );\n\n                const existingEquipment = adventurer.equipment[EquipmentSlotType[slotType]];\n                const fromSlot = dragInfo.inventorySlot!;\n                if (existingEquipment) {\n                    // Another weapon was there, switch them\n                    actions.push(assignEquipment(adventurer.id, fromSlot, existingEquipment),)\n                } else {\n                    // Clear the slot where it came from\n                    actions.push(removeEquipment(adventurer.id, fromSlot));\n                }\n                break;\n            }\n        }\n        actions.forEach(a => dispatch(a));\n    };\n\n    // When an item gets dropped on an adventurer inventory\n    const dropItemInventory = (item: Item, fromSlot: number, toSlot: number, sourceType: DragSourceType, adventurer: AdventurerStoreState, sourceId?: string): void => {\n        const actions: Action[] = [];\n        switch (sourceType) {\n            // Drag from one inventory slot to another\n            case DragSourceType.adventurerInventory:\n                actions.push(moveItemInInventory(adventurer.id, fromSlot, toSlot))\n                break;\n\n            // Dragged from warehouse\n            case DragSourceType.warehouse: {\n                actions.push(\n                    removeItemFromWarehouse(fromSlot),\n                    addItemToInventory(adventurer.id, item, toSlot),\n                )\n                const otherItem = adventurer.inventory[toSlot];\n                if (otherItem) {\n                    actions.push(\n                        addItemToWarehouse(otherItem, fromSlot)\n                    )\n                }\n                break;\n            }\n\n            // Drag from equipment slot\n            case DragSourceType.adventurerEquipment: {\n                actions.push(\n                    addItemToInventory(adventurer.id, item, toSlot)\n                );\n\n                const existingEquipment = adventurer.inventory[toSlot];\n                if (existingEquipment) {\n                    // Was dropped on another piece of equipment in inventory, switch them\n                    actions.push(assignEquipment(adventurer.id, fromSlot, existingEquipment));\n                } else {\n                    // Clear the slot where it came from\n                    actions.push(removeEquipment(adventurer.id, fromSlot));\n                }\n                break;\n            }\n\n            // Dragged from lootCache on a scene\n            case DragSourceType.lootCache: {\n                if (sceneController && sourceId) {\n                    // Let the scene controller handle this action\n                    sceneController.takeItemFromCache(fromSlot, sourceId, adventurer, toSlot);\n                }\n            }\n        }\n        actions.forEach(a => dispatch(a));\n    };\n\n    // When an item gets dropped on the warehouse inventory\n    const dropItemWarehouse = (item: Item, fromSlot: number, toSlot: number, sourceType: DragSourceType, sourceId?: string): void => {\n        const actions: Action[] = [];\n\n        switch (sourceType) {\n            // Dragged from the warehouse itself\n            case DragSourceType.warehouse: {\n                actions.push(\n                    moveItemInWarehouse(fromSlot, toSlot)\n                )\n                const otherItem = stockpile[toSlot];\n                if (otherItem) {\n                    actions.push(\n                        addItemToInventory(sourceId!, otherItem, fromSlot)\n                    )\n                }\n                break;\n            }\n            // Dragged from an adventurer inventory\n            case DragSourceType.adventurerInventory: {\n                actions.push(\n                    removeItemFromInventory(sourceId!, fromSlot),\n                    addItemToWarehouse(item, toSlot)\n                )\n                const otherItem = stockpile[toSlot];\n                if (otherItem) {\n                    actions.push(\n                        addItemToInventory(sourceId!, otherItem, fromSlot)\n                    )\n                }\n                break;\n            }\n        }\n        actions.forEach(a => dispatch(a));\n    };\n    return {\n        dropItemEquipment,\n        dropItemInventory,\n        dropItemWarehouse\n    }\n}\n\nexport default useItemDropActions;","import React, { Fragment } from \"react\";\nimport { useAdventurerState } from 'hooks/store/adventurers';\nimport { TextManager } from 'global/TextManager';\nimport { ContextType } from 'constants/context';\nimport { TooltipManager } from 'global/TooltipManager';\nimport { WeaponType } from 'definitions/items/weapons';\nimport './styles/adventurerSkills.scss';\n\ninterface Props {\n    adventurerId: string;\n}\n\nconst AdventurerSkills = (props: Props) => {\n    const adventurer = useAdventurerState(props.adventurerId);\n\n    const renderSkill = (skill: WeaponType) => {\n        // const traitDefinition = getDefinition(trait);\n        const handleClick = (event: React.MouseEvent) => {\n            const origin = (event.currentTarget as HTMLElement);\n            const originRect = origin.getBoundingClientRect();\n            TooltipManager.showContextTooltip(ContextType.skill, skill, originRect);\n            event.stopPropagation();\n        };\n        return (\n            <Fragment key={skill}>\n                <li onClick={handleClick}>\n                    <span className=\"skill\" onClick={handleClick}>\n                        {TextManager.getSkillName(skill)}\n                    </span>\n                    <span>\n                        {adventurer.skills[skill]}\n                    </span>\n                    {/* {TextManager.getTraitName(trait)} */}\n                </li>\n            </Fragment>\n        )\n    };\n\n    if (!adventurer?.skills) {\n        return null;\n    }\n    return (\n        <>\n            <p>{TextManager.get(\"ui-adventurer-info-skills-title\")}</p>\n            <ul className=\"adventurer-skills\">\n                {Object.keys(adventurer.skills)?.map((s, i) => {\n                    const skill: WeaponType = WeaponType[s];\n                    return renderSkill(skill);\n                })}\n            </ul>\n        </>\n    )\n}\n\nexport default AdventurerSkills;","const CONSTANT = 0.5;\n\nexport function xpToLevel(xp: number) {\n    return Math.floor(CONSTANT * Math.sqrt(xp));\n}\n\nexport function levelToXp(level: number) {\n    return Math.pow(level / CONSTANT, 2);\n}","\nimport { StoreState } from 'store/types';\nimport { useSelector } from 'react-redux';\nimport { EngineStoreState } from 'store/types/engine';\n\n// Returns the 'engine' part from redux store\nexport const useEngine = () => {\n    return useSelector<StoreState, EngineStoreState>(store => store.engine);\n}\n\nexport const useDelta = () => {\n    const engine = useEngine();\n    return Date.now() - engine.previousTick;\n}","import * as React from \"react\";\nimport { useDelta } from 'hooks/store/engine';\nimport { useEffect, useRef, useState } from 'react';\nimport \"./styles/progressbar.scss\";\n\nexport enum Direction {\n    increasing,\n    decreasing\n}\n\nexport interface Props {\n    progress?: number;     // between 0 and 1\n    label?: string;\n    className?: string;\n    direction?: Direction; // only used to prevent the bar from animating back to the start state\n}\n\nconst Progressbar = (props: Props) => {\n    const { className = \"\", direction } = props;\n    const previousProgress = useRef(0);\n    const progress: number = clamp(props.progress || 0, 0, 1);\n    // We use the delta time since last tick to animate\n    const delta = useDelta();\n\n    // If we have a direction defined and we're going the other direction, dont animate\n    // because we've basically reset the progress bar and we just want to animate in one direction\n    const [animate, setAnimate] = useState(false);\n\n    useEffect(() => {\n        setAnimate(\n             direction === undefined ||\n            (direction === Direction.increasing && progress > previousProgress.current) ||\n            (direction === Direction.decreasing && progress < previousProgress.current)\n        );\n    }, [direction, progress]);\n\n\n    previousProgress.current = progress;\n    return (\n        <div className={`progressbar ${className}`}>\n            <div className=\"progressbar-label\">{props.label}</div>\n            <div className=\"progressbar-bar\" style= {{\n                width: `${progress * 100}%`,\n                ...(animate && {transition: `width ${delta}ms linear`})\n            }}/>\n        </div>\n    );\n};\n\nexport default Progressbar;\n\nfunction clamp(val: number, min: number, max: number): number {\n    return val > max ? max : val < min ? min : val;\n}\n","import * as React from \"react\";\nimport { levelToXp, xpToLevel } from 'mechanics/adventurers/levels';\nimport Progressbar from 'components/ui/common/Progressbar';\nimport { TextManager } from 'global/TextManager';\n\nexport interface Props {\n    xp: number;\n}\n\nconst Level = (props: Props) => {\n    const { xp } = props;\n    const currentLevel = xpToLevel(xp);\n    const currentLevelXp = levelToXp(currentLevel); // start\n    const nextLevel = currentLevel + 1;\n    const nextLevelXp = levelToXp(nextLevel);\n\n    return (\n        <div className=\"level\">\n            Level {currentLevel}\n            <Progressbar\n                progress={(xp - currentLevelXp) / (nextLevelXp - currentLevelXp)}\n                label={TextManager.get(\"ui-adventurer-info-xp-progress\", {\n                    xp: Math.floor(xp - currentLevelXp),\n                    next: nextLevelXp - currentLevelXp\n                })}\n            />\n        </div>\n    )\n}\nexport default Level;\n\n","export interface TraitDefinition {\n    trait: Trait;\n    hasEffect?: boolean;\n}\n\nexport enum Trait {\n    arrowFinder = \"arrowFinder\",\n    gloomy = \"gloomy\",\n    houseHouston = \"houseHouston\",\n    houseMaddox = \"houseMaddox\",\n    houseMonroe = \"houseMonroe\",\n}\n\n","import { SceneControllerContext } from 'components/world/QuestPanel/context/SceneControllerContext';\nimport { TextManager } from 'global/TextManager';\nimport useQuest from 'hooks/store/useQuest';\nimport React, { useContext, useMemo } from \"react\";\nimport { AdventurerStoreState } from 'store/types/adventurer';\n\nexport interface Props {\n    adventurer: AdventurerStoreState;\n    questName?: string;\n}\n\n/** Used when AdventurerPanel is used in Quest view\n * todo: move outside of /world\n */\nconst ApIndicator = (props: Props) => {\n    const quest = useQuest(props.questName!);\n    const controller = useContext(SceneControllerContext)!;\n\n    const ap = useMemo(() => {\n        if (!controller) return null;\n        return controller.getActorByAdventurerId(props.adventurer.id)?.ap || null;\n    }, [controller, props.adventurer.id]);\n\n    if (!quest?.scene?.combat) {\n        return null;\n    }\n    return (\n        <span>{TextManager.get(\"ui-adventurer-info-ap-remaining\", { ap })}</span>\n    );\n}\n\nexport default ApIndicator;","import { TraitDefinition, Trait } from './types';\n\nconst all = {\n    [Trait.arrowFinder]: {\n        trait: Trait.arrowFinder,\n        hasEffect: true\n    },\n    [Trait.gloomy]: {\n        trait: Trait.gloomy,\n        hasEffect: true\n    },\n    [Trait.houseHouston]: {\n        trait: Trait.houseHouston,\n    },\n    [Trait.houseMaddox]: {\n        trait: Trait.houseMaddox,\n    },\n    [Trait.houseMonroe]: {\n        trait: Trait.houseMonroe,\n    }\n};\n\nexport function getDefinition(trait: Trait): TraitDefinition {\n    return all[trait];\n}","import React, { Fragment } from \"react\";\nimport { useAdventurerState } from 'hooks/store/adventurers';\nimport { Trait } from 'definitions/traits/types';\nimport './styles/adventurerTraits.scss';\nimport { getDefinition } from 'definitions/traits';\nimport { TextManager } from 'global/TextManager';\nimport { ContextType } from 'constants/context';\nimport { TooltipManager } from 'global/TooltipManager';\n\ninterface Props {\n    adventurerId: string;\n}\n\nconst AdventurerTraits = (props: Props) => {\n    const adventurer = useAdventurerState(props.adventurerId);\n\n    const renderTrait = (trait: Trait, last: boolean) => {\n        const traitDefinition = getDefinition(trait);\n        const handleClick = (event: React.MouseEvent) => {\n            const origin = (event.currentTarget as HTMLElement);\n            const originRect = origin.getBoundingClientRect();\n            TooltipManager.showContextTooltip(ContextType.trait, traitDefinition, originRect);\n            event.stopPropagation();\n        };\n        return (\n            <Fragment key={trait}>\n                <li onClick={handleClick}>\n                    {TextManager.getTraitName(trait)}\n                </li>\n                {!last && (', ')}\n            </Fragment>\n        )\n    };\n\n    if (!adventurer?.traits) {\n        return null;\n    }\n    return (\n        <>\n            <p>{TextManager.get(\"ui-adventurer-info-traits-title\")}</p>\n            <ul className=\"adventurer-traits\">\n                {adventurer.traits.map((t, i)=> renderTrait(t, i === adventurer.traits!.length -1))}\n            </ul>\n        </>\n    )\n}\n\nexport default AdventurerTraits;","import React, { useState, useEffect } from \"react\";\nimport AdventurerTabstrip from './AdventurerTabstrip';\nimport { createSelectAdventurersOnQuest } from 'store/selectors/adventurers';\nimport { useSelector, useDispatch } from 'react-redux';\nimport QuestDetails from './QuestDetails';\nimport { useHistory } from 'react-router';\nimport { getWorldLink } from 'utils/routing';\nimport LootCache from './modals/LootCache';\nimport useQuest from 'hooks/store/useQuest';\nimport { setActiveSceneInteractionModal } from 'store/actions/quests';\nimport Situation from './modals/Situation';\nimport SceneControllerContextProvider from './context/SceneControllerContext';\nimport CombatBar from './CombatBar';\nimport AdventurerPanel from 'components/ui/adventurer/AdventurerPanel';\nimport \"./styles/questPanel.scss\";\n\nenum Layout {\n    auto,       // horizontal on large screens, vertical on small screens\n    vertical,\n    horizontal\n}\n\ninterface Props {\n    questName: string;\n    layout?: Layout;\n}\n\nconst QuestPanel = (props: Props) => {\n    const history = useHistory();\n    const dispatch = useDispatch();\n    const {layout = Layout.auto} = props;\n    const adventurers = useSelector(createSelectAdventurersOnQuest(props.questName));\n    const leader = adventurers[0];\n    const [selectedAdventurerId, setSelectedAdventurerID] = useState<string>(leader?.id);\n\n    const quest = useQuest(props.questName);\n    const activeInteractionModal = quest?.scene?.activeInteractionModal;\n\n    const handleAdventurerSelected = (adventurerId: string) => {\n        setSelectedAdventurerID(adventurerId);\n    }\n\n    const handleCloseLootCacheModal = () => {\n        dispatch(setActiveSceneInteractionModal(props.questName));\n    }\n\n    useEffect(() => {\n        if (!adventurers.length) {\n            // no adventurers, something went wrong, perhaps invalid url\n            // bounce back to world\n            history.push(getWorldLink());\n       }\n    }, [adventurers.length, history]);\n    if (!adventurers.length) return null;\n\n    return (\n        <SceneControllerContextProvider questName={props.questName}>\n            { quest?.scene?.combat && <CombatBar questName={props.questName} selectedAdventurerId={selectedAdventurerId}/>}\n            <div className={`quest-panel quest-panel-${Layout[layout]}`}>\n                <div className=\"quest-area\">\n                    <QuestDetails\n                        questName={props.questName}\n                        selectedActorId={selectedAdventurerId}\n                        setSelectedActor={handleAdventurerSelected}\n                    />\n                    { activeInteractionModal && activeInteractionModal.type === 'lootCache' && (\n                        <div className=\"modal\" onClick={handleCloseLootCacheModal}>\n                            <LootCache\n                                cacheName={activeInteractionModal.lootCache}\n                                adventurerId={selectedAdventurerId}\n                                onClose={handleCloseLootCacheModal}\n                            />\n                        </div>\n                    )}\n                    { activeInteractionModal && activeInteractionModal.type === 'situation' && (\n                        <div className=\"modal\" onClick={handleCloseLootCacheModal}>\n                            <Situation\n                                situation={activeInteractionModal.situation}\n                                adventurerId={selectedAdventurerId}\n                                onClose={handleCloseLootCacheModal}\n                            />\n                        </div>\n                    )}\n                </div>\n                <div className=\"party-area\">\n                    <AdventurerTabstrip\n                        adventurers={adventurers}\n                        selectedAdventurerId={selectedAdventurerId}\n                        onAdventurerTabSelected={handleAdventurerSelected}\n                        disabled={activeInteractionModal !== undefined}\n                    />\n                    <div className=\"adventurer-details\">\n                        { selectedAdventurerId && (\n                            <AdventurerPanel\n                                adventurerId={selectedAdventurerId}\n                                questName={props.questName}\n                            />\n                        )}\n                    </div>\n                </div>\n            </div>\n        </SceneControllerContextProvider>\n    )\n}\n\nexport default QuestPanel;\n","import React from \"react\";\nimport './styles/guy.scss';\nimport { EquipmentSlotType } from 'components/ui/adventurer/EquipmentSlot';\nimport { useAdventurerDamageReduction } from 'hooks/store/adventurers';\n\n\nexport interface Props {\n    adventurerId: string\n}\n\n// A silhouette of a person with the Damage Reduction numbers\nconst Guy = (props: Props) => {\n    const {adventurerId} = props;\n\n    const damageReduction = useAdventurerDamageReduction(adventurerId);\n    const renderDamageReduction = (equipmentType: EquipmentSlotType) => {\n        const dR = damageReduction[EquipmentSlotType[equipmentType]];\n        if (!dR) {\n            return null;\n        }\n        return (\n            <div className={EquipmentSlotType[equipmentType]} key={equipmentType}>\n                {dR}\n            </div>\n        )\n    }\n\n    return (\n        <li className=\"guy\">\n            {(renderDamageReduction(EquipmentSlotType.head))}\n            {(renderDamageReduction(EquipmentSlotType.chest))}\n            {(renderDamageReduction(EquipmentSlotType.hands))}\n            {(renderDamageReduction(EquipmentSlotType.shoulders))}\n            {(renderDamageReduction(EquipmentSlotType.legs))}\n            {(renderDamageReduction(EquipmentSlotType.feet))}\n        </li>\n    )\n}\n\nexport default Guy;","import React from \"react\";\nimport { AdventurerStoreState } from 'store/types/adventurer';\nimport EquipmentSlot, { EquipmentSlotType } from 'components/ui/adventurer/EquipmentSlot';\nimport { Item } from 'definitions/items/types';\nimport DraggableItemIcon, { InventoryItemDragInfo } from 'components/ui/items/DraggableItemIcon';\nimport { DragSourceType } from 'constants/dragging';\nimport { TextManager } from 'global/TextManager';\nimport { IconSize } from 'components/ui/common/Icon';\nimport Guy from './Guy';\nimport './styles/adventurerEquipment.scss';\n\nexport interface Props {\n    adventurer: AdventurerStoreState\n    onDropItemEquipment: (dragInfo: InventoryItemDragInfo, slotType: EquipmentSlotType) => void;\n}\n\n// Shows the gear an adventurer is wearing\nconst AdventurerEquipment = (props: Props) => {\n    const { adventurer, onDropItemEquipment } = props;\n\n    const getEquipmentSlot = (slotType: EquipmentSlotType) => {\n        // returns EquipmentSlot\n        const item: Item | undefined = adventurer.equipment[EquipmentSlotType[slotType]];\n\n        return (\n            <li className={EquipmentSlotType[slotType]}>\n                <EquipmentSlot\n                    onDrop={(dragInfo: InventoryItemDragInfo) => onDropItemEquipment(dragInfo, slotType)}\n                    type={slotType}\n                >\n                    {item && (\n                        <DraggableItemIcon\n                            index={slotType}\n                            sourceId={adventurer.id}\n                            sourceType={DragSourceType.adventurerEquipment}\n                            item={item}\n                            size={IconSize.medium}\n                        />\n                    )}\n                </EquipmentSlot>\n                <span className=\"info\">{TextManager.getEquipmentSlot(slotType)}</span>\n            </li>\n        );\n    };\n    return (\n        <ul className=\"adventurer-equipment\">\n            {getEquipmentSlot(EquipmentSlotType.head)}\n            {getEquipmentSlot(EquipmentSlotType.chest)}\n            {getEquipmentSlot(EquipmentSlotType.hands)}\n            {getEquipmentSlot(EquipmentSlotType.shoulders)}\n            {getEquipmentSlot(EquipmentSlotType.legs)}\n            {getEquipmentSlot(EquipmentSlotType.feet)}\n            {getEquipmentSlot(EquipmentSlotType.mainHand)}\n            {getEquipmentSlot(EquipmentSlotType.offHand)}\n            <Guy adventurerId={adventurer.id} />\n        </ul>\n    )\n}\n\nexport default AdventurerEquipment;","import React, {  } from \"react\";\nimport { DragSourceType } from 'constants/dragging';\nimport Inventory from 'components/ui/inventory/Inventory';\nimport useItemDropActions from 'hooks/actions/useItemActions';\nimport { EquipmentSlotType } from 'components/ui/adventurer/EquipmentSlot';\nimport { InventoryItemDragInfo } from 'components/ui/items/DraggableItemIcon';\nimport { Item } from 'definitions/items/types';\nimport AdventurerSkills from './AdventurerSkills';\nimport { useAdventurerState } from 'hooks/store/adventurers';\nimport Level from 'components/ui/adventurer/AdventurerPanel/Level';\nimport ApIndicator from './ApIndicator';\nimport AdventurerTraits from './AdventurerTraits';\nimport AdventurerEquipment from './AdventurerEquipment';\nimport \"./styles/adventurerPanel.scss\";\n\nexport interface Props {\n    adventurerId: string;\n    questName?: string;\n    horizontalMode?: boolean;\n\n    name?: boolean; // whether to show the adventurer name\n    levelBar?: boolean; // whether to show the level bar\n    traits?: boolean; // whether to show traits\n    skills?: boolean; // whether to show skills\n}\n\n/** Vertical panel showing adventurer info\n */\nconst AdventurerPanel = (props: Props) => {\n    const {\n        adventurerId,\n        questName,\n        horizontalMode,\n        name = true,\n        levelBar = true,\n        traits = true,\n        skills = true\n    } = props;\n    const adventurer = useAdventurerState(adventurerId);\n    // const renderAttributes = () => Object.keys(adventurer.stats).map((stat) => {\n    //     const value: number = adventurer.stats[stat];\n    //     return <div key={`${adventurer.id}-${stat}`} > <b>{stat}</b>: {value.toFixed(1)} </div>;\n    // });\n\n    const {\n        dropItemEquipment,\n        dropItemInventory\n    } = useItemDropActions();\n\n    const handleDropItemEquipment = (dragInfo: InventoryItemDragInfo, slotType: EquipmentSlotType) => {\n        dropItemEquipment(dragInfo, slotType, adventurer);\n    };\n    const handleDropItemInventory = (item: Item, fromSlot: number, toSlot: number, sourceType: DragSourceType, sourceId?: string) => {\n        dropItemInventory(item, fromSlot, toSlot, sourceType, adventurer, sourceId);\n    }\n\n    return (\n        <div className={`adventurer-panel${(horizontalMode ? \" horizontal\" : \"\")}`}>\n            <div className=\"left\">\n                <div className=\"info\">\n                    { name && (\n                        <div className=\"name\">\n                            {adventurer.name}\n                            {questName && <ApIndicator questName={questName} adventurer={adventurer} />}\n                        </div>\n                    )}\n                    { levelBar && <Level xp={adventurer.xp} /> }\n\n                    { traits && <AdventurerTraits adventurerId={adventurer.id}/> }\n                    { skills && <AdventurerSkills adventurerId={adventurer.id}/> }\n                    {/* <div className=\"renderAttributes\">\n                        {renderAttributes()}\n                    </div> */}\n                </div>\n                <div className=\"equipment\">\n                    <AdventurerEquipment\n                        adventurer={adventurer}\n                        onDropItemEquipment={handleDropItemEquipment}\n                    />\n                </div>\n\n            </div>\n            <div className=\"right\">\n                <Inventory\n                    sourceType={DragSourceType.adventurerInventory}\n                    sourceId={adventurer.id}\n                    items={adventurer.inventory}\n                    className=\"inventory-small\"\n                    onDropItem={handleDropItemInventory}\n                />\n            </div>\n        </div>\n    )\n}\n\nexport default AdventurerPanel;\n","import Tab from \"components/ui/tabs/Tab\";\r\nimport Tabstrip from \"components/ui/tabs/Tabstrip\";\r\nimport * as React from \"react\";\r\nimport {LogChannel, LogEntry} from \"store/types/logEntry\";\r\nimport {TextManager} from \"global/TextManager\";\r\nimport {useState} from 'react';\r\nimport {useSelector} from 'react-redux';\r\nimport Button from 'components/ui/buttons/Button';\r\nimport { StoreState } from 'store/types';\r\nimport { QuestStoreState } from 'store/types/quest';\r\nimport { selectActiveQuests } from 'store/selectors/quests';\r\nimport \"./styles/simplelog.scss\";\r\n\r\n// tslint:disable-next-line:no-empty-interface\r\nexport interface Props {\r\n}\r\n\r\nenum ChannelType {\r\n    all,\r\n    town,\r\n    quest,\r\n}\r\n\r\ninterface ChannelDefinition {\r\n    label: string;\r\n    tabType: ChannelType;\r\n    tabId: string;\r\n    channelContext?: string;\r\n}\r\n\r\nconst SimpleLog = (props: Props) => {\r\n\r\n    const [expanded, setExpanded] = useState(false);\r\n    const [selectedTabId, setSelectedTabId] = useState(\"all\");\r\n\r\n    const logEntries = useSelector<StoreState, LogEntry[]>((store) => store.log);\r\n    const activeQuests = useSelector<StoreState, QuestStoreState[]>((store) => selectActiveQuests(store));\r\n\r\n\r\n    const channels: ChannelDefinition[]=[{\r\n        label: TextManager.get(\"ui-log-tab-all\"),\r\n        tabId: \"all\",\r\n        tabType: ChannelType.all,\r\n    }, {\r\n        label: TextManager.get(\"ui-log-tab-town\"),\r\n        tabId: \"town\",\r\n        tabType: ChannelType.town,\r\n    }];\r\n\r\n    const handleTabSelected = (tabId: string) => {\r\n        setSelectedTabId(tabId);\r\n    }\r\n\r\n    const handleToggleExpand=() => {\r\n        setExpanded(!expanded);\r\n    }\r\n\r\n    activeQuests.forEach((quest) => {\r\n        const questName = quest.name;\r\n        channels.push({\r\n            channelContext: questName,\r\n            label: TextManager.getQuestTitle(questName),\r\n            tabId: `quest-${questName}`,\r\n            tabType: ChannelType.quest,\r\n        });\r\n    });\r\n\r\n    let displayEntries: LogEntry[] = [];\r\n    const currentTab=channels.find((t) => t.tabId === selectedTabId)!;\r\n\r\n    switch (currentTab.tabType) {\r\n        case ChannelType.all:\r\n            // All the things\r\n            displayEntries = logEntries;\r\n            break;\r\n\r\n        case ChannelType.town:\r\n            // Only town\r\n            displayEntries = logEntries.filter((lE) => lE.channel === LogChannel.town);\r\n            break;\r\n\r\n        case ChannelType.quest:\r\n            // Only the selected quest\r\n            displayEntries = logEntries.filter((lE) => lE.channel === LogChannel.quest && lE.channelContext === currentTab.channelContext);\r\n            break;\r\n}\r\n\r\n    const getLogEntryRow = (logEntry: LogEntry) => {\r\n        const text = TextManager.get(logEntry.key, logEntry.context);\r\n        return (\r\n            <div className=\"entry\" key={logEntry.time}>\r\n                {text}\r\n            </div>\r\n        );\r\n    };\r\n\r\n    return (\r\n        <div className={`log ${expanded ? \"expanded\" : \"\"}`}>\r\n            <div className=\"tab-bar\">\r\n                <Tabstrip className=\"tabs\" onTabSelected={handleTabSelected} activeTab={selectedTabId}>\r\n                    {channels.map((tab) => {\r\n                        return <Tab id={tab.tabId} key={tab.tabId}>{tab.label}</Tab>;\r\n                    })}\r\n                </Tabstrip>\r\n                <Button\r\n                    className=\"expand-button\"\r\n                    onClick={handleToggleExpand}\r\n                    square={true}\r\n                    size=\"small\"\r\n                    text={expanded ? \"▼\" : \"▲\"}\r\n                />\r\n            </div>\r\n            <div className=\"log-entries\">\r\n                {displayEntries.map((entry) => getLogEntryRow(entry))}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default SimpleLog;\r\n","import WorldMap from \"components/world/WorldMap\";\r\nimport React, { useEffect, useRef } from \"react\";\r\nimport { MusicTrack, SoundManager, Sound } from \"global/SoundManager\";\r\nimport QuestPanel from './QuestPanel';\r\nimport { useRouteMatch, useHistory } from 'react-router';\r\nimport { getQuestLink, getWorldLink } from 'utils/routing';\r\nimport \"./styles/worldView.scss\";\r\n\r\n// tslint:disable-next-line:no-empty-interface\r\nexport interface Props {\r\n}\r\n\r\n\r\n/**\r\n * WorldView shows the map and QuestPanel\r\n * @param props\r\n */\r\nconst WorldView = () => {\r\n    const worldMapRef = useRef<HTMLDivElement>(null);\r\n    const match = useRouteMatch<{questname: string}>(`${getWorldLink()}/:questname`);\r\n    const selectedQuestName = match?.params.questname;\r\n    const history = useHistory();\r\n\r\n    useEffect(() => {\r\n        SoundManager.addMusicTrack(MusicTrack.world, \"sound/music/TheLoomingBattle.ogg\");\r\n        SoundManager.playMusicTrack(MusicTrack.world);\r\n    }, []);\r\n\r\n    // console.log(params.questname);\r\n    // const handleMapMove = (distance: number, angle: number) => {\r\n    //     const compassEl = compassRef!.current!;\r\n    //     const compassTextEl = compassEl.firstElementChild! as HTMLElement;\r\n\r\n    //     // Rotate the compass\r\n    //     compassEl.style.transform = `rotate(${angle - (Math.PI / 2)}rad)`;\r\n    //     compassEl.style.opacity = distance > 10 ? \"1\" : \"0\";\r\n    //     compassTextEl.style.transform = `rotate(${-angle + (Math.PI / 2)}rad)`;\r\n    //     compassTextEl.innerHTML = `${distance.toFixed(0)}`;\r\n    // };\r\n\r\n    // const handleCompassClick = () => {\r\n    //     //setScrollToPosition(new Vector2(1, 1));\r\n    // };\r\n\r\n    const handlePartyClick = (questName: string) => {\r\n        if (questName === selectedQuestName) {\r\n            history.push(getWorldLink());\r\n        } else {\r\n            history.push(getQuestLink(questName));\r\n        }\r\n        SoundManager.playSound(Sound.buttonClick);\r\n    };\r\n\r\n    const handleRetrieveWorldViewRef = () => {\r\n        return worldMapRef;\r\n    }\r\n\r\n    return (\r\n        <div className=\"world-view\" ref={worldMapRef}>\r\n            {/* <div className=\"compass\" ref={compassRef} onClick={handleCompassClick}>\r\n                <div className=\"distance\"/>\r\n            </div> */}\r\n            <WorldMap\r\n                selectedQuestName={selectedQuestName}\r\n                // onMapMove={handleMapMove}\r\n                smallMap={selectedQuestName != null}\r\n                onPartyClick={handlePartyClick}\r\n                retrieveWorldViewRef={handleRetrieveWorldViewRef}\r\n            />\r\n            { selectedQuestName && (\r\n                <QuestPanel questName={selectedQuestName} />\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default WorldView;\r\n","// tslint:disable:object-literal-sort-keys\nimport { Action, AnyAction } from \"redux\";\nimport { TaskType } from \"store/types/task\";\n\nexport enum ActionType {\n    start = \"startTask\",\n    update = \"updateTasks\",\n}\n\nexport interface AddAction extends Action<ActionType> {\n    taskType: TaskType;\n    name: string;\n    origin: string;\n    time: number;\n    callbacks: AnyAction[];\n}\n\nexport function startTask(taskType: TaskType,\n                          name: string, origin: string, time: number, callbacks: AnyAction[]): AddAction {\n    return {\n        type: ActionType.start,\n        taskType,\n        name,\n        origin,\n        time,\n        callbacks,\n    };\n}\n","import { AnyAction } from \"redux\";\n\nexport enum TaskType {\n    buildStructure,\n    upgradeStructure,\n    craftItem,\n    studyItem\n}\n\nexport interface TaskStoreState {\n    type: TaskType;\n    name: string;\n    origin: string;\n    startTime: number;        // time the task was scheduled\n    lastTick: number;         // time of last tick\n    timeRemaining: number;\n    progress: number;         // value between 0 and 1 indicating progress\n    callbacks: AnyAction[];\t  // actions to dispatch on complete\n}\n","import { useCallback } from 'react';\nimport { StoreState } from 'store/types';\nimport { useSelector } from 'react-redux';\nimport { Structure } from 'definitions/structures';\nimport { StructureStoreState } from 'store/types/structure';\n\n// Returns the structure state from redux store\nexport default function useStructureState<T extends StructureStoreState>(structure: Structure): T {\n    const structureSelector = useCallback(\n        (state: StoreState) => state.structures[structure] as T,\n        [structure]\n    );\n    return useSelector<StoreState, T>(structureSelector);\n}\n","import * as React from \"react\";\nimport { useDispatch } from 'react-redux';\nimport { Structure, getDefinition } from 'definitions/structures';\nimport { subtractGold } from 'store/actions/gold';\nimport { startBuildingStructure, finishBuildingStructure } from 'store/actions/structures';\nimport { startTask } from 'store/actions/tasks';\nimport { TaskType } from 'store/types/task';\nimport { DeedDefinition } from 'definitions/items/deeds';\nimport useGoldState from 'hooks/store/useGoldState';\nimport useStructureState from 'hooks/store/useStructureState';\nimport { StructureState } from 'store/types/structure';\nimport { TextManager } from 'global/TextManager';\nimport Button from 'components/ui/buttons/Button';\n\ninterface Props {\n    info: DeedDefinition;\n}\n\nconst DeedContent = (props: Props) => {\n    const { info } = props;\n    const dispatch = useDispatch();\n\n    const gold = useGoldState();\n    const structureDefinition = getDefinition(info.structure);\n    const enoughGold = structureDefinition.cost.gold || 0 <= gold;\n    const structureStoreState = useStructureState(info.structure);\n    const canBeBuilt = structureStoreState.state === StructureState.NotBuilt;\n    const disabled = !canBeBuilt || !enoughGold;\n    const subtext = TextManager.getItemSubtext(info.item);\n\n    const handleStartConstruction = (structure: Structure) => {\n\n        dispatch(subtractGold(structureDefinition.cost.gold || 0));\n        dispatch(startBuildingStructure(structure));\n\n        const callbacks = [ finishBuildingStructure(structure) ];\n        const time = structureDefinition.cost.time!;\n        const start = startTask(TaskType.buildStructure,\n            `${structure}.build`,\n            \"town\",\n            time,\n            callbacks);\n        dispatch(start);\n    }\n    return (\n        <div>\n            { subtext && (<p className=\"subtext\">\"{subtext}\"</p>)}\n            <Button\n                disabled={disabled}\n                size=\"small\"\n                onClick={() => handleStartConstruction(info.structure)}\n            >\n                Start construction ({ structureDefinition.cost.gold } gold)\n            </Button>\n        </div>\n    );\n\n}\n\nexport default DeedContent;","// tslint:disable:object-literal-sort-keys\n\nimport * as time from \"utils/format/time\";\nimport { Item } from \"../items/types\";\nimport { ProductionDefinition } from \"./types\";\n\nconst weaponsmithProduction: {[key: string]: ProductionDefinition} = {\n    [Item.aegisOfValor]: {\n        item: Item.aegisOfValor,\n        levelRequired: 3,\n        cost: {\n            resources: { wood: 20, iron: 5 },\n            time: time.HALF_HOUR,\n        },\n    },\n    [Item.arbalest]: {\n        item: Item.arbalest,\n        cost: {\n            resources: { wood: 20, iron: 5 },\n            time: time.HALF_HOUR,\n        },\n    },\n    [Item.battleAxe]: {\n        item: Item.battleAxe,\n        cost: {\n            resources: { wood: 20, iron: 5 },\n            time: time.HALF_HOUR,\n        },\n    },\n    [Item.berserkerShield]: {\n        item: Item.berserkerShield,\n        levelRequired: 2,\n        cost: {\n            resources: { wood: 20, iron: 5 },\n            time: time.HALF_HOUR,\n        },\n    },\n    [Item.brassKnuckles]: {\n        item: Item.brassKnuckles,\n        cost: {\n            resources: { wood: 20, iron: 5 },\n            time: time.HALF_HOUR,\n        },\n    },\n    [Item.simpleCrossbow]: {\n        item: Item.simpleCrossbow,\n        cost: {\n            resources: { wood: 20, iron: 5 },\n            time: time.HALF_HOUR,\n        },\n    },\n    [Item.cleaver]: {\n        item: Item.cleaver,\n        cost: {\n            resources: { wood: 10, iron: 15 },\n            time: time.HALF_HOUR,\n        },\n    },\n    [Item.club]: {\n        item: Item.club,\n        cost: {\n            resources: { wood: 30,},\n            time: time.HALF_HOUR,\n        },\n    },\n    [Item.dagger]: {\n        item: Item.dagger,\n        cost: {\n            resources: { wood: 10, iron: 10},\n            time: time.ONE_HOUR,\n        },\n    },\n    [Item.flail]: {\n        item: Item.flail,\n        cost: {\n            resources: { wood: 10, iron: 10},\n            time: time.ONE_HOUR,\n        },\n    },\n    [Item.goldenShield]: {\n        item: Item.goldenShield,\n        levelRequired: 2,\n        cost: {\n            resources: { wood: 20, iron: 5 },\n            time: time.HALF_HOUR,\n        },\n    },\n    [Item.javelin]: {\n        item: Item.javelin,\n        cost: {\n            resources: { wood: 20, iron: 10},\n            time: time.ONE_HOUR + time.HALF_HOUR,\n        },\n    },\n    [Item.khopesh]: {\n        item: Item.khopesh,\n        cost: {\n            resources: { wood: 15, iron: 40},\n            time:  time.TWO_MINUTES,\n        },\n    },\n    [Item.longbow]: {\n        item: Item.longbow,\n        cost: {\n            resources: { wood: 40, iron: 5},\n            time: time.ONE_HOUR,\n        },\n    },\n    [Item.mace]: {\n        item: Item.mace,\n        cost: {\n            resources: { wood: 15, iron: 10},\n            time: time.ONE_HOUR,\n        },\n    },\n    [Item.morningStar]: {\n        item: Item.morningStar,\n        cost: {\n            resources: { wood: 15, iron: 15},\n            time: time.ONE_HOUR,\n        },\n    },\n    [Item.paintedBuckler]: {\n        item: Item.paintedBuckler,\n        cost: {\n            resources: { wood: 20, iron: 10},\n            time: time.ONE_HOUR + time.HALF_HOUR,\n        },\n    },\n    [Item.poisonedDagger]: {\n        item: Item.poisonedDagger,\n        cost: {\n            resources: { wood: 50, iron: 15},\n            materials: [ Item.poisonVial ],\n            time: time.ONE_HOUR,\n        },\n    },\n    [Item.ravenStaff]: {\n        item: Item.ravenStaff,\n        cost: {\n            resources: { wood: 15, iron: 10, food: 5},\n            time: time.ONE_HOUR,\n        },\n    },\n    [Item.savageStaff]: {\n        item: Item.savageStaff,\n        cost: {\n            resources: { wood: 15, iron: 10, food: 5},\n            time: time.ONE_HOUR,\n        },\n    },\n    [Item.spear]: {\n        item: Item.spear,\n        cost: {\n            resources: { wood: 15, iron: 15},\n            time: time.ONE_HOUR,\n        },\n    },\n    [Item.steelShield]: {\n        item: Item.steelShield,\n        cost: {\n            resources: { wood: 15, iron: 15},\n            time: time.ONE_HOUR,\n        },\n    },\n    [Item.sword]: {\n        item: Item.sword,\n        cost: {\n            resources: { wood: 10, iron: 30},\n            time:  time.ONE_HOUR,\n        },\n    },\n    [Item.warhammer]: {\n        item: Item.warhammer,\n        cost: {\n            resources: { wood: 10, iron: 30},\n            time:  time.ONE_HOUR,\n        },\n    },\n    [Item.woodenBulwark]: {\n        item: Item.woodenBulwark,\n        cost: {\n            resources: { wood: 10, iron: 30},\n            time:  time.ONE_HOUR,\n        },\n    },\n};\nexport default weaponsmithProduction;\n\nexport function getDefinition(item: Item) {\n    return weaponsmithProduction[item];\n}\n","// tslint:disable:object-literal-sort-keys\n\nimport * as time from \"utils/format/time\";\nimport {    Item} from \"../items/types\";\nimport {  ProductionDefinition } from \"./types\";\n\n// todo: real values for costs\nconst armoursmithProduction: { [key: string]: ProductionDefinition } = {\n    [Item.boots1]: {\n        item: Item.boots1,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        },\n    },\n    [Item.boots2]: {\n        item: Item.boots2,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        },\n        levelRequired: 2\n    },\n    [Item.boots3]: {\n        item: Item.boots3,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        },\n        levelRequired: 3\n    },\n    [Item.chainmailHood]: {\n        item: Item.chainmailHood,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    [Item.chest]: {\n        item: Item.chest,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    [Item.clothGloves]: {\n        item: Item.clothGloves,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        },\n    },\n    [Item.cowl]: {\n        item: Item.cowl,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    [Item.druidChest]: {\n        item: Item.druidHands,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        },\n        levelRequired: 2\n    },\n    [Item.druidFeet]: {\n        item: Item.druidFeet,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        },\n        levelRequired: 2\n    },\n    [Item.druidHands]: {\n        item: Item.druidHands,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        },\n        levelRequired: 2\n    },\n    [Item.druidHead]: {\n        item: Item.druidHead,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        },\n        levelRequired: 2\n    },\n    [Item.druidLegs]: {\n        item: Item.druidLegs,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        },\n        levelRequired: 2\n    },\n    [Item.fedora]: {\n        item: Item.fedora,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    [Item.greaves1]: {\n        item: Item.greaves1,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    [Item.greaves2]: {\n        item: Item.greaves2,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    [Item.hornedHelmet]: {\n        item: Item.hornedHelmet,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    [Item.leatherGloves]: {\n        item: Item.leatherGloves,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    [Item.nomadHelmet]: {\n        item: Item.nomadHelmet,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    [Item.pants1]: {\n        item: Item.pants1,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    [Item.pants2]: {\n        item: Item.pants2,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    [Item.plateChest1]: {\n        item: Item.plateChest1,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    [Item.plateChest2]: {\n        item: Item.plateChest2,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    [Item.plateChest3]: {\n        item: Item.plateChest3,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    [Item.plateChest4]: {\n        item: Item.plateChest4,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    [Item.plateGloves1]: {\n        item: Item.plateGloves1,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    [Item.plateGloves2]: {\n        item: Item.plateGloves2,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    [Item.plateHelmet]: {\n        item: Item.plateHelmet,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    [Item.platePants]: {\n        item: Item.platePants,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    [Item.plateShoulders1]: {\n        item: Item.plateShoulders1,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    [Item.plateShoulders2]: {\n        item: Item.plateShoulders2,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        },\n    },\n    [Item.robe]: {\n        item: Item.robe,\n        cost: {\n            resources: { wood: 10, iron: 45},\n            time: time.ONE_HOUR,\n        }\n    },\n    [Item.shoulders1]: {\n        item: Item.shoulders1,\n        cost: {\n            resources: { wood: 10, iron: 45},\n            time: time.ONE_HOUR,\n        }\n\n    },\n    [Item.shoulders2]: {\n        item: Item.shoulders2,\n        cost: {\n            resources: { wood: 10, iron: 45},\n            time: time.ONE_HOUR,\n        }\n\n    },\n    [Item.shoulders3]: {\n        item: Item.shoulders3,\n        cost: {\n            resources: { wood: 10, iron: 45},\n            time: time.ONE_HOUR,\n        }\n\n    },\n    [Item.vest]: {\n        item: Item.vest,\n        cost: {\n            resources: { wood: 10, iron: 45},\n            time: time.ONE_HOUR,\n        }\n    },\n};\nexport default armoursmithProduction;\n","import React, { useEffect, useRef, useState } from 'react';\nimport { TooltipManager } from 'global/TooltipManager';\nimport { InfoWindow } from 'components/ui/modals/InfoWindow';\nimport './styles/tooltip.scss';\n\nconst ARROW_SIZE = 8; // warning: sync to tooltip.css var\nconst PADDING = 8;\n\nexport interface Props {\n    referenceRect: ClientRect;  // place tooltip in reference to this rect\n    placement?: Placement;\n    children?: any;\n    className?: string;\n}\n\nexport enum Placement {\n    bottom,\n    top,\n    left,\n    right,\n}\n\nexport const Tooltip = (props: Props) => {\n    const { children, referenceRect } = props;\n    let { className = \"\" } = props;\n    const ref = useRef<HTMLDivElement>(null);\n    const [placement, setPlacement] = useState<Placement>(props.placement || Placement.bottom);\n\n    const [containerRect, setContainerRect] = useState<ClientRect>(); // This is the\n\n    useEffect(() => {\n        // Reposition if needed\n        const tooltipElement = ref.current;\n        if (!tooltipElement) return;\n        if (!containerRect) return;\n        const tooltipRect = tooltipElement.getBoundingClientRect();\n\n        // Flip vertically\n        switch (placement) {\n            case Placement.top:\n                if (tooltipRect.top - tooltipRect.height - ARROW_SIZE - PADDING < containerRect!.top) {\n                    // Too high, place underneath\n                    setPlacement(Placement.bottom);\n                    return;\n                }\n                break;\n            case Placement.bottom:\n                if (tooltipRect.top + tooltipRect.height + ARROW_SIZE + PADDING > containerRect!.height) {\n                    // Too low, place top\n                    setPlacement(Placement.top);\n                    return;\n                }\n                break;\n        }\n        tooltipElement.style.opacity = \"1\"; // animated through css\n\n        const contentElement = tooltipElement.querySelector(\".tooltip-content\") as HTMLElement;\n        if (tooltipRect.left < containerRect!.left + PADDING) {\n            // Check left bounding edge\n            const offset = containerRect!.left - tooltipRect.left + PADDING;\n            contentElement.style.transform = `translateX(${offset}px)`;\n        } else if (tooltipRect.right > containerRect!.right - PADDING) {\n            // Check right bounding edge\n            const offset = tooltipRect.right - containerRect!.right + PADDING;\n            contentElement.style.transform = `translateX(${-offset}px)`;\n        } else {\n            contentElement.style.transform = '';\n        }\n\n    }, [setPlacement, containerRect, placement, referenceRect]);\n\n    const resize = () => {\n        TooltipManager.clear();\n    }\n\n    useEffect(() => {\n        setContainerRect(ref.current?.closest('.app')?.getBoundingClientRect());\n\n        window.addEventListener(\"resize\", resize);\n        return () => {\n            window.removeEventListener(\"resize\", resize);\n        };\n    }, []);\n\n\n    let x: number = 0;\n    let y: number = 0;\n\n    if (containerRect) {\n        switch (placement) {\n            case Placement.bottom:\n                x = referenceRect.left - containerRect!.left + referenceRect.width / 2;\n                y = referenceRect.top - containerRect!.top + referenceRect.height;\n                className += \" tooltip-bottom\";\n                break;\n            case Placement.top:\n                x = referenceRect.left - containerRect!.left + referenceRect.width / 2;\n                y = referenceRect.top - containerRect!.top;\n                className += \" tooltip-top\";\n                break;\n        }\n    }\n\n    return (\n        <div className={`tooltip ${className}`}\n            style={{\n                left: x,\n                opacity: 0,\n                top: y,\n            }}\n            ref={ref}\n        >\n            <div className=\"tooltip-arrow\" />\n            <InfoWindow className=\"tooltip-content\">\n                {children}\n            </InfoWindow>\n        </div>\n    );\n}\n\nexport default Tooltip;\n","// tslint:disable:object-literal-sort-keys\n\nimport * as time from \"utils/format/time\";\nimport { Item } from \"../items/types\";\nimport { ProductionDefinition } from \"./types\";\n\n\nconst workshopProduction: {[key: string]: ProductionDefinition} = {\n    [Item.torch]: {\n        item: Item.torch,\n        cost: {\n            resources: { wood: 2, fabric: 1 },\n            time: time.ONE_MINUTE,\n        },\n    },\n    [Item.sandwich]: {\n        item: Item.sandwich,\n        cost: {\n            resources: { food: 1 },\n            time: time.ONE_MINUTE / 2,\n        },\n    }\n};\nexport default workshopProduction;\n\n","// tslint:disable:object-literal-sort-keys\n\n// import * as time from \"utils/time\";\n// import { Item } from \"../items/types\";\nimport { ProductionDefinition } from \"./types\";\n\nconst alchemistProduction: {[key: string]: ProductionDefinition} = {\n};\nexport default alchemistProduction;\n\n","import weaponsmithProduction from './weaponsmith'\nimport armoursmithProduction from './armoursmith'\nimport { Structure } from 'definitions/structures';\nimport { Item } from 'definitions/items/types';\nimport { ProductionDefinition } from './types';\nimport workshopProduction from './workshop';\nimport alchemistProduction from './alchemist';\n\n// Returns the structure that produces given Item, or null if this Item is not produced anywhere\nexport const getProductionStructureForItem = (item: Item): Structure | null => {\n    if (alchemistProduction[item]){\n        return Structure.alchemist;\n    }\n    if (armoursmithProduction[item]){\n        return Structure.armoursmith;\n    }\n    if (weaponsmithProduction[item]){\n        return Structure.weaponsmith;\n    }\n    if (workshopProduction[item]){\n        return Structure.workshop;\n    }\n    return null;\n}\n\n\nconst all = {\n    ...alchemistProduction,\n    ...armoursmithProduction,\n    ...weaponsmithProduction,\n    ...workshopProduction\n};\n\nexport const getDefinition = (item: Item): ProductionDefinition => {\n    return all[item];\n}\n\n\n","import { createSelector } from \"reselect\";\nimport { StoreState } from \"store/types\";\nimport { TasksStoreState } from 'store/types/tasks';\nimport { Structure } from 'definitions/structures';\n\nconst getTasks = (state: StoreState) => state.tasks;\n\n/*\n * Returns a selector for the store that selects all crafting tasks running for given structure */\nexport const createSelectCraftingTasksByStructure = (structure: Structure) => {\n    const craftingTasksByStructure = (tasks: TasksStoreState) => {\n        return tasks.running.filter((val) => val.origin === `${structure}.craft`);\n    };\n    return createSelector([\n        getTasks],\n        craftingTasksByStructure,\n    );\n}\n\n/*\n * Returns a selector for the store that selects all study tasks running for given structure */\nexport const createSelectStudyingTasksByStructure = (structure: Structure) => {\n    const studyingTasksByStructure = (tasks: TasksStoreState) => {\n        return tasks.running.filter((val) => val.origin === `${structure}.study`);\n    };\n    return createSelector([\n        getTasks],\n        studyingTasksByStructure,\n    );\n}\n\n/*\n * Returns a selector for the store that selects all upgrade tasks running for given structure \n * Typically 0 or 1 */\nexport const createSelectUpgradeTasksByStructure = (structure: Structure) => {\n    const upgradeTasksByStructure = (tasks: TasksStoreState) => {\n        return tasks.running.filter((val) => val.name === `${structure}.upgrade`);\n    };\n    return createSelector([\n        getTasks],\n        upgradeTasksByStructure,\n    );\n}\n","import { useSelector } from 'react-redux';\nimport { TasksStoreState } from 'store/types/tasks';\nimport { createSelectCraftingTasksByStructure, createSelectStudyingTasksByStructure, createSelectUpgradeTasksByStructure } from 'store/selectors/tasks';\nimport { Structure } from 'definitions/structures';\nimport { StoreState } from 'store/types';\n\n// Returns all the tasks from redux store\nexport const useTasksState = () => {\n    return useSelector<StoreState, TasksStoreState>(store => store.tasks);\n}\n\n// Returns all running crafting tasks for given structure\nexport const useCraftingTasksStateByStructure = (structure: Structure) => {\n    return useSelector(createSelectCraftingTasksByStructure(structure));\n}\n\n// Returns all running crafting tasks for given structure\nexport const useStudyingTasksStateByStructure = (structure: Structure) => {\n    return useSelector(createSelectStudyingTasksByStructure(structure));\n}\n\n// Returns all running update tasks for given structure\nexport const useUpgradeTasksStateByStructure = (structure: Structure) => {\n    return useSelector(createSelectUpgradeTasksByStructure(structure));\n}\n\n","import * as time from \"utils/format/time\";\n\nexport const STUDY_TIME = time.TWO_MINUTES;","import * as React from \"react\";\nimport { Item } from 'definitions/items/types';\nimport { getDefinition as getProductionDefinition, getProductionStructureForItem } from 'definitions/production';\nimport useStructureState from 'hooks/store/useStructureState';\nimport { Structure } from 'definitions/structures';\nimport { ProductionStructureStoreState, StructureState } from 'store/types/structure';\nimport { getDefinition as getItemDefinition } from 'definitions/items';\nimport { Link } from 'react-router-dom';\nimport { getStructureLink } from 'utils/routing';\nimport { TextManager } from 'global/TextManager';\nimport { useStudyingTasksStateByStructure } from 'hooks/store/useTasksState';\nimport { startTask } from 'store/actions/tasks';\nimport { TaskType } from 'store/types/task';\nimport { useDispatch } from 'react-redux';\nimport { addItemToToProduces } from 'store/actions/structures';\nimport { formatDuration } from 'utils/format/time';\nimport { STUDY_TIME } from 'mechanics/studying';\nimport Button from 'components/ui/buttons/Button';\n\ninterface Props {\n    item: Item;\n}\n\nconst ProduceOrStudy = (props: Props) => {\n    const structure = getProductionStructureForItem(props.item);\n    const itemDefinition = getItemDefinition(props.item);\n    if (itemDefinition.unique) {\n        return (\n            <p>Unique item</p>\n        )\n    }\n    if (!structure) {\n        return null;\n    }\n    return (\n        <ProducedAtStructure item={props.item} structure={structure} />\n    )\n}\n\nconst ProducedAtStructure = (props: Props & { structure: Structure}) => {\n    const {structure} = props;\n    const structureStore: ProductionStructureStoreState = useStructureState(structure);\n    const studyTasks = useStudyingTasksStateByStructure(structure);\n    const dispatch = useDispatch();\n\n    if (!structure) {\n        return null;\n    }\n\n    // const structureDefinition = getStructureDefinition<ProductionStructureDefinition>(structure);\n    // Can already be produced\n    if (structureStore.produces.some((item: Item) => item === props.item)){\n        return (\n            <p>Constructed at:&nbsp;\n                <Link to={getStructureLink(structure)} >\n                    { TextManager.getStructureName(structure) }\n                </Link>\n            </p>\n        )\n    }\n\n    // Currently studied\n    const task = studyTasks.find(sT => sT.name === props.item);\n    if (task) {\n        return (\n            <p>\n                <Link to={getStructureLink(structure)} >\n                    {TextManager.get(\"ui-tooltip-study-currently-studying\")}\n                </Link>\n                {formatDuration(task.timeRemaining, true)}\n            </p>\n        )\n    }\n\n    // Cant study because the structure is not high lvl enough\n    const productionDefinition = getProductionDefinition(props.item);\n    if (structureStore.level < (productionDefinition.levelRequired || 0) || structureStore.state !== StructureState.Built) {\n\n        return (\n            <p className=\"invalid\">\n                {TextManager.get(\"ui-tooltip-study-requires-structure-level\", { structure, level: (productionDefinition.levelRequired || 0) + 1})}\n            </p>\n        )\n    }\n\n    const startStudy = () => {\n        const callbacks = [\n            addItemToToProduces(props.structure, props.item)\n        ];\n\n        const studyTime = STUDY_TIME;\n        const start = startTask(TaskType.studyItem,\n            props.item,\n            `${structure}.study`,\n            studyTime,\n            callbacks);\n        dispatch(start);\n    }\n\n    return (\n        <p>\n            <Button onClick={startStudy} size=\"small\">\n                {TextManager.get(\"ui-tooltip-study-start-study\")}\n            </Button>\n        </p>\n    );\n}\n\nexport default ProduceOrStudy;","import * as React from \"react\";\nimport { WeaponDefinition, DamageType, typeClassifications, WeaponType } from 'definitions/items/weapons';\nimport { TextManager } from 'global/TextManager';\nimport ProduceOrStudy from './ProduceOrStudy';\n\ninterface Props {\n    info: WeaponDefinition;\n}\n\nconst WeaponContent = (props: Props) => {\n    const { info } = props;\n    const subtext = TextManager.getItemSubtext(info.item);\n    const weaponType = TextManager.getWeaponType(info.weaponType);\n    const classification = TextManager.getWeaponClassification(typeClassifications[info.weaponType])\n\n    return (\n        <>\n            <div>{weaponType}\n              {info.weaponType !== WeaponType.shield && (` (${classification})`)}\n            </div>\n            { subtext && (<p className=\"subtext\">\"{subtext}\"</p>)}\n            { info.damage && <p> damage: { info.damage[DamageType.kinetic] } </p>}\n            <ProduceOrStudy item={info.item} />\n        </>\n    );\n\n}\n\nexport default WeaponContent;","import * as React from \"react\";\nimport { TextManager } from 'global/TextManager';\nimport { ApparelDefinition } from 'definitions/items/apparel';\nimport ProduceOrStudy from './ProduceOrStudy';\n\ninterface Props {\n    info: ApparelDefinition;\n}\n\nconst ApparelContent = (props: Props) => {\n    const { info } = props;\n    const { damageReduction } = info;\n    const subtext = TextManager.getItemSubtext(info.item);\n    const equipmentSlot = TextManager.getEquipmentSlot(info.equipmentType);\n    return (\n        <>\n            <div>{`${equipmentSlot}`}</div>\n            { subtext && (<p className=\"subtext\">\"{subtext}\"</p>)}\n            { damageReduction && <p> { TextManager.get(\"ui-tooltip-damage-reduction\", { damageReduction}) } </p> }\n            <ProduceOrStudy item={info.item} />\n        </>\n    );\n};\n\nexport default ApparelContent;","import * as React from \"react\";\nimport { ApparelDefinition } from \"definitions/items/apparel\";\nimport { DeedDefinition } from \"definitions/items/deeds\";\nimport { ItemDefinition, ItemType } from \"definitions/items/types\";\nimport { WeaponDefinition } from \"definitions/items/weapons\";\nimport DeedContent from './DeedContent';\nimport WeaponContent from './WeaponContent';\nimport ApparelContent from './ApparelContent';\nimport { TextManager } from 'global/TextManager';\nimport \"./styles/itemContext.scss\";\n\nexport interface Props {\n    info: ItemDefinition;\n}\n\nconst ItemContext = (props: Props) => {\n\n    const info = props.info;\n    switch (info.itemType) {\n        case ItemType.deed:\n           return <DeedContent info={info as DeedDefinition} />;\n\n        case ItemType.weapon:\n            return <WeaponContent info={info as WeaponDefinition} />;\n\n        case ItemType.apparel:\n            return <ApparelContent info={info as ApparelDefinition} />;\n\n        default:\n            const subtext = TextManager.getItemSubtext(info.item);\n            return (subtext && (<p className=\"subtext\">\"{subtext}\"</p>)) || null;\n    }\n}\nexport default ItemContext;","import * as React from \"react\";\nimport { TextManager } from 'global/TextManager';\nimport { useSelector } from 'react-redux';\nimport { StoreState } from 'store/types';\nimport { StructuresStoreState } from 'store/types/structures';\nimport { Resource } from 'definitions/resources';\nimport { getStructureByResource, getDefinition } from 'definitions/structures';\nimport { StructureState, StructureStoreState } from 'store/types/structure';\nimport { getStructureLink } from 'utils/routing';\nimport { Link } from 'react-router-dom';\nimport { ResourceStructureLevelDefinition, ResourceStructureDefinition } from 'definitions/structures/types';\nimport { useMaxResourcesState, useResourcesState } from 'hooks/store/resources';\nimport { formatNumber } from 'utils/format/number';\nimport useGoldState from 'hooks/store/useGoldState';\nimport { useWorkersFreeState, useWorkersState } from 'hooks/store/useWorkersState';\nimport './resourceContext.scss';\n\nexport interface Props {\n    info: string;\n}\n\nconst ResourceContext = (props: Props) => {\n\n    const resource = props.info;\n    const resourcesState = useResourcesState();\n    const goldState = useGoldState();\n    const workersState = useWorkersState();\n    const workersFreeState = useWorkersFreeState();\n    const structureStates = useSelector<StoreState, StructuresStoreState>(store => store.structures);\n    const maxResources = useMaxResourcesState();\n\n    const renderProducedBy = () => {\n        const structure = getStructureByResource(Resource[resource]);\n        const structureState: StructureStoreState = structureStates[structure];\n        if (structureState.state !== StructureState.Built) {\n            return (\n                <span>\n                    {TextManager.get(\"ui-tooltip-resource-produce-row-notbuilt\", {\n                        structure: TextManager.getStructureName(structure)\n                    })}\n                </span>\n            )\n        }\n        const structureDefinition = getDefinition<ResourceStructureDefinition>(structure);\n        const levelDefinition: ResourceStructureLevelDefinition = structureDefinition.levels[structureState.level];\n        const amount = levelDefinition.generates[resource];\n        // Split the string at {{structure}}\n        const split = TextManager.get(\"ui-tooltip-resource-produce-row\", {\n            structure: \"%SPLIT%\",\n            amount\n        }).split(\"%SPLIT%\");\n        return (\n            <span className=\"produced\">\n                {split[0]}\n                <Link to={getStructureLink(structure)} >\n                    { TextManager.getStructureName(structure) }\n                </Link>\n                {split[1]}\n            </span>\n        )\n    }\n\n    switch (resource) {\n        case Resource.fabric:\n        case Resource.food:\n        case Resource.iron:\n        case Resource.leather:\n        case Resource.stone:\n        case Resource.wood: {\n            const amount = formatNumber(resourcesState[resource]!, 0);\n            const full = resourcesState[resource]! >= maxResources[resource]!;\n            return (\n                <div className=\"resource-context\">\n                    <div className=\"info\">\n                        {TextManager.get(`resource-${resource}-info`)}\n                    </div>\n                    <div>\n                        {TextManager.get(`ui-tooltip-resource-quantity`, { amount } )}\n                    </div>\n                    <div>\n                        {renderProducedBy()}\n                    </div>\n                    { full && (\n                        <div className=\"warning-full\">\n                            {TextManager.get(`ui-tooltip-resource-warehouse-full`, { resource })}\n                        </div>\n                    )}\n                </div>\n            )\n        }\n        case \"gold\": {\n            const amount = goldState;\n            return (\n                <>\n                    <div className=\"resource-context\">\n                        <div className=\"info\">\n                            {` ${TextManager.get(`resource-${resource}-info`)}`}\n                        </div>\n                    </div>\n                    <div>\n                        {TextManager.get(`ui-tooltip-resource-quantity`, { amount } )}\n                    </div>\n                </>\n            )\n        }\n        case \"workers\": {\n            const free = workersFreeState;\n            const total = workersState;\n            return (\n                <>\n                    <div className=\"resource-context\">\n                       <div className=\"info\">\n                        {` ${TextManager.get(`resource-${resource}-info`)}`}\n                        </div>\n                    </div>\n                    <div>\n                        {TextManager.get(`ui-tooltip-workers-quantity`, { free, total } )}\n                    </div>\n                </>\n            )\n        }\n        default:\n            throw new Error(\"Uknow value \" + resource);\n    }\n\n}\nexport default ResourceContext;","import React, { ComponentProps, PropsWithChildren } from 'react';\nimport './styles/infoWindow.scss';\n\nexport interface Props {\n    className?: string;\n}\n\n// An InfoWindow is a semi transparant black square. It is used for tooltips\n// and InfoModal\nexport const InfoWindow = (props: PropsWithChildren<Props> & ComponentProps<\"div\">) => {\n    const { className, children, ...otherProps } = props;\n    return (\n        <div\n            {...otherProps}\n            className={`info-window ${className || \"\"}`}\n        >\n            {children}\n        </div>\n    )\n}\n","import * as React from \"react\";\nimport { TextManager } from 'global/TextManager';\nimport { TraitDefinition } from 'definitions/traits/types';\n import './styles/traitContext.scss';\n\nexport interface Props {\n    traitDefinition: TraitDefinition;\n}\n\nconst TraitContext = (props: Props) => {\n\n    const {traitDefinition} = props;\n\n    return (\n        <div className=\"trait-context\">\n            <div className=\"description\">\n                {TextManager.getTraitDescription(traitDefinition.trait)}\n            </div>\n            { traitDefinition.hasEffect && (\n            <div className=\"effect\">\n                {TextManager.getTraitEffect(traitDefinition.trait)}\n\n            </div>)}\n        </div>\n    )\n}\nexport default TraitContext;","import React, { ReactNode, useEffect, useState } from 'react';\nimport { ContextType } from 'constants/context';\nimport { TooltipManager, Context } from 'global/TooltipManager';\nimport { TextManager } from 'global/TextManager';\nimport ItemContext from './context/ItemContext';\nimport { ItemDefinition } from 'definitions/items/types';\nimport { Resource } from 'definitions/resources';\nimport ResourceContext from './context/ResourceContext';\nimport Tooltip from '../Tooltip';\nimport { TraitDefinition } from 'definitions/traits/types';\nimport TraitContext from './context/TraitContext';\nimport { WeaponType } from 'definitions/items/weapons';\nimport { Rarity } from 'constants/items';\nimport './styles/contextTooltip.scss';\n\n// A contextual popup showing what you just clicked.\n// Can be an Item, Resource, Trait, skill\nconst ContextTooltip = () => {\n\n    const [selectedContext, setSelectedContext] = useState<Context | undefined>();\n\n    const tooltipUpdated = (context: Context | undefined) => {\n        setSelectedContext(context);\n    }\n    useEffect(() => {\n        TooltipManager.addEventListener(TooltipManager.EVENT_CONTEXT_UPDATED, tooltipUpdated);\n        return () => {\n            TooltipManager.removeEventListener(TooltipManager.EVENT_CONTEXT_UPDATED, tooltipUpdated);\n        }\n    }, []);\n    if (!selectedContext) { return null; }\n\n    const { info, type, className } = selectedContext;\n    const renderContent = () => {\n        switch (type) {\n            case ContextType.resource: {\n                const name = TextManager.getResourceName(info as Resource);\n                return (\n                    <>\n                        <div className=\"name resource\">{name}</div>\n                        <ResourceContext info={info as string} />\n                    </>\n                );\n            }\n            case ContextType.item: {\n                const name = TextManager.getItemName((info as ItemDefinition).item);\n                const itemDefinition = info as ItemDefinition;\n                return (\n                    <>\n                        <div className={`name item ${getItemNameClassName(itemDefinition)}`}>{name}</div>\n                        <ItemContext info={itemDefinition} />\n                    </>\n                );\n            }\n            case ContextType.trait: {\n                const traitDefinition = info as TraitDefinition;\n                const name = TextManager.getTraitName(traitDefinition.trait);\n                return (\n                    <>\n                        <div className=\"name trait\">\n                            {TextManager.get(\"ui-tooltip-type-trait\")}\n                            {name}\n                        </div>\n                        <TraitContext traitDefinition={traitDefinition} />\n                    </>\n                );\n            }\n            case ContextType.skill: {\n                const skill = info as WeaponType;\n                const name = TextManager.getSkillName(skill);\n                return (\n                    <>\n                        <div className=\"name skill\">\n                            {TextManager.get(\"ui-tooltip-type-skill\")}\n                            {name}\n                        </div>\n                        { TextManager.getSkillInfo(skill)}\n                    </>\n                );\n            }\n            case ContextType.component: {\n                const component = info as ReactNode;\n                return component;\n            }\n            default: {\n                throw new Error(`Unknown context type ${selectedContext.type}`)\n            }\n        }\n    }\n\n    return (\n        <Tooltip referenceRect={selectedContext.referenceRect} className={className}>\n            <div className=\"context-tooltip\">\n                {renderContent()}\n            </div>\n        </Tooltip>\n    )\n}\nexport default ContextTooltip;\n\nexport const getItemNameClassName = (item: ItemDefinition): string => {\n    const {rarity} = item;\n    switch (rarity) {\n        case Rarity.common:\n            return \"item-name-common\";\n        case Rarity.uncommon:\n            return \"item-name-uncommon\";\n        case Rarity.rare:\n            return \"item-name-rare\";\n        case Rarity.epic:\n            return \"item-name-epic\";\n        case Rarity.legendary:\n            return \"item-name-legendary\";\n    }\n    return \"item-name-common\";\n};\n","import * as React from \"react\";\nimport \"./background.css\";\nimport { useEffect, useRef } from 'react';\nimport * as PIXI from \"pixi.js\";\nimport { Stage, Sprite, useTick } from '@inlet/react-pixi';\n\nconst Background = () => {\n\n    const ref = useRef();\n\n    const filter = useRef(new PIXI.Filter('', fragmentSrc, uniforms));\n    useEffect(() => {\n\n        // filter.current!.syncUniforms();\n        function update(timestamp: number) {\n            filter.current!.uniforms.time = (timestamp || 0) / 1000;\n            requestAnimationFrame(update);\n        }\n\n        requestAnimationFrame(update);\n    },[]);\n\n    return null;\n    // return (\n    //     <Stage width={window.innerWidth} height={window.innerHeight} className=\"background\">\n    //         <Sprite\n    //             image={'https://s3-us-west-2.amazonaws.com/s.cdpn.io/167451/test_BG.jpg'}\n    //             width={window.innerWidth}\n    //             height={window.innerHeight}\n    //             // filters={[filter.current]}\n    //         />\n    //     </Stage>\n    // )\n}\nexport default Background;\n\n\nconst uniforms = {\n    resolution: {\n        type: '2f',\n        value: {\n        x: window.innerWidth,\n        y: window.innerHeight,\n        },\n    },\n    alpha: {\n        type: '1f',\n        value: 1,\n    },\n    shift: {\n        type: '1f',\n        value: 1.6,\n    },\n    time: {\n        type: '1f',\n        value: 0,\n    },\n    speed: {\n        type: '2f',\n        value: {\n        x: 0.7,\n        y: 0.4,\n        },\n    },\n};\n\nconst fragmentSrc = `\n    precision mediump float;\n    uniform vec2      resolution;\n    uniform float     time;\n    uniform float     alpha;\n    uniform vec2      speed;\n    uniform float     shift;\n\n    float rand(vec2 n) {\n        return fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\n    }\n\n    float noise(vec2 n) {\n    const vec2 d = vec2(0.0, 1.0);\n    vec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\n        return mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\n    }\n\n    float fbm(vec2 n) {\n    float total = 0.0, amplitude = 1.0;\n    for (int i = 0; i < 4; i++) {\n        total += noise(n) * amplitude;\n        n += n;\n        amplitude *= 0.5;\n    }\n\n    return total;\n    }\n\n    void main() {\n    const vec3 c1 = vec3(126.0/255.0, 0.0/255.0, 97.0/255.0);\n    const vec3 c2 = vec3(173.0/255.0, 0.0/255.0, 161.4/255.0);\n    const vec3 c3 = vec3(0.2, 0.0, 0.0);\n    const vec3 c4 = vec3(164.0/255.0, 1.0/255.0, 214.4/255.0);\n    const vec3 c5 = vec3(0.1);\n    const vec3 c6 = vec3(0.9);\n\n    vec2 p = gl_FragCoord.xy * 8.0 / resolution.xx;\n    float q = fbm(p - time * 0.1);\n    vec2 r = vec2(fbm(p + q + time * speed.x - p.x - p.y), fbm(p + q - time * speed.y));\n    vec3 c = mix(c1, c2, fbm(p + r)) + mix(c3, c4, r.x) - mix(c5, c6, r.y);\n    float grad = gl_FragCoord.y / resolution.y;\n    gl_FragColor = vec4(c * cos(shift * gl_FragCoord.y / resolution.y), 1.0);\n    gl_FragColor.xyz *= 1.0-grad;\n    }\n`;","\nexport const manifest = [\n    \"sound/fx/button-click.ogg\",\n    \"sound/fx/error.ogg\",\n    \"sound/fx/toast.ogg\",\n    \"sound/music/Soliloquy.mp3\",\n    \"sound/music/TheLoomingBattle.ogg\",\n];\n","import React from \"react\";\nimport { Structure } from 'definitions/structures';\nimport \"./styles/structureViewHeader.scss\";\n\ninterface Props {\n    structure: Structure;\n}\n\nconst StructureViewHeader = (props: Props) => {\n    // const displayName = TextManager.getStructureName(props.structure);\n    return (\n        <div className={`structureview-header structureview-header-${props.structure}`}>\n            {/* <h1 className=\"app-h1-white\">{displayName}</h1> */}\n        </div>\n    );\n}\n\nexport default StructureViewHeader;","import * as React from \"react\";\nimport { AnyAction } from \"redux\";\nimport { TextManager } from 'global/TextManager';\nimport { subtractGold } from 'store/actions/gold';\nimport { addLogText } from 'store/actions/log';\nimport { LogChannel } from 'store/types/logEntry';\nimport { getDefinition, Structure } from 'definitions/structures';\nimport useGoldState from 'hooks/store/useGoldState';\nimport { useDispatch } from 'react-redux';\nimport { upgradeStructure } from 'store/actions/structures';\nimport useStructureState from 'hooks/store/useStructureState';\nimport Button from 'components/ui/buttons/Button';\nimport { startTask } from 'store/actions/tasks';\nimport { TaskType } from 'store/types/task';\nimport { useUpgradeTasksStateByStructure } from 'hooks/store/useTasksState';\nimport Progressbar from 'components/ui/common/Progressbar';\nimport { formatDuration } from 'utils/format/time';\nimport \"./styles/structureLevel.scss\";\n\nexport interface Props {\n    structure: Structure;\n    onHelpClicked?: (e: React.MouseEvent) => void;\n    addUpgradeCallbacks?: (level: number) => AnyAction[]; // add custom actions after upgrade is done\n}\n\nconst StructureLevel = (props: Props) => {\n    const {\n        structure,\n        onHelpClicked,\n        addUpgradeCallbacks\n    } = props;\n    const dispatch = useDispatch();\n    const gold = useGoldState();\n\n    const structureState = useStructureState(structure);\n    const level: number = structureState.level;\n    const structureDefinition = getDefinition(props.structure);\n\n    const nextLevel = structureDefinition.levels[level + 1];\n    const nextLevelCost = (nextLevel != null ? nextLevel.cost.gold || 0 : -1);\n    const canUpgrade = nextLevel != null && gold >= nextLevelCost;\n    const upgradeText = nextLevel == null ? TextManager.get(\"ui-structure-upgrade-max\") : TextManager.get(\"ui-structure-upgrade\", { cost: nextLevelCost, level: level + 2 });\n\n    const upgradeTasks = useUpgradeTasksStateByStructure(structure);\n\n    const handleUpgrade = (cost: number) => {\n        dispatch(subtractGold(cost));\n\n        const callbacks = [\n            ...(addUpgradeCallbacks?.(level + 1) || []),\n            upgradeStructure(structure),\n            addLogText(\"log-town-upgrade-structure-complete\", {\n                level: level + 1,\n                structure,\n            }, LogChannel.town)\n        ];\n        const time = nextLevel.cost.time!;\n        const start = startTask(TaskType.upgradeStructure,\n            `${structure}.upgrade`,\n            \"town\",\n            time,\n            callbacks);\n        dispatch(start);\n    }\n\n    if (upgradeTasks.length) {\n        const t = upgradeTasks[0];\n        return (\n            <Progressbar\n                key={`${t.name}${t.startTime}`}\n                className=\"upgrading\" // todo: margin: 8\n                label={`${TextManager.get(\"structure-upgrade-button-upgrading\")} (${formatDuration(t.timeRemaining)})`}\n                progress={t.progress}\n            />\n        )\n    }\n\n    return (\n        <div className=\"upgrade-stucture-button\">\n            <label>\n                {TextManager.get(\"ui-structure-level\")}\n                { level + 1 }\n            </label>\n            <Button\n                className=\"upgrade\"\n                onClick={() => {handleUpgrade(nextLevelCost)}}\n                disabled={!canUpgrade}>\n                    { upgradeText }\n            </Button>\n            { nextLevel != null && (\n                <Button className=\"help\" square={true} onClick={onHelpClicked}>\n                    ?\n                </Button>\n            )}\n        </div>\n    );\n};\n\nexport default StructureLevel;","import * as React from \"react\";\nimport { getDefinition, Structure } from 'definitions/structures';\nimport { formatDuration } from 'utils/format/time';\nimport { ProductionStructureDefinition } from 'definitions/structures/types';\nimport { IconSize } from 'components/ui/common/Icon';\nimport { TextManager } from 'global/TextManager';\nimport { Item } from 'definitions/items/types';\nimport ItemIcon from 'components/ui/items/ItemIcon';\nimport \"./styles/upgradeHelpModal.scss\"\n\nexport interface Props  {\n    structure: Structure;\n    level: number;\n}\n\nconst UpgradeHelpModal = (props: Props) => {\n    const { level, structure } = props;\n    const structureDefinition: ProductionStructureDefinition = getDefinition(structure);\n    const nextLevel = structureDefinition.levels[level + 1];\n\n    const renderRow = (item: Item) => {\n        return (\n            <ItemIcon key={item} item={item} size={IconSize.small} />\n        )\n    }\n\n    return (\n        <div className=\"production-upgrade-help-modal\">\n            <div className=\"top\">\n                <h3>{TextManager.get(\"ui-structure-help-upgrade-title\", { structure } )}</h3>\n                <div className=\"cost\">\n                    <section>\n                        {TextManager.get(\"ui-structure-help-upgrade-cost-gold\", { gold: nextLevel.cost.gold})}\n                    </section>\n                    { nextLevel.cost.time && <section>{formatDuration(nextLevel.cost.time)}</section> }\n                </div>\n            </div>\n            <div className=\"unlocks\">\n                {nextLevel.unlocks.map(item => renderRow(Item[item]))}\n            </div>\n        </div>\n    )\n}\n\nexport default UpgradeHelpModal;","// Todo: come up with a less retarded name\nimport * as React from \"react\";\nimport \"./styles/updownvalue.scss\";\n\nexport interface DispatchProps {\n    onUp?: (e: React.MouseEvent) => void;\n    onDown?: (e: React.MouseEvent) => void;\n}\nexport interface Props extends DispatchProps {\n    label?: string;\n    value?: number;\n    max?: number;\n    upDisabled?: boolean;\n    downDisabled?: boolean;\n}\n\nconst UpDownValue = (props: Props) => {\n    const handleUp = (e: React.MouseEvent) => {\n        if (props.onUp && !props.upDisabled) { props.onUp(e); }\n    };\n\n    const handleDown = (e: React.MouseEvent) => {\n        if (props.onDown && !props.downDisabled) { props.onDown(e); }\n    };\n\n    let displayValue;\n    if (props.max == null) {\n        displayValue = props.value;\n    } else {\n        displayValue = <span>\n            { props.value } / <span className=\"max\">{ props.max }</span>\n        </span>;\n    }\n    return (\n        <div className=\"updownvalue\">\n            <label> { props.label }</label>\n            { displayValue }\n            <i className= { \"arrow up\" + (props.upDisabled ? \" disabled\" : \"\" )}\n                onClick= { handleUp }\n            />\n            <i className={\"arrow down\" + (props.downDisabled ? \" disabled\" : \"\")}\n                onClick= { handleDown }\n            />\n        </div>\n    );\n};\n\nexport default UpDownValue;\n","import * as React from \"react\";\nimport itemsDescription from \"definitions/items\";\nimport { Item } from \"definitions/items/types\";\nimport { TextManager } from \"global/TextManager\";\nimport useStockpileState from 'hooks/store/useStockpileState';\nimport { useMemo } from 'react';\nimport Icon from 'components/ui/common/Icon';\nimport \"./styles/itemsBox.scss\";\n\nexport interface Props {\n    className?: string;\n    items: Item[];\n\n   // itemsInInventory?: Item[]; // Items that are in `items` array and also in inventory\n}\n\n\n/**\n * The ItemsBox displays a list of items, to be used as requirements for something\n */\nconst ItemsBox = (props: Props) => {\n    const { items } = props;\n    const className = (props.className || \"\") + \" items-box\";\n    const aggregate = items.reduce((accumulator: object, current: Item) => {\n        if (!accumulator[current]) {\n            accumulator[current] = 0;\n        }\n        accumulator[current]++;\n        return accumulator;\n    }, {});\n\n    const stockpile = useStockpileState();\n    const itemsInInventory: Item[] = useMemo(() => {\n        const tmpWarehouse = [ ...stockpile];\n        const tmpItems: Item[] = [];\n        items.forEach((item: Item) => {\n            const found = tmpWarehouse.findIndex((i) => i === item);\n            if (found > -1) {\n                // Remove the item from tmpWarehouse and add to itemsInInventory\n                const [ removed ] = tmpWarehouse.splice(found, 1);\n                if (removed) {\n                    tmpItems.push(removed);\n                }\n            }\n        });\n        return tmpItems;\n    }, [items, stockpile]);\n\n\n    const listItems = Object.keys(aggregate).map((key: string) => {\n        const item = key as Item;\n        const amount = aggregate[key] as number;\n        let listItemClass = \"item\";\n\n        // Check if we have enough\n        const amountInInventory = itemsInInventory ? itemsInInventory.filter((i) => i === item).length : 0;\n        if (amount > amountInInventory) {\n            listItemClass += \" missing\";\n        }\n        const itemDescription = itemsDescription[item];\n        return (\n            <li className={listItemClass} key={item}>\n                <Icon\n                    image={itemDescription.iconImg}\n                    size=\"smallest\"\n                />\n                <div className=\"name\">\n                    { `${TextManager.getItemName(item)} (${ amount })` }\n                </div>\n            </li>\n        );\n    });\n\n    return (\n        <ul className={className} >\n            {listItems}\n        </ul>\n    );\n};\n\nexport default ItemsBox;\n","import { Resource } from \"definitions/resources\";\nimport resourceDescriptions from \"definitions/resources\";\nimport * as React from \"react\";\nimport { ResourceStoreState } from \"store/types/resources\";\nimport { TextManager } from \"global/TextManager\";\nimport { useMemo } from 'react';\nimport { useResourcesState } from 'hooks/store/resources';\nimport Icon from 'components/ui/common/Icon';\nimport { ContextType } from 'constants/context';\nimport { TooltipManager } from 'global/TooltipManager';\nimport \"./styles/resourcesCost.scss\";\n\nexport interface Props {\n    className?: string;\n    resources: ResourceStoreState;\n}\n\n/**\n * \n */\nconst ResourcesCost = (props: Props) => {\n    const {\n        resources,\n    } = props;\n\n    const storeResources = useResourcesState();\n    const sufficientResources = useMemo(() => {\n        return Object.keys(resources).reduce((acc, value) => {\n            acc[value] = storeResources[value] >= resources[value];\n            return acc;\n        }, {});\n    }, [resources, storeResources]);\n\n    const className = (props.className || \"\") + \" resources-cost\";\n    const listItems = Object.keys(props.resources).map((resource: string) => {\n        let listItemClass = \"resource\";\n        if (sufficientResources && !sufficientResources[resource]) {\n            listItemClass += \" insufficient\";\n        }\n        const resourceDescription = resourceDescriptions[resource];\n        if (!resourceDescription) {\n            throw new Error(`No resource description found for ${resource}`);\n        }\n\n        const handleClick = (event: React.MouseEvent) => {\n\n            const origin = (event.currentTarget as HTMLElement);\n            const originRect = origin.getBoundingClientRect();\n            TooltipManager.showContextTooltip(ContextType.resource, resource, originRect);\n            event.stopPropagation();\n        };\n\n        return (\n            <li\n                className={listItemClass}\n                key={resource}\n            >\n                <Icon\n                    image={resourceDescription.iconImg}\n                    size=\"smallest\"\n                    onClick={handleClick}\n                />\n                <div className=\"name\">\n                    {TextManager.getResourceName(resource as Resource)}\n                </div>\n                <div className=\"amount\" >\n                    { props.resources[resource] }\n                </div>\n            </li>\n        );\n    });\n\n    return (\n        <ul className={className}>\n            {listItems}\n        </ul>\n    );\n};\n\nexport default ResourcesCost;","export const MAX_WORKERS_CRAFTING = 6;\n\n/**\n * Calculates the production time for productionDefinition with given amount of workers\n * @param productionDefinition\n * @param workers\n */\nexport const calculateProductionTime = (time: number, workers: number): number => {\n    if (workers > MAX_WORKERS_CRAFTING) {\n        throw new Error(`Cannot possibly have more than ${MAX_WORKERS_CRAFTING} on one item!`);\n    }\n    // Each additional worker shaves off 10% of the production time\n    return time - (.1 * time * (workers - 1));\n};\n","import React, { useState } from 'react';\nimport { useDispatch } from 'react-redux';\nimport useStockpileState from 'hooks/store/useStockpileState';\nimport Button from 'components/ui/buttons/Button';\nimport UpDownValue from 'components/ui/common/UpDownValue';\nimport ItemsBox from 'components/ui/items/ItemsBox';\nimport ResourcesCost from 'components/structures/production/ResourcesCost';\nimport { Item } from 'definitions/items/types';\nimport { TextManager } from 'global/TextManager';\nimport { useResourcesState } from 'hooks/store/resources';\nimport { useWorkersFreeState } from 'hooks/store/useWorkersState';\nimport { calculateProductionTime, MAX_WORKERS_CRAFTING } from 'mechanics/crafting';\nimport { formatDuration } from 'utils/format/time';\nimport { getDefinition as getProductionDefinition } from \"definitions/production\";\nimport { ProductionDefinition } from 'definitions/production/types';\nimport { addItemToWarehouse } from 'store/actions/items';\nimport { removeResources } from 'store/actions/resources';\nimport { increaseWorkers } from 'store/actions/structures';\nimport { startTask } from 'store/actions/tasks';\nimport { TaskType } from 'store/types/task';\nimport { Structure } from 'definitions/structures';\n\nexport interface Props {\n    item: Item;\n    structure: Structure;\n}\n\nconst CraftingDetails = (props: Props) => {\n    const { item, structure } = props;\n    const dispatch = useDispatch();\n    const resourcesState = useResourcesState();\n    const stockpileState = useStockpileState();\n    const workersFree = useWorkersFreeState();\n    const [workersAssigned, setWorkersAssigned] = useState<number>(0);\n\n    const produces = getProductionDefinition(item)!;\n    const costResources = produces.cost.resources!;\n    const missingAtLeastOneResource = Object.keys(costResources)\n        .some((resource) => costResources[resource] > resourcesState[resource]);\n\n    let missingAtLeastOneItem = false;\n    const costMaterials = produces.cost.materials;\n    if (costMaterials) {\n        missingAtLeastOneItem = costMaterials.some((i: Item) => stockpileState.indexOf(i) === -1);\n    }\n\n    const disabled = missingAtLeastOneResource || missingAtLeastOneItem || workersAssigned < 1;\n    // TODO: [10/07/2019] Perhaps each item can have a number of minimum workers?\n\n    const makeTimeString = (asNumber: number): string => {\n        if (workersAssigned === 0) {\n            return \"\";\n        }\n        const craftingTime = calculateProductionTime(asNumber, workersAssigned);\n        const time = formatDuration(craftingTime);\n        return TextManager.get(\"ui-structure-production-crafting-time\", { time });\n    };\n\n    const handleClick = (e: React.MouseEvent) => {\n        e.stopPropagation();\n\n        handleCraft(produces, workersAssigned);\n        setWorkersAssigned(0);\n    };\n\n    const handleUp = (e: React.MouseEvent) => {\n        e.stopPropagation();\n        setWorkersAssigned(workersAssigned + 1);\n    };\n\n    const handleDown = (e: React.MouseEvent) => {\n        e.stopPropagation();\n        setWorkersAssigned(workersAssigned - 1);\n    };\n\n    const handleCraft = (productionDefinition: ProductionDefinition, workers: number) => {\n        const craftingTime = calculateProductionTime(productionDefinition.cost.time || 0, workers);\n        dispatch(removeResources(productionDefinition.cost.resources || {}));\n        dispatch(increaseWorkers(structure, workers));\n\n        const callbacks = [\n            addItemToWarehouse(productionDefinition.item),\n            increaseWorkers(structure, workers),\n        ];\n        const start = startTask(TaskType.craftItem,\n            productionDefinition.item,\n            `${structure}.craft`,\n            craftingTime,\n            callbacks);\n        dispatch(start);\n    }\n\n    return (\n        <div className=\"crafting-details\">\n            { TextManager.get(\"ui-structure-production-craft-a\", {item}) }\n            <div className=\"crafting-costs\">\n                <fieldset>\n                    <ResourcesCost resources={costResources} />\n                </fieldset>\n                <fieldset>\n                    {costMaterials && <ItemsBox items={costMaterials} />}\n                </fieldset>\n            </div>\n            <div className=\"buttonrow\">\n                <div>\n                    <UpDownValue\n                        value={workersAssigned}\n                        label={TextManager.get(\"ui-structure-production-workers\")}\n                        onUp={handleUp}\n                        onDown={handleDown}\n                        upDisabled={\n                            workersAssigned >= workersFree ||\n                            workersAssigned >= MAX_WORKERS_CRAFTING\n                        }\n                        downDisabled={workersAssigned < 1}\n                    />\n                    { makeTimeString(produces.cost.time || 0)}\n                </div>\n                <div>\n                    <Button\n                        disabled={disabled}\n                        className=\"craft\"\n                        onClick={handleClick}\n                    >\n                        {TextManager.get(\"ui-structure-production-craft\")}\n                    </Button>\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default CraftingDetails;","import React, { useState } from \"react\";\nimport { IconSize } from 'components/ui/common/Icon';\nimport ItemIcon from 'components/ui/items/ItemIcon';\nimport { Item } from 'definitions/items/types';\nimport { Structure } from 'definitions/structures';\nimport { ProductionStructureStoreState } from 'store/types/structure';\nimport useStructureState from 'hooks/store/useStructureState';\nimport { TextManager } from 'global/TextManager';\nimport CraftingDetails from './CraftingDetails';\n\nexport interface Props {\n    structure: Structure;\n}\n\nconst CraftingArea = (props: Props) => {\n    const {structure} = props;\n    const [selectedItem, setSelectedItem] = useState<Item>();\n\n    const storeState: ProductionStructureStoreState = useStructureState(structure) as ProductionStructureStoreState;\n    const handleSelectCraftingItem = (item: Item) => {\n        setSelectedItem(item);\n    };\n\n    return (\n        <>\n            <div>craft:</div>\n            <div className=\"crafting-area\">\n                <ul className=\"vertical-tab-bar\">\n                    {storeState.produces.map((item) => (\n                        <li\n                            key={`craft${item}`}\n                            onClick={() => handleSelectCraftingItem(item)}\n                            className={selectedItem === item ? \"selected\" : \"\"}\n                        >\n                            <ItemIcon item={item} size={IconSize.smallest} />\n                            { TextManager.getItemName(item) }\n                        </li>\n                    ))}\n                </ul>\n                { selectedItem && <CraftingDetails item={selectedItem} structure={structure} /> }\n            </div>\n        </>\n    )\n};\n\nexport default CraftingArea;","import * as React from \"react\";\nimport { Item } from \"definitions/items/types\";\nimport { getDefinition, Structure } from \"definitions/structures\";\nimport { ProductionStructureDefinition } from \"definitions/structures/types\";\nimport { TextManager } from \"global/TextManager\";\nimport { formatDuration } from \"utils/format/time\";\nimport Progressbar from \"components/ui/common/Progressbar\";\nimport useStructureState from 'hooks/store/useStructureState';\nimport { useCraftingTasksStateByStructure, useStudyingTasksStateByStructure } from 'hooks/store/useTasksState';\nimport StructureViewHeader from '../StructureViewHeader';\nimport StructureLevel from '../StructureLevel';\nimport UpgradeHelpModal from './UpgradeHelpModal';\nimport { TooltipManager } from 'global/TooltipManager';\nimport { ContextType } from 'constants/context';\nimport CraftingArea from './CraftingArea';\nimport \"./styles/productionStructureView.scss\";\nimport { addItemToToProduces } from 'store/actions/structures';\n\nexport interface Props {\n    structure: Structure;\n}\n\nconst ProductionStructureView = (props: Props) => {\n    const {structure} = props;\n    const level = useStructureState(structure).level;\n\n    const craftingTasks = useCraftingTasksStateByStructure(structure);\n    const studyingTasks = useStudyingTasksStateByStructure(structure);\n\n    const structureDefinition = getDefinition<ProductionStructureDefinition>(props.structure);\n    if (!structureDefinition) {\n        throw new Error(`No definition found for structure ${props.structure}\n            with type ProductionStructureDefinition.`);\n    }\n    const displayName = TextManager.getStructureName(props.structure);\n\n    const handleHelpClicked = (event: React.MouseEvent) => {\n        const origin = (event.currentTarget as HTMLElement);\n        const originRect = origin.getBoundingClientRect();\n        const content = <UpgradeHelpModal level={level} structure={structure} />;\n        TooltipManager.showContextTooltip(ContextType.component, content, originRect, \"upgrade-structure-tooltip\");\n\n        event.stopPropagation();\n    }\n\n    const handleUpgradeCallbacks = (nextLevel: number) => {\n        const nextLevelDefinition = structureDefinition.levels[nextLevel];\n        return nextLevelDefinition.unlocks.map(item => addItemToToProduces(structure, item));\n    }\n\n    return (\n        // TODO: abstract some stuff to generic StructureView\n        <>\n            <StructureViewHeader structure={props.structure} />\n            <div className = \"production-structure-view\">\n                <section>\n                    <StructureLevel\n                        structure={structure}\n                        onHelpClicked={handleHelpClicked}\n                        addUpgradeCallbacks={handleUpgradeCallbacks}\n                    />\n                    <CraftingArea structure={structure} />\n                    <fieldset>\n                        <legend>{TextManager.get(\"ui-structure-production-crafting\")}</legend>\n                        {craftingTasks.map((t) => (\n                            <Progressbar\n                                key={`${t.name}${t.startTime}`}\n                                label={`${TextManager.getItemName(Item[t.name])} (${formatDuration(t.timeRemaining)})`}\n                                progress={t.progress}\n                            />\n                        ))}\n                    </fieldset>\n                    {studyingTasks.length > 0 && (\n                    <fieldset>\n                        <legend>{TextManager.get(\"ui-structure-production-studying\")}</legend>\n                        {studyingTasks.map((t) => (\n                            <Progressbar\n                                key={`${t.name}${t.startTime}`}\n                                label={`${TextManager.getItemName(Item[t.name])} (${formatDuration(t.timeRemaining)})`}\n                                progress={t.progress}\n                            />\n                        ))}\n                    </fieldset>\n                    )}\n                </section>\n            </div>\n        </>\n    );\n}\n\nexport default ProductionStructureView;\n","import * as React from \"react\";\r\nimport { Resource } from \"definitions/resources\";\r\nimport resourceDescriptions from \"definitions/resources\";\r\nimport { ResourceStoreState } from \"store/types/resources\";\r\nimport { TextManager } from \"global/TextManager\";\r\nimport { StructuresStoreState } from 'store/types/structures';\r\nimport { getStructureByResource } from 'definitions/structures';\r\nimport { Link } from 'react-router-dom';\r\nimport { getStructureLink } from 'utils/routing';\r\nimport { withAppContext, AppContextProps } from 'hoc/withAppContext';\r\nimport { useSelector } from 'react-redux';\r\nimport { StoreState } from 'store/types';\r\nimport { StructureState } from 'store/types/structure';\r\nimport { formatNumber } from 'utils/format/number';\r\nimport Icon from '../../ui/common/Icon';\r\nimport \"./styles/resourcesBox.scss\";\r\n\r\nexport interface Props {\r\n    className?: string;\r\n    resources: ResourceStoreState;\r\n    structures: StructuresStoreState;\r\n    maxResources: ResourceStoreState;\r\n    deltaResources: ResourceStoreState;\r\n}\r\n\r\n/**\r\n * The ResourcesBox is used in the Warehouse to show a list of resources\r\n */\r\nconst ResourcesBox = (props: Props & AppContextProps) => {\r\n    const {\r\n        resources,\r\n        deltaResources,\r\n    } = props;\r\n    const structures = useSelector<StoreState, StructuresStoreState>(store => store.structures);\r\n    const className = `resources-box ${(props.className || \"\")}`;\r\n\r\n    return (\r\n        <div className={className}>\r\n            {\r\n                Object.keys(resources).map((resource: string) => {\r\n                    const resourceDescription=resourceDescriptions[resource];\r\n                    const amount = props.resources[resource]!;\r\n                    if (!resourceDescription) {\r\n                        throw new Error(`No resource description found for ${resource}`);\r\n                    }\r\n\r\n                    let delta;\r\n                    if (deltaResources[resource]) {\r\n                        delta = <span className=\"animate-up\">\r\n                            { `+ ${deltaResources[resource]!.toFixed(2)}`  }\r\n                        </span>;\r\n                    }\r\n\r\n                    const structure = getStructureByResource(Resource[resource]);\r\n\r\n                    const handleStructureClick=() => {\r\n                        props.onCloseWindow();\r\n                    }\r\n                    const full = amount >= props.maxResources[resource];\r\n                    return (\r\n                        <>\r\n                            <Icon image={resourceDescription.iconImg} size=\"smallest\"/>\r\n                            <div className=\"name\">\r\n                                { TextManager.getResourceName(resource as Resource) }\r\n                            </div>\r\n                            <div className={`amount${full ? \" full\" : \"\"}`}  >\r\n                                { formatNumber(amount, 0) }\r\n                            </div>\r\n                            <div className=\"max\" >\r\n                                { ` / ${props.maxResources[resource]}` }\r\n                            </div>\r\n                            <div className=\"delta\">\r\n                                { delta }\r\n                            </div>\r\n                            <div className=\"structure\">\r\n                                { structures[structure].state === StructureState.Built ? (\r\n                                    <Link to={getStructureLink(structure)} onClick={handleStructureClick}>\r\n                                        { TextManager.get(\"ui-structure-warehouse-resources-source\", {structure}) }\r\n                                    </Link>\r\n                                ) : (\r\n                                    TextManager.get(\"ui-structure-warehouse-resources-source\", {structure})\r\n                                )}\r\n                            </div>\r\n                        </>\r\n                    )\r\n                })\r\n            }\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default withAppContext(ResourcesBox);\r\n\r\n\r\n","import { useEffect, useRef } from \"react\";\r\n\r\nconst usePrevious = <T extends {}>(value: T) => {\r\n    const ref = useRef<T>();\r\n    useEffect(() => {\r\n      ref.current = value;\r\n    });\r\n    return ref.current;\r\n};\r\nexport default usePrevious;\r\n","import { Resource } from \"definitions/resources\";\n\n// The keys should be the same as the enum Resource\nexport interface ResourceStoreState {\n    [Resource.wood]?: number;\n    [Resource.iron]?: number;\n    [Resource.stone]?: number;\n    [Resource.leather]?: number;\n    [Resource.fabric]?: number;\n    [Resource.food]?: number;\n}\n\nexport const initialState: ResourceStoreState = {\n    fabric: 0,\n    food: 0,\n    iron: 10,\n    leather: 0,\n    stone: 0,\n    wood: 10,\n};\n\nexport const empty: ResourceStoreState = {\n    fabric: 0,\n    food: 0,\n    iron: 0,\n    leather: 0,\n    stone: 0,\n    wood: 0,\n};\n","import * as React from \"react\";\nimport { getDefinition, Structure } from 'definitions/structures';\nimport { formatDuration } from 'utils/format/time';\nimport resourceDescriptions from \"definitions/resources\";\nimport { WarehouseStructureDefinition } from 'definitions/structures/types';\nimport { Resource } from 'definitions/resources';\nimport Icon from 'components/ui/common/Icon';\nimport { TextManager } from 'global/TextManager';\nimport \"./styles/upgradeHelpModal.scss\"\n\nexport interface Props  {\n    level: number;\n}\n\nconst UpgradeHelpModal = (props: Props) => {\n    const { level } = props;\n    const structureDefinition: WarehouseStructureDefinition = getDefinition(Structure.warehouse);\n\n    const currentLevel = structureDefinition.levels[level];\n    const nextLevel = structureDefinition.levels[level + 1];\n\n    const renderRow = (resource: Resource) => {\n        const resourceDescription = resourceDescriptions[resource];\n\n        return (\n            <React.Fragment key={resource}>\n                <div><Icon image={resourceDescription.iconImg} size=\"smallest\"/></div>\n                <div>{TextManager.getResourceName(resource)}</div>\n                <div className=\"number\">{currentLevel.maxResources[resource]}</div>\n                <div className=\"arrow\">⟶</div>\n                <div className=\"number\">{nextLevel.maxResources[resource]}</div>\n            </React.Fragment>\n        )\n    }\n\n    return (\n        <div className=\"warehouse-upgrade-help-modal\">\n            <div className=\"top\">\n                <h3>{TextManager.get(\"ui-structure-help-upgrade-title\", { structure: Structure.warehouse} )}</h3>\n                <div className=\"cost\">\n                    <section>\n                        {TextManager.get(\"ui-structure-help-upgrade-cost-gold\", { gold: nextLevel.cost.gold})}\n                    </section>\n                    { nextLevel.cost.time && <section>{formatDuration(nextLevel.cost.time)}</section> }\n                </div>\n            </div>\n            <div className=\"storage-increase\">\n                <div className=\"header\"/>\n                <div className=\"header\">\n                    {TextManager.get(\"ui-structure-warehouse-help-upgrade-header-capacity\")}\n                </div>\n                <div className=\"header number\">\n                    {TextManager.get(\"ui-structure-help-upgrade-header-level\", {\n                        level: level + 1\n                    })}\n                </div>\n                <div className=\"header\"/>\n                <div className=\"header number\">\n                {TextManager.get(\"ui-structure-help-upgrade-header-level\", {\n                        level: level + 2\n                    })}\n                </div>\n                {Object.keys(nextLevel.maxResources).map(res => renderRow(Resource[res]))}\n            </div>\n        </div>\n    )\n}\n\nexport default UpgradeHelpModal;","import * as React from \"react\";\r\nimport Inventory from \"components/ui/inventory/Inventory\";\r\nimport ResourcesBox from \"components/structures/warehouse/ResourcesBox\";\r\nimport { DragSourceType } from \"constants/dragging\";\r\nimport { Item } from \"definitions/items/types\";\r\nimport { getDefinition, Structure } from \"definitions/structures\";\r\nimport { StructureDefinition, WarehouseStructureDefinition, WarehouseStructureLevelDefinition } from \"definitions/structures/types\";\r\nimport usePrevious from \"hooks/usePrevious\";\r\nimport { useEffect, useRef, useState } from \"react\";\r\nimport { empty, ResourceStoreState } from \"store/types/resources\";\r\nimport { StructuresStoreState } from \"store/types/structures\";\r\nimport { TextManager } from \"global/TextManager\";\r\nimport { TooltipManager } from 'global/TooltipManager';\r\nimport AdventurerTabstrip from 'components/world/QuestPanel/AdventurerTabstrip';\r\nimport useStructureState from 'hooks/store/useStructureState';\r\nimport { useResourcesState } from 'hooks/store/resources';\r\nimport useStockpileState from 'hooks/store/useStockpileState';\r\nimport { useSelector } from 'react-redux';\r\nimport { StoreState } from 'store/types';\r\nimport { useAdventurersInTown } from 'hooks/store/adventurers';\r\nimport useItemDropActions from 'hooks/actions/useItemActions';\r\nimport StructureLevel from '../StructureLevel';\r\nimport AdventurerPanel from 'components/ui/adventurer/AdventurerPanel';\r\nimport UpgradeHelpModal from './UpgradeHelpModal';\r\nimport { ContextType } from 'constants/context';\r\nimport \"./styles/warehouseStructureView.scss\";\r\nimport { addStockpileSlots } from 'store/actions/items';\r\n\r\n// tslint:disable-next-line: no-empty-interface\r\nexport interface Props  {\r\n}\r\n\r\nconst WAREHOUSE = DragSourceType.warehouse;\r\n\r\nconst WarehouseStructureView = () => {\r\n\r\n    const adventurersInTown = useAdventurersInTown();\r\n    const [selectedAdventurer, setSelectedAdventurer] = useState<string>(adventurersInTown[0]?.id);\r\n    const resources = useResourcesState();\r\n    const [resourcesDelta, setResourcesDelta] = useState<ResourceStoreState>(empty);    // updating this will trigger animation\r\n    const previousResources = usePrevious(resources);\r\n    const resourcesRef = useRef<HTMLFieldSetElement>(null);\r\n    const stockpileState = useStockpileState();\r\n    const structuresState = useSelector<StoreState, StructuresStoreState>(store => store.structures);\r\n    const {dropItemWarehouse} = useItemDropActions();\r\n\r\n    useEffect(() => {\r\n        // Calculate delta\r\n        const delta = Object.keys(resources).reduce((acc, value) => {\r\n            if (previousResources && previousResources[value]) {\r\n                acc[value] = resources[value] - previousResources[value];\r\n            }\r\n            return acc;\r\n        }, {});\r\n\r\n        setResourcesDelta(delta);\r\n    }, [resources, previousResources]);\r\n\r\n    useEffect(() => {\r\n        if (!resourcesRef.current) {\r\n            return;\r\n        }\r\n        const ref = resourcesRef.current as unknown as HTMLFieldSetElement;\r\n        ref.classList.remove(\"animate\");\r\n        setTimeout(() => {\r\n            if (resourcesRef) {\r\n                ref.classList.add(\"animate\");\r\n            }\r\n        }, 200);\r\n    }, [resourcesDelta]);\r\n\r\n    const structureDefinition = getDefinition<WarehouseStructureDefinition>(Structure.warehouse);\r\n    if (!structureDefinition) {\r\n        throw new Error(`No definition found for structure ${Structure.warehouse} with type StructureDefinition.`);\r\n    }\r\n\r\n    const structureState = useStructureState(Structure.warehouse);\r\n    const levelDefinition: WarehouseStructureLevelDefinition = structureDefinition.levels[structureState.level] as WarehouseStructureLevelDefinition;\r\n\r\n    const handleDropItemWarehouse = (item: Item, fromSlot: number, toSlot: number, sourceType: DragSourceType, sourceId?: string): void => {\r\n        dropItemWarehouse(item, fromSlot, toSlot, sourceType, sourceId);\r\n    }\r\n\r\n    const handleAdventurerTabSelected = (tabId: string) => {\r\n        setSelectedAdventurer(tabId);\r\n    };\r\n\r\n    const handleHelpClicked = (event: React.MouseEvent) => {\r\n        const origin = (event.currentTarget as HTMLElement);\r\n        const originRect = origin.getBoundingClientRect();\r\n        const content = <UpgradeHelpModal level={structureState.level} />;\r\n        TooltipManager.showContextTooltip(ContextType.component, content, originRect, \"upgrade-structure-tooltip\");\r\n\r\n        event.stopPropagation();\r\n    }\r\n\r\n    const handleUpgradeCallbacks = (nextLevel: number) => {\r\n        const currentLevelDefinition = structureDefinition.levels[structureState.level];\r\n        const nextLevelDefinition = structureDefinition.levels[nextLevel];\r\n        const slots = nextLevelDefinition.maxStockpile - currentLevelDefinition.maxStockpile;\r\n        return [\r\n            addStockpileSlots(slots)\r\n        ]\r\n    }\r\n\r\n    return (\r\n        <div className=\"warehouse-structureview\">\r\n            <StructureLevel structure={Structure.warehouse} onHelpClicked={handleHelpClicked} addUpgradeCallbacks={handleUpgradeCallbacks}/>\r\n            <fieldset className=\"resources\" ref={resourcesRef}>\r\n                <legend>{TextManager.get(\"ui-structure-warehouse-resources\")}</legend>\r\n                <ResourcesBox\r\n                    resources={resources}\r\n                    structures={structuresState}\r\n                    maxResources={levelDefinition.maxResources}\r\n                    deltaResources={resourcesDelta}\r\n                />\r\n            </fieldset>\r\n            <h3>{TextManager.get(\"ui-structure-warehouse-stockpile\")}</h3>\r\n            <Inventory\r\n                sourceType={WAREHOUSE}\r\n                className=\"inventory-large\"\r\n                items={stockpileState}\r\n                onDropItem={handleDropItemWarehouse}\r\n            />\r\n            <h3>{TextManager.get(\"ui-structure-warehouse-adventurers\")}</h3>\r\n            <div>\r\n                <AdventurerTabstrip\r\n                    adventurers={adventurersInTown}\r\n                    selectedAdventurerId={selectedAdventurer}\r\n                    onAdventurerTabSelected={handleAdventurerTabSelected}\r\n                />\r\n                <div className=\"adventurer-inventory\">\r\n                    { selectedAdventurer && (\r\n                        <AdventurerPanel\r\n                            adventurerId={selectedAdventurer}\r\n                            horizontalMode={true}\r\n                            traits={false}\r\n                            skills={false}\r\n                        />\r\n                    )}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n\r\n};\r\n\r\nexport default WarehouseStructureView;\r\n","import { DragType } from \"constants/dragging\";\r\nimport * as React from \"react\";\r\nimport { ConnectDropTarget, DropTarget, DropTargetConnector, DropTargetMonitor, DropTargetSpec } from \"react-dnd\";\r\nimport \"./styles/droppableadventurerslot.scss\";\r\n\r\nconst dropTarget: DropTargetSpec<Props> = {\r\n    drop(props: Props, monitor: DropTargetMonitor) {\r\n        props.onDrop(monitor.getItem());\r\n    },\r\n    canDrop(props: Props, monitor: DropTargetMonitor)  {\r\n        return true; // todo: can't drop on yourself\r\n    },\r\n};\r\n\r\nexport interface Props {\r\n    onDrop: (item: any) => void;\r\n}\r\n\r\nexport interface DropSourceProps {\r\n    canDrop: boolean;\r\n    isOver: boolean;\r\n    connectDropTarget: ConnectDropTarget;\r\n}\r\n\r\nconst collect = (connect: DropTargetConnector, monitor: DropTargetMonitor) => ({\r\n    canDrop: monitor.canDrop(),\r\n    connectDropTarget: connect.dropTarget(),\r\n    isOver: monitor.isOver(),\r\n});\r\n\r\n/*\r\n * Can drop adventurers on this */\r\nconst DroppableAdventurerSlot = (props: Props & DropSourceProps) => {\r\n    const {\r\n        isOver,\r\n        canDrop,\r\n        connectDropTarget,\r\n    } = props;\r\n    // const isActive = isOver && canDrop;\r\n    let className = \"droppable-adventurer-slot\";\r\n\r\n    if (isOver) {\r\n        className += \" active-drop\";\r\n    } else if (canDrop) {\r\n        className += \" can-drop\";\r\n    }\r\n\r\n    return connectDropTarget(\r\n        <div className = { className }/>\r\n    );\r\n}\r\n\r\nexport default DropTarget<Props, DropSourceProps>(\r\n    DragType.ADVENTURER,\r\n    dropTarget,\r\n    collect,\r\n)(DroppableAdventurerSlot);\r\n","import * as React from \"react\";\nimport { AdventurerStoreState } from \"store/types/adventurer\";\nimport AdventurerAvatar from \"components/ui/adventurer/AdventurerAvatar\";\nimport { AdventurerAvatarDragInfo } from 'components/ui/adventurer/DraggableAdventurerAvatar';\nimport DroppableAdventurerSlot from 'components/ui/adventurer/DroppableAdventurerSlot';\nimport { IconSize } from 'components/ui/common/Icon';\nimport \"./styles/assignadventurers.scss\";\n\nexport interface DispatchProps {\n    onAdventurerDropped: (item: AdventurerAvatarDragInfo, index: number) => void;\n    onAdventurerClicked: (adventurer: AdventurerStoreState) => void;\n}\n\nexport interface Props {\n    availableSlots: number;\n    assignedAventurers: AdventurerStoreState[];\n}\n\n/*\n * Displays a number of slots to drag adventurers to */\nconst AssignAdventurers = (props: Props & DispatchProps) => {\n    const slotsContent = () => {\n        const slots: JSX.Element[] = [];\n        for (let i = 0; i < props.availableSlots; i++) {\n            let content;\n            let className = \"\";\n            const hasAdventurer = !!props.assignedAventurers[i];\n\n            if (hasAdventurer) {\n                const adventurer = props.assignedAventurers[i];\n                content = (\n                    <AdventurerAvatar\n                        adventurer={adventurer}\n                        displayName={false}\n                        size={IconSize.small}\n                        onClick={() => props.onAdventurerClicked(adventurer) }\n                    />\n                );\n                className = \"has-adventurer\";\n            } else {\n                content = (\n                    <DroppableAdventurerSlot\n                        onDrop={(item: AdventurerAvatarDragInfo) => { props.onAdventurerDropped(item, i); }}\n                    />\n                );\n            }\n            slots.push(\n                <li\n                    key={`slot${i}`}\n                    className={className}\n                >\n                    {content}\n                </li>\n            );\n        }\n        return slots;\n    };\n\n    return (\n        <ul\n            className=\"assign-adventurers\"\n        >\n            { slotsContent() }\n        </ul>\n    );\n};\n\nexport default AssignAdventurers;\n","import { Item } from \"definitions/items/types\";\nimport { getDefinition } from \"definitions/quests\";\nimport * as React from \"react\";\nimport { AdventurerStoreState } from \"store/types/adventurer\";\nimport { QuestStoreState } from \"store/types/quest\";\nimport { TextManager } from \"global/TextManager\";\nimport AssignAdventurers from \"./AssignAdventurers\";\nimport { QuestDefinition } from 'definitions/quests/types';\nimport { useSelector } from 'react-redux';\nimport { StoreState } from 'store/types';\nimport Button from 'components/ui/buttons/Button';\nimport ItemsBox from 'components/ui/items/ItemsBox';\nimport { AdventurerAvatarDragInfo } from 'components/ui/adventurer/DraggableAdventurerAvatar';\nimport \"./styles/questboard.scss\";\n\nexport const AVAILABLE_SLOTS = 5;\nconst minimumCountAdventurers = 3;  // we need this many adventurers to start the quest\n\n\n// tslint:disable-next-line: no-empty-interface\n\nexport interface Props {\n    availableQuests: QuestStoreState[];\n    selectedQuestName?: string;       // name of selected quest\n    assignedAventurers: AdventurerStoreState[];\n\n    onQuestClick: (questName: string) => void;\n    onAdventurerDropped: (item: AdventurerAvatarDragInfo, index: number) => void;\n    onRemoveAdventurer: (adventurer: AdventurerStoreState) => void;\n    onLaunchQuest: () => void;\n}\n\nconst QuestBoard = (props: Props) => {\n\n    const items = useSelector<StoreState, (null|Item)[]>(state => state.stockpile);\n\n    const getQuestDetails = () => {\n        if (!props.selectedQuestName) {\n            return null;\n        }\n        const quest = props.availableQuests.find((q) => q.name === props.selectedQuestName);\n        if (!quest) {\n            return (\n                <div> { TextManager.get(\"ui-structure-tavern-quest-launched\") } </div>\n            );\n        }\n        const questDefinition = getDefinition(quest.name);\n\n        // Need a full party to launch\n        const fullParty = props.assignedAventurers.filter((a) => a !== null).length >= minimumCountAdventurers;\n        // Check if we have the required items\n        const enoughItems = checkEnoughItems(questDefinition);\n\n        const canLaunch = fullParty && enoughItems;\n\n        return (\n            <div className=\"quest-details\">\n                {TextManager.getQuestDescription(props.selectedQuestName)}\n                <AssignAdventurers\n                    availableSlots={AVAILABLE_SLOTS}\n                    assignedAventurers={props.assignedAventurers}\n                    onAdventurerClicked={props.onRemoveAdventurer}\n                    onAdventurerDropped={props.onAdventurerDropped}\n                />\n                <ItemsBox items={ questDefinition.requiredItems || [] }/>\n                <Button disabled={!canLaunch} onClick = { () => props.onLaunchQuest() }>\n                    {TextManager.get(\"ui-structure-tavern-button-launch-quest\")}\n                </Button>\n            </div>\n        );\n    };\n\n    /**\n     * Returns true if all the items required by the quest are in the inventory\n     */\n    const checkEnoughItems = (questDefinition: QuestDefinition): boolean => {\n        if (!questDefinition.requiredItems) {\n            return true;\n        }\n        return questDefinition.requiredItems.every((item: Item) => {\n            const amountRequired = (questDefinition.requiredItems)!.filter((i) => i === item).length;\n            return items.filter((i) => i === item).length >= amountRequired;\n        });\n    }\n\n    // quest board, expanded quest info + assign adventurers + launch button\n    return (\n        <div className=\"quest-board\">\n            <h2>\n                {TextManager.get(\"ui-structure-tavern-title-quest-board\")}\n            </h2>\n            <ul className=\"quest-list\">\n                {props.availableQuests.map((q) => {\n                    const className = `quest ${(q.name === props.selectedQuestName) ? \" selected\" : \"\"}`;\n                    return (\n                        <li key={q.name}\n                            className={className}\n                            onClick={() => {props.onQuestClick(q.name);} }\n                        >\n                            <div\n                                className=\"icon\"\n                                style={{backgroundImage: `url(${process.env.PUBLIC_URL})`}}\n                            />\n                            <div className=\"title\">{ TextManager.getQuestTitle(q.name) } </div>\n                        </li>\n                    );\n                })}\n            </ul>\n            { getQuestDetails() }\n        </div>\n    );\n}\n\nexport default QuestBoard;\n","import * as React from \"react\";\nimport { AdventurerStoreState } from 'store/types/adventurer';\nimport { AVAILABLE_SLOTS } from '../QuestBoard';\nimport Button from 'components/ui/buttons/Button';\nimport { TextManager } from 'global/TextManager';\nimport \"./styles/adventurerButton.scss\";\n\nexport interface Props {\n    adventurer: AdventurerStoreState;\n    assignedAventurers: AdventurerStoreState[];  // assigned to a quest in the QuestBoard\n    questName: string;\n\n    onAddAdventurer: (adventurer: AdventurerStoreState, index: number) => void;\n    onRemoveAdventurer: (adventurer: AdventurerStoreState) => void;\n}\n\n// Toggles adventurer participation in a quest\nconst AdventurerButton = (props: Props) => {\n    const {\n        adventurer,\n        assignedAventurers,\n        questName,\n        onAddAdventurer,\n        onRemoveAdventurer\n    } = props;\n\n    const isAssigned = assignedAventurers.indexOf(adventurer) > -1;\n    const quest = TextManager.getQuestTitle(questName);\n\n    const handleAddClick = () => {\n        const emptySlot = getEmptySlot(assignedAventurers);\n        onAddAdventurer(adventurer, emptySlot);\n    };\n\n    const handleRemoveClick = () => {\n        onRemoveAdventurer(adventurer);\n    }\n\n    if (isAssigned) {\n        return (\n            <Button onClick={handleRemoveClick} className=\"adventurer-button\">\n               {TextManager.get(\"ui-structure-tavern-button-leave-quest\")}\n            </Button>\n        );\n    }\n    // Skip holes\n    if (assignedAventurers.filter(Boolean).length === AVAILABLE_SLOTS) {\n        return (\n            <Button disabled={true} className=\"adventurer-button\">\n                {TextManager.get(\"ui-structure-tavern-button-join-quest-full-party\")}\n            </Button>\n        )\n    }\n    return (\n        <Button onClick={handleAddClick}  className=\"adventurer-button\">\n            {TextManager.get(\"ui-structure-tavern-button-join-quest\", { quest })}\n        </Button>\n    )\n}\n\nexport default AdventurerButton;\n\n// Finds the first array index with a falsey value\nconst getEmptySlot = (assignedAventurers: AdventurerStoreState[]) => {\n    for (let i = 0; i < AVAILABLE_SLOTS; i++) {\n        if (!assignedAventurers[i]) {\n            return i;\n        }\n    }\n    return 0;\n}","import { DragSourceType, DragType } from \"constants/dragging\";\r\nimport * as React from \"react\";\r\nimport { ConnectDragSource, DragSource, DragSourceConnector, DragSourceMonitor, DragSourceSpec } from \"react-dnd\";\r\nimport { AdventurerStoreState } from \"store/types/adventurer\";\r\nimport AdventurerAvatar, { Props as AdventurerAvatarProps } from '../AdventurerAvatar';\r\nimport \"./styles/draggableadventureravatar.scss\";\r\n\r\nexport interface Props {\r\n    sourceId?: string;\r\n    onClick?: () => void;\r\n    disabled?: boolean;\r\n}\r\n\r\ninterface CollectedProps {\r\n    isDragging: boolean;\r\n    connectDragSource: ConnectDragSource;\r\n}\r\n\r\nexport interface AdventurerAvatarDragInfo {\r\n    adventurer: AdventurerStoreState;\r\n    sourceId?: string;\r\n}\r\n\r\n/**\r\n * Specifies the drag source contract.\r\n * Only `beginDrag` function is required.\r\n */\r\nconst spec: DragSourceSpec<Props & AdventurerAvatarProps, AdventurerAvatarDragInfo> = {\r\n    beginDrag(props: Props & AdventurerAvatarProps) {\r\n        // Return the data describing the dragged item\r\n        return {\r\n            adventurer: props.adventurer,\r\n            sourceId: props.sourceId,\r\n            sourceType: DragSourceType.adventurerInventory,\r\n        };\r\n    },\r\n};\r\n\r\n/**\r\n * Specifies which props to inject into your component.\r\n */\r\nfunction collect(connect: DragSourceConnector, monitor: DragSourceMonitor) {\r\n    return {\r\n        connectDragSource: connect.dragSource(),\r\n        isDragging: monitor.isDragging(),\r\n    };\r\n}\r\n\r\nconst DraggableAdventurerAvatar = (props: Props & CollectedProps & AdventurerAvatarProps) => {\r\n\r\n    const { isDragging, connectDragSource, disabled } = props;\r\n    let className = \"draggable-adventurer-avatar\";\r\n    if (disabled) {\r\n        className += \" disabled\";\r\n    }\r\n    if (isDragging) {\r\n        className += \" dragging\";\r\n    }\r\n\r\n    /*if (isDragging) {\r\n        // TODO: can show some sort of empty state?\r\n        return null;\r\n    }*/\r\n    return connectDragSource(\r\n        <div className = { className }>\r\n            <AdventurerAvatar\r\n                // Copy all props down to AdventurerAvatar\r\n                { ...props }\r\n            />\r\n        </div>,\r\n    );\r\n}\r\n\r\nexport default DragSource<Props & AdventurerAvatarProps, CollectedProps>(DragType.ADVENTURER, spec, collect)(DraggableAdventurerAvatar);\r\n","import * as React from \"react\";\nimport {AppContextProps} from \"hoc/withAppContext\";\nimport {useRef, useState, createContext, useEffect } from \"react\";\nimport {DndProvider } from \"react-dnd\";\nimport {HTML5Backend } from 'react-dnd-html5-backend';\nimport {Link, Redirect, Route, Switch, HashRouter} from \"react-router-dom\";\nimport {Persistor} from \"redux-persist\";\nimport {PixiPlugin } from 'gsap/all';\nimport {gsap } from 'gsap';\nimport {Sound, SoundManager} from \"global/SoundManager\";\nimport {TextManager} from \"global/TextManager\";\nimport {Structure} from \"definitions/structures\";\nimport debounce from \"debounce\";\nimport Preloader, {MediaItem, MediaType} from \"../preloading/Preloader\";\nimport TownView from 'components/town/TownView';\nimport Toasts from 'components/ui/toasts/Toasts';\nimport Topbar from 'components/ui/topbar/Topbar';\nimport WorldView from 'components/world/WorldView';\nimport SimpleLog from 'components/log/SimpleLog';\nimport ContextTooltip from 'components/ui/tooltip/ContextTooltip';\nimport {TooltipManager } from 'global/TooltipManager';\nimport {getWorldLink, getTownLink } from 'utils/routing';\nimport Background from 'components/Background';\nimport {manifest} from \"./manifest/app\";\nimport { restartGame } from 'index';\nimport Button, { ButtonColor } from 'components/ui/buttons/Button';\nimport StructureDetailsView from 'components/town/StructureDetailsView';\nimport \"./styles/app.scss\";\n\nPixiPlugin.registerPIXI(PIXI);\ngsap.registerPlugin(PixiPlugin);\n\n\n// tslint:disable-next-line:no-empty-interface\nexport interface StateProps {\n}\n\n// tslint:disable-next-line:no-empty-interface\nexport interface DispatchProps {\n}\n\nexport enum View {\n    Town,\n    World,\n}\n\nexport interface Props {\n    persistor: Persistor;\n}\n\n\nexport const MAX_WIDTH = 960;\nexport const AppContext = createContext<AppContextProps | null>(null);\ntype AllProps = Props & StateProps & DispatchProps;\n\n\nconst App = (props: AllProps) => {\n    const containerRef = useRef<HTMLDivElement>(null);\n\n    const [media, setMedia] = useState<MediaItem[]>([]);\n    const [activeWindows, setActiveWindows] = useState<React.ReactElement[]>([]);\n\n    const handleViewButtonClick = () => {\n        SoundManager.playSound(Sound.buttonClick);\n    };\n\n    const handleRestartClick = () => {\n        restartGame();\n\n    };\n\n    const selectStructure = (structure: Structure | null) => {\n        if (structure) {\n            const displayName = TextManager.getStructureName(structure);\n\n            const window = <StructureDetailsView structure={structure} title={displayName} />;\n            handleWindowOpened(window);\n\n            SoundManager.playSound(Sound.buttonClick);\n       }\n    };\n\n    const renderTownView = () => <TownView onStructureClick={selectStructure} />;\n    const renderWorldView = () => <WorldView />;\n\n    const handleWindowOpened = (window: React.ReactElement) => {\n        setActiveWindows([\n            ...activeWindows || [],\n            window,\n        ]);\n    };\n\n    /**\n     * Closes all windows\n     */\n    const handleWindowClose = () => {\n        setActiveWindows([]);\n    };\n\n    /**\n     * Closes the top window of the stack\n     */\n    const handleWindowBack = () => {\n        if (activeWindows && activeWindows.length) {\n            setActiveWindows(activeWindows.slice(0, -1));\n        }\n    };\n\n    const renderWindow = (): React.ReactElement | null => {\n        if (!activeWindows.length) {\n            return null;\n        }\n\n        const topWindow = activeWindows[activeWindows.length - 1];\n        const commonWindowProps = {\n            onClose: handleWindowClose,\n            onBack: handleWindowBack,\n            backEnabled: activeWindows.length > 1,\n            closeEnabled: true,\n        };\n\n        const element = React.cloneElement(topWindow, commonWindowProps);\n        return element;\n    };\n\n    const handleMediaLoadComplete = (mediaItems: MediaItem[]) => {\n        const sounds = mediaItems.filter((m) => m.mediaType === MediaType.sound);\n        SoundManager.loadMedia(sounds);\n\n        // todo: refactor manifest stuff\n        SoundManager.addSounds({\n            [Sound.buttonClick]: \"sound/fx/button-click.ogg\",\n            [Sound.error]: \"sound/fx/error.ogg\",\n            [Sound.toast]: \"sound/fx/toast.ogg\"\n            // add more sounds here\n        });\n\n        setMedia(mediaItems);\n\n        // todo: temporary!\n        // const window = <CombatView/>;\n        // handleWindowOpened(window);\n    };\n\n    const handleAppClick = () => {\n        TooltipManager.clear();\n    };\n\n    useEffect(() => {\n        const handleScroll = debounce(() => {\n            TooltipManager.clear();\n        }, 100);\n        window.addEventListener(\"scroll\", handleScroll);\n        window.addEventListener(\"wheel\", handleScroll);\n        return () => {\n            window.removeEventListener(\"resize\", handleScroll);\n            window.removeEventListener(\"wheel\", handleScroll);\n        };\n    }, []);\n    // const handleResize = () => {\n    //     if (containerRef.current) {\n    //         if (window.innerHeight < resolution.height) {\n    //            // containerRef.current.style.transform = `scale(${Math.min(window.innerWidth / resolution.width, 1)}) translateX(-50%)`;\n    //         } else {\n    //             //containerRef.current.style.transform = `scale(1) translateX(-50%)`;\n    //         }\n    //         //const parentBox = containerRef.current.getBoundingClientRect();\n    //         //setContainerRect(parentBox);\n    //    }\n    // };\n\n    // useEffect(() => {\n    //     // todo: see if we can disable this;\n    //     window.addEventListener(\"resize\", handleResize);\n    //     handleResize();\n    //     return () => {\n    //         window.removeEventListener(\"resize\", handleResize);\n    //     };\n    // }, []);\n\n    return (\n        <AppContext.Provider value={{\n            media,\n            onOpenWindow: handleWindowOpened,\n            onCloseWindow: handleWindowClose,\n        }} >\n            <Background />\n            <div\n                className=\"app\"\n                ref={containerRef}\n                style={{\n                    maxWidth: MAX_WIDTH\n                }}\n                onClick={handleAppClick}\n            >\n                <DndProvider backend={HTML5Backend}>\n                <HashRouter>\n                    <Preloader\n                        manifest={manifest}\n                        onLoadComplete={handleMediaLoadComplete}\n                    >\n                        <Topbar persistor={props.persistor} />\n                        <div style={{ margin: \"4px 0 0 8px\"}}>\n                            <Switch>\n                                <Route path=\"/\" exact={true} >\n                                    <Redirect from=\"/\" to={getWorldLink()} />\n                                </Route>\n                                <Route path={getWorldLink()}>\n                                    <Link to={getTownLink()}>\n                                        <Button onClick={() => handleViewButtonClick()} color=\"green\"> {TextManager.get(`ui-view-button-town`)} </Button>\n                                    </Link>\n                                </Route>\n                                <Route path={getTownLink()}>\n                                    <Link to={getWorldLink()}>\n                                        <Button onClick={() => handleViewButtonClick()}  > {TextManager.get(`ui-view-button-world`)} </Button>\n                                    </Link>\n                                </Route>\n                            </Switch>\n                            {` | `}\n                            <Button onClick={() => handleRestartClick()} color={ButtonColor.purple} > Restart! </Button>\n                        </div>\n                        <Switch>\n                            <Route path={getTownLink()} render={renderTownView} />\n                            <Route path={getWorldLink()} render={renderWorldView} />\n                        </Switch>\n                        <SimpleLog/>\n                        {renderWindow()}\n                        <ContextTooltip />\n                        <Toasts />\n                    </Preloader>\n                </HashRouter>\n                </DndProvider>\n            </div>\n        </AppContext.Provider>\n    );\n};\n\nexport default App;\n","import React from 'react';\nimport { AdventurerStoreState } from 'store/types/adventurer';\nimport { SOURCE_ID } from '../TavernStructureView';\nimport AdventurerButton from './AdventurerButton';\nimport { TextManager } from 'global/TextManager';\nimport DraggableAdventurerAvatar from 'components/ui/adventurer/DraggableAdventurerAvatar';\nimport AdventurerPanel from 'components/ui/adventurer/AdventurerPanel';\nimport Button from 'components/ui/buttons/Button';\nimport { renameAdventurer } from 'store/actions/adventurers';\nimport { useDispatch } from 'react-redux';\n\nexport interface Props {\n    adventurer: AdventurerStoreState;\n    onQuest: boolean;\n    assignedAventurers: AdventurerStoreState[];\n    expanded: boolean;\n    selectedQuestName?: string;\n\n    onClick: (adventurer: AdventurerStoreState) => void;\n    onAddAdventurer: (adventurer: AdventurerStoreState, index: number) => void;\n    onRemoveAdventurer: (adventurer: AdventurerStoreState) => void;\n}\n\n// Room block that has adventurer\nconst RoomWithAdventurer = (props: Props) => {\n    const {\n        adventurer,\n        onQuest,\n        assignedAventurers,\n        expanded,\n        selectedQuestName,\n        onClick,\n        onAddAdventurer,\n        onRemoveAdventurer\n    } = props;\n\n    const dispatch = useDispatch();\n    const assigned = assignedAventurers.indexOf(adventurer) > -1; // assigned to a quest in the QuestBoard\n\n    const handleRename = () => {\n        const name = prompt(\"Enter new name\", adventurer.name);\n        if (name && name !== adventurer.name) {\n            dispatch(renameAdventurer(adventurer.id, name));\n        }\n    };\n\n    return (\n        <>\n            <div className={`room ${expanded ? \"expanded\" : \"\"}`}>\n                <DraggableAdventurerAvatar\n                    disabled={assigned || onQuest}\n                    adventurer={adventurer}\n                    className=\"adventurer-icon\"\n                    sourceId={SOURCE_ID}\n                    key={`avatar:${adventurer.id}`}\n                />\n                <div\n                    key={adventurer.id}\n                    onClick={() => onClick(adventurer)}\n                >\n                    <section>\n                        {adventurer.name}\n                    </section>\n                    <section className=\"on-a-quest\">\n                     {(onQuest) && TextManager.get(\"ui-structure-tavern-on-a-quest\") }\n                    </section>\n                </div>\n                <span className=\"rename\" onClick={handleRename}>rename</span>\n            </div>\n            { expanded && (\n                <div className=\"adventurer-details\">\n                    <AdventurerPanel adventurerId={adventurer.id} name={false} />\n                    { (!onQuest && selectedQuestName) && (\n                        <AdventurerButton\n                            adventurer={adventurer}\n                            assignedAventurers={assignedAventurers}\n                            questName={selectedQuestName}\n                            onAddAdventurer={onAddAdventurer}\n                            onRemoveAdventurer={onRemoveAdventurer}\n                        />\n                    )}\n                </div>\n            )}\n        </>\n    );\n}\n\nexport default RoomWithAdventurer;\n","import React, {  } from 'react';\n\nexport interface Props {\n}\n\nconst RoomEmpty = () => {\n    return (\n        <div className=\"room\">\n            (empty room)\n        </div>\n    );\n}\n\nexport default RoomEmpty;\n","import React, { useState } from 'react';\nimport { AdventurerStoreState } from 'store/types/adventurer';\nimport { QuestStoreState } from 'store/types/quest';\nimport RoomWithAdventurer from './RoomWithAdventurer';\nimport RoomEmpty from './RoomEmpty';\nimport { TextManager } from 'global/TextManager';\nimport \"./styles/roomList.scss\";\n\nexport interface Props {\n    roomCount: number;\n    adventurers: AdventurerStoreState[];\n    assignedAventurers: AdventurerStoreState[];\n    quests: QuestStoreState[];\n    selectedQuestName?: string;       // name of selected quest\n\n    onAddAdventurer: (adventurer: AdventurerStoreState, index: number) => void;\n    onRemoveAdventurer: (adventurer: AdventurerStoreState) => void;\n}\n\nconst RoomList = (props: Props) => {\n    const {\n        roomCount,\n        adventurers,\n        assignedAventurers,\n        selectedQuestName,\n        onAddAdventurer,\n        onRemoveAdventurer\n    } = props;\n    const [selectedAdventurer, setSelectedAdventurer] = useState<string>();\n\n    const getQuestByAdventurer = (adventurerId: string): QuestStoreState | undefined => {\n        return Object.values(props.quests).find((quest) => {\n            return quest.party.indexOf(adventurerId) > -1;\n        });\n    };\n\n    const handleAdventurerNameClick = (adventurer: AdventurerStoreState) => {\n        if (selectedAdventurer === adventurer.id) {\n            setSelectedAdventurer(undefined);\n        } else {\n            setSelectedAdventurer(adventurer.id);\n        }\n    };\n\n    const roomContent: JSX.Element[] = [];\n    for (let i = 0; i < roomCount; i++) {\n        const adventurer = adventurers.find((a) => a.room === i);\n        if (!adventurer) {\n            roomContent.push((\n                <RoomEmpty key={`room${i}`} />\n            ));\n            continue;\n        }\n        const onQuest = !!getQuestByAdventurer(adventurer.id);\n\n        roomContent.push((\n            <RoomWithAdventurer\n                key={adventurer.id}\n                adventurer={adventurer}\n                assignedAventurers={assignedAventurers}\n                selectedQuestName={selectedQuestName}\n                expanded={selectedAdventurer === adventurer.id}\n                onQuest={onQuest}\n\n                onClick={handleAdventurerNameClick}\n                onAddAdventurer={onAddAdventurer}\n                onRemoveAdventurer={onRemoveAdventurer}\n            />\n        ));\n    }\n\n    return (\n        <div className=\"room-list\">\n            <h2>{TextManager.get(\"ui-structure-tavern-rooms\")}</h2>\n            { roomContent }\n        </div>\n    );\n}\n\nexport default RoomList;","import * as React from \"react\";\nimport { getDefinition, Structure } from 'definitions/structures';\nimport { formatDuration } from 'utils/format/time';\nimport { TavernStructureDefinition } from 'definitions/structures/types';\nimport Icon from 'components/ui/common/Icon';\nimport { TextManager } from 'global/TextManager';\nimport \"./styles/upgradeHelpModal.scss\"\n\nexport interface Props  {\n    level: number;\n}\n\nconst UpgradeHelpModal = (props: Props) => {\n    const { level } = props;\n    const structureDefinition: TavernStructureDefinition = getDefinition(Structure.tavern);\n\n    const currentLevel = structureDefinition.levels[level];\n    const nextLevel = structureDefinition.levels[level + 1];\n\n\n    return (\n        <div className=\"tavern-upgrade-help-modal\">\n            <div className=\"top\">\n                <h3>{TextManager.get(\"ui-structure-help-upgrade-title\", { structure: Structure.tavern} )}</h3>\n                <div className=\"cost\">\n                    <section>\n                        {TextManager.get(\"ui-structure-help-upgrade-cost-gold\", { gold: nextLevel.cost.gold})}\n                    </section>\n                    { nextLevel.cost.time && <section>{formatDuration(nextLevel.cost.time)}</section> }\n                </div>\n            </div>\n            <div className=\"rooms-increase\">\n                <div className=\"header\"/>\n                <div className=\"header\">\n                    {TextManager.getStructureName(Structure.tavern)}\n                </div>\n                <div className=\"header number\">\n                    {TextManager.get(\"ui-structure-help-upgrade-header-level\", {\n                        level: level + 1\n                    })}\n                </div>\n                <div className=\"header\"/>\n                <div className=\"header number\">\n                    {TextManager.get(\"ui-structure-help-upgrade-header-level\", {\n                        level: level + 2\n                    })}\n                </div>\n                <div><Icon image=\"img/ui/structures/tavern.png\" size=\"smallest\"/></div>\n                <div>{TextManager.get(\"ui-structure-tavern-rooms\")}</div>\n                <div className=\"number\">{currentLevel.rooms}</div>\n                <div className=\"arrow\">⟶</div>\n                <div className=\"number\">{nextLevel.rooms}</div>\n            </div>\n        </div>\n    )\n}\n\nexport default UpgradeHelpModal;","import * as React from \"react\";\nimport { getDefinition, Structure} from \"definitions/structures\";\nimport { TavernStructureDefinition, TavernStructureLevelDefinition} from \"definitions/structures/types\";\nimport { AdventurerStoreState} from \"store/types/adventurer\";\nimport { QuestStatus, QuestStoreState} from \"store/types/quest\";\nimport { TextManager} from \"global/TextManager\";\nimport { ToastManager} from 'global/ToastManager';\nimport { Type} from 'components/ui/toasts/Toast';\nimport { getQuestLink} from 'utils/routing';\nimport RoomList from './rooms/RoomList';\nimport { useState} from 'react';\nimport QuestBoard from './QuestBoard';\nimport useStructureState from 'hooks/store/useStructureState';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { StoreState } from 'store/types';\nimport { launchQuest } from 'store/actions/quests';\nimport { AdventurerAvatarDragInfo } from 'components/ui/adventurer/DraggableAdventurerAvatar';\nimport StructureLevel from '../StructureLevel';\nimport UpgradeHelpModal from './UpgradeHelpModal';\nimport { TooltipManager } from 'global/TooltipManager';\nimport { ContextType } from 'constants/context';\nimport \"./styles/tavernStructureView.scss\";\n\nexport const SOURCE_ID = \"tavern\";\n\n// The UI for the tavern\nconst TavernStructureView = () => {\n    const level = useStructureState(Structure.tavern).level;\n    const adventurers = useSelector<StoreState, AdventurerStoreState[]>(store => store.adventurers);\n    const quests = useSelector<StoreState, QuestStoreState[]>(store => store.quests);\n\n    const [assignedAventurers, setAassignedAdventurers] = useState<AdventurerStoreState[]>([]);\n    const [selectedQuest, setSelectedQuest] = useState<string>();\n\n    const structureDefinition = getDefinition<TavernStructureDefinition>(Structure.tavern);\n    const levelDefinition: TavernStructureLevelDefinition = structureDefinition.levels[level];\n    const displayName = TextManager.getStructureName(Structure.tavern);\n\n    const dispatch = useDispatch();\n\n    const onLaunchQuest = (questName: string) => {\n        dispatch(launchQuest(questName, assignedAventurers));\n    };\n\n    const getAvailableQuests = quests.filter((q) => q.status === QuestStatus.available );\n\n    const handleQuestClick = (name: string): void => {\n        if (selectedQuest === name) {\n            setSelectedQuest(undefined);\n        } else {\n            setSelectedQuest(name);\n        }\n\n        // Unassign all adventurers\n        setAassignedAdventurers([]);\n    };\n\n    const handleAdventurerDropped = (item: AdventurerAvatarDragInfo, index: number) => {\n        if (item.sourceId === SOURCE_ID) {\n            handleAddAdventurer(item.adventurer, index)\n        }\n    }\n\n    const handleAddAdventurer = (adventurer: AdventurerStoreState, index: number): void => {\n        const copy = [ ...assignedAventurers];\n        copy[index] = adventurer;\n        setAassignedAdventurers(copy);\n    };\n\n    const handleRemoveAdventurer = (adventurer: AdventurerStoreState): void => {\n        const index = assignedAventurers.indexOf(adventurer);\n        const copy = [ ...assignedAventurers];\n        delete copy[index];\n        setAassignedAdventurers(copy);\n    };\n\n    const handleLaunchQuest = (): void => {\n        const questTitle = TextManager.getQuestTitle(selectedQuest!);\n        const leader = assignedAventurers[0];\n        ToastManager.addToast(questTitle, Type.questLaunched, leader?.avatarImg, getQuestLink(selectedQuest!));\n        onLaunchQuest(selectedQuest!);\n    };\n\n    const handleHelpClicked = (event: React.MouseEvent) => {\n        const origin = (event.currentTarget as HTMLElement);\n        const originRect = origin.getBoundingClientRect();\n        const content = <UpgradeHelpModal level={level} />;\n        TooltipManager.showContextTooltip(ContextType.component, content, originRect, \"upgrade-structure-tooltip\");\n\n        event.stopPropagation();\n    }\n\n    return (\n        <div className=\"tavern-structure-view\">\n            <StructureLevel structure={Structure.tavern} onHelpClicked={handleHelpClicked}/>\n            <section>\n                <RoomList\n                    roomCount={levelDefinition.rooms}\n                    adventurers={adventurers}\n                    assignedAventurers={assignedAventurers}\n                    quests={quests}\n                    selectedQuestName={selectedQuest}\n                    onAddAdventurer={handleAddAdventurer}\n                    onRemoveAdventurer={handleRemoveAdventurer}\n                />\n                <QuestBoard\n                    availableQuests={getAvailableQuests}\n                    selectedQuestName={selectedQuest}\n                    assignedAventurers={assignedAventurers}\n                    onQuestClick={(name: string) => handleQuestClick(name)}\n                    onAdventurerDropped={handleAdventurerDropped}\n                    onRemoveAdventurer={handleRemoveAdventurer}\n                    onLaunchQuest={handleLaunchQuest}\n                />\n            </section>\n        </div>\n    );\n};\n\nexport default TavernStructureView;\n","import * as React from \"react\";\nimport { getDefinition, Structure } from 'definitions/structures';\nimport { formatDuration } from 'utils/format/time';\nimport resourceDescriptions from \"definitions/resources\";\nimport { ResourceStructureDefinition } from 'definitions/structures/types';\nimport { Resource } from 'definitions/resources';\nimport Icon from 'components/ui/common/Icon';\nimport { TextManager } from 'global/TextManager';\nimport \"./styles/upgradeHelpModal.scss\"\n\nexport interface Props  {\n    structure: Structure;\n    level: number;\n}\n\nconst UpgradeHelpModal = (props: Props) => {\n    const { level, structure } = props;\n    const structureDefinition: ResourceStructureDefinition = getDefinition(structure);\n\n    const currentLevel = structureDefinition.levels[level];\n    const nextLevel = structureDefinition.levels[level + 1];\n\n    const renderRow = (resource: Resource) => {\n        const resourceDescription = resourceDescriptions[resource];\n\n        return (\n            <React.Fragment key={resource}>\n                <div><Icon image={resourceDescription.iconImg} size=\"smallest\"/></div>\n                <div>\n                   {TextManager.get(\"ui-structure-resource-help-upgrade-resource-generates\", { resource })}\n                </div>\n                <div className=\"number\">{currentLevel.generates[resource]}</div>\n                <div className=\"arrow\">⟶</div>\n                <div className=\"number\">{nextLevel.generates[resource]}</div>\n            </React.Fragment>\n        )\n    }\n\n    return (\n        <div className=\"resource-upgrade-help-modal\">\n            <div className=\"top\">\n                <h3>{TextManager.get(\"ui-structure-help-upgrade-title\", { structure } )}</h3>\n                <div className=\"cost\">\n                    <section>\n                        {TextManager.get(\"ui-structure-help-upgrade-cost-gold\", { gold: nextLevel.cost.gold})}\n                    </section>\n                    { nextLevel.cost.time && <section>{formatDuration(nextLevel.cost.time)}</section> }\n                </div>\n            </div>\n            <div className=\"grid generates-increase\">\n                <div className=\"header\"/>\n                <div className=\"header\"/>\n                <div className=\"header number\">\n                    {TextManager.get(\"ui-structure-help-upgrade-header-level\", {\n                        level: level + 1\n                    })}\n                </div>\n                <div className=\"header\"/>\n                <div className=\"header number\">\n                {TextManager.get(\"ui-structure-help-upgrade-header-level\", {\n                        level: level + 2\n                    })}\n                </div>\n                <div><Icon image={\"/img/resources/worker.png\"} size=\"smallest\"/></div>\n                <div>{TextManager.get(\"ui-structure-help-upgrade-worker-capacity\")}</div>\n                <div className=\"number\">{currentLevel.workerCapacity}</div>\n                <div className=\"arrow\">⟶</div>\n                <div className=\"number\">{nextLevel.workerCapacity}</div>\n                {Object.keys(nextLevel.generates).map(res => renderRow(Resource[res]))}\n            </div>\n        </div>\n    )\n}\n\nexport default UpgradeHelpModal;","import React from 'react';\nimport { getDefinition, Structure } from 'definitions/structures';\nimport { TextManager } from 'global/TextManager';\nimport { useEngine } from 'hooks/store/engine';\nimport { formatDuration } from 'utils/format/time';\nimport { RESOURCE_INTERVAL } from 'constants/resources';\nimport Progressbar, { Direction } from 'components/ui/common/Progressbar';\nimport { Resource } from 'definitions/resources';\nimport useStructureState from 'hooks/store/useStructureState';\nimport { ResourceStructureDefinition, ResourceStructureLevelDefinition } from 'definitions/structures/types';\nimport Icon from 'components/ui/common/Icon';\nimport resourceDescriptions from \"definitions/resources\";\n\ninterface Props {\n    structure: Structure;\n    resource: Resource;\n}\n\nconst ResourceGenerationRow = (props: Props) => {\n    const {structure, resource} = props;\n    const engine = useEngine();\n    const {level, workers} = useStructureState(structure);\n    const structureDefinition = getDefinition<ResourceStructureDefinition>(props.structure);\n    if (!structureDefinition) {\n        throw new Error(`No definition found for structure ${props.structure} with type ResourceStructureDefinition.`);\n    }\n    const levelDefinition: ResourceStructureLevelDefinition = structureDefinition.levels[level];\n    const generates = levelDefinition.generates[resource] || 0;\n    const delta = RESOURCE_INTERVAL - (Date.now() - engine.lastProducedUpdate);\n    const resourceDescription = resourceDescriptions[resource];\n\n    return (\n        <div className=\"resource-generation-row\">\n            <div className=\"info\">\n                <Icon image={resourceDescription.iconImg}  size=\"smallest\"/>\n                <div>\n                    {TextManager.get(\"ui-structure-resource-generates\", {\n                        amount: generates,\n                        resource,\n                    })}\n                </div>\n            </div>\n            <Progressbar\n                className=\"generating\"\n                direction={Direction.decreasing}\n                label={`${TextManager.get(\"ui-structure-resource-next-generates\", {\n                    amount: generates * workers,\n                    resource,\n                    time: formatDuration(delta)\n                })}`}\n                progress={delta / RESOURCE_INTERVAL}\n            />\n        </div>\n    )\n}\nexport default ResourceGenerationRow;","import * as React from \"react\";\nimport { getDefinition, Structure  } from \"definitions/structures\";\nimport { ResourceStructureDefinition, ResourceStructureLevelDefinition } from \"definitions/structures/types\";\nimport UpDownValue from \"components/ui/common/UpDownValue\";\nimport { StructureStoreState } from 'store/types/structure';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { StoreState } from 'store/types';\nimport { selectFreeWorkers } from 'store/selectors/workers';\nimport { decreaseWorkers, increaseWorkers } from 'store/actions/structures';\nimport StructureViewHeader from '../StructureViewHeader';\nimport { TextManager } from 'global/TextManager';\nimport StructureLevel from '../StructureLevel';\nimport './styles/resourceStructureView.scss';\nimport { TooltipManager } from 'global/TooltipManager';\nimport { ContextType } from 'constants/context';\nimport UpgradeHelpModal from './UpgradeHelpModal';\nimport useStructureState from 'hooks/store/useStructureState';\nimport ResourceGenerationRow from './ResourceGenerationRow';\nimport { Resource } from 'definitions/resources';\n\n\nexport interface Props  {\n    structure: Structure;\n}\n\n// todo: 02/12/2019 [ ] Can show progress bar in resource screen\nconst ResourceStructureView = (props: Props) => {\n    const {structure} = props;\n\n    // Fetch needed values from store\n    const {level, workers} = useStructureState(structure);\n    const structureDefinition = getDefinition<ResourceStructureDefinition>(props.structure);\n    if (!structureDefinition) {\n        throw new Error(`No definition found for structure ${props.structure} with type ResourceStructureDefinition.`);\n    }\n    const levelDefinition: ResourceStructureLevelDefinition = structureDefinition.levels[level];\n    const workersFree = useSelector<StoreState, number>((store) => selectFreeWorkers(store));\n\n    // Reducer dispatch\n    const dispatch = useDispatch();\n    const handleWorkersDown = () => {\n        dispatch(decreaseWorkers(props.structure));\n    }\n\n    const handleWorkersUp = () => {\n        dispatch(increaseWorkers(props.structure));\n    };\n\n\n    const upDisabled = workers === levelDefinition.workerCapacity || (workersFree || 0) < 1;\n    const downDisabled = workers === 0;\n\n    const handleHelpClicked = (event: React.MouseEvent) => {\n        const origin = (event.currentTarget as HTMLElement);\n        const originRect = origin.getBoundingClientRect();\n        const content = <UpgradeHelpModal level={level} structure={structure} />;\n        TooltipManager.showContextTooltip(ContextType.component, content, originRect, \"upgrade-structure-tooltip\");\n\n        event.stopPropagation();\n    }\n\n    return (\n        <>\n            <StructureViewHeader structure={props.structure} />\n            <div className=\"resource-structure-view\">\n                <section>\n                    <StructureLevel structure={structure} onHelpClicked={handleHelpClicked}/>\n                    <UpDownValue\n                        label={TextManager.get(\"ui-structure-production-workers\")}\n                        value={workers}\n                        max={levelDefinition.workerCapacity}\n                        upDisabled={upDisabled}\n                        downDisabled={downDisabled}\n                        onDown={handleWorkersDown}\n                        onUp={handleWorkersUp}\n                    />\n                    { Object.keys(levelDefinition.generates).map(r => <ResourceGenerationRow structure={structure} resource={Resource[r]} key={r} />)}\n                </section>\n            </div>\n\n        </>\n    );\n};\n\nexport default ResourceStructureView;\n","\nimport { getDefinition, Structure } from \"definitions/structures\";\nimport { StructureDefinition, StructureType } from \"definitions/structures/types\";\nimport * as React from \"react\";\nimport { StructureState } from \"store/types/structure\";\nimport { useSelector } from 'react-redux';\nimport { StoreState } from 'store/types';\nimport { TasksStoreState } from 'store/types/tasks';\nimport useStructureState from 'hooks/store/useStructureState';\nimport { withWindow } from 'hoc/withWindow';\nimport { Props as WindowProps } from \"components/ui/window/Window\";\nimport { formatDuration } from 'utils/format/time';\nimport Progressbar from 'components/ui/common/Progressbar';\nimport ProductionStructureView from 'components/structures/production/ProductionStructureView';\nimport WarehouseStructureView from 'components/structures/warehouse/WarehouseStructureView';\nimport TavernStructureView from 'components/structures/tavern/TavernStructureView';\nimport ResourceStructureView from 'components/structures/resource/ResourceStructureView';\nimport \"./styles/structuredetailsview.scss\";\n\nexport interface Props {\n    structure: Structure;\n}\n\nconst StructureDetailsView = (props: Props & WindowProps) => {\n    const tasks = useSelector<StoreState, TasksStoreState>(store => store.tasks);\n    const buildTask = tasks.running.filter((val) =>\n        val.origin === `town` && val.name === `${props.structure}.build`)[0];\n    const structureState = useStructureState(props.structure);\n\n    const renderContent = () => {\n        if (structureState.state === StructureState.Building) {\n            if (!buildTask) return null;\n            return (\n                <div className=\"building\">\n                    <Progressbar\n                        progress={buildTask.progress}\n                        label={`Building... (${formatDuration(buildTask.timeRemaining)})`}\n                    />\n                </div>\n            );\n        } else {\n\n            const structureDefinition: StructureDefinition = getDefinition(props.structure);\n            switch (structureDefinition.type) {\n                case StructureType.production: {\n                    return <ProductionStructureView structure={props.structure}/>;\n                }\n                case StructureType.resource: {\n                    return <ResourceStructureView structure={props.structure} />;\n                }\n                case StructureType.warehouse: {\n                    return <WarehouseStructureView />;\n                }\n                case StructureType.tavern: {\n                    return <TavernStructureView />;\n                }\n                default: {\n                    return <div> { props.structure } </div>;\n                }\n            }\n        }\n    }\n\n    return (\n        <div className=\"structure-details\">\n            { renderContent() }\n        </div>\n    );\n};\n\nexport default withWindow(StructureDetailsView);\n","import seedrandom from \"seedrandom\";\n\nlet generator: seedrandom.prng;\nexport function init(seed: string) {\n    dirty = true;\n    generator = seedrandom(seed, {state: true});\n}\n\nexport function random(): number {\n    if (!generator) { throw new Error(\"Call init() before random()\"); }\n    dirty = true;\n    return generator();\n}\n\n/**\n * Returns a random integer between min (inclusive) and max (inclusive).\n * The value is no lower than min (or the next integer greater than min\n * if min isn't an integer) and no greater than max (or the next integer\n * lower than max if max isn't an integer).\n */\nexport function randomInt(min: number = 0, max: number = 10) {\n    min = Math.ceil(min);\n    max = Math.floor(max);\n    return Math.floor(random() * (max - min + 1)) + min;\n}\n\nexport function state(): seedrandom.State {\n    dirty = false;\n    return generator.state();\n}\n\nexport let dirty = false;\n","import { RESOURCE_INTERVAL } from 'constants/resources';\r\nimport { getDefinition } from \"definitions/structures\";\r\nimport { ResourceStructureDefinition, ResourceStructureLevelDefinition, StructureType } from \"definitions/structures/types\";\r\nimport { getTimeMultiplier, TimeType } from 'mechanics/time';\r\nimport { selectMaxResources } from 'store/selectors/resources';\r\nimport { StoreState } from \"store/types\";\r\nimport { ResourceStoreState } from \"store/types/resources\";\r\nimport { StructuresStoreState } from \"store/types/structures\";\r\n\r\n\r\n /*\r\n  * Calculates how many resources are generated by the in the town.\r\n  * Will return a ResourceStoreState with the amount of each resource to add  */\r\nconst getProducedResources = (lastProducedUpdate: number, store: StoreState): ResourceStoreState|null => {\r\n    const structures: StructuresStoreState = store.structures;\r\n    const result: ResourceStoreState = {};\r\n    const timeMultiplier = getTimeMultiplier(TimeType.resourceGeneration);\r\n\r\n    // this function can run at different intervals\r\n    // faster or slower than once a minute\r\n    // we will multiply the resource amount by the factor to normalize\r\n    const factor = ((Date.now() - lastProducedUpdate) / (RESOURCE_INTERVAL / timeMultiplier));\r\n    const maxResources = selectMaxResources(store);\r\n\r\n    const handleStructure = (structure: string) => {\r\n        const structureDefinition = getDefinition(structure);\r\n\r\n        if (structureDefinition.type === StructureType.resource) {\r\n            const resourceStructureDefinition = structureDefinition as ResourceStructureDefinition;\r\n            const level: number = structures[structure].level;\r\n            const levelDefinition: ResourceStructureLevelDefinition = resourceStructureDefinition.levels[level];\r\n\r\n            // Store all the resources that this structure will generate this tick into `result`\r\n            Object.keys(levelDefinition.generates).reduce((accumulator: ResourceStoreState, resource: string) => {\r\n                const amount: number = levelDefinition.generates[resource] * structures[structure].workers * factor;\r\n                accumulator[resource] = (accumulator[resource] || 0) + amount;\r\n                return accumulator;\r\n            }, result);\r\n        }\r\n    };\r\n\r\n    if (factor < 1) {\r\n        return null;\r\n    }\r\n    // Calculate what each structure generates. Stores in `result`.\r\n    Object.keys(structures).forEach((structure) => handleStructure(structure));\r\n\r\n    // Check if the warehouse can actually hold it\r\n    Object.keys(result).forEach((resource: string) => {\r\n        if (result[resource]) {\r\n            if (store.resources[resource]! + result[resource]! >= maxResources[resource]!) {\r\n                result[resource] = maxResources[resource]! - (store.resources[resource]!);\r\n            }\r\n        }\r\n        // console.log(`Adding: ${resource} ${result[resource]} factor ${factor}`);\r\n    });\r\n\r\n    return result;\r\n};\r\n\r\n\r\nexport default getProducedResources;\r\n","import { TextEntry } from \"constants/text\";\nimport questDefinitions from \"definitions/quests\";\nimport { QuestDefinition, QuestNodeType } from 'definitions/quests/types';\n\nimport { Store } from \"redux\";\nimport { StoreState } from \"store/types\";\nimport { LogChannel } from \"store/types/logEntry\";\nimport { QuestStatus, QuestStoreState } from \"store/types/quest\";\nimport { ToastManager } from 'global/ToastManager';\nimport { TextManager } from 'global/TextManager';\nimport { Type } from 'components/ui/toasts/Toast';\nimport { getQuestLink } from 'utils/routing';\nimport { setSceneName } from 'store/actions/quests';\nimport { getQuestLeader } from 'store/helpers/storeHelpers';\nimport { getTimeMultiplier, TimeType } from 'mechanics/time';\n\nexport interface QuestUpdate {\n    name: string;\n    progress: number;\n}\n\nexport interface LogUpdate extends TextEntry {\n    key: string;\n    channel: LogChannel;\n    channelContext?: any;\n}\n\ninterface QuestGameTickResponse {\n    questUpdates: QuestUpdate[];\n    logUpdates: LogUpdate[];\n}\n\nconst getQuestUpdates = (delta: number, store: Store<StoreState>): QuestGameTickResponse => {\n\n    const speed = 4;    // in nodes per minute\n    const timeMultiplier = getTimeMultiplier(TimeType.questProgress);\n    const MS_PER_MINUTE = 60000;\n    const log: LogUpdate[] = [];\n    const quests: QuestUpdate[] = [];\n    const state: StoreState = store.getState();\n\n    // Moves the quest line progress. Only if currently at a 'nothing' node\n    // Otherwise the player has to do something to move the quest along\n    state.quests.forEach((quest: QuestStoreState) => {\n        if (quest.status !== QuestStatus.active) {\n            return;\n        }\n        const questDefinition: QuestDefinition = questDefinitions[quest.name];\n        const currentProgress = quest.progress;\n        const currentNodeIndex = Math.floor(currentProgress);\n        const currentNode = questDefinition.nodes[currentNodeIndex];\n\n        if (currentNode.type === QuestNodeType.nothing) {\n            // Currently at a 'nothing' node\n            const progressIncrease = (delta / (MS_PER_MINUTE / timeMultiplier)) * speed;\n            // todo: [15/07/2019] speed could be different for each party\n            const nextProgress = Math.min(currentProgress + progressIncrease, questDefinition.nodes.length - 1);\n            const nodesPassed = Math.floor(nextProgress) - currentNodeIndex;\n\n            // console.log(nextProgress, nodesPassed)\n            for (let i = 1; i <= nodesPassed; i++) {\n                // Loop through all the nodes we've passed since last tick\n                const nextNode = questDefinition.nodes[currentNodeIndex + i];\n//                console.log(`next node: ${QuestNodeType[nextNode.type]}`)\n                if (nextNode.type === QuestNodeType.encounter) {\n                    // We've hit an encounter node. set the progress to here and stop looking at other nodes\n\n                    store.dispatch(setSceneName(quest.name, nextNode.startScene!));\n\n                    const questTitle = TextManager.getQuestTitle(quest.name);\n                    const leader = getQuestLeader(state.adventurers, quest);\n                    ToastManager.addToast(questTitle, Type.questEncounter, leader?.avatarImg, getQuestLink(quest.name));\n\n                    // Add quest to log\n                    if (nextNode.log) {\n                        log.push({\n                            channel: LogChannel.quest,\n                            channelContext: quest.name,\n                            key: nextNode.log,\n                        });\n                    }\n\n                    break;\n                } else if (nextNode.type === QuestNodeType.nothing) {\n                    if (nextNode.log) {\n                        log.push({\n                            channel: LogChannel.quest,\n                            channelContext: quest.name,\n                            key: nextNode.log,\n                        });\n                    }\n                }\n            }\n            quests.push({\n                name: quest.name,\n                progress: nextProgress,\n            });\n        }\n    });\n    return {\n        logUpdates: log,\n        questUpdates: quests,\n    };\n};\n\nexport default getQuestUpdates;\n","import { State as seedrandomStateType } from \"seedrandom\";\nimport * as Random from \"utils/random\";\n\nconst getRngState = (): seedrandomStateType | null => {\n    if (Random.dirty) {\n        return Random.state();\n    }\n    return null;\n};\n\nexport default getRngState;\n","// tslint:disable:no-console\n// In production, we register a service worker to serve assets from local cache.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on the 'N+1' visit to a page, since previously\n// cached resources are updated in the background.\n\n// To learn more about the benefits of this model, read https://goo.gl/KwvDNy.\n// This link also includes instructions on opting out of this behavior.\n\nconst isLocalhost = Boolean(\n  window.location.hostname === \"localhost\" ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === \"[::1]\" ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/,\n    ),\n);\n\nexport default function register() {\n  if (process.env.NODE_ENV === \"production\" && \"serviceWorker\" in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL!,\n      window.location.toString(),\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebookincubator/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener(\"load\", () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Lets check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            \"This web app is being served cache-first by a service \" +\n              \"worker. To learn more, visit https://goo.gl/SC7cgQ\",\n          );\n        });\n      } else {\n        // Is not local host. Just register service worker\n        registerValidSW(swUrl);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then((registration) => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker) {\n          installingWorker.onstatechange = () => {\n            if (installingWorker.state === \"installed\") {\n              if (navigator.serviceWorker.controller) {\n                // At this point, the old content will have been purged and\n                // the fresh content will have been added to the cache.\n                // It's the perfect time to display a 'New content is\n                // available; please refresh.' message in your web app.\n                console.log(\"New content is available; please refresh.\");\n              } else {\n                // At this point, everything has been precached.\n                // It's the perfect time to display a\n                // 'Content is cached for offline use.' message.\n                console.log(\"Content is cached for offline use.\");\n              }\n            }\n          };\n        }\n      };\n    })\n    .catch((error) => {\n      console.error(\"Error during service worker registration:\", error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then((response) => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      if (\n        response.status === 404 ||\n        response.headers.get(\"content-type\")!.indexOf(\"javascript\") === -1\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then((registration) => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl);\n      }\n    })\n    .catch(() => {\n      console.log(\n        \"No internet connection found. App is running in offline mode.\",\n      );\n    });\n}\n\nexport function unregister() {\n  if (\"serviceWorker\" in navigator) {\n    navigator.serviceWorker.ready.then((registration) => {\n      registration.unregister();\n    });\n  }\n}\n","// tslint:disable:object-literal-sort-keys\nimport {\n    ActionType,\n    AssignEquipmentAction,\n    InventoryAction,\n    MoveItemInInventoryAction,\n    MoveItemToOtherAdventurerAction,\n    RemoveEquipmentAction,\n    RemoveItemFromInventoryAction,\n    RenameAdventurerAction\n} from \"store/actions/adventurers\";\nimport { EquipmentSlotType } from \"components/ui/adventurer/EquipmentSlot\";\nimport { Item } from \"definitions/items/types\";\nimport { AnyAction, Reducer } from \"redux\";\nimport { AdventurerStoreState, BasicAttributesStoreState } from \"store/types/adventurer\";\nimport { Trait } from 'definitions/traits/types';\nimport { WeaponType } from 'definitions/items/weapons';\n\n/**\n * reducer\n * @param state\n * @param action\n */\nconst generateRandomAttributes = (): BasicAttributesStoreState => {\n    return {\n        strength: Math.floor(Math.random() * 3) + 9,\n        dexterity: Math.floor(Math.random() * 3) + 9,\n        intelligence: Math.floor(Math.random() * 3) + 9,\n        health: Math.floor(Math.random() * 3) + 9\n    };\n};\n\nconst avatarImgBasePath = \"img/avatars\";\nconst spritesheetBasePath = \"img/scene/actors/\";\n\n// Create a bunch of guys for debugging\nconst testState: AdventurerStoreState[] = [{\n    id: \"c4a5d270\",\n    equipment: {\n        head: Item.cowl,\n        chest: Item.chest,\n        hands: Item.clothGloves,\n        shoulders: Item.shoulders2,\n        legs: Item.pants2,\n        feet: Item.boots3,\n        offHand: Item.indomitableCarapace\n    },\n    basicAttributes: generateRandomAttributes(),\n    health: Math.random() * 100,\n    xp: Math.random() * 100,\n    baseAP: 6,\n    room: 0,\n    name: \"Ximena Maddox\",\n    traits: [Trait.houseMaddox, Trait.gloomy],\n    avatarImg: `${avatarImgBasePath}/female/f_14.png`,\n    spritesheetPath: `${spritesheetBasePath}axethrower.json`,\n    skills: {\n        [WeaponType.crossbow]: 10,\n        [WeaponType.bow]: 10\n    },\n    // tslint:disable-next-line:max-line-length\n    inventory: [ Item.deedForLumbermill, null, Item.simpleCrossbow, Item.dagger, Item.khopesh, null, Item.sword, null,  null,  null,  null,  Item.steelShield,  null,  null,  null,  null],\n}, {\n    id: \"2e655832\",\n    equipment: {\n        feet: Item.boots2\n    },\n    basicAttributes: generateRandomAttributes(),\n    name: \"Donte Houston\",\n    health: Math.random() * 100,\n    xp: Math.random() * 100,\n    baseAP: 6,\n    room: 1,\n    avatarImg: `${avatarImgBasePath}/male/m_05.png`,\n    spritesheetPath: `${spritesheetBasePath}footman.json`,\n    traits: [Trait.houseHouston],\n    skills: {\n        [WeaponType.crossbow]: 12,\n        [WeaponType.staff]: 13\n    },\n    // tslint:disable-next-line:max-line-length\n    inventory: [ Item.simpleCrossbow, null, null, null, null, Item.boots1, Item.chainmailHood, Item.nomadHelmet, Item.plateChest4, null, Item.buckler, null, null, null,  null,  null,  null,  null,  null,  null,  null,  null, Item.plateHelmet, Item.cowl],\n}, {\n    id: \"ec6f1050\",\n    equipment: {\n        feet: Item.boots3,\n        offHand: Item.aegisOfValor\n    },\n    basicAttributes: generateRandomAttributes(),\n    name: \"Zackary 'bone bag' Morris\",\n    health: Math.random() * 100,\n    xp: Math.random() * 100,\n    baseAP: 5,\n    room: 2,\n    traits: [Trait.gloomy],\n    skills: {\n        [WeaponType.sword]: 12,\n        [WeaponType.hammer]: 6\n    },\n    avatarImg: `${avatarImgBasePath}/male/m_09.png`,\n    spritesheetPath: `${spritesheetBasePath}skeleton.json`,\n    inventory: [ Item.greatswordOfGwai, null, null, null, Item.berserkerShield ],\n}, {\n    id: \"d299f98a\",\n    basicAttributes: generateRandomAttributes(),\n    equipment: {},\n    name: \"Mike Keith\",\n    health: Math.random() * 100,\n    xp: Math.random() * 100,\n    baseAP: 6,\n    room: 4,\n    avatarImg: `${avatarImgBasePath}/male/m_19.png`,\n    spritesheetPath: `${spritesheetBasePath}grunt.json`,\n    traits: [Trait.arrowFinder],\n    skills: {\n        [WeaponType.sword]: 13\n    },\n    inventory: [ null, null, null, null, Item.khopesh, Item.hornedHelmet, Item.woodenBulwark ],\n}, {\n    id: \"96c686c3\",\n    equipment: {},\n    basicAttributes: generateRandomAttributes(),\n    name: \"Wayne Monroe\",\n    health: Math.random() * 100,\n    xp: Math.random() * 100,\n    baseAP: 4,\n    room: 5,\n    avatarImg: `${avatarImgBasePath}/male/m_08.png`,\n    spritesheetPath: `${spritesheetBasePath}grunt.json`,\n    traits: [Trait.houseMonroe, Trait.arrowFinder],\n    skills: {\n        [WeaponType.axe]: 12\n    },\n    inventory: [ null, null, null, Item.goldenShield ],\n}, {\n    id: \"250d1a9d\",\n    basicAttributes: generateRandomAttributes(),\n    equipment: {},\n    name: \"Alexis Ortiz \",\n    health: Math.random() * 100,\n    xp: Math.random() * 100,\n    baseAP: 5,\n    room: 9,\n    avatarImg: `${avatarImgBasePath}/female/f_10.png`,\n    spritesheetPath: `${spritesheetBasePath}footman.json`,\n    inventory: [ null, null, null, null, null ],\n    skills: {\n        [WeaponType.axe]: 10\n    },\n}, {\n    id: \"169384ef\",\n    equipment: {},\n    basicAttributes: generateRandomAttributes(),\n    name: \"Karlee Nolan\",\n    health: Math.random() * 100,\n    xp: Math.random() * 100,\n    baseAP: 5,\n    room: 3,\n    avatarImg: `${avatarImgBasePath}/female/f_16.png`,\n    spritesheetPath: `${spritesheetBasePath}footman.json`,\n    inventory: [ Item.greatswordOfGwai, null, null, null ],\n    skills: {\n        [WeaponType.axe]: 10\n    },\n}, {\n    id: \"f22d66cb\",\n    basicAttributes: generateRandomAttributes(),\n    equipment: {},\n    name: \"Gylbarde the Earnest\",\n    health: Math.random() * 100,\n    xp: Math.random() * 100,\n    baseAP: 5,\n    room: 8,\n    avatarImg: `${avatarImgBasePath}/male/m_09.png`,\n    spritesheetPath: `${spritesheetBasePath}footman.json`,\n    inventory: [ null, null, null, null, null ],\n    skills: {\n        [WeaponType.axe]: 13\n    },\n}, {\n    id: \"36c686c1\",\n    equipment: {},\n    basicAttributes: generateRandomAttributes(),\n    name: \"Lanslet of the Water\",\n    health: Math.random() * 100,\n    xp: Math.random() * 100,\n    baseAP: 6,\n\n    room: 6,\n    avatarImg: `${avatarImgBasePath}/male/m_26.png`,\n    spritesheetPath: `${spritesheetBasePath}footman.json`,\n    inventory: [ Item.greatswordOfGwai, null, null, null, Item.shoulders1, Item.fedora, Item.greaves2 ],\n    skills: {\n        [WeaponType.axe]: 3\n    },\n}, {\n    id: \"12c613d4\",\n    equipment: {},\n    basicAttributes: generateRandomAttributes(),\n    name: \"Tedric the Bold\",\n    health: Math.random() * 100,\n    xp: Math.random() * 100,\n    baseAP: 6,\n    room: 7,\n    avatarImg: `${avatarImgBasePath}/male/m_33.png`,\n    spritesheetPath: `${spritesheetBasePath}footman.json`,\n    inventory: [ Item.greatswordOfGwai, null, null, null ],\n    skills: {\n        [WeaponType.axe]: 10\n    },\n}];\n\n// TODO: To generate a random 11 digit number, use: Math.random().toString(36).substring(2)\n\nexport const adventurers: Reducer<AdventurerStoreState[], AnyAction> = (\n    state: AdventurerStoreState[] = testState, action: AnyAction) => {\n\n    switch (action.type) {\n        // Moves an  item from one inventory slot to another\n        case ActionType.moveItemInInventory: {\n            const {\n                adventurerId,\n                fromSlot,\n                toSlot,\n            } = (action as MoveItemInInventoryAction);\n            const adventurer = state.find((a) => a.id === adventurerId)!;\n            const inventory = adventurer.inventory.map((element, index) => {\n                if (index === fromSlot) { return adventurer.inventory[toSlot]; }\n                if (index === toSlot) { return adventurer.inventory[fromSlot]; }\n                return element;\n            });\n\n            return state.map((element: AdventurerStoreState) => {\n                if (element === adventurer) {\n                    return {\n                        ...element,\n                        inventory,\n                    };\n                }\n                return element;\n            });\n        }\n\n        case ActionType.moveItemToOtherAdventurer: {\n            // Moves an item from one adventurer to another\n            const {\n                adventurerId: fromAdventurerId,\n                fromSlot,\n                toAdventurerId,\n            } = (action as MoveItemToOtherAdventurerAction);\n\n            const fromAdventurer = state.find((a) => a.id === fromAdventurerId)!;\n            const item = fromAdventurer.inventory[fromSlot];\n\n            return state.map((element: AdventurerStoreState) => {\n                if (element.id === fromAdventurerId) {\n                    // Clear out the item from this adventurer\n                    const inventory = element.inventory.concat();\n                    inventory[fromSlot] = null;\n                    return {\n                        ...element,\n                        inventory,\n                    };\n                } else if (element.id === toAdventurerId) {\n                    // Find first empty slot, add there\n                    const inventory = element.inventory.concat();\n                    const index = inventory.findIndex((slot) => slot === null);\n                    inventory[index] = item;\n                    // todo: what if there is no room?\n                    return {\n                        ...element,\n                        inventory,\n                    };\n                }\n                return element;\n            });\n        }\n\n        case ActionType.addItemToInventory: {\n            const { item } = action as InventoryAction;\n\n            return state.map((element: AdventurerStoreState) => {\n                if (element.id === action.adventurerId) {\n                    const inventory = element.inventory.concat();\n                    let toSlot = (action as InventoryAction).toSlot;\n                    if (toSlot === null || toSlot === undefined) {\n                        toSlot = inventory.findIndex((val) => (val === null || val === undefined));\n                    }\n                    inventory[toSlot!] = item;\n                    // todo: check if no space\n                    return {\n                        ...element,\n                        inventory,\n                    };\n                }\n                return element;\n            });\n        }\n\n        case ActionType.removeItemFromInventory: {\n            const { fromSlot } = action as RemoveItemFromInventoryAction;\n\n            return state.map((adventurer: AdventurerStoreState) => {\n                if (adventurer.id === action.adventurerId) {\n                    const inventory = adventurer.inventory.map((element, index) => index !== fromSlot ? element : null);\n                    return {\n                        ...adventurer,\n                        inventory,\n                    };\n                }\n                return adventurer;\n            });\n        }\n\n        case ActionType.assignEquipment: {\n            // Assigns equipment to an adventurer\n            const { equipmentSlot, item } = action as AssignEquipmentAction;\n            return state.map((adventurer: AdventurerStoreState) => {\n                if (adventurer.id === action.adventurerId) {\n                    return {\n                        ...adventurer,\n                        equipment: {\n                            ...adventurer.equipment,\n                            [EquipmentSlotType[equipmentSlot]]: item,\n                        },\n                    };\n                }\n                return adventurer;\n            });\n        }\n\n        case ActionType.removeEquipment: {\n            // Assigns equipment to an adventurer\n            const { equipmentSlot } = action as RemoveEquipmentAction;\n            return state.map((adventurer: AdventurerStoreState) => {\n                if (adventurer.id === action.adventurerId) {\n                    return {\n                        ...adventurer,\n                        equipment: {\n                            ...adventurer.equipment,\n                            [EquipmentSlotType[equipmentSlot]]: null,\n                        },\n                    };\n                }\n                return adventurer;\n            });\n        }\n        case ActionType.renameAdventurer: {\n            // Rename adventurer\n            const { name } = action as RenameAdventurerAction;\n            return state.map((adventurer: AdventurerStoreState) => {\n                if (adventurer.id === action.adventurerId) {\n                    return {\n                        ...adventurer,\n                        name\n                    };\n                }\n                return adventurer;\n            });\n        }\n\n    }\n\n    // debug: this will auto-increase the levels of every adventurer at every tick\n    // return state.map((adventurer: AdventurerStoreState) => {\n    //     return {\n    //         ...adventurer,\n    //         xp: adventurer.xp + 1\n    //     };\n    // });\n\n    return state;\n};\n","import updateCombat from \"mechanics/gameTick/combat\";\r\nimport * as React from \"react\";\r\nimport * as ReactDOM from \"react-dom\";\r\nimport { Provider } from \"react-redux\";\r\nimport { Store, AnyAction } from \"redux\";\r\nimport { Persistor } from \"redux-persist\";\r\nimport localforage from 'localforage';\r\nimport { gameTick, startGame } from \"store/actions/game\";\r\nimport { addLogText } from \"store/actions/log\";\r\nimport version from \"./constants/version\";\r\nimport App from \"./components/App\";\r\nimport getProducedResources from \"./mechanics/gameTick/producedResources\";\r\nimport getQuestUpdates, { LogUpdate } from \"./mechanics/gameTick/quests\";\r\nimport getRngState from \"./mechanics/gameTick/rngState\";\r\nimport registerServiceWorker from \"./registerServiceWorker\";\r\nimport configureStore from \"./utils/configureStore\";\r\nimport * as Random from \"./utils/random\";\r\nimport { TextManager } from \"./global/TextManager\";\r\nimport { loadResourceAsync } from 'utils/pixiJs';\r\nimport { processCompletedTasks } from 'mechanics/gameTick/tasks';\r\nimport { StoreState } from 'store/types';\r\nimport \"./index.css\";\r\n\r\n// Todo: Refactor into class\r\nconst TICK_INTERVAL = 2500;\r\nlet persistor: Persistor;\r\n\r\nconst initGame = async () => {\r\n    const texts = await loadResourceAsync(`${process.env.PUBLIC_URL}/lang/en-US.json`);\r\n    TextManager.init(texts.data);\r\n    Random.init(\"GILLESROX2\");\r\n\r\n    readPersistedStore();\r\n};\r\n\r\n/**\r\n * Attemps to read persisted store state. Calls `runGame`\r\n */\r\nconst readPersistedStore = async () => {\r\n    const storeConfiguration = await configureStore();\r\n    const { store, isHydrated } = storeConfiguration;\r\n    persistor = storeConfiguration.persistor;\r\n\r\n    if (!isHydrated) {\r\n        startNewGame(store);\r\n    } else {\r\n        continueGame(store);\r\n    }\r\n    runGame(store);\r\n}\r\n\r\n/**\r\n * Gets called when a player starts a new game\r\n * @param store\r\n */\r\nconst startNewGame = (store: any) => {\r\nconsole.log(\"STARTING NEW GAME\")\r\n    store.dispatch(startGame());\r\n    store.dispatch(addLogText(\"test-game-welcome\"));\r\n    // todo: here is a good place to launch a tutorial or something\r\n\r\n    // tslint:disable-next-line:no-console\r\n    console.log(`Starting new GAME (version ${version})`);\r\n};\r\n\r\n\r\n/**\r\n * Continue playing earlier persisted store\r\n * @param store\r\n */\r\nconst continueGame = (store: any) => {\r\n    // tslint:disable-next-line:no-console\r\n    console.log(`Continuing existing GAME (version ${version})`);\r\n};\r\n\r\n/**\r\n * Loads a saved game from a file\r\n */\r\nconst loadGame = async (state: StoreState) => {\r\n    // todo: implement in MenuWindow!\r\n    await persistor.purge();\r\n    const { store } = await configureStore(state);\r\n    runGame(store);\r\n\r\n    // We have to cause the page to reinitialize and all react components to remount\r\n    // eslint-disable-next-line no-restricted-globals\r\n    location.href = '#/world/'; // todo: load path from metadata '#/world/kill10Boars';\r\n}\r\n\r\nconst restartGame = () => {\r\n    // eslint-disable-next-line no-restricted-globals\r\n    if(confirm('Are you sure you wish to reset all your progress?')){\r\n        clearTimeout(interval);\r\n        persistor.purge();\r\n        localforage.clear();\r\n\r\n        readPersistedStore();\r\n        // eslint-disable-next-line no-restricted-globals\r\n        location.href = \"#/town\"\r\n    }\r\n}\r\n\r\n// const stopGame = () => {\r\n//     clearTimeout(interval);\r\n// };\r\n\r\nlet interval: NodeJS.Timeout;\r\nconst runGame = (store: Store<StoreState, AnyAction>) => {\r\n    clearTimeout(interval);\r\n\r\n    ReactDOM.render((\r\n        <Provider store={store}>\r\n            <App persistor={persistor} />\r\n        </Provider>\r\n        ),\r\n        document.getElementById(\"root\") as HTMLElement,\r\n    );\r\n    registerServiceWorker();\r\n\r\n    const gameLoop = () => {\r\n        const state: StoreState = store.getState();\r\n        const delta = Date.now() - state.engine.lastTick;\r\n\r\n        const logs: LogUpdate[] = [];\r\n        const resourcesUpdates = getProducedResources(state.engine.lastProducedUpdate, state);\r\n        const rngState = getRngState();\r\n        updateCombat(delta, store);\r\n        const { questUpdates, logUpdates } = getQuestUpdates(delta, store);\r\n        logs.push(...logUpdates);\r\n\r\n        store.dispatch(gameTick(delta, rngState, resourcesUpdates, questUpdates, logs));\r\n\r\n        processCompletedTasks(state.tasks, store.dispatch);\r\n\r\n        // store.dispatch(addLogEntry(\"test-you-have-found-an-item\", LogChannel.common, { item: Item.teeth }));\r\n    };\r\n\r\n    interval = setInterval(gameLoop, TICK_INTERVAL);\r\n};\r\nexport {runGame, restartGame, loadGame};\r\n\r\ninitGame();\r\n","// tslint:disable:object-literal-sort-keys\r\n\r\nexport interface EngineStoreState {\r\n    gameStarted?: number;\r\n    previousTick: number;\r\n    lastTick: number;\r\n    lastProducedUpdate: number;\r\n}\r\n\r\nexport const initialState: EngineStoreState = {\r\n    gameStarted: undefined,\r\n    previousTick: Date.now(),\r\n    lastTick: Date.now(),\r\n    lastProducedUpdate: Date.now()\r\n};\r\n","\r\nimport { ActionType, AddAction, AddStockpileSlotsAction, MoveItemInWarehouseAction, RemoveItemFromWarehouseAction } from \"store/actions/items\";\r\nimport { Item } from \"definitions/items/types\";\r\nimport { AnyAction, Reducer } from \"redux\";\r\nimport { getDefinition, Structure } from 'definitions/structures';\r\nimport { WarehouseStructureDefinition } from 'definitions/structures/types';\r\n\r\n// Items in warehouse\r\nconst getTestState = () => {\r\n    const result = [];\r\n    const { maxStockpile } = getDefinition<WarehouseStructureDefinition>(Structure.warehouse).levels[0];\r\n    for (let i = 0; i < maxStockpile; i++) {\r\n        if (Math.random() < .5) {\r\n            result.push(null)\r\n        } else {\r\n            const randomItem = randomEnum(Item);\r\n            result.push(randomItem);\r\n        }\r\n    }\r\n    return result;\r\n}\r\n\r\nconst randomEnum = <T>(anEnum: T): T[keyof T] => {\r\n    const enumValues = (Object.values(anEnum) as unknown) as T[keyof T][];\r\n    const randomIndex = Math.floor(Math.random() * enumValues.length);\r\n    return enumValues[randomIndex];\r\n}\r\n\r\n/**\r\n * reducer\r\n * @param state\r\n * @param action\r\n */\r\nexport const items: Reducer<(Item|null)[]> = (state: (Item|null)[] = getTestState(),\r\n                                                 action: AnyAction) => {\r\n    switch (action.type) {\r\n        case ActionType.addItem: {\r\n            // toSlot is optional\r\n            const { item } = (action as AddAction);\r\n            let { toSlot } = (action as AddAction);\r\n            if (toSlot === undefined) {\r\n                toSlot = state.findIndex((slot) => slot === null);  // find first empty element\r\n                if (toSlot === -1) {\r\n                    // Still not found. Add at end\r\n                    // todo: [07/07/2019] GAME DESIGN\r\n                    return [ ...state, item ];\r\n                }\r\n            }\r\n            return state.map((element, index) => index === toSlot ? item : element);\r\n        }\r\n\r\n        case ActionType.moveItemInWarehouse: {\r\n            const {\r\n                fromSlot,\r\n                toSlot,\r\n            } = (action as MoveItemInWarehouseAction);\r\n\r\n            return state.map((element, index) => {\r\n                if (index === fromSlot) { return state[toSlot]; }\r\n                if (index === toSlot) { return state[fromSlot]; }\r\n                return element;\r\n            });\r\n        }\r\n        case ActionType.removeItem: {\r\n            const { fromSlot } = (action as RemoveItemFromWarehouseAction);\r\n\r\n            return state.map((element, index) => index !== fromSlot ? element : null);\r\n        }\r\n\r\n        // Adds slots with 'null' to the end\r\n        case ActionType.addStockpileSlots: {\r\n            const {\r\n                slots,\r\n            } = (action as AddStockpileSlotsAction);\r\n\r\n            return [\r\n                ...state,\r\n                ...Array(slots).fill(null)\r\n            ];\r\n        }\r\n    }\r\n\r\n    return state;\r\n};\r\n","import { ActionType as GameActionType, GameTickAction } from \"store/actions/game\";\nimport { ActionType, AddLogEntryAction } from \"store/actions/log\";\nimport { LogUpdate } from \"mechanics/gameTick/quests\";\nimport { AnyAction, Reducer } from \"redux\";\nimport { LogEntry } from \"store/types/logEntry\";\n\n/**\n * reducer\n * @param state\n * @param action\n */\nexport const log: Reducer<LogEntry[]> = (state: LogEntry[] = [], action: AnyAction) => {\n    switch (action.type) {\n        case ActionType.addLogEntry:\n            const {entry, channel, channelContext} = (action as AddLogEntryAction);\n            const {key, context} = entry;\n            const time = Date.now();\n            return [{\n                    channel,\n                    channelContext,\n                    context,\n                    key,\n                    time,\n                },\n                ...state,\n            ];\n\n        case GameActionType.gameTick:\n            return gameTick(state, action as GameTickAction);\n    }\n    return state;\n};\n\nconst gameTick = (state: LogEntry[], action: GameTickAction): LogEntry[] => {\n    if (!action.log.length) {\n        return state;\n    }\n\n    // Add log entries\n    const logEntries = action.log.map((lU: LogUpdate): LogEntry => {\n        return {\n            ...lU,\n            time: Date.now(),\n        };\n    });\n    return [\n        ...logEntries,\n        ...state,\n    ];\n};\n","import { ActionType as GameActionType, GameTickAction } from \"store/actions/game\";\nimport {\n    ActionType,\n    QuestAction,\n    QuestLaunchAction,\n    QuestVarsAction,\n    UpdateEncounterResultAction,\n    EnqueueSceneActionAction,\n    SetSceneNameAction,\n    SetSceneAction,\n    UpdateSceneObjectAction,\n    SetActiveSceneInteractionModalAction,\n    DeductActorApAction,\n    SetCombatAction\n} from \"store/actions/quests\";\nimport { Item } from \"definitions/items/types\";\nimport { AnyAction, Reducer } from \"redux\";\nimport { QuestStatus, QuestStoreState } from \"store/types/quest\";\nimport { SceneActionType } from 'store/types/scene';\nimport { QuestDefinition } from 'definitions/quests/types';\nimport { getDefinition } from 'definitions/quests';\nimport { initialQuestVars } from 'definitions/quests/kill10Boars/questVars';\n\n// tslint:disable:object-literal-sort-keys\nconst initialState: QuestStoreState[] = [{\n    name: \"kill10Boars\",\n    status: QuestStatus.active,\n    party: [\n        \"c4a5d270\",\n        \"2e655832\",\n        \"ec6f1050\",\n        \"d299f98a\",\n    ],\n    progress: 0,\n    questVars: initialQuestVars,\n    encounterResults: [],\n    icon: \"sigil1.png\",\n}, {\n    name: \"retrieveMagicAmulet\",\n    party: [],\n    status: QuestStatus.available,\n    progress: 0,\n    questVars: {},\n    encounterResults: [],\n    icon: \"sigil2.png\",\n    reward: {\n        gold: 4,\n        items: [ Item.deedForWeaponsmith ],\n    },\n}];\n\n/**\n * reducer\n * @param state\n * @param action\n */\nexport const quests: Reducer<QuestStoreState[]> = (state: QuestStoreState[] = initialState, action: AnyAction ) => {\n    switch (action.type) {\n        case ActionType.launchQuest:\n            return launchQuest(state, action as QuestLaunchAction);\n\n        case ActionType.exitEncounter:\n            return exitEncounter(state, action as QuestAction);\n\n        case ActionType.updateQuestVars:\n            // Updates the questvars\n            return updateQuestVars(state, action as QuestVarsAction);\n\n        case ActionType.updateEncounterResult:\n            return updateEncounterResult(state, action as UpdateEncounterResultAction);\n\n        // case ActionType.startEncounter:\n        //     return startEncounter(state, action as StartEncounterAction);\n\n        case ActionType.setSceneName:\n            return setSceneName(state, action as SetSceneNameAction);\n\n        case ActionType.setScene:\n            return setScene(state, action as SetSceneAction);\n\n        case ActionType.enqueueSceneAction:\n            return enqueueSceneAction(state, action as EnqueueSceneActionAction);\n\n        case ActionType.completeSceneAction:\n            return completeSceneAction(state, action as QuestAction);\n            \n        case ActionType.setCombat:\n            return setCombat(state, action as SetCombatAction);\n\n        case ActionType.deductActorAp:\n            return deductActorAp(state, action as DeductActorApAction);\n\n        case ActionType.updateSceneObjectAction:\n            return updateSceneObjectAction(state, action as UpdateSceneObjectAction);\n\n        case ActionType.setActiveSceneInteractionModal:\n            return setActiveSceneInteractionModal(state, action as SetActiveSceneInteractionModalAction);\n\n        case GameActionType.gameTick:\n           return gameTick(state, action as GameTickAction);\n\n    }\n    return state;\n};\n\n// Launches quest. Sets state to active, assigns adventurers\nconst launchQuest = (questStoreState: QuestStoreState[], action: QuestLaunchAction) => {\n    const party = action.assignedAventurers\n        .filter((adventurer) => !!adventurer)\n        .map((adventurer) => adventurer.id);\n\n    return questStoreState.map((qss) => {\n        if (qss.name === action.questName) {\n            const questDefinition: QuestDefinition = getDefinition(action.questName);\n            const questVars = questDefinition.getInitialQuestVars(qss);\n\n            return {\n                ...qss,\n                status: QuestStatus.active,\n                party,\n                questVars\n            };\n        }\n        return qss;\n    });\n};\n\nconst exitEncounter = (state: QuestStoreState[], action: QuestAction) => {\n    return state.map((qss) => {\n        if (qss.name === action.questName) {\n            const progress = qss.progress + 1;\n            // const questDefinition: QuestDefinition = questDefinitions[qss.name];\n            // const nextNode = questDefinition.nodes[Math.floor(progress)];\n\n            return {\n                ...qss,\n                progress,\n                scene: undefined,\n                sceneName: undefined\n            };\n        }\n        return qss;\n    });\n};\n\n// const startEncounter = (state: QuestStoreState[], action: StartEncounterAction) => {\n//     const {scene} = action;\n//     return state.map((qss) => {\n//         if (qss.name === action.questName) {\n//             return {\n//                 ...qss,\n//                 scene\n//             };\n//         }\n//         return qss;\n//     });\n// };\n\n// To change scene, set scene name. The scenecontroller will load the scene data and art assets\n// and call setScene reducer\nconst setSceneName = (state: QuestStoreState[], action: SetSceneNameAction) => {\n    return state.map((qss) => {\n        if (qss.name === action.questName) {\n            return {\n                ...qss,\n                sceneName: action.sceneName,\n                scene: undefined\n            };\n        }\n        return qss;\n    });\n};\n\nconst setScene = (state: QuestStoreState[], action: SetSceneAction) => {\n    return state.map((qss) => {\n        if (qss.name === action.questName) {\n            return {\n                ...qss,\n                scene: action.scene\n            };\n        }\n        return qss;\n    });\n};\n\n// Enqueues a scene action on this quest\nconst enqueueSceneAction = (state: QuestStoreState[], action: EnqueueSceneActionAction) => {\n    return state.map((qss) => {\n        if (qss.name === action.questName) {\n            const scene = qss.scene;\n            if (!scene) throw new Error(\"Something broke. No scene\");\n            scene.actionQueue = [...scene.actionQueue || [], action.sceneAction];\n\n            return {\n                ...qss,\n                scene\n            };\n        }\n        return qss;\n    });\n};\n\n// next action on scene is completed\nconst completeSceneAction = (state: QuestStoreState[], action: QuestAction) => {\n    return state.map((qss) => {\n        if (qss.name === action.questName) {\n            const scene = qss.scene;\n            if (!scene) throw new Error(\"Something broke. No scene\");\n            const sceneAction = scene.actionQueue![0];\n            if (!sceneAction) return qss;\n\n            switch (sceneAction.actionType) {\n                case SceneActionType.move: {\n                    scene.actors = scene.actors.map((a) => {\n                        if (a.id === sceneAction.actorId) {\n                            return { ...a, location: sceneAction.target };\n                        }\n                        return a;\n                    })\n                }\n            }\n\n            // pop first action of the stack\n            scene.actionQueue = [\n                ...scene.actionQueue!.slice(1)\n            ];\n\n            return {\n                ...qss,\n                scene\n            };\n        }\n        return qss;\n    });\n};\n\n\nconst setCombat = (state: QuestStoreState[], action: SetCombatAction) => {\n    const {combat} = action;\n    return state.map((qss) => {\n        if (qss.name === action.questName) {\n            const scene = { ...qss.scene!, combat };\n            return {\n                ...qss,\n                scene\n            };\n        }\n        return qss;\n    });\n};\n\nconst deductActorAp = (state: QuestStoreState[], action: DeductActorApAction) => {\n    return state.map((qss) => {\n        if (qss.name === action.questName) {\n            const scene = qss.scene;\n            if (!scene) throw new Error(\"Something broke. No scene\");\n\n            scene.actors = scene.actors.map(a => {\n                if (a.id === action.actor) {\n                    const ap = a.ap - action.ap;\n                    return {\n                        ...a,\n                        ap\n                    };\n                }\n                return a;\n            })\n\n            return {\n                ...qss,\n                scene\n            };\n        }\n        return qss;\n    });\n}\n\nconst updateSceneObjectAction = (state: QuestStoreState[], action: UpdateSceneObjectAction) => {\n    return state.map((qss) => {\n        if (qss.name === action.questName) {\n            const scene = qss.scene;\n            if (!scene) throw new Error(\"Something broke. No scene\");\n\n            scene.objects = scene.objects.map(tO => {\n                if (tO.id === action.id) {\n                    return {\n                        ...tO,\n                        ...action.object\n                    }\n                }\n                return tO;\n            })\n\n            return {\n                ...qss,\n                scene\n            };\n        }\n        return qss;\n    });\n}\n\n\nconst gameTick = (state: QuestStoreState[], action: GameTickAction) => {\n    const questsToUpdate = action.quests;\n    if (!questsToUpdate.length) {\n        return state;\n    }\n\n    return state.map((qss) => {\n        const questToUpdate = questsToUpdate.find((q) => q.name === qss.name);\n        if (questToUpdate) {\n            const progress = questToUpdate.progress;\n            // const currentEncounter = questToUpdate.currentEncounter;\n\n            return {\n                ...qss,\n                progress,\n                // currentEncounter,\n            };\n        }\n        return qss;\n    });\n};\n\nconst updateQuestVars = (state: QuestStoreState[], action: QuestVarsAction)  => {\n    return state.map((qss) => {\n        if (qss.name === action.questName) {\n            const questVars = Object.assign({}, qss.questVars, action.vars);\n            return {\n                ...qss,\n                questVars,\n            };\n        }\n        return qss;\n    });\n};\n\nconst updateEncounterResult = (state: QuestStoreState[], action: UpdateEncounterResultAction)  => {\n    return state.map((qss: QuestStoreState) => {\n        if (qss.name === action.questName) {\n            const encounterResults = qss.encounterResults.concat();\n            encounterResults[action.nodeIndex] = action.result;\n            return {\n                ...qss,\n                encounterResults,\n            };\n        }\n        return qss;\n    });\n};\n\nconst setActiveSceneInteractionModal = (state: QuestStoreState[], action: SetActiveSceneInteractionModalAction) => {\n    return state.map((qss: QuestStoreState) => {\n        if (qss.name === action.questName && qss.scene) {\n            qss.scene.activeInteractionModal = action.sceneInteractionModal\n        }\n        return qss;\n    });\n}\n\n// const takeGoldFromCache = (state: QuestStoreState[], action: TakeGoldFromCacheAction) => {\n//     return state.map((qss: QuestStoreState) => {\n//         if (qss.name === action.questName && qss.scene) {\n//             const lootCaches = {\n//                 ...qss.scene?.caches,\n//                 [action.cacheName]: {\n//                     ...qss.scene?.caches[action.cacheName],\n//                     gold: 0\n//                 }\n//             }\n//             qss.scene.caches = lootCaches;\n//         }\n//         return qss;\n//     });\n// }\n\n// const takeItemFromCache = (state: QuestStoreState[], action: TakeItemFromCacheAction) => {\n//     return state.map((qss: QuestStoreState) => {\n//         if (qss.name === action.questName && qss.scene) {\n//             const cache = qss.scene.caches[action.cacheName];\n//             const index = cache.items.indexOf(action.item);\n//             if (index > -1 ) {\n//                 qss.scene.caches[action.cacheName].items = [\n//                     ...cache.items.slice(0, index),\n//                     ...cache.items.slice(index + 1)\n//                 ]\n//             }\n//         }\n//         return qss;\n//     });\n// }\n\n// // Call this when the quest has progressed a node. Will return either `log` or a new array\n// // with all values of `log` and a new value appended\n// const addLogMessage = (log: string[],\n//                        currentNode: QuestNode, nextNode: QuestNode, quest: QuestStoreState): string[] => {\n//     if (currentNode.type === QuestNodeType.nothing && nextNode.type === QuestNodeType.nothing) {\n//         // Moved from a 'nothing' node to a 'nothing' node\n//         // There is no need to flood the log with unimportant messages\n//         return log;\n//     }\n//     switch (nextNode.type) {\n//         case QuestNodeType.nothing:\n//             return [\n//                 ...log,\n//                 \"The party trrrudges on\",\n//             ];\n//         case QuestNodeType.encounter:\n//             const encounter = nextNode.encounter!;\n//             console.log(encounter.getDescription(oracle))\n//             //return log;\n//             return [\n//                 ...log,\n//                 encounter.getDescription(oracle),\n//             ]\n//         default:\n//             return log;\n//     }\n// }\n","import { Structure } from \"definitions/structures\";\nimport { StructureState, StructureStoreState, initialState as structureInitialState, ProductionStructureStoreState } from \"./structure\";\nimport { Item } from 'definitions/items/types';\n\nexport interface StructuresStoreState {\n    [Structure.alchemist]: ProductionStructureStoreState;\n    [Structure.armoursmith]: ProductionStructureStoreState;\n    [Structure.garden]: StructureStoreState;\n    [Structure.lumberMill]: StructureStoreState;\n    [Structure.mine]: StructureStoreState;\n    [Structure.quarry]: StructureStoreState;\n    [Structure.tavern]: StructureStoreState;\n    [Structure.tannery]: StructureStoreState;\n    [Structure.warehouse]: StructureStoreState;\n    [Structure.weaponsmith]: ProductionStructureStoreState;\n    [Structure.weaver]: StructureStoreState;\n    [Structure.workshop]: ProductionStructureStoreState;\n}\n\nexport const initialState: StructuresStoreState = {\n    [Structure.alchemist]:  { ...structureInitialState, produces: [ ] },\n    [Structure.armoursmith]: { ...structureInitialState, produces: [ Item.boots1 ] },\n    [Structure.garden]: { level: 0, workers: 0, state: StructureState.Built  }, // TODO: change back to NotBuilt\n    [Structure.lumberMill]: structureInitialState,\n    [Structure.mine]: { level: 0, workers: 0, state: StructureState.NotBuilt  },\n    [Structure.quarry]: structureInitialState,\n    [Structure.tavern]: { level: 0, workers: 0, state: StructureState.Built },\n    [Structure.tannery]: structureInitialState,\n    [Structure.warehouse]: { level: 0, workers: 0, state: StructureState.Built},\n    [Structure.weaponsmith]:  { ...structureInitialState, produces: [ Item.simpleCrossbow, Item.dagger ] },\n    [Structure.weaver]: structureInitialState,\n    [Structure.workshop]:  { ...structureInitialState, produces: [ Item.torch, Item.sandwich ] },\n};\n","import { ActionType, StructureStateAction, WorkerCountAction, AddItemToProducesAction } from \"store/actions/structures\";\nimport { Structure } from \"definitions/structures\";\nimport { AnyAction, Reducer } from \"redux\";\nimport { StructureState, StructureStoreState } from \"store/types/structure\";\nimport { initialState, StructuresStoreState } from \"store/types/structures\";\n\n/**\n * reducer\n * @param state\n * @param action\n */\nexport const structures: Reducer<StructuresStoreState, AnyAction> = (state: StructuresStoreState = initialState,\n                                                                     action: AnyAction) => {\n    switch (action.type) {\n        case ActionType.startBuildingStructure: {\n            return updateStructureState(state, action.structure, StructureState.Building);\n        }\n        case ActionType.finishBuildingStructure: {\n            return updateStructureState(state, action.structure, StructureState.Built);\n        }\n        case ActionType.upgradeStructure: {\n            const level = state[action.structure].level + 1;\n            const structureStore: StructureStoreState = {\n                ...state[action.structure],\n                level,\n            };\n            return    {\n                ...state,\n                [action.structure]: structureStore,\n            };\n        }\n        case ActionType.increaseWorkers: {\n            const { workers: workersToAdd } = action as WorkerCountAction;\n            const workers = state[action.structure].workers + workersToAdd;\n            const structureStore: StructureStoreState = {\n                ...state[action.structure],\n                workers,\n            };\n            return {\n                ...state,\n                [action.structure]: structureStore,\n            };\n        }\n        case ActionType.decreaseWorkers: {\n            const { workers: workersToRemove } = action as WorkerCountAction;\n            const workers = state[action.structure].workers - workersToRemove;\n            const structureStore: StructureStoreState = {\n                ...state[action.structure],\n                workers,\n            };\n            return {\n                ...state,\n                [action.structure]: structureStore,\n            };\n        }\n        case ActionType.setStructureState: {\n            const { state: structureState } = action as StructureStateAction;\n            return updateStructureState(state, action.structure, structureState);\n        }\n\n        case ActionType.addItemToToProduces: {\n            // Adds given item to a structures' `produces` list\n            const { item } = action as AddItemToProducesAction;\n            const produces = [...state[action.structure].produces, item];\n            const structureStore: StructureStoreState = {\n                ...state[action.structure],\n                produces,\n            };\n            return {\n                ...state,\n                [action.structure]: structureStore,\n            };\n        }\n\n    }\n    return state;\n};\n\nconst updateStructureState = (state: StructuresStoreState, structure: Structure, structureState: StructureState) => {\n    const structureStore: StructureStoreState = {\n        ...state[structure],\n        state: structureState,\n    };\n    return {\n        ...state,\n        [structure]: structureStore,\n    };\n};\n","import { TaskStoreState } from \"./task\";\n\nexport interface TasksStoreState {\n    running: TaskStoreState[];\n    completed: TaskStoreState[];\n}\nexport const initialState: TasksStoreState = {\n    completed: [],\n    running: [],\n};\n","\nimport { ActionType as GameActionType } from \"store/actions/game\";\nimport {  ActionType, AddAction} from \"store/actions/tasks\";\nimport { AnyAction, Reducer } from \"redux\";\nimport { TaskStoreState } from \"store/types/task\";\nimport { initialState, TasksStoreState } from \"store/types/tasks\";\n\n/**\n * Tasks reducer\n * @param state\n * @param action\n */\nexport const tasks: Reducer<TasksStoreState> = (state: TasksStoreState = initialState,\n                                                action: AnyAction ) => {\n    switch (action.type) {\n        case ActionType.start: {\n        // Adds a new task to the running tasks\n            const task: TaskStoreState = createTask(action as AddAction);\n            const running = state.running.concat(task);\n            return {\n                ...state,\n                running,\n            };\n        }\n        case GameActionType.gameTick: {\n            // Will update all tasks in `running`. If a running task expires it is placed in `complete`\n            // Note that completed tasks must be handled BEFORE the next call to ActionType.update, because\n            // this list is recreated every time\n            const now: number = Date.now();\n            const running: TaskStoreState[] = [];\n            const completed: TaskStoreState[] = [];\n            state.running.forEach((t) => {\n                const end = now + t.timeRemaining;\n                const progress = (now - t.startTime) / (end - t.startTime);\n                const timeRemaining = t.timeRemaining - (now - t.lastTick);\n                const task = {\n                    ...t,\n                    progress,\n                    lastTick: now,\n                    timeRemaining,\n                };\n                if (timeRemaining < 0) {\n                    completed.push(task);\n                } else {\n                    running.push(task);\n                }\n            });\n\n            return {\n                running,\n                completed,\n            };\n        }\n    }\n    return state;\n};\n\nconst createTask = (action: AddAction): TaskStoreState => {\n    return {\n        name: action.name,\n        origin: action.origin,\n        type: action.taskType,\n        callbacks: action.callbacks,\n        timeRemaining: action.time,\n        startTime: Date.now(),\n        lastTick: Date.now(),\n        progress: 0,\n    };\n};\n","import { combineReducers } from \"redux\";\nimport { StoreState } from \"store/types\"\nimport { adventurers } from \"./adventurers\";\nimport { combat } from \"./combat\";\nimport { engine } from \"./engine\";\nimport { gold } from \"./gold\";\nimport { items } from \"./items\";\nimport { log } from \"./log\";\nimport { quests } from \"./quests\";\nimport { resources } from \"./resources\";\nimport { rngState } from \"./rngState\";\nimport { structures } from \"./structures\";\nimport { tasks } from \"./tasks\";\nimport { workers } from \"./workers\";\n\nexport default combineReducers<StoreState>({\n    adventurers,\n    combat,\n    engine,\n    gold,\n    stockpile: items,\n    log,\n    quests,\n    resources,\n    rngState,\n    structures,\n    tasks,\n    workers,\n});\n","import { ActionType, AddCombatActionAction, MoveActorAction } from \"store/actions/combat\";\nimport { AnyAction, Reducer } from \"redux\";\nimport { barBrawl, CombatStoreState } from \"store/types/combat\";\n\n/**\n * reducer\n * @param state\n * @param action\n */\nexport const combat: Reducer<CombatStoreState> = (state: CombatStoreState = barBrawl, action: AnyAction) => {\n    switch (action.type) {\n        case ActionType.startCombatAction:\n            const addAction = action as AddCombatActionAction;\n\n            return {\n                ...state,\n                action: {\n                    actor: addAction.actor,\n                    endsAt: addAction.endsAt,\n                    target: addAction.target,\n                    type: addAction.combatType,\n                },\n            };\n\n        case ActionType.moveActor:\n            const moveAction = action as MoveActorAction;\n\n            // Moves an actor to another position\n            const actors = state.actors.map((a) => {\n                if (a.name === moveAction.actor) {\n                    return {\n                        ...a,\n                        location: moveAction.location,\n                    };\n                }\n                return a;\n            });\n\n            return {\n                ...state,\n                actors,\n            };\n\n            case ActionType.clearCombatAction:\n            // Clears current combat action\n            return {\n                ...state,\n                action: undefined,\n            };\n    }\n    return state;\n};\n","import { ActionType as GameActionType, GameTickAction } from \"store/actions/game\";\r\nimport { AnyAction, Reducer } from \"redux\";\r\nimport { EngineStoreState, initialState } from \"store/types/engine\";\r\n\r\n/**\r\n * reducer\r\n * @param state\r\n * @param action\r\n */\r\nexport const engine: Reducer<EngineStoreState> = (state: EngineStoreState = initialState, action: AnyAction) => {\r\n    switch (action.type) {\r\n        case GameActionType.startGame: {\r\n            return {\r\n                ...state,\r\n                gameStarted: Date.now()\r\n            };\r\n        }\r\n        case GameActionType.gameTick: {\r\n\r\n            // Keep track of the last time resources were produced\r\n            const resourcesToAdd = (action as GameTickAction).resources;\r\n            const lastProducedUpdate = resourcesToAdd === null ? state.lastProducedUpdate : Date.now();\r\n            const previousTick = state.lastTick;\r\n\r\n            return {\r\n                ...state,\r\n                previousTick,\r\n                lastProducedUpdate,\r\n                lastTick: Date.now(),\r\n            };\r\n        }\r\n    }\r\n    return state;\r\n};\r\n","import { ActionType, ModifyGoldAction } from \"store/actions/gold\";\nimport { AnyAction, Reducer } from \"redux\";\n\n/**\n * reducer\n * @param state\n * @param action\n */\nexport const gold: Reducer<number> = (state: number = 40, action: AnyAction) => {\n    switch (action.type) {\n        case ActionType.addGold:\n            // Adds (or subtract, if negative) gold from the players gold supply\n            return state + (action as ModifyGoldAction).amount;\n    }\n    return state;\n};\n","import { ActionType as GameActionType, GameTickAction } from \"store/actions/game\";\r\nimport { AnyAction, Reducer } from \"redux\";\r\nimport { ActionType, AddResources } from \"store/actions/resources\";\r\nimport { initialState, ResourceStoreState } from \"store/types/resources\";\r\n\r\n/**\r\n * reducer\r\n * @param state\r\n * @param action\r\n */\r\nexport const resources: Reducer<ResourceStoreState> = (state: ResourceStoreState = initialState,\r\n                                                       action: AnyAction | GameTickAction) => {\r\n\r\n    const addResources = (resourcesToAdd: ResourceStoreState) => {\r\n        // todo: Check if warehouse can hold it\r\n        return Object.keys(state).reduce((accumulator: object, current: string) => {\r\n            accumulator[current] = state[current] + (resourcesToAdd[current] || 0);\r\n            return accumulator;\r\n        }, {});\r\n    };\r\n\r\n    switch (action.type) {\r\n        case ActionType.addResources: {\r\n            const resourcesToAdd = (action as AddResources).resources;\r\n            return addResources(resourcesToAdd);\r\n        }\r\n        case ActionType.removeResources: {\r\n            const resourcesToRemove = (action as AddResources).resources;\r\n            return Object.keys(state).reduce((accumulator: object, current: string) => {\r\n                accumulator[current] = state[current] - (resourcesToRemove[current] || 0);\r\n                return accumulator;\r\n            }, {});\r\n        }\r\n\r\n        case GameActionType.gameTick: {\r\n            const resourcesToAdd = (action as GameTickAction).resources;\r\n            if (resourcesToAdd === null) {\r\n                return state;\r\n            }\r\n            return addResources(resourcesToAdd);\r\n        }\r\n    }\r\n    return state;\r\n};\r\n","import { ActionType } from \"store/actions/game\";\nimport { AnyAction, Reducer } from \"redux\";\nimport { State as seedrandomStateType } from \"seedrandom\";\n\nconst initialState = false;\n/**\n * reducer\n * @param state\n * @param action\n */\nexport const rngState: Reducer<seedrandomStateType, AnyAction> = (state: seedrandomStateType = initialState,\n                                                                  action: AnyAction) => {\n    if (action.type === ActionType.gameTick && action.rngState != null) {\n        state = Object.assign({}, action.rngState);\n    }\n    return state;\n};\n","import { AnyAction, Reducer } from \"redux\";\nimport { ActionType, ModifyWorkersAction } from 'store/actions';\n\n/**\n * reducer\n * @param state\n * @param action\n */\nexport const workers: Reducer<number> = (state: number = 13, action: AnyAction) => {\n    switch (action.type) {\n        case ActionType.addWorkers:\n            // Adds (or subtract, if negative) from the players workers\n            return state + (action as ModifyWorkersAction).value;\n    }\n    return state;\n};\n","import rootReducer from \"store/reducers/index\";\nimport { createStore, DeepPartial, AnyAction } from \"redux\";\nimport { Persistor, persistReducer, persistStore } from \"redux-persist\";\nimport localForage from 'localforage';\nimport { PersistPartial } from 'redux-persist/lib/persistReducer';\nimport { asInt } from \"constants/version\";\nimport { storeIsRehydrated } from 'store/helpers/storeHelpers';\nimport { StoreState } from 'store/types';\n\nconst persistConfig = {\n    key: \"root\",\n    storage: localForage,\n    version: asInt,\n};\n\nconst persistedReducer = persistReducer<StoreState, AnyAction>(persistConfig, rootReducer);\n\ninterface ConfigureStoreResult {\n    store: any;\n    persistor: Persistor;\n    isHydrated: boolean;\n}\n/**\n * Configures the redux store\n */\nexport default async (initial: DeepPartial<StoreState> = {}): Promise<ConfigureStoreResult> => {\n    return new Promise((resolve, reject) => {\n        const store = createStore<StoreState & PersistPartial, AnyAction, any, StoreState>(\n            persistedReducer,\n            initial,\n            (window as any).__REDUX_DEVTOOLS_EXTENSION__ && (window as any).__REDUX_DEVTOOLS_EXTENSION__(),\n        );\n        const persistor = persistStore(store, undefined, () => {\n            const isHydrated = storeIsRehydrated(store.getState());\n            resolve({ store, persistor, isHydrated }) ;\n        });\n    });\n};\n","import { TaskStoreState, TaskType } from 'store/types/task';\nimport { TasksStoreState } from 'store/types/tasks';\nimport { AnyAction, Dispatch } from \"redux\";\nimport { ToastManager } from 'global/ToastManager';\nimport { TextManager } from 'global/TextManager';\nimport { Type } from 'components/ui/toasts/Toast';\nimport { getDefinition } from 'definitions/items';\nimport { Item } from 'definitions/items/types';\n\nexport const processCompletedTasks = (tasks: TasksStoreState, dispatch: Dispatch<AnyAction>) => {\n    const handleCompletedTask = (task: TaskStoreState) => {\n        // Fire all callbacks\n        task.callbacks.forEach((action) => dispatch(action));\n\n        switch (task.type) {\n            case TaskType.craftItem:\n                const item = task.name as Item;\n                const title = TextManager.get(\"common-item-crafted\", { item });\n                const definition = getDefinition(item);\n                ToastManager.addToast(title, Type.itemCrafted, definition.iconImg);\n                break;\n        }\n    };\n\n    tasks.completed.forEach((task) => handleCompletedTask(task));\n};","export interface TextEntry {\r\n    key: string;\r\n    context?: any;\r\n}\r\n\r\nexport function isTextEntry(test: any): test is TextEntry {\r\n    return typeof test.key === 'string';\r\n}","import { Store, AnyAction } from \"redux\";\nimport { getExtendedTilemapObjects, ExtendedTiledObjectData, addAllTilesInLayerToList, locationEquals, TiledObjectType } from 'utils/tilemap';\nimport { StoreState } from 'store/types';\nimport { loadResource, loadResourceAsync } from 'utils/pixiJs';\nimport { TiledMapData } from 'constants/tiledMapData';\nimport { AStarFinder } from 'astar-typescript';\nimport { AdventurerStoreState } from 'store/types/adventurer';\nimport { setScene, setSceneName, exitEncounter, enqueueSceneAction, deductActorAp } from 'store/actions/quests';\nimport { SceneObject, ActorObject, LootCache, SceneActionType, SceneAction } from 'store/types/scene';\nimport { ToastManager } from 'global/ToastManager';\nimport { Type } from 'components/ui/toasts/Toast';\nimport { getQuestLink } from 'utils/routing';\nimport { TextEntry, isTextEntry } from 'constants/text';\nimport { TextManager } from 'global/TextManager';\nimport { addLogText, addLogEntry } from 'store/actions/log';\nimport { getDefinition } from 'definitions/quests';\nimport { LogChannel } from 'store/types/logEntry';\nimport { addGold } from 'store/actions/gold';\nimport { addItemToInventory } from 'store/actions/adventurers';\nimport { calculateInitialAp } from './actionPoints';\nimport { adventurersOnQuest } from 'store/helpers/storeHelpers';\n\n/**\n * This is a type of God class that knows pretty much everything about a scene\n */\nexport class BaseSceneController<TQuestVars> {\n\n    public mapData?: TiledMapData;\n    public aStar?: AStarFinder;\n    public questName: string;\n    public tilemapObjects?: {[location: string]: ExtendedTiledObjectData};\n\n    protected jsonPath?: string;\n    protected store: Store<StoreState, AnyAction>;\n    protected blockedTiles: [number, number][] = [];\n\n    protected spritesheetsMap: {[key: string]: PIXI.Spritesheet} = {} // Various spritesheets, e.g for actors\n\n    constructor(store: Store<StoreState, AnyAction>, questName: string) {\n        this.store = store;\n        this.questName = questName;\n    }\n\n    get basePath(): string | null {\n        if (!this.jsonPath) return null;\n        return `${process.env.PUBLIC_URL}/${this.jsonPath.substr(0, this.jsonPath.lastIndexOf('/'))}`;\n    }\n\n    get dataLoaded(): boolean {\n        return !!this.mapData;\n    }\n\n    // Loads tiles from json, loads all scene assets\n    loadData(callback: () => void) {\n        if (this.dataLoaded) {\n            return callback();\n        }\n        if (!this.jsonPath) {\n            throw new Error(\"No jsonPath defined!\");\n        }\n\n        loadResource(`${process.env.PUBLIC_URL}/${this.jsonPath}`, async (resource) => {\n            this.mapData = resource.data;\n            this.tilemapObjects = getExtendedTilemapObjects(resource.data);\n            this.mapData!.layers.filter(layer => layer.visible).forEach(layer => {\n                if (layer.properties && layer.properties.some(p => p.name === 'blocksMovement' && p.value === true)){\n                    addAllTilesInLayerToList(this.blockedTiles, layer, layer.width);\n                }\n            });\n\n\n            const adventurers = this.getAdventurers();\n            const spritesheets = Array.from(new Set<string>(adventurers.map(a => a.spritesheetPath)));\n\n            for(const path of spritesheets) {\n                const {spritesheet} = await loadResourceAsync(path);\n                this.spritesheetsMap[path] = spritesheet!;\n\n                // Object.keys(spritesheet!.textures).forEach((key: string) => {\n                //     Texture.removeFromCache(spritesheet!.textures[key]); //or just 'key' will work in that case\n                //     // baseTex = spaceship.textures[key].baseTexture; //they all have same base texture\n                // });\n                // console.log('done loading ', path, spritesheet)\n            }\n            // PIXI.utils.clearTextureCache()\n            // Create aStar based on blocked tiles\n            this.aStar = this.createAStar();\n\n            callback();\n        });\n    }\n\n    // Constructs the scene and dispatches it to be saved to the store\n    createScene() {\n        const objects = this.createObjects();\n        const actors = this.createActors();\n        const combat = true;\n\n        // todo: perhaps this should be a class such that stuff that repeats for every scene can be done in a base class\n        const scene = {\n            objects,\n            actors,\n            combat\n        }\n        this.store.dispatch(setScene(this.questName, scene));\n    }\n\n    sceneEntered() {\n        // tslint:disable-next-line: no-empty\n    }\n\n    // Convenience function returns an object with tileWidth and tileHeight properties\n    getTileDimensions() {\n        return {\n            tileWidth: this.mapData?.tilewidth || 0,\n            tileHeight: this.mapData?.tileheight || 0\n        }\n    }\n\n    getActorSpritesheet(actorId: string): PIXI.Spritesheet {\n        // todo: what about the non-adventurer actors (e.g the enemies)\n        const path = this.getActorSpritesheetPath(actorId);\n        return this.spritesheetsMap[path];\n    }\n\n    getActorSpritesheetPath(actorId: string): string {\n        // todo: what about the non-adventurer actors (e.g the enemies)\n        const adventurers = this.getAdventurers();\n        const adventurer = adventurers.find(a => a.id === actorId)!;\n        return adventurer.spritesheetPath;\n    }\n\n    actorMoved(actor: string, location: [number, number]) {\n        const object = this.tilemapObjects![`${location[0]},${location[1]}`];\n        if (!object) return;\n\n        if (object.type === \"exit\") {\n            // We've hit the exit. Should we load another scene?\n            if (object.ezProps?.loadScene) {\n                this.store.dispatch(setSceneName(this.questName, object.ezProps.loadScene))\n            } else {\n                // Or exit the encounter\n                const index = Math.floor(this.quest.progress) + 1;\n                const definition = getDefinition(this.questName);\n                const node = definition.nodes[index];\n                if (node.log) {\n                    // If the next node has a log entry, add it\n                    this.store.dispatch(addLogText(node.log, null, LogChannel.quest, this.questName));\n                }\n                this.store.dispatch(exitEncounter(this.questName));\n            }\n        }\n    }\n\n    actorCanInteract(actorId: string) {\n        const {scene} = this.quest;\n        const actor = scene?.actors.find(o => o.id === actorId)!;\n        const object = this.tilemapObjects?.[`${actor.location[0]},${actor.location[1]}`];\n\n        // todo: should we look for some specific property?\n        return object && object.ezProps?.interactive;\n    }\n\n    actorInteract(actorId: string) {\n        if (!this.actorCanInteract(actorId)) {\n            // tslint:disable-next-line: no-console\n            console.warn(\"Can't interact\");\n            return;\n        }\n        const {scene} = this.quest;\n        const actor = scene?.actors.find(o => o.id === actorId)!;\n        const object = scene?.objects\n            .find(o => locationEquals(o.location, actor.location));\n\n        if (!object) {\n            // tslint:disable-next-line: no-console\n            console.warn(\"No object found\");\n            return;\n        }\n\n        this.interactWithObject(actor, object);\n    }\n\n    actorAttemptAction(actorId: string, type: SceneActionType, destination: [number, number]) {\n        // Tries to perform action on given actor\n\n        const actor = this.getSceneActor(actorId);\n        const {location} = actor;\n\n        switch (type) {\n            case SceneActionType.move: {\n                // Find path to move using aStar\n                const path = this.findPath(location!, destination);\n\n                if (this.combat) {\n                    const remaining = actor.ap || -1;\n                    if (remaining < (path?.length || 0)) {\n                        // return;\n                    }\n                    // this.dispatch(deductActorAp(this.questName, actorId, path?.length || 0));\n                }\n\n                const movementDuration = 500; // time every tile movement takes\n                path?.forEach((l, index) => {\n                    const sceneAction: SceneAction = {\n                        actionType: SceneActionType.move,\n                        actorId,\n                        target: l as [number, number],\n                        endsAt: movementDuration * (index + 1) + performance.now()\n                    };\n                    this.dispatch(enqueueSceneAction(this.questName, sceneAction));\n                });\n                break;\n            }\n            case SceneActionType.slash: {\n                // Find path to move towards the target\n                const path = this.findPath(location!, destination);\n                const target = path?.pop();\n                if (!path || !target) {\n                    // No path possible.. cant do anything now\n                    return;\n                }\n\n                // Walk towards the target\n                const movementDuration = 500; // time every tile movement takes\n                path?.forEach((l, index) => {\n                    const moveAction: SceneAction = {\n                        actionType: SceneActionType.move,\n                        actorId,\n                        target: l as [number, number],\n                        endsAt: movementDuration * (index + 1) + performance.now()\n                    };\n                    this.dispatch(enqueueSceneAction(this.questName, moveAction));\n                });\n                const meleeAction: SceneAction = {\n                    actionType: type,\n                    actorId,\n                    target,\n                    endsAt: movementDuration * (path.length + 1) + performance.now()\n                };\n                this.dispatch(enqueueSceneAction(this.questName, meleeAction));\n                // this.dispatch(deductActorAp(this.questName, actorId, path?.length || 0));\n            }\n        }\n\n\n    }\n\n    interactWithObject(_actor: ActorObject, _object: SceneObject) {\n        // override\n    }\n\n    // Converts pixel coordinate to scene location\n    pointToSceneLocation (point: PIXI.Point): [number, number] {\n        if (!this.mapData?.tilewidth || !this.mapData?.tileheight) {\n            return [0, 0];\n        }\n        return [Math.floor(point.x / this.mapData.tilewidth), Math.floor(point.y / this.mapData.tilewidth)];\n    }\n\n    // Returns true if the tile is blocked\n    locationIsBlocked(location: [number, number]){\n        return this.blockedTiles.some((l) => locationEquals(l, location));\n    }\n\n    // Returns true\n    locationIsOutOfBounds(location: [number, number]){\n        return location[0] < 0 || location[1] < 0 ||\n            location[0] >= this.mapData!.width ||\n            location[1] >= this.mapData!.height;\n    }\n\n    // Should be overridden\n    getLootCache(name: string): LootCache | undefined {\n        // Override this to retrieve LootCache from questvars\n        return;\n    }\n\n    takeGoldFromCache(name: string) {\n        // Override this to remove gold from questvars\n        const lootCache = this.getLootCache(name);\n        if (lootCache){\n            this.store.dispatch(addGold(lootCache.gold || 0));\n        }\n    }\n\n    takeItemFromCache(itemIndex: number, name: string, adventurer: AdventurerStoreState, toSlot?: number) {\n        // Override this to remove items from questvars\n        const lootCache = this.getLootCache(name);\n        if (!lootCache) return;\n\n        const item = lootCache.items[itemIndex];\n        this.store.dispatch(addItemToInventory(adventurer.id, item, toSlot))\n    }\n\n    getSituation(situation: string, adventurerId?: string) : { title: string, choices: string[]} | undefined {\n         return undefined;\n    }\n\n    handleSituationOptionClick(situation: string, option: string) {\n        // @ts-ignore\n    }\n\n    /**\n     * Returns a path from two locations on the map\n     * @param origin\n     * @param target\n     */\n    findPath(origin: [number, number], target: [number, number]) {\n        // This is the format AStarFind works with\n        const convertIn = (l: [number, number]) => ({ x: l[0], y: l[1] });\n        const convertOut = (input: number[]): [number, number] => [input[0], input[1]];\n\n        return this\n            .aStar?.findPath(convertIn(origin), convertIn(target))\n            .map(convertOut);\n    }\n\n    /**\n     * Calculates the AP costs to walk\n     */\n    calculateWalkApCosts(from: [number, number], to: [number, number]) {\n        return this.findPath(from, to)?.length || 0;\n    }\n\n    getActorByAdventurerId(adventurerId: string) {\n        const { scene } = this.quest;\n        return scene?.actors.find(a => a.id === adventurerId);\n    }\n\n    protected createAStar() {\n        const matrix: number[][] = [];\n        for (let y = 0; y < this.mapData!.height; y++) {\n            const row: number[] = [];\n            for (let x = 0; x < this.mapData!.width; x++) {\n                const location: [number, number] = [x, y];\n                const blocked = this.locationIsBlocked(location);\n                row.push(blocked ? 1 : 0);\n            }\n            matrix.push(row);\n        }\n        return new AStarFinder({\n            grid: {\n                matrix\n            },\n            includeStartNode: false,\n            heuristic: \"Manhattan\",\n            weight: 0.2,\n        });\n    }\n\n    protected createActors(): ActorObject[] {\n\n        // todo: add the baddies\n        if (!this.tilemapObjects) {\n            throw new Error(\"No tilemapObjects\");\n        }\n\n        const adventurers = this.getAdventurers();\n\n        const startLocations = Object.values(this.tilemapObjects)\n            .filter(o => o.type === \"adventurerStart\")\n            .map(o => o.location);\n        if (adventurers.length > startLocations.length) {\n            throw new Error(\"Not enough objects with 'adventurerStart' property set to true\");\n        }\n        return adventurers.reduce((acc: ActorObject[], value: AdventurerStoreState, index: number) => {\n            const location = startLocations[index];\n            const ap = calculateInitialAp(value);\n            acc.push({\n                location,\n                id: value.id,\n                ap\n            });\n            return acc;\n        }, []);\n    }\n\n    // These objects are saved in store\n    protected createObjects(): SceneObject[] {\n        if (!this.tilemapObjects) {\n            throw new Error(\"No tilemapObjects\");\n        }\n\n        return Object.values(this.tilemapObjects)\n            .map(o => this.createObject(o))\n            .filter((o): o is SceneObject => o !== null);   // filter out null values\n    }\n\n    protected createObject(config: ExtendedTiledObjectData): SceneObject | null {\n        switch (config.type) {\n            case TiledObjectType.adventurerStart:\n            case TiledObjectType.exit:\n                return null;\n            default:\n                return config;\n        }\n    }\n\n    // protected createCaches(): { [name: string]: LootCache } {\n    //     return Object.values(this.tilemapObjects!)\n    //         .filter(o => o.type === \"lootCache\")\n    //         .reduce((acc: { [name: string]: LootCache }, value) => {\n    //             // serialize comma separated string to array of Item\n    //             const items = value.ezProps?.items?.split(\",\").map((v:string) => {\n    //                 const item = Item[v.trim()];\n    //                 if (item) {\n    //                     return item;\n    //                 }\n    //             }).filter(Boolean);\n    //             acc[value.name] = {\n    //                 title: value.ezProps?.title,\n    //                 items\n    //             }\n    //             return acc;\n    //         }, {});\n    // }\n\n    // Quest\n    protected get quest() {\n        const storeState = this.store.getState();\n        return storeState.quests.find(q => q.name === this.questName)!;\n    }\n\n    protected get questVars(): TQuestVars {\n        return this.quest.questVars;\n    }\n\n    // Scene\n    protected get combat() {\n        return !!this.quest.scene?.combat;\n    }\n\n    protected get sceneActors() {\n        return this.quest.scene?.actors || [];\n    }\n\n    protected getSceneActor(actorId: string) {\n        return this.sceneActors.find(sA => sA.id === actorId)!;\n    }\n\n    protected getAdventurers(): AdventurerStoreState[] {\n        const storeState = this.store.getState();\n        return adventurersOnQuest(storeState.adventurers, this.quest);\n    }\n\n    protected getAdventurerByActor(actor: ActorObject) {\n        const storeState = this.store.getState();\n        return storeState.adventurers.find(a => a.id === actor.id);\n    }\n\n    protected questUpdate(input: string | TextEntry, icon?: string, toast: boolean = false) : void {\n        const textEntry: TextEntry = isTextEntry(input) ? input : {key: input};\n        const title = TextManager.getTextEntry(textEntry);\n        if (toast) {\n            ToastManager.addToast(title, Type.questUpdate, icon, getQuestLink(this.questName));\n        }\n        this.dispatch(addLogEntry(textEntry, LogChannel.quest, this.questName));\n    }\n\n    // Store\n    protected dispatch(action: AnyAction) {\n        this.store.dispatch(action)\n    }\n\n}\n","import { AdventurerStoreState } from 'store/types/adventurer';\n\nexport function calculateInitialAp(adventurer: AdventurerStoreState): number {\n    return adventurer.baseAP;\n}","import { BaseSceneController } from 'mechanics/scenes/BaseSceneController';\nimport { SceneControllerManager } from 'global/SceneControllerManager';\nimport { SceneObject, ActorObject, LootCache } from 'store/types/scene';\nimport { updateSceneObject, setActiveSceneInteractionModal, updateQuestVars } from 'store/actions/quests';\nimport { Kill10BoarsQuestVars } from '../questVars';\nimport { AdventurerStoreState } from 'store/types/adventurer';\n// tslint:disable: max-classes-per-file\n\nconst TILE_CHEST_CLOSED = 33; // todo: take this from json?\nconst TILE_CHEST_OPEN = 34; // todo: take this from json?\n\nexport class DungeonEntranceSceneController extends BaseSceneController<Kill10BoarsQuestVars> {\n    jsonPath = \"scenes/ork-dungeon-level1.json\";\n\n    interactWithObject(actor: ActorObject, object: SceneObject) {\n        switch (object.name) {\n            // todo: I want to share this common stuff with other SceneControllers\n            case \"chest\":\n                if (object.gid === TILE_CHEST_CLOSED) {\n                    const adventurer = this.getAdventurerByActor(actor)?.name;\n                    const textEntry = { key: \"quest-common-adventurer-opened-chest\", context: { adventurer } };\n                    this.questUpdate(textEntry, \"/img/items/misc/chest-02.png\");\n                    this.store.dispatch(updateSceneObject(this.questName, object.id, { gid: TILE_CHEST_OPEN }));\n                }\n                // display loot modal!\n                this.store.dispatch(setActiveSceneInteractionModal(this.questName, {\n                    type: 'lootCache',\n                    lootCache: object.name\n                }));\n                break;\n\n            case \"altar\":\n                this.store.dispatch(setActiveSceneInteractionModal(this.questName, {\n                    type: 'situation',\n                    situation: 'altar'\n                }));\n                break;\n        }\n        super.interactWithObject(actor, object);\n    }\n\n    sceneEntered() {\n        if (!this.questVars.dungeon.entered) {\n            this.questUpdate(\"quest-kill10-boars-enter-dungeon-see-chest\");\n        }\n    }\n\n    getLootCache(name: string): LootCache | undefined {\n        return this.questVars.dungeon.lootCaches[name];\n    }\n\n    takeGoldFromCache(name: string) {\n        super.takeGoldFromCache(name);  // first add gold to inventory\n        const lootCache = this.getLootCache(name);\n        if (lootCache){\n            const questVars = this.questVars;\n            questVars.dungeon.lootCaches[name].gold = 0;\n            this.store.dispatch(updateQuestVars(this.questName, questVars));\n        }\n    }\n\n    takeItemFromCache(itemIndex: number, name: string, adventurer: AdventurerStoreState, toSlot?: number) {\n        super.takeItemFromCache(itemIndex, name, adventurer, toSlot);\n        const lootCache = this.getLootCache(name);\n        if (lootCache){\n            const questVars = this.questVars;\n            const items = questVars.dungeon.lootCaches[name].items.filter((_: any, index: number) => index !== itemIndex);\n            questVars.dungeon.lootCaches[name].items = items;\n            this.store.dispatch(updateQuestVars(this.questName, questVars));\n        }\n    }\n\n    getSituation(situation: string, adventurerId?: string) {\n        switch (situation) {\n            case 'altar':\n                const questVars = this.questVars;\n                if (questVars.dungeon.situations.altar.candleLit) {\n                    return {\n                        title: 'quest-kill10-boars-dungeonentrance-altar',\n                        choices: [\n                            \"quest-kill10-boars-dungeonentrance-altar-rummagedrawers\"\n                        ]\n                    }\n                }\n                return {\n                    title: 'quest-kill10-boars-dungeonentrance-altar',\n                    choices: [\n                        \"quest-kill10-boars-dungeonentrance-altar-lightcandle\",\n                        \"quest-kill10-boars-dungeonentrance-altar-rummagedrawers\"\n                    ]\n                }\n                default:\n                    return super.getSituation(situation, adventurerId);\n        }\n    }\n\n    handleSituationOptionClick(situation: string, option: string) {\n        // @ts-ignore\n        switch (situation) {\n            case 'altar': {\n                switch (option) {\n                    case 'quest-kill10-boars-dungeonentrance-altar-lightcandle':\n                        const questVars = this.questVars;\n                        questVars.dungeon.situations.altar.candleLit = true;\n                        this.store.dispatch(updateQuestVars(this.questName, questVars));\n                        break;\n\n                    case 'quest-kill10-boars-dungeonentrance-altar-rummagedrawers':\n                        // display loot modal!\n                        this.store.dispatch(setActiveSceneInteractionModal(this.questName, {\n                            type: 'lootCache',\n                            lootCache: 'altar'\n                        }));\n                        break;\n                }\n            }\n        }\n    }\n}\n\nexport class DungeonHallwaySceneController extends BaseSceneController<Kill10BoarsQuestVars> {\n    jsonPath = \"scenes/ork-dungeon-level2.json\";\n}\n\nSceneControllerManager.registerSceneController(\"kill10Boars\", \"dungeon.entrance\", DungeonEntranceSceneController as any);\nSceneControllerManager.registerSceneController(\"kill10Boars\", \"dungeon.hallway\", DungeonHallwaySceneController as any);\n"],"sourceRoot":""}