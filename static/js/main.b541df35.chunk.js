(this["webpackJsonpgilles-game"]=this["webpackJsonpgilles-game"]||[]).push([[0],{101:function(e,t,n){},104:function(e,t,n){},113:function(e){e.exports=JSON.parse('{"alchemist":[{"shape":[34,18,31,1,37,0]},{"shape":[37,0,53,5,45,17]},{"shape":[45,17,68,27,81,48]},{"shape":[72,67,75,168,11,168]},{"shape":[9,65,1,45,10,30]},{"shape":[31,19,29,5,45,0]},{"shape":[45,0,34,18,37,0]},{"shape":[45,17,81,48,72,67]},{"shape":[72,67,11,168,9,65]},{"shape":[9,65,10,30,31,19]},{"shape":[45,17,72,67,9,65]},{"shape":[9,65,31,19,45,0]},{"shape":[37,0,45,17,9,65]}],"garden":[{"shape":[48,45,48,0,58,0]},{"shape":[57,41,75,56,73,78]},{"shape":[73,78,11,68,2,56]},{"shape":[2,56,13,45,48,45]},{"shape":[48,45,58,0,57,41]},{"shape":[73,78,2,56,48,45]},{"shape":[48,45,57,41,73,78]}],"armoursmith":[{"shape":[53,1,55,0,93,5]},{"shape":[93,5,112,11,120,20]},{"shape":[120,20,124,36,119,49]},{"shape":[119,49,122,156,75,149]},{"shape":[75,149,57,135,33,104]},{"shape":[33,104,10,95,11,52]},{"shape":[11,52,0,35,2,20]},{"shape":[2,20,6,14,27,5]},{"shape":[27,5,53,1,93,5]},{"shape":[93,5,120,20,119,49]},{"shape":[119,49,75,149,33,104]},{"shape":[33,104,11,52,2,20]},{"shape":[2,20,27,5,93,5]},{"shape":[93,5,119,49,33,104]},{"shape":[33,104,2,20,93,5]}],"lumberMill":[{"shape":[32,11,43,1,45,0]},{"shape":[45,0,49,4,37,18]},{"shape":[39,29,50,44,49,48]},{"shape":[38,46,38,230,17,233]},{"shape":[17,233,13,232,13,48]},{"shape":[13,48,3,48,14,28]},{"shape":[14,28,1,7,6,4]},{"shape":[31,18,32,11,45,0]},{"shape":[39,29,49,48,40,43]},{"shape":[38,46,17,233,13,48]},{"shape":[14,28,6,4,19,18]},{"shape":[31,18,45,0,37,18]},{"shape":[37,18,39,29,40,43]},{"shape":[40,43,38,46,13,48]},{"shape":[13,48,14,28,19,18]},{"shape":[31,18,37,18,40,43]},{"shape":[40,43,13,48,19,18]},{"shape":[19,18,31,18,40,43]}],"mine":[{"shape":[15,0,79,1,88,13]},{"shape":[88,13,78,66,27,70]},{"shape":[27,70,2,50,11,27]},{"shape":[11,27,6,13,15,0]},{"shape":[15,0,88,13,27,70]},{"shape":[27,70,11,27,15,0]}],"quarry":[{"shape":[2,24,20,2,22,0]},{"shape":[22,0,103,2,117,15]},{"shape":[117,15,124,24,112,24]},{"shape":[112,24,112,64,104,70]},{"shape":[104,70,104,89,97,88]},{"shape":[97,68,66,67,60,43]},{"shape":[60,43,17,42,17,26]},{"shape":[17,26,2,24,22,0]},{"shape":[22,0,117,15,112,24]},{"shape":[112,24,104,70,97,88]},{"shape":[60,43,17,26,22,0]},{"shape":[112,24,97,88,97,68]},{"shape":[97,68,60,43,22,0]},{"shape":[22,0,112,24,97,68]}],"tannery":[{"shape":[4,2,4,0,61,1]},{"shape":[59,36,89,37,85,79]},{"shape":[85,79,15,77,15,47]},{"shape":[15,47,5,35,0,9]},{"shape":[0,9,4,2,61,1]},{"shape":[59,36,85,79,15,47]},{"shape":[15,47,0,9,61,1]},{"shape":[61,1,59,36,15,47]}],"tavern":[{"shape":[110,27,108,24,112,23]},{"shape":[112,23,151,27,148,60]},{"shape":[148,60,137,71,133,67]},{"shape":[133,67,136,69,132,75]},{"shape":[132,75,137,77,138,124]},{"shape":[131,131,136,136,55,119]},{"shape":[29,64,6,72,0,69]},{"shape":[27,56,76,61,85,67]},{"shape":[101,25,108,13,112,17]},{"shape":[112,17,102,18,104,6]},{"shape":[110,27,112,23,148,60]},{"shape":[132,75,138,124,131,131]},{"shape":[131,131,55,119,59,118]},{"shape":[29,64,0,69,27,56]},{"shape":[112,17,104,6,111,9]},{"shape":[92,27,110,27,148,60]},{"shape":[132,75,131,131,59,118]},{"shape":[50,68,29,64,27,56]},{"shape":[92,27,148,60,133,67]},{"shape":[133,67,132,75,59,118]},{"shape":[50,68,27,56,85,67]},{"shape":[133,67,59,118,56,72]},{"shape":[56,72,50,68,85,67]},{"shape":[133,67,56,72,85,67]},{"shape":[133,67,85,67,89,60]},{"shape":[92,27,133,67,89,60]},{"shape":[92,27,89,60,86,25]},{"shape":[104,0,92,27,86,25]}],"warehouse":[{"shape":[36,414,3,409,2,13]},{"shape":[2,13,31,-7,63,7]},{"shape":[62,197,63,126,65,218]},{"shape":[61,262,83,272,84,459]},{"shape":[84,459,36,414,2,13]},{"shape":[2,13,63,7,62,197]},{"shape":[62,197,65,218,61,262]},{"shape":[61,262,84,459,2,13]},{"shape":[2,13,62,197,61,262]}],"weaponsmith":[{"shape":[52,18,50,2,50,0]},{"shape":[50,0,114,1,109,49]},{"shape":[109,49,115,132,98,129]},{"shape":[98,129,66,95,65,34]},{"shape":[11,33,11,77,0,77]},{"shape":[0,29,18,18,52,18]},{"shape":[52,18,50,0,109,49]},{"shape":[109,49,98,129,65,34]},{"shape":[11,33,0,77,0,29]},{"shape":[52,18,109,49,65,34]},{"shape":[15,27,11,33,0,29]},{"shape":[52,18,65,34,53,26]},{"shape":[15,27,0,29,52,18]},{"shape":[52,18,53,26,15,27]}],"weaver":[{"shape":[51,41,54,0,55,6]},{"shape":[55,41,82,53,87,63]},{"shape":[87,63,86,259,62,254]},{"shape":[62,254,23,212,21,61]},{"shape":[21,61,2,56,51,41]},{"shape":[51,41,55,6,55,41]},{"shape":[55,41,87,63,62,254]},{"shape":[62,254,21,61,51,41]},{"shape":[51,41,55,41,62,254]}],"workshop":[{"shape":[11,2,13,0,68,3]},{"shape":[68,3,77,12,70,14]},{"shape":[70,14,69,38,10,37]},{"shape":[9,13,1,12,11,2]},{"shape":[11,2,68,3,70,14]},{"shape":[70,14,10,37,9,13]},{"shape":[9,13,11,2,70,14]}]}')},114:function(e){e.exports=JSON.parse('{"alpha":{"start":0.25,"end":0},"scale":{"start":0.04,"end":0.29,"minimumScaleMultiplier":1},"color":{"start":"#85888d","end":"#100f0c"},"speed":{"start":100,"end":200,"minimumSpeedMultiplier":1},"acceleration":{"x":10,"y":-30},"maxSpeed":200,"startRotation":{"min":265,"max":270},"noRotation":false,"rotationSpeed":{"min":8,"max":0},"lifetime":{"min":0.5,"max":3.05},"blendMode":"normal","frequency":0.0005,"emitterLifetime":-1,"maxParticles":300,"pos":{"x":0,"y":0},"addAtBack":true,"spawnType":"point"}')},123:function(e,t,n){e.exports=n(251)},172:function(e,t,n){},173:function(e,t,n){},195:function(e,t){},201:function(e,t,n){},202:function(e,t,n){},203:function(e,t,n){},204:function(e,t,n){},205:function(e,t,n){},206:function(e,t,n){},208:function(e,t,n){},209:function(e,t,n){},210:function(e,t,n){},211:function(e,t,n){},212:function(e,t,n){},213:function(e,t,n){},214:function(e,t,n){},215:function(e,t,n){},216:function(e,t,n){},217:function(e,t,n){},218:function(e,t,n){},219:function(e,t,n){},229:function(e,t,n){},230:function(e,t,n){},231:function(e,t,n){},232:function(e,t,n){},233:function(e,t,n){},234:function(e,t,n){},235:function(e,t,n){},243:function(e,t){},244:function(e,t,n){},245:function(e,t,n){},246:function(e,t,n){},248:function(e,t,n){},251:function(e,t,n){"use strict";n.r(t);var a,r,o,c=n(14),i=n(29),s=n.n(i),u=n(41),l=n(105),m=n.n(l);!function(e){e.clearCombatAction="clearCombatAction",e.startCombatAction="startCombatAction",e.moveActor="moveActor"}(a||(a={})),function(e){e[e.player=0]="player",e[e.enemy=1]="enemy"}(r||(r={})),function(e){e.move="move",e.slash="slash",e.shoot="shoot"}(o||(o={}));var d,p,h,g={actors:[{allegiance:r.player,health:100,location:[3,5],name:"c4a5d270",remainingAP:5},{allegiance:r.player,health:100,location:[4,6],name:"2e655832",remainingAP:4}],turn:r.player},f=function(e,t){var n,c,i=t.getState().combat;if(i.action&&i.action.endsAt<Date.now())if(i.turn===r.enemy);else if(i.turn===r.player){switch(i.action.type){case o.move:t.dispatch((n=i.action.actor,c=i.action.target,{type:a.moveActor,actor:n,location:c})),t.dispatch({type:a.clearCombatAction})}return{action:null}}return null},v=n(0),b=n.n(v),y=n(53),w=n(4);function E(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:p.common,a=arguments.length>3?arguments[3]:void 0;return{type:h.addLogEntry,key:e,channel:n,channelContext:a,context:t}}!function(e){e.gameTick="gameTick"}(d||(d={})),function(e){e[e.common=0]="common",e[e.town=1]="town",e[e.quest=2]="quest"}(p||(p={})),function(e){e.addLogEntry="addLogEntry"}(h||(h={}));var k,O,T,j=function(e){var t=e.split(".").map((function(e){return Number(e)}));if(3!==t.length)throw new Error("Received invalid version string: ".concat(e));t.forEach((function(e){if(e>=1024)throw new Error("Version string invalid, ".concat(e," is too large"))}));for(var n=0,a=0;a<3;a++)n|=t[a]<<10*a;return n}("0.0.4"),I=n(1),x=n(6),N=(n(43),n(5));!function(e){e[e.deed=0]="deed",e[e.apparel=1]="apparel",e[e.material=2]="material",e[e.questItem=3]="questItem",e[e.trinket=4]="trinket",e[e.weapon=5]="weapon"}(k||(k={})),function(e){e.deedForLumbermill="deedForLumbermill",e.deedForWeaponsmith="deedForWeaponsmith",e.boots1="boots1",e.boots2="boots2",e.boots3="boots3",e.chainmailHood="chainmailHood",e.chest="chest",e.clothGloves="clothGloves",e.cowl="cowl",e.fedora="fedora",e.druidChest="druidChest",e.druidFeet="druidFeet",e.druidHands="druidHands",e.druidHead="druidHead",e.druidLegs="druidLegs",e.greaves1="greaves1",e.greaves2="greaves2",e.hornedHelmet="hornedHelmet",e.leatherGloves="leatherGloves",e.nomadHelmet="nomadHelmet",e.pants1="pants1",e.pants2="pants2",e.plateChest1="plateChest1",e.plateChest2="plateChest2",e.plateChest3="plateChest3",e.plateChest4="plateChest4",e.plateGloves1="plateGloves1",e.plateGloves2="plateGloves2",e.plateHelmet="plateHelmet",e.platePants="platePants",e.plateShoulders1="plateShoulders1",e.plateShoulders2="plateShoulders2",e.robe="robe",e.shoulders1="shoulders1",e.shoulders2="shoulders2",e.shoulders3="shoulders3",e.vest="vest",e.arrowheads="arrowheads",e.bolts="bolts",e.buckle="buckle",e.chain="chain",e.cogs="cogs",e.gem="gem",e.gunpowder="gunpowder",e.ingot="ingot",e.nails="nails",e.poisonVial="poisonVial",e.ribbon="ribbon",e.rope="rope",e.scales="scales",e.spring="spring",e.thread="thread",e.blueprints="blueprints",e.crate="crate",e.dragonEye="dragonEye",e.dynamite="dynamite",e.eye="eye",e.feather="feather",e.food="food",e.heart="heart",e.horn="horn",e.key="key",e.letters="letters",e.lockPicks="lockPicks",e.oil="oil",e.orcFinger="orcFinger",e.plans="plans",e.purpleGems="purpleGems",e.runestone="runestone",e.sandwich="sandwich",e.teeth="teeth",e.tooth="tooth",e.torch="torch",e.tusk="tusk",e.vase="vase",e.vial="vial",e.weeds="weeds",e.ring="ring",e.magicAmulet="magicAmulet",e.battleAxe="battleAxe",e.brassKnuckles="brassKnuckles",e.cleaver="cleaver",e.club="club",e.crossbow="crossbow",e.dagger="dagger",e.flail="flail",e.greatswordOfGwai="greatswordOfGwai",e.khopesh="khopesh",e.longbow="longbow",e.mace="mace",e.morningStar="morningStar",e.poisonedDagger="poisonedDagger",e.ravenStaff="ravenStaff",e.savageStaff="savageStaff",e.spear="spear",e.sword="sword",e.warhammer="warhammer"}(O||(O={}));var C,S=k.apparel,q="/img/items/apparel/";!function(e){e[e.feet=0]="feet",e[e.hands=1]="hands",e[e.chest=2]="chest",e[e.legs=3]="legs",e[e.head=4]="head",e[e.shoulders=5]="shoulders"}(C||(C={}));var A,D=(T={},Object(I.a)(T,O.boots1,{item:O.boots1,equipmentType:C.feet,itemType:S,subText:"These boots are made for questin'",iconImg:"".concat(q,"boots_1.png")}),Object(I.a)(T,O.boots2,{item:O.boots2,equipmentType:C.feet,itemType:S,subText:"",iconImg:"".concat(q,"boots_2.png")}),Object(I.a)(T,O.boots3,{item:O.boots3,equipmentType:C.feet,itemType:S,subText:"",iconImg:"".concat(q,"boots_3.png")}),Object(I.a)(T,O.chainmailHood,{item:O.chainmailHood,equipmentType:C.head,itemType:S,subText:"",iconImg:"".concat(q,"chainmail_hood.png"),armourRating:3}),Object(I.a)(T,O.chest,{item:O.chest,equipmentType:C.chest,itemType:S,subText:"",iconImg:"".concat(q,"chest_1.png"),armourRating:2}),Object(I.a)(T,O.clothGloves,{item:O.clothGloves,equipmentType:C.hands,itemType:S,subText:"",iconImg:"".concat(q,"cloth_gloves.png")}),Object(I.a)(T,O.cowl,{item:O.cowl,equipmentType:C.head,itemType:S,subText:"",iconImg:"".concat(q,"cowl.png"),armourRating:20}),Object(I.a)(T,O.druidChest,{item:O.druidHands,equipmentType:C.chest,itemType:S,subText:"",iconImg:"".concat(q,"druid-chest.png")}),Object(I.a)(T,O.druidFeet,{item:O.druidFeet,equipmentType:C.feet,itemType:S,subText:"",iconImg:"".concat(q,"druid-feet.png")}),Object(I.a)(T,O.druidHands,{item:O.druidHands,equipmentType:C.hands,itemType:S,subText:"",iconImg:"".concat(q,"druid-hands.png")}),Object(I.a)(T,O.druidHead,{item:O.druidHead,equipmentType:C.head,itemType:S,subText:"",iconImg:"".concat(q,"druid-head.png")}),Object(I.a)(T,O.druidLegs,{item:O.druidLegs,equipmentType:C.legs,itemType:S,subText:"",iconImg:"".concat(q,"druid-legs.png")}),Object(I.a)(T,O.fedora,{item:O.fedora,equipmentType:C.head,itemType:S,subText:"I study the blade",iconImg:"".concat(q,"fedora.png")}),Object(I.a)(T,O.greaves1,{item:O.greaves1,equipmentType:C.feet,itemType:S,subText:"",iconImg:"".concat(q,"greaves_1.png"),armourRating:10}),Object(I.a)(T,O.greaves2,{item:O.greaves2,equipmentType:C.hands,itemType:S,subText:"",iconImg:"".concat(q,"greaves_2.png")}),Object(I.a)(T,O.hornedHelmet,{item:O.hornedHelmet,equipmentType:C.head,itemType:S,subText:"",iconImg:"".concat(q,"horned_helmet.png")}),Object(I.a)(T,O.leatherGloves,{item:O.leatherGloves,equipmentType:C.hands,itemType:S,subText:"",iconImg:"".concat(q,"leather_gloves.png")}),Object(I.a)(T,O.nomadHelmet,{item:O.nomadHelmet,equipmentType:C.head,itemType:S,subText:"",iconImg:"".concat(q,"nomad_helmet.png")}),Object(I.a)(T,O.pants1,{item:O.pants1,equipmentType:C.legs,itemType:S,subText:"",iconImg:"".concat(q,"pants_1.png"),armourRating:10}),Object(I.a)(T,O.pants2,{item:O.pants2,equipmentType:C.legs,itemType:S,subText:"",iconImg:"".concat(q,"pants_2.png")}),Object(I.a)(T,O.plateChest1,{item:O.plateChest1,equipmentType:C.chest,itemType:S,subText:"",iconImg:"".concat(q,"plate_chest_1.png")}),Object(I.a)(T,O.plateChest2,{item:O.plateChest2,equipmentType:C.chest,itemType:S,subText:"",iconImg:"".concat(q,"plate_chest_2.png")}),Object(I.a)(T,O.plateChest3,{item:O.plateChest3,equipmentType:C.chest,itemType:S,subText:"",iconImg:"".concat(q,"plate_chest_3.png")}),Object(I.a)(T,O.plateChest4,{item:O.plateChest4,equipmentType:C.chest,itemType:S,subText:"",iconImg:"".concat(q,"plate_chest_4.png")}),Object(I.a)(T,O.plateGloves1,{item:O.plateGloves1,equipmentType:C.hands,itemType:S,subText:"",iconImg:"".concat(q,"plate_gloves_1.png")}),Object(I.a)(T,O.plateGloves2,{item:O.plateGloves2,equipmentType:C.hands,itemType:S,subText:"",iconImg:"".concat(q,"plate_gloves_2.png")}),Object(I.a)(T,O.plateHelmet,{item:O.plateHelmet,equipmentType:C.head,itemType:S,subText:"",iconImg:"".concat(q,"plate_helmet_1.png")}),Object(I.a)(T,O.platePants,{item:O.platePants,equipmentType:C.legs,itemType:S,subText:"",iconImg:"".concat(q,"plate_pants1.png")}),Object(I.a)(T,O.plateShoulders1,{item:O.plateShoulders1,equipmentType:C.shoulders,itemType:S,subText:"",iconImg:"".concat(q,"plate_shoulders_1.png")}),Object(I.a)(T,O.plateShoulders2,{item:O.plateShoulders2,equipmentType:C.shoulders,itemType:S,subText:"",iconImg:"".concat(q,"plate_shoulders_2.png")}),Object(I.a)(T,O.robe,{item:O.robe,equipmentType:C.chest,itemType:S,subText:"",iconImg:"".concat(q,"robe_1.png")}),Object(I.a)(T,O.shoulders1,{item:O.shoulders1,equipmentType:C.shoulders,itemType:S,subText:"",iconImg:"".concat(q,"shoulders_1.png")}),Object(I.a)(T,O.shoulders2,{item:O.shoulders2,equipmentType:C.shoulders,itemType:S,subText:"",iconImg:"".concat(q,"shoulders_2.png")}),Object(I.a)(T,O.shoulders3,{item:O.shoulders3,equipmentType:C.shoulders,itemType:S,subText:"",iconImg:"".concat(q,"shoulders_3.png")}),Object(I.a)(T,O.vest,{item:O.vest,equipmentType:C.chest,itemType:S,subText:"",iconImg:"".concat(q,"vest_1.png")}),T),M=D;!function(e){e[e.resource=0]="resource",e[e.production=1]="production",e[e.tavern=2]="tavern",e[e.warehouse=3]="warehouse"}(A||(A={}));var _,R={type:A.production,cost:{gold:40,time:4e3},levels:[{displayName:"structure-alchemist-name",workerCapacity:2,cost:{gold:0},produces:[]},{displayName:"structure-alchemist-name",workerCapacity:5,cost:{gold:30},produces:[]},{displayName:"structure-alchemist-name",workerCapacity:10,cost:{gold:50},produces:[]}]},W=n(42),H=(n(150),function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"milliseconds";return W.duration(e,t).format("d [days] h [hours] m [min] s [sec]",{trim:"both"})}),F={item:O.boots1,cost:{resources:{wood:2,iron:15},time:18e5}},L={item:O.chest,cost:{resources:{wood:10,iron:45},time:36e5}},P={item:O.cowl,cost:{resources:{iron:15},time:36e5}},B={cost:{gold:40,time:4e3},type:A.production,levels:[{displayName:"structure-armoursmith-name",workerCapacity:2,cost:{gold:0},produces:[F]},{displayName:"structure-armoursmith-name",workerCapacity:5,cost:{gold:30},produces:[F,L]},{displayName:"structure-armoursmith-name",workerCapacity:10,cost:{gold:50},produces:[F,L,P]}]},U={type:A.resource,cost:{gold:40,time:4e3},levels:[{displayName:"structure-garden-name",workerCapacity:2,cost:{gold:0},generates:{food:2}},{displayName:"structure-garden-name",workerCapacity:5,cost:{gold:30},generates:{food:2}},{displayName:"structure-garden-name",workerCapacity:10,cost:{gold:50},generates:{food:2}}]},G={type:A.resource,cost:{gold:31,time:5e3},levels:[{displayName:"structure-lumberMill-name",workerCapacity:2,cost:{gold:0},generates:{wood:2}},{displayName:"structure-lumberMill-name",workerCapacity:5,cost:{gold:30},generates:{wood:2}},{displayName:"structure-lumberMill-name",workerCapacity:10,cost:{gold:50},generates:{wood:2}}]},V={cost:{gold:40,time:4e3},type:A.resource,levels:[{displayName:"structure-mine-name",workerCapacity:2,cost:{gold:0},generates:{iron:2}},{displayName:"structure-mine-name",workerCapacity:5,cost:{gold:30},generates:{iron:2}},{displayName:"structure-mine-name",workerCapacity:10,cost:{gold:50},generates:{iron:2}}]},Q={cost:{gold:40,time:4e3},type:A.resource,levels:[{displayName:"structure-quarry-name",workerCapacity:2,cost:{gold:0},generates:{stone:2}},{displayName:"structure-quarry-name",workerCapacity:5,cost:{gold:30},generates:{stone:4}},{displayName:"structure-quarry-name",workerCapacity:10,cost:{gold:50},generates:{stone:6}}]},z={cost:{gold:40,time:4e3},type:A.resource,levels:[{displayName:"structure-tannery-name",workerCapacity:2,cost:{gold:0},generates:{leather:2}},{displayName:"structure-tannery-name",workerCapacity:5,cost:{gold:30},generates:{leather:5}},{displayName:"structure-tannery-name",workerCapacity:10,cost:{gold:50},generates:{leather:7}}]},X={cost:{gold:40,time:4e3},type:A.tavern,levels:[{displayName:"structure-tavern-name",workerCapacity:2,cost:{gold:0},rooms:10},{displayName:"structure-tavern-name",workerCapacity:5,cost:{gold:30},rooms:12},{displayName:"structure-tavern-name",workerCapacity:10,cost:{gold:50},rooms:15}]},K={cost:{gold:40,time:4e3},type:A.warehouse,levels:[{displayName:"structure-warehouse-name",workerCapacity:2,cost:{gold:0},maxResources:{fabric:200,food:200,iron:200,leather:200,stone:200,wood:200}},{displayName:"structure-warehouse-name",workerCapacity:5,cost:{gold:30},maxResources:{fabric:500,food:500,iron:500,leather:500,stone:500,wood:500}},{displayName:"structure-warehouse-name",workerCapacity:10,cost:{gold:50},maxResources:{fabric:1e3,food:1e3,iron:1e3,leather:1e3,stone:1e3,wood:1e3}}]},J={item:O.crossbow,cost:{resources:{wood:20,iron:5},time:18e5}},Y={item:O.longbow,cost:{resources:{wood:40,iron:5},time:36e5}},Z={item:O.poisonedDagger,cost:{resources:{wood:50,iron:15},materials:[O.poisonVial],time:36e5}},$={item:O.dagger,cost:{resources:{wood:10,iron:10},time:36e5}},ee={item:O.sword,cost:{resources:{wood:10,iron:30},time:36e5}},te={item:O.khopesh,cost:{resources:{wood:15,iron:40},time:12e4}},ne={type:A.production,cost:{gold:40,time:4e3},levels:[{displayName:"structure-weaponsmith-name",workerCapacity:2,cost:{gold:0},produces:[J,$]},{displayName:"structure-weaponsmith-name",workerCapacity:5,cost:{gold:30},produces:[J,$,Y]},{displayName:"structure-weaponsmith-name",workerCapacity:10,cost:{gold:50},produces:[J,$,Y,ee,te]},{displayName:"structure-weaponsmith-name",workerCapacity:14,cost:{gold:50},produces:[J,$,Y,ee,te,Z]}]},ae={cost:{gold:40,time:4e3},type:A.resource,levels:[{displayName:"structure-weaver-name",workerCapacity:2,cost:{gold:0},generates:{fabric:2}},{displayName:"structure-weaver-name",workerCapacity:5,cost:{gold:30},generates:{fabric:5}},{displayName:"structure-weaver-name",workerCapacity:10,cost:{gold:50},generates:{fabric:7}}]},re={item:O.torch,cost:{resources:{wood:2,fabric:1},time:6e4}},oe={item:O.sandwich,cost:{resources:{food:1},time:3e4}},ce={type:A.production,cost:{gold:40,time:4e3},levels:[{displayName:"structure-workshop-name",workerCapacity:2,cost:{gold:0},produces:[re,oe]},{displayName:"structure-workshop-name",workerCapacity:5,cost:{gold:30},produces:[]},{displayName:"structure-workshop-name",workerCapacity:10,cost:{gold:50},produces:[]},{displayName:"structure-workshop-name",workerCapacity:14,cost:{gold:50},produces:[]}]};!function(e){e.alchemist="alchemist",e.armoursmith="armoursmith",e.garden="garden",e.lumberMill="lumberMill",e.mine="mine",e.quarry="quarry",e.tavern="tavern",e.tannery="tannery",e.warehouse="warehouse",e.weaponsmith="weaponsmith",e.weaver="weaver",e.workshop="workshop"}(_||(_={}));var ie={alchemist:R,armoursmith:B,garden:U,lumberMill:G,mine:V,quarry:Q,tavern:X,tannery:z,warehouse:K,weaponsmith:ne,weaver:ae,workshop:ce};function se(e){return ie[e]}var ue,le,me,de,pe,he,ge=k.deed,fe={deedForLumbermill:{item:O.deedForLumbermill,structure:_.lumberMill,itemType:ge,subText:"It allows for the construction of a lumber mill",iconImg:"/img/items/deeds/deed.png"},deedForWeaponsmith:{item:O.deedForWeaponsmith,structure:_.weaponsmith,itemType:ge,subText:"It allows for the construction of a weaponsmith",iconImg:"/img/items/deeds/deed.png"}},ve=k.material,be="/img/items/materials/",ye=(ue={},Object(I.a)(ue,O.arrowheads,{item:O.arrowheads,itemType:ve,iconImg:"".concat(be,"arrowheads.png")}),Object(I.a)(ue,O.bolts,{item:O.bolts,itemType:ve,iconImg:"".concat(be,"bolts.png")}),Object(I.a)(ue,O.buckle,{item:O.buckle,itemType:ve,iconImg:"".concat(be,"buckle.png")}),Object(I.a)(ue,O.chain,{item:O.chain,itemType:ve,iconImg:"".concat(be,"chain.png")}),Object(I.a)(ue,O.cogs,{item:O.cogs,itemType:ve,iconImg:"".concat(be,"cogs.png")}),Object(I.a)(ue,O.gem,{item:O.gem,itemType:ve,iconImg:"".concat(be,"gem.png")}),Object(I.a)(ue,O.ingot,{item:O.ingot,itemType:ve,iconImg:"".concat(be,"ingot.png")}),Object(I.a)(ue,O.nails,{item:O.nails,itemType:ve,iconImg:"".concat(be,"nails.png")}),Object(I.a)(ue,O.poisonVial,{item:O.poisonVial,itemType:ve,iconImg:"".concat(be,"poison-vial.png")}),Object(I.a)(ue,O.ribbon,{item:O.ribbon,itemType:ve,iconImg:"".concat(be,"ribbon.png")}),Object(I.a)(ue,O.rope,{item:O.rope,itemType:ve,iconImg:"".concat(be,"rope.png")}),Object(I.a)(ue,O.gem,{item:O.gem,itemType:ve,iconImg:"".concat(be,"gem.png")}),Object(I.a)(ue,O.gunpowder,{item:O.gunpowder,itemType:ve,iconImg:"".concat(be,"gunpowder.png")}),Object(I.a)(ue,O.scales,{item:O.scales,itemType:ve,iconImg:"".concat(be,"scales.png")}),Object(I.a)(ue,O.spring,{item:O.spring,itemType:ve,iconImg:"".concat(be,"spring.png")}),Object(I.a)(ue,O.thread,{item:O.thread,itemType:ve,iconImg:"".concat(be,"thread.png")}),ue),we=k.questItem,Ee="/img/items/quest-items/",ke=(le={},Object(I.a)(le,O.blueprints,{item:O.blueprints,itemType:we,iconImg:"".concat(Ee,"blueprints.png")}),Object(I.a)(le,O.crate,{item:O.crate,itemType:we,iconImg:"".concat(Ee,"crate.png")}),Object(I.a)(le,O.dynamite,{item:O.dynamite,itemType:we,iconImg:"".concat(Ee,"dynamite.png")}),Object(I.a)(le,O.dragonEye,{item:O.dragonEye,itemType:we,iconImg:"".concat(Ee,"dragon-eye.png")}),Object(I.a)(le,O.eye,{item:O.eye,itemType:we,iconImg:"".concat(Ee,"eye.png")}),Object(I.a)(le,O.feather,{item:O.feather,itemType:we,iconImg:"".concat(Ee,"feather.png")}),Object(I.a)(le,O.food,{item:O.food,itemType:we,iconImg:"".concat(Ee,"food.png")}),Object(I.a)(le,O.heart,{item:O.heart,itemType:we,iconImg:"".concat(Ee,"heart.png")}),Object(I.a)(le,O.horn,{item:O.horn,itemType:we,iconImg:"".concat(Ee,"horn.png")}),Object(I.a)(le,O.key,{item:O.key,itemType:we,iconImg:"".concat(Ee,"key.png")}),Object(I.a)(le,O.letters,{item:O.letters,itemType:we,iconImg:"".concat(Ee,"letters.png")}),Object(I.a)(le,O.lockPicks,{item:O.lockPicks,itemType:we,iconImg:"".concat(Ee,"lock-picks.png")}),Object(I.a)(le,O.oil,{item:O.oil,itemType:we,iconImg:"".concat(Ee,"oil.png")}),Object(I.a)(le,O.orcFinger,{item:O.orcFinger,itemType:we,iconImg:"".concat(Ee,"orc-finger.png")}),Object(I.a)(le,O.plans,{item:O.plans,itemType:we,iconImg:"".concat(Ee,"plans.png")}),Object(I.a)(le,O.purpleGems,{item:O.purpleGems,itemType:we,iconImg:"".concat(Ee,"purple-gems.png")}),Object(I.a)(le,O.runestone,{item:O.runestone,itemType:we,iconImg:"".concat(Ee,"runestone.png")}),Object(I.a)(le,O.sandwich,{item:O.sandwich,itemType:we,iconImg:"".concat(Ee,"sandwich.png")}),Object(I.a)(le,O.teeth,{item:O.teeth,itemType:we,iconImg:"".concat(Ee,"teeth.png")}),Object(I.a)(le,O.tooth,{item:O.tooth,itemType:we,iconImg:"".concat(Ee,"tooth.png")}),Object(I.a)(le,O.torch,{item:O.torch,itemType:we,iconImg:"".concat(Ee,"torch.png")}),Object(I.a)(le,O.tusk,{item:O.tusk,itemType:we,iconImg:"".concat(Ee,"tusk.png")}),Object(I.a)(le,O.vase,{item:O.vase,itemType:we,iconImg:"".concat(Ee,"vase.png")}),Object(I.a)(le,O.vial,{item:O.vial,itemType:we,iconImg:"".concat(Ee,"vial.png")}),Object(I.a)(le,O.weeds,{item:O.weeds,itemType:we,iconImg:"".concat(Ee,"weeds.png")}),le),Oe=k.trinket,Te=(me={},Object(I.a)(me,O.magicAmulet,{item:O.magicAmulet,itemType:Oe,iconImg:"".concat("/img/items/trinkets/","magic_amulet.png")}),Object(I.a)(me,O.ring,{item:O.ring,itemType:Oe,iconImg:"".concat("/img/items/trinkets/","ring.png")}),me),je=k.weapon,Ie="/img/items/weapons/";!function(e){e[e.axe=0]="axe",e[e.bow=1]="bow",e[e.club=2]="club",e[e.crossbow=3]="crossbow",e[e.fist=4]="fist",e[e.flail=5]="flail",e[e.hammer=6]="hammer",e[e.melee=7]="melee",e[e.knife=8]="knife",e[e.staff=9]="staff",e[e.sword=10]="sword",e[e.poleArm=11]="poleArm"}(pe||(pe={})),function(e){e.kinetic="kinetic"}(he||(he={}));var xe=(de={},Object(I.a)(de,O.battleAxe,{item:O.battleAxe,itemType:je,weaponType:pe.axe,subText:"It's an axe for battle",iconImg:"".concat(Ie,"battle_axe.png"),damage:Object(I.a)({},he.kinetic,20)}),Object(I.a)(de,O.brassKnuckles,{item:O.brassKnuckles,itemType:je,weaponType:pe.melee,subText:" Brass knuckles are pieces of metal shaped to fit around the knuckles.",iconImg:"".concat(Ie,"brass_knuckles.png"),damage:Object(I.a)({},he.kinetic,10)}),Object(I.a)(de,O.crossbow,{item:O.crossbow,itemType:je,weaponType:pe.crossbow,subText:"Shoots and reloads fast",iconImg:"".concat(Ie,"crossbow.png"),damage:Object(I.a)({},he.kinetic,3)}),Object(I.a)(de,O.cleaver,{item:O.cleaver,itemType:je,weaponType:pe.knife,subText:"A cleaver is a large knife that varies in its shape but usually resembles a rectangular-bladed hatchet.",iconImg:"".concat(Ie,"cleaver.png"),damage:Object(I.a)({},he.kinetic,5)}),Object(I.a)(de,O.club,{item:O.club,itemType:je,weaponType:pe.club,subText:"A club is among the simplest of all weapons: a short staff or stick, usually made of wood, wielded as a weapon",iconImg:"".concat(Ie,"club.png"),damage:Object(I.a)({},he.kinetic,8)}),Object(I.a)(de,O.dagger,{item:O.dagger,itemType:je,weaponType:pe.knife,subText:"Excellent for ritual sacrifice and cheese platters",iconImg:"".concat(Ie,"dagger.png"),damage:Object(I.a)({},he.kinetic,8)}),Object(I.a)(de,O.flail,{item:O.flail,itemType:je,weaponType:pe.flail,subText:"A flail is a weapon consisting of a striking head attached to a handle by a flexible rope, strap, or chain. ",iconImg:"".concat(Ie,"flail.png"),damage:Object(I.a)({},he.kinetic,15)}),Object(I.a)(de,O.greatswordOfGwai,{item:O.greatswordOfGwai,itemType:je,weaponType:pe.sword,subText:"Finer steel was seldom forged",iconImg:"".concat(Ie,"greatsword-gwai.png"),unique:!0,damage:Object(I.a)({},he.kinetic,25)}),Object(I.a)(de,O.khopesh,{item:O.khopesh,itemType:je,weaponType:pe.sword,subText:"Dafuq is this. Can I get garlic sauce with that?",iconImg:"".concat(Ie,"khopesh.png"),damage:Object(I.a)({},he.kinetic,15)}),Object(I.a)(de,O.longbow,{item:O.longbow,itemType:je,weaponType:pe.bow,subText:"A deadly killer from long range",iconImg:"".concat(Ie,"longbow.png"),damage:Object(I.a)({},he.kinetic,2)}),Object(I.a)(de,O.mace,{item:O.mace,itemType:je,weaponType:pe.club,subText:"A mace is a blunt weapon, a type of club or virge that uses a heavy head on the end of a handle to deliver powerful blows.",iconImg:"".concat(Ie,"mace.png"),damage:Object(I.a)({},he.kinetic,15)}),Object(I.a)(de,O.morningStar,{item:O.morningStar,itemType:je,weaponType:pe.club,subText:"A morning star is any of several medieval club-like weapons consisting of a shaft with an attached ball adorned with one or more spikes.",iconImg:"".concat(Ie,"morning-star.png"),damage:Object(I.a)({},he.kinetic,13)}),Object(I.a)(de,O.poisonedDagger,{item:O.poisonedDagger,itemType:je,weaponType:pe.knife,subText:"Excellent for ritual sacrifice and cheese platters",iconImg:"".concat(Ie,"poisoned-dagger.png"),damage:Object(I.a)({},he.kinetic,12)}),Object(I.a)(de,O.ravenStaff,{item:O.ravenStaff,itemType:je,weaponType:pe.staff,subText:"Kaa, kaa!",iconImg:"".concat(Ie,"raven-staff.png"),damage:Object(I.a)({},he.kinetic,13)}),Object(I.a)(de,O.savageStaff,{item:O.savageStaff,itemType:je,weaponType:pe.staff,subText:"Savage dude",iconImg:"".concat(Ie,"savage-staff.png"),damage:Object(I.a)({},he.kinetic,8)}),Object(I.a)(de,O.spear,{item:O.spear,itemType:je,weaponType:pe.poleArm,subText:"A spear is a pole weapon consisting of a shaft, usually of wood, with a pointed head. ",iconImg:"".concat(Ie,"sword.png"),damage:Object(I.a)({},he.kinetic,10)}),Object(I.a)(de,O.sword,{item:O.sword,itemType:je,weaponType:pe.sword,subText:"An elegant weapon for a more civilized age",iconImg:"".concat(Ie,"sword.png"),damage:Object(I.a)({},he.kinetic,14)}),Object(I.a)(de,O.warhammer,{item:O.warhammer,itemType:je,weaponType:pe.hammer,subText:"A war hammer is a late medieval weapon of war intended for close combat action, whose design resembles the hammer",iconImg:"".concat(Ie,"warhammer.png"),damage:Object(I.a)({},he.kinetic,16)}),de),Ne=xe;var Ce=Object(N.a)({},fe,{},M,{},ye,{},ke,{},Te,{},Ne),Se=Ce;function qe(e){return Ce[e]}var Ae=n(8),De=n(9),Me=n(31),_e=function(){function e(){Object(Ae.a)(this,e)}return Object(De.a)(e,null,[{key:"init",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.texts=e,this.templates={},t&&this.compileAll(),this.initialized=!0}},{key:"get",value:function(e,t){if(!this.initialized)throw new Error("Error ".concat(this," not initialized!"));var n=this.getTemplate(e);return n?n(t):(console.error("Key '".concat(e,"' not found in TextManager")),"<<'".concat(e,"' missing>>"))}},{key:"getTextEntry",value:function(e){return this.get(e.key,e.context)}},{key:"getTemplate",value:function(e){var t=this.templates[e];return!t&&this.texts[e]&&(this.compile(e,this.texts[e]),t=this.templates[e]),t}},{key:"getQuestTitle",value:function(e){return this.get("quest-".concat(e,"-title"))}},{key:"getQuestDescription",value:function(e){return this.get("quest-".concat(e,"-description"))}},{key:"getResourceName",value:function(e){return this.get("resource-".concat(e,"-name"))}},{key:"getItemName",value:function(e){var t=k[qe(e).itemType];return this.get("item-".concat(t,"-").concat(e,"-name"))}},{key:"getStructureName",value:function(e){return this.get("structure-".concat(e,"-name"))}},{key:"compileAll",value:function(){var e=this;Object.keys(this.texts).forEach((function(t){e.compile(t,e.texts[t])}))}},{key:"compile",value:function(e,t){var n=Me.compile(t);this.templates[e]=n}}]),e}();_e.initialized=!1,_e.texts=void 0,_e.templates=void 0,Me.registerHelper("item:name",(function(e,t){if(!Se[e])return new Me.SafeString("<<ITEM DEFINITION NOT FOUND: ".concat(e,">>"));switch(t){case"aA":return He(e);case"aD":case"aU":return Le(e);default:var n=Se[e].name;return new Me.SafeString(n)}})),Me.registerHelper("structure:name",(function(e){var t=_e.get("structure-".concat(e,"-name"));return new Me.SafeString(t)}));var Re,We,He=function(e){return Fe(e)},Fe=function(e){var t=_e.getItemName(e),n=_e.getTemplate("common-article-undefined");return new Me.SafeString("".concat(n({noun:t})))},Le=function(e){var t=_e.getItemName(e),n=_e.getTemplate("common-article-defined");return new Me.SafeString("".concat(n({noun:t})))},Pe=(n(172),function(e){var t=e.itemsInInventory,n=(e.className||"")+" itemsbox",a=e.items.reduce((function(e,t){return e[t]||(e[t]=0),e[t]++,e}),{}),r=Object.keys(a).map((function(e){var n=e,r=a[e],o="item";r>(t?t.filter((function(e){return e===n})).length:0)&&(o+=" missing");var c=Se[n];return v.createElement("li",{className:o,key:n},v.createElement("div",{className:"icon common-icon-smallest",style:{backgroundImage:"url(".concat("/gilles-game").concat(c.iconImg,")")}}),v.createElement("div",{className:"name"},"".concat(_e.getItemName(n)," (").concat(r,")")))}));return v.createElement("ul",{className:n},r)}),Be=Object(w.b)((function(e,t){var n=[],a=Object(c.a)(e.stockpile);return t.items.forEach((function(e){var t=a.findIndex((function(t){return t===e}));if(t>-1){var r=a.splice(t,1),o=Object(x.a)(r,1)[0];o&&n.push(o)}})),{itemsInInventory:n}}))(Pe);!function(e){e.wood="wood",e.iron="iron",e.stone="stone",e.leather="leather",e.fabric="fabric",e.food="food"}(We||(We={}));var Ue,Ge,Ve=(Re={},Object(I.a)(Re,We.wood,{resource:We.wood,iconImg:"/img/resources/wood.png"}),Object(I.a)(Re,We.iron,{resource:We.iron,iconImg:"/img/resources/iron.png"}),Object(I.a)(Re,We.stone,{resource:We.stone,iconImg:"/img/resources/stone.png"}),Object(I.a)(Re,We.leather,{resource:We.leather,iconImg:"/img/resources/leather.png"}),Object(I.a)(Re,We.fabric,{resource:We.fabric,iconImg:"/img/resources/fabric.png"}),Object(I.a)(Re,We.food,{resource:We.food,iconImg:"/img/resources/food.png"}),Re),Qe=(n(63),function(e){var t=e.sufficientResources,n=(e.className||"")+" resourcesbox",a=Object.keys(e.resources).map((function(n){var a="resource";t&&!t[n]&&(a+=" insufficient");var r=Ve[n];if(!r)throw new Error("No resource description found for ".concat(n));return v.createElement("li",{className:a,key:n},v.createElement("div",{className:"icon",style:{backgroundImage:"url(".concat("/gilles-game").concat(r.iconImg,")")}}),v.createElement("div",{className:"name"},_e.getResourceName(n)),v.createElement("div",{className:"amount"},e.resources[n]))}));return v.createElement("ul",{className:n},a)}),ze=Object(w.b)((function(e,t){var n={};return Object.keys(t.resources).forEach((function(a){n[a]=e.resources[a]>=t.resources[a]})),{sufficientResources:n}}))(Qe),Xe=function(e,t){if(t>6)throw new Error("Cannot possibly have more than ".concat(6," on one item!"));return e-.1*e*(t-1)};!function(e){e[e.item=0]="item"}(Ue||(Ue={})),function(e){e[e.smallest=0]="smallest",e[e.small=1]="small",e[e.medium=2]="medium",e[e.big=3]="big",e[e.biggest=4]="biggest"}(Ge||(Ge={}));var Ke=function e(t){switch(t){case Ge.smallest:return"common-icon-smallest";case Ge.small:return"common-icon-small";case Ge.medium:return"common-icon-medium";case Ge.big:return"common-icon-big";case Ge.biggest:return"common-icon-biggest"}return e(Ge.medium)},Je=(n(173),n(12)),Ye=n(13),Ze=n(108),$e=n.n(Ze);var et=function(){var e=function(){function e(){Object(Ae.a)(this,e)}return Object(De.a)(e,null,[{key:"addEventListener",value:function(e,t){this.events[e]=this.events[e]||[],this.events[e].push(t)}},{key:"removeEventListener",value:function(e,t){if(this.events[e])for(var n=0;n<this.events[e].length;n++)if(this.events[e][n]===t){this.events[e].splice(n,1);break}}},{key:"emit",value:function(e,t){this.events[e]&&this.events[e].forEach((function(e){return e(t)}))}}]),e}();return e.events={},e},tt=function(e){Object(Ye.a)(n,e);var t=Object(Je.a)(n);function n(){return Object(Ae.a)(this,n),t.apply(this,arguments)}return Object(De.a)(n,null,[{key:"showContextTooltip",value:function(e,t,n){var a={type:e,info:t,referenceRect:n};$e()(a,this.lastContext)?this.clear():(this.emit(this.EVENT_CONTEXT_UPDATED,a),this.lastContext=a)}},{key:"clear",value:function(){this.emit(this.EVENT_CONTEXT_UPDATED,void 0),this.lastContext=void 0}}]),n}(et());tt.EVENT_CONTEXT_UPDATED="tooltipContextUpdated",tt.lastContext=void 0;var nt=function(e){var t=e.item,n=qe(t);n||console.warn("could not find definition for ".concat(t));var a="item-icon ".concat(Ke(e.size));return v.createElement("div",{className:a,onClick:function(n){if(!1!==e.showContext){var a=n.currentTarget.getBoundingClientRect();tt.showContextTooltip(Ue.item,qe(t),a),n.stopPropagation()}e.onClick&&e.onClick(n)},style:{backgroundImage:"url(".concat("/gilles-game").concat(n.iconImg,")")}})},at=(n(201),function(e){var t,n,a,r=(t=e.progress||0,n=0,t>(a=1)?a:t<n?n:t);return v.createElement("div",{className:"progressbar"},v.createElement("div",{className:"progressbar-label"},e.label),v.createElement("div",{className:"progressbar-info",style:{width:"".concat(100*r,"%")}},"  "))});n(202);var rt,ot,ct,it,st,ut=function(e){var t;return t=null==e.max?e.value:v.createElement("span",null,e.value," / ",v.createElement("span",{className:"max"},e.max)),v.createElement("div",{className:"updownvalue"},v.createElement("label",null," ",e.label),t,v.createElement("i",{className:"arrow up"+(e.upDisabled?" disabled":""),onClick:function(t){e.onUp&&!e.upDisabled&&e.onUp(t)}}),v.createElement("i",{className:"arrow down"+(e.downDisabled?" disabled":""),onClick:function(t){e.onDown&&!e.downDisabled&&e.onDown(t)}}))},lt=(n(203),n(204),function(e){return b.a.createElement("div",{className:"structureview-header structureview-header-".concat(e.structure)})}),mt=function(e){var t=Object(v.useState)(),n=Object(x.a)(t,2),a=n[0],r=n[1],o=Object(v.useState)(0),c=Object(x.a)(o,2),i=c[0],s=c[1],u=se(e.type);if(!u)throw new Error("No definition found for structure ".concat(e.type,"\n            with type ProductionStructureDefinition."));var l=e.level||0,m=u.levels[l],d=_e.getStructureName(e.type);return v.createElement(v.Fragment,null,v.createElement(lt,{structure:e.type}),v.createElement("details",{open:!0,className:"productionstructureview"},v.createElement("summary",null,d),v.createElement("section",null,function(){var t=e.gold,n=u.levels[l+1],a=null!=n?n.cost.gold||0:-1,r=null!=n&&t>=a,o="Upgrade! (".concat(a<0?"max":a+" gold",")");return v.createElement("div",null,v.createElement("label",null,"level:"),l+1+" / "+u.levels.length,v.createElement("button",{style:{float:"right"},onClick:function(t){e.onUpgrade&&e.onUpgrade(a,l+1)},disabled:!r},o))}(),v.createElement("div",null,"craft:"),v.createElement("div",{className:"crafting-area"},v.createElement("ul",{className:"vertical-tab-bar"},m.produces.map((function(e){return v.createElement("li",{key:"craft".concat(e.item),onClick:function(t){t.stopPropagation(),r(e.item)},className:a===e.item?"selected":""},v.createElement(nt,{item:e.item}),_e.getItemName(e.item))}))),function(){var t=a;if(!t)return null;var n=m.produces.find((function(e){return e.item===t})),r=e.resources||{},o=n.cost.resources,c=Object.keys(o).some((function(e){return o[e]>r[e]})),u=!1,l=n.cost.materials;l&&(u=l.some((function(t){return-1===e.items.indexOf(t)})));var d=c||u||i<1,p=Se[t],h=null;return l&&(h=v.createElement(Be,{items:l})),v.createElement("div",{className:"crafting-details"},"Craft a ",_e.getItemName(p.item),v.createElement("div",{className:"crafting-costs"},v.createElement("fieldset",null,v.createElement(ze,{resources:o})),v.createElement("fieldset",null,h)),v.createElement("div",{style:{display:"flex "}},v.createElement(ut,{value:i,label:"Workers: ",onUp:function(e){e.stopPropagation(),s(i+1)},onDown:function(e){e.stopPropagation(),s(i-1)},upDisabled:i>=e.workersFree||i>=6,downDisabled:i<1}),"\xa0",function(e){if(0===i)return"";var t=Xe(e,i),n=H(t);return" Crafting time: ".concat(n)}(n.cost.time||0)),v.createElement("div",null,v.createElement("button",{disabled:d,onClick:function(t){t.stopPropagation(),e.onCraft&&(e.onCraft(n,i),s(0))}},"Craft")))}()),v.createElement("fieldset",null,v.createElement("legend",null,"Currently crafting:"),(e.tasks||[]).map((function(e){return v.createElement(at,{key:"".concat(e.name).concat(e.startTime),label:"".concat(e.name," (").concat(H(e.timeRemaining),")"),progress:e.progress})}))))))};function dt(e){return{type:rt.addGold,amount:e}}function pt(e){return{type:rt.addGold,amount:-e}}function ht(e,t){return{type:ot.addItem,item:e,toSlot:t}}function gt(e){return{type:ot.removeItem,fromSlot:e}}function ft(e){return{type:ct.addResources,resources:e}}function vt(e){return{type:it.finishBuildingStructure,structure:e}}function bt(e){return{type:it.upgradeStructure,structure:e}}function yt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return{type:it.increaseWorkers,structure:e,workers:t}}function wt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return{type:it.decreaseWorkers,structure:e,workers:t}}function Et(e,t,n,a,r){return{type:st.start,taskType:e,name:t,origin:n,time:a,callbacks:r}}!function(e){e.addGold="addGold"}(rt||(rt={})),function(e){e.addItem="addItem",e.moveItemInWarehouse="moveItemInWarehouse",e.removeItem="removeItem"}(ot||(ot={})),function(e){e.addResources="addResources",e.removeResources="removeResources"}(ct||(ct={})),function(e){e.upgradeStructure="upgradeStructure",e.increaseWorkers="increaseWorkers",e.decreaseWorkers="decreaseWorkers",e.startBuildingStructure="startBuildingStructure",e.finishBuildingStructure="finishBuildingStructure",e.setStructureState="setStructureState"}(it||(it={})),function(e){e.start="startTask",e.update="updateTasks"}(st||(st={}));var kt,Ot=n(26),Tt=Object(Ot.a)([function(e){return e.structures},function(e){return e.workers}],(function(e,t){return t-Object.keys(e).map((function(t){return e[t]})).reduce((function(e,t){return e+t.workers}),0)}));!function(e){e[e.buildStructure=0]="buildStructure",e[e.craftItem=1]="craftItem"}(kt||(kt={}));var jt,It=Object(w.b)((function(e,t){var n=e.structures[t.type],a=e.tasks.running.filter((function(e){return e.origin==="".concat(t.type,".craft")}));return{gold:e.gold,items:e.stockpile,level:n.level,resources:e.resources,tasks:a,workersFree:Tt(e)}}),(function(e,t){return{onCraft:function(n,a){var r,o=Xe(n.cost.time||0,a);e((r=n.cost.resources||{},{type:ct.removeResources,resources:r})),e(yt(t.type,a));var c=[ht(n.item),wt(t.type,a)],i=Et(kt.craftItem,n.item,"".concat(t.type,".craft"),o,c);e(i)},onUpgrade:function(n,a){e(pt(n)),e(bt(t.type)),a++,e(E("log-town-upgrade-structure-complete",{level:a,structure:t.type},p.town))}}}))(mt);function xt(e){return{type:jt.advanceQuest,questName:e}}function Nt(e,t){return{type:jt.startEncounter,questName:e,encounter:t}}!function(e){e.launchQuest="launchQuest",e.advanceQuest="advanceQuest",e.updateQuestVars="updateQuestVars",e.updateEncounterResult="updateEncounterResult",e.startEncounter="startEncounter",e.updateQuests="updateQuests"}(jt||(jt={}));var Ct,St="adventurer",qt="item";!function(e){e[e.adventurerInventory=0]="adventurerInventory",e[e.warehouse=1]="warehouse",e[e.tavern=2]="tavern",e[e.adventurerEquipment=3]="adventurerEquipment"}(Ct||(Ct={}));var At=n(254),Dt=(n(205),function(e){var t=e.adventurer,n=(e.className||"")+" avatar";return v.createElement("div",{className:n,style:{backgroundImage:"url(".concat("/gilles-game").concat(t.avatarImg,")")},onClick:function(){e.onClick&&e.onClick(e.adventurer.id)}},v.createElement("div",{className:"sizer"}),e.displayName&&v.createElement("div",{className:"name"},t.name))}),Mt=(n(206),{beginDrag:function(e){return{adventurer:e.adventurer,sourceId:e.sourceId,sourceType:Ct.adventurerInventory}}});var _t,Rt,Wt=Object(At.a)(St,Mt,(function(e,t){return{connectDragSource:e.dragSource(),isDragging:t.isDragging()}}))((function(e){var t=e.isDragging,n=e.connectDragSource,a="draggable-adventurer-avatar";return e.disabled&&(a+=" disabled"),t&&(a+=" dragging"),n(v.createElement("div",{className:a},v.createElement(Dt,e)))}));!function(e){e.backstabbed="backstabbed",e.goblinHouseHallway="goblinHouseHallway",e.goblinHouseOutside="goblinHouseOutside",e.theBigTree="theBigTree"}(_t||(_t={})),function(e){e[e.nothing=0]="nothing",e[e.encounter=1]="encounter",e[e.combat=2]="combat",e[e.boss=3]="boss"}(Rt||(Rt={}));var Ht={kill10Boars:{nodes:[{x:0,y:1,type:Rt.nothing,log:"quest-kill10Boars-node0"},{x:0,y:2,type:Rt.nothing,log:"quest-kill10Boars-node1"},{x:0,y:3,type:Rt.encounter,encounter:_t.goblinHouseOutside},{x:1,y:3,type:Rt.nothing,log:"quest-kill10Boars-node4"},{x:1,y:3,type:Rt.nothing},{x:2,y:3,type:Rt.nothing},{x:3,y:3,type:Rt.encounter,encounter:_t.backstabbed},{x:4,y:4,type:Rt.nothing,log:"The party spots a boss"},{x:5,y:4,type:Rt.boss}]},retrieveMagicAmulet:{requiredItems:[O.torch,O.torch,O.torch,O.sandwich,O.sandwich],nodes:[{x:0,y:1,type:Rt.nothing},{x:1,y:1,type:Rt.nothing},{x:2,y:1,type:Rt.nothing},{x:3,y:1,type:Rt.nothing},{x:4,y:1,type:Rt.nothing},{x:5,y:1,type:Rt.nothing},{x:7,y:1,type:Rt.nothing},{x:8,y:2,type:Rt.nothing},{x:8,y:3,type:Rt.nothing},{x:9,y:3,type:Rt.nothing},{x:10,y:1,type:Rt.nothing},{x:10,y:2,type:Rt.nothing},{x:10,y:3,type:Rt.nothing},{x:10,y:4,type:Rt.nothing},{x:11,y:5,type:Rt.nothing},{x:12,y:6,type:Rt.nothing},{x:12,y:7,type:Rt.nothing},{x:13,y:8,type:Rt.nothing},{x:12,y:8,type:Rt.nothing},{x:12,y:9,type:Rt.nothing},{x:11,y:8,type:Rt.nothing},{x:10,y:8,type:Rt.nothing},{x:9,y:8,type:Rt.nothing},{x:8,y:9,type:Rt.nothing},{x:7,y:8,type:Rt.encounter,encounter:_t.theBigTree},{x:8,y:1,type:Rt.nothing},{x:1,y:1,type:Rt.nothing},{x:1,y:1,type:Rt.nothing},{x:1,y:1,type:Rt.nothing},{x:1,y:1,type:Rt.nothing},{x:1,y:1,type:Rt.nothing},{x:1,y:1,type:Rt.nothing},{x:1,y:1,type:Rt.nothing},{x:1,y:1,type:Rt.nothing},{x:2,y:1,type:Rt.encounter,encounter:_t.backstabbed},{x:3,y:1,type:Rt.boss}]}},Ft=Ht;function Lt(e){return Ht[e]}var Pt=n(255),Bt=(n(208),Object(Pt.a)(St,{drop:function(e,t){e.onDrop(t.getItem())},canDrop:function(e,t){return!0}},(function(e,t){return{canDrop:t.canDrop(),connectDropTarget:e.dropTarget(),isOver:t.isOver()}}))((function(e){var t=e.isOver,n=e.canDrop,a="droppable-adventurer-slot";return t?a+=" active-drop":n&&(a+=" can-drop"),(0,e.connectDropTarget)(v.createElement("div",{className:a}))}))),Ut=(n(209),function(e){return v.createElement("ul",{className:"assign-adventurers"},function(){for(var t=[],n=function(n){var a=void 0,r="";if(!!e.assignedAventurers[n]){var o=e.assignedAventurers[n];a=v.createElement(Dt,{adventurer:o,displayName:!1,onClick:function(){return e.onRemoveAdventurer(n)}}),r="has-adventurer"}else a=v.createElement(Bt,{onDrop:function(t){e.onAddEventurer(t,n)}});t.push(v.createElement("li",{key:"slot".concat(n),className:r}," ",a," "))},a=0;a<e.availableSlots;a++)n(a);return t}())}),Gt=(n(210),function(e){var t=e.availableQuests.map((function(t){var n="".concat("/gilles-game","img/sigils/").concat(t.icon),a="quest"+(t.name===e.selectedQuestName?" selected":"");return v.createElement("li",{key:t.name,className:a,onClick:function(){e.onQuestClick(t.name)}},v.createElement("div",{className:"icon",style:{backgroundImage:"url(".concat("/gilles-game").concat(n,")")}}),v.createElement("div",{className:"title"},_e.getQuestTitle(t.name)," "))})),n=function(t){return!t.requiredItems||t.requiredItems.every((function(n){var a=t.requiredItems.filter((function(e){return e===n})).length;return e.items.filter((function(e){return e===n})).length>=a}))};return v.createElement("div",{className:"quest-board"},v.createElement("h2",null," ",_e.get("structure-tavern-title-quest-board")),v.createElement("ul",{className:"quest-list"},t),function(){if(!e.selectedQuestName)return null;var t=e.availableQuests.find((function(t){return t.name===e.selectedQuestName}));if(!t)return v.createElement("div",null," ",_e.get("structure-tavern-quest-launched")," ");var a=Lt(t.name),r=e.assignedAventurers.filter((function(e){return null!==e})).length>=3,o=n(a),c=r&&o;return v.createElement("div",{className:"quest-details"},_e.getQuestDescription(e.selectedQuestName),v.createElement(Ut,{availableSlots:5,assignedAventurers:e.assignedAventurers,onRemoveAdventurer:e.onRemoveAdventurer,onAddEventurer:e.onAddAdventurer}),v.createElement(Be,{items:a.requiredItems||[]}),v.createElement("button",{disabled:!c,onClick:function(){return e.onLaunchQuest()}},_e.get("structure-tavern-button-launch-quest")))}())});var Vt,Qt=Object(w.b)((function(e,t){return{items:e.stockpile}}))(Gt);!function(e){e[e.unavailable=0]="unavailable",e[e.available=1]="available",e[e.active=2]="active",e[e.completed=3]="completed"}(Vt||(Vt={}));n(211),n(212);var zt,Xt=Object(At.a)(qt,{beginDrag:function(e){return{inventorySlot:e.index,item:e.item,sourceId:e.sourceId,sourceType:e.sourceType}}},(function(e,t){return{connectDragSource:e.dragSource(),isDragging:t.isDragging()}}))((function(e){var t=e.item,n=e.onClick,a=e.isDragging,r=e.connectDragSource,o=e.size;return a?null:r(v.createElement("div",null,v.createElement(nt,{item:t,onClick:function(e){n&&n(e)},size:o})))})),Kt=(n(213),{drop:function(e,t){e.onDrop(t.getItem())},canDrop:function(e,t){var n=t.getItem().item;return Yt(n,e.type)}});!function(e){e[e.feet=0]="feet",e[e.hands=1]="hands",e[e.chest=2]="chest",e[e.legs=3]="legs",e[e.head=4]="head",e[e.shoulders=5]="shoulders",e[e.mainHand=6]="mainHand",e[e.offHand=7]="offHand"}(zt||(zt={}));var Jt,Yt=function(e,t){switch(t){case zt.chest:return $t(e,C.chest);case zt.feet:return $t(e,C.feet);case zt.hands:return $t(e,C.hands);case zt.head:return $t(e,C.head);case zt.legs:return $t(e,C.legs);case zt.mainHand:case zt.offHand:return qe(e).itemType===k.weapon;default:return!1}},Zt=Object(Pt.a)(qt,Kt,(function(e,t){return{canDrop:t.canDrop(),connectDropTarget:e.dropTarget(),isOver:t.isOver()}}))((function(e){var t=e.isOver,n=e.canDrop,a="grey";return t&&n?a="green":n&&(a="orange"),(0,e.connectDropTarget)(v.createElement("div",{className:"equipment-slot",style:{borderColor:a},title:zt[e.type]},e.children))})),$t=function(e,t){var n=qe(e);return n.itemType===k.apparel&&n.equipmentType===t},en=(n(214),{drop:function(e,t){e.onDrop(t.getItem())},canDrop:function(e,t){var n=t.getItem();return n.sourceType!==Ct.adventurerEquipment||(null==e.item||Yt(e.item,n.inventorySlot))}}),tn=Object(Pt.a)(qt,en,(function(e,t){return{canDrop:t.canDrop(),connectDropTarget:e.dropTarget(),isOver:t.isOver()}}))((function(e){var t=e.isOver,n=e.canDrop,a=e.connectDropTarget,r=t&&n,o=["inventory-item",Ke(e.size)];return r?o.push("drop-active"):n&&o.push("drop-possible"),a(v.createElement("div",{className:o.join(" ")},e.children))})),nn=function(e){for(var t=[],n=function(n){var a=void 0,r=e.items[n];r&&(a=v.createElement(Xt,{index:n,sourceId:e.sourceId,sourceType:e.sourceType,item:r}));var o=v.createElement(tn,{key:"inventory-slot-".concat(n),item:r,size:e.iconSize,onDrop:function(t){if((t.inventorySlot!==n||t.sourceType!==e.sourceType||t.sourceId!==e.sourceId)&&e.onDropItem){var a=t.inventorySlot;e.onDropItem(t.item,a,n,t.sourceType,t.sourceId)}}},a);t.push(o)},a=0;a<e.items.length;a++)n(a);return v.createElement("div",{className:"inventory ".concat(e.className)},t)},an=function(e){var t=e.adventurer,n=Object.keys(t.stats).map((function(e){var n=t.stats[e];return v.createElement("div",{key:"".concat(t.id,"-").concat(e)}," ",v.createElement("b",null,e),": ",n.toFixed(1)," ")})),a=function(n){var a=t.equipment[zt[n]],r=null;if(a){var o=v.createRef();r=v.createElement(Xt,{index:n,sourceId:t.id,sourceType:Ct.adventurerEquipment,item:a,onClick:function(e){var t=e.currentTarget.getBoundingClientRect();tt.showContextTooltip(Ue.item,qe(a),t),e.stopPropagation()},ref:o,size:Ge.medium})}return v.createElement(v.Fragment,null,v.createElement(Zt,{onDrop:function(a){return function(n,a){var r=n.item;switch(n.sourceType){case Ct.adventurerInventory:e.onRemoveItemFromInventory(t.id,n.inventorySlot),e.onAssignEquipment(t.id,a,r);var o=t.equipment[zt[a]];o&&e.onAddItemToInventory(t.id,o,n.inventorySlot);break;case Ct.warehouse:e.onAssignEquipmentFromWarehouse(t.id,n.inventorySlot,r,a);var c=t.equipment[zt[a]];c&&e.onAddItemToWarehouse(c,n.inventorySlot);break;case Ct.adventurerEquipment:e.onAssignEquipment(t.id,a,r);var i=t.equipment[zt[a]],s=n.inventorySlot;i?e.onAssignEquipment(t.id,s,i):e.onRemoveEquipment(t.id,s)}}(a,n)},type:n},r),v.createElement("span",{className:"info"},_e.get("ui-equipmentslot-".concat(zt[n]))))},r=v.createElement("ul",null,v.createElement("li",null,a(zt.head)),v.createElement("li",null,a(zt.shoulders)),v.createElement("li",null,a(zt.chest)),v.createElement("li",null,a(zt.hands)),v.createElement("li",null,a(zt.legs)),v.createElement("li",null,a(zt.feet)),v.createElement("li",null,a(zt.mainHand)),v.createElement("li",null,a(zt.offHand)));return v.createElement("div",{className:"adventurer-info"},v.createElement("div",{className:"left"},v.createElement("div",{className:"name"},v.createElement("b",null,t.name)),v.createElement("div",{className:"attributes"},n),v.createElement("div",{className:"equipment"},r)),v.createElement("div",{className:"right"},v.createElement(nn,{sourceType:Ct.adventurerInventory,sourceId:t.id,items:t.inventory,onDropItem:function(n,a,r,o,c){switch(o){case Ct.adventurerInventory:e.onMoveItemInInventory&&e.onMoveItemInInventory(t.id,a,r);break;case Ct.warehouse:var i=t.inventory[r];e.onMoveItemFromWarehouseToInventory(t.id,a,r,n,i);break;case Ct.adventurerEquipment:e.onAddItemToInventory&&e.onRemoveEquipment&&e.onAddItemToInventory(t.id,n,r);var s=t.inventory[r];s?e.onAssignEquipment(t.id,a,s):e.onRemoveEquipment(t.id,a)}}})))};function rn(e,t,n){return{type:Jt.moveItemInInventory,adventurerId:e,fromSlot:t,toSlot:n}}function on(e,t,n){return{type:Jt.addItemToInventory,adventurerId:e,item:t,toSlot:n}}function cn(e,t){return{type:Jt.removeItemFromInventory,adventurerId:e,fromSlot:t}}function sn(e,t,n){return{type:Jt.assignEquipment,adventurerId:e,item:n,equipmentSlot:t}}function un(e,t){return{type:Jt.removeEquipment,adventurerId:e,equipmentSlot:t}}!function(e){e.moveItemInInventory="moveItemInInventory",e.moveItemToOtherAdventurer="moveItemToOtherAdventurer",e.moveItemFromWarehouseToAdventurer="moveItemFromWarehouseToAdventurer",e.addItemToInventory="addItemToInventory",e.removeItemFromInventory="removeItemFromInventory",e.assignEquipment="assignEquipment",e.removeEquipment="removeEquipment"}(Jt||(Jt={}));var ln,mn,dn,pn=function(e){return{onAddItemToInventory:function(t,n,a){var r=on(t,n,a);e(r)},onAddItemToWarehouse:function(t,n){var a=ht(t,n);e(a)},onAssignEquipment:function(t,n,a){var r=sn(t,n,a);e(r)},onAssignEquipmentFromWarehouse:function(t,n,a,r){var o=gt(n);e(o);var c=sn(t,r,a);e(c)},onMoveItemFromWarehouseToInventory:function(t,n,a,r,o){var c=gt(n);e(c);var i=on(t,r,a);if(e(i),o){var s=ht(o,n);e(s)}},onMoveItemInInventory:function(t,n,a){var r=rn(t,n,a);e(r)},onRemoveEquipment:function(t,n){var a=un(t,n);e(a)},onRemoveItemFromInventory:function(t,n){var a=cn(t,n);e(a)}}},hn=Object(w.b)((function(e,t){return{adventurer:e.adventurers.find((function(e){return e.id===t.adventurerId})),warehouse:e.stockpile}}),pn)(an),gn=(n(215),n(216),function(e){var t=e.className||"";return v.createElement("div",{className:"ui-button widgets-squareiconbutton ".concat(t),onClick:function(t){e.onClick&&e.onClick(t)}},e.text)});!function(e){e[e.town=0]="town",e[e.world=1]="world"}(ln||(ln={})),function(e){e[e.buttonClick=0]="buttonClick",e[e.error=1]="error"}(mn||(mn={}));var fn={},vn=null,bn={},yn=function(){function e(){Object(Ae.a)(this,e)}return Object(De.a)(e,null,[{key:"loadMedia",value:function(e){dn=e}},{key:"addSounds",value:function(e){Object.entries(e).forEach((function(e){var t=Object(x.a)(e,2),n=t[0],a=t[1];bn[n]=dn.find((function(e){return e.url===a})).content}))}},{key:"playSound",value:function(e){bn[e].play()}},{key:"addMusicTrack",value:function(e,t){if(dn){var n=dn.find((function(e){return e.url===t}));if(!n)throw new Error("No sound found at ".concat(t));fn.hasOwnProperty(e)||(fn[e]=n.content)}}},{key:"playMusicTrack",value:function(t){if(dn){if(null!==vn)fn[vn].fade(e.musicVolume,0,500);var n=fn[t];n.playing()||(n.loop(!0),n.play()),n.fade(0,e.musicVolume,500),vn=t}}},{key:"soundVolume",value:function(e){}},{key:"musicVolume",set:function(e){vn&&fn[vn].volume(e),this._musicVolume=e;try{localStorage.setItem("musicVolume","".concat(e))}catch(t){}},get:function(){if(void 0!==this._musicVolume)return this._musicVolume;var e=localStorage.getItem("musicVolume");return null==e?this._musicVolume=.8:(this._musicVolume=parseFloat(e),console.log("got value from storage",e)),console.log(this._musicVolume),this._musicVolume}}]),e}();yn._musicVolume=void 0,yn._soundVolume=void 0;var wn=function(e){var t=null;!1!==e.backEnabled&&(t=v.createElement(gn,{className:"back-button",onClick:function(t){e.onBack&&(e.onBack(),yn.playSound(mn.buttonClick))},text:"<"}));var n=null;return!1!==e.closeEnabled&&(n=v.createElement(gn,{className:"close-button",onClick:function(t){e.onClose&&(e.onClose(),yn.playSound(mn.buttonClick))},text:"x"})),v.createElement("div",{className:"window"},v.createElement("div",{className:"header"},t,v.createElement("h3",null,e.title),n),e.children)},En=function(e){return function(t){Object(Ye.a)(a,t);var n=Object(Je.a)(a);function a(){return Object(Ae.a)(this,a),n.apply(this,arguments)}return Object(De.a)(a,[{key:"render",value:function(){return v.createElement(wn,this.props,v.createElement(e,this.props))}}]),a}(v.Component)},kn=n(11),On=Object(kn.c)(En,Object(w.b)((function(e,t){return{adventurer:e.adventurers.find((function(e){return e.id===t.adventurerId})),warehouse:e.stockpile}}),pn))(an),Tn=function(e){var t=v.useState([]),n=Object(x.a)(t,2),a=n[0],r=n[1],o=v.useState(null),i=Object(x.a)(o,2),s=i[0],u=i[1],l=v.useContext(Nr),m=se(_.tavern),d=e.level||0,p=m.levels[d],h=_e.getStructureName(_.tavern),g=p.rooms,f=e.quests.filter((function(e){return e.status===Vt.available})),b=function(t){return Object.values(e.quests).find((function(e){return e.party.indexOf(t)>-1}))},y=function(e){var t=v.createElement(On,{adventurerId:e.id,title:e.name});l.onOpenWindow(t)};return v.createElement("details",{open:!0,className:"tavernstructureview"},v.createElement("summary",null,h),function(){var t=e.gold,n=m.levels[d+1],a=null!=n?n.cost.gold||0:-1,r=null!=n&&t>=a,o="Upgrade! (".concat(a<0?"max":a+" gold",")");return v.createElement("div",null,v.createElement("label",null,"level:"),d+1+" / "+m.levels.length,v.createElement("button",{style:{float:"right"},onClick:function(t){e.onUpgrade&&e.onUpgrade(a,d+1)},disabled:!r},o))}(),v.createElement("section",null,function(){for(var t=[],n=function(n){var r=e.adventurers.find((function(e){return e.room===n})),o=null;if(r){var c=r.name,i=a.indexOf(r)>-1,s=b(r.id);s&&(c+=" (on a quest)"),o=[v.createElement(Wt,{disabled:i||null!=s,adventurer:r,className:"adventurer-icon",sourceId:"tavern",key:"avatar:".concat(r.id)}),v.createElement("a",{key:r.id,onClick:function(){return y(r)}}," ",c)]}else o="(empty room)";t.push(v.createElement("div",{key:"room".concat(n),className:"room"},o))},r=0;r<g;r++)n(r);return v.createElement("div",{className:"rooms"},v.createElement("h2",null,"Rooms"),t)}(),v.createElement(Qt,{availableQuests:f,selectedQuestName:s,assignedAventurers:a,onQuestClick:function(e){return function(e){u(s===e?null:e),r([])}(e)},onAddAdventurer:function(e,t){return function(e,t){if("tavern"===e.sourceId){var n=Object(c.a)(a);n[t]=e.adventurer,r(n)}}(e,t)},onRemoveAdventurer:function(e){return function(e){var t=Object(c.a)(a);delete t[e],r(t)}(e)},onLaunchQuest:function(){e.onLaunchQuest(s,a)}})))};var jn=Object(w.b)((function(e,t){var n=e.structures[_.tavern];return{adventurers:e.adventurers,gold:e.gold,level:n.level,quests:e.quests}}),(function(e,t){return{onLaunchQuest:function(t,n){e(function(e,t){return{type:jt.launchQuest,questName:e,assignedAventurers:t}}(t,n))},onUpgrade:function(t,n){e(pt(t)),e(bt(_.tavern)),n++,e(E("log-town-upgrade-structure-complete",{level:n,structure:_.tavern},p.town))}}}))(Tn),In=function(e){var t=e.sufficientResources,n=e.resources,a=e.deltaResources,r=(e.className||"")+" resourcesbox",o=Object.keys(n).map((function(n){var r="resource";t&&!t[n]&&(r+=" insufficient");var o,c=Ve[n],i=e.resources[n];if(!c)throw new Error("No resource description found for ".concat(n));a[n]&&(o=v.createElement("span",{className:"animate-up"},"+ ".concat(a[n].toFixed(2))));var s=xn(n);return v.createElement("li",{className:r,key:n},v.createElement("div",{className:"icon common-icon-smallest",style:{backgroundImage:"url(".concat("/gilles-game").concat(c.iconImg,")")}}),v.createElement("div",{className:"name"},_e.getResourceName(n)),v.createElement("div",{className:"amount"},i.toFixed(1)),v.createElement("div",{className:"max"}," / ".concat(e.maxResources[n])),v.createElement("div",{className:"delta"},o),v.createElement("div",{className:"structure"},"source: ",_e.getStructureName(s)))}));return v.createElement("ul",{className:r},o)},xn=function(e){switch(e){case We.fabric:return _.weaver;case We.food:return _.garden;case We.iron:return _.mine;case We.leather:return _.tannery;case We.stone:return _.quarry;case We.wood:return _.lumberMill}throw new Error("Unknown structure for resource ".concat(e))},Nn=(n(101),function(e){var t=(e.active?"active":"")+(e.className||"");return v.createElement("li",{className:"tabstrip-tab ".concat(t),onClick:function(t){e.onClick&&e.onClick(t)}},e.children)}),Cn=function(e){var t=null;e.children&&e.children.length&&(t=e.children[0].props.id);var n=Object(v.useState)(t),a=Object(x.a)(n,2),r=a[0],o=a[1],c=e.className||"",i=b.a.Children.map(e.children,(function(e){return b.a.cloneElement(e,{active:e.props.id===r,onClick:function(){s(e.props.id)}})})),s=function(t){o(t),e.onTabSelected&&e.onTabSelected(t)};return b.a.createElement("ul",{className:"tabstrip ".concat(c),onClick:function(t){e.onClick&&e.onClick(t)}},i)},Sn=function(e){var t=Object(v.useRef)();return Object(v.useEffect)((function(){t.current=e})),t.current},qn={fabric:0,food:0,iron:60,leather:0,stone:0,wood:40},An={fabric:0,food:0,iron:0,leather:0,stone:0,wood:0},Dn=(n(217),Ct.warehouse),Mn=function(e){var t=Object(v.useState)(),n=Object(x.a)(t,2),a=n[0],r=n[1],o=Object(v.useState)(An),c=Object(x.a)(o,2),i=c[0],s=c[1],u=Sn(e.resources),l=Object(v.useRef)(null);Object(v.useEffect)((function(){var t=Object.keys(e.resources).reduce((function(t,n){return u&&u[n]&&(t[n]=e.resources[n]-u[n]),t}),{});s(t)}),[e.resources,u]),Object(v.useEffect)((function(){if(l.current){var e=l.current;e.classList.remove("animate"),setTimeout((function(){l&&e.classList.add("animate")}),200)}}),[i]);var m=se(_.warehouse);if(!m)throw new Error("No definition found for structure ".concat(_.warehouse," with type StructureDefinition."));var d=e.level,p=_e.getStructureName(_.warehouse);return v.createElement("details",{open:!0,className:"warehouse-structureview"},v.createElement("summary",null,p),function(){var t=e.gold,n=m.levels[d+1],a=null!=n?n.cost.gold||0:-1,r=null!=n&&t>=a,o="Upgrade! (".concat(a<0?"max":a+" gold",")");return v.createElement("div",null,v.createElement("label",null,"level:"),d+1+" / "+m.levels.length,v.createElement("button",{style:{float:"right"},onClick:function(t){e.onUpgrade&&e.onUpgrade(a,d+1)},disabled:!r},o))}(),v.createElement("fieldset",{className:"resources",ref:l},v.createElement("legend",null,"Resources"),v.createElement(In,{resources:e.resources,structures:e.structures,maxResources:e.maxResources,deltaResources:i})),v.createElement("h3",null,"Stockpile"),v.createElement(nn,{sourceType:Dn,items:e.items,onDropItem:function(t,n,a,r,o){switch(r){case Dn:e.onMoveItemInWarehouse&&e.onMoveItemInWarehouse(n,a);break;case Ct.adventurerInventory:if(e.onMoveItemFromAdventurer){var c=e.items[a];e.onMoveItemFromAdventurer(o,t,n,a,c)}}}}),v.createElement("h3",null,"Adventurers"),v.createElement("div",null,v.createElement(Cn,{className:"adventurers-tabstrip",onTabSelected:function(e){r(e)}},e.adventurersInTown.map((function(e){return t=e,v.createElement(Nn,{id:t.id,key:t.id},v.createElement(Dt,{adventurer:t,className:"common-icon-small"}));var t}))),v.createElement("div",{className:"adventurer-inventory"},a?v.createElement(hn,{adventurerId:a}):null)))},_n=function(e,t){return t.party.map((function(t){return Wn(e,t)}))},Rn=function(e,t){var n=t.party[0];return Wn(e,n)},Wn=function(e,t){return e.find((function(e){return e.id===t}))},Hn=function(e){return!!e.rngState},Fn=function(e){return e.adventurers},Ln=function(e){return e.quests},Pn=(Object(Ot.a)([Fn,Ln],(function(e,t){var n=[],a=Object.values(t).reduce((function(t,a){var r=_n(e,a);return a.status===Vt.active&&(t[a.name]=r),n.push.apply(n,Object(c.a)(r)),t}),{});return a.solo=e.filter((function(e){return-1===n.indexOf(e)})),a})),Object(Ot.a)([Fn,Ln],(function(e,t){var n=t.reduce((function(e,t){return t.status===Vt.active&&e.push.apply(e,Object(c.a)(t.party)),e}),[]);return e.filter((function(e){return-1===n.indexOf(e.id)}))})));var Bn,Un=Object(w.b)((function(e,t){var n=e.structures[_.warehouse],a=se(_.warehouse),r=n.level,o=a.levels[r],c=Pn(e);if(!n)throw new Error("No structure '".concat(_.warehouse,"' found in the store!"));return{adventurersInTown:c,gold:e.gold,items:e.stockpile,level:r,maxResources:o.maxResources,resources:e.resources,structures:e.structures,workers:n.workers,workersFree:Tt(e)}}),(function(e,t){return{onMoveItemFromAdventurer:function(t,n,a,r,o){var c=cn(t,a);e(c);var i=ht(n,r);if(e(i),o){var s=on(t,o,a);e(s)}},onMoveItemInWarehouse:function(t,n){e(function(e,t){return{type:ot.moveItemInWarehouse,fromSlot:e,toSlot:t}}(t,n))},onMoveItemInInventory:function(t,n,a){var r=rn(t,n,a);e(r)},onMoveItemToAdventurer:function(t,n,a,r){var o=gt(a);e(o);var c=on(t,n,r);e(c)},onUpgrade:function(t,n){e(pt(t)),e(bt(_.warehouse)),n++,e(E("log-town-upgrade-structure-complete",{level:n,structure:_.warehouse},p.town))}}}))(Mn);!function(e){e[e.NotBuilt=0]="NotBuilt",e[e.Building=1]="Building",e[e.Built=2]="Built"}(Bn||(Bn={}));var Gn={level:0,state:Bn.NotBuilt,workers:0},Vn=(n(218),function(e){var t=Object(w.d)((function(e){return e.gold})),n=Object(w.d)((function(t){var n=t.structures[e.type];if(!n)throw new Error("No structure '".concat(e.type,"' found in the store!"));return n.level})),a=Object(w.d)((function(t){var n=t.structures[e.type];if(!n)throw new Error("No structure '".concat(e.type,"' found in the store!"));return n.workers})),r=Object(w.d)((function(e){return Tt(e)})),o=se(e.type);if(!o)throw new Error("No definition found for structure ".concat(e.type," with type ResourceStructureDefinition."));var c=Object(w.c)(),i=function(){c(wt(e.type))},s=function(){c(yt(e.type))},u=o.levels[n];return v.createElement(v.Fragment,null,v.createElement(lt,{structure:e.type}),v.createElement("details",{open:!0,className:"structureview"},v.createElement("section",null,function(){var e=a===u.workerCapacity||(r||0)<1,t=0===a;return v.createElement(ut,{label:"workers:",value:a,max:u.workerCapacity,upDisabled:e,downDisabled:t,onDown:i,onUp:s})}(),function(){var a=o.levels[n+1],r=null!=a?a.cost.gold||0:-1,i=null!=a&&t>=r,s="Upgrade! (".concat(r<0?"max":r+" gold",")");return v.createElement("div",null,v.createElement("label",null,"level:"),n+1+" / "+o.levels.length,v.createElement("button",{style:{float:"right"},onClick:function(t){!function(t,n){c(pt(t)),c(bt(e.type)),n++,c(E("log-town-upgrade-structure-complete",{level:n,structure:e.type},p.town))}(r,n+1)},disabled:!i},s))}(),function(){var e=u.generates,t=Object.keys(e).reduce((function(t,n){return e[n]&&t.push("".concat(e[n]," x ").concat(a," = ").concat(e[n]*(a||0)," ").concat(n)),t}),[]).join(",");return v.createElement("div",null,"Generates (every minute): ",v.createElement("br",null),t)}())))}),Qn=function(e){return v.createElement("div",{className:"structure-details"},function(){if(e.structures[e.structure].state===Bn.Building){var t=e.buildTask?e.buildTask.progress:1;return v.createElement("div",null,v.createElement(at,{label:"Building...",progress:t}))}switch(se(e.structure).type){case A.production:return v.createElement(It,{type:e.structure});case A.resource:return v.createElement(Vn,{type:e.structure});case A.warehouse:return v.createElement(Un,null);case A.tavern:return v.createElement(jn,null);default:return v.createElement("div",null," ",e.structure," ")}}())};var zn,Xn=Object(kn.c)(Object(w.b)((function(e,t){return{buildTask:e.tasks.running.filter((function(e){return"town"===e.origin&&e.name==="".concat(t.structure,".build")}))[0],structures:e.structures}})),En)(Qn),Kn=["sound/fx/button-click.ogg","sound/fx/error.ogg","sound/music/Soliloquy.mp3","sound/music/TheLoomingBattle.ogg"],Jn=n(253),Yn=n(120),Zn=n(60),$n=n(34),ea=(n(219),n(110)),ta=function(e){var t=e.itemsLoaded,n=e.itemsTotal;return v.createElement("div",null," ","Loading (".concat(Math.floor((t||0)/(n||0)*100),")%")," ")};!function(e){e[e.image=0]="image",e[e.sound=1]="sound"}(zn||(zn={}));var na,aa=[],ra=function(e){var t=new Image;return t.src=e,new Promise((function(e,n){function a(){t.naturalWidth?e(t):n(null),t.removeEventListener("load",a),t.removeEventListener("error",a)}t.naturalWidth?e(t):t.complete?n(null):(t.addEventListener("load",a),t.addEventListener("error",a))}))},oa=function(e){if((e=e.toLowerCase()).endsWith("png")||e.endsWith("jpg")||e.endsWith("gif"))return zn.image;if(e.endsWith("mp3")||e.endsWith("ogg")||e.endsWith("wav"))return zn.sound;throw Error("Could not determine type for ".concat(e))},ca=function(e){var t=Object(v.useState)(!1),n=Object(x.a)(t,2),a=n[0],r=n[1],o=Object(v.useState)(0),c=Object(x.a)(o,2),i=c[0],l=c[1];Object(v.useEffect)((function(){h()}),[]);var m=e.children,d=e.manifest,p=v.createElement(ta,{itemsLoaded:i,itemsTotal:d.length}),h=function(){l(0);var t=e.manifest.map((function(e){return g(e).catch((function(e){return console.error(e)}))}));Promise.all(t).then((function(t){e.onLoadComplete&&e.onLoadComplete(aa),r(!0)}))},g=function(){var e=Object(u.a)(s.a.mark((function e(t){var n,a,r,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(aa.some((function(e){return e.url===t}))&&console.warn("Loading media with url ".concat(t," more than once! Will overwrite.")),(n=oa(t))!==zn.image){e.next=7;break}return e.next=5,ra(t);case 5:r=e.sent,a={content:r,mediaType:n,url:t};case 7:if(n===zn.sound&&(o=new ea.Howl({src:["".concat("/gilles-game","/").concat(t)]}),a={content:o,mediaType:n,url:t}),!a){e.next=14;break}return aa.push(a),l(i+1),e.abrupt("return",a);case 14:throw new Error("Unknown error while trying to load ".concat(t));case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return a?m:p},ia=n(7),sa=n(112),ua=b.a.forwardRef((function(e,t){var n=Object(ia.useApp)();if(n){var a="url('".concat("/gilles-game","/img/cursors/dwarven_gauntlet_extra_6.png'), auto");n.renderer.plugins.interaction.cursorStyles.pointer=a}return b.a.createElement(la,Object.assign({app:n},e,{ref:t}))})),la=Object(ia.PixiComponent)("Viewport",{create:function(e){var t=new sa.a({screenWidth:e.screenWidth,screenHeight:e.screenHeight,worldWidth:e.worldWidth,worldHeight:e.worldHeight,ticker:e.app.ticker,interaction:e.app.renderer.plugins.interaction});return t.on("clicked",(function(t){e.onClick&&e.onClick(t)})),t.drag().pinch().wheel().clamp({direction:"all"}).clampZoom({minScale:1,maxScale:2}).decelerate(),t}}),ma=ua,da=(n(229),n(2)),pa=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"0";Object(Ae.a)(this,e),this.shapes=void 0,this.shapes=t[n].map((function(e){var t=e.shape;return new da.Polygon(t)}))}return Object(De.a)(e,[{key:"contains",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return!(!this.shapes||0===this.shapes.length)&&this.shapes.some((function(n){return n.contains(e,t)}))}}]),e}(),ha=n(113),ga=n(57),fa=function(e){var t=_.lumberMill,n="".concat("/gilles-game","/img/town/town-alpha/").concat(t,".json"),a=new pa(ga,t),r=Object(v.useState)(),o=Object(x.a)(r,2),c=o[0],i=o[1],s=Object(ia.useApp)();Object(v.useEffect)((function(){var e;s.loader.resources[n]?i(null===(e=s.loader.resources[n])||void 0===e?void 0:e.textures):s.loader.add(n).load((function(e,t){var a;i(null===(a=t[n])||void 0===a?void 0:a.textures)}))}),[s,s.loader,n]);var u=Object(v.useState)(0),l=Object(x.a)(u,2),m=l[0],d=l[1];return Object(ia.useTick)((function(e){return d((function(t){return t+.01*e}))})),c?b.a.createElement(ia.Sprite,{name:t,x:403,y:320,interactive:!0,buttonMode:!0,pointertap:function(){e.onStructureClick(t)},hitArea:a,texture:c["structure.png"]},b.a.createElement(ia.Sprite,{name:"blades",texture:c["blades.png"],anchor:new da.Point(.5,.5),x:15,y:10,rotation:m})):null},va=n(114),ba=n(121),ya=n(115),wa=Object(ia.PixiComponent)("ParticleEmitter",{create:function(){return new da.ParticleContainer},applyProps:function(e,t,n){var a=n.image,r=n.config,o=Object(ba.a)(n,["image","config"]);Object(ia.applyDefaultProps)(e,t,o);var c=this._emitter;if(!c){c=new ya.a(e,[da.Texture.from(a)],r);var i=performance.now();c.emit=!0,function e(){c.raf=requestAnimationFrame(e);var t=performance.now();c.update(3e-4*(t-i)),i=t}()}this._emitter=c},willUnmount:function(){this._emitter&&(this._emitter.emit=!1,cancelAnimationFrame(this._emitter.raf))}}),Ea=function(e){var t=_.tavern,n=new pa(ga,t);return b.a.createElement(ia.Sprite,{name:t,x:500,y:469,interactive:!0,buttonMode:!0,pointertap:function(){e.onStructureClick(t)},hitArea:n,image:"".concat("/gilles-game","/img/town/town-alpha/").concat(t,".png")},b.a.createElement(wa,{name:"smoke",x:107,y:-2,image:"".concat("/gilles-game","/img/town/effects/smokeparticle.png"),config:va}))},ka=function(e){b.a.useEffect((function(){yn.addMusicTrack(ln.town,"sound/music/Soliloquy.mp3"),yn.playMusicTrack(ln.town)}),[]);var t=function(t){!a.current&&e.onStructureClick&&e.onStructureClick(t)},n=Object(w.d)((function(e){return e.structures})),a=Object(v.useRef)(!1),r=Object(v.useRef)(null);Object(v.useEffect)((function(){if(r.current){var e=r.current;e.on("drag-start",(function(){a.current=!0})),e.on("drag-end",(function(){a.current=!1}))}var t=function(e){e.preventDefault()};return window.addEventListener("wheel",t,{passive:!1}),function(){window.removeEventListener("wheel",t)}}),[]);return b.a.createElement("div",{className:"town-view"},b.a.createElement(ia.Stage,{width:xr,height:1079,options:{sharedLoader:!0}},b.a.createElement(ma,{screenWidth:xr,screenHeight:1079,worldWidth:1024,worldHeight:1600,ref:r},b.a.createElement(ia.Sprite,{name:"background",image:"".concat("/gilles-game","/img/town/town-alpha/background.png")},[_.workshop,_.quarry,_.tavern,_.tannery,_.alchemist,_.garden,_.weaponsmith,_.armoursmith,_.warehouse,_.mine,_.lumberMill,_.weaver].reverse().map((function(e){var a,r;if(n[e].state===Bn.NotBuilt)return null;switch(e){case _.workshop:a=373,r=610;break;case _.quarry:a=632,r=633;break;case _.tannery:a=372,r=460;break;case _.alchemist:a=411,r=371;break;case _.garden:a=822,r=689;break;case _.weaponsmith:a=449,r=460;break;case _.armoursmith:a=473,r=442;break;case _.warehouse:a=471,r=130;break;case _.mine:a=183,r=527;break;case _.weaver:a=484,r=333}switch(e){case _.lumberMill:return b.a.createElement(fa,{onStructureClick:t,key:e});case _.tavern:return b.a.createElement(Ea,{onStructureClick:t,key:e});default:var o=new pa(ha,e);return b.a.createElement(ia.Sprite,{key:e,name:e,x:a,y:r,interactive:!0,buttonMode:!0,pointertap:function(){t(e)},hitArea:o,image:"".concat("/gilles-game","/img/town/town-alpha/").concat(e,".png")})}}))))))};n(230);!function(e){e[e.questEncounter=0]="questEncounter",e[e.questCompleted=1]="questCompleted",e[e.achievementUnlocked=2]="achievementUnlocked",e[e.cheat=3]="cheat"}(na||(na={}));var Oa=function(e){var t=e.title,n=e.type,a=void 0===n?na.achievementUnlocked:n,r=e.icon,o=void 0===r?"/img/items/quest-items/dragon-eye.png":r,c=_e.get("ui-toast-type-".concat(na[a]));return b.a.createElement("div",{className:"toast"},b.a.createElement("div",{className:"label type"},c),b.a.createElement("div",{className:"label title app-h2-white"},t),b.a.createElement("div",{className:"icon"},b.a.createElement("div",{className:"background"}),b.a.createElement("img",{className:"image",width:"300",alt:"dragon eye",src:"".concat("/gilles-game").concat(o)}),b.a.createElement("div",{className:"foreground"})),b.a.createElement("div",{className:"banner"}))},Ta=function(e){Object(Ye.a)(n,e);var t=Object(Je.a)(n);function n(){return Object(Ae.a)(this,n),t.apply(this,arguments)}return Object(De.a)(n,null,[{key:"addToast",value:function(e,t,n){var a=this;this.stack=[].concat(Object(c.a)(this.stack),[{time:Object(W.now)(),title:e,type:t,icon:n}]),this.emit(this.EVENT_TOASTS_UPDATED,this.stack),setTimeout((function(){a.stack=a.stack.filter((function(e){return Object(W.now)()-e.time<a.lifeTime})),a.emit(a.EVENT_TOASTS_UPDATED,a.stack)}),this.lifeTime)}}]),n}(et());Ta.stack=[],Ta.lifeTime=5e3,Ta.EVENT_TOASTS_UPDATED="toast";var ja,Ia=function(){var e=Object(v.useState)([]),t=Object(x.a)(e,2),n=t[0],a=t[1],r=function(e){a(e)};return Object(v.useEffect)((function(){return Ta.addEventListener(Ta.EVENT_TOASTS_UPDATED,r),function(){Ta.removeEventListener(Ta.EVENT_TOASTS_UPDATED,r)}}),[]),b.a.createElement("div",{className:"toasts"},n.map((function(e){return b.a.createElement(Oa,Object.assign({key:e.time},e))})))};!function(e){e.addWorkers="addWorkers"}(ja||(ja={}));n(104);var xa=function(e){var t=Object(v.useRef)(null),n=Object(v.useState)({gold:50,resources:50,workers:10}),a=Object(x.a)(n,2),r=a[0],o=a[1],c=Object.keys(e.structures).map((function(t){return function(t){var n=se(t),a=e.structures[t],r=n.levels[a.level],o=_e.get(r.displayName);return v.createElement("div",{className:"label-dropdown",key:t},v.createElement("label",{title:t},"".concat(o)),v.createElement("input",{key:t,type:"checkbox",checked:e.structures[t].state===Bn.Built,onChange:function(){return u(t,e.structures[t].state!==Bn.Built)}}))}(t)})),i=function(e){return v.createElement("option",{value:e,key:e},_e.getItemName(e))},s=Object.keys(k).filter((function(e){return!isNaN(e)})).map((function(e){return v.createElement("optgroup",{label:k[e],key:e},function(e){return Object.keys(O).filter((function(t){return qe(t).itemType==e})).map((function(e){return i(e)}))}(e))})),u=function(t,n){e.onCheatStructureState&&e.onCheatStructureState(t,n?Bn.Built:Bn.NotBuilt),n?Ta.addToast("The ".concat(_e.getStructureName(t)," is constructed"),na.cheat):Ta.addToast("The ".concat(_e.getStructureName(t)," is not constructed"),na.cheat)};return v.createElement("div",{className:"cheat-box"},v.createElement("div",{className:"label-numberbox-button"},v.createElement("label",null,"Gold"),v.createElement("input",{type:"number",value:r.gold,style:{width:"50px"},onChange:function(e){var t=Number(e.target.value);o(Object(N.a)({},r,{gold:t}))}}),v.createElement("button",{onClick:function(t){var n=r.gold;e.onCheatGold&&e.onCheatGold(n);var a=_e.get("common-cheat-gold-added",{amount:n});Ta.addToast(a,na.cheat,"/img/resources/gold.png")}},"Add")),v.createElement("div",{className:"label-numberbox-button"},v.createElement("label",null,"Workers"),v.createElement("input",{type:"number",value:r.workers,style:{width:"50px"},onChange:function(e){var t=Number(e.target.value);o(Object(N.a)({},r,{workers:t}))}}),v.createElement("button",{onClick:function(t){var n=r.workers;e.onCheatWorkers&&e.onCheatWorkers(n);var a=_e.get("common-cheat-workers-added",{amount:n});Ta.addToast(a,na.cheat,"/img/resources/worker.png")}},"Add")),v.createElement("div",{className:"label-numberbox-button"},v.createElement("label",null,"Resources"),v.createElement("input",{type:"number",value:r.resources,style:{width:"50px"},onChange:function(e){var t=Number(e.target.value);o(Object(N.a)({},r,{resources:t}))}}),v.createElement("button",{onClick:function(t){e.onCheatResources&&e.onCheatResources(r.resources);var n=_e.get("common-cheat-resources-added",{amount:r.resources});Ta.addToast(n,na.cheat)}},"Add")),v.createElement("div",{className:"label-numberbox-button"},v.createElement("label",null,"Items"),v.createElement("select",{style:{width:"150px"},ref:t},s),v.createElement("button",{onClick:function(n){var a=t.current.value;e.onCheatItem&&e.onCheatItem(a);var r=_e.get("common-cheat-item-added",{item:a}),o=qe(a).iconImg;Ta.addToast(r,na.cheat,o)}},"Add")),c)},Na=[We.food,We.wood,We.stone,We.fabric,We.leather],Ca=Object(kn.c)(Object(w.b)((function(e){return{structures:e.structures}}),(function(e){return{onCheatGold:function(t){e(dt(t)),e(E("common-cheat-gold-added",{amount:t},p.common))},onCheatItem:function(t){e(ht(t)),e(E("common-cheat-item-added",{item:t},p.common))},onCheatResources:function(t){var n=Na.reduce((function(e,n){return e[n]=t,e}),{});e(ft(n)),e(E("common-cheat-resources-added",{amount:t},p.common))},onCheatStructureState:function(t,n){return e(function(e,t){return{type:it.setStructureState,structure:e,state:t}}(t,n))},onCheatWorkers:function(t){var n;e((n=t,{type:ja.addWorkers,value:n})),e(E("common-cheat-workers-added",{amount:t},p.common))}}})),En)(xa),Sa=(n(231),Object(kn.c)(En)((function(e){return v.createElement("div",{className:"settings-window"},v.createElement("details",{open:!0},v.createElement("summary",null,"Sound"),v.createElement("section",null,v.createElement("p",null,v.createElement("label",null,"Music"),v.createElement("input",{type:"range",min:"0",max:"1",step:"0.05",onChange:function(e){var t=parseFloat(e.target.value),n=Math.pow(t,2);yn.musicVolume=n},defaultValue:"".concat(Math.sqrt(yn.musicVolume))})),v.createElement("p",null,v.createElement("label",null,"Sound"),v.createElement("input",{type:"range",min:"0",max:"1",step:"0.1"})))))}))),qa=Object(kn.c)(En,(function(e){return function(t){Object(Ye.a)(a,t);var n=Object(Je.a)(a);function a(){return Object(Ae.a)(this,a),n.apply(this,arguments)}return Object(De.a)(a,[{key:"render",value:function(){var t=this;return v.createElement(Nr.Consumer,null,(function(n){return v.createElement(e,Object.assign({},t.props,n))}))}}]),a}(v.Component)}))((function(e){return v.createElement("div",{className:"menu"},v.createElement("p",null,v.createElement("button",{onClick:function(){var t=v.createElement(Ca,{title:"Cheats"});e.onOpenWindow(t)}},"Cheats!")),v.createElement("p",null,v.createElement("button",{onClick:function(){var t=v.createElement(Sa,{title:"Settings"});e.onOpenWindow(t)}},"Settings")))})),Aa=(n(232),n(233),function(){var e=Object(w.d)((function(e){return{gold:e.gold,resources:e.resources,workers:e.workers,workersFree:Tt(e)}})),t=function(e,t,n){return v.createElement("li",{title:n,key:n},v.createElement("div",{className:"icon common-icon-smallest",style:{backgroundImage:"url(".concat("/gilles-game").concat(e,")")}}),v.createElement("div",{className:"amount"},function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=["","k","M","G","T","P","E"],a=Math.log10(e)/3|0;if(0===a)return"0";var r=n[a],o=Math.pow(10,3*a),c=e/o;return c.toFixed(t)+r}(t)))},n=Na.map((function(n){return t(Ve[n].iconImg,e.resources[n],_e.getResourceName(n))}));return n.push(t("/img/resources/worker.png",e.workersFree,"workers"),t("/img/resources/gold.png",e.gold,"gold")),v.createElement("ul",{className:"resourcebar"},n)}),Da=function(){var e=Object(v.useContext)(Nr);return v.createElement("div",{className:"topbar"},v.createElement("div",{className:"topbar-left"},v.createElement(Aa,null)),v.createElement("div",{className:"topbar-right"},v.createElement("div",{className:"hamburger",onClick:function(t){var n=v.createElement(qa,{title:"Menu"});e.onOpenWindow(n)}},"\u2630")))},Ma=function(e,t,n){return e+n*(t-e)},_a=Object(ia.PixiComponent)("Rectangle",{create:function(e){return new da.Graphics},applyProps:function(e,t,n){var a=n.width,r=n.height,o=n.gridWidth;e.clear(),e.lineStyle(1,11382189,.5);for(var c=0;c<r;c++)e.moveTo(0,c*o),e.lineTo(a,c*o);for(var i=0;i<a;i++)e.moveTo(i*o,0),e.lineTo(i*o,r);e.endFill(),Object.assign(e,{gridWidth:o,worldWidth:a,worldHeight:r})},didMount:function(e,t){var n=new da.Graphics;n.beginFill(5374972),n.drawCircle(0,0,3),n.endFill(),n.x=-999,e.addChild(n);var a=e,r=a.gridWidth,o=a.worldWidth,c=a.worldHeight;t.addListener("clicked",(function(e){var t=Math.round(e.world.x/r)*r,a=Math.round(e.world.y/r)*r;n.x=t,n.y=a;var o=i(t,a);console.log("Node [".concat(o.x,", ").concat(o.y,"]"))}));var i=function(e,t){return{x:(e-Math.floor(o/2))/r,y:(t-Math.floor(c/2))/r}}}}),Ra=function(e){var t=e.quest,n=e.leader,a=e.encounterActive,r=e.position,o=e.onClick,c=e.selected?"/img/world/map-marker-selected.png":"/img/world/map-marker.png",i=Object(v.useRef)(null);return Object(v.useEffect)((function(){var e=i.current,t=new da.Graphics;t.beginFill(12245589),t.drawCircle(0,0,256),t.endFill(),e.mask=t,e.addChild(t)}),[i]),b.a.createElement(ia.Sprite,{image:"".concat("/gilles-game").concat(c),name:t.name,x:r.x,y:r.y,interactive:!0,buttonMode:!0,scale:new da.Point(.1,.1),anchor:new da.Point(.5,1),pointerdown:function(){o&&o(t)}},n&&b.a.createElement(ia.Sprite,{image:"".concat("/gilles-game").concat(n.avatarImg),name:"avatar",anchor:new da.Point(.5,.5),x:0,y:-396,scale:new da.Point(.66,.66),ref:i}),a&&b.a.createElement(ia.Sprite,{image:"".concat("/gilles-game","/img/world/quest-alert.png"),name:"quest-alert",anchor:new da.Point(.5,1),x:180,y:-396,scale:new da.Point(2,2)}))},Wa=function(e){var t=e.positions;return e.positions.length>2?b.a.createElement(ia.Graphics,{name:"questline",x:0,y:0,draw:function(e){e.lineStyle(3,16724736),e.moveTo(t[0].x,t[0].y);var n=0;for(n=1;n<t.length-2;n++){var a=(t[n].x+t[n+1].x)/2,r=(t[n].y+t[n+1].y)/2;e.quadraticCurveTo(t[n].x,t[n].y,a,r)}e.quadraticCurveTo(t[n].x,t[n].y,t[n+1].x,t[n+1].y),e.endFill()}}):null},Ha=function(e){return e.log},Fa=Object(Ot.a)([function(e){return e.quests}],(function(e){return e.filter((function(e){return e.status===Vt.active})).map((function(e){return e}))}));var La,Pa=function(e){var t=e.retrieveWorldViewRef,n=e.smallMap,a=Object(v.useCallback)((function(t){return t.quests.find((function(t){return t.name===e.selectedQuestName}))}),[e.selectedQuestName]),r=Object(w.d)(a),o=Object(w.d)((function(e){return e.adventurers})),c=Object(w.d)((function(e){return Fa(e)})),i=Object(v.useState)(xr),s=Object(x.a)(i,2),u=s[0],l=s[1],m=Object(v.useState)(1024),d=Object(x.a)(m,2),p=d[0],h=d[1];Object(v.useEffect)((function(){var e=function(){var e,a,r=t(),o=(null===(e=r.current)||void 0===e?void 0:e.clientWidth)||xr,c=(null===(a=r.current)||void 0===a?void 0:a.clientHeight)||1024;l(o),h(n?o<576?64:128:c)};return e(),window.addEventListener("resize",e),function(){window.removeEventListener("resize",e)}}),[t,n]),Object(v.useEffect)((function(){r&&f(r)}),[r,p]);var g=Object(v.useRef)(null);Object(v.useEffect)((function(){if(g.current){var e=g.current,t=Ua({x:0,y:0});e.moveCenter(t.x,t.y)}}),[u]);var f=function(e){var t=g.current;if(t){var n=Ba(e),a=Ua(n);t.moveCenter(a.x,a.y)}};return b.a.createElement(ia.Stage,{width:u,height:p},b.a.createElement(ma,{screenWidth:u,screenHeight:p,worldWidth:1500,worldHeight:1061,ref:g},b.a.createElement(ia.Sprite,{image:"".concat("/gilles-game","/img/world/francesca-baerald-fbaerald-angeloumap-lowres.jpg"),interactive:!0,pointerdown:function(){}},c.map((function(e){var t=Ga(e);return b.a.createElement(Wa,{positions:t,key:e.name})})),c.map((function(t){var n=Ba(t),a=Ua(n),c=Rn(o,t),i=Lt(t.name),s=Math.floor(t.progress),u=i.nodes[s];return b.a.createElement(Ra,{quest:t,leader:c,position:a,key:t.name,selected:t===r,encounterActive:u.type===Rt.encounter,onClick:function(t){return n=t.name,void e.onPartyClick(n);var n}})}))),b.a.createElement(_a,{width:1500,height:1061,gridWidth:10})))},Ba=function(e){var t,n,a,r=Lt(e.name),o=Math.floor(e.progress),c=r.nodes[o],i=r.nodes[o+1];return i?(t=c,n=i,a=e.progress-o,{x:Ma(t.x,n.x,a),y:Ma(t.y,n.y,a)}):c},Ua=function(e){var t=10*e.x+750,n=10*e.y+530.5;return new da.Point(t,n)},Ga=function(e){for(var t=[],n=Lt(e.name),a=0;a<e.progress;a++)t.push(Ua(n.nodes[a]));var r=Ua(Ba(e));return t.push(r),t},Va=(n(234),n(235),function(e){var t=e.adventurers,n=e.onAdventurerTabSelected;return b.a.createElement(Cn,{className:"adventurers-tabstrip",onTabSelected:function(t){var a=e.adventurers.find((function(e){return e.id===t}));n(a)}},t.map((function(e){return t=e,b.a.createElement(Nn,{id:t.id,key:t.id},b.a.createElement(Dt,{adventurer:t,className:"common-icon-small"}));var t})))}),Qa=function(e){var t=e.adventurer,n=e.onDropItemEquipment,a=function(e){var a=t.equipment[zt[e]],r=null;if(a){var o=b.a.createRef();r=b.a.createElement(Xt,{index:e,sourceId:t.id,sourceType:Ct.adventurerEquipment,item:a,ref:o,size:Ge.medium})}return b.a.createElement(b.a.Fragment,null,b.a.createElement(Zt,{onDrop:function(t){return n(t,e)},type:e},r),b.a.createElement("span",{className:"info"},_e.get("ui-equipmentslot-".concat(zt[e]))))};return b.a.createElement("ul",null,b.a.createElement("li",null,a(zt.head)),b.a.createElement("li",null,a(zt.shoulders)),b.a.createElement("li",null,a(zt.chest)),b.a.createElement("li",null,a(zt.hands)),b.a.createElement("li",null,a(zt.legs)),b.a.createElement("li",null,a(zt.feet)),b.a.createElement("li",null,a(zt.mainHand)),b.a.createElement("li",null,a(zt.offHand)))},za=function(e){var t=e.adventurer,n=Object(w.c)();return b.a.createElement("div",{className:"adventurer-panel"},b.a.createElement("div",{className:"info"},b.a.createElement("div",{className:"name"},b.a.createElement("b",null,t.name)),b.a.createElement("div",{className:"renderAttributes"},Object.keys(t.stats).map((function(e){var n=t.stats[e];return b.a.createElement("div",{key:"".concat(t.id,"-").concat(e)}," ",b.a.createElement("b",null,e),": ",n.toFixed(1)," ")})))),b.a.createElement("div",{className:"equipment"},b.a.createElement(Qa,{adventurer:t,onDropItemEquipment:function(e,a){var r=e.item,o=[];switch(e.sourceType){case Ct.adventurerInventory:o.push(cn(t.id,e.inventorySlot),sn(t.id,a,r));var c=t.equipment[zt[a]];c&&o.push(on(t.id,c,e.inventorySlot));break;case Ct.warehouse:o.push(gt(e.inventorySlot),sn(t.id,a,r));var i=t.equipment[zt[a]];i&&o.push(ht(i,e.inventorySlot));break;case Ct.adventurerEquipment:o.push(sn(t.id,a,r));var s=t.equipment[zt[a]],u=e.inventorySlot;s?o.push(sn(t.id,u,s)):o.push(un(t.id,u))}o.forEach((function(e){return n(e)}))}})),b.a.createElement("div",{className:"right"},b.a.createElement(nn,{sourceType:Ct.adventurerInventory,sourceId:t.id,items:t.inventory,className:"inventory-medium",onDropItem:function(e,a,r,o,c){var i=[];switch(o){case Ct.adventurerInventory:i.push(rn(t.id,a,r));break;case Ct.warehouse:i.push(gt(a),on(t.id,e,r));var s=t.inventory[r];s&&i.push(ht(s,a));break;case Ct.adventurerEquipment:i.push(on(t.id,e,r));var u=t.inventory[r];u?i.push(sn(t.id,a,u)):i.push(un(t.id,a))}i.forEach((function(e){return n(e)}))}})))},Xa=n(116),Ka=n.n(Xa);function Ja(){if(!La)throw new Error("Call init() before random()");return Za=!0,La()}function Ya(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return e=Math.ceil(e),t=Math.floor(t),Math.floor(Ja()*(t-e+1))+e}var Za=!1,$a=function(){function e(t,n){Object(Ae.a)(this,e),this.questName=void 0,this.store=void 0,this.questName=t,this.store=n}return Object(De.a)(e,[{key:"getAdventurerWithHighest",value:function(e){return _n(this.store.adventurers,this.quest).concat().sort((function(t,n){return n.stats[e]-t.stats[e]}))[0]}},{key:"getAdventurerWithLowest",value:function(e){return _n(this.store.adventurers,this.quest).concat().sort((function(t,n){return t.stats[e]-n.stats[e]}))[0]}},{key:"getRandomAdventurer",value:function(){return this.adventurers[Ya(0,this.adventurers.length)]}},{key:"questVars",get:function(){return this.quest.questVars}},{key:"quest",get:function(){var e=this;return this.store.quests.find((function(t){return t.name===e.questName}))}},{key:"adventurers",get:function(){return _n(this.store.adventurers,this.quest)}}]),e}(),er={},tr={name:_t.backstabbed,getOracle:function(e,t){return new $a(e,t)},getDescription:function(e){return{key:"encounter-backstabbed-description"}},getOptions:function(e){return{fight:"Fight the brigands",flight:"Run away!"}},answer:function(e,t,n){switch(e){case"flight":return"You run away like a pussy";case"fight":var a=t.getRandomAdventurer();return n(on(a.id,O.deedForWeaponsmith)),"The party fights off the rogues. One of them drops a document. ".concat(a.name," picks it up");default:throw new Error("Unhandled option '".concat(e))}}},nr={name:_t.goblinHouseOutside,getOracle:function(e,t){return new $a(e,t)},getDescription:function(e){return{key:"encounter-goblinHouseOutside-description"}},getOptions:function(e){return{investigate:"Investigate",leave:"Keep walking"}},answer:function(e,t,n){var a=t.quest;switch(e){case"investigate":return n(Nt(a.name,_t.goblinHouseHallway)),"The party coutiously opens the door and goes inside";case"leave":return n(Nt(a.name,_t.goblinHouseHallway)),"The party coutiously opens the door and goes inside";default:throw new Error("Unhandled option ".concat(e))}}},ar={backstabbed:tr,goblinHouseHallway:{name:_t.goblinHouseHallway,getOracle:function(e,t){return new $a(e,t)},getDescription:function(e){return{key:"encounter-goblinHouseHallway-description"}},getOptions:function(e){return{investigate:"Go inside the house",leave:"Leave the premise"}},answer:function(e,t,n){t.store,t.questVars,t.quest;switch(e){case"walkAround":return"Your party walks around the tree";case"leave":return n(xt(t.questName)),"The party escapes the house unscathed";default:throw new Error("Unhandled option ".concat(e))}}},goblinHouseOutside:nr,theBigTree:{name:_t.theBigTree,getOracle:function(e,t){return new $a(e,t)},getDescription:function(e){return{key:"encounter-thebigtree-description"}},getOptions:function(e){var t=e.getAdventurerWithHighest("strength");return{walkAround:"Walk around the tree",lift:"Lift the tree (".concat(t.name,")")}},answer:function(e,t,n){var a=t.questVars,r=t.quest;switch(e){case"walkAround":return"Your party walks around the tree";case"lift":var o=t.getAdventurerWithHighest("strength");a.treeState="lifted",n(function(e,t){return{type:jt.updateQuestVars,questName:e,vars:t}}(r.name,a));var c=Ya(2,5);return n(dt(c)),"".concat(o.name," heaves and lifts the heavy tree, moving it aside. Underneath your party finds ").concat(c," gold coins");default:throw new Error("Unhandled option ".concat(e))}}}},rr=ar;var or,cr,ir=n(117),sr=n.n(ir),ur=Object(ia.PixiComponent)("Mesh",{create:function(e){return new da.Mesh(e.geometry,e.shader,e.state,e.drawMode)}});!function(e){e.orthagonal="orthagonal",e.isometric="isometric",e.staggered="staggered",e.hexagonal="hexagonal"}(or||(or={})),function(e){e.rightUp="right-up",e.rightDown="right-down",e.leftUp="left-up",e.leftDown="left-down"}(cr||(cr={}));var lr,mr=function(e){var t=Object(v.useState)(),n=Object(x.a)(t,2),a=n[0],r=n[1],o=e.levelJson;return Object(v.useEffect)((function(){(new da.Loader).add(o).load((function(e){var t=e.resources[o].data,n=sr.a.dirname(o.replace(e.baseUrl,"")),a=t.width,c=t.height,i=vr(t),s=[i.imagewidth/i.tilewidth,i.imageheight/i.tileheight],u=t.layers.map((function(e){var t=[a,c],r=da.BaseTexture.fromBuffer(gr(e,i),a,c),o=da.Texture.from("".concat(n,"/").concat(i.image));return o.baseTexture.scaleMode=da.SCALE_MODES.NEAREST,o.baseTexture.mipmap=da.MIPMAP_MODES.OFF,da.Shader.from(hr,pr,{map:r,image:o,tileSize:s,mapSize:t,view:[0,0,a,c],name:e.name})}));r(u)}))}),[o]),b.a.createElement(ia.Container,null,a&&a.map((function(e){return b.a.createElement(ur,{geometry:dr,shader:e,key:e.uniforms.name})})))},dr=(new da.Geometry).addAttribute("position",[-1,-1,1,-1,-1,1,1,1,-1,1,1,-1]),pr="\n    precision mediump float;\n    uniform sampler2D map, image;\n    uniform vec2 mapSize, tileSize;\n    varying vec2 uv;\n    void main() {\n        vec2 tileCoord = floor(255.0 * texture2D(map, floor(uv) / mapSize).ra);\n        gl_FragColor = texture2D(image, (tileCoord + fract(uv)) / tileSize);\n    }",hr="\n    precision mediump float;\n    attribute vec2 position;\n    uniform vec4 view;\n    varying vec2 uv;\n    void main() {\n        uv = mix(view.xw, view.zy, 0.5 * (1.0 + position));\n        gl_Position = vec4(position, 1, 1);\n    }",gr=function(e,t){var n=t.columns,a=t.imageheight/t.tileheight;console.log(a);var r=e.data.reduce((function(e,t,r){var o=fr(t,n,a),c=o.x,i=o.y;return e[4*r]=c,e[4*r+1]=0,e[4*r+2]=0,e[4*r+3]=i,e}),[]);return new Uint8Array(r)},fr=function(e,t,n){return 0===e?{x:0,y:0}:{x:(e-1)%t,y:Math.floor((e-1)/(n-1))}},vr=function(e){if(!e.tilesets.length)throw new Error("No tilesets found! Can't continue");if(e.tilesets.length>1&&console.warn("Found more than one tileset. But we currently only support one."),e.tilesets[0].source)throw new Error("Please embed tilemaps! Can't continue");return e.tilesets[0]},br=function(e){var t=Object(v.useCallback)((function(t){return t.quests.find((function(t){return t.name===e.questName}))}),[e.questName]),n=Object(w.d)(t),a=Object(w.c)(),r=Object(w.d)((function(e){return t=e,a=n.name,Object(Ot.a)([Ha],(function(e){return e.filter((function(e){return e.channel===p.quest&&e.channelContext===a}))}))(t);var t,a})),o=Lt(n.name),c=Math.floor(n.progress),i=o.nodes[c],s=b.a.createElement("p",null),u=b.a.createElement("p",null),l=function(e,t,r){var o=e.answer(t,r,a),c=function(e,t,n){return{type:jt.updateEncounterResult,questName:e,nodeIndex:t,result:n}}(n.name,n.progress,o);a(c),a(xt(n.name))},m=Object(w.d)((function(e){return e}));switch(i.type){case Rt.nothing:s=b.a.createElement("div",null," ",r&&r.map((function(e){return b.a.createElement("p",{key:e.key},_e.getTextEntry(e))}))," ");break;case Rt.encounter:var d=function(e){return ar[e]}(n.currentEncounter),h=d.getOracle(n.name,m),g=d.getDescription(h),f=_e.getTextEntry(g);s=b.a.createElement("div",null,b.a.createElement("p",null," ",f," "));var y=d.getOptions(h);u=b.a.createElement("ul",null,Object.keys(y).map((function(e){return b.a.createElement("li",{key:e},b.a.createElement("button",{onClick:function(){return l(d,e,h)},"data-tip":!0,"data-for":"global"},e),b.a.createElement("p",null,y[e]))})));break;case Rt.boss:s=b.a.createElement("p",null," ","Boss fight!"," ")}return b.a.createElement("div",null,b.a.createElement("h1",{className:"app-h2"},_e.getQuestTitle(n.name)),b.a.createElement("div",{className:"questlog"},b.a.createElement(ia.Stage,{width:800,height:800},b.a.createElement(mr,{levelJson:"".concat("/gilles-game","/scenes/ork-dungeon-level1.json")})),s,b.a.createElement("div",{className:"actions"},u)))},yr=function(e){var t,n=e.horizontal,a=Object(w.d)((t=e.questName,Object(Ot.a)([Fn,Ln],(function(e,n){var a=n.find((function(e){return e.name===t}));return _n(e,a)})))),r=a[0],o=Object(v.useState)(r.id),c=Object(x.a)(o,2),i=c[0],s=c[1],u=Object(v.useMemo)((function(){return a.find((function(e){return e.id===i}))}),[a,i]);return b.a.createElement("div",{className:"quest-panel ".concat(n?"quest-panel-horizontal":"quest-panel-vertical")},b.a.createElement("div",{className:"quest-area"},b.a.createElement(br,{questName:e.questName})),b.a.createElement("div",{className:"party-area"},b.a.createElement(Va,{adventurers:a,onAdventurerTabSelected:function(e){s(e.id)}}),b.a.createElement("div",{className:"adventurer-details"},u&&b.a.createElement(za,{adventurer:u}))))},wr=function(){var e=Object(v.useRef)(null),t=Object(v.useState)(),n=Object(x.a)(t,2),a=n[0],r=n[1];Object(v.useEffect)((function(){yn.addMusicTrack(ln.world,"sound/music/TheLoomingBattle.ogg"),yn.playMusicTrack(ln.world)}),[]);return b.a.createElement("div",{className:"world-view",ref:e},b.a.createElement(Pa,{selectedQuestName:a,smallMap:null!=a,onPartyClick:function(e){r(e===a?void 0:e),yn.playSound(mn.buttonClick)},retrieveWorldViewRef:function(){return e}}),a&&b.a.createElement(yr,{questName:a}))};n(244);!function(e){e[e.all=0]="all",e[e.town=1]="town",e[e.quest=2]="quest"}(lr||(lr={}));var Er=function(e){var t=Object(v.useState)(!1),n=Object(x.a)(t,2),a=n[0],r=n[1],o=Object(v.useState)("all"),c=Object(x.a)(o,2),i=c[0],s=c[1],u=Object(w.d)((function(e){return e.log})),l=Object(w.d)((function(e){return Fa(e)})),m=[{label:_e.get("common-log-tab-all"),tabId:"all",tabType:lr.all},{label:_e.get("common-log-tab-town"),tabId:"town",tabType:lr.town}];l.forEach((function(e){var t=e.name;m.push({channelContext:t,label:_e.getQuestTitle(t),tabId:"quest-".concat(t),tabType:lr.quest})}));var d=[],h=m.find((function(e){return e.tabId===i}));switch(h.tabType){case lr.all:d=u;break;case lr.town:d=u.filter((function(e){return e.channel===p.town}));break;case lr.quest:d=u.filter((function(e){return e.channel===p.quest&&e.channelContext===h.channelContext}))}var g=m.map((function(e){return v.createElement(Nn,{id:e.tabId,key:e.tabId},e.label)}));return v.createElement("div",{className:"log ".concat(a?"expanded":"")},v.createElement("div",{className:"tab-bar"},v.createElement(Cn,{className:"tabs",onTabSelected:function(e){return function(e){s(e)}(e)}},g),v.createElement(gn,{className:"expand-button",onClick:function(){r(!a)},text:a?"\u25bc":"\u25b2"})),v.createElement("div",{className:"log-entries"},d.map((function(e){return function(e){var t=_e.get(e.key,e.context);return v.createElement("div",{className:"entry",key:e.time},t)}(e)}))))};var kr,Or=Object(w.b)((function(e,t){return{store:e}}),(function(e,t){return{handleStartConstruction:function(t){var n=se(t);e(pt(n.cost.gold||0)),e(function(e){return{type:it.startBuildingStructure,structure:e}}(t));var a=[vt(t)],r=n.cost.time,o=Et(kt.buildStructure,"".concat(t,".build"),"town",r,a);e(o)}}}))((function(e){var t,n=e.info;switch(n.itemType){case k.deed:var a=e.store.gold,r=n,o=se(r.structure),c=o.cost.gold||0<=a,i=!(e.store.structures[r.structure].state===Bn.NotBuilt)||!c;return v.createElement("div",null,v.createElement("p",null,' " ',n.subText,' " '),v.createElement("button",{disabled:i,onClick:function(){return e.handleStartConstruction(r.structure)}},"Start construction (",o.cost.gold," gold)"));case k.weapon:var s=(t=n.item,xe[t]);return v.createElement(v.Fragment,null,v.createElement("p",null,' " ',n.subText,' " '),v.createElement("p",null," damage: ",s.damage[he.kinetic]," "));case k.apparel:var u=function(e){return D[e]}(n.item);return v.createElement(v.Fragment,null,v.createElement("p",null,' " ',n.subText,' " '),u.armourRating&&v.createElement("p",null," armour: ",u.armourRating," "));default:return v.createElement("p",null,' " ',n.subText,' " ')}}));n(245);!function(e){e[e.bottom=0]="bottom",e[e.top=1]="top",e[e.left=2]="left",e[e.right=3]="right"}(kr||(kr={}));var Tr,jr=function(e){var t=e.children,n=e.referenceRect,a=Object(v.useRef)(null),r=Object(v.useState)(e.placement||kr.bottom),o=Object(x.a)(r,2),c=o[0],i=o[1],s=Object(v.useState)(),u=Object(x.a)(s,2),l=u[0],m=u[1];Object(v.useEffect)((function(){var e=a.current;if(e&&l){var t=e.getBoundingClientRect();switch(c){case kr.top:if(t.top-t.height-8-8<l.top)return void i(kr.bottom);break;case kr.bottom:if(t.top+t.height+8+8>l.height)return void i(kr.top)}e.style.opacity="1";var n=e.querySelector(".tooltip-content");if(t.left<l.left+8){var r=l.left-t.left+8;n.style.transform="translateX(".concat(r,"px)")}else if(t.right>l.right-8){var o=t.right-l.right+8;n.style.transform="translateX(".concat(-o,"px)")}else n.style.transform=""}}),[i,l,c,n]);var d=function(){tt.clear()};Object(v.useEffect)((function(){var e,t;return m(null===(e=a.current)||void 0===e||null===(t=e.closest(".app"))||void 0===t?void 0:t.getBoundingClientRect()),window.addEventListener("resize",d),function(){window.removeEventListener("resize",d)}}),[]);var p=0,h=0,g="";if(l)switch(c){case kr.bottom:p=n.left-l.left+n.width/2,h=n.top-l.top+n.height,g="tooltip-bottom";break;case kr.top:p=n.left-l.left+n.width/2,h=n.top-l.top,g="tooltip-top"}return b.a.createElement("div",{className:"tooltip ".concat(g),style:{left:p,opacity:0,top:h},ref:a},b.a.createElement("div",{className:"tooltip-arrow"}),b.a.createElement("div",{className:"tooltip-content"},t))},Ir=(n(246),function(e){var t=Object(v.useState)(),n=Object(x.a)(t,2),a=n[0],r=n[1],o=function(e){r(e)};if(Object(v.useEffect)((function(){return tt.addEventListener(tt.EVENT_CONTEXT_UPDATED,o),function(){tt.removeEventListener(tt.EVENT_CONTEXT_UPDATED,o)}}),[]),!a)return null;var c,i=a.info;switch(a.type){case Ue.item:default:c=b.a.createElement(Or,{info:i})}var s=_e.getItemName(i.item);return b.a.createElement(jr,{referenceRect:a.referenceRect},b.a.createElement("div",{className:"context-tooltip"},b.a.createElement("div",null,s),c))});!function(e){e[e.Town=0]="Town",e[e.World=1]="World"}(Tr||(Tr={}));var xr=960,Nr=Object(v.createContext)(null),Cr=function(e){var t=Object(v.useRef)(null),n=Object(v.useState)([]),a=Object(x.a)(n,2),r=a[0],o=a[1],i=Object(v.useState)([]),s=Object(x.a)(i,2),u=s[0],l=s[1],m=function(){yn.playSound(mn.buttonClick)},d=function(e){if(e){var t=_e.getStructureName(e);p(v.createElement(Xn,{structure:e,title:t})),yn.playSound(mn.buttonClick)}},p=function(e){l([].concat(Object(c.a)(u||[]),[e]))},h=function(){l([])},g=function(){u&&u.length&&l(u.slice(0,-1))};return v.createElement(Nr.Provider,{value:{media:r,onOpenWindow:p}},v.createElement("div",{className:"app",ref:t,style:{maxWidth:xr},onClick:function(){tt.clear()}},v.createElement(Jn.a,{backend:Yn.a},v.createElement(Zn.a,null,v.createElement(ca,{manifest:Kn,onLoadComplete:function(e){var t,n=e.filter((function(e){return e.mediaType===zn.sound}));yn.loadMedia(n),yn.addSounds((t={},Object(I.a)(t,mn.buttonClick,"sound/fx/button-click.ogg"),Object(I.a)(t,mn.error,"sound/fx/error.ogg"),t)),o(e)}},v.createElement(Da,null),v.createElement("div",null,v.createElement($n.d,null,v.createElement($n.b,{path:"/",exact:!0},v.createElement($n.a,{from:"/",to:"world"})),v.createElement($n.b,{path:"/world"},v.createElement(Zn.b,{to:"/town"},v.createElement("button",{onClick:function(){return m()}}," ",_e.get("common-view-button-town")," "))),v.createElement($n.b,{path:"/town"},v.createElement(Zn.b,{to:"/world"},v.createElement("button",{onClick:function(){return m()}}," ",_e.get("common-view-button-world")," "))))," | ",v.createElement("button",{"data-for":"global2","data-tip2":!0,onClick:function(){return e.persistor.purge(),void window.location.reload()},style:{color:"red"}}," Restart! ")),v.createElement($n.d,null,v.createElement($n.b,{path:"/town",component:function(){return v.createElement(ka,{onStructureClick:d})}}),v.createElement($n.b,{path:"/world",component:function(){return v.createElement(wr,null)}})),v.createElement(Er,null),function(){if(!u.length)return null;var e=u[u.length-1],t={onClose:h,onBack:g,backEnabled:u.length>1,closeEnabled:!0};return v.cloneElement(e,t)}(),v.createElement(Ir,null),v.createElement(Ia,null))))))};var Sr=Object(w.b)((function(e,t){return{}}),(function(e,t){return{}}))(Cr),qr=(n(248),function(e){var t=se(_.warehouse),n=e.structures[_.warehouse].level;return t.levels[n].maxResources}),Ar=function(e,t){var n=t.structures,a={},r=(Date.now()-e)/2e4,o=qr(t);return r<1?null:(Object.keys(n).forEach((function(e){return function(e){var t=se(e);if(t.type===A.resource){var o=t,c=n[e].level,i=o.levels[c];Object.keys(i.generates).reduce((function(t,a){var o=i.generates[a]*n[e].workers*r;return t[a]=(t[a]||0)+o,t}),a)}}(e)})),Object.keys(a).forEach((function(e){a[e]&&t.resources[e]+a[e]>=o[e]&&(a[e]=o[e]-t.resources[e])})),a)},Dr=function(e,t){var n=[],a=[];return t.quests.forEach((function(r){if(r.status===Vt.active){var o=Ft[r.name],c=r.progress,i=Math.floor(c);if(o.nodes[i].type===Rt.nothing){for(var s=e/6e4*4,u=Math.min(c+s,o.nodes.length-1),l=Math.floor(u)-i,m=r.currentEncounter,d=1;d<=l;d++){var h=o.nodes[i+d];if(h.type===Rt.encounter){var g=rr[h.encounter],f=er[r.name];u=i+d,m=h.encounter;var v=_e.getQuestTitle(r.name),b=Rn(t.adventurers,r);Ta.addToast(v,na.questEncounter,null===b||void 0===b?void 0:b.avatarImg),n.push(Object(N.a)({channel:p.quest,channelContext:r.name},g.getDescription(f)));break}h.type===Rt.nothing&&(m=null,h.log&&n.push({channel:p.quest,channelContext:r.name,key:h.log}))}a.push({currentEncounter:m,name:r.name,progress:u})}}})),{logUpdates:n,questUpdates:a}},Mr=function(){return Za?(Za=!1,La.state()):null},_r=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function Rr(){if("serviceWorker"in navigator){if(new URL("/gilles-game",window.location.toString()).origin!==window.location.origin)return;window.addEventListener("load",(function(){var e="".concat("/gilles-game","/service-worker.js");_r?(!function(e){fetch(e).then((function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):Wr(e)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")}))):Wr(e)}))}}function Wr(e){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var t=e.installing;t&&(t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}var Hr,Fr=function(){return{strength:100*Math.random(),perception:100*Math.random(),endurance:100*Math.random(),charisma:100*Math.random(),intelligenge:100*Math.random(),agility:100*Math.random(),luck:100*Math.random()}},Lr=[{id:"c4a5d270",equipment:{chest:O.chest,head:O.cowl},stats:Fr(),health:100*Math.random(),room:0,name:"Ximena Maddox",avatarImg:"".concat("/img/avatars","/female/f_14.png"),inventory:[O.deedForLumbermill,null,O.crossbow,O.dagger,O.khopesh,null,O.sword,null,null,null,null,null,null,null,null,null]},{id:"2e655832",equipment:{},stats:Fr(),name:"Donte Houston",health:100*Math.random(),room:1,avatarImg:"".concat("/img/avatars","/male/m_05.png"),inventory:[O.crossbow,null,null,null,null,O.boots1,O.chainmailHood,O.nomadHelmet,O.plateChest4,null,null,null,null,null,null,null,null,null,null,null,null,null,O.plateHelmet,O.cowl]},{id:"ec6f1050",equipment:{},stats:Fr(),name:"Zackary Morris",health:100*Math.random(),room:2,avatarImg:"".concat("/img/avatars","/male/m_09.png"),inventory:[O.greatswordOfGwai,null,null,null]},{id:"d299f98a",stats:Fr(),equipment:{},name:"Mike Keith",health:100*Math.random(),room:4,avatarImg:"".concat("/img/avatars","/male/m_19.png"),inventory:[null,null,null,null,O.khopesh,O.hornedHelmet]},{id:"96c686c3",equipment:{},stats:Fr(),name:"Wayne Monroe",health:100*Math.random(),room:5,avatarImg:"".concat("/img/avatars","/male/m_08.png"),inventory:[null,null,null]},{id:"250d1a9d",stats:Fr(),equipment:{},name:"Alexis Ortiz ",health:100*Math.random(),room:9,avatarImg:"".concat("/img/avatars","/female/f_10.png"),inventory:[null,null,null,null,null]},{id:"169384ef",equipment:{},stats:Fr(),name:"Karlee Nolan",health:100*Math.random(),room:3,avatarImg:"".concat("/img/avatars","/female/f_16.png"),inventory:[O.greatswordOfGwai,null,null,null]},{id:"f22d66cb",stats:Fr(),equipment:{},name:"Gylbarde the Earnest",health:100*Math.random(),room:8,avatarImg:"".concat("/img/avatars","/male/m_09.png"),inventory:[null,null,null,null,null]},{id:"36c686c1",equipment:{},stats:Fr(),name:"Lanslet of the Water",health:100*Math.random(),room:6,avatarImg:"".concat("/img/avatars","/male/m_26.png"),inventory:[O.greatswordOfGwai,null,null,null,O.shoulders1,O.fedora,O.greaves2]},{id:"12c613d4",equipment:{},stats:Fr(),name:"Tedric the Bold",health:100*Math.random(),room:7,avatarImg:"".concat("/img/avatars","/male/m_33.png"),inventory:[O.greatswordOfGwai,null,null,null]}],Pr={lastTick:Date.now(),lastProducedUpdate:Date.now()},Br=[null,null,null,O.dagger,O.deedForWeaponsmith,null,O.sandwich,O.sandwich,null,null,O.torch,O.torch,null,O.torch],Ur=function(e,t){if(!t.log.length)return e;var n=t.log.map((function(e){return Object(N.a)({},e,{time:Date.now()})}));return[].concat(Object(c.a)(n),Object(c.a)(e))},Gr=[{name:"kill10Boars",status:Vt.active,party:["c4a5d270","2e655832","ec6f1050","d299f98a"],progress:0,questVars:{},encounterResults:[],icon:"sigil1.png",currentEncounter:null},{name:"retrieveMagicAmulet",party:[],status:Vt.available,progress:0,questVars:{},encounterResults:[],icon:"sigil2.png",currentEncounter:null,reward:{gold:4,items:[O.deedForWeaponsmith]}}],Vr=function(e,t){var n=t.assignedAventurers.filter((function(e){return!!e})).map((function(e){return e.id}));return e.map((function(e){return e.name===t.questName?Object(N.a)({},e,{status:Vt.active,party:n}):e}))},Qr=function(e,t){return e.map((function(e){if(e.name===t.questName){var n=e.progress+1;return Object(N.a)({},e,{progress:n})}return e}))},zr=function(e,t){return e.map((function(e){return e.name===t.questName?Object(N.a)({},e,{currentEncounter:t.encounter}):e}))},Xr=function(e,t){var n=t.quests;return n.length?e.map((function(e){var t=n.find((function(t){return t.name===e.name}));if(t){var a=t.progress,r=t.currentEncounter;return Object(N.a)({},e,{progress:a,currentEncounter:r})}return e})):e},Kr=function(e,t){return e.map((function(e){if(e.name===t.questName){var n=Object.assign({},e.questVars,t.vars);return Object(N.a)({},e,{questVars:n})}return e}))},Jr=function(e,t){return e.map((function(e){if(e.name===t.questName){var n=e.encounterResults.concat();return n[t.nodeIndex]=t.result,Object(N.a)({},e,{encounterResults:n})}return e}))},Yr=(Hr={},Object(I.a)(Hr,_.alchemist,{level:0,workers:1,state:Bn.NotBuilt}),Object(I.a)(Hr,_.armoursmith,Gn),Object(I.a)(Hr,_.garden,{level:0,workers:0,state:Bn.Built}),Object(I.a)(Hr,_.lumberMill,Gn),Object(I.a)(Hr,_.mine,{level:0,workers:0,state:Bn.NotBuilt}),Object(I.a)(Hr,_.quarry,Gn),Object(I.a)(Hr,_.tavern,{level:0,workers:0,state:Bn.Built}),Object(I.a)(Hr,_.tannery,Gn),Object(I.a)(Hr,_.warehouse,{level:0,workers:0,state:Bn.Built}),Object(I.a)(Hr,_.weaponsmith,{level:0,workers:0,state:Bn.Built}),Object(I.a)(Hr,_.weaver,Gn),Object(I.a)(Hr,_.workshop,Gn),Hr),Zr=function(e,t,n){var a=Object(N.a)({},e[t],{state:n});return Object(N.a)({},e,Object(I.a)({},t,a))},$r={completed:[],running:[]},eo=function(e){return{name:e.name,origin:e.origin,type:e.taskType,callbacks:e.callbacks,timeRemaining:e.time,startTime:Date.now(),lastTick:Date.now(),progress:0}},to=Object(kn.b)({adventurers:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Lr,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Jt.moveItemInInventory:var n=t,a=n.adventurerId,r=n.fromSlot,o=n.toSlot,c=e.find((function(e){return e.id===a})),i=c.inventory.map((function(e,t){return t===r?c.inventory[o]:t===o?c.inventory[r]:e}));return e.map((function(e){return e===c?Object(N.a)({},e,{inventory:i}):e}));case Jt.moveItemToOtherAdventurer:var s=t,u=s.adventurerId,l=s.fromSlot,m=s.toAdventurerId,d=e.find((function(e){return e.id===u})),p=d.inventory[l];return e.map((function(e){if(e.id===u){var t=e.inventory.concat();return t[l]=null,Object(N.a)({},e,{inventory:t})}if(e.id===m){var n=e.inventory.concat(),a=n.findIndex((function(e){return null===e}));return n[a]=p,Object(N.a)({},e,{inventory:n})}return e}));case Jt.addItemToInventory:var h=t,g=h.item;return e.map((function(e){if(e.id===t.adventurerId){var n=e.inventory.concat(),a=t.toSlot;return null===a&&(a=n.findIndex((function(e){return null===e||void 0===e}))),n[a]=g,Object(N.a)({},e,{inventory:n})}return e}));case Jt.removeItemFromInventory:var f=t,v=f.fromSlot;return e.map((function(e){if(e.id===t.adventurerId){var n=e.inventory.map((function(e,t){return t!==v?e:null}));return Object(N.a)({},e,{inventory:n})}return e}));case Jt.assignEquipment:var b=t,y=b.equipmentSlot,w=b.item;return e.map((function(e){return e.id===t.adventurerId?Object(N.a)({},e,{equipment:Object(N.a)({},e.equipment,Object(I.a)({},zt[y],w))}):e}));case Jt.removeEquipment:var E=t,k=E.equipmentSlot;return e.map((function(e){return e.id===t.adventurerId?Object(N.a)({},e,{equipment:Object(N.a)({},e.equipment,Object(I.a)({},zt[k],null))}):e}))}return e},combat:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case a.startCombatAction:var n=t;return Object(N.a)({},e,{action:{actor:n.actor,endsAt:n.endsAt,target:n.target,type:n.combatType}});case a.moveActor:var r=t,o=e.actors.map((function(e){return e.name===r.actor?Object(N.a)({},e,{location:r.location}):e}));return Object(N.a)({},e,{actors:o});case a.clearCombatAction:return Object(N.a)({},e,{action:void 0})}return e},engine:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Pr,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case d.gameTick:var n=t.resources,a=null===n?e.lastProducedUpdate:Date.now();return Object(N.a)({},e,{lastProducedUpdate:a,lastTick:Date.now()})}return e},gold:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case rt.addGold:return e+t.amount}return e},stockpile:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Br,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case ot.addItem:var n=t,a=n.item,r=t,o=r.toSlot;return void 0===o&&-1===(o=e.findIndex((function(e){return null===e})))?[].concat(Object(c.a)(e),[a]):e.map((function(e,t){return t===o?a:e}));case ot.moveItemInWarehouse:var i=t,s=i.fromSlot,u=i.toSlot;return e.map((function(t,n){return n===s?null:n===u?e[s]:t}));case ot.removeItem:var l=t,m=l.fromSlot;return e.map((function(e,t){return t!==m?e:null}))}return e},log:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case h.addLogEntry:var n=t,a=n.key,r=n.channel,o=n.channelContext,i=n.context,s=Date.now();return[{channel:r,channelContext:o,context:i,key:a,time:s}].concat(Object(c.a)(e));case d.gameTick:return Ur(e,t)}return e},quests:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Gr,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case jt.launchQuest:return Vr(e,t);case jt.advanceQuest:return Qr(e,t);case jt.updateQuestVars:return Kr(e,t);case jt.updateEncounterResult:return Jr(e,t);case jt.startEncounter:return zr(e,t);case d.gameTick:return Xr(e,t)}return e},resources:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:qn,t=arguments.length>1?arguments[1]:void 0,n=function(t){return Object.keys(e).reduce((function(n,a){return n[a]=e[a]+(t[a]||0),n}),{})};switch(t.type){case ct.addResources:var a=t.resources;return n(a);case ct.removeResources:var r=t.resources;return Object.keys(e).reduce((function(t,n){return t[n]=e[n]-(r[n]||0),t}),{});case d.gameTick:var o=t.resources;return null===o?e:n(o)}return e},rngState:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;return t.type===d.gameTick&&null!=t.rngState&&(e=Object.assign({},t.rngState)),e},structures:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Yr,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case it.startBuildingStructure:return Zr(e,t.structure,Bn.Building);case it.finishBuildingStructure:return Zr(e,t.structure,Bn.Built);case it.upgradeStructure:var n=e[t.structure].level+1,a=Object(N.a)({},e[t.structure],{level:n});return Object(N.a)({},e,Object(I.a)({},t.structure,a));case it.increaseWorkers:var r=t,o=r.workers,c=e[t.structure].workers+o,i=Object(N.a)({},e[t.structure],{workers:c});return Object(N.a)({},e,Object(I.a)({},t.structure,i));case it.decreaseWorkers:var s=t,u=s.workers,l=e[t.structure].workers-u,m=Object(N.a)({},e[t.structure],{workers:l});return Object(N.a)({},e,Object(I.a)({},t.structure,m));case it.setStructureState:var d=t,p=d.state;return Zr(e,t.structure,p)}return e},tasks:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:$r,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case st.start:var n=eo(t),a=e.running.concat(n);return Object(N.a)({},e,{running:a});case d.gameTick:var r=Date.now(),o=[],c=[];return e.running.forEach((function(e){var t=r+e.timeRemaining,n=(r-e.startTime)/(t-e.startTime),a=e.timeRemaining-(r-e.lastTick),i=Object(N.a)({},e,{progress:n,lastTick:r,timeRemaining:a});a<0?c.push(i):o.push(i)})),{running:o,completed:c}}return e},workers:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:13,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case ja.addWorkers:return e+t.value}return e}}),no=n(71),ao=n(119),ro={key:"root",storage:n.n(ao).a,version:j},oo=Object(no.a)(ro,to),co=Object(u.a)(s.a.mark((function e(){var t,n=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},e.abrupt("return",new Promise((function(e,n){var a=Object(kn.d)(oo,t,window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__()),r=Object(no.b)(a,void 0,(function(){var t=Hn(a.getState());e({store:a,persistor:r,isHydrated:t})}))})));case 2:case"end":return e.stop()}}),e)}))),io=function(){var e=Object(u.a)(s.a.mark((function e(){var t,n,a,r,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.a.get("".concat("/gilles-game","/lang/en-US.json"));case 2:return t=e.sent,n=t.data,_e.init(n),c="GILLESROX2",Za=!0,La=Ka()(c,{state:!0}),e.next=8,co();case 8:a=e.sent,r=a.store,o=a.persistor,a.isHydrated?uo(r):so(r),lo(r,o);case 14:case"end":return e.stop()}var c}),e)})));return function(){return e.apply(this,arguments)}}(),so=function(e){e.dispatch(E("test-game-welcome")),console.log("Starting new GILLES-IDLE-GAME (version ".concat("0.0.4",")"))},uo=function(e){console.log("Continuing existing GILLES-IDLE-GAME (version ".concat("0.0.4",")"))},lo=function(e,t){y.render(v.createElement(w.a,{store:e},v.createElement(Sr,{persistor:t})),document.getElementById("root")),Rr();var n=function(t){t.completed.forEach((function(t){return function(t){t.callbacks.forEach((function(t){return e.dispatch(t)}))}(t)}))};setInterval((function(){var t=e.getState(),a=Date.now()-t.engine.lastTick,r=[],o=Ar(t.engine.lastProducedUpdate,t),i=Mr();f(a,e);var s=Dr(a,t),u=s.questUpdates,l=s.logUpdates;r.push.apply(r,Object(c.a)(l)),e.dispatch(function(e,t,n,a,r){return{type:d.gameTick,delta:e,rngState:t,resources:n,quests:a,log:r}}(a,i,o,u,r)),n(t.tasks)}),2500)};io()},43:function(e,t,n){},57:function(e){e.exports=JSON.parse('{"alchemist":[{"shape":[34,18,31,1,37,0]},{"shape":[37,0,53,5,45,17]},{"shape":[45,17,68,27,81,48]},{"shape":[72,67,75,168,11,168]},{"shape":[9,65,1,45,10,30]},{"shape":[31,19,29,5,45,0]},{"shape":[45,0,34,18,37,0]},{"shape":[45,17,81,48,72,67]},{"shape":[72,67,11,168,9,65]},{"shape":[9,65,10,30,31,19]},{"shape":[45,17,72,67,9,65]},{"shape":[9,65,31,19,45,0]},{"shape":[37,0,45,17,9,65]}],"garden":[{"shape":[48,45,48,0,58,0]},{"shape":[57,41,75,56,73,78]},{"shape":[73,78,11,68,2,56]},{"shape":[2,56,13,45,48,45]},{"shape":[48,45,58,0,57,41]},{"shape":[73,78,2,56,48,45]},{"shape":[48,45,57,41,73,78]}],"armoursmith":[{"shape":[53,1,55,0,93,5]},{"shape":[93,5,112,11,120,20]},{"shape":[120,20,124,36,119,49]},{"shape":[119,49,122,156,75,149]},{"shape":[75,149,57,135,33,104]},{"shape":[33,104,10,95,11,52]},{"shape":[11,52,0,35,2,20]},{"shape":[2,20,6,14,27,5]},{"shape":[27,5,53,1,93,5]},{"shape":[93,5,120,20,119,49]},{"shape":[119,49,75,149,33,104]},{"shape":[33,104,11,52,2,20]},{"shape":[2,20,27,5,93,5]},{"shape":[93,5,119,49,33,104]},{"shape":[33,104,2,20,93,5]}],"lumberMill":[{"shape":[32,11,43,1,45,0]},{"shape":[45,0,49,4,37,18]},{"shape":[39,29,50,44,49,48]},{"shape":[38,46,38,230,17,233]},{"shape":[17,233,13,232,13,48]},{"shape":[13,48,3,48,14,28]},{"shape":[14,28,1,7,6,4]},{"shape":[31,18,32,11,45,0]},{"shape":[39,29,49,48,40,43]},{"shape":[38,46,17,233,13,48]},{"shape":[14,28,6,4,19,18]},{"shape":[31,18,45,0,37,18]},{"shape":[37,18,39,29,40,43]},{"shape":[40,43,38,46,13,48]},{"shape":[13,48,14,28,19,18]},{"shape":[31,18,37,18,40,43]},{"shape":[40,43,13,48,19,18]},{"shape":[19,18,31,18,40,43]}],"mine":[{"shape":[15,0,79,1,88,13]},{"shape":[88,13,78,66,27,70]},{"shape":[27,70,2,50,11,27]},{"shape":[11,27,6,13,15,0]},{"shape":[15,0,88,13,27,70]},{"shape":[27,70,11,27,15,0]}],"quarry":[{"shape":[2,24,20,2,22,0]},{"shape":[22,0,103,2,117,15]},{"shape":[117,15,124,24,112,24]},{"shape":[112,24,112,64,104,70]},{"shape":[104,70,104,89,97,88]},{"shape":[97,68,66,67,60,43]},{"shape":[60,43,17,42,17,26]},{"shape":[17,26,2,24,22,0]},{"shape":[22,0,117,15,112,24]},{"shape":[112,24,104,70,97,88]},{"shape":[60,43,17,26,22,0]},{"shape":[112,24,97,88,97,68]},{"shape":[97,68,60,43,22,0]},{"shape":[22,0,112,24,97,68]}],"tannery":[{"shape":[4,2,4,0,61,1]},{"shape":[59,36,89,37,85,79]},{"shape":[85,79,15,77,15,47]},{"shape":[15,47,5,35,0,9]},{"shape":[0,9,4,2,61,1]},{"shape":[59,36,85,79,15,47]},{"shape":[15,47,0,9,61,1]},{"shape":[61,1,59,36,15,47]}],"tavern":[{"shape":[110,27,108,24,112,23]},{"shape":[112,23,151,27,148,60]},{"shape":[148,60,137,71,133,67]},{"shape":[133,67,136,69,132,75]},{"shape":[132,75,137,77,138,124]},{"shape":[131,131,136,136,55,119]},{"shape":[29,64,6,72,0,69]},{"shape":[27,56,76,61,85,67]},{"shape":[101,25,108,13,112,17]},{"shape":[112,17,102,18,104,6]},{"shape":[110,27,112,23,148,60]},{"shape":[132,75,138,124,131,131]},{"shape":[131,131,55,119,59,118]},{"shape":[29,64,0,69,27,56]},{"shape":[112,17,104,6,111,9]},{"shape":[92,27,110,27,148,60]},{"shape":[132,75,131,131,59,118]},{"shape":[50,68,29,64,27,56]},{"shape":[92,27,148,60,133,67]},{"shape":[133,67,132,75,59,118]},{"shape":[50,68,27,56,85,67]},{"shape":[133,67,59,118,56,72]},{"shape":[56,72,50,68,85,67]},{"shape":[133,67,56,72,85,67]},{"shape":[133,67,85,67,89,60]},{"shape":[92,27,133,67,89,60]},{"shape":[92,27,89,60,86,25]},{"shape":[104,0,92,27,86,25]}],"warehouse":[{"shape":[36,414,3,409,2,13]},{"shape":[2,13,31,-7,63,7]},{"shape":[62,197,63,126,65,218]},{"shape":[61,262,83,272,84,459]},{"shape":[84,459,36,414,2,13]},{"shape":[2,13,63,7,62,197]},{"shape":[62,197,65,218,61,262]},{"shape":[61,262,84,459,2,13]},{"shape":[2,13,62,197,61,262]}],"weaponsmith":[{"shape":[52,18,50,2,50,0]},{"shape":[50,0,114,1,109,49]},{"shape":[109,49,115,132,98,129]},{"shape":[98,129,66,95,65,34]},{"shape":[11,33,11,77,0,77]},{"shape":[0,29,18,18,52,18]},{"shape":[52,18,50,0,109,49]},{"shape":[109,49,98,129,65,34]},{"shape":[11,33,0,77,0,29]},{"shape":[52,18,109,49,65,34]},{"shape":[15,27,11,33,0,29]},{"shape":[52,18,65,34,53,26]},{"shape":[15,27,0,29,52,18]},{"shape":[52,18,53,26,15,27]}],"weaver":[{"shape":[51,41,54,0,55,6]},{"shape":[55,41,82,53,87,63]},{"shape":[87,63,86,259,62,254]},{"shape":[62,254,23,212,21,61]},{"shape":[21,61,2,56,51,41]},{"shape":[51,41,55,6,55,41]},{"shape":[55,41,87,63,62,254]},{"shape":[62,254,21,61,51,41]},{"shape":[51,41,55,41,62,254]}],"workshop":[{"shape":[11,2,13,0,68,3]},{"shape":[68,3,77,12,70,14]},{"shape":[70,14,69,38,10,37]},{"shape":[9,13,1,12,11,2]},{"shape":[11,2,68,3,70,14]},{"shape":[70,14,10,37,9,13]},{"shape":[9,13,11,2,70,14]}]}')},63:function(e,t,n){}},[[123,1,2]]]);
//# sourceMappingURL=main.b541df35.chunk.js.map