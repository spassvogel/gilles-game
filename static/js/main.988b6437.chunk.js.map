{"version":3,"sources":["definitions/items/types.ts","global/SceneControllerManager.ts","components/ui/EquipmentSlot/index.tsx","definitions/items/apparel.ts","global/EventEmitter.ts","definitions/quests/kill10Boars/questVars.ts","constants/tiledMapData.ts","utils/format/time.ts","definitions/quests/types.ts","global/SoundManager.ts","actions/quests.ts","constants/dragging.ts","components/App/styles/img/cursors/dwarven_gauntlet_extra_6.png","definitions/items/weapons.ts","utils/routing.ts","constants/items.ts","definitions/structures/types.ts","definitions/resources.ts","actions/adventurers.ts","stores/logEntry.ts","global/ToastManager.tsx","components/ui/toasts/Toast.tsx","definitions/items/deeds.ts","definitions/items/materials.ts","definitions/items/questItems.ts","definitions/items/trinkets.ts","definitions/items/index.ts","actions/log.ts","actions/combat.ts","stores/combat.ts","actions/game.ts","mechanics/gameTick/combat.ts","components/preloading/Preloader.tsx","constants/version.tsx","utils/version.ts","components/preloading/Indicator.tsx","stores/structure.ts","components/ui/buttons/Button/index.tsx","utils/hitAreaShapes.ts","components/town/structures/LumberMill/index.tsx","components/pixi/ParticleEmitter.ts","components/town/structures/Tavern/index.tsx","hoc/withAppContext.tsx","components/town/structures/Generic/index.tsx","components/town/Legenda/index.tsx","components/pixi/Viewport.tsx","components/town/TownStage.tsx","components/town/TownView.tsx","components/ui/toasts/Toasts.tsx","actions/resources.ts","actions/structures.ts","components/ui/window/Window.tsx","hoc/withWindow.tsx","components/ui/window/windows/SettingsWindow.tsx","constants/resources.ts","actions/items.ts","actions/index.ts","constants/context.ts","components/ui/window/windows/CheatWindow.tsx","components/ui/window/windows/MenuWindow.tsx","utils/format/number.ts","global/TooltipManager.ts","hooks/store/useGoldState.ts","constants/icons.ts","hooks/store/useResourcesState.ts","selectors/workers.ts","hooks/store/useWorkersState.ts","components/ui/topbar/Resourcebar.tsx","components/ui/topbar/Topbar.tsx","components/world/WorldMap/QuestMarker.tsx","stores/quest.ts","components/world/WorldMap/QuestLine.tsx","selectors/quests.ts","components/world/WorldMap/index.tsx","components/ui/tabs/Tabstrip.tsx","components/ui/tabs/Tab.tsx","components/ui/adventurer/AdventurerAvatar/index.tsx","components/world/QuestPanel/AdventurerTabstrip.tsx","selectors/adventurers.ts","components/ui/ItemIcon/index.tsx","components/ui/DraggableItemIcon.tsx","definitions/traits/types.ts","hooks/store/adventurers.ts","components/world/QuestPanel/AdventurerEquipment/Guy/index.tsx","components/world/QuestPanel/AdventurerEquipment/index.tsx","components/ui/inventory/InventorySlot.tsx","components/ui/inventory/Inventory.tsx","hooks/store/useStockpileState.ts","components/world/QuestPanel/context/SceneControllerContext.tsx","hooks/actions/useItemActions.ts","definitions/traits/index.ts","components/world/QuestPanel/AdventurerTraits/index.tsx","components/world/QuestPanel/AdventurerSkills/index.tsx","mechanics/adventurers/levels.ts","components/ui/Progressbar/index.tsx","components/ui/adventurer/AdventurerInfo/Level.tsx","hooks/store/useQuest.ts","components/world/QuestPanel/AdventurerPanel.tsx","components/pixi/tile/RectTileLayer.tsx","stores/scene.ts","components/world/QuestPanel/QuestDetails/scene/Tilemap.tsx","components/pixi/util/BridgedStage.tsx","components/world/QuestPanel/QuestDetails/scene/SceneActor.tsx","components/world/QuestPanel/QuestDetails/scene/SpriteAnimated.tsx","components/world/QuestPanel/QuestDetails/scene/ActionPath.tsx","components/world/QuestPanel/QuestDetails/scene/ActionPoints.tsx","components/world/QuestPanel/QuestDetails/scene/SceneAdventurer.tsx","hooks/useTilesetsLoader.ts","components/world/QuestPanel/QuestDetails/scene/SceneObjectWrapper.tsx","components/world/QuestPanel/QuestDetails/scene/renderObject.tsx","components/world/QuestPanel/QuestDetails/scene/Scene.tsx","components/world/QuestPanel/index.tsx","components/world/QuestPanel/QuestDetails/OnTheRoad.tsx","components/world/QuestPanel/QuestDetails/index.tsx","components/ui/items/DraggableItemsList/index.tsx","components/world/QuestPanel/modals/LootCache/index.tsx","components/world/QuestPanel/modals/Situation/index.tsx","components/world/QuestPanel/CombatBar/index.tsx","components/log/SimpleLog.tsx","components/world/WorldView.tsx","actions/tasks.ts","stores/task.ts","hooks/store/useStructureState.ts","components/ui/tooltip/context/ItemContext/DeedContent.tsx","definitions/production/weaponsmith.ts","definitions/production/armoursmith.ts","components/ui/tooltip/Tooltip/index.tsx","definitions/production/workshop.ts","definitions/production/alchemist.ts","definitions/production/index.ts","selectors/tasks.ts","hooks/store/useTasksState.ts","mechanics/studying.ts","components/ui/tooltip/context/ItemContext/ProduceOrStudy.tsx","components/ui/tooltip/context/ItemContext/WeaponContent.tsx","components/ui/tooltip/context/ItemContext/ApparelContent.tsx","components/ui/tooltip/context/ItemContext/index.tsx","components/ui/tooltip/context/ResourceContext/index.tsx","components/ui/tooltip/context/TraitContext/index.tsx","components/ui/tooltip/ContextTooltip/index.tsx","components/Background/index.tsx","components/App/manifest/app.ts","mechanics/crafting.ts","components/ui/UpDownValue.tsx","components/structures/StructureViewHeader.tsx","components/ui/resources/ResourcesCostBox.tsx","components/ui/items/ItemsBox.tsx","components/structures/ProductionStructureView.tsx","components/ui/resources/ResourcesBox.tsx","hooks/usePrevious.ts","stores/resources.ts","hooks/actions/useStructureActions.ts","components/ui/adventurer/AdventurerInfo/index.tsx","components/structures/warehouse/WarehouseStructureView.tsx","components/ui/adventurer/DroppableAdventurerSlot/index.tsx","components/structures/tavern/AssignAdventurers.tsx","components/structures/tavern/QuestBoard.tsx","components/structures/tavern/AdventurerButton.tsx","components/ui/adventurer/DraggableAdventurerAvatar/index.tsx","components/App/index.tsx","components/structures/tavern/RoomWithAdventurer.tsx","components/structures/tavern/RoomEmpty.tsx","components/structures/tavern/RoomList.tsx","components/structures/tavern/TavernStructureView.tsx","components/structures/ResourceStructureView.tsx","components/town/StructureDetailsView/index.tsx","containers/App.tsx","utils/random.ts","mechanics/gameTick/producedResources.ts","mechanics/gameTick/quests.ts","mechanics/gameTick/rngState.ts","registerServiceWorker.ts","reducers/adventurers.ts","index.tsx","stores/engine.ts","reducers/items.ts","reducers/log.ts","reducers/quests.ts","stores/structures.ts","reducers/structures.ts","stores/tasks.ts","reducers/tasks.ts","reducers/index.ts","reducers/combat.ts","reducers/engine.ts","reducers/gold.ts","reducers/resources.ts","reducers/rngState.ts","reducers/workers.ts","utils/configureStore.ts","mechanics/gameTick/tasks.ts","utils/tilemap.ts","constants/text.ts","mechanics/scenes/BaseSceneController.ts","mechanics/scenes/actionPoints.ts","definitions/quests/kill10Boars/encounters/dungeon.ts","actions/gold.ts","definitions/quests/kill10Boars/index.ts","definitions/quests/index.ts","definitions/quests/retrieveMagicAmulet/index.ts","storeHelpers/index.ts","global/TextManager.ts","utils/math.ts","utils/pixiJs.ts","definitions/structures/index.ts","definitions/structures/alchemist.ts","definitions/structures/armoursmith.ts","definitions/structures/garden.ts","definitions/structures/lumberMill.ts","definitions/structures/mine.ts","definitions/structures/quarry.ts","definitions/structures/tannery.ts","definitions/structures/tavern.ts","definitions/structures/warehouse.ts","definitions/structures/weaponsmith.ts","definitions/structures/weaver.ts","definitions/structures/workshop.ts"],"names":["ItemType","Item","SceneControllerManager","questName","sceneName","controllerType","this","controllerTypes","store","Error","require","EquipmentSlotType","dropTarget","drop","props","monitor","onDrop","getItem","canDrop","item","itemAndEquipmentSlotMatch","type","equipmentSlotType","chest","feet","hands","head","legs","checkEquipment","mainHand","offHand","itemDefinition","getDefinition","itemType","weapon","typeClassifications","weaponType","WeaponClassification","oneHanded","shield","DropTarget","DragType","ITEM","connect","connectDropTarget","isOver","borderColor","className","style","title","children","equipmentType","apparel","basePath","all","boots1","iconImg","boots2","damageReduction","boots3","chainmailHood","clothGloves","cowl","druidChest","druidHands","druidFeet","druidHead","druidLegs","fedora","greaves1","greaves2","hornedHelmet","leatherGloves","nomadHelmet","pants1","pants2","plateChest1","plateChest2","plateChest3","plateChest4","plateGloves1","plateGloves2","plateHelmet","platePants","plateShoulders1","shoulders","plateShoulders2","robe","shoulders1","shoulders2","shoulders3","vest","eventEmitter","EventEmitter","eventName","listener","events","push","i","length","splice","event","forEach","fn","initialQuestVars","dungeon","entered","lootCaches","items","teeth","poisonVial","gold","altar","bolts","letters","situations","candleLit","TiledLayerType","Orientation","RenderOrder","ONE_MINUTE","TWO_MINUTES","HALF_HOUR","ONE_HOUR","ONE_DAY","ONE_YEAR","formatDuration","ms","short","timeUnitsList","unit","amount","time","Math","abs","output","el","tmp","floor","TextManager","get","join","QuestNodeType","MusicTrack","Sound","media","musicTracks","currentMusicTrack","sounds","SoundManager","localforage","_musicVolume","_soundVolume","_initialized","m","soundList","Object","entries","key","value","find","url","content","sound","howl","volume","soundVolume","play","track","init","hasOwnProperty","fade","musicVolume","nextMusic","playing","loop","setItem","ActionType","launchQuest","assignedAventurers","exitEncounter","quest","updateQuestVars","vars","setSceneName","setScene","scene","enqueueSceneAction","sceneAction","completeSceneAction","deductActorAp","actor","ap","updateSceneObject","id","object","updateSceneObjectAction","setActiveSceneInteractionModal","sceneInteractionModal","DragSourceType","ADVENTURER","module","exports","WeaponType","DamageType","axe","bow","club","crossbow","fist","flail","hammer","knife","staff","twoHanded","sword","poleArm","weaponDefinitions","aegisOfValor","rarity","Rarity","legendary","arbalest","epic","damage","kinetic","battleAxe","common","berserkerShield","brassKnuckles","buckler","cleaver","dagger","uncommon","goldenShield","rare","greatswordOfGwai","unique","indomitableCarapace","javelin","khopesh","longbow","mace","morningStar","paintedBuckler","poisonedDagger","ravenStaff","savageStaff","simpleCrossbow","spear","steelShield","warhammer","woodenBulwark","getWorldLink","getQuestLink","getTownLink","getStructureLink","structure","getIconClassName","getItemNameClassName","StructureType","Resource","wood","resource","iron","stone","leather","fabric","food","moveItemInInventory","adventurerId","fromSlot","toSlot","addItemToInventory","removeItemFromInventory","assignEquipment","equipmentSlot","removeEquipment","LogChannel","ToastManager","icon","link","stack","Date","now","emit","EVENT_TOASTS_UPDATED","playSound","toast","setTimeout","filter","lifeTime","Type","Toast","achievementUnlocked","history","useHistory","typeText","getToastType","onClick","width","alt","src","process","deed","deedForLumbermill","Structure","lumberMill","deedForWeaponsmith","weaponsmith","material","arrowheads","buckle","chain","cogs","gem","ingot","nails","ribbon","rope","gunpowder","scales","spring","thread","questItem","questItemDefinitions","blueprints","crate","dynamite","dragonEye","eye","feather","heart","horn","lockPicks","oil","orcFinger","plans","purpleGems","runestone","sandwich","tooth","torch","tusk","vase","vial","weeds","trinket","trinketDefinitions","magicAmulet","ring","deeds","materials","questItems","trinkets","weapons","addLogText","context","channel","channelContext","entry","addLogEntry","Allegiance","CombatActionType","barBrawl","actors","allegiance","player","health","location","name","remainingAP","turn","updateCombat","delta","combat","getState","action","endsAt","enemy","move","dispatch","moveActor","target","clearCombatAction","MediaType","asInt","semVer","parts","split","map","part","Number","numericVersion","convertSemVerToInt","Indicator","itemsLoaded","itemsTotal","StructureState","loadImage","image","Image","Promise","resolve","reject","check","naturalWidth","removeEventListener","complete","addEventListener","getType","toLowerCase","endsWith","Preloader","useState","completed","setCompleted","setItemsLoaded","useEffect","loadMedia","manifest","promises","loadItem","catch","err","console","error","then","results","onLoadComplete","a","some","warn","mediaType","Howl","ButtonSize","ButtonColor","initialState","level","state","NotBuilt","workers","HitAreaShapes","shapes","sprite","definition","shape","PIXI","x","y","contains","LumberMill","hitAreaShapes","atlas","textures","setTextures","filters","selected","STRUCTURE_HIGHLIGHT_FILTER","app","useApp","loadResource","loader","rotation","setRotation","useTick","r","position","interactive","buttonMode","pointertap","onStructureClick","hitArea","texture","anchor","ParticleEmitter","PixiComponent","create","applyProps","instance","oldProps","newProps","config","newP","applyDefaultProps","emitter","_emitter","particles","from","elapsed","performance","tick","raf","requestAnimationFrame","update","willUnmount","cancelAnimationFrame","Tavern","tavern","smoke","withAppContext","WrappedComponent","AppContext","Consumer","Component","Generic","Legenda","structures","orderedStructures","workshop","quarry","tannery","alchemist","garden","armoursmith","warehouse","mine","weaver","match","useRouteMatch","params","toString","getStructureName","to","renderText","Viewport","forwardRef","ref","cursor","gauntlet","renderer","plugins","interaction","cursorStyles","pointer","PixiComponentViewport","viewport","PixiViewport","screenWidth","screenHeight","worldWidth","worldHeight","ticker","on","minScale","maxScale","drag","pinch","wheel","clamp","direction","clampZoom","decelerate","TownStage","innerRef","useRef","useImperativeHandle","current","godray","enabled","horizontalFactor","gsap","utils","normalize","right","verticalFactor","bottom","factor","max","gain","lacunarity","onScroll","e","preventDefault","window","passive","height","options","autoDensity","sharedLoader","GodrayFilter","OutlineFilter","selectedStructure","viewportRef","dragging","addMusicTrack","town","playMusicTrack","tween","duration","thickness","yoyo","repeat","pause","kill","stopPropagation","handleStructureClick","useSelector","zoomPercent","getStructurePosition","moveCenter","MAX_WIDTH","canvasWidth","setCanvasWidth","canvasHeight","setCanvasHeight","resize","worldViewWidth","clientWidth","worldViewHeight","clientHeight","reverse","StructureComponent","getStructure","polygons","Point","Toasts","activeToasts","setActiveToasts","toastsUpdated","toastConfig","Button","color","square","size","text","otherProps","blue","auto","Window","backEnabled","onBack","buttonClick","closeEnabled","onClose","withWindow","React","compose","soundSlider","musicSlider","open","onComplete","role","aria-label","min","step","onChange","linear","parseFloat","log","pow","defaultValue","sqrt","resourceOrder","addResources","resources","finishBuildingStructure","upgradeStructure","increaseWorkers","addItemToToProduces","addItemToWarehouse","addItem","removeItemFromWarehouse","removeItem","ContextType","itemSelectRef","cheats","setCheats","useDispatch","onCheatStructureState","setStructureState","onCheatWorkers","addWorkers","getItemOption","getItemName","keys","val","isNaN","label","getItemTypeOptions","handleChangeStructureState","checked","Built","addToast","cheat","evt","addGold","onCheatGold","reduce","acc","onCheatResources","onCheatItem","structureDef","getStructureDefinition","structureStore","levelDef","levels","displayName","getStructureRow","storeState","loadedStore","setLoadedStore","handleClickLoad","undefined","loadGame","game","onCloseWindow","onOpenWindow","encryptor","createEncryptor","document","createElement","JSON","stringify","encrypted","encrypt","setAttribute","encodeURIComponent","click","fileReader","FileReader","onload","result","decrypt","obj","parse","readAsText","files","disabled","formatNumber","input","digits","SI_SYMBOL","tier","log10","toFixed","suffix","scale","scaled","TooltipManager","info","originRect","referenceRect","deepEquals","lastContext","clear","EVENT_CONTEXT_UPDATED","IconSize","useGoldState","useResourcesState","selectFreeWorkers","createSelector","useWorkersFreeState","getClassName","smallest","small","medium","big","biggest","Resourcebar","goldState","storeResources","workersFree","createItem","currentTarget","getBoundingClientRect","showContextTooltip","backgroundImage","resourceDescription","resourceDescriptions","Topbar","useContext","persistor","QuestStatus","QuestMarker","leader","encounterActive","avatar","maskGraphics","beginFill","drawCircle","CIRCLE_DIAMETER","endFill","mask","addChild","pointerdown","avatarImg","QuestLine","positions","draw","graphics","lineStyle","moveTo","xc","yc","quadraticCurveTo","selectActiveQuests","quests","q","status","active","WorldMap","retrieveWorldViewRef","smallMap","questSelector","useCallback","selectedQuestName","selectedQuest","adventurers","activeQuests","handlePartyClick","onPartyClick","WIDTH","worldView","SMALL_HEIGHT","focusOnQuestingParty","point","nodeLocationToPoint","partyLocation","getQuestWorldLocation","previousPositions","getPreviousPositions","currentPosition","getQuestLeader","questDefinition","progress","questNode","nodes","encounter","getQuestTitle","roundedProgress","lastNode","nextNode","lerpLocation","WORLD_WIDTH","WORLD_HEIGHT","lastPosition","Tabstrip","activeTab","Children","child","cloneElement","handleTabClick","tabId","onTabSelected","Tab","AdventurerAvatar","adventurer","AdventurerTabstrip","onAdventurerTabSelected","selectedAdventurerId","getAdventurers","getQuests","createSelectAdventurersOnQuest","foundInParty","groupedAdventurers","values","foundAdventurers","adventurersOnQuest","indexOf","party","ItemIcon","showContext","Trait","DragSource","beginDrag","inventorySlot","index","sourceId","sourceType","connectDragSource","dragSource","isDragging","useAdventurersInTown","useMemo","getAdventurersInTown","useAdventurerState","adventurerSelector","Guy","findDR","equipment","useAdventurerDamageReduction","renderDamageReduction","dR","AdventurerEquipment","onDropItemEquipment","getEquipmentSlot","slotType","EquipmentSlot","dragInfo","adventurerEquipment","classNames","Inventory","slots","contents","slot","iconSize","onDropItem","useStockpileState","stockpile","SceneControllerContext","createContext","SceneControllerContextProvider","useStore","loaded","setLoaded","controller","getSceneController","loadData","createScene","sceneEntered","dataLoaded","Provider","useItemDropActions","sceneController","dropItemEquipment","actions","adventurerInventory","existingEquipment","dropItemInventory","otherItem","inventory","lootCache","takeItemFromCache","dropItemWarehouse","moveItemInWarehouse","arrowFinder","trait","hasEffect","gloomy","houseHouston","houseMaddox","houseMonroe","AdventurerTraits","renderTrait","last","traitDefinition","getTraitName","traits","t","AdventurerSkills","skills","s","skill","handleClick","getSkillName","renderSkill","levelToXp","Progressbar","Level","xp","currentLevel","xpToLevel","currentLevelXp","nextLevelXp","next","useQuest","AdventurerPanel","ApIndicator","getRemainingAdventurerAp","SceneActionType","RectTileLayer","tilemap","CompositeRectTileLayer","layer","tilesets","horizontalTiles","spritesheets","data","tileset","findTileset","w","tilewidth","h","tileheight","spritesheet","spriteId","addFrame","gid","firstgid","Tilemap","layers","l","visible","tilelayer","createTileLayer","BridgedStage","restProps","SpriteAnimated","gotoAndPlay","memo","idleAnimation","rest","tileWidth","mapData","tileHeight","actorRef","previousAction","actionQueueSelector","actionQueue","animation","setAnimation","spritesheetPath","getActorSpritesheetPath","nextAction","actionType","moveComplete","actorMoved","setOrientation","north","northEast","east","southEast","south","southWest","west","northWest","killTweensOf","ease","pixi","frames","setFrames","indexed","Loader","shared","frame","replace","orientation","flipped","random","interval","setInterval","left","clearInterval","getFrames","animationSpeed","isPlaying","pivot","createColorReplaceFilter","BLUES","PURPLE","replacements","MultiColorReplaceFilter","ActionPath","graphicsRef","drawAction","allowed","grfx","lineTo","parent","ActionPoints","textRef","drawAp","fontFamily","fontSize","fill","align","actionPathRef","actionPointsRef","actionActive","setActionActive","actionPath","container","mouseMove","destinationLocation","pointToSceneLocation","global","blocked","locationIsBlocked","enoughAp","calculateWalkApCosts","off","handleActorEndDrag","endLocation","path","findPath","setSelectedActor","pointerup","pointerupoutside","Rectangle","actorCanInteract","actorInteract","useTilesetsLoader","tileSpritesheets","setTilesets","setData","nextTileset","nextTilesetToload","tilesetName","spritesheetData","parseSpritesheetData","Spritesheet","newTilesets","loadComplete","loadTilesets","tilesetsTextures","columns","tilecount","spriteSourceSize","rotated","trimmed","sourceSize","meta","imagewidth","imageheight","SceneObjectWrapper","renderObject","Layout","Scene","selectedActor","renderActors","o","renderActor","sceneWidth","sceneHeight","objects","OnTheRoad","QuestDetails","DraggableItemsList","getItemSubtext","LootCache","freeSlots","adventurerFreeInventorySlots","cache","getLootCache","cacheName","querySelectorAll","classList","add","stagger","each","takeGoldFromCache","Situation","situation","getSituation","choices","handleChoiceClick","choice","getAttribute","handleSituationOptionClick","data-option","CombatBar","Fragment","ChannelType","QuestPanel","layout","setSelectedAdventurerID","selectedAdventurer","activeInteractionModal","handleAdventurerSelected","handleCloseLootCacheModal","WorldView","worldMapRef","questname","world","TaskType","SimpleLog","expanded","setExpanded","selectedTabId","setSelectedTabId","logEntries","channels","tabType","displayEntries","currentTab","lE","tab","logEntry","getLogEntryRow","startTask","taskType","origin","callbacks","start","useStructureState","structureSelector","DeedContent","structureDefinition","enoughGold","cost","subtext","handleStartConstruction","subtractGold","startBuildingStructure","buildStructure","weaponsmithProduction","levelRequired","Placement","armoursmithProduction","workshopProduction","alchemistProduction","getTasks","tasks","useCraftingTasksStateByStructure","running","createSelectCraftingTasksByStructure","useStudyingTasksStateByStructure","createSelectStudyingTasksByStructure","STUDY_TIME","ProducedAtStructure","studyTasks","produces","task","sT","timeRemaining","productionDefinition","getProductionDefinition","studyTime","studyItem","ProduceOrStudy","getItemDefinition","WeaponContent","getWeaponType","classification","getWeaponClassification","ApparelContent","ItemContext","ResourceContext","resourcesState","workersState","workersFreeState","structureStates","getStructureByResource","structureState","generates","renderProducedBy","free","total","Tooltip","placement","setPlacement","containerRect","setContainerRect","tooltipElement","tooltipRect","top","opacity","contentElement","querySelector","offset","transform","closest","TraitContext","getTraitDescription","getTraitEffect","ContextTooltip","selectedContext","setSelectedContext","tooltipUpdated","getResourceName","getSkillInfo","renderContent","Background","fragmentSrc","uniforms","timestamp","resolution","innerWidth","innerHeight","alpha","shift","speed","calculateProductionTime","UpDownValue","displayValue","upDisabled","onUp","downDisabled","onDown","StructureViewHeader","ResourcesCostBox","useResources","sufficientResources","listItems","listItemClass","ItemsBox","aggregate","accumulator","itemsInInventory","tmpWarehouse","tmpItems","found","findIndex","removed","itemDescription","itemsDescription","ProductionStructureView","selectedItem","setSelectedItem","workersAssigned","setWorkersAssigned","stockpileState","craftingTasks","studyingTasks","handleCraft","craftingTime","removeResources","craftItem","nextLevel","nextLevelCost","canUpgrade","upgradeText","createUpgradeRow","costResources","missingAtLeastOneResource","missingAtLeastOneItem","costMaterials","asNumber","makeTimeString","createCraftingDetails","startTime","deltaResources","maxResources","usePrevious","empty","useStructureActions","startUpgradeStructure","AdventurerInfo","itemRef","handleDropItemEquipment","equipmentList","basicAttributes","stat","WAREHOUSE","WarehouseStructureView","setSelectedAdventurer","resourcesDelta","setResourcesDelta","previousResources","resourcesRef","structuresState","adventurersInTown","remove","levelDefinition","AssignAdventurers","onAdventurerClicked","onAdventurerDropped","availableSlots","slotsContent","QuestBoard","checkEnoughItems","requiredItems","every","amountRequired","availableQuests","onQuestClick","fullParty","enoughItems","canLaunch","getQuestDescription","onRemoveAdventurer","onLaunchQuest","getQuestDetails","AdventurerButton","onAddAdventurer","isAssigned","Boolean","emptySlot","getEmptySlot","spec","View","RoomWithAdventurer","onQuest","assigned","SOURCE_ID","RoomEmpty","RoomList","roomCount","handleAdventurerNameClick","roomContent","room","TavernStructureView","setAassignedAdventurers","setSelectedQuest","getAvailableQuests","available","handleAddAdventurer","copy","handleRemoveAdventurer","handleLaunchQuest","questTitle","questLaunched","rooms","handleQuestClick","ResourceStructureView","handleWorkersDown","decreaseWorkers","handleWorkersUp","workerCapacity","createWorkersRow","generatesText","createGeneratesRow","buildTask","Building","production","PixiPlugin","registerPIXI","registerPlugin","App","containerRef","setMedia","activeWindows","setActiveWindows","handleViewButtonClick","selectStructure","handleWindowOpened","handleWindowClose","handleWindowBack","slice","handleScroll","debounce","maxWidth","DndProvider","backend","HTML5Backend","mediaItems","addSounds","margin","exact","restartGame","purple","render","topWindow","commonWindowProps","renderWindow","generator","ownProps","getMaxResources","getProducedResources","lastProducedUpdate","resourceStructureDefinition","handleStructure","getQuestUpdates","questDefinitions","currentProgress","currentNodeIndex","nothing","progressIncrease","nextProgress","nodesPassed","startScene","questEncounter","logUpdates","questUpdates","dirty","getRngState","Random","isLocalhost","hostname","register","navigator","URL","swUrl","fetch","response","headers","serviceWorker","ready","registration","unregister","reload","registerValidSW","checkValidServiceWorker","onupdatefound","installingWorker","installing","onstatechange","generateRandomAttributes","strength","dexterity","intelligence","testState","baseAP","lastTick","gameTick","lU","questVars","encounterResults","reward","questStoreState","qss","getInitialQuestVars","tO","questsToUpdate","questToUpdate","assign","updateEncounterResult","concat","nodeIndex","structureInitialState","updateStructureState","createTask","combineReducers","element","moveItemToOtherAdventurer","fromAdventurerId","toAdventurerId","fromAdventurer","startCombatAction","addAction","combatType","moveAction","engine","GameActionType","resourcesToAdd","resourcesToRemove","rngState","workersToAdd","workersToRemove","end","persistConfig","storage","localForage","version","persistedReducer","persistReducer","rootReducer","initial","createStore","__REDUX_DEVTOOLS_EXTENSION__","persistStore","isHydrated","storeIsRehydrated","processCompletedTasks","itemCrafted","handleCompletedTask","initGame","loadResourceAsync","texts","seed","seedrandom","readPersistedStore","configureStore","storeConfiguration","continueGame","startNewGame","runGame","purge","href","confirm","clearTimeout","ReactDOM","getElementById","registerServiceWorker","logs","resourcesUpdates","TiledObjectType","getExtendedTilemapObjects","tilemapData","objectLayers","objectgroup","objectLayer","ezProps","parseProperties","properties","extended","addAllTilesInLayerToList","list","tile","locationEquals","b","isTextEntry","test","BaseSceneController","aStar","tilemapObjects","jsonPath","blockedTiles","spritesheetsMap","callback","p","Array","Set","createAStar","createObjects","createActors","actorName","loadScene","getQuest","node","interactWithObject","_actor","_object","itemIndex","option","convertLocation","matrix","row","AStarFinder","grid","includeStartNode","heuristic","weight","startLocations","createObject","adventurerStart","exit","textEntry","getTextEntry","questUpdate","substr","lastIndexOf","DungeonEntranceSceneController","getAdventurerByActor","getQuestVars","_","DungeonHallwaySceneController","registerSceneController","kill10Boars","questStore","retrieveMagicAmulet","baz","zux","findAdventurerById","leaderId","precompile","templates","compileAll","initialized","getDefault","template","getTemplate","compile","toKebab","weaponClass","Handlebars","article","itemDefinitions","itemArticleAuto","itemArticleDefined","itemArticleUndefined","articleTemplate","noun","lerp","n1","n2","point1","point2","load","unlocks"],"mappings":"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,EACHC,EAAG,EACH5a,KAAMyH,IAAc+wC,SACrB,CACC79B,EAAG,EACHC,EAAG,EACH5a,KAAMyH,IAAc+wC,SACrB,CACC79B,EAAG,EACHC,EAAG,EACH5a,KAAMyH,IAAc+wC,SACrB,CACC79B,EAAG,EACHC,EAAG,EACH5a,KAAMyH,IAAc+wC,SACrB,CACC79B,EAAG,EACHC,EAAG,EACH5a,KAAMyH,IAAc+wC,SACrB,CACC79B,EAAG,EACHC,EAAG,EACH5a,KAAMyH,IAAc+wC,SACrB,CACC79B,EAAG,GACHC,EAAG,EACH5a,KAAMyH,IAAc+wC,SACrB,CACC79B,EAAG,GACHC,EAAG,EACH5a,KAAMyH,IAAc+wC,SACrB,CACC79B,EAAG,GACHC,EAAG,EACH5a,KAAMyH,IAAc+wC,SACrB,CACC79B,EAAG,GACHC,EAAG,EACH5a,KAAMyH,IAAc+wC,SACrB,CACC79B,EAAG,GACHC,EAAG,EACH5a,KAAMyH,IAAc+wC,SACrB,CACC79B,EAAG,GACHC,EAAG,EACH5a,KAAMyH,IAAc+wC,SACrB,CACC79B,EAAG,GACHC,EAAG,EACH5a,KAAMyH,IAAc+wC,SACrB,CACC79B,EAAG,GACHC,EAAG,EACH5a,KAAMyH,IAAc+wC,SACrB,CACC79B,EAAG,GACHC,EAAG,EACH5a,KAAMyH,IAAc+wC,SACrB,CACC79B,EAAG,GACHC,EAAG,EACH5a,KAAMyH,IAAc+wC,SACrB,CACC79B,EAAG,GACHC,EAAG,EACH5a,KAAMyH,IAAc+wC,SACrB,CACC79B,EAAG,GACHC,EAAG,EACH5a,KAAMyH,IAAc+wC,SACrB,CACC79B,EAAG,EACHC,EAAG,EACH5a,KAAMyH,IAAc+wC,SACrB,CACC79B,EAAG,EACHC,EAAG,EACH5a,KAAMyH,IAAc+wC,SACrB,CACC79B,EAAG,EACHC,EAAG,EACH5a,KAAMyH,IAAc8qB,UACpBqmB,WAAY,mBACb,CACCj+B,EAAG,EACHC,EAAG,EACH5a,KAAMyH,IAAc+wC,SACrB,CACC79B,EAAG,EACHC,EAAG,EACH5a,KAAMyH,IAAc+wC,SACrB,CA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","file":"static/js/main.988b6437.chunk.js","sourcesContent":["import { Rarity } from 'constants/items';\n\nexport enum ItemType {\n    deed,\n    apparel,\n    material,\n    questItem,\n    trinket,\n    weapon,\n}\n\n// the string must correspond to a named export in /items/index.tsx\nexport enum Item {\n    // deeds\n    deedForLumbermill = \"deedForLumbermill\",\n    deedForWeaponsmith = \"deedForWeaponsmith\",\n\n    // equipment\n    boots1 = \"boots1\",\n    boots2 = \"boots2\",\n    boots3 = \"boots3\",\n    chainmailHood = \"chainmailHood\",\n    chest = \"chest\",\n    clothGloves = \"clothGloves\",\n    cowl = \"cowl\",\n    fedora = \"fedora\",\n    druidChest = \"druidChest\",\n    druidFeet = \"druidFeet\",\n    druidHands = \"druidHands\",\n    druidHead = \"druidHead\",\n    druidLegs = \"druidLegs\",\n    greaves1 = \"greaves1\",\n    greaves2 = \"greaves2\",\n    hornedHelmet = \"hornedHelmet\",\n    leatherGloves = \"leatherGloves\",\n    nomadHelmet = \"nomadHelmet\",\n    pants1 = \"pants1\",\n    pants2 = \"pants2\",\n    plateChest1 = \"plateChest1\",\n    plateChest2 = \"plateChest2\",\n    plateChest3 = \"plateChest3\",\n    plateChest4 = \"plateChest4\",\n    plateGloves1 = \"plateGloves1\",\n    plateGloves2 = \"plateGloves2\",\n    plateHelmet = \"plateHelmet\",\n    platePants = \"platePants\",\n    plateShoulders1 = \"plateShoulders1\",\n    plateShoulders2 = \"plateShoulders2\",\n    robe = \"robe\",\n    shoulders1 = \"shoulders1\",\n    shoulders2 = \"shoulders2\",\n    shoulders3 = \"shoulders3\",\n    vest = \"vest\",\n\n    // materials\n    arrowheads = \"arrowheads\",\n    bolts = \"bolts\",\n    buckle = \"buckle\",\n    chain = \"chain\",\n    cogs = \"cogs\",\n    gem = \"gem\",\n    gunpowder = \"gunpowder\",\n    ingot = \"ingot\",\n    nails = \"nails\",\n    poisonVial = \"poisonVial\",\n    ribbon = \"ribbon\",\n    rope = \"rope\",\n    scales = \"scales\",\n    spring = \"spring\",\n    thread = \"thread\",\n\n    // quest-items\n    blueprints = \"blueprints\",\n    crate = \"crate\",\n    dragonEye = \"dragonEye\",\n    dynamite = \"dynamite\",\n    eye = \"eye\",\n    feather = \"feather\",\n    food = \"food\",\n    heart = \"heart\",\n    horn = \"horn\",\n    key = \"key\",\n    letters = \"letters\",\n    lockPicks = \"lockPicks\",\n    oil = \"oil\",\n    orcFinger = \"orcFinger\",\n    plans = \"plans\",\n    purpleGems = \"purpleGems\",\n    runestone = \"runestone\",\n    sandwich = \"sandwich\",\n    teeth = \"teeth\",\n    tooth = \"tooth\",\n    torch = \"torch\",\n    tusk = \"tusk\",\n    vase = \"vase\",\n    vial = \"vial\",\n    weeds = \"weeds\",\n\n    // trinkets\n    ring = \"ring\",\n    magicAmulet = \"magicAmulet\",\n\n    // weapons\n    aegisOfValor = \"aegisOfValor\",\n    arbalest = \"arbalest\",\n    battleAxe = \"battleAxe\",\n    berserkerShield = \"berserkerShield\",\n    brassKnuckles = \"brassKnuckles\",\n    buckler = \"buckler\",\n    cleaver = \"cleaver\",\n    club = \"club\",\n    dagger = \"dagger\",\n    flail = \"flail\",\n    goldenShield = \"goldenShield\",\n    greatswordOfGwai = \"greatswordOfGwai\",\n    indomitableCarapace = \"indomitableCarapace\",\n    javelin = \"javelin\",\n    khopesh = \"khopesh\",\n    longbow = \"longbow\",\n    mace = \"mace\",\n    morningStar = \"morningStar\",\n    paintedBuckler = \"paintedBuckler\",\n    poisonedDagger = \"poisonedDagger\",\n    ravenStaff = \"ravenStaff\",\n    savageStaff = \"savageStaff\",\n    simpleCrossbow = \"simpleCrossbow\",\n    spear = \"spear\",\n    steelShield = \"steelShield\",\n    sword = \"sword\",\n    warhammer = \"warhammer\",\n    woodenBulwark = \"woodenBulwark\"\n}\n\n\nexport interface ItemDefinition {\n    item: Item;\n    itemType: ItemType;\n    iconImg: string;\n    rarity?: Rarity;\n//    articleUndefined?: string;  // Key to text\n    unique?: boolean;           // Indicate that this item is unique.\n                                // Not actually enforced by anything,\n                                // but used to generate the article ('a' or 'the')\n}\n","import { Store, AnyAction } from \"redux\";\nimport { StoreState } from 'stores';\nimport { BaseSceneController } from 'mechanics/scenes/BaseSceneController';\n\nexport abstract class SceneControllerManager {\n    static store: { [key: string]: BaseSceneController<any> } = {};\n    static controllerTypes = {};\n\n    static registerSceneController(questName: string, sceneName: string, controllerType: typeof BaseSceneController) {\n        this.controllerTypes[`${questName}.${sceneName}`] = controllerType;\n    }\n\n    /**\n     * Gets the scenecontroller for scene. Creates it if it doesnt exist\n     */\n    static getSceneController<TQuestVars>(questName: string, sceneName: string, store: Store<StoreState, AnyAction>): BaseSceneController<TQuestVars> {\n        if (!this.store[`${questName}.${sceneName}`]) {\n            if (!this.controllerTypes[`${questName}.${sceneName}`]) {\n                throw new Error(`No controller registered for ${questName}.${sceneName}`);\n            }\n            this.store[`${questName}.${sceneName}`] = new this.controllerTypes[`${questName}.${sceneName}`](store, questName);\n        }\n        return this.store[`${questName}.${sceneName}`];\n    }\n\n    static destroySceneConroller(questName: string, sceneName: string, ) {\n        delete this.store[`${questName}.${sceneName}`];\n    }\n}\n\n// tslint:disable-next-line: no-var-requires\nrequire('definitions/quests/kill10Boars/encounters/dungeon');\n","// https://github.com/react-dnd/react-dnd/pull/1244\nimport { DragType } from \"constants/dragging\";\nimport { getDefinition } from \"definitions/items\";\nimport { ApparelDefinition } from \"definitions/items/apparel\";\nimport { Item, ItemType } from \"definitions/items/types\";\nimport * as React from \"react\";\nimport { ConnectDropTarget, DropTarget, DropTargetConnector, DropTargetMonitor, DropTargetSpec } from \"react-dnd\";\nimport { InventoryItemDragInfo } from '../DraggableItemIcon';\nimport \"./styles/equipmentslot.scss\";\nimport { WeaponDefinition, typeClassifications, WeaponClassification } from 'definitions/items/weapons';\n\nconst dropTarget: DropTargetSpec<Props> = {\n    drop(props: Props, monitor: DropTargetMonitor) {\n        props.onDrop(monitor.getItem());\n    },\n    canDrop(props: Props, monitor: DropTargetMonitor)  {\n        const item = monitor.getItem().item;\n\n        return itemAndEquipmentSlotMatch(item, props.type);\n    },\n};\n\nexport enum EquipmentSlotType {\n    feet,\n    hands,\n    chest,\n    legs,\n    head,\n    shoulders,\n    mainHand,\n    offHand,\n}\n\n// Returns true if item can be slotted in equipmentSlotType\nexport const itemAndEquipmentSlotMatch = (item: Item, equipmentSlotType: EquipmentSlotType) => {\n    switch (equipmentSlotType) {\n        case EquipmentSlotType.chest:\n        case EquipmentSlotType.feet:\n        case EquipmentSlotType.hands:\n        case EquipmentSlotType.head:\n        case EquipmentSlotType.legs:\n            return checkEquipment(item, equipmentSlotType);\n        case EquipmentSlotType.mainHand:\n        case EquipmentSlotType.offHand:\n            const itemDefinition: WeaponDefinition = getDefinition(item) as WeaponDefinition;\n            if (itemDefinition.itemType !== ItemType.weapon) {\n                return false;\n            }\n            const weaponClassification: WeaponClassification = typeClassifications[itemDefinition.weaponType];\n            switch (weaponClassification) {\n                case WeaponClassification.oneHanded:\n                    return true;\n                case WeaponClassification.mainHand:\n                    return equipmentSlotType === EquipmentSlotType.mainHand;\n                case WeaponClassification.offHand:\n                case WeaponClassification.shield:\n                    return equipmentSlotType === EquipmentSlotType.offHand;\n            }\n\n            // todo: prevent shields to be equipped in main hand\n            return true;\n        default:\n            return false;\n    }\n};\n\nexport interface Props {\n    type: EquipmentSlotType;\n    onDrop: (item: InventoryItemDragInfo) => void;\n}\n\nexport interface DropSourceProps {\n    canDrop: boolean;\n    isOver: boolean;\n    connectDropTarget: ConnectDropTarget;\n}\n\nconst collect = (connect: DropTargetConnector, monitor: DropTargetMonitor) => ({\n    canDrop: monitor.canDrop(),\n    connectDropTarget: connect.dropTarget(),\n    isOver: monitor.isOver(),\n});\n\n/**\n * The EquipmentSlot displays a slot in which an item can be placed.\n */\nconst EquipmentSlot = (props: React.PropsWithChildren<Props & DropSourceProps>) => {\n    const {\n        isOver,\n        canDrop,\n        connectDropTarget,\n    } = props;\n    const isActive = isOver && canDrop;\n    let borderColor = \"grey\";\n    if (isActive) {\n        borderColor = \"green\";\n    } else if (canDrop) {\n        borderColor = \"orange\";\n    }\n\n    return connectDropTarget(\n        <div className = \"equipment-slot\" style = { { borderColor }} title={EquipmentSlotType[props.type]}>\n            { props.children }\n        </div>,\n    );\n};\n\nexport default DropTarget<Props, DropSourceProps>(\n    DragType.ITEM,\n    dropTarget,\n    collect,\n)(EquipmentSlot);\n\nconst checkEquipment = (item: Item, equipmentType: EquipmentSlotType) => {\n    const itemDefinition = getDefinition(item);\n    if (itemDefinition.itemType !== ItemType.apparel) {\n        return false;\n    }\n    return (itemDefinition as ApparelDefinition).equipmentType === equipmentType;\n};\n","// tslint:disable:object-literal-sort-keys\nimport { Item, ItemDefinition, ItemType } from \"./types\";\nimport { EquipmentSlotType } from 'components/ui/EquipmentSlot';\n\nconst itemType = ItemType.apparel;\nconst basePath = \"/img/items/apparel/\";\n\n// export enum EquipmentSlotType {\n//     feet,\n//     hands,\n//     chest,\n//     legs,\n//     head,\n//     shoulders,\n// }\n\nexport interface ApparelDefinition extends ItemDefinition {\n    equipmentType: EquipmentSlotType;\n    damageReduction?: number;\n}\n\nconst all: Record<string, ApparelDefinition> = {\n    [Item.boots1]: {\n        item: Item.boots1,\n        equipmentType: EquipmentSlotType.feet,\n        itemType,\n        iconImg: `${basePath}boots_1.png`,\n    },\n    [Item.boots2]: {\n        item: Item.boots2,\n        equipmentType: EquipmentSlotType.feet,\n        itemType,\n        damageReduction: 1,\n        iconImg: `${basePath}boots_2.png`,\n    },\n    [Item.boots3]: {\n        item: Item.boots3,\n        equipmentType: EquipmentSlotType.feet,\n        itemType,\n        damageReduction: 2,\n        iconImg: `${basePath}boots_3.png`,\n    },\n    [Item.chainmailHood]: {\n        item: Item.chainmailHood,\n        equipmentType: EquipmentSlotType.head,\n        itemType,\n        iconImg: `${basePath}chainmail_hood.png`,\n        damageReduction: 3,\n    },\n    [Item.chest]: {\n        item: Item.chest,\n        equipmentType: EquipmentSlotType.chest,\n        itemType,\n        iconImg: `${basePath}chest_1.png`,\n        damageReduction: 2,\n    },\n    [Item.clothGloves]: {\n        item: Item.clothGloves,\n        equipmentType: EquipmentSlotType.hands,\n        itemType,\n        iconImg: `${basePath}cloth_gloves.png`,\n        damageReduction: 1\n    },\n    [Item.cowl]: {\n        item: Item.cowl,\n        equipmentType: EquipmentSlotType.head,\n        itemType,\n        iconImg: `${basePath}cowl.png`,\n        damageReduction: 2,\n    },\n    [Item.druidChest]: {\n        item: Item.druidHands,\n        equipmentType: EquipmentSlotType.chest,\n        itemType,\n        iconImg: `${basePath}druid-chest.png`,\n    },\n    [Item.druidFeet]: {\n        item: Item.druidFeet,\n        equipmentType: EquipmentSlotType.feet,\n        itemType,\n        iconImg: `${basePath}druid-feet.png`,\n    },\n    [Item.druidHands]: {\n        item: Item.druidHands,\n        equipmentType: EquipmentSlotType.hands,\n        itemType,\n        iconImg: `${basePath}druid-hands.png`,\n    },\n    [Item.druidHead]: {\n        item: Item.druidHead,\n        equipmentType: EquipmentSlotType.head,\n        itemType,\n        iconImg: `${basePath}druid-head.png`,\n    },\n    [Item.druidLegs]: {\n        item: Item.druidLegs,\n        equipmentType: EquipmentSlotType.legs,\n        itemType,\n        iconImg: `${basePath}druid-legs.png`,\n    },\n    [Item.fedora]: {\n        item: Item.fedora,\n        equipmentType: EquipmentSlotType.head,\n        itemType,\n        iconImg: `${basePath}fedora.png`,\n    },\n    [Item.greaves1]: {\n        item: Item.greaves1,\n        equipmentType: EquipmentSlotType.feet,\n        itemType,\n        iconImg: `${basePath}greaves_1.png`,\n        damageReduction: 2,\n    },\n    [Item.greaves2]: {\n        item: Item.greaves2,\n        equipmentType: EquipmentSlotType.hands,\n        itemType,\n        iconImg: `${basePath}greaves_2.png`,\n    },\n    [Item.hornedHelmet]: {\n        item: Item.hornedHelmet,\n        equipmentType: EquipmentSlotType.head,\n        itemType,\n        iconImg: `${basePath}horned_helmet.png`,\n    },\n    [Item.leatherGloves]: {\n        item: Item.leatherGloves,\n        equipmentType: EquipmentSlotType.hands,\n        itemType,\n        iconImg: `${basePath}leather_gloves.png`,\n    },\n    [Item.nomadHelmet]: {\n        item: Item.nomadHelmet,\n        equipmentType: EquipmentSlotType.head,\n        itemType,\n        iconImg: `${basePath}nomad_helmet.png`,\n    },\n    [Item.pants1]: {\n        item: Item.pants1,\n        equipmentType: EquipmentSlotType.legs,\n        itemType,\n        iconImg: `${basePath}pants_1.png`,\n        damageReduction: 3,\n    },\n    [Item.pants2]: {\n        item: Item.pants2,\n        equipmentType: EquipmentSlotType.legs,\n        itemType,\n        iconImg: `${basePath}pants_2.png`,\n        damageReduction: 3\n    },\n    [Item.plateChest1]: {\n        item: Item.plateChest1,\n        equipmentType: EquipmentSlotType.chest,\n        itemType,\n        iconImg: `${basePath}plate_chest_1.png`,\n    },\n    [Item.plateChest2]: {\n        item: Item.plateChest2,\n        equipmentType: EquipmentSlotType.chest,\n        itemType,\n        iconImg: `${basePath}plate_chest_2.png`,\n    },\n    [Item.plateChest3]: {\n        item: Item.plateChest3,\n        equipmentType: EquipmentSlotType.chest,\n        itemType,\n        iconImg: `${basePath}plate_chest_3.png`,\n    },\n    [Item.plateChest4]: {\n        item: Item.plateChest4,\n        equipmentType: EquipmentSlotType.chest,\n        itemType,\n        iconImg: `${basePath}plate_chest_4.png`,\n    },\n    [Item.plateGloves1]: {\n        item: Item.plateGloves1,\n        equipmentType: EquipmentSlotType.hands,\n        itemType,\n        iconImg: `${basePath}plate_gloves_1.png`,\n    },\n    [Item.plateGloves2]: {\n        item: Item.plateGloves2,\n        equipmentType: EquipmentSlotType.hands,\n        itemType,\n        iconImg: `${basePath}plate_gloves_2.png`,\n    },\n    [Item.plateHelmet]: {\n        item: Item.plateHelmet,\n        equipmentType: EquipmentSlotType.head,\n        itemType,\n        iconImg: `${basePath}plate_helmet_1.png`,\n    },\n    [Item.platePants]: {\n        item: Item.platePants,\n        equipmentType: EquipmentSlotType.legs,\n        itemType,\n        iconImg: `${basePath}plate_pants1.png`,\n    },\n    [Item.plateShoulders1]: {\n        item: Item.plateShoulders1,\n        equipmentType: EquipmentSlotType.shoulders,\n        itemType,\n        iconImg: `${basePath}plate_shoulders_1.png`,\n    },\n    [Item.plateShoulders2]: {\n        item: Item.plateShoulders2,\n        equipmentType: EquipmentSlotType.shoulders,\n        itemType,\n        iconImg: `${basePath}plate_shoulders_2.png`,\n    },\n    [Item.robe]: {\n        item: Item.robe,\n        equipmentType: EquipmentSlotType.chest,\n        itemType,\n        iconImg: `${basePath}robe_1.png`,\n    },\n    [Item.shoulders1]: {\n        item: Item.shoulders1,\n        equipmentType: EquipmentSlotType.shoulders,\n        itemType,\n        iconImg: `${basePath}shoulders_1.png`,\n    },\n    [Item.shoulders2]: {\n        item: Item.shoulders2,\n        equipmentType: EquipmentSlotType.shoulders,\n        itemType,\n        iconImg: `${basePath}shoulders_2.png`,\n        damageReduction: 2\n    },\n    [Item.shoulders3]: {\n        item: Item.shoulders3,\n        equipmentType: EquipmentSlotType.shoulders,\n        itemType,\n        iconImg: `${basePath}shoulders_3.png`,\n    },\n    [Item.vest]: {\n        item: Item.vest,\n        equipmentType: EquipmentSlotType.chest,\n        itemType,\n        iconImg: `${basePath}vest_1.png`,\n    },\n};\n\nexport default all;\n\nexport function getDefinition<T extends ApparelDefinition>(apparel: string): T {\n    return all[apparel] as T;\n}\n","function eventEmitter<TEventType>() {\n    abstract class EventEmitter {\n        static events = {};\n\n        static addEventListener (eventName: string, listener: (event: TEventType) => void) {\n            this.events[eventName] = this.events[eventName] || [];\n            this.events[eventName].push(listener);\n        }\n\n        static removeEventListener (eventName: string, listener: (event: TEventType) => void) {\n            if (this.events[eventName]) {\n                for (let i = 0; i < this.events[eventName].length; i++) {\n                    if (this.events[eventName][i] === listener) {\n                        this.events[eventName].splice(i, 1);\n                        break;\n                    }\n                };\n            }\n        }\n\n        protected static emit (eventName: string, event: TEventType | undefined) {\n            if (this.events[eventName]) {\n                this.events[eventName].forEach((fn: (event: TEventType | undefined) => any) => fn(event));\n            }\n        }\n    }\n    return EventEmitter;\n}\n\nexport default eventEmitter;","import { Item } from 'definitions/items/types';\nimport { LootCache } from 'stores/scene';\n\nexport interface Kill10BoarsQuestVars {\n    dungeon: {\n        entered: boolean,\n        lootCaches: {\n            chest: LootCache,\n            altar: LootCache,\n        },\n        situations: {\n            altar: {\n                candleLit: boolean\n            }\n        }\n    }\n}\n\nexport const initialQuestVars: Kill10BoarsQuestVars = {\n    dungeon: {\n        entered: false,\n        lootCaches: {\n            chest: {\n                title: \"encounter-dungeon-caches-chest\",\n                items: [\n                    Item.nomadHelmet,\n                    Item.teeth,\n                    Item.poisonVial,\n                    Item.fedora,\n                ],\n                gold: 100\n            },\n            altar: {\n                title: \"quest-kill10-boars-dungeonentrance-altar\",\n                items: [\n                    Item.bolts,\n                    Item.letters\n                ]\n            }\n        },\n        situations: {\n            altar: {\n                candleLit: false\n            }\n        }\n    }\n}","export interface TiledMapData {\n    width: number;\n    height: number;\n    tilewidth: number;\n    tileheight: number;\n    infinite: boolean;\n    backgroundcolor: string | null;\n    orientation: Orientation;\n    renderorder: RenderOrder;\n    tilesets: TiledTilesetData[];\n    layers: TiledLayerData[];\n}\n\nexport interface TiledTilesetData {\n    columns: number;\n    firstgid: number;\n    source: string;\n    image: string;\n    imagewidth: number;\n    imageheight: number;\n    tilewidth: number;\n    tileheight: number;\n    tilecount: number;\n    name: string;\n    margin: number; // todo:\n    spacing: number; // todo\n    tiles?: TileData[];\n}\n\nexport interface TileData {\n    id: number,\n    image: string;\n    properties?: TiledProperty[];\n}\n\nexport interface TiledLayerData {\n    data: number[];\n    objects: TiledObjectData[];\n    type: TiledLayerType;\n    height: number;\n    id: number;\n    name: string;\n    opacity: number; // not supported atm\n    visible: boolean;\n    x: number;\n    y: number;\n    width: number;\n    properties?: TiledProperty[];\n}\n\nexport interface TiledObjectData {\n    gid?: number;\n    id: number;\n    name: string;\n    properties?: TiledProperty[];\n    polygon?: { x: number, y: number}[];\n    type: string;\n    visible: boolean;\n    width: number;\n    height: number;\n    x: number;\n    y: number;\n}\n\nexport enum TiledLayerType {\n    tilelayer = \"tilelayer\",\n    objectgroup = \"objectgroup\"\n}\n\nexport interface TiledProperty {\n    name: string,\n    type: string,\n    value: any\n}\n\nenum Orientation {\n    orthagonal = \"orthagonal\",\n    isometric = \"isometric\",\n    staggered = \"staggered\",\n    hexagonal = \"hexagonal\"\n}\n\nenum RenderOrder {\n    rightUp = \"right-up\",\n    rightDown = \"right-down\",\n    leftUp = \"left-up\",\n    leftDown = \"left-down\"\n}","import { TextManager } from 'global/TextManager';\n\nexport const ONE_SECOND = 1000;\nexport const TWO_SECONDS = 2000;\nexport const THREE_SECONDS = 3000;\nexport const FOUR_SECONDS = 4000;\n// ...\nexport const TEN_SECONDS = 10000;\nexport const TWENTY_SECONDS = 20000;\nexport const THIRTY_SECONDS = 30000;\n\nexport const ONE_MINUTE = 60000;\nexport const TWO_MINUTES = 120000;\nexport const THREE_MINUTES = 180000;\nexport const FOUR_MINUTES = 240000;\n\nexport const HALF_HOUR = ONE_MINUTE * 30;\nexport const ONE_HOUR = ONE_MINUTE * 60;\nexport const ONE_DAY = ONE_HOUR * 24;\nexport const ONE_YEAR = ONE_DAY * 265.25;\n\nexport const formatDuration = (ms: number, short?: boolean): string => {\n    const timeUnitsList = [\n        { unit: short? 'y' : 'year', amount: ONE_YEAR },\n        { unit: short? 'd' : 'day', amount: ONE_DAY },\n        { unit: short? 'h' : 'hour', amount: ONE_HOUR },\n        { unit: short? 'm' : 'minute', amount: ONE_MINUTE },\n        { unit: short? 's': 'second', amount: ONE_SECOND },\n    ]\n    let time = Math.abs(ms);\n    const output: string[] = [];\n    timeUnitsList.forEach((el) => {\n        const tmp = Math.floor(time / el.amount);\n        time -= tmp * el.amount\n        if (tmp !== 0) {\n            const unit = TextManager.get(`common-time-${el.unit}${tmp > 1 && !short ? \"-plural\": \"\"}`);\n            output.push(`${tmp}${unit}`);\n        }\n    })\n    return output.join(\" \");\n}\n","import { QuestStoreState } from 'stores/quest';\nimport { Item } from 'definitions/items/types';\n\nexport enum QuestNodeType {\n    nothing = 0,    // Nothing much going on here\n    encounter = 1,\n    // combat = 2,     // Not implemented\n    // boss = 3,\n}\n\nexport interface QuestDefinition<TQuestVars = any> {\n    nodes: QuestNode[];\n    requiredItems?: Item[];\n    getQuestVars: (questStoreState: QuestStoreState) => TQuestVars;\n    getInitialQuestVars: (questStoreState: QuestStoreState) => TQuestVars;\n}\n\ntype AllNodeTypes = {\n    x: number;\n    y: number;\n    log?: string;   \n}\n\nexport type QuestNode  =\n    | AllNodeTypes & { type: QuestNodeType.nothing}\n    | AllNodeTypes & { type: QuestNodeType.encounter, startScene: string}\n","import { MediaItem } from \"components/preloading/Preloader\";\nimport { Howl } from \"howler\";\nimport localforage from 'localforage';\n\nexport enum MusicTrack {\n    town,\n    world,\n}\n\nexport enum Sound {\n    buttonClick,\n    error,\n    toast\n}\n\nlet media: MediaItem[];\n\nconst musicTracks: { [key: number]: Howl; } = {};\nlet currentMusicTrack: MusicTrack|null = null;\n\nconst sounds: { [key: number]: Howl; } = {};\nconst DEFAULT_MUSIC_VOLUME = 0;\nconst STORAGE_KEY_MUSIC_VOLUME = \"musicVolume\";\nconst DEFAULT_SOUND_VOLUME = 1;\nconst STORAGE_KEY_SOUND_VOLUME = \"soundVolume\";\n\nexport class SoundManager {\n    private static _musicVolume: number = DEFAULT_MUSIC_VOLUME;\n    private static _soundVolume: number = DEFAULT_SOUND_VOLUME;\n    private static _initialized = false;\n\n    public static async init() {\n        // Attempt to fetch volumes from storage. If not set, revert to defaults\n        this._musicVolume = await localforage.getItem(STORAGE_KEY_MUSIC_VOLUME) || DEFAULT_MUSIC_VOLUME;\n        this._soundVolume = await localforage.getItem(STORAGE_KEY_SOUND_VOLUME) || DEFAULT_SOUND_VOLUME;\n        // if (this._soundVolume === null) this._soundVolume = DEFAULT_SOUND_VOLUME;\n        // if (this._musicVolume === null) this._musicVolume = DEFAULT_MUSIC_VOLUME;\n\n        this._initialized = true;\n    }\n\n    public static loadMedia(m: MediaItem[]) {\n        media = m;\n    }\n\n    public static addSounds(soundList: Record<Sound, string>) {\n        Object.entries(soundList).forEach(([key, value]) => {\n            // todo: assert [10/07/2019 ASSERTS]\n            sounds[key] = media.find((m) => m.url === value)!.content;\n        });\n    }\n\n    public static playSound(sound: Sound) {\n        const howl = sounds[sound];\n        howl.volume(this.soundVolume);\n        howl.play();\n    }\n\n    public static async addMusicTrack(track: MusicTrack, url: string) {\n        if (!media) { return; }\n        if (!this._initialized) {\n            await this.init();\n        }\n\n        const sound = media.find((m) => m.url === url);\n        if (!sound) {\n            throw new Error(`No sound found at ${url}`);\n        }\n        if (!musicTracks.hasOwnProperty(track)) {\n            musicTracks[track] = sound.content as Howl;\n        }\n    }\n\n    /**\n     * Fades out currently playing music and fades new music in\n     * @param track\n     */\n    public static async playMusicTrack(track: MusicTrack) {\n        if (!media) { return; }\n        if (!this._initialized) {\n            await this.init();\n        }\n\n        if (currentMusicTrack !== null) {\n            const currentMusic: Howl = musicTracks[currentMusicTrack];\n            currentMusic.fade(SoundManager.musicVolume, 0, 500);\n        }\n        const nextMusic = musicTracks[track];\n        if (!nextMusic.playing()) {\n            nextMusic.loop(true);\n            nextMusic.play();\n        }\n        nextMusic.fade(0, SoundManager.musicVolume, 500);\n\n        currentMusicTrack = track;\n    }\n\n    static set soundVolume(volume: number) {\n        this._soundVolume = volume;\n        localforage.setItem(STORAGE_KEY_SOUND_VOLUME, volume);\n    }\n\n    static get soundVolume(): number {\n        return this._soundVolume;\n    }\n\n    static set musicVolume(volume: number) {\n        if (currentMusicTrack) {\n            musicTracks[currentMusicTrack].volume(volume);\n        }\n        this._musicVolume = volume;\n        localforage.setItem(STORAGE_KEY_MUSIC_VOLUME, volume);\n    }\n\n    static get musicVolume() : number {\n        return this._musicVolume;\n    }\n}\n","import { Action } from \"redux\";\nimport { AdventurerStoreState } from \"stores/adventurer\";\nimport { SceneAction, SceneStoreState, SceneObject, SceneInteractionModal } from 'stores/scene';\nimport { Item } from 'definitions/items/types';\n\n// tslint:disable:object-literal-sort-keys\n\nexport enum ActionType {\n    launchQuest = \"launchQuest\",                            // Embark upon a new quest\n    updateQuestVars = \"updateQuestVars\",                    // ?\n    updateEncounterResult = \"updateEncounterResult\",        // unused?\n    startEncounter = \"startEncounter\",                      // unused! remove\n    setSceneName = \"setSceneName\",                          // Sets name of the current scene of a quest\n    setScene = \"setScene\",                                  // Fills in the scene of a quest\n    exitEncounter = \"exitEncounter\",                        // Encounter is complete, leave scene and continue on quest\n    updateQuests = \"updateQuests\",                          // unused! remove\n    enqueueSceneAction = \"enqueueSceneAction\",\n    completeSceneAction = \"completeSceneAction\",\n    deductActorAp = \"deductActorAp\",\n    updateSceneObjectAction = \"updateSceneObjectAction\",    // Updates a tile object on the scene. Can update any property except 'id'\n    setActiveSceneInteractionModal = \"setActiveSceneInteractionModal\",     // Sets the active  modal\n}\n\nexport interface QuestAction extends Action<ActionType> {\n    questName: string;\n}\n\nexport interface QuestVarsAction extends QuestAction {\n    vars: any;\n}\n\nexport interface QuestLaunchAction extends QuestAction {\n    assignedAventurers: AdventurerStoreState[];\n}\n\nexport interface SetSceneNameAction extends QuestAction {\n    sceneName: string;\n}\n\nexport interface SetSceneAction extends QuestAction {\n    scene: SceneStoreState;\n}\n\nexport interface EnqueueSceneActionAction extends QuestAction {\n    sceneAction: SceneAction;\n}\n\nexport interface DeductActorApAction extends QuestAction {\n    actor: string;\n    ap: number;\n}\n\nexport interface UpdateEncounterResultAction extends QuestAction {\n    nodeIndex: number;\n    result: string;\n}\n\nexport interface SetActiveSceneInteractionModalAction extends QuestAction {\n    sceneInteractionModal?: SceneInteractionModal;\n}\n\nexport interface TakeItemFromCacheAction extends QuestAction {\n    cacheName: string;\n    item: Item;\n}\n\nexport interface UpdateSceneObjectAction extends QuestAction {\n    id: number;\n    object: Partial<Omit<SceneObject, 'id'>>;\n}\n\nexport function launchQuest(questName: string, assignedAventurers: AdventurerStoreState[]): QuestLaunchAction {\n    return {\n        type: ActionType.launchQuest,\n        questName,\n        assignedAventurers,\n    };\n}\n\n/** Completes the current encounter so the party can continue the quest */\nexport function exitEncounter(quest: string): QuestAction {\n    return {\n        type: ActionType.exitEncounter,\n        questName: quest,\n    };\n}\n\nexport function updateQuestVars(quest: string, vars: any): QuestVarsAction {\n    return {\n        type: ActionType.updateQuestVars,\n        questName: quest,\n        vars,\n    };\n}\n\n// Scene stuff\n\nexport function setSceneName(questName: string, sceneName: string): SetSceneNameAction {\n    return {\n        type: ActionType.setSceneName,\n        questName,\n        sceneName,\n    };\n}\n\nexport function setScene(questName: string, scene: SceneStoreState): SetSceneAction {\n    return {\n        type: ActionType.setScene,\n        questName,\n        scene,\n    };\n}\n\nexport function enqueueSceneAction(quest: string, sceneAction: SceneAction): EnqueueSceneActionAction {\n    return {\n        type: ActionType.enqueueSceneAction,\n        questName: quest,\n        sceneAction,\n    };\n}\n\nexport function completeSceneAction(quest: string): QuestAction {\n    return {\n        type: ActionType.completeSceneAction,\n        questName: quest,\n    };\n}\n\nexport function deductActorAp(quest: string, actor: string, ap: number): DeductActorApAction {\n    return {\n        type: ActionType.deductActorAp,\n        questName: quest,\n        actor,\n        ap\n    };\n}\n\nexport const updateSceneObject = (questName: string, id: number, object: Partial<Omit<SceneObject, 'id'>>): UpdateSceneObjectAction => {\n    return {\n        type: ActionType.updateSceneObjectAction,\n        questName,\n        id,\n        object\n    };\n}\n\nexport function updateEncounterResult(quest: string, nodeIndex: number, result: string): UpdateEncounterResultAction {\n    return {\n        type: ActionType.updateEncounterResult,\n        questName: quest,\n        nodeIndex,\n        result,\n    };\n}\n\nexport const setActiveSceneInteractionModal = (questName: string, sceneInteractionModal?: SceneInteractionModal): SetActiveSceneInteractionModalAction => {\n   return {\n       type: ActionType.setActiveSceneInteractionModal,\n       questName,\n       sceneInteractionModal\n   }\n}\n","\n// Things that can be dragged\nexport const DragType = {\n    ADVENTURER: \"adventurer\",   // Adventurer avatar\n    ITEM: \"item\",               // A game 'item' (equipment, etc)\n};\n\n// Source, where it comes from\nexport enum DragSourceType {\n    adventurerInventory,\n    warehouse,\n    tavern,\n    adventurerEquipment,\n    lootCache\n}\n","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAgCAYAAAABtRhCAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAB3RJTUUH3gMODzc3YHmYGgAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAE50lEQVRIx7WXW0wcVRjHfzO7y16YZbfAytACvbjU1hqkLVZMbbSXBEPUNjX6YDYanwYfTXzxrb7qm0lTJ018QhOjaWI0trFYbRoqpYVuwy2UpRS2lAF22YUdtuxt1ofKCIXShaZfMjm37+Q33zn/cxMURWHRVFXNAyiKIvCMTFwKO6Ne4ONPTpngZwoE6Lx6FYCDhwLPDLoMeKPtV8b6ewkEAssiVVU1v/gtLS+dhnUDFUUResZvUhLXuNF+ZVmkBw8F6B+4b5avXR8x82fUC+uCWhoaGsxCV1fXKZelGOvMNPcXspw9+zV60s3MzAweTwXJZBLJXYXPt8XMJ5NJbgX/pqGh4ctCgNalBUVRhId/u5tsQqf9UpDGxkZCoRCtra2mX2trK5qmAZhpoWZdrTIvCOyQihn8/RydsQSVm6uQJAnZ6zV9MjYbkUgEAL/fj6p+my9kOYmPViiKIgQn+8mLIv1jowSONtN0+OgyGEAkEkHXdTRNQ5Kkjal0qY3MJciLIsdOvslYXy9xbXxZu67rAEiSZOafCtgzfpM8Al2/deDEwJZOrYAu2lNFqKpq/rPjLTTtbWY0Psu1jovUVm7Hmk1jS6eYmXooEiH//0pYj3BWFc2RukM4HpxHMAz6x0aRvT1scfsYT0yTTwnEtXEsuQzxhbQ5j08F/O7H0+zz+ThQWsK52yGuBNs5XPcqllwOVzrOjv2HsZaXsuv1OtySnYSeort7kE+Vt56o1FWBo7EollwGQ7Sww13McHyWbE8n9VVVNLzWzMDkXSYGujl/uY1wNIamaciybO4+a0FXXRbd04P8PHydu/EYtmwaSy7NaCzOi0eO09F5kfk7/bhSSZ4T8zQ2NiLLMgCyLPPe+5+vudWtqlJFUYRF8MhsHNHIcXKnn86rfxK8P4Etk8G5kKR4YZ758F1OnDixrP9aUHGt8V6ExlMLbLP7GBoeAkGkxuWhKJfFlUoiJRNE7o0TCARM8UiS9NgjTnySqhRFEUZmR/jm5l9YsynGolG0RJQqpwd7OoU0P0dqZJD0TJyWlhZzU/D7/Txfe2wFVCxUzttLPNyaGEc0svx0+zZVW/cD4Eo/wJuIkevtwZiKLhteWZZXQAsGdk9PscluRzByODxlnL78Aw17mpDdZdizGUr0GNEbndRvKeeD5rcpLy83oRWVjeuLUFEUYTQ+jMfpwutw4CgpJVmzm6/++QVDtFDpLkU0DLxzUabbB6ir9vHGtp3mxi5JkhmluJ6zzONw/pfaMUSR0HyaL6530zYRBmBz7QFqj9YhSQ5efsXPQjxS2MJ/nJUUS8zEZ/G4nPSEQgyHLj08kCehtQuqy66w94/vEfIGNaVliEYGr6No40AAj9OBkDcYHmpb0RaO9hGO9lFdtodubQqAovQCG1IpgGgYlNlsbCqyrekXjvaZ+SlD3Dgwoc9hyWU4WP1SQf6lNbXouo6u6+ZtvmCgoihCcErDks2QCA3w4YF3ngjz+/1omsbkRMfG5nBkdoQ7bjeEe9hVVsZHe5u4FB7nXqTX9Kmvf5eKys3IskwwGGR4qG3ZW0VY+pgpxFRVze/zvcBWbylep5OMzY5hsVLsLiFd5MTqq+DedJRQKLQCtiHg0uv91k21uF1uPE4XhsVC1monlsqSmE8yOdGx6itsQ8BHwavN9+P6/Avf+1eTf20QhwAAAABJRU5ErkJggg==\"","// tslint:disable:object-literal-sort-keys\nimport { Item, ItemDefinition, ItemType } from \"./types\";\nimport { Rarity } from 'constants/items';\n\nconst itemType = ItemType.weapon;\nconst basePath = \"/img/items/weapons/\";\n\nexport enum WeaponType {\n    axe = \"axe\",\n    bow = \"bow\",\n    club = \"club\",\n    crossbow = \"crossbow\",\n    fist = \"fist\",\n    flail = \"flail\",\n    hammer = \"hammer\",\n    knife = \"knife\",\n    staff = \"staff\",\n    shield = \"shield\",\n    sword = \"sword\",\n    poleArm = \"poleArm\",\n}\n\nexport enum WeaponClassification {\n    oneHanded,  // Can be used in main hand or off hand\n    mainHand,   // Can only be used in main hand\n    offHand,    // Can only be used in the off hand\n    twoHanded,  // Can be used in the main hand and will disable off hand from being used\n    shield      // ?\n    // add 'ranged'?\n}\n\nexport const typeClassifications = {\n    [WeaponType.axe]: WeaponClassification.oneHanded,\n    [WeaponType.bow]: WeaponClassification.oneHanded,\n    [WeaponType.club]: WeaponClassification.oneHanded,\n    [WeaponType.crossbow]: WeaponClassification.mainHand,\n    [WeaponType.fist]: WeaponClassification.oneHanded,\n    [WeaponType.flail]: WeaponClassification.mainHand,\n    [WeaponType.hammer]: WeaponClassification.oneHanded,\n    [WeaponType.knife]: WeaponClassification.oneHanded,\n    [WeaponType.staff]: WeaponClassification.twoHanded,\n    [WeaponType.sword]: WeaponClassification.oneHanded,\n    [WeaponType.poleArm]: WeaponClassification.twoHanded,\n    [WeaponType.shield]: WeaponClassification.shield\n}\n\n\nexport enum DamageType {\n    kinetic = \"kinetic\",\n}\n\nexport interface DamageDefinition {\n    [DamageType.kinetic]: number | undefined;\n}\n\n\n// tslint:disable-next-line:no-empty-interface\nexport interface WeaponDefinition extends ItemDefinition {\n    weaponType: WeaponType;\n    damage?: DamageDefinition;\n}\n\nconst weaponDefinitions: Record<string, WeaponDefinition> = {\n    [Item.aegisOfValor]: {\n        item: Item.aegisOfValor,\n        itemType,\n        weaponType: WeaponType.shield,\n        rarity: Rarity.legendary,\n        iconImg: `${basePath}aegis-of-valor.png`,\n    },\n    [Item.arbalest]: {\n        item: Item.arbalest,\n        itemType,\n        weaponType: WeaponType.crossbow,\n        rarity: Rarity.epic,\n        iconImg: `${basePath}arbalest.png`,\n        damage: { [DamageType.kinetic]: 40 },\n    },\n    [Item.battleAxe]: {\n        item: Item.battleAxe,\n        itemType,\n        weaponType: WeaponType.axe,\n        rarity: Rarity.common,\n        iconImg: `${basePath}battle_axe.png`,\n        damage: { [DamageType.kinetic]: 20 },\n    },\n    [Item.berserkerShield]: {\n        item: Item.berserkerShield,\n        itemType,\n        weaponType: WeaponType.shield,\n        rarity: Rarity.epic,\n        iconImg: `${basePath}berserker-shield.png`,\n    },\n    [Item.brassKnuckles]: {\n        item: Item.brassKnuckles,\n        itemType,\n        weaponType: WeaponType.fist,\n        iconImg: `${basePath}brass_knuckles.png`,\n        rarity: Rarity.common,\n        damage: { [DamageType.kinetic]: 10 },\n    },\n    [Item.buckler]: {\n        item: Item.buckler,\n        itemType,\n        weaponType: WeaponType.shield,\n        rarity: Rarity.common,\n        iconImg: `${basePath}buckler.png`,\n    },\n    [Item.cleaver]: {\n        item: Item.cleaver,\n        itemType,\n        weaponType: WeaponType.knife,\n        iconImg: `${basePath}cleaver.png`,\n        rarity: Rarity.common,\n        damage: { [DamageType.kinetic]: 5 },\n    },\n    [Item.club]: {\n        item: Item.club,\n        itemType,\n        weaponType: WeaponType.club,\n        iconImg: `${basePath}club.png`,\n        rarity: Rarity.common,\n        damage: { [DamageType.kinetic]: 8 },\n    },\n    [Item.dagger]: {\n        item: Item.dagger,\n        itemType,\n        weaponType: WeaponType.knife,\n        iconImg: `${basePath}dagger.png`,\n        rarity: Rarity.uncommon,\n        damage: { [DamageType.kinetic]: 8 },\n    },\n    [Item.flail]: {\n        item: Item.flail,\n        itemType,\n        weaponType: WeaponType.flail,\n        iconImg: `${basePath}flail.png`,\n        rarity: Rarity.uncommon,\n        damage: { [DamageType.kinetic]: 15 },\n    },\n    [Item.goldenShield]: {\n        item: Item.goldenShield,\n        itemType,\n        weaponType: WeaponType.shield,\n        rarity: Rarity.rare,\n        iconImg: `${basePath}golden-shield.png`,\n    },\n    [Item.greatswordOfGwai]: {\n        item: Item.greatswordOfGwai,\n        itemType,\n        weaponType: WeaponType.sword,\n        iconImg: `${basePath}greatsword-gwai.png`,\n        unique: true,\n        rarity: Rarity.legendary,\n        damage: { [DamageType.kinetic]: 25 },\n    },\n    [Item.indomitableCarapace]: {\n        item: Item.indomitableCarapace,\n        itemType,\n        weaponType: WeaponType.shield,\n        rarity: Rarity.epic,\n        unique: true,\n        iconImg: `${basePath}indomitable-carapace.png`,\n    },\n    [Item.javelin]: {\n        item: Item.javelin,\n        itemType,\n        weaponType: WeaponType.poleArm,\n        iconImg: `${basePath}javelin.png`,\n        rarity: Rarity.epic,\n        damage: { [DamageType.kinetic]: 25 },\n    },\n    [Item.khopesh]: {\n        item: Item.khopesh,\n        itemType,\n        weaponType: WeaponType.sword,\n        iconImg: `${basePath}khopesh.png`,\n        rarity: Rarity.epic,\n        damage: { [DamageType.kinetic]: 15 },\n    },\n    [Item.longbow]: {\n        item: Item.longbow,\n        itemType,\n        weaponType: WeaponType.bow,\n        iconImg: `${basePath}longbow.png`,\n        rarity: Rarity.rare,\n        damage: { [DamageType.kinetic]: 2 },\n    },\n    [Item.mace]: {\n        item: Item.mace,\n        itemType,\n        weaponType: WeaponType.club,\n        iconImg: `${basePath}mace.png`,\n        rarity: Rarity.rare,\n        damage: { [DamageType.kinetic]: 15 },\n    },\n    [Item.morningStar]: {\n        item: Item.morningStar,\n        itemType,\n        weaponType: WeaponType.club,\n        iconImg: `${basePath}morning-star.png`,\n        rarity: Rarity.uncommon,\n        damage: { [DamageType.kinetic]: 13 },\n    },\n    [Item.paintedBuckler]: {\n        item: Item.paintedBuckler,\n        itemType,\n        weaponType: WeaponType.shield,\n        iconImg: `${basePath}painted-buckler.png`,\n    },\n    [Item.poisonedDagger]: {\n        item: Item.poisonedDagger,\n        itemType,\n        weaponType: WeaponType.knife,\n        iconImg: `${basePath}poisoned-dagger.png`,\n        rarity: Rarity.epic,\n        damage: { [DamageType.kinetic]: 12 },\n    },\n    [Item.ravenStaff]: {\n        item: Item.ravenStaff,\n        itemType,\n        weaponType: WeaponType.staff,\n        iconImg: `${basePath}raven-staff.png`,\n        rarity: Rarity.epic,\n        damage: { [DamageType.kinetic]: 13 },\n    },\n    [Item.savageStaff]: {\n        item: Item.savageStaff,\n        itemType,\n        weaponType: WeaponType.staff,\n        iconImg: `${basePath}savage-staff.png`,\n        rarity: Rarity.epic,\n        damage: { [DamageType.kinetic]: 8 },\n    },\n    [Item.simpleCrossbow]: {\n        item: Item.simpleCrossbow,\n        itemType,\n        weaponType: WeaponType.crossbow,\n        iconImg: `${basePath}crossbow.png`,\n        rarity: Rarity.common,\n        damage: { [DamageType.kinetic]: 3 },\n    },\n    [Item.spear]: {\n        item: Item.spear,\n        itemType,\n        weaponType: WeaponType.poleArm,\n        iconImg: `${basePath}sword.png`,\n        rarity: Rarity.rare,\n        damage: { [DamageType.kinetic]: 10 },\n    },\n    [Item.steelShield]: {\n        item: Item.steelShield,\n        itemType,\n        weaponType: WeaponType.shield,\n        rarity: Rarity.rare,\n        iconImg: `${basePath}steel-shield.png`,\n    },\n    [Item.sword]: {\n        item: Item.sword,\n        itemType,\n        weaponType: WeaponType.sword,\n        iconImg: `${basePath}sword.png`,\n        rarity: Rarity.uncommon,\n        damage: { [DamageType.kinetic]: 14 },\n    },\n    [Item.warhammer]: {\n        item: Item.warhammer,\n        itemType,\n        weaponType: WeaponType.hammer,\n        iconImg: `${basePath}warhammer.png`,\n        rarity: Rarity.rare,\n        damage: { [DamageType.kinetic]: 16 },\n    },\n    [Item.woodenBulwark]: {\n        item: Item.woodenBulwark,\n        itemType,\n        weaponType: WeaponType.shield,\n        rarity: Rarity.common,\n        iconImg: `${basePath}wooden-bulwark.png`,\n    },\n};\nexport default weaponDefinitions;\n\nexport function getDefinition<T extends WeaponDefinition>(weapon: string): T {\n    return weaponDefinitions[weapon] as T;\n}\n","// Utilities for routing \n\nimport { Structure } from 'definitions/structures';\n\nexport const getWorldLink = () => `/world`;\nexport const getQuestLink = (questName: string) => `${getWorldLink()}/${questName}`;\n\nexport const getTownLink = () => `/town`;\nexport const getStructureLink = (structure: Structure) => `${getTownLink()}/${structure}`;\n","import { ItemDefinition } from 'definitions/items/types';\n\nexport enum Rarity {\n    // gray = common, green = uncommon, blue = rare, purple = epic, orange = legendary\n    common,\n    uncommon,\n    rare,\n    epic,\n    legendary\n}\n\nexport const getIconClassName = (rarity?: Rarity): string => {\n    switch (rarity) {\n        case Rarity.common:\n            return \"item-icon-common\";\n        case Rarity.uncommon:\n            return \"item-icon-uncommon\";\n        case Rarity.rare:\n            return \"item-icon-rare\";\n        case Rarity.epic:\n            return \"item-icon-epic\";\n        case Rarity.legendary:\n            return \"item-icon-legendary\";\n    }\n    return getIconClassName(Rarity.common);\n};\n\nexport const getItemNameClassName = (item: ItemDefinition): string => {\n    const {rarity} = item;\n    switch (rarity) {\n        case Rarity.common:\n            return \"item-name-common\";\n        case Rarity.uncommon:\n            return \"item-name-uncommon\";\n        case Rarity.rare:\n            return \"item-name-rare\";\n        case Rarity.epic:\n            return \"item-name-epic\";\n        case Rarity.legendary:\n            return \"item-name-legendary\";\n    }\n    return getIconClassName(Rarity.common);\n};\n","import { ResourceStoreState } from \"stores/resources\";\nimport { CostStoreState } from \"../production/types\";\nimport { Item } from 'definitions/items/types';\n\nexport enum StructureType {\n    resource,\n    production,\n    tavern,\n    warehouse,\n}\n\nexport interface StructureDefinition {\n    type: StructureType;\n    cost: CostStoreState;\n    levels: StructureLevelDefinition[];\n}\n\nexport interface StructureLevelDefinition {\n    displayName: string;          // At this moment we can potentially support different names depending on the level\n                                  // of the structure. But this is not implemented because I feel it can cause confusion\n                                  // todo: REMOVE\n    cost: CostStoreState;                 // in gold\n    workerCapacity: number;       // number of workers that can work at this structure at this level\n}\n\nexport interface ResourceStructureDefinition extends StructureDefinition {\n    levels: ResourceStructureLevelDefinition[];\n}\n\nexport interface ResourceStructureLevelDefinition extends StructureLevelDefinition {\n    generates: ResourceStoreState;\n}\n\nexport interface ProductionStructureDefinition extends StructureDefinition {\n    levels: ProductionStructureLevelDefinition[];\n}\n\nexport interface ProductionStructureLevelDefinition extends StructureLevelDefinition {\n    unlocks: Item[];\n}\n\nexport interface WarehouseStructureDefinition extends StructureDefinition {\n    levels: WarehouseStructureLevelDefinition[];\n}\n\nexport interface WarehouseStructureLevelDefinition extends StructureLevelDefinition {\n    maxResources: ResourceStoreState;\n}\n\n// tslint:disable-next-line:no-empty-interface\nexport interface TavernStructureDefinition extends StructureDefinition {\n    levels: TavernStructureLevelDefinition[];\n}\n\nexport interface TavernStructureLevelDefinition extends StructureLevelDefinition {\n    rooms: number;\n}\n","// tslint:disable: object-literal-sort-keys\nexport enum Resource {\n    wood = \"wood\",\n    iron = \"iron\",\n    stone = \"stone\",\n    leather = \"leather\",\n    fabric = \"fabric\",\n    food = \"food\",\n}\n\nexport interface ResourceDefinition {\n    resource: Resource;\n    iconImg: string;\n}\n\nexport default {\n    [Resource.wood]: {\n        resource: Resource.wood,\n        iconImg: \"/img/resources/wood.png\",\n    },\n    [Resource.iron]: {\n        resource: Resource.iron,\n        iconImg: \"/img/resources/iron.png\",\n    },\n    [Resource.stone]: {\n        resource: Resource.stone,\n        iconImg: \"/img/resources/stone.png\",\n    },\n    [Resource.leather]: {\n        resource: Resource.leather,\n        iconImg: \"/img/resources/leather.png\",\n    },\n    [Resource.fabric]: {\n        resource: Resource.fabric,\n        iconImg: \"/img/resources/fabric.png\",\n    },\n    [Resource.food]: {\n        resource: Resource.food,\n        iconImg: \"/img/resources/food.png\",\n    },\n};\n","import { EquipmentSlotType } from \"components/ui/EquipmentSlot\";\nimport { Item } from \"definitions/items/types\";\nimport { Action } from \"redux\";\n\n// tslint:disable:object-literal-sort-keys\nexport enum ActionType {\n    moveItemInInventory = \"moveItemInInventory\",\n    moveItemToOtherAdventurer = \"moveItemToOtherAdventurer\",\n    moveItemFromWarehouseToAdventurer = \"moveItemFromWarehouseToAdventurer\",\n    addItemToInventory = \"addItemToInventory\",\n    removeItemFromInventory = \"removeItemFromInventory\",\n    assignEquipment = \"assignEquipment\",\n    removeEquipment = \"removeEquipment\",\n}\n\nexport interface AdventurerAction extends Action<ActionType> {\n    adventurerId: string;\n}\n\nexport interface InventoryAction extends AdventurerAction {\n    item: Item;\n    toSlot?: number;\n}\n\nexport interface MoveItemInInventoryAction extends AdventurerAction {\n    fromSlot: number;\n    toSlot: number;\n}\n\nexport interface RemoveItemFromInventoryAction extends AdventurerAction {\n    fromSlot: number;\n}\n\nexport interface MoveItemToOtherAdventurerAction extends AdventurerAction {\n    fromSlot: number;\n    toSlot?: number;\n    toAdventurerId: string;\n}\n\nexport interface AssignEquipmentAction extends AdventurerAction {\n    item: Item;\n    equipmentSlot: EquipmentSlotType;\n}\nexport interface RemoveEquipmentAction extends AdventurerAction {\n    equipmentSlot: EquipmentSlotType;\n}\n\nexport function moveItemInInventory(adventurerId: string, fromSlot: number, toSlot: number):\n    MoveItemInInventoryAction {\n    return {\n        type: ActionType.moveItemInInventory,\n        adventurerId,\n        fromSlot,\n        toSlot,\n    };\n}\n\n/**\n * Moves the an item from one adventurers' inventory to another\n * @param fromAdventurerId adventurer whose inventory to take the item from\n * @param fromSlot index of the inventory item\n * @param toAdventurerId player who to give the item to\n */\nexport function moveItemToOtherAdventurer(fromAdventurerId: string,\n                                          fromSlot: number,\n                                          toAdventurerId: string, toSlot?: number): MoveItemToOtherAdventurerAction {\n    return {\n        type: ActionType.moveItemToOtherAdventurer,\n        adventurerId: fromAdventurerId,\n        fromSlot,\n        toAdventurerId,\n        toSlot,\n    };\n}\n\n// If slot is not provided, will take the first empty slot\nexport function addItemToInventory(adventurerId: string, item: Item, toSlot?: number): InventoryAction {\n    return {\n        type: ActionType.addItemToInventory,\n        adventurerId,\n        item,\n        toSlot,\n    };\n}\n\nexport function removeItemFromInventory(adventurerId: string, fromSlot: number): RemoveItemFromInventoryAction {\n    return {\n        type: ActionType.removeItemFromInventory,\n        adventurerId,\n        fromSlot,\n    };\n}\n\nexport function assignEquipment(adventurerId: string, equipmentSlot: EquipmentSlotType, item: Item): AssignEquipmentAction {\n    return {\n        type: ActionType.assignEquipment,\n        adventurerId,\n        item,\n        equipmentSlot,\n    };\n}\n\nexport function removeEquipment(adventurerId: string, equipmentSlot: EquipmentSlotType): RemoveEquipmentAction {\n    return {\n        type: ActionType.removeEquipment,\n        adventurerId,\n        equipmentSlot,\n    };\n}\n","import { TextEntry } from \"constants/text\";\n\nexport enum LogChannel {\n    common,         // Only visible in 'all'\n    town,           // Visible in 'all' and town\n    quest,          // Visible in 'all' and the appropriate quest tab\n}\n\nexport interface LogEntry extends TextEntry {\n    time: number;\n    channel: LogChannel;\n    channelContext?: string;\n}\n","import { Type } from '../components/ui/toasts/Toast';\nimport EventEmitter from './EventEmitter';\nimport { SoundManager, Sound } from './SoundManager';\n\nexport interface ToastConfig {\n    time: number;\n    title: string;\n    type?: Type;\n    icon?: string;\n    link?: string;\n}\n\nexport abstract class ToastManager extends EventEmitter<ToastConfig[]>() {\n\n    private static stack: ToastConfig[] = [];\n    private static lifeTime = 5000; // Time each toast lives\n\n    static EVENT_TOASTS_UPDATED = \"toast\";\n\n    static addToast(title: string, type?: Type, icon?: string, link?: string) {\n\n        this.stack = [...this.stack, {\n            time: Date.now(),\n            title,\n            type,\n            icon,\n            link\n        }];\n\n        this.emit(this.EVENT_TOASTS_UPDATED, this.stack);\n\n        SoundManager.playSound(Sound.toast);\n\n        setTimeout(() => {\n            // Remove all popups that have expired\n            this.stack = this.stack.filter((toast) => {\n                return Date.now() - toast.time < this.lifeTime\n            });\n            this.emit(this.EVENT_TOASTS_UPDATED, this.stack);\n\n        }, this.lifeTime);\n    }\n}","import React from 'react';\nimport { TextManager } from 'global/TextManager';\nimport { ToastConfig } from 'global/ToastManager';\nimport { useHistory } from 'react-router';\n\ntype Props = ToastConfig;\n\nexport enum Type {\n    achievementUnlocked,\n    cheat,\n    game,\n    itemCrafted,\n    questCompleted,\n    questEncounter,\n    questLaunched,\n    questUpdate,\n}\n\nconst Toast = (props: Props) => {\n    const {\n        title,\n        type = Type.achievementUnlocked,\n        icon = \"/img/items/quest-items/dragon-eye.png\",\n        link\n    } = props;\n    const history = useHistory();\n\n    const handleClick = () => {\n        if (link) {\n            history.push(link);\n        }\n    }\n\n    const typeText = TextManager.getToastType(type);\n    return (\n        <div className={`toast ${link && \"withlink\"}`} onClick={handleClick}>\n            <div className=\"label type\">{typeText}</div>\n            <div className=\"label title app-h2-white\">{title}</div>\n            <div className=\"icon\">\n                <div className=\"background\"/>\n                <img className=\"image\" width=\"300\" alt=\"dragon eye\" src={`${process.env.PUBLIC_URL}${icon}`} />\n                <div className=\"foreground\"/>\n            </div>\n            <div className=\"banner\"/>\n        </div>\n    );\n}\n\nexport default Toast;","// tslint:disable:object-literal-sort-keys\n\nimport { Structure } from \"../structures\";\nimport { Item, ItemDefinition, ItemType } from \"./types\";\n\nconst itemType = ItemType.deed;\n\nexport interface DeedDefinition extends ItemDefinition {\n    structure: Structure;\n}\n\nexport const deedForLumbermill: DeedDefinition = {\n    item: Item.deedForLumbermill,\n    structure: Structure.lumberMill,\n    itemType,\n    iconImg: \"/img/items/deeds/deed.png\",\n};\n\nexport const deedForWeaponsmith: DeedDefinition = {\n    item: Item.deedForWeaponsmith,\n    structure: Structure.weaponsmith,\n    itemType,\n    iconImg: \"/img/items/deeds/deed.png\",\n};\n\nexport default {\n    deedForLumbermill,\n    deedForWeaponsmith,\n};\n","// tslint:disable:object-literal-sort-keys\n\nimport { Item, ItemType } from \"./types\";\n\nconst itemType = ItemType.material;\nconst basePath = \"/img/items/materials/\";\n\nexport default {\n    [Item.arrowheads]: {\n        item: Item.arrowheads,\n        itemType,\n        iconImg: `${basePath}arrowheads.png`,\n    },\n    [Item.bolts]: {\n        item: Item.bolts,\n        itemType,\n        iconImg: `${basePath}bolts.png`,\n    },\n    [Item.buckle]: {\n        item: Item.buckle,\n        itemType,\n        iconImg: `${basePath}buckle.png`,\n    },\n    [Item.chain]: {\n        item: Item.chain,\n        itemType,\n        iconImg: `${basePath}chain.png`,\n    },\n    [Item.cogs]: {\n        item: Item.cogs,\n        itemType,\n        iconImg: `${basePath}cogs.png`,\n    },\n    [Item.gem]: {\n        item: Item.gem,\n        itemType,\n        iconImg: `${basePath}gem.png`,\n    },\n    [Item.ingot]: {\n        item: Item.ingot,\n        itemType,\n        iconImg: `${basePath}ingot.png`,\n    },\n    [Item.nails]: {\n        item: Item.nails,\n        itemType,\n        iconImg: `${basePath}nails.png`,\n    },\n    [Item.poisonVial]: {\n        item: Item.poisonVial,\n        itemType,\n        iconImg: `${basePath}poison-vial.png`,\n    },\n    [Item.ribbon]: {\n        item: Item.ribbon,\n        itemType,\n        iconImg: `${basePath}ribbon.png`,\n    },\n    [Item.rope]: {\n        item: Item.rope,\n        itemType,\n        iconImg: `${basePath}rope.png`,\n    },\n    [Item.gem]: {\n        item: Item.gem,\n        itemType,\n        iconImg: `${basePath}gem.png`,\n    },\n    [Item.gunpowder]: {\n        item: Item.gunpowder,\n        itemType,\n        iconImg: `${basePath}gunpowder.png`,\n    },\n    [Item.scales]: {\n        item: Item.scales,\n        itemType,\n        iconImg: `${basePath}scales.png`,\n    },\n    [Item.spring]: {\n        item: Item.spring,\n        itemType,\n        iconImg: `${basePath}spring.png`,\n    },\n    [Item.thread]: {\n        item: Item.thread,\n        itemType,\n        iconImg: `${basePath}thread.png`,\n    },\n};\n","// tslint:disable:object-literal-sort-keys\n\nimport { Item, ItemDefinition, ItemType } from \"./types\";\n\nconst itemType = ItemType.questItem;\nconst basePath = \"/img/items/quest-items/\";\n\nconst questItemDefinitions: Record<string, ItemDefinition> = {\n    [Item.blueprints]: {\n        item: Item.blueprints,\n        itemType,\n        iconImg: `${basePath}blueprints.png`,\n    },\n    [Item.crate]: {\n        item: Item.crate,\n        itemType,\n        iconImg: `${basePath}crate.png`,\n    },\n    [Item.dynamite]: {\n        item: Item.dynamite,\n        itemType,\n        iconImg: `${basePath}dynamite.png`,\n    },\n    [Item.dragonEye]: {\n        item: Item.dragonEye,\n        itemType,\n        iconImg: `${basePath}dragon-eye.png`,\n    },\n    [Item.eye]: {\n        item: Item.eye,\n        itemType,\n        iconImg: `${basePath}eye.png`,\n    },\n    [Item.feather]: {\n        item: Item.feather,\n        itemType,\n        iconImg: `${basePath}feather.png`,\n    },\n    [Item.food]: {\n        item: Item.food,\n        itemType,\n        iconImg: `${basePath}food.png`,\n    },\n    [Item.heart]: {\n        item: Item.heart,\n        itemType,\n        iconImg: `${basePath}heart.png`,\n    },\n    [Item.horn]: {\n        item: Item.horn,\n        itemType,\n        iconImg: `${basePath}horn.png`,\n    },\n    [Item.key]: {\n        item: Item.key,\n        itemType,\n        iconImg: `${basePath}key.png`,\n    },\n    [Item.letters]: {\n        item: Item.letters,\n        itemType,\n        iconImg: `${basePath}letters.png`,\n    },\n    [Item.lockPicks]: {\n        item: Item.lockPicks,\n        itemType,\n        iconImg: `${basePath}lock-picks.png`,\n    },\n    [Item.oil]: {\n        item: Item.oil,\n        itemType,\n        iconImg: `${basePath}oil.png`,\n    },\n    [Item.orcFinger]: {\n        item: Item.orcFinger,\n        itemType,\n        iconImg: `${basePath}orc-finger.png`,\n    },\n    [Item.plans]: {\n        item: Item.plans,\n        itemType,\n        iconImg: `${basePath}plans.png`,\n    },\n    [Item.purpleGems]: {\n        item: Item.purpleGems,\n        itemType,\n        iconImg: `${basePath}purple-gems.png`,\n    },\n    [Item.runestone]: {\n        item: Item.runestone,\n        itemType,\n        iconImg: `${basePath}runestone.png`,\n    },\n    [Item.sandwich]: {\n        item: Item.sandwich,\n        itemType,\n        iconImg: `${basePath}sandwich.png`,\n    },\n    [Item.teeth]: {\n        item: Item.teeth,\n        itemType,\n        iconImg: `${basePath}teeth.png`,\n    },\n    [Item.tooth]: {\n        item: Item.tooth,\n        itemType,\n        iconImg: `${basePath}tooth.png`,\n    },\n    [Item.torch]: {\n        item: Item.torch,\n        itemType,\n        iconImg: `${basePath}torch.png`,\n    },\n    [Item.tusk]: {\n        item: Item.tusk,\n        itemType,\n        iconImg: `${basePath}tusk.png`,\n    },\n    [Item.vase]: {\n        item: Item.vase,\n        itemType,\n        iconImg: `${basePath}vase.png`,\n    },\n    [Item.vial]: {\n        item: Item.vial,\n        itemType,\n        iconImg: `${basePath}vial.png`,\n    },\n    [Item.weeds]: {\n        item: Item.weeds,\n        itemType,\n        iconImg: `${basePath}weeds.png`,\n    },\n};\n\nexport default questItemDefinitions;\n","// tslint:disable:object-literal-sort-keys\n\nimport { Item, ItemDefinition, ItemType } from \"./types\";\n\nconst itemType = ItemType.trinket;\nconst basePath = \"/img/items/trinkets/\";\n\nconst trinketDefinitions: Record<string, ItemDefinition> = {\n    [Item.magicAmulet]: {\n        item: Item.magicAmulet,\n        itemType,\n        iconImg: `${basePath}magic_amulet.png`,\n    },\n    [Item.ring]: {\n        item: Item.ring,\n        itemType,\n        iconImg: `${basePath}ring.png`,\n    },\n};\n\nexport default trinketDefinitions;\n","import apparel from \"./apparel\";\nimport deeds from \"./deeds\";\nimport materials from \"./materials\";\nimport questItems from \"./questItems\";\nimport trinkets from \"./trinkets\";\nimport { Item, ItemDefinition } from \"./types\";\nimport weapons from \"./weapons\";\n\nconst all = {\n    ...deeds,\n    ...apparel,\n    ...materials,\n    ...questItems,\n    ...trinkets,\n    ...weapons,\n};\n\nexport default all;\n\nexport function getDefinition(item: Item): ItemDefinition {\n    return all[item];\n}\n","import { Action } from \"redux\";\nimport { LogChannel } from \"stores/logEntry\";\nimport { TextEntry } from 'constants/text';\n\nexport enum ActionType {\n    addLogEntry = \"addLogEntry\",\n}\n\nexport interface AddLogEntryAction extends Action<ActionType> {\n    entry: TextEntry;\n    channel: LogChannel;\n    channelContext?: string;\n}\n\nexport function addLogText(key: string, context?: any, channel: LogChannel = LogChannel.common, channelContext?: string): AddLogEntryAction {\n    const entry: TextEntry = {\n        key,\n        context\n    };\n    return {\n        type: ActionType.addLogEntry,\n        entry,\n        channel,\n        channelContext,\n    };\n}\n\nexport function addLogEntry(entry: TextEntry, channel: LogChannel = LogChannel.common, channelContext?: string): AddLogEntryAction {\n    return {\n        type: ActionType.addLogEntry,\n        entry,\n        channel,\n        channelContext,\n    };\n}\n","// tslint:disable:object-literal-sort-keys\nimport { Action } from \"redux\";\nimport { CombatActionType } from \"stores/combat\";\n\nexport enum ActionType {\n    clearCombatAction = \"clearCombatAction\",\n    startCombatAction = \"startCombatAction\",\n    moveActor = \"moveActor\",\n}\n\nexport interface AddCombatActionAction extends Action<ActionType> {\n    combatType: CombatActionType;\n    actor: string;\n    target: [number, number];\n    endsAt: number;\n}\n\nexport interface MoveActorAction extends Action<ActionType> {\n    actor: string;\n    location: [number, number];\n}\n\nexport function startCombatAction(type: CombatActionType, actor: string, target: [number, number], endsAt: number): AddCombatActionAction {\n    return {\n        type: ActionType.startCombatAction,\n        combatType: type,\n        actor,\n        target,\n        endsAt,\n    };\n}\n\nexport function moveActor(actor: string, location: [number, number]): MoveActorAction {\n    return {\n        type: ActionType.moveActor,\n        actor,\n        location,\n    };\n}\n\nexport function clearCombatAction(): Action<ActionType> {\n    // currently there is only one combat possible. so only one needs to be cleared\n    return {\n        type: ActionType.clearCombatAction,\n    };\n}\n","export interface CombatStoreState {\n    actors: Actor[];\n    turn: Allegiance;\n    action?: CombatAction;\n}\n\nexport interface Actor {\n    name: string;\n    allegiance: Allegiance;\n    location: number[];\n    health: number;\n    remainingAP: number;\n}\n\nexport enum Allegiance {\n    player,\n    enemy,\n}\n\nexport interface CombatAction {\n    type: CombatActionType;\n    actor: string;\n    target: [number, number];\n    endsAt: number;\n}\n\nexport enum CombatActionType {\n    move = \"move\",\n    slash = \"slash\",\n    shoot = \"shoot\",\n}\n\nexport const barBrawl: CombatStoreState = {\n    actors: [{\n        allegiance: Allegiance.player,\n        health: 100,\n        location: [3, 5],\n        name: \"c4a5d270\",\n        remainingAP: 5,\n    }, {\n        allegiance: Allegiance.player,\n        health: 100,\n        location: [4, 6],\n        name: \"2e655832\",\n        remainingAP: 4,\n    }],\n    turn: Allegiance.player,\n};\n","import { LogUpdate, QuestUpdate } from \"mechanics/gameTick/quests\";\r\nimport { Action } from \"redux\";\r\nimport { State as seedrandomStateType } from \"seedrandom\";\r\nimport { ResourceStoreState } from \"stores/resources\";\r\n\r\nexport enum ActionType {\r\n    gameTick = \"gameTick\",\r\n}\r\nexport interface GameTickAction extends Action<ActionType> {\r\n    delta: number;\r\n    rngState: seedrandomStateType | null;\r\n    resources: ResourceStoreState | null;\r\n    quests: QuestUpdate[];\r\n    log: LogUpdate[];\r\n}\r\n\r\n// export type IncrementResource = IncrementResource // | others\r\n\r\n// tslint:disable: align\r\nexport function gameTick(delta: number,\r\n    rngState: seedrandomStateType | null,\r\n    resources: ResourceStoreState | null,\r\n    quests: QuestUpdate[],\r\n    log: LogUpdate[],\r\n): GameTickAction {\r\n    return {\r\n        type: ActionType.gameTick,\r\n        delta,\r\n        rngState,\r\n        resources,\r\n        quests,\r\n        log,\r\n    };\r\n}\r\n","import { clearCombatAction, moveActor } from \"actions/combat\";\nimport { Store } from \"redux\";\nimport { StoreState } from \"stores\";\nimport { Allegiance, CombatAction, CombatActionType } from \"stores/combat\";\n\n// tslint:disable-next-line: no-empty-interface\nexport interface CombatUpdate  {\n    // todo: maybe this is not needed\n    action: CombatAction | null;\n}\n\nconst updateCombat = (delta: number, store: Store<StoreState>): CombatUpdate | null => {\n    const state = store.getState();\n    const combat = state.combat;\n    if (combat.action) {\n        const action = combat.action;\n        if (action.endsAt < Date.now()) {\n            if (combat.turn === Allegiance.enemy) {\n                /* if (apLeft(enemy))\n                determine next action\n                else\n                players turn now\n                */\n            } else if (combat.turn === Allegiance.player) {\n                switch (combat.action.type) {\n                    case CombatActionType.move:\n                        store.dispatch(moveActor(combat.action.actor, combat.action.target));\n                        store.dispatch(clearCombatAction());\n                        break;\n                    default:\n                        break;\n                }\n                return {\n                    action: null,\n                };\n            }\n        }\n    }\n    return null;\n};\n\nexport default updateCombat;\n","import { Howl } from \"howler\";\r\nimport * as React from \"react\";\r\nimport Indicator from \"./Indicator\";\r\nimport { useState, useEffect, PropsWithChildren } from 'react';\r\n\r\n// https://medium.com/@jchiam/publishing-a-typescript-react-component-to-npm-d3cc15b8d0a2\r\nexport type Props = PropsWithChildren<{\r\n    manifest: string[];\r\n    onLoadComplete?: (mediaItems: MediaItem[]) => void;\r\n}>\r\n\r\nexport enum MediaType {\r\n    image,\r\n    sound,\r\n}\r\n\r\nexport interface MediaItem {\r\n    url: string;\r\n    mediaType: MediaType;\r\n    content?: HTMLImageElement | Howl;\r\n    sound?: Howl;\r\n}\r\n\r\nconst Preloader = (props: Props) => {\r\n\r\n    const [completed, setCompleted] = useState(false);\r\n    const [itemsLoaded, setItemsLoaded] = useState(0);\r\n\r\n    useEffect(() => {\r\n        loadMedia();\r\n    }, []);\r\n\r\n    const { children, manifest } = props;\r\n\r\n    const loadMedia = () => {\r\n        // todo: what if props get set at runtime\r\n        setItemsLoaded(0);\r\n\r\n        const promises = props.manifest\r\n            .map((url) => loadItem(url)\r\n            // tslint:disable-next-line:no-console\r\n            .catch((err) => console.error(err)));\r\n\r\n        Promise.all(promises).then((results) => {\r\n            if (props.onLoadComplete) {\r\n                props.onLoadComplete(media);\r\n            }\r\n            setCompleted(true);\r\n        });\r\n    }\r\n\r\n    const loadItem = async (url: string): Promise<MediaItem> => {\r\n        if (media.some((m) => m.url === url)) {\r\n            // tslint:disable-next-line:no-console\r\n            console.warn(`Loading media with url ${url} more than once! Will overwrite.`);\r\n        }\r\n        const mediaType = getType(url);\r\n        let item;\r\n        if (mediaType === MediaType.image) {\r\n            const value = await loadImage(url);\r\n            item = {\r\n                content: value,\r\n                mediaType,\r\n                url,\r\n            } ;\r\n        }\r\n        if (mediaType === MediaType.sound) {\r\n            const value = new Howl({\r\n                src: [ `${process.env.PUBLIC_URL}/${url}` ],\r\n            });\r\n            item = {\r\n                content: value,\r\n                mediaType,\r\n                url,\r\n            };\r\n        }\r\n        if (item) {\r\n            media.push(item);\r\n            setItemsLoaded(itemsLoaded + 1);\r\n            return item;\r\n        } else {\r\n            throw new Error(`Unknown error while trying to load ${url}`);\r\n        }\r\n    }\r\n    if (!completed) {\r\n        return (\r\n            <Indicator\r\n                itemsLoaded = { itemsLoaded }\r\n                itemsTotal = { manifest.length }\r\n            />\r\n        );\r\n    }\r\n    return <> {children} </>;\r\n}\r\n\r\nconst media: MediaItem[] = [];\r\n\r\nconst loadImage = (url: string): Promise<HTMLImageElement> => {\r\n    const image = new Image();\r\n    image.src = url;\r\n\r\n    return new Promise((resolve, reject) => {\r\n        if (image.naturalWidth) {\r\n            resolve(image);\r\n        } else if (image.complete) {\r\n            reject(null);\r\n        } else {\r\n            image.addEventListener(\"load\", check);\r\n            image.addEventListener(\"error\", check);\r\n        }\r\n        function check() {\r\n            if (image.naturalWidth) {\r\n                resolve(image);\r\n            } else {\r\n                reject(null);\r\n            }\r\n            image.removeEventListener(\"load\", check);\r\n            image.removeEventListener(\"error\", check);\r\n        }\r\n    });\r\n};\r\n\r\nconst getType = (url: string): MediaType => {\r\n    url = url.toLowerCase();\r\n    if (url.endsWith(\"png\") || url.endsWith(\"jpg\") || url.endsWith(\"gif\")) {\r\n        return MediaType.image;\r\n    }\r\n    if (url.endsWith(\"mp3\") || url.endsWith(\"ogg\") || url.endsWith(\"wav\")) {\r\n        return MediaType.sound;\r\n    }\r\n    throw Error(`Could not determine type for ${url}`);\r\n};\r\n\r\nexport default Preloader;","import { convertSemVerToInt } from \"utils/version\";\n\n// <MAJOR>.<MINOR>.<RELEASE>\n\nconst version = \"0.0.5\";\n\nexport default version;\nexport const asInt: number = convertSemVerToInt(version);\n","// tslint:disable:no-bitwise\n\n/**\n * Convert a sematic versioning string into an 32-bit integer.\n *\n * Make sure the input string is compatible with the standard found\n * at semver.org. Since this only uses 10-bit per major/minor/patch version,\n * the highest possible SemVer string would be 1023.1023.1023.\n * @param  {string} semVer SemVer string\n * @return {number}         Numeric version\n */\nexport const convertSemVerToInt = (semVer: string): number => {\n    // Split a given version string into three parts.\n    const parts = semVer.split(\".\").map((part) => Number(part));\n    // Check if we got exactly three parts, otherwise throw an error.\n    if (parts.length !== 3) {\n        throw new Error(`Received invalid version string: ${semVer}`);\n    }\n    // Make sure that no part is larger than 1023 or else it\n    // won't fit into a 32-bit integer.\n    parts.forEach((part: number) => {\n        if (part >= 1024) {\n            throw new Error(`Version string invalid, ${part} is too large`);\n        }\n    });\n    let numericVersion = 0;\n    // Shift all parts either 0, 10 or 20 bits to the left.\n    for (let i = 0; i < 3; i++) {\n        numericVersion |= parts[i] << i * 10;\n    }\n    return numericVersion;\n};\n\n/**\n * Converts a 32-bit integer into a semantic versioning (SemVer) compatible string.\n * @param  {number} version Numeric version\n * @return {string}   SemVer string\n */\nexport const convertIntToSemVer = (version: number) => {\n    // Works by shifting the numeric version to the right and then masking it\n    // with 0b1111111111 (or 1023 in decimal).\n    // eslint-disable-next-line no-mixed-operators\n    return `${version & 1023}.${version >> 10 & 1023}.${version >> 20 & 1023}`;\n};\n","import * as React from \"react\";\r\n\r\nexport interface Props {\r\n    itemsLoaded?: number;\r\n    itemsTotal?: number;\r\n}\r\n\r\n/**\r\n * Loading indicator\r\n */\r\nconst Indicator = (props: Props) =>  {\r\n    const { itemsLoaded, itemsTotal } = props;\r\n    return <div> { `Loading (${Math.floor((itemsLoaded || 0) / (itemsTotal || 0 ) * 100)})%`} </div>;\r\n}\r\n\r\nexport default Indicator;\r\n","import { Item } from 'definitions/items/types';\n\nexport enum StructureState {\n    NotBuilt,\n    Building,\n    Built,\n}\n\nexport interface StructureStoreState {\n    level: number;\n    workers: number;\n    state: StructureState;\n}\n\nexport const initialState: StructureStoreState = {\n    level: 0,\n    state: StructureState.NotBuilt,\n    workers: 0,\n};\n\nexport interface ProductionStructureStoreState extends StructureStoreState {\n    produces: Item[];\n}\n","import * as React from \"react\";\nimport { PropsWithChildren } from 'react';\nimport './styles/button.scss';\n\nexport enum ButtonSize {\n    auto, // will select either medium or small, depending on screen size\n    large,\n    medium,\n    small,\n}\n\nexport enum ButtonColor {\n    blue = \"blue\",\n    purple = \"purple\",\n    green = \"green\"\n}\n\nexport type Props = PropsWithChildren<{\n    text?: string;\n    color?: ButtonColor | \"blue\" | \"purple\" | \"green\"; // Can use enum or string\n    size?: ButtonSize | \"auto\" | \"large\" | \"medium\" | \"small\"; // Can use enum or string\n    className?: string;\n    disabled?: boolean;\n    square?: boolean;\n    onClick?: React.MouseEventHandler<Element>;\n}>\n\n\nconst Button = (props: React.ComponentProps<'button'> & Props) => {\n    const { color, size, square, text, ...otherProps } = props;\n\n    const handleClick = (e: React.MouseEvent<HTMLButtonElement>) => {\n        props.onClick?.(e)\n    };\n\n    const className = `button\n        ${props.className || \"\"}\n        button-${typeof color === \"string\" ? color : ButtonColor[color ?? ButtonColor.blue]}\n        button-${typeof props.size === \"string\" ? props.size : ButtonSize[props.size ?? ButtonSize.auto]}\n        ${square ? \"button-square\" : \"\"}\n    `;\n\n    return (\n        <button\n            {...otherProps}\n            className={className}\n            onClick={handleClick}\n        >\n            <span>\n                {!!text && text}\n                {!text && props.children}\n            </span>\n        </button>\n    );\n};\n\nexport default Button;\n","import * as PIXI from 'pixi.js';\n// Adapted from https://github.com/explooosion/hitarea-shapes/blob/master/src/index.js\n\nexport default class HitAreaShapes {\n    public shapes: PIXI.Polygon[];\n\n    constructor(shapes = {}, sprite: string = \"0\") {\n      this.shapes = shapes[sprite].map((definition: { shape: number[]; }) => {\n          const shape: number[] = definition.shape;\n          return new PIXI.Polygon(shape);\n      });\n    }\n  \n    /**\n     * Called by hitArea\n     * @param {number} x\n     * @param {number} y\n     */\n    contains(x = 0, y = 0) {\n      return (!this.shapes || this.shapes.length === 0)\n        ? false\n        : this.shapes.some(shape => shape.contains(x, y));\n    }\n  }","import React, { useState, useEffect } from 'react';\nimport { Structure } from 'definitions/structures';\nimport { Sprite, useApp, useTick } from '@inlet/react-pixi';\nimport HitAreaShapes from 'utils/hitAreaShapes';\nimport * as PIXI from 'pixi.js';\nimport { ITextureDictionary } from 'pixi.js';\nimport { STRUCTURE_HIGHLIGHT_FILTER } from 'components/town/TownView';\nimport { loadResource } from 'utils/pixiJs';\n\nconst BLADE_ROTATION_SPEED = 0.01;\n\nexport interface Props {\n    onStructureClick: (structure: Structure | null) => void;\n    position: PIXI.Point;\n    selected?: boolean;\n    hitAreaShapes: HitAreaShapes;\n}\n\nconst LumberMill = (props: Props) => {\n    const {hitAreaShapes} = props;\n    const structure = Structure.lumberMill;\n    const atlas = `${process.env.PUBLIC_URL}/img/town/town-alpha/${structure}.json`;\n    const [textures, setTextures] = useState<ITextureDictionary>();\n    const filters = props.selected ? [STRUCTURE_HIGHLIGHT_FILTER] : [];\n\n    const app = useApp();\n\n    useEffect(() => {\n        loadResource(atlas, (resource) => {\n            setTextures(resource.textures);    \n        })\n    }, [app, app.loader, atlas]);\n\n    const [rotation, setRotation] = useState(0);\n    useTick((delta:number | undefined) => setRotation(r => r + (BLADE_ROTATION_SPEED * delta!)));\n\n\n    if (!textures) return null;\n    return (\n        <Sprite \n            name={structure}\n            position={props.position}\n            interactive={true}\n            buttonMode={true}\n            pointertap={() => {\n                props.onStructureClick(structure);\n            }}\n            hitArea={hitAreaShapes}\n            filters={filters}\n            texture={textures[\"structure.png\"]}\n        >\n            <Sprite \n                name=\"blades\"\n                texture={textures[\"blades.png\"]}\n                anchor={new PIXI.Point(0.5, 0.5)}\n                x={15}\n                y={10}\n                rotation={rotation}\n            /> \n        </Sprite>        \n    )\n}\n\nexport default LumberMill;","import { PixiComponent, applyDefaultProps, Container } from \"@inlet/react-pixi\";\nimport * as PIXI  from 'pixi.js';\nimport * as particles from 'pixi-particles';\n\ninterface Props  {\n    image: string;\n    config: particles.OldEmitterConfig | particles.EmitterConfig;\n};\n\nconst ParticleEmitter = PixiComponent<Props & React.ComponentProps<typeof Container>, PIXI.ParticleContainer>(\"ParticleEmitter\", {\n    create() {\n      return new PIXI.ParticleContainer();\n    },\n\n    applyProps(instance, oldProps: Props, newProps: Props) {\n      const { image, config, ...newP } = newProps;\n\n      // apply rest props to PIXI.ParticleContainer\n      applyDefaultProps(instance, oldProps, newP);\n\n      let emitter = (this as any)._emitter;\n      if (!emitter) {\n        emitter = new particles.Emitter(\n          instance,\n          [PIXI.Texture.from(image)],\n          config\n        );\n\n        let elapsed = performance.now();\n\n        const tick = () => {\n          emitter.raf = requestAnimationFrame(tick);\n          const now = performance.now();\n          // const amp = Math.random() * 5 + 15;\n          // const amp = 15;\n          // const freq = 0.0015;\n          // emitter.acceleration.x = (Math.sin((elapsed * freq)) * amp) + 15;\n\n          emitter.update((now - elapsed) * 0.0003);\n\n          elapsed = now;\n        };\n        emitter.emit = true;\n        // emitter.update(00.2);\n\n        tick();\n      }\n      (this as any)._emitter = emitter;\n    },\n\n    willUnmount() {\n      if ((this as any)._emitter) {\n        (this as any)._emitter.emit = false;\n        cancelAnimationFrame((this as any)._emitter.raf);\n      }\n    }\n});\n\nexport default ParticleEmitter;","import React from \"react\";\nimport { Sprite, Container } from '@inlet/react-pixi';\nimport { Structure } from 'definitions/structures';\nimport HitAreaShapes from 'utils/hitAreaShapes';\nimport smoke from './smoke.json';\nimport ParticleEmitter from 'components/pixi/ParticleEmitter';\nimport { STRUCTURE_HIGHLIGHT_FILTER } from 'components/town/TownView';\n\nexport interface Props {\n    onStructureClick: (structure: Structure | null) => void;\n    position: PIXI.Point;\n    selected?: boolean;\n    hitAreaShapes: HitAreaShapes;\n}\n\nconst Tavern = (props: Props) => {\n    const {hitAreaShapes, position} = props;\n    const structure = Structure.tavern;\n    const filters = props.selected ? [STRUCTURE_HIGHLIGHT_FILTER] : [];\n\n    return (\n        <Container position={position}>\n            <Sprite\n                name={structure}\n                interactive={true}\n                buttonMode={true}\n                pointertap={() => {\n                    props.onStructureClick(structure);\n                }}\n                filters={filters}\n                hitArea={hitAreaShapes}\n                image={`${process.env.PUBLIC_URL}/img/town/town-alpha/${structure}.png`}\n            />\n            <ParticleEmitter\n                name=\"smoke\"\n                x={107}\n                y={-2}\n                image={`${process.env.PUBLIC_URL}/img/town/effects/smokeparticle.png`}\n                config={smoke}\n            />\n        </Container>\n    )\n}\nexport default Tavern;","import { AppContext } from \"components/App\";\nimport { MediaItem } from \"components/preloading/Preloader\";\nimport * as React from \"react\";\nimport { Component, ComponentType } from 'react';\n\n// Sharing context within the entire App\nexport interface AppContextProps {\n    onOpenWindow: (window: React.ReactElement) => void;\n    onCloseWindow: () => void;\n    media: MediaItem[] | null;\n}\n\nexport const withAppContext = <TWrappedComponentProps extends AppContextProps>(WrappedComponent: ComponentType<TWrappedComponentProps>) => {\n    type WrappedComponentPropsExceptProvided = Exclude<keyof TWrappedComponentProps, keyof AppContextProps>;\n    type ForwardedProps = Pick<TWrappedComponentProps, WrappedComponentPropsExceptProvided>;\n    return class WithContext extends Component<ForwardedProps> {\n        public render() {\n            return (\n                <AppContext.Consumer>\n                    {(context: any) => <WrappedComponent {...this.props } {...context} />}\n                </AppContext.Consumer>\n            );\n        }\n    };\n};\n","import React from 'react';\nimport { Structure } from 'definitions/structures';\nimport { Sprite } from '@inlet/react-pixi';\nimport HitAreaShapes from 'utils/hitAreaShapes';\nimport { STRUCTURE_HIGHLIGHT_FILTER } from 'components/town/TownView';\n\nexport interface Props {\n    onStructureClick: (structure: Structure | null) => void;\n    position: PIXI.Point;\n    selected?: boolean;\n    structure: Structure;\n    hitAreaShapes: HitAreaShapes;\n}\n\nconst Generic = (props: Props) => {\n    const {structure, position, hitAreaShapes, selected, onStructureClick} = props;\n    const filters = selected ? [STRUCTURE_HIGHLIGHT_FILTER] : [];\n\n    const handlePointerTap = () => {\n        onStructureClick(structure);\n    };\n\n    return (\n        <Sprite\n            name={structure}\n            position={position}\n            interactive={true}\n            buttonMode={true}\n            pointertap={handlePointerTap}\n            hitArea={hitAreaShapes}\n            filters={filters}\n            image={`${process.env.PUBLIC_URL}/img/town/town-alpha/${structure}.png`}\n        >\n            {/* <Graphics\n                name=\"hitarea\"\n                draw={graphics => {\n                    graphics.beginFill(0xffffff);\n                    hitAreaShapes.shapes.map(shape => graphics.drawPolygon(shape))\n                    graphics.endFill();\n                }}\n            /> */}\n        </Sprite>\n    );\n}\nexport default Generic;","import React from \"react\";\nimport \"./css/legenda.css\";\nimport { StructuresStoreState } from 'stores/structures';\nimport { Structure } from 'definitions/structures';\nimport { StructureStoreState, StructureState } from 'stores/structure';\nimport { Link } from 'react-router-dom';\nimport { getStructureLink, getTownLink } from 'utils/routing';\nimport { TextManager } from 'global/TextManager';\nimport { useRouteMatch } from 'react-router';\n\ninterface Props {\n    structures: StructuresStoreState;\n}\n\n// Legenda with clickable names of structures\nconst Legenda = (props: Props) => {\n    const {structures} = props;\n    const orderedStructures = [\n        Structure.workshop,\n        Structure.quarry,\n        Structure.tavern,\n        Structure.tannery,\n        Structure.alchemist,\n        Structure.garden,\n        Structure.weaponsmith,\n        Structure.armoursmith,\n        Structure.warehouse,\n        Structure.mine,\n        Structure.lumberMill,\n        Structure.weaver,\n    ];\n    const match = useRouteMatch<{structure: string}>(`${getTownLink()}/:structure`);\n\n    const renderText = (structure: Structure) => {\n        if (match?.params.structure === structure.toString()) {\n            return (\n                <span className=\"highlighted\">{`${TextManager.getStructureName(structure)}`}</span>\n            )\n        }\n        return (\n            <Link to={getStructureLink(structure)} >\n                {`${TextManager.getStructureName(structure)}`}\n            </Link>\n        )\n    }\n\n    return (\n        <div className=\"legenda\">\n            <ul>\n            {orderedStructures.map((structure) => {\n                const structureStore: StructureStoreState = structures[structure];\n                if (structureStore.state === StructureState.NotBuilt) {\n                    return null;\n                }\n                return (\n                    <li key={structure}>\n                        {renderText(structure)}\n                    </li>\n                );\n            })}\n            </ul>\n        </div>\n    );\n}\n\nexport default Legenda;","import React, { forwardRef } from \"react\";\nimport { Viewport as PixiViewport, ClickEventData } from \"pixi-viewport\";\nimport { PixiComponent, useApp } from \"@inlet/react-pixi\";\nimport gauntlet from \"components/App/styles/img/cursors/dwarven_gauntlet_extra_6.png\";\n\ninterface Props {\n  onClick?(event: ClickEventData): void;\n  screenWidth: number,\n  screenHeight: number,\n  worldWidth: number,\n  worldHeight: number,\n  minScale?: number;\n  maxScale?: number;\n}\n\n/** Viewport leverages pixi-viewport to create a pannable map\n * https://davidfig.github.io/pixi-viewport/jsdoc/\n */\nconst Viewport = forwardRef<PixiViewport, any>((props, ref) => {\n  const app = useApp();\n  if (app) {\n      // Perhaps this is better moved somewhere else\n      const cursor = `url('${gauntlet}'), auto`;\n      app.renderer.plugins.interaction.cursorStyles.pointer = cursor;\n  }\n  return <PixiComponentViewport app={app} {...props} ref={ref} />;\n})\n\ninterface PixiComponentProps {\n    app: PIXI.Application;\n}\n\nconst PixiComponentViewport = PixiComponent(\"Viewport\", {\n  create: (props: PixiComponentProps & Props) => {\n    const viewport = new PixiViewport({\n      screenWidth: props.screenWidth,\n      screenHeight: props.screenHeight,\n      worldWidth: props.worldWidth,\n      worldHeight: props.worldHeight,\n      ticker: props.app.ticker,\n      interaction: props.app.renderer.plugins.interaction,\n      // the interaction module is important for wheel to work properly when renderer.view is placed or scaled\n    });\n    viewport.on(\"clicked\", (event) => { if(props.onClick) props.onClick(event) });\n\n    const {\n      minScale = 1,\n      maxScale = 2\n    } = props;\n\n    viewport\n      .drag()\n      .pinch()\n      .wheel()\n      .clamp({ direction: 'all' })\n      .clampZoom({ minScale, maxScale })\n      .decelerate();\n\n    return viewport;\n  }\n});\nexport default Viewport;\n","\nimport React, { useRef, useEffect, PropsWithChildren, forwardRef, useImperativeHandle } from \"react\";\nimport { Sprite, Stage } from '@inlet/react-pixi';\nimport { Viewport as PixiViewport} from 'pixi-viewport';\nimport { GodrayFilter } from 'pixi-filters';\nimport Viewport from 'components/pixi/Viewport';\nimport { gsap } from 'gsap';\n\nexport interface Props {\n    screenWidth: number;\n    screenHeight: number;\n    worldWidth: number;\n    worldHeight: number;\n}\n\n\nconst TownStage = forwardRef<any, PropsWithChildren<Props>>((props, ref: React.Ref<PixiViewport>) => {\n    const {\n        children,\n        screenWidth,\n        screenHeight,\n        worldWidth,\n        worldHeight\n    } = props;\n\n    const innerRef = useRef<PixiViewport>(null);\n\n    useImperativeHandle(ref, () => {\n        return innerRef.current!\n    });\n\n\n    useEffect(() => {\n        godray.enabled = false;\n        if(innerRef.current) {\n\n            const viewport = innerRef.current;\n            viewport.on(\"moved\", () => {\n                const horizontalFactor = gsap.utils.normalize(viewport.screenWidth, worldWidth, viewport.right);\n                const verticalFactor = gsap.utils.normalize(worldHeight, viewport.screenHeight, viewport.bottom);\n                const factor = Math.max(horizontalFactor * verticalFactor - .4, 0);;\n\n                godray.gain =  factor;\n                godray.lacunarity = 2.4;\n                godray.enabled = godray.gain > 0;\n            })\n        }\n\n        const onScroll = (e: WheelEvent) => {\n            // Scrolling the mouse is just used for zoom, not for actual scrolling\n            e.preventDefault();\n        }\n        window.addEventListener(\"wheel\", onScroll, {passive: false});\n        return () => {\n            window.removeEventListener(\"wheel\", onScroll);\n        };\n    }, [worldHeight, worldWidth]);\n\n    return (\n        <Stage width={screenWidth} height={screenHeight} options={options} >\n            <Viewport\n                screenWidth={screenWidth}\n                screenHeight={screenHeight}\n                worldWidth={worldWidth}\n                worldHeight={worldHeight}\n                ref={innerRef}>\n                <Sprite\n                    name=\"background\"\n                    image={`${process.env.PUBLIC_URL}/img/town/town-alpha/background.png`}\n                    filters={[godray]}\n                >\n                    {children}\n                </Sprite>\n            </Viewport>\n        </Stage>\n\n    )\n});\n\nexport default TownStage;\n\nconst options = {\n    autoDensity: true,\n    sharedLoader: true\n}\n\nexport const godray = new GodrayFilter();\n","import React, { useRef, useEffect, useState } from \"react\";\r\nimport { Structure } from 'definitions/structures';\r\nimport { StructuresStoreState } from 'stores/structures';\r\nimport { SoundManager, MusicTrack } from 'global/SoundManager';\r\nimport { useRouteMatch } from 'react-router';\r\nimport {OutlineFilter} from '@pixi/filter-outline';\r\nimport { getTownLink } from 'utils/routing';\r\nimport { StructureState, StructureStoreState } from 'stores/structure';\r\nimport { useSelector } from 'react-redux';\r\nimport { StoreState } from 'stores';\r\nimport { gsap } from 'gsap';\r\nimport { MAX_WIDTH } from 'components/App';\r\nimport HitAreaShapes from 'utils/hitAreaShapes';\r\nimport polygons from './hitAreas.json';\r\nimport LumberMill from './structures/LumberMill';\r\nimport Tavern from './structures/Tavern';\r\nimport { withAppContext, AppContextProps } from 'hoc/withAppContext';\r\nimport Generic from './structures/Generic';\r\nimport Legenda from './Legenda';\r\nimport \"./styles/townView.scss\"\r\nimport TownStage from './TownStage';\r\nimport { Viewport as PixiViewport } from \"pixi-viewport\";\r\n\r\nconst HEIGHT = 1079;\r\nconst WORLD_WIDTH = 1024;\r\nconst WORLD_HEIGHT = 1600;\r\n\r\nexport interface Props {\r\n    onStructureClick: (structure: Structure | null) => void;\r\n}\r\n\r\nexport const STRUCTURE_HIGHLIGHT_FILTER = new OutlineFilter(8, 0xffcc00);\r\n\r\nconst TownView = (props: Props & AppContextProps) => {\r\n    const match = useRouteMatch<{structure: string}>(`${getTownLink()}/:structure`);\r\n    const selectedStructure = match?.params.structure;\r\n    const ref = useRef<HTMLDivElement>(null);\r\n    const viewportRef = useRef<PixiViewport>(null);\r\n    const dragging = useRef(false);\r\n\r\n    useEffect(() => {\r\n        SoundManager.addMusicTrack(MusicTrack.town, \"sound/music/Soliloquy.mp3\");\r\n        SoundManager.playMusicTrack(MusicTrack.town);\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        const tween = gsap.to(STRUCTURE_HIGHLIGHT_FILTER, {\r\n            duration: .6,\r\n            thickness: 2,\r\n            yoyo: true,\r\n            repeat: -1\r\n        });\r\n        return () => {\r\n            tween.pause(0);\r\n            tween.kill();\r\n        }\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        if(viewportRef.current) {\r\n\r\n            const viewport = viewportRef.current;\r\n            viewport.on(\"drag-start\", (e) => {\r\n                dragging.current = true;\r\n                e.event.stopPropagation();\r\n            });\r\n            viewport.on(\"drag-end\", () => { dragging.current = false; });\r\n        }\r\n    }, []);\r\n\r\n    const handleStructureClick = (structure: Structure | null) => {\r\n        if (!dragging.current) {\r\n            props.onStructureClick(structure);\r\n        }\r\n    }\r\n    // console.log('rendering town');\r\n\r\n    const structures = useSelector<StoreState, StructuresStoreState>((state: StoreState) => {\r\n        return state.structures;\r\n    });\r\n\r\n\r\n    const renderStructures = () => {\r\n        const orderedStructures = [\r\n            Structure.workshop,\r\n            Structure.quarry,\r\n            Structure.tavern,\r\n            Structure.tannery,\r\n            Structure.alchemist,\r\n            Structure.garden,\r\n            Structure.weaponsmith,\r\n            Structure.armoursmith,\r\n            Structure.warehouse,\r\n            Structure.mine,\r\n            Structure.lumberMill,\r\n            Structure.weaver,\r\n        ]\r\n        return orderedStructures.reverse().map((structure) => {\r\n            const structureStore: StructureStoreState = structures[structure];\r\n            if (structureStore.state === StructureState.NotBuilt) {\r\n                return null;\r\n            }\r\n            // todo: refactor into seperate components\r\n\r\n            const StructureComponent = getStructure(structure);\r\n            const position = getStructurePosition(structure);\r\n            const hitAreaShapes = new HitAreaShapes(polygons, structure);\r\n            return (\r\n                <StructureComponent\r\n                    position={position}\r\n                    structure={structure}\r\n                    hitAreaShapes={hitAreaShapes}\r\n                    onStructureClick={handleStructureClick}\r\n                    key={structure}\r\n                    selected={selectedStructure === structure}\r\n                />\r\n            );\r\n        });\r\n    }\r\n\r\n    useEffect(() => {\r\n        if (selectedStructure && viewportRef.current) {\r\n            const viewport = viewportRef.current;\r\n            viewport.zoomPercent(0);\r\n            const position = getStructurePosition(Structure[selectedStructure]);\r\n            viewport.moveCenter(position);\r\n        }\r\n    }, [selectedStructure]);\r\n\r\n    const [canvasWidth, setCanvasWidth] = useState(MAX_WIDTH);\r\n    const [canvasHeight, setCanvasHeight] = useState(HEIGHT);\r\n\r\n    useEffect(() => {\r\n        // This will set the dimensions of the canvas tot that of the townview\r\n        const resize = () => {\r\n            const worldViewWidth = ref.current?.clientWidth || MAX_WIDTH;\r\n            const worldViewHeight = ref.current?.clientHeight || HEIGHT;\r\n\r\n            setCanvasWidth(worldViewWidth);\r\n            setCanvasHeight(worldViewHeight);\r\n        }\r\n        resize();\r\n        window.addEventListener(\"resize\", resize);\r\n        return () => {\r\n            window.removeEventListener(\"resize\", resize);\r\n        };\r\n    }, []);\r\n\r\n\r\n    return (\r\n        <div className=\"town-view\" ref={ref}>\r\n            <Legenda structures={structures} />\r\n            <TownStage\r\n                screenWidth={canvasWidth}\r\n                screenHeight={canvasHeight}\r\n                worldWidth={WORLD_WIDTH}\r\n                worldHeight={WORLD_HEIGHT}\r\n                ref={viewportRef}\r\n            >\r\n                {renderStructures()}\r\n            </TownStage>\r\n            {/* { selectedStructure && (\r\n                <StructureDetailsView\r\n                    structure={selectedStructure}\r\n                    title={TextManager.getStructureName(selectedStructure)}\r\n                    onClose={() => handleStructureClick(null)}\r\n                />\r\n            )} */}\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default withAppContext(TownView);\r\n\r\nconst getStructure = (structure: Structure) => {\r\n    switch (structure) {\r\n        case Structure.workshop:\r\n        case Structure.quarry:\r\n        case Structure.tannery:\r\n        case Structure.alchemist:\r\n        case Structure.garden:\r\n        case Structure.weaponsmith:\r\n        case Structure.armoursmith:\r\n        case Structure.warehouse:\r\n        case Structure.mine:\r\n        case Structure.weaver:\r\n            return Generic;\r\n        case Structure.lumberMill:\r\n            return LumberMill;\r\n        case Structure.tavern:\r\n            return Tavern;\r\n    }\r\n}\r\n\r\nconst getStructurePosition = (structure: Structure) => {\r\n    let x;\r\n    let y;\r\n    switch (structure) {\r\n        case Structure.workshop:\r\n            x = 373;\r\n            y = 610;\r\n            break;\r\n        case Structure.quarry:\r\n            x = 632;\r\n            y = 633;\r\n            break;\r\n        case Structure.tannery:\r\n            x = 372;\r\n            y = 460;\r\n            break;\r\n        case Structure.tavern:\r\n            x = 500;\r\n            y = 469;\r\n            break;\r\n        case Structure.alchemist:\r\n            x = 411;\r\n            y = 371;\r\n            break;\r\n        case Structure.garden:\r\n            x = 822;\r\n            y = 689;\r\n            break;\r\n        case Structure.weaponsmith:\r\n            x = 449;\r\n            y = 460;\r\n            break;\r\n        case Structure.armoursmith:\r\n            x = 473;\r\n            y = 442;\r\n            break;\r\n        case Structure.warehouse:\r\n            x = 471;\r\n            y = 130;\r\n            break;\r\n        case Structure.lumberMill:\r\n            x = 403;\r\n            y = 320;\r\n            break;\r\n        case Structure.mine:\r\n            x = 183;\r\n            y = 527;\r\n            break;\r\n        case Structure.weaver:\r\n            x = 484;\r\n            y = 333;\r\n            break;\r\n    }\r\n    return new PIXI.Point(x, y);\r\n}","import React, { useEffect, useState } from 'react';\nimport { ToastManager, ToastConfig } from 'global/ToastManager';\nimport Toast from './Toast';\nimport './styles/toasts.scss';\n\n// Toasts can be added by calling ToastManager.addToast\n// ToastManager will inform whenever the something is added to the list of toasts via EVENT_TOASTS_UPDATED\n// The toasts themselves will fade out via css transition\nconst Toasts = () => {\n\n    const [activeToasts, setActiveToasts] = useState<ToastConfig[]>([]);\n\n    const toastsUpdated = (stack: ToastConfig[]) => {\n        setActiveToasts(stack);\n    }\n\n    useEffect(() => {\n        ToastManager.addEventListener(ToastManager.EVENT_TOASTS_UPDATED, toastsUpdated);\n        return () => {\n            ToastManager.removeEventListener(ToastManager.EVENT_TOASTS_UPDATED, toastsUpdated);\n        }\n    }, []);\n\n    return (\n        <div className=\"toasts\" > \n            { activeToasts.map((toastConfig) => (\n                <Toast key={toastConfig.time} {...toastConfig}/>\n            ))}\n        </div>\n    )\n}\n\nexport default Toasts;","// tslint:disable:object-literal-sort-keys\nimport { Action } from \"redux\";\nimport { ResourceStoreState } from \"stores/resources\";\n\nexport enum ActionType {\n    addResources = \"addResources\",\n    removeResources = \"removeResources\",\n}\n\nexport interface AddResources extends Action<ActionType> {\n    resources: ResourceStoreState;\n}\n\nexport function addResource(resource: string, value: number): AddResources {\n    return addResources({\n        [resource]: value,\n    });\n}\n\nexport function addResources(resources: ResourceStoreState): AddResources {\n    return {\n        type: ActionType.addResources,\n        resources,\n    };\n}\n\nexport function removeResources(resources: ResourceStoreState): AddResources {\n    return {\n        type: ActionType.removeResources,\n        resources,\n    };\n}\n","// tslint:disable:object-literal-sort-keys\n\nimport { Structure } from \"definitions/structures\";\nimport { Action } from \"redux\";\nimport { StructureState } from \"stores/structure\";\nimport { Item } from 'definitions/items/types';\n\nexport enum ActionType {\n    upgradeStructure = \"upgradeStructure\",\n    increaseWorkers = \"increaseWorkers\",\n    decreaseWorkers = \"decreaseWorkers\",\n    startBuildingStructure = \"startBuildingStructure\",\n    finishBuildingStructure = \"finishBuildingStructure\",\n    setStructureState = \"setStructureState\",\n    addItemToToProduces = \"addItemToToProduces\"\n}\n\nexport interface StructureAction extends Action<ActionType> {\n    structure: Structure;\n}\nexport interface StructureStateAction extends StructureAction {\n    state: StructureState;\n}\nexport interface AddItemToProducesAction extends StructureAction {\n    item: Item;\n}\n\nexport interface WorkerCountAction extends StructureAction {\n    workers: number;\n}\n\nexport function startBuildingStructure(structure: Structure): StructureAction {\n    return {\n        type: ActionType.startBuildingStructure,\n        structure,\n    };\n}\n\nexport function finishBuildingStructure(structure: Structure): StructureAction {\n    return {\n        type: ActionType.finishBuildingStructure,\n        structure,\n    };\n}\n\nexport function upgradeStructure(structure: Structure): StructureAction {\n    return {\n        type: ActionType.upgradeStructure,\n        structure,\n    };\n}\n\n// Increases workers used by given structure by given amount\nexport function increaseWorkers(structure: Structure, workers: number = 1): WorkerCountAction {\n    return {\n        type: ActionType.increaseWorkers,\n        structure,\n        workers,\n    };\n}\n\n// Decreases workers used by given structure by given amount\nexport function decreaseWorkers(structure: Structure, workers: number = 1): WorkerCountAction {\n    return {\n        type: ActionType.decreaseWorkers,\n        structure,\n        workers,\n    };\n}\n\nexport function setStructureState(structure: Structure, state: StructureState): StructureStateAction {\n    return {\n        type: ActionType.setStructureState,\n        structure,\n        state,\n    };\n}\n\nexport function addItemToToProduces(structure: Structure, item: Item): AddItemToProducesAction {\n    return {\n        type: ActionType.addItemToToProduces,\n        structure,\n        item,\n    };\n}\n","import * as React from \"react\";\nimport { SoundManager, Sound } from 'global/SoundManager';\nimport \"components/ui/styles/icon.scss\";\nimport \"components/ui/resources/css/resourcesbox.css\";\nimport Button from '../buttons/Button';\n\n// todo: refactor using WindowManager [30/03/2020]\nexport interface Props {\n    title: string;\n    backEnabled?: boolean;\n    closeEnabled?: boolean;\n    onClose?: () => void;\n    onBack?: () => void;\n}\n\ntype AllProps = Props;\n\n/**\n *\n */\nconst Window: React.FunctionComponent<AllProps> = (props) => {\n\n    const handleClose = (e: React.MouseEvent) => {\n        if (props.onClose) {\n            props?.onClose();\n\n            SoundManager.playSound(Sound.buttonClick);\n        }\n    };\n\n    const handleBack = (e: React.MouseEvent) => {\n        if (props.onBack) {\n            props?.onBack();\n\n            SoundManager.playSound(Sound.buttonClick);\n        }\n    };\n\n    return (\n        <div className = \"window\">\n            <div className = \"header\">\n                { props.backEnabled !== false && (\n                    <Button\n                        className=\"back-button\"\n                        onClick={handleBack}\n                        square={true}\n                        size={\"medium\"}\n                        color=\"purple\"\n                        text=\"<\"\n                    />\n                )}\n                <h3>{ props.title }</h3>\n                { props.closeEnabled !== false && (\n                    <Button\n                        className=\"close-button\"\n                        onClick={handleClose}\n                        square={true}\n                        size={\"medium\"}\n                        color=\"purple\"\n                        text=\"x\"\n                    />\n                )}\n            </div>\n            { props.children }\n        </div>\n    );\n};\n\nexport default Window;\n","import Window, { Props } from \"components/ui/window/Window\";\nimport * as React from \"react\";\nimport \"components/ui/window/styles/window.scss\";\n\nexport const withWindow = <TWrappedComponentProps extends Props>(WrappedComponent: React.ComponentType<TWrappedComponentProps>) => {\n    return class WithWindow extends React.Component<TWrappedComponentProps> {\n\n        public render() {\n            return <Window { ...this.props } >\n                <WrappedComponent { ...this.props } />\n            </Window>;\n        }\n    };\n};\n","import { withWindow } from \"hoc/withWindow\";\r\nimport * as React from \"react\";\r\nimport { compose } from \"redux\";\r\nimport { ChangeEvent, useRef } from 'react';\r\nimport { SoundManager } from 'global/SoundManager';\r\nimport \"./styles/settings.scss\";\r\nimport gsap from 'gsap';\r\n\r\nconst SettingsWindow = () => {\r\n\r\n    const soundSlider = useRef<HTMLInputElement>(null);\r\n    const musicSlider = useRef<HTMLInputElement>(null);\r\n\r\n    const handleSoundMuteClick = () => {\r\n        gsap.to(soundSlider.current, {\r\n            duration: .5,\r\n            value: 0,\r\n            onComplete: () => {\r\n                SoundManager.soundVolume = 0;\r\n            }\r\n        });\r\n    }\r\n    const handleMusicMuteClick = () => {\r\n        gsap.to(musicSlider.current, {\r\n            duration: .5,\r\n            value: 0,\r\n            onComplete: () => {\r\n                SoundManager.musicVolume = 0;\r\n            }\r\n        });\r\n    }\r\n\r\n    const handleSoundChange = (e: ChangeEvent<HTMLInputElement>) => {\r\n        const linear = parseFloat(e.target.value);\r\n        const log = Math.pow(linear, 2);\r\n        SoundManager.soundVolume = log;\r\n    };\r\n\r\n    const handleMusicChange = (e: ChangeEvent<HTMLInputElement>) => {\r\n        const linear = parseFloat(e.target.value);\r\n        const log = Math.pow(linear, 2);\r\n        SoundManager.musicVolume = log;\r\n    };\r\n\r\n    return (\r\n        <div className=\"settings-window\">\r\n            <details open = { true } className=\"sound\" >\r\n                <summary>Sound</summary>\r\n                <section>\r\n                    <p>\r\n                        <label>Sound</label>\r\n                        <button onClick={handleSoundMuteClick}>\r\n                            <span role=\"img\" aria-label=\"Mute\">🔇</span>\r\n                        </button>\r\n                        <input\r\n                            type=\"range\"\r\n                            min=\"0\"\r\n                            max=\"1\"\r\n                            step=\"0.05\"\r\n                            ref={soundSlider}\r\n                            onChange={handleSoundChange}\r\n                            defaultValue={`${Math.sqrt(SoundManager.soundVolume)}`}\r\n                        />\r\n                    </p>\r\n                    <p>\r\n                        <label>Music</label>\r\n                        <button onClick={handleMusicMuteClick}>\r\n                            <span role=\"img\" aria-label=\"Mute\">🔇</span>\r\n                        </button>\r\n                        <input\r\n                            type=\"range\"\r\n                            min=\"0\"\r\n                            max=\"1\"\r\n                            step=\"0.05\"\r\n                            ref={musicSlider}\r\n                            onChange={handleMusicChange}\r\n                            defaultValue={`${Math.sqrt(SoundManager.musicVolume)}`}\r\n                        />\r\n                    </p>\r\n                </section>\r\n            </details>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default compose(\r\n    withWindow,\r\n)(SettingsWindow);\r\n","import { Resource } from \"definitions/resources\";\n\n// Whenever a list of resource is shown, use this order\nexport const resourceOrder = [\n    Resource.food,\n    Resource.wood,\n    Resource.iron,\n    Resource.stone,\n    Resource.fabric,\n    Resource.leather,\n];\n","import { Item } from \"definitions/items/types\";\nimport { Action } from \"redux\";\n\n// tslint:disable:object-literal-sort-keys\nexport enum ActionType {\n    addItem = \"addItem\",\n    moveItemInWarehouse = \"moveItemInWarehouse\",\n    removeItem = \"removeItem\",\n}\n\nexport interface MoveItemInWarehouseAction extends Action<ActionType> {\n    fromSlot: number;\n    toSlot: number;\n}\n\nexport interface AddAction extends Action {\n    item: Item;\n    toSlot?: number;\n}\n\nexport interface RemoveItemFromWarehouseAction extends Action {\n    fromSlot: number;\n}\n\n// Adds one Item to the warehouse\n// slot is optional, will take the first empty slot if not provided\nexport function addItemToWarehouse(item: Item, toSlot?: number): AddAction {\n    return {\n        type: ActionType.addItem,\n        item,\n        toSlot,\n    };\n}\n\n// When an Item is moved from one slot to the other in the warehouse\nexport function moveItemInWarehouse(fromSlot: number, toSlot: number): MoveItemInWarehouseAction {\n    return {\n        type: ActionType.moveItemInWarehouse,\n        fromSlot,\n        toSlot,\n    };\n}\nexport function removeItemFromWarehouse(fromSlot: number): RemoveItemFromWarehouseAction {\n    return {\n        type: ActionType.removeItem,\n        fromSlot,\n    };\n}\n","import { Action } from \"redux\";\n\n// todo this should go somewhere else\nexport enum ActionType {\n    addWorkers = \"addWorkers\",\n}\n\nexport interface ModifyWorkersAction extends Action<ActionType> {\n    value: number;\n}\n\nexport function addWorkers(value: number): ModifyWorkersAction {\n    return {\n        type: ActionType.addWorkers,\n        value,\n    };\n}\nexport function subtractWorkers(value: number): ModifyWorkersAction {\n    return {\n        type: ActionType.addWorkers,\n        value: -value,\n    };\n}\n","import { ItemDefinition } from \"definitions/items/types\";\nimport { WeaponType } from 'definitions/items/weapons';\nimport { TraitDefinition } from 'definitions/traits/types';\n\n// Things that can be shown on the ContextPopup\nexport enum ContextType {\n    item,\n    trait,\n    resource,\n    skill\n}\n\nexport type ContextInfo = ItemDefinition | TraitDefinition | WeaponType | string;\n","import { getDefinition } from \"definitions/items\";\r\nimport { Item, ItemType } from \"definitions/items/types\";\r\nimport { getDefinition as getStructureDefinition, Structure } from \"definitions/structures\";\r\nimport * as React from \"react\";\r\nimport { StructureState, StructureStoreState } from \"stores/structure\";\r\nimport { StructuresStoreState } from \"stores/structures\";\r\nimport { TextManager } from \"global/TextManager\";\r\nimport { useRef, useState } from 'react';\r\nimport { ToastManager } from 'global/ToastManager';\r\nimport { Type } from 'components/ui/toasts/Toast';\r\nimport { useDispatch, useSelector } from 'react-redux';\r\nimport { addLogText } from 'actions/log';\r\nimport { LogChannel } from 'stores/logEntry';\r\nimport { resourceOrder } from 'constants/resources';\r\nimport { ResourceStoreState } from 'stores/resources';\r\nimport { addResources } from 'actions/resources';\r\nimport { setStructureState } from 'actions/structures';\r\nimport { StoreState } from 'stores';\r\nimport { addGold } from 'actions/gold';\r\nimport { addItemToWarehouse } from 'actions/items';\r\nimport { addWorkers } from 'actions';\r\nimport { withWindow } from 'hoc/withWindow';\r\nimport \"./styles/cheat.scss\";\r\n\r\n\r\n// tslint:disable-next-line:no-empty-interface\r\nexport interface Props {\r\n}\r\n\r\n\r\nconst CheatWindow = (props: Props) => {\r\n\r\n    const itemSelectRef = useRef<HTMLSelectElement>(null);\r\n    const [cheats, setCheats] = useState({\r\n        gold: 50,\r\n        resources: 50,\r\n        workers: 10,\r\n    });\r\n    const dispatch = useDispatch();\r\n\r\n    const onCheatGold = (amount: number) => {\r\n        dispatch(addGold(amount));\r\n        dispatch(addLogText(\"common-cheat-gold-added\", { amount }, LogChannel.common));\r\n    };\r\n\r\n    const onCheatItem = (item: Item) => {\r\n        dispatch(addItemToWarehouse(item));\r\n        dispatch(addLogText(\"common-cheat-item-added\", { item }, LogChannel.common));\r\n    };\r\n\r\n    const onCheatResources = (amount: number) => {\r\n        // Create ResourceStoreState where value of each resource is `amount`\r\n        const resources = resourceOrder.reduce((acc: ResourceStoreState, resource) => {\r\n            acc[resource] = amount;\r\n            return acc;\r\n        }, {});\r\n\r\n        dispatch(addResources(resources));\r\n        dispatch(addLogText(\"common-cheat-resources-added\", { amount }, LogChannel.common));\r\n    };\r\n\r\n    const onCheatStructureState = (structure: Structure, state: StructureState) => {\r\n        dispatch(setStructureState(structure, state))\r\n    }\r\n\r\n    const onCheatWorkers = (amount: number) => {\r\n        dispatch(addWorkers(amount));\r\n        dispatch(addLogText(\"common-cheat-workers-added\", { amount }, LogChannel.common));\r\n    };\r\n\r\n    const structures = useSelector<StoreState, StructuresStoreState>(store => store.structures);\r\n\r\n    const getStructureRow = (structure: Structure) => {\r\n        const structureDef = getStructureDefinition(structure);\r\n        const structureStore: StructureStoreState = structures[structure];\r\n        const levelDef = structureDef.levels[structureStore.level];\r\n\r\n        const displayName = TextManager.get(levelDef.displayName);\r\n\r\n        return (\r\n            <div\r\n                className=\"label-dropdown\"\r\n                key={structure}\r\n            >\r\n                <label title={structure}>\r\n                    { `${displayName}` }\r\n                </label>\r\n                <input\r\n                    key={structure}\r\n                    type=\"checkbox\"\r\n                    checked={structureStore.state === StructureState.Built }\r\n                    onChange={() => handleChangeStructureState(structure, structureStore.state !== StructureState.Built)}\r\n                />\r\n            </div>\r\n        );\r\n    };\r\n\r\n    const getItemTypeOptions = (type: ItemType) => {\r\n        return Object.keys(Item)\r\n            // eslint-disable-next-line eqeqeq\r\n            // tslint:disable-next-line: triple-equals\r\n            .filter((item: string) => getDefinition(item as Item).itemType == type)\r\n            .map((item: string) => getItemOption(item as Item));\r\n    };\r\n\r\n    const getItemOption = (item: Item) => {\r\n        return (\r\n            <option value ={item } key ={item }>\r\n                { TextManager.getItemName(item) }\r\n            </option>\r\n        );\r\n    };\r\n\r\n    const items = Object.keys(ItemType)\r\n        .filter((val: any) => !isNaN(val))\r\n        .map((type: string) => {\r\n        return (\r\n            <optgroup label ={ItemType[type] } key ={type }>\r\n                { getItemTypeOptions(type as unknown as ItemType) }\r\n            </optgroup>\r\n        );\r\n    });\r\n\r\n\r\n    const handleCheatGold = (evt: React.MouseEvent<HTMLButtonElement>) => {\r\n        const amount = cheats.gold;\r\n        onCheatGold(amount);\r\n\r\n        const text = TextManager.get(\"common-cheat-gold-added\", { amount });\r\n        const icon = \"/img/resources/gold.png\";\r\n        ToastManager.addToast(text, Type.cheat, icon);\r\n    }\r\n\r\n    const handleCheatWorkers = (evt: React.MouseEvent<HTMLButtonElement>) => {\r\n        const amount = cheats.workers;\r\n        onCheatWorkers(amount);\r\n        const text = TextManager.get(\"common-cheat-workers-added\", { amount });\r\n        const icon = \"/img/resources/worker.png\";\r\n        ToastManager.addToast(text, Type.cheat, icon);\r\n    }\r\n\r\n    const handleCheatResources = (evt: React.MouseEvent<HTMLButtonElement>) => {\r\n        onCheatResources(cheats.resources);\r\n        const text = TextManager.get(\"common-cheat-resources-added\", { amount: cheats.resources });\r\n        ToastManager.addToast(text, Type.cheat);\r\n    }\r\n\r\n    const handleCheatItem = (evt: React.MouseEvent<HTMLButtonElement>) => {\r\n        const item = itemSelectRef.current!.value as Item;\r\n        onCheatItem(item);\r\n\r\n        const text = TextManager.get(\"common-cheat-item-added\", { item });\r\n        const icon = getDefinition(item).iconImg;\r\n        ToastManager.addToast(text, Type.cheat, icon);\r\n    }\r\n\r\n    const handleChangeStructureState = (structure: Structure, checked: boolean) => {\r\n        onCheatStructureState(structure, checked ? StructureState.Built : StructureState.NotBuilt);\r\n        if (checked) {\r\n            ToastManager.addToast(`The ${TextManager.getStructureName(structure)} is constructed`, Type.cheat);\r\n        } else {\r\n            ToastManager.addToast(`The ${TextManager.getStructureName(structure)} is not constructed`, Type.cheat);\r\n        }\r\n    }\r\n\r\n    const handleChangeGold = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n        const amount = Number(event.target.value);\r\n        setCheats({\r\n            ...cheats,\r\n            gold: amount,\r\n        });\r\n    }\r\n\r\n    const handleChangeWorkers = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n        const amount = Number(event.target.value);\r\n        setCheats({\r\n            ...cheats,\r\n            workers: amount,\r\n        });\r\n    }\r\n\r\n    const handleChangeResources = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n        const amount = Number(event.target.value);\r\n        setCheats({\r\n            ...cheats,\r\n            resources: amount,\r\n        });\r\n    }\r\n\r\n    return (\r\n        <div className=\"cheat-window\">\r\n            <div className=\"label-numberbox-button\">\r\n                <label>Gold</label>\r\n                <input type=\"number\"\r\n                    value= {cheats.gold}\r\n                    style={{width: \"50px\"}}\r\n                    onChange={handleChangeGold}/>\r\n                <button onClick={handleCheatGold}>Add</button>\r\n            </div>\r\n            <div className=\"label-numberbox-button\">\r\n                <label>Workers</label>\r\n                <input type=\"number\"\r\n                    value= {cheats.workers}\r\n                    style={{width: \"50px\"}}\r\n                    onChange={handleChangeWorkers}/>\r\n                <button onClick={handleCheatWorkers}>Add</button>\r\n            </div>\r\n            <div className=\"label-numberbox-button\">\r\n                <label>Resources</label>\r\n                <input type=\"number\"\r\n                    value= {cheats.resources}\r\n                    style={{width: \"50px\"}}\r\n                    onChange={handleChangeResources}/>\r\n                <button onClick={handleCheatResources}>Add</button>\r\n            </div>\r\n            <div className=\"label-numberbox-button\">\r\n                <label>Items</label>\r\n                <select style={{width: \"150px\"}} ref={itemSelectRef}>\r\n                    { items }\r\n                </select>\r\n                <button onClick={handleCheatItem}>Add</button>\r\n            </div>\r\n            { Object.keys(structures).map((structure) => getStructureRow(structure as Structure)) }\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default withWindow(CheatWindow);\r\n","import { Props as WindowProps } from \"components/ui/window/Window\";\r\nimport { AppContextProps, withAppContext } from \"hoc/withAppContext\";\r\nimport { withWindow } from \"hoc/withWindow\";\r\nimport * as React from \"react\";\r\nimport { compose } from \"redux\";\r\nimport SettingsWindow from './SettingsWindow';\r\nimport CheatWindow from './CheatWindow';\r\nimport { useSelector } from 'react-redux';\r\nimport { StoreState } from 'stores';\r\nimport { Persistor } from 'redux-persist';\r\nimport { loadGame } from 'index';\r\nimport { useState } from 'react';\r\nimport { ToastManager } from 'global/ToastManager';\r\nimport { Type } from 'components/ui/toasts/Toast';\r\nimport { TextManager } from 'global/TextManager';\r\nimport { createEncryptor } from 'simple-encryptor';\r\nimport \"./styles/menu.scss\";\r\nimport Button from 'components/ui/buttons/Button';\r\n\r\n// tslint:disable-next-line:no-empty-interface\r\nexport interface Props {\r\n    persistor: Persistor;\r\n}\r\n\r\nconst key = \"P5mw}jD>5c6Y]yqy\";\r\ntype AllProps = Props & WindowProps;\r\nconst Menu = (props: AllProps & AppContextProps) => {\r\n\r\n    const storeState = useSelector<StoreState>(state => state);\r\n    const [loadedStore, setLoadedStore] = useState<StoreState>();\r\n\r\n    const handleClickCheats = () => {\r\n        const window = <CheatWindow title=\"Cheats\" />;\r\n        props.onOpenWindow(window);\r\n    };\r\n\r\n    const handleClickSettings = () => {\r\n        const window = <SettingsWindow title=\"Settings\" />;\r\n        props.onOpenWindow(window);\r\n    };\r\n\r\n    const handleClickSave = () => {\r\n        const encryptor = createEncryptor(key);\r\n        const a = document.createElement('a');\r\n        const text = JSON.stringify(storeState);\r\n        const encrypted = encryptor.encrypt(text);\r\n        const filename = \"Gidletown save.json\";\r\n        a.setAttribute('href', 'data:text/json;cccharset=utf-8,' + encodeURIComponent(encrypted));\r\n        a.setAttribute('download', filename);\r\n        a.click();\r\n    }\r\n\r\n    const handleClickLoad = async () => {\r\n        if (!loadedStore) return;\r\n        setLoadedStore(undefined);\r\n\r\n        await loadGame(loadedStore);\r\n        ToastManager.addToast(TextManager.get(\"ui-game-loaded\"), Type.game, \"/img/items/misc/magic-eye.png\");\r\n        props.onCloseWindow();\r\n\r\n    }\r\n\r\n    const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const encryptor = createEncryptor(key);\r\n        const fileReader = new FileReader();\r\n        fileReader.onload = () => {\r\n            const encrypted = fileReader.result! as string;\r\n            const text = encryptor.decrypt(encrypted);\r\n            const obj: StoreState = JSON.parse(text);\r\n            setLoadedStore(obj);\r\n        }\r\n        fileReader.readAsText(e.target.files![0]);\r\n    }\r\n\r\n\r\n\r\n    return (\r\n        <div className=\"menu\">\r\n            <p>\r\n                <Button onClick={handleClickCheats}>Cheats!</Button>\r\n            </p>\r\n            <p>\r\n                <Button onClick={handleClickSettings}>Settings</Button>\r\n            </p>\r\n            <fieldset>\r\n                <legend>Save and load</legend>\r\n                <section>\r\n                    Save game to disk:&nbsp;\r\n                    <Button onClick={handleClickSave}>Save</Button>\r\n                </section>\r\n                <section>\r\n                    Load game from disk:&nbsp;\r\n                    <input type=\"file\" onChange={handleFileChange} />\r\n                    <Button onClick={handleClickLoad} disabled={!loadedStore}>Load</Button>\r\n                </section>\r\n            </fieldset>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default compose(\r\n    withWindow,\r\n    withAppContext,\r\n)(Menu) as React.ComponentType<AllProps>;\r\n","export const formatNumber = (input: number, digits: number = 1): string => {\n    const SI_SYMBOL = [\"\", \"k\", \"M\", \"G\", \"T\", \"P\", \"E\"];\n\n    // what tier? (determines SI symbol)\n    const tier = Math.log10(input) / 3 | 0;\n    // if zero, we don't need a suffix\n    if(tier === 0) return input.toFixed(digits);\n\n    // get suffix and determine scale\n    const suffix = SI_SYMBOL[tier];\n    const scale = Math.pow(10, tier * 3);\n\n    // scale the number\n    const scaled = input / scale;\n\n    // format number and add suffix\n    return scaled.toFixed(digits) + suffix;\n}","import { ContextInfo, ContextType } from 'constants/context';\nimport deepEquals from 'deep-equal';\nimport EventEmitter from './EventEmitter';\n\nexport interface Context {\n    type: ContextType;\n    info: ContextInfo;\n    referenceRect: ClientRect;\n}\n\nexport abstract class TooltipManager extends EventEmitter<Context>() {\n\n    static EVENT_CONTEXT_UPDATED = \"tooltipContextUpdated\";\n    private static lastContext: Context | undefined;\n\n    static showContextTooltip (type: ContextType, info: ContextInfo, originRect: ClientRect) {\n        const context = { type, info, referenceRect: originRect};\n\n        if(deepEquals(context, this.lastContext)) {\n            this.clear();\n        } else {\n            this.emit(this.EVENT_CONTEXT_UPDATED, context);\n            this.lastContext = context;\n        }\n    }\n\n    static clear() {\n        this.emit(this.EVENT_CONTEXT_UPDATED, undefined);\n        this.lastContext = undefined;\n    }\n}","import { StoreState } from 'stores';\nimport { useSelector } from 'react-redux';\n\n// Returns the gold from redux store\nconst useGoldState = () => {\n    return useSelector<StoreState, number>(store => store.gold);\n}\n\nexport default useGoldState;","export enum IconSize {\r\n    smallest,\r\n    small,\r\n    medium,\r\n    big,\r\n    biggest,\r\n}\r\n\r\nexport const getClassName = (size?: IconSize): string => {\r\n    switch (size) {\r\n        case IconSize.smallest:\r\n            return \"common-icon-smallest\";\r\n        case IconSize.small:\r\n            return \"common-icon-small\";\r\n        case IconSize.medium:\r\n            return \"common-icon-medium\";\r\n        case IconSize.big:\r\n            return \"common-icon-big\";\r\n        case IconSize.biggest:\r\n            return \"common-icon-biggest\";\r\n    }\r\n    return getClassName(IconSize.medium);\r\n};\r\n","import { StoreState } from 'stores';\nimport { useSelector } from 'react-redux';\nimport { ResourceStoreState } from 'stores/resources';\n\n// Returns the resources from redux store\nconst useResourcesState = () => {\n    return useSelector<StoreState, ResourceStoreState>(store => store.resources);\n}\n\nexport default useResourcesState;","import { createSelector } from \"reselect\";\nimport { StoreState } from \"stores\";\nimport { StructureStoreState } from \"stores/structure\";\nimport { StructuresStoreState } from \"stores/structures\";\n\nconst getStructures = (state: StoreState) => state.structures;\nconst getWorkers = (state: StoreState) => state.workers;\n\nconst calculateFreeWorkers = (structures: StructuresStoreState, workers: number) => {\n    // Add up all the workers used by all structures in town\n    const workersUsed = Object.keys(structures).map((name) => structures[name])\n        .reduce((acc: number, value: StructureStoreState) => acc += value.workers, 0);\n\n    return workers - workersUsed;\n};\n\nexport const selectFreeWorkers = createSelector([\n    getStructures,\n    getWorkers],\n    calculateFreeWorkers,\n);\n","import { StoreState } from 'stores';\nimport { useSelector } from 'react-redux';\nimport { selectFreeWorkers } from 'selectors/workers';\n\n// Returns all the workers from redux store\nexport const useWorkersState = () => {\n    return useSelector<StoreState, number>(store => store.workers);\n}\n\n// Returns all the workers not working on something from redux store\nexport const useWorkersFreeState = () => {\n    return useSelector<StoreState, number>(selectFreeWorkers);\n}\n\n","import { resourceOrder } from \"constants/resources\";\nimport resourceDescriptions from \"definitions/resources\";\nimport * as React from \"react\";\nimport { ResourceStoreState } from \"stores/resources\";\nimport { formatNumber } from 'utils/format/number';\nimport { TooltipManager } from 'global/TooltipManager';\nimport { ContextType } from 'constants/context';\nimport useGoldState from 'hooks/store/useGoldState';\nimport useResourcesState from 'hooks/store/useResourcesState';\nimport { useWorkersFreeState } from 'hooks/store/useWorkersState';\nimport \"./styles/resourcebar.scss\";\nimport \"components/ui/styles/icon.scss\";\nimport { getClassName, IconSize } from 'constants/icons';\n\nexport interface StateProps  {\n    gold: number;\n    workers: number;    // total\n    workersFree: number;\n    resources: ResourceStoreState;\n}\n\n/** Shown on top in the UI */\nconst Resourcebar = () => {\n\n    const goldState = useGoldState();\n    const storeResources = useResourcesState();\n    const workersFree = useWorkersFreeState();\n\n    const createItem = (icon: string, amount: number, type: string) => {\n\n        const handleClick = (event: React.MouseEvent) => {\n\n            const origin = (event.currentTarget as HTMLElement);\n            const originRect = origin.getBoundingClientRect();\n            TooltipManager.showContextTooltip(ContextType.resource, type, originRect);\n            event.stopPropagation();\n        };\n\n        return (\n            <li key={type} onClick={handleClick}>\n                <div\n                    className={`icon ${getClassName(IconSize.smallest)}`}\n                    style={{ backgroundImage: `url(${process.env.PUBLIC_URL}${icon})` }}\n                />\n                <div className=\"amount\">\n                    { formatNumber(amount, 0) }\n                </div>\n            </li>\n        )\n    };\n\n    const resources = resourceOrder.map((resource) => {\n        const resourceDescription = resourceDescriptions[resource];\n        return createItem(resourceDescription.iconImg, storeResources[resource as string], resource);\n    });\n\n    resources.push(\n        createItem(\"/img/resources/worker.png\", workersFree, \"workers\"),\n        createItem(\"/img/resources/gold.png\", goldState, \"gold\"),\n    );\n\n    return (\n        <ul className=\"resourcebar\">\n            { resources }\n        </ul>\n    );\n};\nexport default Resourcebar;\n","import Menu from \"components/ui/window/windows/MenuWindow\";\nimport * as React from \"react\";\nimport Resourcebar from './Resourcebar';\nimport { useContext } from 'react';\nimport { AppContext } from 'components/App';\nimport { Persistor } from 'redux-persist';\nimport \"./styles/topbar.scss\";\n\ninterface Props {\n    persistor: Persistor;\n}\n\nconst Topbar = (props: Props) => {\n    const context = useContext(AppContext)!;\n\n    const handleClick = (e: React.MouseEvent<HTMLDivElement, MouseEvent>) => {\n        const window = <Menu title = \"Menu\" persistor={props.persistor} />;\n        context.onOpenWindow(window);\n    };\n\n    return (\n        <div className = \"topbar\">\n            <div className = \"topbar-left\">\n                <Resourcebar />\n            </div>\n            <div className = \"topbar-right\">\n                <div className = \"hamburger\" onClick = { handleClick }>☰</div>\n            </div>\n        </div>\n    );\n}\nexport default Topbar;","import React, { useRef, useEffect } from 'react';\nimport { Sprite } from '@inlet/react-pixi';\nimport { QuestStoreState } from 'stores/quest';\nimport * as PIXI from 'pixi.js';\nimport { AdventurerStoreState } from 'stores/adventurer';\nwindow.PIXI = PIXI;\n\ninterface Props {\n    quest: QuestStoreState;\n    position: PIXI.Point;\n    selected?: boolean;\n    encounterActive?: boolean;\n    onClick?: (quest: QuestStoreState) => void;\n    leader: AdventurerStoreState;\n}\nconst CIRCLE_DIAMETER = 256; // = avatar size / 2\n\nconst QuestMarker = (props: Props) => {\n    const { quest, leader, encounterActive, position, onClick, selected } = props;\n    const image = selected ? '/img/world/map-marker-selected.png' : '/img/world/map-marker.png';\n\n    const avatar = useRef<PIXI.Sprite>(null);\n    // Mask has to be a child of the avatar in order to move with it\n    useEffect(() => {\n        const sprite = avatar.current as any as PIXI.Sprite;\n\n        const maskGraphics = new PIXI.Graphics();\n        maskGraphics.beginFill(0xBADA55);\n        maskGraphics.drawCircle(0, 0, CIRCLE_DIAMETER * 1);\n        maskGraphics.endFill();\n\n        sprite.mask = maskGraphics;\n        sprite.addChild(maskGraphics);\n    }, [avatar]);\n\n    return (\n        <Sprite\n            image={`${process.env.PUBLIC_URL}${image}`}\n            name={quest.name}\n            x={position.x}\n            y={position.y}\n            interactive={true}\n            buttonMode={true}\n            scale={new PIXI.Point(0.1, 0.1)}\n            anchor={new PIXI.Point(0.5, 1)}\n            pointerdown={() => {\n                if(onClick) {\n                    onClick(quest);\n                }\n            }}\n        >\n            { leader && (\n            <Sprite\n                image={`${process.env.PUBLIC_URL}/${leader.avatarImg}`}\n                name=\"avatar\"\n                anchor={new PIXI.Point(0.5, 0.5)}\n                x={0}\n                y={-396}\n                scale={new PIXI.Point(0.66, 0.66)}\n                ref={avatar}\n            />)}\n            {encounterActive && (\n            <Sprite\n                image={`${process.env.PUBLIC_URL}/img/world/quest-alert.png`}\n                name=\"quest-alert\"\n                anchor={new PIXI.Point(0.5, 1)}\n                x={180}\n                y={-396}\n                scale={new PIXI.Point(2, 2)}\n            />\n            )}\n        </Sprite>\n    )\n}\n\nexport default QuestMarker;","import { Item } from \"definitions/items/types\";\nimport { SceneStoreState } from './scene';\n\nexport enum QuestStatus {\n    unavailable,\n    available,  // on the quest board\n    active,\n    completed,\n    // todo: failed?\n}\n\nexport interface QuestReward {\n    gold?: number;\n    items?: Item[];\n}\n\nexport interface QuestStoreState {\n    name: string;\n    status: QuestStatus;\n    party: string[];                // list of adventurer ids\n    progress: number;               // Which questnode the party is at currently\n    questVars: any;                 // \n    encounterResults: string[];   // Store what option the place chose during an encounter // OBSOLETE\n    icon: string;\n\n    reward?: QuestReward;\n    scene?: SceneStoreState;\n    sceneName?: string;\n}\n","import React from \"react\";\nimport { Graphics } from '@inlet/react-pixi';\n\ninterface Props {\n    positions: PIXI.Point[];\n}\n\nconst QuestLine = (props: Props) => {\n    const { positions } = props;\n    if (props.positions.length > 2) {\n        return <Graphics\n            name=\"questline\"\n            x={0}\n            y={0}\n            draw={graphics => {\n                graphics.lineStyle(3, 0xFF3300);\n                graphics.moveTo(positions[0].x, positions[0].y);\n\n                let i = 0;\n                for (i = 1; i < positions.length - 2; i ++)\n                {\n                    const xc = (positions[i].x + positions[i + 1].x) / 2;\n                    const yc = (positions[i].y + positions[i + 1].y) / 2;\n                    graphics.quadraticCurveTo(positions[i].x, positions[i].y, xc, yc);\n                }\n                graphics.quadraticCurveTo(positions[i].x, positions[i].y, positions[i+1].x, positions[i+1].y);\n                graphics.endFill();\n            }}\n        />;\n    }\n    return null;\n}\n\nexport default QuestLine;","import { TextEntry } from \"constants/text\";\nimport { createSelector } from \"reselect\";\nimport { StoreState } from \"stores\";\nimport { LogChannel, LogEntry } from \"stores/logEntry\";\nimport { QuestStatus, QuestStoreState } from \"stores/quest\";\n\nconst getQuests = (state: StoreState) => state.quests;\nconst getLog = (state: StoreState) => state.log;\n\nconst activeQuests = (quests: QuestStoreState[]) => {\n    // returns the names of the active quests\n    return quests.filter((q) => q.status === QuestStatus.active).map((q) => q);\n};\n\nexport const selectActiveQuests = createSelector([\n    getQuests],\n    activeQuests,\n);\n\n// /**\n//  * Returns the most recent log entry for a given quest\n//  */\n// export const selectLastQuestLogEntry = (state: StoreState, questName: string) => createSelector([\n//     getLog],\n//     (log: LogEntry[]): TextEntry | undefined => {\n//         const questLog = log.find((l) => l.channel === LogChannel.quest && l.channelContext === questName);\n//         return questLog;\n//     },\n// )(state);\n\n// /**\n//  * Returns all log entries for given quest\n//  */\n// export const selectQuestLogEntries = (state: StoreState, questName: string) => createSelector([\n//     getLog],\n//     (log: LogEntry[]): TextEntry[] | undefined => {\n//         return log.filter((l) => l.channel === LogChannel.quest && l.channelContext === questName);\n//     },\n// )(state);\n","import * as PIXI from 'pixi.js';\r\nimport { Stage, Sprite } from '@inlet/react-pixi';\r\nimport { Viewport as PixiViewport } from \"pixi-viewport\";\r\nimport { useSelector } from 'react-redux'\r\n\r\nimport React, { useEffect, useRef, useCallback, useState } from \"react\";\r\nimport { QuestStoreState } from \"stores/quest\";\r\nimport { lerpLocation } from 'utils/pixiJs';\r\nimport { QuestDefinition, QuestNodeType, QuestNode } from \"definitions/quests/types\";\r\nimport Viewport from '../../pixi/Viewport';\r\nimport MapGrid from './MapGrid';\r\nimport QuestMarker from './QuestMarker';\r\nimport { StoreState } from 'stores';\r\nimport { getQuestLeader } from 'storeHelpers';\r\nimport { AdventurerStoreState } from 'stores/adventurer';\r\nimport QuestLine from './QuestLine';\r\nimport { MAX_WIDTH as WIDTH } from 'components/App';\r\nimport { selectActiveQuests } from 'selectors/quests';\r\nimport { getDefinition } from 'definitions/quests';\r\nimport './styles/worldMap.scss';\r\nimport { TextManager } from 'global/TextManager';\r\n\r\nwindow.PIXI = PIXI; // workaround for pixi-tilemap\r\nconst FULL_HEIGHT = 1024;\r\nconst SMALL_HEIGHT = 64;   // Used when QuestPanel is open\r\nconst WORLD_WIDTH = 1500;\r\nconst WORLD_HEIGHT = 1061;\r\nconst GRID_WIDTH = 10;      // width or height of each node location in pixels\r\n\r\n// // This stuff is needed for the pixi-js browser plugin\r\nif (process.env.NODE_ENV === \"development\") {\r\n    // @ts-ignore\r\n    // tslint:disable-next-line: no-unused-expression\r\n    window.__PIXI_INSPECTOR_GLOBAL_HOOK__ && window.__PIXI_INSPECTOR_GLOBAL_HOOK__.register({ PIXI });\r\n}\r\n\r\nexport interface Props {\r\n    selectedQuestName?: string;\r\n    smallMap: boolean;\r\n    onPartyClick: (questName: string) => void;\r\n    retrieveWorldViewRef: () => React.RefObject<HTMLDivElement>;\r\n}\r\n\r\nconst WorldMap = (props: Props) => {\r\n    const { retrieveWorldViewRef, smallMap } = props;\r\n    const questSelector = useCallback(\r\n        (state: StoreState) => state.quests.find((q) => q.name === props.selectedQuestName),\r\n        [props.selectedQuestName]\r\n    );\r\n    const selectedQuest = useSelector<StoreState, QuestStoreState | undefined>(questSelector);\r\n    const adventurers = useSelector<StoreState, AdventurerStoreState[]>((store) => store.adventurers);\r\n    const activeQuests = useSelector<StoreState, QuestStoreState[]>((store) => selectActiveQuests(store));\r\n\r\n    const handlePartyClick = (name: string) => {\r\n        props.onPartyClick(name);\r\n    };\r\n\r\n    // useEffect(() => {\r\n    //     const onScroll = (e: WheelEvent) => {\r\n    //         // When the map is big, scrolling the mouse is just used for zoom, not for actual scrolling\r\n    //         if (!smallMap) {\r\n    //             e.preventDefault();\r\n    //         }\r\n    //     }\r\n    //     window.addEventListener(\"wheel\", onScroll, {passive: false} );\r\n    //     return () => {\r\n    //         window.removeEventListener(\"wheel\", onScroll);\r\n    //     };\r\n    // }, [smallMap]);\r\n\r\n\r\n    const [canvasWidth, setCanvasWidth] = useState(WIDTH);\r\n    const [canvasHeight, setCanvasHeight] = useState(FULL_HEIGHT);\r\n\r\n    useEffect(() => {\r\n        // This will set the dimensions of the canvas tot that of the parent (worldview)\r\n        const resize = () => {\r\n            const worldView = retrieveWorldViewRef();\r\n            const worldViewWidth = worldView.current?.clientWidth || WIDTH;\r\n            const worldViewHeight = worldView.current?.clientHeight || FULL_HEIGHT;\r\n\r\n            setCanvasWidth(worldViewWidth);\r\n            if (smallMap) {\r\n                if (worldViewWidth < 576) {\r\n                    // Small screens\r\n                    setCanvasHeight(SMALL_HEIGHT / 2);\r\n                } else {\r\n                    setCanvasHeight(SMALL_HEIGHT);\r\n                }\r\n            }\r\n            else {\r\n                setCanvasHeight(worldViewHeight);\r\n            }\r\n        }\r\n        resize();\r\n        window.addEventListener(\"resize\", resize);\r\n        return () => {\r\n            window.removeEventListener(\"resize\", resize);\r\n        };\r\n    }, [retrieveWorldViewRef, smallMap]);\r\n\r\n    useEffect(() => {\r\n        if (selectedQuest) {\r\n            focusOnQuestingParty(selectedQuest);\r\n        }\r\n    }, [selectedQuest, canvasHeight])\r\n\r\n    const viewportRef = useRef<PixiViewport>(null);\r\n    useEffect(() => {\r\n        // focus on center of the map\r\n        if (viewportRef.current) {\r\n            const viewport = viewportRef.current;\r\n            const point = nodeLocationToPoint({ x: 0, y: 0 });\r\n            viewport.moveCenter(point.x / 2, point.y / 2 + 10);\r\n        }\r\n    }, [canvasWidth]);\r\n\r\n    const renderQuestlines = () => {\r\n        return activeQuests.map((quest) => {\r\n            const previousPositions = getPreviousPositions(quest);\r\n            return (\r\n                <QuestLine positions={previousPositions} key={quest.name} />\r\n            );\r\n        });\r\n    };\r\n\r\n    const renderMarkers = () => {\r\n        return activeQuests.map((quest) => {\r\n            const location = getQuestWorldLocation(quest);\r\n            const currentPosition = nodeLocationToPoint(location);\r\n            const leader = getQuestLeader(adventurers, quest)!;\r\n            const questDefinition: QuestDefinition = getDefinition(quest.name);\r\n            const progress: number = Math.floor(quest.progress);\r\n            const questNode: QuestNode = questDefinition.nodes[progress];\r\n\r\n            return (\r\n                <QuestMarker\r\n                    quest={quest}\r\n                    leader={leader}\r\n                    position={currentPosition}\r\n                    key={quest.name}\r\n                    selected={quest === selectedQuest}\r\n                    encounterActive={questNode.type === QuestNodeType.encounter}\r\n                    onClick={(q) => handlePartyClick(q.name)}\r\n                />\r\n            );\r\n        });\r\n    };\r\n\r\n\r\n    // puts the given party in the center of the map\r\n    const focusOnQuestingParty = (quest: QuestStoreState) => {\r\n        const viewport = viewportRef.current;\r\n        if (viewport) {\r\n            const partyLocation = getQuestWorldLocation(quest);\r\n            const point = nodeLocationToPoint(partyLocation);\r\n            viewport.moveCenter(point.x, point.y);\r\n        }\r\n    }\r\n\r\n    const handleMapClick = () => {\r\n        /// todo: close map\r\n        // if(smallMap === true && selectedQuest) {\r\n        //     props.onPartyClick(selectedQuest.name);\r\n        // }\r\n    }\r\n\r\n    const options = {\r\n        autoDensity: true,\r\n        sharedLoader: true,\r\n        width: canvasWidth,\r\n        height: canvasHeight,\r\n    }\r\n    return (\r\n        <div className=\"world-map\">\r\n            <Stage width={canvasWidth} height={canvasHeight} options={options}>\r\n                <Viewport screenWidth={canvasWidth} screenHeight={canvasHeight} worldWidth={WORLD_WIDTH} worldHeight={WORLD_HEIGHT} ref={viewportRef} >\r\n                    <Sprite\r\n                        image={`${process.env.PUBLIC_URL}/img/world/francesca-baerald-fbaerald-angeloumap-lowres.jpg`}\r\n                        interactive={true}\r\n                        pointerdown={handleMapClick}\r\n                    >\r\n                        {renderQuestlines()}\r\n                        {renderMarkers()}\r\n                    </Sprite>\r\n                    {/* <MapGrid width={WORLD_WIDTH} height={WORLD_HEIGHT} gridWidth={GRID_WIDTH} /> */}\r\n                </Viewport>\r\n            </Stage>\r\n            {props.selectedQuestName && (\r\n                <div className=\"title\">\r\n                    <span>\r\n                        {TextManager.getQuestTitle(props.selectedQuestName)}\r\n                    </span>\r\n                    <span onClick={() => handlePartyClick(props.selectedQuestName!)}>x</span>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\n\r\nexport default WorldMap;\r\n\r\nconst getQuestWorldLocation = (quest: QuestStoreState): { x: number; y: number; } => {\r\n    const questDefinition = getDefinition(quest.name);\r\n    const roundedProgress = Math.floor(quest.progress);\r\n    const lastNode = questDefinition.nodes[roundedProgress];\r\n\r\n    const nextNode = questDefinition.nodes[roundedProgress + 1];\r\n    if (!nextNode) {\r\n        // We've reached the last node\r\n        return lastNode;\r\n    }\r\n    return lerpLocation(lastNode, nextNode, quest.progress - roundedProgress);\r\n};\r\n\r\n// Node locations work on a centered coordinate system\r\nconst nodeLocationToPoint = (location: { x: number; y: number; }) => {\r\n    const x = location.x * GRID_WIDTH + WORLD_WIDTH / 2;\r\n    const y = location.y * GRID_WIDTH + WORLD_HEIGHT / 2;\r\n    return new PIXI.Point(x, y);\r\n}\r\n\r\nconst getPreviousPositions = (quest: QuestStoreState) => {\r\n    const positions: PIXI.Point[] = [];\r\n    const questDefinition = getDefinition(quest.name);\r\n\r\n    for (let i = 0; i < quest.progress; i++) {\r\n        positions.push(nodeLocationToPoint(questDefinition.nodes[i]))\r\n    }\r\n    const lastPosition = nodeLocationToPoint(getQuestWorldLocation(quest));\r\n    positions.push(lastPosition);\r\n    return positions;\r\n}","import React from \"react\";\nimport \"./css/tabstrip.css\";\nimport { Props as TabProps } from \"./Tab\";\nimport { SoundManager, Sound } from 'global/SoundManager';\n\nexport interface Props {\n    className?: string;\n    onClick?: React.MouseEventHandler<Element>;\n    onTabSelected?: (tabId: string) => void;\n    children?: any;\n    activeTab?: string;\n    disabled?: boolean;\n}\n\ntype AllProps = Props;\nconst Tabstrip = (props: AllProps) => {\n    let {activeTab = null} = props;\n    if (!activeTab && props.children && props.children.length) {\n        activeTab = props.children[0].props.id;\n    }\n    const className = `${props.className} ${(props.disabled ? \"disabled\" : \"\")}`;\n    const children = React.Children.map(props.children, (child: React.ReactElement<TabProps>) => {\n        const clone: React.ReactElement<TabProps> = React.cloneElement(child, {\n            active: child.props.id === activeTab,\n            onClick: () => { handleTabClick(child.props.id); }\n        });\n        return clone;\n    });\n\n    const handleTabClick = (tabId: string) => {\n        if (props.onTabSelected && props.disabled !== true) {\n            props.onTabSelected(tabId);\n        }\n    };\n\n    const handleClick = (e: React.MouseEvent<Element>) => {\n        SoundManager.playSound(Sound.buttonClick);\n        if (props.onClick) {\n            props.onClick(e);\n        }\n    };\n\n    return (\n        <ul className={`tabstrip ${className}`} onClick={handleClick}>\n            {children}\n        </ul>\n    );\n};\n\nexport default Tabstrip;\n","import * as React from \"react\";\nimport \"./css/tabstrip.css\";\n\nexport interface Props {\n    id: string;\n    className?: string;\n    onClick?: React.MouseEventHandler<Element>;\n    active?: boolean;\n    children?: any;\n}\n\ntype AllProps = Props;\n\nconst Tab = (props: AllProps) => {\n    const handleClick = (e: React.MouseEvent<HTMLLIElement>) => {\n        if (props.onClick) {\n            props.onClick(e);\n        }\n    };\n    const className = ((props.active) ? \"active\" : \"\") + (props.className || \"\");\n    return (\n        <li className={`tabstrip-tab ${className}`} onClick={handleClick}>\n            {props.children}\n        </li>\n    );\n};\n\nexport default Tab;\n","import * as React from \"react\";\nimport { AdventurerStoreState } from \"stores/adventurer\";\nimport { getClassName, IconSize } from 'constants/icons';\nimport \"./styles/adventureravatar.scss\";\n\nexport interface Props {\n    adventurer: AdventurerStoreState;\n    className?: string;\n    displayName?: boolean;\n    onClick?: (adventurerId: string) => void;\n    size?: IconSize;\n}\n\n/**\n * The AdventurerAvatar displays the avatar of an adventurer\n */\nconst AdventurerAvatar = (props: Props) => {\n    const {\n        adventurer,\n        size\n    } = props;\n\n    const className = (props.className || \"\") +\n        (size !== undefined ? getClassName(size) : \"\") +\n        \" avatar\";\n\n    const handleClick = () => {\n        if (props.onClick) {\n            props.onClick(props.adventurer.id);\n        }\n    };\n    return (\n        <div className = { className }\n            style={{ backgroundImage: `url(${process.env.PUBLIC_URL}/${adventurer.avatarImg})` }}\n            onClick={ () => handleClick() }>\n            <div className=\"sizer\"/>\n            {\n                props.displayName && <div className=\"name\">\n                    { adventurer.name }\n                </div>\n            }\n        </div>\n    );\n};\n\nexport default AdventurerAvatar;\n","import React from \"react\";\nimport Tabstrip from 'components/ui/tabs/Tabstrip';\nimport { AdventurerStoreState } from 'stores/adventurer';\nimport Tab from 'components/ui/tabs/Tab';\nimport AdventurerAvatar from 'components/ui/adventurer/AdventurerAvatar';\nimport { getClassName, IconSize } from 'constants/icons';\n\ninterface Props {\n    adventurers: AdventurerStoreState[];\n    selectedAdventurerId?: string;\n    onAdventurerTabSelected: (adventurerId: string) => void;\n    disabled?: boolean;\n}\n\n// Shows adventurer portraits in a tabstrip\nconst AdventurerTabstrip = (props: Props) => {\n    const {adventurers, onAdventurerTabSelected} = props;\n\n    const handleAdventurerTabSelected = (adventurerId: string) => {\n        const adventurer = props.adventurers.find(a => a.id === adventurerId)!;\n        onAdventurerTabSelected(adventurer.id);\n    }\n\n    const renderAdventurerTab = (adventurer: AdventurerStoreState) => (\n        <Tab id={adventurer.id} key={adventurer.id}>\n            <AdventurerAvatar adventurer={adventurer} className={getClassName(IconSize.small)}/>\n        </Tab>\n    );\n    return (\n        <Tabstrip \n            className=\"adventurers-tabstrip\"\n            onTabSelected={handleAdventurerTabSelected}\n            activeTab={props.selectedAdventurerId}\n            disabled={props.disabled}\n        >\n            {adventurers.map((a) => renderAdventurerTab(a))}\n        </Tabstrip>\n    )\n}\n\nexport default AdventurerTabstrip;","import { createSelector } from \"reselect\";\nimport { StoreState } from \"stores\";\nimport { AdventurerStoreState } from \"stores/adventurer\";\nimport { QuestStatus, QuestStoreState } from \"stores/quest\";\nimport { adventurersOnQuest } from 'storeHelpers';\n\n// maybe this is not used anymore?\n\n// Store accessors\nconst getAdventurers = (state: StoreState): AdventurerStoreState[] => state.adventurers;\nconst getQuests = (state: StoreState): QuestStoreState[] => state.quests;\n\nconst groupAdventurersByQuest = (adventurers: AdventurerStoreState[], quests: QuestStoreState[]): Record<string, AdventurerStoreState[]> => {\n    const foundInParty: AdventurerStoreState[] = []; // store the adventurers in parties in a temp array\n\n\n    const groupedAdventurers = Object.values(quests).reduce((acc, val: QuestStoreState) => {\n        const foundAdventurers = adventurersOnQuest(adventurers, val);\n        if (val.status === QuestStatus.active) {\n            // Only active quests\n            acc[val.name] = foundAdventurers;\n        }\n        foundInParty.push(...foundAdventurers);\n        return acc;\n    }, {});\n\n    // Add a special group called 'solo' for those adventurers not in a party\n    const soloKey = \"solo\";\n    groupedAdventurers[soloKey] = adventurers.filter((a) => foundInParty.indexOf(a) === -1);\n\n    return groupedAdventurers;\n};\n\nconst getAdventurersInTown = (adventurers: AdventurerStoreState[], quests: QuestStoreState[]): AdventurerStoreState[] => {\n    // Get an array of all adventurer ids on any active quest\n    const adventurersOnQuest = quests.reduce<string[]>((acc, val: QuestStoreState) => {\n        if (val.status === QuestStatus.active) {\n            acc.push(...val.party);\n        }\n        return acc;\n    }, []);\n\n    return adventurers.filter((a) => adventurersOnQuest.indexOf(a.id) === -1);\n};\n\n/** Returns an object keyed by active quests whose value is a list of AdventurerStoreState */\nexport const selectAdventurersGroupedByQuest = createSelector([\n    getAdventurers,\n    getQuests],\n    groupAdventurersByQuest,\n);\n\n/** Returns a selector keyed by active quests whose value is a list of AdventurerStoreState */\nexport const createSelectAdventurersOnQuest = (questName: string) => {\n    const getAdventurersOnQuest = (adventurers: AdventurerStoreState[], quests: QuestStoreState[]): AdventurerStoreState[] => {\n        const quest = quests.find(q => q.name === questName)!;\n        return adventurersOnQuest(adventurers, quest);\n    };\n\n    return createSelector([\n        getAdventurers,\n        getQuests],\n        getAdventurersOnQuest,\n    );\n}\n\n/** Returns an object keyed by active quests whose value is a list of AdventurerStoreState */\nexport const selectAdventurersInTown = createSelector([\n    getAdventurers,\n    getQuests],\n    getAdventurersInTown,\n);\n","import { ContextType } from \"constants/context\";\nimport { getClassName, IconSize } from \"constants/icons\";\nimport { getIconClassName } from \"constants/items\";\nimport { getDefinition } from \"definitions/items\";\nimport { Item } from \"definitions/items/types\";\nimport * as React from \"react\";\nimport { TooltipManager } from 'global/TooltipManager';\nimport { TextManager } from 'global/TextManager';\nimport \"./styles/itemicon.scss\";\nimport \"components/ui/styles/icon.scss\";\nimport \"components/ui/styles/item.scss\";\n\nexport interface Props {\n    item: Item;\n    onClick?: (event: React.MouseEvent) => void;\n    size?: IconSize;\n    showContext?: boolean;\n}\n\nconst ItemIcon = (props: Props) => {\n    const {item} = props;\n    const itemDefinition = getDefinition(item);\n\n    if (!itemDefinition) {\n        // tslint:disable-next-line: no-console\n        console.warn(`could not find definition for ${item}`);\n    }     // todo: [10/07/2019] assert\n\n    const handleClick = (event: React.MouseEvent) => {\n        if (props.showContext !== false) {\n            const origin = (event.currentTarget as HTMLElement);\n            const originRect = origin.getBoundingClientRect();\n            TooltipManager.showContextTooltip(ContextType.item, getDefinition(item), originRect);\n            event.stopPropagation();\n        }\n\n        if (props.onClick) {\n            props.onClick(event);\n        }\n    };\n\n    const className = `item-icon ${getClassName(props.size)} ${getIconClassName(itemDefinition.rarity)} `;\n\n    return (\n        <div\n            className={className}\n            onClick={handleClick}\n        >\n            <img src={`${process.env.PUBLIC_URL}${itemDefinition.iconImg}`} alt={TextManager.getItemName(props.item)} />\n        </div>\n    );\n};\n\nexport default ItemIcon;\n","import { DragSourceType, DragType } from \"constants/dragging\";\r\nimport { IconSize } from \"constants/icons\";\r\nimport { Item } from \"definitions/items/types\";\r\nimport * as React from \"react\";\r\nimport { ConnectDragSource, DragSource, DragSourceConnector, DragSourceMonitor, DragSourceSpec } from \"react-dnd\";\r\nimport ItemIcon from \"./ItemIcon\";\r\n\r\nexport interface Props {\r\n    index: number;\r\n    item: Item;\r\n    sourceType: DragSourceType;\r\n    sourceId?: string;\r\n    size?: IconSize;\r\n    onClick?: (event: React.MouseEvent) => void;\r\n}\r\n\r\ninterface CollectedProps {\r\n    isDragging: boolean;\r\n    connectDragSource: ConnectDragSource;\r\n}\r\n\r\nexport interface InventoryItemDragInfo {\r\n    item: Item;\r\n    inventorySlot?: number;\r\n    sourceId?: string;\r\n    sourceType: DragSourceType;\r\n}\r\n\r\n/**\r\n * Specifies the drag source contract.\r\n * Only `beginDrag` function is required.\r\n */\r\nconst source: DragSourceSpec<Props, InventoryItemDragInfo> = {\r\n    beginDrag(props: Props) {\r\n        // Return the data describing the dragged item\r\n        return {\r\n            inventorySlot: props.index,\r\n            item: props.item,\r\n            sourceId: props.sourceId,\r\n            sourceType: props.sourceType,\r\n        };\r\n    },\r\n};\r\n\r\n/**\r\n * Specifies which props to inject into your component.\r\n */\r\nfunction collect(connect: DragSourceConnector, monitor: DragSourceMonitor) {\r\n    return {\r\n        connectDragSource: connect.dragSource(),\r\n        isDragging: monitor.isDragging(),\r\n    };\r\n}\r\n\r\nconst DraggableItemIcon = (props: Props & CollectedProps) => {\r\n\r\n    const { item, onClick, isDragging, connectDragSource, size } = props;\r\n    const handleClick = (event: React.MouseEvent) => {\r\n        if (onClick) {\r\n            onClick(event);\r\n        }\r\n    };\r\n    if (isDragging) {\r\n        // TODO: can show some sort of empty state?\r\n        return null;\r\n    }\r\n    return connectDragSource((\r\n        <div>\r\n            <ItemIcon\r\n                item={item}\r\n                onClick={handleClick}\r\n                size={size}\r\n            />\r\n        </div>\r\n    ));\r\n}\r\n\r\nexport default DragSource<Props, CollectedProps>(DragType.ITEM, source, collect)(DraggableItemIcon);\r\n","export interface TraitDefinition {\n    trait: Trait;\n    hasEffect?: boolean;\n}\n\nexport enum Trait {\n    arrowFinder = \"arrowFinder\",\n    gloomy = \"gloomy\",\n    houseHouston = \"houseHouston\",\n    houseMaddox = \"houseMaddox\",\n    houseMonroe = \"houseMonroe\",\n}\n\n","import { AdventurerStoreState } from 'stores/adventurer';\nimport { QuestStoreState, QuestStatus } from 'stores/quest';\nimport { StoreState } from 'stores';\nimport { useSelector } from 'react-redux';\nimport { useMemo, useCallback } from 'react';\nimport { EquipmentSlotType } from 'components/ui/EquipmentSlot';\nimport { Item } from 'definitions/items/types';\nimport { getDefinition } from 'definitions/items/apparel';\n\nconst getAdventurersInTown = (adventurers: AdventurerStoreState[], quests: QuestStoreState[]): AdventurerStoreState[] => {\n    // Get an array of all adventurer ids on any active quest\n    const adventurersOnQuest = quests.reduce<string[]>((acc, val: QuestStoreState) => {\n        if (val.status === QuestStatus.active) {\n            acc.push(...val.party);\n        }\n        return acc;\n    }, []);\n\n    return adventurers.filter((a) => adventurersOnQuest.indexOf(a.id) === -1);\n};\n\n/** Returns all the adventurers currently not on a mission */\nexport const useAdventurersInTown = () => {\n    const adventurers = useSelector<StoreState, AdventurerStoreState[]>(store => store.adventurers);\n    const quests = useSelector<StoreState, QuestStoreState[]>(store => store.quests);\n\n    const adventurersInTown = useMemo(() => {\n        return getAdventurersInTown(adventurers, quests)\n    }, [adventurers, quests]);\n\n    return adventurersInTown;\n}\n\n/** Returns the adventurer from store */\nexport const useAdventurerState = (adventurerId: string) => {\n    const adventurerSelector = useCallback(\n        (state: StoreState) => state.adventurers.find((q) => q.id === adventurerId)!,\n        [adventurerId]\n    );\n    return useSelector<StoreState, AdventurerStoreState>(adventurerSelector);\n}\n\n/* Returns a map keyed by EquipmentSlotType with DR of an adventurer.\n   0 if nothing worn or if item does not have DR */\nexport const useAdventurerDamageReduction = (adventurerId: string): { [key: string]: number } => {\n    const adventurer = useAdventurerState(adventurerId);\n    const findDR = (type: EquipmentSlotType) => {\n        const item: Item = adventurer.equipment[EquipmentSlotType[type]];\n        if (!item) return 0;\n        return getDefinition(item).damageReduction || 0;\n    }\n    return {\n        [EquipmentSlotType[EquipmentSlotType.head]]: findDR(EquipmentSlotType.head),\n        [EquipmentSlotType[EquipmentSlotType.chest]]: findDR(EquipmentSlotType.chest),\n        [EquipmentSlotType[EquipmentSlotType.hands]]: findDR(EquipmentSlotType.hands),\n        [EquipmentSlotType[EquipmentSlotType.shoulders]]: findDR(EquipmentSlotType.shoulders),\n        [EquipmentSlotType[EquipmentSlotType.legs]]: findDR(EquipmentSlotType.legs),\n        [EquipmentSlotType[EquipmentSlotType.feet]]: findDR(EquipmentSlotType.feet),\n    }\n}\n\n\n\n","import React from \"react\";\nimport './styles/guy.scss';\nimport { EquipmentSlotType } from 'components/ui/EquipmentSlot';\nimport { useAdventurerDamageReduction } from 'hooks/store/adventurers';\n\n\nexport interface Props {\n    adventurerId: string\n}\n\n// A silhouette of a person with the Damage Reduction numbers\nconst Guy = (props: Props) => {\n    const {adventurerId} = props;\n\n    const damageReduction = useAdventurerDamageReduction(adventurerId);\n    const renderDamageReduction = (equipmentType: EquipmentSlotType) => {\n        const dR = damageReduction[EquipmentSlotType[equipmentType]];\n        if (!dR) {\n            return null;\n        }\n        return (\n            <div className={EquipmentSlotType[equipmentType]} key={equipmentType}>\n                {dR}\n            </div>\n        )\n    }\n\n    return (\n        <li className=\"guy\">\n            {(renderDamageReduction(EquipmentSlotType.head))}\n            {(renderDamageReduction(EquipmentSlotType.chest))}\n            {(renderDamageReduction(EquipmentSlotType.hands))}\n            {(renderDamageReduction(EquipmentSlotType.shoulders))}\n            {(renderDamageReduction(EquipmentSlotType.legs))}\n            {(renderDamageReduction(EquipmentSlotType.feet))}\n        </li>\n    )\n}\n\nexport default Guy;","import React from \"react\";\nimport { AdventurerStoreState } from 'stores/adventurer';\nimport EquipmentSlot, { EquipmentSlotType } from 'components/ui/EquipmentSlot';\nimport { Item } from 'definitions/items/types';\nimport DraggableItemIcon, { InventoryItemDragInfo } from 'components/ui/DraggableItemIcon';\nimport { DragSourceType } from 'constants/dragging';\nimport { IconSize } from 'constants/icons';\nimport { TextManager } from 'global/TextManager';\nimport Guy from './Guy';\nimport './styles/adventurerEquipment.scss';\n\nexport interface Props {\n    adventurer: AdventurerStoreState\n    onDropItemEquipment: (dragInfo: InventoryItemDragInfo, slotType: EquipmentSlotType) => void;\n}\n\n// Shows the gear an adventurer is wearing\nconst AdventurerEquipment = (props: Props) => {\n    const { adventurer, onDropItemEquipment } = props;\n\n    const getEquipmentSlot = (slotType: EquipmentSlotType) => {\n        // returns EquipmentSlot\n        const item: Item | undefined = adventurer.equipment[EquipmentSlotType[slotType]];\n\n        return (\n            <li className={EquipmentSlotType[slotType]}>\n                <EquipmentSlot\n                    onDrop={(dragInfo: InventoryItemDragInfo) => onDropItemEquipment(dragInfo, slotType)}\n                    type={slotType}\n                >\n                    {item && (\n                        <DraggableItemIcon\n                            index={slotType}\n                            sourceId={adventurer.id}\n                            sourceType={DragSourceType.adventurerEquipment}\n                            item={item}\n                            size={IconSize.medium}\n                        />\n                    )}\n                </EquipmentSlot>\n                <span className=\"info\">{TextManager.getEquipmentSlot(slotType)}</span>\n            </li>\n        );\n    };\n    return (\n        <ul className=\"adventurer-equipment\">\n            {getEquipmentSlot(EquipmentSlotType.head)}\n            {getEquipmentSlot(EquipmentSlotType.chest)}\n            {getEquipmentSlot(EquipmentSlotType.hands)}\n            {getEquipmentSlot(EquipmentSlotType.shoulders)}\n            {getEquipmentSlot(EquipmentSlotType.legs)}\n            {getEquipmentSlot(EquipmentSlotType.feet)}\n            {getEquipmentSlot(EquipmentSlotType.mainHand)}\n            {getEquipmentSlot(EquipmentSlotType.offHand)}\n            <Guy adventurerId={adventurer.id} />\n        </ul>\n    )\n}\n\nexport default AdventurerEquipment;","import { DragSourceType, DragType } from \"constants/dragging\";\r\nimport { IconSize } from \"constants/icons\";\r\nimport { Item } from \"definitions/items/types\";\r\nimport * as React from \"react\";\r\nimport { ConnectDropTarget, DropTarget, DropTargetConnector, DropTargetMonitor, DropTargetSpec } from \"react-dnd\";\r\nimport { InventoryItemDragInfo } from \"../DraggableItemIcon\";\r\nimport { itemAndEquipmentSlotMatch } from \"../EquipmentSlot\";\r\nimport { PropsWithChildren } from 'react';\r\n\r\nconst dropTarget: DropTargetSpec<Props> = {\r\n    drop(props: Props, monitor: DropTargetMonitor) {\r\n        props.onDrop(monitor.getItem());\r\n    },\r\n    canDrop(props: Props, monitor: DropTargetMonitor) {\r\n        const dragInfo: InventoryItemDragInfo = monitor.getItem();\r\n        if (dragInfo.sourceType === DragSourceType.adventurerEquipment) {\r\n            return props.item == null || itemAndEquipmentSlotMatch(props.item, dragInfo.inventorySlot!);\r\n        }\r\n        return true;\r\n    },\r\n};\r\n\r\nexport interface Props {\r\n    item: Item | null;\r\n    onDrop: (item: any) => void;\r\n    size?: IconSize;\r\n}\r\n\r\nexport interface DropSourceProps {\r\n    canDrop: boolean;\r\n    isOver: boolean;\r\n    connectDropTarget: ConnectDropTarget;\r\n}\r\n\r\nconst collect = (connect: DropTargetConnector, monitor: DropTargetMonitor) => ({\r\n    canDrop: monitor.canDrop(),\r\n    connectDropTarget: connect.dropTarget(),\r\n    isOver: monitor.isOver(),\r\n});\r\n\r\n/**\r\n * The InventorySlot displays a slot in which an item can be placed.\r\n */\r\nconst InventorySlot = (props: PropsWithChildren<Props> & DropSourceProps) => {\r\n    const {\r\n        isOver,\r\n        canDrop,\r\n        connectDropTarget,\r\n    } = props;\r\n    const isActive = isOver && canDrop;\r\n\r\n    const classNames = [\r\n        \"inventory-item\",\r\n    ];\r\n\r\n    if (isActive) {\r\n        classNames.push(\"drop-active\");\r\n    } else if (canDrop) {\r\n        classNames.push(\"drop-possible\");\r\n    }\r\n\r\n    return connectDropTarget(\r\n        <div className={classNames.join(\" \")}>\r\n            { props.children }\r\n        </div>,\r\n    );\r\n}\r\n\r\nexport default DropTarget<Props, DropSourceProps>(\r\n    DragType.ITEM,\r\n    dropTarget,\r\n    collect,\r\n)(InventorySlot);\r\n","import DraggableItemIcon, {InventoryItemDragInfo} from \"components/ui/DraggableItemIcon\";\nimport { DragSourceType } from \"constants/dragging\";\nimport { IconSize } from \"constants/icons\";\nimport {Item} from \"definitions/items/types\";\nimport * as React from \"react\";\nimport InventorySlot from \"./InventorySlot\";\nimport \"./styles/inventory.scss\";\n\nexport interface Props {\n    items: (Item|null)[];\n    sourceId?: string;   // who does this inventory belong to?\n    sourceType: DragSourceType;\n    iconSize?: IconSize;\n    onDropItem: (item: Item, fromSlot: number, toSlot: number, sourceType: DragSourceType, sourceId?: string) => void;\n    className?: string;\n}\n\n/**\n * Inventory is used to show Items. They can be dragged about\n * @param props\n */\nconst Inventory = (props: Props) => {\n    const slots = [];\n    for (let i = 0; i < props.items.length; i++) {\n        let contents;\n        const item = props.items[i];\n        const handleDrop = (dragInfo: InventoryItemDragInfo) => {\n            if (dragInfo.inventorySlot === i && dragInfo.sourceType === props.sourceType && dragInfo.sourceId === props.sourceId) {\n                // TODO: Swap items?!\n                return;\n            }\n            if (props.onDropItem) {\n                const {inventorySlot: fromSlot} = dragInfo;\n                props.onDropItem(dragInfo.item, fromSlot!, i, dragInfo.sourceType, dragInfo.sourceId);\n           }\n        };\n\n        if (item) {\n            contents = (\n                <DraggableItemIcon\n                    index={i}\n                    sourceId={props.sourceId}\n                    sourceType={props.sourceType}\n                    item={item}\n                />\n            );\n       }\n\n        const slot = (\n            <InventorySlot\n                key={`inventory-slot-${i}`}\n                item={item}\n                size={props.iconSize}\n                onDrop={handleDrop}\n            >\n                {contents}\n            </InventorySlot>\n        );\n        slots.push(slot);\n   }\n    return (\n        <div className={`inventory ${props.className}`}>\n            {slots}\n        </div>\n    );\n};\nexport default Inventory;\n","import { StoreState } from 'stores';\nimport { useSelector } from 'react-redux';\nimport { Item } from 'definitions/items/types';\n\n// Returns the gold from redux store\nconst useStockpileState = () => {\n    return useSelector<StoreState, (Item|null)[]>(store => store.stockpile);\n}\n\nexport default useStockpileState;","import React, { createContext, PropsWithChildren, useState, useMemo, useEffect } from 'react';\nimport { SceneControllerManager } from 'global/SceneControllerManager';\nimport { BaseSceneController } from 'mechanics/scenes/BaseSceneController';\nimport { useStore } from 'react-redux';\nimport { StoreState } from 'stores';\n\nexport const SceneControllerContext = createContext<BaseSceneController<any> | null>(null);\n\nexport interface Props {\n    questName: string;\n}\n\nconst SceneControllerContextProvider = (props: PropsWithChildren<Props>) => {\n    const {questName, children} = props;\n    const store = useStore<StoreState>();\n    const [loaded, setLoaded] = useState<boolean>(false);\n    const storeState = store.getState();\n    const quest = storeState.quests.find(q => q.name === questName)!;\n    const {scene, sceneName} = quest;\n\n    const controller = useMemo(() => {\n        if (!sceneName) {\n            return null;\n        }\n        return SceneControllerManager.getSceneController(questName, sceneName, store);\n    }, [questName, sceneName, store]);\n\n    useEffect(() => {\n        if (sceneName && controller) {\n            setLoaded(false);\n            const loadingComplete = () => {\n                setLoaded(true);\n\n                // If the store has no scene for this quest yet, create and store it!\n                if (!scene && controller) {\n                    controller.createScene();\n                    controller.sceneEntered();\n                }\n            }\n            controller.loadData(loadingComplete);\n        }\n    }, [controller, questName, scene, sceneName]);\n\n    if (controller && !(controller.dataLoaded || loaded)) {\n        return (\n            <div>loading...</div>\n        );\n    }\n    return (\n        <SceneControllerContext.Provider value={controller}>\n            {children}\n        </SceneControllerContext.Provider>\n    );\n};\n\nexport default SceneControllerContextProvider;","import { useDispatch } from 'react-redux';\nimport { Action } from \"redux\";\nimport { removeItemFromInventory, assignEquipment, addItemToInventory, removeEquipment, moveItemInInventory } from 'actions/adventurers';\nimport { removeItemFromWarehouse, addItemToWarehouse, moveItemInWarehouse } from 'actions/items';\nimport { EquipmentSlotType } from 'components/ui/EquipmentSlot';\nimport { Item } from 'definitions/items/types';\nimport { InventoryItemDragInfo } from 'components/ui/DraggableItemIcon';\nimport { DragSourceType } from 'constants/dragging';\nimport { AdventurerStoreState } from 'stores/adventurer';\nimport useStockpileState from 'hooks/store/useStockpileState';\nimport { SceneControllerContext } from 'components/world/QuestPanel/context/SceneControllerContext';\nimport { useContext } from 'react';\n\nconst useItemDropActions = () => {\n    const dispatch = useDispatch();\n    const sceneController = useContext(SceneControllerContext);  // is only available when in a scene\n    const stockpile = useStockpileState();\n\n    // When an item gets dropped on equipment slot\n    const dropItemEquipment = (dragInfo: InventoryItemDragInfo, slotType: EquipmentSlotType, adventurer: AdventurerStoreState) => {\n        const item = dragInfo.item;\n        const actions: Action[] = [];\n\n        switch (dragInfo.sourceType) {\n            // Dragged from inventory\n            case DragSourceType.adventurerInventory: {\n                actions.push(\n                    // Item gets removed from inventory\n                    removeItemFromInventory(adventurer.id, dragInfo.inventorySlot!),\n                    // Item gets assigned to an equipment slot\n                    assignEquipment(adventurer.id, slotType, item),\n                );\n\n                const existingEquipment = adventurer.equipment[EquipmentSlotType[slotType]];\n                if (existingEquipment) {\n                    // There is already an item in this slot. Place in inventory\n                    actions.push(addItemToInventory(adventurer.id, existingEquipment, dragInfo.inventorySlot!));\n                }\n                break;\n            }\n            // Dragged from warehouse.\n            case DragSourceType.warehouse: {\n                actions.push(\n                    removeItemFromWarehouse(dragInfo.inventorySlot!),\n                    assignEquipment(adventurer.id, slotType, item),\n                );\n\n                const existingEquipment = adventurer.equipment[EquipmentSlotType[slotType]];\n                if (existingEquipment) {\n                    // There is already an item in this slot. Place in warehouse\n                    actions.push(addItemToWarehouse(existingEquipment, dragInfo.inventorySlot!));\n                }\n                break;\n            }\n\n            // Dragged from equipment slot (only applicable to weapons)\n            case DragSourceType.adventurerEquipment: {\n                actions.push(\n                    assignEquipment(adventurer.id, slotType, item)\n                );\n\n                const existingEquipment = adventurer.equipment[EquipmentSlotType[slotType]];\n                const fromSlot = dragInfo.inventorySlot!;\n                if (existingEquipment) {\n                    // Another weapon was there, switch them\n                    actions.push(assignEquipment(adventurer.id, fromSlot, existingEquipment),)\n                } else {\n                    // Clear the slot where it came from\n                    actions.push(removeEquipment(adventurer.id, fromSlot));\n                }\n                break;\n            }\n        }\n        actions.forEach(a => dispatch(a));\n    };\n\n    // When an item gets dropped on an adventurer inventory\n    const dropItemInventory = (item: Item, fromSlot: number, toSlot: number, sourceType: DragSourceType, adventurer: AdventurerStoreState, sourceId?: string): void => {\n        const actions: Action[] = [];\n        switch (sourceType) {\n            // Drag from one inventory slot to another\n            case DragSourceType.adventurerInventory:\n                actions.push(moveItemInInventory(adventurer.id, fromSlot, toSlot))\n                break;\n\n            // Dragged from warehouse\n            case DragSourceType.warehouse: {\n                actions.push(\n                    removeItemFromWarehouse(fromSlot),\n                    addItemToInventory(adventurer.id, item, toSlot),\n                )\n                const otherItem = adventurer.inventory[toSlot];\n                if (otherItem) {\n                    actions.push(\n                        addItemToWarehouse(otherItem, fromSlot)\n                    )\n                }\n                break;\n            }\n\n            // Drag from equipment slot\n            case DragSourceType.adventurerEquipment: {\n                actions.push(\n                    addItemToInventory(adventurer.id, item, toSlot)\n                );\n\n                const existingEquipment = adventurer.inventory[toSlot];\n                if (existingEquipment) {\n                    // Was dropped on another piece of equipment in inventory, switch them\n                    actions.push(assignEquipment(adventurer.id, fromSlot, existingEquipment));\n                } else {\n                    // Clear the slot where it came from\n                    actions.push(removeEquipment(adventurer.id, fromSlot));\n                }\n                break;\n            }\n\n            // Dragged from lootCache on a scene\n            case DragSourceType.lootCache: {\n                if (sceneController && sourceId) {\n                    // Let the scene controller handle this action\n                    sceneController.takeItemFromCache(fromSlot, sourceId, adventurer, toSlot);\n                }\n            }\n        }\n        actions.forEach(a => dispatch(a));\n    };\n\n    // When an item gets dropped on the warehouse inventory\n    const dropItemWarehouse = (item: Item, fromSlot: number, toSlot: number, sourceType: DragSourceType, sourceId?: string): void => {\n        const actions: Action[] = [];\n\n        switch (sourceType) {\n            // Dragged from the warehouse itself\n            case DragSourceType.warehouse: {\n                actions.push(\n                    moveItemInWarehouse(fromSlot, toSlot)\n                )\n                const otherItem = stockpile[toSlot];\n                if (otherItem) {\n                    actions.push(\n                        addItemToInventory(sourceId!, otherItem, fromSlot)\n                    )\n                }\n                break;\n            }\n            // Dragged from an adventurer inventory\n            case DragSourceType.adventurerInventory: {\n                actions.push(\n                    removeItemFromInventory(sourceId!, fromSlot),\n                    addItemToWarehouse(item, toSlot)\n                )\n                const otherItem = stockpile[toSlot];\n                if (otherItem) {\n                    actions.push(\n                        addItemToInventory(sourceId!, otherItem, fromSlot)\n                    )\n                }\n                break;\n            }\n        }\n        actions.forEach(a => dispatch(a));\n    };\n    return {\n        dropItemEquipment,\n        dropItemInventory,\n        dropItemWarehouse\n    }\n}\n\nexport default useItemDropActions;","import { TraitDefinition, Trait } from './types';\n\nconst all = {\n    [Trait.arrowFinder]: {\n        trait: Trait.arrowFinder,\n        hasEffect: true\n    },\n    [Trait.gloomy]: {\n        trait: Trait.gloomy,\n        hasEffect: true\n    },\n    [Trait.houseHouston]: {\n        trait: Trait.houseHouston,\n    },\n    [Trait.houseMaddox]: {\n        trait: Trait.houseMaddox,\n    },\n    [Trait.houseMonroe]: {\n        trait: Trait.houseMonroe,\n    }\n};\n\nexport function getDefinition(trait: Trait): TraitDefinition {\n    return all[trait];\n}","import React, { Fragment } from \"react\";\nimport { useAdventurerState } from 'hooks/store/adventurers';\nimport { Trait } from 'definitions/traits/types';\nimport './styles/adventurerTraits.scss';\nimport { getDefinition } from 'definitions/traits';\nimport { TextManager } from 'global/TextManager';\nimport { ContextType } from 'constants/context';\nimport { TooltipManager } from 'global/TooltipManager';\n\ninterface Props {\n    adventurerId: string;\n}\n\nconst AdventurerTraits = (props: Props) => {\n    const adventurer = useAdventurerState(props.adventurerId);\n\n    const renderTrait = (trait: Trait, last: boolean) => {\n        const traitDefinition = getDefinition(trait);\n        const handleClick = (event: React.MouseEvent) => {\n            const origin = (event.currentTarget as HTMLElement);\n            const originRect = origin.getBoundingClientRect();\n            TooltipManager.showContextTooltip(ContextType.trait, traitDefinition, originRect);\n            event.stopPropagation();\n        };\n        return (\n            <Fragment key={trait}>\n                <li onClick={handleClick}>\n                    {TextManager.getTraitName(trait)}\n                </li>\n                {!last && (', ')}\n            </Fragment>\n        )\n    };\n\n    if (!adventurer?.traits) {\n        return null;\n    }\n    return (\n        <>\n            <p>{TextManager.get(\"ui-adventurer-info-traits-title\")}</p>\n            <ul className=\"adventurer-traits\">\n                {adventurer.traits.map((t, i)=> renderTrait(t, i === adventurer.traits!.length -1))}\n            </ul>\n        </>\n    )\n}\n\nexport default AdventurerTraits;","import React, { Fragment } from \"react\";\nimport { useAdventurerState } from 'hooks/store/adventurers';\nimport { TextManager } from 'global/TextManager';\nimport { ContextType } from 'constants/context';\nimport { TooltipManager } from 'global/TooltipManager';\nimport { WeaponType } from 'definitions/items/weapons';\nimport './styles/adventurerSkills.scss';\n\ninterface Props {\n    adventurerId: string;\n}\n\nconst AdventurerSkills = (props: Props) => {\n    const adventurer = useAdventurerState(props.adventurerId);\n\n    const renderSkill = (skill: WeaponType) => {\n        // const traitDefinition = getDefinition(trait);\n        const handleClick = (event: React.MouseEvent) => {\n            const origin = (event.currentTarget as HTMLElement);\n            const originRect = origin.getBoundingClientRect();\n            TooltipManager.showContextTooltip(ContextType.skill, skill, originRect);\n            event.stopPropagation();\n        };\n        return (\n            <Fragment key={skill}>\n                <li onClick={handleClick}>\n                    <span className=\"skill\" onClick={handleClick}>\n                        {TextManager.getSkillName(skill)}\n                    </span>\n                    <span>\n                        {adventurer.skills[skill]}\n                    </span>\n                    {/* {TextManager.getTraitName(trait)} */}\n                </li>\n            </Fragment>\n        )\n    };\n\n    if (!adventurer?.skills) {\n        return null;\n    }\n    return (\n        <>\n            <p>{TextManager.get(\"ui-adventurer-info-skills-title\")}</p>\n            <ul className=\"adventurer-skills\">\n                {Object.keys(adventurer.skills)?.map((s, i) => {\n                    const skill: WeaponType = WeaponType[s];\n                    return renderSkill(skill);\n                })}\n            </ul>\n        </>\n    )\n}\n\nexport default AdventurerSkills;","const CONSTANT = 0.5;\n\nexport function xpToLevel(xp: number) {\n    return Math.floor(CONSTANT * Math.sqrt(xp));\n}\n\nexport function levelToXp(level: number) {\n    return Math.pow(level / CONSTANT, 2);\n}","import * as React from \"react\";\nimport \"./styles/progressbar.scss\";\n\nexport interface Props {\n    progress?: number;     // between 0 and 1\n    label?: string;\n}\n\nconst Progressbar = (props: Props) => {\n    const progress: number = clamp(props.progress || 0, 0, 1);\n\n    return (\n        <div className=\"progressbar\">\n            <div className=\"progressbar-label\">{props.label}</div>\n            <div className=\"progressbar-bar\" style= {{width: `${progress * 100}%`}}/>\n        </div>\n    );\n};\n\nexport default Progressbar;\n\nfunction clamp(val: number, min: number, max: number): number {\n    return val > max ? max : val < min ? min : val;\n}\n","import * as React from \"react\";\nimport { levelToXp, xpToLevel } from 'mechanics/adventurers/levels';\nimport Progressbar from 'components/ui/Progressbar';\nimport { TextManager } from 'global/TextManager';\n\nexport interface Props {\n    xp: number;\n}\n\n\nconst Level = (props: Props) => {\n    const { xp } = props;\n    const currentLevel = xpToLevel(xp);\n    const currentLevelXp = levelToXp(currentLevel); // start\n    const nextLevel = currentLevel + 1;\n    const nextLevelXp = levelToXp(nextLevel);\n\n\n    return (\n        <div className=\"level\">\n            Level {currentLevel}\n            <Progressbar\n                progress={(xp - currentLevelXp) / (nextLevelXp - currentLevelXp)}\n                label={TextManager.get(\n                    \"ui-adventurer-info-xp-progress\", {\n                    xp: Math.floor(xp - currentLevelXp),\n                    next: nextLevelXp - currentLevelXp\n                    }\n                )}\n            />\n        </div>\n    )\n}\nexport default Level;\n\n","import { useCallback } from 'react';\nimport { StoreState } from 'stores';\nimport { useSelector } from 'react-redux';\nimport { QuestStoreState } from 'stores/quest';\n\n// Returns the quest from redux store\nconst useQuest = (questName: string) => {\n    const questSelector = useCallback(\n        (state: StoreState) => state.quests.find((q) => q.name === questName)!,\n        [questName]\n    );\n    const quest = useSelector<StoreState, QuestStoreState>(questSelector);\n    return quest;\n}\n\nexport default useQuest;","import React, { useContext, useMemo } from \"react\";\nimport { AdventurerStoreState } from 'stores/adventurer';\nimport { DragSourceType } from 'constants/dragging';\nimport AdventurerEquipment from './AdventurerEquipment';\nimport Inventory from 'components/ui/inventory/Inventory';\nimport useItemDropActions from 'hooks/actions/useItemActions';\nimport { InventoryItemDragInfo } from 'components/ui/DraggableItemIcon';\nimport { EquipmentSlotType } from 'components/ui/EquipmentSlot';\nimport { Item } from 'definitions/items/types';\nimport AdventurerTraits from './AdventurerTraits';\nimport AdventurerSkills from './AdventurerSkills';\nimport Level from 'components/ui/adventurer/AdventurerInfo/Level';\nimport useQuest from 'hooks/store/useQuest';\nimport { SceneControllerContext } from './context/SceneControllerContext';\nimport \"./styles/adventurerPanel.scss\";\nimport { TextManager } from 'global/TextManager';\n\nexport interface Props {\n    adventurer: AdventurerStoreState;\n    questName?: string;\n}\n\n/** Vertical panel showing adventurer info\n * todo: move outside of /world\n */\nconst AdventurerPanel = (props: Props) => {\n    const { adventurer, questName } = props;\n    // const renderAttributes = () => Object.keys(adventurer.stats).map((stat) => {\n    //     const value: number = adventurer.stats[stat];\n    //     return <div key={`${adventurer.id}-${stat}`} > <b>{stat}</b>: {value.toFixed(1)} </div>;\n    // });\n\n    const {\n        dropItemEquipment,\n        dropItemInventory\n    } = useItemDropActions();\n\n    const handleDropItemEquipment = (dragInfo: InventoryItemDragInfo, slotType: EquipmentSlotType) => {\n        dropItemEquipment(dragInfo, slotType, adventurer);\n    };\n    const handleDropItemInventory = (item: Item, fromSlot: number, toSlot: number, sourceType: DragSourceType, sourceId?: string) => {\n        dropItemInventory(item, fromSlot, toSlot, sourceType, adventurer, sourceId);\n    }\n\n    return (\n        <div className=\"adventurer-panel\">\n            <div className=\"info\">\n                <div className=\"name\">\n                    {adventurer.name}\n                    {questName && <ApIndicator questName={questName} adventurer={adventurer} />}\n                </div>\n                <Level xp={adventurer.xp} />\n\n                <AdventurerTraits adventurerId={adventurer.id}/>\n                <AdventurerSkills adventurerId={adventurer.id}/>\n                {/* <div className=\"renderAttributes\">\n                    {renderAttributes()}\n                </div> */}\n            </div>\n            <div className=\"equipment\">\n                <AdventurerEquipment\n                    adventurer={adventurer}\n                    onDropItemEquipment={handleDropItemEquipment}\n                />\n            </div>\n            <div className=\"right\">\n                <Inventory\n                    sourceType={DragSourceType.adventurerInventory}\n                    sourceId={adventurer.id}\n                    items={adventurer.inventory}\n                    className=\"inventory-small\"\n                    onDropItem={handleDropItemInventory}\n                />\n            </div>\n        </div>\n    )\n}\n\nexport default AdventurerPanel;\n\n\n\n\n/** Vertical panel showing adventurer info\n * todo: move outside of /world\n */\nconst ApIndicator = (props: Props) => {\n    const quest = useQuest(props.questName!);\n    const controller = useContext(SceneControllerContext)!;\n\n    const ap = useMemo(() => {\n        return controller.getRemainingAdventurerAp(props.adventurer.id)\n    }, [controller, props.adventurer.id]);\n\n    if (!quest?.scene?.combat) {\n        return null;\n    }\n    return (\n        <span>{TextManager.get(\"ui-adventurer-info-ap-remaining\", { ap })}</span>\n    );\n}","import { PixiComponent } from \"@inlet/react-pixi\";\nimport * as PIXI  from 'pixi.js';\nimport { TiledLayerData, TiledTilesetData } from 'constants/tiledMapData';\n\nwindow.PIXI = PIXI;\n// eslint-disable-next-line import/first\nimport 'pixi-tilemap';\n\ninterface Props  {\n    // texture: PIXI.Texture;\n    horizontalTiles: number;\n    layer: TiledLayerData;\n    tilesets: TiledTilesetData[];\n    spritesheets: {[key: string]: PIXI.Spritesheet}\n}\n\nconst RectTileLayer = PixiComponent<Props, any>(\"RectTileLayer\", {\n    create(props: Props) {\n        // @ts-ignore\n        const tileLayer = new window.PIXI.tilemap.CompositeRectTileLayer();\n        return tileLayer;\n    },\n\n    applyProps(instance, oldProps: Props, props: Props) {\n        const {layer, tilesets, horizontalTiles, spritesheets} = props;\n        if (!layer.data) {\n            return;\n        }\n        for (let i = 0; i < layer.data.length; i++) {\n            const tileset = findTileset(layer.data[i], tilesets);\n            if (!tileset) continue;\n\n            const w = tileset.tilewidth;\n            const h = tileset.tileheight;\n            const x = (i % horizontalTiles) * w;\n            const y = Math.floor(i / horizontalTiles) * h;\n            const spritesheet = spritesheets[tileset.name];\n\n            if (layer.data[i] > 0) {\n                const spriteId = `${tileset.name}-${layer.data[i]}`;\n                instance.addFrame(spritesheet.textures[spriteId], x, y);\n            }\n        }\n    }\n});\n\nexport default RectTileLayer;\n\n\n// finds tileset based on gid\nconst findTileset = (gid: number, tilesets: TiledTilesetData[]) => {\n    let tileset;\n    for (let i = tilesets.length - 1; i >= 0; i--) {\n        tileset = tilesets[i];\n        if (tileset.firstgid <= gid) {\n            break;\n        }\n    }\n    return tileset;\n}\n","import { Item } from 'definitions/items/types';\n\n\nexport interface SceneStoreState {\n    objects: SceneObject[];\n    actors: ActorObject[];\n    actionQueue?: SceneAction[];\n    activeInteractionModal?: SceneInteractionModal;\n    combat: boolean;\n}\n\nexport interface SceneObject {\n    id: number;\n    name?: string;\n    type: string;\n    gid?: number;\n    location: [number, number];\n};\n\nexport type ActorObject = {\n    name: string;                   // todo: refactor to id\n    location: [number, number];     // current location in the scene\n    ap: number;                     // Remaining AP\n};\n\n // export type Actor = SceneObject & {\n//     type: \"actor\";\n//     //allegiance: Allegiance;\n//     health: number;\n//     //remainingAP: number;\n// }\n\nexport type SceneInteractionModal =\n| { type: 'lootCache', lootCache: string }\n| { type: 'situation', situation: string }\n\nexport interface LootCache {\n    title: string;\n    items: Item[];\n    gold?: number;\n}\n\nexport interface SceneAction {\n    actionType: SceneActionType;\n    actor: string;\n    target: [number, number];\n    endsAt: number;\n}\n\nexport enum SceneActionType {\n    move = \"move\"\n    // todo: interact?\n    // todo: attack?\n}\n","import React from 'react';\nimport { TiledMapData, TiledLayerData, TiledTilesetData, TiledLayerType } from 'constants/tiledMapData';\nimport { Container } from '@inlet/react-pixi';\nimport RectTileLayer from 'components/pixi/tile/RectTileLayer';\nimport * as PIXI from 'pixi.js';\n\ninterface Props {\n    basePath: string;\n    data: TiledMapData;\n    spritesheets: {[key: string]: PIXI.Spritesheet}\n}\n\nconst Tilemap = (props: Props) => {\n    const {data, spritesheets} = props;\n\n    return (\n        <Container >\n            {data.layers\n                .filter(l => l.visible && l.type === TiledLayerType.tilelayer)\n                .map(layer => createTileLayer(layer, data.width, data.tilesets, spritesheets))\n            }\n\n        </Container>\n    );\n}\n\nexport default Tilemap;\n\nconst createTileLayer = (layer: TiledLayerData, horizontalTiles: number, tilesets: TiledTilesetData[], spritesheets: {[key: string]: PIXI.Spritesheet}) => {\n    return (\n        <RectTileLayer\n            key={layer.name}\n            layer={layer}\n            horizontalTiles={horizontalTiles}\n            tilesets={tilesets}\n            spritesheets={spritesheets}\n        />\n    );\n}\n","import React from \"react\";\nimport { ReactReduxContext, Provider } from 'react-redux';\nimport { Stage } from '@inlet/react-pixi';\n\n// Contexts are not passed through the reconcilers with the new Context API.\n// This means we lose the redux context\n// Create a wrapper component that consumes the context and provides it again in the new reconciler context:\n// https://github.com/inlet/react-pixi/issues/77\nconst BridgedStage = (props: React.ComponentProps<typeof Stage>) => {\n    const { children, ...restProps } = props;\n    return (\n        <ReactReduxContext.Consumer>\n            {({ store }) => (\n                <Stage {...restProps}>\n                    <Provider store={store}>\n                        {children}\n                    </Provider>\n                </Stage>\n            )}\n        </ReactReduxContext.Consumer>\n    );\n}\n\nexport default BridgedStage;\n","import React, { useMemo,  useEffect, useRef, useCallback, PropsWithChildren, useState, memo } from 'react';\nimport { Container } from '@inlet/react-pixi';\nimport { MultiColorReplaceFilter } from 'pixi-filters';\nimport { SceneActionType, SceneAction } from 'stores/scene';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { completeSceneAction } from 'actions/quests';\nimport { StoreState } from 'stores';\nimport { gsap } from 'gsap';\nimport { BaseSceneController } from 'mechanics/scenes/BaseSceneController';\nimport SpriteAnimated from './SpriteAnimated';\n\nexport interface Props  {\n    name: string;\n    controller: BaseSceneController<any>;\n    location?: [number, number]; // tile coordinate space\n    idleAnimation?: boolean;\n};\n\nenum Orientation {\n    north = \"n\",\n    northEast = \"ne\",\n    east = \"e\",\n    southEast = \"se\",\n    south = \"s\",\n    southWest = \"sw\",\n    west = \"w\",\n    northWest = \"nw\"\n}\n\n// This is a wrapper that exposes a location property. Will set x and y on children\nconst SceneActor = (props: PropsWithChildren<Props> & React.ComponentProps<typeof Container>) => {\n    const {\n        location = [0, 0],\n        // spritesheet,\n        controller,\n        idleAnimation,\n        children,\n        ...rest\n    } = props;\n    const tileWidth = controller.mapData?.tilewidth!;\n    const tileHeight = controller.mapData?.tileheight!;\n\n    const actorRef = useRef<PIXI.Container>(null);\n    const previousAction = useRef<SceneAction>();\n    const dispatch = useDispatch();\n\n    const actionQueueSelector = useCallback(\n        (state: StoreState) => {\n            const quest = state.quests.find((q) => q.name === props.controller.questName)!;\n            if (!quest.scene!.actionQueue) {\n                return [];\n            }\n            return quest.scene!.actionQueue.filter(a => a.actor === props.name);\n        },\n        [props.name, props.controller.questName]\n    );\n    const actionQueue = useSelector<StoreState, SceneAction[]>(actionQueueSelector);\n    const [animation, setAnimation] = useState(\"stand\");\n\n    const spritesheetPath = useMemo(() => {\n        return controller.getActorSpritesheetPath(props.name);\n    }, [controller, props.name]);\n\n    // Handle actions\n    useEffect(() => {\n        if (!actorRef) {\n            return;\n        }\n        const nextAction = actionQueue[0];\n        if (nextAction) {\n            // console.log(`next action is ${nextAction.target}, \\ncurrent location is: ${location.current}\\nprev action was ${previousAction?.current?.target} `)\n            switch (nextAction.actionType) {\n                case SceneActionType.move: {\n                    const moveComplete = () => {\n                        dispatch(completeSceneAction(props.controller.questName));\n                        props.controller.actorMoved(props.name, nextAction.target);\n                    }\n                    const duration = (nextAction.endsAt - performance.now()) / 1000;\n                    if (duration < 0) {\n                        moveComplete();\n                    }\n\n                    // determine orientation\n                    if (location[0] === nextAction.target[0] && location[1] > nextAction.target[1]) {\n                        setOrientation(Orientation.north);\n                    }\n                    else if (location[0] < nextAction.target[0] && location[1] > nextAction.target[1]) {\n                        setOrientation(Orientation.northEast);\n                    }\n                    else if (location[0] < nextAction.target[0] && location[1] === nextAction.target[1]) {\n                        setOrientation(Orientation.east);\n                    }\n                    else if (location[0] < nextAction.target[0] && location[1] < nextAction.target[1]) {\n                        setOrientation(Orientation.southEast);\n                    }\n                    else if (location[0] === nextAction.target[0] && location[1] < nextAction.target[1]) {\n                        setOrientation(Orientation.south);\n                    }\n                    else if (location[0] > nextAction.target[0] && location[1] < nextAction.target[1]) {\n                        setOrientation(Orientation.southWest);\n                    }\n                    else if (location[0] > nextAction.target[0] && location[1] === nextAction.target[1]) {\n                        setOrientation(Orientation.west);\n                    }\n                    else if (location[0] > nextAction.target[0] && location[1] > nextAction.target[1]) {\n                        setOrientation(Orientation.northWest);\n                    }\n                    setAnimation(\"walk\");\n                    gsap.killTweensOf(actorRef.current);\n                    gsap.to(actorRef.current, {\n                        duration,\n                        ease: \"linear\",\n                        pixi: {\n                            x: nextAction.target[0] * tileWidth,\n                            y: nextAction.target[1] * tileHeight\n                        },\n                        onComplete: moveComplete\n                    });\n                    break;\n                }\n            }\n            previousAction.current = nextAction;\n        }\n\n    }, [dispatch, tileWidth, tileHeight, actionQueue, props.controller, props.name, location]);\n\n    const {x, y} = useMemo(() => {\n        setAnimation(\"stand\")\n\n        return {\n            x: location[0] * tileWidth,\n            y: location[1] * tileHeight,\n        };\n    }, [location, tileWidth, tileHeight]);\n\n    const [frames, setFrames] = useState<{ [key: string]: PIXI.Texture[]}|null>(null);\n\n    useEffect(() => {\n        if (!spritesheetPath) return;\n\n        const allFrames = Object.keys(PIXI.Loader.shared.resources[spritesheetPath].textures!);\n        const indexed = allFrames.reduce((acc: any, frame: string) => {\n            // frames are in the format of: 'stand-n', 'walk0-ne', 'walk1-ne' etc\n            // create a mapping with arrays keyed by the part without the number,\n            // eg: 'stand-n': [TEXTURE:stand-n] and 'walk-ne': [TEXTURE:walk0-ne, TEXTURE:walk1-ne]\n            const key = frame.replace(/[0-9]/g, '');\n            if (!acc[key]) {\n              acc[key] = [];\n            }\n            acc[key].push(PIXI.Loader.shared.resources[spritesheetPath].textures![frame]);\n            return acc;\n        }, {});\n        setFrames(indexed);\n    }, [spritesheetPath])\n\n    const [orientation, setOrientation] = useState<Orientation>(Orientation.north);\n    // const [flipped, setFlipped] = useState(false);\n    const flipped = useRef(false);\n    const setFlipped = (value:boolean) => {\n        flipped.current = value;\n    }\n\n    useEffect(() => {\n        setFlipped(orientation === Orientation.southWest || orientation === Orientation.west || orientation === Orientation.northWest)\n    }, [orientation]);\n\n    useEffect(() => {\n        if (!idleAnimation) return;\n\n        // Idle animation\n        // Randomly turn left or right\n        const randomOrientation = () => {\n            const left = Math.random() < .5;\n            if (orientation === Orientation.north && left) {\n                setOrientation(Orientation.northWest);\n            }\n            else if (orientation === Orientation.northWest && left) {\n                setOrientation(Orientation.west);\n            }\n            else if (orientation === Orientation.west && left) {\n                setOrientation(Orientation.southWest);\n            }\n            else if (orientation === Orientation.southWest && left) {\n                setOrientation(Orientation.south);\n            }\n            else if (orientation === Orientation.south && left) {\n                setOrientation(Orientation.southEast);\n            }\n            else if (orientation === Orientation.southEast && left) {\n                setOrientation(Orientation.east);\n            }\n            else if (orientation === Orientation.east && left) {\n                setOrientation(Orientation.northEast);\n            }\n            else if (orientation === Orientation.northEast && left) {\n                setOrientation(Orientation.north);\n            }\n            if (orientation === Orientation.north && !left) {\n                setOrientation(Orientation.northEast);\n            }\n            else if (orientation === Orientation.northEast && !left) {\n                setOrientation(Orientation.east);\n            }\n            else if (orientation === Orientation.east && !left) {\n                setOrientation(Orientation.southEast);\n            }\n            else if (orientation === Orientation.southEast && !left) {\n                setOrientation(Orientation.south);\n            }\n            else if (orientation === Orientation.south && !left) {\n                setOrientation(Orientation.southWest);\n            }\n            else if (orientation === Orientation.southWest && !left) {\n                setOrientation(Orientation.west);\n            }\n            else if (orientation === Orientation.west && !left) {\n                setOrientation(Orientation.northWest);\n            }\n            else if (orientation === Orientation.northWest && !left) {\n                setOrientation(Orientation.north);\n            }\n        }\n        const minDuration = 2000;\n        const maxDuration = 4000;\n        const duration = minDuration + Math.random() * maxDuration;\n        const interval = setInterval(randomOrientation, duration);\n        return () => clearInterval(interval);\n    }, [animation, orientation])\n\n    const getFrames = useCallback(() => {\n        const prefix = ''; \n        //const prefix = `${spritesheet.data.meta.image}-`;\n        switch (orientation) {\n            case Orientation.northWest:\n                return `${prefix}${animation}-${Orientation.northEast}`;\n            case Orientation.west:\n                return `${prefix}${animation}-${Orientation.east}`;\n            case Orientation.southWest:\n                return `${prefix}${animation}-${Orientation.southEast}`;\n            default:\n                return `${prefix}${animation}-${orientation}`;\n        }\n    }, [animation, orientation]);\n\n    // console.log(props.name, spritesheet, frames)\n    return (\n        <Container x={x} y={y} ref={actorRef} {...rest}>\n            { spritesheetPath && frames && (\n                <SpriteAnimated\n                    animationSpeed={0.1}\n                    name=\"footman\"\n                    isPlaying={true}\n                    textures={frames[getFrames()]}\n                    x={50}\n                    y={30}\n                    scale={[(flipped.current ? -1 : 1), 1]}\n                    anchor={[.5, .5]}\n                    pivot={[0, 0]}\n                    // filters={[new ColorReplaceFilter(0x002487, 0x875c00, 0.35)]}\n                    filters={[\n                        createColorReplaceFilter(BLUES, PURPLE)\n                    ]}\n                />\n            )}\n            {children}\n        </Container>\n    )\n};\n\nexport default memo(SceneActor);\n\nconst createColorReplaceFilter = (from: number[], to: number[]) => {\n    const replacements = from.map((val, index) => {\n        return [\n            from[index], to[index]\n        ]\n    });\n    return new MultiColorReplaceFilter(replacements, 0.15);\n}\n\nconst BLUES = [\n    0x000e5f,\n    0x00227f,\n    0x0038a5,\n    0x0055cc,\n];\n\nconst REDS = [\n    0x570800,\n    0x700c00,\n    0x901000,\n    0xb51700\n];\n\nconst TEALS = [\n    0x00330d,\n    0x00653a,\n    0x08936f,\n    0x30bea5\n];\n\nconst PURPLE = [\n    0x3b0d3a,\n    0x641d5e,\n    0x884696,\n    0xaa61bd\n];\n\nconst ORANGE = [\n    0x802d0c,\n    0xaa4a12,\n    0xd16d11,\n    0xf59717\n];\n\nconst BLACK = [\n    0x0d0d1a,\n    0x1a1b2b,\n    0x25263a,\n    0x35354c\n];\n\nconst WHITE = [\n    0x30375e,\n    0x676993,\n    0xa9aac2,\n    0xe6e6e6\n];\n\nconst YELLOW = [\n    0xc28600,\n    0xd6ae10,\n    0xe9d333,\n    0xfdf959\n];","import { PixiComponent, applyDefaultProps, AnimatedSprite } from '@inlet/react-pixi';\nimport * as PIXI from 'pixi.js';\nimport { memo } from 'react';\n\nconst SpriteAnimated = PixiComponent<React.ComponentProps<typeof AnimatedSprite>, PIXI.AnimatedSprite>('SpriteAnimated', {\ncreate: ({ textures }) => {\n    const animatedSprite = new PIXI.AnimatedSprite(textures || [], true);\n    return animatedSprite;\n  },\n  applyProps: (instance, oldProps, newProps) => {\n    if(oldProps.textures !== newProps.textures){\n      applyDefaultProps(instance, oldProps, newProps);\n      instance.gotoAndPlay(0);\n    }\n  },\n});\n\nexport default memo(SpriteAnimated);\n\n","import React, { useRef, forwardRef, useImperativeHandle } from \"react\";\nimport { Graphics } from '@inlet/react-pixi';\n\n// tslint:disable-next-line: no-empty-interface\ninterface Props {\n\n}\n\nexport interface RefActions {\n    drawAction: (from: PIXI.Point, to: PIXI.Point, allowed?: boolean) => void;\n    clear: () => void;\n    parent: PIXI.Container;\n}\n/**\n * ActionPath shows a line previewing the action the user is taking on a scene\n * @param props\n */\nconst ActionPath = forwardRef((props: Props, ref: React.Ref<RefActions>) => {\n    const graphicsRef = useRef<PIXI.Graphics>(null);\n\n    useImperativeHandle(ref, () => {\n        // console.log(graphicsRef.current.parent)\n        return {\n            drawAction: (from: PIXI.Point, to: PIXI.Point, allowed: boolean = true)=> {\n                const grfx = graphicsRef.current;\n                if (!grfx) return;\n                const color = allowed ? 0x00FF00 : 0xFF3300;\n                grfx.clear()\n                    .lineStyle(3, color)\n                    .moveTo(from.x, from.y)\n                    .lineTo(to.x, to.y);\n            },\n            clear: () => {\n                const grfx = graphicsRef.current;\n                grfx?.clear();\n            },\n            parent: graphicsRef.current?.parent!\n        }\n    });\n\n    return (\n        <Graphics\n            name=\"ActionPath\"\n            ref={graphicsRef}\n        />\n    )\n});\n\nexport default ActionPath;\n\n","import React, { useRef, forwardRef, useImperativeHandle } from \"react\";\nimport { Text } from '@inlet/react-pixi';\n\n// tslint:disable-next-line: no-empty-interface\ninterface Props {\n    tileWidth: number;\n    tileHeight: number;\n}\n\nexport interface RefActionPoints {\n    drawAp: (location: [number, number], ap: number) => void;\n    clear: () => void;\n    parent: PIXI.Container;\n}\n/**\n * @param props\n */\nconst ActionPoints = forwardRef((props: Props, ref: React.Ref<RefActionPoints>) => {\n    const textRef = useRef<PIXI.Text>(null);\n    const { tileWidth, tileHeight } = props;\n\n    useImperativeHandle(ref, () => {\n        return {\n            drawAp: (location: [number, number], ap: number)=> {\n                if(textRef.current) {\n                    textRef.current.x = tileWidth * location[0] + tileWidth / 2;\n                    textRef.current.y = tileHeight * location[1] + tileHeight / 2;\n                    textRef.current.text = `${ap}`;\n                    textRef.current.visible = true;\n\n                }\n            },\n            clear: () => {\n                if(textRef.current) {\n                    textRef.current.visible = false;\n                }\n            },\n            parent: textRef.current?.parent!\n        }\n    });\n\n    return (\n        <Text\n            name=\"ActionPoints\"\n            ref={textRef}\n            anchor={[0.5, 0.5]}\n            style={\n                {fontFamily : 'Gabriela', fontSize: 42, fill : 0xff1010, align : 'center'}\n            }\n        />\n    )\n});\n\nexport default ActionPoints;\n\n","import { Container, Graphics, Sprite } from '@inlet/react-pixi';\nimport React, { useRef, useEffect, useState, memo } from 'react';\nimport SceneActor, { Props as SceneActorProps } from './SceneActor';\nimport { useDispatch } from 'react-redux';\nimport useQuest from 'hooks/store/useQuest';\nimport { deductActorAp, enqueueSceneAction } from 'actions/quests';\nimport { SceneAction, SceneActionType } from 'stores/scene';\nimport ActionPath, { RefActions } from './ActionPath';\nimport { useAdventurerState } from 'hooks/store/adventurers';\nimport ActionPoints, { RefActionPoints } from './ActionPoints';\n\ninterface Props  {\n    name: string;\n    selected: boolean;\n    setSelectedActor: (actor: string) => void;\n};\n\n// The adventurers avatar on the scene\nconst SceneAdventurer = (props: Props & Omit<SceneActorProps, 'children'>) => {\n    const {\n        controller,\n        location,\n        name,\n        selected,\n    } = props;\n    const tileWidth = controller.mapData?.tilewidth!;\n    const tileHeight = controller.mapData?.tileheight!;\n    const dispatch = useDispatch();\n\n    const quest = useQuest(controller.questName);\n    const scene = quest.scene!;\n    const {combat} = scene;\n\n    const adventurer = useAdventurerState(name);\n\n    // Draw a line to indicate the action to take\n    const actionPathRef = useRef<RefActions>(null);\n    const actionPointsRef = useRef<RefActionPoints>(null);\n    const [actionActive, setActionActive] = useState(false);\n\n    useEffect(() => {\n        if (!actionActive || !location /* || scene.actionQueue?.length*/) {\n            return;\n        }\n        const actionPath = actionPathRef.current;\n        const container = actionPath?.parent!;\n        const mouseMove = (event: PIXI.InteractionEvent) => {\n            if (actionActive && location && actionPath) {\n                // Find out if on a blocked tile\n                const destinationLocation = controller.pointToSceneLocation(new PIXI.Point(event.data.global.x, event.data.global.y));\n                const blocked = controller.locationIsBlocked(destinationLocation);\n                let enoughAp = true;\n                const from = new PIXI.Point(location[0] * tileWidth + tileWidth / 2,\n                    location[1] * tileHeight + tileHeight / 2);\n\n                if (combat) {\n                    const ap = controller.calculateWalkApCosts(location, destinationLocation);\n                    if (ap > 0) {\n                        actionPointsRef.current?.drawAp(destinationLocation, ap);\n\n                        const remaining = controller.getRemainingAdventurerAp(name) || -1;\n                        enoughAp = remaining >= ap;\n                    } else {\n                        actionPointsRef.current?.clear();\n                    }\n                }\n\n                // Draw a line to the destination tile\n                actionPath.drawAction(from, event.data.global, !blocked && enoughAp);\n            }\n        }\n        container.on('pointermove', mouseMove);\n        return () => {\n           container.off('pointermove', mouseMove);\n        }\n    }, [actionActive, combat, controller, location, name, tileHeight, tileWidth]);\n\n    const handleActorStartDrag = () => {\n        setActionActive(true);\n        props.setSelectedActor(name);\n    }\n\n    // Queue actions\n    const handleActorEndDrag = (event: PIXI.InteractionEvent) => {\n        setActionActive(false);\n        const actionPath = actionPathRef.current;\n\n        setActionActive(false);\n        actionPath?.clear();\n        actionPointsRef.current?.clear();\n\n        if(scene.actionQueue?.length) {\n            return;\n        }\n\n        const endLocation = controller.pointToSceneLocation(new PIXI.Point(event.data.global.x, event.data.global.y));\n        const blocked = controller.locationIsBlocked(endLocation);\n        if (blocked) {\n            return;\n        }\n        const target = controller.pointToSceneLocation(event.data.global);\n        if(target[0] < 0 || target[0] >= controller.mapData?.width! || target[1] < 0 || target[1] >= controller.mapData?.height!) {\n            // Released out of bounds\n            return;\n        }\n\n        // Find path to walk using aStar\n        const path = controller.findPath(location!, target);\n\n        if (combat) {\n            const remaining = controller.getRemainingAdventurerAp(name) || -1;\n            if (remaining < (path?.length || 0)){\n                return;\n            }\n        }\n\n        const movementDuration = 500; // time every tile movement takes\n        path?.forEach((l, index) => {\n            const sceneAction: SceneAction = {\n                actionType: SceneActionType.move,\n                actor: name,\n                target: l as [number, number],\n                endsAt: movementDuration * (index + 1) + performance.now()\n            };\n            dispatch(enqueueSceneAction(controller.questName, sceneAction));\n        });\n        dispatch(deductActorAp(controller.questName, name, path?.length || 0));\n\n        // if (DEBUG_ASTAR) {\n        //     const graphics = new PIXI.Graphics();\n        //     path?.forEach((tile) => {\n        //         const [x, y] = tile;\n        //         const stroke = 3;\n        //         graphics.beginFill(0xDE3249, 0.5);\n        //         graphics.lineStyle(stroke, 0xFF0000);\n        //         graphics.drawRect(x * tileWidth + stroke / 2,\n        //             y * tileHeight + stroke / 2,\n        //             tileWidth - stroke / 2,\n        //             tileHeight - stroke / 2);\n        //         graphics.endFill();\n        //     });\n        //     ref.current!.addChild(graphics);\n        //     setTimeout(() => {\n        //         ref.current?.removeChild(graphics)}\n        //     , 1000);\n        // }\n\n    }\n\n\n    return (\n        <Container interactive={true}>\n            <ActionPath ref={actionPathRef} />\n            <ActionPoints ref={actionPointsRef} tileWidth={tileWidth} tileHeight={tileHeight} />\n            <SceneActor\n                name={name}\n                controller={controller}\n                location={location}\n                interactive={true}\n                pointerdown={handleActorStartDrag}\n                pointerup={handleActorEndDrag}\n                pointerupoutside={handleActorEndDrag}\n                hitArea={new PIXI.Rectangle(location?.[0], location?.[1], tileWidth, tileHeight)}\n                idleAnimation={Math.random() < 0.5}\n            >\n                {selected && (\n                    <Graphics\n                        name=\"selectioncircle\"\n                        draw={graphics => {\n                            const line = 3;\n                            graphics.lineStyle(line, 0xFFFFFF);\n                            graphics.drawCircle(tileWidth / 2, tileHeight / 2, tileWidth / 2 - line);\n                            graphics.endFill();\n                        }}\n                    />\n                )}\n                {/* <Sprite\n                    y={-80}\n                    image={`${process.env.PUBLIC_URL}/img/scene/actors/wizard.png`}\n                /> */}\n                <Sprite\n                    scale={.1}\n                    anchor={.5}\n                    x={tileWidth / 2}\n                    y={-30}\n                    image={`${process.env.PUBLIC_URL}/${adventurer.avatarImg}`}\n                />\n                { (selected && controller.actorCanInteract(name)) && (\n                    <Container\n                        interactive={true}\n                        pointerdown={() => {controller.actorInteract(name)}}\n                    >\n                        {/* <Graphics\n                            draw={graphics => {\n                                graphics.beginFill(0xDE3249);\n                                graphics.drawCircle(tileWidth / 2, tileHeight, tileWidth / 4);\n                                graphics.endFill();\n                            }}\n                        /> */}\n                        <Sprite\n                            image={`${process.env.PUBLIC_URL}/img/scene/ui/background.png`}\n                            width={tileWidth / 2}\n                            height={tileWidth / 2}\n                            y={tileHeight}\n                            x={tileWidth/2}\n                            anchor={.5}\n                        />\n                        <Sprite\n                            image={`${process.env.PUBLIC_URL}/img/scene/ui/interact.png`}\n                            width={tileWidth / 2}\n                            height={tileWidth / 2}\n                            y={tileHeight}\n                            x={tileWidth/2}\n                            anchor={.5}\n                        />\n                    </Container>\n                )}\n            </SceneActor>\n        </Container>\n    )\n}\n\nexport default memo(SceneAdventurer);\n","import { useState, useEffect } from \"react\";\n\nimport { loadResource } from \"utils/pixiJs\";\nimport { TiledTilesetData } from 'constants/tiledMapData';\nimport { SpritesheetData, SpriteData } from 'constants/spritesheetData';\n\nconst useTilesetsLoader = (basePath: string) => {\n    const [tileSpritesheets, setTilesets] = useState<{[key: string]: PIXI.Spritesheet}>({});\n    const [data, setData] = useState<TiledTilesetData[]>();\n\n    const loadTilesets = (value: TiledTilesetData[]) => {\n        setData(value);\n    };\n\n    useEffect(() => {\n        if (!data) return;\n        const nextTileset = nextTilesetToload(data, tileSpritesheets);\n        if (!nextTileset) return;\n\n        const tilesetName = nextTileset.name;\n\n        loadResource(`${basePath}/${nextTileset.image}`, (resource) => {\n            if (resource.error) {\n                throw new Error(`Loading ${basePath}\\n${resource.error}`);\n            }\n            const spritesheetData = parseSpritesheetData(nextTileset);\n            const spritesheet = new PIXI.Spritesheet(resource.texture, spritesheetData);\n\n            spritesheet.parse(() => {\n                const newTilesets = {\n                    ...tileSpritesheets,\n                    [tilesetName]: spritesheet\n                }\n                setTilesets(newTilesets);\n            })\n        });\n    }, [data, basePath, tileSpritesheets]);\n\n    const loadComplete = !!data && nextTilesetToload(data, tileSpritesheets) === undefined;\n\n    return {\n        loadComplete,\n        loadTilesets,\n        tileSpritesheets\n    }\n}\n\nexport default useTilesetsLoader;\n\n// Returns a TiledTilesetData that has not been loaded into tilesetsTextures yet\nconst nextTilesetToload = (tilesets: TiledTilesetData[], tilesetsTextures: {[key: string]: PIXI.Spritesheet}) => {\n    return tilesets.find((t) => {\n        return !tilesetsTextures[t.name];\n    })\n}\n\n\nconst parseSpritesheetData = (tileset: TiledTilesetData): SpritesheetData => {\n    const columns = tileset.columns;\n\n    const frames: { [name: string]: SpriteData } = {};\n    for (let i = 0; i < tileset.tilecount; i++) {\n        const w = tileset.tilewidth;\n        const h = tileset.tileheight;\n        const x = (i % columns) * w;\n        const y = Math.floor(i / columns) * h;\n\n        frames[`${tileset.name}-${i + tileset.firstgid}`] = {\n            frame: {x, y, w, h},\n            spriteSourceSize: {x, y, w, h},\n            rotated: false,\n            trimmed: false,\n            sourceSize: { w, h}\n        };\n    }\n    const image = tileset.image;\n    const size = { w: tileset.imagewidth, h: tileset.imageheight };\n    return {\n        frames,\n        meta: {\n            image,\n            size,\n            scale: 1\n        }\n    };\n}\n","\nimport { Container } from '@inlet/react-pixi';\nimport React, { useMemo, forwardRef, PropsWithChildren } from 'react';\nimport { BaseSceneController } from 'mechanics/scenes/BaseSceneController';\n\ninterface Props {\n  controller: BaseSceneController<any>;\n  location?: [number, number]; // tile coordinate space\n};\n\n// This is a wrapper that exposes a location property. Will set x and y on children\nconst SceneObjectWrapper = forwardRef<PIXI.Container, PropsWithChildren<Props>>((props, ref) => {\n    const {\n        location = [0, 0],\n        controller,\n        children\n    } = props;\n    const tileWidth = controller.mapData?.tilewidth!;\n    const tileHeight = controller.mapData?.tileheight!;\n\n    const {x, y} = useMemo(() => {\n        return {\n            x: location[0] * tileWidth,\n            y: location[1] * tileHeight,\n        };\n    }, [location, tileWidth, tileHeight]);\n\n    return (\n        <Container x={x} y={y} ref={ref}>\n            {children}\n        </Container>\n    )\n});\n\nexport default SceneObjectWrapper;\n","import React, {  } from \"react\";\nimport SceneObjectWrapper from './SceneObjectWrapper';\nimport { SceneObject } from 'stores/scene';\nimport { BaseSceneController } from 'mechanics/scenes/BaseSceneController';\nimport { Sprite } from '@inlet/react-pixi';\nimport { TiledTilesetData } from 'constants/tiledMapData';\n\nconst renderObject = (object: SceneObject, controller: BaseSceneController<any>, spritesheets: {[key: string]: PIXI.Spritesheet} ) => {\n\n    if (object.gid){\n        // const tilesets = controller.mapData!.tilesets;\n        const tileset = findTileset(object.gid, controller.mapData!.tilesets);\n        const spritesheet = spritesheets[tileset.name]\n        return (\n            <SceneObjectWrapper\n                key={`${object.name}${object.location[0]}${object.location[1]}`}\n                controller={controller}\n                location={object.location}\n            >\n                <Sprite\n                    name={object.name}\n                    texture={spritesheet.textures[`${tileset.name}-${object.gid}`]}\n                />\n            </SceneObjectWrapper>\n        )\n    }\n    return  <div/>\n}\n\nexport default renderObject;\n\nconst findTileset = (gid: number, tilesets: TiledTilesetData[]) => {\n    for (let i = tilesets.length - 1; i >= 0; i--) {\n        if (tilesets[i].firstgid <= gid) {\n            return tilesets[i];\n        }\n    }\n    return tilesets[0];\n}\n","import React, { useRef, useMemo, useEffect, useContext, useCallback } from \"react\";\nimport { Container } from '@inlet/react-pixi';\nimport useQuest from 'hooks/store/useQuest';\nimport Tilemap from './Tilemap';\nimport { ActorObject } from 'stores/scene';\nimport BridgedStage from 'components/pixi/util/BridgedStage';\nimport SceneAdventurer from './SceneAdventurer';\nimport useTilesetsLoader from 'hooks/useTilesetsLoader';\nimport renderObject from './renderObject';\nimport { SceneControllerContext } from '../../context/SceneControllerContext';\n\nimport * as PIXI from 'pixi.js';\nwindow.PIXI = PIXI;\n// eslint-disable-next-line import/first\nimport 'pixi-tilemap'; // tilemap is not a real npm module :/\n\nexport interface Props {\n    selectedActor: string;\n    setSelectedActor: (actor: string) => void;\n}\n\nconst DEBUG_ACTIONQUEUE = false;\n\nconst Scene = (props: Props) => {\n    const controller = useContext(SceneControllerContext)!;\n    const mapData = controller.mapData!;\n    const basePath = controller.basePath!;\n\n    const {\n        loadComplete,\n        loadTilesets,\n        tileSpritesheets\n    } = useTilesetsLoader(basePath);\n\n    const ref = useRef<PIXI.Container>(null);\n    const quest = useQuest(controller.questName);\n    const scene = quest.scene!;\n\n    const selectedActor = useMemo(() => {\n        return scene?.actors?.find(a => a.name === props.selectedActor) || null;\n    }, [scene, props.selectedActor]);\n\n    const renderActors = useCallback(() => {\n        const renderActor = (actor: ActorObject) => {\n            const {name, location} = actor;\n            return (\n                <SceneAdventurer\n                    location={location}\n                    // spritesheet={spritesheet}\n                    controller={controller}\n                    name={name}\n                    key={name}\n                    selected={selectedActor?.name === name}\n                    setSelectedActor={props.setSelectedActor}\n                />\n            );\n        }\n        return scene?.actors?.map((o) => renderActor(o));\n\n    }, [controller, props.setSelectedActor, scene, selectedActor])\n\n    useEffect(() => {\n        if (!mapData) return;\n        loadTilesets(mapData.tilesets);\n    }, [loadTilesets, mapData]);\n\n    if (!loadComplete || !mapData || !scene) {\n        return <div>loading...</div>\n    }\n    const sceneWidth = mapData.width * mapData.tilewidth;\n    const sceneHeight = mapData.height * mapData.tileheight;\n\n    return (\n        <>\n            <BridgedStage width={sceneWidth} height={sceneHeight}>\n                <Container\n                    ref={ref}\n                    interactive={true}\n                    hitArea={new PIXI.Rectangle(0, 0, sceneWidth, sceneHeight)}\n                >\n                    <Tilemap\n                        basePath={basePath}\n                        data={mapData}\n                        spritesheets={tileSpritesheets}\n                    />\n                    { scene.objects.map((o) => renderObject(o, controller, tileSpritesheets ))}\n                    { renderActors()}\n                </Container>\n            </BridgedStage>\n            {DEBUG_ACTIONQUEUE && (\n                <div style={{ position: 'absolute', bottom: 0}}>\n                    <h2>ActionQueue</h2>\n                    <ul>\n                        {scene.actionQueue && scene.actionQueue.map((action) => (\n                            <li key={JSON.stringify(action)}>{JSON.stringify(action)}</li>\n                        ))}\n                    </ul>\n                </div>\n            )}\n        </>\n    );\n}\n\nexport default Scene;\n","import React, { useState, useMemo, useEffect } from \"react\";\nimport AdventurerTabstrip from './AdventurerTabstrip';\nimport { createSelectAdventurersOnQuest } from 'selectors/adventurers';\nimport { useSelector, useDispatch } from 'react-redux';\nimport AdventurerPanel from './AdventurerPanel';\nimport QuestDetails from './QuestDetails';\nimport { useHistory } from 'react-router';\nimport { getWorldLink } from 'utils/routing';\nimport LootCache from './modals/LootCache';\nimport useQuest from 'hooks/store/useQuest';\nimport { setActiveSceneInteractionModal } from 'actions/quests';\nimport Situation from './modals/Situation';\nimport SceneControllerContextProvider from './context/SceneControllerContext';\nimport CombatBar from './CombatBar';\nimport \"./styles/questPanel.scss\";\n\nenum Layout {\n    auto,       // horizontal on large screens, vertical on small screens\n    vertical,\n    horizontal\n}\n\ninterface Props {\n    questName: string;\n    layout?: Layout;\n}\n\nconst QuestPanel = (props: Props) => {\n    const history = useHistory();\n    const dispatch = useDispatch();\n    const {layout = Layout.auto} = props;\n    const adventurers = useSelector(createSelectAdventurersOnQuest(props.questName));\n    const leader = adventurers[0];\n    const [selectedAdventurerId, setSelectedAdventurerID] = useState<string>(leader?.id);\n\n    const selectedAdventurer = useMemo(() => {\n        return adventurers.find(a => a.id === selectedAdventurerId);\n    }, [adventurers, selectedAdventurerId]);\n\n    const quest = useQuest(props.questName);\n    const activeInteractionModal = quest?.scene?.activeInteractionModal;\n\n    const handleAdventurerSelected = (adventurerId: string) => {\n        setSelectedAdventurerID(adventurerId);\n    }\n\n    const handleCloseLootCacheModal = () => {\n        dispatch(setActiveSceneInteractionModal(props.questName));\n    }\n\n    useEffect(() => {\n        if (!adventurers.length) {\n            // no adventurers, something went wrong, perhaps invalid url\n            // bounce back to world\n            history.push(getWorldLink());\n       }\n    }, [adventurers.length, history]);\n    if (!adventurers.length) return null;\n\n    return (\n        <SceneControllerContextProvider questName={props.questName}>\n            { quest?.scene?.combat && <CombatBar questName={props.questName} />}\n            <div className={`quest-panel quest-panel-${Layout[layout]}`}>\n                <div className=\"quest-area\">\n                    <QuestDetails\n                        questName={props.questName}\n                        selectedActor={selectedAdventurerId}\n                        setSelectedActor={handleAdventurerSelected}\n                    />\n                    { activeInteractionModal && activeInteractionModal.type === 'lootCache' && (\n                        <div className=\"modal\" onClick={handleCloseLootCacheModal}>\n                            <LootCache\n                                cacheName={activeInteractionModal.lootCache}\n                                adventurerId={selectedAdventurerId}\n                                onClose={handleCloseLootCacheModal}\n                            />\n                        </div>\n                    )}\n                    { activeInteractionModal && activeInteractionModal.type === 'situation' && (\n                        <div className=\"modal\" onClick={handleCloseLootCacheModal}>\n                            <Situation\n                                situation={activeInteractionModal.situation}\n                                adventurerId={selectedAdventurerId}\n                                onClose={handleCloseLootCacheModal}\n                            />\n                        </div>\n                    )}\n                </div>\n                <div className=\"party-area\">\n                    <AdventurerTabstrip\n                        adventurers={adventurers}\n                        selectedAdventurerId={selectedAdventurerId}\n                        onAdventurerTabSelected={handleAdventurerSelected}\n                        disabled={activeInteractionModal !== undefined}\n                        />\n                    <div className=\"adventurer-details\">\n                        { selectedAdventurer && (\n                            <AdventurerPanel\n                                adventurer={selectedAdventurer}\n                                questName={props.questName}\n                            />\n                        )}\n                    </div>\n                </div>\n            </div>\n        </SceneControllerContextProvider>\n    )\n}\n\nexport default QuestPanel;\n","import React from 'react';\nimport useQuest from 'hooks/store/useQuest';\nimport { getDefinition } from 'definitions/quests';\nimport { QuestDefinition } from 'definitions/quests/types';\nimport { TextManager } from 'global/TextManager';\n\nexport interface Props {\n    questName: string;\n}\n\n/* Shows the most recent log on a questnode */\nconst OnTheRoad = (props: Props) => {\n    const quest = useQuest(props.questName);\n    const questDefinition: QuestDefinition = getDefinition(quest.name);\n    let progress: number = Math.floor(quest.progress);\n    do {\n        const log = questDefinition.nodes[progress].log;\n        if (log) {\n            return (\n                <div>\n                    <p>{`${TextManager.get(log)}`}</p>\n                </div>\n            )\n        }\n        progress--;\n    } while (progress >= 0);\n    return <h1 className=\"app-h2\">{TextManager.getQuestTitle(quest.name)}</h1>;\n}\n\nexport default OnTheRoad;","import React from 'react';\nimport Scene from 'components/world/QuestPanel/QuestDetails/scene/Scene';\nimport useQuest from 'hooks/store/useQuest';\nimport OnTheRoad from './OnTheRoad';\n\nexport interface Props {\n    questName: string;\n    selectedActor: string;\n    setSelectedActor: (actor: string) => void;\n}\n\nconst QuestDetails = (props: Props) => {\n    const quest = useQuest(props.questName);\n\n    if (!quest.sceneName) {\n        return <OnTheRoad questName={props.questName} />;\n    }\n    return (\n        <Scene {...props} />\n    );\n}\n\nexport default QuestDetails;","import { Item } from \"definitions/items/types\";\nimport * as React from \"react\";\nimport { TextManager } from \"global/TextManager\";\nimport DraggableItemIcon from 'components/ui/DraggableItemIcon';\nimport { DragSourceType } from 'constants/dragging';\nimport \"components/ui/styles/icon.scss\";\nimport \"./itemsList.scss\";\n\nexport interface Props {\n    className?: string;\n    items: Item[];\n    sourceType: DragSourceType;\n    sourceId?: string;\n}\n\n/**\n * The ItemsList displays a list of items vertically. Shows icon and description\n */\nconst DraggableItemsList = (props: Props) => {\n    const className = (props.className || \"\")+ \" itemslist\";\n\n    return (\n        <ul className={className} >\n            {props.items.map((item, index)=> (\n                <li\n                    key={`${item}${index}`}\n                    className=\"item\"\n                >\n                    <DraggableItemIcon\n                        item={item}\n                        index={index}\n                        sourceId={props.sourceId}\n                        sourceType={props.sourceType}\n                    />\n                    <div className=\"text\">\n                        <p className=\"name\">{TextManager.getItemName(item)}</p>\n                        <p className=\"subtext\">{TextManager.getItemSubtext(item)}</p>\n                    </div>\n                </li>\n            ))}\n        </ul>\n    );\n};\n\nexport default DraggableItemsList;\n","import React, { useRef, useContext } from \"react\";\nimport gsap from 'gsap';\nimport DraggableItemsList from 'components/ui/items/DraggableItemsList';\nimport { TextManager } from 'global/TextManager';\nimport AdventurerAvatar from 'components/ui/adventurer/AdventurerAvatar';\nimport { DragSourceType } from 'constants/dragging';\nimport { adventurerFreeInventorySlots } from 'storeHelpers';\nimport { SceneControllerContext } from '../../context/SceneControllerContext';\nimport { useAdventurerState } from 'hooks/store/adventurers';\nimport Button from 'components/ui/buttons/Button';\nimport \"../styles/lootCache.scss\";\nimport \"../styles/modal.scss\";\nimport { getClassName, IconSize } from 'constants/icons';\n\ninterface Props {\n    cacheName: string;\n    adventurerId: string;\n    onClose: () => void;\n}\n\nconst LootCache = (props: Props) => {\n    const controller = useContext(SceneControllerContext)!;\n    const adventurer = useAdventurerState(props.adventurerId);\n    const freeSlots = adventurerFreeInventorySlots(adventurer);\n    const ref = useRef<HTMLDivElement>(null);\n    const cache = controller.getLootCache(props.cacheName);\n\n    if (!cache) {\n        return null;\n    }\n\n    const handleTakeGold = (e: React.MouseEvent) => {\n        e.stopPropagation();\n        // todo: animate gold flying away\n\n        controller.takeGoldFromCache(props.cacheName);\n    }\n\n    const handleTakeAllItems = (e: React.MouseEvent) => {\n        e.stopPropagation();\n        ref.current!.querySelectorAll(\".itemslist .item\").forEach((el, index) => {\n            if (index >= freeSlots) return;\n            el.classList.add(\"taking\");\n        });\n        gsap.to(\".itemslist .item.taking\", {\n            right: \"-100%\",\n            stagger: {\n              each: 0.1,\n              ease: \"power2.inOut\",\n            },\n            onComplete: () => {\n                for (let i = 0; i < freeSlots; i++) {\n                    controller.takeItemFromCache(0, props.cacheName, adventurer);\n                }\n            }\n        });\n    }\n\n    return (\n        <div className={`interaction-modal loot-cache`} ref={ref}>\n            <div className=\"header\">\n                <div className=\"title\">\n                    {TextManager.get(cache.title)}\n                </div>\n                <div className=\"close\" onClick={props.onClose} />\n            </div>\n            { cache.items.length > 0 && (\n                <div className=\"content\">\n                    <div className=\"items\">\n                        <DraggableItemsList\n                            items={cache.items}\n                            sourceType={DragSourceType.lootCache}\n                            sourceId={props.cacheName}\n                        />\n                    </div>\n                    <div className=\"adventurer\">\n                        <AdventurerAvatar adventurer={adventurer}/>\n                        <Button onClick={handleTakeAllItems} disabled={freeSlots === 0} size=\"small\">\n                            {TextManager.get(\"quest-common-loot-cache-take-all\")}\n                        </Button>\n                    </div>\n                </div>\n            )}\n            { !!cache.gold && (\n                <div className=\"content\">\n                    <div className=\"gold\">\n                        <div\n                            className={`icon ${getClassName(IconSize.medium)}`}\n                            style={{ backgroundImage: `url(${process.env.PUBLIC_URL}/img/resources/gold.png)`}}\n                        />\n                        {TextManager.get(\"quest-common-loot-cache-gold\", { gold: cache.gold })}\n                    </div>\n                    <div className=\"take-gold\">\n                        <Button onClick={handleTakeGold} size=\"small\">\n                            {TextManager.get(\"quest-common-loot-cache-take\")}\n                        </Button>\n                    </div>\n                </div>\n            )}\n        </div>\n    )\n}\n\nexport default LootCache;","import React, { MouseEvent, useRef, useContext } from \"react\";\nimport { TextManager } from 'global/TextManager';\nimport { SceneControllerContext } from '../../context/SceneControllerContext';\nimport Button from 'components/ui/buttons/Button';\nimport \"../styles/situation.scss\";\nimport \"../styles/modal.scss\";\n\ninterface Props {\n    situation: string;\n    adventurerId: string;\n    onClose: () => void;\n}\n\nconst Situation = (props: Props) => {\n    const controller = useContext(SceneControllerContext)!;\n    const ref = useRef<HTMLDivElement>(null);\n    const situation = controller.getSituation(props.situation, props.adventurerId);\n    if (!situation) return null;\n\n    const { title, choices } = situation;\n\n    const handleChoiceClick = (e: MouseEvent<HTMLButtonElement>) => {\n        //choice: string\n        const choice = e.currentTarget.getAttribute('data-option')!;\n        controller.handleSituationOptionClick(props.situation, choice);\n        e.stopPropagation();\n    }\n\n    const handleClose = (e: MouseEvent<HTMLDivElement>) => {\n        props.onClose();\n        e.stopPropagation();\n    }\n    return (\n        <div className={`interaction-modal situation`} ref={ref}>\n            <div className=\"header\">\n                <div className=\"title\">\n                    {TextManager.get(title)}\n                </div>\n                <div className=\"close\" onClick={handleClose} />\n            </div>\n             { choices.length > 0 && (\n                <div className=\"content\">\n                    {choices.map(choice => (\n                        <Button key={choice} data-option={choice} onClick={handleChoiceClick}>{TextManager.get(choice)}</Button>\n                    ))}\n                </div>\n            )}\n        </div>\n    )\n}\n\nexport default Situation;","import React, { useContext } from \"react\";\nimport { useSelector } from 'react-redux';\nimport { createSelectAdventurersOnQuest } from 'selectors/adventurers';\nimport { SceneControllerContext } from '../context/SceneControllerContext';\nimport AdventurerAvatar from 'components/ui/adventurer/AdventurerAvatar';\nimport { IconSize } from 'constants/icons';\nimport \"./styles/combatBar.scss\";\nimport { TextManager } from 'global/TextManager';\n\ninterface Props {\n    questName: string;\n}\n\nconst CombatBar = (props: Props) => {\n    const adventurers = useSelector(createSelectAdventurersOnQuest(props.questName));\n    const controller = useContext(SceneControllerContext)!;\n\n    return (\n        <div className=\"combat-bar\">\n            <div className=\"title\">\n                {TextManager.get(\"ui-combat-bar-title\")}\n            </div>\n            <div className=\"adventurers\">\n                {adventurers.map(a => (\n                    <React.Fragment key={a.id}>\n                        <AdventurerAvatar adventurer={a} size={IconSize.smallest}/>\n                        <div className=\"ap\">\n                            {controller.getRemainingAdventurerAp(a.id)} AP\n                        </div>\n                    </React.Fragment>\n                ))}\n\n            </div>\n        </div>\n    )\n}\n\nexport default CombatBar;\n","import Tab from \"components/ui/tabs/Tab\";\r\nimport Tabstrip from \"components/ui/tabs/Tabstrip\";\r\nimport * as React from \"react\";\r\nimport {LogChannel, LogEntry} from \"stores/logEntry\";\r\nimport {TextManager} from \"global/TextManager\";\r\nimport {useState} from 'react';\r\nimport {StoreState} from 'stores';\r\nimport {useSelector} from 'react-redux';\r\nimport {QuestStoreState} from 'stores/quest';\r\nimport {selectActiveQuests} from 'selectors/quests';\r\nimport \"./styles/simplelog.scss\";\r\nimport Button from 'components/ui/buttons/Button';\r\n\r\n// tslint:disable-next-line:no-empty-interface\r\nexport interface Props {\r\n}\r\n\r\nenum ChannelType {\r\n    all,\r\n    town,\r\n    quest,\r\n}\r\n\r\ninterface ChannelDefinition {\r\n    label: string;\r\n    tabType: ChannelType;\r\n    tabId: string;\r\n    channelContext?: string;\r\n}\r\n\r\nconst SimpleLog = (props: Props) => {\r\n\r\n    const [expanded, setExpanded] = useState(false);\r\n    const [selectedTabId, setSelectedTabId] = useState(\"all\");\r\n\r\n    const logEntries = useSelector<StoreState, LogEntry[]>((store) => store.log);\r\n    const activeQuests = useSelector<StoreState, QuestStoreState[]>((store) => selectActiveQuests(store));\r\n\r\n\r\n    const channels: ChannelDefinition[]=[{\r\n        label: TextManager.get(\"ui-log-tab-all\"),\r\n        tabId: \"all\",\r\n        tabType: ChannelType.all,\r\n    }, {\r\n        label: TextManager.get(\"ui-log-tab-town\"),\r\n        tabId: \"town\",\r\n        tabType: ChannelType.town,\r\n    }];\r\n\r\n    const handleTabSelected = (tabId: string) => {\r\n        setSelectedTabId(tabId);\r\n    }\r\n\r\n    const handleToggleExpand=() => {\r\n        setExpanded(!expanded);\r\n    }\r\n\r\n    activeQuests.forEach((quest) => {\r\n        const questName = quest.name;\r\n        channels.push({\r\n            channelContext: questName,\r\n            label: TextManager.getQuestTitle(questName),\r\n            tabId: `quest-${questName}`,\r\n            tabType: ChannelType.quest,\r\n        });\r\n    });\r\n\r\n    let displayEntries: LogEntry[] = [];\r\n    const currentTab=channels.find((t) => t.tabId === selectedTabId)!;\r\n\r\n    switch (currentTab.tabType) {\r\n        case ChannelType.all:\r\n            // All the things\r\n            displayEntries = logEntries;\r\n            break;\r\n\r\n        case ChannelType.town:\r\n            // Only town\r\n            displayEntries = logEntries.filter((lE) => lE.channel === LogChannel.town);\r\n            break;\r\n\r\n        case ChannelType.quest:\r\n            // Only the selected quest\r\n            displayEntries = logEntries.filter((lE) => lE.channel === LogChannel.quest && lE.channelContext === currentTab.channelContext);\r\n            break;\r\n}\r\n\r\n    const getLogEntryRow = (logEntry: LogEntry) => {\r\n        const text = TextManager.get(logEntry.key, logEntry.context);\r\n        return (\r\n            <div className=\"entry\" key={logEntry.time}>\r\n                {text}\r\n            </div>\r\n        );\r\n    };\r\n\r\n    return (\r\n        <div className={`log ${expanded ? \"expanded\" : \"\"}`}>\r\n            <div className=\"tab-bar\">\r\n                <Tabstrip className=\"tabs\" onTabSelected={handleTabSelected} activeTab={selectedTabId}>\r\n                    {channels.map((tab) => {\r\n                        return <Tab id={tab.tabId} key={tab.tabId}>{tab.label}</Tab>;\r\n                    })}\r\n                </Tabstrip>\r\n                <Button\r\n                    className=\"expand-button\"\r\n                    onClick={handleToggleExpand}\r\n                    square={true}\r\n                    size={\"medium\"}\r\n                    text={expanded ? \"▼\" : \"▲\"}\r\n                />\r\n            </div>\r\n            <div className=\"log-entries\">\r\n                {displayEntries.map((entry) => getLogEntryRow(entry))}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default SimpleLog;\r\n","import WorldMap from \"components/world/WorldMap\";\r\nimport React, { useEffect, useRef } from \"react\";\r\nimport { MusicTrack, SoundManager, Sound } from \"global/SoundManager\";\r\nimport QuestPanel from './QuestPanel';\r\nimport { useRouteMatch, useHistory } from 'react-router';\r\nimport { getQuestLink, getWorldLink } from 'utils/routing';\r\nimport \"./styles/worldView.scss\";\r\n\r\n// tslint:disable-next-line:no-empty-interface\r\nexport interface Props {\r\n}\r\n\r\n\r\n/**\r\n * WorldView shows the map and QuestPanel\r\n * @param props\r\n */\r\nconst WorldView = () => {\r\n    const worldMapRef = useRef<HTMLDivElement>(null);\r\n    const match = useRouteMatch<{questname: string}>(`${getWorldLink()}/:questname`);\r\n    const selectedQuestName = match?.params.questname;\r\n    const history = useHistory();\r\n\r\n    useEffect(() => {\r\n        SoundManager.addMusicTrack(MusicTrack.world, \"sound/music/TheLoomingBattle.ogg\");\r\n        SoundManager.playMusicTrack(MusicTrack.world);\r\n    }, []);\r\n\r\n    // console.log(params.questname);\r\n    // const handleMapMove = (distance: number, angle: number) => {\r\n    //     const compassEl = compassRef!.current!;\r\n    //     const compassTextEl = compassEl.firstElementChild! as HTMLElement;\r\n\r\n    //     // Rotate the compass\r\n    //     compassEl.style.transform = `rotate(${angle - (Math.PI / 2)}rad)`;\r\n    //     compassEl.style.opacity = distance > 10 ? \"1\" : \"0\";\r\n    //     compassTextEl.style.transform = `rotate(${-angle + (Math.PI / 2)}rad)`;\r\n    //     compassTextEl.innerHTML = `${distance.toFixed(0)}`;\r\n    // };\r\n\r\n    // const handleCompassClick = () => {\r\n    //     //setScrollToPosition(new Vector2(1, 1));\r\n    // };\r\n\r\n    const handlePartyClick = (questName: string) => {\r\n        if (questName === selectedQuestName) {\r\n            history.push(getWorldLink());\r\n        } else {\r\n            history.push(getQuestLink(questName));\r\n        }\r\n        SoundManager.playSound(Sound.buttonClick);\r\n    };\r\n\r\n    const handleRetrieveWorldViewRef = () => {\r\n        return worldMapRef;\r\n    }\r\n\r\n    return (\r\n        <div className=\"world-view\" ref={worldMapRef}>\r\n            {/* <div className=\"compass\" ref={compassRef} onClick={handleCompassClick}>\r\n                <div className=\"distance\"/>\r\n            </div> */}\r\n            <WorldMap\r\n                selectedQuestName={selectedQuestName}\r\n                // onMapMove={handleMapMove}\r\n                smallMap={selectedQuestName != null}\r\n                onPartyClick={handlePartyClick}\r\n                retrieveWorldViewRef={handleRetrieveWorldViewRef}\r\n            />\r\n            { selectedQuestName && (\r\n                <QuestPanel questName={selectedQuestName} />\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default WorldView;\r\n","// tslint:disable:object-literal-sort-keys\nimport { Action, AnyAction } from \"redux\";\nimport { TaskType } from \"stores/task\";\n\nexport enum ActionType {\n    start = \"startTask\",\n    update = \"updateTasks\",\n}\n\nexport interface AddAction extends Action<ActionType> {\n    taskType: TaskType;\n    name: string;\n    origin: string;\n    time: number;\n    callbacks: AnyAction[];\n}\n\nexport function startTask(taskType: TaskType,\n                          name: string, origin: string, time: number, callbacks: AnyAction[]): AddAction {\n    return {\n        type: ActionType.start,\n        taskType,\n        name,\n        origin,\n        time,\n        callbacks,\n    };\n}\n","import { AnyAction } from \"redux\";\n\nexport enum TaskType {\n    buildStructure,\n    craftItem,\n    studyItem\n}\n\nexport interface TaskStoreState {\n    type: TaskType;\n    name: string;\n    origin: string;\n    startTime: number;        // time the task was scheduled\n    lastTick: number;         // time of last tick\n    timeRemaining: number;\n    progress: number;         // value between 0 and 1 indicating progress\n    callbacks: AnyAction[];\t  // actions to dispatch on complete\n}\n","import { useCallback } from 'react';\nimport { StoreState } from 'stores';\nimport { useSelector } from 'react-redux';\nimport { Structure } from 'definitions/structures';\nimport { StructureStoreState } from 'stores/structure';\n\n// Returns the structure state from redux store\nexport default function useStructureState<T extends StructureStoreState>(structure: Structure): T {\n    const structureSelector = useCallback(\n        (state: StoreState) => state.structures[structure] as T,\n        [structure]\n    );\n    return useSelector<StoreState, T>(structureSelector);\n}\n","import * as React from \"react\";\nimport { useDispatch } from 'react-redux';\nimport { Structure, getDefinition } from 'definitions/structures';\nimport { subtractGold } from 'actions/gold';\nimport { startBuildingStructure, finishBuildingStructure } from 'actions/structures';\nimport { startTask } from 'actions/tasks';\nimport { TaskType } from 'stores/task';\nimport { DeedDefinition } from 'definitions/items/deeds';\nimport useGoldState from 'hooks/store/useGoldState';\nimport useStructureState from 'hooks/store/useStructureState';\nimport { StructureState } from 'stores/structure';\nimport { TextManager } from 'global/TextManager';\nimport Button from 'components/ui/buttons/Button';\n\ninterface Props {\n    info: DeedDefinition;\n}\n\nconst DeedContent = (props: Props) => {\n    const { info } = props;\n    const dispatch = useDispatch();\n\n    const gold = useGoldState();\n    const structureDefinition = getDefinition(info.structure);\n    const enoughGold = structureDefinition.cost.gold || 0 <= gold;\n    const structureStoreState = useStructureState(info.structure);\n    const canBeBuilt = structureStoreState.state === StructureState.NotBuilt;\n    const disabled = !canBeBuilt || !enoughGold;\n    const subtext = TextManager.getItemSubtext(info.item);\n\n    const handleStartConstruction = (structure: Structure) => {\n\n        dispatch(subtractGold(structureDefinition.cost.gold || 0));\n        dispatch(startBuildingStructure(structure));\n\n        const callbacks = [ finishBuildingStructure(structure) ];\n        const time = structureDefinition.cost.time!;\n        const start = startTask(TaskType.buildStructure,\n            `${structure}.build`,\n            \"town\",\n            time,\n            callbacks);\n        dispatch(start);\n    }\n    return (\n        <div>\n            { subtext && (<p className=\"subtext\">\"{subtext}\"</p>)}\n            <Button\n                disabled={disabled}\n                size=\"small\"\n                onClick={() => handleStartConstruction(info.structure)}\n            >\n                Start construction ({ structureDefinition.cost.gold } gold)\n            </Button>\n        </div>\n    );\n\n}\n\nexport default DeedContent;","// tslint:disable:object-literal-sort-keys\n\nimport * as time from \"utils/format/time\";\nimport { Item } from \"../items/types\";\nimport { ProductionDefinition } from \"./types\";\n\nconst weaponsmithProduction: {[key: string]: ProductionDefinition} = {\n    [Item.aegisOfValor]: {\n        item: Item.aegisOfValor,\n        levelRequired: 3,\n        cost: {\n            resources: { wood: 20, iron: 5 },\n            time: time.HALF_HOUR,\n        },\n    },\n    [Item.arbalest]: {\n        item: Item.arbalest,\n        cost: {\n            resources: { wood: 20, iron: 5 },\n            time: time.HALF_HOUR,\n        },\n    },\n    [Item.battleAxe]: {\n        item: Item.battleAxe,\n        cost: {\n            resources: { wood: 20, iron: 5 },\n            time: time.HALF_HOUR,\n        },\n    },\n    [Item.berserkerShield]: {\n        item: Item.berserkerShield,\n        levelRequired: 2,\n        cost: {\n            resources: { wood: 20, iron: 5 },\n            time: time.HALF_HOUR,\n        },\n    },\n    [Item.brassKnuckles]: {\n        item: Item.brassKnuckles,\n        cost: {\n            resources: { wood: 20, iron: 5 },\n            time: time.HALF_HOUR,\n        },\n    },\n    [Item.simpleCrossbow]: {\n        item: Item.simpleCrossbow,\n        cost: {\n            resources: { wood: 20, iron: 5 },\n            time: time.HALF_HOUR,\n        },\n    },\n    [Item.cleaver]: {\n        item: Item.cleaver,\n        cost: {\n            resources: { wood: 10, iron: 15 },\n            time: time.HALF_HOUR,\n        },\n    },\n    [Item.club]: {\n        item: Item.club,\n        cost: {\n            resources: { wood: 30,},\n            time: time.HALF_HOUR,\n        },\n    },\n    [Item.dagger]: {\n        item: Item.dagger,\n        cost: {\n            resources: { wood: 10, iron: 10},\n            time: time.ONE_HOUR,\n        },\n    },\n    [Item.flail]: {\n        item: Item.flail,\n        cost: {\n            resources: { wood: 10, iron: 10},\n            time: time.ONE_HOUR,\n        },\n    },\n    [Item.goldenShield]: {\n        item: Item.goldenShield,\n        levelRequired: 2,\n        cost: {\n            resources: { wood: 20, iron: 5 },\n            time: time.HALF_HOUR,\n        },\n    },\n    [Item.javelin]: {\n        item: Item.javelin,\n        cost: {\n            resources: { wood: 20, iron: 10},\n            time: time.ONE_HOUR + time.HALF_HOUR,\n        },\n    },\n    [Item.khopesh]: {\n        item: Item.khopesh,\n        cost: {\n            resources: { wood: 15, iron: 40},\n            time:  time.TWO_MINUTES,\n        },\n    },\n    [Item.longbow]: {\n        item: Item.longbow,\n        cost: {\n            resources: { wood: 40, iron: 5},\n            time: time.ONE_HOUR,\n        },\n    },\n    [Item.mace]: {\n        item: Item.mace,\n        cost: {\n            resources: { wood: 15, iron: 10},\n            time: time.ONE_HOUR,\n        },\n    },\n    [Item.morningStar]: {\n        item: Item.morningStar,\n        cost: {\n            resources: { wood: 15, iron: 15},\n            time: time.ONE_HOUR,\n        },\n    },\n    [Item.paintedBuckler]: {\n        item: Item.paintedBuckler,\n        cost: {\n            resources: { wood: 20, iron: 10},\n            time: time.ONE_HOUR + time.HALF_HOUR,\n        },\n    },\n    [Item.poisonedDagger]: {\n        item: Item.poisonedDagger,\n        cost: {\n            resources: { wood: 50, iron: 15},\n            materials: [ Item.poisonVial ],\n            time: time.ONE_HOUR,\n        },\n    },\n    [Item.ravenStaff]: {\n        item: Item.ravenStaff,\n        cost: {\n            resources: { wood: 15, iron: 10, food: 5},\n            time: time.ONE_HOUR,\n        },\n    },\n    [Item.savageStaff]: {\n        item: Item.savageStaff,\n        cost: {\n            resources: { wood: 15, iron: 10, food: 5},\n            time: time.ONE_HOUR,\n        },\n    },\n    [Item.spear]: {\n        item: Item.spear,\n        cost: {\n            resources: { wood: 15, iron: 15},\n            time: time.ONE_HOUR,\n        },\n    },\n    [Item.steelShield]: {\n        item: Item.steelShield,\n        cost: {\n            resources: { wood: 15, iron: 15},\n            time: time.ONE_HOUR,\n        },\n    },\n    [Item.sword]: {\n        item: Item.sword,\n        cost: {\n            resources: { wood: 10, iron: 30},\n            time:  time.ONE_HOUR,\n        },\n    },\n    [Item.warhammer]: {\n        item: Item.warhammer,\n        cost: {\n            resources: { wood: 10, iron: 30},\n            time:  time.ONE_HOUR,\n        },\n    },\n    [Item.woodenBulwark]: {\n        item: Item.woodenBulwark,\n        cost: {\n            resources: { wood: 10, iron: 30},\n            time:  time.ONE_HOUR,\n        },\n    },\n};\nexport default weaponsmithProduction;\n\nexport function getDefinition(item: Item) {\n    return weaponsmithProduction[item];\n}\n","// tslint:disable:object-literal-sort-keys\n\nimport * as time from \"utils/format/time\";\nimport {    Item} from \"../items/types\";\nimport {  ProductionDefinition } from \"./types\";\n\n// todo: real values for costs\nconst armoursmithProduction: { [key: string]: ProductionDefinition } = {\n    [Item.boots1]: {\n        item: Item.boots1,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        },\n    },\n    [Item.boots2]: {\n        item: Item.boots2,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        },\n        levelRequired: 2\n    },\n    [Item.boots3]: {\n        item: Item.boots3,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        },\n        levelRequired: 3\n    },\n    [Item.chainmailHood]: {\n        item: Item.chainmailHood,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    [Item.chest]: {\n        item: Item.chest,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    [Item.clothGloves]: {\n        item: Item.clothGloves,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        },\n    },\n    [Item.cowl]: {\n        item: Item.cowl,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    [Item.druidChest]: {\n        item: Item.druidHands,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        },\n        levelRequired: 2\n    },\n    [Item.druidFeet]: {\n        item: Item.druidFeet,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        },\n        levelRequired: 2\n    },\n    [Item.druidHands]: {\n        item: Item.druidHands,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        },\n        levelRequired: 2\n    },\n    [Item.druidHead]: {\n        item: Item.druidHead,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        },\n        levelRequired: 2\n    },\n    [Item.druidLegs]: {\n        item: Item.druidLegs,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        },\n        levelRequired: 2\n    },\n    [Item.fedora]: {\n        item: Item.fedora,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    [Item.greaves1]: {\n        item: Item.greaves1,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    [Item.greaves2]: {\n        item: Item.greaves2,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    [Item.hornedHelmet]: {\n        item: Item.hornedHelmet,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    [Item.leatherGloves]: {\n        item: Item.leatherGloves,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    [Item.nomadHelmet]: {\n        item: Item.nomadHelmet,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    [Item.pants1]: {\n        item: Item.pants1,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    [Item.pants2]: {\n        item: Item.pants2,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    [Item.plateChest1]: {\n        item: Item.plateChest1,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    [Item.plateChest2]: {\n        item: Item.plateChest2,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    [Item.plateChest3]: {\n        item: Item.plateChest3,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    [Item.plateChest4]: {\n        item: Item.plateChest4,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    [Item.plateGloves1]: {\n        item: Item.plateGloves1,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    [Item.plateGloves2]: {\n        item: Item.plateGloves2,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    [Item.plateHelmet]: {\n        item: Item.plateHelmet,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    [Item.platePants]: {\n        item: Item.platePants,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    [Item.plateShoulders1]: {\n        item: Item.plateShoulders1,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    [Item.plateShoulders2]: {\n        item: Item.plateShoulders2,\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        },\n    },\n    [Item.robe]: {\n        item: Item.robe,\n        cost: {\n            resources: { wood: 10, iron: 45},\n            time: time.ONE_HOUR,\n        }\n    },\n    [Item.shoulders1]: {\n        item: Item.shoulders1,\n        cost: {\n            resources: { wood: 10, iron: 45},\n            time: time.ONE_HOUR,\n        }\n\n    },\n    [Item.shoulders2]: {\n        item: Item.shoulders2,\n        cost: {\n            resources: { wood: 10, iron: 45},\n            time: time.ONE_HOUR,\n        }\n\n    },\n    [Item.shoulders3]: {\n        item: Item.shoulders3,\n        cost: {\n            resources: { wood: 10, iron: 45},\n            time: time.ONE_HOUR,\n        }\n\n    },\n    [Item.vest]: {\n        item: Item.vest,\n        cost: {\n            resources: { wood: 10, iron: 45},\n            time: time.ONE_HOUR,\n        }\n    },\n};\nexport default armoursmithProduction;\n","import React, { useEffect, useRef, useState } from 'react';\nimport './style/tooltip.scss';\nimport { TooltipManager } from 'global/TooltipManager';\n\nconst ARROW_SIZE = 8; // warning: sync to tooltip.css var\nconst PADDING = 8;\n\nexport interface Props {\n    referenceRect: ClientRect;  // place tooltip in reference to this rect\n    placement?: Placement;\n    children?: any;\n}\n\nexport enum Placement {\n    bottom,\n    top,\n    left,\n    right,\n}\n\nexport const Tooltip = (props: Props) => {\n    const { children, referenceRect } = props;\n    const ref = useRef<HTMLDivElement>(null);\n    const [placement, setPlacement] = useState<Placement>(props.placement || Placement.bottom);\n\n    const [containerRect, setContainerRect] = useState<ClientRect>(); // This is the\n\n    useEffect(() => {\n        // Reposition if needed\n        const tooltipElement = ref.current;\n        if (!tooltipElement) return;\n        if (!containerRect) return;\n        const tooltipRect = tooltipElement.getBoundingClientRect();\n\n        // Flip vertically\n        switch (placement) {\n            case Placement.top:\n                if (tooltipRect.top - tooltipRect.height - ARROW_SIZE - PADDING < containerRect!.top) {\n                    // Too high, place underneath\n                    setPlacement(Placement.bottom);\n                    return;\n                }\n                break;\n            case Placement.bottom:\n                if (tooltipRect.top + tooltipRect.height + ARROW_SIZE + PADDING > containerRect!.height) {\n                    // Too low, place top\n                    setPlacement(Placement.top);\n                    return;\n                }\n                break;\n        }\n        tooltipElement.style.opacity = \"1\"; // animated through css\n\n        const contentElement = tooltipElement.querySelector(\".tooltip-content\") as HTMLElement;\n        if (tooltipRect.left < containerRect!.left + PADDING) {\n            // Check left bounding edge\n            const offset = containerRect!.left - tooltipRect.left + PADDING;\n            contentElement.style.transform = `translateX(${offset}px)`;\n        } else if (tooltipRect.right > containerRect!.right - PADDING) {\n            // Check right bounding edge\n            const offset = tooltipRect.right - containerRect!.right + PADDING;\n            contentElement.style.transform = `translateX(${-offset}px)`;\n        } else {\n            contentElement.style.transform = '';\n        }\n\n    }, [setPlacement, containerRect, placement, referenceRect]);\n\n    const resize = () => {\n        TooltipManager.clear();\n    }\n\n    useEffect(() => {\n        setContainerRect(ref.current?.closest('.app')?.getBoundingClientRect());\n\n        window.addEventListener(\"resize\", resize);\n        return () => {\n            window.removeEventListener(\"resize\", resize);\n        };\n    }, []);\n\n\n    let x: number = 0;\n    let y: number = 0;\n    let className: string = \"\";\n\n    if (containerRect) {\n        switch (placement) {\n            case Placement.bottom:\n                x = referenceRect.left - containerRect!.left + referenceRect.width / 2;\n                y = referenceRect.top - containerRect!.top + referenceRect.height;\n                className = \"tooltip-bottom\";\n                break;\n            case Placement.top:\n                x = referenceRect.left - containerRect!.left + referenceRect.width / 2;\n                y = referenceRect.top - containerRect!.top;\n                className = \"tooltip-top\";\n                break;\n        }\n    }\n\n    return (\n        <div className={`tooltip ${className}`}\n            style={{\n                left: x,\n                opacity: 0,\n                top: y,\n            }}\n            ref={ref}\n        >\n            <div className=\"tooltip-arrow\" />\n            <div className=\"tooltip-content\">\n                {children}\n            </div>\n        </div>\n    );\n}\n\nexport default Tooltip;\n","// tslint:disable:object-literal-sort-keys\n\nimport * as time from \"utils/format/time\";\nimport { Item } from \"../items/types\";\nimport { ProductionDefinition } from \"./types\";\n\n\nconst workshopProduction: {[key: string]: ProductionDefinition} = {\n    [Item.torch]: {\n        item: Item.torch,\n        cost: {\n            resources: { wood: 2, fabric: 1 },\n            time: time.ONE_MINUTE,\n        },\n    },\n    [Item.sandwich]: {\n        item: Item.sandwich,\n        cost: {\n            resources: { food: 1 },\n            time: time.ONE_MINUTE / 2,\n        },\n    }\n};\nexport default workshopProduction;\n\n","// tslint:disable:object-literal-sort-keys\n\n// import * as time from \"utils/time\";\n// import { Item } from \"../items/types\";\nimport { ProductionDefinition } from \"./types\";\n\nconst alchemistProduction: {[key: string]: ProductionDefinition} = {\n};\nexport default alchemistProduction;\n\n","import weaponsmithProduction from './weaponsmith'\nimport armoursmithProduction from './armoursmith'\nimport { Structure } from 'definitions/structures';\nimport { Item } from 'definitions/items/types';\nimport { ProductionDefinition } from './types';\nimport workshopProduction from './workshop';\nimport alchemistProduction from './alchemist';\n\n// Returns the structure that produces given Item, or null if this Item is not produced anywhere\nexport const getProductionStructureForItem = (item: Item): Structure | null => {\n    if (alchemistProduction[item]){\n        return Structure.alchemist;\n    }\n    if (armoursmithProduction[item]){\n        return Structure.armoursmith;\n    }\n    if (weaponsmithProduction[item]){\n        return Structure.weaponsmith;\n    }\n    if (workshopProduction[item]){\n        return Structure.workshop;\n    }\n    return null;\n}\n\n\nconst all = {\n    ...alchemistProduction,\n    ...armoursmithProduction,\n    ...weaponsmithProduction,\n    ...workshopProduction\n};\n\nexport const getDefinition = (item: Item): ProductionDefinition => {\n    return all[item];\n}\n\n\n","import { createSelector } from \"reselect\";\nimport { StoreState } from \"stores\";\nimport { TasksStoreState } from 'stores/tasks';\nimport { Structure } from 'definitions/structures';\n\nconst getTasks = (state: StoreState) => state.tasks;\n\n\n/** Returns a selector for the store that selects all crafting tasks running for given structure */\nexport const createSelectCraftingTasksByStructure = (structure: Structure) => {\n    const craftingTasksByStructure = (tasks: TasksStoreState) => {\n        return tasks.running.filter((val) => val.origin === `${structure}.craft`);\n    };\n    return createSelector([\n        getTasks],\n        craftingTasksByStructure,\n    );\n}\n/** Returns a selector for the store that selects all study tasks running for given structure */\nexport const createSelectStudyingTasksByStructure = (structure: Structure) => {\n    const studyingTasksByStructure = (tasks: TasksStoreState) => {\n        return tasks.running.filter((val) => val.origin === `${structure}.study`);\n    };\n    return createSelector([\n        getTasks],\n        studyingTasksByStructure,\n    );\n}\n","import { StoreState } from 'stores';\nimport { useSelector } from 'react-redux';\nimport { TasksStoreState } from 'stores/tasks';\nimport { createSelectCraftingTasksByStructure, createSelectStudyingTasksByStructure } from 'selectors/tasks';\nimport { Structure } from 'definitions/structures';\n\n// Returns all the tasks from redux store\nexport const useTasksState = () => {\n    return useSelector<StoreState, TasksStoreState>(store => store.tasks);\n}\n\n// Returns all running crafting tasks for given structure\nexport const useCraftingTasksStateByStructure = (structure: Structure) => {\n    return useSelector(createSelectCraftingTasksByStructure(structure));\n}\n\n// Returns all running crafting tasks for given structure\nexport const useStudyingTasksStateByStructure = (structure: Structure) => {\n    return useSelector(createSelectStudyingTasksByStructure(structure));\n}\n\n","import * as time from \"utils/format/time\";\n\nexport const STUDY_TIME = time.TWO_MINUTES;","import * as React from \"react\";\nimport { Item } from 'definitions/items/types';\nimport { getDefinition as getProductionDefinition, getProductionStructureForItem } from 'definitions/production';\nimport useStructureState from 'hooks/store/useStructureState';\nimport { Structure } from 'definitions/structures';\nimport { ProductionStructureStoreState, StructureState } from 'stores/structure';\nimport { getDefinition as getItemDefinition } from 'definitions/items';\nimport { Link } from 'react-router-dom';\nimport { getStructureLink } from 'utils/routing';\nimport { TextManager } from 'global/TextManager';\nimport { useStudyingTasksStateByStructure } from 'hooks/store/useTasksState';\nimport { startTask } from 'actions/tasks';\nimport { TaskType } from 'stores/task';\nimport { useDispatch } from 'react-redux';\nimport { addItemToToProduces } from 'actions/structures';\nimport { formatDuration } from 'utils/format/time';\nimport { STUDY_TIME } from 'mechanics/studying';\nimport Button from 'components/ui/buttons/Button';\n\ninterface Props {\n    item: Item;\n}\n\nconst ProduceOrStudy = (props: Props) => {\n    const structure = getProductionStructureForItem(props.item);\n    const itemDefinition = getItemDefinition(props.item);\n    if (itemDefinition.unique) {\n        return (\n            <p>Unique item</p>\n        )\n    }\n    if (!structure) {\n        return null;\n    }\n    return (\n        <ProducedAtStructure item={props.item} structure={structure} />\n    )\n}\n\nconst ProducedAtStructure = (props: Props & { structure: Structure}) => {\n    const {structure} = props;\n    const structureStore: ProductionStructureStoreState = useStructureState(structure);\n    const studyTasks = useStudyingTasksStateByStructure(structure);\n    const dispatch = useDispatch();\n\n    if (!structure) {\n        return null;\n    }\n\n    // const structureDefinition = getStructureDefinition<ProductionStructureDefinition>(structure);\n    // Can already be produced\n    if (structureStore.produces.some((item: Item) => item === props.item)){\n        return (\n            <p>Constructed at:&nbsp;\n                <Link to={getStructureLink(structure)} >\n                    { TextManager.getStructureName(structure) }\n                </Link>\n            </p>\n        )\n    }\n\n    // Currently studied\n    const task = studyTasks.find(sT => sT.name === props.item);\n    if (task) {\n        return (\n            <p>\n                <Link to={getStructureLink(structure)} >\n                    {TextManager.get(\"ui-tooltip-study-currently-studying\")}\n                </Link>\n                {formatDuration(task.timeRemaining, true)}\n            </p>\n        )\n    }\n\n    // Cant study because the structure is not high lvl enough\n    const productionDefinition = getProductionDefinition(props.item);\n    if (structureStore.level < (productionDefinition.levelRequired || 0) || structureStore.state !== StructureState.Built) {\n\n        return (\n            <p className=\"invalid\">\n                {TextManager.get(\"ui-tooltip-study-requires-structure-level\", { structure, level: (productionDefinition.levelRequired || 0) + 1})}\n            </p>\n        )\n    }\n\n    const startStudy = () => {\n        const callbacks = [\n            addItemToToProduces(props.structure, props.item)\n        ];\n\n        const studyTime = STUDY_TIME;\n        const start = startTask(TaskType.studyItem,\n            props.item,\n            `${structure}.study`,\n            studyTime,\n            callbacks);\n        dispatch(start);\n    }\n\n    return (\n        <p>\n            <Button onClick={startStudy} size=\"small\">\n                {TextManager.get(\"ui-tooltip-study-start-study\")}\n            </Button>\n        </p>\n    );\n}\n\nexport default ProduceOrStudy;","import * as React from \"react\";\nimport { WeaponDefinition, DamageType, typeClassifications, WeaponType } from 'definitions/items/weapons';\nimport { TextManager } from 'global/TextManager';\nimport ProduceOrStudy from './ProduceOrStudy';\n\ninterface Props {\n    info: WeaponDefinition;\n}\n\nconst WeaponContent = (props: Props) => {\n    const { info } = props;\n    const subtext = TextManager.getItemSubtext(info.item);\n    const weaponType = TextManager.getWeaponType(info.weaponType);\n    const classification = TextManager.getWeaponClassification(typeClassifications[info.weaponType])\n\n    return (\n        <>\n            <div>{weaponType}\n              {info.weaponType !== WeaponType.shield && (` (${classification})`)}\n            </div>\n            { subtext && (<p className=\"subtext\">\"{subtext}\"</p>)}\n            { info.damage && <p> damage: { info.damage[DamageType.kinetic] } </p>}\n            <ProduceOrStudy item={info.item} />\n        </>\n    );\n\n}\n\nexport default WeaponContent;","import * as React from \"react\";\nimport { TextManager } from 'global/TextManager';\nimport { ApparelDefinition } from 'definitions/items/apparel';\nimport ProduceOrStudy from './ProduceOrStudy';\n\ninterface Props {\n    info: ApparelDefinition;\n}\n\nconst ApparelContent = (props: Props) => {\n    const { info } = props;\n    const { damageReduction } = info;\n    const subtext = TextManager.getItemSubtext(info.item);\n    const equipmentSlot = TextManager.getEquipmentSlot(info.equipmentType);\n    return (\n        <>\n            <div>{`${equipmentSlot}`}</div>\n            { subtext && (<p className=\"subtext\">\"{subtext}\"</p>)}\n            { damageReduction && <p> { TextManager.get(\"ui-tooltip-damage-reduction\", { damageReduction}) } </p> }\n            <ProduceOrStudy item={info.item} />\n        </>\n    );\n};\n\nexport default ApparelContent;","import * as React from \"react\";\nimport { ApparelDefinition } from \"definitions/items/apparel\";\nimport { DeedDefinition } from \"definitions/items/deeds\";\nimport { ItemDefinition, ItemType } from \"definitions/items/types\";\nimport { WeaponDefinition } from \"definitions/items/weapons\";\nimport DeedContent from './DeedContent';\nimport WeaponContent from './WeaponContent';\nimport ApparelContent from './ApparelContent';\nimport { TextManager } from 'global/TextManager';\nimport \"./styles/itemContext.scss\";\n\nexport interface Props {\n    info: ItemDefinition;\n}\n\nconst ItemContext = (props: Props) => {\n\n    const info = props.info;\n    switch (info.itemType) {\n        case ItemType.deed:\n           return <DeedContent info={info as DeedDefinition} />;\n\n        case ItemType.weapon:\n            return <WeaponContent info={info as WeaponDefinition} />;\n\n        case ItemType.apparel:\n            return <ApparelContent info={info as ApparelDefinition} />;\n\n        default:\n            const subtext = TextManager.getItemSubtext(info.item);\n            return (subtext && (<p className=\"subtext\">\"{subtext}\"</p>)) || null;\n    }\n}\nexport default ItemContext;","import * as React from \"react\";\nimport { TextManager } from 'global/TextManager';\nimport { useSelector } from 'react-redux';\nimport { StoreState } from 'stores';\nimport { StructuresStoreState } from 'stores/structures';\nimport { Resource } from 'definitions/resources';\nimport { getStructureByResource, getDefinition } from 'definitions/structures';\nimport { StructureState, StructureStoreState } from 'stores/structure';\nimport { getStructureLink } from 'utils/routing';\nimport { Link } from 'react-router-dom';\nimport { ResourceStructureLevelDefinition, ResourceStructureDefinition } from 'definitions/structures/types';\nimport useResourcesState from 'hooks/store/useResourcesState';\nimport { formatNumber } from 'utils/format/number';\nimport useGoldState from 'hooks/store/useGoldState';\nimport { useWorkersFreeState, useWorkersState } from 'hooks/store/useWorkersState';\nimport './resourceContext.scss';\n\nexport interface Props {\n    info: string;\n}\n\nconst ResourceContext = (props: Props) => {\n\n    const resource = props.info;\n    const resourcesState = useResourcesState();\n    const goldState = useGoldState();\n    const workersState = useWorkersState();\n    const workersFreeState = useWorkersFreeState();\n    const structureStates = useSelector<StoreState, StructuresStoreState>(store => store.structures);\n\n    const renderProducedBy = () => {\n        const structure = getStructureByResource(Resource[resource]);\n        const structureState: StructureStoreState = structureStates[structure];\n        if (structureState.state !== StructureState.Built) {\n            return (\n                <span>\n                    {TextManager.get(\"ui-tooltip-resource-produce-row-notbuilt\", {\n                        structure: TextManager.getStructureName(structure)\n                    })}\n                </span>\n            )\n        }\n        const structureDefinition = getDefinition<ResourceStructureDefinition>(structure);\n        const levelDefinition: ResourceStructureLevelDefinition = structureDefinition.levels[structureState.level];\n        const amount = levelDefinition.generates[resource];\n        // Split the string at {{structure}}\n        const split = TextManager.get(\"ui-tooltip-resource-produce-row\", {\n            structure: \"%SPLIT%\",\n            amount\n        }).split(\"%SPLIT%\");\n        return (\n            <span className=\"produced\">\n                {split[0]}\n                <Link to={getStructureLink(structure)} >\n                    { TextManager.getStructureName(structure) }\n                </Link>\n                {split[1]}\n            </span>\n        )\n    }\n\n    switch (resource) {\n        case Resource.fabric:\n        case Resource.food:\n        case Resource.iron:\n        case Resource.leather:\n        case Resource.stone:\n        case Resource.wood: {\n            const amount = formatNumber(resourcesState[resource]!, 0);\n\n            return (\n                <>\n                    <div className=\"resource-context\">\n                        {TextManager.get(`resource-${resource}-info`)}\n                    </div>\n                    <div>\n                        {TextManager.get(`ui-tooltip-resource-quantity`, { amount } )}\n                    </div>\n                    <div>\n                        {renderProducedBy()}\n                    </div>\n                </>\n            )\n        }\n        case \"gold\": {\n            const amount = goldState;\n            return (\n                <>\n                    <div className=\"resource-context\">\n                        {` ${TextManager.get(`resource-${resource}-info`)}`}\n                    </div>\n                    <div>\n                        {TextManager.get(`ui-tooltip-resource-quantity`, { amount } )}\n                    </div>\n                </>\n            )\n        }\n        case \"workers\": {\n            const free = workersFreeState;\n            const total = workersState;\n            return (\n                <>\n                    <div className=\"resource-context\">\n                        {` ${TextManager.get(`resource-${resource}-info`)}`}\n                    </div>\n                    <div>\n                        {TextManager.get(`ui-tooltip-workers-quantity`, { free, total } )}\n                    </div>\n                </>\n            )\n        }\n        default:\n            throw new Error(\"Uknow value \" + resource);\n    }\n\n}\nexport default ResourceContext;","import * as React from \"react\";\nimport { TextManager } from 'global/TextManager';\nimport { TraitDefinition } from 'definitions/traits/types';\n import './styles/traitContext.scss';\n\nexport interface Props {\n    traitDefinition: TraitDefinition;\n}\n\nconst TraitContext = (props: Props) => {\n\n    const {traitDefinition} = props;\n\n    return (\n        <div className=\"trait-context\">\n            <div className=\"description\">\n                {TextManager.getTraitDescription(traitDefinition.trait)}\n            </div>\n            { traitDefinition.hasEffect && (\n            <div className=\"effect\">\n                {TextManager.getTraitEffect(traitDefinition.trait)}\n\n            </div>)}\n        </div>\n    )\n}\nexport default TraitContext;","import React, { useEffect, useState } from 'react';\nimport { ContextType } from 'constants/context';\nimport { TooltipManager, Context } from 'global/TooltipManager';\nimport { TextManager } from 'global/TextManager';\nimport ItemContext from '../context/ItemContext';\nimport { ItemDefinition } from 'definitions/items/types';\nimport { Resource } from 'definitions/resources';\nimport ResourceContext from '../context/ResourceContext';\nimport './styles/contextTooltip.scss';\nimport Tooltip from '../Tooltip';\nimport { TraitDefinition } from 'definitions/traits/types';\nimport TraitContext from '../context/TraitContext';\nimport { getItemNameClassName } from 'constants/items';\nimport { WeaponType } from 'definitions/items/weapons';\n\n\n// A contextual popup showing what you just clicked. Can be an Item\nconst ContextTooltip = () => {\n\n    const [selectedContext, setSelectedContext] = useState<Context | undefined>();\n\n    const tooltipUpdated = (context: Context | undefined) => {\n        setSelectedContext(context);\n    }\n\n    useEffect(() => {\n        TooltipManager.addEventListener(TooltipManager.EVENT_CONTEXT_UPDATED, tooltipUpdated);\n        return () => {\n            TooltipManager.removeEventListener(TooltipManager.EVENT_CONTEXT_UPDATED, tooltipUpdated);\n        }\n    }, []);\n    if (!selectedContext) { return null; }\n\n    const { info, type } = selectedContext;\n    const renderContent = () => {\n        switch (type) {\n            case ContextType.resource: {\n                const name = TextManager.getResourceName(info as Resource);\n                return (\n                    <>\n                        <div className=\"name resource\">{name}</div>\n                        <ResourceContext info={info as string} />\n                    </>\n                );\n            }\n            case ContextType.item: {\n                const name = TextManager.getItemName((info as ItemDefinition).item);\n                const itemDefinition = info as ItemDefinition;\n                const className = `name item ${getItemNameClassName(itemDefinition)}`\n                return (\n                    <>\n                        <div className={`${className}`}>{name}</div>\n                        <ItemContext info={itemDefinition} />\n                    </>\n                );\n            }\n            case ContextType.trait: {\n                const traitDefinition = info as TraitDefinition;\n                const name = TextManager.getTraitName(traitDefinition.trait);\n                return (\n                    <>\n                        <div className=\"name trait\">\n                            {TextManager.get(\"ui-tooltip-type-trait\")}\n                            {name}\n                        </div>\n                        <TraitContext traitDefinition={traitDefinition} />\n                    </>\n                );\n            }\n            case ContextType.skill: {\n                const skill = info as WeaponType;\n                const name = TextManager.getSkillName(skill);\n                return (\n                    <>\n                        <div className=\"name skill\">\n                            {TextManager.get(\"ui-tooltip-type-skill\")}\n                            {name}\n                        </div>\n                        { TextManager.getSkillInfo(skill)}\n                    </>\n                );\n            }\n            default: {\n                throw new Error(`Unknown context type ${selectedContext.type}`)\n            }\n        }\n    }\n\n    return (\n        <Tooltip referenceRect={selectedContext.referenceRect}>\n            <div className = \"context-tooltip\">\n                {renderContent()}\n            </div>\n        </Tooltip>\n    )\n}\nexport default ContextTooltip;\n","import * as React from \"react\";\nimport \"./background.css\";\nimport { useEffect, useRef } from 'react';\nimport * as PIXI from \"pixi.js\";\nimport { Stage, Sprite, useTick } from '@inlet/react-pixi';\n\nconst Background = () => {\n\n    const ref = useRef();\n\n    const filter = useRef(new PIXI.Filter('', fragmentSrc, uniforms));\n    useEffect(() => {\n\n        // filter.current!.syncUniforms();\n        function update(timestamp: number) {\n            filter.current!.uniforms.time = (timestamp || 0) / 1000;\n            requestAnimationFrame(update);\n        }\n\n        requestAnimationFrame(update);\n    },[]);\n\n    return null;\n    // return (\n    //     <Stage width={window.innerWidth} height={window.innerHeight} className=\"background\">\n    //         <Sprite\n    //             image={'https://s3-us-west-2.amazonaws.com/s.cdpn.io/167451/test_BG.jpg'}\n    //             width={window.innerWidth}\n    //             height={window.innerHeight}\n    //             // filters={[filter.current]}\n    //         />\n    //     </Stage>\n    // )\n}\nexport default Background;\n\n\nconst uniforms = {\n    resolution: {\n        type: '2f',\n        value: {\n        x: window.innerWidth,\n        y: window.innerHeight,\n        },\n    },\n    alpha: {\n        type: '1f',\n        value: 1,\n    },\n    shift: {\n        type: '1f',\n        value: 1.6,\n    },\n    time: {\n        type: '1f',\n        value: 0,\n    },\n    speed: {\n        type: '2f',\n        value: {\n        x: 0.7,\n        y: 0.4,\n        },\n    },\n};\n\nconst fragmentSrc = `\n    precision mediump float;\n    uniform vec2      resolution;\n    uniform float     time;\n    uniform float     alpha;\n    uniform vec2      speed;\n    uniform float     shift;\n\n    float rand(vec2 n) {\n        return fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\n    }\n\n    float noise(vec2 n) {\n    const vec2 d = vec2(0.0, 1.0);\n    vec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\n        return mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\n    }\n\n    float fbm(vec2 n) {\n    float total = 0.0, amplitude = 1.0;\n    for (int i = 0; i < 4; i++) {\n        total += noise(n) * amplitude;\n        n += n;\n        amplitude *= 0.5;\n    }\n\n    return total;\n    }\n\n    void main() {\n    const vec3 c1 = vec3(126.0/255.0, 0.0/255.0, 97.0/255.0);\n    const vec3 c2 = vec3(173.0/255.0, 0.0/255.0, 161.4/255.0);\n    const vec3 c3 = vec3(0.2, 0.0, 0.0);\n    const vec3 c4 = vec3(164.0/255.0, 1.0/255.0, 214.4/255.0);\n    const vec3 c5 = vec3(0.1);\n    const vec3 c6 = vec3(0.9);\n\n    vec2 p = gl_FragCoord.xy * 8.0 / resolution.xx;\n    float q = fbm(p - time * 0.1);\n    vec2 r = vec2(fbm(p + q + time * speed.x - p.x - p.y), fbm(p + q - time * speed.y));\n    vec3 c = mix(c1, c2, fbm(p + r)) + mix(c3, c4, r.x) - mix(c5, c6, r.y);\n    float grad = gl_FragCoord.y / resolution.y;\n    gl_FragColor = vec4(c * cos(shift * gl_FragCoord.y / resolution.y), 1.0);\n    gl_FragColor.xyz *= 1.0-grad;\n    }\n`;","\nexport const manifest = [\n    \"sound/fx/button-click.ogg\",\n    \"sound/fx/error.ogg\",\n    \"sound/fx/toast.ogg\",\n    \"sound/music/Soliloquy.mp3\",\n    \"sound/music/TheLoomingBattle.ogg\",\n];\n","export const MAX_WORKERS_CRAFTING = 6;\n\n/**\n * Calculates the production time for productionDefinition with given amount of workers\n * @param productionDefinition\n * @param workers\n */\nexport const calculateProductionTime = (time: number, workers: number): number => {\n    if (workers > MAX_WORKERS_CRAFTING) {\n        throw new Error(`Cannot possibly have more than ${MAX_WORKERS_CRAFTING} on one item!`);\n    }\n    // Each additional worker shaves off 10% of the production time\n    return time - (.1 * time * (workers - 1));\n};\n","// Todo: come up with a less retarded name\nimport * as React from \"react\";\nimport \"./css/updownvalue.css\";\n\nexport interface DispatchProps {\n    onUp?: (e: React.MouseEvent) => void;\n    onDown?: (e: React.MouseEvent) => void;\n}\nexport interface Props extends DispatchProps {\n    label?: string;\n    value?: number;\n    max?: number;\n    upDisabled?: boolean;\n    downDisabled?: boolean;\n}\n\nconst UpDownValue = (props: Props) => {\n    const handleUp = (e: React.MouseEvent) => {\n        if (props.onUp && !props.upDisabled) { props.onUp(e); }\n    };\n\n    const handleDown = (e: React.MouseEvent) => {\n        if (props.onDown && !props.downDisabled) { props.onDown(e); }\n    };\n\n    let displayValue;\n    if (props.max == null) {\n        displayValue = props.value;\n    } else {\n        displayValue = <span>\n            { props.value } / <span className=\"max\">{ props.max }</span>\n        </span>;\n    }\n    return (\n        <div className=\"updownvalue\">\n            <label> { props.label }</label>\n            { displayValue }\n            <i className= { \"arrow up\" + (props.upDisabled ? \" disabled\" : \"\" )}\n                onClick= { handleUp }\n            />\n            <i className={\"arrow down\" + (props.downDisabled ? \" disabled\" : \"\")}\n                onClick= { handleDown }\n            />\n        </div>\n    );\n};\n\nexport default UpDownValue;\n","import React from \"react\";\nimport { Structure } from 'definitions/structures';\nimport \"./styles/structureViewHeader.scss\";\n\ninterface Props {\n    structure: Structure;\n}\n\nconst StructureViewHeader = (props: Props) => {\n    // const displayName = TextManager.getStructureName(props.structure);\n    return (\n        <div className={`structureview-header structureview-header-${props.structure}`}>\n            {/* <h1 className=\"app-h1-white\">{displayName}</h1> */}\n        </div>\n    );\n}\n\nexport default StructureViewHeader;","import { Resource } from \"definitions/resources\";\nimport resourceDescriptions from \"definitions/resources\";\nimport * as React from \"react\";\nimport { ResourceStoreState } from \"stores/resources\";\nimport { TextManager } from \"global/TextManager\";\nimport \"./css/resourcesbox.css\";\nimport { useMemo } from 'react';\nimport useResources from 'hooks/store/useResourcesState';\n\nexport interface Props {\n    className?: string;\n    resources: ResourceStoreState;\n}\n\nexport interface StateProps {\n    sufficientResources?: Record<Resource, boolean>;\n}\n\ntype AllProps = Props & StateProps;\n\n/**\n * The ResourcesBox displays a list of resources\n */\nconst ResourcesCostBox = (props: AllProps) => {\n    const {\n        resources,\n    } = props;\n\n    const storeResources = useResources();\n    const sufficientResources = useMemo(() => {\n        return Object.keys(resources).reduce((acc, value) => {\n            acc[value] = storeResources[value] >= resources[value];\n            return acc;\n        }, {});\n    }, [resources, storeResources]);\n\n\n    const className = (props.className || \"\") + \" resourcesbox\";\n    const listItems = Object.keys(props.resources).map((resource: string) => {\n        let listItemClass = \"resource\";\n        if (sufficientResources && !sufficientResources[resource]) {\n             listItemClass += \" insufficient\";\n        }\n        const resourceDescription = resourceDescriptions[resource];\n        if (!resourceDescription) {\n            throw new Error(`No resource description found for ${resource}`);\n        }\n\n        return <li className = { listItemClass } key = { resource }>\n            <div\n                className=\"icon\"\n                style={{backgroundImage: `url(${process.env.PUBLIC_URL}${resourceDescription.iconImg})`}}\n            />\n            <div className=\"name\">\n                {TextManager.getResourceName(resource as Resource)}\n            </div>\n            <div className=\"amount\" >\n                { props.resources[resource] }\n            </div>\n        </li>;\n    });\n\n    return (\n        <ul className={className}>\n            {listItems}\n        </ul>\n    );\n};\n\nexport default ResourcesCostBox;\n","import itemsDescription from \"definitions/items\";\nimport { Item } from \"definitions/items/types\";\nimport * as React from \"react\";\nimport { TextManager } from \"global/TextManager\";\nimport useStockpileState from 'hooks/store/useStockpileState';\nimport { useMemo } from 'react';\nimport { getClassName, IconSize } from 'constants/icons';\nimport \"components/ui/styles/icon.scss\";\nimport \"./styles/itemsBox.scss\";\n\nexport interface Props {\n    className?: string;\n    items: Item[];\n\n   // itemsInInventory?: Item[]; // Items that are in `items` array and also in inventory\n}\n\n\n/**\n * The ItemsBox displays a list of items, to be used as requirements for something\n */\nconst ItemsBox = (props: Props) => {\n    const { items } = props;\n    const className = (props.className || \"\") + \" items-box\";\n    const aggregate = items.reduce((accumulator: object, current: Item) => {\n        if (!accumulator[current]) {\n            accumulator[current] = 0;\n        }\n        accumulator[current]++;\n        return accumulator;\n    }, {});\n\n    const stockpile = useStockpileState();\n    const itemsInInventory: Item[] = useMemo(() => {\n        const tmpWarehouse = [ ...stockpile];\n        const tmpItems: Item[] = [];\n        items.forEach((item: Item) => {\n            const found = tmpWarehouse.findIndex((i) => i === item);\n            if (found > -1) {\n                // Remove the item from tmpWarehouse and add to itemsInInventory\n                const [ removed ] = tmpWarehouse.splice(found, 1);\n                if (removed) {\n                    tmpItems.push(removed);\n                }\n            }\n        });\n        return tmpItems;\n    }, [items, stockpile]);\n\n\n    const listItems = Object.keys(aggregate).map((key: string) => {\n        const item = key as Item;\n        const amount = aggregate[key] as number;\n        let listItemClass = \"item\";\n\n        // Check if we have enough\n        const amountInInventory = itemsInInventory ? itemsInInventory.filter((i) => i === item).length : 0;\n        if (amount > amountInInventory) {\n            listItemClass += \" missing\";\n        }\n        const itemDescription = itemsDescription[item];\n        return <li className={listItemClass} key={item}>\n            <div\n                className={`icon ${getClassName(IconSize.smallest)}`}\n                style={{ backgroundImage: `url(${process.env.PUBLIC_URL}${itemDescription.iconImg})`}}\n            />\n            <div className=\"name\">\n                { `${TextManager.getItemName(item)} (${ amount })` }\n            </div>\n        </li>;\n    });\n\n    return (\n        <ul className={className} >\n            {listItems}\n        </ul>\n    );\n};\n\nexport default ItemsBox;\n","import * as React from \"react\";\nimport { useState } from 'react';\nimport { Item } from \"definitions/items/types\";\nimport { ProductionDefinition } from \"definitions/production/types\";\nimport { getDefinition, Structure } from \"definitions/structures\";\nimport { getDefinition as getProductionDefinition } from \"definitions/production\";\nimport { ProductionStructureDefinition } from \"definitions/structures/types\";\nimport { calculateProductionTime, MAX_WORKERS_CRAFTING } from \"mechanics/crafting\";\nimport { TextManager } from \"global/TextManager\";\nimport { formatDuration } from \"utils/format/time\";\nimport ItemIcon from \"../ui/ItemIcon\";\nimport Progressbar from \"../ui/Progressbar\";\nimport UpDownValue from \"../ui/UpDownValue\";\nimport StructureViewHeader from './StructureViewHeader';\nimport ResourcesCostBox from 'components/ui/resources/ResourcesCostBox';\nimport { ProductionStructureStoreState } from 'stores/structure';\nimport useGoldState from 'hooks/store/useGoldState';\nimport useStructureState from 'hooks/store/useStructureState';\nimport useResourcesState from 'hooks/store/useResourcesState';\nimport useStockpileState from 'hooks/store/useStockpileState';\nimport { useWorkersFreeState } from 'hooks/store/useWorkersState';\nimport { useCraftingTasksStateByStructure, useStudyingTasksStateByStructure } from 'hooks/store/useTasksState';\nimport { removeResources } from 'actions/resources';\nimport { increaseWorkers, upgradeStructure } from 'actions/structures';\nimport { addItemToWarehouse } from 'actions/items';\nimport { TaskType } from 'stores/task';\nimport { startTask } from 'actions/tasks';\nimport { useDispatch } from 'react-redux';\nimport { subtractGold } from 'actions/gold';\nimport { addLogText } from 'actions/log';\nimport { LogChannel } from 'stores/logEntry';\nimport \"./styles/productionStructureView.scss\";\nimport Button from 'components/ui/buttons/Button';\nimport ItemsBox from 'components/ui/items/ItemsBox';\n\nexport interface Props {\n    structure: Structure;\n}\n\nconst ProductionStructureView = (props: Props) => {\n    const {structure} = props;\n    const [selectedItem, setSelectedItem] = useState<Item>();\n    const [workersAssigned, setWorkersAssigned] = useState<number>(0);\n\n    const dispatch = useDispatch();\n    const gold = useGoldState();\n    const structureState = useStructureState(structure) as ProductionStructureStoreState;\n    const resourcesState = useResourcesState();\n    const stockpileState = useStockpileState();\n    const workersFree = useWorkersFreeState();\n    const craftingTasks = useCraftingTasksStateByStructure(structure);\n    const studyingTasks = useStudyingTasksStateByStructure(structure);\n\n    const structureDefinition = getDefinition<ProductionStructureDefinition>(props.structure);\n    if (!structureDefinition) {\n        throw new Error(`No definition found for structure ${props.structure}\n            with type ProductionStructureDefinition.`);\n    }\n    const level: number = structureState.level;\n    const storeState: ProductionStructureStoreState = useStructureState(structure) as ProductionStructureStoreState;\n    const displayName = TextManager.getStructureName(props.structure);\n\n    const handleCraft = (productionDefinition: ProductionDefinition, workers: number) => {\n        const craftingTime = calculateProductionTime(productionDefinition.cost.time || 0, workers);\n        dispatch(removeResources(productionDefinition.cost.resources || {}));\n        dispatch(increaseWorkers(structure, workers));\n\n        const callbacks = [\n            addItemToWarehouse(productionDefinition.item),\n            increaseWorkers(structure, workers),\n        ];\n        const start = startTask(TaskType.craftItem,\n            productionDefinition.item,\n            `${structure}.craft`,\n            craftingTime,\n            callbacks);\n        dispatch(start);\n    }\n\n    const handleUpgrade = (cost: number) => {\n        dispatch(subtractGold(cost));\n        dispatch(upgradeStructure(structure)); // TODO: [07/07/2019] time to upgarde??\n\n        dispatch(addLogText(\"log-town-upgrade-structure-complete\", {\n            level: level + 1,\n            structure,\n        }, LogChannel.town));\n    }\n\n    const createUpgradeRow = () => {\n        const nextLevel = structureDefinition.levels[level + 1];\n        const nextLevelCost = (nextLevel != null ? nextLevel.cost.gold || 0 : -1);\n        const canUpgrade = nextLevel != null && gold >= nextLevelCost;\n        const upgradeText = nextLevel == null ? TextManager.get(\"ui-structure-upgrade-max\") : TextManager.get(\"ui-structure-upgrade\", { cost: nextLevelCost, level: level + 2 });\n\n        return (\n            <div>\n                <label>{TextManager.get(\"ui-structure-level\")}</label>\n                { `${(level + 1)} / ${structureDefinition.levels.length}` }\n                <Button\n                    className=\"upgrade\"\n                    onClick={() => {handleUpgrade(nextLevelCost)}}\n                    disabled={!canUpgrade}>\n                        { upgradeText }\n                </Button>\n            </div>\n        );\n    };\n\n    const createCraftTabs = () => {\n        return storeState.produces.map((item) => {\n            const handleSelectCraftingItem = (e: React.MouseEvent) => {\n                e.stopPropagation();\n\n                setSelectedItem(item);\n            };\n\n            return (\n                <li\n                    key={`craft${item}`}\n                    onClick={handleSelectCraftingItem}\n                    className={selectedItem === item ? \"selected\" : \"\"}\n                >\n                    <ItemIcon item={item} />\n                    { TextManager.getItemName(item) }\n                </li>\n            );\n        });\n    };\n\n    const createCraftingDetails = () => {\n        const item = selectedItem;\n        if (!item) { return null; }\n\n        const produces = getProductionDefinition(item)!;\n        const costResources = produces.cost.resources!;\n        const missingAtLeastOneResource = Object.keys(costResources)\n            .some((resource) => costResources[resource] > resourcesState[resource]);\n\n        let missingAtLeastOneItem = false;\n        const costMaterials = produces.cost.materials;\n        if (costMaterials) {\n            missingAtLeastOneItem = costMaterials.some((i: Item) => stockpileState.indexOf(i) === -1);\n        }\n\n        const disabled = missingAtLeastOneResource || missingAtLeastOneItem || workersAssigned < 1;\n        // TODO: [10/07/2019] Perhaps each item can have a number of minimum workers?\n\n        const makeTimeString = (asNumber: number): string => {\n            if (workersAssigned === 0) {\n                return \"\";\n            }\n            const craftingTime = calculateProductionTime(asNumber, workersAssigned);\n            const time = formatDuration(craftingTime);\n            return TextManager.get(\"ui-structure-production-crafting-time\", { time });\n        };\n\n        const handleClick = (e: React.MouseEvent) => {\n            e.stopPropagation();\n\n            handleCraft(produces, workersAssigned);\n            setWorkersAssigned(0);\n        };\n\n        const handleUp = (e: React.MouseEvent) => {\n            e.stopPropagation();\n            setWorkersAssigned(workersAssigned + 1);\n        };\n\n        const handleDown = (e: React.MouseEvent) => {\n            e.stopPropagation();\n            setWorkersAssigned(workersAssigned - 1);\n        };\n\n        return (\n            <div className=\"crafting-details\">\n                { TextManager.get(\"ui-structure-production-craft-a\", {item}) }\n                <div className=\"crafting-costs\">\n                    <fieldset>\n                        <ResourcesCostBox resources={costResources} />\n                    </fieldset>\n                    <fieldset>\n                        {costMaterials && <ItemsBox items={costMaterials} />}\n                    </fieldset>\n                </div>\n                <div className=\"buttonrow\">\n                    <div>\n                        <UpDownValue\n                            value={workersAssigned}\n                            label={TextManager.get(\"ui-structure-production-workers\")}\n                            onUp={handleUp}\n                            onDown={handleDown}\n                            upDisabled={\n                                workersAssigned >= workersFree ||\n                                workersAssigned >= MAX_WORKERS_CRAFTING\n                            }\n                            downDisabled={ workersAssigned < 1 }\n                        />\n                        { makeTimeString(produces.cost.time || 0) }\n                    </div>\n                    <div>\n                        <Button\n                            disabled={disabled}\n                            className=\"craft\"\n                            onClick={handleClick}\n                        >\n                            {TextManager.get(\"ui-structure-production-craft\")}\n                        </Button>\n                    </div>\n                </div>\n            </div>\n        );\n    };\n\n\n    return (\n        // TODO: abstract some stuff to generic StructureView\n        <>\n            <StructureViewHeader structure={props.structure} />\n\n            <details open={true } className = \"production-structure-view\">\n                <summary>{displayName}</summary>\n                <section>\n                    { createUpgradeRow() }\n                    <div>craft:</div>\n                    {/* { createCraftRows() } */}\n                    <div className=\"crafting-area\">\n                        <ul className=\"vertical-tab-bar\">\n                            {createCraftTabs()}\n                        </ul>\n                        {createCraftingDetails()}\n                    </div>\n                    <fieldset>\n                        <legend>{TextManager.get(\"ui-structure-production-crafting\")}</legend>\n                        {craftingTasks.map((t) => (\n                            <Progressbar\n                                key={`${t.name}${t.startTime}`}\n                                label={`${t.name} (${formatDuration(t.timeRemaining)})`}\n                                progress={t.progress}\n                            />\n                        ))}\n                    </fieldset>\n                    {studyingTasks.length > 0 && (\n                    <fieldset>\n                        <legend>{TextManager.get(\"ui-structure-production-studying\")}</legend>\n                        {studyingTasks.map((t) => (\n                            <Progressbar\n                                key={`${t.name}${t.startTime}`}\n                                label={`${t.name} (${formatDuration(t.timeRemaining)})`}\n                                progress={t.progress}\n                            />\n                        ))}\n                    </fieldset>\n                    )}\n                </section>\n            </details>\n        </>\n    );\n}\n\nexport default ProductionStructureView;\n","import { Resource } from \"definitions/resources\";\r\nimport resourceDescriptions from \"definitions/resources\";\r\nimport * as React from \"react\";\r\nimport { ResourceStoreState } from \"stores/resources\";\r\nimport { TextManager } from \"global/TextManager\";\r\nimport { StructuresStoreState } from 'stores/structures';\r\nimport { getStructureByResource } from 'definitions/structures';\r\nimport { Link } from 'react-router-dom';\r\nimport { getStructureLink } from 'utils/routing';\r\nimport { withAppContext, AppContextProps } from 'hoc/withAppContext';\r\nimport { useSelector } from 'react-redux';\r\nimport { StoreState } from 'stores';\r\nimport { StructureState } from 'stores/structure';\r\nimport \"components/ui/styles/icon.scss\";\r\nimport \"components/ui/resources/css/resourcesbox.css\";\r\nimport { getClassName, IconSize } from 'constants/icons';\r\n\r\nexport interface Props {\r\n    className?: string;\r\n    resources: ResourceStoreState;\r\n    structures: StructuresStoreState;\r\n    maxResources: ResourceStoreState;\r\n    deltaResources: ResourceStoreState;\r\n}\r\n\r\nexport interface StateProps {\r\n    sufficientResources?: Record<Resource, boolean>;\r\n}\r\n\r\ntype AllProps = Props & StateProps;\r\n\r\n/**\r\n * The ResourcesBox is used in the Warehouse to show a list of resources\r\n */\r\nconst ResourcesBox = (props: AllProps & AppContextProps) => {\r\n    const {\r\n        sufficientResources,\r\n        resources,\r\n        deltaResources,\r\n    } = props;\r\n    const structures = useSelector<StoreState, StructuresStoreState>(store => store.structures);\r\n\r\n    const className=(props.className || \"\") + \" resourcesbox\";\r\n    const listItems = Object.keys(resources).map((resource: string) => {\r\n        let listItemClass = \"resource\";\r\n        if (sufficientResources && !sufficientResources[resource]) {\r\n             listItemClass += \" insufficient\";\r\n        }\r\n        const resourceDescription=resourceDescriptions[resource];\r\n        const amount = props.resources[resource]!;\r\n        if (!resourceDescription) {\r\n            throw new Error(`No resource description found for ${resource}`);\r\n        }\r\n\r\n        let delta;\r\n        if (deltaResources[resource]) {\r\n            delta = <span className=\"animate-up\">\r\n                { `+ ${deltaResources[resource]!.toFixed(2)}`  }\r\n            </span>;\r\n        }\r\n\r\n        const structure = getStructureByResource(Resource[resource]);\r\n\r\n        const handleStructureClick=() => {\r\n            props.onCloseWindow();\r\n        }\r\n\r\n        return (\r\n            <li className={listItemClass} key={resource}>\r\n                <div\r\n                    className={`icon ${getClassName(IconSize.smallest)}`}\r\n                    style={{\r\n                        backgroundImage: `url(${process.env.PUBLIC_URL}${resourceDescription.iconImg})`,\r\n                    }}\r\n                />\r\n                <div className=\"name\">\r\n                    { TextManager.getResourceName(resource as Resource) }\r\n                </div>\r\n                <div className=\"amount\" >\r\n                    { amount.toFixed(1) }\r\n                </div>\r\n                <div className=\"max\" >\r\n                    { ` / ${props.maxResources[resource]}` }\r\n                </div>\r\n                <div className=\"delta\">\r\n                    { delta }\r\n                </div>\r\n                <div className=\"structure\">\r\n                    source:\r\n                    { structures[structure].state === StructureState.Built ? (\r\n                        <Link to={getStructureLink(structure)} onClick={handleStructureClick}>\r\n                            { TextManager.getStructureName(structure) }\r\n                        </Link>\r\n                    ) : (\r\n                        TextManager.getStructureName(structure)\r\n                    )}\r\n                </div>\r\n            </li>\r\n        );\r\n    });\r\n\r\n    return (\r\n        <ul className={ className } >\r\n            { listItems }\r\n        </ul>\r\n    );\r\n};\r\n\r\nexport default withAppContext(ResourcesBox);\r\n\r\n\r\n","import { useEffect, useRef } from \"react\";\r\n\r\nconst usePrevious = <T extends {}>(value: T) => {\r\n    const ref = useRef<T>();\r\n    useEffect(() => {\r\n      ref.current = value;\r\n    });\r\n    return ref.current;\r\n};\r\nexport default usePrevious;\r\n","import { Resource } from \"definitions/resources\";\n\n// The keys should be the same as the enum Resource\nexport interface ResourceStoreState {\n    [Resource.wood]?: number;\n    [Resource.iron]?: number;\n    [Resource.stone]?: number;\n    [Resource.leather]?: number;\n    [Resource.fabric]?: number;\n    [Resource.food]?: number;\n}\n\nexport const initialState: ResourceStoreState = {\n    fabric: 0,\n    food: 0,\n    iron: 10,\n    leather: 0,\n    stone: 0,\n    wood: 10,\n};\n\nexport const empty: ResourceStoreState = {\n    fabric: 0,\n    food: 0,\n    iron: 0,\n    leather: 0,\n    stone: 0,\n    wood: 0,\n};\n","import { useDispatch } from 'react-redux';\nimport { subtractGold } from 'actions/gold';\nimport { upgradeStructure } from 'actions/structures';\nimport { Structure } from 'definitions/structures';\nimport { addLogText } from 'actions/log';\nimport { LogChannel } from 'stores/logEntry';\n\n\nconst useStructureActions = () => {\n    const dispatch = useDispatch();\n\n    const startUpgradeStructure = (cost: number, level: number, structure: Structure) => {\n        dispatch(subtractGold(cost));\n        dispatch(upgradeStructure(structure)); // Todo: [07/07/2019] time??\n\n        dispatch(addLogText(\"log-town-upgrade-structure-complete\", {\n            level,\n            structure,\n        }, LogChannel.town));\n    }\n\n    return {\n        startUpgradeStructure\n    }\n}\n\nexport default useStructureActions;","import * as React from \"react\";\nimport { ContextType } from \"constants/context\";\nimport { DragSourceType } from \"constants/dragging\";\nimport { IconSize } from \"constants/icons\";\nimport { getDefinition } from \"definitions/items\";\nimport { Item } from \"definitions/items/types\";\nimport { TextManager } from \"global/TextManager\";\nimport DraggableItemIcon, { InventoryItemDragInfo } from \"../../DraggableItemIcon\";\nimport EquipmentSlot, { EquipmentSlotType } from \"../../EquipmentSlot\";\nimport Inventory from \"../../inventory/Inventory\";\nimport { TooltipManager } from 'global/TooltipManager';\nimport useItemDropActions from 'hooks/actions/useItemActions';\nimport { useAdventurerState } from 'hooks/store/adventurers';\nimport \"./styles/adventurerinfo.scss\";\nimport Level from './Level';\n\nexport interface Props {\n    adventurerId: string;\n}\n\n\n// Used in warehouse\nconst AdventurerInfo = (props: Props) => {\n\n    const adventurer = useAdventurerState(props.adventurerId);\n\n    const {\n        dropItemEquipment,\n        dropItemInventory\n    } = useItemDropActions()\n\n    const handleDropItemEquipment = (dragInfo: InventoryItemDragInfo, slotType: EquipmentSlotType) => {\n        dropItemEquipment(dragInfo, slotType, adventurer);\n    };\n\n    const handleDropItemInventory = (item: Item, fromSlot: number, toSlot: number, sourceType: DragSourceType, sourceId?: string): void => {\n        dropItemInventory(item, fromSlot, toSlot, sourceType, adventurer, sourceId);\n    };\n\n    const getEquipmentSlot = (slotType: EquipmentSlotType) => {\n        // returns EquipmentSlot\n        const item: Item | undefined = adventurer.equipment[EquipmentSlotType[slotType]];\n        let contents = null;\n        if (item) {\n            const itemRef: React.RefObject<any> = React.createRef();\n            const handleClick = (event: React.MouseEvent) => {\n                const origin = (event.currentTarget as HTMLElement);\n                const originRect = origin.getBoundingClientRect();\n                TooltipManager.showContextTooltip(ContextType.item, getDefinition(item), originRect);\n                event.stopPropagation();\n            };\n\n            contents = (\n                <DraggableItemIcon\n                    index={slotType}\n                    sourceId={adventurer.id}\n                    sourceType={DragSourceType.adventurerEquipment}\n                    item={item}\n                    onClick={handleClick}\n                    ref={itemRef}\n                    size={IconSize.medium}\n                />\n            );\n        }\n\n        return (\n            <>\n                <EquipmentSlot\n                    onDrop={(dragInfo: InventoryItemDragInfo) => handleDropItemEquipment(dragInfo, slotType)}\n                    type={slotType}\n                >\n                    {contents}\n                </EquipmentSlot>\n                <span className=\"info\">{TextManager.getEquipmentSlot(slotType)}</span>\n            </>\n        );\n    };\n\n    const equipmentList = (\n        <ul>\n            <li>{getEquipmentSlot(EquipmentSlotType.head)}</li>\n            <li>{getEquipmentSlot(EquipmentSlotType.shoulders)}</li>\n            <li>{getEquipmentSlot(EquipmentSlotType.chest)}</li>\n            <li>{getEquipmentSlot(EquipmentSlotType.hands)}</li>\n            <li>{getEquipmentSlot(EquipmentSlotType.legs)}</li>\n            <li>{getEquipmentSlot(EquipmentSlotType.feet)}</li>\n            <li>{getEquipmentSlot(EquipmentSlotType.mainHand)}</li>\n            <li>{getEquipmentSlot(EquipmentSlotType.offHand)}</li>\n        </ul>\n    );\n\n    return (\n        <div className=\"adventurer-info\">\n            <div className=\"left\">\n                <div className=\"name\">\n                    <b>{adventurer.name}</b>\n                </div>\n                <Level xp={adventurer.xp} />\n                <div className=\"attributes\">\n                    { Object.keys(adventurer.basicAttributes).map((stat) => {\n                        const value: number = adventurer.basicAttributes[stat];\n                        return (\n                            <div key={`${adventurer.id}-${stat}`} >\n                                 <b>{stat}</b>: {value.toFixed(1)}\n                            </div>\n                        );\n                    })}\n                </div>\n                <div className=\"equipment\">\n                    {equipmentList}\n                </div>\n            </div>\n            <div className=\"right\">\n                <Inventory\n                    sourceType={DragSourceType.adventurerInventory}\n                    sourceId={adventurer.id}\n                    items={adventurer.inventory}\n                    onDropItem={handleDropItemInventory}\n                />\n            </div>\n        </div>\n    );\n};\n\nexport default AdventurerInfo;\n","import Inventory from \"components/ui/inventory/Inventory\";\r\nimport ResourcesBox from \"components/ui/resources/ResourcesBox\";\r\nimport { DragSourceType } from \"constants/dragging\";\r\nimport { Item } from \"definitions/items/types\";\r\nimport { getDefinition, Structure } from \"definitions/structures\";\r\nimport { StructureDefinition, WarehouseStructureLevelDefinition } from \"definitions/structures/types\";\r\nimport usePrevious from \"hooks/usePrevious\";\r\nimport * as React from \"react\";\r\nimport { useEffect, useRef, useState } from \"react\";\r\nimport { empty, ResourceStoreState } from \"stores/resources\";\r\nimport { StructuresStoreState } from \"stores/structures\";\r\nimport { TextManager } from \"global/TextManager\";\r\nimport AdventurerTabstrip from 'components/world/QuestPanel/AdventurerTabstrip';\r\nimport useStructureState from 'hooks/store/useStructureState';\r\nimport useResourcesState from 'hooks/store/useResourcesState';\r\nimport useGoldState from 'hooks/store/useGoldState';\r\nimport useStructureActions from 'hooks/actions/useStructureActions';\r\nimport useStockpileState from 'hooks/store/useStockpileState';\r\nimport { useSelector } from 'react-redux';\r\nimport { StoreState } from 'stores';\r\nimport { useAdventurersInTown } from 'hooks/store/adventurers';\r\nimport useItemDropActions from 'hooks/actions/useItemActions';\r\nimport AdventurerInfo from 'components/ui/adventurer/AdventurerInfo';\r\nimport \"./styles/warehousestructureview.scss\";\r\nimport Button from 'components/ui/buttons/Button';\r\n\r\n// tslint:disable-next-line: no-empty-interface\r\nexport interface Props  {\r\n}\r\n\r\n\r\nconst WAREHOUSE = DragSourceType.warehouse;\r\n\r\n\r\n// todo 20191202: Resource update should happen at a set interval\r\nconst WarehouseStructureView = (props: Props) => {\r\n\r\n    const [selectedAdventurer, setSelectedAdventurer] = useState<string>();\r\n    const resources = useResourcesState();\r\n    const [resourcesDelta, setResourcesDelta] = useState<ResourceStoreState>(empty);    // updating this will trigger animation\r\n    const previousResources = usePrevious(resources);\r\n    const resourcesRef = useRef<HTMLFieldSetElement>(null);\r\n    const gold = useGoldState();\r\n    const stockpileState = useStockpileState();\r\n    const structuresState = useSelector<StoreState, StructuresStoreState>(store => store.structures);\r\n    const {startUpgradeStructure} = useStructureActions();\r\n    const adventurersInTown = useAdventurersInTown();\r\n    const {dropItemWarehouse} = useItemDropActions();\r\n\r\n    useEffect(() => {\r\n        // Calculate delta\r\n        const delta = Object.keys(resources).reduce((acc, value) => {\r\n            if (previousResources && previousResources[value]) {\r\n                acc[value] = resources[value] - previousResources[value];\r\n            }\r\n            return acc;\r\n        }, {});\r\n\r\n        setResourcesDelta(delta);\r\n    }, [resources, previousResources]);\r\n\r\n    useEffect(() => {\r\n        if (!resourcesRef.current) {\r\n            return;\r\n        }\r\n        const ref = resourcesRef.current as unknown as HTMLFieldSetElement;\r\n        ref.classList.remove(\"animate\");\r\n        setTimeout(() => {\r\n            if (resourcesRef) {\r\n                ref.classList.add(\"animate\");\r\n            }\r\n        }, 200);\r\n    }, [resourcesDelta]);\r\n\r\n    const structureDefinition = getDefinition<StructureDefinition>(Structure.warehouse);\r\n    if (!structureDefinition) {\r\n        throw new Error(`No definition found for structure ${Structure.warehouse} with type StructureDefinition.`);\r\n    }\r\n\r\n    const structureState = useStructureState(Structure.warehouse);\r\n    const levelDefinition: WarehouseStructureLevelDefinition = structureDefinition.levels[structureState.level] as WarehouseStructureLevelDefinition;\r\n    const level: number = structureState.level;\r\n    const displayName = TextManager.getStructureName(Structure.warehouse);\r\n\r\n    const createUpgradeRow = () => {\r\n        const nextLevel = structureDefinition.levels[level + 1];\r\n        const nextLevelCost = (nextLevel != null ? nextLevel.cost.gold || 0 : -1);\r\n        const canUpgrade = nextLevel != null && gold >= nextLevelCost;\r\n        const upgradeText = nextLevel == null ? TextManager.get(\"ui-structure-upgrade-max\") : TextManager.get(\"ui-structure-upgrade\", { cost: nextLevelCost, level: level + 2 });\r\n\r\n        const handleClick = (event: React.MouseEvent<HTMLButtonElement>) => {\r\n            startUpgradeStructure(nextLevelCost, level + 1, Structure.warehouse);\r\n        };\r\n        return (\r\n            <div>\r\n                <label>{TextManager.get(\"ui-structure-level\")}</label>\r\n                { `${(level + 1)} / ${structureDefinition.levels.length}` }\r\n                <Button\r\n                    className=\"upgrade\"\r\n                    onClick={handleClick}\r\n                    disabled={!canUpgrade}>\r\n                        { upgradeText }\r\n                </Button>\r\n            </div>\r\n        );\r\n    };\r\n\r\n    const handleDropItemWarehouse = (item: Item, fromSlot: number, toSlot: number, sourceType: DragSourceType, sourceId?: string): void => {\r\n        dropItemWarehouse(item, fromSlot, toSlot, sourceType, sourceId);\r\n    }\r\n\r\n    const handleAdventurerTabSelected = (tabId: string) => {\r\n        setSelectedAdventurer(tabId);\r\n    };\r\n\r\n    const renderAdventurerContent = () => {\r\n        if (selectedAdventurer) {\r\n            return (\r\n                <AdventurerInfo\r\n                    adventurerId={selectedAdventurer}\r\n                />\r\n            );\r\n        }\r\n        return null;\r\n    };\r\n\r\n    return (\r\n        <details open={true} className=\"warehouse-structureview\">\r\n            <summary>{displayName}</summary>\r\n            {createUpgradeRow()}\r\n            <fieldset className=\"resources\" ref={resourcesRef}>\r\n                <legend>Resources</legend>\r\n                <ResourcesBox\r\n                    resources={resources}\r\n                    structures={structuresState}\r\n                    maxResources={levelDefinition.maxResources}\r\n                    deltaResources={resourcesDelta}\r\n                />\r\n            </fieldset>\r\n            <h3>Stockpile</h3>\r\n            <Inventory\r\n                sourceType={WAREHOUSE}\r\n                items={stockpileState}\r\n                onDropItem={handleDropItemWarehouse}\r\n            />\r\n            <h3>Adventurers</h3>\r\n            <div>\r\n                <AdventurerTabstrip\r\n                    adventurers={adventurersInTown}\r\n                    selectedAdventurerId={selectedAdventurer}\r\n                    onAdventurerTabSelected={handleAdventurerTabSelected}\r\n                />\r\n                <div className=\"adventurer-inventory\">\r\n                    {renderAdventurerContent()}\r\n                </div>\r\n            </div>\r\n        </details>\r\n    );\r\n\r\n};\r\n\r\nexport default WarehouseStructureView;\r\n","import { DragType } from \"constants/dragging\";\r\nimport * as React from \"react\";\r\nimport { ConnectDropTarget, DropTarget, DropTargetConnector, DropTargetMonitor, DropTargetSpec } from \"react-dnd\";\r\nimport \"./styles/droppableadventurerslot.scss\";\r\n\r\nconst dropTarget: DropTargetSpec<Props> = {\r\n    drop(props: Props, monitor: DropTargetMonitor) {\r\n        props.onDrop(monitor.getItem());\r\n    },\r\n    canDrop(props: Props, monitor: DropTargetMonitor)  {\r\n        return true; // todo: can't drop on yourself\r\n    },\r\n};\r\n\r\nexport interface Props {\r\n    onDrop: (item: any) => void;\r\n}\r\n\r\nexport interface DropSourceProps {\r\n    canDrop: boolean;\r\n    isOver: boolean;\r\n    connectDropTarget: ConnectDropTarget;\r\n}\r\n\r\nconst collect = (connect: DropTargetConnector, monitor: DropTargetMonitor) => ({\r\n    canDrop: monitor.canDrop(),\r\n    connectDropTarget: connect.dropTarget(),\r\n    isOver: monitor.isOver(),\r\n});\r\n\r\n/*\r\n * Can drop adventurers on this */\r\nconst DroppableAdventurerSlot = (props: Props & DropSourceProps) => {\r\n    const {\r\n        isOver,\r\n        canDrop,\r\n        connectDropTarget,\r\n    } = props;\r\n    // const isActive = isOver && canDrop;\r\n    let className = \"droppable-adventurer-slot\";\r\n\r\n    if (isOver) {\r\n        className += \" active-drop\";\r\n    } else if (canDrop) {\r\n        className += \" can-drop\";\r\n    }\r\n\r\n    return connectDropTarget(\r\n        <div className = { className }/>\r\n    );\r\n}\r\n\r\nexport default DropTarget<Props, DropSourceProps>(\r\n    DragType.ADVENTURER,\r\n    dropTarget,\r\n    collect,\r\n)(DroppableAdventurerSlot);\r\n","import * as React from \"react\";\nimport { AdventurerStoreState } from \"stores/adventurer\";\nimport AdventurerAvatar from \"components/ui/adventurer/AdventurerAvatar\";\nimport { AdventurerAvatarDragInfo } from 'components/ui/adventurer/DraggableAdventurerAvatar';\nimport \"./styles/assignadventurers.scss\";\nimport DroppableAdventurerSlot from 'components/ui/adventurer/DroppableAdventurerSlot';\n\nexport interface DispatchProps {\n    onAdventurerDropped: (item: AdventurerAvatarDragInfo, index: number) => void;\n    onAdventurerClicked: (adventurer: AdventurerStoreState) => void;\n}\n\nexport interface Props {\n    availableSlots: number;\n    assignedAventurers: AdventurerStoreState[];\n}\n\n/*\n * Displays a number of slots to drag adventurers to */\nconst AssignAdventurers = (props: Props & DispatchProps) => {\n    const slotsContent = () => {\n        const slots: JSX.Element[] = [];\n        for (let i = 0; i < props.availableSlots; i++) {\n            let content;\n            let className = \"\";\n            const hasAdventurer = !!props.assignedAventurers[i];\n\n            if (hasAdventurer) {\n                const adventurer = props.assignedAventurers[i];\n                content = (\n                    <AdventurerAvatar\n                        adventurer={adventurer}\n                        displayName={false}\n                        onClick={() => props.onAdventurerClicked(adventurer) }\n                    />\n                );\n                className = \"has-adventurer\";\n            } else {\n                content = (\n                    <DroppableAdventurerSlot onDrop={ (item: AdventurerAvatarDragInfo) => { props.onAdventurerDropped(item, i); }} />\n                );\n            }\n            slots.push(\n                <li\n                    key={`slot${i}`}\n                    className={className}\n                >\n                    {content}\n                </li>\n            );\n        }\n        return slots;\n    };\n\n    return (\n        <ul className = \"assign-adventurers\">\n            { slotsContent() }\n        </ul>\n    );\n};\n\nexport default AssignAdventurers;\n","import { Item } from \"definitions/items/types\";\nimport { getDefinition } from \"definitions/quests\";\nimport * as React from \"react\";\nimport { AdventurerStoreState } from \"stores/adventurer\";\nimport { QuestStoreState } from \"stores/quest\";\nimport { TextManager } from \"global/TextManager\";\nimport AssignAdventurers from \"./AssignAdventurers\";\nimport { QuestDefinition } from 'definitions/quests/types';\nimport { useSelector } from 'react-redux';\nimport { StoreState } from 'stores';\nimport Button from 'components/ui/buttons/Button';\nimport ItemsBox from 'components/ui/items/ItemsBox';\nimport { AdventurerAvatarDragInfo } from 'components/ui/adventurer/DraggableAdventurerAvatar';\nimport \"./styles/questboard.scss\";\n\nexport const AVAILABLE_SLOTS = 5;\nconst minimumCountAdventurers = 3;  // we need this many adventurers to start the quest\n\n\n// tslint:disable-next-line: no-empty-interface\n\nexport interface Props {\n    availableQuests: QuestStoreState[];\n    selectedQuestName?: string;       // name of selected quest\n    assignedAventurers: AdventurerStoreState[];\n\n    onQuestClick: (questName: string) => void;\n    onAdventurerDropped: (item: AdventurerAvatarDragInfo, index: number) => void;\n    onRemoveAdventurer: (adventurer: AdventurerStoreState) => void;\n    onLaunchQuest: () => void;\n}\n\nconst QuestBoard = (props: Props) => {\n\n    const items = useSelector<StoreState, (null|Item)[]>(state => state.stockpile);\n\n    const getQuestDetails = () => {\n        if (!props.selectedQuestName) {\n            return null;\n        }\n        const quest = props.availableQuests.find((q) => q.name === props.selectedQuestName);\n        if (!quest) {\n            return (\n                <div> { TextManager.get(\"structure-tavern-quest-launched\") } </div>\n            );\n        }\n        const questDefinition = getDefinition(quest.name);\n\n        // Need a full party to launch\n        const fullParty = props.assignedAventurers.filter((a) => a !== null).length >= minimumCountAdventurers;\n        // Check if we have the required items\n        const enoughItems = checkEnoughItems(questDefinition);\n\n        const canLaunch = fullParty && enoughItems;\n\n        return (\n            <div className=\"quest-details\">\n                {TextManager.getQuestDescription(props.selectedQuestName)}\n                <AssignAdventurers\n                    availableSlots={AVAILABLE_SLOTS}\n                    assignedAventurers={props.assignedAventurers}\n                    onAdventurerClicked={props.onRemoveAdventurer}\n                    onAdventurerDropped={props.onAdventurerDropped}\n                />\n                <ItemsBox items={ questDefinition.requiredItems || [] }/>\n                <Button disabled={!canLaunch} onClick = { () => props.onLaunchQuest() }>\n                    {TextManager.get(\"structure-tavern-button-launch-quest\")}\n                </Button>\n            </div>\n        );\n    };\n\n    /**\n     * Returns true if all the items required by the quest are in the inventory\n     */\n    const checkEnoughItems = (questDefinition: QuestDefinition): boolean => {\n        if (!questDefinition.requiredItems) {\n            return true;\n        }\n        return questDefinition.requiredItems.every((item: Item) => {\n            const amountRequired = (questDefinition.requiredItems)!.filter((i) => i === item).length;\n            return items.filter((i) => i === item).length >= amountRequired;\n        });\n    }\n\n    // quest board, expanded quest info + assign adventurers + launch button\n    return (\n        <div className=\"quest-board\">\n            <h2>\n                {TextManager.get(\"structure-tavern-title-quest-board\")}\n            </h2>\n            <ul className=\"quest-list\">\n                {props.availableQuests.map((q) => {\n                    const className = `quest ${(q.name === props.selectedQuestName) ? \" selected\" : \"\"}`;\n                    return (\n                        <li key={q.name}\n                            className={className}\n                            onClick={() => {props.onQuestClick(q.name);} }\n                        >\n                            <div\n                                className=\"icon\"\n                                style={{backgroundImage: `url(${process.env.PUBLIC_URL})`}}\n                            />\n                            <div className=\"title\">{ TextManager.getQuestTitle(q.name) } </div>\n                        </li>\n                    );\n                })}\n            </ul>\n            { getQuestDetails() }\n        </div>\n    );\n}\n\nexport default QuestBoard;\n","import * as React from \"react\";\nimport { AdventurerStoreState } from 'stores/adventurer';\nimport { AVAILABLE_SLOTS } from './QuestBoard';\nimport Button from 'components/ui/buttons/Button';\nimport { TextManager } from 'global/TextManager';\nimport \"./styles/adventurerButton.scss\";\n\nexport interface Props {\n    adventurer: AdventurerStoreState;\n    assignedAventurers: AdventurerStoreState[];  // assigned to a quest in the QuestBoard\n    questName: string;\n\n    onAddAdventurer: (adventurer: AdventurerStoreState, index: number) => void;\n    onRemoveAdventurer: (adventurer: AdventurerStoreState) => void;\n}\n\n// Toggles adventurer participation in a quest\nconst AdventurerButton = (props: Props) => {\n    const {\n        adventurer,\n        assignedAventurers,\n        questName,\n        onAddAdventurer,\n        onRemoveAdventurer\n    } = props;\n\n    const isAssigned = assignedAventurers.indexOf(adventurer) > -1;\n    const quest = TextManager.getQuestTitle(questName);\n\n    const handleAddClick = () => {\n        const emptySlot = getEmptySlot(assignedAventurers);\n        onAddAdventurer(adventurer, emptySlot);\n    };\n\n    const handleRemoveClick = () => {\n        onRemoveAdventurer(adventurer);\n    }\n\n    if (isAssigned) {\n        return (\n            <Button onClick={handleRemoveClick} className=\"adventurer-button\">\n               {TextManager.get(\"structure-tavern-button-leave-quest\")}\n            </Button>\n        );\n    }\n    // Skip holes\n    if (assignedAventurers.filter(Boolean).length === AVAILABLE_SLOTS) {\n        return (\n            <Button disabled={true} className=\"adventurer-button\">\n                {TextManager.get(\"structure-tavern-button-join-quest-full-party\")}\n            </Button>\n        )\n    }\n    return (\n        <Button onClick={handleAddClick}  className=\"adventurer-button\">\n            {TextManager.get(\"structure-tavern-button-join-quest\", { quest })}\n        </Button>\n    )\n}\n\nexport default AdventurerButton;\n\n// Finds the first array index with a falsey value\nconst getEmptySlot = (assignedAventurers: AdventurerStoreState[]) => {\n    for (let i = 0; i < AVAILABLE_SLOTS; i++) {\n        if (!assignedAventurers[i]) {\n            return i;\n        }\n    }\n    return 0;\n}","import { DragSourceType, DragType } from \"constants/dragging\";\r\nimport * as React from \"react\";\r\nimport { ConnectDragSource, DragSource, DragSourceConnector, DragSourceMonitor, DragSourceSpec } from \"react-dnd\";\r\nimport { AdventurerStoreState } from \"stores/adventurer\";\r\nimport AdventurerAvatar, { Props as AdventurerAvatarProps } from '../AdventurerAvatar';\r\nimport \"./styles/draggableadventureravatar.scss\";\r\n\r\nexport interface Props {\r\n    sourceId?: string;\r\n    onClick?: () => void;\r\n    disabled?: boolean;\r\n}\r\n\r\ninterface CollectedProps {\r\n    isDragging: boolean;\r\n    connectDragSource: ConnectDragSource;\r\n}\r\n\r\nexport interface AdventurerAvatarDragInfo {\r\n    adventurer: AdventurerStoreState;\r\n    sourceId?: string;\r\n}\r\n\r\n/**\r\n * Specifies the drag source contract.\r\n * Only `beginDrag` function is required.\r\n */\r\nconst spec: DragSourceSpec<Props & AdventurerAvatarProps, AdventurerAvatarDragInfo> = {\r\n    beginDrag(props: Props & AdventurerAvatarProps) {\r\n        // Return the data describing the dragged item\r\n        return {\r\n            adventurer: props.adventurer,\r\n            sourceId: props.sourceId,\r\n            sourceType: DragSourceType.adventurerInventory,\r\n        };\r\n    },\r\n};\r\n\r\n/**\r\n * Specifies which props to inject into your component.\r\n */\r\nfunction collect(connect: DragSourceConnector, monitor: DragSourceMonitor) {\r\n    return {\r\n        connectDragSource: connect.dragSource(),\r\n        isDragging: monitor.isDragging(),\r\n    };\r\n}\r\n\r\nconst DraggableAdventurerAvatar = (props: Props & CollectedProps & AdventurerAvatarProps) => {\r\n\r\n    const { isDragging, connectDragSource, disabled } = props;\r\n    let className = \"draggable-adventurer-avatar\";\r\n    if (disabled) {\r\n        className += \" disabled\";\r\n    }\r\n    if (isDragging) {\r\n        className += \" dragging\";\r\n    }\r\n\r\n    /*if (isDragging) {\r\n        // TODO: can show some sort of empty state?\r\n        return null;\r\n    }*/\r\n    return connectDragSource(\r\n        <div className = { className }>\r\n            <AdventurerAvatar\r\n                // Copy all props down to AdventurerAvatar\r\n                { ...props }\r\n            />\r\n        </div>,\r\n    );\r\n}\r\n\r\nexport default DragSource<Props & AdventurerAvatarProps, CollectedProps>(DragType.ADVENTURER, spec, collect)(DraggableAdventurerAvatar);\r\n","// tslint:disable: object-literal-sort-keys\nimport * as React from \"react\";\nimport {AppContextProps} from \"hoc/withAppContext\";\nimport {useRef, useState, createContext, useEffect } from \"react\";\nimport {DndProvider } from \"react-dnd\";\nimport {HTML5Backend } from 'react-dnd-html5-backend';\nimport {Link, Redirect, Route, Switch, HashRouter} from \"react-router-dom\";\nimport {Persistor} from \"redux-persist\";\nimport {PixiPlugin } from 'gsap/all';\nimport {gsap } from 'gsap';\nimport {Sound, SoundManager} from \"global/SoundManager\";\nimport {TextManager} from \"global/TextManager\";\nimport {Structure} from \"definitions/structures\";\nimport debounce from \"debounce\";\nimport Preloader, {MediaItem, MediaType} from \"../preloading/Preloader\";\nimport TownView from 'components/town/TownView';\nimport Toasts from 'components/ui/toasts/Toasts';\nimport Topbar from 'components/ui/topbar/Topbar';\nimport WorldView from 'components/world/WorldView';\nimport SimpleLog from 'components/log/SimpleLog';\nimport ContextTooltip from 'components/ui/tooltip/ContextTooltip';\nimport {TooltipManager } from 'global/TooltipManager';\nimport {getWorldLink, getTownLink } from 'utils/routing';\nimport Background from 'components/Background';\nimport {manifest} from \"./manifest/app\";\nimport { restartGame } from 'index';\nimport Button, { ButtonColor } from 'components/ui/buttons/Button';\nimport StructureDetailsView from 'components/town/StructureDetailsView';\nimport \"./styles/app.scss\";\n\nPixiPlugin.registerPIXI(PIXI);\ngsap.registerPlugin(PixiPlugin);\n\n\n// tslint:disable-next-line:no-empty-interface\nexport interface StateProps {\n}\n\n// tslint:disable-next-line:no-empty-interface\nexport interface DispatchProps {\n}\n\nexport enum View {\n    Town,\n    World,\n}\n\nexport interface Props {\n    persistor: Persistor;\n}\n\n\nexport const MAX_WIDTH = 960;\nexport const AppContext = createContext<AppContextProps | null>(null);\ntype AllProps = Props & StateProps & DispatchProps;\n\n\nconst App = (props: AllProps) => {\n    const containerRef = useRef<HTMLDivElement>(null);\n\n    const [media, setMedia] = useState<MediaItem[]>([]);\n    const [activeWindows, setActiveWindows] = useState<React.ReactElement[]>([]);\n\n    const handleViewButtonClick = () => {\n        SoundManager.playSound(Sound.buttonClick);\n    };\n\n    const handleRestartClick = () => {\n        restartGame();\n\n    };\n\n    const selectStructure = (structure: Structure | null) => {\n        if (structure) {\n            const displayName = TextManager.getStructureName(structure);\n\n            const window = <StructureDetailsView structure={structure} title={displayName} />;\n            handleWindowOpened(window);\n\n            SoundManager.playSound(Sound.buttonClick);\n       }\n    };\n\n    const renderTownView = () => <TownView onStructureClick={selectStructure} />;\n    const renderWorldView = () => <WorldView />;\n\n    const handleWindowOpened = (window: React.ReactElement) => {\n        setActiveWindows([\n            ...activeWindows || [],\n            window,\n        ]);\n    };\n\n    /**\n     * Closes all windows\n     */\n    const handleWindowClose = () => {\n        setActiveWindows([]);\n    };\n\n    /**\n     * Closes the top window of the stack\n     */\n    const handleWindowBack = () => {\n        if (activeWindows && activeWindows.length) {\n            setActiveWindows(activeWindows.slice(0, -1));\n        }\n    };\n\n    const renderWindow = (): React.ReactElement | null => {\n        if (!activeWindows.length) {\n            return null;\n        }\n\n        const topWindow = activeWindows[activeWindows.length - 1];\n        const commonWindowProps = {\n            onClose: handleWindowClose,\n            onBack: handleWindowBack,\n            backEnabled: activeWindows.length > 1,\n            closeEnabled: true,\n        };\n\n        const element = React.cloneElement(topWindow, commonWindowProps);\n        return element;\n    };\n\n    const handleMediaLoadComplete = (mediaItems: MediaItem[]) => {\n        const sounds = mediaItems.filter((m) => m.mediaType === MediaType.sound);\n        SoundManager.loadMedia(sounds);\n\n        // todo: refactor manifest stuff\n        SoundManager.addSounds({\n            [Sound.buttonClick]: \"sound/fx/button-click.ogg\",\n            [Sound.error]: \"sound/fx/error.ogg\",\n            [Sound.toast]: \"sound/fx/toast.ogg\"\n            // add more sounds here\n        });\n\n        setMedia(mediaItems);\n\n        // todo: temporary!\n        // const window = <CombatView/>;\n        // handleWindowOpened(window);\n    };\n\n    const handleAppClick = () => {\n        TooltipManager.clear();\n    };\n\n    useEffect(() => {\n        const handleScroll = debounce(() => {\n            TooltipManager.clear();\n        }, 100);\n        window.addEventListener(\"scroll\", handleScroll);\n        window.addEventListener(\"wheel\", handleScroll);\n        return () => {\n            window.removeEventListener(\"resize\", handleScroll);\n            window.removeEventListener(\"wheel\", handleScroll);\n        };\n    }, []);\n    // const handleResize = () => {\n    //     if (containerRef.current) {\n    //         if (window.innerHeight < resolution.height) {\n    //            // containerRef.current.style.transform = `scale(${Math.min(window.innerWidth / resolution.width, 1)}) translateX(-50%)`;\n    //         } else {\n    //             //containerRef.current.style.transform = `scale(1) translateX(-50%)`;\n    //         }\n    //         //const parentBox = containerRef.current.getBoundingClientRect();\n    //         //setContainerRect(parentBox);\n    //    }\n    // };\n\n    // useEffect(() => {\n    //     // todo: see if we can disable this;\n    //     window.addEventListener(\"resize\", handleResize);\n    //     handleResize();\n    //     return () => {\n    //         window.removeEventListener(\"resize\", handleResize);\n    //     };\n    // }, []);\n\n    return (\n        <AppContext.Provider value={{\n            media,\n            onOpenWindow: handleWindowOpened,\n            onCloseWindow: handleWindowClose,\n        }} >\n            <Background />\n            <div\n                className=\"app\"\n                ref={containerRef}\n                style={{\n                    maxWidth: MAX_WIDTH\n                }}\n                onClick={handleAppClick}\n            >\n                <DndProvider backend={HTML5Backend}>\n                <HashRouter>\n                    <Preloader\n                        manifest={manifest}\n                        onLoadComplete={handleMediaLoadComplete}\n                    >\n                        <Topbar persistor={props.persistor} />\n                        <div style={{ margin: \"4px 0 0 8px\"}}>\n                            <Switch>\n                                <Route path=\"/\" exact={true} >\n                                    <Redirect from=\"/\" to={getWorldLink()} />\n                                </Route>\n                                <Route path={getWorldLink()}>\n                                    <Link to={getTownLink()}>\n                                        <Button onClick={() => handleViewButtonClick()} color=\"green\"> {TextManager.get(`ui-view-button-town`)} </Button>\n                                    </Link>\n                                </Route>\n                                <Route path={getTownLink()}>\n                                    <Link to={getWorldLink()}>\n                                        <Button onClick={() => handleViewButtonClick()}  > {TextManager.get(`ui-view-button-world`)} </Button>\n                                    </Link>\n                                </Route>\n                            </Switch>\n                            {` | `}\n                            <Button onClick={() => handleRestartClick()} color={ButtonColor.purple} > Restart! </Button>\n                        </div>\n                        <Switch>\n                            <Route path={getTownLink()} render={renderTownView} />\n                            <Route path={getWorldLink()} render={renderWorldView} />\n                        </Switch>\n                        <SimpleLog/>\n                        {renderWindow()}\n                        <ContextTooltip />\n                        <Toasts />\n                    </Preloader>\n                </HashRouter>\n                </DndProvider>\n            </div>\n        </AppContext.Provider>\n    );\n};\n\nexport default App;\n","import React from 'react';\nimport { AdventurerStoreState } from 'stores/adventurer';\nimport { SOURCE_ID } from './TavernStructureView';\nimport AdventurerPanel from 'components/world/QuestPanel/AdventurerPanel';\nimport AdventurerButton from './AdventurerButton';\nimport { TextManager } from 'global/TextManager';\nimport DraggableAdventurerAvatar from 'components/ui/adventurer/DraggableAdventurerAvatar';\n\nexport interface Props {\n    adventurer: AdventurerStoreState;\n    onQuest: boolean;\n    assignedAventurers: AdventurerStoreState[];\n    expanded: boolean;\n    selectedQuestName?: string;\n\n    onClick: (adventurer: AdventurerStoreState) => void;\n    onAddAdventurer: (adventurer: AdventurerStoreState, index: number) => void;\n    onRemoveAdventurer: (adventurer: AdventurerStoreState) => void;\n}\n\n// Room block that has adventurer\nconst RoomWithAdventurer = (props: Props) => {\n    const {\n        adventurer,\n        onQuest,\n        assignedAventurers,\n        expanded,\n        selectedQuestName,\n        onClick,\n        onAddAdventurer,\n        onRemoveAdventurer\n    } = props;\n    /*\n    <button\n        className=\"boot\"\n        key={ `boot:${adventurer.id}` }\n    >\n        Boot\n    </button>,*/\n    const assigned = assignedAventurers.indexOf(adventurer) > -1; // assigned to a quest in the QuestBoard\n\n    return (\n        <>\n            <div className={`room ${expanded ? \"expanded\" : \"\"}`}>\n                <DraggableAdventurerAvatar\n                    disabled={assigned || onQuest}\n                    adventurer={adventurer}\n                    className=\"adventurer-icon\"\n                    sourceId={SOURCE_ID}\n                    key={`avatar:${adventurer.id}`}\n                />\n                <span key={ adventurer.id } onClick={() => onClick(adventurer)}>\n                    {adventurer.name}\n                    {(onQuest) && TextManager.get(\"structure-tavern-on-a-quest\") }\n                </span>\n            </div>\n            { expanded && (\n                <div className=\"adventurer-details\">\n                    <AdventurerPanel adventurer={adventurer} />\n                    { (!onQuest && selectedQuestName) && (\n                        <AdventurerButton\n                            adventurer={adventurer}\n                            assignedAventurers={assignedAventurers}\n                            questName={selectedQuestName}\n                            onAddAdventurer={onAddAdventurer}\n                            onRemoveAdventurer={onRemoveAdventurer}\n                        />\n                    )}\n                </div>\n            )}\n        </>\n    );\n}\n\nexport default RoomWithAdventurer;\n","import React, {  } from 'react';\n\nexport interface Props {\n}\n\nconst RoomEmpty = () => {\n    return (\n        <div className=\"room\">\n            (empty room)\n        </div>\n    );\n}\n\nexport default RoomEmpty;\n","import React, { useState } from 'react';\nimport { AdventurerStoreState } from 'stores/adventurer';\nimport { QuestStoreState } from 'stores/quest';\nimport RoomWithAdventurer from './RoomWithAdventurer';\nimport RoomEmpty from './RoomEmpty';\n\nexport interface Props {\n    roomCount: number;\n    adventurers: AdventurerStoreState[];\n    assignedAventurers: AdventurerStoreState[];\n    quests: QuestStoreState[];\n    selectedQuestName?: string;       // name of selected quest\n\n    onAddAdventurer: (adventurer: AdventurerStoreState, index: number) => void;\n    onRemoveAdventurer: (adventurer: AdventurerStoreState) => void;\n}\n\nconst RoomList = (props: Props) => {\n    const {\n        roomCount,\n        adventurers,\n        assignedAventurers,\n        selectedQuestName,\n        onAddAdventurer,\n        onRemoveAdventurer\n    } = props;\n    const [selectedAdventurer, setSelectedAdventurer] = useState<string>();\n\n    const getQuestByAdventurer = (adventurerId: string): QuestStoreState | undefined => {\n        return Object.values(props.quests).find((quest) => {\n            return quest.party.indexOf(adventurerId) > -1;\n        });\n    };\n\n    const handleAdventurerNameClick = (adventurer: AdventurerStoreState) => {\n        if (selectedAdventurer === adventurer.id) {\n            setSelectedAdventurer(undefined);\n        } else {\n            setSelectedAdventurer(adventurer.id);\n        }\n    };\n\n    const roomContent: JSX.Element[] = [];\n    for (let i = 0; i < roomCount; i++) {\n        const adventurer = adventurers.find((a) => a.room === i);\n        if (!adventurer) {\n            roomContent.push((\n                <RoomEmpty key={`room${i}`} />\n            ));\n            continue;\n        }\n        const onQuest = !!getQuestByAdventurer(adventurer.id);\n\n        roomContent.push((\n            <RoomWithAdventurer\n                key={adventurer.id}\n                adventurer={adventurer}\n                assignedAventurers={assignedAventurers}\n                selectedQuestName={selectedQuestName}\n                expanded={selectedAdventurer === adventurer.id}\n                onQuest={onQuest}\n\n                onClick={handleAdventurerNameClick}\n                onAddAdventurer={onAddAdventurer}\n                onRemoveAdventurer={onRemoveAdventurer}\n            />\n        ));\n    }\n\n    return (\n        <div className=\"rooms\">\n            <h2>Rooms</h2>\n            { roomContent }\n        </div>\n    );\n}\n\nexport default RoomList;","import * as React from \"react\";\nimport { getDefinition, Structure} from \"definitions/structures\";\nimport { TavernStructureDefinition, TavernStructureLevelDefinition} from \"definitions/structures/types\";\nimport { AdventurerStoreState} from \"stores/adventurer\";\nimport { QuestStatus, QuestStoreState} from \"stores/quest\";\nimport { TextManager} from \"global/TextManager\";\nimport { ToastManager} from 'global/ToastManager';\nimport { Type} from 'components/ui/toasts/Toast';\nimport { getQuestLink} from 'utils/routing';\nimport RoomList from './RoomList';\nimport { useState} from 'react';\nimport QuestBoard from './QuestBoard';\nimport useGoldState from 'hooks/store/useGoldState';\nimport useStructureState from 'hooks/store/useStructureState';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { StoreState } from 'stores';\nimport { launchQuest } from 'actions/quests';\nimport { subtractGold } from 'actions/gold';\nimport { upgradeStructure } from 'actions/structures';\nimport { addLogText } from 'actions/log';\nimport { LogChannel } from 'stores/logEntry';\nimport Button from 'components/ui/buttons/Button';\nimport { AdventurerAvatarDragInfo } from 'components/ui/adventurer/DraggableAdventurerAvatar';\nimport \"./styles/tavernstructureview.scss\";\n\nexport interface StateProps {\n    gold: number;\n    level: number;\n    adventurers: AdventurerStoreState[];\n    quests: QuestStoreState[];\n}\n\n// tslint:disable-next-line:no-empty-interface\nexport interface Props {\n}\n\n\nexport const SOURCE_ID = \"tavern\";\n\n// The UI for the tavern\nconst TavernStructureView = (props: Props) => {\n    const gold = useGoldState();\n    const level = useStructureState(Structure.tavern).level;\n    const adventurers = useSelector<StoreState, AdventurerStoreState[]>(store => store.adventurers);\n    const quests = useSelector<StoreState, QuestStoreState[]>(store => store.quests);\n\n    const [assignedAventurers, setAassignedAdventurers] = useState<AdventurerStoreState[]>([]);\n    const [selectedQuest, setSelectedQuest] = useState<string>();\n\n    const structureDefinition = getDefinition<TavernStructureDefinition>(Structure.tavern);\n    const levelDefinition: TavernStructureLevelDefinition = structureDefinition.levels[level];\n    const displayName = TextManager.getStructureName(Structure.tavern);\n\n    const dispatch = useDispatch();\n\n    const onLaunchQuest = (questName: string) => {\n        dispatch(launchQuest(questName, assignedAventurers));\n    };\n\n    const onUpgrade = (cost: number) => {\n        dispatch(subtractGold(cost));\n        dispatch(upgradeStructure(Structure.tavern));  // Todo: [07/07/2019] time??\n\n        dispatch(addLogText(\"log-town-upgrade-structure-complete\", {\n            level: level + 1,\n            structure: Structure.tavern,\n        }, LogChannel.town));\n    };\n\n    const createUpgradeRow = () => {\n\n        const nextLevel = structureDefinition.levels[level + 1];\n        const nextLevelCost = (nextLevel != null ? nextLevel.cost.gold || 0 : -1);\n        const canUpgrade = nextLevel != null && gold >= nextLevelCost;\n        const upgradeText = nextLevel == null ? TextManager.get(\"ui-structure-upgrade-max\") : TextManager.get(\"ui-structure-upgrade\", { cost: nextLevelCost, level: level + 2 });\n\n        const handleClick = (event: React.MouseEvent<HTMLButtonElement>) => {\n            onUpgrade(nextLevelCost);\n        };\n\n        return (\n            <div>\n                <label>{TextManager.get(\"ui-structure-level\")}</label>\n                { `${(level + 1)} / ${structureDefinition.levels.length}` }\n                <Button\n                    className=\"upgrade\"\n                    onClick={handleClick}\n                    disabled={!canUpgrade}>\n                        { upgradeText }\n                </Button>\n            </div>\n        );\n    };\n\n    const getAvailableQuests = quests.filter((q) => q.status === QuestStatus.available );\n\n    const handleQuestClick = (name: string): void => {\n        if (selectedQuest === name) {\n            setSelectedQuest(undefined);\n        } else {\n            setSelectedQuest(name);\n        }\n\n        // Unassign all adventurers\n        setAassignedAdventurers([]);\n    };\n\n    const handleAdventurerDropped = (item: AdventurerAvatarDragInfo, index: number) => {\n        if (item.sourceId === SOURCE_ID) {\n            handleAddAdventurer(item.adventurer, index)\n        }\n    }\n\n    const handleAddAdventurer = (adventurer: AdventurerStoreState, index: number): void => {\n        const copy = [ ...assignedAventurers];\n        copy[index] = adventurer;\n        setAassignedAdventurers(copy);\n    };\n\n    const handleRemoveAdventurer = (adventurer: AdventurerStoreState): void => {\n        const index = assignedAventurers.indexOf(adventurer);\n        const copy = [ ...assignedAventurers];\n        delete copy[index];\n        setAassignedAdventurers(copy);\n    };\n\n    const handleLaunchQuest = (): void => {\n        const questTitle = TextManager.getQuestTitle(selectedQuest!);\n        const leader = assignedAventurers[0];\n        ToastManager.addToast(questTitle, Type.questLaunched, leader?.avatarImg, getQuestLink(selectedQuest!));\n        onLaunchQuest(selectedQuest!);\n    };\n\n    return (\n        <details open={true} className=\"tavernstructureview\">\n            <summary>{displayName}</summary>\n            {createUpgradeRow()}\n            <section>\n                <RoomList\n                    roomCount={levelDefinition.rooms}\n                    adventurers={adventurers}\n                    assignedAventurers={assignedAventurers}\n                    quests={quests}\n                    selectedQuestName={selectedQuest}\n                    onAddAdventurer={handleAddAdventurer}\n                    onRemoveAdventurer={handleRemoveAdventurer}\n                />\n                <QuestBoard\n                    availableQuests={getAvailableQuests}\n                    selectedQuestName={selectedQuest}\n                    assignedAventurers={assignedAventurers}\n                    onQuestClick={(name: string) => handleQuestClick(name)}\n                    onAdventurerDropped={handleAdventurerDropped}\n                    onRemoveAdventurer={handleRemoveAdventurer}\n                    onLaunchQuest={() => handleLaunchQuest()}\n                />\n            </section>\n        </details>\n    );\n};\n\nexport default TavernStructureView;\n","import * as React from \"react\";\nimport { getDefinition, Structure  } from \"definitions/structures\";\nimport { ResourceStructureDefinition, ResourceStructureLevelDefinition } from \"definitions/structures/types\";\nimport UpDownValue from \"../ui/UpDownValue\";\nimport { StructureStoreState } from 'stores/structure';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { StoreState } from 'stores';\nimport { selectFreeWorkers } from 'selectors/workers';\nimport { decreaseWorkers, increaseWorkers } from 'actions/structures';\nimport StructureViewHeader from './StructureViewHeader';\nimport useStructureActions from 'hooks/actions/useStructureActions';\nimport { TextManager } from 'global/TextManager';\nimport Button from 'components/ui/buttons/Button';\nimport './styles/resourceStructureView.scss';\n\nexport interface Props  {\n    type: Structure;\n}\n\nconst ResourceStructureView = (props: Props) => {\n\n    // Fetch needed values from store\n    const gold = useSelector<StoreState, number>((store) => store.gold);\n    const level = useSelector<StoreState, number>((store) => {\n        const structureStore: StructureStoreState = store.structures[props.type];\n        if (!structureStore) { throw new Error(`No structure '${props.type}' found in the store!`); }\n        return structureStore.level;\n    });\n    const workers = useSelector<StoreState, number>((store) => {\n        const structureStore: StructureStoreState = store.structures[props.type];\n        if (!structureStore) { throw new Error(`No structure '${props.type}' found in the store!`); }\n        return structureStore.workers;\n    });\n    const workersFree = useSelector<StoreState, number>((store) => selectFreeWorkers(store));\n\n    const structureDefinition = getDefinition<ResourceStructureDefinition>(props.type);\n    if (!structureDefinition) {\n        throw new Error(`No definition found for structure ${props.type} with type ResourceStructureDefinition.`);\n    }\n    const {startUpgradeStructure} = useStructureActions();\n\n    // Reducer dispatch\n    const dispatch = useDispatch();\n\n    const handleWorkersDown = () => {\n        dispatch(decreaseWorkers(props.type));\n    }\n\n    const handleWorkersUp = () => {\n        dispatch(increaseWorkers(props.type));\n    };\n\n    const levelDefinition: ResourceStructureLevelDefinition = structureDefinition.levels[level];\n\n    const createWorkersRow = () => {\n        const upDisabled = workers === levelDefinition.workerCapacity || (workersFree || 0) < 1;\n        const downDisabled = workers === 0;\n        return (\n            <UpDownValue\n                label={TextManager.get(\"ui-structure-production-workers\")}\n                value={workers}\n                max={levelDefinition.workerCapacity}\n                upDisabled={upDisabled}\n                downDisabled={downDisabled}\n                onDown={handleWorkersDown}\n                onUp={handleWorkersUp}\n            />\n        );\n    };\n\n    const createUpgradeRow = () => {\n        const nextLevel = structureDefinition.levels[level + 1];\n        const nextLevelCost = (nextLevel != null ? nextLevel.cost.gold || 0 : -1);\n        const canUpgrade = nextLevel != null && gold >= nextLevelCost;\n        const upgradeText = nextLevel == null ? TextManager.get(\"ui-structure-upgrade-max\") : TextManager.get(\"ui-structure-upgrade\", { cost: nextLevelCost, level: level + 2 });\n\n        const handleClick = () => {\n            startUpgradeStructure(nextLevelCost, level + 1, props.type);\n        };\n\n        return (\n            <div>\n                <label>\n                    {TextManager.get(\"ui-structure-level\")}\n                </label>\n                {(level + 1) + \" / \" + structureDefinition.levels.length }\n                <Button\n                    className=\"upgrade\"\n                    onClick={handleClick }\n                    disabled= {!canUpgrade } >\n                        {upgradeText }\n                </Button>\n            </div>\n        );\n    };\n\n    const createGeneratesRow = () => {\n        const generates = levelDefinition.generates;\n        const generatesText = Object.keys(generates).reduce((accumulator: string[], value: string) => {\n            // For values that are not 0\n            if (generates[value]) {\n                // tslint:disable-next-line:max-line-length\n                accumulator.push(`${generates[value]} x ${workers} = ${generates[value] * (workers || 0)} ${value}`);\n            }\n            return accumulator;\n        }, []).join(\",\");\n        return <div>\n            {\"Generates (every minute): \" }\n            <br/>\n            {generatesText }\n        </div>;\n    };\n\n    return (\n        <>\n            <StructureViewHeader structure={props.type} />\n            <details open={true} className=\"resource-structure-view\">\n                <section>\n                    {createWorkersRow() }\n                    {createUpgradeRow() }\n                    {createGeneratesRow() }\n                </section>\n            </details>\n        </>\n    );\n};\n\nexport default ResourceStructureView;\n","\nimport { getDefinition, Structure } from \"definitions/structures\";\nimport { StructureDefinition, StructureType } from \"definitions/structures/types\";\nimport * as React from \"react\";\nimport { StructureState } from \"stores/structure\";\nimport { useSelector } from 'react-redux';\nimport { StoreState } from 'stores';\nimport { TasksStoreState } from 'stores/tasks';\nimport useStructureState from 'hooks/store/useStructureState';\nimport { withWindow } from 'hoc/withWindow';\nimport { Props as WindowProps } from \"components/ui/window/Window\";\nimport { formatDuration } from 'utils/format/time';\nimport Progressbar from 'components/ui/Progressbar';\nimport ProductionStructureView from 'components/structures/ProductionStructureView';\nimport WarehouseStructureView from 'components/structures/warehouse/WarehouseStructureView';\nimport TavernStructureView from 'components/structures/tavern/TavernStructureView';\nimport ResourceStructureView from 'components/structures/ResourceStructureView';\nimport \"./styles/structuredetailsview.scss\";\n\nexport interface Props {\n    structure: Structure;\n}\n\nconst StructureDetailsView = (props: Props & WindowProps) => {\n    const tasks = useSelector<StoreState, TasksStoreState>(store => store.tasks);\n    const buildTask = tasks.running.filter((val) =>\n        val.origin === `town` && val.name === `${props.structure}.build`)[0];\n    const structureState = useStructureState(props.structure);\n\n    const renderContent = () => {\n        if (structureState.state === StructureState.Building) {\n            if (!buildTask) return null;\n            return (\n                <div className=\"building\">\n                    <Progressbar\n                        progress={buildTask.progress}\n                        label={`Building... (${formatDuration(buildTask.timeRemaining)})`}\n                    />\n                </div>\n            );\n        } else {\n\n            const structureDefinition: StructureDefinition = getDefinition(props.structure);\n            switch (structureDefinition.type) {\n                case StructureType.production: {\n                    return <ProductionStructureView structure={props.structure}/>;\n                }\n                case StructureType.resource: {\n                    return <ResourceStructureView type={props.structure} />;\n                }\n                case StructureType.warehouse: {\n                    return <WarehouseStructureView />;\n                }\n                case StructureType.tavern: {\n                    return <TavernStructureView />;\n                }\n                default: {\n                    return <div> { props.structure } </div>;\n                }\n            }\n        }\n    }\n\n    return (\n        <div className=\"structure-details\">\n            { renderContent() }\n        </div>\n    );\n};\n\nexport default withWindow(StructureDetailsView);\n","import App, { DispatchProps, Props, StateProps } from \"components/App\";\nimport { Dispatch } from \"react\";\nimport { connect } from \"react-redux\";\nimport { AnyAction } from \"redux\";\nimport { StoreState } from \"stores\";\n\nfunction mapStateToProps(store: StoreState, ownProps: Props): StateProps {\n    return { };\n}\n\nfunction mapDispatchToProps(dispatch: Dispatch<AnyAction>, ownProps: Props): DispatchProps {\n    return { };\n}\n\nexport default connect<StateProps, DispatchProps, Props, StoreState>(mapStateToProps, mapDispatchToProps)(App);\n","import seedrandom from \"seedrandom\";\n\nlet generator: seedrandom.prng;\nexport function init(seed: string) {\n    dirty = true;\n    generator = seedrandom(seed, {state: true});\n}\n\nexport function random(): number {\n    if (!generator) { throw new Error(\"Call init() before random()\"); }\n    dirty = true;\n    return generator();\n}\n\n/**\n * Returns a random integer between min (inclusive) and max (inclusive).\n * The value is no lower than min (or the next integer greater than min\n * if min isn't an integer) and no greater than max (or the next integer\n * lower than max if max isn't an integer).\n */\nexport function randomInt(min: number = 0, max: number = 10) {\n    min = Math.ceil(min);\n    max = Math.floor(max);\n    return Math.floor(random() * (max - min + 1)) + min;\n}\n\nexport function state(): seedrandom.State {\n    dirty = false;\n    return generator.state();\n}\n\nexport let dirty = false;\n","import { getDefinition, Structure } from \"definitions/structures\";\r\nimport { ResourceStructureDefinition, ResourceStructureLevelDefinition, StructureType, WarehouseStructureDefinition, WarehouseStructureLevelDefinition } from \"definitions/structures/types\";\r\nimport { StoreState } from \"stores\";\r\nimport { ResourceStoreState } from \"stores/resources\";\r\nimport { StructuresStoreState } from \"stores/structures\";\r\n\r\n// const RESOURCE_INTERVAL = 60000; // every minute constitutes a resource tick. todo: move to some other shared place\r\nconst RESOURCE_INTERVAL = 20000; // every thirty seconds constitutes a resource tick. todo: move to some other shared place\r\n\r\n /*\r\n  * Calculates how many resources are generated by the in the town.\r\n  * Will return a ResourceStoreState with the amount of each resource to add  */\r\nconst getProducedResources = (lastProducedUpdate: number, store: StoreState): ResourceStoreState|null => {\r\n    const structures: StructuresStoreState = store.structures;\r\n    const result: ResourceStoreState = {};\r\n    const factor = ((Date.now() - lastProducedUpdate) / RESOURCE_INTERVAL);\r\n\r\n    // this function can run at different intervals\r\n    // faster or slower than once a minute\r\n    // we will multiply the resource amount by the factor to normalize\r\n    const maxResources = getMaxResources(store);\r\n\r\n    const handleStructure = (structure: string) => {\r\n        const structureDefinition = getDefinition(structure);\r\n\r\n        if (structureDefinition.type === StructureType.resource) {\r\n            const resourceStructureDefinition = structureDefinition as ResourceStructureDefinition;\r\n            const level: number = structures[structure].level;\r\n            const levelDefinition: ResourceStructureLevelDefinition = resourceStructureDefinition.levels[level];\r\n\r\n            // Store all the resources that this structure will generate this tick into `result`\r\n            Object.keys(levelDefinition.generates).reduce((accumulator: ResourceStoreState, resource: string) => {\r\n                const amount: number = levelDefinition.generates[resource] * structures[structure].workers * factor;\r\n                accumulator[resource] = (accumulator[resource] || 0) + amount;\r\n                return accumulator;\r\n            }, result);\r\n        }\r\n    };\r\n\r\n    if (factor < 1) {\r\n        return null;\r\n    }\r\n    // Calculate what each structure generates. Stores in `result`.\r\n    Object.keys(structures).forEach((structure) => handleStructure(structure));\r\n\r\n    // Check if the warehouse can actually hold it\r\n    Object.keys(result).forEach((resource: string) => {\r\n        if (result[resource]) {\r\n            if (store.resources[resource]! + result[resource]! >= maxResources[resource]!) {\r\n                result[resource] = maxResources[resource]! - (store.resources[resource]!);\r\n            }\r\n        }\r\n        // console.log(`Adding: ${resource} ${result[resource]} factor ${factor}`);\r\n    });\r\n\r\n    return result;\r\n};\r\n\r\n// Returns a ResourceStoreState with maximum stockpile of each resource the warehouse supports\r\nconst getMaxResources = (store: StoreState): ResourceStoreState => {\r\n    const structureDefinition = getDefinition<WarehouseStructureDefinition>(Structure.warehouse);\r\n    const level: number = store.structures[Structure.warehouse].level;\r\n    const levelDefinition: WarehouseStructureLevelDefinition = structureDefinition.levels[level];\r\n    return levelDefinition.maxResources;\r\n};\r\n\r\nexport default getProducedResources;\r\n","import { TextEntry } from \"constants/text\";\nimport questDefinitions from \"definitions/quests\";\nimport { QuestDefinition, QuestNodeType } from 'definitions/quests/types';\n\nimport { Store } from \"redux\";\nimport { StoreState } from \"stores\";\nimport { LogChannel } from \"stores/logEntry\";\nimport { QuestStatus, QuestStoreState } from \"stores/quest\";\nimport { ToastManager } from 'global/ToastManager';\nimport { TextManager } from 'global/TextManager';\nimport { Type } from 'components/ui/toasts/Toast';\nimport { getQuestLeader } from 'storeHelpers';\nimport { getQuestLink } from 'utils/routing';\nimport { setSceneName } from 'actions/quests';\n\nexport interface QuestUpdate {\n    name: string;\n    progress: number;\n}\n\nexport interface LogUpdate extends TextEntry {\n    key: string;\n    channel: LogChannel;\n    channelContext?: any;\n}\n\ninterface QuestGameTickResponse {\n    questUpdates: QuestUpdate[];\n    logUpdates: LogUpdate[];\n}\n\nconst getQuestUpdates = (delta: number, store: Store<StoreState>): QuestGameTickResponse => {\n\n    const speed = 4;    // in nodes per minute\n    const MS_PER_MINUTE = 60000;\n    const log: LogUpdate[] = [];\n    const quests: QuestUpdate[] = [];\n    const state: StoreState = store.getState();\n\n    // Moves the quest line progress. Only if currently at a 'nothing' node\n    // Otherwise the player has to do something to move the quest along\n    state.quests.forEach((quest: QuestStoreState) => {\n        if (quest.status !== QuestStatus.active) {\n            return;\n        }\n        const questDefinition: QuestDefinition = questDefinitions[quest.name];\n        const currentProgress = quest.progress;\n        const currentNodeIndex = Math.floor(currentProgress);\n        const currentNode = questDefinition.nodes[currentNodeIndex];\n\n        if (currentNode.type === QuestNodeType.nothing) {\n            // Currently at a 'nothing' node\n            const progressIncrease = (delta / MS_PER_MINUTE) * speed;\n            // todo: [15/07/2019] speed could be different for each party\n            const nextProgress = Math.min(currentProgress + progressIncrease, questDefinition.nodes.length - 1);\n            const nodesPassed = Math.floor(nextProgress) - currentNodeIndex;\n\n            // console.log(nextProgress, nodesPassed)\n            for (let i = 1; i <= nodesPassed; i++) {\n                // Loop through all the nodes we've passed since last tick\n                const nextNode = questDefinition.nodes[currentNodeIndex + i];\n//                console.log(`next node: ${QuestNodeType[nextNode.type]}`)\n                if (nextNode.type === QuestNodeType.encounter) {\n                    // We've hit an encounter node. set the progress to here and stop looking at other nodes\n\n                    store.dispatch(setSceneName(quest.name, nextNode.startScene!));\n\n                    const questTitle = TextManager.getQuestTitle(quest.name);\n                    const leader = getQuestLeader(state.adventurers, quest);\n                    ToastManager.addToast(questTitle, Type.questEncounter, leader?.avatarImg, getQuestLink(quest.name));\n\n                    // Add quest to log\n                    if (nextNode.log) {\n                        log.push({\n                            channel: LogChannel.quest,\n                            channelContext: quest.name,\n                            key: nextNode.log,\n                        });\n                    }\n\n                    break;\n                } else if (nextNode.type === QuestNodeType.nothing) {\n                    if (nextNode.log) {\n                        log.push({\n                            channel: LogChannel.quest,\n                            channelContext: quest.name,\n                            key: nextNode.log,\n                        });\n                    }\n                }\n            }\n            quests.push({\n                name: quest.name,\n                progress: nextProgress,\n            });\n        }\n    });\n    return {\n        logUpdates: log,\n        questUpdates: quests,\n    };\n};\n\nexport default getQuestUpdates;\n","import { State as seedrandomStateType } from \"seedrandom\";\nimport * as Random from \"utils/random\";\n\nconst getRngState = (): seedrandomStateType | null => {\n    if (Random.dirty) {\n        return Random.state();\n    }\n    return null;\n};\n\nexport default getRngState;\n","// tslint:disable:no-console\n// In production, we register a service worker to serve assets from local cache.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on the 'N+1' visit to a page, since previously\n// cached resources are updated in the background.\n\n// To learn more about the benefits of this model, read https://goo.gl/KwvDNy.\n// This link also includes instructions on opting out of this behavior.\n\nconst isLocalhost = Boolean(\n  window.location.hostname === \"localhost\" ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === \"[::1]\" ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/,\n    ),\n);\n\nexport default function register() {\n  if (process.env.NODE_ENV === \"production\" && \"serviceWorker\" in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL!,\n      window.location.toString(),\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebookincubator/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener(\"load\", () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Lets check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            \"This web app is being served cache-first by a service \" +\n              \"worker. To learn more, visit https://goo.gl/SC7cgQ\",\n          );\n        });\n      } else {\n        // Is not local host. Just register service worker\n        registerValidSW(swUrl);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then((registration) => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker) {\n          installingWorker.onstatechange = () => {\n            if (installingWorker.state === \"installed\") {\n              if (navigator.serviceWorker.controller) {\n                // At this point, the old content will have been purged and\n                // the fresh content will have been added to the cache.\n                // It's the perfect time to display a 'New content is\n                // available; please refresh.' message in your web app.\n                console.log(\"New content is available; please refresh.\");\n              } else {\n                // At this point, everything has been precached.\n                // It's the perfect time to display a\n                // 'Content is cached for offline use.' message.\n                console.log(\"Content is cached for offline use.\");\n              }\n            }\n          };\n        }\n      };\n    })\n    .catch((error) => {\n      console.error(\"Error during service worker registration:\", error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then((response) => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      if (\n        response.status === 404 ||\n        response.headers.get(\"content-type\")!.indexOf(\"javascript\") === -1\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then((registration) => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl);\n      }\n    })\n    .catch(() => {\n      console.log(\n        \"No internet connection found. App is running in offline mode.\",\n      );\n    });\n}\n\nexport function unregister() {\n  if (\"serviceWorker\" in navigator) {\n    navigator.serviceWorker.ready.then((registration) => {\n      registration.unregister();\n    });\n  }\n}\n","// tslint:disable:object-literal-sort-keys\nimport { ActionType,\n    AssignEquipmentAction,\n    InventoryAction,\n    MoveItemInInventoryAction,\n    MoveItemToOtherAdventurerAction, RemoveEquipmentAction, RemoveItemFromInventoryAction } from \"actions/adventurers\";\nimport { EquipmentSlotType } from \"components/ui/EquipmentSlot\";\nimport { Item } from \"definitions/items/types\";\nimport { AnyAction, Reducer } from \"redux\";\nimport { AdventurerStoreState, BasicAttributesStoreState } from \"stores/adventurer\";\nimport { Trait } from 'definitions/traits/types';\nimport { WeaponType } from 'definitions/items/weapons';\n\n/**\n * reducer\n * @param state\n * @param action\n */\nconst generateRandomAttributes = (): BasicAttributesStoreState => {\n    return {\n        strength: Math.floor(Math.random() * 3) + 9,\n        dexterity: Math.floor(Math.random() * 3) + 9,\n        intelligence: Math.floor(Math.random() * 3) + 9,\n        health: Math.floor(Math.random() * 3) + 9\n    };\n};\n\nconst avatarImgBasePath = \"img/avatars\";\nconst spritesheetBasePath = \"img/scene/actors/\";\n\n// Create a bunch of guys for debugging\nconst testState: AdventurerStoreState[] = [{\n    id: \"c4a5d270\",\n    equipment: {\n        head: Item.cowl,\n        chest: Item.chest,\n        hands: Item.clothGloves,\n        shoulders: Item.shoulders2,\n        legs: Item.pants2,\n        feet: Item.boots3,\n        offHand: Item.indomitableCarapace\n    },\n    basicAttributes: generateRandomAttributes(),\n    health: Math.random() * 100,\n    xp: Math.random() * 100,\n    baseAP: 6,\n    room: 0,\n    name: \"Ximena Maddox\",\n    traits: [Trait.houseMaddox, Trait.gloomy],\n    avatarImg: `${avatarImgBasePath}/female/f_14.png`,\n    spritesheetPath: `${spritesheetBasePath}archer.json`,\n    skills: {\n        [WeaponType.crossbow]: 10,\n        [WeaponType.bow]: 10\n    },\n    // tslint:disable-next-line:max-line-length\n    inventory: [ Item.deedForLumbermill, null, Item.simpleCrossbow, Item.dagger, Item.khopesh, null, Item.sword, null,  null,  null,  null,  Item.steelShield,  null,  null,  null,  null],\n}, {\n    id: \"2e655832\",\n    equipment: {\n        feet: Item.boots2\n    },\n    basicAttributes: generateRandomAttributes(),\n    name: \"Donte Houston\",\n    health: Math.random() * 100,\n    xp: Math.random() * 100,\n    baseAP: 6,\n    room: 1,\n    avatarImg: `${avatarImgBasePath}/male/m_05.png`,\n    spritesheetPath: `${spritesheetBasePath}footman.json`,\n    traits: [Trait.houseHouston],\n    skills: {\n        [WeaponType.crossbow]: 12,\n        [WeaponType.staff]: 13\n    },\n    // tslint:disable-next-line:max-line-length\n    inventory: [ Item.simpleCrossbow, null, null, null, null, Item.boots1, Item.chainmailHood, Item.nomadHelmet, Item.plateChest4, null, Item.buckler, null, null, null,  null,  null,  null,  null,  null,  null,  null,  null, Item.plateHelmet, Item.cowl],\n}, {\n    id: \"ec6f1050\",\n    equipment: {\n        feet: Item.boots3,\n        offHand: Item.aegisOfValor\n    },\n    basicAttributes: generateRandomAttributes(),\n    name: \"Zackary 'bone bag' Morris\",\n    health: Math.random() * 100,\n    xp: Math.random() * 100,\n    baseAP: 5,\n    room: 2,\n    traits: [Trait.gloomy],\n    skills: {\n        [WeaponType.sword]: 12,\n        [WeaponType.hammer]: 6\n    },\n    avatarImg: `${avatarImgBasePath}/male/m_09.png`,\n    spritesheetPath: `${spritesheetBasePath}skeleton.json`,\n    inventory: [ Item.greatswordOfGwai, null, null, null, Item.berserkerShield ],\n}, {\n    id: \"d299f98a\",\n    basicAttributes: generateRandomAttributes(),\n    equipment: {},\n    name: \"Mike Keith\",\n    health: Math.random() * 100,\n    xp: Math.random() * 100,\n    baseAP: 6,\n    room: 4,\n    avatarImg: `${avatarImgBasePath}/male/m_19.png`,\n    spritesheetPath: `${spritesheetBasePath}grunt.json`,\n    traits: [Trait.arrowFinder],\n    skills: {\n        [WeaponType.sword]: 13\n    },\n    inventory: [ null, null, null, null, Item.khopesh, Item.hornedHelmet, Item.woodenBulwark ],\n}, {\n    id: \"96c686c3\",\n    equipment: {},\n    basicAttributes: generateRandomAttributes(),\n    name: \"Wayne Monroe\",\n    health: Math.random() * 100,\n    xp: Math.random() * 100,\n    baseAP: 4,\n    room: 5,\n    avatarImg: `${avatarImgBasePath}/male/m_08.png`,\n    spritesheetPath: `${spritesheetBasePath}grunt.json`,\n    traits: [Trait.houseMonroe, Trait.arrowFinder],\n    skills: {\n        [WeaponType.axe]: 12\n    },\n    inventory: [ null, null, null, Item.goldenShield ],\n}, {\n    id: \"250d1a9d\",\n    basicAttributes: generateRandomAttributes(),\n    equipment: {},\n    name: \"Alexis Ortiz \",\n    health: Math.random() * 100,\n    xp: Math.random() * 100,\n    baseAP: 5,\n    room: 9,\n    avatarImg: `${avatarImgBasePath}/female/f_10.png`,\n    spritesheetPath: `${spritesheetBasePath}footman.json`,\n    inventory: [ null, null, null, null, null ],\n    skills: {\n        [WeaponType.axe]: 10\n    },\n}, {\n    id: \"169384ef\",\n    equipment: {},\n    basicAttributes: generateRandomAttributes(),\n    name: \"Karlee Nolan\",\n    health: Math.random() * 100,\n    xp: Math.random() * 100,\n    baseAP: 5,\n    room: 3,\n    avatarImg: `${avatarImgBasePath}/female/f_16.png`,\n    spritesheetPath: `${spritesheetBasePath}footman.json`,\n    inventory: [ Item.greatswordOfGwai, null, null, null ],\n    skills: {\n        [WeaponType.axe]: 10\n    },\n}, {\n    id: \"f22d66cb\",\n    basicAttributes: generateRandomAttributes(),\n    equipment: {},\n    name: \"Gylbarde the Earnest\",\n    health: Math.random() * 100,\n    xp: Math.random() * 100,\n    baseAP: 5,\n    room: 8,\n    avatarImg: `${avatarImgBasePath}/male/m_09.png`,\n    spritesheetPath: `${spritesheetBasePath}footman.json`,\n    inventory: [ null, null, null, null, null ],\n    skills: {\n        [WeaponType.axe]: 13\n    },\n}, {\n    id: \"36c686c1\",\n    equipment: {},\n    basicAttributes: generateRandomAttributes(),\n    name: \"Lanslet of the Water\",\n    health: Math.random() * 100,\n    xp: Math.random() * 100,\n    baseAP: 6,\n\n    room: 6,\n    avatarImg: `${avatarImgBasePath}/male/m_26.png`,\n    spritesheetPath: `${spritesheetBasePath}footman.json`,\n    inventory: [ Item.greatswordOfGwai, null, null, null, Item.shoulders1, Item.fedora, Item.greaves2 ],\n    skills: {\n        [WeaponType.axe]: 3\n    },\n}, {\n    id: \"12c613d4\",\n    equipment: {},\n    basicAttributes: generateRandomAttributes(),\n    name: \"Tedric the Bold\",\n    health: Math.random() * 100,\n    xp: Math.random() * 100,\n    baseAP: 6,\n    room: 7,\n    avatarImg: `${avatarImgBasePath}/male/m_33.png`,\n    spritesheetPath: `${spritesheetBasePath}footman.json`,\n    inventory: [ Item.greatswordOfGwai, null, null, null ],\n    skills: {\n        [WeaponType.axe]: 10\n    },\n}];\n\n// TODO: To generate a random 11 digit number, use: Math.random().toString(36).substring(2)\n\nexport const adventurers: Reducer<AdventurerStoreState[], AnyAction> = (\n    state: AdventurerStoreState[] = testState, action: AnyAction) => {\n\n    switch (action.type) {\n        // Moves an  item from one inventory slot to another\n        case ActionType.moveItemInInventory: {\n            const {\n                adventurerId,\n                fromSlot,\n                toSlot,\n            } = (action as MoveItemInInventoryAction);\n            const adventurer = state.find((a) => a.id === adventurerId)!;\n            const inventory = adventurer.inventory.map((element, index) => {\n                if (index === fromSlot) { return adventurer.inventory[toSlot]; }\n                if (index === toSlot) { return adventurer.inventory[fromSlot]; }\n                return element;\n            });\n\n            return state.map((element: AdventurerStoreState) => {\n                if (element === adventurer) {\n                    return {\n                        ...element,\n                        inventory,\n                    };\n                }\n                return element;\n            });\n        }\n\n        case ActionType.moveItemToOtherAdventurer: {\n            // Moves an item from one adventurer to another\n            const {\n                adventurerId: fromAdventurerId,\n                fromSlot,\n                toAdventurerId,\n            } = (action as MoveItemToOtherAdventurerAction);\n\n            const fromAdventurer = state.find((a) => a.id === fromAdventurerId)!;\n            const item = fromAdventurer.inventory[fromSlot];\n\n            return state.map((element: AdventurerStoreState) => {\n                if (element.id === fromAdventurerId) {\n                    // Clear out the item from this adventurer\n                    const inventory = element.inventory.concat();\n                    inventory[fromSlot] = null;\n                    return {\n                        ...element,\n                        inventory,\n                    };\n                } else if (element.id === toAdventurerId) {\n                    // Find first empty slot, add there\n                    const inventory = element.inventory.concat();\n                    const index = inventory.findIndex((slot) => slot === null);\n                    inventory[index] = item;\n                    // todo: what if there is no room?\n                    return {\n                        ...element,\n                        inventory,\n                    };\n                }\n                return element;\n            });\n        }\n\n        case ActionType.addItemToInventory: {\n            const { item } = action as InventoryAction;\n\n            return state.map((element: AdventurerStoreState) => {\n                if (element.id === action.adventurerId) {\n                    const inventory = element.inventory.concat();\n                    let toSlot = (action as InventoryAction).toSlot;\n                    if (toSlot === null || toSlot === undefined) {\n                        toSlot = inventory.findIndex((val) => (val === null || val === undefined));\n                    }\n                    inventory[toSlot!] = item;\n                    // todo: check if no space\n                    return {\n                        ...element,\n                        inventory,\n                    };\n                }\n                return element;\n            });\n        }\n\n        case ActionType.removeItemFromInventory: {\n            const { fromSlot } = action as RemoveItemFromInventoryAction;\n\n            return state.map((adventurer: AdventurerStoreState) => {\n                if (adventurer.id === action.adventurerId) {\n                    const inventory = adventurer.inventory.map((element, index) => index !== fromSlot ? element : null);\n                    return {\n                        ...adventurer,\n                        inventory,\n                    };\n                }\n                return adventurer;\n            });\n        }\n\n        case ActionType.assignEquipment: {\n            // Assigns equipment to an adventurer\n            const { equipmentSlot, item } = action as AssignEquipmentAction;\n            return state.map((adventurer: AdventurerStoreState) => {\n                if (adventurer.id === action.adventurerId) {\n                    return {\n                        ...adventurer,\n                        equipment: {\n                            ...adventurer.equipment,\n                            [EquipmentSlotType[equipmentSlot]]: item,\n                        },\n                    };\n                }\n                return adventurer;\n            });\n        }\n\n        case ActionType.removeEquipment: {\n            // Assigns equipment to an adventurer\n            const { equipmentSlot } = action as RemoveEquipmentAction;\n            return state.map((adventurer: AdventurerStoreState) => {\n                if (adventurer.id === action.adventurerId) {\n                    return {\n                        ...adventurer,\n                        equipment: {\n                            ...adventurer.equipment,\n                            [EquipmentSlotType[equipmentSlot]]: null,\n                        },\n                    };\n                }\n                return adventurer;\n            });\n        }\n\n    }\n\n    // debug: this will auto-increase the levels of every adventurer at every tick\n    // return state.map((adventurer: AdventurerStoreState) => {\n    //     return {\n    //         ...adventurer,\n    //         xp: adventurer.xp + 1\n    //     };\n    // });\n\n    return state;\n};\n","import updateCombat from \"mechanics/gameTick/combat\";\r\nimport * as React from \"react\";\r\nimport * as ReactDOM from \"react-dom\";\r\nimport { Provider } from \"react-redux\";\r\nimport { Store, AnyAction } from \"redux\";\r\nimport { Persistor } from \"redux-persist\";\r\nimport { gameTick } from \"./actions/game\";\r\nimport { addLogText } from \"./actions/log\";\r\nimport version from \"./constants/version\";\r\nimport App from \"./containers/App\";\r\nimport getProducedResources from \"./mechanics/gameTick/producedResources\";\r\nimport getQuestUpdates, { LogUpdate } from \"./mechanics/gameTick/quests\";\r\nimport getRngState from \"./mechanics/gameTick/rngState\";\r\nimport registerServiceWorker from \"./registerServiceWorker\";\r\nimport { StoreState } from \"./stores\";\r\nimport configureStore from \"./utils/configureStore\";\r\nimport * as Random from \"./utils/random\";\r\nimport { TextManager } from \"./global/TextManager\";\r\nimport { loadResourceAsync } from 'utils/pixiJs';\r\nimport { processCompletedTasks } from 'mechanics/gameTick/tasks';\r\nimport localforage from 'localforage';\r\nimport \"./index.css\";\r\n\r\n// Todo: Refactor into class\r\nconst TICK_INTERVAL = 2500;\r\nlet persistor: Persistor;\r\n\r\nconst initGame = async () => {\r\n    const texts = await loadResourceAsync(`${process.env.PUBLIC_URL}/lang/en-US.json`);\r\n    TextManager.init(texts.data);\r\n    Random.init(\"GILLESROX2\");\r\n\r\n    readPersistedStore();\r\n};\r\n\r\n/**\r\n * Attemps to read persisted store state. Calls `runGame`\r\n */\r\nconst readPersistedStore = async () => {\r\n    const storeConfiguration = await configureStore();\r\n    const { store, isHydrated } = storeConfiguration;\r\n    persistor = storeConfiguration.persistor;\r\n\r\n    if (!isHydrated) {\r\n        startNewGame(store);\r\n    } else {\r\n        continueGame(store);\r\n    }\r\n    runGame(store);\r\n}\r\n\r\n/**\r\n * Gets called when a player starts a new game\r\n * @param store\r\n */\r\nconst startNewGame = (store: any) => {\r\nconsole.log(\"STARTING NEW GAME\")\r\n    store.dispatch(addLogText(\"test-game-welcome\"));\r\n    // todo: here is a good place to launch a tutorial or something\r\n\r\n    // tslint:disable-next-line:no-console\r\n    console.log(`Starting new GILLES-IDLE-GAME (version ${version})`);\r\n};\r\n\r\n\r\n/**\r\n * Continue playing earlier persisted store\r\n * @param store\r\n */\r\nconst continueGame = (store: any) => {\r\n    // tslint:disable-next-line:no-console\r\n    console.log(`Continuing existing GILLES-IDLE-GAME (version ${version})`);\r\n};\r\n\r\n/**\r\n * Loads a saved game from disks\r\n */\r\nconst loadGame = async (state: StoreState) => {\r\n    // todo: implement in MenuWindow!\r\n    await persistor.purge();\r\n    const { store } = await configureStore(state);\r\n    runGame(store);\r\n\r\n    // We have to cause the page to reinitialize and all react components to remount\r\n    // eslint-disable-next-line no-restricted-globals\r\n    location.href = '#/world/'; // todo: load path from metadata '#/world/kill10Boars';\r\n}\r\n\r\nconst restartGame = () => {\r\n    // eslint-disable-next-line no-restricted-globals\r\n    if(confirm('Are you sure you wish to reset all your progress?')){\r\n        clearTimeout(interval);\r\n        persistor.purge();\r\n        localforage.clear();\r\n\r\n        readPersistedStore();\r\n        // eslint-disable-next-line no-restricted-globals\r\n        location.href = \"#/town\"\r\n    }\r\n}\r\n\r\n// const stopGame = () => {\r\n//     clearTimeout(interval);\r\n// };\r\n\r\nlet interval: NodeJS.Timeout;\r\nconst runGame = (store: Store<StoreState, AnyAction>) => {\r\n    clearTimeout(interval);\r\n\r\n    ReactDOM.render((\r\n        <Provider store={store}>\r\n            <App persistor={persistor} />\r\n        </Provider>\r\n        ),\r\n        document.getElementById(\"root\") as HTMLElement,\r\n    );\r\n    registerServiceWorker();\r\n\r\n    const gameLoop = () => {\r\n        const state: StoreState = store.getState();\r\n        const delta = Date.now() - state.engine.lastTick;\r\n\r\n        const logs: LogUpdate[] = [];\r\n        const resourcesUpdates = getProducedResources(state.engine.lastProducedUpdate, state);\r\n        const rngState = getRngState();\r\n        updateCombat(delta, store);\r\n        const { questUpdates, logUpdates } = getQuestUpdates(delta, store);\r\n        logs.push(...logUpdates);\r\n\r\n        store.dispatch(gameTick(delta, rngState, resourcesUpdates, questUpdates, logs));\r\n\r\n        processCompletedTasks(state.tasks, store.dispatch);\r\n\r\n        // store.dispatch(addLogEntry(\"test-you-have-found-an-item\", LogChannel.common, { item: Item.teeth }));\r\n    };\r\n\r\n    interval = setInterval(gameLoop, TICK_INTERVAL);\r\n};\r\nexport {runGame, restartGame, loadGame};\r\n\r\ninitGame();\r\n","// tslint:disable:object-literal-sort-keys\r\n\r\nexport interface EngineStoreState {\r\n    lastTick: number;\r\n    lastProducedUpdate: number;\r\n}\r\n\r\nexport const initialState: EngineStoreState = {\r\n    lastTick: Date.now(),\r\n    lastProducedUpdate: Date.now()\r\n};\r\n","\r\nimport {  ActionType, AddAction, MoveItemInWarehouseAction, RemoveItemFromWarehouseAction } from \"actions/items\";\r\nimport { Item } from \"definitions/items/types\";\r\nimport { AnyAction, Reducer } from \"redux\";\r\n\r\nconst testState = [\r\n    null,\r\n    null,\r\n    null,\r\n    Item.dagger,\r\n    Item.deedForWeaponsmith,\r\n    null,\r\n    Item.sandwich,\r\n    Item.sandwich,\r\n    null,\r\n    null,\r\n    Item.torch,\r\n    Item.torch,\r\n    null,\r\n    Item.torch\r\n];\r\n\r\n// Items in warehouse\r\n\r\n/**\r\n * reducer\r\n * @param state\r\n * @param action\r\n */\r\nexport const items: Reducer<(Item|null)[]> = (state: (Item|null)[] = testState,\r\n                                                 action: AnyAction) => {\r\n    switch (action.type) {\r\n        case ActionType.addItem: {\r\n            // toSlot is optional\r\n            const { item } = (action as AddAction);\r\n            let { toSlot } = (action as AddAction);\r\n            if (toSlot === undefined) {\r\n                toSlot = state.findIndex((slot) => slot === null);  // find first empty element\r\n                if (toSlot === -1) {\r\n                    // Still not found. Add at end\r\n                    // todo: [07/07/2019] GAME DESIGN\r\n                    return [ ...state, item ];\r\n                }\r\n            }\r\n            return state.map((element, index) => index === toSlot ? item : element);\r\n        }\r\n\r\n        case ActionType.moveItemInWarehouse: {\r\n            const {\r\n                fromSlot,\r\n                toSlot,\r\n            } = (action as MoveItemInWarehouseAction);\r\n\r\n            return state.map((element, index) => {\r\n                if (index === fromSlot) { return state[toSlot]; }\r\n                if (index === toSlot) { return state[fromSlot]; }\r\n                return element;\r\n            });\r\n        }\r\n        case ActionType.removeItem: {\r\n            const { fromSlot } = (action as RemoveItemFromWarehouseAction);\r\n\r\n            return state.map((element, index) => index !== fromSlot ? element : null);\r\n        }\r\n    }\r\n\r\n    return state;\r\n};\r\n","import { ActionType as GameActionType, GameTickAction } from \"actions/game\";\nimport { ActionType, AddLogEntryAction } from \"actions/log\";\nimport { LogUpdate } from \"mechanics/gameTick/quests\";\nimport { AnyAction, Reducer } from \"redux\";\nimport { LogEntry } from \"stores/logEntry\";\n\n/**\n * reducer\n * @param state\n * @param action\n */\nexport const log: Reducer<LogEntry[]> = (state: LogEntry[] = [], action: AnyAction) => {\n    switch (action.type) {\n        case ActionType.addLogEntry:\n            const {entry, channel, channelContext} = (action as AddLogEntryAction);\n            const {key, context} = entry;\n            const time = Date.now();\n            return [{\n                    channel,\n                    channelContext,\n                    context,\n                    key,\n                    time,\n                },\n                ...state,\n            ];\n\n        case GameActionType.gameTick:\n            return gameTick(state, action as GameTickAction);\n    }\n    return state;\n};\n\nconst gameTick = (state: LogEntry[], action: GameTickAction): LogEntry[] => {\n    if (!action.log.length) {\n        return state;\n    }\n\n    // Add log entries\n    const logEntries = action.log.map((lU: LogUpdate): LogEntry => {\n        return {\n            ...lU,\n            time: Date.now(),\n        };\n    });\n    return [\n        ...logEntries,\n        ...state,\n    ];\n};\n","import { ActionType as GameActionType, GameTickAction } from \"actions/game\";\nimport {\n    ActionType,\n    QuestAction,\n    QuestLaunchAction,\n    QuestVarsAction,\n    UpdateEncounterResultAction,\n    EnqueueSceneActionAction,\n    SetSceneNameAction,\n    SetSceneAction,\n    UpdateSceneObjectAction,\n    SetActiveSceneInteractionModalAction,\n    DeductActorApAction\n} from \"actions/quests\";\nimport { Item } from \"definitions/items/types\";\nimport { AnyAction, Reducer } from \"redux\";\nimport { QuestStatus, QuestStoreState } from \"stores/quest\";\nimport { SceneActionType } from 'stores/scene';\nimport { QuestDefinition } from 'definitions/quests/types';\nimport { getDefinition } from 'definitions/quests';\nimport { initialQuestVars } from 'definitions/quests/kill10Boars/questVars';\n\n// tslint:disable:object-literal-sort-keys\nconst initialState: QuestStoreState[] = [{\n    name: \"kill10Boars\",\n    status: QuestStatus.active,\n    party: [\n        \"c4a5d270\",\n        \"2e655832\",\n        \"ec6f1050\",\n        \"d299f98a\",\n    ],\n    progress: 0,\n    questVars: initialQuestVars,\n    encounterResults: [],\n    icon: \"sigil1.png\",\n}, {\n    name: \"retrieveMagicAmulet\",\n    party: [],\n    status: QuestStatus.available,\n    progress: 0,\n    questVars: {},\n    encounterResults: [],\n    icon: \"sigil2.png\",\n    reward: {\n        gold: 4,\n        items: [ Item.deedForWeaponsmith ],\n    },\n}];\n\n/**\n * reducer\n * @param state\n * @param action\n */\nexport const quests: Reducer<QuestStoreState[]> = (state: QuestStoreState[] = initialState, action: AnyAction ) => {\n    switch (action.type) {\n        case ActionType.launchQuest:\n            return launchQuest(state, action as QuestLaunchAction);\n\n        case ActionType.exitEncounter:\n            return exitEncounter(state, action as QuestAction);\n\n        case ActionType.updateQuestVars:\n            // Updates the questvars\n            return updateQuestVars(state, action as QuestVarsAction);\n\n        case ActionType.updateEncounterResult:\n            return updateEncounterResult(state, action as UpdateEncounterResultAction);\n\n        // case ActionType.startEncounter:\n        //     return startEncounter(state, action as StartEncounterAction);\n\n        case ActionType.setSceneName:\n            return setSceneName(state, action as SetSceneNameAction);\n\n        case ActionType.setScene:\n            return setScene(state, action as SetSceneAction);\n\n        case ActionType.enqueueSceneAction:\n            return enqueueSceneAction(state, action as EnqueueSceneActionAction);\n\n        case ActionType.completeSceneAction:\n            return completeSceneAction(state, action as QuestAction);\n\n        case ActionType.deductActorAp:\n            return deductActorAp(state, action as DeductActorApAction);\n\n        case ActionType.updateSceneObjectAction:\n            return updateSceneObjectAction(state, action as UpdateSceneObjectAction);\n\n        case ActionType.setActiveSceneInteractionModal:\n            return setActiveSceneInteractionModal(state, action as SetActiveSceneInteractionModalAction);\n\n        case GameActionType.gameTick:\n           return gameTick(state, action as GameTickAction);\n\n    }\n    return state;\n};\n\n// Launches quest. Sets state to active, assigns adventurers\nconst launchQuest = (questStoreState: QuestStoreState[], action: QuestLaunchAction) => {\n    const party = action.assignedAventurers\n        .filter((adventurer) => !!adventurer)\n        .map((adventurer) => adventurer.id);\n\n    return questStoreState.map((qss) => {\n        if (qss.name === action.questName) {\n            const questDefinition: QuestDefinition = getDefinition(action.questName);\n            const questVars = questDefinition.getInitialQuestVars(qss);\n\n            return {\n                ...qss,\n                status: QuestStatus.active,\n                party,\n                questVars\n            };\n        }\n        return qss;\n    });\n};\n\nconst exitEncounter = (state: QuestStoreState[], action: QuestAction) => {\n    return state.map((qss) => {\n        if (qss.name === action.questName) {\n            const progress = qss.progress + 1;\n            // const questDefinition: QuestDefinition = questDefinitions[qss.name];\n            // const nextNode = questDefinition.nodes[Math.floor(progress)];\n\n            return {\n                ...qss,\n                progress,\n                scene: undefined,\n                sceneName: undefined\n            };\n        }\n        return qss;\n    });\n};\n\n// const startEncounter = (state: QuestStoreState[], action: StartEncounterAction) => {\n//     const {scene} = action;\n//     return state.map((qss) => {\n//         if (qss.name === action.questName) {\n//             return {\n//                 ...qss,\n//                 scene\n//             };\n//         }\n//         return qss;\n//     });\n// };\n\n// To change scene, set scene name. The scenecontroller will load the scene data and art assets\n// and call setScene reducer\nconst setSceneName = (state: QuestStoreState[], action: SetSceneNameAction) => {\n    return state.map((qss) => {\n        if (qss.name === action.questName) {\n            return {\n                ...qss,\n                sceneName: action.sceneName,\n                scene: undefined\n            };\n        }\n        return qss;\n    });\n};\n\nconst setScene = (state: QuestStoreState[], action: SetSceneAction) => {\n    return state.map((qss) => {\n        if (qss.name === action.questName) {\n            return {\n                ...qss,\n                scene: action.scene\n            };\n        }\n        return qss;\n    });\n};\n\n// Enqueues a scene action on this quest\nconst enqueueSceneAction = (state: QuestStoreState[], action: EnqueueSceneActionAction) => {\n    return state.map((qss) => {\n        if (qss.name === action.questName) {\n            const scene = qss.scene;\n            if (!scene) throw new Error(\"Something broke. No scene\");\n            scene.actionQueue = [...scene.actionQueue || [], action.sceneAction];\n\n            return {\n                ...qss,\n                scene\n            };\n        }\n        return qss;\n    });\n};\n\n// Action on scene is completed\nconst completeSceneAction = (state: QuestStoreState[], action: QuestAction) => {\n    return state.map((qss) => {\n        if (qss.name === action.questName) {\n            const scene = qss.scene;\n            if (!scene) throw new Error(\"Something broke. No scene\");\n            const sceneAction = scene.actionQueue![0];\n            if (!sceneAction) return qss;\n\n            switch (sceneAction.actionType) {\n                case SceneActionType.move: {\n                    scene.actors = scene.actors.map((a) => {\n                        if (a.name === sceneAction.actor) {\n                            return { ...a, location: sceneAction.target };\n                        }\n                        return a;\n                    })\n                }\n            }\n\n            // pop first action of the stack\n            scene.actionQueue = [\n                ...scene.actionQueue!.slice(1)\n            ];\n\n            return {\n                ...qss,\n                scene\n            };\n        }\n        return qss;\n    });\n};\n\nconst deductActorAp = (state: QuestStoreState[], action: DeductActorApAction) => {\n    return state.map((qss) => {\n        if (qss.name === action.questName) {\n            const scene = qss.scene;\n            if (!scene) throw new Error(\"Something broke. No scene\");\n\n            scene.actors = scene.actors.map(a => {\n                if (a.name === action.actor) {\n                    const ap = a.ap - action.ap;\n                    return {\n                        ...a,\n                        ap\n                    };\n                }\n                return a;\n            })\n\n            return {\n                ...qss,\n                scene\n            };\n        }\n        return qss;\n    });\n}\n\nconst updateSceneObjectAction = (state: QuestStoreState[], action: UpdateSceneObjectAction) => {\n    return state.map((qss) => {\n        if (qss.name === action.questName) {\n            const scene = qss.scene;\n            if (!scene) throw new Error(\"Something broke. No scene\");\n\n            scene.objects = scene.objects.map(tO => {\n                if (tO.id === action.id) {\n                    return {\n                        ...tO,\n                        ...action.object\n                    }\n                }\n                return tO;\n            })\n\n            return {\n                ...qss,\n                scene\n            };\n        }\n        return qss;\n    });\n}\n\n\nconst gameTick = (state: QuestStoreState[], action: GameTickAction) => {\n    const questsToUpdate = action.quests;\n    if (!questsToUpdate.length) {\n        return state;\n    }\n\n    return state.map((qss) => {\n        const questToUpdate = questsToUpdate.find((q) => q.name === qss.name);\n        if (questToUpdate) {\n            const progress = questToUpdate.progress;\n            // const currentEncounter = questToUpdate.currentEncounter;\n\n            return {\n                ...qss,\n                progress,\n                // currentEncounter,\n            };\n        }\n        return qss;\n    });\n};\n\nconst updateQuestVars = (state: QuestStoreState[], action: QuestVarsAction)  => {\n    return state.map((qss) => {\n        if (qss.name === action.questName) {\n            const questVars = Object.assign({}, qss.questVars, action.vars);\n            return {\n                ...qss,\n                questVars,\n            };\n        }\n        return qss;\n    });\n};\n\nconst updateEncounterResult = (state: QuestStoreState[], action: UpdateEncounterResultAction)  => {\n    return state.map((qss: QuestStoreState) => {\n        if (qss.name === action.questName) {\n            const encounterResults = qss.encounterResults.concat();\n            encounterResults[action.nodeIndex] = action.result;\n            return {\n                ...qss,\n                encounterResults,\n            };\n        }\n        return qss;\n    });\n};\n\nconst setActiveSceneInteractionModal = (state: QuestStoreState[], action: SetActiveSceneInteractionModalAction) => {\n    return state.map((qss: QuestStoreState) => {\n        if (qss.name === action.questName && qss.scene) {\n            qss.scene.activeInteractionModal = action.sceneInteractionModal\n        }\n        return qss;\n    });\n}\n\n// const takeGoldFromCache = (state: QuestStoreState[], action: TakeGoldFromCacheAction) => {\n//     return state.map((qss: QuestStoreState) => {\n//         if (qss.name === action.questName && qss.scene) {\n//             const lootCaches = {\n//                 ...qss.scene?.caches,\n//                 [action.cacheName]: {\n//                     ...qss.scene?.caches[action.cacheName],\n//                     gold: 0\n//                 }\n//             }\n//             qss.scene.caches = lootCaches;\n//         }\n//         return qss;\n//     });\n// }\n\n// const takeItemFromCache = (state: QuestStoreState[], action: TakeItemFromCacheAction) => {\n//     return state.map((qss: QuestStoreState) => {\n//         if (qss.name === action.questName && qss.scene) {\n//             const cache = qss.scene.caches[action.cacheName];\n//             const index = cache.items.indexOf(action.item);\n//             if (index > -1 ) {\n//                 qss.scene.caches[action.cacheName].items = [\n//                     ...cache.items.slice(0, index),\n//                     ...cache.items.slice(index + 1)\n//                 ]\n//             }\n//         }\n//         return qss;\n//     });\n// }\n\n// // Call this when the quest has progressed a node. Will return either `log` or a new array\n// // with all values of `log` and a new value appended\n// const addLogMessage = (log: string[],\n//                        currentNode: QuestNode, nextNode: QuestNode, quest: QuestStoreState): string[] => {\n//     if (currentNode.type === QuestNodeType.nothing && nextNode.type === QuestNodeType.nothing) {\n//         // Moved from a 'nothing' node to a 'nothing' node\n//         // There is no need to flood the log with unimportant messages\n//         return log;\n//     }\n//     switch (nextNode.type) {\n//         case QuestNodeType.nothing:\n//             return [\n//                 ...log,\n//                 \"The party trrrudges on\",\n//             ];\n//         case QuestNodeType.encounter:\n//             const encounter = nextNode.encounter!;\n//             console.log(encounter.getDescription(oracle))\n//             //return log;\n//             return [\n//                 ...log,\n//                 encounter.getDescription(oracle),\n//             ]\n//         default:\n//             return log;\n//     }\n// }\n","import { Structure } from \"definitions/structures\";\nimport { StructureState, StructureStoreState, initialState as structureInitialState, ProductionStructureStoreState } from \"./structure\";\nimport { Item } from 'definitions/items/types';\n\nexport interface StructuresStoreState {\n    [Structure.alchemist]: ProductionStructureStoreState;\n    [Structure.armoursmith]: ProductionStructureStoreState;\n    [Structure.garden]: StructureStoreState;\n    [Structure.lumberMill]: StructureStoreState;\n    [Structure.mine]: StructureStoreState;\n    [Structure.quarry]: StructureStoreState;\n    [Structure.tavern]: StructureStoreState;\n    [Structure.tannery]: StructureStoreState;\n    [Structure.warehouse]: StructureStoreState;\n    [Structure.weaponsmith]: ProductionStructureStoreState;\n    [Structure.weaver]: StructureStoreState;\n    [Structure.workshop]: ProductionStructureStoreState;\n}\n\nexport const initialState: StructuresStoreState = {\n    [Structure.alchemist]:  { ...structureInitialState, produces: [ ] },\n    [Structure.armoursmith]: { ...structureInitialState, produces: [ Item.boots1 ] },\n    [Structure.garden]: { level: 0, workers: 0, state: StructureState.Built  }, // TODO: change back to NotBuilt\n    [Structure.lumberMill]: structureInitialState,\n    [Structure.mine]: { level: 0, workers: 0, state: StructureState.NotBuilt  },\n    [Structure.quarry]: structureInitialState,\n    [Structure.tavern]: { level: 0, workers: 0, state: StructureState.Built },\n    [Structure.tannery]: structureInitialState,\n    [Structure.warehouse]: { level: 0, workers: 0, state: StructureState.Built},\n    [Structure.weaponsmith]:  { ...structureInitialState, produces: [ Item.simpleCrossbow, Item.dagger ] },\n    [Structure.weaver]: structureInitialState,\n    [Structure.workshop]:  { ...structureInitialState, produces: [ Item.torch, Item.sandwich ] },\n};\n","import { ActionType, StructureStateAction, WorkerCountAction, AddItemToProducesAction } from \"actions/structures\";\nimport { Structure } from \"definitions/structures\";\nimport { AnyAction, Reducer } from \"redux\";\nimport { StructureState, StructureStoreState } from \"stores/structure\";\nimport { initialState, StructuresStoreState } from \"../stores/structures\";\n\n/**\n * reducer\n * @param state\n * @param action\n */\nexport const structures: Reducer<StructuresStoreState, AnyAction> = (state: StructuresStoreState = initialState,\n                                                                     action: AnyAction) => {\n    switch (action.type) {\n        case ActionType.startBuildingStructure: {\n            return updateStructureState(state, action.structure, StructureState.Building);\n        }\n        case ActionType.finishBuildingStructure: {\n            return updateStructureState(state, action.structure, StructureState.Built);\n        }\n        case ActionType.upgradeStructure: {\n            const level = state[action.structure].level + 1;\n            const structureStore: StructureStoreState = {\n                ...state[action.structure],\n                level,\n            };\n            return    {\n                ...state,\n                [action.structure]: structureStore,\n            };\n        }\n        case ActionType.increaseWorkers: {\n            const { workers: workersToAdd } = action as WorkerCountAction;\n            const workers = state[action.structure].workers + workersToAdd;\n            const structureStore: StructureStoreState = {\n                ...state[action.structure],\n                workers,\n            };\n            return {\n                ...state,\n                [action.structure]: structureStore,\n            };\n        }\n        case ActionType.decreaseWorkers: {\n            const { workers: workersToRemove } = action as WorkerCountAction;\n            const workers = state[action.structure].workers - workersToRemove;\n            const structureStore: StructureStoreState = {\n                ...state[action.structure],\n                workers,\n            };\n            return {\n                ...state,\n                [action.structure]: structureStore,\n            };\n        }\n        case ActionType.setStructureState: {\n            const { state: structureState } = action as StructureStateAction;\n            return updateStructureState(state, action.structure, structureState);\n        }\n\n        case ActionType.addItemToToProduces: {\n            // Adds given item to a structures' `produces` list\n            const { item } = action as AddItemToProducesAction;\n            const produces = [...state[action.structure].produces, item];\n            const structureStore: StructureStoreState = {\n                ...state[action.structure],\n                produces,\n            };\n            return {\n                ...state,\n                [action.structure]: structureStore,\n            };\n        }\n\n    }\n    return state;\n};\n\nconst updateStructureState = (state: StructuresStoreState, structure: Structure, structureState: StructureState) => {\n    const structureStore: StructureStoreState = {\n        ...state[structure],\n        state: structureState,\n    };\n    return {\n        ...state,\n        [structure]: structureStore,\n    };\n};\n","import { TaskStoreState } from \"./task\";\n\nexport interface TasksStoreState {\n    running: TaskStoreState[];\n    completed: TaskStoreState[];\n}\nexport const initialState: TasksStoreState = {\n    completed: [],\n    running: [],\n};\n","\nimport { ActionType as GameActionType } from \"actions/game\";\nimport {  ActionType, AddAction} from \"actions/tasks\";\nimport { AnyAction, Reducer } from \"redux\";\nimport { TaskStoreState } from \"stores/task\";\nimport { initialState, TasksStoreState } from \"stores/tasks\";\n\n/**\n * Tasks reducer\n * @param state\n * @param action\n */\nexport const tasks: Reducer<TasksStoreState> = (state: TasksStoreState = initialState,\n                                                action: AnyAction ) => {\n    switch (action.type) {\n        case ActionType.start: {\n        // Adds a new task to the running tasks\n            const task: TaskStoreState = createTask(action as AddAction);\n            const running = state.running.concat(task);\n            return {\n                ...state,\n                running,\n            };\n        }\n        case GameActionType.gameTick: {\n            // Will update all tasks in `running`. If a running task expires it is placed in `complete`\n            // Note that completed tasks must be handled BEFORE the next call to ActionType.update, because\n            // this list is recreated every time\n            const now: number = Date.now();\n            const running: TaskStoreState[] = [];\n            const completed: TaskStoreState[] = [];\n            state.running.forEach((t) => {\n                const end = now + t.timeRemaining;\n                const progress = (now - t.startTime) / (end - t.startTime);\n                const timeRemaining = t.timeRemaining - (now - t.lastTick);\n                const task = {\n                    ...t,\n                    progress,\n                    lastTick: now,\n                    timeRemaining,\n                };\n                if (timeRemaining < 0) {\n                    completed.push(task);\n                } else {\n                    running.push(task);\n                }\n            });\n\n            return {\n                running,\n                completed,\n            };\n        }\n    }\n    return state;\n};\n\nconst createTask = (action: AddAction): TaskStoreState => {\n    return {\n        name: action.name,\n        origin: action.origin,\n        type: action.taskType,\n        callbacks: action.callbacks,\n        timeRemaining: action.time,\n        startTime: Date.now(),\n        lastTick: Date.now(),\n        progress: 0,\n    };\n};\n","import { combineReducers } from \"redux\";\nimport { StoreState } from \"../stores\";\nimport { adventurers } from \"./adventurers\";\nimport { combat } from \"./combat\";\nimport { engine } from \"./engine\";\nimport { gold } from \"./gold\";\nimport { items } from \"./items\";\nimport { log } from \"./log\";\nimport { quests } from \"./quests\";\nimport { resources } from \"./resources\";\nimport { rngState } from \"./rngState\";\nimport { structures } from \"./structures\";\nimport { tasks } from \"./tasks\";\nimport { workers } from \"./workers\";\n\nexport default combineReducers<StoreState>({\n    adventurers,\n    combat,\n    engine,\n    gold,\n    stockpile: items,\n    log,\n    quests,\n    resources,\n    rngState,\n    structures,\n    tasks,\n    workers,\n});\n","import { ActionType, AddCombatActionAction, MoveActorAction } from \"actions/combat\";\nimport { AnyAction, Reducer } from \"redux\";\nimport { barBrawl, CombatStoreState } from \"stores/combat\";\n\n/**\n * reducer\n * @param state\n * @param action\n */\nexport const combat: Reducer<CombatStoreState> = (state: CombatStoreState = barBrawl, action: AnyAction) => {\n    switch (action.type) {\n        case ActionType.startCombatAction:\n            const addAction = action as AddCombatActionAction;\n\n            return {\n                ...state,\n                action: {\n                    actor: addAction.actor,\n                    endsAt: addAction.endsAt,\n                    target: addAction.target,\n                    type: addAction.combatType,\n                },\n            };\n\n        case ActionType.moveActor:\n            const moveAction = action as MoveActorAction;\n\n            // Moves an actor to another position\n            const actors = state.actors.map((a) => {\n                if (a.name === moveAction.actor) {\n                    return {\n                        ...a,\n                        location: moveAction.location,\n                    };\n                }\n                return a;\n            });\n\n            return {\n                ...state,\n                actors,\n            };\n\n            case ActionType.clearCombatAction:\n            // Clears current combat action\n            return {\n                ...state,\n                action: undefined,\n            };\n    }\n    return state;\n};\n","import { ActionType as GameActionType, GameTickAction } from \"actions/game\";\r\nimport { AnyAction, Reducer } from \"redux\";\r\nimport { EngineStoreState, initialState } from \"stores/engine\";\r\n\r\n/**\r\n * reducer\r\n * @param state\r\n * @param action\r\n */\r\nexport const engine: Reducer<EngineStoreState> = (state: EngineStoreState = initialState, action: AnyAction) => {\r\n    switch (action.type) {\r\n        case GameActionType.gameTick:\r\n\r\n            // Keep track of the last time resources were produced\r\n            const resourcesToAdd = (action as GameTickAction).resources;\r\n            const lastProducedUpdate = resourcesToAdd === null ? state.lastProducedUpdate : Date.now();\r\n            return {\r\n                ...state,\r\n                lastProducedUpdate,\r\n                lastTick: Date.now(),\r\n            };\r\n    }\r\n    return state;\r\n};\r\n","import { ActionType, ModifyGoldAction } from \"actions/gold\";\nimport { AnyAction, Reducer } from \"redux\";\n\n/**\n * reducer\n * @param state\n * @param action\n */\nexport const gold: Reducer<number> = (state: number = 0, action: AnyAction) => {\n    switch (action.type) {\n        case ActionType.addGold:\n            // Adds (or subtract, if negative) gold from the players gold supply\n            return state + (action as ModifyGoldAction).amount;\n    }\n    return state;\n};\n","import { ActionType as GameActionType, GameTickAction } from \"actions/game\";\r\nimport { AnyAction, Reducer } from \"redux\";\r\nimport { ActionType, AddResources } from \"../actions/resources\";\r\nimport { initialState, ResourceStoreState } from \"../stores/resources\";\r\n\r\n/**\r\n * reducer\r\n * @param state\r\n * @param action\r\n */\r\nexport const resources: Reducer<ResourceStoreState> = (state: ResourceStoreState = initialState,\r\n                                                       action: AnyAction | GameTickAction) => {\r\n\r\n    const addResources = (resourcesToAdd: ResourceStoreState) => {\r\n        // todo: Check if warehouse can hold it\r\n        return Object.keys(state).reduce((accumulator: object, current: string) => {\r\n            accumulator[current] = state[current] + (resourcesToAdd[current] || 0);\r\n            return accumulator;\r\n        }, {});\r\n    };\r\n\r\n    switch (action.type) {\r\n        case ActionType.addResources: {\r\n            const resourcesToAdd = (action as AddResources).resources;\r\n            return addResources(resourcesToAdd);\r\n        }\r\n        case ActionType.removeResources: {\r\n            const resourcesToRemove = (action as AddResources).resources;\r\n            return Object.keys(state).reduce((accumulator: object, current: string) => {\r\n                accumulator[current] = state[current] - (resourcesToRemove[current] || 0);\r\n                return accumulator;\r\n            }, {});\r\n        }\r\n\r\n        case GameActionType.gameTick: {\r\n            const resourcesToAdd = (action as GameTickAction).resources;\r\n            if (resourcesToAdd === null) {\r\n                return state;\r\n            }\r\n            return addResources(resourcesToAdd);\r\n        }\r\n    }\r\n    return state;\r\n};\r\n","import { ActionType } from \"actions/game\";\nimport { AnyAction, Reducer } from \"redux\";\nimport { State as seedrandomStateType } from \"seedrandom\";\n\nconst initialState = false;\n/**\n * reducer\n * @param state\n * @param action\n */\nexport const rngState: Reducer<seedrandomStateType, AnyAction> = (state: seedrandomStateType = initialState,\n                                                                  action: AnyAction) => {\n    if (action.type === ActionType.gameTick && action.rngState != null) {\n        state = Object.assign({}, action.rngState);\n    }\n    return state;\n};\n","import { ActionType, ModifyWorkersAction } from \"actions\";\nimport { AnyAction, Reducer } from \"redux\";\n\n/**\n * reducer\n * @param state\n * @param action\n */\nexport const workers: Reducer<number> = (state: number = 13, action: AnyAction) => {\n    switch (action.type) {\n        case ActionType.addWorkers:\n            // Adds (or subtract, if negative) from the players workers\n            return state + (action as ModifyWorkersAction).value;\n    }\n    return state;\n};\n","import rootReducer from \"reducers/index\";\nimport { createStore, DeepPartial, AnyAction } from \"redux\";\nimport { Persistor, persistReducer, persistStore } from \"redux-persist\";\nimport localForage from 'localforage';\nimport { storeIsRehydrated } from \"storeHelpers\";\nimport { StoreState } from \"stores\";\nimport { PersistPartial } from 'redux-persist/lib/persistReducer';\nimport { asInt } from \"constants/version\";\n\nconst persistConfig = {\n    key: \"root\",\n    storage: localForage,\n    version: asInt,\n};\n\nconst persistedReducer = persistReducer<StoreState, AnyAction>(persistConfig, rootReducer);\n\ninterface ConfigureStoreResult {\n    store: any;\n    persistor: Persistor;\n    isHydrated: boolean;\n}\n/**\n * Configures the redux store\n */\nexport default async (initial: DeepPartial<StoreState> = {}): Promise<ConfigureStoreResult> => {\n    return new Promise((resolve, reject) => {\n        const store = createStore<StoreState & PersistPartial, AnyAction, any, StoreState>(\n            persistedReducer,\n            initial,\n            (window as any).__REDUX_DEVTOOLS_EXTENSION__ && (window as any).__REDUX_DEVTOOLS_EXTENSION__(),\n        );\n        const persistor = persistStore(store, undefined, () => {\n            const isHydrated = storeIsRehydrated(store.getState());\n            resolve({ store, persistor, isHydrated }) ;\n        });\n    });\n};\n","import { TaskStoreState, TaskType } from 'stores/task';\nimport { TasksStoreState } from 'stores/tasks';\nimport { AnyAction, Dispatch } from \"redux\";\nimport { ToastManager } from 'global/ToastManager';\nimport { TextManager } from 'global/TextManager';\nimport { Type } from 'components/ui/toasts/Toast';\nimport { getDefinition } from 'definitions/items';\nimport { Item } from 'definitions/items/types';\n\nexport const processCompletedTasks = (tasks: TasksStoreState, dispatch: Dispatch<AnyAction>) => {\n    const handleCompletedTask = (task: TaskStoreState) => {\n        // Fire all callbacks\n        task.callbacks.forEach((action) => dispatch(action));\n\n        switch (task.type) {\n            case TaskType.craftItem:\n                const item = task.name as Item;\n                const title = TextManager.get(\"common-item-crafted\", { item });\n                const definition = getDefinition(item);\n                ToastManager.addToast(title, Type.itemCrafted, definition.iconImg);\n                break;\n        }\n    };\n\n    tasks.completed.forEach((task) => handleCompletedTask(task));\n};","import { TiledMapData, TiledObjectData, TiledLayerType, TiledProperty, TiledLayerData } from 'constants/tiledMapData';\n\n/* Tiled doesnt export the tile location of an Object. This function calculates it based on x and y.\n* Also returns a convenience object with all properties\n*/\nexport const getExtendedTilemapObjects = (tilemapData: TiledMapData) => {\n    const objectLayers = tilemapData.layers.filter(layer => layer.type === TiledLayerType.objectgroup);\n    const objects: { [key: string]: ExtendedTiledObjectData } = {};\n    objectLayers.forEach(objectLayer => {\n        objectLayer.objects.reduce((acc: {[location: string]: ExtendedTiledObjectData}, value: TiledObjectData) => {\n            let {x, y} = value;\n            if (value.gid !== undefined) {\n                y -= value.height; // https://github.com/bjorn/tiled/issues/91\n            }\n            const location: [number, number] = [\n                x / tilemapData.tilewidth,\n                y / tilemapData.tileheight\n            ];\n            // reduce the props array into an object with key/values\n            const ezProps = parseProperties(value.properties);\n            const extended: ExtendedTiledObjectData = {\n                location,\n                ezProps,\n                ...value\n            };\n            acc[`${location[0]},${location[1]}`] = extended; // todo: what if object alraedy exists at this location?\n            return acc;\n        }, objects);\n    });\n    return objects;\n}\n\n// Unpack array of properties into key/value object for fast retrieval\nconst parseProperties = (properties?: TiledProperty[]) => {\n    if (!properties) return;\n    return properties.reduce((acc: {[key: string]: any}, value: TiledProperty) => {\n        acc[value.name] = value.value;\n        return acc;\n    }, {});\n}\n\nexport type ExtendedTiledObjectData = TiledObjectData & {\n    location: [number, number];\n    ezProps?: { [key: string]: any}\n}\n\nexport enum TiledObjectType {\n    adventurerStart = \"adventurerStart\",\n    exit = \"exit\"\n}\n\n/** Add tiles in this layer to list */\nexport const addAllTilesInLayerToList = (list: [number, number][], layer: TiledLayerData, columns: number) => {\n    layer.data.reduce((acc: [number, number][], tile, index) => {\n        if (tile > 0) {\n            const x = (index % columns);\n            const y = Math.floor(index / columns);\n            acc.push([x, y]);\n        }\n        return acc;\n    }, list);\n}\n\nexport const locationEquals = (a: [number, number], b: [number, number]) => {\n    return a[0] === b[0] && a[1] === b[1];\n}","export interface TextEntry {\r\n    key: string;\r\n    context?: any;\r\n}\r\n\r\nexport function isTextEntry(test: any): test is TextEntry {\r\n    return typeof test.key === 'string';\r\n}","import { Store, AnyAction } from \"redux\";\nimport { getExtendedTilemapObjects, ExtendedTiledObjectData, addAllTilesInLayerToList, locationEquals, TiledObjectType } from 'utils/tilemap';\nimport { adventurersOnQuest } from 'storeHelpers';\nimport { StoreState } from 'stores';\nimport { loadResource, loadResourceAsync } from 'utils/pixiJs';\nimport { TiledMapData } from 'constants/tiledMapData';\nimport { AStarFinder } from 'astar-typescript';\nimport { AdventurerStoreState } from 'stores/adventurer';\nimport { setScene, setSceneName, exitEncounter } from 'actions/quests';\nimport { SceneObject, ActorObject, LootCache } from 'stores/scene';\nimport { ToastManager } from 'global/ToastManager';\nimport { Type } from 'components/ui/toasts/Toast';\nimport { getQuestLink } from 'utils/routing';\nimport { TextEntry, isTextEntry } from 'constants/text';\nimport { TextManager } from 'global/TextManager';\nimport { addLogText, addLogEntry } from 'actions/log';\nimport { getDefinition } from 'definitions/quests';\nimport { LogChannel } from 'stores/logEntry';\nimport { addGold } from 'actions/gold';\nimport { addItemToInventory } from 'actions/adventurers';\nimport { calculateInitialAp } from './actionPoints';\n\nexport class BaseSceneController<TQuestVars> {\n\n    public mapData?: TiledMapData;\n    public aStar?: AStarFinder;\n    public questName: string;\n    public tilemapObjects?: {[location: string]: ExtendedTiledObjectData};\n\n    protected jsonPath?: string;\n    protected store: Store<StoreState, AnyAction>;\n    protected blockedTiles: [number, number][] = [];\n\n    protected spritesheetsMap: {[key: string]: PIXI.Spritesheet} = {} // Various spritesheets, e.g for actors\n\n    constructor(store: Store<StoreState, AnyAction>, questName: string) {\n        this.store = store;\n        this.questName = questName;\n    }\n\n    get basePath(): string | null {\n        if (!this.jsonPath) return null;\n        return `${process.env.PUBLIC_URL}/${this.jsonPath.substr(0, this.jsonPath.lastIndexOf('/'))}`;\n    }\n\n    get dataLoaded(): boolean {\n        return !!this.mapData;\n    }\n\n    // Loads tiles from json, loads all scene assets\n    loadData(callback: () => void) {\n        if (this.dataLoaded) {\n            return callback();\n        }\n        if (!this.jsonPath) {\n            throw new Error(\"No jsonPath defined!\");\n        }\n\n        loadResource(`${process.env.PUBLIC_URL}/${this.jsonPath}`, async (resource) => {\n            this.mapData = resource.data;\n            this.tilemapObjects = getExtendedTilemapObjects(resource.data);\n            this.mapData!.layers.filter(layer => layer.visible).forEach(layer => {\n                if (layer.properties && layer.properties.some(p => p.name === 'blocksMovement' && p.value === true)){\n                    addAllTilesInLayerToList(this.blockedTiles, layer, layer.width);\n                }\n            });\n\n\n            const adventurers = this.getAdventurers();\n            const spritesheets = Array.from(new Set<string>(adventurers.map(a => a.spritesheetPath)));\n\n            for(const path of spritesheets) {\n                const {spritesheet} = await loadResourceAsync(path);\n                this.spritesheetsMap[path] = spritesheet!;\n\n                // Object.keys(spritesheet!.textures).forEach((key: string) => {\n                //     Texture.removeFromCache(spritesheet!.textures[key]); //or just 'key' will work in that case\n                //     // baseTex = spaceship.textures[key].baseTexture; //they all have same base texture\n                // });\n                // console.log('done loading ', path, spritesheet)\n            }\n            // PIXI.utils.clearTextureCache()\n            // Create aStar based on blocked tiles\n            this.aStar = this.createAStar();\n\n            callback();\n        });\n    }\n\n    // Constructs the scene and dispatches it to be saved to the store\n    createScene() {\n        const objects = this.createObjects();\n        const actors = this.createActors();\n        const combat = true;\n\n        // todo: perhaps this should be a class such that stuff that repeats for every scene can be done in a base class\n        const scene = {\n            objects,\n            actors,\n            combat\n        }\n        this.store.dispatch(setScene(this.questName, scene));\n    }\n\n    sceneEntered() {\n        // tslint:disable-next-line: no-empty\n    }\n\n    getActorSpritesheet(actorName: string): PIXI.Spritesheet {\n        // todo: what about the non-adventurer actors (e.g the enemies)\n        const path = this.getActorSpritesheetPath(actorName);\n        return this.spritesheetsMap[path];\n    }\n\n    getActorSpritesheetPath(actorName: string): string {\n        // todo: what about the non-adventurer actors (e.g the enemies)\n        const adventurers = this.getAdventurers();\n        const adventurer = adventurers.find(a => a.id === actorName)!;\n        return adventurer.spritesheetPath;\n    }\n\n    actorMoved(actor: string, location: [number, number]) {\n        const object = this.tilemapObjects![`${location[0]},${location[1]}`];\n        if (!object) return;\n\n        if (object.type === \"exit\") {\n            // We've hit the exit. Should we load another scene?\n            if (object.ezProps?.loadScene) {\n                this.store.dispatch(setSceneName(this.questName, object.ezProps.loadScene))\n            } else {\n                // Or exit the encounter\n                const index = Math.floor(this.getQuest().progress) + 1;\n                const definition = getDefinition(this.questName);\n                const node = definition.nodes[index];\n                if (node.log) {\n                    // If the next node has a log entry, add it\n                    this.store.dispatch(addLogText(node.log, null, LogChannel.quest, this.questName));\n                }\n                this.store.dispatch(exitEncounter(this.questName));\n            }\n        }\n    }\n\n    actorCanInteract(actorName: string) {\n        const {scene} = this.getQuest();\n        const actor = scene?.actors.find(o => o.name === actorName)!;\n        const object = this.tilemapObjects?.[`${actor.location[0]},${actor.location[1]}`];\n\n        // todo: should we look for some specific property?\n        return object && object.ezProps?.interactive;\n    }\n\n    actorInteract(actorName: string) {\n        if (!this.actorCanInteract(actorName)) {\n            // tslint:disable-next-line: no-console\n            console.warn(\"Can't interact\");\n            return;\n        }\n        const {scene} = this.getQuest();\n        const actor = scene?.actors.find(o => o.name === actorName)!;\n        const object = scene?.objects\n            .find(o => locationEquals(o.location, actor.location));\n\n        if (!object) {\n            // tslint:disable-next-line: no-console\n            console.warn(\"No object found\");\n            return;\n        }\n\n        this.interactWithObject(actor, object);\n    }\n\n    interactWithObject(_actor: ActorObject, _object: SceneObject) {\n        // override\n    }\n\n    // Converts pixel coordinate to scene location\n    pointToSceneLocation (point: PIXI.Point): [number, number] {\n        if (!this.mapData?.tilewidth || !this.mapData?.tileheight) {\n            return [0, 0];\n        }\n        return [Math.floor(point.x / this.mapData.tilewidth), Math.floor(point.y / this.mapData.tilewidth)];\n    }\n\n    // Returns true if the tile is blocked\n    locationIsBlocked(location: [number, number]){\n        return this.blockedTiles.some((l) => locationEquals(l, location));\n    }\n\n    // Should be overridden\n    getLootCache(name: string): LootCache | undefined {\n        // Override this to retrieve LootCache from questvars\n        return;\n    }\n\n    takeGoldFromCache(name: string) {\n        // Override this to remove gold from questvars\n        const lootCache = this.getLootCache(name);\n        if (lootCache){\n            this.store.dispatch(addGold(lootCache.gold || 0));\n        }\n    }\n\n    takeItemFromCache(itemIndex: number, name: string, adventurer: AdventurerStoreState, toSlot?: number) {\n        // Override this to remove items from questvars\n        const lootCache = this.getLootCache(name);\n        if (!lootCache) return;\n\n        const item = lootCache.items[itemIndex];\n        this.store.dispatch(addItemToInventory(adventurer.id, item, toSlot))\n    }\n\n    getSituation(situation: string, adventurerId?: string) : { title: string, choices: string[]} | undefined {\n         return undefined;\n    }\n\n    handleSituationOptionClick(situation: string, option: string) {\n        // @ts-ignore\n    }\n\n    /**\n     * Returns a path from two locations on the map\n     * @param origin\n     * @param target\n     */\n    findPath(origin: [number, number], target: [number, number]) {\n        const convertLocation = (l: [number, number]) => {\n            // This is the format AStarFind works with\n            return { x: l[0], y: l[1] }\n        }\n        return this.aStar?.findPath(\n            convertLocation(origin), convertLocation(target)\n        );\n    }\n\n    /**\n     * Calculates the AP costs to walk\n     */\n    calculateWalkApCosts(from: [number, number], to: [number, number]) {\n        return this.findPath(from, to)?.length || 0;\n    }\n\n    getRemainingAdventurerAp(adventurerId: string) {\n        const { scene } = this.getQuest();\n        return scene?.actors.find(a => a.name === adventurerId)?.ap;\n    }\n\n    protected createAStar() {\n        const matrix: number[][] = [];\n        for (let y = 0; y < this.mapData!.height; y++) {\n            const row: number[] = [];\n            for (let x = 0; x < this.mapData!.width; x++) {\n                const location: [number, number] = [x, y];\n                const blocked = this.locationIsBlocked(location);\n                row.push(blocked ? 1 : 0);\n            }\n            matrix.push(row);\n        }\n        return new AStarFinder({\n            grid: {\n                matrix\n            },\n            includeStartNode: false,\n            heuristic: \"Manhattan\",\n            weight: 0,\n        });\n    }\n\n    protected createActors(): ActorObject[] {\n\n        if (!this.tilemapObjects) {\n            throw new Error(\"No tilemapObjects\");\n        }\n\n        const adventurers = this.getAdventurers();\n\n        const startLocations = Object.values(this.tilemapObjects)\n            .filter(o => o.type === \"adventurerStart\")\n            .map(o => o.location);\n        if (adventurers.length > startLocations.length) {\n            throw new Error(\"Not enough objects with 'adventurerStart' property set to true\");\n        }\n        return adventurers.reduce((acc: ActorObject[], value: AdventurerStoreState, index: number) => {\n            const location = startLocations[index];\n            const ap = calculateInitialAp(value);\n            acc.push({\n                location,\n                name: value.id,\n                ap\n            });\n            return acc;\n        }, []);\n    }\n\n    // These objects are saved in store\n    protected createObjects(): SceneObject[] {\n        if (!this.tilemapObjects) {\n            throw new Error(\"No tilemapObjects\");\n        }\n\n        return Object.values(this.tilemapObjects)\n            .map(o => this.createObject(o))\n            .filter((o): o is SceneObject => o !== null);   // filter out null values\n    }\n\n    protected createObject(config: ExtendedTiledObjectData): SceneObject | null {\n        switch (config.type) {\n            case TiledObjectType.adventurerStart:\n            case TiledObjectType.exit:\n                return null;\n            default:\n                return config;\n        }\n    }\n\n    // protected createCaches(): { [name: string]: LootCache } {\n    //     return Object.values(this.tilemapObjects!)\n    //         .filter(o => o.type === \"lootCache\")\n    //         .reduce((acc: { [name: string]: LootCache }, value) => {\n    //             // serialize comma separated string to array of Item\n    //             const items = value.ezProps?.items?.split(\",\").map((v:string) => {\n    //                 const item = Item[v.trim()];\n    //                 if (item) {\n    //                     return item;\n    //                 }\n    //             }).filter(Boolean);\n    //             acc[value.name] = {\n    //                 title: value.ezProps?.title,\n    //                 items\n    //             }\n    //             return acc;\n    //         }, {});\n    // }\n\n    protected getQuest() {\n        const storeState = this.store.getState();\n        return storeState.quests.find(q => q.name === this.questName)!;\n    }\n\n    protected getQuestVars(): TQuestVars {\n        return this.getQuest().questVars;\n    }\n\n    protected getAdventurers(): AdventurerStoreState[] {\n        const storeState = this.store.getState();\n        const quest = this.getQuest();\n        return adventurersOnQuest(storeState.adventurers, quest);\n    }\n\n    protected getAdventurerByActor(actor: ActorObject) {\n        const storeState = this.store.getState();\n        return storeState.adventurers.find(a => a.id === actor.name);\n    }\n\n    protected questUpdate(input: string | TextEntry, icon?: string, toast: boolean = false) : void {\n        const textEntry: TextEntry = isTextEntry(input) ? input : {key: input};\n        const title = TextManager.getTextEntry(textEntry);\n        if (toast) {\n            ToastManager.addToast(title, Type.questUpdate, icon, getQuestLink(this.questName));\n        }\n        this.store.dispatch(addLogEntry(textEntry, LogChannel.quest, this.questName));\n    }\n}\n","import { AdventurerStoreState } from 'stores/adventurer';\n\nexport function calculateInitialAp(adventurer: AdventurerStoreState): number {\n    return adventurer.baseAP;\n}","import { BaseSceneController } from 'mechanics/scenes/BaseSceneController';\nimport { SceneControllerManager } from 'global/SceneControllerManager';\nimport { SceneObject, ActorObject, LootCache } from 'stores/scene';\nimport { updateSceneObject, setActiveSceneInteractionModal, updateQuestVars } from 'actions/quests';\nimport { Kill10BoarsQuestVars } from '../questVars';\nimport { AdventurerStoreState } from 'stores/adventurer';\n// tslint:disable: max-classes-per-file\n\nconst TILE_CHEST_CLOSED = 33; // todo: take this from json?\nconst TILE_CHEST_OPEN = 34; // todo: take this from json?\n\nexport class DungeonEntranceSceneController extends BaseSceneController<Kill10BoarsQuestVars> {\n    jsonPath = \"scenes/ork-dungeon-level1.json\";\n\n    interactWithObject(actor: ActorObject, object: SceneObject) {\n        switch (object.name) {\n            // todo: I want to share this common stuff with other SceneControllers\n            case \"chest\":\n                if (object.gid === TILE_CHEST_CLOSED) {\n                    const adventurer = this.getAdventurerByActor(actor)?.name;\n                    const textEntry = { key: \"quest-common-adventurer-opened-chest\", context: { adventurer } };\n                    this.questUpdate(textEntry, \"/img/items/misc/chest-02.png\");\n                    this.store.dispatch(updateSceneObject(this.questName, object.id, { gid: TILE_CHEST_OPEN }));\n                }\n                // display loot modal!\n                this.store.dispatch(setActiveSceneInteractionModal(this.questName, {\n                    type: 'lootCache',\n                    lootCache: object.name\n                }));\n                break;\n\n            case \"altar\":\n                this.store.dispatch(setActiveSceneInteractionModal(this.questName, {\n                    type: 'situation',\n                    situation: 'altar'\n                }));\n                break;\n        }\n        super.interactWithObject(actor, object);\n    }\n\n    sceneEntered() {\n        const vars = this.getQuestVars();\n        if (!vars.dungeon.entered) {\n            this.questUpdate(\"quest-kill10-boars-enter-dungeon-see-chest\");\n        }\n    }\n\n    getLootCache(name: string): LootCache | undefined {\n        return this.getQuestVars().dungeon.lootCaches[name];\n    }\n\n    takeGoldFromCache(name: string) {\n        super.takeGoldFromCache(name);  // first add gold to inventory\n        const lootCache = this.getLootCache(name);\n        if (lootCache){\n            const questVars = this.getQuestVars();\n            questVars.dungeon.lootCaches[name].gold = 0;\n            this.store.dispatch(updateQuestVars(this.questName, questVars));\n        }\n    }\n\n    takeItemFromCache(itemIndex: number, name: string, adventurer: AdventurerStoreState, toSlot?: number) {\n        super.takeItemFromCache(itemIndex, name, adventurer, toSlot);\n        const lootCache = this.getLootCache(name);\n        if (lootCache){\n            const questVars = this.getQuestVars();\n            const items = questVars.dungeon.lootCaches[name].items.filter((_: any, index: number) => index !== itemIndex);\n            questVars.dungeon.lootCaches[name].items = items;\n            this.store.dispatch(updateQuestVars(this.questName, questVars));\n        }\n    }\n\n    getSituation(situation: string, adventurerId?: string) {\n        switch (situation) {\n            case 'altar':\n                const questVars = this.getQuestVars();\n                if (questVars.dungeon.situations.altar.candleLit) {\n                    return {\n                        title: 'quest-kill10-boars-dungeonentrance-altar',\n                        choices: [\n                            \"quest-kill10-boars-dungeonentrance-altar-rummagedrawers\"\n                        ]\n                    }\n                }\n                return {\n                    title: 'quest-kill10-boars-dungeonentrance-altar',\n                    choices: [\n                        \"quest-kill10-boars-dungeonentrance-altar-lightcandle\",\n                        \"quest-kill10-boars-dungeonentrance-altar-rummagedrawers\"\n                    ]\n                }\n                default:\n                    return super.getSituation(situation, adventurerId);\n        }\n    }\n\n    handleSituationOptionClick(situation: string, option: string) {\n        // @ts-ignore\n        switch (situation) {\n            case 'altar': {\n                switch (option) {\n                    case 'quest-kill10-boars-dungeonentrance-altar-lightcandle':\n                        const questVars = this.getQuestVars();\n                        questVars.dungeon.situations.altar.candleLit = true;\n                        this.store.dispatch(updateQuestVars(this.questName, questVars));\n                        break;\n\n                    case 'quest-kill10-boars-dungeonentrance-altar-rummagedrawers':\n                        // display loot modal!\n                        this.store.dispatch(setActiveSceneInteractionModal(this.questName, {\n                            type: 'lootCache',\n                            lootCache: 'altar'\n                        }));\n                        break;\n                }\n            }\n        }\n    }\n}\n\nexport class DungeonHallwaySceneController extends BaseSceneController<Kill10BoarsQuestVars> {\n    jsonPath = \"scenes/ork-dungeon-level2.json\";\n}\n\nSceneControllerManager.registerSceneController(\"kill10Boars\", \"dungeon.entrance\", DungeonEntranceSceneController as any);\nSceneControllerManager.registerSceneController(\"kill10Boars\", \"dungeon.hallway\", DungeonHallwaySceneController as any);\n","import { Action } from \"redux\";\n\n// tslint:disable:object-literal-sort-keys\nexport enum ActionType {\n    addGold = \"addGold\",\n}\n\nexport interface ModifyGoldAction extends Action<ActionType> {\n    amount: number;\n}\n\nexport function addGold(amount: number): ModifyGoldAction {\n    return {\n        type: ActionType.addGold,\n        amount,\n    };\n}\nexport function subtractGold(amount: number): ModifyGoldAction {\n    return {\n        type: ActionType.addGold,\n        amount: -amount,\n    };\n}\n","import { QuestStoreState } from 'stores/quest';\nimport { QuestDefinition, QuestNodeType } from '../types';\nimport { initialQuestVars, Kill10BoarsQuestVars } from './questVars';\n\n\nconst kill10Boars: QuestDefinition<Kill10BoarsQuestVars> = {\n    getQuestVars: (questStore: QuestStoreState) => questStore.questVars as Kill10BoarsQuestVars,\n    getInitialQuestVars: (questStore: QuestStoreState) => {\n        return initialQuestVars;\n    },\n    nodes: [{\n        x: 0,\n        y: 1,\n        type: QuestNodeType.nothing,\n        log: \"quest-kill10-boars-node0\",\n    }, {\n        x: 0,\n        y: 2,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 0,\n        y: 3,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 0,\n        y: 4,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 0,\n        y: 3,\n        type: QuestNodeType.encounter,\n        // log: \"quest-kill10-boars-enter-dungeon\",\n        startScene: \"dungeon.entrance\"\n    }, {\n        x: 1,\n        y: 3,\n        type: QuestNodeType.nothing,\n        log: \"quest-kill10-boars-leave-dungeon\",\n    }, {\n        x: 1,\n        y: 3,\n        type: QuestNodeType.nothing,\n        log: \"quest-kill10-boars-left-dungeon\"\n    }, {\n        x: 2,\n        y: 3,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 3,\n        y: 3,\n        type: QuestNodeType.encounter,\n        startScene: \"dungeon.hallway\"\n\n        //encounter: Encounter.backstabbed,\n    }, {\n        x: 4,\n        y: 4,\n        type: QuestNodeType.nothing,\n        log: \"The party spots a boss\",\n    }, {\n        x: 5,\n        y: 4,\n        type: QuestNodeType.nothing,\n    }],\n};\n\nexport default kill10Boars;","import kill10Boars from './kill10Boars';\r\nimport retrieveMagicAmulet from './retrieveMagicAmulet';\r\nimport { QuestDefinition } from './types';\r\n\r\n// tslint:disable:object-literal-sort-keys\r\n\r\n\r\n\r\n\r\n\r\n// const fulruhmRaid: QuestDefinition = {\r\n//     nodes: [{\r\n//         x: -4,\r\n//         y: -1,\r\n//         type: QuestNodeType.nothing,\r\n//     }, {\r\n//         x: -4,\r\n//         y: -1,\r\n//         type: QuestNodeType.nothing,\r\n\r\nconst all = {\r\n    kill10Boars,\r\n    retrieveMagicAmulet,\r\n};\r\n\r\nexport default all;\r\n\r\nexport function getDefinition<T>(questName: string): QuestDefinition<T> {\r\n    return all[questName];\r\n}\r\n","import { QuestStoreState } from 'stores/quest';\nimport { Item } from 'definitions/items/types';\nimport { QuestDefinition, QuestNodeType } from '../types';\n\nexport interface RetrieveMagicAmuletQuestVars {\n    baz: boolean;\n    zux: number;\n}\n\nconst retrieveMagicAmulet: QuestDefinition<RetrieveMagicAmuletQuestVars> = {\n    getQuestVars: (questStore: QuestStoreState) => questStore.questVars as RetrieveMagicAmuletQuestVars,\n    getInitialQuestVars: (questStore: QuestStoreState) => {\n        const vars: RetrieveMagicAmuletQuestVars = {\n            baz: false,\n            zux: 13\n        }\n        return vars;\n    },\n    requiredItems: [\n        Item.torch,\n        Item.torch,\n        Item.torch,\n        Item.sandwich,\n        Item.sandwich,\n    ],\n    nodes: [{\n        x: 0,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 1,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 2,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 3,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 4,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 5,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 7,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 8,\n        y: 2,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 8,\n        y: 3,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 9,\n        y: 3,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 10,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 10,\n        y: 2,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 10,\n        y: 3,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 10,\n        y: 4,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 11,\n        y: 5,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 12,\n        y: 6,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 12,\n        y: 7,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 13,\n        y: 8,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 12,\n        y: 8,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 12,\n        y: 9,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 11,\n        y: 8,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 10,\n        y: 8,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 9,\n        y: 8,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 8,\n        y: 9,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 7,\n        y: 8,\n        type: QuestNodeType.encounter,\n        startScene: \"dungeon.hallway\"\n    }, {\n        x: 8,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 1,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 1,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 1,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 1,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 1,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 1,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 1,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 1,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 2,\n        y: 1,\n        type: QuestNodeType.encounter,\n        startScene: \"dungeon.hallway\"\n    }, {\n        x: 3,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }],\n};\n\nexport default retrieveMagicAmulet;","import { StoreState } from \"stores\";\nimport { AdventurerStoreState } from \"stores/adventurer\";\nimport { QuestStoreState } from \"stores/quest\";\n\n// export const adventurersInParty = (store: StoreState, partyId: string): AdventurerStoreState[] => {\n//     const party: PartyStoreState = store.parties[partyId];\n//     return party.adventurers.map((id: string) => findAdventurerById(store, id)!);\n// };\n\nexport const adventurersOnQuest = (adventurers: AdventurerStoreState[], quest: QuestStoreState): AdventurerStoreState[] => {\n    return quest.party.map((id: string) => findAdventurerById(adventurers, id)!);\n};\n\nexport const getQuestLeader = (adventurers: AdventurerStoreState[], quest: QuestStoreState): AdventurerStoreState | undefined => {\n    const leaderId = quest.party[0];\n    return findAdventurerById(adventurers, leaderId);\n}\n\nexport const findAdventurerById = (adventurers: AdventurerStoreState[], id: string): AdventurerStoreState | undefined => {\n    return adventurers.find((a) => a.id === id);\n};\n\n/**\n * Returns the amount of free inventory slots on this adventurer\n */\nexport const adventurerFreeInventorySlots = (adventurer: AdventurerStoreState): number => {\n    return adventurer.inventory.filter(i => i === null).length;\n};\n\nexport const storeIsRehydrated = (store: StoreState): boolean => {\n    // Returns a value indicating whether this store is fresh or rehydrated\n    // Probably I should find a more solid way to do this\n    return !!store.rngState;\n};\n\n","import { paramCase as toKebab} from \"text-param-case\";\nimport { TextEntry } from \"constants/text\";\nimport itemDefinitions, { getDefinition } from \"definitions/items\";\nimport { Item, ItemType } from \"definitions/items/types\";\nimport { Resource } from \"definitions/resources\";\nimport { Structure } from \"definitions/structures\";\nimport * as Handlebars from \"handlebars\";\nimport { Trait } from 'definitions/traits/types';\nimport { Type } from 'components/ui/toasts/Toast';\nimport { EquipmentSlotType } from 'components/ui/EquipmentSlot';\nimport { WeaponType, WeaponClassification } from 'definitions/items/weapons';\n\nexport abstract class TextManager {\n\n\n\n    public static init(texts: {[key: string]: string}, precompile = true) {\n        this.texts = texts;\n        this.templates = {};\n        if (precompile) {\n            this.compileAll();\n        }\n        this.initialized = true;\n    }\n\n//    public static addTexts(texts: Record<string, string>)\n    public static get(key: string, context?: any): string {\n        const result = this.getDefault(key, context);\n        if (result === null) {\n            // tslint:disable-next-line: no-console\n            console.error(`Key '${key}' not found in TextManager`);\n            return `<<'${key}' missing>>`;\n        } else {\n            return result;\n        }\n    }\n\n    // Will return `null` when no text found, otherwise will return the text\n    public static getDefault(key: string, context?: any): string|null {\n        if (!this.initialized) {\n            throw new Error(`Error ${this} not initialized!`);\n        }\n        const template = this.getTemplate(key);\n        if (!template) {\n            return null;\n        }\n        return template(context);\n    }\n\n    public static getTextEntry(textEntry: TextEntry): string {\n        return this.get(textEntry.key, textEntry.context);\n    }\n\n    public static getTemplate(key: string) {\n        let template = this.templates[key];\n        if (!template && this.texts[key]) {\n            // Template not found but key is defined. Needs to be compiled\n            this.compile(key, this.texts[key]);\n            template = this.templates[key];\n        }\n        return template;\n    }\n\n    public static getEquipmentSlot(slotType: EquipmentSlotType) {\n        return this.get(`ui-equipmentslot-${toKebab(EquipmentSlotType[slotType])}`);\n    }\n\n    public static getQuestTitle(name: string) {\n        return this.get(`quest-${toKebab(name)}-title`);\n    }\n\n    public static getQuestDescription(name: string) {\n        return this.get(`quest-${toKebab(name)}-description`);\n    }\n\n    public static getResourceName(type: Resource) {\n        return this.get(`resource-${type}-name`);\n    }\n\n    public static getItemName(item: Item): string {\n        const itemType = ItemType[getDefinition(item).itemType];\n        return this.get(`item-${toKebab(itemType)}-${toKebab(item)}-name`);\n    }\n    public static getItemSubtext(item: Item): string|null {\n        const itemType = ItemType[getDefinition(item).itemType];\n        return this.getDefault(`item-${toKebab(itemType)}-${toKebab(item)}-subtext`);\n    }\n\n    public static getStructureName(structure: Structure): string {\n        return this.get(`structure-${toKebab(structure)}-name`);\n    }\n\n    public static getTraitName(trait: Trait): string {\n        return this.get(`trait-${toKebab(trait)}-name`);\n    }\n\n    public static getTraitDescription(trait: Trait): string {\n        return this.get(`trait-${toKebab(trait)}-description`);\n    }\n\n    public static getTraitEffect(trait: Trait): string {\n        return this.get(`trait-${toKebab(trait)}-effect`);\n    }\n\n    public static getToastType(type: Type): string {\n        return this.get(`ui-toast-type-${toKebab(Type[type])}`);\n    }\n\n    public static getWeaponType(type: WeaponType) {\n        return this.get(`ui-weapon-type-${toKebab(WeaponType[type])}`);\n    }\n\n    public static getSkillName(type: WeaponType) {\n        return this.get(`skill-${toKebab(WeaponType[type])}-name`);\n    }\n\n    public static getSkillInfo(type: WeaponType) {\n        return this.get(`skill-${toKebab(WeaponType[type])}-info`);\n    }\n\n    static getWeaponClassification(weaponClass: WeaponClassification) {\n        return this.get(`ui-weapon-class-${toKebab(WeaponClassification[weaponClass])}`);\n    }\n\n    private static initialized = false;\n    private static texts: Record<string, string>;\n    private static templates: Record<string, Handlebars.TemplateDelegate<any>>;\n\n    private static compileAll() {\n        Object.keys(this.texts).forEach((key: string) =>  {\n            this.compile(key, this.texts[key]);\n        });\n    }\n\n    private static compile(key: string, value: string) {\n        const template = Handlebars.compile(value);\n        this.templates[key] = template;\n    }\n}\n\nHandlebars.registerHelper(\"item:name\", (item: Item, article?: string) => {\n    if (!itemDefinitions[item]) {\n        return new Handlebars.SafeString(`<<ITEM DEFINITION NOT FOUND: ${item}>>`);\n    }\n    switch (article) {\n        case \"aA\":  // article Auto\n            return itemArticleAuto(item);\n        case \"aD\":  // article Defined \"a sword\"\n            return itemArticleDefined(item);\n        case \"aU\":  // article Defined \"the sword\"\n            return itemArticleDefined(item);\n        default:\n            // No article\n            // const name = itemDefinitions[item].name;\n            return new Handlebars.SafeString(item);\n    }\n});\n\nHandlebars.registerHelper(\"structure:name\", (structure: string) => {\n    const name = TextManager.get(`structure-${structure}-name`);\n    return new Handlebars.SafeString(name);\n});\n\nconst itemArticleAuto = (item: Item) => {\n    return itemArticleUndefined(item);\n};\n\nconst itemArticleUndefined = (item: Item) => {\n    const name = TextManager.getItemName(item);\n    const articleTemplate = TextManager.getTemplate(\"common-article-undefined\");\n    return new Handlebars.SafeString(`${articleTemplate({ noun: name})}`);\n};\n\nconst itemArticleDefined = (item: Item) => {\n    const name = TextManager.getItemName(item);\n    const articleTemplate = TextManager.getTemplate(\"common-article-defined\");\n    return new Handlebars.SafeString(`${articleTemplate({ noun: name})}`);\n};\n","export const lerp = (n1: number,  n2: number,  alpha: number) =>  {\n    return n1 + alpha * (n2 - n1);\n}","import { LoaderResource } from 'pixi.js';\nimport { lerp } from './math';\n\ninterface Location {\n    x: number;\n    y: number;\n}\n\nexport const lerpLocation = (point1: Location, point2: Location, alpha: number): Location => {\n    const x = lerp(point1.x, point2.x, alpha);\n    const y = lerp(point1.y, point2.y, alpha);\n    return { x, y };\n}\n\n\n/**\n * Uses the shared pixi loader to load a resource\n */\nexport async function loadResourceAsync(path: string) {\n    const loader = PIXI.Loader.shared;\n    return new Promise<LoaderResource>((resolve, reject) => {\n        if (loader.resources[path]) {\n            resolve(loader.resources[path]);\n        }\n        else {\n            loader.add(path).load((_, resources) => {\n                resolve(resources[path]);\n            });\n        }\n    });\n}\n\nexport const loadResource = (path: string, callback: (resource: LoaderResource) => void) => {\n    const loader = PIXI.Loader.shared;\n    if (loader.resources[path]) {\n        callback(loader.resources[path]);\n        return;\n    }\n    loader.add(path).load((_, resources) => { callback(resources[path]!)});\n}","// tslint:disable:object-literal-sort-keys\n\nimport alchemist from \"./alchemist\";\nimport armoursmith from \"./armoursmith\";\nimport garden from \"./garden\";\nimport lumberMill from \"./lumberMill\";\nimport mine from \"./mine\";\nimport quarry from \"./quarry\";\nimport tannery from \"./tannery\";\nimport tavern from \"./tavern\";\nimport { StructureDefinition } from \"./types\";\nimport warehouse from \"./warehouse\";\nimport weaponsmith from \"./weaponsmith\";\nimport weaver from \"./weaver\";\nimport workshop from \"./workshop\";\nimport { Resource } from 'definitions/resources';\n\nexport enum Structure {\n    alchemist = \"alchemist\",\n    armoursmith = \"armoursmith\",\n    garden = \"garden\",\n    lumberMill = \"lumberMill\",\n    mine = \"mine\",\n    quarry = \"quarry\",\n    tavern = \"tavern\",\n    tannery = \"tannery\",\n    warehouse = \"warehouse\",\n    weaponsmith = \"weaponsmith\",\n    weaver = \"weaver\",\n    workshop = \"workshop\",\n}\n\nconst all = {\n    alchemist,\n    armoursmith,\n    garden,\n    lumberMill,\n    mine,\n    quarry,\n    tavern,\n    tannery,\n    warehouse,\n    weaponsmith,\n    weaver,\n    workshop,\n};\n\nexport default all;\n\nexport function getDefinition<T extends StructureDefinition>(structure: string): T {\n    return all[structure] as T;\n}\n\nexport function getStructureByResource(resource: Resource) : Structure {\n    switch (resource) {\n        case Resource.fabric:\n            return Structure.weaver;\n        case Resource.food:\n            return Structure.garden;\n        case Resource.iron:\n            return Structure.mine;\n        case Resource.leather:\n            return Structure.tannery;\n        case Resource.stone:\n            return Structure.quarry;\n        case Resource.wood:\n            return Structure.lumberMill;\n    }\n}\n","// tslint:disable:object-literal-sort-keys\nimport { ProductionStructureDefinition, StructureType } from \"./types\";\nconst alchemist: ProductionStructureDefinition = {\n    type: StructureType.production,\n    cost: {\n        gold: 40,\n        time: 4000,\n    },\n    levels: [{\n        displayName: \"structure-alchemist-name\",\n        // level 1:\n        workerCapacity: 2,\n        cost: {\n            gold: 0,\n        },\n        unlocks: [],\n    }, {\n        // level 2:\n        displayName: \"structure-alchemist-name\",\n        workerCapacity: 5,\n        cost: {\n            gold: 30,\n        },\n        unlocks: [],\n    }, {\n        // level 3:\n        displayName: \"structure-alchemist-name\",\n        workerCapacity: 10,\n        cost: {\n             gold: 50,\n        },\n        unlocks: [],\n    }],\n};\n\nexport default alchemist;\n","// tslint:disable:object-literal-sort-keys\n\nimport { ProductionStructureDefinition, StructureType } from \"./types\";\nimport { Item } from 'definitions/items/types';\n\nconst armoursmith: ProductionStructureDefinition = {\n    cost: {\n        gold: 40,\n        time: 4000,\n    },\n    type: StructureType.production,\n    levels: [{\n        // level 1:\n        displayName: \"structure-armoursmith-name\",\n        workerCapacity: 2,\n        cost: {\n            gold: 0,\n        },\n        unlocks: [ Item.boots1 ],\n    }, {\n        // level 2:\n        displayName: \"structure-armoursmith-name\",\n        workerCapacity: 5,\n        cost: {\n            gold: 30,\n        },\n        unlocks: [ Item.chest ],\n    }, {\n        // level 3:\n        displayName: \"structure-armoursmith-name\",\n        workerCapacity: 10,\n        cost: {\n            gold: 50,\n        },\n        unlocks: [ Item.cowl],\n    }],\n};\nexport default armoursmith;\n","// tslint:disable:object-literal-sort-keys\nimport { ResourceStructureDefinition, StructureType } from \"./types\";\n\nconst garden: ResourceStructureDefinition = {\n    type: StructureType.resource,\n    cost: {\n        gold: 40,\n        time: 4000,\n    },\n    levels: [{\n        displayName: \"structure-garden-name\",\n        // level 1:\n        workerCapacity: 2,\n        cost: {\n            gold: 0,\n        },\n        generates: { food: 2 },\n    }, {\n        displayName: \"structure-garden-name\",\n        // level 2:\n        workerCapacity: 5,\n        cost: {\n            gold: 30,\n        },\n        generates: { food: 2 },\n    }, {\n        // level 3:\n        displayName: \"structure-garden-name\",\n        workerCapacity: 10,\n        cost: {\n            gold: 50,\n        },\n        generates: { food: 2 },\n    }],\n};\n\nexport default garden;\n","// tslint:disable:object-literal-sort-keys\n\nimport { ResourceStructureDefinition, StructureType } from \"./types\";\nimport { HALF_HOUR } from 'utils/format/time';\n\nconst lumberMill: ResourceStructureDefinition = {\n    type: StructureType.resource,\n    cost: {\n        gold: 31,\n        time: HALF_HOUR,\n    },\n    levels: [{\n        // level 0:\n        displayName: \"structure-lumber-mill-name\",\n        workerCapacity: 2,\n        cost: {\n            gold: 0,\n        },\n        generates: { wood: 2 },\n    }, {\n        // level 1:\n        displayName: \"structure-lumber-mill-name\",\n        workerCapacity: 5,\n        cost: {\n            gold: 30,\n        },\n        generates: { wood: 2 },\n    }, {\n        // level 2:\n        displayName: \"structure-lumber-mill-name\",\n        workerCapacity: 10,\n        cost: {\n            gold: 50,\n        },\n        generates: { wood: 2 },\n    }],\n};\n\nexport default lumberMill;\n","// tslint:disable:object-literal-sort-keys\nimport { ResourceStructureDefinition, StructureType } from \"./types\";\n\nconst mine: ResourceStructureDefinition = {\n    cost: {\n        gold: 40,\n        time: 4000,\n    },\n    type: StructureType.resource,\n    levels: [{\n        displayName: \"structure-mine-name\",\n        // level 0:\n        workerCapacity: 2,\n        cost: {\n            gold: 0,\n        },\n        generates: { iron: 2 },\n    }, {\n        displayName: \"structure-mine-name\",\n        // level 1:\n        workerCapacity: 5,\n        cost: {\n            gold: 30,\n        },\n        generates: { iron: 2 },\n    }, {\n        displayName: \"structure-mine-name\",\n        // level 2:\n        workerCapacity: 10,\n        cost: {\n            gold: 50,\n        },\n        generates: { iron: 2 },\n    }],\n};\nexport default mine;\n","// tslint:disable:object-literal-sort-keys\nimport { ResourceStructureDefinition, StructureType } from \"./types\";\n\nconst quarry: ResourceStructureDefinition = {\n    cost: {\n        gold: 40,\n        time: 4000,\n    },\n    type: StructureType.resource,\n    levels: [{\n        displayName: \"structure-quarry-name\",\n        // level 1:\n        workerCapacity: 2,\n        cost: {\n            gold: 0,\n        },\n        generates: { stone: 2 },\n    }, {\n        // level 2:\n        displayName: \"structure-quarry-name\",\n        workerCapacity: 5,\n        cost: {\n            gold: 30,\n        },\n        generates: { stone: 4 },\n    }, {\n        // level 3:\n        displayName: \"structure-quarry-name\",\n        workerCapacity: 10,\n        cost: {\n            gold: 50,\n        },\n        generates: { stone: 6 },\n    }],\n};\n\nexport default quarry;\n","// tslint:disable:object-literal-sort-keys\n\nimport { ResourceStructureDefinition, StructureType } from \"./types\";\n\nconst tannery: ResourceStructureDefinition = {\n    cost: {\n        gold: 40,\n        time: 4000,\n    },\n    type: StructureType.resource,\n    levels: [{\n        displayName: \"structure-tannery-name\",\n        // level 1:\n        workerCapacity: 2,\n        cost: {\n            gold: 0,\n        },\n        generates: { leather: 2 },\n    }, {\n        // level 2:\n        displayName: \"structure-tannery-name\",\n        workerCapacity: 5,\n        cost: {\n            gold: 30,\n        },\n        generates: { leather: 5 },\n    }, {\n        // level 3:\n        displayName: \"structure-tannery-name\",\n        workerCapacity: 10,\n        cost: {\n            gold: 50,\n        },\n        generates: { leather: 7 },\n    }],\n};\n\nexport default tannery;\n","// tslint:disable:object-literal-sort-keys\n\nimport { StructureType, TavernStructureDefinition } from \"./types\";\n\nconst tavern: TavernStructureDefinition = {\n    cost: {\n        gold: 40,\n        time: 4000,\n    },\n    type: StructureType.tavern,\n    levels: [{\n        displayName: \"structure-tavern-name\",\n        // level 1:\n        workerCapacity: 2,\n        cost: {\n             gold: 0,\n        },\n        rooms: 10,\n    }, {\n        // level 2:\n        displayName: \"structure-tavern-name\",\n        workerCapacity: 5,\n        cost: {\n             gold: 30,\n        },\n        rooms: 12,\n    }, {\n        // level 3:\n        displayName: \"structure-tavern-name\",\n        workerCapacity: 10,\n        cost: {\n             gold: 50,\n        },\n        rooms: 15,\n    }],\n};\n\nexport default tavern;\n","// tslint:disable:object-literal-sort-keys\n\nimport {  StructureType, WarehouseStructureDefinition } from \"./types\";\n\nconst warehouse: WarehouseStructureDefinition = {\n    cost: {\n        gold: 40,\n        time: 4000,\n    },\n    type: StructureType.warehouse,\n    levels: [{\n        displayName: \"structure-warehouse-name\",\n        // level 1:\n        workerCapacity: 2,\n        cost: {\n            gold: 0,\n        },\n        maxResources: {\n            fabric: 200,\n            food: 200,\n            iron: 200,\n            leather: 200,\n            stone: 200,\n            wood: 200,\n        },\n    }, {\n        // level 2:\n        displayName: \"structure-warehouse-name\",\n        workerCapacity: 5,\n        cost: {\n            gold: 30,\n        },\n        maxResources: {\n            fabric: 500,\n            food: 500,\n            iron: 500,\n            leather: 500,\n            stone: 500,\n            wood: 500,\n        },\n    }, {\n        // level 3:\n        displayName: \"structure-warehouse-name\",\n        workerCapacity: 10,\n        cost: {\n            gold: 50,\n        },\n        maxResources: {\n            fabric: 1000,\n            food: 1000,\n            iron: 1000,\n            leather: 1000,\n            stone: 1000,\n            wood: 1000,\n        },\n    }],\n};\n\nexport default warehouse;\n","// tslint:disable:object-literal-sort-keys\nimport { ProductionStructureDefinition, StructureType } from \"./types\";\nimport { Item } from 'definitions/items/types';\n\nconst weaponsmith: ProductionStructureDefinition = {\n    type: StructureType.production,\n    cost: {\n        gold: 40,\n        time: 4000,\n    },\n    levels: [{\n        // level 1:\n        displayName: \"structure-weaponsmith-name\",\n        workerCapacity: 2,\n        cost: {\n            gold: 0,\n        },\n        unlocks: [],\n    }, {\n        // level 2:\n        displayName: \"structure-weaponsmith-name\",\n        workerCapacity: 5,\n        cost: {\n            gold: 30,\n        },\n        unlocks: [],\n    }, {\n        // level 3:\n        displayName: \"structure-weaponsmith-name\",\n        workerCapacity: 10,\n        cost: {\n            gold: 50,\n        },\n        unlocks: [],\n    }, {\n        // level 4:\n        displayName: \"structure-weaponsmith-name\",\n        workerCapacity: 14,\n        cost: {\n            gold: 50,\n        },\n        unlocks: [Item.poisonedDagger],\n    }],\n};\nexport default weaponsmith;\n","// tslint:disable:object-literal-sort-keys\nimport { ResourceStructureDefinition, StructureType } from \"./types\";\n\nconst weaver: ResourceStructureDefinition = {\n    cost: {\n        gold: 40,\n        time: 4000,\n    },\n    type: StructureType.resource,\n    levels: [{\n        displayName: \"structure-weaver-name\",\n        // level 0:\n        workerCapacity: 2,\n        cost: {\n            gold: 0,\n        },\n        generates: { fabric: 2 },\n    }, {\n        displayName: \"structure-weaver-name\",\n        // level 1:\n        workerCapacity: 5,\n        cost: {\n             gold: 30,\n        },\n        generates: { fabric: 5 },\n    }, {\n        displayName: \"structure-weaver-name\",\n        // level 2:\n        workerCapacity: 10,\n        cost: {\n             gold: 50,\n        },\n        generates: { fabric: 7 },\n    }],\n};\n\nexport default weaver;\n","// tslint:disable:object-literal-sort-keys\nimport { ProductionStructureDefinition, StructureType } from \"./types\";\n\nconst workshop: ProductionStructureDefinition = {\n    type: StructureType.production,\n    cost: {\n        gold: 40,\n        time: 4000,\n    },\n    levels: [{\n        // level 1:\n        displayName: \"structure-workshop-name\",\n        workerCapacity: 2,\n        cost: {\n            gold: 0,\n        },\n        unlocks: [ ],\n    }, {\n        // level 2:\n        displayName: \"structure-workshop-name\",\n        workerCapacity: 5,\n        cost: {\n            gold: 30,\n        },\n        unlocks: [],\n    }, {\n        // level 3:\n        displayName: \"structure-workshop-name\",\n        workerCapacity: 10,\n        cost: {\n            gold: 50,\n        },\n        unlocks: [],\n    }, {\n        // level 4:\n        displayName: \"structure-workshop-name\",\n        workerCapacity: 14,\n        cost: {\n            gold: 50,\n        },\n        unlocks: [],\n    }],\n};\nexport default workshop;\n"],"sourceRoot":""}