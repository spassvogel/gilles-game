{"version":3,"sources":["definitions/items/deeds.ts","definitions/items/questItems.ts","global/SceneControllerManager.ts","constants/tiledMapData.ts","definitions/quests/kill10Boars/questVars.ts","constants/text.ts","mechanics/scenes/BaseSceneController.ts","store/types/scene.ts","definitions/quests/types.ts","components/ui/common/Icon/index.tsx","global/SoundManager.ts","constants/items.ts","definitions/items/types.ts","global/TextManager.ts","utils/routing.ts","definitions/items/weapons.ts","store/actions/quests.ts","constants/dragging.ts","definitions/items/herbs.ts","definitions/items/materials.ts","definitions/items/minerals.ts","definitions/items/trinkets.ts","definitions/items/index.ts","store/types/combat.ts","utils/tilemap.ts","store/types/logEntry.ts","store/actions/adventurers.ts","global/ToastManager.tsx","definitions/quests/kill10Boars/encounters/dungeon.ts","components/ui/toasts/Toast.tsx","store/actions/combat.ts","constants/version.ts","utils/version.ts","store/types/structure.ts","mechanics/gameTick/combat.ts","utils/hitAreaShapes.ts","components/town/structures/LumberMill/LumberMill.tsx","components/pixi/ParticleEmitter.ts","components/town/structures/Tavern/index.tsx","hoc/withAppContext.tsx","components/town/structures/Generic/index.tsx","components/town/Legenda/index.tsx","components/pixi/Viewport.tsx","components/App/styles/img/cursors/dwarven_gauntlet_extra_6.png","components/town/TownStage.tsx","definitions/structures/types.ts","components/town/Clouds.tsx","definitions/structures/alchemist.ts","definitions/resources.ts","definitions/structures/armoursmith.ts","definitions/structures/garden.ts","definitions/structures/lumberMill.ts","definitions/structures/mine.ts","definitions/structures/quarry.ts","definitions/structures/tannery.ts","definitions/structures/tavern.ts","definitions/structures/warehouse.ts","definitions/structures/weaponsmith.ts","definitions/structures/weaver.ts","definitions/structures/workshop.ts","definitions/structures/index.ts","hooks/store/structures.ts","components/ui/buttons/Button/Button.tsx","components/ui/common/progress/PlainProgressbar.tsx","components/ui/window/Window.tsx","hoc/withWindow.tsx","hooks/store/engine.ts","components/ui/common/progress/TickingProgressbar.tsx","hooks/usePrevious.ts","constants/context.ts","store/selectors/tasks.ts","hooks/store/useTasksState.ts","components/structures/StructureViewHeader.tsx","components/structures/StructureLevel.tsx","global/TooltipManager.ts","components/ui/items/ItemIcon/ItemIcon.tsx","components/ui/common/UpDownValue/index.tsx","hooks/store/stockpile.ts","components/ui/items/ItemsBox.tsx","store/selectors/resources.ts","hooks/store/resources.ts","hooks/store/useGoldState.ts","components/structures/production/ResourcesCost.tsx","store/selectors/workers.ts","hooks/store/useWorkersState.ts","mechanics/crafting.ts","definitions/production/weaponsmith.ts","definitions/production/armoursmith.ts","store/types/task.ts","definitions/production/workshop.ts","definitions/production/index.ts","store/actions/stockpile.ts","store/actions/resources.ts","store/actions/structures.ts","store/actions/tasks.ts","components/structures/production/CraftingDetails.tsx","store/types/quest.ts","components/structures/production/CraftingArea.tsx","components/structures/UpgradeHelpModal.tsx","components/structures/production/UpgradeHelpModalContent.tsx","components/structures/production/ProductionStructureView.tsx","utils/format/number.ts","components/structures/warehouse/ResourcesBox.tsx","store/types/resources.ts","components/ui/tabs/Tabstrip.tsx","components/ui/tabs/Tab.tsx","components/ui/adventurer/AdventurerAvatar/index.tsx","components/world/QuestPanel/AdventurerTabstrip.tsx","hooks/store/adventurers.ts","components/ui/inventory/InventorySlot.tsx","components/ui/items/DraggableItemIcon.tsx","components/ui/inventory/Inventory.tsx","components/ui/loading/LoadingSpinner.tsx","components/world/QuestPanel/context/SceneControllerContext.tsx","hooks/actions/useItemActions.ts","components/ui/adventurer/AdventurerPanel/AdventurerSkills/index.tsx","mechanics/adventurers/levels.ts","components/ui/adventurer/AdventurerPanel/Level.tsx","definitions/traits/types.ts","utils/reselect.ts","hooks/store/quests.ts","components/ui/adventurer/AdventurerPanel/ApIndicator.tsx","definitions/traits/index.ts","components/ui/adventurer/AdventurerPanel/AdventurerTraits/index.tsx","components/ui/adventurer/AdventurerPanel/AdventurerEquipment/Guy/index.tsx","components/ui/adventurer/AdventurerPanel/AdventurerEquipment/index.tsx","components/ui/adventurer/AdventurerPanel/AdventurerPanel.tsx","components/ui/adventurer/AdventurerPanel/AdventurerSectionSelection.tsx","components/ui/adventurer/AdventurerPanel/styles/images/icon-person.png","components/ui/adventurer/AdventurerPanel/styles/images/icon-crosshair.png","components/ui/adventurer/AdventurerPanel/styles/images/icon-helmet.png","components/ui/adventurer/AdventurerPanel/styles/images/icon-sword.png","components/structures/warehouse/UpgradeHelpModalContent.tsx","components/structures/warehouse/Stockpile.tsx","components/structures/warehouse/WarehouseStructureView.tsx","components/ui/adventurer/DroppableAdventurerSlot/index.tsx","components/structures/tavern/AssignAdventurers.tsx","components/structures/tavern/QuestBoard.tsx","components/structures/tavern/rooms/AdventurerButton.tsx","components/ui/adventurer/DraggableAdventurerAvatar/index.tsx","mechanics/time.ts","components/structures/tavern/rooms/RoomWithAdventurer.tsx","components/structures/tavern/rooms/RoomEmpty.tsx","components/structures/tavern/rooms/RoomList.tsx","components/structures/tavern/UpgradeHelpModalContent.tsx","components/structures/tavern/TavernStructureView.tsx","constants/resources.ts","components/structures/resource/ResourceGenerationRow.tsx","components/ui/items/DraggableItemsList/ItemText.tsx","components/ui/items/DraggableItemsList/DraggableItemsList.tsx","mechanics/lootTable.ts","mechanics/gameTick/harvest.ts","components/ui/buttons/IconButton/IconButton.tsx","components/structures/resource/HarvestProgress.tsx","store/actions/game.ts","components/structures/styles/images/warehouse/icon.png","components/structures/resource/UpgradeHelpModalContent.tsx","components/structures/resource/ResourceStructureView.tsx","components/town/StructureDetailsView/index.tsx","components/town/TownView.tsx","components/ui/toasts/Toasts.tsx","components/ui/window/windows/SettingsWindow.tsx","components/ui/common/Select/index.tsx","store/types/adventurer.ts","components/ui/window/windows/CheatWindow.tsx","store/actions/workers.ts","utils/game.ts","components/ui/window/windows/MenuWindow.tsx","components/ui/topbar/Resourcebar.tsx","components/ui/topbar/Topbar.tsx","components/world/WorldMap/QuestMarker.tsx","components/world/WorldMap/QuestLine.tsx","components/world/WorldMap/index.tsx","store/selectors/adventurers.ts","components/pixi/tile/RectTileLayer.tsx","components/pixi/tile/ObjectTileLayer.tsx","components/pixi/tile/SpriteAnimated.tsx","components/world/QuestPanel/QuestDetails/scene/ActorThingy.tsx","components/world/QuestPanel/QuestDetails/scene/SceneActor.tsx","components/world/QuestPanel/QuestDetails/scene/SceneAdventurer.tsx","components/world/QuestPanel/QuestDetails/scene/ObjectSpriteLayer.tsx","components/world/QuestPanel/QuestDetails/scene/Tilemap.tsx","components/pixi/util/BridgedStage.tsx","hooks/useTilesetsLoader.ts","components/world/QuestPanel/QuestDetails/scene/ui/CombatUIWidget/Segment.tsx","components/world/QuestPanel/QuestDetails/scene/ui/CombatUIWidget/CombatUIWidget.tsx","components/world/QuestPanel/QuestDetails/scene/ui/NormalUICursor.tsx","components/world/QuestPanel/QuestDetails/scene/ui/SceneUI.tsx","components/pixi/DashedLine.ts","components/world/QuestPanel/QuestDetails/scene/ActionPreview.tsx","hooks/store/useLog.ts","components/world/QuestPanel/QuestDetails/scene/SceneLog.tsx","mechanics/scenes/CombatController.ts","components/world/QuestPanel/QuestDetails/scene/Scene.tsx","components/world/QuestPanel/index.tsx","components/world/QuestPanel/QuestDetails/OnTheRoad.tsx","components/world/QuestPanel/QuestDetails/index.tsx","components/world/QuestPanel/modals/LootCache/index.tsx","components/world/QuestPanel/modals/Situation/index.tsx","components/world/QuestPanel/CombatBar/index.tsx","components/log/SimpleLog.tsx","components/world/WorldView.tsx","components/ui/tooltip/Tooltip/index.tsx","components/ui/tooltip/ContextTooltip/context/ItemContext/DeedContent.tsx","mechanics/studying.ts","components/ui/tooltip/ContextTooltip/context/ItemContext/ProduceOrStudy.tsx","components/ui/tooltip/ContextTooltip/context/ItemContext/WeaponContent.tsx","components/ui/tooltip/ContextTooltip/context/ItemContext/ApparelContent.tsx","components/ui/tooltip/ContextTooltip/context/ItemContext/PotionContent.tsx","components/ui/tooltip/ContextTooltip/context/ItemContext/index.tsx","components/ui/tooltip/ContextTooltip/context/ResourceContext/index.tsx","components/ui/modals/InfoWindow/index.tsx","components/App/index.tsx","components/ui/tooltip/ContextTooltip/context/TraitContext/index.tsx","components/ui/tooltip/ContextTooltip/ContextTooltip.tsx","utils/random.ts","mechanics/gameTick/producedResources.ts","mechanics/gameTick/quests.ts","mechanics/gameTick/rngState.ts","registerServiceWorker.ts","index.tsx","store/reducers/adventurers.ts","store/reducers/engine.ts","store/reducers/gold.ts","store/reducers/stockpile.ts","store/reducers/log.ts","store/reducers/quests.ts","store/reducers/resources.ts","store/reducers/rngState.ts","store/reducers/structures.ts","store/reducers/tasks.ts","store/reducers/workers.ts","store/reducers/index.ts","store/reducers/combat.ts","utils/configureStore.ts","mechanics/gameTick/tasks.ts","definitions/quests/index.ts","definitions/quests/kill10Boars/index.ts","definitions/quests/retrieveMagicAmulet/index.ts","components/ui/adventurer/EquipmentSlot/index.tsx","store/actions/log.ts","store/helpers/storeHelpers.ts","utils/format/time.ts","definitions/items/apparel.ts","utils/pixiJs.ts","store/actions/gold.ts","definitions/items/potions.ts"],"names":["itemType","ItemType","deed","basePath","deeds","alchemist","structure","iconImg","armoursmith","lumbermill","tavern","weaponsmith","workshop","all","Object","entries","reduce","acc","key","value","getDefinition","isDeed","item","questItem","questItems","blueprints","crate","dynamite","dragonEye","eye","feather","food","heart","horn","letters","lockPicks","oil","orcFinger","plans","purpleGems","runestone","sandwich","teeth","tooth","torch","tusk","vase","vial","weeds","isQuestItem","SceneControllerManager","questName","sceneName","controllerType","this","controllerTypes","store","Error","require","TiledLayerType","Orientation","RenderOrder","initialQuestVars","dungeon","entered","entrance","chestOpen","chest","title","items","gold","hallway","doorOpen","isTextEntry","test","movementDuration","BaseSceneController","mapData","aStar","dataLoading","dataLoadComplete","jsonPath","blockedTiles","process","substr","lastIndexOf","callback","loadSound","sound","files","a","Promise","resolve","_reject","SoundManager","addSound","sounds","promises","loadResourceAsync","then","resource","Loader","shared","resources","data","createBlockedTiles","createAStar","spritesheets","getSpritesheetPaths","sceneObjects","length","createObjects","path","objects","layers","filter","layer","visible","forEach","properties","some","p","name","addAllTilesInLayerToList","width","o","blocksMovement","location","push","updateScene","combat","scene","quest","dispatch","setScene","tileWidth","tilewidth","tileHeight","tileheight","_actor","destination","getObjectAtLocation","type","TiledObjectType","exit","loadScene","setSceneName","index","Math","floor","progress","node","nodes","log","addLogText","LogChannel","exitEncounter","actorId","actor","getSceneActor","object","interactWithObject","console","warn","SceneActionType","move","findPath","ap","deductActorAp","l","sceneAction","actionType","target","endsAt","performance","now","enqueueSceneAction","interact","findPathNearest","moveAction","interactAction","slash","pop","meleeAction","_object","point","x","y","locationEquals","height","_name","lootCache","getLootCache","addGold","itemIndex","adventurerId","toSlot","addItemToInventory","adventurer","getAdventurerById","inventory","indexOf","undefined","removeItemFromInventory","_situation","_adventurerId","_option","origin","convertIn","map","convertOut","includeLast","grid","getGrid","getGridNodes","matrix","r","c","getIsWalkable","tempAStar","AStarFinder","includeStartNode","heuristic","weight","slice","from","to","endPlayerTurn","sceneActors","find","sA","row","blocked","locationIsBlocked","objectLayers","objectgroup","adventurers","getAdventurers","objectLayer","parseProperties","gid","layerId","id","adventurerStart","isActorObject","health","allegiance","Allegiance","player","isSprite","spritesheet","spritesheetPath","enemySpawn","random","enemy","isAdventurer","isEnemy","getState","quests","q","questVars","updated","updateQuestVars","storeState","adventurersOnQuest","input","icon","toast","textEntry","TextManager","getTextEntry","ToastManager","addToast","Type","questUpdate","getQuestLink","addLogEntry","action","Array","Set","QuestNodeType","IconSize","Border","Icon","props","image","size","children","className","border","restProps","sizeClassName","style","backgroundImage","borderClassName","smallest","small","medium","big","biggest","none","Channel","MixMode","Music","STORAGE_KEY_VOLUME","music","localforage","getItem","ui","_channelVolume","_initialized","gameSound","complete","_sounds","loader","file","add","load","_","values","Boolean","channel","loop","mixMode","singleInstance","storePosition","init","pixiSound","getSound","volume","_currentSound","oldSoundInfo","instance","once","duration","_storedPositions","start","play","fade","gsap","onComplete","destroy","stop","on","filters","_filter","setItem","TelephoneFilter","Rarity","texts","precompile","templates","notFound","compileAll","initialized","context","result","getDefault","error","template","getTemplate","get","compile","slotType","toKebab","EquipmentSlotType","trait","WeaponType","weaponClass","WeaponClassification","join","keys","Handlebars","article","itemArticleAuto","itemArticleDefined","link","getStructureLink","itemArticleUndefined","getItemName","articleTemplate","noun","getWorldLink","getTownLink","onlyHighlight","WeaponAbility","weapon","DamageType","WeaponTypeDefinition","axe","classification","oneHanded","abilities","cut","bow","shoot","club","swing","parry","crossbow","mainHand","aimedShot","fist","flail","hammer","knife","staff","twoHanded","sword","poleArm","shield","block","weapons","aegisOfValor","weaponType","rarity","legendary","arbalest","epic","damage","kinetic","battleAxe","common","berserkerShield","brassKnuckles","bronzeDagger","buckler","cleaver","dagger","rare","dirk","uncommon","falchion","goldenShield","greatswordOfGwai","unique","halbert","huntingBow","indomitableCarapace","jaggedBlade","javelin","khopesh","legionnaireSword","longbow","mace","morningStar","paintedBuckler","poisonedDagger","pikeStaff","ravenStaff","scythe","savageStaff","simpleCrossbow","spear","steelShield","steelSword","warhammer","woodenBulwark","isWeapon","launchQuest","assignedAventurers","vars","completeSceneAction","setCombat","startTurn","turn","setActiveSceneInteractionModal","sceneInteractionModal","DragSourceType","DragType","ADVENTURER","ITEM","herb","herbs","angelicasSorrow","bansheeReeds","blissflower","bloodLotus","bogroot","ceviorise","chicory","dragonroot","heartsVine","hyacinthus","jaboticaba","kingsrose","lastSupper","mistagold","monksweed","moonFlower","mountainGrass","oakLeaf","patricksroot","sunleaf","trollsFeast","uwolic","wyrmvine","winterWeed","wizardsBane","material","materials","arrowheads","beam","bolts","buckle","chain","cogs","gunpowder","ingot","nails","pile","planks","poisonVial","pulley","ribbon","rope","runeCarvedPlank","scales","spring","stake","stick","thread","woodenMask","mineral","minerals","amethyst","aquamarine","arminsHeart","dragonsTooth","greenOpal","jasper","malachite","moonstone","obsidian","roseQuartz","sapphire","spellstone","tigersEye","topaz","wyrdstone","trinket","trinkets","magicAmulet","ring","apparel","potions","getAllItemsByType","potion","CombatActionType","barBrawl","actors","remainingAP","findTileset","tilesets","tileset","i","firstgid","list","columns","tile","b","drinkPotion","fromSlot","moveItemInInventory","assignEquipment","equipmentSlot","removeEquipment","renameAdventurer","EVENT_TOASTS_UPDATED","stack","time","Date","emit","playSound","setTimeout","lifeTime","_instance","EventEmitter","FIVE_SECONDS","DungeonEncounterSceneController","DungeonEntranceSceneController","getAdventurerByActor","situation","DungeonHallwaySceneController","choices","text","option","discardItem","interactive","part","registerSceneController","Toast","achievementUnlocked","history","useHistory","typeText","getToastType","onClick","ActionType","version","asInt","semVer","parts","split","Number","numericVersion","convertSemVerToInt","StructureState","updateCombat","delta","moveActor","clearCombatAction","HitAreaShapes","shapes","sprite","definition","shape","PIXI","contains","LumberMill","hitAreaShapes","atlas","useState","textures","setTextures","selected","STRUCTURE_HIGHLIGHT_FILTER","app","useApp","useEffect","loadResource","rotation","setRotation","useTick","position","buttonMode","pointertap","onStructureClick","texture","anchor","Point","ParticleEmitter","PixiComponent","create","applyProps","oldProps","newProps","config","newP","applyDefaultProps","emitter","_emitter","particles","elapsed","tick","_raf","requestAnimationFrame","update","willUnmount","cancelAnimationFrame","Tavern","hitArea","smoke","withAppContext","WrappedComponent","AppContext","Consumer","Component","Generic","Legenda","structures","match","useRouteMatch","renderText","params","getStructureName","state","NotBuilt","Viewport","forwardRef","ref","cursor","renderer","plugins","interaction","cursorStyles","pointer","PixiComponentViewport","displayName","viewport","PixiViewport","screenWidth","screenHeight","worldWidth","worldHeight","ticker","event","minScale","maxScale","drag","pinch","wheel","clamp","direction","clampZoom","decelerate","TownStage","innerRef","useRef","useImperativeHandle","current","godray","enabled","horizontalFactor","utils","normalize","right","verticalFactor","bottom","factor","max","gain","lacunarity","onScroll","e","preventDefault","window","addEventListener","passive","removeEventListener","options","StructureType","autoDensity","sharedLoader","GodrayFilter","Clouds","speed","randomCloud","cloud","setCloud","setX","randomY","setY","alpha","Resource","production","cost","levels","workerCapacity","unlocks","wood","iron","stone","ONE_MINUTE","TWO_MINUTES","garden","generates","harvest","amount","lootTable","lumberMill","HALF_HOUR","mine","quarry","tannery","leather","rooms","warehouse","maxResources","fabric","maxStockpile","FOUR_MINUTES","THREE_MINUTES","weaver","isProductionStructure","isResourceStructure","getStructureByResource","ButtonSize","ButtonColor","useStructureState","structureSelector","useCallback","useSelector","useStructureDefinition","structureDefinition","useStructureLevel","level","Direction","Button","color","square","otherProps","blue","auto","Window","musicFiltered","backEnabled","_e","onBack","closeEnabled","onClose","withWindow","React","PlainProgressbar","val","min","animationTime","previousProgress","label","transition","useEngine","engine","usePrevious","ContextType","TickingProgressbar","previousTick","useDelta","animate","setAnimate","increasing","decreasing","getTasks","tasks","useCraftingTasksStateByStructure","createSelector","running","createSelectCraftingTasksByStructure","useStudyingTasksStateByStructure","createSelectStudyingTasksByStructure","useUpgradeTasksStateByStructure","createSelectUpgradeTasksByStructure","StructureViewHeader","StructureLevel","onHelpClicked","addUpgradeCallbacks","nextLevel","upgradeText","upgradeTasks","t","formatDuration","timeRemaining","startTime","disabled","EVENT_CONTEXT_UPDATED","TooltipManager","info","originRect","source","referenceRect","deepEquals","lastContext","clear","ItemIcon","itemDefinition","getIconClassName","showContext","currentTarget","getBoundingClientRect","showContextTooltip","stopPropagation","UpDownValue","displayValue","upDisabled","onUp","downDisabled","onDown","useStockpileState","stockpile","useStockpileStateFlat","useMemo","flat","ItemsBox","aggregate","itemsInInventory","tmpWarehouse","tmpItems","found","findIndex","splice","removed","listItems","listItemClass","itemDescription","selectMaxResources","useResourcesState","useMaxResourcesState","useGoldState","ResourcesCost","storeResources","sufficientResources","availableGold","sufficientGold","resourceDescription","resourceDescriptions","getResourceName","selectFreeWorkers","workers","useWorkersFreeState","calculateProductionTime","weaponsmithProduction","levelRequired","TaskType","armoursmithProduction","workshopProduction","addItemToWarehouse","moveItemInWarehouse","removeItemFromWarehouse","addResources","removeResources","finishBuildingStructure","upgradeStructure","increaseWorkers","addItemToToProduces","startTask","taskType","callbacks","QuestStatus","CraftingDetails","useDispatch","resourcesState","stockpileState","workersFree","workersAssigned","setWorkersAssigned","produces","getProductionDefinition","costResources","missingAtLeastOneResource","missingAtLeastOneItem","costMaterials","handleCraft","productionDefinition","craftingTime","craftItem","asNumber","makeTimeString","CraftingArea","selectedItem","setSelectedItem","handleSelectCraftingItem","UpgradeHelpModal","goldCost","missingGold","canUpgrade","subtractGold","town","UpgradeHelpModalContent","renderRow","ProductionStructureView","craftingTasks","studyingTasks","content","component","formatNumber","digits","SI_SYMBOL","tier","log10","toFixed","suffix","scale","pow","scaled","deltaResources","full","structureText","Built","empty","Tabstrip","activeTab","Children","child","cloneElement","active","handleTabClick","tabId","onTabSelected","Tab","AdventurerAvatar","avatarImg","AdventurerTabstrip","onAdventurerTabSelected","selectedAdventurerId","useAdventurersInTown","status","party","getAdventurersInTown","useAdventurerState","adventurerSelector","dropTarget","drop","monitor","onDrop","canDrop","dragInfo","sourceType","adventurerEquipment","inventorySlot","itemAndEquipmentSlotMatch","canDropHere","DropTarget","connect","connectDropTarget","isOver","isActive","classNames","DragSource","beginDrag","onStartDrag","sourceId","connectDragSource","dragSource","isDragging","slot","Inventory","slots","contents","iconSize","onDropItem","LoadingSpinner","SceneControllerContext","createContext","SceneControllerContextProvider","useStore","loaded","setLoaded","previousQuestVars","controller","getSceneController","loadData","createScene","sceneEntered","Provider","useItemDropActions","sceneController","useContext","dropItemEquipment","actions","adventurerInventory","existingEquipment","equipment","dropItemInventory","otherItem","takeItemFromCache","dropItemWarehouse","stockpileCategory","AdventurerSkills","skills","s","skill","handleClick","getSkillName","renderSkill","levelToXp","Trait","Level","xp","currentLevel","sqrt","xpToLevel","currentLevelXp","nextLevelXp","dingAnimationRunning","setDingAnimationRunning","lastState","lastAdventurer","lastDingAnimationRunning","next","createStringArraySelector","createSelectorCreator","defaultMemoize","stringArrayEqual","getQuests","getQuestNames","getQuestStatus","getActiveQuests","useQuest","questSelector","ApIndicator","arrowFinder","hasEffect","gloomy","houseHouston","houseMaddox","houseMonroe","AdventurerTraits","renderTrait","last","traitDefinition","getTraitName","traits","Guy","damageReduction","findDR","head","hands","shoulders","legs","feet","useAdventurerDamageReduction","renderDamageReduction","equipmentType","dR","AdventurerEquipment","onDropItemEquipment","getEquipmentSlot","EquipmentSlot","offHand","AdventurerPanel","horizontalMode","levelBar","onStartInventoryItemDrag","AdventurerSectionSelection","sectionParent","parentNode","debounce","fromTop","scrollTop","querySelectorAll","hash","substring","section","document","querySelector","offsetTop","clientHeight","classList","remove","smooth","src","res","WAREHOUSE","Stockpile","selectedItemType","setSelectedItemType","dragDropManager","useDragDropManager","dragging","getMonitor","dragItem","dragItemType","getItemType","WarehouseStructureView","adventurersInTown","selectedAdventurer","setSelectedAdventurer","resourcesDelta","setResourcesDelta","previousResources","resourcesRef","structuresState","timeout","clearTimeout","structureState","levelDefinition","currentLevelDefinition","_props","_monitor","AssignAdventurers","onAdventurerClicked","onAdventurerDropped","availableSlots","slotsContent","QuestBoard","checkEnoughItems","questDefinition","requiredItems","every","amountRequired","availableQuests","selectedQuestName","onQuestClick","getQuestTitle","fullParty","enoughItems","canLaunch","getQuestDescription","onRemoveAdventurer","onLaunchQuest","getQuestDetails","AdventurerButton","onAddAdventurer","isAssigned","emptySlot","getEmptySlot","spec","TimeType","RoomWithAdventurer","onQuest","expanded","assigned","SOURCE_ID","prompt","RoomEmpty","RoomList","roomCount","handleAdventurerClick","roomContent","room","TavernStructureView","setAassignedAdventurers","selectedQuest","setSelectedQuest","getAvailableQuests","available","handleAddAdventurer","copy","handleRemoveAdventurer","handleQuestClick","questTitle","leader","questLaunched","RESOURCE_INTERVAL","resourceOrder","ResourceGenerationRow","lastProducedUpdate","ItemText","getItemSubtext","DraggableItemsList","renderButton","cheatTimeMultiplier","getTimeMultiplier","cheat","pick","table","totalWeight","randomNumber","HARVEST_INTERVAL","ONE_HOUR","getHarvest","lastHarvest","resourceGeneration","resourceStructureDefinition","itemCount","handleStructure","IconButton","HarvestProgress","percentage","ResourceStructureView","selectHarvest","decreaseWorkers","resourceStructure","warehouseIcon","removeItemFromHarvest","handleItemTake","StructureDetailsView","buildTask","Building","renderContent","RoutedStructureDetailsView","useParams","OutlineFilter","selectedStructure","viewportRef","tween","thickness","yoyo","repeat","pause","kill","handleStructureClick","zoomPercent","getStructurePosition","moveCenter","MAX_WIDTH","canvasWidth","setCanvasWidth","canvasHeight","setCanvasHeight","resize","worldViewWidth","clientWidth","worldViewHeight","reverse","StructureComponent","getStructure","polygons","Toasts","activeToasts","setActiveToasts","toastsUpdated","addListener","removeListener","toastConfig","compose","getChannelControls","slider","lastChild","setChannelVolume","role","aria-label","step","onChange","linear","parseFloat","defaultValue","getChannelVolume","open","DefaultSelect","styles","control","provided","minHeight","boxShadow","isFocused","container","_state","flex","padding","placeholder","whiteSpace","valueContainer","marginTop","indicatorsContainer","AdventurerColor","cheats","setCheats","timeMultiplier","setTimeMultiplier","handleChangeStructureState","checked","setStructureState","onCheatStructureState","k","isNaN","parseInt","typeKey","subtext","allItems","_evt","onCheatGold","onCheatWorkers","onCheatResources","Select","formatGroupLabel","formatOptionLabel","onCheatItem","setCheatTimeMultiplier","structureDef","getStructureDefinition","structureStore","levelDef","getStructureRow","encryptor","createEncryptor","loadedStore","setLoadedStore","handleClickLoad","loadGame","game","onCloseWindow","onOpenWindow","createElement","JSON","stringify","encrypted","encrypt","setAttribute","encodeURIComponent","click","saveGame","fileReader","FileReader","onload","decrypt","parse","decryptSavedGame","readAsText","Resourcebar","goldState","createItem","Topbar","persistor","QuestMarker","encounterActive","avatar","maskGraphics","beginFill","drawCircle","CIRCLE_DIAMETER","endFill","mask","addChild","pointerdown","QuestLine","positions","draw","graphics","lineStyle","moveTo","xc","yc","quadraticCurveTo","WorldMap","retrieveWorldViewRef","smallMap","activeQuests","selectMemoized","useActiveQuests","WIDTH","worldView","SMALL_HEIGHT","focusOnQuestingParty","nodeLocationToPoint","partyLocation","getQuestWorldLocation","previousPositions","getPreviousPositions","currentPosition","getQuestLeader","questNode","encounter","onPartyClick","roundedProgress","lastNode","nextNode","lerpLocation","WORLD_WIDTH","WORLD_HEIGHT","lastPosition","DebugToggleCombat","createSelectAdventurersOnQuest","foundInParty","groupedAdventurers","foundAdventurers","RectTileLayer","CompositeRectTileLayer","horizontalTiles","w","h","spriteId","addFrame","ObjectTileLayer","_oldProps","SpriteAnimated","gotoAndPlay","ActorThingy","useActorThingyInfo","fontFamily","fontSize","fill","align","wordWrap","wordWrapWidth","dropShadow","dropShadowAngle","dropShadowBlur","dropShadowDistance","drawRect","SceneActor","idleAnimation","lookAt","rest","getTileDimensions","actorRef","previousAction","actionQueueSelector","actionQueue","animation","setAnimation","determineOrientation","nextAction","setOrientation","north","northEast","east","southEast","south","southWest","west","northWest","moveComplete","actorMoved","killTweensOf","ease","pixi","actorInteract","frames","setFrames","indexed","frame","replace","orientation","flipped","bearing","calculateBearing","interval","setInterval","left","clearInterval","getFrames","black","createColorReplaceFilter","BLUES","BLACK","orange","ORANGE","purple","PURPLE","red","REDS","teal","TEALS","white","WHITE","yellow","YELLOW","showThingy","animationSpeed","isPlaying","SPRITE_WIDTH","pivot","memo","angle","atan2","round","PI","replacements","MultiColorReplaceFilter","SceneAdventurer","ObjectSpriteLayer","selectedActorId","Tilemap","getLayerObjects","tileObjects","spriteObjects","Fragment","tilelayer","BridgedStage","useTilesetsLoader","tileSpritesheets","setTilesets","setData","nextTileset","nextTilesetToload","tilesetName","spritesheetData","parseSpritesheetData","Spritesheet","newTilesets","loadComplete","loadTilesets","tilesetsTextures","tilecount","spriteSourceSize","rotated","trimmed","sourceSize","meta","imagewidth","imageheight","Segment","onActivate","onDeactivate","activated","rot","transform","segmentWidth","segmentHeight","background","zIndex","onMouseOver","onMouseOut","alt","CombatUIWidget","actionIntent","onActionChange","collapsed","setCollapsed","actorLocation","handleSegmentActivate","handleSegmentDeactivate","_action","onMouseMove","getText","insufficient","actorAP","apCost","NormalUICursor","images","SceneUI","sceneWidth","sceneHeight","onMouseDown","onSetActionIntent","mouseDown","cursorLocation","setCursorLocation","handleResize","canvas","currentWidth","handleCombatActionChange","calculateWalkApCosts","findLocation","Element","rect","clientX","clientY","top","pointToSceneLocation","locationIsOutOfBounds","onMouseUp","selectedActorLocation","actorAttemptAction","DashedLine","points","dash","gap","_destroy","alignment","native","offsetPercentage","abs","dashLeft","gapLeft","progressOffset","rotatedpoints","clone","cosAngle","cos","sinAngle","sin","dx","dy","p1","p2","len","normal","progressOnLine","lineTo","ActionPreview","convert","converted","valid","getLog","SceneLog","questId","channelContext","useQuestLog","lastLog","shift","CombatController","storeChange","handleStoreChange","bind","unsubscriber","subscribe","sceneAdventurers","enemies","sceneEnemies","totalAdventurerAp","totalEnemiesAp","findEnemyWithAp","getTime","findNearestActor","distance","MAX_VALUE","steps","Layout","Scene","setSelectedActor","currentActionIntent","setCurrentActionIntent","initialize","Rectangle","OnTheRoad","QuestDetails","LootCache","freeSlots","adventurerFreeInventorySlots","cache","cacheName","el","stagger","each","takeGoldFromCache","Situation","getSituation","handleChoiceClick","choice","getAttribute","handleSituationOptionClick","data-option","CombatBar","endTurn","ChannelType","QuestPanel","layout","setSelectedAdventurerID","activeInteractionModal","handleAdventurerSelected","handleCloseLootCacheModal","WorldView","worldMapRef","questname","Placement","SimpleLog","setExpanded","selectedTabId","setSelectedTabId","logEntries","activeQuestNames","questNameSelector","names","statuses","useActiveQuestNames","useLocation","pathname","channels","tabType","displayEntries","currentTab","lE","tab","entry","logEntry","getLogEntryRow","DeedContent","getDeedDefinition","enoughGold","startBuildingStructure","buildStructure","handleStartConstruction","STUDY_TIME","ProducedAtStructure","studyTasks","task","sT","studyTime","studyItem","ProduceOrStudy","isApparel","getItemDefinition","WeaponContent","getWeaponDefinition","getWeaponType","classificationText","getWeaponClassification","ApparelContent","getApparelDefinition","onAnAdventurer","handleDrink","ItemContext","isPotion","PotionContent","ResourceContext","workersState","workersFreeState","structureStates","renderProducedBy","free","total","InfoWindow","View","Tooltip","placement","setPlacement","containerRect","setContainerRect","tooltipElement","tooltipRect","opacity","contentElement","offset","closest","TraitContext","getTraitDescription","getTraitEffect","ContextTooltip","selectedContext","setSelectedContext","tooltipUpdated","getItemNameClassName","getSkillInfo","PixiPlugin","registerPIXI","registerPlugin","generator","App","containerRef","activeWindows","setActiveWindows","handleViewButtonClick","handleWindowClose","handleWindowBack","handleScroll","maxWidth","DndProvider","backend","HTML5Backend","exact","restartGame","render","topWindow","commonWindowProps","renderWindow","getProducedResources","accumulator","getQuestUpdates","questProgress","currentProgress","currentNodeIndex","nothing","progressIncrease","nextProgress","nodesPassed","startScene","questEncounter","logUpdates","questUpdates","dirty","getRngState","Random","isLocalhost","hostname","register","navigator","URL","toString","swUrl","fetch","response","headers","serviceWorker","ready","registration","unregister","reload","registerValidSW","catch","checkValidServiceWorker","onupdatefound","installingWorker","installing","onstatechange","generateRandomAttributes","strength","dexterity","intelligence","avatarImgBasePath","spritesheetBasePath","initialAdventurers","basicAttributes","baseAP","getInitialEngineState","gameStarted","lastTick","initialGoldState","getInitialStockpile","itemTypeName","randomItem","getRandomItemOfType","initialLogState","initialQuestState","encounterResults","overwriteMerge","sourceArray","initialResourcesState","initialRngState","updateStructureState","structureInitialState","initialStructuresState","createTask","initialTasksState","completed","initialWorkersState","combineReducers","category","element","fromAdventurerId","toAdventurerId","fromAdventurer","concat","startCombatAction","addAction","combatType","resourcesToAdd","timeLeft","lU","qss","getInitialQuestVars","deepmerge","arrayMerge","questsToUpdate","questToUpdate","resourcesToRemove","rngState","assign","workersToAdd","workersToRemove","structureAsString","end","persistConfig","storage","localForage","persistedReducer","persistReducer","rootReducer","configureStore","initial","createStore","__REDUX_DEVTOOLS_EXTENSION__","persistStore","isHydrated","storeIsRehydrated","processCompletedTasks","itemCrafted","handleCompletedTask","initGame","seed","seedrandom","setupStore","storeConfiguration","continueGame","startNewGame","runGame","purge","href","confirm","ReactDOM","getElementById","registerServiceWorker","logs","resourcesUpdates","harvestUpdates","gameTick","kill10Boars","getQuestVars","questStore","_questStore","retrieveMagicAmulet","baz","zux","equipmentSlotType","checkEquipment","borderColor","findAdventurerById","leaderId","ONE_DAY","ONE_YEAR","ms","short","timeUnitsList","unit","output","tmp","boots1","boots2","boots3","chainmailHood","clothGloves","cowl","cultistBoots","crimsonRogueBoots","crimsonRogueBritches","crimsonRogueCoif","crimsonRogueGrips","crimsonRogueSpaulders","crimsonRogueTunic","cultistGloves","cultistPants","cultistRobe","cultistShoulderwraps","darkPrinceBracers","darkPrinceCape","darkPrinceCuirass","darkPrinceHood","darkPrinceSarong","darkPrinceSlippers","dreadnoughtBoots","dreadnoughtChest","dreadnoughtGauntlets","dreadnoughtHelm","dreadnoughtLegplates","dreadnoughtPauldrons","druidChest","druidFeet","druidHands","druidHead","druidLegs","fedora","footmanBoots","footmanBreastplate","footmanFaceguard","footmanFists","footmanLegplates","footmanPauldrons","greaves1","greaves2","hornedHelmet","leatherGloves","naturalistsCape","naturalistsCowl","naturalistsFootwraps","naturalistsVambraces","naturalistsVest","nomadHelmet","pants1","pants2","plateChest1","plateChest2","plateChest3","plateChest4","plateGloves1","plateGloves2","plateHelmet","platePants","plateShoulders1","plateShoulders2","robe","shoulders1","shoulders2","shoulders3","studdedLeatherShoulderguards","sunchaserBritches","sunchaserGloves","sunchaserHelm","sunchaserMantle","sunchaserMoccasins","sunchaserTunic","templeGuardChestplate","templeGuardGloves","templeGuardGreaves","templeGuardHelm","templeGuardLegplates","templeGuardPauldrons","vest","point1","point2","lerp","n1","n2","minorHealth","minorMana","minorSoma","lesserHealth","lesserMana","lesserSoma","majorHealth","majorMana","majorSoma","greaterHealth","greaterMana","greaterSoma"],"mappings":"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EH,aAAc,SAACC,GAAD,OAAiCA,EAAWpoD,WAC1DolD,oBAAqB,SAACiD,GAKlB,MAJ2C,CACvCE,KAAK,EACLC,IAAK,KAIb9vB,cAAe,CACX,kBACA,kBACA,kBACA,qBACA,sBAEJt/B,MAAO,CAAC,CACJkC,EAAG,EACHC,EAAG,EACH7C,KAAM0I,IAAck/C,SACrB,CACChlD,EAAG,EACHC,EAAG,EACH7C,KAAM0I,IAAck/C,SACrB,CACChlD,EAAG,EACHC,EAAG,EACH7C,KAAM0I,IAAck/C,SACrB,CACChlD,EAAG,EACHC,EAAG,EACH7C,KAAM0I,IAAck/C,SACrB,CACChlD,EAAG,EACHC,EAAG,EACH7C,KAAM0I,IAAck/C,SACrB,CACChlD,EAAG,EACHC,EAAG,EACH7C,KAAM0I,IAAck/C,SACrB,CACChlD,EAAG,EACHC,EAAG,EACH7C,KAAM0I,IAAck/C,SACrB,CACChlD,EAAG,EACHC,EAAG,EACH7C,KAAM0I,IAAck/C,SACrB,CACChlD,EAAG,EACHC,EAAG,EACH7C,KAAM0I,IAAck/C,SACrB,CACChlD,EAAG,EACHC,EAAG,EACH7C,KAAM0I,IAAck/C,SACrB,CACChlD,EAAG,GACHC,EAAG,EACH7C,KAAM0I,IAAck/C,SACrB,CACChlD,EAAG,GACHC,EAAG,EACH7C,KAAM0I,IAAck/C,SACrB,CACChlD,EAAG,GACHC,EAAG,EACH7C,KAAM0I,IAAck/C,SACrB,CACChlD,EAAG,GACHC,EAAG,EACH7C,KAAM0I,IAAck/C,SACrB,CACChlD,EAAG,GACHC,EAAG,EACH7C,KAAM0I,IAAck/C,SACrB,CACChlD,EAAG,GACHC,EAAG,EACH7C,KAAM0I,IAAck/C,SACrB,CACChlD,EAAG,GACHC,EAAG,EACH7C,KAAM0I,IAAck/C,SACrB,CACChlD,EAAG,GACHC,EAAG,EACH7C,KAAM0I,IAAck/C,SACrB,CACChlD,EAAG,GACHC,EAAG,EACH7C,KAAM0I,IAAck/C,SACrB,CACChlD,EAAG,GACHC,EAAG,EACH7C,KAAM0I,IAAck/C,SACrB,CACChlD,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","file":"static/js/main.5c27ccb4.chunk.js","sourcesContent":["import { Structure } from \"../structures\";\nimport { Item, ItemDefinition, ItemType } from \"./types\";\n\ntype Prefix = \"deed/\";\nconst PREFIX = \"deed/\";\nconst itemType = ItemType.deed;\nconst basePath = \"/img/items/deeds/\";\n\nexport interface DeedDefinition extends ItemDefinition {\n    structure: Structure;\n}\n\nconst deeds = {\n    alchemist: {\n        structure: \"alchemist\" as const,\n        itemType,\n        iconImg: `${basePath}deed.png`,\n    },\n    armoursmith: {\n        structure: \"armoursmith\" as const,\n        itemType,\n        iconImg: `${basePath}deed.png`,\n    },\n    lumbermill: {\n        structure: \"lumberMill\" as const,\n        itemType,\n        iconImg: `${basePath}deed.png`,\n    },\n    tavern: {\n        structure: \"tavern\" as const,\n        itemType,\n        iconImg: `${basePath}deed.png`,\n    },\n    weaponsmith: {\n        structure: \"weaponsmith\" as const,\n        itemType,\n        iconImg: `${basePath}deed.png`,\n    },\n    workshop: {\n        structure: \"workshop\" as const,\n        itemType,\n        iconImg: `${basePath}deed.png`,\n    }\n}\n\nexport type Deed = `${Prefix}${keyof typeof deeds}`;\nconst all = Object.entries(deeds).reduce<{[key: string]: DeedDefinition}>((acc, [key, value]) => {\n    acc[`${PREFIX}${key}`] = value;\n    return acc;    \n}, {}) as Record<Deed, DeedDefinition>;\nexport default all;\n\nexport function getDefinition(deed: Deed): DeedDefinition {\n    return all[deed] as unknown as DeedDefinition;\n}\n\nexport const isDeed = (item: Item): item is Deed => {\n    return !!all[item as Deed];\n}","import { Item, ItemDefinition, ItemType } from \"./types\";\n\ntype Prefix = \"questItem/\";\nconst PREFIX = \"questItem/\";\nconst itemType = ItemType.questItem;\nconst basePath = \"/img/items/quest-items/\";\n\n\nconst questItems = {\n    blueprints: {\n        itemType,\n        iconImg: `${basePath}blueprints.png`,\n    },\n    crate: {\n        itemType,\n        iconImg: `${basePath}crate.png`,\n    },\n    dynamite: {\n        itemType,\n        iconImg: `${basePath}dynamite.png`,\n    },\n    dragonEye: {\n        itemType,\n        iconImg: `${basePath}dragon-eye.png`,\n    },\n    eye: {\n        itemType,\n        iconImg: `${basePath}eye.png`,\n    },\n    feather: {\n        itemType,\n        iconImg: `${basePath}feather.png`,\n    },\n    food: {\n        itemType,\n        iconImg: `${basePath}food.png`,\n    },\n    heart: {\n        itemType,\n        iconImg: `${basePath}heart.png`,\n    },\n    horn: {\n        itemType,\n        iconImg: `${basePath}horn.png`,\n    },\n    key: {\n        itemType,\n        iconImg: `${basePath}key.png`,\n    },\n    letters: {\n        itemType,\n        iconImg: `${basePath}letters.png`,\n    },\n    lockPicks: {\n        itemType,\n        iconImg: `${basePath}lock-picks.png`,\n    },\n    oil: {\n        itemType,\n        iconImg: `${basePath}oil.png`,\n    },\n    orcFinger: {\n        itemType,\n        iconImg: `${basePath}orc-finger.png`,\n    },\n    plans: {\n        itemType,\n        iconImg: `${basePath}plans.png`,\n    },\n    purpleGems: {\n        itemType,\n        iconImg: `${basePath}purple-gems.png`,\n    },\n    runestone: {\n        itemType,\n        iconImg: `${basePath}runestone.png`,\n    },\n    sandwich: {\n        itemType,\n        iconImg: `${basePath}sandwich.png`,\n    },\n    teeth: {\n        itemType,\n        iconImg: `${basePath}teeth.png`,\n    },\n    tooth: {\n        itemType,\n        iconImg: `${basePath}tooth.png`,\n    },\n    torch: {\n        itemType,\n        iconImg: `${basePath}torch.png`,\n    },\n    tusk: {\n        itemType,\n        iconImg: `${basePath}tusk.png`,\n    },\n    vase: {\n        itemType,\n        iconImg: `${basePath}vase.png`,\n    },\n    vial: {\n        itemType,\n        iconImg: `${basePath}vial.png`,\n    },\n    weeds: {\n        itemType,\n        iconImg: `${basePath}weeds.png`,\n    },\n};\n\n\nexport type QuestItem = `${Prefix}${keyof typeof questItems}`;\nconst all = Object.entries(questItems).reduce<{[key: string]: ItemDefinition}>((acc, [key, value]) => {\n    acc[`${PREFIX}${key}`] = value;\n    return acc;    \n}, {}) as Record<QuestItem, ItemDefinition>;\nexport default all;\n\nexport function getDefinition(questItem: QuestItem): ItemDefinition {\n    return all[questItem];\n}\n\nexport const isQuestItem = (item: Item): item is QuestItem => {\n    return !!all[item as QuestItem];\n}\n","import { Store, AnyAction } from \"redux\";\nimport { StoreState } from 'store/types';\nimport { BaseSceneController } from 'mechanics/scenes/BaseSceneController';\n\nexport abstract class SceneControllerManager {\n    static store: { [key: string]: BaseSceneController<unknown> } = {};\n    static controllerTypes: {[key: string]: typeof BaseSceneController} = {};\n\n    static registerSceneController(questName: string, sceneName: string, controllerType: typeof BaseSceneController) {\n        this.controllerTypes[`${questName}.${sceneName}`] = controllerType;\n    }\n\n    /**\n     * Gets the scenecontroller for scene. Creates it if it doesnt exist\n     */\n    static getSceneController(questName: string, sceneName: string, store: Store<StoreState, AnyAction>): BaseSceneController<unknown> {\n        if (!this.store[`${questName}.${sceneName}`]) {\n            if (!this.controllerTypes[`${questName}.${sceneName}`]) {\n                throw new Error(`No controller registered for ${questName}.${sceneName}`);\n            }\n            this.store[`${questName}.${sceneName}`] = new this.controllerTypes[`${questName}.${sceneName}`](store, questName);\n        }\n        return this.store[`${questName}.${sceneName}`];\n    }\n\n    static destroySceneConroller(questName: string, sceneName: string, ) {\n        delete this.store[`${questName}.${sceneName}`];\n    }\n}\n\nrequire('definitions/quests/kill10Boars/encounters/dungeon');\n","export interface TiledMapData {\n    width: number;\n    height: number;\n    tilewidth: number;\n    tileheight: number;\n    infinite: boolean;\n    backgroundcolor: string | null;\n    orientation: Orientation;\n    renderorder: RenderOrder;\n    tilesets: TiledTilesetData[];\n    layers: TiledLayerData[];\n}\n\nexport interface TiledTilesetData {\n    columns: number;\n    firstgid: number;\n    source: string;\n    image: string;\n    imagewidth: number;\n    imageheight: number;\n    tilewidth: number;\n    tileheight: number;\n    tilecount: number;\n    name: string;\n    margin: number; // todo:\n    spacing: number; // todo\n    tiles?: TileData[];\n}\n\nexport interface TileData {\n    id: number,\n    image: string;\n    properties?: TiledProperty[];\n}\n\nexport interface TiledLayerData {\n    data: number[];\n    objects: TiledObjectData[];\n    type: TiledLayerType;\n    height: number;\n    id: number;\n    name: string;\n    opacity: number; // not supported atm\n    visible: boolean;\n    x: number;\n    y: number;\n    width: number;\n    properties?: TiledProperty[];\n}\n\nexport interface TiledObjectData {\n    gid?: number;\n    id: number;\n    name?: string;\n    properties?: TiledProperty[];\n    polygon?: { x: number, y: number}[];\n    type: string;\n    visible: boolean;\n    width: number;\n    height: number;\n    x: number;\n    y: number;\n}\n\nexport enum TiledLayerType {\n    tilelayer = \"tilelayer\",\n    objectgroup = \"objectgroup\"\n}\n\nexport interface TiledProperty {\n    name: string,\n    type: string,\n    value: string | number | boolean;\n}\n\nenum Orientation {\n    orthagonal = \"orthagonal\",\n    isometric = \"isometric\",\n    staggered = \"staggered\",\n    hexagonal = \"hexagonal\"\n}\n\nenum RenderOrder {\n    rightUp = \"right-up\",\n    rightDown = \"right-down\",\n    leftUp = \"left-up\",\n    leftDown = \"left-down\"\n}","import { LootCache } from 'store/types/scene';\n\nexport interface Kill10BoarsQuestVars {\n    dungeon: {\n        entered: boolean,\n        entrance: {\n            chestOpen: boolean,\n            chest: LootCache,\n        }\n        hallway: {\n            doorOpen: boolean,\n            chestOpen: boolean,\n            chest: LootCache,\n        }\n        // situations: {\n        //     altar: {\n        //         candleLit: boolean\n        //     },\n        // }\n    }\n}\n\nexport const initialQuestVars: Kill10BoarsQuestVars = {\n    dungeon: {\n        entered: false,\n        entrance: {\n            chestOpen: false,\n            chest: {\n                title: \"encounter-dungeon-caches-chest\",\n                items: [\n                    \"apparel/nomadHelmet\",\n                    \"questItem/teeth\",\n                    \"material/poisonVial\",\n                    \"apparel/fedora\",\n                ],\n                gold: 100\n            },\n            // altar: {\n            //     title: \"quest-kill10-boars-dungeonentrance-altar\",\n            //     items: [\n            //         Item.bolts,\n            //         Item.letters\n            //     ]\n            // },\n        },\n        hallway: {\n            chest: {\n                title: \"encounter-dungeon-caches-chest\",\n                items: [ \"questItem/key\" ]\n            },\n            chestOpen: false,\n            doorOpen: false\n        }\n    }\n}","export interface TextEntry {\r\n    key: string;\r\n    context?: unknown;\r\n}\r\n\r\nexport function isTextEntry(test: string | TextEntry): test is TextEntry {\r\n    return typeof test !== \"string\";\r\n}","import { Store, AnyAction, DeepPartial } from \"redux\";\nimport { addAllTilesInLayerToList, locationEquals, TiledObjectType, parseProperties } from 'utils/tilemap';\nimport { StoreState } from 'store/types';\nimport { loadResourceAsync } from 'utils/pixiJs';\nimport { TiledLayerType, TiledMapData, TiledObjectData } from 'constants/tiledMapData';\nimport { AStarFinder } from 'astar-typescript';\nimport { AdventurerStoreState } from 'store/types/adventurer';\nimport { setScene, setSceneName, exitEncounter, enqueueSceneAction, updateQuestVars, deductActorAp, endPlayerTurn } from 'store/actions/quests';\nimport { SceneObject, ActorObject, LootCache, SceneActionType, SceneAction, isActorObject, getSpritesheetPaths, isAdventurer, isEnemy } from 'store/types/scene';\nimport { ToastManager } from 'global/ToastManager';\nimport { Type } from 'components/ui/toasts/Toast';\nimport { getQuestLink } from 'utils/routing';\nimport { TextEntry, isTextEntry } from 'constants/text';\nimport { TextManager } from 'global/TextManager';\nimport { addLogText, addLogEntry } from 'store/actions/log';\nimport { getDefinition } from 'definitions/quests';\nimport { LogChannel } from 'store/types/logEntry';\nimport { addGold } from 'store/actions/gold';\nimport { addItemToInventory, removeItemFromInventory } from 'store/actions/adventurers';\nimport { adventurersOnQuest } from 'store/helpers/storeHelpers';\nimport { GameSound, SoundManager } from 'global/SoundManager';\nimport { Allegiance } from \"store/types/combat\";\nimport { Item } from \"definitions/items/types\";\nimport { Loader, Point } from \"pixi.js\";\n\nconst spritesheetBasePath = \"img/scene/actors/\";\nexport const movementDuration = 500; // time every tile movement takes\n\n/**\n * This is a type of God class that knows pretty much everything about a scene\n */\nexport class BaseSceneController<TQuestVars> {\n\n    public questName: string;\n    public mapData?: TiledMapData;\n    public aStar?: AStarFinder;\n    public dataLoading = false;\n    public dataLoadComplete = false;\n    public store: Store<StoreState, AnyAction>;\n\n    protected jsonPath?: string;\n    protected blockedTiles: [number, number][] = [];\n\n    constructor(store: Store<StoreState, AnyAction>, questName: string) {\n        this.store = store;\n        this.questName = questName;\n    }\n\n    get basePath(): string | null {\n        if (!this.jsonPath) return null;\n        return `${process.env.PUBLIC_URL}/${this.jsonPath.substr(0, this.jsonPath.lastIndexOf('/'))}`;\n    }\n\n\n    // Loads tiles from json, loads all scene assets\n    loadData(callback: () => void) {\n        if (this.dataLoadComplete) {\n            return callback();\n        }\n        if (!this.jsonPath) {\n            throw new Error(\"No jsonPath defined!\");\n        }\n        this.dataLoading = true;\n        // load sounds\n        const loadSound = async (sound: GameSound, files: string[]): Promise<PIXI.sound.Sound[]> => {\n            return new Promise((resolve, _reject) => {\n                SoundManager.addSound(sound, files, (sounds) => {\n                    resolve(sounds);\n                })\n            });\n        }\n        const promises = [\n            loadSound(\"scene/bow\", [\"sound/scene/bow-01.mp3\", \"sound/scene/bow-02.mp3\"]),\n            loadSound(\"scene/meleeHit\", [\"sound/scene/melee-hit-01.mp3\", \"sound/scene/melee-hit-02.mp3\", \"sound/scene/melee-hit-03.mp3\"]),\n            loadSound(\"scene/metalBash\", [\"sound/scene/metal-bash-01.mp3\", \"sound/scene/metal-bash-02.mp3\", \"sound/scene/metal-bash-03.mp3\"]),\n            loadSound(\"scene/shieldBash\", [\"sound/scene/shield-bash-impact.mp3\"]),\n            loadSound(\"scene/swish\", [\"sound/scene/swish-01.mp3\", \"sound/scene/swish-02.mp3\", \"sound/scene/swish-03.mp3\", \"sound/scene/swish-04.mp3\"]),\n            loadSound(\"scene/doorOpen\", [\"sound/scene/door.ogg\"]),\n            loadResourceAsync(`${process.env.PUBLIC_URL}/${this.jsonPath}`)\n        ] as const;\n\n        Promise.all(promises).then(async () => {\n            const resource = Loader.shared.resources[`${process.env.PUBLIC_URL}/${this.jsonPath}`];\n            this.mapData = resource.data;\n\n            // Create aStar based on blocked tiles\n            this.createBlockedTiles();\n            this.aStar = this.createAStar();\n\n            // In the case a scene is just created, we dont have this.sceneObjects yet\n            const spritesheets = getSpritesheetPaths(this.sceneObjects.length ? this.sceneObjects : this.createObjects());\n            for(const path of spritesheets) {\n                await loadResourceAsync(path);\n            }\n            // PIXI.utils.clearTextureCache()\n            this.dataLoadComplete = true;\n            this.dataLoading = false;\n            callback();\n        });\n    }\n\n    createBlockedTiles(objects?: SceneObject[]) {\n        this.blockedTiles = [];\n        this.mapData?.layers.filter(layer => layer.visible).forEach(layer => {\n            if (layer.properties && layer.properties.some(p => p.name === 'blocksMovement' && p.value === true)){\n                addAllTilesInLayerToList(this.blockedTiles, layer, layer.width);\n            }\n        });\n        objects?.forEach(o => {\n            if(o.properties.blocksMovement === true && o.location){\n                this.blockedTiles.push(o.location);\n            }\n        });\n    }\n\n    // Constructs the scene and dispatches it to be saved to the store\n    createScene() {\n        const objects = this.createObjects();\n        const combat = false;\n        this.updateScene(objects, combat)\n    }\n\n    updateScene(objects: SceneObject[] = this.sceneObjects, combat: boolean = this.combat) {\n        const scene = {\n            ...this.quest.scene,\n            objects,\n            combat,\n        }\n        this.dispatch(setScene(this.questName, scene));\n\n        this.createBlockedTiles(objects);\n\n        // Create aStar based on blocked tiles\n        if (this.mapData) {\n            this.aStar = this.createAStar();\n        }\n    }\n\n\n    sceneEntered() {\n        return;\n    }\n\n    // Convenience function returns an object with tileWidth and tileHeight properties\n    getTileDimensions() {\n        return {\n            tileWidth: this.mapData?.tilewidth || 0,\n            tileHeight: this.mapData?.tileheight || 0\n        }\n    }\n\n    actorMoved(_actor: string, location: [number, number]) {\n        // const object = this.tilemapObjects![`${location[0]},${location[1]}`];\n        const destination = this.getObjectAtLocation(location);\n        if (!destination) return;\n\n        if (destination.type === TiledObjectType.exit) {\n            // We've hit the exit. Should we load another scene?\n            if (destination.properties.loadScene) {\n                this.dispatch(setSceneName(this.questName, destination.properties.loadScene as string))\n            } else {\n                // Or exit the encounter\n                const index = Math.floor(this.quest.progress) + 1;\n                const definition = getDefinition(this.questName);\n                const node = definition.nodes[index];\n                if (node.log) {\n                    // If the next node has a log entry, add it\n                    this.dispatch(addLogText(node.log, null, LogChannel.quest, this.questName));\n                }\n                this.dispatch(exitEncounter(this.questName));\n            }\n        }\n    }\n\n    actorInteract(actorId: string, location: [number, number]) {\n        const actor = this.getSceneActor(actorId);\n        const object = this.getObjectAtLocation(location);\n\n        if (!object) {\n            console.warn(\"No object found\");\n            return;\n        }\n        if (actor) {\n            this.interactWithObject(actor, object);\n        }\n    }\n\n    actorAttemptAction(actorId: string, type: SceneActionType, destination: [number, number]) {\n        // Tries to perform action on given actor\n\n        const actor = this.getSceneActor(actorId);\n        if (!actor) return\n        const {location} = actor;\n        if (!location) throw new Error(\"No location found!\")\n\n        switch (type) {\n            case SceneActionType.move: {\n                // Find path to move using aStar\n                const path = this.findPath(location, destination);\n\n                if (this.combat) {\n                    const remaining = actor.ap || -1;\n                    if (remaining < (path?.length || 0)) {\n                        return;\n                    }\n                    this.dispatch(deductActorAp(this.questName, actorId, path?.length || 0));\n                }\n                path?.forEach((l, index) => {\n                    const sceneAction: SceneAction = {\n                        actionType: SceneActionType.move,\n                        actorId,\n                        target: l as [number, number],\n                        endsAt: movementDuration * (index + 1) + performance.now()\n                    };\n                    this.dispatch(enqueueSceneAction(this.questName, sceneAction));\n                });\n                break;\n            }\n            case SceneActionType.interact: {\n                const path = this.findPathNearest(location, destination);\n                path?.forEach((l, index) => {\n                    const moveAction: SceneAction = {\n                        actionType: SceneActionType.move,\n                        actorId,\n                        target: l as [number, number],\n                        endsAt: movementDuration * (index + 1) + performance.now()\n                    };\n                    this.dispatch(enqueueSceneAction(this.questName, moveAction));\n                });\n\n                const interactAction: SceneAction = {\n                    actionType: SceneActionType.interact,\n                    actorId,\n                    target: destination,\n                    endsAt: movementDuration * path.length + performance.now()\n                };\n                this.dispatch(enqueueSceneAction(this.questName, interactAction));\n                break;\n            }\n            case SceneActionType.slash: {\n                // Find path to move towards the target\n                const path = this.findPath(location, destination);\n                const target = path?.pop();\n                if (!path || !target) {\n                    // No path possible.. cant do anything now\n                    return;\n                }\n\n                // Walk towards the target\n                path?.forEach((l, index) => {\n                    const moveAction: SceneAction = {\n                        actionType: SceneActionType.move,\n                        actorId,\n                        target: l as [number, number],\n                        endsAt: movementDuration * (index + 1) + performance.now()\n                    };\n                    this.dispatch(enqueueSceneAction(this.questName, moveAction));\n                });\n                const meleeAction: SceneAction = {\n                    actionType: type,\n                    actorId,\n                    target,\n                    endsAt: movementDuration * (path.length + 1) + performance.now()\n                };\n                this.dispatch(enqueueSceneAction(this.questName, meleeAction));\n                this.dispatch(deductActorAp(this.questName, actorId, path?.length || 0));\n            }\n        }\n    }\n\n    interactWithObject(_actor: ActorObject, _object: SceneObject) {\n        // override\n    }\n\n    // Converts pixel coordinate to scene location\n    pointToSceneLocation (point: Point): [number, number] {\n        if (!this.mapData?.tilewidth || !this.mapData?.tileheight) {\n            return [0, 0];\n        }\n        return [Math.floor(point.x / this.mapData.tilewidth), Math.floor(point.y / this.mapData.tilewidth)];\n    }\n\n    // Returns true if the tile is blocked\n    locationIsBlocked(location: [number, number]){\n        return this.blockedTiles.some((l) => locationEquals(l, location));\n    }\n\n    // Returns true if outsie of the bounds of the map\n    locationIsOutOfBounds(location: [number, number]) {\n        if (!this.mapData) return true;\n\n        return location[0] < 0 || location[1] < 0 ||\n            location[0] >= this.mapData.width ||\n            location[1] >= this.mapData.height;\n    }\n\n    // Should be overridden\n    getLootCache(_name: string): LootCache | undefined {\n        // Override this to retrieve LootCache from questvars\n        return;\n    }\n\n    takeGoldFromCache(name: string) {\n        // Override this to remove gold from questvars\n        const lootCache = this.getLootCache(name);\n        if (lootCache){\n            this.dispatch(addGold(lootCache.gold || 0));\n        }\n    }\n\n    takeItemFromCache(itemIndex: number, name: string, adventurerId: string, toSlot?: number) {\n        // Override this to remove items from questvars\n        const lootCache = this.getLootCache(name);\n        if (!lootCache) return;\n\n        const item = lootCache.items[itemIndex];\n        this.dispatch(addItemToInventory(adventurerId, item, toSlot))\n    }\n\n    discardItem(item: Item, adventurerId: string) {\n        const adventurer = this.getAdventurerById(adventurerId);\n        const itemIndex = adventurer?.inventory.indexOf(item);\n        if (itemIndex !== undefined) {\n            this.dispatch(removeItemFromInventory(adventurerId, itemIndex));\n        }\n    }\n\n    getSituation(_situation: string, _adventurerId?: string) : Situation | undefined {\n         return undefined;\n    }\n\n    // eslint-disable-next-line @typescript-eslint/no-empty-function\n    handleSituationOptionClick(_situation: string, _option: string, _adventurerId: string) {\n    }\n\n    /**\n     * Returns a path from two locations on the map\n     * @param origin\n     * @param target\n     */\n    findPath(origin: [number, number], target: [number, number]) {\n        return this\n            .aStar?.findPath(convertIn(origin), convertIn(target))\n            .map(convertOut);\n    }\n\n    /**\n     * Finds a path from origin to a tile next to target (closest from origin)\n     * It doesn't matter if target is unpathable\n     * @param origin\n     * @param target\n     */\n    public findPathNearest(origin: [number, number], target: [number, number], includeLast = false) {\n        // todo; shortcut, if already neighbour, return early\n        const grid = this.aStar?.getGrid().getGridNodes();\n        if (!grid) return [];\n        const matrix = grid.map(r => r.map(c => (c.getIsWalkable() ? 0 : 1)));\n        matrix[target[1]][target[0]] = 0; // make target pathable\n        const tempAStar = new AStarFinder({\n            grid: {\n                matrix\n            },\n            includeStartNode: false,\n            heuristic: \"Manhattan\",\n            weight: 0.2,\n        });\n        return tempAStar.findPath(convertIn(origin), convertIn(target))\n            .map(convertOut)\n            .slice(0, includeLast ? undefined : -1);\n    }\n\n    /**\n     * Calculates the AP costs to walk\n     */\n    calculateWalkApCosts(from: [number, number], to: [number, number]) {\n        return this.findPath(from, to)?.length || 0;\n    }\n\n    /**\n     * Forfeits all player ap\n     */\n    public endTurn() {\n        this.dispatch(endPlayerTurn(this.questName));\n    }\n\n    public getSceneActor(actorId: string): ActorObject | undefined {\n        const actor = this.sceneActors.find(sA => sA.name === actorId);\n        // if (!actor) throw new Error (`No actor found with id ${actorId}`);\n        return actor;\n    }\n\n    public getObjectAtLocation(location: [number, number]) {\n        return this.quest.scene?.objects?.find(o => o.location && locationEquals(o.location, location))\n    }\n\n    protected createAStar() {\n        const matrix: number[][] = [];\n        if (this.mapData){\n            for (let y = 0; y < this.mapData.height; y++) {\n                const row: number[] = [];\n                for (let x = 0; x < this.mapData.width; x++) {\n                    const location: [number, number] = [x, y];\n                    const blocked = this.locationIsBlocked(location);\n                    row.push(blocked ? 1 : 0);\n                }\n                matrix.push(row);\n            }\n        }\n        return new AStarFinder({\n            grid: {\n                matrix\n            },\n            includeStartNode: false,\n            heuristic: \"Manhattan\",\n            weight: 0.2,\n        });\n    }\n\n    // Create SceneObject from this.mapData\n    protected createObjects(): SceneObject[] {\n        if (!this.mapData) {\n            throw new Error(\"No mapData\");\n        }\n        const objectLayers = this.mapData.layers.filter(layer => layer.type === TiledLayerType.objectgroup);\n        const objects: SceneObject[] = [];\n        const adventurers = this.getAdventurers();\n        objectLayers.forEach(objectLayer => {\n            objectLayer.objects.reduce((acc:  SceneObject[], value: TiledObjectData) => {\n\n                // reduce the props array into an object with key/values\n                const properties = parseProperties(value.properties);\n                const location: [number, number] = [\n                    value.x / (this.mapData?.tilewidth || 1),\n                    (value.y - (value.gid ? value.height : 0)) / (this.mapData?.tileheight || 1)\n                ];\n\n                let object: SceneObject | null = {\n                    ...value,\n                    layerId: objectLayer.id,\n                    properties,\n                    location\n                };\n\n                if (object.type === TiledObjectType.adventurerStart) {\n                    const adventurer = adventurers.pop();\n                    if (adventurer) {\n                        object.type = TiledObjectType.actor;\n                        if (isActorObject(object)) { // typeguard, is always true but we need to tell typescript it's an actor\n                            object.name = adventurer.id;\n                            object.ap = adventurer.id === 'c4a5d270' ? 2 : 0\n                            object.health = adventurer.health;\n                            object.allegiance = Allegiance.player;\n                            object.properties.adventurerId = adventurer.id;\n                            object.properties.isSprite = true;\n                            object.properties.spritesheet = adventurer.spritesheetPath;\n                        }\n                    } else {\n                        // Unused player spawn location, dont add\n                        object = null;\n                    }\n                } else if (object.type === TiledObjectType.enemySpawn) {\n                    object.type = TiledObjectType.actor;\n                    if (isActorObject(object)) { // typeguard, is always true but we need to tell typescript it's an actor\n                        object.health = Math.random() * 100;\n                        object.ap = 6;\n                        object.name = object.properties.name as string;\n                        object.allegiance = Allegiance.enemy;\n                        object.properties.isSprite = true;\n                        object.properties.spritesheet = `${spritesheetBasePath}troll-sword.json`;\n                    }\n                }\n\n                if (object) {\n                    acc.push(object);\n                }\n                return acc;\n            }, objects);\n        });\n        return objects;\n    }\n\n    // Scene\n    protected get combat() {\n        return !!this.quest.scene?.combat;\n    }\n\n    public get sceneObjects(): SceneObject[]  {\n        return this.quest.scene?.objects || [];\n    }\n\n    public get sceneActors(): ActorObject[] {\n        return this.sceneObjects.filter<ActorObject>(isActorObject);\n    }\n\n    public get sceneAdventurers(): ActorObject[] {\n        return this.sceneObjects.filter<ActorObject>(isAdventurer);\n    }\n\n    public get sceneEnemies(): ActorObject[] {\n        return this.sceneObjects.filter<ActorObject>(isEnemy);\n    }\n\n    // Quest\n    public get quest() {\n        const storeState = this.store.getState();\n        const quest = storeState.quests.find(q => q.name === this.questName);\n        if (!quest) throw new Error(\"No quest :(\")\n        return quest;\n    }\n\n    protected get questVars(): TQuestVars {\n        return this.quest.questVars as unknown as TQuestVars;\n    }\n\n    // Provide questvars to update\n    protected updateQuestVars(updated: DeepPartial<TQuestVars>) {\n        this.dispatch(updateQuestVars(this.questName, updated));\n    }\n\n    protected getAdventurers(): AdventurerStoreState[] {\n        const storeState = this.store.getState();\n        return adventurersOnQuest(storeState.adventurers, this.quest);\n    }\n\n    protected getAdventurerByActor(actor: ActorObject) {\n        const storeState = this.store.getState();\n        return storeState.adventurers.find(a => a.id === actor.name);\n    }\n\n    protected getAdventurerById(id: string) {\n        const storeState = this.store.getState();\n        return storeState.adventurers.find(a => a.id === id);\n    }\n\n    protected questUpdate(input: string | TextEntry, icon?: string, toast = false) : void {\n        const textEntry: TextEntry = isTextEntry(input) ? input : {key: input};\n        const title = TextManager.getTextEntry(textEntry);\n        if (toast) {\n            ToastManager.addToast(title, Type.questUpdate, icon, getQuestLink(this.questName));\n        }\n        this.dispatch(addLogEntry(textEntry, LogChannel.quest, this.questName));\n    }\n\n    // Store\n    protected dispatch(action: AnyAction) {\n        this.store.dispatch(action)\n    }\n}\n\nexport interface Situation {\n    title: string;\n    choices?: string[];\n    text?: string;\n}\n\n// This is the format AStarFind works with\nconst convertIn = (l: [number, number]) => ({ x: l[0], y: l[1] });\nconst convertOut = (input: number[]): [number, number] => [input[0], input[1]];\n","import { TiledObjectData } from 'constants/tiledMapData';\nimport { Item } from 'definitions/items/types';\nimport { Merge } from 'type-fest';\nimport { TiledObjectType } from 'utils/tilemap';\nimport { Allegiance } from './combat';\n\n\nexport interface SceneStoreState {\n    objects: SceneObject[];\n    actionQueue?: SceneAction[];\n    activeInteractionModal?: SceneInteractionModal;\n    combat: boolean;\n    turn?: Allegiance;\n}\n\nexport type SceneObject = Merge<TiledObjectData, {\n    layerId: number;\n    properties: { [key: string]: string | boolean | number };\n    location?: [number, number];\n}>;\n\nexport type ActorObject = SceneObject & {\n    name: string;\n    ap: number;                     // Remaining AP\n    health: number;\n    allegiance: Allegiance;\n};\n\n// Type guard\nexport const isActorObject = (object: SceneObject): object is ActorObject => {\n    return object.type === TiledObjectType.actor;\n}\n\nexport const isAdventurer = (object: SceneObject): object is ActorObject => {\n    return isActorObject(object) && object.allegiance === Allegiance.player;\n}\n\nexport const isEnemy = (object: SceneObject): object is ActorObject => {\n    return isActorObject(object) && object.allegiance === Allegiance.enemy;\n}\n\n // export type Actor = SceneObject & {\n//     type: \"actor\";\n//     //allegiance: Allegiance;\n//     health: number;\n//     //remainingAP: number;\n// }\n\nexport type SceneInteractionModal =\n| { type: 'lootCache', lootCache: string }\n| { type: 'situation', situation: string }\n\nexport interface LootCache {\n    title: string;\n    items: Item[];\n    gold?: number;\n    open?: boolean;\n}\n\nexport interface SceneAction {\n    actionType: SceneActionType;\n    actorId: string;\n    target: [number, number];\n    endsAt: number;\n}\n\nexport enum SceneActionType {\n    move = \"move\",\n    interact = \"interact\",\n    attack = \"attack\",\n    slash = \"slash\"\n}\n\nexport const getSpritesheetPaths = (objects: SceneObject[]) => {\n    return Array.from(\n        new Set<string>(\n            objects.filter(o => o.properties.isSprite)\n                .map(o => o.properties.spritesheet as string)\n        )\n    );\n}","import { QuestStoreState } from 'store/types/quest';\nimport { Item } from 'definitions/items/types';\n\nexport enum QuestNodeType {\n    nothing = 0,    // Nothing much going on here\n    encounter = 1,\n    // combat = 2,     // Not implemented\n    // boss = 3,\n}\n\n// eslint-disable-next-line @typescript-eslint/ban-types\nexport interface QuestDefinition<TQuestVars = unknown> {\n    nodes: QuestNode[];\n    requiredItems?: Item[];\n    getQuestVars: (questStoreState: QuestStoreState) => TQuestVars;\n    getInitialQuestVars: (questStoreState: QuestStoreState) => TQuestVars;\n}\n\ntype AllNodeTypes = {\n    x: number;\n    y: number;\n    log?: string;   \n}\n\nexport type QuestNode  =\n    | AllNodeTypes & { type: QuestNodeType.nothing}\n    | AllNodeTypes & { type: QuestNodeType.encounter, startScene: string}\n","import * as React from \"react\";\nimport { PropsWithChildren } from 'react';\nimport \"./styles/icon.scss\";\n\nexport interface Props {\n    image: string;\n    size?: IconSizeType;\n    className?: string;\n    border?: Border | keyof typeof Border;\n}\n\nexport enum IconSize {\n    smallest = \"smallest\",\n    small = \"small\",\n    medium = \"medium\",\n    big = \"big\",\n    biggest = \"biggest\"\n}\n\nexport type IconSizeType = IconSize | keyof typeof IconSize;\n\nexport enum Border {\n    none = \"none\",\n    gold = \"gold\"\n}\n\nconst Icon = (props: PropsWithChildren<Props> & React.ComponentProps<\"div\">) => {\n    const {\n        image,\n        size,\n        children,\n        className = \"\",\n        border = \"none\",\n        ...restProps\n    } = props;\n    return (\n        <div\n            className={`icon ${sizeClassName((typeof size === \"string\") ? IconSize[size] : size)} ${className}`}\n            {...restProps}\n            style={{\n                backgroundImage: `url(${process.env.PUBLIC_URL}${image})`,\n            }}\n        >\n            {children}\n            { border !== \"none\" && border && (\n                <div className={`border ${borderClassName((typeof border === \"string\") ? Border[border] : border)} `}/>\n            )}\n        </div>\n    );\n};\n\nexport default Icon;\n\n\nconst sizeClassName = (size?: IconSize): string => {\n    switch (size) {\n        case IconSize.smallest:\n            return \"size-smallest\";\n        case IconSize.small:\n            return \"size-small\";\n        case IconSize.medium:\n            return \"size-medium\";\n        case IconSize.big:\n            return \"size-big\";\n        case IconSize.biggest:\n            return \"size-biggest\";\n    }\n    return sizeClassName(IconSize.medium);\n};\n\nconst borderClassName = (border?: Border): string => {\n    switch (border) {\n        case Border.gold:\n            return \"border-gold\";\n        case Border.none:\n        default:\n            return \"\";\n    }\n}","import localforage from 'localforage';\nimport sound from 'pixi-sound';\nimport {gsap } from 'gsap';\nimport { Loader } from 'pixi.js';\n\nexport enum Channel {\n    music,\n    ui,\n    scene\n}\n\nexport enum MixMode {\n    singleInstance,     // Only one sound plays at the same time in this channel\n    layered,            // Multiple sounds can play in this channel\n    fade                // Fades out currently playing sound on this channel and fades new music in\n}\n\nexport enum Music {\n    town,\n    world,\n}\n\nexport type GameSound =\n    \"ui/buttonClick\" |\n    \"ui/equip\" |\n    \"ui/error\" |\n    \"ui/levelUp\" |\n    \"ui/toast\" |\n    \"music/town\" |\n    \"music/world\" |\n    \"scene/bow\" |\n    \"scene/doorOpen\" |\n    \"scene/meleeHit\" |\n    \"scene/metalBash\" |\n    \"scene/shieldBash\" |\n    \"scene/swish\"\n;\n\ntype SoundInfo = {\n    instance: sound.IMediaInstance;\n    gameSound: GameSound;\n    pixiSound: sound.Sound;\n    storePosition?: boolean;\n}\n\nconst DEFAULT_MUSIC_VOLUME = 0;\nconst DEFAULT_UI_VOLUME = 1;\nconst DEFAULT_SCENE_VOLUME = 1;\nconst STORAGE_KEY_VOLUME = \"channelVolume\";\n\nexport class SoundManager {\n    private static _sounds: { [key: string]: sound.Sound[] } = {};\n    private static _currentSound: { [key: number]: SoundInfo } = {};    // per channel\n    private static _storedPositions: { [key: string]: number } = {};\n    \n    private static _channelVolume: {[key: number]: number} = {};\n    private static _initialized = false;\n    private static _filter = new sound.filters.TelephoneFilter() \n\n    public static async init() {\n        // Attempt to fetch volumes from storage. If not set, revert to defaults\n        this._channelVolume = {\n            [(Channel.music)]: await localforage.getItem(`${STORAGE_KEY_VOLUME}-${Channel.music}`) ?? DEFAULT_MUSIC_VOLUME,\n            [(Channel.ui)]: await localforage.getItem(`${STORAGE_KEY_VOLUME}-${Channel.ui}`) ?? DEFAULT_UI_VOLUME,\n            [(Channel.scene)]: await localforage.getItem(`${STORAGE_KEY_VOLUME}-${Channel.scene}`) ?? DEFAULT_SCENE_VOLUME,\n        }\n        this._initialized = true;\n    }\n\n\n    public static async addSound(gameSound: GameSound, files: string[] | string, complete?: (sounds: sound.Sound[]) => void) {\n        if (typeof files === \"string\") {\n            files = [files];\n        }\n        if(this._sounds[gameSound]) {\n            // Sound already loaded. Great.\n            complete?.(this._sounds[gameSound]);\n            return;\n        }\n\n        const loader = new Loader();\n        files.map((file) => loader.add(file));\n        loader.load((_, resources: PIXI.LoaderResource) => {\n            if (resources) {\n                this._sounds[gameSound] = Object.values(resources).filter(Boolean).map(r => r.sound);\n                complete?.(this._sounds[gameSound]);\n            }\n        });\n    }\n\n    /**\n     * Plays a sound. The sound needs to be loaded through `addSound` first!\n     * @param gameSound the GameSound to play\n     * @param channel channel to play the sound on\n     * @param loop true to make the sound repeat\n     * @param mixMode how to mix in the new sound into the channel\n     * @param storePosition Store position of current sound on this channel in order to resume\n     */\n    public static async playSound(gameSound: GameSound, channel: Channel = Channel.ui, loop = false, mixMode: MixMode = MixMode.singleInstance, storePosition = false) {\n        if (!this._initialized) {\n            await this.init();\n        }\n\n       // \n\n        const pixiSound = this.getSound(gameSound);\n        pixiSound.volume = this._channelVolume[channel];\n        pixiSound.loop = loop;\n\n        if (this._currentSound[channel]?.storePosition) {\n            // Did we have to store the position of the current sound?\n            const oldSoundInfo = this._currentSound[channel];\n            // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n            // @ts-ignore https://github.com/pixijs/pixi-sound/issues/111\n            oldSoundInfo.instance.once('progress', (progress: number , duration: number) => {\n                this._storedPositions[oldSoundInfo.gameSound] = progress * duration;\n            });\n        }\n        const start = this._storedPositions[gameSound] ?? 0;\n        const instance = await pixiSound.play({ start });\n\n        if (this._currentSound[channel]) {\n            if (mixMode === MixMode.fade) {\n                // Fade out current sound on this channel and fade in new sound\n                const oldSoundInfo = this._currentSound[channel];\n                gsap.to(oldSoundInfo.instance, { volume: 0, duration: .75, onComplete: () => {\n                    oldSoundInfo.instance.destroy();\n                }});\n                // Fade in the new sound\n                gsap.from(instance, { volume: 0, duration: 0.75 });\n            }\n            else if (mixMode === MixMode.singleInstance) {\n                this._currentSound[channel].instance.stop();\n            }\n        }\n        this._currentSound[channel] = { instance, gameSound, pixiSound, storePosition };\n        instance.on('end', () => {\n            this._currentSound[channel].instance.destroy();\n            delete this._currentSound[channel];\n        });\n    }\n\n    protected static getSound(sound: GameSound): sound.Sound {\n        if (!this._sounds[sound]?.length) {\n            throw new Error(`No sound found for ${sound}`);\n        }\n        if (this._sounds[sound].length === 1) {\n            return this._sounds[sound][0];\n        }\n        else {\n            return this._sounds[sound][Math.floor(Math.random() * this._sounds[sound].length)];\n        }\n    }\n\n    public static set musicFiltered(value: boolean) {\n        if(this._currentSound[Channel.music]) {\n            this._currentSound[Channel.music].pixiSound.filters = value ? [ this._filter ] : []\n        }\n    }\n\n    static getChannelVolume(channel: Channel): number {\n        return this._channelVolume[channel];\n    }\n\n    static setChannelVolume(channel: Channel, volume:number) {\n        this._channelVolume[channel] = volume;\n        if(this._currentSound[channel]?.instance) {\n            this._currentSound[channel].instance.volume = volume;\n        }\n        localforage.setItem(`${STORAGE_KEY_VOLUME}-${channel}`, volume);\n    }\n}\n","import { DragSourceType } from \"./dragging\";\n\nexport enum Rarity {\n    // gray = common, green = uncommon, blue = rare, purple = epic, orange = legendary\n    common,\n    uncommon,\n    rare,\n    epic,\n    legendary\n}\n\n// Information about where an item is found\nexport interface ItemSource {\n    origin: DragSourceType;\n    id?: string;    // eg: adventurerId\n    slot?: number;  // slot in the inventory\n}","import { Rarity } from 'constants/items';\nimport { Apparel } from './apparel';\nimport { Deed } from './deeds';\nimport { Herb } from './herbs';\nimport { Material } from './materials';\nimport { Mineral } from './minerals';\nimport { Potion } from './potions';\nimport { QuestItem } from './questItems';\nimport { Trinket } from './trinkets';\nimport { Weapon } from './weapons';\n\nexport enum ItemType {\n    apparel,\n    deed,\n    herb,\n    material,\n    mineral,\n    potion,\n    questItem,\n    trinket,\n    weapon,\n}\n\nexport type Item = Apparel | Deed | Herb | Material | Mineral | Potion | QuestItem | Trinket | Weapon;\n\nexport interface ItemDefinition {\n    itemType: ItemType;\n    iconImg: string;\n    rarity?: Rarity;\n//    articleUndefined?: string;  // Key to text\n    unique?: boolean;           // Indicate that this item is unique.\n                                // Not actually enforced by anything,\n                                // but used to generate the article ('a' or 'the')\n}\n","import { paramCase as toKebab} from \"text-param-case\";\nimport { TextEntry } from \"constants/text\";\nimport { getDefinition } from \"definitions/items\";\nimport { Item, ItemType } from \"definitions/items/types\";\nimport { Resource } from \"definitions/resources\";\nimport { Structure } from \"definitions/structures\";\nimport * as Handlebars from \"handlebars\";\nimport { Trait } from 'definitions/traits/types';\nimport { Type } from 'components/ui/toasts/Toast';\nimport { EquipmentSlotType } from 'components/ui/adventurer/EquipmentSlot';\nimport { WeaponType, WeaponClassification } from 'definitions/items/weapons';\nimport { getStructureLink } from \"utils/routing\";\n\nexport abstract class TextManager {\n\n    public static init(texts: {[key: string]: string}, precompile = true) {\n        this.texts = texts;\n        this.templates = {};\n        this.notFound = [];\n\n        if (precompile) {\n            this.compileAll();\n        }\n        this.initialized = true;\n    }\n\n    public static get(key: string, context?: unknown): string {\n        const result = this.getDefault(key, context);\n        if (result === null) {\n            if (process.env.NODE_ENV === 'development') {\n                this.notFound.push(key)\n            }\n    \n            console.error(`Key '${key}' not found in TextManager`);\n            return `<<'${key}' missing>>`;\n        } else {\n            return result;\n        }\n    }\n\n    // Will return `null` when no text found, otherwise will return the text\n    public static getDefault(key: string, context?: unknown): string|null {\n        if (!this.initialized) {\n            throw new Error(`Error ${this} not initialized!`);\n        }\n        const template = this.getTemplate(key);\n        if (!template) {\n            return null;\n        }\n        return template(context);\n    }\n\n    public static getTextEntry(textEntry: TextEntry): string {\n        return this.get(textEntry.key, textEntry.context);\n    }\n\n    public static getTemplate(key: string) {\n        let template = this.templates[key];\n        if (!template && this.texts[key]) {\n            // Template not found but key is defined. Needs to be compiled\n            this.compile(key, this.texts[key]);\n            template = this.templates[key];\n        }\n        return template;\n    }\n\n    public static getEquipmentSlot(slotType: EquipmentSlotType) {\n        return this.get(`ui-equipmentslot-${toKebab(EquipmentSlotType[slotType])}`);\n    }\n\n    public static getQuestTitle(name: string) {\n        return this.get(`quest-${toKebab(name)}-title`);\n    }\n\n    public static getQuestDescription(name: string) {\n        return this.get(`quest-${toKebab(name)}-description`);\n    }\n\n    public static getResourceName(type: Resource) {\n        return this.get(`resource-${type}-name`);\n    }\n\n    public static getItemName(item: Item): string {\n        return this.get(`item-${toKebab(item)}-name`);\n    }\n    \n    public static getItemType(itemType: ItemType): string {\n        return this.get(`item-type-${toKebab(ItemType[itemType])}`);\n    }\n\n    public static getItemSubtext(item: Item): string|null {\n        return this.getDefault(`item-${toKebab(item)}-subtext`);\n    }\n\n    public static getStructureName(structure: Structure): string {\n        return this.get(`structure-${toKebab(structure)}-name`);\n    }\n\n    public static getTraitName(trait: Trait): string {\n        return this.get(`trait-${toKebab(trait)}-name`);\n    }\n\n    public static getTraitDescription(trait: Trait): string {\n        return this.get(`trait-${toKebab(trait)}-description`);\n    }\n\n    public static getTraitEffect(trait: Trait): string {\n        return this.get(`trait-${toKebab(trait)}-effect`);\n    }\n\n    public static getToastType(type: Type): string {\n        return this.get(`ui-toast-type-${toKebab(Type[type])}`);\n    }\n\n    public static getWeaponType(type: WeaponType) {\n        return this.get(`ui-weapon-type-${toKebab(WeaponType[type])}`);\n    }\n\n    public static getSkillName(type: WeaponType) {\n        return this.get(`skill-${toKebab(WeaponType[type])}-name`);\n    }\n\n    public static getSkillInfo(type: WeaponType) {\n        return this.get(`skill-${toKebab(WeaponType[type])}-info`);\n    }\n\n    public static getWeaponClassification(weaponClass: WeaponClassification) {\n        return this.get(`ui-weapon-class-${toKebab(WeaponClassification[weaponClass])}`);\n    }\n\n    public static printNotFounds() {\n        if (this.notFound.length) {\n            console.log(\"TextManager strings not found:\")\n            console.log(\"\\\"\" + this.notFound.join('\": \"\",\\n\"') + '\": \"\"')\n        }\n    }\n\n    private static initialized = false;\n    private static texts: Record<string, string>;\n    private static templates: Record<string, Handlebars.TemplateDelegate<unknown>>;\n    private static notFound: string[];\n\n    private static compileAll() {\n        Object.keys(this.texts).forEach((key: string) =>  {\n            this.compile(key, this.texts[key]);\n        });\n    }\n\n    private static compile(key: string, value: string) {\n        const template = Handlebars.compile(value);\n        this.templates[key] = template;\n    }\n}\n\nHandlebars.registerHelper(\"item:name\", (item: Item, article?: string) => {\n    if (!getDefinition(item)) {\n        return new Handlebars.SafeString(`<<ITEM DEFINITION NOT FOUND: ${item}>>`);\n    }\n    switch (article) {\n        case \"aA\":  // article Auto\n            return itemArticleAuto(item);\n        case \"aD\":  // article Defined \"a sword\"\n            return itemArticleDefined(item);\n        case \"aU\":  // article Defined \"the sword\"\n            return itemArticleDefined(item);\n        default:\n            // No article\n            // const name = itemDefinitions[item].name;\n            return new Handlebars.SafeString(item);\n    }\n});\n\nHandlebars.registerHelper(\"structure:name\", (structure: Structure) => {\n    const name = TextManager.get(`structure-${toKebab(structure)}-name`);\n    return new Handlebars.SafeString(name);\n});\n\nHandlebars.registerHelper(\"structure:link\", (structure: Structure) => {\n    const name = TextManager.get(`structure-${toKebab(structure)}-name`);\n    const link = getStructureLink(structure)\n    return new Handlebars.SafeString( `[${name}](#${link})`);\n});\n\nHandlebars.registerHelper(\"resource:name\", (resource: string) => {\n    const name = TextManager.get(`resource-${resource}-name`);\n    return new Handlebars.SafeString(name);\n});\n\nconst itemArticleAuto = (item: Item) => {\n    return itemArticleUndefined(item);\n};\n\nconst itemArticleUndefined = (item: Item) => {\n    const name = TextManager.getItemName(item);\n    const articleTemplate = TextManager.getTemplate(\"common-article-undefined\");\n    return new Handlebars.SafeString(`${articleTemplate({ noun: name})}`);\n};\n\nconst itemArticleDefined = (item: Item) => {\n    const name = TextManager.getItemName(item);\n    const articleTemplate = TextManager.getTemplate(\"common-article-defined\");\n    return new Handlebars.SafeString(`${articleTemplate({ noun: name})}`);\n};\n","// Utilities for routing\n\nimport { Structure } from 'definitions/structures';\n\nexport const getWorldLink = () => `/world`;\nexport const getQuestLink = (questName: string) => `${getWorldLink()}/${questName}`;\n\nexport const getTownLink = () => `/town`;\nexport const getStructureLink = (structure: Structure, onlyHighlight = false) => `${getTownLink()}/${structure}${onlyHighlight ? '' : '/view'}`;\n","import { Item, ItemDefinition, ItemType } from \"./types\";\nimport { Rarity } from 'constants/items';\n\ntype Prefix = \"weapon/\";\nconst PREFIX = \"weapon/\";\nconst itemType = ItemType.weapon;\nconst basePath = \"/img/items/weapons/\";\n\nexport enum WeaponType {\n    axe = \"axe\",\n    bow = \"bow\",\n    club = \"club\",\n    crossbow = \"crossbow\",\n    fist = \"fist\",\n    flail = \"flail\",\n    hammer = \"hammer\",\n    knife = \"knife\",\n    staff = \"staff\",\n    shield = \"shield\",\n    sword = \"sword\",\n    poleArm = \"poleArm\",\n}\n\nexport enum WeaponAbility {\n    aimedShot,\n    swing,\n    block,\n    cut,\n    cleave,\n    shoot,\n    slash,\n    parry,\n}\n\nexport enum WeaponClassification {\n    oneHanded,  // Can be used in main hand or off hand\n    mainHand,   // Can only be used in main hand\n    offHand,    // Can only be used in the off hand\n    twoHanded,  // Can be used in the main hand and will disable off hand from being used\n    shield      // ?\n    // add 'ranged'?\n}\n\nexport const WeaponTypeDefinition = {\n    [WeaponType.axe]: {\n        classification: WeaponClassification.oneHanded,\n        abilities: [WeaponAbility.cut],\n    },\n    [WeaponType.bow]: {\n        classification: WeaponClassification.oneHanded,\n        abilities: [WeaponAbility.shoot]\n    },\n    [WeaponType.club]: {\n        classification: WeaponClassification.oneHanded,\n        abilities: [WeaponAbility.swing, WeaponAbility.parry]\n    },\n    [WeaponType.crossbow]: {\n        classification: WeaponClassification.mainHand,\n        abilities: [WeaponAbility.aimedShot, WeaponAbility.shoot]\n    },\n    [WeaponType.fist]: {\n        classification: WeaponClassification.oneHanded,\n        abilities: [WeaponAbility.swing]\n    },\n    [WeaponType.flail]: {\n        classification: WeaponClassification.mainHand,\n        abilities: [WeaponAbility.swing, WeaponAbility.parry]\n    },\n    [WeaponType.hammer]: {\n        classification: WeaponClassification.oneHanded,\n        abilities: [WeaponAbility.swing, WeaponAbility.parry]\n    },\n    [WeaponType.knife]: {\n        classification: WeaponClassification.oneHanded,\n        abilities: [WeaponAbility.cut, WeaponAbility.parry]\n    },\n    [WeaponType.staff]: {\n        classification: WeaponClassification.twoHanded,\n        abilities: [WeaponAbility.swing, WeaponAbility.parry]\n    },\n    [WeaponType.sword]: {\n        classification: WeaponClassification.oneHanded,\n        abilities: [WeaponAbility.swing, WeaponAbility.parry]\n    },\n    [WeaponType.poleArm]: {\n        classification: WeaponClassification.twoHanded,\n        abilities: [WeaponAbility.swing, WeaponAbility.parry]\n    },\n    [WeaponType.shield]: {\n        classification: WeaponClassification.shield,\n        abilities: [WeaponAbility.block]\n    }\n}\n\nexport enum DamageType {\n    kinetic = \"kinetic\",\n}\n\nexport interface DamageDefinition {\n    [DamageType.kinetic]: number | undefined;\n}\n\n\nexport interface WeaponDefinition extends ItemDefinition {\n    weaponType: WeaponType;\n    damage?: DamageDefinition;\n}\n\nconst weapons = {\n    aegisOfValor: {\n        itemType,\n        weaponType: WeaponType.shield,\n        rarity: Rarity.legendary,\n        iconImg: `${basePath}aegis-of-valor.png`,\n    },\n    arbalest: {\n        itemType,\n        weaponType: WeaponType.crossbow,\n        rarity: Rarity.epic,\n        iconImg: `${basePath}arbalest.png`,\n        damage: { [DamageType.kinetic]: 40 },\n    },\n    battleAxe: {\n        itemType,\n        weaponType: WeaponType.axe,\n        rarity: Rarity.common,\n        iconImg: `${basePath}battle-axe.png`,\n        damage: { [DamageType.kinetic]: 20 },\n    },\n    berserkerShield: {\n        itemType,\n        weaponType: WeaponType.shield,\n        rarity: Rarity.epic,\n        iconImg: `${basePath}berserker-shield.png`,\n    },\n    brassKnuckles: {\n        itemType,\n        weaponType: WeaponType.fist,\n        iconImg: `${basePath}brass-knuckles.png`,\n        rarity: Rarity.common,\n        damage: { [DamageType.kinetic]: 10 },\n    },\n    bronzeDagger: {\n        itemType,\n        weaponType: WeaponType.knife,\n        iconImg: `${basePath}bronze-dagger.png`,\n        rarity: Rarity.common,\n        damage: { [DamageType.kinetic]: 8 },\n    },\n    buckler: {\n        itemType,\n        weaponType: WeaponType.shield,\n        rarity: Rarity.common,\n        iconImg: `${basePath}buckler.png`,\n    },\n    cleaver: {\n        itemType,\n        weaponType: WeaponType.knife,\n        iconImg: `${basePath}cleaver.png`,\n        rarity: Rarity.common,\n        damage: { [DamageType.kinetic]: 5 },\n    },\n    club: {\n        itemType,\n        weaponType: WeaponType.club,\n        iconImg: `${basePath}club.png`,\n        rarity: Rarity.common,\n        damage: { [DamageType.kinetic]: 8 },\n    },\n    dagger: {\n        itemType,\n        weaponType: WeaponType.knife,\n        iconImg: `${basePath}dagger.png`,\n        rarity: Rarity.rare,\n        damage: { [DamageType.kinetic]: 10 },\n    },\n    dirk: {\n        itemType,\n        weaponType: WeaponType.knife,\n        iconImg: `${basePath}dirk.png`,\n        rarity: Rarity.uncommon,\n        damage: { [DamageType.kinetic]: 10 },\n    },\n    falchion: {\n        itemType,\n        weaponType: WeaponType.sword,\n        iconImg: `${basePath}falchion.png`,\n        rarity: Rarity.rare,\n        damage: { [DamageType.kinetic]: 12 },\n    },\n    flail: {\n        itemType,\n        weaponType: WeaponType.flail,\n        iconImg: `${basePath}flail.png`,\n        rarity: Rarity.uncommon,\n        damage: { [DamageType.kinetic]: 15 },\n    },\n    goldenShield: {\n        itemType,\n        weaponType: WeaponType.shield,\n        rarity: Rarity.rare,\n        iconImg: `${basePath}golden-shield.png`,\n    },\n    greatswordOfGwai: {\n        itemType,\n        weaponType: WeaponType.sword,\n        iconImg: `${basePath}greatsword-gwai.png`,\n        unique: true,\n        rarity: Rarity.legendary,\n        damage: { [DamageType.kinetic]: 25 },\n    },\n    halbert: {\n        itemType,\n        weaponType: WeaponType.poleArm,\n        iconImg: `${basePath}halbert.png`,\n        rarity: Rarity.rare,\n        damage: { [DamageType.kinetic]: 12 },\n    },\n    huntingBow: {\n        itemType,\n        weaponType: WeaponType.bow,\n        iconImg: `${basePath}hunting-bow.png`,\n        rarity: Rarity.common,\n        damage: { [DamageType.kinetic]: 3 },\n    },\n    indomitableCarapace: {\n        itemType,\n        weaponType: WeaponType.shield,\n        rarity: Rarity.epic,\n        unique: true,\n        iconImg: `${basePath}indomitable-carapace.png`,\n    },\n    jaggedBlade: {\n        itemType,\n        weaponType: WeaponType.knife,\n        rarity: Rarity.epic,\n        iconImg: `${basePath}jagged-blade.png`,\n    },\n    javelin: {\n        itemType,\n        weaponType: WeaponType.poleArm,\n        iconImg: `${basePath}javelin.png`,\n        rarity: Rarity.epic,\n        damage: { [DamageType.kinetic]: 25 },\n    },\n    khopesh: {\n        itemType,\n        weaponType: WeaponType.sword,\n        iconImg: `${basePath}khopesh.png`,\n        rarity: Rarity.epic,\n        damage: { [DamageType.kinetic]: 15 },\n    },\n    legionnaireSword: {\n        itemType,\n        weaponType: WeaponType.sword,\n        iconImg: `${basePath}legionnaire-sword.png`,\n        rarity: Rarity.rare,\n        damage: { [DamageType.kinetic]: 8 },\n    },\n    longbow: {\n        itemType,\n        weaponType: WeaponType.bow,\n        iconImg: `${basePath}longbow.png`,\n        rarity: Rarity.rare,\n        damage: { [DamageType.kinetic]: 2 },\n    },\n    mace: {\n        itemType,\n        weaponType: WeaponType.club,\n        iconImg: `${basePath}mace.png`,\n        rarity: Rarity.rare,\n        damage: { [DamageType.kinetic]: 15 },\n    },\n    morningStar: {\n        itemType,\n        weaponType: WeaponType.club,\n        iconImg: `${basePath}morning-star.png`,\n        rarity: Rarity.uncommon,\n        damage: { [DamageType.kinetic]: 13 },\n    },\n    paintedBuckler: {\n        itemType,\n        weaponType: WeaponType.shield,\n        iconImg: `${basePath}painted-buckler.png`,\n    },\n    poisonedDagger: {\n        itemType,\n        weaponType: WeaponType.knife,\n        iconImg: `${basePath}poisoned-dagger.png`,\n        rarity: Rarity.epic,\n        damage: { [DamageType.kinetic]: 12 },\n    },\n    pikeStaff: {\n        itemType,\n        weaponType: WeaponType.poleArm,\n        iconImg: `${basePath}pike-staff.png`,\n        rarity: Rarity.uncommon,\n        damage: { [DamageType.kinetic]: 22 },\n    },\n    ravenStaff: {\n        itemType,\n        weaponType: WeaponType.staff,\n        iconImg: `${basePath}raven-staff.png`,\n        rarity: Rarity.epic,\n        damage: { [DamageType.kinetic]: 13 },\n    },\n    scythe: {\n        itemType,\n        weaponType: WeaponType.poleArm,\n        iconImg: `${basePath}scythe.png`,\n        rarity: Rarity.common,\n        damage: { [DamageType.kinetic]: 5 },\n    },\n    savageStaff: {\n        itemType,\n        weaponType: WeaponType.staff,\n        iconImg: `${basePath}savage-staff.png`,\n        rarity: Rarity.epic,\n        damage: { [DamageType.kinetic]: 8 },\n    },\n    simpleCrossbow: {\n        itemType,\n        weaponType: WeaponType.crossbow,\n        iconImg: `${basePath}crossbow.png`,\n        rarity: Rarity.common,\n        damage: { [DamageType.kinetic]: 3 },\n    },\n    spear: {\n        itemType,\n        weaponType: WeaponType.poleArm,\n        iconImg: `${basePath}spear.png`,\n        rarity: Rarity.rare,\n        damage: { [DamageType.kinetic]: 10 },\n    },\n    steelShield: {\n        itemType,\n        weaponType: WeaponType.shield,\n        rarity: Rarity.rare,\n        iconImg: `${basePath}steel-shield.png`,\n    },\n    steelSword: {\n        itemType,\n        weaponType: WeaponType.sword,\n        iconImg: `${basePath}steel-sword.png`,\n        rarity: Rarity.uncommon,\n        damage: { [DamageType.kinetic]: 14 },\n    },\n    warhammer: {\n        itemType,\n        weaponType: WeaponType.hammer,\n        iconImg: `${basePath}warhammer.png`,\n        rarity: Rarity.rare,\n        damage: { [DamageType.kinetic]: 16 },\n    },\n    woodenBulwark: {\n        itemType,\n        weaponType: WeaponType.shield,\n        rarity: Rarity.common,\n        iconImg: `${basePath}wooden-bulwark.png`,\n    },\n};\n\n\nexport type Weapon = `${Prefix}${keyof typeof weapons}`;\nconst all = Object.entries(weapons).reduce<{[key: string]: WeaponDefinition}>((acc, [key, value]) => {\n    acc[`${PREFIX}${key}`] = value;\n    return acc;    \n}, {}) as Record<Weapon, WeaponDefinition>;\nexport default all;\n\nexport function getDefinition(weapon: Weapon): WeaponDefinition {\n    return all[weapon];\n}\n\nexport const isWeapon = (item: Item): item is Weapon => {\n    return !!all[item as Weapon];\n}\n","import { AdventurerStoreState } from \"store/types/adventurer\";\nimport { Allegiance } from \"store/types/combat\";\nimport { SceneAction, SceneStoreState, SceneInteractionModal } from \"store/types/scene\";\nimport { PartialDeep } from \"type-fest\";\n\nexport type QuestAction = \n    { type: \"launchQuest\", questName: string, assignedAventurers: AdventurerStoreState[] }\n |  { type: \"exitEncounter\", questName: string }\n |  { type: \"updateQuestVars\", questName: string, vars: PartialDeep<unknown> }\n |  { type: \"setSceneName\", questName: string, sceneName: string }\n |  { type: \"setScene\", questName: string, scene: SceneStoreState; }\n |  { type: \"enqueueSceneAction\", questName: string, sceneAction: SceneAction }\n |  { type: \"completeSceneAction\", questName: string }\n |  { type: \"setCombat\", questName: string, combat: boolean }\n |  { type: \"endPlayerTurn\", questName: string }\n |  { type: \"startTurn\", questName: string, turn: Allegiance }\n |  { type: \"deductActorAp\", questName: string,  actor: string, ap: number }\n |  { type: \"setActorAp\", questName: string, actor: string, ap: number }\n//  |  { type: \"updateEncounterResult\", questName: string, nodeIndex: number, result: string }\n |  { type: \"setActiveSceneInteractionModal\", questName: string, sceneInteractionModal?: SceneInteractionModal }\n\n;\n\n\n/**\n * Embark upon a new quest */\nexport const launchQuest = (questName: string, assignedAventurers: AdventurerStoreState[]): QuestAction => ({\n    type: \"launchQuest\",\n    questName,\n    assignedAventurers,\n})\n\n/** \n * Completes the current encounter so the party can continue the quest */\nexport const exitEncounter = (quest: string): QuestAction => ({\n    type: \"exitEncounter\",\n    questName: quest,\n})\n\nexport const updateQuestVars = (quest: string, vars: PartialDeep<unknown>): QuestAction => ({\n    type: \"updateQuestVars\",\n    questName: quest,\n    vars,\n})\n\n/**\n * Sets name of the current scene of a quest */\nexport const setSceneName = (questName: string, sceneName: string): QuestAction =>({\n    type: \"setSceneName\",\n    questName,\n    sceneName,\n})\n\n/**\n * Fills in the scene of a quest */\nexport const setScene = (questName: string, scene: SceneStoreState): QuestAction => ({\n    type: \"setScene\",\n    questName,\n    scene,\n})\n\nexport const enqueueSceneAction = (questName: string, sceneAction: SceneAction): QuestAction => ({\n    type: \"enqueueSceneAction\",\n    questName,\n    sceneAction,\n})\n\nexport const completeSceneAction = (questName: string): QuestAction => ({\n    type: \"completeSceneAction\",\n    questName,\n})\n\nexport const setCombat = (questName: string, combat: boolean): QuestAction => ({\n    type: \"setCombat\",\n    questName,\n    combat\n})\n\nexport const endPlayerTurn = (questName: string): QuestAction => ({\n    type: \"endPlayerTurn\",\n    questName,\n})\n\nexport const startTurn = (questName: string, turn: Allegiance): QuestAction => ({\n    type: \"startTurn\",\n    questName,\n    turn,\n})\n\nexport const deductActorAp = (questName: string, actor: string, ap: number): QuestAction => ({\n    type: \"deductActorAp\",\n    questName,\n    actor,\n    ap\n})\n\nexport const setActorAp = (questName: string, actor: string, ap: number): QuestAction => ({\n    type: \"setActorAp\",\n    questName,\n    actor,\n    ap\n})\n\n\n// export const updateEncounterResult = (questName: string, nodeIndex: number, result: string): QuestAction => ({\n//     type: \"updateEncounterResult\",\n//     questName,\n//     nodeIndex,\n//     result,\n// })\n\nexport const setActiveSceneInteractionModal = (questName: string, sceneInteractionModal?: SceneInteractionModal): QuestAction => ({\n    type: \"setActiveSceneInteractionModal\",\n    questName,\n    sceneInteractionModal\n})\n\n","\n// Things that can be dragged\nexport const DragType = {\n    ADVENTURER: \"adventurer\",   // Adventurer avatar\n    ITEM: \"item\",               // A game 'item' (equipment, etc)\n};\n\n// Source, where it comes from\nexport enum DragSourceType {\n    adventurerInventory,\n    warehouse,\n    tavern,\n    adventurerEquipment,\n    lootCache,\n    resourceStructure // harvest\n}\n","import { Item, ItemDefinition, ItemType } from \"./types\";\n\ntype Prefix = \"herb/\";\nconst PREFIX = \"herb/\";\nconst itemType = ItemType.herb;\nconst basePath = \"/img/items/herbs/\";\n\nconst herbs = {\n    angelicasSorrow: {\n        itemType,\n        iconImg: `${basePath}angelicas-sorrow.png`,\n    },\n    bansheeReeds: {\n        itemType,\n        iconImg: `${basePath}banshee-reeds.png`,\n    },\n    blissflower: {\n        itemType,\n        iconImg: `${basePath}blissflower.png`,\n    },\n    bloodLotus: {\n        itemType,\n        iconImg: `${basePath}blood-lotus.png`,\n    },\n    bogroot: {\n        itemType,\n        iconImg: `${basePath}bogroot.png`,\n    },\n    ceviorise: {\n        itemType,\n        iconImg: `${basePath}ceviorise.png`,\n    },\n    chicory: {\n        itemType,\n        iconImg: `${basePath}chicory.png`,\n    },\n    dragonroot: {\n        itemType,\n        iconImg: `${basePath}dragonroot.png`,\n    },\n    heartsVine: {\n        itemType,\n        iconImg: `${basePath}hearts-vine.png`,\n    },\n    hyacinthus: {\n        itemType,\n        iconImg: `${basePath}hyacinthus.png`,\n    },\n    jaboticaba: {\n        itemType,\n        iconImg: `${basePath}jaboticaba.png`,\n    },\n    kingsrose: {\n        itemType,\n        iconImg: `${basePath}kingsrose.png`,\n    },\n    lastSupper: {\n        itemType,\n        iconImg: `${basePath}last-supper.png`,\n    },\n    mistagold: {\n        itemType,\n        iconImg: `${basePath}mistagold.png`,\n    },\n    monksweed: {\n        itemType,\n        iconImg: `${basePath}monksweed.png`,\n    },\n    moonFlower: {\n        itemType,\n        iconImg: `${basePath}moon-flower.png`,\n    },\n    mountainGrass: {\n        itemType,\n        iconImg: `${basePath}mountain-grass.png`,\n    },\n    oakLeaf: {\n        itemType,\n        iconImg: `${basePath}oak-leaf.png`,\n    },\n    patricksroot: {\n        itemType,\n        iconImg: `${basePath}patricksroot.png`,\n    },\n    sunleaf: {\n        itemType,\n        iconImg: `${basePath}sunleaf.png`,\n    },\n    trollsFeast: {\n        itemType,\n        iconImg: `${basePath}trolls-feast.png`,\n    },\n    uwolic: {\n        itemType,\n        iconImg: `${basePath}uwolic.png`,\n    },\n    wyrmvine: {\n        itemType,\n        iconImg: `${basePath}wyrmvine.png`,\n    },\n    winterWeed: {\n        itemType,\n        iconImg: `${basePath}winter-weed.png`,\n    },\n    wizardsBane: {\n        itemType,\n        iconImg: `${basePath}wizards-bane.png`,\n    },\n};\n\nexport type Herb = `${Prefix}${keyof typeof herbs}`;\nconst all = Object.entries(herbs).reduce<{[key: string]: ItemDefinition}>((acc, [key, value]) => {\n    acc[`${PREFIX}${key}`] = value;\n    return acc;    \n}, {}) as Record<Herb, ItemDefinition>;\nexport default all;\n\nexport function getDefinition(herb: Herb): ItemDefinition {\n    return all[herb];\n}\n\nexport const isHerb = (item: Item): item is Herb => {\n    return !!all[item as Herb];\n}","import { Item, ItemDefinition, ItemType } from \"./types\";\n\ntype Prefix = \"material/\";\nconst PREFIX = \"material/\";\nconst itemType = ItemType.material;\nconst basePath = \"/img/items/materials/\";\n\n\nconst materials = {\n    arrowheads: {\n        itemType,\n        iconImg: `${basePath}arrowheads.png`,\n    },\n    beam: {\n        itemType,\n        iconImg: `${basePath}beam.png`,\n    },\n    bolts: {\n        itemType,\n        iconImg: `${basePath}bolts.png`,\n    },\n    buckle: {\n        itemType,\n        iconImg: `${basePath}buckle.png`,\n    },\n    chain: {\n        itemType,\n        iconImg: `${basePath}chain.png`,\n    },\n    cogs: {\n        itemType,\n        iconImg: `${basePath}cogs.png`,\n    },\n    gunpowder: {\n        itemType,\n        iconImg: `${basePath}gunpowder.png`,\n    },\n    ingot: {\n        itemType,\n        iconImg: `${basePath}ingot.png`,\n    },\n    nails: {\n        itemType,\n        iconImg: `${basePath}nails.png`,\n    },\n    pile: {\n        itemType,\n        iconImg: `${basePath}pile.png`,\n    },\n    planks: {\n        itemType,\n        iconImg: `${basePath}planks.png`,\n    },\n    poisonVial: {\n        itemType,\n        iconImg: `${basePath}poison-vial.png`,\n    },\n    pulley: {\n        itemType,\n        iconImg: `${basePath}pulley.png`,\n    },\n    ribbon: {\n        itemType,\n        iconImg: `${basePath}ribbon.png`,\n    },\n    rope: {\n        itemType,\n        iconImg: `${basePath}rope.png`,\n    },\n    runeCarvedPlank: {\n        itemType,\n        iconImg: `${basePath}rune-carved-plank.png`,\n    },\n    scales: {\n        itemType,\n        iconImg: `${basePath}scales.png`,\n    },\n    spring: {\n        itemType,\n        iconImg: `${basePath}spring.png`,\n    },\n    stake: {\n        itemType,\n        iconImg: `${basePath}stake.png`,\n    },\n    stick: {\n        itemType,\n        iconImg: `${basePath}stick.png`,\n    },\n    thread: {\n        itemType,\n        iconImg: `${basePath}thread.png`,\n    },\n    woodenMask: {\n        itemType,\n        iconImg: `${basePath}wooden-mask.png`,\n    },\n};\n\n\nexport type Material = `${Prefix}${keyof typeof materials}`;\nconst all = Object.entries(materials).reduce<{[key: string]: ItemDefinition}>((acc, [key, value]) => {\n    acc[`${PREFIX}${key}`] = value;\n    return acc;    \n}, {}) as Record<Material, ItemDefinition>;\nexport default all;\n\nexport function getDefinition(material: Material): ItemDefinition {\n    return all[material];\n}\n\nexport const isMaterial = (item: Item): item is Material => {\n    return !!all[item as Material];\n}","import { Item, ItemDefinition, ItemType } from \"./types\";\n\ntype Prefix = \"mineral/\";\nconst PREFIX = \"mineral/\";\nconst itemType = ItemType.mineral;\nconst basePath = \"/img/items/minerals/\";\n\n// Minerals can be used to imbue magical powers to weapons and armor\nconst minerals = {\n    amethyst: {\n        itemType,\n        iconImg: `${basePath}amethyst.png`,\n    },\n    aquamarine: {\n        itemType,\n        iconImg: `${basePath}aquamarine.png`,\n    },\n    arminsHeart: {\n        itemType,\n        iconImg: `${basePath}armins-heart.png`,\n    },\n    dragonsTooth: {\n        itemType,\n        iconImg: `${basePath}dragons-tooth.png`,\n    },\n    greenOpal: {\n        itemType,\n        iconImg: `${basePath}green-opal.png`,\n    },\n    jasper: {\n        itemType,\n        iconImg: `${basePath}jasper.png`,\n    },\n    malachite: {\n        itemType,\n        iconImg: `${basePath}malachite.png`,\n    },\n    moonstone: {\n        itemType,\n        iconImg: `${basePath}moonstone.png`,\n    },\n    obsidian: {\n        itemType,\n        iconImg: `${basePath}obsidian.png`,\n    },\n    roseQuartz: {\n        itemType,\n        iconImg: `${basePath}rose-quartz.png`,\n    },\n    sapphire: {\n        itemType,\n        iconImg: `${basePath}sapphire.png`,\n    },\n    spellstone: {\n        itemType,\n        iconImg: `${basePath}spellstone.png`,\n    },\n    tigersEye: {\n        itemType,\n        iconImg: `${basePath}tigers-eye.png`,\n    },\n    topaz: {\n        itemType,\n        iconImg: `${basePath}topaz.png`,\n    },\n    wyrdstone: {\n        itemType,\n        iconImg: `${basePath}wyrdstone.png`,\n    },\n};\n\n\nexport type Mineral = `${Prefix}${keyof typeof minerals}`;\nconst all = Object.entries(minerals).reduce<{[key: string]: ItemDefinition}>((acc, [key, value]) => {\n    acc[`${PREFIX}${key}`] = value;\n    return acc;    \n}, {}) as Record<Mineral, ItemDefinition>;\nexport default all;\n\nexport function getDefinition(mineral: Mineral): ItemDefinition {\n    return all[mineral];\n}\n\nexport const isMineral = (item: Item): item is Mineral => {\n    return !!all[item as Mineral];\n}","import {  Item, ItemDefinition, ItemType } from \"./types\";\n\ntype Prefix = \"trinket/\";\nconst PREFIX = \"trinket/\";\nconst itemType = ItemType.trinket;\nconst basePath = \"/img/items/trinkets/\";\n\nconst trinkets = {\n    magicAmulet: {\n        itemType,\n        iconImg: `${basePath}magic_amulet.png`,\n    },\n    ring: {\n        itemType,\n        iconImg: `${basePath}ring.png`,\n    },\n};\n\n\nexport type Trinket = `${Prefix}${keyof typeof trinkets}`;\nconst all = Object.entries(trinkets).reduce<{[key: string]: ItemDefinition}>((acc, [key, value]) => {\n    acc[`${PREFIX}${key}`] = value;\n    return acc;    \n}, {}) as Record<Trinket, ItemDefinition>;\nexport default all;\n\nexport function getDefinition(trinket: Trinket): ItemDefinition {\n    return all[trinket];\n}\n\nexport const isTrinket = (item: Item): item is Trinket => {\n    return !!all[item as Trinket];\n}","import apparel, { Apparel } from \"./apparel\";\nimport deeds, { Deed } from \"./deeds\";\nimport herbs, { Herb } from \"./herbs\";\nimport materials, { Material } from \"./materials\";\nimport minerals, { Mineral } from \"./minerals\";\nimport potions, { Potion } from \"./potions\";\nimport questItems, { QuestItem } from \"./questItems\";\nimport trinkets, { Trinket } from \"./trinkets\";\nimport { Item, ItemDefinition, ItemType } from \"./types\";\nimport weapons, { Weapon } from \"./weapons\";\n\nconst all = {\n    ...apparel,\n    ...deeds,\n    ...herbs,\n    ...materials,\n    ...minerals,\n    ...potions,\n    ...questItems,\n    ...trinkets,\n    ...weapons,\n};\n\nexport default all;\n\nexport const getDefinition = (item: Item): ItemDefinition => {\n    return all[item]\n}\n\nexport const getAllItemsByType = (itemType: ItemType): Item[] => {\n    switch (itemType) {\n        case ItemType.apparel:\n            return Object.keys(apparel) as Apparel[];\n        case ItemType.deed:\n            return Object.keys(deeds) as Deed[];\n        case ItemType.herb:\n            return Object.keys(herbs) as Herb[];\n        case ItemType.material:\n            return Object.keys(materials) as Material[];\n        case ItemType.mineral:\n            return Object.keys(minerals) as Mineral[];\n        case ItemType.potion:\n            return Object.keys(potions) as Potion[];\n        case ItemType.questItem:\n            return Object.keys(questItems) as QuestItem[];\n        case ItemType.trinket:\n            return Object.keys(trinkets) as Trinket[];\n        case ItemType.weapon:\n            return Object.keys(weapons) as Weapon[];\n    }\n}","export interface CombatStoreState {\n    actors: Actor[];\n    turn: Allegiance;\n    action?: CombatAction;\n}\n\nexport interface Actor {\n    name: string;\n    allegiance: Allegiance;\n    location: number[];\n    health: number;\n    remainingAP: number;\n}\n\nexport enum Allegiance {\n    player,\n    enemy,\n}\n\nexport interface CombatAction {\n    type: CombatActionType;\n    actor: string;\n    target: [number, number];\n    endsAt: number;\n}\n\nexport enum CombatActionType {\n    move = \"move\",\n    slash = \"slash\",\n    shoot = \"shoot\",\n}\n\nexport const barBrawl: CombatStoreState = {\n    actors: [{\n        allegiance: Allegiance.player,\n        health: 100,\n        location: [3, 5],\n        name: \"c4a5d270\",\n        remainingAP: 5,\n    }, {\n        allegiance: Allegiance.player,\n        health: 100,\n        location: [4, 6],\n        name: \"2e655832\",\n        remainingAP: 4,\n    }],\n    turn: Allegiance.player,\n};\n","import { TiledProperty, TiledLayerData, TiledTilesetData } from 'constants/tiledMapData';\n\n\n// Unpack array of properties into key/value object for fast retrieval\nexport const parseProperties = (properties?: TiledProperty[]): {[key: string]: string | boolean | number } => {\n    if (!properties) return {};\n    return properties.reduce((acc: {[key: string]: string | boolean | number}, value: TiledProperty) => {\n        acc[value.name] = value.value;\n        return acc;\n    }, {});\n}\n\nexport enum TiledObjectType {\n    adventurerStart = \"adventurerStart\",\n    exit = \"exit\",\n    actor = \"actor\",\n    enemySpawn = \"enemySpawn\",\n}\n\n// finds tileset based on gid\nexport const findTileset = (gid: number, tilesets: TiledTilesetData[]): TiledTilesetData | undefined => {\n    let tileset;\n    for (let i = tilesets.length - 1; i >= 0; i--) {\n        tileset = tilesets[i];\n        if (tileset.firstgid <= gid) {\n            break;\n        }\n    }\n    return tileset;\n}\n/** Add tiles in this layer to list */\nexport const addAllTilesInLayerToList = (list: [number, number][], layer: TiledLayerData, columns: number): void => {\n    layer.data.reduce((acc: [number, number][], tile, index) => {\n        if (tile > 0) {\n            const x = (index % columns);\n            const y = Math.floor(index / columns);\n            acc.push([x, y]);\n        }\n        return acc;\n    }, list);\n}\n\nexport const locationEquals = (a: [number, number], b: [number, number]): boolean => {\n    return a[0] === b[0] && a[1] === b[1];\n}","import { TextEntry } from \"constants/text\";\n\nexport enum LogChannel {\n    common,         // Only visible in 'all'\n    town,           // Visible in 'all' and town\n    quest,          // Visible in 'all' and the appropriate quest tab\n}\n\nexport interface LogEntry extends TextEntry {\n    time: number;\n    channel: LogChannel;\n    channelContext?: string;\n}\n","import { EquipmentSlotType } from \"components/ui/adventurer/EquipmentSlot\";\nimport { Item } from \"definitions/items/types\";\n\nexport type AdventurerAction = \n    { type: \"drinkPotion\", adventurerId: string, fromSlot: number }\n |  { type: \"moveItemInInventory\", adventurerId: string, fromSlot: number, toSlot: number }\n |  { type: \"moveItemToOtherAdventurer\", adventurerId: string, fromSlot: number, toSlot?: number, toAdventurerId: string }\n |  { type: \"addItemToInventory\", adventurerId: string, item: Item, toSlot?: number }\n |  { type: \"removeItemFromInventory\", adventurerId: string, fromSlot: number }\n |  { type: \"assignEquipment\", adventurerId: string, item: Item, equipmentSlot: EquipmentSlotType }\n |  { type: \"removeEquipment\", adventurerId: string, equipmentSlot: EquipmentSlotType }\n |  { type: \"renameAdventurer\", adventurerId: string, name: string }\n |  { type: \"addXP\", adventurerId: string, xp: number; }\n\nexport const drinkPotion = (adventurerId: string, fromSlot: number): AdventurerAction => ({\n    type: \"drinkPotion\",\n    adventurerId,\n    fromSlot,\n})\n\nexport const moveItemInInventory = (adventurerId: string, fromSlot: number, toSlot: number): AdventurerAction => ({\n    type: \"moveItemInInventory\",\n    adventurerId,\n    fromSlot,\n    toSlot,\n})\n\n/**\n * Moves the an item from one adventurers' inventory to another\n * @param fromAdventurerId adventurer whose inventory to take the item from\n * @param fromSlot index of the inventory item\n * @param toAdventurerId player who to give the item to\n */\nexport const moveItemToOtherAdventurer = (fromAdventurerId: string, fromSlot: number, toAdventurerId: string, toSlot?: number): AdventurerAction => ({\n    type: \"moveItemToOtherAdventurer\",\n    adventurerId: fromAdventurerId,\n    fromSlot,\n    toAdventurerId,\n    toSlot,\n})\n\n// If slot is not provided, will take the first empty slot\nexport const addItemToInventory = (adventurerId: string, item: Item, toSlot?: number): AdventurerAction => ({\n    type: \"addItemToInventory\",\n    adventurerId,\n    item,\n    toSlot,\n})\n\nexport const removeItemFromInventory = (adventurerId: string, fromSlot: number): AdventurerAction => ({\n    type: \"removeItemFromInventory\",\n    adventurerId,\n    fromSlot,\n})\n\nexport const assignEquipment = (adventurerId: string, equipmentSlot: EquipmentSlotType, item: Item): AdventurerAction => ({\n    type: \"assignEquipment\",\n    adventurerId,\n    item,\n    equipmentSlot,\n})\n\nexport const removeEquipment = (adventurerId: string, equipmentSlot: EquipmentSlotType): AdventurerAction => ({\n    type: \"removeEquipment\",\n    adventurerId,\n    equipmentSlot,\n})\n\nexport const renameAdventurer = (adventurerId: string, name: string): AdventurerAction => ({\n    type: \"renameAdventurer\",\n    adventurerId,\n    name,\n})\n\nexport const addXp = (adventurerId: string, xp: number): AdventurerAction => ({\n    type: \"addXP\",\n    adventurerId,\n    xp,\n})\n","import { FIVE_SECONDS } from 'utils/format/time';\nimport { Type } from 'components/ui/toasts/Toast';\nimport EventEmitter from \"events\";\nimport TypedEmitter from \"typed-emitter\";\nimport { SoundManager} from './SoundManager';\n\nexport interface ToastConfig {\n    time: number;\n    title: string;\n    type?: Type;\n    icon?: string;\n    link?: string;\n}\n\nexport const EVENT_TOASTS_UPDATED = \"toast\";\ninterface ToastEvents {\n    [EVENT_TOASTS_UPDATED]: (context: ToastConfig[] | undefined) => void;\n}\nexport class ToastManager extends (EventEmitter as new () => TypedEmitter<ToastEvents>) {\n    private static _instance = new ToastManager();\n\n    private static stack: ToastConfig[] = [];\n    private static lifeTime = FIVE_SECONDS; // Time each toast lives\n                                            // also update CSS animation!\n\n    static addToast(title: string, type?: Type, icon?: string, link?: string) {\n\n        this.stack = [...this.stack, {\n            time: Date.now(),\n            title,\n            type,\n            icon,\n            link\n        }];\n\n        this.instance.emit(EVENT_TOASTS_UPDATED, this.stack);\n\n        SoundManager.playSound(\"ui/toast\");\n\n        setTimeout(() => {\n            // Remove all popups that have expired\n            this.stack = this.stack.filter((toast) => {\n                return Date.now() - toast.time < this.lifeTime\n            });\n            this.instance.emit(EVENT_TOASTS_UPDATED, this.stack);\n\n        }, this.lifeTime);\n    }\n\n    static get instance() {\n        return this._instance;\n    }\n}","import { BaseSceneController } from 'mechanics/scenes/BaseSceneController';\nimport { SceneControllerManager } from 'global/SceneControllerManager';\nimport { SceneObject, ActorObject, LootCache } from 'store/types/scene';\nimport { setActiveSceneInteractionModal } from 'store/actions/quests';\nimport { Kill10BoarsQuestVars } from '../questVars';\nimport { Channel, MixMode, SoundManager } from 'global/SoundManager';\nimport { Item } from 'definitions/items/types';\n\nconst TILE_CHEST_CLOSED = 33; // todo: take this from json?\nconst TILE_CHEST_OPEN = 34; // todo: take this from json?\nconst TILE_DOOR_UPPER_CLOSED = 121 + 131;\nconst TILE_DOOR_LOWER_CLOSED = 121 + 143;\nconst TILE_DOOR_UPPER_OPEN = 121 + 107;\nconst TILE_DOOR_LOWER_OPEN = 121 + 119;\n\nclass DungeonEncounterSceneController extends BaseSceneController<Kill10BoarsQuestVars>  {\n\n    // getLootCache(name: string): LootCache | undefined {\n    //     return this.questVars.dungeon.lootCaches[name];\n    // }\n\n    // takeGoldFromCache(name: string) {\n    //     super.takeGoldFromCache(name);  // first add gold to inventory\n    //     const lootCache = this.getLootCache(name);\n    //     if (lootCache){\n    //         const questVars = this.questVars;\n    //         questVars.dungeon.lootCaches[name].gold = 0;\n    //         this.store.dispatch(updateQuestVars(this.questName, questVars));\n    //     }\n    // }\n\n    // takeItemFromCache(itemIndex: number, name: string, adventurer: AdventurerStoreState, toSlot?: number) {\n    //     super.takeItemFromCache(itemIndex, name, adventurer, toSlot);\n    //     const lootCache = this.getLootCache(name);\n    //     if (lootCache){\n    //         const questVars = this.questVars;\n    //         const items = questVars.dungeon.lootCaches[name].items.filter((_: any, index: number) => index !== itemIndex);\n    //         questVars.dungeon.lootCaches[name].items = items;\n    //         this.store.dispatch(updateQuestVars(this.questName, questVars));\n    //     }\n    // }\n}\nexport class DungeonEntranceSceneController extends DungeonEncounterSceneController {\n    // jsonPath = \"scenes/dungeon-entry-64.json\";\n    jsonPath = \"scenes/ork-dungeon-level1.json\";\n\n\n    getLootCache(_: string): LootCache | undefined {\n        return this.questVars.dungeon.entrance.chest;\n    }\n\n    takeGoldFromCache(name: \"chest\") {\n        super.takeGoldFromCache(name);  // first add gold to inventory\n        this.updateQuestVars({\n            dungeon: { entrance: { chest: { gold: 0 }}}\n        });\n    }\n\n    takeItemFromCache(itemIndex: number, name: string, adventurerId: string, toSlot?: number) {\n        super.takeItemFromCache(itemIndex, name, adventurerId, toSlot);\n        const lootCache = this.getLootCache(name);\n        if (lootCache){\n            const items = lootCache.items.filter((_:Item, index: number) => index !== itemIndex);\n            this.updateQuestVars({\n                dungeon: { entrance: { chest: { items }}}\n            });\n        }\n    }\n\n    updateScene(objects: SceneObject[] = this.sceneObjects, combat: boolean = this.combat) {\n        objects = objects.map(o => {\n            switch(o.name) {\n                case \"chest\": {\n                    return {\n                        ...o,\n                        gid: this.questVars.dungeon.entrance.chestOpen ? TILE_CHEST_OPEN : TILE_CHEST_CLOSED,\n                    }\n                }\n            }\n            return o;\n        });\n        super.updateScene(objects, combat);\n    }\n\n    interactWithObject(actor: ActorObject, object: SceneObject) {\n        switch (object.name) {\n            // todo: I want to share this common stuff with other SceneControllers\n            case \"chest\":\n                if (!this.questVars.dungeon.entrance.chestOpen) {\n                    const adventurer = this.getAdventurerByActor(actor)?.name;\n                    const textEntry = { key: \"quest-common-adventurer-opened-chest\", context: { adventurer } };\n                    this.questUpdate(textEntry, \"/img/items/misc/chest-02.png\");\n\n                    this.updateQuestVars({\n                        dungeon: { entrance: { chestOpen: true }}\n                    })\n                }\n                // display loot modal\n                this.store.dispatch(setActiveSceneInteractionModal(this.questName, {\n                    type: 'lootCache',\n                    lootCache: object.name\n                }));\n                break;\n\n            case \"altar\":\n                this.store.dispatch(setActiveSceneInteractionModal(this.questName, {\n                    type: 'situation',\n                    situation: 'altar'\n                }));\n                break;\n        }\n        super.interactWithObject(actor, object);\n    }\n\n    sceneEntered() {\n        if (!this.questVars.dungeon.entered) {\n            this.questUpdate(\"quest-kill10-boars-enter-dungeon-see-chest\");\n        }\n    }\n\n\n    getSituation(situation: string, adventurerId?: string) {\n        switch (situation) {\n            // case 'altar':\n            //     const questVars = this.questVars;\n            //     if (questVars.dungeon.situations.altar.candleLit) {\n            //         return {\n            //             title: 'quest-kill10-boars-dungeonentrance-altar',\n            //             choices: [\n            //                 \"quest-kill10-boars-dungeonentrance-altar-rummagedrawers\"\n            //             ]\n            //         }f\n            //     }\n            //     return {\n            //         title: 'quest-kill10-boars-dungeonentrance-altar',\n            //         choices: [\n            //             \"quest-kill10-boars-dungeonentrance-altar-lightcandle\",\n            //             \"quest-kill10-boars-dungeonentrance-altar-rummagedrawers\"\n            //         ]\n            //     }\n                default:\n                    return super.getSituation(situation, adventurerId);\n        }\n    }\n\n    handleSituationOptionClick(_situation: string, _option: string, _adventurerId: string) {\n        // switch (situation) {\n            // case 'altar': {\n            //     switch (option) {\n            //         case 'quest-kill10-boars-dungeonentrance-altar-lightcandle':\n            //             const questVars = this.questVars;\n            //             questVars.dungeon.situations.altar.candleLit = true;\n            //             this.store.dispatch(updateQuestVars(this.questName, questVars));\n            //             break;\n\n            //         case 'quest-kill10-boars-dungeonentrance-altar-rummagedrawers':\n            //             // display loot modal!\n            //             this.store.dispatch(setActiveSceneInteractionModal(this.questName, {\n            //                 type: 'lootCache',\n            //                 lootCache: 'altar'\n            //             }));\n            //             break;\n            //     }\n            // }\n        // }\n    }\n}\n\nexport class DungeonHallwaySceneController extends DungeonEncounterSceneController {\n    jsonPath = \"scenes/ork-dungeon-level2.json\";\n\n    getLootCache(_: string): LootCache | undefined {\n        return this.questVars.dungeon.hallway.chest;\n    }\n\n    sceneEntered() {\n        // console.log(\"ENTERED THE HALLWAy\")\n    }\n\n    interactWithObject(actor: ActorObject, object: SceneObject) {\n        switch (object.name) {\n            // todo: I want to share this common stuff with other SceneControllers\n            case \"chest\":\n                if (!this.questVars.dungeon.hallway.chestOpen) {\n                    const adventurer = this.getAdventurerByActor(actor)?.name;\n                    const textEntry = { key: \"quest-common-adventurer-opened-chest\", context: { adventurer } };\n                    this.questUpdate(textEntry, \"/img/items/misc/chest-02.png\");\n\n                    this.updateQuestVars({\n                        dungeon: { hallway: { chestOpen: true }}\n                    })\n                }\n                // display loot modal\n                this.store.dispatch(setActiveSceneInteractionModal(this.questName, {\n                    type: 'lootCache',\n                    lootCache: object.name\n                }));\n                break;\n            case \"door1\":\n                if (!this.questVars.dungeon.hallway.doorOpen) {\n                    this.store.dispatch(setActiveSceneInteractionModal(this.questName, {\n                        type: 'situation',\n                        situation: 'door'\n                    }));\n                }\n                break;\n            case \"latrine\":\n                this.questUpdate(\"quest-kill10-boars-dungeonentrance-latrine\");\n                break;\n        }\n        super.interactWithObject(actor, object);\n    }\n\n    getSituation(situation: string, adventurerId?: string) {\n        switch (situation) {\n            case 'door': {\n                const adventurer = this.getAdventurerById(adventurerId!);\n                if (adventurer && adventurer.inventory.some(i => i === \"questItem/key\")) {\n                    // Adventurer has key\n                    return {\n                        title: 'quest-kill10-boars-dungeonentrance-door',\n                        choices: [\n                            \"quest-common-scenerio-door-open\"\n                        ]\n                    }\n                }\n                return {\n                    title: 'quest-kill10-boars-dungeonentrance-door',\n                    text: 'quest-kill10-boars-dungeonentrance-door-needs-key',\n                }\n            }\n            default:\n                return super.getSituation(situation, adventurerId);\n        }\n    }\n    \n\n    handleSituationOptionClick(situation: string, option: string, adventurerId: string) {\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n        // @ts-ignore\n        switch (situation) {\n            case 'door': {\n                // Only one option, to open\n                this.updateQuestVars({\n                    dungeon: { hallway: { doorOpen: true }}\n                });\n\n                SoundManager.playSound(\"scene/doorOpen\", Channel.scene, false, MixMode.singleInstance);\n\n                this.discardItem(\"questItem/key\", adventurerId);\n                const adventurer = this.getAdventurerById(adventurerId)?.name;\n                const textEntry = { key: \"quest-common-adventurer-opened-door\", context: { adventurer } };\n                this.questUpdate(textEntry, \"/img/items/misc/chest-02.png\");\n\n                this.dispatch(setActiveSceneInteractionModal(this.questName));\n            }\n        }\n    }\n\n    // Todo: figure out an easier way to do this\n    takeItemFromCache(itemIndex: number, name: string, adventurerId: string, toSlot?: number) {\n        super.takeItemFromCache(itemIndex, name, adventurerId, toSlot);\n        const lootCache = this.getLootCache(name);\n        if (lootCache){\n            const items = lootCache.items.filter((_: any, index: number) => index !== itemIndex);\n            this.updateQuestVars({\n                dungeon: { hallway: { chest: { items }}}\n            });\n        }\n    }\n\n    updateScene(objects: SceneObject[] = this.sceneObjects, combat: boolean = this.combat) {\n        objects = objects.map(o => {\n            switch(o.name) {\n                case \"chest\": {\n                    return {\n                        ...o,\n                        gid: this.questVars.dungeon.hallway.chestOpen ? TILE_CHEST_OPEN : TILE_CHEST_CLOSED,\n                    }\n                }\n                case \"door1\": {\n                    if ( this.questVars.dungeon.hallway.doorOpen) {\n                        const properties = { ...o.properties, blocksMovement: false, interactive: false };\n                        if (o.properties.part === 'upper') {\n                            return { ...o, gid: TILE_DOOR_UPPER_OPEN, properties};\n                        } else {\n                            return { ...o, gid: TILE_DOOR_LOWER_OPEN, properties};\n                        }\n                    } else {\n                        if (o.properties.part === 'upper') {\n                            return { ...o, gid: TILE_DOOR_UPPER_CLOSED };\n                        } else {\n                            return { ...o, gid: TILE_DOOR_LOWER_CLOSED };\n                        }\n                    }\n                }\n            }\n            return o;\n        });\n        super.updateScene(objects, combat);\n    }\n}\n\nSceneControllerManager.registerSceneController(\"kill10Boars\", \"dungeon.entrance\", DungeonEntranceSceneController as any);\nSceneControllerManager.registerSceneController(\"kill10Boars\", \"dungeon.hallway\", DungeonHallwaySceneController as any);\n","import React from 'react';\nimport { TextManager } from 'global/TextManager';\nimport { ToastConfig } from 'global/ToastManager';\nimport { useHistory } from 'react-router';\nimport Icon from 'components/ui/common/Icon';\n\ntype Props = ToastConfig;\n\nexport enum Type {\n    achievementUnlocked,\n    cheat,\n    game,\n    itemCrafted,\n    questCompleted,\n    questEncounter,\n    questLaunched,\n    questUpdate,\n}\n\nconst Toast = (props: Props) => {\n    const {\n        title,\n        type = Type.achievementUnlocked,\n        icon = \"/img/items/quest-items/dragon-eye.png\",\n        link\n    } = props;\n    const history = useHistory();\n\n    const handleClick = () => {\n        if (link) {\n            history.push(link);\n        }\n    }\n\n    const typeText = TextManager.getToastType(type);\n    return (\n        <div className={`toast ${link ? \"withlink\" : \"\"}`} onClick={handleClick}>\n            <div className=\"label type\">{typeText}</div>\n            <div className=\"label title\">{title}</div>\n            <Icon size=\"big\" image={icon} className=\"toast-icon\" border=\"gold\" />\n            <div className=\"banner\"/>\n        </div>\n    );\n}\n\nexport default Toast;","import { Action } from \"redux\";\nimport { CombatActionType } from \"store/types/combat\";\n\nexport enum ActionType {\n    clearCombatAction = \"clearCombatAction\",\n    startCombatAction = \"startCombatAction\",\n    moveActor = \"moveActor\",\n}\n\nexport interface AddCombatActionAction extends Action<ActionType> {\n    combatType: CombatActionType;\n    actor: string;\n    target: [number, number];\n    endsAt: number;\n}\n\nexport interface MoveActorAction extends Action<ActionType> {\n    actor: string;\n    location: [number, number];\n}\n\nexport function startCombatAction(type: CombatActionType, actor: string, target: [number, number], endsAt: number): AddCombatActionAction {\n    return {\n        type: ActionType.startCombatAction,\n        combatType: type,\n        actor,\n        target,\n        endsAt,\n    };\n}\n\nexport function moveActor(actor: string, location: [number, number]): MoveActorAction {\n    return {\n        type: ActionType.moveActor,\n        actor,\n        location,\n    };\n}\n\nexport function clearCombatAction(): Action<ActionType> {\n    // currently there is only one combat possible. so only one needs to be cleared\n    return {\n        type: ActionType.clearCombatAction,\n    };\n}\n","import { convertSemVerToInt } from \"utils/version\";\n\n// <MAJOR>.<MINOR>.<RELEASE>\n\nconst version = \"0.0.6\";\n\nexport default version;\nexport const asInt: number = convertSemVerToInt(version);\n","/**\n * Convert a sematic versioning string into an 32-bit integer.\n *\n * Make sure the input string is compatible with the standard found\n * at semver.org. Since this only uses 10-bit per major/minor/patch version,\n * the highest possible SemVer string would be 1023.1023.1023.\n * @param  {string} semVer SemVer string\n * @return {number}         Numeric version\n */\nexport const convertSemVerToInt = (semVer: string): number => {\n    // Split a given version string into three parts.\n    const parts = semVer.split(\".\").map((part) => Number(part));\n    // Check if we got exactly three parts, otherwise throw an error.\n    if (parts.length !== 3) {\n        throw new Error(`Received invalid version string: ${semVer}`);\n    }\n    // Make sure that no part is larger than 1023 or else it\n    // won't fit into a 32-bit integer.\n    parts.forEach((part: number) => {\n        if (part >= 1024) {\n            throw new Error(`Version string invalid, ${part} is too large`);\n        }\n    });\n    let numericVersion = 0;\n    // Shift all parts either 0, 10 or 20 bits to the left.\n    for (let i = 0; i < 3; i++) {\n        numericVersion |= parts[i] << i * 10;\n    }\n    return numericVersion;\n};\n\n/**\n * Converts a 32-bit integer into a semantic versioning (SemVer) compatible string.\n * @param  {number} version Numeric version\n * @return {string}   SemVer string\n */\nexport const convertIntToSemVer = (version: number): string => {\n    // Works by shifting the numeric version to the right and then masking it\n    // with 0b1111111111 (or 1023 in decimal).\n    // eslint-disable-next-line no-mixed-operators\n    return `${version & 1023}.${version >> 10 & 1023}.${version >> 20 & 1023}`;\n};\n","import { Apparel } from 'definitions/items/apparel';\nimport { QuestItem } from 'definitions/items/questItems';\nimport { Item } from 'definitions/items/types';\nimport { Weapon } from 'definitions/items/weapons';\n\nexport enum StructureState {\n    NotBuilt,\n    Building,\n    Built,\n}\n\nexport interface StructureStoreState {\n    level: number;\n    workers: number;\n    state: StructureState;\n}\n\nexport type ProducableItem = Weapon | Apparel | QuestItem;\nexport interface ProductionStructureStoreState extends StructureStoreState {\n    produces: ProducableItem[];\n}\n\nexport interface ResourceStructureState extends StructureStoreState {\n    harvest?: Item[]; // Items currently available for harvest at this structure\n}\n","import { clearCombatAction, moveActor } from \"store/actions/combat\";\nimport { Store } from \"redux\";\nimport { StoreState } from \"store/types\";\nimport { Allegiance, CombatAction, CombatActionType } from \"store/types/combat\";\n\nexport interface CombatUpdate  {\n    // todo: maybe this is not needed\n    action: CombatAction | null;\n}\n\nconst updateCombat = (delta: number, store: Store<StoreState>): CombatUpdate | null => {\n    const state = store.getState();\n    const combat = state.combat;\n    if (combat.action) {\n        const action = combat.action;\n        if (action.endsAt < Date.now()) {\n            if (combat.turn === Allegiance.enemy) {\n                /* if (apLeft(enemy))\n                determine next action\n                else\n                players turn now\n                */\n            } else if (combat.turn === Allegiance.player) {\n                switch (combat.action.type) {\n                    case CombatActionType.move:\n                        store.dispatch(moveActor(combat.action.actor, combat.action.target));\n                        store.dispatch(clearCombatAction());\n                        break;\n                    default:\n                        break;\n                }\n                return {\n                    action: null,\n                };\n            }\n        }\n    }\n    return null;\n};\n\nexport default updateCombat;\n","import * as PIXI from 'pixi.js';\n// Adapted from https://github.com/explooosion/hitarea-shapes/blob/master/src/index.js\n\nexport default class HitAreaShapes {\n    public shapes: PIXI.Polygon[];\n\n    constructor(shapes: { [key: string]: { shape: number[]}[] } = {}, sprite = \"0\") {\n      \n      this.shapes = shapes[sprite].map((definition: { shape: number[]; }) => {\n        const shape: number[] = definition.shape;\n        return new PIXI.Polygon(shape);\n      });\n    }\n    \n    /**\n     * Called by hitArea\n     * @param {number} x\n     * @param {number} y\n     */\n    contains(x = 0, y = 0) {\n      return (!this.shapes || this.shapes.length === 0)\n      ? false\n      : this.shapes.some(shape => shape.contains(x, y));\n    }\n}\n","import React, { useState, useEffect } from 'react';\nimport { Structure } from 'definitions/structures';\nimport { Sprite, useApp, useTick } from '@inlet/react-pixi';\nimport HitAreaShapes from 'utils/hitAreaShapes';\nimport { STRUCTURE_HIGHLIGHT_FILTER } from 'components/town/TownView';\nimport { loadResource } from 'utils/pixiJs';\nimport { Point, Texture } from 'pixi.js';\n\nconst BLADE_ROTATION_SPEED = 0.01;\n\nexport interface Props {\n    onStructureClick: (structure: Structure | null) => void;\n    position: Point;\n    selected?: boolean;\n    hitAreaShapes: HitAreaShapes;\n}\n\nconst LumberMill = (props: Props) => {\n    const {hitAreaShapes} = props;\n    const structure: Structure = \"lumberMill\";\n    const atlas = `${process.env.PUBLIC_URL}/img/town/town-alpha/${structure}.json`;\n    const [textures, setTextures] = useState<{[name: string]: Texture}>();\n    const filters = props.selected ? [STRUCTURE_HIGHLIGHT_FILTER] : [];\n\n    const app = useApp();\n\n    useEffect(() => {\n        loadResource(atlas, (resource) => {\n            if (resource) {\n                setTextures(resource.textures);\n            }\n        })\n    }, [app, app.loader, atlas]);\n\n    const [rotation, setRotation] = useState(0);\n    useTick((delta:number | undefined) => setRotation(r => r + (BLADE_ROTATION_SPEED * (delta ?? 0))));\n\n\n    if (!textures) return null;\n    return (\n        <Sprite\n            name={structure}\n            position={props.position}\n            interactive={true}\n            buttonMode={true}\n            pointertap={() => {\n                props.onStructureClick(structure);\n            }}\n            // hitArea={hitAreaShapes}\n            filters={filters}\n            texture={textures[\"structure.png\"]}\n        >\n            <Sprite\n                name=\"blades\"\n                texture={textures[\"blades.png\"]}\n                anchor={new Point(0.5, 0.5)}\n                x={15}\n                y={10}\n                rotation={rotation}\n            />\n        </Sprite>\n    )\n}\n\nexport default LumberMill;","import { PixiComponent, applyDefaultProps, Container } from \"@inlet/react-pixi\";\nimport * as PIXI  from 'pixi.js';\nimport * as particles from 'pixi-particles';\n\ninterface Props  {\n    image: string;\n    config: particles.OldEmitterConfig | particles.EmitterConfig;\n}\n\ninterface InternalParticleEmitter {\n  _emitter: particles.Emitter;\n  _raf: number;\n}\n\nconst ParticleEmitter = PixiComponent<Props & React.ComponentProps<typeof Container>, PIXI.ParticleContainer>(\"ParticleEmitter\", {\n    create() {\n      return new PIXI.ParticleContainer(256, {});\n    },\n\n    applyProps(instance, oldProps: Props, newProps: Props) {\n      const { image, config, ...newP } = newProps;\n\n      // apply rest props to PIXI.ParticleContainer\n      applyDefaultProps(instance, oldProps, newP);\n\n      let emitter = (this as unknown as InternalParticleEmitter)._emitter;\n      if (!emitter) {\n        emitter = new particles.Emitter(\n          instance,\n          [PIXI.Texture.from(image)],\n          config\n        );\n\n        let elapsed = performance.now();\n\n        const tick = () => {\n          (this as unknown as InternalParticleEmitter)._raf = requestAnimationFrame(tick);\n          const now = performance.now();\n          // const amp = Math.random() * 5 + 15;\n          // const amp = 15;\n          // const freq = 0.0015;\n          // emitter.acceleration.x = (Math.sin((elapsed * freq)) * amp) + 15;\n\n          emitter.update((now - elapsed) * 0.0003);\n\n          elapsed = now;\n        };\n        emitter.emit = true;\n        // emitter.update(00.2);\n\n        tick();\n      }\n      (this as unknown as InternalParticleEmitter)._emitter = emitter;\n    },\n\n    willUnmount() {\n      if ((this as unknown as InternalParticleEmitter)._emitter) {\n        (this as unknown as InternalParticleEmitter)._emitter.emit = false;\n        cancelAnimationFrame((this as unknown as InternalParticleEmitter)._raf);\n      }\n    }\n});\n\nexport default ParticleEmitter;","import React from \"react\";\nimport { Sprite, Container } from '@inlet/react-pixi';\nimport { Structure } from 'definitions/structures';\nimport HitAreaShapes from 'utils/hitAreaShapes';\nimport smoke from './smoke.json';\nimport ParticleEmitter from 'components/pixi/ParticleEmitter';\nimport { STRUCTURE_HIGHLIGHT_FILTER } from 'components/town/TownView';\nimport { Point } from \"pixi.js\";\n\nexport interface Props {\n    onStructureClick: (structure: Structure | null) => void;\n    position: Point;\n    selected?: boolean;\n    hitAreaShapes: HitAreaShapes;\n}\n\nconst Tavern = (props: Props) => {\n    const {hitAreaShapes, position} = props;\n    const structure: Structure = \"tavern\";\n    const filters = props.selected ? [STRUCTURE_HIGHLIGHT_FILTER] : [];\n\n    return (\n        <Container position={position}>\n            <Sprite\n                name={structure}\n                interactive={true}\n                buttonMode={true}\n                pointertap={() => {\n                    props.onStructureClick(structure);\n                }}\n                filters={filters}\n                hitArea={hitAreaShapes}\n                image={`${process.env.PUBLIC_URL}/img/town/town-alpha/${structure}.png`}\n            />\n            <ParticleEmitter\n                name=\"smoke\"\n                x={107}\n                y={-2}\n                image={`${process.env.PUBLIC_URL}/img/town/effects/smokeparticle.png`}\n                config={smoke}\n            />\n        </Container>\n    )\n}\nexport default Tavern;","import { AppContext } from \"components/App\";\nimport * as React from \"react\";\nimport { Component, ComponentType } from 'react';\n\n// Sharing context within the entire App\nexport interface AppContextProps {\n    onOpenWindow: (window: React.ReactElement) => void;\n    onCloseWindow: () => void;\n}\n\nexport const withAppContext = <TWrappedComponentProps extends AppContextProps>(WrappedComponent: ComponentType<TWrappedComponentProps>) => {\n    type WrappedComponentPropsExceptProvided = Exclude<keyof TWrappedComponentProps, keyof AppContextProps>;\n    type ForwardedProps = Pick<TWrappedComponentProps, WrappedComponentPropsExceptProvided>;\n    return class WithContext extends Component<ForwardedProps> {\n        public render() {\n            return (\n                <AppContext.Consumer>\n                    {(context: any) => <WrappedComponent {...this.props } {...context} />}\n                </AppContext.Consumer>\n            );\n        }\n    };\n};\n","import React from 'react';\nimport { Structure } from 'definitions/structures';\nimport { Sprite } from '@inlet/react-pixi';\nimport HitAreaShapes from 'utils/hitAreaShapes';\nimport { STRUCTURE_HIGHLIGHT_FILTER } from 'components/town/TownView';\nimport { Point } from 'pixi.js';\n\nexport interface Props {\n    onStructureClick: (structure: Structure | null) => void;\n    position: Point;\n    selected?: boolean;\n    structure: Structure;\n    hitAreaShapes: HitAreaShapes;\n}\n\nconst Generic = (props: Props) => {\n    const {structure, position, hitAreaShapes, selected, onStructureClick} = props;\n    const filters = selected ? [STRUCTURE_HIGHLIGHT_FILTER] : [];\n\n    const handlePointerTap = () => {\n        onStructureClick(structure);\n    };\n\n    return (\n        <Sprite\n            name={structure}\n            position={position}\n            interactive={true}\n            buttonMode={true}\n            pointertap={handlePointerTap}\n            hitArea={hitAreaShapes}\n            filters={filters}\n            image={`${process.env.PUBLIC_URL}/img/town/town-alpha/${structure}.png`}\n        >\n            {/* <Graphics\n                name=\"hitarea\"\n                draw={graphics => {\n                    graphics.beginFill(0xffffff);\n                    hitAreaShapes.shapes.map(shape => graphics.drawPolygon(shape))\n                    graphics.endFill();\n                }}\n            /> */}\n        </Sprite>\n    );\n}\nexport default Generic;","import React from \"react\";\nimport { StructuresStoreState } from 'store/types/structures';\nimport { Structure } from 'definitions/structures';\nimport { StructureStoreState, StructureState } from 'store/types/structure';\nimport { Link } from 'react-router-dom';\nimport { getStructureLink, getTownLink } from 'utils/routing';\nimport { TextManager } from 'global/TextManager';\nimport { useRouteMatch } from 'react-router';\nimport \"./styles/legenda.scss\";\n\ninterface Props {\n    structures: StructuresStoreState;\n}\n\n// Legenda with clickable names of structures\nconst Legenda = (props: Props) => {\n    const {structures} = props;\n    const orderedStructures: Structure[] = [\n        \"workshop\",\n        \"quarry\",\n        \"tavern\",\n        \"tannery\",\n        \"alchemist\",\n        \"garden\",\n        \"weaponsmith\",\n        \"armoursmith\",\n        \"warehouse\",\n        \"mine\",\n        \"lumberMill\",\n        \"weaver\",\n    ];\n    const match = useRouteMatch<{structure: Structure}>(`${getTownLink()}/:structure`);\n\n    const renderText = (structure: Structure) => {\n        if (match?.params.structure === structure) {\n            return (\n                <span className=\"highlighted\">{`${TextManager.getStructureName(structure)}`}</span>\n            )\n        }\n        return (\n            <Link to={getStructureLink(structure, true)} >\n                {`${TextManager.getStructureName(structure)}`}\n            </Link>\n        )\n    }\n\n    return (\n        <div className=\"legenda\">\n            <ul>\n            {orderedStructures.map((structure) => {\n                const structureStore: StructureStoreState = structures[structure];\n                if (structureStore.state === StructureState.NotBuilt) {\n                    return null;\n                }\n                return (\n                    <li key={structure}>\n                        {renderText(structure)}\n                    </li>\n                );\n            })}\n            </ul>\n        </div>\n    );\n}\n\nexport default Legenda;","import React, { forwardRef, PropsWithChildren } from \"react\";\nimport { Viewport as PixiViewport } from \"pixi-viewport\";\nimport { PixiComponent, useApp } from \"@inlet/react-pixi\";\nimport gauntlet from \"components/App/styles/img/cursors/dwarven_gauntlet_extra_6.png\";\nimport { Application, InteractionEvent } from \"pixi.js\";\n\ninterface Props {\n  onClick?(event: InteractionEvent): void;\n  screenWidth: number,\n  screenHeight: number,\n  worldWidth: number,\n  worldHeight: number,\n  minScale?: number;\n  maxScale?: number;\n}\n\n/** Viewport leverages pixi-viewport to create a pannable map\n * https://davidfig.github.io/pixi-viewport/jsdoc/\n */\nconst Viewport = forwardRef<PixiViewport, PropsWithChildren<Props>>((props, ref) => {\n  const app = useApp();\n  if (app) {\n      // Perhaps this is better moved somewhere else\n      const cursor = `url('${gauntlet}'), auto`;\n      app.renderer.plugins.interaction.cursorStyles.pointer = cursor;\n  }\n  return <PixiComponentViewport app={app} {...props} ref={ref} />;\n})\nViewport.displayName = 'DisplayName';\n\ninterface PixiComponentProps {\n    app: Application;\n}\n\nconst PixiComponentViewport = PixiComponent(\"Viewport\", {\n  create: (props: PixiComponentProps & Props) => {\n    const viewport = new PixiViewport({\n      screenWidth: props.screenWidth,\n      screenHeight: props.screenHeight,\n      worldWidth: props.worldWidth,\n      worldHeight: props.worldHeight,\n      ticker: props.app.ticker,\n      interaction: props.app.renderer.plugins.interaction,\n      // the interaction module is important for wheel to work properly when renderer.view is placed or scaled\n    });\n    viewport.on(\"clicked\", (event) => { if(props.onClick) props.onClick(event) });\n\n    const {\n      minScale = 1,\n      maxScale = 2\n    } = props;\n\n    viewport\n      .drag()\n      .pinch()\n      .wheel()\n      .clamp({ direction: 'all' })\n      .clampZoom({ minScale, maxScale })\n      .decelerate();\n\n    return viewport as unknown as PixiViewport;\n  }\n});\nexport default Viewport;\n","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAgCAYAAAABtRhCAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAB3RJTUUH3gMODzc3YHmYGgAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAE50lEQVRIx7WXW0wcVRjHfzO7y16YZbfAytACvbjU1hqkLVZMbbSXBEPUNjX6YDYanwYfTXzxrb7qm0lTJ018QhOjaWI0trFYbRoqpYVuwy2UpRS2lAF22YUdtuxt1ofKCIXShaZfMjm37+Q33zn/cxMURWHRVFXNAyiKIvCMTFwKO6Ne4ONPTpngZwoE6Lx6FYCDhwLPDLoMeKPtV8b6ewkEAssiVVU1v/gtLS+dhnUDFUUResZvUhLXuNF+ZVmkBw8F6B+4b5avXR8x82fUC+uCWhoaGsxCV1fXKZelGOvMNPcXspw9+zV60s3MzAweTwXJZBLJXYXPt8XMJ5NJbgX/pqGh4ctCgNalBUVRhId/u5tsQqf9UpDGxkZCoRCtra2mX2trK5qmAZhpoWZdrTIvCOyQihn8/RydsQSVm6uQJAnZ6zV9MjYbkUgEAL/fj6p+my9kOYmPViiKIgQn+8mLIv1jowSONtN0+OgyGEAkEkHXdTRNQ5Kkjal0qY3MJciLIsdOvslYXy9xbXxZu67rAEiSZOafCtgzfpM8Al2/deDEwJZOrYAu2lNFqKpq/rPjLTTtbWY0Psu1jovUVm7Hmk1jS6eYmXooEiH//0pYj3BWFc2RukM4HpxHMAz6x0aRvT1scfsYT0yTTwnEtXEsuQzxhbQ5j08F/O7H0+zz+ThQWsK52yGuBNs5XPcqllwOVzrOjv2HsZaXsuv1OtySnYSeort7kE+Vt56o1FWBo7EollwGQ7Sww13McHyWbE8n9VVVNLzWzMDkXSYGujl/uY1wNIamaciybO4+a0FXXRbd04P8PHydu/EYtmwaSy7NaCzOi0eO09F5kfk7/bhSSZ4T8zQ2NiLLMgCyLPPe+5+vudWtqlJFUYRF8MhsHNHIcXKnn86rfxK8P4Etk8G5kKR4YZ758F1OnDixrP9aUHGt8V6ExlMLbLP7GBoeAkGkxuWhKJfFlUoiJRNE7o0TCARM8UiS9NgjTnySqhRFEUZmR/jm5l9YsynGolG0RJQqpwd7OoU0P0dqZJD0TJyWlhZzU/D7/Txfe2wFVCxUzttLPNyaGEc0svx0+zZVW/cD4Eo/wJuIkevtwZiKLhteWZZXQAsGdk9PscluRzByODxlnL78Aw17mpDdZdizGUr0GNEbndRvKeeD5rcpLy83oRWVjeuLUFEUYTQ+jMfpwutw4CgpJVmzm6/++QVDtFDpLkU0DLxzUabbB6ir9vHGtp3mxi5JkhmluJ6zzONw/pfaMUSR0HyaL6530zYRBmBz7QFqj9YhSQ5efsXPQjxS2MJ/nJUUS8zEZ/G4nPSEQgyHLj08kCehtQuqy66w94/vEfIGNaVliEYGr6No40AAj9OBkDcYHmpb0RaO9hGO9lFdtodubQqAovQCG1IpgGgYlNlsbCqyrekXjvaZ+SlD3Dgwoc9hyWU4WP1SQf6lNbXouo6u6+ZtvmCgoihCcErDks2QCA3w4YF3ngjz+/1omsbkRMfG5nBkdoQ7bjeEe9hVVsZHe5u4FB7nXqTX9Kmvf5eKys3IskwwGGR4qG3ZW0VY+pgpxFRVze/zvcBWbylep5OMzY5hsVLsLiFd5MTqq+DedJRQKLQCtiHg0uv91k21uF1uPE4XhsVC1monlsqSmE8yOdGx6itsQ8BHwavN9+P6/Avf+1eTf20QhwAAAABJRU5ErkJggg==\"","\nimport React, { useRef, useEffect, PropsWithChildren, forwardRef, useImperativeHandle } from \"react\";\nimport { Sprite, Stage } from '@inlet/react-pixi';\nimport { Viewport as PixiViewport} from 'pixi-viewport';\nimport Viewport from 'components/pixi/Viewport';\nimport { gsap } from 'gsap';\nimport { GodrayFilter } from \"@pixi/filter-godray\";\n\nexport interface Props {\n    screenWidth: number;\n    screenHeight: number;\n    worldWidth: number;\n    worldHeight: number;\n}\n\n\nconst TownStage = forwardRef<PixiViewport, PropsWithChildren<Props>>((props: PropsWithChildren<Props>, ref: React.Ref<PixiViewport>) => {\n    const {\n        children,\n        screenWidth,\n        screenHeight,\n        worldWidth,\n        worldHeight\n    } = props;\n\n    const innerRef = useRef<PixiViewport>(null);\n\n    useImperativeHandle(ref, () => {\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        return innerRef.current!\n    });\n\n\n    useEffect(() => {\n        godray.enabled = false;\n        if(innerRef.current) {\n\n            const viewport = innerRef.current;\n            viewport.on(\"moved\", () => {\n                const horizontalFactor = gsap.utils.normalize(viewport.screenWidth, worldWidth, viewport.right);\n                const verticalFactor = gsap.utils.normalize(worldHeight, viewport.screenHeight, viewport.bottom);\n                const factor = Math.max(horizontalFactor * verticalFactor - .4, 0);\n\n                godray.gain =  factor;\n                godray.lacunarity = 2.4;\n                godray.enabled = godray.gain > 0;\n            })\n        }\n\n        const onScroll = (e: WheelEvent) => {\n            // Scrolling the mouse is just used for zoom, not for actual scrolling\n            e.preventDefault();\n        }\n        window.addEventListener(\"wheel\", onScroll, {passive: false});\n        return () => {\n            window.removeEventListener(\"wheel\", onScroll);\n        };\n    }, [worldHeight, worldWidth]);\n\n    return (\n        <Stage width={screenWidth} height={screenHeight} options={options} >\n            <Viewport\n                screenWidth={screenWidth}\n                screenHeight={screenHeight}\n                worldWidth={worldWidth}\n                worldHeight={worldHeight}\n                ref={innerRef}>\n                <Sprite\n                    name=\"background\"\n                    image={`${process.env.PUBLIC_URL}/img/town/town-alpha/background.png`}\n                    filters={[godray]}\n                >\n                    {children}\n                </Sprite>\n            </Viewport>\n        </Stage>\n\n    )\n});\nTownStage.displayName = \"TownStage\";\n\nexport default TownStage;\n\nconst options = {\n    autoDensity: true,\n    sharedLoader: true\n}\n\nexport const godray = new GodrayFilter();\n","import { Item } from \"definitions/items/types\";\nimport { ResourceStoreState } from \"store/types/resources\";\nimport { ProducableItem } from \"store/types/structure\";\nimport { CostStoreState } from \"../production/types\";\n\nexport enum StructureType {\n    resource,\n    production,\n    tavern,\n    warehouse,\n}\n\nexport interface StructureDefinition {\n    type: StructureType;\n    cost: CostStoreState;\n    levels: StructureLevelDefinition[];\n}\n\nexport interface StructureLevelDefinition {\n    displayName: string;          // At this moment we can potentially support different names depending on the level\n                                  // of the structure. But this is not implemented because I feel it can cause confusion\n                                  // todo: REMOVE\n    cost: CostStoreState;         // in gold\n    workerCapacity: number;       // number of workers that can work at this structure at this level\n}\n\nexport interface ResourceStructureDefinition extends StructureDefinition {\n    levels: ResourceStructureLevelDefinition[];\n}\n\ninterface HarvestDefinition {\n    amount: number;\n    lootTable: {[key in Item]?: number};\n}\n\nexport interface ResourceStructureLevelDefinition extends StructureLevelDefinition {\n    generates: ResourceStoreState;\n    harvest?: HarvestDefinition;\n}\n\nexport interface ProductionStructureDefinition extends StructureDefinition {\n    levels: ProductionStructureLevelDefinition[];\n}\n\nexport interface ProductionStructureLevelDefinition extends StructureLevelDefinition {\n    unlocks: ProducableItem[];\n}\n\nexport interface WarehouseStructureDefinition extends StructureDefinition {\n    levels: WarehouseStructureLevelDefinition[];\n}\n\nexport interface WarehouseStructureLevelDefinition extends StructureLevelDefinition {\n    maxResources: ResourceStoreState;\n    maxStockpile: number;\n}\n\nexport interface TavernStructureDefinition extends StructureDefinition {\n    levels: TavernStructureLevelDefinition[];\n}\n\nexport interface TavernStructureLevelDefinition extends StructureLevelDefinition {\n    rooms: number;\n}\n","import { Sprite, useTick } from '@inlet/react-pixi';\nimport React, { useState } from 'react';\n\ninterface Props {\n    worldWidth: number;\n    speed?: number;\n}\n\nconst Clouds = (props: Props) => {\n    const { speed = 1 } = props;\n    const [cloud, setCloud] = useState(randomCloud());\n    const image = `${process.env.PUBLIC_URL}/img/town/clouds/cloud-0${cloud}.png`;\n    const [x, setX] = useState(-2000);\n    const [y, setY] = useState(randomY());\n\n    useTick((delta:number | undefined) => {\n        if (x > props.worldWidth){\n            setX(2000 - Math.random() * 1000);\n            setY(randomY());\n            setCloud(randomCloud());\n        } else {\n            setX(x + speed * (delta || 1));\n        }\n    });\n\n    return (\n        <Sprite\n            // name={`cloud ${cloud}`}\n            image={image}\n            alpha={0.8}\n            x={x}\n            y={y}\n        />\n    );\n}\n\nexport default Clouds;\n\nconst randomCloud = () => Math.floor(Math.random() * 2) + 1;\nconst randomY = () => Math.random() * -300 - 200;","import { ONE_MINUTE, TWO_MINUTES } from 'utils/format/time';\nimport { ProductionStructureDefinition, StructureType } from \"./types\";\n\nconst alchemist: ProductionStructureDefinition = {\n    type: StructureType.production,\n    cost: {\n        gold: 40,\n        time: 4000,\n    },\n    levels: [{\n        displayName: \"structure-alchemist-name\",\n        // level 1:\n        workerCapacity: 2,\n        cost: {\n            gold: 0,\n        },\n        unlocks: [],\n    }, {\n        // level 2:\n        displayName: \"structure-alchemist-name\",\n        workerCapacity: 5,\n        cost: {\n            gold: 30,\n            resources: {\n                wood: 100,\n                iron: 100,\n                stone: 100\n            },\n            time: ONE_MINUTE\n        },\n        unlocks: [],\n    }, {\n        // level 3:\n        displayName: \"structure-alchemist-name\",\n        workerCapacity: 10,\n        cost: {\n             gold: 50,\n             time: TWO_MINUTES\n        },\n        unlocks: [],\n    }],\n};\n\nexport default alchemist;\n","export enum Resource {\n    wood = \"wood\",\n    iron = \"iron\",\n    stone = \"stone\",\n    leather = \"leather\",\n    fabric = \"fabric\",\n    food = \"food\",\n}\n\n\nexport interface ResourceDefinition {\n    resource: Resource;\n    iconImg: string;\n}\n\nconst all = {\n    [Resource.wood]: {\n        resource: Resource.wood,\n        iconImg: \"/img/resources/wood.png\",\n    },\n    [Resource.iron]: {\n        resource: Resource.iron,\n        iconImg: \"/img/resources/iron.png\",\n    },\n    [Resource.stone]: {\n        resource: Resource.stone,\n        iconImg: \"/img/resources/stone.png\",\n    },\n    [Resource.leather]: {\n        resource: Resource.leather,\n        iconImg: \"/img/resources/leather.png\",\n    },\n    [Resource.fabric]: {\n        resource: Resource.fabric,\n        iconImg: \"/img/resources/fabric.png\",\n    },\n    [Resource.food]: {\n        resource: Resource.food,\n        iconImg: \"/img/resources/food.png\",\n    },\n};\n\nexport default all;","import { ProductionStructureDefinition, StructureType } from \"./types\";\nimport { ONE_MINUTE, TWO_MINUTES } from 'utils/format/time';\n\nconst armoursmith: ProductionStructureDefinition = {\n    cost: {\n        gold: 40,\n        time: 4000,\n    },\n    type: StructureType.production,\n    levels: [{\n        // level 1:\n        displayName: \"structure-armoursmith-name\",\n        workerCapacity: 2,\n        cost: {\n            gold: 0,\n        },\n        unlocks: [\"apparel/boots1\" ],\n    }, {\n        // level 2:\n        displayName: \"structure-armoursmith-name\",\n        workerCapacity: 5,\n        cost: {\n            gold: 30,\n            resources: {\n                wood: 100,\n                iron: 100,\n                stone: 100\n            },\n            time: ONE_MINUTE\n        },\n        unlocks: [\"apparel/chest\" ],\n    }, {\n        // level 3:\n        displayName: \"structure-armoursmith-name\",\n        workerCapacity: 10,\n        cost: {\n            gold: 50,\n            time: TWO_MINUTES\n        },\n        unlocks: [\"apparel/cowl\"],\n    }],\n};\nexport default armoursmith;\n","import { ONE_MINUTE, TWO_MINUTES } from 'utils/format/time';\nimport { ResourceStructureDefinition, StructureType } from \"./types\";\n\nconst garden: ResourceStructureDefinition = {\n    type: StructureType.resource,\n    cost: {\n        gold: 40,\n        time: 4000,\n    },\n    levels: [{\n        displayName: \"structure-garden-name\",\n        // level 1:\n        workerCapacity: 2,\n        cost: {\n            gold: 0,\n        },\n        generates: { food: 2 },\n        harvest: {\n            amount: 3,\n            lootTable: {\n                \"herb/bogroot\": 2,\n                \"herb/winterWeed\": 1\n            }\n        }\n    }, {\n        displayName: \"structure-garden-name\",\n        // level 2:\n        workerCapacity: 5,\n        cost: {\n            gold: 30,\n            resources: {\n                wood: 100,\n                iron: 100,\n                stone: 100\n            },\n            time: ONE_MINUTE\n        },\n        generates: { food: 4 },\n        harvest: {\n            amount: 5,\n            lootTable: {\n                \"herb/bogroot\": 2,\n                \"herb/winterWeed\": 1,\n                \"herb/hyacinthus\": 1, \n                \"herb/bloodLotus\": 1, \n            }\n        }\n    }, {\n        // level 3:\n        displayName: \"structure-garden-name\",\n        workerCapacity: 10,\n        cost: {\n            gold: 50,\n            time: TWO_MINUTES\n        },\n        generates: { food: 8 },\n    }],\n};\n\nexport default garden;\n","import { ResourceStructureDefinition, StructureType } from \"./types\";\nimport { HALF_HOUR, ONE_MINUTE, TWO_MINUTES } from 'utils/format/time';\n\nconst lumberMill: ResourceStructureDefinition = {\n    type: StructureType.resource,\n    cost: {\n        gold: 31,\n        time: HALF_HOUR,\n    },\n    levels: [{\n        // level 0:\n        displayName: \"structure-lumber-mill-name\",\n        workerCapacity: 2,\n        cost: {\n            gold: 0,\n        },\n        generates: { wood: 2 },\n    }, {\n        // level 1:\n        displayName: \"structure-lumber-mill-name\",\n        workerCapacity: 5,\n        cost: {\n            gold: 30,\n            resources: {\n                wood: 100,\n                iron: 100,\n                stone: 100\n            },\n            time: ONE_MINUTE\n        },\n        generates: { wood: 2 },\n    }, {\n        // level 2:\n        displayName: \"structure-lumber-mill-name\",\n        workerCapacity: 10,\n        cost: {\n            gold: 50,\n            time: TWO_MINUTES\n        },\n        generates: { wood: 2 },\n    }],\n};\n\nexport default lumberMill;\n","import { ONE_MINUTE, TWO_MINUTES } from 'utils/format/time';\nimport { ResourceStructureDefinition, StructureType } from \"./types\";\n\nconst mine: ResourceStructureDefinition = {\n    cost: {\n        gold: 40,\n        time: 4000,\n    },\n    type: StructureType.resource,\n    levels: [{\n        displayName: \"structure-mine-name\",\n        // level 0:\n        workerCapacity: 2,\n        cost: {\n            gold: 0,\n        },\n        generates: { iron: 2 },     \n        harvest: {\n            amount: 3,\n            lootTable: {\n                \"mineral/roseQuartz\": 2,\n                \"mineral/topaz\": 1\n            }\n        }\n    }, {\n        displayName: \"structure-mine-name\",\n        // level 1:\n        workerCapacity: 5,\n        cost: {\n            gold: 30,\n            resources: {\n                wood: 100,\n                iron: 100,\n                stone: 100\n            },\n            time: ONE_MINUTE\n        },\n        generates: { iron: 2 },\n        harvest: {\n            amount: 5,\n            lootTable: {\n                \"mineral/roseQuartz\": 2,\n                \"mineral/topaz\": 2,\n                \"mineral/jasper\": 1,\n                \"mineral/greenOpal\": 1,\n            }\n        }\n    }, {\n        displayName: \"structure-mine-name\",\n        // level 2:\n        workerCapacity: 10,\n        cost: {\n            gold: 50,\n            time: TWO_MINUTES\n        },\n        generates: { iron: 2 },\n        harvest: {\n            amount: 5,\n            lootTable: {\n                \"mineral/roseQuartz\": 1,\n                \"mineral/topaz\": 1,\n                \"mineral/jasper\": 1,\n                \"mineral/greenOpal\": 1,\n                \"mineral/malachite\": 1,\n                \"mineral/tigersEye\": 1,\n            }\n        }\n    }],\n};\nexport default mine;\n","import { ONE_MINUTE, TWO_MINUTES } from 'utils/format/time';\nimport { ResourceStructureDefinition, StructureType } from \"./types\";\n\nconst quarry: ResourceStructureDefinition = {\n    cost: {\n        gold: 40,\n        time: 4000,\n    },\n    type: StructureType.resource,\n    levels: [{\n        displayName: \"structure-quarry-name\",\n        // level 1:\n        workerCapacity: 2,\n        cost: {\n            gold: 0,\n        },\n        generates: { stone: 2 },\n    }, {\n        // level 2:\n        displayName: \"structure-quarry-name\",\n        workerCapacity: 5,\n        cost: {\n            gold: 30,\n            resources: {\n                wood: 100,\n                iron: 100,\n                stone: 100\n            },\n            time: ONE_MINUTE\n        },\n        generates: { stone: 4 },\n    }, {\n        // level 3:\n        displayName: \"structure-quarry-name\",\n        workerCapacity: 10,\n        cost: {\n            gold: 50,\n            time: TWO_MINUTES\n        },\n        generates: { stone: 6 },\n    }],\n};\n\nexport default quarry;\n","import { ONE_MINUTE, TWO_MINUTES } from 'utils/format/time';\nimport { ResourceStructureDefinition, StructureType } from \"./types\";\n\nconst tannery: ResourceStructureDefinition = {\n    cost: {\n        gold: 40,\n        time: 4000,\n    },\n    type: StructureType.resource,\n    levels: [{\n        displayName: \"structure-tannery-name\",\n        // level 1:\n        workerCapacity: 2,\n        cost: {\n            gold: 0,\n        },\n        generates: { leather: 2 },\n    }, {\n        // level 2:\n        displayName: \"structure-tannery-name\",\n        workerCapacity: 5,\n        cost: {\n            gold: 30,\n            resources: {\n                wood: 100,\n                iron: 100,\n                stone: 100\n            },\n            time: ONE_MINUTE\n        },\n        generates: { leather: 5 },\n    }, {\n        // level 3:\n        displayName: \"structure-tannery-name\",\n        workerCapacity: 10,\n        cost: {\n            gold: 50,\n            time: TWO_MINUTES\n        },\n        generates: { leather: 7 },\n    }],\n};\n\nexport default tannery;\n","import { ONE_MINUTE, TWO_MINUTES } from 'utils/format/time';\nimport { StructureType, TavernStructureDefinition } from \"./types\";\n\nconst tavern: TavernStructureDefinition = {\n    cost: {\n        gold: 40,\n        time: 4000,\n    },\n    type: StructureType.tavern,\n    levels: [{\n        displayName: \"structure-tavern-name\",\n        // level 1:\n        workerCapacity: 2,\n        cost: {\n             gold: 0,\n        },\n        rooms: 10,\n    }, {\n        // level 2:\n        displayName: \"structure-tavern-name\",\n        workerCapacity: 5,\n        cost: {\n            gold: 30,\n            resources: {\n                wood: 100,\n                iron: 100,\n                stone: 100\n            },\n            time: ONE_MINUTE\n        },\n        rooms: 12,\n    }, {\n        // level 3:\n        displayName: \"structure-tavern-name\",\n        workerCapacity: 10,\n        cost: {\n             gold: 50,\n             time: TWO_MINUTES\n        },\n        rooms: 15,\n    }],\n};\n\nexport default tavern;\n","import { FOUR_MINUTES, TWO_MINUTES } from 'utils/format/time';\nimport {  StructureType, WarehouseStructureDefinition } from \"./types\";\n\nconst warehouse: WarehouseStructureDefinition = {\n    cost: {\n        gold: 40,\n        time: 4000,\n    },\n    type: StructureType.warehouse,\n    levels: [{\n        displayName: \"structure-warehouse-name\",\n        // level 1:\n        workerCapacity: 2,\n        cost: {\n            gold: 0,\n        },\n        maxResources: {\n            fabric: 200,\n            food: 200,\n            iron: 200,\n            leather: 200,\n            stone: 200,\n            wood: 200,\n        },\n        maxStockpile: 16\n    }, {\n        // level 2:\n        displayName: \"structure-warehouse-name\",\n        workerCapacity: 5,\n        cost: {\n            gold: 13,\n            resources: {\n                wood: 100,\n                iron: 100,\n                stone: 100\n            },\n            time: FOUR_MINUTES\n        },\n        maxResources: {\n            fabric: 500,\n            food: 500,\n            iron: 500,\n            leather: 500,\n            stone: 500,\n            wood: 500,\n        },\n        maxStockpile: 32\n    }, {\n        // level 3:\n        displayName: \"structure-warehouse-name\",\n        workerCapacity: 10,\n        cost: {\n            gold: 50,\n            resources: {\n                wood: 200,\n                iron: 200,\n                stone: 200\n            },\n            time: TWO_MINUTES * 5\n        },\n        maxResources: {\n            fabric: 1000,\n            food: 1000,\n            iron: 1000,\n            leather: 1000,\n            stone: 1000,\n            wood: 1000,\n        },\n        maxStockpile: 48\n    }],\n};\n\nexport default warehouse;\n","import { ProductionStructureDefinition, StructureType } from \"./types\";\nimport { ONE_MINUTE, THREE_MINUTES, TWO_MINUTES } from 'utils/format/time';\n\nconst weaponsmith: ProductionStructureDefinition = {\n    type: StructureType.production,\n    cost: {\n        gold: 40,\n        time: 4000,\n    },\n    levels: [{\n        // level 1:\n        displayName: \"structure-weaponsmith-name\",\n        workerCapacity: 2,\n        cost: {\n            gold: 0,\n        },\n        unlocks: [],\n    }, {\n        // level 2:\n        displayName: \"structure-weaponsmith-name\",\n        workerCapacity: 5,\n        cost: {\n            gold: 30,\n            resources: {\n                wood: 100,\n                iron: 100,\n                stone: 100\n            },\n            time: ONE_MINUTE\n        },\n        unlocks: [],\n    }, {\n        // level 3:\n        displayName: \"structure-weaponsmith-name\",\n        workerCapacity: 10,\n        cost: {\n            gold: 50,\n            time: TWO_MINUTES\n\n        },\n        unlocks: [],\n    }, {\n        // level 4:\n        displayName: \"structure-weaponsmith-name\",\n        workerCapacity: 14,\n        cost: {\n            gold: 50,\n            time: THREE_MINUTES\n        },\n        unlocks: [\"weapon/poisonedDagger\"],\n    }],\n};\nexport default weaponsmith;\n","import { ONE_MINUTE, THREE_MINUTES } from 'utils/format/time';\nimport { ResourceStructureDefinition, StructureType } from \"./types\";\n\nconst weaver: ResourceStructureDefinition = {\n    cost: {\n        gold: 40,\n        time: 4000,\n    },\n    type: StructureType.resource,\n    levels: [{\n        displayName: \"structure-weaver-name\",\n        // level 0:\n        workerCapacity: 2,\n        cost: {\n            gold: 0,\n        },\n        generates: { fabric: 2 },\n    }, {\n        displayName: \"structure-weaver-name\",\n        // level 1:\n        workerCapacity: 5,\n        cost: {\n            gold: 30,\n            resources: {\n                wood: 100,\n                iron: 100,\n                stone: 100\n            },\n            time: ONE_MINUTE\n        },\n        generates: { fabric: 5 },\n    }, {\n        displayName: \"structure-weaver-name\",\n        // level 2:\n        workerCapacity: 10,\n        cost: {\n            gold: 50,\n            time: THREE_MINUTES\n        },\n        generates: { fabric: 7 },\n    }],\n};\n\nexport default weaver;\n","import { ONE_MINUTE, THREE_MINUTES, TWO_MINUTES } from 'utils/format/time';\nimport { ProductionStructureDefinition, StructureType } from \"./types\";\n\nconst workshop: ProductionStructureDefinition = {\n    type: StructureType.production,\n    cost: {\n        gold: 40,\n        time: 4000,\n    },\n    levels: [{\n        // level 1:\n        displayName: \"structure-workshop-name\",\n        workerCapacity: 2,\n        cost: {\n            gold: 0,\n        },\n        unlocks: [ ],\n    }, {\n        // level 2:\n        displayName: \"structure-workshop-name\",\n        workerCapacity: 5,\n        cost: {\n            gold: 30,\n            resources: {\n                wood: 100,\n                iron: 100,\n                stone: 100\n            },\n            time: ONE_MINUTE\n        },\n        unlocks: [],\n    }, {\n        // level 3:\n        displayName: \"structure-workshop-name\",\n        workerCapacity: 10,\n        cost: {\n            gold: 50,\n            time: TWO_MINUTES\n        },\n        unlocks: [],\n    }, {\n        // level 4:\n        displayName: \"structure-workshop-name\",\n        workerCapacity: 14,\n        cost: {\n            gold: 50,\n            time: THREE_MINUTES\n        },\n        unlocks: [],\n    }],\n};\nexport default workshop;\n","import alchemist from \"./alchemist\";\nimport armoursmith from \"./armoursmith\";\nimport garden from \"./garden\";\nimport lumberMill from \"./lumberMill\";\nimport mine from \"./mine\";\nimport quarry from \"./quarry\";\nimport tannery from \"./tannery\";\nimport tavern from \"./tavern\";\nimport { StructureDefinition } from \"./types\";\nimport warehouse from \"./warehouse\";\nimport weaponsmith from \"./weaponsmith\";\nimport weaver from \"./weaver\";\nimport workshop from \"./workshop\";\nimport { Resource } from 'definitions/resources';\n\nexport type Structure = \n    \"alchemist\" |\n    \"armoursmith\" |\n    \"garden\" |\n    \"lumberMill\" |\n    \"mine\" |\n    \"quarry\" |\n    \"tavern\" |\n    \"tannery\" |\n    \"warehouse\" |\n    \"weaponsmith\" |\n    \"weaver\" |\n    \"workshop\";\n\n\nexport type ProductionStructure = \"alchemist\" | \"armoursmith\" | \"weaponsmith\" | \"workshop\";\nexport type ResourceStructure = \"garden\" | \"lumberMill\" | \"mine\" | \"quarry\" | \"tannery\" | \"weaver\";\n\n// Type guard\nexport const isProductionStructure = (structure: Structure): structure is ProductionStructure => {\n    return structure === \"alchemist\" ||\n        structure === \"armoursmith\" ||\n        structure === \"weaponsmith\" ||\n        structure === \"workshop\";\n}\n// Type guard\nexport const isResourceStructure = (structure: Structure): structure is ResourceStructure => {\n    return structure === \"garden\" ||\n        structure === \"lumberMill\" ||\n        structure === \"mine\" ||\n        structure === \"quarry\" ||\n        structure === \"tannery\" ||\n        structure === \"weaver\";\n}\nconst all = {\n    alchemist,\n    armoursmith,\n    garden,\n    lumberMill,\n    mine,\n    quarry,\n    tavern,\n    tannery,\n    warehouse,\n    weaponsmith,\n    weaver,\n    workshop,\n};\n\nexport default all;\n\nexport function getDefinition<T extends StructureDefinition>(structure: Structure): T {\n    return all[structure] as unknown as T;\n}\n\n\n\nexport function getStructureByResource(resource: Resource) : Structure {\n    switch (resource) {\n        case Resource.fabric:\n            return \"weaver\";\n        case Resource.food:\n            return \"garden\";\n        case Resource.iron:\n            return \"mine\";\n        case Resource.leather:\n            return \"tannery\";\n        case Resource.stone:\n            return \"quarry\";\n        case Resource.wood:\n            return \"lumberMill\";\n    }\n}\n","import { useCallback } from 'react';\nimport { StoreState } from 'store/types';\nimport { useSelector } from 'react-redux';\nimport { StructureStoreState } from 'store/types/structure';\nimport { getDefinition, Structure  } from \"definitions/structures\";\nimport { StructureDefinition, StructureLevelDefinition } from 'definitions/structures/types';\n\n// Returns the structure state from redux store\nexport const useStructureState = <T extends StructureStoreState>(structure: Structure): T => {\n    const structureSelector = useCallback(\n        (state: StoreState) => state.structures[structure] as T,\n        [structure]\n    );\n    return useSelector<StoreState, T>(structureSelector);\n}\n\nexport const useStructureDefinition = <T extends StructureDefinition>(structure: Structure): T => {\n    const structureDefinition = getDefinition<T>(structure);\n    if (!structureDefinition) {\n        throw new Error(`No definition found for structure ${structure}.`);\n    }\n    return structureDefinition\n} \n \nexport const useStructureLevel = <T extends StructureLevelDefinition>(structure: Structure): T => {\n    const { level } = useStructureState(structure);\n    const structureDefinition = useStructureDefinition(structure)\n    return structureDefinition.levels[level] as T;\n}","import * as React from \"react\";\nimport { PropsWithChildren } from 'react';\nimport './styles/button.scss';\n\nexport enum ButtonSize {\n    auto, // will select either medium or small, depending on screen size\n    large,\n    medium,\n    small,\n}\n\nexport enum ButtonColor {\n    blue = \"blue\",\n    purple = \"purple\",\n    green = \"green\"\n}\n\nexport type Props = PropsWithChildren<{\n    text?: string;\n    color?: ButtonColor | keyof typeof ButtonColor; // Can use enum or string\n    size?: ButtonSize | keyof typeof ButtonSize; // Can use enum or string\n    className?: string;\n    disabled?: boolean;\n    square?: boolean;\n    onClick?: React.MouseEventHandler<Element>;\n}>\n\n\nconst Button = (props: React.ComponentProps<'button'> & Props) => {\n    const { color, square, text, ...otherProps } = props;\n\n    const handleClick = (e: React.MouseEvent<HTMLButtonElement>) => {\n        props.onClick?.(e)\n    };\n\n    const className = [\n        'button',\n        (props.className ?? \"\"),\n        `button-${typeof color === \"string\" ? color : ButtonColor[color ?? ButtonColor.blue]}`,\n        `button-${typeof props.size === \"string\" ? props.size : ButtonSize[props.size ?? ButtonSize.auto]}`,\n        `${square ? \"button-square\" : ''}`\n    ]\n\n    return (\n        <button\n            {...otherProps}\n            className={className.join(' ')}\n            onClick={handleClick}\n        >\n            <span>\n                {!!text && text}\n                {!text && props.children}\n            </span>\n        </button>\n    );\n};\n\nexport default Button;\n","import React, { useRef } from 'react';\nimport \"./styles/progressbar.scss\";\n\nexport enum Direction {\n    increasing,\n    decreasing\n}\n\nexport interface Props {\n    progress?: number;     // between 0 and 1\n    label?: string;\n    className?: string;\n    direction?: Direction; // only used to prevent the bar from animating back to the start state\n    animationTime?: number;\n}\n\nconst PlainProgressbar = (props: Props) => {\n    const { className = \"\", animationTime } = props;\n    const previousProgress = useRef(0);\n    const progress: number = clamp(props.progress || 0, 0, 1);\n\n    previousProgress.current = progress;\n    return (\n        <div className={`progressbar ${className}`}>\n            <div className=\"progressbar-label\">{props.label}</div>\n            <div className=\"progressbar-bar\" style= {{\n                width: `${progress * 100}%`,\n                ...(animationTime && {transition: `width ${animationTime}ms linear`})\n            }}/>\n        </div>\n    );\n};\n\nexport default PlainProgressbar;\n\nfunction clamp(val: number, min: number, max: number): number {\n    return val > max ? max : val < min ? min : val;\n}\n","import * as React from \"react\";\nimport { SoundManager} from 'global/SoundManager';\nimport Button from '../buttons/Button';\nimport { PropsWithChildren, useEffect } from \"react\";\n\n// todo: refactor using WindowManager [30/03/2020]\nexport interface Props {\n    title: string;\n    backEnabled?: boolean;\n    closeEnabled?: boolean;\n    onClose?: () => void;\n    onBack?: () => void;\n}\n\n/**\n *\n */\nconst Window = (props: PropsWithChildren<Props>) => {\n\n    const handleClose = (_e: React.MouseEvent) => {\n        if (props.onClose) {\n            props?.onClose();\n\n            SoundManager.playSound(\"ui/buttonClick\");\n        }\n    };\n\n    const handleBack = (_e: React.MouseEvent) => {\n        if (props.onBack) {\n            props?.onBack();\n\n            SoundManager.playSound(\"ui/buttonClick\");\n        }\n    };\n\n    useEffect(() => {\n        SoundManager.musicFiltered = true;\n        return () => {\n            SoundManager.musicFiltered = false;\n        }\n    })\n\n    return (\n        <div className=\"window\">\n            <div className=\"header\">\n                { props.backEnabled !== false && (\n                    <Button\n                        className=\"back-button\"\n                        onClick={handleBack}\n                        square={true}\n                        size={\"medium\"}\n                        color=\"purple\"\n                        text=\"<\"\n                    />\n                )}\n                <h3>{ props.title }</h3>\n                { props.closeEnabled !== false && (\n                    <Button\n                        className=\"close-button\"\n                        onClick={handleClose}\n                        square={true}\n                        size={\"medium\"}\n                        color=\"purple\"\n                        text=\"x\"\n                    />\n                )}\n            </div>\n            { props.children }\n        </div>\n    );\n};\n\nexport default Window;\n","import Window, { Props } from \"components/ui/window/Window\";\nimport * as React from \"react\";\nimport \"components/ui/window/styles/window.scss\";\n\nexport const withWindow = <TWrappedComponentProps extends Props>(WrappedComponent: React.ComponentType<TWrappedComponentProps>) => {\n    return class WithWindow extends React.Component<TWrappedComponentProps> {\n\n        public render() {\n            return <Window { ...this.props } >\n                <WrappedComponent { ...this.props } />\n            </Window>;\n        }\n    };\n};\n","\nimport { StoreState } from 'store/types';\nimport { useSelector } from 'react-redux';\nimport { EngineStoreState } from 'store/types/engine';\n\n// Returns the 'engine' part from redux store\nexport const useEngine = () => {\n    return useSelector<StoreState, EngineStoreState>(store => store.engine);\n}\n\nexport const useDelta = () => {\n    const engine = useEngine();\n    return Date.now() - engine.previousTick;\n}","import * as React from \"react\";\nimport { useDelta } from 'hooks/store/engine';\nimport { useEffect, useState } from 'react';\nimport PlainProgressbar from \"./PlainProgressbar\";\nimport usePrevious from \"hooks/usePrevious\";\n\nexport enum Direction {\n    increasing,\n    decreasing\n}\n\nexport interface Props {\n    progress: number;     // between 0 and 1\n    label?: string;\n    className?: string;\n    direction?: Direction; // only used to prevent the bar from animating back to the start state\n    animate?: boolean;\n}\n\nconst TickingProgressbar = (props: Props) => {\n    const { className = \"\", label, direction, progress = 0} = props;\n    const previousProgress = usePrevious(progress) || 0;\n    // We use the delta time since last tick to animate\n    const delta = useDelta();\n\n    // If we have a direction defined and we're going the other direction, dont animate\n    // because we've basically reset the progress bar and we just want to animate in one direction\n    const [animate, setAnimate] = useState(false);\n\n    useEffect(() => {\n        setAnimate(\n             direction === undefined ||\n            (direction === Direction.increasing && progress > previousProgress) ||\n            (direction === Direction.decreasing && progress < previousProgress)\n        );\n    }, [direction, progress]); // see https://github.com/facebook/react/issues/20752\n\n    // previousProgress.current = progress;\n    return (\n        <PlainProgressbar\n            progress={progress}\n            label={label}\n            className={className}\n            animationTime={animate ? delta : 0}\n        />\n    );\n};\n\nexport default TickingProgressbar;\n","import { useEffect, useRef } from \"react\";\r\n\r\nconst usePrevious = <T>(value: T): T|undefined => {\r\n    const ref = useRef<T>();\r\n    useEffect(() => {\r\n      ref.current = value;\r\n    }, [value]);\r\n    return ref.current;\r\n};\r\nexport default usePrevious;\r\n","import { ReactNode } from 'react';\nimport { Item } from \"definitions/items/types\";\nimport { WeaponType } from 'definitions/items/weapons';\nimport { TraitDefinition } from 'definitions/traits/types';\n\n// Things that can be shown on the ContextPopup\nexport enum ContextType {\n    item,\n    trait,\n    resource,\n    skill,\n    component\n}\n\nexport type ContextInfo = Item | TraitDefinition | WeaponType | string | ReactNode;\n","import { createSelector } from \"reselect\";\nimport { StoreState } from \"store/types\";\nimport { TasksStoreState } from 'store/types/tasks';\nimport { Structure } from 'definitions/structures';\n\nconst getTasks = (state: StoreState) => state.tasks;\n\n/*\n * Returns a selector for the store that selects all crafting tasks running for given structure */\nexport const createSelectCraftingTasksByStructure = (structure: Structure) => {\n    const craftingTasksByStructure = (tasks: TasksStoreState) => {\n        return tasks.running.filter((val) => val.origin === `${structure}.craft`);\n    };\n    return createSelector([\n        getTasks],\n        craftingTasksByStructure,\n    );\n}\n\n/*\n * Returns a selector for the store that selects all study tasks running for given structure */\nexport const createSelectStudyingTasksByStructure = (structure: Structure) => {\n    const studyingTasksByStructure = (tasks: TasksStoreState) => {\n        return tasks.running.filter((val) => val.origin === `${structure}.study`);\n    };\n    return createSelector([\n        getTasks],\n        studyingTasksByStructure,\n    );\n}\n\n/*\n * Returns a selector for the store that selects all upgrade tasks running for given structure \n * Typically 0 or 1 */\nexport const createSelectUpgradeTasksByStructure = (structure: Structure) => {\n    const upgradeTasksByStructure = (tasks: TasksStoreState) => {\n        return tasks.running.filter((val) => val.name === `${structure}.upgrade`);\n    };\n    return createSelector([\n        getTasks],\n        upgradeTasksByStructure,\n    );\n}\n","import { useSelector } from 'react-redux';\nimport { TasksStoreState } from 'store/types/tasks';\nimport { createSelectCraftingTasksByStructure, createSelectStudyingTasksByStructure, createSelectUpgradeTasksByStructure } from 'store/selectors/tasks';\nimport { Structure } from 'definitions/structures';\nimport { StoreState } from 'store/types';\n\n// Returns all the tasks from redux store\nexport const useTasksState = () => {\n    return useSelector<StoreState, TasksStoreState>(store => store.tasks);\n}\n\n// Returns all running crafting tasks for given structure\nexport const useCraftingTasksStateByStructure = (structure: Structure) => {\n    return useSelector(createSelectCraftingTasksByStructure(structure));\n}\n\n// Returns all running crafting tasks for given structure\nexport const useStudyingTasksStateByStructure = (structure: Structure) => {\n    return useSelector(createSelectStudyingTasksByStructure(structure));\n}\n\n// Returns all running update tasks for given structure\nexport const useUpgradeTasksStateByStructure = (structure: Structure) => {\n    return useSelector(createSelectUpgradeTasksByStructure(structure));\n}\n\n","import React from \"react\";\nimport { Structure } from 'definitions/structures';\nimport \"./styles/structureViewHeader.scss\";\n\ninterface Props {\n    structure: Structure;\n}\n\nconst StructureViewHeader = (props: Props) => {\n    // const displayName = TextManager.getStructureName(props.structure);\n    return (\n        <div className={`structureview-header structureview-header-${props.structure}`}>\n            {/* <h1 className=\"app-h1-white\">{displayName}</h1> */}\n        </div>\n    );\n}\n\nexport default StructureViewHeader;","import * as React from \"react\";\nimport { AnyAction } from \"redux\";\nimport { TextManager } from 'global/TextManager';\nimport { Structure } from 'definitions/structures';\nimport { useStructureDefinition, useStructureState } from 'hooks/store/structures';\nimport Button from 'components/ui/buttons/Button';\nimport { useUpgradeTasksStateByStructure } from 'hooks/store/useTasksState';\nimport { formatDuration } from 'utils/format/time';\nimport { TickingProgressbar } from \"components/ui/common/progress\";\nimport \"./styles/structureLevel.scss\";\n\nexport interface Props {\n    structure: Structure;\n    onHelpClicked?: (e: React.MouseEvent) => void;\n    addUpgradeCallbacks?: (level: number) => AnyAction[]; // add custom actions after upgrade is done\n}\n\nconst StructureLevel = (props: Props) => {\n    const {\n        structure,\n        onHelpClicked,\n        addUpgradeCallbacks\n    } = props;\n\n    const structureState = useStructureState(structure);\n    const level: number = structureState.level;\n    const structureDefinition = useStructureDefinition(structure);\n\n    const nextLevel = structureDefinition.levels[level + 1];\n    // const nextLevelCost = (nextLevel != null ? nextLevel.cost.gold || 0 : -1);\n    // const canUpgrade = nextLevel != null && gold >= nextLevelCost;\n    const upgradeText = nextLevel == null ? TextManager.get(\"ui-structure-upgrade-max\") : TextManager.get(\"ui-structure-upgrade\", { level: level + 2 });\n\n    const upgradeTasks = useUpgradeTasksStateByStructure(structure);\n\n\n\n    if (upgradeTasks.length) {\n        const t = upgradeTasks[0];\n        return (\n            <TickingProgressbar\n                key={`${t.name}${t.startTime}`}\n                className=\"upgrading\" // todo: margin: 8\n                label={`${TextManager.get(\"structure-upgrade-button-upgrading\")} (${formatDuration(t.timeRemaining)})`}\n                progress={t.progress}\n            />\n        )\n    }\n\n    return (\n        <div className=\"upgrade-stucture-button\">\n            <label>\n                {TextManager.get(\"ui-structure-level\")}\n                { level + 1 }\n            </label>\n            <Button\n                className=\"upgrade\"\n                onClick={onHelpClicked}\n                disabled={nextLevel == null}\n            >\n                { upgradeText }\n            </Button>\n        </div>\n    );\n};\n\nexport default StructureLevel;","import { ContextInfo, ContextType } from 'constants/context';\nimport { ItemSource } from 'constants/items';\nimport deepEquals from 'deep-equal';\nimport EventEmitter from \"events\";\nimport TypedEmitter from \"typed-emitter\";\nexport interface Context {\n    type: ContextType;\n    info: ContextInfo;\n    source?: ItemSource;\n    referenceRect: ClientRect;\n    className?: string;\n}\n\nexport const EVENT_CONTEXT_UPDATED = \"tooltipContextUpdated\";\ninterface TooltipEvents {\n    [EVENT_CONTEXT_UPDATED]: (context: Context | undefined) => void;\n}\n\nexport class TooltipManager extends (EventEmitter as new () => TypedEmitter<TooltipEvents>) {\n    private static _instance = new TooltipManager();\n    private static lastContext: Context | undefined;\n\n    static showContextTooltip (type: ContextType, info: ContextInfo, originRect: ClientRect, className?: string, source?: ItemSource) {\n        const context = { type, info, referenceRect: originRect, className, source };\n\n        if(deepEquals(context, this.lastContext)) {\n            this.clear();\n        } else {\n            this.instance.emit(EVENT_CONTEXT_UPDATED, context);\n            this.lastContext = context;\n        }\n    }\n\n    static clear() {\n        this.instance.emit(EVENT_CONTEXT_UPDATED, undefined);\n        this.lastContext = undefined;\n    }\n\n    static get instance() {\n        return this._instance;\n    }\n}\n","import * as React from \"react\";\nimport { ContextType } from \"constants/context\";\nimport { ItemSource, Rarity } from \"constants/items\";\nimport { getDefinition } from \"definitions/items\";\nimport { Item } from \"definitions/items/types\";\nimport { TooltipManager } from 'global/TooltipManager';\nimport Icon, { IconSize } from 'components/ui/common/Icon';\nimport \"./styles/itemIcon.scss\";\n\nexport interface Props {\n    item: Item;\n    onClick?: (event: React.MouseEvent) => void;\n    size?: IconSize;\n    showContext?: boolean;\n    source?: ItemSource;\n}\n\nconst ItemIcon = (props: Props) => {\n    const { item, size, source } = props;\n    const itemDefinition = getDefinition(item);\n\n    if (!itemDefinition) {\n        throw `could not find definition for ${item}`;\n    }\n\n    const handleClick = (event: React.MouseEvent) => {\n        if (props.showContext !== false) {\n            const origin = (event.currentTarget as HTMLElement);\n            const originRect = origin.getBoundingClientRect();\n            TooltipManager.showContextTooltip(ContextType.item, item, originRect, undefined, source);\n            event.stopPropagation();\n        }\n\n        if (props.onClick) {\n            props.onClick(event);\n        }\n    };\n\n    const className = `item-icon ${getIconClassName(itemDefinition.rarity)} ${sizeClassName(size)}`;\n\n    return (\n        <div className={className}>\n            <Icon\n                image={itemDefinition.iconImg}\n                size={props.size}\n                onClick={handleClick}\n            />\n        </div>\n    );\n};\n\nexport default ItemIcon;\n\n\nconst getIconClassName = (rarity?: Rarity): string => {\n    switch (rarity) {\n        case Rarity.common:\n            return \"item-icon-common\";\n        case Rarity.uncommon:\n            return \"item-icon-uncommon\";\n        case Rarity.rare:\n            return \"item-icon-rare\";\n        case Rarity.epic:\n            return \"item-icon-epic\";\n        case Rarity.legendary:\n            return \"item-icon-legendary\";\n    }\n    return getIconClassName(Rarity.common);\n};\n\nconst sizeClassName = (size?: IconSize): string => {\n    switch (size) {\n        case IconSize.smallest:\n            return \"item-icon-size-smallest\";\n        case IconSize.small:\n            return \"item-icon-size-small\";\n        case IconSize.medium:\n            return \"item-icon-size-medium\";\n        case IconSize.big:\n            return \"item-icon-size-big\";\n        case IconSize.biggest:\n            return \"item-icon-size-biggest\";\n    }\n    return sizeClassName(IconSize.medium);\n};","// Todo: come up with a less retarded name\nimport * as React from \"react\";\nimport \"./styles/updownvalue.scss\";\n\nexport interface DispatchProps {\n    onUp?: (e: React.MouseEvent) => void;\n    onDown?: (e: React.MouseEvent) => void;\n}\nexport interface Props extends DispatchProps {\n    label?: string;\n    value?: number;\n    max?: number;\n    upDisabled?: boolean;\n    downDisabled?: boolean;\n}\n\nconst UpDownValue = (props: Props) => {\n    const handleUp = (e: React.MouseEvent) => {\n        if (props.onUp && !props.upDisabled) { props.onUp(e); }\n    };\n\n    const handleDown = (e: React.MouseEvent) => {\n        if (props.onDown && !props.downDisabled) { props.onDown(e); }\n    };\n\n    let displayValue;\n    if (props.max == null) {\n        displayValue = props.value;\n    } else {\n        displayValue = <span>\n            { props.value } / <span className=\"max\">{ props.max }</span>\n        </span>;\n    }\n    return (\n        <div className=\"updownvalue\">\n            <label> { props.label }</label>\n            { displayValue }\n            <i className= { \"arrow up\" + (props.upDisabled ? \" disabled\" : \"\" )}\n                onClick= { handleUp }\n            />\n            <i className={\"arrow down\" + (props.downDisabled ? \" disabled\" : \"\")}\n                onClick= { handleDown }\n            />\n        </div>\n    );\n};\n\nexport default UpDownValue;\n","\nimport { StoreState } from 'store/types';\nimport { useSelector } from 'react-redux';\nimport { StockpileStoreState } from 'store/types/stockpile';\nimport { useMemo } from 'react';\nimport { Item } from 'definitions/items/types';\n\n// Returns the stockpile of items grouped into ItemType\nexport const useStockpileState = () => {\n    return useSelector<StoreState, StockpileStoreState>(state => state.stockpile);\n}\n\nexport const useStockpileStateFlat = (): Item[] => {\n    const stockpile = useStockpileState();\n    return useMemo(() => {\n        const all = Object.values(stockpile).flat()\n        return all;\n    }, [stockpile])\n}\n ","import * as React from \"react\";\nimport { getDefinition } from \"definitions/items\";\nimport { Item } from \"definitions/items/types\";\nimport { TextManager } from \"global/TextManager\";\nimport { useMemo } from 'react';\nimport Icon from 'components/ui/common/Icon';\nimport { useStockpileStateFlat } from \"hooks/store/stockpile\";\nimport \"./styles/itemsBox.scss\";\n\nexport interface Props {\n    className?: string;\n    items: Item[];\n\n   // itemsInInventory?: Item[]; // Items that are in `items` array and also in inventory\n}\n\n\n/**\n * The ItemsBox displays a list of items, to be used as requirements for something\n */\nconst ItemsBox = (props: Props) => {\n    const { items } = props;\n    const className = (props.className || \"\") + \" items-box\";\n    const aggregate = items.reduce<{[key: string]: number}>((acc, value) => {\n        if (!acc[value]) {\n            acc[value] = 0;\n        }\n        acc[value]++;\n        return acc;\n    }, {});\n\n    const stockpile = useStockpileStateFlat();\n    const itemsInInventory: Item[] = useMemo(() => {\n        const tmpWarehouse = [ ...stockpile];\n        const tmpItems: Item[] = [];\n        items.forEach((item: Item) => {\n            const found = tmpWarehouse.findIndex((i) => i === item);\n            if (found > -1) {\n                // Remove the item from tmpWarehouse and add to itemsInInventory\n                const [ removed ] = tmpWarehouse.splice(found, 1);\n                if (removed) {\n                    tmpItems.push(removed);\n                }\n            }\n        });\n        return tmpItems;\n    }, [items, stockpile]);\n\n\n    const listItems = Object.keys(aggregate).map((key: string) => {\n        const item = key as Item;\n        const amount = aggregate[key] as number;\n        let listItemClass = \"item\";\n\n        // Check if we have enough\n        const amountInInventory = itemsInInventory ? itemsInInventory.filter((i) => i === item).length : 0;\n        if (amount > amountInInventory) {\n            listItemClass += \" missing\";\n        }\n        const itemDescription = getDefinition(item);\n        return (\n            <li className={listItemClass} key={item}>\n                <Icon\n                    image={itemDescription.iconImg}\n                    size=\"smallest\"\n                />\n                <div className=\"name\">\n                    { `${TextManager.getItemName(item)} (${ amount })` }\n                </div>\n            </li>\n        );\n    });\n\n    return (\n        <ul className={className} >\n            {listItems}\n        </ul>\n    );\n};\n\nexport default ItemsBox;\n","import { getDefinition } from \"definitions/structures\";\nimport { WarehouseStructureDefinition, WarehouseStructureLevelDefinition } from \"definitions/structures/types\";\nimport { createSelector } from 'reselect';\nimport { StoreState } from \"store/types\";\n\nconst getWarehouseLevel = (state: StoreState) => {\n    return state.structures[\"warehouse\"].level;\n}\n\n\nconst maxResources = (level: number) => {\n    const structureDefinition = getDefinition<WarehouseStructureDefinition>(\"warehouse\");\n    const levelDefinition: WarehouseStructureLevelDefinition = structureDefinition.levels[level];\n    return levelDefinition.maxResources;\n}\n\n// Selects a ResourceStoreState with maximum stockpile of each resource the warehouse supports\nexport const selectMaxResources = createSelector([\n    getWarehouseLevel],\n    maxResources,\n);","import { StoreState } from 'store/types';\nimport { useSelector } from 'react-redux';\nimport { ResourceStoreState } from 'store/types/resources';\nimport { selectMaxResources } from 'store/selectors/resources';\n\n// Returns the resources from the warehouse\nexport const useResourcesState = () => {\n    return useSelector<StoreState, ResourceStoreState>(store => store.resources);\n}\n\n// Returns the maximum of each resource that the warehouse can hold\nexport const useMaxResourcesState = () => {\n    return useSelector<StoreState, ResourceStoreState>(selectMaxResources);\n}","import { StoreState } from 'store/types';\nimport { useSelector } from 'react-redux';\n\n// Returns the gold from redux store\nconst useGoldState = () => {\n    return useSelector<StoreState, number>(store => store.gold);\n}\n\nexport default useGoldState;","import { Resource } from \"definitions/resources\";\nimport resourceDescriptions from \"definitions/resources\";\nimport * as React from \"react\";\nimport { ResourceStoreState } from \"store/types/resources\";\nimport { TextManager } from \"global/TextManager\";\nimport { useMemo } from 'react';\nimport { useResourcesState } from 'hooks/store/resources';\nimport Icon from 'components/ui/common/Icon';\nimport { ContextType } from 'constants/context';\nimport { TooltipManager } from 'global/TooltipManager';\nimport useGoldState from \"hooks/store/useGoldState\";\nimport \"./styles/resourcesCost.scss\";\n\nexport interface Props {\n    className?: string;\n    resources: ResourceStoreState;\n    gold?: number;\n}\n\n/**\n * \n */\nconst ResourcesCost = (props: Props) => {\n    const {\n        resources,\n        gold\n    } = props;\n\n    const storeResources = useResourcesState();\n    \n    const sufficientResources = useMemo(() => {\n        return Object.keys(resources).reduce<{[key: string]: boolean}>((acc, value) => {\n            const resource = value as Resource;\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            acc[value] = storeResources[resource]! >= resources[resource]!;\n            return acc;\n        }, {});\n    }, [resources, storeResources]);\n    const availableGold = useGoldState();\n    const sufficientGold = gold === undefined || availableGold >= gold;\n\n    const className = (props.className || \"\") + \" resources-cost\";\n    const listItems = Object.keys(props.resources).map((key: string) => {\n        const resource = key as Resource;\n        let listItemClass = \"resource\";\n        if (sufficientResources && !sufficientResources[resource]) {\n            listItemClass += \" insufficient\";\n        }\n        const resourceDescription = resourceDescriptions[resource];\n        if (!resourceDescription) {\n            throw new Error(`No resource description found for ${resource}`);\n        }\n\n        const handleClick = (event: React.MouseEvent) => {\n\n            const origin = (event.currentTarget as HTMLElement);\n            const originRect = origin.getBoundingClientRect();\n            TooltipManager.showContextTooltip(ContextType.resource, resource, originRect);\n            event.stopPropagation();\n        };\n\n        return (\n            <li\n                className={listItemClass}\n                key={resource}\n            >\n                <Icon\n                    image={resourceDescription.iconImg}\n                    size=\"smallest\"\n                    onClick={handleClick}\n                />\n                <div className=\"name\">\n                    {TextManager.getResourceName(resource as Resource)}\n                </div>\n                <div className=\"amount\" >\n                    { props.resources[resource] }\n                </div>\n            </li>\n        );\n    });\n\n    return (\n        <ul className={className}>\n            {listItems}\n            {gold && (\n                <li className={[\"gold\", ...(sufficientGold ? [] : [\"insufficient\"])].join(\" \")}>\n                    <Icon\n                        image=\"img/resources/gold.png\"\n                        size=\"smallest\"\n                    />\n                    <div className=\"name\">\n                        {TextManager.get(\"resource-gold-name\")}\n                    </div>\n                    <div className=\"amount\" >\n                        { gold }\n                    </div>\n                </li>\n            )}\n        </ul>\n    );\n};\n\nexport default ResourcesCost;","import { Structure } from \"definitions/structures\";\nimport { createSelector } from \"reselect\";\nimport { StoreState } from \"store/types\";\nimport { StructureStoreState } from \"store/types/structure\";\nimport { StructuresStoreState } from \"store/types/structures\";\n\nconst getStructures = (state: StoreState) => state.structures;\nconst getWorkers = (state: StoreState) => state.workers;\n\nconst calculateFreeWorkers = (structures: StructuresStoreState, workers: number) => {\n    // Add up all the workers used by all structures in town\n    const workersUsed = Object.keys(structures).map((name) => structures[name as Structure])\n        .reduce((acc: number, value: StructureStoreState) => acc += value.workers, 0);\n\n    return workers - workersUsed;\n};\n\nexport const selectFreeWorkers = createSelector([\n    getStructures,\n    getWorkers],\n    calculateFreeWorkers,\n);\n","import { StoreState } from 'store/types';\nimport { useSelector } from 'react-redux';\nimport { selectFreeWorkers } from 'store/selectors/workers';\n\n// Returns all the workers from redux store\nexport const useWorkersState = () => {\n    return useSelector<StoreState, number>(store => store.workers);\n}\n\n// Returns all the workers not working on something from redux store\nexport const useWorkersFreeState = () => {\n    return useSelector<StoreState, number>(selectFreeWorkers);\n}\n\n","export const MAX_WORKERS_CRAFTING = 6;\n\n/**\n * Calculates the production time for productionDefinition with given amount of workers\n * @param productionDefinition\n * @param workers\n */\nexport const calculateProductionTime = (time: number, workers: number): number => {\n    if (workers > MAX_WORKERS_CRAFTING) {\n        throw new Error(`Cannot possibly have more than ${MAX_WORKERS_CRAFTING} on one item!`);\n    }\n    // Each additional worker shaves off 10% of the production time\n    return time - (.1 * time * (workers - 1));\n};\n","\nimport { Weapon } from \"definitions/items/weapons\";\nimport * as time from \"utils/format/time\";\nimport { ProductionDefinition } from \"./types\";\n\nconst weaponsmithProduction: {[key in Weapon]?: ProductionDefinition} = {\n    \"weapon/aegisOfValor\": {\n        item: \"weapon/aegisOfValor\",\n        levelRequired: 3,\n        cost: {\n            resources: { wood: 20, iron: 5 },\n            time: time.HALF_HOUR,\n        },\n    },\n    \"weapon/arbalest\": {\n        item: \"weapon/arbalest\",\n        cost: {\n            resources: { wood: 20, iron: 5 },\n            time: time.HALF_HOUR,\n        },\n    },\n    \"weapon/battleAxe\": {\n        item: \"weapon/battleAxe\",\n        cost: {\n            resources: { wood: 20, iron: 5 },\n            time: time.HALF_HOUR,\n        },\n    },\n    \"weapon/berserkerShield\": {\n        item: \"weapon/berserkerShield\",\n        levelRequired: 2,\n        cost: {\n            resources: { wood: 20, iron: 5 },\n            time: time.HALF_HOUR,\n        },\n    },\n    \"weapon/brassKnuckles\": {\n        item: \"weapon/brassKnuckles\",\n        cost: {\n            resources: { wood: 20, iron: 5 },\n            time: time.HALF_HOUR,\n        },\n    },\n    \"weapon/simpleCrossbow\": {\n        item: \"weapon/simpleCrossbow\",\n        cost: {\n            resources: { wood: 20, iron: 5 },\n            time: time.HALF_HOUR,\n        },\n    },\n    \"weapon/cleaver\": {\n        item: \"weapon/cleaver\",\n        cost: {\n            resources: { wood: 10, iron: 15 },\n            time: time.HALF_HOUR,\n        },\n    },\n    \"weapon/club\": {\n        item: \"weapon/club\",\n        cost: {\n            resources: { wood: 30,},\n            time: time.HALF_HOUR,\n        },\n    },\n    \"weapon/dagger\": {\n        item: \"weapon/dagger\",\n        cost: {\n            resources: { wood: 10, iron: 10},\n            time: time.ONE_HOUR,\n        },\n    },\n    \"weapon/flail\": {\n        item: \"weapon/flail\",\n        cost: {\n            resources: { wood: 10, iron: 10},\n            time: time.ONE_HOUR,\n        },\n    },\n    \"weapon/goldenShield\": {\n        item: \"weapon/goldenShield\",\n        levelRequired: 2,\n        cost: {\n            resources: { wood: 20, iron: 5 },\n            time: time.HALF_HOUR,\n        },\n    },\n    \"weapon/javelin\": {\n        item: \"weapon/javelin\",\n        cost: {\n            resources: { wood: 20, iron: 10},\n            time: time.ONE_HOUR + time.HALF_HOUR,\n        },\n    },\n    \"weapon/khopesh\": {\n        item: \"weapon/khopesh\",\n        cost: {\n            resources: { wood: 15, iron: 40},\n            time:  time.TWO_MINUTES,\n        },\n    },\n    \"weapon/longbow\": {\n        item: \"weapon/longbow\",\n        cost: {\n            resources: { wood: 40, iron: 5},\n            time: time.ONE_HOUR,\n        },\n    },\n    \"weapon/mace\": {\n        item: \"weapon/mace\",\n        cost: {\n            resources: { wood: 15, iron: 10},\n            time: time.ONE_HOUR,\n        },\n    },\n    \"weapon/morningStar\": {\n        item: \"weapon/morningStar\",\n        cost: {\n            resources: { wood: 15, iron: 15},\n            time: time.ONE_HOUR,\n        },\n    },\n    \"weapon/paintedBuckler\": {\n        item: \"weapon/paintedBuckler\",\n        cost: {\n            resources: { wood: 20, iron: 10},\n            time: time.ONE_HOUR + time.HALF_HOUR,\n        },\n    },\n    \"weapon/poisonedDagger\": {\n        item: \"weapon/poisonedDagger\",\n        cost: {\n            resources: { wood: 50, iron: 15},\n            materials: [ \"material/poisonVial\" ],\n            time: time.ONE_HOUR,\n        },\n    },\n    \"weapon/ravenStaff\": {\n        item: \"weapon/ravenStaff\",\n        cost: {\n            resources: { wood: 15, iron: 10, food: 5},\n            time: time.ONE_HOUR,\n        },\n    },\n    \"weapon/savageStaff\": {\n        item: \"weapon/savageStaff\",\n        cost: {\n            resources: { wood: 15, iron: 10, food: 5},\n            time: time.ONE_HOUR,\n        },\n    },\n    \"weapon/spear\": {\n        item: \"weapon/spear\",\n        cost: {\n            resources: { wood: 15, iron: 15},\n            time: time.ONE_HOUR,\n        },\n    },\n    \"weapon/steelShield\": {\n        item: \"weapon/steelShield\",\n        cost: {\n            resources: { wood: 15, iron: 15},\n            time: time.ONE_HOUR,\n        },\n    },\n    \"weapon/steelSword\": {\n        item: \"weapon/steelSword\",\n        cost: {\n            resources: { wood: 10, iron: 30},\n            time:  time.ONE_HOUR,\n        },\n    },\n    \"weapon/warhammer\": {\n        item: \"weapon/warhammer\",\n        cost: {\n            resources: { wood: 10, iron: 30},\n            time:  time.ONE_HOUR,\n        },\n    },\n    \"weapon/woodenBulwark\": {\n        item: \"weapon/woodenBulwark\",\n        cost: {\n            resources: { wood: 10, iron: 30},\n            time:  time.ONE_HOUR,\n        },\n    },\n};\nexport default weaponsmithProduction;\n\nexport function getDefinition(item: Weapon) {\n    return weaponsmithProduction[item];\n}\n","import { Apparel } from \"definitions/items/apparel\";\nimport * as time from \"utils/format/time\";\nimport {  ProductionDefinition } from \"./types\";\n\n// todo: real values for costs\nconst armoursmithProduction: { [key in Apparel]?: ProductionDefinition } = {\n    \"apparel/boots1\": {\n        item: \"apparel/boots1\",\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        },\n    },\n    \"apparel/boots2\": {\n        item: \"apparel/boots2\",\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        },\n        levelRequired: 2\n    },\n    \"apparel/boots3\": {\n        item: \"apparel/boots3\",\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        },\n        levelRequired: 3\n    },\n    \"apparel/chainmailHood\": {\n        item: \"apparel/chainmailHood\",\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    \"apparel/chest\": {\n        item: \"apparel/chest\",\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    \"apparel/clothGloves\": {\n        item: \"apparel/clothGloves\",\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        },\n    },\n    \"apparel/cowl\": {\n        item: \"apparel/cowl\",\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    \"apparel/druidChest\": {\n        item: \"apparel/druidHands\",\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        },\n        levelRequired: 2\n    },\n    \"apparel/druidFeet\": {\n        item: \"apparel/druidFeet\",\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        },\n        levelRequired: 2\n    },\n    \"apparel/druidHands\": {\n        item: \"apparel/druidHands\",\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        },\n        levelRequired: 2\n    },\n    \"apparel/druidHead\": {\n        item: \"apparel/druidHead\",\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        },\n        levelRequired: 2\n    },\n    \"apparel/druidLegs\": {\n        item: \"apparel/druidLegs\",\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        },\n        levelRequired: 2\n    },\n    \"apparel/fedora\": {\n        item: \"apparel/fedora\",\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    \"apparel/greaves1\": {\n        item: \"apparel/greaves1\",\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    \"apparel/greaves2\": {\n        item: \"apparel/greaves2\",\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    \"apparel/hornedHelmet\": {\n        item: \"apparel/hornedHelmet\",\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    \"apparel/leatherGloves\": {\n        item: \"apparel/leatherGloves\",\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    \"apparel/nomadHelmet\": {\n        item: \"apparel/nomadHelmet\",\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    \"apparel/pants1\": {\n        item: \"apparel/pants1\",\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    \"apparel/pants2\": {\n        item: \"apparel/pants2\",\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    \"apparel/plateChest1\": {\n        item: \"apparel/plateChest1\",\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    \"apparel/plateChest2\": {\n        item: \"apparel/plateChest2\",\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    \"apparel/plateChest3\": {\n        item: \"apparel/plateChest3\",\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    \"apparel/plateChest4\": {\n        item: \"apparel/plateChest4\",\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    \"apparel/plateGloves1\": {\n        item: \"apparel/plateGloves1\",\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    \"apparel/plateGloves2\": {\n        item: \"apparel/plateGloves2\",\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    \"apparel/plateHelmet\": {\n        item: \"apparel/plateHelmet\",\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    \"apparel/platePants\": {\n        item: \"apparel/platePants\",\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    \"apparel/plateShoulders1\": {\n        item: \"apparel/plateShoulders1\",\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        }\n    },\n    \"apparel/plateShoulders2\": {\n        item: \"apparel/plateShoulders2\",\n        cost: {\n            resources: {\n                wood: 10,\n                iron: 45\n            },\n            time: time.ONE_HOUR,\n        },\n    },\n    \"apparel/robe\": {\n        item: \"apparel/robe\",\n        cost: {\n            resources: { wood: 10, iron: 45},\n            time: time.ONE_HOUR,\n        }\n    },\n    \"apparel/shoulders1\": {\n        item: \"apparel/shoulders1\",\n        cost: {\n            resources: { wood: 10, iron: 45},\n            time: time.ONE_HOUR,\n        }\n\n    },\n    \"apparel/shoulders2\": {\n        item: \"apparel/shoulders2\",\n        cost: {\n            resources: { wood: 10, iron: 45},\n            time: time.ONE_HOUR,\n        }\n\n    },\n    \"apparel/shoulders3\": {\n        item: \"apparel/shoulders3\",\n        cost: {\n            resources: { wood: 10, iron: 45},\n            time: time.ONE_HOUR,\n        }\n\n    },\n    \"apparel/vest\": {\n        item: \"apparel/vest\",\n        cost: {\n            resources: { wood: 10, iron: 45},\n            time: time.ONE_HOUR,\n        }\n    },\n};\nexport default armoursmithProduction;\n","import { AnyAction } from \"redux\";\n\nexport enum TaskType {\n    buildStructure,\n    upgradeStructure,\n    craftItem,\n    studyItem\n}\n\nexport interface TaskStoreState {\n    type: TaskType;\n    name: string;\n    origin: string;\n    startTime: number;        // time the task was scheduled\n    lastTick: number;         // time of last tick\n    timeRemaining: number;\n    progress: number;         // value between 0 and 1 indicating progress\n    callbacks: AnyAction[];\t  // actions to dispatch on complete\n}\n","import { QuestItem } from \"definitions/items/questItems\";\nimport * as time from \"utils/format/time\";\nimport { ProductionDefinition } from \"./types\";\n\nconst workshopProduction: {[key in QuestItem]?: ProductionDefinition} = {\n    \"questItem/torch\": {\n        item: \"questItem/torch\",\n        cost: {\n            resources: { wood: 2, fabric: 1 },\n            time: time.ONE_MINUTE,\n        },\n    },\n    \"questItem/sandwich\": {\n        item: \"questItem/sandwich\",\n        cost: {\n            resources: { food: 1 },\n            time: time.ONE_MINUTE / 2,\n        },\n    }\n};\nexport default workshopProduction;\n\n","import weaponsmithProduction from './weaponsmith'\nimport armoursmithProduction from './armoursmith'\nimport { Structure } from 'definitions/structures';\nimport { ProductionDefinition } from './types';\nimport workshopProduction from './workshop';\n// import alchemistProduction from './alchemist';\nimport { isWeapon } from 'definitions/items/weapons';\nimport { isApparel } from 'definitions/items/apparel';\nimport { isQuestItem } from 'definitions/items/questItems';\nimport { ProducableItem } from 'store/types/structure';\n\n// Returns the structure that produces given Item, or null if this Item is not produced anywhere\nexport const getProductionStructureForItem = (item: ProducableItem): Structure | null => {\n    // if (alchemistProduction[item]){\n    //     return Structure.alchemist;\n    // }\n    if (isApparel(item) && armoursmithProduction[item]){\n        return \"armoursmith\";\n    }\n    if (isWeapon(item) && weaponsmithProduction[item]){\n        return \"weaponsmith\";\n    }\n    if (isQuestItem(item) && workshopProduction[item]){\n        return \"workshop\";\n    }\n    return null;\n}\n\n\nconst all = {\n    // ...alchemistProduction,\n    ...armoursmithProduction,\n    ...weaponsmithProduction,\n    ...workshopProduction\n};\n\nexport const getDefinition = (item: ProducableItem ): ProductionDefinition => {\n    return all[item]!;\n}\n\n\n","import { Item, ItemType } from \"definitions/items/types\";\nimport { Action } from \"redux\";\n\nexport type StockpileAction =\n    { type: \"addItem\", item: Item, toSlot?: number }\n |  { type: \"moveItemInWarehouse\", itemType: ItemType, fromSlot: number, toSlot: number }\n |  { type: \"removeItem\", itemType: ItemType, fromSlot: number }\n//  |  { type: \"addStockpileSlots\"\n\n\n\nexport interface AddStockpileSlotsAction extends Action {\n    slots: number;\n}\n\n// Adds one Item to the warehouse\n// slot is optional, will take the first empty slot if not provided\nexport const addItemToWarehouse = (item: Item, toSlot?: number): StockpileAction => {\n    console.log('add item to warehouse')\n    return {\n        type: \"addItem\",\n        item,\n        toSlot,\n    };\n}\n\n// When an Item is moved from one slot to the other in the warehouse\nexport const moveItemInWarehouse = (itemType: ItemType, fromSlot: number, toSlot: number): StockpileAction => {\n    return {\n        type: \"moveItemInWarehouse\",\n        itemType,\n        fromSlot,\n        toSlot,\n    };\n}\n\nexport const removeItemFromWarehouse = (itemType: ItemType, fromSlot: number): StockpileAction => {\n    return {\n        type: \"removeItem\",\n        itemType,\n        fromSlot,\n    };\n}\n\n// export function addStockpileSlots(slots: number): AddStockpileSlotsAction {\n//     return {\n//         type: ActionType.addStockpileSlots,\n//         slots,\n//     };\n// }\n","import { ResourceStoreState } from \"store/types/resources\";\n\nexport type ResourcesAction = \n    { type: \"addResources\", resources: ResourceStoreState }\n |  { type: \"removeResources\", resources: ResourceStoreState }\n\n\nexport const addResource = (resource: string, value: number): ResourcesAction => {\n    return addResources({\n        [resource]: value,\n    });\n}\n\nexport const addResources = (resources: ResourceStoreState): ResourcesAction => ({\n    type: \"addResources\",\n    resources,\n})\n\nexport const removeResources = (resources: ResourceStoreState): ResourcesAction => ({\n    type: \"removeResources\",\n    resources,\n})\n","import { Structure } from \"definitions/structures\";\nimport { ProducableItem, StructureState } from \"store/types/structure\";\n\nexport type StructuresAction =\n    { type: \"upgradeStructure\", structure: Structure }\n |  { type: \"increaseWorkers\", structure: Structure, workers: number}\n |  { type: \"decreaseWorkers\", structure: Structure, workers: number}\n |  { type: \"startBuildingStructure\", structure: Structure }\n |  { type: \"finishBuildingStructure\", structure: Structure }\n |  { type: \"setStructureState\", structure: Structure, state: StructureState }\n |  { type: \"addItemToToProduces\", structure: Structure, item: ProducableItem }\n |  { type: \"removeItemFromHarvest\", structure: Structure, index: number }\n\n\nexport const startBuildingStructure = (structure: Structure): StructuresAction => ({\n    type: \"startBuildingStructure\",\n    structure,\n})\n\nexport const finishBuildingStructure = (structure: Structure): StructuresAction => ({\n    type: \"finishBuildingStructure\",\n    structure,\n})\n\nexport const upgradeStructure = (structure: Structure): StructuresAction => ({\n    type: \"upgradeStructure\",\n    structure,\n})\n\n// Increases workers used by given structure by given amount\nexport const increaseWorkers = (structure: Structure, workers = 1): StructuresAction => ({\n    type: \"increaseWorkers\",\n    structure,\n    workers\n})\n\n// Decreases workers used by given structure by given amount\nexport const decreaseWorkers = (structure: Structure, workers = 1): StructuresAction => ({\n    type: \"decreaseWorkers\",\n    structure,\n    workers\n})\n\n// Set state directly\nexport const setStructureState = (structure: Structure, state: StructureState): StructuresAction => ({\n    type: \"setStructureState\",\n    structure,\n    state\n})\n\n// Structure can now preoduce this\nexport const addItemToToProduces = (structure: Structure, item: ProducableItem): StructuresAction => ({\n    type: \"addItemToToProduces\",\n    structure,\n    item\n})\n\n// Take item at specified index\nexport const removeItemFromHarvest = (structure: Structure, index: number): StructuresAction => ({\n    type: \"removeItemFromHarvest\",\n    structure,\n    index\n})\n","import { AnyAction } from \"redux\";\nimport { TaskType } from \"store/types/task\";\n\n\nexport type TaskAction = { \n    type: \"start\", \n    taskType: TaskType;\n    name: string;\n    origin: string;\n    time: number;\n    callbacks: AnyAction[];\n}\n\nexport function startTask(taskType: TaskType, name: string, origin: string, time: number, callbacks: AnyAction[]): TaskAction {\n    return {\n        type: \"start\",\n        taskType,\n        name,\n        origin,\n        time,\n        callbacks,\n    };\n}\n","import React, { useState } from 'react';\nimport { useDispatch } from 'react-redux';\nimport Button from 'components/ui/buttons/Button';\nimport UpDownValue from 'components/ui/common/UpDownValue';\nimport ItemsBox from 'components/ui/items/ItemsBox';\nimport ResourcesCost from 'components/structures/production/ResourcesCost';\nimport { Item } from 'definitions/items/types';\nimport { TextManager } from 'global/TextManager';\nimport { useResourcesState } from 'hooks/store/resources';\nimport { useWorkersFreeState } from 'hooks/store/useWorkersState';\nimport { calculateProductionTime, MAX_WORKERS_CRAFTING } from 'mechanics/crafting';\nimport { formatDuration } from 'utils/format/time';\nimport { getDefinition as getProductionDefinition } from \"definitions/production\";\nimport { ProductionDefinition } from 'definitions/production/types';\nimport { addItemToWarehouse } from 'store/actions/stockpile';\nimport { removeResources } from 'store/actions/resources';\nimport { increaseWorkers } from 'store/actions/structures';\nimport { startTask } from 'store/actions/tasks';\nimport { TaskType } from 'store/types/task';\nimport { Structure } from 'definitions/structures';\nimport { Resource } from 'definitions/resources';\nimport { ProducableItem } from 'store/types/structure';\nimport { useStockpileStateFlat } from 'hooks/store/stockpile';\n\nexport interface Props {\n    item: ProducableItem;\n    structure: Structure;\n}\n\nconst CraftingDetails = (props: Props) => {\n    const { item, structure } = props;\n    const dispatch = useDispatch();\n    const resourcesState = useResourcesState();\n    const stockpileState = useStockpileStateFlat();\n    const workersFree = useWorkersFreeState();\n    const [workersAssigned, setWorkersAssigned] = useState<number>(0);\n\n    const produces = getProductionDefinition(item);\n    const costResources = produces.cost.resources || {};\n    const missingAtLeastOneResource = Object.keys(costResources)\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        .some((key) => { const resource:Resource = key as Resource; return costResources[resource]! > resourcesState[resource]! });\n\n    let missingAtLeastOneItem = false;\n    const costMaterials = produces.cost.materials;\n    if (costMaterials) {\n        missingAtLeastOneItem = costMaterials.some((i: Item) => stockpileState.indexOf(i) === -1);\n    }\n\n    const disabled = missingAtLeastOneResource || missingAtLeastOneItem || workersAssigned < 1;\n    // TODO: [10/07/2019] Perhaps each item can have a number of minimum workers?\n\n    const makeTimeString = (asNumber: number): string => {\n        if (workersAssigned === 0) {\n            return \"\";\n        }\n        const craftingTime = calculateProductionTime(asNumber, workersAssigned);\n        const time = formatDuration(craftingTime);\n        return TextManager.get(\"ui-structure-production-crafting-time\", { time });\n    };\n\n    const handleClick = (e: React.MouseEvent) => {\n        e.stopPropagation();\n\n        handleCraft(produces, workersAssigned);\n        setWorkersAssigned(0);\n    };\n\n    const handleUp = (e: React.MouseEvent) => {\n        e.stopPropagation();\n        setWorkersAssigned(workersAssigned + 1);\n    };\n\n    const handleDown = (e: React.MouseEvent) => {\n        e.stopPropagation();\n        setWorkersAssigned(workersAssigned - 1);\n    };\n\n    const handleCraft = (productionDefinition: ProductionDefinition, workers: number) => {\n        const craftingTime = calculateProductionTime(productionDefinition.cost.time || 0, workers);\n        dispatch(removeResources(productionDefinition.cost.resources || {}));\n        dispatch(increaseWorkers(structure, workers));\n\n        const callbacks = [\n            addItemToWarehouse(productionDefinition.item),\n            increaseWorkers(structure, workers),\n        ];\n        const start = startTask(TaskType.craftItem,\n            productionDefinition.item,\n            `${structure}.craft`,\n            craftingTime,\n            callbacks);\n        dispatch(start);\n    }\n\n    return (\n        <div className=\"crafting-details\">\n            { TextManager.get(\"ui-structure-production-craft-a\", {item}) }\n            <div className=\"crafting-costs\">\n                <fieldset>\n                    <ResourcesCost resources={costResources} />\n                </fieldset>\n                <fieldset>\n                    {costMaterials && <ItemsBox items={costMaterials} />}\n                </fieldset>\n            </div>\n            <div className=\"buttonrow\">\n                <div>\n                    <UpDownValue\n                        value={workersAssigned}\n                        label={TextManager.get(\"ui-structure-production-workers\")}\n                        onUp={handleUp}\n                        onDown={handleDown}\n                        upDisabled={\n                            workersAssigned >= workersFree ||\n                            workersAssigned >= MAX_WORKERS_CRAFTING\n                        }\n                        downDisabled={workersAssigned < 1}\n                    />\n                    { makeTimeString(produces.cost.time || 0)}\n                </div>\n                <div>\n                    <Button\n                        disabled={disabled}\n                        className=\"craft\"\n                        onClick={handleClick}\n                    >\n                        {TextManager.get(\"ui-structure-production-craft\")}\n                    </Button>\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default CraftingDetails;","import { Item } from \"definitions/items/types\";\nimport { SceneStoreState } from './scene';\n\nexport enum QuestStatus {\n    unavailable,\n    available,  // on the quest board\n    active,\n    completed,\n    // todo: failed?\n}\n\nexport interface QuestReward {\n    gold?: number;\n    items?: Item[];\n}\n\nexport interface QuestStoreState {\n    name: string;\n    status: QuestStatus;\n    party: string[];                // list of adventurer ids\n    progress: number;               // Which questnode the party is at currently\n    questVars: unknown;           // \n    encounterResults: string[];     // Store what option the place chose during an encounter // OBSOLETE\n    icon: string;\n\n    reward?: QuestReward;\n    scene?: SceneStoreState;\n    sceneName?: string;\n}\n","import React, { useState } from \"react\";\nimport { IconSize } from 'components/ui/common/Icon';\nimport ItemIcon from 'components/ui/items/ItemIcon';\nimport { Structure } from 'definitions/structures';\nimport { ProducableItem, ProductionStructureStoreState } from 'store/types/structure';\nimport { useStructureState } from 'hooks/store/structures';\nimport { TextManager } from 'global/TextManager';\nimport CraftingDetails from './CraftingDetails';\n\nexport interface Props {\n    structure: Structure;\n}\n\nconst CraftingArea = (props: Props) => {\n    const {structure} = props;\n    const [selectedItem, setSelectedItem] = useState<ProducableItem>();\n\n    const storeState = useStructureState<ProductionStructureStoreState>(structure);\n    const handleSelectCraftingItem = (item: ProducableItem) => {\n        setSelectedItem(item);\n    };\n\n    return (\n        <>\n            <div> { TextManager.get(\"ui-structure-production-craft\") }</div>\n            <div className=\"crafting-area\">\n                <ul className=\"vertical-tab-bar\">\n                    {storeState.produces.map((item) => (\n                        <li\n                            key={`craft${item}`}\n                            onClick={() => handleSelectCraftingItem(item)}\n                            className={selectedItem === item ? \"selected\" : \"\"}\n                        >\n                            <ItemIcon item={item} size={IconSize.smallest} />\n                            { TextManager.getItemName(item) }\n                        </li>\n                    ))}\n                </ul>\n                { selectedItem && <CraftingDetails item={selectedItem} structure={structure} /> }\n            </div>\n        </>\n    )\n};\n\nexport default CraftingArea;","import * as React from \"react\";\nimport { PropsWithChildren } from \"react\";\nimport { TextManager } from 'global/TextManager';\nimport useGoldState from \"hooks/store/useGoldState\";\nimport { Structure } from \"definitions/structures\";\nimport ResourcesCost from \"./production/ResourcesCost\";\nimport { ResourceStructureDefinition } from \"definitions/structures/types\";\nimport { useStructureDefinition } from \"hooks/store/structures\";\nimport { Resource } from \"definitions/resources\";\nimport { useResourcesState } from \"hooks/store/resources\";\nimport { useDispatch } from \"react-redux\";\nimport { subtractGold } from \"store/actions/gold\";\nimport { addLogText } from \"store/actions/log\";\nimport { upgradeStructure } from \"store/actions/structures\";\nimport { startTask } from \"store/actions/tasks\";\nimport { LogChannel } from \"store/types/logEntry\";\nimport { TaskType } from \"store/types/task\";\nimport Button from \"components/ui/buttons/Button\";\nimport { removeResources } from \"store/actions/resources\";\nimport { formatDuration } from \"utils/format/time\";\nimport \"./styles/upgradeHelpModal.scss\"\n\nexport interface Props  {\n    structure: Structure;\n    level: number;\n}\n\nconst UpgradeHelpModal = (props: PropsWithChildren<Props>) => {\n    const { structure, level, children } = props;\n    const dispatch = useDispatch();\n    const structureDefinition: ResourceStructureDefinition = useStructureDefinition(structure);\n    const nextLevel = structureDefinition.levels[level + 1];\n    \n    const { time } = nextLevel.cost;\n\n    const gold = useGoldState()\n    const goldCost = (nextLevel != null ? nextLevel.cost.gold || 0 : -1);\n    const missingGold = goldCost > gold;\n\n    const resourcesState = useResourcesState();\n    const costResources = nextLevel.cost.resources || {};\n    const missingAtLeastOneResource = Object.keys(costResources)\n        .some((key) => { \n            const resource = key as Resource; \n            return (costResources[resource] ?? 0) > (resourcesState?.[resource] ?? 0) \n        });\n\n    const canUpgrade = nextLevel != null && !missingGold && !missingAtLeastOneResource\n\n    const handleUpgrade = () => {\n        dispatch(subtractGold(goldCost));\n        dispatch(removeResources(costResources))\n\n        const callbacks = [\n            // ...(addUpgradeCallbacks?.(level + 1) || []),\n            upgradeStructure(structure),\n            addLogText(\"log-town-upgrade-structure-complete\", {\n                level: level + 1,\n                structure,\n            }, LogChannel.town)\n        ];\n        const time = nextLevel.cost.time ?? 0;\n        const start = startTask(TaskType.upgradeStructure,\n            `${structure}.upgrade`,\n            \"town\",\n            time,\n            callbacks);\n        dispatch(start);\n    }\n\n    return (\n        <div className=\"structure-upgrade-help-modal\">\n            <div className=\"top\">\n                <h3>{TextManager.get(\"ui-structure-help-upgrade-title\", { structure } )}</h3>\n                <div className=\"level\">\n                    {TextManager.get(\"ui-structure-help-upgrade-header-level\", {\n                        level: level + 2\n                    })}\n                </div>\n            </div>\n            <div className=\"cost\">\n                <h3>Costs</h3>\n                { nextLevel.cost.resources && <ResourcesCost resources={nextLevel.cost.resources} gold={nextLevel.cost.gold} className=\"wrap\" /> }\n            </div>\n            <Button\n                className=\"start\"\n                onClick={handleUpgrade}\n                disabled={!canUpgrade}\n            >\n                { TextManager.get(\"ui-structure-help-upgrade-start\", {\n                    time: formatDuration(time ?? 0)\n                })}\n            </Button>\n            {children}\n        </div>\n    )\n}\n\nexport default UpgradeHelpModal;\n","import * as React from \"react\";\nimport { Structure } from 'definitions/structures';\nimport { ProductionStructureDefinition } from 'definitions/structures/types';\nimport { IconSize } from 'components/ui/common/Icon';\nimport ItemIcon from 'components/ui/items/ItemIcon';\nimport { Item } from \"definitions/items/types\";\nimport { useStructureDefinition } from \"hooks/store/structures\";\nimport { TextManager } from \"global/TextManager\";\nimport \"./styles/upgradeHelpModalContent.scss\"\n\nexport interface Props  {\n    structure: Structure;\n    level: number;\n}\n\nconst UpgradeHelpModalContent = (props: Props) => {\n    const { level, structure } = props;\n    const structureDefinition = useStructureDefinition<ProductionStructureDefinition>(structure);\n    const nextLevel = structureDefinition.levels[level + 1];\n\n    const renderRow = (item: Item) => {\n        return (\n            <ItemIcon key={item} item={item} size={IconSize.small} />\n        )\n    }\n\n    return (   \n        <div className=\"upgrade-help-model-content-production\">\n            <h3>{TextManager.get(\"ui-structure-help-upgrade-unlocks-crafting\")}</h3>\n            <div className=\"unlocks\">\n                {nextLevel.unlocks.map(item => renderRow(item))}\n            </div>\n        </div>\n    )\n}\n\nexport default UpgradeHelpModalContent;","import * as React from \"react\";\nimport { Item } from \"definitions/items/types\";\nimport { Structure } from \"definitions/structures\";\nimport { ProductionStructureDefinition } from \"definitions/structures/types\";\nimport { TextManager } from \"global/TextManager\";\nimport { formatDuration } from \"utils/format/time\";\nimport { TickingProgressbar } from 'components/ui/common/progress';\nimport { useStructureDefinition, useStructureState } from 'hooks/store/structures';\nimport { useCraftingTasksStateByStructure, useStudyingTasksStateByStructure } from 'hooks/store/useTasksState';\nimport StructureViewHeader from '../StructureViewHeader';\nimport StructureLevel from '../StructureLevel';\nimport { TooltipManager } from 'global/TooltipManager';\nimport { ContextType } from 'constants/context';\nimport CraftingArea from './CraftingArea';\nimport { addItemToToProduces } from 'store/actions/structures';\nimport UpgradeHelpModal from \"../UpgradeHelpModal\";\nimport UpgradeHelpModalContent from \"./UpgradeHelpModalContent\";\nimport \"./styles/productionStructureView.scss\";\n\nexport interface Props {\n    structure: Structure;\n}\n\nconst ProductionStructureView = (props: Props) => {\n    const {structure} = props;\n    const level = useStructureState(structure).level;\n\n    const craftingTasks = useCraftingTasksStateByStructure(structure);\n    const studyingTasks = useStudyingTasksStateByStructure(structure);\n    const structureDefinition = useStructureDefinition<ProductionStructureDefinition>(props.structure);\n\n    const handleHelpClicked = (event: React.MouseEvent) => {\n        const origin = (event.currentTarget as HTMLElement);\n        const originRect = origin.getBoundingClientRect();\n        const content = (\n            <UpgradeHelpModal level={level} structure={structure}>\n                <UpgradeHelpModalContent level={level} structure={structure}/>\n            </UpgradeHelpModal>\n        );\n        TooltipManager.showContextTooltip(ContextType.component, content, originRect, \"upgrade-structure-tooltip\");\n\n        event.stopPropagation();\n    }\n\n    const handleUpgradeCallbacks = (nextLevel: number) => {\n        const nextLevelDefinition = structureDefinition.levels[nextLevel];\n        return nextLevelDefinition.unlocks.map(item => addItemToToProduces(structure, item));\n    }\n\n    return (\n        // TODO: abstract some stuff to generic StructureView\n        <>\n            <StructureViewHeader structure={props.structure} />\n            <div className = \"production-structure-view\">\n                <section>\n                    <StructureLevel\n                        structure={structure}\n                        onHelpClicked={handleHelpClicked}\n                        addUpgradeCallbacks={handleUpgradeCallbacks}\n                    />\n                    <CraftingArea structure={structure} />\n                    <fieldset>\n                        <legend>{TextManager.get(\"ui-structure-production-crafting\")}</legend>\n                        {craftingTasks.map((t) => (\n                            <TickingProgressbar\n                                key={`${t.name}${t.startTime}`}\n                                label={`${TextManager.getItemName(t.name as Item)} (${formatDuration(t.timeRemaining)})`}\n                                progress={t.progress}\n                            />\n                        ))}\n                    </fieldset>\n                    {studyingTasks.length > 0 && (\n                    <fieldset>\n                        <legend>{TextManager.get(\"ui-structure-production-studying\")}</legend>\n                        {studyingTasks.map((t) => (\n                            <TickingProgressbar\n                                key={`${t.name}${t.startTime}`}\n                                label={`${TextManager.getItemName(t.name as Item)} (${formatDuration(t.timeRemaining)})`}\n                                progress={t.progress}\n                            />\n                        ))}\n                    </fieldset>\n                    )}\n                </section>\n            </div>\n        </>\n    );\n}\n\nexport default ProductionStructureView;\n","export const formatNumber = (input: number, digits = 1): string => {\n    const SI_SYMBOL = [\"\", \"k\", \"M\", \"G\", \"T\", \"P\", \"E\"];\n\n    // what tier? (determines SI symbol)\n    const tier = Math.log10(input) / 3 | 0;\n    // if zero, we don't need a suffix\n    if(tier === 0) return input.toFixed(digits);\n\n    // get suffix and determine scale\n    const suffix = SI_SYMBOL[tier];\n    const scale = Math.pow(10, tier * 3);\n\n    // scale the number\n    const scaled = input / scale;\n\n    // format number and add suffix\n    return scaled.toFixed(digits) + suffix;\n}","import * as React from \"react\";\r\nimport { Resource } from \"definitions/resources\";\r\nimport resourceDescriptions from \"definitions/resources\";\r\nimport { ResourceStoreState } from \"store/types/resources\";\r\nimport { TextManager } from \"global/TextManager\";\r\nimport ReactMarkdown from \"react-markdown\";\r\nimport { StructuresStoreState } from 'store/types/structures';\r\nimport { getStructureByResource } from 'definitions/structures';\r\nimport { withAppContext, AppContextProps } from 'hoc/withAppContext';\r\nimport { useSelector } from 'react-redux';\r\nimport { StoreState } from 'store/types';\r\nimport { StructureState } from 'store/types/structure';\r\nimport { formatNumber } from 'utils/format/number';\r\nimport Icon from '../../ui/common/Icon';\r\nimport \"./styles/resourcesBox.scss\";\r\n\r\nexport interface Props {\r\n    className?: string;\r\n    resources: ResourceStoreState;\r\n    structures: StructuresStoreState;\r\n    maxResources: ResourceStoreState;\r\n    deltaResources: ResourceStoreState;\r\n}\r\n\r\n/**\r\n * The ResourcesBox is used in the Warehouse to show a list of resources\r\n */\r\nconst ResourcesBox = (props: Props & AppContextProps) => {\r\n    const {\r\n        resources,\r\n        deltaResources,\r\n    } = props;\r\n    const structures = useSelector<StoreState, StructuresStoreState>(store => store.structures);\r\n    const className = `resources-box ${(props.className || \"\")}`;\r\n\r\n    return (\r\n        <div className={className}>\r\n            {\r\n                Object.keys(resources).map((value: string) => {\r\n                    const resource = value as Resource;\r\n                    const resourceDescription = resourceDescriptions[resource];\r\n                    const amount = props.resources[resource] || 0;\r\n                    if (!resourceDescription) {\r\n                        throw new Error(`No resource description found for ${resource}`);\r\n                    }\r\n\r\n                    let delta;\r\n                    if (deltaResources[resource]) {\r\n                        delta = <span className=\"animate-up\">\r\n                            { `+ ${deltaResources[resource]?.toFixed(2)}`  }\r\n                        </span>;\r\n                    }\r\n\r\n                    const structure = getStructureByResource(Resource[resource]);\r\n\r\n                    const full = amount >= (props.maxResources?.[resource] ?? 0);\r\n                    const structureText = TextManager.get(structures[structure].state === StructureState.Built ? \"ui-structure-warehouse-resources-source\" : \"ui-structure-warehouse-resources-source-unbuilt\", {structure}) \r\n                    return (\r\n                        <React.Fragment key={resource}>\r\n                            <Icon image={resourceDescription.iconImg} size=\"smallest\"/>\r\n                            <div className=\"name\">\r\n                                { TextManager.getResourceName(resource as Resource) }\r\n                            </div>\r\n                            <div className={`amount${full ? \" full\" : \"\"}`}  >\r\n                                { formatNumber(amount, 0) }\r\n                            </div>\r\n                            <div className=\"max\" >\r\n                                { ` / ${props.maxResources[resource]}` }\r\n                            </div>\r\n                            <div className=\"delta\">\r\n                                { delta }\r\n                            </div>\r\n                            <div className=\"structure\">\r\n                                <ReactMarkdown>{structureText}</ReactMarkdown>\r\n                            </div>\r\n                        </React.Fragment>\r\n                    )\r\n                })\r\n            }\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default withAppContext(ResourcesBox);\r\n\r\n\r\n","import { Resource } from \"definitions/resources\";\n\n// The keys should be the same as the enum Resource\nexport interface ResourceStoreState {\n    [Resource.wood]?: number;\n    [Resource.iron]?: number;\n    [Resource.stone]?: number;\n    [Resource.leather]?: number;\n    [Resource.fabric]?: number;\n    [Resource.food]?: number;\n}\n\nexport const empty: ResourceStoreState = {\n    fabric: 0,\n    food: 0,\n    iron: 0,\n    leather: 0,\n    stone: 0,\n    wood: 0,\n};\n","import React from \"react\";\nimport { Props as TabProps } from \"./Tab\";\nimport { SoundManager} from 'global/SoundManager';\nimport \"./styles/tabstrip.scss\";\n\nexport interface Props {\n    className?: string;\n    children: React.ReactElement<TabProps>[] |  React.ReactElement<TabProps>;\n    activeTab?: string;\n    disabled?: boolean;\n    onClick?: React.MouseEventHandler<Element>;\n    onTabSelected?: (tabId: string) => void;\n}\n\nconst Tabstrip = (props: Props) => {\n    const {activeTab = null} = props;\n    if (!activeTab && props.children && props.children) {\n        //activeTab = props.children[0].props.id;\n    }\n    const className = `${props.className}${(props.disabled ? \" disabled\" : \"\")}`;\n    const children = React.Children.map(props.children, (child: React.ReactElement<TabProps>) => {\n        const clone: React.ReactElement<TabProps> = React.cloneElement(child, {\n            active: child.props.id === activeTab,\n            onClick: () => { handleTabClick(child.props.id); }\n        });\n        return clone;\n    });\n\n    const handleTabClick = (tabId: string) => {\n        if (props.onTabSelected && props.disabled !== true) {\n            props.onTabSelected(tabId);\n        }\n    };\n\n    const handleClick = (e: React.MouseEvent<Element>) => {\n        SoundManager.playSound(\"ui/buttonClick\");\n        if (props.onClick) {\n            props.onClick(e);\n        }\n    };\n\n    return (\n        <ul className={`tabstrip ${className ?? \"\"}`} onClick={handleClick}>\n            {children}\n        </ul>\n    );\n};\n\nexport default Tabstrip;\n","import * as React from \"react\";\n\nexport interface Props {\n    id: string;\n    className?: string;\n    onClick?: React.MouseEventHandler<Element>;\n    active?: boolean;\n}\n\n\nconst Tab = (props: React.PropsWithChildren<Props>) => {\n    const handleClick = (e: React.MouseEvent<HTMLLIElement>) => {\n        if (props.onClick) {\n            props.onClick(e);\n        }\n    };\n    const className = ((props.active) ? \"active\" : \"\") + (props.className || \"\");\n    return (\n        <li className={`tabstrip-tab ${className}`} onClick={handleClick}>\n            {props.children}\n        </li>\n    );\n};\n\nexport default Tab;\n","import Icon, { IconSize } from 'components/ui/common/Icon';\nimport * as React from \"react\";\nimport { AdventurerStoreState } from \"store/types/adventurer\";\nimport \"./styles/adventureravatar.scss\";\n\nexport interface Props {\n    adventurer: AdventurerStoreState;\n    className?: string;\n    displayName?: boolean;\n    onClick?: (adventurerId: string) => void;\n    size?: IconSize;\n}\n\n/**\n * The AdventurerAvatar displays the avatar of an adventurer\n */\nconst AdventurerAvatar = (props: Props) => {\n    const {\n        adventurer,\n        size\n    } = props;\n\n    const className = `${(props.className || \"\")} avatar`;\n\n    const handleClick = () => {\n        if (props.onClick) {\n            props.onClick(props.adventurer.id);\n        }\n    };\n    return (\n        <Icon\n            className={className}\n            image={adventurer.avatarImg}\n            size={size}\n            onClick={handleClick}\n        />\n    );\n};\n\nexport default AdventurerAvatar;\n","import React from \"react\";\nimport Tabstrip from 'components/ui/tabs/Tabstrip';\nimport { AdventurerStoreState } from 'store/types/adventurer';\nimport Tab from 'components/ui/tabs/Tab';\nimport AdventurerAvatar from 'components/ui/adventurer/AdventurerAvatar';\nimport { IconSize } from 'components/ui/common/Icon';\n\ninterface Props {\n    adventurers: AdventurerStoreState[];\n    selectedAdventurerId?: string;\n    onAdventurerTabSelected: (adventurerId: string) => void;\n    disabled?: boolean;\n}\n\n// Shows adventurer portraits in a tabstrip\nconst AdventurerTabstrip = (props: Props) => {\n    const {adventurers, onAdventurerTabSelected} = props;\n\n    const handleAdventurerTabSelected = (adventurerId: string) => {\n        const adventurer = props.adventurers.find(a => a.id === adventurerId);\n        if (adventurer) onAdventurerTabSelected(adventurer.id);\n    }\n\n    const renderAdventurerTab = (adventurer: AdventurerStoreState) => (\n        <Tab id={adventurer.id} key={adventurer.id}>\n            <AdventurerAvatar adventurer={adventurer} size={IconSize.small}/>\n        </Tab>\n    );\n    return (\n        <Tabstrip\n            className=\"adventurers-tabstrip\"\n            onTabSelected={handleAdventurerTabSelected}\n            activeTab={props.selectedAdventurerId}\n            disabled={props.disabled}\n        >\n            {adventurers.map((a) => renderAdventurerTab(a))}\n        </Tabstrip>\n    )\n}\n\nexport default AdventurerTabstrip;","import { AdventurerStoreState } from 'store/types/adventurer';\nimport { QuestStoreState, QuestStatus } from 'store/types/quest';\nimport { StoreState } from 'store/types';\nimport { useSelector } from 'react-redux';\nimport { useMemo, useCallback } from 'react';\nimport { EquipmentSlotType } from 'components/ui/adventurer/EquipmentSlot';\nimport { Apparel, getDefinition } from 'definitions/items/apparel';\n\nconst getAdventurersInTown = (adventurers: AdventurerStoreState[], quests: QuestStoreState[]): AdventurerStoreState[] => {\n    // Get an array of all adventurer ids on any active quest\n    const adventurersOnQuest = quests.reduce<string[]>((acc, val: QuestStoreState) => {\n        if (val.status === QuestStatus.active) {\n            acc.push(...val.party);\n        }\n        return acc;\n    }, []);\n\n    return adventurers.filter((a) => adventurersOnQuest.indexOf(a.id) === -1);\n};\n\n/** Returns all the adventurers currently not on a mission */\nexport const useAdventurersInTown = () => {\n    const adventurers = useSelector<StoreState, AdventurerStoreState[]>(store => store.adventurers);\n    const quests = useSelector<StoreState, QuestStoreState[]>(store => store.quests);\n\n    const adventurersInTown = useMemo(() => {\n        return getAdventurersInTown(adventurers, quests)\n    }, [adventurers, quests]);\n\n    return adventurersInTown;\n}\n\n/** Returns the adventurer from store */\nexport const useAdventurerState = (adventurerId: string) => {\n    const adventurerSelector = useCallback(\n        (state: StoreState) => state.adventurers.find((q) => q.id === adventurerId)!,\n        [adventurerId]\n    );\n    return useSelector<StoreState, AdventurerStoreState>(adventurerSelector);\n}\n\n/* Returns a map keyed by EquipmentSlotType with DR of an adventurer.\n   0 if nothing worn or if item does not have DR */\nexport const useAdventurerDamageReduction = (adventurerId: string): { [key: string]: number } => {\n    const adventurer = useAdventurerState(adventurerId);\n    const findDR = (type: EquipmentSlotType) => {\n        const item: Apparel|undefined = adventurer.equipment[type as EquipmentSlotType] as Apparel;\n        if (!item) return 0;\n        return getDefinition(item).damageReduction || 0;\n    }\n    return {\n        [EquipmentSlotType[EquipmentSlotType.head]]: findDR(EquipmentSlotType.head),\n        [EquipmentSlotType[EquipmentSlotType.chest]]: findDR(EquipmentSlotType.chest),\n        [EquipmentSlotType[EquipmentSlotType.hands]]: findDR(EquipmentSlotType.hands),\n        [EquipmentSlotType[EquipmentSlotType.shoulders]]: findDR(EquipmentSlotType.shoulders),\n        [EquipmentSlotType[EquipmentSlotType.legs]]: findDR(EquipmentSlotType.legs),\n        [EquipmentSlotType[EquipmentSlotType.feet]]: findDR(EquipmentSlotType.feet),\n    }\n}\n\n\n\n","import * as React from \"react\";\r\nimport { PropsWithChildren } from 'react';\r\nimport { DragSourceType, DragType } from \"constants/dragging\";\r\nimport { Item } from \"definitions/items/types\";\r\nimport { ConnectDropTarget, DropTarget, DropTargetConnector, DropTargetMonitor, DropTargetSpec } from \"react-dnd\";\r\nimport { InventoryItemDragInfo } from '../items/DraggableItemIcon';\r\nimport { IconSize } from '../common/Icon';\r\nimport { itemAndEquipmentSlotMatch } from '../adventurer/EquipmentSlot';\r\n\r\nconst dropTarget: DropTargetSpec<Props> = {\r\n    drop(props: Props, monitor: DropTargetMonitor) {\r\n        props.onDrop(monitor.getItem());\r\n    },\r\n    canDrop(props: Props, monitor: DropTargetMonitor) {\r\n        const dragInfo: InventoryItemDragInfo = monitor.getItem();\r\n        if (dragInfo.sourceType === DragSourceType.adventurerEquipment && dragInfo.inventorySlot !== undefined) {\r\n            return props.item == null || itemAndEquipmentSlotMatch(props.item, dragInfo.inventorySlot);\r\n        }\r\n        return props.canDropHere ? props.canDropHere(dragInfo) : true;\r\n    },\r\n};\r\n\r\nexport interface Props {\r\n    item: Item | null;\r\n    size?: IconSize;\r\n    onDrop: (info: InventoryItemDragInfo) => void;\r\n    canDropHere?: ( dragInfo: InventoryItemDragInfo ) => boolean;\r\n}\r\n\r\nexport interface DropSourceProps {\r\n    canDrop: boolean;\r\n    isOver: boolean;\r\n    connectDropTarget: ConnectDropTarget;\r\n}\r\n\r\nconst collect = (connect: DropTargetConnector, monitor: DropTargetMonitor) => ({\r\n    canDrop: monitor.canDrop(),\r\n    connectDropTarget: connect.dropTarget(),\r\n    isOver: monitor.isOver(),\r\n});\r\n\r\n/**\r\n * The InventorySlot displays a slot in which an item can be placed.\r\n */\r\nconst InventorySlot = (props: PropsWithChildren<Props> & DropSourceProps) => {\r\n    const {\r\n        isOver,\r\n        canDrop,\r\n        connectDropTarget,\r\n    } = props;\r\n    const isActive = isOver && canDrop;\r\n\r\n    const classNames = [\r\n        \"inventory-item\",\r\n        ...(isActive ? [\"drop-active\"] : []),\r\n        ...(!isActive && canDrop ? [\"drop-possible\"] : [])\r\n    ];\r\n\r\n\r\n    return connectDropTarget(\r\n        <div className={classNames.join(\" \")}>\r\n            { props.children }\r\n        </div>,\r\n    );\r\n}\r\n\r\nexport default DropTarget<Props, DropSourceProps>(\r\n    DragType.ITEM,\r\n    dropTarget,\r\n    collect,\r\n)(InventorySlot);\r\n","import * as React from \"react\";\r\nimport { IconSize } from 'components/ui/common/Icon';\r\nimport { DragSourceType, DragType } from \"constants/dragging\";\r\nimport { Item } from \"definitions/items/types\";\r\nimport ItemIcon from \"./ItemIcon\";\r\nimport { ConnectDragSource, DragSource, DragSourceConnector, DragSourceMonitor, DragSourceSpec } from \"react-dnd\";\r\nimport { useMemo } from \"react\";\r\nimport { ItemSource } from \"constants/items\";\r\n\r\nexport interface Props {\r\n    index: number;\r\n    item: Item;\r\n    sourceType: DragSourceType;\r\n    sourceId?: string;\r\n    size?: IconSize;\r\n\r\n    onStartDrag?: () => void;\r\n    onClick?: (event: React.MouseEvent) => void;\r\n}\r\n\r\ninterface CollectedProps {\r\n    isDragging: boolean;\r\n    connectDragSource: ConnectDragSource;\r\n}\r\n\r\nexport interface InventoryItemDragInfo {\r\n    item: Item;\r\n    inventorySlot?: number;\r\n    sourceId?: string;\r\n    sourceType: DragSourceType;\r\n}\r\n\r\n/**\r\n * Specifies the drag source contract.\r\n * Only `beginDrag` function is required.\r\n */\r\nconst source: DragSourceSpec<Props, InventoryItemDragInfo> = {\r\n    beginDrag(props: Props) {\r\n        const { \r\n            onStartDrag,\r\n            index,\r\n            item,\r\n            sourceId,\r\n            sourceType\r\n        } = props;\r\n        onStartDrag?.();\r\n\r\n        // Return the data describing the dragged item\r\n        return {\r\n            inventorySlot: index,\r\n            item,\r\n            sourceId,\r\n            sourceType,\r\n        };\r\n    },\r\n};\r\n\r\n/**\r\n * Specifies which props to inject into your component.\r\n */\r\nfunction collect(connect: DragSourceConnector, monitor: DragSourceMonitor) {\r\n    return {\r\n        connectDragSource: connect.dragSource(),\r\n        isDragging: monitor.isDragging(),\r\n    };\r\n}\r\n\r\nconst DraggableItemIcon = (props: Props & CollectedProps) => {\r\n\r\n    const { item, onClick, isDragging, connectDragSource, size, index, sourceType, sourceId } = props;\r\n    const handleClick = (event: React.MouseEvent) => {\r\n        onClick?.(event);\r\n    };\r\n    if (isDragging) {\r\n        // TODO: can show some sort of empty state?\r\n        return null;\r\n    }\r\n    const source = useMemo<ItemSource>(() => ({\r\n        origin: sourceType,\r\n        id: sourceId,\r\n        slot: index\r\n    }), []);\r\n\r\n    // The wrapping div is needed by ReactDnD\r\n    return connectDragSource((\r\n        <div>\r\n            <ItemIcon\r\n                item={item}\r\n                source={source}\r\n                onClick={handleClick}\r\n                size={size}\r\n            />\r\n        </div>\r\n    ));\r\n}\r\n\r\nexport default DragSource<Props, CollectedProps>(DragType.ITEM, source, collect)(DraggableItemIcon);\r\n","import * as React from \"react\";\nimport { DragSourceType } from \"constants/dragging\";\nimport {Item} from \"definitions/items/types\";\nimport InventorySlot from \"./InventorySlot\";\nimport DraggableItemIcon, { InventoryItemDragInfo } from '../items/DraggableItemIcon';\nimport { IconSize } from '../common/Icon';\nimport \"./styles/inventory.scss\";\n\nexport interface Props {\n    items: (Item|null)[];\n    sourceId?: string;   // who does this inventory belong to?\n    sourceType: DragSourceType;\n    iconSize?: IconSize;\n    className?: string;\n    onDropItem: (item: Item, fromSlot: number, toSlot: number, sourceType: DragSourceType, sourceId?: string) => void;\n    onStartDrag?: (item: Item, fromSlot: number) => void;\n    canDropHere?: (dragInfo: InventoryItemDragInfo) => boolean;\n}\n\n/**\n * Inventory is used to show Items. They can be dragged about\n * @param props\n */\nconst Inventory = (props: Props) => {\n    const { items, canDropHere, onStartDrag } = props;\n    const slots = [];\n    for (let i = 0; i < items.length; i++) {\n        let contents;\n        const item = items[i];\n        const handleDrop = (dragInfo: InventoryItemDragInfo) => {\n            if (dragInfo.inventorySlot === i && dragInfo.sourceType === props.sourceType && dragInfo.sourceId === props.sourceId) {\n                return;\n            }\n            if (props.onDropItem && dragInfo.inventorySlot !== undefined) {\n                const {inventorySlot: fromSlot} = dragInfo;\n                props.onDropItem(dragInfo.item, fromSlot, i, dragInfo.sourceType, dragInfo.sourceId);\n           }\n        };\n\n        const handleCheckDrop = (dragInfo: InventoryItemDragInfo) => {\n            return canDropHere ? canDropHere(dragInfo) : true;\n        }\n\n        const handleStartDrag = () => {\n            if (item) {\n                onStartDrag?.(item, i);\n            }\n        }\n\n        if (item) {\n            contents = (\n                <DraggableItemIcon\n                    index={i}\n                    sourceId={props.sourceId}\n                    sourceType={props.sourceType}\n                    item={item}\n                    onStartDrag={handleStartDrag}\n                />\n            );\n       }\n\n        const slot = (\n            <InventorySlot\n                key={`inventory-slot-${i}`}\n                item={item}\n                size={props.iconSize}\n                onDrop={handleDrop}\n                canDropHere={handleCheckDrop}\n            >\n                {contents}\n            </InventorySlot>\n        );\n        slots.push(slot);\n   }\n    return (\n        <div className={`inventory ${props.className ? props.className : \"\"}`}>\n            {slots}\n        </div>\n    );\n};\nexport default Inventory;\n","import React from 'react';\nimport \"./styles/loadingSpinner.scss\";\n\nconst LoadingSpinner = () => {\n    const rings = 5;\n    return (\n        <div className=\"loading-spinner\">\n        {[...Array(rings)].map((e, i) => (\n            <div className=\"ring\" key={i}>\n                <div className=\"inner\"/>\n            </div>\n        ))}\n        </div>\n    );\n}\nexport default LoadingSpinner;","import React, { createContext, PropsWithChildren, useState, useMemo, useEffect } from 'react';\nimport { useStore } from 'react-redux';\nimport { SceneControllerManager } from 'global/SceneControllerManager';\nimport { BaseSceneController } from 'mechanics/scenes/BaseSceneController';\nimport { StoreState } from 'store/types';\nimport LoadingSpinner from 'components/ui/loading/LoadingSpinner';\nimport usePrevious from 'hooks/usePrevious';\n\nexport const SceneControllerContext = createContext<BaseSceneController<unknown> | null>(null);\n\nexport interface Props {\n    questName: string;\n}\n\nconst SceneControllerContextProvider = (props: PropsWithChildren<Props>) => {\n    const {questName, children} = props;\n    const store = useStore<StoreState>();\n    const [loaded, setLoaded] = useState<boolean>(false);\n    const storeState = store.getState();\n    const quest = storeState.quests.find(q => q.name === questName)!;\n    const {scene, sceneName, questVars} = quest;\n    const previousQuestVars = usePrevious(questVars);\n\n    const controller = useMemo(() => {\n        if (!sceneName) {\n            return null;\n        }\n        return SceneControllerManager.getSceneController(questName, sceneName, store);\n    }, [questName, sceneName, store]);\n\n    useEffect(() => {\n        setLoaded(false);\n        if (sceneName && controller && !controller.dataLoading) {\n            const loadingComplete = () => {\n                setLoaded(true);\n\n                // If the store has no scene for this quest yet, create and store it!\n                if (!scene && controller) {\n                    controller.createScene();\n                    controller.sceneEntered();\n                }\n            }\n            controller.loadData(loadingComplete);\n        }\n    }, [controller, questName, scene, sceneName]);\n\n    useEffect(() => {\n        if (questVars !== previousQuestVars && controller) {\n            controller.updateScene();\n        }\n    }, [controller, previousQuestVars, questVars]);\n\n    if (controller && (controller.dataLoading || !loaded)) {\n        return (\n            <LoadingSpinner />\n        );\n    }\n    return (\n        <SceneControllerContext.Provider value={controller}>\n            {children}\n        </SceneControllerContext.Provider>\n    );\n};\n\nexport default SceneControllerContextProvider;","import { useContext } from 'react';\nimport { useDispatch } from 'react-redux';\nimport { Action } from \"redux\";\nimport { removeItemFromInventory, assignEquipment, addItemToInventory, removeEquipment, moveItemInInventory } from 'store/actions/adventurers';\nimport { removeItemFromWarehouse, addItemToWarehouse, moveItemInWarehouse } from 'store/actions/stockpile';\nimport { EquipmentSlotType } from 'components/ui/adventurer/EquipmentSlot';\nimport { Item, ItemType } from 'definitions/items/types';\nimport { DragSourceType } from 'constants/dragging';\nimport { AdventurerStoreState } from 'store/types/adventurer';\nimport { SceneControllerContext } from 'components/world/QuestPanel/context/SceneControllerContext';\nimport { InventoryItemDragInfo } from 'components/ui/items/DraggableItemIcon';\nimport { SoundManager } from 'global/SoundManager';\nimport { useStockpileState } from 'hooks/store/stockpile';\nimport { getDefinition } from 'definitions/items';\nimport { StockpileStoreState } from 'store/types/stockpile';\n\n/* Exposes\n- dropItemEquipment,\n- dropItemInventory,\n- dropItemWarehouse\nto use in various places in the UI when an item is dropped somewhere\n*/\nconst useItemDropActions = () => {\n    const dispatch = useDispatch();\n    const sceneController = useContext(SceneControllerContext);  // is only available when in a scene\n    const stockpile = useStockpileState();\n\n    // When an item gets dropped on equipment slot\n    const dropItemEquipment = (dragInfo: InventoryItemDragInfo, slotType: EquipmentSlotType, adventurer: AdventurerStoreState) => {\n        const item = dragInfo.item;\n        const actions: Action[] = [];\n\n        SoundManager.playSound(\"ui/equip\");\n\n        switch (dragInfo.sourceType) {\n            // Dragged from inventory\n            case DragSourceType.adventurerInventory: {\n                actions.push(\n                    // Item gets removed from inventory\n                    removeItemFromInventory(adventurer.id, dragInfo.inventorySlot ?? -1),\n                    // Item gets assigned to an equipment slot\n                    assignEquipment(adventurer.id, slotType, item),\n                );\n\n                const existingEquipment = adventurer.equipment[slotType as EquipmentSlotType];\n                if (existingEquipment) {\n                    // There is already an item in this slot. Place in inventory\n                    actions.push(addItemToInventory(adventurer.id, existingEquipment, dragInfo.inventorySlot ?? -1));\n                }\n                break;\n            }\n            // Dragged from warehouse.\n            case DragSourceType.warehouse: {\n                const definition = getDefinition(item)\n                actions.push(\n                    removeItemFromWarehouse(definition.itemType, dragInfo.inventorySlot ?? -1),\n                    assignEquipment(adventurer.id, slotType, item),\n                );\n\n                const existingEquipment = adventurer.equipment[slotType as EquipmentSlotType];\n                if (existingEquipment) {\n                    // There is already an item in this slot. Place in warehouse\n                    actions.push(addItemToWarehouse(existingEquipment, dragInfo.inventorySlot ?? -1));\n                }\n                break;\n            }\n\n            // Dragged from equipment slot (only applicable to weapons)\n            case DragSourceType.adventurerEquipment: {\n                actions.push(\n                    assignEquipment(adventurer.id, slotType, item)\n                );\n\n                const existingEquipment = adventurer.equipment[slotType as EquipmentSlotType];\n                const fromSlot = dragInfo.inventorySlot ?? -1;\n                if (existingEquipment) {\n                    // Another weapon was there, switch them\n                    actions.push(assignEquipment(adventurer.id, fromSlot, existingEquipment),)\n                } else {\n                    // Clear the slot where it came from\n                    actions.push(removeEquipment(adventurer.id, fromSlot));\n                }\n                break;\n            }\n        }\n        actions.forEach(a => dispatch(a));\n    };\n\n    // When an item gets dropped on an adventurer inventory\n    const dropItemInventory = (item: Item, fromSlot: number, toSlot: number, sourceType: DragSourceType, adventurer: AdventurerStoreState, sourceId?: string): void => {\n        const actions: Action[] = [];\n\n        switch (sourceType) {\n            // Drag from one inventory slot to another\n            case DragSourceType.adventurerInventory:\n                actions.push(moveItemInInventory(adventurer.id, fromSlot, toSlot))\n                break;\n\n            // Dragged from warehouse\n            case DragSourceType.warehouse: {\n                const definition = getDefinition(item)\n                actions.push(\n                    removeItemFromWarehouse(definition.itemType, fromSlot),\n                    addItemToInventory(adventurer.id, item, toSlot),\n                )\n                const otherItem = adventurer.inventory[toSlot];\n                if (otherItem) {\n                    actions.push(\n                        addItemToWarehouse(otherItem, fromSlot)\n                    )\n                }\n                break;\n            }\n\n            // Drag from equipment slot\n            case DragSourceType.adventurerEquipment: {\n                actions.push(\n                    addItemToInventory(adventurer.id, item, toSlot)\n                );\n\n                const existingEquipment = adventurer.inventory[toSlot];\n                if (existingEquipment) {\n                    // Was dropped on another piece of equipment in inventory, switch them\n                    actions.push(assignEquipment(adventurer.id, fromSlot, existingEquipment));\n                } else {\n                    // Clear the slot where it came from\n                    actions.push(removeEquipment(adventurer.id, fromSlot));\n                }\n                break;\n            }\n\n            // Dragged from lootCache on a scene\n            case DragSourceType.lootCache: {\n                if (sceneController && sourceId) {\n                    // Let the scene controller handle this action\n                    sceneController.takeItemFromCache(fromSlot, sourceId, adventurer.id, toSlot);\n                }\n            }\n        }\n        actions.forEach(a => dispatch(a));\n    };\n\n    // When an item gets dropped on the warehouse inventory\n    const dropItemWarehouse = (item: Item, fromSlot: number, toSlot: number, sourceType: DragSourceType, sourceId = \"\"): void => {\n        const actions: Action[] = [];\n        const definition = getDefinition(item)\n        const stockpileCategory = ItemType[definition.itemType] as keyof StockpileStoreState\n\n        switch (sourceType) {\n            // Dragged from the warehouse itself\n            case DragSourceType.warehouse: {\n                actions.push(\n                    moveItemInWarehouse(definition.itemType, fromSlot, toSlot)\n                )\n                const otherItem = stockpile[stockpileCategory][toSlot];\n                if (otherItem) {\n                    actions.push(\n                        addItemToInventory(sourceId, otherItem, fromSlot)\n                    )\n                }\n                break;\n            }\n            // Dragged from an adventurer inventory\n            case DragSourceType.adventurerInventory: {\n                actions.push(\n                    removeItemFromInventory(sourceId, fromSlot),\n                    addItemToWarehouse(item, toSlot)\n                )\n                \n                const otherItem = stockpile[stockpileCategory][toSlot];\n                if (otherItem) {\n                    actions.push(\n                        addItemToInventory(sourceId, otherItem, fromSlot)\n                    )\n                }\n                break;\n            }\n        }\n        actions.forEach(a => dispatch(a));\n    };\n    return {\n        dropItemEquipment,\n        dropItemInventory,\n        dropItemWarehouse\n    }\n}\n\nexport default useItemDropActions;","import React, { Fragment } from \"react\";\nimport { useAdventurerState } from 'hooks/store/adventurers';\nimport { TextManager } from 'global/TextManager';\nimport { ContextType } from 'constants/context';\nimport { TooltipManager } from 'global/TooltipManager';\nimport { WeaponType } from 'definitions/items/weapons';\nimport './styles/adventurerSkills.scss';\n\ninterface Props {\n    adventurerId: string;\n}\n\nconst AdventurerSkills = (props: Props) => {\n    const adventurer = useAdventurerState(props.adventurerId);\n\n    const renderSkill = (skill: WeaponType) => {\n        // const traitDefinition = getDefinition(trait);\n        const handleClick = (event: React.MouseEvent) => {\n            const origin = (event.currentTarget as HTMLElement);\n            const originRect = origin.getBoundingClientRect();\n            TooltipManager.showContextTooltip(ContextType.skill, skill, originRect);\n            event.stopPropagation();\n        };\n        return (\n            <Fragment key={skill}>\n                <li onClick={handleClick}>\n                    <span className=\"skill\" onClick={handleClick}>\n                        {TextManager.getSkillName(skill)}\n                    </span>\n                    <span>\n                        {adventurer.skills[skill]}\n                    </span>\n                    {/* {TextManager.getTraitName(trait)} */}\n                </li>\n            </Fragment>\n        )\n    };\n\n    if (!adventurer?.skills) {\n        return null;\n    }\n    return (\n        <>\n            <p>{TextManager.get(\"ui-adventurer-info-skills-title\")}</p>\n            <ul className=\"adventurer-skills\">\n                {Object.keys(adventurer.skills)?.map((s) => {\n                    const skill: WeaponType = s as WeaponType;\n                    return renderSkill(skill);\n                })}\n            </ul>\n        </>\n    )\n}\n\nexport default AdventurerSkills;","const CONSTANT = 0.5;\n\nexport function xpToLevel(xp: number) {\n    return Math.floor(CONSTANT * Math.sqrt(xp));\n}\n\nexport function levelToXp(level: number) {\n    return Math.pow(level / CONSTANT, 2);\n}\n\n// print out required xp\n// for(let i = 1; i < 20; i++) {\n//     console.log(levelToXp(i))\n// }","import * as React from \"react\";\nimport { levelToXp, xpToLevel } from 'mechanics/adventurers/levels';\nimport PlainProgressbar from 'components/ui/common/progress/PlainProgressbar';\nimport { TextManager } from 'global/TextManager';\nimport { useEffect, useMemo, useState } from \"react\";\nimport usePrevious from \"hooks/usePrevious\";\nimport { useAdventurerState } from \"hooks/store/adventurers\";\nimport { SoundManager } from \"global/SoundManager\";\n\nexport interface Props {\n    adventurerId: string;\n}\n\nconst Level = (props: Props) => {\n    const { adventurerId } = props;\n    const { xp } = useAdventurerState(adventurerId);\n    const currentLevel = xpToLevel(xp);\n    const currentLevelXp = levelToXp(currentLevel); // start\n    const nextLevel = currentLevel + 1;\n    const nextLevelXp = levelToXp(nextLevel);\n    const [dingAnimationRunning, setDingAnimationRunning] = useState(false)\n\n    const lastState = usePrevious({ currentLevel, currentLevelXp, nextLevel, nextLevelXp })\n    const lastAdventurer = usePrevious(adventurerId);\n\n    useEffect(() => {\n        if (lastAdventurer !== adventurerId) {\n            setDingAnimationRunning(false)\n        }\n        else if (nextLevel > (lastState?.nextLevel ?? 0)) {\n            SoundManager.playSound(\"ui/levelUp\");\n            setDingAnimationRunning(true);\n\n            setTimeout(() => {\n                setDingAnimationRunning(false)\n            }, 2000)\n        }\n    }, [adventurerId, lastAdventurer, lastState?.nextLevel, nextLevel])\n\n    const lastDingAnimationRunning = usePrevious(dingAnimationRunning);\n\n    const progress = useMemo(() => {\n        return dingAnimationRunning ? 1 : (xp - currentLevelXp) / (nextLevelXp - currentLevelXp)\n    }, [currentLevelXp, dingAnimationRunning, nextLevelXp, xp]);\n\n    return (\n        <div className=\"level\">\n            Level {currentLevel}\n            {<PlainProgressbar\n                progress={progress}\n                animationTime={lastAdventurer === adventurerId && !lastDingAnimationRunning ? 300 : 0}\n                label={dingAnimationRunning ?  TextManager.get(\"ui-adventurer-info-xp-level-up\") : TextManager.get(\"ui-adventurer-info-xp-progress\", {\n                    xp: Math.floor(xp - currentLevelXp),\n                    next: nextLevelXp - currentLevelXp\n                })}\n            />}\n        </div>\n    )\n}\nexport default Level;\n","export interface TraitDefinition {\n    trait: Trait;\n    hasEffect?: boolean;\n}\n\nexport enum Trait {\n    arrowFinder = \"arrowFinder\",\n    gloomy = \"gloomy\",\n    houseHouston = \"houseHouston\",\n    houseMaddox = \"houseMaddox\",\n    houseMonroe = \"houseMonroe\",\n}\n\n","import { createSelectorCreator, defaultMemoize } from 'reselect';\nimport stringArrayEqual from 'string-arrays-equal';\n\nexport const createStringArraySelector = createSelectorCreator<string>(\n  // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n  // @ts-ignore: https://github.com/reduxjs/reselect/issues/384\n  defaultMemoize,\n  stringArrayEqual\n);","import { useCallback, useMemo } from 'react';\nimport { StoreState } from 'store/types';\nimport { useSelector } from 'react-redux';\nimport { QuestStatus, QuestStoreState } from 'store/types/quest';\nimport { createSelector } from 'reselect';\nimport { createStringArraySelector } from 'utils/reselect';\nimport { SceneStoreState } from 'store/types/scene';\n\nconst getQuests = (state: StoreState) => state.quests;\nconst getQuestNames = (state: StoreState) => state.quests.map(q => q.name);\nconst getQuestStatus = (state: StoreState) => state.quests.map(q => q.status);\n\n\nconst getActiveQuests = (quests: QuestStoreState[]) => {\n    // returns the names of the active quests\n    return quests.filter((q) => q.status === QuestStatus.active);\n};\n\n// Returns the quest from redux store\nexport const useQuest = (questName: string) => {\n    const questSelector = useCallback(\n        (state: StoreState) => state.quests.find((q) => q.name === questName)!,\n        [questName]\n    );\n    const quest = useSelector<StoreState, QuestStoreState>(questSelector);\n    return quest;\n}\n\nexport const useQuestScene = (questName: string) => {\n    const scene = useSelector<StoreState, SceneStoreState | undefined>(\n        store => store.quests.find((q) => q.name === questName)?.scene)\n    return scene;\n}\n\n// Returns the active quests from the store\nexport const useActiveQuests = () => {\n    const selectMemoized = useMemo(() => {\n        const activeQuests = createSelector(\n            [getQuests],\n            getActiveQuests,\n        );\n\n        return activeQuests;\n    }, []);\n\n    return useSelector<StoreState, QuestStoreState[]>(selectMemoized);\n}\n\n// Returns the active quests from the store\nexport const useActiveQuestNames = () => {\n    const questNameSelector = useMemo(() => createStringArraySelector(\n        [getQuestNames, getQuestStatus],\n        (names: string[], statuses: QuestStatus[]) => names.filter((_: string, index: number) => statuses[index] === QuestStatus.active)\n    ), []);\n    return useSelector<StoreState, string[]>(questNameSelector);\n}\n","import React, { useContext, useMemo } from \"react\";\nimport { SceneControllerContext } from 'components/world/QuestPanel/context/SceneControllerContext';\nimport { TextManager } from 'global/TextManager';\nimport { useQuest } from 'hooks/store/quests';\nimport { AdventurerStoreState } from 'store/types/adventurer';\n\nexport interface Props {\n    adventurer: AdventurerStoreState;\n    questName?: string;\n}\n\n/** Used when AdventurerPanel is used in Quest view\n * todo: move outside of /world\n */\nconst ApIndicator = (props: Props) => {\n    const quest = useQuest(props.questName ?? \"\");\n    const controller = useContext(SceneControllerContext);\n\n    const ap = useMemo(() => {\n        if (!controller) return null;\n        return controller.getSceneActor(props.adventurer.id)?.ap || null;\n    }, [controller, props.adventurer.id]);\n\n    if (!quest?.scene?.combat) {\n        return null;\n    }\n    return (\n        <span>{TextManager.get(\"ui-adventurer-info-ap-remaining\", { ap })}</span>\n    );\n}\n\nexport default ApIndicator;","import { TraitDefinition, Trait } from './types';\n\nconst all = {\n    [Trait.arrowFinder]: {\n        trait: Trait.arrowFinder,\n        hasEffect: true\n    },\n    [Trait.gloomy]: {\n        trait: Trait.gloomy,\n        hasEffect: true\n    },\n    [Trait.houseHouston]: {\n        trait: Trait.houseHouston,\n    },\n    [Trait.houseMaddox]: {\n        trait: Trait.houseMaddox,\n    },\n    [Trait.houseMonroe]: {\n        trait: Trait.houseMonroe,\n    }\n};\n\nexport function getDefinition(trait: Trait): TraitDefinition {\n    return all[trait];\n}","import React, { Fragment } from \"react\";\nimport { useAdventurerState } from 'hooks/store/adventurers';\nimport { Trait } from 'definitions/traits/types';\nimport { getDefinition } from 'definitions/traits';\nimport { TextManager } from 'global/TextManager';\nimport { ContextType } from 'constants/context';\nimport { TooltipManager } from 'global/TooltipManager';\nimport './styles/adventurerTraits.scss';\n\ninterface Props {\n    adventurerId: string;\n}\n\nconst AdventurerTraits = (props: Props) => {\n    const adventurer = useAdventurerState(props.adventurerId);\n\n    const renderTrait = (trait: Trait, last: boolean) => {\n        const traitDefinition = getDefinition(trait);\n        const handleClick = (event: React.MouseEvent) => {\n            const origin = (event.currentTarget as HTMLElement);\n            const originRect = origin.getBoundingClientRect();\n            TooltipManager.showContextTooltip(ContextType.trait, traitDefinition, originRect);\n            event.stopPropagation();\n        };\n        return (\n            <Fragment key={trait}>\n                <li onClick={handleClick}>\n                    {TextManager.getTraitName(trait)}\n                </li>\n                {!last && (', ')}\n            </Fragment>\n        )\n    };\n\n    if (!adventurer?.traits) {\n        return null;\n    }\n    return (\n        <>\n            <p>{TextManager.get(\"ui-adventurer-info-traits-title\")}</p>\n            <ul className=\"adventurer-traits\">\n                {adventurer.traits && adventurer.traits.map((t, i, a)=> renderTrait(t, i === a.length -1))}\n            </ul>\n        </>\n    )\n}\n\nexport default AdventurerTraits;","import React from \"react\";\nimport './styles/guy.scss';\nimport { EquipmentSlotType } from 'components/ui/adventurer/EquipmentSlot';\nimport { useAdventurerDamageReduction } from 'hooks/store/adventurers';\n\n\nexport interface Props {\n    adventurerId: string\n}\n\n// A silhouette of a person with the Damage Reduction numbers\nconst Guy = (props: Props) => {\n    const {adventurerId} = props;\n\n    const damageReduction = useAdventurerDamageReduction(adventurerId);\n    const renderDamageReduction = (equipmentType: EquipmentSlotType) => {\n        const dR = damageReduction[EquipmentSlotType[equipmentType]];\n        if (!dR) {\n            return null;\n        }\n        return (\n            <div className={EquipmentSlotType[equipmentType]} key={equipmentType}>\n                {dR}\n            </div>\n        )\n    }\n\n    return (\n        <li className=\"guy\">\n            {(renderDamageReduction(EquipmentSlotType.head))}\n            {(renderDamageReduction(EquipmentSlotType.chest))}\n            {(renderDamageReduction(EquipmentSlotType.hands))}\n            {(renderDamageReduction(EquipmentSlotType.shoulders))}\n            {(renderDamageReduction(EquipmentSlotType.legs))}\n            {(renderDamageReduction(EquipmentSlotType.feet))}\n        </li>\n    )\n}\n\nexport default Guy;","import React from \"react\";\nimport { AdventurerStoreState } from 'store/types/adventurer';\nimport EquipmentSlot, { EquipmentSlotType } from 'components/ui/adventurer/EquipmentSlot';\nimport { Item } from 'definitions/items/types';\nimport DraggableItemIcon, { InventoryItemDragInfo } from 'components/ui/items/DraggableItemIcon';\nimport { DragSourceType } from 'constants/dragging';\nimport { TextManager } from 'global/TextManager';\nimport { IconSize } from 'components/ui/common/Icon';\nimport Guy from './Guy';\nimport './styles/adventurerEquipment.scss';\n\nexport interface Props {\n    adventurer: AdventurerStoreState\n    onDropItemEquipment: (dragInfo: InventoryItemDragInfo, slotType: EquipmentSlotType) => void;\n}\n\n// Shows the gear an adventurer is wearing\nconst AdventurerEquipment = (props: Props) => {\n    const { adventurer, onDropItemEquipment } = props;\n\n    const getEquipmentSlot = (slotType: EquipmentSlotType) => {\n        // returns EquipmentSlot\n        const item: Item | undefined = adventurer.equipment[slotType];\n\n        return (\n            <li className={EquipmentSlotType[slotType]}>\n                <EquipmentSlot\n                    onDrop={(dragInfo: InventoryItemDragInfo) => onDropItemEquipment(dragInfo, slotType)}\n                    type={slotType}\n                >\n                    {item && (\n                        <DraggableItemIcon\n                            index={slotType}\n                            sourceId={adventurer.id}\n                            sourceType={DragSourceType.adventurerEquipment}\n                            item={item}\n                            size={IconSize.medium}\n                        />\n                    )}\n                </EquipmentSlot>\n                <span className=\"info\">{TextManager.getEquipmentSlot(slotType)}</span>\n            </li>\n        );\n    };\n    return (\n        <ul className=\"adventurer-equipment\">\n            {getEquipmentSlot(EquipmentSlotType.head)}\n            {getEquipmentSlot(EquipmentSlotType.chest)}\n            {getEquipmentSlot(EquipmentSlotType.hands)}\n            {getEquipmentSlot(EquipmentSlotType.shoulders)}\n            {getEquipmentSlot(EquipmentSlotType.legs)}\n            {getEquipmentSlot(EquipmentSlotType.feet)}\n            {getEquipmentSlot(EquipmentSlotType.mainHand)}\n            {getEquipmentSlot(EquipmentSlotType.offHand)}\n            <Guy adventurerId={adventurer.id} />\n        </ul>\n    )\n}\n\nexport default AdventurerEquipment;","import React, {  } from \"react\";\nimport { DragSourceType } from 'constants/dragging';\nimport Inventory from 'components/ui/inventory/Inventory';\nimport useItemDropActions from 'hooks/actions/useItemActions';\nimport { EquipmentSlotType } from 'components/ui/adventurer/EquipmentSlot';\nimport { InventoryItemDragInfo } from 'components/ui/items/DraggableItemIcon';\nimport { Item } from 'definitions/items/types';\nimport AdventurerSkills from './AdventurerSkills';\nimport { useAdventurerState } from 'hooks/store/adventurers';\nimport Level from 'components/ui/adventurer/AdventurerPanel/Level';\nimport ApIndicator from './ApIndicator';\nimport AdventurerTraits from './AdventurerTraits';\nimport AdventurerEquipment from './AdventurerEquipment';\nimport \"./styles/adventurerPanel.scss\";\nimport { TextManager } from \"global/TextManager\";\n\nexport interface Props {\n    adventurerId: string;\n    questName?: string;\n    horizontalMode?: boolean;\n\n    name?: boolean; // whether to show the adventurer name\n    levelBar?: boolean; // whether to show the level bar\n    traits?: boolean; // whether to show traits\n    skills?: boolean; // whether to show skills\n\n    onStartInventoryItemDrag?: (item: Item, fromSlot: number) => void;\n}\n\n/** Vertical panel showing adventurer info\n */\nconst AdventurerPanel = (props: Props) => {\n    const {\n        adventurerId,\n        questName,\n        horizontalMode,\n        name = true,\n        levelBar = true,\n        traits = true,\n        skills = true,\n        onStartInventoryItemDrag\n    } = props;\n    const adventurer = useAdventurerState(adventurerId);\n    // const renderAttributes = () => Object.keys(adventurer.stats).map((stat) => {\n    //     const value: number = adventurer.stats[stat];\n    //     return <div key={`${adventurer.id}-${stat}`} > <b>{stat}</b>: {value.toFixed(1)} </div>;\n    // });\n\n    const {\n        dropItemEquipment,\n        dropItemInventory\n    } = useItemDropActions();\n\n    const handleDropItemEquipment = (dragInfo: InventoryItemDragInfo, slotType: EquipmentSlotType) => {\n        dropItemEquipment(dragInfo, slotType, adventurer);\n    };\n    const handleDropItemInventory = (item: Item, fromSlot: number, toSlot: number, sourceType: DragSourceType, sourceId?: string) => {\n        dropItemInventory(item, fromSlot, toSlot, sourceType, adventurer, sourceId);\n    }\n\n    return (\n        <div className={`adventurer-panel${(horizontalMode ? \" horizontal\" : \"\")}`}>\n           <section id=\"common\">\n               <div className=\"info\">\n               { name && (\n                    <div className=\"name\">\n                        {adventurer.name}\n                        {questName && <ApIndicator questName={questName} adventurer={adventurer} />}\n                    </div>\n                )}\n                { levelBar && <Level adventurerId={adventurer.id}/> }\n                { traits && <AdventurerTraits adventurerId={adventurer.id}/> }\n                </div>\n            </section>\n            <section id=\"skills\">\n                { skills && <AdventurerSkills adventurerId={adventurer.id}/> }\n                {/* <div className=\"renderAttributes\">\n                    {renderAttributes()}\n                </div> */}\n            </section>\n            <section id=\"equipment\">\n                <div className=\"equipment\">\n                    <p>{TextManager.get(\"ui-adventurer-info-equipment-title\")}</p>\n                    <AdventurerEquipment\n                        adventurer={adventurer}\n                        onDropItemEquipment={handleDropItemEquipment}\n                    />\n                </div>\n            </section>\n            <section id=\"inventory\">\n            <p>{TextManager.get(\"ui-adventurer-info-inventory-title\")}</p>\n                <Inventory\n                    sourceType={DragSourceType.adventurerInventory}\n                    sourceId={adventurer.id}\n                    items={adventurer.inventory}\n                    className=\"inventory-small\"\n                    onDropItem={handleDropItemInventory}\n                    onStartDrag={onStartInventoryItemDrag}\n                />\n            </section>\n        </div>\n    )\n}\n\nexport default AdventurerPanel;\n","import React, { useEffect, useRef } from \"react\";\nimport debounce from \"debounce\";\nimport { TextManager } from \"global/TextManager\";\nimport { HashLink } from 'react-router-hash-link';\nimport iconPerson from './styles/images/icon-person.png';\nimport iconHelmet from './styles/images/icon-helmet.png';\nimport iconCrosshair from './styles/images/icon-crosshair.png';\nimport iconSword from './styles/images/icon-sword.png';\nimport \"./styles/adventurerSectionSelection.scss\"\n\nconst AdventurerSectionSelection = () => {\n    const ref = useRef<HTMLUListElement>(null);\n\n    useEffect(() => {\n        const sectionParent = ref?.current?.parentNode as HTMLElement;\n  \n        const onScroll = debounce(() => {\n            const fromTop = sectionParent.scrollTop;\n            ref.current?.querySelectorAll(\"a\")?.forEach(link => {\n                const hash = link.hash.substring(link.hash.lastIndexOf(\"#\"));\n                const section = document.querySelector(hash) as HTMLElement;\n            \n                if (section && section.offsetTop <= fromTop && section.offsetTop + section.clientHeight > fromTop) {\n                    link.classList.add(\"active\");\n                } else {\n                    link.classList.remove(\"active\");\n                }\n            });\n        }, 50);\n        sectionParent?.addEventListener(\"scroll\", onScroll);\n        return () => {\n            sectionParent?.removeEventListener(\"scroll\", onScroll);\n        }\n    }, []);\n    \n    return (\n        <ul className=\"adventurer-section-selection\" ref={ref}>\n            <li title={TextManager.get(\"ui-adventurer-info-general-title\")}>\n                <HashLink smooth to=\"#common\" className=\"active\">  \n                    <img src={iconPerson} />\n                </HashLink>\n            </li>\n            <li title={TextManager.get(\"ui-adventurer-info-skills-title\")}>\n                <HashLink smooth to=\"#skills\">  \n                    <img src={iconCrosshair} />\n                </HashLink>\n            </li>\n            <li title={TextManager.get(\"ui-adventurer-info-equipment-title\")}>\n                <HashLink smooth to=\"#equipment\">  \n                    <img src={iconHelmet} />\n                </HashLink>\n            </li>\n            <li title={TextManager.get(\"ui-adventurer-info-inventory-title\")}>\n                <HashLink smooth to={\"#inventory\" }>  \n                    <img src={iconSword} />\n                </HashLink>\n            </li>\n        </ul>\n    )\n}\n\nexport default AdventurerSectionSelection;\n","export default \"data:image/png;base64,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UmVhZHlxyWU8AAADcWlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDIgNzkuMTYwOTI0LCAyMDE3LzA3LzEzLTAxOjA2OjM5ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIgeG1wTU06T3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOjNmZjJmYzA3LThiNGEtNjQ0Yi1iMjNkLTViMDFlOWRlOGVjZSIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo2RDkzMzJCMjUxNkExMUVBOUM3MDk0RTkwOTBCRTk4NiIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo2RDkzMzJCMTUxNkExMUVBOUM3MDk0RTkwOTBCRTk4NiIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgKFdpbmRvd3MpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6N2RhZTkyNzMtYWI4NC03OTQ0LThjZjctZjliMTFkZjk3MTk4IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjNmZjJmYzA3LThiNGEtNjQ0Yi1iMjNkLTViMDFlOWRlOGVjZSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PvfQy5UAAAAGUExURf///////1V89WwAAAACdFJOU/8A5bcwSgAAAkZJREFUeNrs3cGO4yAUBdHi/396dqPuie3IgOFdT9U+4ixa6gTDM21qHDV5iYe189Ws4E5Fs4g7D81C7xwzS70zzCz2jptZ7h01swM8RGaHd8jMJnA/mV3gbjLbwL1k9oE7yezzdprZCg4Us0IMe8lsBt8nsxt8m8x28F3y28Wwn0wB8D3yu8VQgUwJ8B3ym8VQg/xiMRQhK64jhipkxWXEUIasuIoY6pAVK1ZcVgyFyIoVK1asWLFixUvFfttUrFixu1iK3fFW7NMxxc+KfZK+QOyJkAXivHNCnh5bIc47U+hJ0xXivPPHgWe8A8/RB95VCLzBMpHcVonj7jW1wLtjgffzAu9AjpoHlm1byG2PuNs8tmZbT247xXn3/m+bJyzX2kLzlMXanBZx2/88h+WCPXuFlpbiyuKehy4z/rqn/Wp65kOP71f0fOhRccd/tq17m2F79GnPTNNOhLCuKWLWNi6GYmSKeb+bKef9ZqYi+JJMSfAVmZLey+8oVcGnZMqCz8jUBZ+QKQw+JlMZfEimNPiITG3wAZni4E8y1cEfZMqD/yVTHxwo5lwMAWQSwL/I0WKIIJMB/kEOFkMIOVcMKWRiwIFissWQQw4VQxA5UwxJZMVLxBBFVqz4SExWihW/Q2xmZmZmZmZmZmZmZmZmZmZmZmZmZmZmVUq7DxJ8azMCHTVx43i2QsromOJTpj68pee7HXHrzik80dact3nJbdXeOv5Ne2+acAFs14zprdiRyeN7sPveaNJHXf8miDHo3/4IMAAA0TKWRcqboAAAAABJRU5ErkJggg==\"","export default \"data:image/png;base64,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UmVhZHlxyWU8AAADcWlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDIgNzkuMTYwOTI0LCAyMDE3LzA3LzEzLTAxOjA2OjM5ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIgeG1wTU06T3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOjNmZjJmYzA3LThiNGEtNjQ0Yi1iMjNkLTViMDFlOWRlOGVjZSIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDoyNzBDNjVEMjUxNzExMUVBODM1MkY4N0UwMUZBQ0UxNyIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDoyNzBDNjVEMTUxNzExMUVBODM1MkY4N0UwMUZBQ0UxNyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgKFdpbmRvd3MpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6ODUyMmFiMmUtMjAyMS1hYTQ0LWE2NGUtODI3YjBkYzg0NTA5IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjNmZjJmYzA3LThiNGEtNjQ0Yi1iMjNkLTViMDFlOWRlOGVjZSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PtCL+cMAAAAGUExURf///////1V89WwAAAACdFJOU/8A5bcwSgAAA49JREFUeNrs3VFy3DAMA1Dg/pfuBTqTFQlqBBP8TKw1X+S0WWpFgVcD/4nLGQQccMABBxxwwAEHHHDAAQcccMABBxxwwAEHvAGMP+M7YByEPRiFsAWjEX5gtMMKDEm4gCEMAzDE8TgYA/EwGEPxKBiD8SAYw/EYGBfiJTBgI4YNV0SGk1chhhNXQYaZty2GGbdNxlUvf/7imBi3vH8V8W6JccP7a9XyhhjT3tMy7bQYo9xaXXqUjEFvvRA/KMaYt7fyMCbGjFex1DIjxoT3bOjIjZTgThqCy5tiyL3Hg+fuJgH3EhANaYhx1UvVmLpYCq4NH79pB9y9tXBYUQyZt/wCd+5cAvfvqh1ZEeOql+KhBTGueqkeey7WgHkDzMtgzQOlH376U7vq5cT4w1+M9q14E8xrYNV/+yOvcPSP/VWvIrp/CQT8uLebDOy8zXRaYPItsQr8mreVUQNMPifWgOEDxiSYtJxieHrraQVs4i0nVgSTr4q7YLiBMQImbacYthNcTA6+E1zLrgImnxZ3wHAEQw0mnacYzhNcyTBgqye6kCKsJ7iQI7wn+DzJgP94LdJBXAPDF4yAq2DS/ZkO2O2JPk00YLsn+jDTgNeC4Q2GBEz6T3HAAQe8B0waic9qQrd7TfQqWG59FwIOOOCAAw444IADDjjggAMOOOCAAx7K9rNFvJRpAw444M+CP70gns94BLwBnE/ifQmcT9OuBOcT8V8Cr9vkkW08O8Ff3oq3brNlttN+HrxuS/y+pgfr2lqkcclTYgyA1zUf2tdeal0DsX0t4tL18PPgdY0897VqXdeMd1+75XUNtfe1TF/XFD/nPHwfvO7okn2H0+w7fmjdAVP7jhDbd0jcumMA9x30uO8oz32Hte47jnffgcvrjtTed2h676x6weXNd6eVN7SNNPpXd9+Nl97BSzf4QX8XOfinTY898Ngmz2KNprqPs3GZqLpULUoVt66WL5JV0+pVuNJ23doVyuJho+xY2aN8/l11sbRTZy1szD77zkRxuFVYPt+O/vMXx/bg9yrphj0HuksHdi0W2mslbi0lBItDTlwJmE5eapb/bLgqMG28lC3wenCF4FmyMEvyfbI0R/J1sjhD8m2yPD/yZfJAdpyIV7VjYAV5KjGOxYPaWXAVPZwRx+Md7CXw4DLCw+DCUkvAAQcccMABBxxwwAEHHHDAAQcccMABBxxwwB8E/xNgADKop7nSnBUxAAAAAElFTkSuQmCC\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALAAAADsCAMAAADjJdzgAAAKQ2lDQ1BJQ0MgcHJvZmlsZQAAeNqdU3dYk/cWPt/3ZQ9WQtjwsZdsgQAiI6wIyBBZohCSAGGEEBJAxYWIClYUFRGcSFXEgtUKSJ2I4qAouGdBiohai1VcOO4f3Ke1fXrv7e371/u855zn/M55zw+AERImkeaiagA5UoU8Otgfj09IxMm9gAIVSOAEIBDmy8JnBcUAAPADeXh+dLA//AGvbwACAHDVLiQSx+H/g7pQJlcAIJEA4CIS5wsBkFIAyC5UyBQAyBgAsFOzZAoAlAAAbHl8QiIAqg0A7PRJPgUA2KmT3BcA2KIcqQgAjQEAmShHJAJAuwBgVYFSLALAwgCgrEAiLgTArgGAWbYyRwKAvQUAdo5YkA9AYACAmUIszAAgOAIAQx4TzQMgTAOgMNK/4KlfcIW4SAEAwMuVzZdL0jMUuJXQGnfy8ODiIeLCbLFCYRcpEGYJ5CKcl5sjE0jnA0zODAAAGvnRwf44P5Dn5uTh5mbnbO/0xaL+a/BvIj4h8d/+vIwCBAAQTs/v2l/l5dYDcMcBsHW/a6lbANpWAGjf+V0z2wmgWgrQevmLeTj8QB6eoVDIPB0cCgsL7SViob0w44s+/zPhb+CLfvb8QB7+23rwAHGaQJmtwKOD/XFhbnauUo7nywRCMW735yP+x4V//Y4p0eI0sVwsFYrxWIm4UCJNx3m5UpFEIcmV4hLpfzLxH5b9CZN3DQCshk/ATrYHtctswH7uAQKLDljSdgBAfvMtjBoLkQAQZzQyefcAAJO/+Y9AKwEAzZek4wAAvOgYXKiUF0zGCAAARKCBKrBBBwzBFKzADpzBHbzAFwJhBkRADCTAPBBCBuSAHAqhGJZBGVTAOtgEtbADGqARmuEQtMExOA3n4BJcgetwFwZgGJ7CGLyGCQRByAgTYSE6iBFijtgizggXmY4EImFINJKApCDpiBRRIsXIcqQCqUJqkV1II/ItchQ5jVxA+pDbyCAyivyKvEcxlIGyUQPUAnVAuagfGorGoHPRdDQPXYCWomvRGrQePYC2oqfRS+h1dAB9io5jgNExDmaM2WFcjIdFYIlYGibHFmPlWDVWjzVjHVg3dhUbwJ5h7wgkAouAE+wIXoQQwmyCkJBHWExYQ6gl7CO0EroIVwmDhDHCJyKTqE+0JXoS+cR4YjqxkFhGrCbuIR4hniVeJw4TX5NIJA7JkuROCiElkDJJC0lrSNtILaRTpD7SEGmcTCbrkG3J3uQIsoCsIJeRt5APkE+S+8nD5LcUOsWI4kwJoiRSpJQSSjVlP+UEpZ8yQpmgqlHNqZ7UCKqIOp9aSW2gdlAvU4epEzR1miXNmxZDy6Qto9XQmmlnafdoL+l0ugndgx5Fl9CX0mvoB+nn6YP0dwwNhg2Dx0hiKBlrGXsZpxi3GS+ZTKYF05eZyFQw1zIbmWeYD5hvVVgq9ip8FZHKEpU6lVaVfpXnqlRVc1U/1XmqC1SrVQ+rXlZ9pkZVs1DjqQnUFqvVqR1Vu6k2rs5Sd1KPUM9RX6O+X/2C+mMNsoaFRqCGSKNUY7fGGY0hFsYyZfFYQtZyVgPrLGuYTWJbsvnsTHYF+xt2L3tMU0NzqmasZpFmneZxzQEOxrHg8DnZnErOIc4NznstAy0/LbHWaq1mrX6tN9p62r7aYu1y7Rbt69rvdXCdQJ0snfU6bTr3dQm6NrpRuoW623XP6j7TY+t56Qn1yvUO6d3RR/Vt9KP1F+rv1u/RHzcwNAg2kBlsMThj8MyQY+hrmGm40fCE4agRy2i6kcRoo9FJoye4Ju6HZ+M1eBc+ZqxvHGKsNN5l3Gs8YWJpMtukxKTF5L4pzZRrmma60bTTdMzMyCzcrNisyeyOOdWca55hvtm82/yNhaVFnMVKizaLx5balnzLBZZNlvesmFY+VnlW9VbXrEnWXOss623WV2xQG1ebDJs6m8u2qK2brcR2m23fFOIUjynSKfVTbtox7PzsCuya7AbtOfZh9iX2bfbPHcwcEh3WO3Q7fHJ0dcx2bHC866ThNMOpxKnD6VdnG2ehc53zNRemS5DLEpd2lxdTbaeKp26fesuV5RruutK10/Wjm7ub3K3ZbdTdzD3Ffav7TS6bG8ldwz3vQfTw91jicczjnaebp8LzkOcvXnZeWV77vR5Ps5wmntYwbcjbxFvgvct7YDo+PWX6zukDPsY+Ap96n4e+pr4i3z2+I37Wfpl+B/ye+zv6y/2P+L/hefIW8U4FYAHBAeUBvYEagbMDawMfBJkEpQc1BY0FuwYvDD4VQgwJDVkfcpNvwBfyG/ljM9xnLJrRFcoInRVaG/owzCZMHtYRjobPCN8Qfm+m+UzpzLYIiOBHbIi4H2kZmRf5fRQpKjKqLupRtFN0cXT3LNas5Fn7Z72O8Y+pjLk722q2cnZnrGpsUmxj7Ju4gLiquIF4h/hF8ZcSdBMkCe2J5MTYxD2J43MC52yaM5zkmlSWdGOu5dyiuRfm6c7Lnnc8WTVZkHw4hZgSl7I/5YMgQlAvGE/lp25NHRPyhJuFT0W+oo2iUbG3uEo8kuadVpX2ON07fUP6aIZPRnXGMwlPUit5kRmSuSPzTVZE1t6sz9lx2S05lJyUnKNSDWmWtCvXMLcot09mKyuTDeR55m3KG5OHyvfkI/lz89sVbIVM0aO0Uq5QDhZML6greFsYW3i4SL1IWtQz32b+6vkjC4IWfL2QsFC4sLPYuHhZ8eAiv0W7FiOLUxd3LjFdUrpkeGnw0n3LaMuylv1Q4lhSVfJqedzyjlKD0qWlQyuCVzSVqZTJy26u9Fq5YxVhlWRV72qX1VtWfyoXlV+scKyorviwRrjm4ldOX9V89Xlt2treSrfK7etI66Trbqz3Wb+vSr1qQdXQhvANrRvxjeUbX21K3nShemr1js20zcrNAzVhNe1bzLas2/KhNqP2ep1/XctW/a2rt77ZJtrWv913e/MOgx0VO97vlOy8tSt4V2u9RX31btLugt2PGmIbur/mft24R3dPxZ6Pe6V7B/ZF7+tqdG9s3K+/v7IJbVI2jR5IOnDlm4Bv2pvtmne1cFoqDsJB5cEn36Z8e+NQ6KHOw9zDzd+Zf7f1COtIeSvSOr91rC2jbaA9ob3v6IyjnR1eHUe+t/9+7zHjY3XHNY9XnqCdKD3x+eSCk+OnZKeenU4/PdSZ3Hn3TPyZa11RXb1nQ8+ePxd07ky3X/fJ897nj13wvHD0Ivdi2yW3S609rj1HfnD94UivW2/rZffL7Vc8rnT0Tes70e/Tf/pqwNVz1/jXLl2feb3vxuwbt24m3Ry4Jbr1+Hb27Rd3Cu5M3F16j3iv/L7a/eoH+g/qf7T+sWXAbeD4YMBgz8NZD+8OCYee/pT/04fh0kfMR9UjRiONj50fHxsNGr3yZM6T4aeypxPPyn5W/3nrc6vn3/3i+0vPWPzY8Av5i8+/rnmp83Lvq6mvOscjxx+8znk98ab8rc7bfe+477rfx70fmSj8QP5Q89H6Y8en0E/3Pud8/vwv94Tz+4A5JREAAAAZdEVYdFNvZnR3YXJlAEFkb2JlIEltYWdlUmVhZHlxyWU8AAADcWlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDIgNzkuMTYwOTI0LCAyMDE3LzA3LzEzLTAxOjA2OjM5ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIgeG1wTU06T3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOjNmZjJmYzA3LThiNGEtNjQ0Yi1iMjNkLTViMDFlOWRlOGVjZSIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpDNDRDQkUzODUxNzUxMUVBQjM5REFCODVERTEzMUU2MSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpDNDRDQkUzNzUxNzUxMUVBQjM5REFCODVERTEzMUU2MSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgKFdpbmRvd3MpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6ZDI0YWU3ZTAtMDM1Ny04MTQ5LWJhZDQtY2Y2NjM5MWIwMWEyIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjNmZjJmYzA3LThiNGEtNjQ0Yi1iMjNkLTViMDFlOWRlOGVjZSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Pm/dvNIAAAAGUExURf///////1V89WwAAAACdFJOU/8A5bcwSgAAAlpJREFUeNrs3UFy4zAMRNHG/S89s0hNZWLJIgUSQjsf+268rVBlU7FudDorl2ymLmerCLsMrUrtCrOKtWmz6rU5sx7RJsx6jHuTrAe5t8h6lHuDrIe502Q9zp0kq4N3RqwO3BmymniHxWrCHSarj3dMrEbeIbEacYfI6uW9FquZ91Ksbt4rsdp5L8Rqx70gq6P3nVgtvW/E6uk9F6up91T8KWCpq1htvSdi9fUei9XYeyhWZ++R+APAUmuxentfxWrufRG7g6XuYrX3/hB7g6X+YmuwZCCWg/e72BgsWYh9wZKH2BYsmYgBF4ElF7EpWLIRAy4BSz5iwBVgyUgMuAAsOYkBA/YG6y9YgAEDLgUzDMMwDMMwvhMPDGDAgAEDBlz442k3L+C+f1zxlNcPLDevH1hu3kqxfilYbt4qsdvXs9v3vtmJwu2oYnYH8rpd+dzcvO6EbpdNt1usAAMGDBgwYMCAAQMGDBgwYMCAAQMGDBgwYMCAAQMGDBgwYMCAAQMGDBgwYMCAAQMGDBgwYMCAAQMGDBgwYMCAAX80OLzAqdci6sGRe/GkHByRe8ipGPwVTXSUgv9FEyWV4HgFz9fUgb9HEz1l4DgDTzYVgX9EE10l4JdooqwCHNfg8br94KNoonA3+DiaaNwMjhnwUOdW8Gk00boR/CaaqN0Hjnvgq+Jd4PfRRPUe8FU00b0FHFnwm/YN4IFoon85eCiaWLAaHOvAxyvWgkejiSUrwePRxJaF4NgBftmzDDwVTSxaBY594P9XrQHPRu8vi1ggnk/eXhaxQDwf/CPAAEWCOZah9n1oAAAAAElFTkSuQmCC\"","export default \"data:image/png;base64,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UmVhZHlxyWU8AAADcWlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDIgNzkuMTYwOTI0LCAyMDE3LzA3LzEzLTAxOjA2OjM5ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIgeG1wTU06T3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOjNmZjJmYzA3LThiNGEtNjQ0Yi1iMjNkLTViMDFlOWRlOGVjZSIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo5OTY0QUNENDUxNzQxMUVBQjZGRENDOUJGNDMzNjU3NCIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo5OTY0QUNEMzUxNzQxMUVBQjZGRENDOUJGNDMzNjU3NCIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgKFdpbmRvd3MpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6ZDI0YWU3ZTAtMDM1Ny04MTQ5LWJhZDQtY2Y2NjM5MWIwMWEyIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjNmZjJmYzA3LThiNGEtNjQ0Yi1iMjNkLTViMDFlOWRlOGVjZSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PpwgK6gAAAAGUExURf///////1V89WwAAAACdFJOU/8A5bcwSgAAA19JREFUeNrc21ty4zAMRNHG/jc9qfm3RcjEo683EJ2STQINRGH50eEHjRMaJzROaJzQOKFxQuOExgmNExonNE5onNA4oXFC44TGCY0TGic0Tmic0DihcULjhMYJjRMaJzROaJzQOKFxQuOExgmNExonNE5onNBvTuivpdC/OaEPFKFPS6GvApFxm3QF15zIuD26kgJFZNwWXVFpKTJuh66sKRAZt0FX2M6JjJvXlTbiIuOmdcURisi4WV15+CUyblLXEFuKjJvTtQTOIuOmdE2jApFxM7q2IY/IuAld43hOZFy/rnWwKjKuW9c8EhcZ16trX2YQGdepG1hDERnXpxtZIBIZ16UbWv0SGdejG1vaExnXoRtctxQZV68bXZQVGVetG15xFhlXqxtfThcZV6lb8G8FIuPqdBtwZboVuCrdDlyRbgmuRrcFV6Jbg6vQ7cEV6Bbh7us24a7rVuFu63bhLuuW4e7qtuGu6tbhbur24S7qFuLu6Tbi4tYy0krc48OfLoasxJ3oZIs70skVd6aTKS4OH9wTd6qTJe5YJ0fcuU6GuAfd41/fjcvoZIdL6eSGy+lkhovkTeaFy+pkhUvr5ITL62SEe6GTD+6r7vPzmOCiq/ofwSXvOzNc9DWmA7jD3twUF52ZSTvuIK40xkVvnNeMO4qabXHRnTS34g7HBKa4gSFII+54wmWJO5/fOeIS00lDXGb26odLTZbtcLm5uRsuuRVghsvuPHjh0hsdVrj8vooT7sU2jhGu8d2Fgc4K13ZmhoHODNdUq4SBzg7X0iOEgc4Q19Cbh4HOEleeiYWBzhRXnEWHgc4WVzoDCgOdMa5y9mqgs4pRsjqvCCypM4svc7pzhOFtnnlDdpVY7utnVkVnf1tWHVD+4DDqXt+cijbJw7sj3yQ1enufWSR+7y9rg7T2l0pkfdL+W5m1fEryaw25esL1e4G8eDp5o/pfO1m+09os3Qq41bet3Oi415Tue3dXO+5tN8LlOGFXnXk9K9nUvRYEQXsSP6cINq2D4kJk3H8dFhci4/50YFxiUhBkXZB14akLMO7wzAxfXWBxR7VKeOsCijvoEcJfF0jcY28eDF0AcQ+ZWHB0gcN9TWuDpQsY7suUJHi6QOE+TieDqQsQ7sNWAAQX/wQYAPYPhm0aAm5YAAAAAElFTkSuQmCC\"","import * as React from \"react\";\nimport resourceDescriptions from \"definitions/resources\";\nimport { WarehouseStructureDefinition } from 'definitions/structures/types';\nimport { Resource } from 'definitions/resources';\nimport Icon from 'components/ui/common/Icon';\nimport { TextManager } from 'global/TextManager';\nimport { useStructureDefinition } from \"hooks/store/structures\";\nimport \"./styles/upgradeHelpModalContent.scss\"\n\nexport interface Props  {\n    level: number;\n}\n\nconst UpgradeHelpModalContent = (props: Props) => {\n    const { level } = props;\n    const structureDefinition = useStructureDefinition<WarehouseStructureDefinition>(\"warehouse\");\n\n    const currentLevel = structureDefinition.levels[level];\n    const nextLevel = structureDefinition.levels[level + 1];\n\n    const renderRow = (resource: Resource) => {\n        const resourceDescription = resourceDescriptions[resource];\n\n        return (\n            <React.Fragment key={resource}>\n                <div><Icon image={resourceDescription.iconImg} size=\"smallest\"/></div>\n                <div>{TextManager.getResourceName(resource)}</div>\n                <div className=\"number\">{currentLevel.maxResources[resource]}</div>\n                <div className=\"arrow\">⟶</div>\n                <div className=\"number\">{nextLevel.maxResources[resource]}</div>\n            </React.Fragment>\n        )\n    }\n\n    return (\n        <div className=\"upgrade-help-model-content-warehouse\">\n            <h3>{TextManager.get(\"ui-structure-help-upgrade-improvements\")}</h3>\n            <div className=\"storage-increase\">\n                <div className=\"header\"/>\n                <div className=\"header\">\n                    {TextManager.get(\"ui-structure-warehouse-help-upgrade-header-capacity\")}\n                </div>\n                <div className=\"header number\">\n                    {TextManager.get(\"ui-structure-help-upgrade-header-level\", {\n                        level: level + 1\n                    })}\n                </div>\n                <div className=\"header\"/>\n                <div className=\"header number\">\n                {TextManager.get(\"ui-structure-help-upgrade-header-level\", {\n                        level: level + 2\n                    })}\n                </div>\n                {Object.keys(nextLevel.maxResources).map(res => renderRow(res as Resource))}\n            </div>\n        </div>\n    )\n}\n\nexport default UpgradeHelpModalContent;","import * as React from \"react\";\nimport Inventory from \"components/ui/inventory/Inventory\";\nimport { DragSourceType, DragType } from \"constants/dragging\";\nimport { useStockpileState } from \"hooks/store/stockpile\";\nimport useItemDropActions from \"hooks/actions/useItemActions\";\nimport { Item, ItemType } from \"definitions/items/types\";\nimport Tabstrip from \"components/ui/tabs/Tabstrip\";\nimport { useEffect, useMemo, useState } from \"react\";\nimport Tab from \"components/ui/tabs/Tab\";\nimport { StockpileStoreState } from \"store/types/stockpile\";\nimport { TextManager } from \"global/TextManager\";\nimport { useDragDropManager } from \"react-dnd\";\nimport { getDefinition } from \"definitions/items\";\nimport { InventoryItemDragInfo } from \"components/ui/items/DraggableItemIcon\";\nimport \"./styles/stockpile.scss\"\n\nconst WAREHOUSE = DragSourceType.warehouse;\n\nconst Stockpile = () => {\n    const stockpile = useStockpileState();\n    const {dropItemWarehouse} = useItemDropActions();\n    const [selectedItemType, setSelectedItemType] = useState<string>(Object.keys(stockpile)[0]);\n\n    const handleDropItemWarehouse = (item: Item, fromSlot: number, toSlot: number, sourceType: DragSourceType, sourceId?: string): void => {\n        dropItemWarehouse(item, fromSlot, toSlot, sourceType, sourceId);\n    }\n    const dragDropManager = useDragDropManager()\n    const dragging = dragDropManager.getMonitor().isDragging();\n    useEffect(() => {\n        // If we're dragging some item, switch to the appropriate category so we can drop it here\n        if(dragging){\n            const dragItem = dragDropManager.getMonitor().getItem();\n            const dragItemType = dragDropManager.getMonitor().getItemType();\n\n            if (dragItem && dragItemType === DragType.ITEM) {\n                const item = dragItem.item;\n                const definition = getDefinition(item)\n                setSelectedItemType(ItemType[definition.itemType]);\n            }\n        }\n    }, [dragging]);\n\n    const handleCheckDropItem = (dragInfo: InventoryItemDragInfo) => {\n        // can only drop on the appropriate category\n        const definition = getDefinition(dragInfo.item)\n        return (definition.itemType === ItemType[selectedItemType as keyof typeof ItemType])\n    }\n\n    const items = useMemo(() => {\n        return stockpile[selectedItemType as keyof StockpileStoreState]\n    }, [selectedItemType, stockpile])\n\n    return (\n        <div className=\"stockpile\">\n            <Tabstrip className=\"tabs\" onTabSelected={setSelectedItemType} activeTab={selectedItemType}>\n            {Object.keys(stockpile).map((itemType) => {\n                return (\n                    <Tab id={itemType} key={itemType}>\n                        {TextManager.getItemType(ItemType[itemType as keyof typeof ItemType])}\n                    </Tab>);\n                }\n            )}\n            </Tabstrip>\n            <Inventory\n                sourceType={WAREHOUSE}\n                className=\"inventory-large\"\n                items={items}\n                onDropItem={handleDropItemWarehouse}\n                // onStartDrag={handleStartDrag}\n                canDropHere={handleCheckDropItem}\n            />\n        </div>\n    )\n}\n\nexport default Stockpile\n","import * as React from \"react\";\r\nimport ResourcesBox from \"components/structures/warehouse/ResourcesBox\";\r\nimport { WarehouseStructureDefinition, WarehouseStructureLevelDefinition } from \"definitions/structures/types\";\r\nimport usePrevious from \"hooks/usePrevious\";\r\nimport { useEffect, useRef, useState } from \"react\";\r\nimport { empty, ResourceStoreState } from \"store/types/resources\";\r\nimport { StructuresStoreState } from \"store/types/structures\";\r\nimport { TextManager } from \"global/TextManager\";\r\nimport { TooltipManager } from 'global/TooltipManager';\r\nimport AdventurerTabstrip from 'components/world/QuestPanel/AdventurerTabstrip';\r\nimport { useStructureDefinition, useStructureLevel, useStructureState } from 'hooks/store/structures';\r\nimport { useResourcesState } from 'hooks/store/resources';\r\nimport { useSelector } from 'react-redux';\r\nimport { StoreState } from 'store/types';\r\nimport { useAdventurersInTown } from 'hooks/store/adventurers';\r\nimport StructureLevel from '../StructureLevel';\r\nimport AdventurerPanel from 'components/ui/adventurer/AdventurerPanel';\r\nimport { ContextType } from 'constants/context';\r\nimport { Resource } from \"definitions/resources\";\r\nimport UpgradeHelpModal from \"../UpgradeHelpModal\";\r\nimport UpgradeHelpModalContent from \"./UpgradeHelpModalContent\";\r\nimport Stockpile from \"./Stockpile\";\r\nimport \"./styles/warehouseStructureView.scss\";\r\nimport { Item } from \"definitions/items/types\";\r\n\r\n\r\nconst WarehouseStructureView = () => {\r\n\r\n    const adventurersInTown = useAdventurersInTown();\r\n    const [selectedAdventurer, setSelectedAdventurer] = useState<string>(adventurersInTown[0]?.id);\r\n    const resources = useResourcesState();\r\n    const [resourcesDelta, setResourcesDelta] = useState<ResourceStoreState>(empty);    // updating this will trigger animation\r\n    const previousResources = usePrevious(resources);\r\n    const resourcesRef = useRef<HTMLFieldSetElement>(null);\r\n    const structuresState = useSelector<StoreState, StructuresStoreState>(store => store.structures);\r\n\r\n    useEffect(() => {\r\n        // Calculate delta\r\n        const delta = Object.keys(resources).reduce<ResourceStoreState>((acc, value) => {\r\n            const resource = value as Resource;\r\n            if (previousResources && previousResources[resource]) {\r\n                // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\r\n                acc[resource] = resources[resource]! - previousResources[resource]!;\r\n            }\r\n            return acc;\r\n        }, {});\r\n\r\n        setResourcesDelta(delta);\r\n    }, [resources, previousResources]);\r\n\r\n    useEffect(() => {\r\n        if (!resourcesRef.current) {\r\n            return;\r\n        }\r\n        const ref = resourcesRef.current as unknown as HTMLFieldSetElement;\r\n        ref.classList.remove(\"animate\");\r\n        const timeout = setTimeout(() => {\r\n            if (resourcesRef) {\r\n                ref.classList.add(\"animate\");\r\n            }\r\n        }, 200);\r\n        return () => { clearTimeout(timeout); }\r\n    }, [resourcesDelta]);\r\n\r\n    const structureDefinition = useStructureDefinition<WarehouseStructureDefinition>(\"warehouse\");\r\n    const structureState = useStructureState(\"warehouse\");\r\n    const { level } = structureState;\r\n    const levelDefinition = useStructureLevel<WarehouseStructureLevelDefinition>(\"warehouse\");\r\n    \r\n\r\n    const handleAdventurerTabSelected = (tabId: string) => {\r\n        setSelectedAdventurer(tabId);\r\n    };\r\n\r\n    const handleHelpClicked = (event: React.MouseEvent) => {\r\n        const origin = (event.currentTarget as HTMLElement);\r\n        const originRect = origin.getBoundingClientRect();\r\n        const content = (\r\n            <UpgradeHelpModal level={level} structure={\"warehouse\"}>\r\n                <UpgradeHelpModalContent level={level} />\r\n            </UpgradeHelpModal>\r\n        );\r\n        TooltipManager.showContextTooltip(ContextType.component, content, originRect, \"upgrade-structure-tooltip\");\r\n\r\n        event.stopPropagation();\r\n    }\r\n\r\n    const handleUpgradeCallbacks = (nextLevel: number) => {\r\n        const currentLevelDefinition = structureDefinition.levels[structureState.level];\r\n        const nextLevelDefinition = structureDefinition.levels[nextLevel];\r\n        const slots = nextLevelDefinition.maxStockpile - currentLevelDefinition.maxStockpile;\r\n        return [\r\n            // addStockpileSlots(slots)\r\n        ]\r\n    }\r\n\r\n    const handleAdventurerInventoryItemStartDrag = (item: Item, fromSlot: number) => {\r\n        console.log(item)\r\n    }\r\n\r\n    return (\r\n        <div className=\"warehouse-structureview\">\r\n            <StructureLevel structure={\"warehouse\"} onHelpClicked={handleHelpClicked} addUpgradeCallbacks={handleUpgradeCallbacks}/>\r\n            <fieldset className=\"resources\" ref={resourcesRef}>\r\n                <legend>{TextManager.get(\"ui-structure-warehouse-resources\")}</legend>\r\n                <ResourcesBox\r\n                    resources={resources}\r\n                    structures={structuresState}\r\n                    maxResources={levelDefinition.maxResources}\r\n                    deltaResources={resourcesDelta}\r\n                />\r\n            </fieldset>\r\n            <h3>{TextManager.get(\"ui-structure-warehouse-stockpile\")}</h3>\r\n            <Stockpile />\r\n            <h3>{TextManager.get(\"ui-structure-warehouse-adventurers\")}</h3>\r\n            <div>\r\n                <AdventurerTabstrip\r\n                    adventurers={adventurersInTown}\r\n                    selectedAdventurerId={selectedAdventurer}\r\n                    onAdventurerTabSelected={handleAdventurerTabSelected}\r\n                />\r\n                <div className=\"adventurer-inventory\">\r\n                    { selectedAdventurer && (\r\n                        <AdventurerPanel\r\n                            adventurerId={selectedAdventurer}\r\n                            horizontalMode={true}\r\n                            traits={false}\r\n                            skills={false}\r\n                            onStartInventoryItemDrag={handleAdventurerInventoryItemStartDrag}\r\n                        />\r\n                    )}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n\r\n};\r\n\r\nexport default WarehouseStructureView;\r\n","import { DragType } from \"constants/dragging\";\r\nimport * as React from \"react\";\r\nimport { ConnectDropTarget, DropTarget, DropTargetConnector, DropTargetMonitor, DropTargetSpec } from \"react-dnd\";\r\nimport { AdventurerAvatarDragInfo } from \"../DraggableAdventurerAvatar\";\r\nimport \"./styles/droppableadventurerslot.scss\";\r\n\r\nconst dropTarget: DropTargetSpec<Props> = {\r\n    drop(props: Props, monitor: DropTargetMonitor) {\r\n        props.onDrop(monitor.getItem());\r\n    },\r\n    canDrop(_props: Props, _monitor: DropTargetMonitor)  {\r\n        return true; // todo: can't drop on yourself\r\n    },\r\n};\r\n\r\nexport interface Props {\r\n    onDrop: (item: AdventurerAvatarDragInfo) => void;\r\n}\r\n\r\nexport interface DropSourceProps {\r\n    canDrop: boolean;\r\n    isOver: boolean;\r\n    connectDropTarget: ConnectDropTarget;\r\n}\r\n\r\nconst collect = (connect: DropTargetConnector, monitor: DropTargetMonitor) => ({\r\n    canDrop: monitor.canDrop(),\r\n    connectDropTarget: connect.dropTarget(),\r\n    isOver: monitor.isOver(),\r\n});\r\n\r\n/*\r\n * Can drop adventurers on this */\r\nconst DroppableAdventurerSlot = (props: Props & DropSourceProps) => {\r\n    const {\r\n        isOver,\r\n        canDrop,\r\n        connectDropTarget,\r\n    } = props;\r\n    // const isActive = isOver && canDrop;\r\n    let className = \"droppable-adventurer-slot\";\r\n\r\n    if (isOver) {\r\n        className += \" active-drop\";\r\n    } else if (canDrop) {\r\n        className += \" can-drop\";\r\n    }\r\n\r\n    return connectDropTarget(\r\n        <div className = { className }/>\r\n    );\r\n}\r\n\r\nexport default DropTarget<Props, DropSourceProps>(\r\n    DragType.ADVENTURER,\r\n    dropTarget,\r\n    collect,\r\n)(DroppableAdventurerSlot);\r\n","import * as React from \"react\";\nimport { AdventurerStoreState } from \"store/types/adventurer\";\nimport AdventurerAvatar from \"components/ui/adventurer/AdventurerAvatar\";\nimport { AdventurerAvatarDragInfo } from 'components/ui/adventurer/DraggableAdventurerAvatar';\nimport DroppableAdventurerSlot from 'components/ui/adventurer/DroppableAdventurerSlot';\nimport { IconSize } from 'components/ui/common/Icon';\nimport \"./styles/assignadventurers.scss\";\n\nexport interface DispatchProps {\n    onAdventurerDropped: (item: AdventurerAvatarDragInfo, index: number) => void;\n    onAdventurerClicked: (adventurer: AdventurerStoreState) => void;\n}\n\nexport interface Props {\n    availableSlots: number;\n    assignedAventurers: AdventurerStoreState[];\n}\n\n/*\n * Displays a number of slots to drag adventurers to */\nconst AssignAdventurers = (props: Props & DispatchProps) => {\n    const slotsContent = () => {\n        const slots: JSX.Element[] = [];\n        for (let i = 0; i < props.availableSlots; i++) {\n            let content;\n            let className = \"\";\n            const hasAdventurer = !!props.assignedAventurers[i];\n\n            if (hasAdventurer) {\n                const adventurer = props.assignedAventurers[i];\n                content = (\n                    <AdventurerAvatar\n                        adventurer={adventurer}\n                        displayName={false}\n                        size={IconSize.small}\n                        onClick={() => props.onAdventurerClicked(adventurer) }\n                    />\n                );\n                className = \"has-adventurer\";\n            } else {\n                content = (\n                    <DroppableAdventurerSlot\n                        onDrop={(item: AdventurerAvatarDragInfo) => { props.onAdventurerDropped(item, i); }}\n                    />\n                );\n            }\n            slots.push(\n                <li\n                    key={`slot${i}`}\n                    className={className}\n                >\n                    {content}\n                </li>\n            );\n        }\n        return slots;\n    };\n\n    return (\n        <ul\n            className=\"assign-adventurers\"\n        >\n            { slotsContent() }\n        </ul>\n    );\n};\n\nexport default AssignAdventurers;\n","import { Item } from \"definitions/items/types\";\nimport { getDefinition } from \"definitions/quests\";\nimport * as React from \"react\";\nimport { AdventurerStoreState } from \"store/types/adventurer\";\nimport { QuestStoreState } from \"store/types/quest\";\nimport { TextManager } from \"global/TextManager\";\nimport AssignAdventurers from \"./AssignAdventurers\";\nimport { QuestDefinition } from 'definitions/quests/types';\nimport { useSelector } from 'react-redux';\nimport { StoreState } from 'store/types';\nimport Button from 'components/ui/buttons/Button';\nimport ItemsBox from 'components/ui/items/ItemsBox';\nimport { AdventurerAvatarDragInfo } from 'components/ui/adventurer/DraggableAdventurerAvatar';\nimport \"./styles/questboard.scss\";\nimport { StockpileStoreState } from \"store/types/stockpile\";\nimport { useStockpileStateFlat } from \"hooks/store/stockpile\";\n\nexport const AVAILABLE_SLOTS = 5;\nconst minimumCountAdventurers = 3;  // we need this many adventurers to start the quest\n\n\nexport interface Props {\n    availableQuests: QuestStoreState[];\n    selectedQuestName?: string;       // name of selected quest\n    assignedAventurers: AdventurerStoreState[];\n\n    onQuestClick: (questName: string) => void;\n    onAdventurerDropped: (item: AdventurerAvatarDragInfo, index: number) => void;\n    onRemoveAdventurer: (adventurer: AdventurerStoreState) => void;\n    onLaunchQuest: () => void;\n}\n\nconst QuestBoard = (props: Props) => {\n\n    const items = useStockpileStateFlat();\n    const getQuestDetails = () => {\n        if (!props.selectedQuestName) {\n            return null;\n        }\n        const quest = props.availableQuests.find((q) => q.name === props.selectedQuestName);\n        if (!quest) {\n            return (\n                <div> { TextManager.get(\"ui-structure-tavern-quest-launched\") } </div>\n            );\n        }\n        const questDefinition = getDefinition(quest.name);\n\n        // Need a full party to launch\n        const fullParty = props.assignedAventurers.filter((a) => a !== null).length >= minimumCountAdventurers;\n        // Check if we have the required items\n        const enoughItems = checkEnoughItems(questDefinition);\n\n        const canLaunch = fullParty && enoughItems;\n\n        return (\n            <div className=\"quest-details\">\n                {TextManager.getQuestDescription(props.selectedQuestName)}\n                <AssignAdventurers\n                    availableSlots={AVAILABLE_SLOTS}\n                    assignedAventurers={props.assignedAventurers}\n                    onAdventurerClicked={props.onRemoveAdventurer}\n                    onAdventurerDropped={props.onAdventurerDropped}\n                />\n                <ItemsBox items={ questDefinition.requiredItems || [] }/>\n                <Button disabled={!canLaunch} onClick = { () => props.onLaunchQuest() }>\n                    {TextManager.get(\"ui-structure-tavern-button-launch-quest\")}\n                </Button>\n            </div>\n        );\n    };\n\n    /**\n     * Returns true if all the items required by the quest are in the inventory\n     */\n    const checkEnoughItems = (questDefinition: QuestDefinition): boolean => {\n        if (!questDefinition.requiredItems) {\n            return true;\n        }\n        return questDefinition.requiredItems.every((item: Item) => {\n            const amountRequired = (questDefinition.requiredItems)?.filter((i) => i === item).length;\n            return items.filter((i) => i === item).length >= (amountRequired ?? 0);\n        });\n    }\n\n    // quest board, expanded quest info + assign adventurers + launch button\n    return (\n        <div className=\"quest-board\">\n            <h2>\n                {TextManager.get(\"ui-structure-tavern-title-quest-board\")}\n            </h2>\n            <ul className=\"quest-list\">\n                {props.availableQuests.map((q) => {\n                    const className = `quest ${(q.name === props.selectedQuestName) ? \" selected\" : \"\"}`;\n                    return (\n                        <li key={q.name}\n                            className={className}\n                            onClick={() => {props.onQuestClick(q.name);} }\n                        >\n                            <div\n                                className=\"icon\"\n                                style={{backgroundImage: `url(${process.env.PUBLIC_URL})`}}\n                            />\n                            <div className=\"title\">{ TextManager.getQuestTitle(q.name) } </div>\n                        </li>\n                    );\n                })}\n            </ul>\n            { getQuestDetails() }\n        </div>\n    );\n}\n\nexport default QuestBoard;\n","import * as React from \"react\";\nimport { AdventurerStoreState } from 'store/types/adventurer';\nimport { AVAILABLE_SLOTS } from '../QuestBoard';\nimport Button from 'components/ui/buttons/Button';\nimport { TextManager } from 'global/TextManager';\nimport \"./styles/adventurerButton.scss\";\n\nexport interface Props {\n    adventurer: AdventurerStoreState;\n    assignedAventurers: AdventurerStoreState[];  // assigned to a quest in the QuestBoard\n    questName: string;\n\n    onAddAdventurer: (adventurer: AdventurerStoreState, index: number) => void;\n    onRemoveAdventurer: (adventurer: AdventurerStoreState) => void;\n}\n\n// Toggles adventurer participation in a quest\nconst AdventurerButton = (props: Props) => {\n    const {\n        adventurer,\n        assignedAventurers,\n        questName,\n        onAddAdventurer,\n        onRemoveAdventurer\n    } = props;\n\n    const isAssigned = assignedAventurers.indexOf(adventurer) > -1;\n    const quest = TextManager.getQuestTitle(questName);\n\n    const handleAddClick = () => {\n        const emptySlot = getEmptySlot(assignedAventurers);\n        onAddAdventurer(adventurer, emptySlot);\n    };\n\n    const handleRemoveClick = () => {\n        onRemoveAdventurer(adventurer);\n    }\n\n    if (isAssigned) {\n        return (\n            <Button onClick={handleRemoveClick} className=\"adventurer-button\">\n               {TextManager.get(\"ui-structure-tavern-button-leave-quest\")}\n            </Button>\n        );\n    }\n    // Skip holes\n    if (assignedAventurers.filter(Boolean).length === AVAILABLE_SLOTS) {\n        return (\n            <Button disabled={true} className=\"adventurer-button\">\n                {TextManager.get(\"ui-structure-tavern-button-join-quest-full-party\")}\n            </Button>\n        )\n    }\n    return (\n        <Button onClick={handleAddClick}  className=\"adventurer-button\">\n            {TextManager.get(\"ui-structure-tavern-button-join-quest\", { quest })}\n        </Button>\n    )\n}\n\nexport default AdventurerButton;\n\n// Finds the first array index with a falsey value\nconst getEmptySlot = (assignedAventurers: AdventurerStoreState[]) => {\n    for (let i = 0; i < AVAILABLE_SLOTS; i++) {\n        if (!assignedAventurers[i]) {\n            return i;\n        }\n    }\n    return 0;\n}","import { DragSourceType, DragType } from \"constants/dragging\";\r\nimport * as React from \"react\";\r\nimport { ConnectDragSource, DragSource, DragSourceConnector, DragSourceMonitor, DragSourceSpec } from \"react-dnd\";\r\nimport { AdventurerStoreState } from \"store/types/adventurer\";\r\nimport AdventurerAvatar, { Props as AdventurerAvatarProps } from '../AdventurerAvatar';\r\nimport \"./styles/draggableadventureravatar.scss\";\r\n\r\nexport interface Props {\r\n    sourceId?: string;\r\n    onClick?: () => void;\r\n    disabled?: boolean;\r\n}\r\n\r\ninterface CollectedProps {\r\n    isDragging: boolean;\r\n    connectDragSource: ConnectDragSource;\r\n}\r\n\r\nexport interface AdventurerAvatarDragInfo {\r\n    adventurer: AdventurerStoreState;\r\n    sourceId?: string;\r\n}\r\n\r\n/**\r\n * Specifies the drag source contract.\r\n * Only `beginDrag` function is required.\r\n */\r\nconst spec: DragSourceSpec<Props & AdventurerAvatarProps, AdventurerAvatarDragInfo> = {\r\n    beginDrag(props: Props & AdventurerAvatarProps) {\r\n        // Return the data describing the dragged item\r\n        return {\r\n            adventurer: props.adventurer,\r\n            sourceId: props.sourceId,\r\n            sourceType: DragSourceType.adventurerInventory,\r\n        };\r\n    },\r\n};\r\n\r\n/**\r\n * Specifies which props to inject into your component.\r\n */\r\nfunction collect(connect: DragSourceConnector, monitor: DragSourceMonitor) {\r\n    return {\r\n        connectDragSource: connect.dragSource(),\r\n        isDragging: monitor.isDragging(),\r\n    };\r\n}\r\n\r\nconst DraggableAdventurerAvatar = (props: Props & CollectedProps & AdventurerAvatarProps) => {\r\n\r\n    const { isDragging, connectDragSource, disabled } = props;\r\n    let className = \"draggable-adventurer-avatar\";\r\n    if (disabled) {\r\n        className += \" disabled\";\r\n    }\r\n    if (isDragging) {\r\n        className += \" dragging\";\r\n    }\r\n\r\n    /*if (isDragging) {\r\n        // TODO: can show some sort of empty state?\r\n        return null;\r\n    }*/\r\n    return connectDragSource(\r\n        <div className = { className }>\r\n            <AdventurerAvatar\r\n                // Copy all props down to AdventurerAvatar\r\n                { ...props }\r\n            />\r\n        </div>,\r\n    );\r\n}\r\n\r\nexport default DragSource<Props & AdventurerAvatarProps, CollectedProps>(DragType.ADVENTURER, spec, collect)(DraggableAdventurerAvatar);\r\n","export enum TimeType {\n    questProgress,          // progress on the worldmap\n    resourceGeneration,\n    cheat\n}\n// todo: should come from store?\n\nlet cheatTimeMultiplier = 1;\nexport const setCheatTimeMultiplier = (value: number) => {\n    cheatTimeMultiplier = value;\n}\n\nexport const getTimeMultiplier = (type: TimeType): number => {\n    switch (type) {\n       case TimeType.cheat:\n            return cheatTimeMultiplier;\n        // todo: implement different multipliers for different timetypes?\n        // the idea is to have speed boosts in different areas of the game\n        default:\n            return cheatTimeMultiplier;\n    }\n}\n\n","import React from 'react';\nimport { AdventurerStoreState } from 'store/types/adventurer';\nimport { SOURCE_ID } from '../TavernStructureView';\nimport AdventurerButton from './AdventurerButton';\nimport { TextManager } from 'global/TextManager';\nimport DraggableAdventurerAvatar from 'components/ui/adventurer/DraggableAdventurerAvatar';\nimport AdventurerPanel from 'components/ui/adventurer/AdventurerPanel';\nimport { renameAdventurer } from 'store/actions/adventurers';\nimport { useDispatch } from 'react-redux';\n\nexport interface Props {\n    adventurer: AdventurerStoreState;\n    onQuest: boolean;\n    assignedAventurers: AdventurerStoreState[];\n    expanded: boolean;\n    selectedQuestName?: string;\n\n    onClick: (adventurer: AdventurerStoreState) => void;\n    onAddAdventurer: (adventurer: AdventurerStoreState, index: number) => void;\n    onRemoveAdventurer: (adventurer: AdventurerStoreState) => void;\n}\n\n// Room block that has adventurer\nconst RoomWithAdventurer = (props: Props) => {\n    const {\n        adventurer,\n        onQuest,\n        assignedAventurers,\n        expanded,\n        selectedQuestName,\n        onClick,\n        onAddAdventurer,\n        onRemoveAdventurer\n    } = props;\n\n    const dispatch = useDispatch();\n    const assigned = assignedAventurers.indexOf(adventurer) > -1; // assigned to a quest in the QuestBoard\n\n    const handleRename = (e: React.MouseEvent<HTMLSpanElement>) => {\n        e.stopPropagation();\n        const name = prompt(\"Enter new name\", adventurer.name);\n        if (name && name !== adventurer.name) {\n            dispatch(renameAdventurer(adventurer.id, name));\n        }\n    };\n\n    return (\n        <>\n            <div \n                className={`room ${expanded ? \"expanded\" : \"\"}`}\n                onClick={() => onClick(adventurer)}\n            >\n                <DraggableAdventurerAvatar\n                    disabled={assigned || onQuest}\n                    adventurer={adventurer}\n                    className=\"adventurer-icon\"\n                    sourceId={SOURCE_ID}\n                    key={`avatar:${adventurer.id}`}\n                />\n                <div>\n                    <section>\n                        {adventurer.name}\n                    </section>\n                    <section className=\"on-a-quest\">\n                     {(onQuest) && TextManager.get(\"ui-structure-tavern-on-a-quest\") }\n                    </section>\n                </div>\n                <span className=\"rename\" onClick={handleRename}>rename</span>\n            </div>\n            { expanded && (\n                <div className=\"adventurer-details\">\n                    <AdventurerPanel adventurerId={adventurer.id} name={false} />\n                    { (!onQuest && selectedQuestName) && (\n                        <AdventurerButton\n                            adventurer={adventurer}\n                            assignedAventurers={assignedAventurers}\n                            questName={selectedQuestName}\n                            onAddAdventurer={onAddAdventurer}\n                            onRemoveAdventurer={onRemoveAdventurer}\n                        />\n                    )}\n                </div>\n            )}\n        </>\n    );\n}\n\nexport default RoomWithAdventurer;\n","import React, {  } from 'react';\n\n// eslint-disable-next-line @typescript-eslint/no-empty-interface\nexport interface Props {\n}\n\nconst RoomEmpty = () => {\n    return (\n        <div className=\"room\">\n            (empty room)\n        </div>\n    );\n}\n\nexport default RoomEmpty;\n","import React, { useState } from 'react';\nimport { AdventurerStoreState } from 'store/types/adventurer';\nimport { QuestStoreState } from 'store/types/quest';\nimport RoomWithAdventurer from './RoomWithAdventurer';\nimport RoomEmpty from './RoomEmpty';\nimport { TextManager } from 'global/TextManager';\nimport \"./styles/roomList.scss\";\n\nexport interface Props {\n    roomCount: number;\n    adventurers: AdventurerStoreState[];\n    assignedAventurers: AdventurerStoreState[];\n    quests: QuestStoreState[];\n    selectedQuestName?: string;       // name of selected quest\n\n    onAddAdventurer: (adventurer: AdventurerStoreState, index: number) => void;\n    onRemoveAdventurer: (adventurer: AdventurerStoreState) => void;\n}\n\nconst RoomList = (props: Props) => {\n    const {\n        roomCount,\n        adventurers,\n        assignedAventurers,\n        selectedQuestName,\n        onAddAdventurer,\n        onRemoveAdventurer\n    } = props;\n    const [selectedAdventurer, setSelectedAdventurer] = useState<string>();\n\n    const getQuestByAdventurer = (adventurerId: string): QuestStoreState | undefined => {\n        return Object.values(props.quests).find((quest) => {\n            return quest.party.indexOf(adventurerId) > -1;\n        });\n    };\n\n    const handleAdventurerClick = (adventurer: AdventurerStoreState) => {\n        if (selectedAdventurer === adventurer.id) {\n            setSelectedAdventurer(undefined);\n        } else {\n            setSelectedAdventurer(adventurer.id);\n        }\n    };\n\n    const roomContent: JSX.Element[] = [];\n    for (let i = 0; i < roomCount; i++) {\n        const adventurer = adventurers.find((a) => a.room === i);\n        if (!adventurer) {\n            roomContent.push((\n                <RoomEmpty key={`room${i}`} />\n            ));\n            continue;\n        }\n        const onQuest = !!getQuestByAdventurer(adventurer.id);\n\n        roomContent.push((\n            <RoomWithAdventurer\n                key={adventurer.id}\n                adventurer={adventurer}\n                assignedAventurers={assignedAventurers}\n                selectedQuestName={selectedQuestName}\n                expanded={selectedAdventurer === adventurer.id}\n                onQuest={onQuest}\n\n                onClick={handleAdventurerClick}\n                onAddAdventurer={onAddAdventurer}\n                onRemoveAdventurer={onRemoveAdventurer}\n            />\n        ));\n    }\n\n    return (\n        <div className=\"room-list\">\n            <h2>{TextManager.get(\"ui-structure-tavern-rooms\")}</h2>\n            { roomContent }\n        </div>\n    );\n}\n\nexport default RoomList;","import * as React from \"react\";\nimport { getDefinition } from 'definitions/structures';\nimport { TavernStructureDefinition } from 'definitions/structures/types';\nimport Icon from 'components/ui/common/Icon';\nimport { TextManager } from 'global/TextManager';\nimport \"./styles/upgradeHelpModalContent.scss\"\n\nexport interface Props  {\n    level: number;\n}\n\nconst UpgradeHelpModalContent = (props: Props) => {\n    const { level } = props;\n    const structureDefinition: TavernStructureDefinition = getDefinition(\"tavern\");\n\n    const currentLevel = structureDefinition.levels[level];\n    const nextLevel = structureDefinition.levels[level + 1];\n\n\n    return (\n        <div className=\"upgrade-help-model-content-tavern\">\n            <h3>{TextManager.get(\"ui-structure-help-upgrade-improvements\")}</h3>\n\n            <div className=\"rooms-increase\">\n                <div className=\"header\"/>\n                <div className=\"header\">\n                    {TextManager.getStructureName(\"tavern\")}\n                </div>\n                <div className=\"header number\">\n                    {TextManager.get(\"ui-structure-help-upgrade-header-level\", {\n                        level: level + 1\n                    })}\n                </div>\n                <div className=\"header\"/>\n                <div className=\"header number\">\n                    {TextManager.get(\"ui-structure-help-upgrade-header-level\", {\n                        level: level + 2\n                    })}\n                </div>\n                <div><Icon image=\"img/ui/structures/tavern.png\" size=\"smallest\"/></div>\n                <div>{TextManager.get(\"ui-structure-tavern-rooms\")}</div>\n                <div className=\"number\">{currentLevel.rooms}</div>\n                <div className=\"arrow\">⟶</div>\n                <div className=\"number\">{nextLevel.rooms}</div>\n            </div>\n        </div>\n    )\n}\n\nexport default UpgradeHelpModalContent;","import * as React from \"react\";\nimport { TavernStructureDefinition, TavernStructureLevelDefinition} from \"definitions/structures/types\";\nimport { AdventurerStoreState} from \"store/types/adventurer\";\nimport { QuestStatus, QuestStoreState} from \"store/types/quest\";\nimport { TextManager} from \"global/TextManager\";\nimport { ToastManager} from 'global/ToastManager';\nimport { TooltipManager } from 'global/TooltipManager';\nimport { ContextType } from 'constants/context';\nimport { Type} from 'components/ui/toasts/Toast';\nimport { getQuestLink} from 'utils/routing';\nimport RoomList from './rooms/RoomList';\nimport { useState} from 'react';\nimport QuestBoard from './QuestBoard';\nimport { useStructureDefinition, useStructureState } from 'hooks/store/structures';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { StoreState } from 'store/types';\nimport { launchQuest } from 'store/actions/quests';\nimport { AdventurerAvatarDragInfo } from 'components/ui/adventurer/DraggableAdventurerAvatar';\nimport StructureLevel from '../StructureLevel';\nimport StructureViewHeader from \"../StructureViewHeader\";\nimport UpgradeHelpModal from \"../UpgradeHelpModal\";\nimport UpgradeHelpModalContent from \"./UpgradeHelpModalContent\";\nimport \"./styles/tavernStructureView.scss\";\n\nexport const SOURCE_ID = \"tavern\";\n\n// The UI for the tavern\nconst TavernStructureView = () => {\n    const level = useStructureState(\"tavern\").level;\n    const adventurers = useSelector<StoreState, AdventurerStoreState[]>(store => store.adventurers);\n    const quests = useSelector<StoreState, QuestStoreState[]>(store => store.quests);\n\n    const [assignedAventurers, setAassignedAdventurers] = useState<AdventurerStoreState[]>([]);\n    const [selectedQuest, setSelectedQuest] = useState<string>();\n\n    const structureDefinition = useStructureDefinition<TavernStructureDefinition>(\"tavern\");\n    const levelDefinition: TavernStructureLevelDefinition = structureDefinition.levels[level];\n\n    const dispatch = useDispatch();\n\n    const onLaunchQuest = (questName: string) => {\n        dispatch(launchQuest(questName, assignedAventurers));\n    };\n\n    const getAvailableQuests = quests.filter((q) => q.status === QuestStatus.available );\n\n    const handleQuestClick = (name: string): void => {\n        if (selectedQuest === name) {\n            setSelectedQuest(undefined);\n        } else {\n            setSelectedQuest(name);\n        }\n\n        // Unassign all adventurers\n        setAassignedAdventurers([]);\n    };\n\n    const handleAdventurerDropped = (item: AdventurerAvatarDragInfo, index: number) => {\n        if (item.sourceId === SOURCE_ID) {\n            handleAddAdventurer(item.adventurer, index)\n        }\n    }\n\n    const handleAddAdventurer = (adventurer: AdventurerStoreState, index: number): void => {\n        const copy = [ ...assignedAventurers];\n        copy[index] = adventurer;\n        setAassignedAdventurers(copy);\n    };\n\n    const handleRemoveAdventurer = (adventurer: AdventurerStoreState): void => {\n        const index = assignedAventurers.indexOf(adventurer);\n        const copy = [ ...assignedAventurers];\n        delete copy[index];\n        setAassignedAdventurers(copy);\n    };\n\n    const handleLaunchQuest = (): void => {\n        if (!selectedQuest) return;\n\n        const questTitle = TextManager.getQuestTitle(selectedQuest);\n        const leader = assignedAventurers[0];\n        ToastManager.addToast(questTitle, Type.questLaunched, leader?.avatarImg, getQuestLink(selectedQuest));\n        onLaunchQuest(selectedQuest);\n    };\n\n    const handleHelpClicked = (event: React.MouseEvent) => {\n        const origin = (event.currentTarget as HTMLElement);\n        const originRect = origin.getBoundingClientRect();\n        const content = (\n            <UpgradeHelpModal level={level} structure={\"tavern\"}>\n                <UpgradeHelpModalContent level={level} />\n            </UpgradeHelpModal>\n        );\n        TooltipManager.showContextTooltip(ContextType.component, content, originRect, \"upgrade-structure-tooltip\");\n\n        event.stopPropagation();\n    }\n\n    return (\n        <>\n            <StructureViewHeader structure={\"tavern\"} />\n            <div className=\"tavern-structure-view\">\n                <StructureLevel structure={\"tavern\"} onHelpClicked={handleHelpClicked}/>\n                <section>\n                    <RoomList\n                        roomCount={levelDefinition.rooms}\n                        adventurers={adventurers}\n                        assignedAventurers={assignedAventurers}\n                        quests={quests}\n                        selectedQuestName={selectedQuest}\n                        onAddAdventurer={handleAddAdventurer}\n                        onRemoveAdventurer={handleRemoveAdventurer}\n                    />\n                    <QuestBoard\n                        availableQuests={getAvailableQuests}\n                        selectedQuestName={selectedQuest}\n                        assignedAventurers={assignedAventurers}\n                        onQuestClick={(name: string) => handleQuestClick(name)}\n                        onAdventurerDropped={handleAdventurerDropped}\n                        onRemoveAdventurer={handleRemoveAdventurer}\n                        onLaunchQuest={handleLaunchQuest}\n                    />\n                </section>\n            </div>\n        </>\n    );\n};\n\nexport default TavernStructureView;\n","import { Resource } from \"definitions/resources\";\nimport { ONE_MINUTE } from 'utils/format/time';\n\nexport const RESOURCE_INTERVAL = ONE_MINUTE; // every minute constitutes a resource tick.\n\n// Whenever a list of resource is shown, use this order\nexport const resourceOrder = [\n    Resource.food,\n    Resource.wood,\n    Resource.iron,\n    Resource.stone,\n    Resource.fabric,\n    Resource.leather,\n];\n","import * as React from \"react\";\nimport ReactMarkdown from \"react-markdown\";\nimport { Structure } from 'definitions/structures';\nimport { TextManager } from 'global/TextManager';\nimport { useEngine } from 'hooks/store/engine';\nimport { formatDuration } from 'utils/format/time';\nimport { RESOURCE_INTERVAL } from 'constants/resources';\nimport { Direction } from 'components/ui/common/progress/PlainProgressbar';\nimport { Resource } from 'definitions/resources';\nimport { useStructureLevel, useStructureState } from 'hooks/store/structures';\nimport { ResourceStructureLevelDefinition } from 'definitions/structures/types';\nimport Icon from 'components/ui/common/Icon';\nimport resourceDescriptions from \"definitions/resources\";\nimport TickingProgressbar from 'components/ui/common/progress/TickingProgressbar';\nimport { useMaxResourcesState, useResourcesState } from \"hooks/store/resources\";\n\ninterface Props {\n    structure: Structure;\n    resource: Resource;\n}\n\nconst ResourceGenerationRow = (props: Props) => {\n    const {structure, resource} = props;\n    const engine = useEngine();\n    const {workers} = useStructureState(structure);\n    \n    const levelDefinition = useStructureLevel<ResourceStructureLevelDefinition>(structure);\n    const generates = levelDefinition.generates[resource] || 0;\n    const delta = RESOURCE_INTERVAL - (Date.now() - engine.lastProducedUpdate);\n    const resourceDescription = resourceDescriptions[resource];\n    const resources = useResourcesState();\n    const maxResources = useMaxResourcesState();\n    const full = (resources[resource] ?? 0) >= (maxResources?.[resource] ?? 0);\n    if (full) {\n        return (\n            <div className=\"resource-generation-row\">\n                <div className=\"error-full\">\n                <ReactMarkdown>\n                    {TextManager.get(\"ui-structure-resource-warehouse-full\", { structure, resource })}\n                </ReactMarkdown>\n                </div>\n            </div>\n        )\n    }\n    return (\n        <div className=\"resource-generation-row\">\n            <div className=\"info\">\n                <Icon image={resourceDescription.iconImg} size=\"smallest\"/>\n                <div>\n                    {TextManager.get(\"ui-structure-resource-generates\", {\n                        amount: generates,\n                        resource,\n                    })}\n                </div>\n            </div>\n            {full}\n            { workers > 0 &&\n            <TickingProgressbar\n                className=\"generating\"\n                direction={Direction.decreasing}\n                label={`${TextManager.get(\"ui-structure-resource-next-generates\", {\n                    amount: generates * workers,\n                    resource,\n                    time: formatDuration(delta)\n                })}`}\n                progress={delta / RESOURCE_INTERVAL}\n            />}\n            { !workers && TextManager.get(\"ui-structure-resource-no-workers\")}\n        </div>\n    )\n}\nexport default ResourceGenerationRow;","import * as React from \"react\";\nimport { Item } from \"definitions/items/types\";\nimport { TextManager } from \"global/TextManager\";\n\ninterface Props {\n    item: Item;\n}\n\nconst ItemText = ({ item }: Props) => (\n    <div className=\"text\">\n        <p className=\"name\">{TextManager.getItemName(item)}</p>\n        <p className=\"subtext\">{TextManager.getItemSubtext(item)}</p>\n    </div>\n)\n\nexport default ItemText;","import * as React from \"react\";\nimport { Item } from \"definitions/items/types\";\nimport { DragSourceType } from 'constants/dragging';\nimport DraggableItemIcon from '../DraggableItemIcon';\nimport ItemText from \"./ItemText\";\nimport { ReactNode } from \"react\";\nimport \"./styles/itemsList.scss\";\n\nexport interface Props {\n    className?: string;\n    items: Item[];\n    sourceType: DragSourceType;\n    sourceId?: string;\n    slots?: number; // optionally always show this amount of slots\n    renderButton?: (item: Item, index: number) => ReactNode\n}\n\n/**\n * The ItemsList displays a list of items vertically. Shows icon and description\n */\nconst DraggableItemsList = (props: Props) => {\n    const { renderButton, items } = props;\n    const className = `items-list ${props.className ?? ''}`;\n    const slots = props.slots ?? items.length;\n\n    return (\n        <ul className={className} >\n            {[...Array(slots)].map((_, index )=> {\n                const item = items[index]; \n                return (\n                    <li\n                        key={`${item}${index}`}\n                        className=\"item-row\"\n                    >\n                        <div className=\"item-placeholder\" />\n                        { item && (\n                            <>\n                                <DraggableItemIcon\n                                    item={item}\n                                    index={index}\n                                    sourceId={props.sourceId}\n                                    sourceType={props.sourceType}\n                                />\n                                <ItemText item={item} />\n                            </>\n                        )}\n                        { (item && renderButton) && renderButton(item, index) }\n                    </li>\n                )\n            })}\n        </ul>\n    );\n};\n\nexport default DraggableItemsList;\n","import { Item } from \"definitions/items/types\";\n\n// export function pick<T extends string, TEnumValue extends number>(table: {[key in keyof T]?: TEnumValue}) : T { \n// export function pick<T =Item>(table: {[key in Item]?: number}) : T { \nexport function pick(table: {[key in Item]?: number}) : Item { \n    const totalWeight = Object.values(table).reduce((acc, value) => (acc ?? 0 ) + (value ?? 0), 0) ?? 0;\n    const randomNumber = Math.floor(Math.random() * totalWeight + 1);\n\n    let weight = 0;\n    const entries = Object.entries(table);\n    for(let i = 0; i < entries.length; i++) {\n        weight += entries[i][1]!;\n        if (randomNumber <= weight) {\n            return entries[i][0] as unknown as Item\n        }\n    }\n    throw new Error()\n}\n\n/* Tests distribution */\nexport const test = () => {\n    const lootTable: {[key in Item]?: number} = {\n        \"herb/bogroot\": 2,\n        \"herb/winterWeed\": 1\n    }\n    const result: {[key in Item]?: number} = {}\n    for(let i = 0; i < 500; i++) {\n        const picked = pick(lootTable);\n        if (!result[picked]) {\n            result[picked] = 0\n        }\n        result[picked]!++;\n    }\n    console.log(result)\n}\n// */","import { Item } from 'definitions/items/types';\r\nimport { getDefinition, Structure } from \"definitions/structures\";\r\nimport { ResourceStructureDefinition, ResourceStructureLevelDefinition, StructureType } from \"definitions/structures/types\";\r\nimport { getTimeMultiplier, TimeType } from 'mechanics/time';\r\nimport { StoreState } from \"store/types\";\r\nimport { StructuresStoreState } from \"store/types/structures\";\r\nimport { pick } from \"mechanics/lootTable\";\r\nimport { ONE_HOUR } from 'utils/format/time';\r\nimport { ResourceStructureState } from 'store/types/structure';\r\n\r\n\r\n /*\r\n  *   */\r\nexport type HarvestUpdate = {\r\n    [key in Structure]?: Item[]\r\n}\r\n\r\nexport const HARVEST_INTERVAL = ONE_HOUR * 3; // every three hours constitutes a harvest tick.\r\n\r\n\r\nconst getHarvest = (state: StoreState): HarvestUpdate|null => {\r\n    const { lastHarvest } = state.engine;\r\n    const structures: StructuresStoreState = state.structures;\r\n    const result: HarvestUpdate = {};\r\n    const timeMultiplier = getTimeMultiplier(TimeType.resourceGeneration);\r\n\r\n\r\n    const handleStructure = (structure: Structure) => {\r\n        const structureDefinition = getDefinition(structure);\r\n\r\n        if (structureDefinition.type === StructureType.resource) {\r\n            const resourceStructureDefinition = structureDefinition as ResourceStructureDefinition;\r\n            const level: number = structures[structure as Structure].level;\r\n            const levelDefinition: ResourceStructureLevelDefinition = resourceStructureDefinition.levels[level];\r\n            \r\n            if (levelDefinition.harvest?.lootTable){\r\n                const state = structures[structure] as ResourceStructureState;\r\n                let itemCount = state.harvest?.length ?? 0;\r\n                const items: Item[] = [];\r\n                while (itemCount < levelDefinition.harvest.amount) {\r\n                    items.push(pick(levelDefinition.harvest.lootTable))\r\n                    itemCount ++;\r\n                }\r\n\r\n                result[structure] = items\r\n            }\r\n            \r\n        }\r\n    };\r\n\r\n\r\n    // Calculate what each structure generates. Stores in `result`.\r\n    if (Date.now() - lastHarvest > HARVEST_INTERVAL){\r\n        Object.keys(structures).forEach((structure) => handleStructure(structure as Structure));\r\n    }\r\n    return result;\r\n};\r\n\r\n\r\nexport default getHarvest;\r\n","import Icon, { IconSize, IconSizeType } from \"components/ui/common/Icon\";\nimport * as React from \"react\";\nimport { PropsWithChildren } from 'react';\nimport './styles/iconButton.scss';\n\nexport type Props = PropsWithChildren<{\n    iconImg: string;\n    size?: IconSizeType; // Can use enum or string\n}>\n\n\nconst IconButton = (props: React.ComponentProps<'button'> & Props) => {\n    const { iconImg, children, ...otherProps } = props;\n\n    const className = [\n        'icon-button',\n        (props.className ?? \"\"),\n        `size-${typeof props.size === \"string\" ? props.size : IconSize[props.size ?? IconSize.medium]}`,\n    ]\n\n    return (\n        <button\n            {...otherProps}\n            className={className.join(' ')}\n        >\n            <Icon\n                image={iconImg}\n                size={props.size}\n            />\n            { children && (\n                <div className=\"text\">\n                    {children}\n                </div>\n            )}\n        </button>\n    );\n};\n\nexport default IconButton;\n","import React from 'react';\nimport { TickingProgressbar } from \"components/ui/common/progress\";\nimport { Direction } from \"components/ui/common/progress/TickingProgressbar\";\nimport { Structure } from \"definitions/structures\";\nimport { TextManager } from \"global/TextManager\";\nimport { useEngine } from \"hooks/store/engine\";\nimport { HARVEST_INTERVAL } from \"mechanics/gameTick/harvest\";\nimport { formatDuration } from \"utils/format/time\";\nimport IconButton from 'components/ui/buttons/IconButton';\nimport { useDispatch } from 'react-redux';\nimport { reduceTime } from 'store/actions/game';\nimport \"./styles/harvestProgress.scss\"\n\ninterface Props {\n    structure: Structure;\n}\n\nconst HarvestProgress = (props: Props) => {\n    const engine = useEngine();\n    const dispatch = useDispatch();\n    const delta = HARVEST_INTERVAL - (Date.now() - engine.lastHarvest);\n\n    const handleReduceTime50 = () => {\n        dispatch(reduceTime(50, \"harvest\"))\n    }\n\n    return (\n        <div className=\"harvest-progress\">\n            <TickingProgressbar\n               className=\"harvest-progress\"\n               direction={Direction.decreasing}\n               label={`${TextManager.get(\"ui-structure-resource-next-harvest\", {\n                   time: formatDuration(delta)\n               })}`}\n               progress={delta / HARVEST_INTERVAL}\n            />\n            <IconButton iconImg=\"/img/ui/misc/clock.png\" size=\"smallest\" onClick={handleReduceTime50}> 50%</IconButton>\n        </div>\n    )\n}\n\nexport default HarvestProgress;","import { HarvestUpdate } from \"mechanics/gameTick/harvest\";\r\nimport { LogUpdate, QuestUpdate } from \"mechanics/gameTick/quests\";\r\nimport { State as seedrandomStateType } from \"seedrandom\";\r\nimport { ResourceStoreState } from \"store/types/resources\";\r\n\r\nexport type Time = \"harvest\" \r\nexport type GameAction = \r\n   { type: \"gameTick\", delta: number, rngState: seedrandomStateType | null, resources: ResourceStoreState | null, quests: QuestUpdate[], harvest: HarvestUpdate | null, log: LogUpdate[] }\r\n|  { type: \"startGame\" }\r\n|  { type: \"reduceTime\", percentage: number, time: Time }\r\n\r\n\r\nexport const startGame = (): GameAction => ({\r\n    type: \"startGame\",\r\n})\r\n\r\nexport const gameTick = (delta: number, rngState: seedrandomStateType | null, resources: ResourceStoreState | null, quests: QuestUpdate[], harvest: HarvestUpdate | null, log: LogUpdate[]): GameAction => ({\r\n    type: \"gameTick\",\r\n    delta,\r\n    rngState,\r\n    resources,\r\n    quests,\r\n    harvest,\r\n    log,\r\n})\r\n\r\nexport const reduceTime = (percentage: number, time: Time): GameAction => ({\r\n    type: \"reduceTime\",\r\n    percentage,\r\n    time\r\n})\r\n","export default __webpack_public_path__ + \"static/media/icon.745e2ffb.png\";","import * as React from \"react\";\nimport { getDefinition, Structure } from 'definitions/structures';\nimport resourceDescriptions from \"definitions/resources\";\nimport { ResourceStructureDefinition } from 'definitions/structures/types';\nimport { Resource } from 'definitions/resources';\nimport Icon from 'components/ui/common/Icon';\nimport { TextManager } from 'global/TextManager';\nimport \"./styles/upgradeHelpModalContent.scss\"\n\nexport interface Props  {\n    structure: Structure;\n    level: number;\n}\n\nconst UpgradeHelpModalContent = (props: Props) => {\n    const { level, structure } = props;\n    const structureDefinition: ResourceStructureDefinition = getDefinition(structure);\n\n    const currentLevel = structureDefinition.levels[level];\n    const nextLevel = structureDefinition.levels[level + 1];\n\n    const renderRow = (resource: Resource) => {\n        const resourceDescription = resourceDescriptions[resource];\n\n        return (\n            <React.Fragment key={resource}>\n                <div><Icon image={resourceDescription.iconImg} size=\"smallest\"/></div>\n                <div>\n                   {TextManager.get(\"ui-structure-resource-help-upgrade-resource-generates\", { resource })}\n                </div>\n                <div className=\"number\">{currentLevel.generates[resource]}</div>\n                <div className=\"arrow\">⟶</div>\n                <div className=\"number\">{nextLevel.generates[resource]}</div>\n            </React.Fragment>\n        )\n    }\n\n    return (\n        <div className=\"upgrade-help-model-content-resource\">\n            <div className=\"grid generates-increase\">\n                <div className=\"header\">\n                    <h3>{TextManager.get(\"ui-structure-help-upgrade-improvements\")}</h3>\n                </div>\n                <div className=\"header\"/>\n                <div className=\"header number\">\n                    {TextManager.get(\"ui-structure-help-upgrade-header-level\", {\n                        level: level + 1\n                    })}\n                </div>\n                <div className=\"header\"/>\n                <div className=\"header number\">\n                {TextManager.get(\"ui-structure-help-upgrade-header-level\", {\n                        level: level + 2\n                    })}\n                </div>\n                <div><Icon image={\"/img/resources/worker.png\"} size=\"smallest\"/></div>\n                <div>{TextManager.get(\"ui-structure-help-upgrade-worker-capacity\")}</div>\n                <div className=\"number\">{currentLevel.workerCapacity}</div>\n                <div className=\"arrow\">⟶</div>\n                <div className=\"number\">{nextLevel.workerCapacity}</div>\n                {Object.keys(nextLevel.generates).map(res => renderRow(res as Resource))}\n            </div>\n        </div>\n    )\n}\n\nexport default UpgradeHelpModalContent;","import * as React from \"react\";\nimport { ResourceStructure, Structure  } from \"definitions/structures\";\nimport { ResourceStructureLevelDefinition } from \"definitions/structures/types\";\nimport UpDownValue from \"components/ui/common/UpDownValue\";\nimport { useSelector, useDispatch } from 'react-redux';\nimport ReactMarkdown from \"react-markdown\";\nimport { StoreState } from 'store/types';\nimport { selectFreeWorkers } from 'store/selectors/workers';\nimport { decreaseWorkers, increaseWorkers, removeItemFromHarvest } from 'store/actions/structures';\nimport StructureViewHeader from '../StructureViewHeader';\nimport { TextManager } from 'global/TextManager';\nimport StructureLevel from '../StructureLevel';\nimport { TooltipManager } from 'global/TooltipManager';\nimport { ContextType } from 'constants/context';\nimport { useStructureLevel, useStructureState } from 'hooks/store/structures';\nimport ResourceGenerationRow from './ResourceGenerationRow';\nimport { Resource } from 'definitions/resources';\nimport DraggableItemsList from \"components/ui/items/DraggableItemsList\";\nimport { Item } from \"definitions/items/types\";\nimport { DragSourceType } from \"constants/dragging\";\nimport HarvestProgress from \"./HarvestProgress\";\nimport IconButton from \"components/ui/buttons/IconButton\";\nimport warehouseIcon from \"components/structures/styles/images/warehouse/icon.png\"\nimport { addItemToWarehouse } from \"store/actions/stockpile\";\nimport './styles/resourceStructureView.scss';\nimport UpgradeHelpModal from \"../UpgradeHelpModal\";\nimport UpgradeHelpModalContent from \"./UpgradeHelpModalContent\";\n\nexport interface Props  {\n    structure: Structure;\n}\n\n// todo: 02/12/2019 [ ] Can show progress bar in resource screen\nconst ResourceStructureView = (props: Props) => {\n    const {structure} = props;\n\n    // Fetch needed values from store\n    const {level, workers} = useStructureState(structure);\n    const workersFree = useSelector<StoreState, number>((store) => selectFreeWorkers(store));\n    const harvest = useSelector<StoreState, Item[]>((store) => selectHarvest(store, structure as ResourceStructure));\n    const levelDefinition = useStructureLevel<ResourceStructureLevelDefinition>(structure);\n    \n    // Reducer dispatch\n    const dispatch = useDispatch();\n    const handleWorkersDown = () => {\n        dispatch(decreaseWorkers(props.structure));\n    }\n\n    const handleWorkersUp = () => {\n        dispatch(increaseWorkers(props.structure));\n    };\n\n\n    const upDisabled = workers === levelDefinition.workerCapacity || (workersFree || 0) < 1;\n    const downDisabled = workers === 0;\n\n    const handleHelpClicked = (event: React.MouseEvent) => {\n        const origin = (event.currentTarget as HTMLElement);\n        const originRect = origin.getBoundingClientRect();\n        const content = (\n            <UpgradeHelpModal level={level} structure={structure}>\n                <UpgradeHelpModalContent level={level} structure={structure}/>\n            </UpgradeHelpModal>\n        );\n        TooltipManager.showContextTooltip(ContextType.component, content, originRect, \"upgrade-structure-tooltip\");\n\n        event.stopPropagation();\n    }\n\n    const handleItemTake = (item: Item, index: number) => {\n        dispatch(removeItemFromHarvest(structure, index));\n        dispatch(addItemToWarehouse(item))\n    }\n\n    return (\n        <>\n            <StructureViewHeader structure={props.structure} />\n            <div className=\"resource-structure-view\">\n                <section>\n                    <StructureLevel structure={structure} onHelpClicked={handleHelpClicked}/>\n                    <UpDownValue\n                        label={TextManager.get(\"ui-structure-production-workers\")}\n                        value={workers}\n                        max={levelDefinition.workerCapacity}\n                        upDisabled={upDisabled}\n                        downDisabled={downDisabled}\n                        onDown={handleWorkersDown}\n                        onUp={handleWorkersUp}\n                    />\n                    { /** Generates this resource */}\n                    <h3>Generates</h3>\n                    { Object.keys(levelDefinition.generates).map(r => <ResourceGenerationRow structure={structure} resource={r as Resource} key={r} />)}\n    \n                    { levelDefinition.harvest && (\n                        <>\n                            { /** Generates these items */}\n                            <h3>Harvest</h3>\n                            <ReactMarkdown>\n                                {TextManager.get(`ui-structure-resource-harvest-${structure}`)}\n                            </ReactMarkdown>\n                            <HarvestProgress structure={structure} /> \n                            <DraggableItemsList\n                                items={harvest}\n                                sourceType={DragSourceType.resourceStructure}\n                                sourceId={structure}\n                                slots={levelDefinition.harvest?.amount}\n                                renderButton={(item: Item, index: number) => (<IconButton iconImg={warehouseIcon} onClick={() => handleItemTake(item, index)} >Take</IconButton>)}\n                            />\n                           \n                        </>\n                    )}\n                </section>\n            </div>\n        </>\n    );\n};\n\nexport default ResourceStructureView;\n\nconst selectHarvest = (store: StoreState, structure: ResourceStructure): Item[] => {\n    return store.structures[structure].harvest ?? [];\n}","import * as React from \"react\";\nimport { getDefinition, Structure } from \"definitions/structures\";\nimport { StructureDefinition, StructureType } from \"definitions/structures/types\";\nimport { StructureState } from \"store/types/structure\";\nimport { useSelector } from 'react-redux';\nimport { StoreState } from 'store/types';\nimport { TasksStoreState } from 'store/types/tasks';\nimport { useStructureState } from 'hooks/store/structures';\nimport { withWindow } from 'hoc/withWindow';\nimport { Props as WindowProps } from \"components/ui/window/Window\";\nimport { formatDuration } from 'utils/format/time';\nimport { TickingProgressbar } from 'components/ui/common/progress';\nimport ProductionStructureView from 'components/structures/production/ProductionStructureView';\nimport WarehouseStructureView from 'components/structures/warehouse/WarehouseStructureView';\nimport TavernStructureView from 'components/structures/tavern/TavernStructureView';\nimport ResourceStructureView from 'components/structures/resource/ResourceStructureView';\nimport { Link, useParams } from \"react-router-dom\";\nimport { TextManager } from \"global/TextManager\";\nimport Button from \"components/ui/buttons/Button\";\nimport { getStructureLink } from \"utils/routing\";\nimport \"./styles/structuredetailsview.scss\";\n\nexport interface Props {\n    structure: Structure;\n}\n\nconst StructureDetailsView = (props: Props & WindowProps) => {\n    const tasks = useSelector<StoreState, TasksStoreState>(store => store.tasks);\n    const buildTask = tasks.running.filter((val) =>\n        val.origin === `town` && val.name === `${props.structure}.build`)[0];\n    const structureState = useStructureState(props.structure);\n\n    const renderContent = () => {\n        if (structureState.state === StructureState.Building) {\n            if (!buildTask) return null;\n            return (\n                <div className=\"building\">\n                    <TickingProgressbar\n                        progress={buildTask.progress}\n                        label={`Building... (${formatDuration(buildTask.timeRemaining)})`}\n                    />\n                </div>\n            );\n        } else {\n\n            const structureDefinition: StructureDefinition = getDefinition(props.structure);\n            switch (structureDefinition.type) {\n                case StructureType.production: {\n                    return <ProductionStructureView structure={props.structure}/>;\n                }\n                case StructureType.resource: {\n                    return <ResourceStructureView structure={props.structure} />;\n                }\n                case StructureType.warehouse: {\n                    return <WarehouseStructureView />;\n                }\n                case StructureType.tavern: {\n                    return <TavernStructureView />;\n                }\n                default: {\n                    return <div> { props.structure } </div>;\n                }\n            }\n        }\n    }\n\n    return (\n        <div className=\"structure-details\">\n            { renderContent() }\n        </div>\n    );\n};\n\nexport default StructureDetailsView\nexport const StructureDetailsWindow = withWindow(StructureDetailsView);\n\nexport const RoutedStructureDetailsView = () => {\n    const { structure } = useParams<{structure: Structure}>();\n    const title = TextManager.getStructureName(structure)\n    return (\n        <div className=\"structure-details-window \">\n            <div className=\"header\">\n                <h3>{ title }</h3>\n                <Link to={getStructureLink(structure, true)}>\n                    <Button\n                        className=\"close-button\"\n                        square={true}\n                        size={\"medium\"}\n                        color=\"purple\"\n                        text=\"x\"\n                    />\n                </Link>\n            </div>\n            <StructureDetailsView structure={structure} title={title}  />\n        </div>\n    )\n}","import React, { useRef, useEffect, useState } from \"react\";\r\nimport { Structure } from 'definitions/structures';\r\nimport { StructuresStoreState } from 'store/types/structures';\r\nimport { SoundManager, Channel, MixMode } from 'global/SoundManager';\r\nimport { Route, Switch, useHistory, useRouteMatch } from 'react-router';\r\nimport {OutlineFilter} from '@pixi/filter-outline';\r\nimport { getStructureLink, getTownLink } from 'utils/routing';\r\nimport { StructureState, StructureStoreState } from 'store/types/structure';\r\nimport { useSelector } from 'react-redux';\r\nimport { StoreState } from 'store/types';\r\nimport { gsap } from 'gsap';\r\nimport { MAX_WIDTH } from 'components/App';\r\nimport HitAreaShapes from 'utils/hitAreaShapes';\r\nimport polygons from './hitAreas.json';\r\nimport LumberMill from './structures/LumberMill';\r\nimport Tavern from './structures/Tavern';\r\nimport { withAppContext } from 'hoc/withAppContext';\r\nimport Generic from './structures/Generic';\r\nimport Legenda from './Legenda';\r\nimport TownStage from './TownStage';\r\nimport { Viewport as PixiViewport } from \"pixi-viewport\";\r\nimport Clouds from './Clouds';\r\nimport { Point } from \"pixi.js\";\r\nimport { RoutedStructureDetailsView } from \"./StructureDetailsView\";\r\nimport \"./styles/townView.scss\"\r\n\r\nconst HEIGHT = 1079;\r\nconst WORLD_WIDTH = 1024;\r\nconst WORLD_HEIGHT = 1600;\r\n\r\n\r\n\r\nexport const STRUCTURE_HIGHLIGHT_FILTER = new OutlineFilter(8, 0xffcc00);\r\n\r\nconst TownView = () => {\r\n    const match = useRouteMatch<{structure: string}>(`${getTownLink()}/:structure`);\r\n    const selectedStructure = match?.params.structure;\r\n    const ref = useRef<HTMLDivElement>(null);\r\n    const viewportRef = useRef<PixiViewport>(null);\r\n    const dragging = useRef(false);\r\n    const history = useHistory();\r\n\r\n    useEffect(() => {\r\n        SoundManager.addSound(\"music/town\", \"sound/music/Soliloquy.mp3\", () => {\r\n            SoundManager.playSound(\"music/town\", Channel.music, true, MixMode.fade, true);\r\n        })\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        const tween = gsap.to(STRUCTURE_HIGHLIGHT_FILTER, {\r\n            duration: .6,\r\n            thickness: 2,\r\n            yoyo: true,\r\n            repeat: -1\r\n        });\r\n        return () => {\r\n            tween.pause(0);\r\n            tween.kill();\r\n        }\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        if(viewportRef.current) {\r\n\r\n            const viewport = viewportRef.current;\r\n            viewport.on(\"drag-start\", (e) => {\r\n                dragging.current = true;\r\n                e.event.stopPropagation();\r\n            });\r\n            viewport.on(\"drag-end\", () => { dragging.current = false; });\r\n        }\r\n    }, []);\r\n\r\n    const handleStructureClick = (structure: Structure | null) => {\r\n        if (!dragging.current && structure) {\r\n            SoundManager.playSound(\"ui/buttonClick\");\r\n            history.push(getStructureLink(structure))\r\n        }\r\n    }\r\n\r\n    const structures = useSelector<StoreState, StructuresStoreState>((state: StoreState) => {\r\n        return state.structures;\r\n    });\r\n\r\n    const renderStructures = () => {\r\n        const orderedStructures: Structure[] = [\r\n            \"workshop\",\r\n            \"quarry\",\r\n            \"tavern\",\r\n            \"tannery\",\r\n            \"alchemist\",\r\n            \"garden\",\r\n            \"weaponsmith\",\r\n            \"armoursmith\",\r\n            \"warehouse\",\r\n            \"mine\",\r\n            \"lumberMill\",\r\n            \"weaver\",\r\n        ]\r\n        return orderedStructures.reverse().map((structure) => {\r\n            const structureStore: StructureStoreState = structures[structure];\r\n            if (structureStore.state === StructureState.NotBuilt) {\r\n                return null;\r\n            }\r\n            // todo: refactor into seperate components\r\n\r\n            const StructureComponent = getStructure(structure);\r\n            const position = getStructurePosition(structure);\r\n            const hitAreaShapes = new HitAreaShapes(polygons, structure as string);\r\n            return (\r\n                <StructureComponent\r\n                    position={position}\r\n                    structure={structure}\r\n                    hitAreaShapes={hitAreaShapes}\r\n                    onStructureClick={handleStructureClick}\r\n                    key={structure}\r\n                    selected={selectedStructure === structure}\r\n                />\r\n            );\r\n        });\r\n    }\r\n\r\n    useEffect(() => {\r\n        if (selectedStructure && viewportRef.current) {\r\n            const viewport = viewportRef.current;\r\n            viewport.zoomPercent(0);\r\n            const position = getStructurePosition(selectedStructure as Structure);\r\n            viewport.moveCenter(position);\r\n        }\r\n    }, [selectedStructure]);\r\n\r\n    const [canvasWidth, setCanvasWidth] = useState(MAX_WIDTH);\r\n    const [canvasHeight, setCanvasHeight] = useState(HEIGHT);\r\n\r\n    useEffect(() => {\r\n        // This will set the dimensions of the canvas tot that of the townview\r\n        const resize = () => {\r\n            const worldViewWidth = ref.current?.clientWidth || MAX_WIDTH;\r\n            const worldViewHeight = ref.current?.clientHeight || HEIGHT;\r\n\r\n            setCanvasWidth(worldViewWidth);\r\n            setCanvasHeight(worldViewHeight);\r\n        }\r\n        resize();\r\n        window.addEventListener(\"resize\", resize);\r\n        return () => {\r\n            window.removeEventListener(\"resize\", resize);\r\n        };\r\n    }, []);\r\n\r\n\r\n    return (\r\n        <div className=\"town-view\" ref={ref}>\r\n            <Legenda structures={structures} />\r\n            <TownStage\r\n                screenWidth={canvasWidth}\r\n                screenHeight={canvasHeight}\r\n                worldWidth={WORLD_WIDTH}\r\n                worldHeight={WORLD_HEIGHT}\r\n                ref={viewportRef}\r\n            >\r\n                <Clouds worldWidth={canvasWidth} />\r\n                {renderStructures()}\r\n                <Clouds worldWidth={canvasWidth} />\r\n            </TownStage>\r\n            <Switch>\r\n                <Route path=\"/town/:structure/view\" >\r\n                    <RoutedStructureDetailsView />\r\n                </Route>\r\n            </Switch>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default withAppContext(TownView);\r\n\r\nconst getStructure = (structure: Structure) => {\r\n    switch (structure) {\r\n        case \"workshop\":\r\n        case \"quarry\":\r\n        case \"tannery\":\r\n        case \"alchemist\":\r\n        case \"garden\":\r\n        case \"weaponsmith\":\r\n        case \"armoursmith\":\r\n        case \"warehouse\":\r\n        case \"mine\":\r\n        case \"weaver\":\r\n            return Generic;\r\n        case \"lumberMill\":\r\n            return LumberMill;\r\n        case \"tavern\":\r\n            return Tavern;\r\n    }\r\n}\r\n\r\nconst getStructurePosition = (structure: Structure) => {\r\n    let x;\r\n    let y;\r\n    switch (structure) {\r\n        case \"workshop\":\r\n            x = 373;\r\n            y = 610;\r\n            break;\r\n        case \"quarry\":\r\n            x = 632;\r\n            y = 633;\r\n            break;\r\n        case \"tannery\":\r\n            x = 372;\r\n            y = 460;\r\n            break;\r\n        case \"tavern\":\r\n            x = 500;\r\n            y = 469;\r\n            break;\r\n        case \"alchemist\":\r\n            x = 411;\r\n            y = 371;\r\n            break;\r\n        case \"garden\":\r\n            x = 822;\r\n            y = 689;\r\n            break;\r\n        case \"weaponsmith\":\r\n            x = 449;\r\n            y = 460;\r\n            break;\r\n        case \"armoursmith\":\r\n            x = 473;\r\n            y = 442;\r\n            break;\r\n        case \"warehouse\":\r\n            x = 471;\r\n            y = 130;\r\n            break;\r\n        case \"lumberMill\":\r\n            x = 403;\r\n            y = 320;\r\n            break;\r\n        case \"mine\":\r\n            x = 183;\r\n            y = 527;\r\n            break;\r\n        case \"weaver\":\r\n            x = 484;\r\n            y = 333;\r\n            break;\r\n    }\r\n    return new Point(x, y);\r\n}","import React, { useEffect, useState } from 'react';\nimport { ToastManager, ToastConfig, EVENT_TOASTS_UPDATED } from 'global/ToastManager';\nimport Toast from './Toast';\nimport './styles/toasts.scss';\n\n// Toasts can be added by calling ToastManager.addToast\n// ToastManager will inform whenever the something is added to the list of toasts via EVENT_TOASTS_UPDATED\n// The toasts themselves will fade out via css transition\nconst Toasts = () => {\n\n    const [activeToasts, setActiveToasts] = useState<ToastConfig[]>([]);\n\n    const toastsUpdated = (stack?: ToastConfig[]) => {\n        if (stack) setActiveToasts(stack);\n    }\n\n    useEffect(() => {\n        ToastManager.instance.addListener(EVENT_TOASTS_UPDATED, toastsUpdated);\n        return () => {\n            ToastManager.instance.removeListener(EVENT_TOASTS_UPDATED, toastsUpdated);\n        }\n    }, []);\n\n    return (\n        <div className=\"toasts\" > \n            { activeToasts.map((toastConfig) => (\n                <Toast key={toastConfig.time} {...toastConfig}/>\n            ))}\n        </div>\n    )\n}\n\nexport default Toasts;","import * as React from \"react\";\r\nimport { compose } from \"redux\";\r\nimport { ChangeEvent } from 'react';\r\nimport gsap from 'gsap';\r\nimport { Channel, SoundManager } from 'global/SoundManager';\r\nimport { withWindow } from \"hoc/withWindow\";\r\nimport \"./styles/settings.scss\";\r\n\r\nconst SettingsWindow = () => {\r\n\r\n    const getChannelControls = (channel: Channel) => {\r\n        const handleVolumeChange = (e: ChangeEvent<HTMLInputElement>) => {\r\n            const linear = parseFloat(e.target.value);\r\n            const log = Math.pow(linear, 2);\r\n            SoundManager.setChannelVolume(channel, log);\r\n        };\r\n        const handleMuteClick = (e: React.MouseEvent<HTMLButtonElement>) => {\r\n            const slider = (e.currentTarget as HTMLButtonElement).parentNode?.lastChild;\r\n            if (slider) {\r\n                gsap.to(slider, {\r\n                    duration: .5,\r\n                    value: 0,\r\n                    onComplete: () => {\r\n                        SoundManager.setChannelVolume(channel, 0);\r\n                    }\r\n                });\r\n            }\r\n        }\r\n\r\n        return (\r\n            <p>\r\n                <label>{Channel[channel]}</label>\r\n                <button onClick={handleMuteClick}>\r\n                    <span role=\"img\" aria-label=\"Mute\">🔇</span>\r\n                </button>\r\n                <input\r\n                    type=\"range\"\r\n                    min=\"0\"\r\n                    max=\"1\"\r\n                    step=\"0.05\"\r\n                    onChange={handleVolumeChange}\r\n                    defaultValue={`${Math.sqrt(SoundManager.getChannelVolume(channel))}`}\r\n                />\r\n            </p>\r\n        )\r\n    }\r\n\r\n    return (\r\n        <div className=\"settings-window\">\r\n            <details open = { true } className=\"sound\" >\r\n                <summary>Sound volume</summary>\r\n                <section>\r\n                    {getChannelControls(Channel.ui)}\r\n                    {getChannelControls(Channel.scene)}\r\n                    {getChannelControls(Channel.music)}\r\n                </section>\r\n            </details>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default compose(\r\n    withWindow,\r\n)(SettingsWindow);\r\n","import React from 'react';\nimport Select, { Props} from 'react-select';\n\n\nconst DefaultSelect = (props: Props) => {\n    return <Select\n        styles={{\n            control: (provided, state) => ({\n                ...provided,\n                minHeight: 'inherit',\n                height: '32px',\n                boxShadow: '0',\n                border: state.isFocused ? '1px solid orange' : '1px solid #B1B1B1',\n                ':hover': {\n                    border: '1px solid orange'\n                }             \n            }),\n            container: (provided, _state) => ({\n                ...provided,\n                flex: 1\n            }),\n            option: (provided) => ({\n                ...provided,\n                padding: '4px 12px',\n            }),\n            placeholder: (provided) => ({\n                ...provided,\n                whiteSpace: 'nowrap'\n            }), \n            valueContainer: (provided) => ({\n                ...provided,\n                marginTop: '-2px'\n            }), \n            indicatorsContainer: (provided) => ({\n                ...provided,\n                marginTop: '-2px',\n\n                'div': {\n                    padding: '4px'\n                }\n            }),\n            \n        }}\n        {...props}\n    />\n}\nDefaultSelect.displayName = \"DefaultSelect\";\n\nexport default DefaultSelect;","import { EquipmentSlotType } from \"components/ui/adventurer/EquipmentSlot\";\nimport { Apparel } from \"definitions/items/apparel\";\nimport { Item } from \"definitions/items/types\";\nimport { Weapon } from \"definitions/items/weapons\";\nimport { Trait } from 'definitions/traits/types';\n\nexport interface AdventurerStoreState {\n    id: string;\n    name: string;\n    avatarImg: string;\n    spritesheetPath: string;            // Path to JSON of spritesheet to use in scenes\n    color?: AdventurerColor;\n    traits?: Trait[];\n    health: number;                     // When this reaches zero, the adventurer is dead\n    xp: number;\n    baseAP: number;                     // Amount of AP this adventurer has\n\n    equipment: EquipmentStoreState;     // equipment\n    inventory: (null | Item)[];\n    basicAttributes: BasicAttributesStoreState;\n    skills: SkillsStoreState;           //\n    room: number;                       // Adventurer is lodged in this room in the tavern\n}\n\nexport enum AdventurerColor {\n    blue,\n    red,\n    teal,\n    purple,\n    orange,\n    black,\n    white,\n    yellow\n}\n\nexport interface EquipmentStoreState {\n    [EquipmentSlotType.head]?: Apparel;\n    [EquipmentSlotType.shoulders]?: Apparel;\n    [EquipmentSlotType.chest]?: Apparel;\n    [EquipmentSlotType.hands]?: Apparel;\n    [EquipmentSlotType.legs]?: Apparel;\n    [EquipmentSlotType.feet]?: Apparel;\n    [EquipmentSlotType.mainHand]?: Weapon;\n    [EquipmentSlotType.offHand]?: Weapon;\n}\n\nexport interface BasicAttributesStoreState {\n    strength: number;\n    dexterity: number;\n    intelligence: number;\n    health: number;\n}\n\nexport interface SkillsStoreState {\n    [key: string]: number\n}\n","import * as React from \"react\";\r\nimport { useEffect, useMemo,  useState } from 'react';\r\nimport { getDefinition } from \"definitions/items\";\r\nimport { Item, ItemType } from \"definitions/items/types\";\r\nimport { getDefinition as getStructureDefinition, Structure } from \"definitions/structures\";\r\nimport { StructureState, StructureStoreState } from \"store/types/structure\";\r\nimport { StructuresStoreState } from \"store/types/structures\";\r\nimport { TextManager } from \"global/TextManager\";\r\nimport { ToastManager } from 'global/ToastManager';\r\nimport { Type } from 'components/ui/toasts/Toast';\r\nimport { useDispatch, useSelector } from 'react-redux';\r\nimport { addLogText } from 'store/actions/log';\r\nimport { LogChannel } from 'store/types/logEntry';\r\nimport { resourceOrder } from 'constants/resources';\r\nimport { ResourceStoreState } from 'store/types/resources';\r\nimport { addResources } from 'store/actions/resources';\r\nimport { setStructureState } from 'store/actions/structures';\r\nimport { StoreState } from 'store/types';\r\nimport { addGold } from 'store/actions/gold';\r\nimport { addItemToWarehouse } from 'store/actions/stockpile';\r\nimport { withWindow } from 'hoc/withWindow';\r\nimport { getTimeMultiplier, setCheatTimeMultiplier, TimeType } from 'mechanics/time';\r\nimport ItemIcon from \"components/ui/items/ItemIcon\";\r\nimport { IconSize } from \"components/ui/common/Icon\";\r\nimport Button from \"components/ui/buttons/Button\";\r\nimport Select from \"components/ui/common/Select\";\r\nimport allItems from \"definitions/items\";\r\nimport { addWorkers } from \"store/actions/workers\";\r\nimport \"./styles/cheat.scss\";\r\n\r\nconst CheatWindow = () => {\r\n\r\n    const [cheats, setCheats] = useState({\r\n        gold: 50,\r\n        resources: 50,\r\n        workers: 10,\r\n    });\r\n    const [selectedItem, setSelectedItem] = useState<string|null>();\r\n    const dispatch = useDispatch();\r\n    const [timeMultiplier, setTimeMultiplier] = useState(getTimeMultiplier(TimeType.cheat));\r\n\r\n    const onCheatGold = (amount: number) => {\r\n        dispatch(addGold(amount));\r\n        dispatch(addLogText(\"common-cheat-gold-added\", { amount }, LogChannel.common));\r\n    };\r\n\r\n    const onCheatItem = (item: Item) => {\r\n        dispatch(addItemToWarehouse(item));\r\n        dispatch(addLogText(\"common-cheat-item-added\", { item }, LogChannel.common));\r\n    };\r\n\r\n    const onCheatResources = (amount: number) => {\r\n        // Create ResourceStoreState where value of each resource is `amount`\r\n        const resources = resourceOrder.reduce((acc: ResourceStoreState, resource) => {\r\n            acc[resource] = amount;\r\n            return acc;\r\n        }, {});\r\n\r\n        dispatch(addResources(resources));\r\n        dispatch(addLogText(\"common-cheat-resources-added\", { amount }, LogChannel.common));\r\n    };\r\n\r\n    const onCheatStructureState = (structure: Structure, state: StructureState) => {\r\n        dispatch(setStructureState(structure, state))\r\n    }\r\n\r\n    const onCheatWorkers = (amount: number) => {\r\n        dispatch(addWorkers(amount));\r\n        dispatch(addLogText(\"common-cheat-workers-added\", { amount }, LogChannel.common));\r\n    };\r\n\r\n    const structures = useSelector<StoreState, StructuresStoreState>(store => store.structures);\r\n\r\n    const getStructureRow = (structure: Structure) => {\r\n        const structureDef = getStructureDefinition(structure);\r\n        const structureStore: StructureStoreState = structures[structure];\r\n        const levelDef = structureDef.levels[structureStore.level];\r\n\r\n        const displayName = TextManager.get(levelDef.displayName);\r\n\r\n        return (\r\n            <div\r\n                className=\"label-dropdown\"\r\n                key={structure}\r\n            >\r\n                <label title={structure}>\r\n                    {`${displayName}`}\r\n                </label>\r\n                <input\r\n                    key={structure}\r\n                    type=\"checkbox\"\r\n                    checked={structureStore.state === StructureState.Built}\r\n                    onChange={() => handleChangeStructureState(structure, structureStore.state !== StructureState.Built)}\r\n                />\r\n            </div>\r\n        );\r\n    };\r\n\r\n    const handleCheatGold = (_evt: React.MouseEvent<HTMLButtonElement>) => {\r\n        const amount = cheats.gold;\r\n        onCheatGold(amount);\r\n\r\n        const text = TextManager.get(\"common-cheat-gold-added\", { amount });\r\n        const icon = \"/img/resources/gold.png\";\r\n        ToastManager.addToast(text, Type.cheat, icon);\r\n    }\r\n\r\n    const handleCheatWorkers = (_evt: React.MouseEvent<HTMLButtonElement>) => {\r\n        const amount = cheats.workers;\r\n        onCheatWorkers(amount);\r\n        const text = TextManager.get(\"common-cheat-workers-added\", { amount });\r\n        const icon = \"/img/resources/worker.png\";\r\n        ToastManager.addToast(text, Type.cheat, icon);\r\n    }\r\n\r\n    const handleCheatResources = (_evt: React.MouseEvent<HTMLButtonElement>) => {\r\n        onCheatResources(cheats.resources);\r\n        const text = TextManager.get(\"common-cheat-resources-added\", { amount: cheats.resources });\r\n        ToastManager.addToast(text, Type.cheat);\r\n    }\r\n\r\n    const handleCheatItem = (_evt: React.MouseEvent<HTMLButtonElement>) => {\r\n        const item = selectedItem as Item;\r\n        onCheatItem(item);\r\n\r\n        const text = TextManager.get(\"common-cheat-item-added\", { item });\r\n        const icon = getDefinition(item).iconImg;\r\n        ToastManager.addToast(text, Type.cheat, icon);\r\n    }\r\n\r\n    const handleChangeStructureState = (structure: Structure, checked: boolean) => {\r\n        onCheatStructureState(structure, checked ? StructureState.Built : StructureState.NotBuilt);\r\n        if (checked) {\r\n            ToastManager.addToast(`The ${TextManager.getStructureName(structure)} is constructed`, Type.cheat);\r\n        } else {\r\n            ToastManager.addToast(`The ${TextManager.getStructureName(structure)} is not constructed`, Type.cheat);\r\n        }\r\n    }\r\n\r\n    const handleChangeGold = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n        const amount = Number.parseFloat(event.target.value);\r\n        setCheats({\r\n            ...cheats,\r\n            gold: amount,\r\n        });\r\n    }\r\n\r\n    const handleChangeWorkers = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n        const amount = Number.parseFloat(event.target.value);\r\n        setCheats({\r\n            ...cheats,\r\n            workers: amount,\r\n        });\r\n    }\r\n\r\n    const handleChangeResources = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n        const amount = Number.parseFloat(event.target.value);\r\n        setCheats({\r\n            ...cheats,\r\n            resources: amount,\r\n        });\r\n    }\r\n\r\n    const handleChangeTimeMultiplier = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n        const value = Number.parseFloat(event.target.value);\r\n        setTimeMultiplier(value)\r\n        setCheatTimeMultiplier(value);\r\n    }\r\n\r\n    const items = useMemo(() => (Object.keys(ItemType)\r\n        .filter(k => !isNaN(parseInt(k))) // such a weird way to unumerate an enum.. sigh\r\n        .map((typeKey: string) => {\r\n            const type = ItemType[typeKey as unknown as number] as unknown as ItemType;\r\n            return {\r\n                label: type as unknown as ItemType,\r\n                value: \"\",\r\n                subtext: \"\",\r\n                options: Object.keys(allItems) \r\n                    .filter((item: string) => getDefinition(item as Item).itemType as unknown as string == typeKey)\r\n                    .map((item: string) => ({\r\n                        value: item,\r\n                        label: TextManager.getItemName(item as Item),\r\n                        subtext: TextManager.getItemSubtext(item as Item),\r\n                    })\r\n                )\r\n            }\r\n        })\r\n    ), []);\r\n\r\n    useEffect(() => {\r\n        if (process.env.NODE_ENV !== 'production') {\r\n            TextManager.printNotFounds();\r\n        }\r\n    }, [])\r\n\r\n    return (\r\n        <div className=\"cheat-window\">\r\n            <div className=\"label-numberbox-button\">\r\n                <label>Gold</label>\r\n                <input type=\"number\"\r\n                    value={cheats.gold}\r\n                    style={{ width: \"50px\" }}\r\n                    onChange={handleChangeGold} />\r\n                <button onClick={handleCheatGold}>Add</button>\r\n            </div>\r\n            <div className=\"label-numberbox-button\">\r\n                <label>Workers</label>\r\n                <input type=\"number\"\r\n                    value={cheats.workers}\r\n                    style={{ width: \"50px\" }}\r\n                    onChange={handleChangeWorkers} />\r\n                <button onClick={handleCheatWorkers}>Add</button>\r\n            </div>\r\n            <div className=\"label-numberbox-button\">\r\n                <label>Resources</label>\r\n                <input type=\"number\"\r\n                    value={cheats.resources}\r\n                    style={{ width: \"50px\" }}\r\n                    onChange={handleChangeResources} />\r\n                <button onClick={handleCheatResources}>Add</button>\r\n            </div>\r\n            <div className=\"label-numberbox-button\">\r\n                <label>Items</label>\r\n                <Select\r\n                    placeholder={\"Find item in any category...\"}                   \r\n                    onChange={(e) => setSelectedItem(e?.value)}\r\n                    formatGroupLabel={(data) => (\r\n                        <div className=\"item-group\">\r\n                            <div className=\"item-group-label\">{data.label}</div>\r\n                            <div className=\"item-group-count\">{data.options.length} items</div>\r\n                        </div>\r\n                    )}\r\n                    formatOptionLabel={option => (\r\n                        <div className=\"item-option\">\r\n                            <ItemIcon item={option.value as Item} size={IconSize.smallest} />\r\n                            <div className=\"item-label\">\r\n                                {option.label}\r\n                                <span>{(option as unknown as { subtext: string}).subtext}</span>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                    options={items} />\r\n                <Button onClick={handleCheatItem}>Add</Button>\r\n            </div>\r\n            <div className=\"label-range-value\">\r\n                <label>Speed</label>\r\n                <input\r\n                    type=\"range\"\r\n                    min=\"1\" max=\"10\" value={timeMultiplier} step={1}\r\n                    onChange={handleChangeTimeMultiplier}\r\n                />\r\n                {timeMultiplier}x speed\r\n            </div>\r\n            <div>\r\n                <h2>Structures</h2>\r\n            </div>\r\n            { Object.keys(structures).map((structure) => getStructureRow(structure as Structure))}\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default withWindow(CheatWindow);\r\n\r\n","export type WorkersAction = {\n  type: \"addWorkers\",\n  value: number\n}\n\nexport const addWorkers = (value: number): WorkersAction => ({\n    type: \"addWorkers\",\n    value,\n})\n\nexport const subtractWorkers = (value: number): WorkersAction => ({\n    type: \"addWorkers\",\n    value: -value,\n})","import { createEncryptor } from 'simple-encryptor';\nimport { StoreState } from 'store/types';\nconst key = \"P5mw}jD>5c6Y]yqy\";\nconst encryptor = createEncryptor(key);\n\nexport const saveGame = (storeState: StoreState) => {\n    const a = document.createElement('a');\n    const text = JSON.stringify(storeState);\n    const encrypted = encryptor.encrypt(text);\n    const filename = \"Gidletown save.json\";\n    a.setAttribute('href', 'data:text/json;charset=utf-8,' + encodeURIComponent(encrypted));\n    a.setAttribute('download', filename);\n    a.click();\n}\n\nexport const decryptSavedGame = (encrypted: string) : StoreState => {\n    const text = encryptor.decrypt(encrypted);\n    return JSON.parse(text);\n}","import { Props as WindowProps } from \"components/ui/window/Window\";\r\nimport { AppContextProps, withAppContext } from \"hoc/withAppContext\";\r\nimport { withWindow } from \"hoc/withWindow\";\r\nimport * as React from \"react\";\r\nimport { compose } from \"redux\";\r\nimport SettingsWindow from './SettingsWindow';\r\nimport CheatWindow from './CheatWindow';\r\nimport { useSelector } from 'react-redux';\r\nimport { StoreState } from 'store/types';\r\nimport { Persistor } from 'redux-persist';\r\nimport { loadGame } from 'index';\r\nimport { useState } from 'react';\r\nimport { ToastManager } from 'global/ToastManager';\r\nimport { Type } from 'components/ui/toasts/Toast';\r\nimport { TextManager } from 'global/TextManager';\r\nimport Button from 'components/ui/buttons/Button';\r\nimport { decryptSavedGame, saveGame } from \"utils/game\";\r\nimport \"./styles/menu.scss\";\r\n\r\nexport interface Props {\r\n    persistor: Persistor;\r\n}\r\n\r\ntype AllProps = Props & WindowProps;\r\nconst Menu = (props: AllProps & AppContextProps) => {\r\n\r\n    const storeState = useSelector<StoreState>(state => state);\r\n    const [loadedStore, setLoadedStore] = useState<StoreState>();\r\n\r\n    const handleClickCheats = () => {\r\n        const window = <CheatWindow title=\"Cheats\" />;\r\n        props.onOpenWindow(window);\r\n    };\r\n\r\n    const handleClickSettings = () => {\r\n        const window = <SettingsWindow title=\"Settings\" />;\r\n        props.onOpenWindow(window);\r\n    };\r\n\r\n    const handleClickSave = () => {\r\n       saveGame(storeState as StoreState);\r\n    }\r\n\r\n    const handleClickLoad = async () => {\r\n        if (!loadedStore) return;\r\n        setLoadedStore(undefined);\r\n\r\n        await loadGame(loadedStore);\r\n        ToastManager.addToast(TextManager.get(\"ui-game-loaded\"), Type.game, \"/img/items/misc/magic-eye.png\");\r\n        props.onCloseWindow();\r\n\r\n    }\r\n\r\n    const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const fileReader = new FileReader();\r\n        fileReader.onload = () => {\r\n            const encrypted = fileReader.result as string;\r\n            const state =  decryptSavedGame(encrypted)\r\n\r\n            setLoadedStore(state);\r\n        }\r\n        if (e.target.files){\r\n            fileReader.readAsText(e.target.files[0]);\r\n        }\r\n    }\r\n\r\n\r\n\r\n    return (\r\n        <div className=\"menu\">\r\n            <p>\r\n                <Button onClick={handleClickCheats}>Cheats!</Button>\r\n            </p>\r\n            <p>\r\n                <Button onClick={handleClickSettings}>Settings</Button>\r\n            </p>\r\n            <fieldset>\r\n                <legend>Save and load</legend>\r\n                <section>\r\n                    Save game to disk:&nbsp;\r\n                    <Button onClick={handleClickSave}>Save</Button>\r\n                </section>\r\n                <section>\r\n                    Load game from disk:&nbsp;\r\n                    <input type=\"file\" onChange={handleFileChange} />\r\n                    <Button onClick={handleClickLoad} disabled={!loadedStore}>Load</Button>\r\n                </section>\r\n            </fieldset>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default compose(\r\n    withWindow,\r\n    withAppContext,\r\n)(Menu) as React.ComponentType<AllProps>;\r\n","import { resourceOrder } from \"constants/resources\";\nimport resourceDescriptions, { Resource } from \"definitions/resources\";\nimport * as React from \"react\";\nimport { ResourceStoreState } from \"store/types/resources\";\nimport { formatNumber } from 'utils/format/number';\nimport { TooltipManager } from 'global/TooltipManager';\nimport { ContextType } from 'constants/context';\nimport useGoldState from 'hooks/store/useGoldState';\nimport { useMaxResourcesState, useResourcesState } from 'hooks/store/resources';\nimport { useWorkersFreeState } from 'hooks/store/useWorkersState';\nimport Icon from 'components/ui/common/Icon';\nimport \"./styles/resourcebar.scss\";\n\nexport interface StateProps  {\n    gold: number;\n    workers: number;    // total\n    workersFree: number;\n    resources: ResourceStoreState;\n}\n\n/** Shown on top in the UI */\nconst Resourcebar = () => {\n\n    const goldState = useGoldState();\n    const storeResources = useResourcesState();\n    const workersFree = useWorkersFreeState();\n    const maxResources = useMaxResourcesState();\n\n    const createItem = (icon: string, amount: number, type: Resource | \"workers\" | \"gold\") => {\n        const full = type !== \"workers\" && type !== \"gold\" && (amount ?? 0) >= (maxResources?.[type] ?? 0);\n\n        const handleClick = (event: React.MouseEvent) => {\n\n            const origin = (event.currentTarget as HTMLElement);\n            const originRect = origin.getBoundingClientRect();\n            TooltipManager.showContextTooltip(ContextType.resource, type, originRect);\n            event.stopPropagation();\n        };\n\n        return (\n            <li key={type} onClick={handleClick}>\n                <Icon\n                    image={icon}\n                    size=\"smallest\"\n                />\n                <div className={`amount ${full ? \"full\" : \"\"}`}>\n                    { formatNumber(amount, 0) }\n                </div>\n            </li>\n        )\n    };\n\n    const resources = resourceOrder.map((resource) => {\n        const resourceDescription = resourceDescriptions[resource];\n        return createItem(resourceDescription.iconImg, storeResources[resource] ?? 0, resource);\n    });\n\n    resources.push(\n        createItem(\"/img/resources/worker.png\", workersFree, \"workers\"),\n        createItem(\"/img/resources/gold.png\", goldState, \"gold\"),\n    );\n\n    return (\n        <ul className=\"resourcebar\">\n            { resources }\n        </ul>\n    );\n};\nexport default Resourcebar;\n","import Menu from \"components/ui/window/windows/MenuWindow\";\nimport * as React from \"react\";\nimport Resourcebar from './Resourcebar';\nimport { useContext } from 'react';\nimport { AppContext } from 'components/App';\nimport { Persistor } from 'redux-persist';\nimport \"./styles/topbar.scss\";\n\ninterface Props {\n    persistor: Persistor;\n}\n\nconst Topbar = (props: Props) => {\n    const context = useContext(AppContext);\n\n    const handleClick = (_e: React.MouseEvent<HTMLDivElement, MouseEvent>) => {\n        const window = <Menu title = \"Menu\" persistor={props.persistor} />;\n        context?.onOpenWindow(window);\n    };\n\n    return (\n        <div className = \"topbar\">\n            <div className = \"topbar-left\">\n                <Resourcebar />\n            </div>\n            <div className = \"topbar-right\">\n                <div className = \"hamburger\" onClick = { handleClick }>☰</div>\n            </div>\n        </div>\n    );\n}\nexport default Topbar;","import React, { useRef, useEffect } from 'react';\nimport { Sprite } from '@inlet/react-pixi';\nimport * as PIXI from 'pixi.js';\nimport { QuestStoreState } from 'store/types/quest';\nimport { AdventurerStoreState } from 'store/types/adventurer';\nimport { Point } from 'pixi.js';\n\ninterface Props {\n    quest: QuestStoreState;\n    position: Point;\n    selected?: boolean;\n    encounterActive?: boolean;\n    onClick?: (quest: QuestStoreState) => void;\n    leader: AdventurerStoreState;\n}\nconst CIRCLE_DIAMETER = 256; // = avatar size / 2\n\nconst QuestMarker = (props: Props) => {\n    const { quest, leader, encounterActive, position, onClick, selected } = props;\n    const image = selected ? '/img/world/map-marker-selected.png' : '/img/world/map-marker.png';\n\n    const avatar = useRef<PIXI.Sprite>(null);\n    // Mask has to be a child of the avatar in order to move with it\n    useEffect(() => {\n        const sprite = avatar.current as PIXI.Sprite;\n\n        const maskGraphics = new PIXI.Graphics();\n        maskGraphics.beginFill(0xBADA55);\n        maskGraphics.drawCircle(0, 0, CIRCLE_DIAMETER * 1);\n        maskGraphics.endFill();\n\n        sprite.mask = maskGraphics;\n        sprite.addChild(maskGraphics);\n    }, [avatar]);\n\n    return (\n        <Sprite\n            image={`${process.env.PUBLIC_URL}${image}`}\n            name={quest.name}\n            x={position.x}\n            y={position.y}\n            interactive={true}\n            buttonMode={true}\n            scale={new Point(0.1, 0.1)}\n            anchor={new Point(0.5, 1)}\n            pointerdown={() => {\n                if(onClick) {\n                    onClick(quest);\n                }\n            }}\n        >\n            { leader && (\n            <Sprite\n                image={`${process.env.PUBLIC_URL}${leader.avatarImg}`}\n                name=\"avatar\"\n                anchor={new Point(0.5, 0.5)}\n                x={0}\n                y={-396}\n                scale={new Point(0.66, 0.66)}\n                ref={avatar}\n            />)}\n            {encounterActive && (\n            <Sprite\n                image={`${process.env.PUBLIC_URL}/img/world/quest-alert.png`}\n                name=\"quest-alert\"\n                anchor={new Point(0.5, 1)}\n                x={180}\n                y={-396}\n                scale={new Point(2, 2)}\n            />\n            )}\n        </Sprite>\n    )\n}\n\nexport default QuestMarker;","import React from \"react\";\nimport { Graphics } from '@inlet/react-pixi';\nimport { Point } from \"pixi.js\";\n\ninterface Props {\n    positions: Point[];\n}\n\nconst QuestLine = (props: Props) => {\n    const { positions } = props;\n    if (props.positions.length > 2) {\n        return <Graphics\n            name=\"questline\"\n            x={0}\n            y={0}\n            draw={graphics => {\n                graphics.lineStyle(3, 0xFF3300);\n                graphics.moveTo(positions[0].x, positions[0].y);\n\n                let i = 0;\n                for (i = 1; i < positions.length - 2; i ++)\n                {\n                    const xc = (positions[i].x + positions[i + 1].x) / 2;\n                    const yc = (positions[i].y + positions[i + 1].y) / 2;\n                    graphics.quadraticCurveTo(positions[i].x, positions[i].y, xc, yc);\n                }\n                graphics.quadraticCurveTo(positions[i].x, positions[i].y, positions[i+1].x, positions[i+1].y);\n                graphics.endFill();\n            }}\n        />;\n    }\n    return null;\n}\n\nexport default QuestLine;","import * as PIXI from 'pixi.js';\r\nimport React, { useEffect, useRef, useCallback, useState } from \"react\";\r\nimport { Stage, Sprite } from '@inlet/react-pixi';\r\nimport { Viewport as PixiViewport } from \"pixi-viewport\";\r\nimport { useDispatch, useSelector } from 'react-redux'\r\nimport { QuestStoreState } from \"store/types/quest\";\r\nimport { lerpLocation } from 'utils/pixiJs';\r\nimport { QuestDefinition, QuestNodeType, QuestNode } from \"definitions/quests/types\";\r\nimport Viewport from '../../pixi/Viewport';\r\n// import MapGrid from './MapGrid';\r\nimport QuestMarker from './QuestMarker';\r\nimport { AdventurerStoreState } from 'store/types/adventurer';\r\nimport QuestLine from './QuestLine';\r\nimport { MAX_WIDTH as WIDTH } from 'components/App';\r\nimport { getDefinition } from 'definitions/quests';\r\nimport { TextManager } from 'global/TextManager';\r\nimport { getQuestLeader } from 'store/helpers/storeHelpers';\r\nimport { StoreState } from 'store/types';\r\nimport { useActiveQuests, useQuest } from 'hooks/store/quests';\r\nimport { setCombat } from 'store/actions/quests';\r\nimport { useHistory } from 'react-router-dom';\r\nimport { getWorldLink } from 'utils/routing';\r\nimport { Allegiance } from 'store/types/combat';\r\nimport { Point } from 'pixi.js';\r\nimport './styles/worldMap.scss';\r\n\r\nconst FULL_HEIGHT = 1024;\r\nconst SMALL_HEIGHT = 64;   // Used when QuestPanel is open\r\nconst WORLD_WIDTH = 1500;\r\nconst WORLD_HEIGHT = 1061;\r\nconst GRID_WIDTH = 10;      // width or height of each node location in pixels\r\n\r\nexport interface Props {\r\n    selectedQuestName?: string;\r\n    smallMap: boolean;\r\n    onPartyClick: (questName: string) => void;\r\n    retrieveWorldViewRef: () => React.RefObject<HTMLDivElement>;\r\n}\r\n\r\nconst WorldMap = (props: Props) => {\r\n    const { retrieveWorldViewRef, smallMap } = props;\r\n    const questSelector = useCallback(\r\n        (state: StoreState) => state.quests.find((q) => q.name === props.selectedQuestName),\r\n        [props.selectedQuestName]\r\n    );\r\n\r\n    const selectedQuest = useSelector<StoreState, QuestStoreState | undefined>(questSelector);\r\n    const adventurers = useSelector<StoreState, AdventurerStoreState[]>((store) => store.adventurers);\r\n    const activeQuests = useActiveQuests();\r\n    const history = useHistory();\r\n\r\n    const handlePartyClick = (name: string) => {\r\n        props.onPartyClick(name);\r\n    };\r\n\r\n    const handleClose = () => {\r\n        history.push(getWorldLink());\r\n    }\r\n\r\n    // useEffect(() => {\r\n    //     const onScroll = (e: WheelEvent) => {\r\n    //         // When the map is big, scrolling the mouse is just used for zoom, not for actual scrolling\r\n    //         if (!smallMap) {\r\n    //             e.preventDefault();\r\n    //         }\r\n    //     }\r\n    //     window.addEventListener(\"wheel\", onScroll, {passive: false} );\r\n    //     return () => {\r\n    //         window.removeEventListener(\"wheel\", onScroll);\r\n    //     };\r\n    // }, [smallMap]);\r\n\r\n\r\n    const [canvasWidth, setCanvasWidth] = useState(WIDTH);\r\n    const [canvasHeight, setCanvasHeight] = useState(FULL_HEIGHT);\r\n\r\n    useEffect(() => {\r\n        // This will set the dimensions of the canvas tot that of the parent (worldview)\r\n        const resize = () => {\r\n            const worldView = retrieveWorldViewRef();\r\n            const worldViewWidth = worldView.current?.clientWidth || WIDTH;\r\n            const worldViewHeight = worldView.current?.clientHeight || FULL_HEIGHT;\r\n\r\n            setCanvasWidth(worldViewWidth);\r\n            if (smallMap) {\r\n                if (worldViewWidth < 576) {\r\n                    // Small screens\r\n                    setCanvasHeight(SMALL_HEIGHT / 2);\r\n                } else {\r\n                    setCanvasHeight(SMALL_HEIGHT);\r\n                }\r\n            }\r\n            else {\r\n                setCanvasHeight(worldViewHeight);\r\n            }\r\n        }\r\n        resize();\r\n        window.addEventListener(\"resize\", resize);\r\n        return () => {\r\n            window.removeEventListener(\"resize\", resize);\r\n        };\r\n    }, [retrieveWorldViewRef, smallMap]);\r\n\r\n    useEffect(() => {\r\n        if (selectedQuest) {\r\n            focusOnQuestingParty(selectedQuest);\r\n        } else {\r\n            const viewport = viewportRef.current;\r\n            const point = nodeLocationToPoint({ x: 0, y: 0 });\r\n            viewport?.moveCenter(point.x, point.y);\r\n        }\r\n    }, [selectedQuest, canvasHeight])\r\n\r\n    const viewportRef = useRef<PixiViewport>(null);\r\n    useEffect(() => {\r\n        // focus on center of the map\r\n        if (viewportRef.current) {\r\n            const viewport = viewportRef.current;\r\n            const point = nodeLocationToPoint({ x: 0, y: 0 });\r\n            viewport.moveCenter(point.x / 2, point.y / 2 + 10);\r\n        }\r\n    }, [canvasWidth]);\r\n\r\n    const renderQuestlines = () => {\r\n        return activeQuests.map((quest) => {\r\n            const previousPositions = getPreviousPositions(quest);\r\n            return (\r\n                <QuestLine positions={previousPositions} key={quest.name} />\r\n            );\r\n        });\r\n    };\r\n\r\n    const renderMarkers = () => {\r\n        return activeQuests.map((quest) => {\r\n            const location = getQuestWorldLocation(quest);\r\n            const currentPosition = nodeLocationToPoint(location);\r\n            const leader = getQuestLeader(adventurers, quest) ?? adventurers[0];\r\n            const questDefinition: QuestDefinition = getDefinition(quest.name);\r\n            const progress: number = Math.floor(quest.progress);\r\n            const questNode: QuestNode = questDefinition.nodes[progress];\r\n\r\n            return (\r\n                <QuestMarker\r\n                    quest={quest}\r\n                    leader={leader}\r\n                    position={currentPosition}\r\n                    key={quest.name}\r\n                    selected={quest === selectedQuest}\r\n                    encounterActive={questNode.type === QuestNodeType.encounter}\r\n                    onClick={(q) => handlePartyClick(q.name)}\r\n                />\r\n            );\r\n        });\r\n    };\r\n\r\n\r\n    // puts the given party in the center of the map\r\n    const focusOnQuestingParty = (quest: QuestStoreState) => {\r\n        const viewport = viewportRef.current;\r\n        if (viewport) {\r\n            const partyLocation = getQuestWorldLocation(quest);\r\n            const point = nodeLocationToPoint(partyLocation);\r\n            viewport.moveCenter(point.x, point.y);\r\n        }\r\n    }\r\n\r\n    const handleMapClick = () => {\r\n        /// todo: close map\r\n        // if(smallMap === true && selectedQuest) {\r\n        //     props.onPartyClick(selectedQuest.name);\r\n        // }\r\n    }\r\n\r\n    const options = {\r\n        autoDensity: true,\r\n        sharedLoader: true,\r\n        width: canvasWidth,\r\n        height: canvasHeight,\r\n    }\r\n    return (\r\n        <div className=\"world-map\">\r\n            <Stage width={canvasWidth} height={canvasHeight} options={options}>\r\n                <Viewport screenWidth={canvasWidth} screenHeight={canvasHeight} worldWidth={WORLD_WIDTH} worldHeight={WORLD_HEIGHT} ref={viewportRef} >\r\n                    <Sprite\r\n                        image={`${process.env.PUBLIC_URL}/img/world/francesca-baerald-fbaerald-angeloumap-lowres.jpg`}\r\n                        interactive={true}\r\n                        pointerdown={handleMapClick}\r\n                    >\r\n                        {renderQuestlines()}\r\n                        {renderMarkers()}\r\n                    </Sprite>\r\n                    {/* <MapGrid width={WORLD_WIDTH} height={WORLD_HEIGHT} gridWidth={GRID_WIDTH} /> */}\r\n                </Viewport>\r\n            </Stage>\r\n            {props.selectedQuestName && (\r\n                <div className=\"title\">\r\n                    <span>\r\n                        <DebugToggleCombat questName={props.selectedQuestName} />\r\n                        {TextManager.getQuestTitle(props.selectedQuestName)}\r\n                    </span>\r\n                    <span onClick={handleClose} className=\"close\">x</span>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\n\r\nexport default WorldMap;\r\n\r\nconst getQuestWorldLocation = (quest: QuestStoreState): { x: number; y: number; } => {\r\n    const questDefinition = getDefinition(quest.name);\r\n    const roundedProgress = Math.floor(quest.progress);\r\n    const lastNode = questDefinition.nodes[roundedProgress];\r\n\r\n    const nextNode = questDefinition.nodes[roundedProgress + 1];\r\n    if (!nextNode) {\r\n        // We've reached the last node\r\n        return lastNode;\r\n    }\r\n    return lerpLocation(lastNode, nextNode, quest.progress - roundedProgress);\r\n};\r\n\r\n// Node locations work on a centered coordinate system\r\nconst nodeLocationToPoint = (location: { x: number; y: number; }) => {\r\n    const x = location.x * GRID_WIDTH + WORLD_WIDTH / 2;\r\n    const y = location.y * GRID_WIDTH + WORLD_HEIGHT / 2;\r\n    return new Point(x, y);\r\n}\r\n\r\nconst getPreviousPositions = (quest: QuestStoreState) => {\r\n    const positions: Point[] = [];\r\n    const questDefinition = getDefinition(quest.name);\r\n\r\n    for (let i = 0; i < quest.progress; i++) {\r\n        positions.push(nodeLocationToPoint(questDefinition.nodes[i]))\r\n    }\r\n    const lastPosition = nodeLocationToPoint(getQuestWorldLocation(quest));\r\n    positions.push(lastPosition);\r\n    return positions;\r\n}\r\n\r\n\r\n// temporary\r\nconst DebugToggleCombat = ({ questName }: {questName: string}) => {\r\n    const quest = useQuest(questName);\r\n    const dispatch = useDispatch();\r\n\r\n    if (quest.scene?.combat && quest.scene.turn !== undefined) {\r\n        return (\r\n            <button onClick={() => dispatch(setCombat(questName, false))}>\r\n                combat: on ({Allegiance[quest.scene.turn]})\r\n            </button>\r\n        );\r\n    }\r\n    return (\r\n        <button onClick={() => dispatch(setCombat(questName, true))}>\r\n            combat: off\r\n        </button>\r\n    )\r\n}","import { createSelector } from \"reselect\";\nimport { adventurersOnQuest } from 'store/helpers/storeHelpers';\nimport { StoreState } from 'store/types';\nimport { AdventurerStoreState } from \"store/types/adventurer\";\nimport { QuestStatus, QuestStoreState } from 'store/types/quest';\n\n// maybe this is not used anymore?\n\n// Store accessors\nconst getAdventurers = (state: StoreState): AdventurerStoreState[] => state.adventurers;\nconst getQuests = (state: StoreState): QuestStoreState[] => state.quests;\n\nconst groupAdventurersByQuest = (adventurers: AdventurerStoreState[], quests: QuestStoreState[]): Record<string, AdventurerStoreState[]> => {\n    const foundInParty: AdventurerStoreState[] = []; // store the adventurers in parties in a temp array\n\n\n    const groupedAdventurers = Object.values(quests).reduce<{[key: string]: AdventurerStoreState[]}>((acc, value) => {\n        const foundAdventurers = adventurersOnQuest(adventurers, value);\n        if (value.status === QuestStatus.active) {\n            // Only active quests\n            acc[value.name] = foundAdventurers;\n        }\n        foundInParty.push(...foundAdventurers);\n        return acc;\n    }, {});\n\n    // Add a special group called 'solo' for those adventurers not in a party\n    const soloKey = \"solo\";\n    groupedAdventurers[soloKey] = adventurers.filter((a) => foundInParty.indexOf(a) === -1);\n\n    return groupedAdventurers;\n};\n\nconst getAdventurersInTown = (adventurers: AdventurerStoreState[], quests: QuestStoreState[]): AdventurerStoreState[] => {\n    // Get an array of all adventurer ids on any active quest\n    const adventurersOnQuest = quests.reduce<string[]>((acc, val: QuestStoreState) => {\n        if (val.status === QuestStatus.active) {\n            acc.push(...val.party);\n        }\n        return acc;\n    }, []);\n\n    return adventurers.filter((a) => adventurersOnQuest.indexOf(a.id) === -1);\n};\n\n/** Returns an object keyed by active quests whose value is a list of AdventurerStoreState */\nexport const selectAdventurersGroupedByQuest = createSelector([\n    getAdventurers,\n    getQuests],\n    groupAdventurersByQuest,\n);\n\n/** Returns a selector keyed by active quests whose value is a list of AdventurerStoreState */\nexport const createSelectAdventurersOnQuest = (questName: string) => {\n    const getAdventurersOnQuest = (adventurers: AdventurerStoreState[], quests: QuestStoreState[]): AdventurerStoreState[] => {\n        const quest = quests.find(q => q.name === questName);\n        if (!quest) throw new Error(`No quest named ${questName}`)\n        return adventurersOnQuest(adventurers, quest);\n    };\n\n    return createSelector([\n        getAdventurers,\n        getQuests],\n        getAdventurersOnQuest,\n    );\n}\n\n/** Returns an object keyed by active quests whose value is a list of AdventurerStoreState */\nexport const selectAdventurersInTown = createSelector([\n    getAdventurers,\n    getQuests],\n    getAdventurersInTown,\n);\n","import { PixiComponent } from \"@inlet/react-pixi\";\nimport * as PIXI  from 'pixi.js';\nimport { TiledLayerData, TiledTilesetData } from 'constants/tiledMapData';\nimport { findTileset } from \"utils/tilemap\";\nimport { CompositeRectTileLayer } from \"@pixi/tilemap\";\n\n\ninterface Props  {\n    horizontalTiles: number;\n    layer: TiledLayerData;\n    tilesets: TiledTilesetData[];\n    spritesheets: {[key: string]: PIXI.Spritesheet}\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any \nconst RectTileLayer = PixiComponent<Props, any>(\"RectTileLayer\", {\n    create(_props: Props) {\n        const tileLayer = new CompositeRectTileLayer();\n        return tileLayer;\n    },\n\n    applyProps(instance, oldProps: Props, props: Props) {\n        const {layer, tilesets, horizontalTiles, spritesheets} = props;\n        if (!layer.data) {\n            return;\n        }\n        for (let i = 0; i < layer.data.length; i++) {\n            const tileset = findTileset(layer.data[i], tilesets);\n            if (!tileset) continue;\n\n            const w = tileset.tilewidth;\n            const h = tileset.tileheight;\n            const x = (i % horizontalTiles) * w;\n            const y = Math.floor(i / horizontalTiles) * h;\n            const spritesheet = spritesheets[tileset.name];\n\n            if (layer.data[i] > 0) {\n                const spriteId = `${tileset.name}-${layer.data[i]}`;\n                instance.addFrame(spritesheet.textures[spriteId], x, y);\n            }\n        }\n    }\n});\n\nexport default RectTileLayer;\n\n\n","import { PixiComponent } from \"@inlet/react-pixi\";\nimport * as PIXI from 'pixi.js';\nimport { TiledTilesetData } from 'constants/tiledMapData';\nimport { SceneObject } from 'store/types/scene';\nimport { findTileset } from \"utils/tilemap\";\nimport { CompositeRectTileLayer } from \"@pixi/tilemap\";\n\ninterface Props  {\n    objects: SceneObject[];\n    tilesets: TiledTilesetData[];\n    spritesheets: {[key: string]: PIXI.Spritesheet}\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any \nconst ObjectTileLayer = PixiComponent<Props, any>(\"ObjectTileLayer\", {\n    create(_props: Props) {\n        const tileLayer = new CompositeRectTileLayer();\n        return tileLayer;\n    },\n\n    applyProps(instance, _oldProps: Props, props: Props) {\n        const {objects, tilesets, spritesheets} = props;\n        if (!objects.length) {\n            return;\n        }\n        instance.clear();\n        if (!objects) return;\n\n        objects.forEach((object) => {\n            if (!object.gid) return; // todo!\n            const tileset = findTileset(object.gid, tilesets);\n            if (!tileset) return;\n\n            const x = object.x;\n            const y = object.y - tileset.tileheight;\n            const spritesheet = spritesheets[tileset.name];\n\n            // todo: add sprites!\n            const spriteId = `${tileset.name}-${object.gid}`;\n            instance.addFrame(spritesheet.textures[spriteId], x, y);\n      \n        });\n    }\n});\n\nexport default ObjectTileLayer;\n\n","import { PixiComponent, applyDefaultProps, AnimatedSprite } from '@inlet/react-pixi';\nimport * as PIXI from 'pixi.js';\n\nconst SpriteAnimated = PixiComponent<React.ComponentProps<typeof AnimatedSprite>, PIXI.AnimatedSprite>('SpriteAnimated', {\ncreate: ({ textures }) => {\n    const animatedSprite = new PIXI.AnimatedSprite(textures || [], true);\n    return animatedSprite;\n  },\n  applyProps: (instance, oldProps, newProps) => {\n    if(oldProps.textures !== newProps.textures){\n      applyDefaultProps(instance, oldProps, newProps);\n      instance.gotoAndPlay(0);\n    }\n  },\n});\n\n// export default memo(SpriteAnimated);\nexport default SpriteAnimated;\n\n","import { Container, Graphics, Text } from \"@inlet/react-pixi\";\nimport { useAdventurerState } from \"hooks/store/adventurers\";\nimport React from \"react\";\nimport { Allegiance } from \"store/types/combat\";\nimport { ActorObject } from \"store/types/scene\";\n\ninterface Props {\n  actor: ActorObject;\n  tileWidth: number;\n}\n\nconst MARGIN = 4;\n\nconst useActorThingyInfo = (actor: ActorObject) => {\n    const adventurer = useAdventurerState(actor.name); // is possibly null\n    if (actor.allegiance === Allegiance.player) {\n        return adventurer.name;\n    }\n    return actor.name; // enemy name\n}\n\nconst ActorThingy = (props: Props) => {\n    const { tileWidth, actor } = props;\n    \n    // const mask = useRef<PIXI.Graphics>(null);\n    const name = useActorThingyInfo(actor);\n\n    return (\n        <Container y={-40}>\n            <Text \n                y={-10}\n                x={MARGIN}\n                anchor={[0, 1]}\n                text={`${name} (${actor.ap})`}\n                style={{\n                    fontFamily : 'Gabriela', \n                    fontSize: 18, \n                    fill : 0xffffff, \n                    align : 'center',\n                    wordWrap: true,\n                    wordWrapWidth: tileWidth,\n                    dropShadow: true,\n                    dropShadowAngle: 0.9,\n                    dropShadowBlur: 10,\n                    dropShadowDistance: 0\n                }}\n                // mask={mask.current}\n            />\n            {/* <Graphics\n                name=\"mask\"\n                ref={mask}\n                draw={mask => {\n                    mask.beginFill (0x003c1b);\n                    mask.drawRect(MARGIN, -30, tileWidth - 2 * MARGIN, 22);\n                    mask.endFill();\n                }}\n            /> */}\n            <Graphics\n                name=\"background\"\n                draw={graphics => {\n                    graphics.beginFill (0x003c1b);\n                    graphics.drawRect(0, 0, tileWidth, 6);\n                    graphics.endFill();\n                }}\n            />\n            <Graphics\n                name=\"foreground\"\n                draw={graphics => {\n                    graphics.beginFill (0x006b22);\n                    graphics.drawRect(0, 0, actor.health, 6);\n                    graphics.endFill();\n                }}\n            />\n        </Container>\n    )\n}\n\nexport default ActorThingy","import React, { useMemo,  useEffect, useRef, useCallback, PropsWithChildren, useState, memo } from 'react';\nimport { gsap } from 'gsap';\nimport { Container } from '@inlet/react-pixi';\nimport { SceneActionType, SceneAction, ActorObject } from 'store/types/scene';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { completeSceneAction } from 'store/actions/quests';\nimport { StoreState } from 'store/types';\nimport { BaseSceneController } from 'mechanics/scenes/BaseSceneController';\nimport SpriteAnimated from 'components/pixi/tile/SpriteAnimated';\nimport { Channel, MixMode, SoundManager } from 'global/SoundManager';\nimport { AdventurerColor } from 'store/types/adventurer';\nimport { useQuest } from 'hooks/store/quests';\nimport ActorThingy from './ActorThingy';\nimport { Filter, Loader, Texture, Container as PixiContainer } from 'pixi.js';\nimport { MultiColorReplaceFilter } from '@pixi/filter-multi-color-replace';\n\nexport interface Props  {\n    actor: ActorObject;\n    spritesheetPath: string;\n    color?: AdventurerColor;\n    controller: BaseSceneController<unknown>;\n    location?: [number, number]; // tile coordinate space\n    lookAt?: [number, number];\n    idleAnimation?: boolean;    // Only when lookAt is undefined, will randomly turn around\n}\n\nenum Orientation {\n    north = \"n\",\n    northEast = \"ne\",\n    east = \"e\",\n    southEast = \"se\",\n    south = \"s\",\n    southWest = \"sw\",\n    west = \"w\",\n    northWest = \"nw\"\n}\n\nconst SPRITE_WIDTH = 142;\n\n// This is a wrapper that exposes a location property. Will set x and y on children\nconst SceneActor = (props: PropsWithChildren<Props> & React.ComponentProps<typeof Container>) => {\n    const {\n        location = [0, 0],\n        controller,\n        idleAnimation,\n        color,\n        children,\n        spritesheetPath,\n        lookAt,\n        actor,\n        ...rest\n    } = props;\n    const { tileWidth, tileHeight } = controller.getTileDimensions();\n    const actorRef = useRef<PixiContainer>(null);\n    const previousAction = useRef<SceneAction>();\n    const dispatch = useDispatch();\n    const quest = useQuest(props.controller.questName);\n    const actionQueueSelector = useCallback(() => {\n        if (!quest.scene?.actionQueue) {\n            return [];\n        }\n        return quest.scene.actionQueue.filter(a => a.actorId === actor.name);\n    }, [quest.scene, actor.name]);\n    \n    const actionQueue = useSelector<StoreState, SceneAction[]>(actionQueueSelector);\n    const [animation, setAnimation] = useState(\"stand\");\n    const tween = useRef<gsap.core.Tween>();\n\n    // Handle actions\n    useEffect(() => {\n        if (!actorRef) {\n            return;\n        }\n        // Determines orientation based on where the target is\n        const determineOrientation = () => {\n            if (location[0] === nextAction.target[0] && location[1] > nextAction.target[1]) {\n                setOrientation(Orientation.north);\n            }\n            else if (location[0] < nextAction.target[0] && location[1] > nextAction.target[1]) {\n                setOrientation(Orientation.northEast);\n            }\n            else if (location[0] < nextAction.target[0] && location[1] === nextAction.target[1]) {\n                setOrientation(Orientation.east);\n            }\n            else if (location[0] < nextAction.target[0] && location[1] < nextAction.target[1]) {\n                setOrientation(Orientation.southEast);\n            }\n            else if (location[0] === nextAction.target[0] && location[1] < nextAction.target[1]) {\n                setOrientation(Orientation.south);\n            }\n            else if (location[0] > nextAction.target[0] && location[1] < nextAction.target[1]) {\n                setOrientation(Orientation.southWest);\n            }\n            else if (location[0] > nextAction.target[0] && location[1] === nextAction.target[1]) {\n                setOrientation(Orientation.west);\n            }\n            else if (location[0] > nextAction.target[0] && location[1] > nextAction.target[1]) {\n                setOrientation(Orientation.northWest);\n            }\n        }\n        const nextAction = actionQueue[0];\n        if (nextAction && nextAction !== previousAction.current) {\n            // console.log(`next action is ${nextAction.target} (${nextAction.actionType}), \\ncurrent location is: ${location}\\nprev action was ${previousAction?.current?.target} `)\n            switch (nextAction.actionType) {\n                case SceneActionType.move: {\n                    const moveComplete = () => {\n                        dispatch(completeSceneAction(props.controller.questName));\n                        props.controller.actorMoved(actor.name, nextAction.target);\n                    }\n                    const duration = (nextAction.endsAt - performance.now()) / 1000;\n                    if (duration < 0) {\n                        moveComplete();\n                    }\n\n                    // determine orientation\n                    determineOrientation();\n                    setAnimation(\"walk\");\n                    gsap.killTweensOf(actorRef.current);\n                    tween.current = gsap.to(actorRef.current, {\n                        duration,\n                        ease: \"linear\",\n                        pixi: {\n                            x: nextAction.target[0] * tileWidth,\n                            y: nextAction.target[1] * tileHeight\n                        },\n                        onComplete: moveComplete\n                    });\n                    break;\n                }\n                case SceneActionType.slash: {\n                    determineOrientation();\n                    setAnimation(\"attack\");\n                    SoundManager.playSound(\"scene/swish\", Channel.scene, false, MixMode.singleInstance);\n                    const attackComplete = () => {\n                        setAnimation(\"stand\");\n                        dispatch(completeSceneAction(props.controller.questName));\n                    }\n                    setTimeout(attackComplete, 1000);\n                    break;\n                }\n                case SceneActionType.interact: {\n                    controller.actorInteract(actor.name, nextAction.target);\n                    dispatch(completeSceneAction(props.controller.questName));\n                    break;\n                }\n            }\n            previousAction.current = nextAction;\n        }\n    }, [dispatch, tileWidth, tileHeight, actionQueue, props.controller, props.name, location, controller]);\n\n    useEffect(() => {\n        return () => {\n            tween.current?.kill();\n        }\n    }, []);\n\n    const {x, y} = useMemo(() => {\n        setAnimation(\"stand\")\n\n        return {\n            x: location[0] * tileWidth,\n            y: location[1] * tileHeight,\n        };\n    }, [location, tileWidth, tileHeight]);\n\n    const [frames, setFrames] = useState<{ [key: string]: Texture[]}|null>(null);\n\n    useEffect(() => {\n        if (!spritesheetPath) return;\n\n        if (!Loader.shared.resources[spritesheetPath]?.textures){\n            throw new Error(`No textures for ${spritesheetPath}`);\n        }\n        const allFrames = Object.keys(Loader.shared.resources[spritesheetPath].textures ?? {});\n        const indexed = allFrames.reduce((acc: {[key: string]: Texture[] }, frame: string) => {\n            // frames are in the format of: 'stand-n', 'walk0-ne', 'walk1-ne' etc\n            // create a mapping with arrays keyed by the part without the number,\n            // eg: 'stand-n': [TEXTURE:stand-n] and 'walk-ne': [TEXTURE:walk0-ne, TEXTURE:walk1-ne]\n            const key = frame.replace(/[0-9]/g, '');\n            if (!acc[key]) {\n              acc[key] = [];\n            }\n            const texture = Loader.shared.resources[spritesheetPath].textures?.[frame];\n            if (texture) acc[key].push(texture);\n            return acc;\n        }, {});\n        setFrames(indexed);\n    }, [spritesheetPath])\n\n    const [orientation, setOrientation] = useState<Orientation>(Orientation.north);\n    // const [flipped, setFlipped] = useState(false);\n    const flipped = useRef(false);\n    const setFlipped = (value:boolean) => {\n        flipped.current = value;\n    }\n\n    useEffect(() => {\n        if (lookAt !== undefined) {\n            const bearing = calculateBearing(location, lookAt);\n            setOrientation(bearing);\n        }\n    }, [location, lookAt])\n\n    useEffect(() => {\n        setFlipped(orientation === Orientation.southWest || orientation === Orientation.west || orientation === Orientation.northWest)\n    }, [orientation]);\n\n    useEffect(() => {\n        // Todo: move to custom hook\n        if (!idleAnimation || !!lookAt) return;\n\n        // Idle animation\n        // Randomly turn left or right\n        const randomOrientation = () => {\n            const left = Math.random() < .5;\n            if (orientation === Orientation.north && left) {\n                setOrientation(Orientation.northWest);\n            }\n            else if (orientation === Orientation.northWest && left) {\n                setOrientation(Orientation.west);\n            }\n            else if (orientation === Orientation.west && left) {\n                setOrientation(Orientation.southWest);\n            }\n            else if (orientation === Orientation.southWest && left) {\n                setOrientation(Orientation.south);\n            }\n            else if (orientation === Orientation.south && left) {\n                setOrientation(Orientation.southEast);\n            }\n            else if (orientation === Orientation.southEast && left) {\n                setOrientation(Orientation.east);\n            }\n            else if (orientation === Orientation.east && left) {\n                setOrientation(Orientation.northEast);\n            }\n            else if (orientation === Orientation.northEast && left) {\n                setOrientation(Orientation.north);\n            }\n            if (orientation === Orientation.north && !left) {\n                setOrientation(Orientation.northEast);\n            }\n            else if (orientation === Orientation.northEast && !left) {\n                setOrientation(Orientation.east);\n            }\n            else if (orientation === Orientation.east && !left) {\n                setOrientation(Orientation.southEast);\n            }\n            else if (orientation === Orientation.southEast && !left) {\n                setOrientation(Orientation.south);\n            }\n            else if (orientation === Orientation.south && !left) {\n                setOrientation(Orientation.southWest);\n            }\n            else if (orientation === Orientation.southWest && !left) {\n                setOrientation(Orientation.west);\n            }\n            else if (orientation === Orientation.west && !left) {\n                setOrientation(Orientation.northWest);\n            }\n            else if (orientation === Orientation.northWest && !left) {\n                setOrientation(Orientation.north);\n            }\n        }\n        const minDuration = 2000;\n        const maxDuration = 4000;\n        const duration = minDuration + Math.random() * maxDuration;\n        const interval = setInterval(randomOrientation, duration);\n        return () => clearInterval(interval);\n    }, [animation, idleAnimation, orientation, lookAt])\n\n    const getFrames = useCallback(() => {\n        const prefix = '';\n        // const prefix = `${spritesheet.data.meta.image}-`;\n        switch (orientation) {\n            case Orientation.northWest:\n                return `${prefix}${animation}-${Orientation.northEast}`;\n            case Orientation.west:\n                return `${prefix}${animation}-${Orientation.east}`;\n            case Orientation.southWest:\n                return `${prefix}${animation}-${Orientation.southEast}`;\n            default:\n                return `${prefix}${animation}-${orientation}`;\n        }\n    }, [animation, orientation]);\n\n    const filters = useMemo<Filter[]>(() => {\n        switch (color) {\n            case AdventurerColor.black:\n                return [createColorReplaceFilter(BLUES, BLACK)];\n            case AdventurerColor.orange:\n                return [createColorReplaceFilter(BLUES, ORANGE)];\n            case AdventurerColor.purple:\n                return [createColorReplaceFilter(BLUES, PURPLE)];\n            case AdventurerColor.red:\n                return [createColorReplaceFilter(BLUES, REDS)];\n            case AdventurerColor.teal:\n                return [createColorReplaceFilter(BLUES, TEALS)];\n            case AdventurerColor.white:\n                return [createColorReplaceFilter(BLUES, WHITE)];\n            case AdventurerColor.yellow:\n                return [createColorReplaceFilter(BLUES, YELLOW)];\n\n            // case AdventurerColor.blue:\n            default:\n                return [];\n        }\n    }, [color])\n    const showThingy = !!quest.scene?.combat;\n    return (\n        <Container x={x} y={y} ref={actorRef} {...rest}>\n            { spritesheetPath && frames && (\n                <SpriteAnimated\n                    animationSpeed={0.1}\n                    name=\"sprite\"\n                    isPlaying={true}\n                    textures={frames[getFrames()]}\n                    x={SPRITE_WIDTH/4}\n                    y={20}\n                    scale={[(flipped.current ? -1 : 1), 1]}\n                    anchor={[.5, .5]}\n                    pivot={[0, 0]}\n                    filters={filters}\n                    />\n                )}\n            {children}\n            {showThingy && (\n                <ActorThingy tileWidth={tileWidth} actor={actor} />\n            )}\n        </Container>\n    )\n};\n\nexport default memo(SceneActor);\n\n// Calculates an orientation that origin would be in if it was looking at destination\nconst calculateBearing = (origin: [number, number], destination: [number, number]) => {\n    const angle = Math.atan2(destination[1] - origin[1], destination[0] - origin[0]);\n    const result = Math.round((angle / (2 * Math.PI / 8) + 8) % 8);\n    const orientations = [Orientation.east, Orientation.southEast, Orientation.south, Orientation.southWest, Orientation.west, Orientation.northWest, Orientation.north, Orientation.northEast];\n    return orientations[result];\n}\n\nconst createColorReplaceFilter = (from: number[], to: number[]) => {\n    const replacements: [number, number][] = from.map((val, index) => {\n        return [\n            from[index], to[index]\n        ]\n    });\n    // todo!!\n    return new MultiColorReplaceFilter(replacements, 0.15);\n}\n\nconst BLUES = [\n    0x000e5f,\n    0x00227f,\n    0x0038a5,\n    0x0055cc,\n];\n\nconst REDS = [\n    0x570800,\n    0x700c00,\n    0x901000,\n    0xb51700\n];\n\nconst TEALS = [\n    0x00330d,\n    0x00653a,\n    0x08936f,\n    0x30bea5\n];\n\nconst PURPLE = [\n    0x3b0d3a,\n    0x641d5e,\n    0x884696,\n    0xaa61bd\n];\n\nconst ORANGE = [\n    0x802d0c,\n    0xaa4a12,\n    0xd16d11,\n    0xf59717\n];\n\nconst BLACK = [\n    0x0d0d1a,\n    0x1a1b2b,\n    0x25263a,\n    0x35354c\n];\n\nconst WHITE = [\n    0x30375e,\n    0x676993,\n    0xa9aac2,\n    0xe6e6e6\n];\n\nconst YELLOW = [\n    0xc28600,\n    0xd6ae10,\n    0xe9d333,\n    0xfdf959\n];","import { Container, Graphics } from '@inlet/react-pixi';\nimport React, { useRef, memo } from 'react';\nimport { ActorObject } from 'store/types/scene';\nimport SceneActor, { Props as SceneActorProps } from './SceneActor';\nimport { Container as PixiContainer } from 'pixi.js';\n\ninterface Props  {\n    actor: ActorObject;\n    selected: boolean;\n    spritesheetPath: string;\n}\n\n// The adventurers avatar on the scene\nconst SceneAdventurer = (props: Props & Omit<SceneActorProps, 'children'|'name'>) => {\n    const {\n        controller,\n        location,\n        actor,\n        selected,\n        spritesheetPath,\n    } = props;\n    const {tileWidth, tileHeight} = controller.getTileDimensions();\n\n    const ref = useRef<PixiContainer>(null);\n\n    return (\n        <Container ref={ref}>\n            <SceneActor\n                actor={actor}\n                controller={controller}\n                spritesheetPath={spritesheetPath}\n                location={location}\n                idleAnimation={Math.random() < 0.5}\n            >\n                {selected && (\n                    <Graphics\n                        name=\"selectioncircle\"\n                        draw={graphics => {\n                            const line = 3;\n                            graphics.lineStyle(line, 0xFFFFFF);\n                            graphics.drawCircle(tileWidth / 2, tileHeight / 2, tileWidth / 2 - line);\n                            graphics.endFill();\n                        }}\n                    />\n                )}\n            </SceneActor>\n        </Container>\n    )\n}\n\nexport default memo(SceneAdventurer);\n","import React from \"react\";\nimport { Container } from \"@inlet/react-pixi\";\nimport { isActorObject, SceneObject } from \"store/types/scene\";\nimport SceneAdventurer from \"./SceneAdventurer\";\nimport { BaseSceneController } from \"mechanics/scenes/BaseSceneController\";\nimport { TiledObjectType } from \"utils/tilemap\";\nimport { Allegiance } from \"store/types/combat\";\nimport SceneActor from \"./SceneActor\";\n\ninterface Props {\n  objects: SceneObject[];\n  controller: BaseSceneController<unknown>;\n  selectedActorId: string;\n}\n\nconst ObjectSpriteLayer = (props: Props) => {\n    const { objects, controller } = props;\n\n    return (\n        <Container>\n            {objects.map((object) => {\n                const { location, name } = object;\n                const { adventurerId, spritesheet } = object.properties as { [key: string]: string};\n                switch (object.type) {\n                    case TiledObjectType.actor: {\n                        if (isActorObject(object)) {\n                            if (object.allegiance === Allegiance.player) {\n                                return (\n                                    <SceneAdventurer\n                                        location={location}\n                                        controller={controller}\n                                        actor={object}\n                                        key={adventurerId}\n                                        spritesheetPath={spritesheet}\n                                        selected={props.selectedActorId === name }\n                                    />\n                                )\n                            }\n                            else if (object.allegiance === Allegiance.enemy) {\n                                return (\n                                    <SceneActor\n                                        actor={object}\n                                        controller={controller}\n                                        spritesheetPath={spritesheet}\n                                        location={location}\n                                        key={object.name}\n                                        idleAnimation={Math.random() < 0.5}\n                                        lookAt={[4, 3]}\n                                    />\n                                );\n                            }\n                        }\n                        break;\n                    }\n                    default:\n                        return null;\n                }\n                return null;\n            })}\n        </Container>\n    )\n}\n\nexport default ObjectSpriteLayer;","import React, { PropsWithChildren } from 'react';\nimport { TiledMapData, TiledLayerData, TiledLayerType } from 'constants/tiledMapData';\nimport { Container } from '@inlet/react-pixi';\nimport RectTileLayer from 'components/pixi/tile/RectTileLayer';\nimport * as PIXI from 'pixi.js';\nimport ObjectTileLayer from 'components/pixi/tile/ObjectTileLayer';\nimport { SceneObject } from 'store/types/scene';\nimport ObjectSpriteLayer from './ObjectSpriteLayer';\nimport { BaseSceneController } from 'mechanics/scenes/BaseSceneController';\nimport { Props as SceneProps } from \"./Scene\";\n\ninterface Props extends SceneProps {\n    basePath: string;\n    data: TiledMapData;\n    spritesheets: {[key: string]: PIXI.Spritesheet}\n    objects: SceneObject[];\n    controller: BaseSceneController<unknown>;\n}\n\nconst Tilemap = (props: PropsWithChildren<Props>) => {\n    const { data, objects, controller, spritesheets, selectedActorId } = props;\n\n    return (\n        <Container >\n            {data.layers\n                .filter(l => l.visible)\n                .map(layer => {\n                    if (layer.type === TiledLayerType.objectgroup) {\n                        const { tileObjects, spriteObjects} = getLayerObjects(objects, layer);\n                        return (\n                            <React.Fragment key={layer.name}>\n                                { !!tileObjects.length && (\n                                    <ObjectTileLayer\n                                        objects={tileObjects}\n                                        tilesets={data.tilesets || []}\n                                        spritesheets={spritesheets}\n                                    />\n                                )}\n                                { !!spriteObjects.length && (\n                                    <ObjectSpriteLayer\n                                        key={layer.name}\n                                        objects={spriteObjects || []}\n                                        controller={controller}\n                                        selectedActorId={selectedActorId}\n                                    />\n                                )}\n                            </React.Fragment>\n                        )\n                    }\n                    if (layer.type === TiledLayerType.tilelayer) {\n                        return (\n                            <RectTileLayer\n                                key={layer.name}\n                                layer={layer}\n                                horizontalTiles={data.width}\n                                tilesets={data.tilesets}\n                                spritesheets={spritesheets}\n                            />\n                        )\n                    }\n                    return null;\n                })\n            }\n        </Container>\n    );\n}\n\nexport default Tilemap;\n\nconst getLayerObjects = (objects: SceneObject[], layer: TiledLayerData) => {\n    return objects.reduce<{tileObjects: SceneObject[], spriteObjects: SceneObject[]}>((acc, value) => {\n        if (value.layerId === layer.id) {\n            if (value.gid !== undefined) {\n                acc.tileObjects.push(value);\n            } else if (value.properties.isSprite === true) {\n                acc.spriteObjects.push(value);\n            }\n        }\n        return acc;\n    }, { tileObjects: [], spriteObjects: [] });\n}\n","import React from \"react\";\nimport { ReactReduxContext, Provider } from 'react-redux';\nimport { Stage } from '@inlet/react-pixi';\n\n// Contexts are not passed through the reconcilers with the new Context API.\n// This means we lose the redux context\n// Create a wrapper component that consumes the context and provides it again in the new reconciler context:\n// https://github.com/inlet/react-pixi/issues/77\nconst BridgedStage = (props: React.ComponentProps<typeof Stage>) => {\n    const { children, ...restProps } = props;\n    return (\n        <ReactReduxContext.Consumer>\n            {({ store }) => (\n                <Stage {...restProps}>\n                    <Provider store={store}>\n                        {children}\n                    </Provider>\n                </Stage>\n            )}\n        </ReactReduxContext.Consumer>\n    );\n}\n\nexport default BridgedStage;\n","import { useState, useEffect } from \"react\";\nimport { loadResource } from \"utils/pixiJs\";\nimport { TiledTilesetData } from 'constants/tiledMapData';\nimport { SpritesheetData, SpriteData } from 'constants/spritesheetData';\nimport { Spritesheet } from \"pixi.js\";\n\nconst useTilesetsLoader = (basePath: string) => {\n    const [tileSpritesheets, setTilesets] = useState<{[key: string]: Spritesheet}>({});\n    const [data, setData] = useState<TiledTilesetData[]>();\n\n    const loadTilesets = (value: TiledTilesetData[]) => {\n        setData(value);\n    };\n\n    useEffect(() => {\n        if (!data) return;\n        const nextTileset = nextTilesetToload(data, tileSpritesheets);\n        if (!nextTileset) return;\n\n        const tilesetName = nextTileset.name;\n\n        loadResource(`${basePath}/${nextTileset.image}`, (resource) => {\n            if (!resource) return;\n            if (resource.error) {\n                throw new Error(`Loading ${basePath}\\n${resource.error}`);\n            }\n            const spritesheetData = parseSpritesheetData(nextTileset);\n            const spritesheet = new Spritesheet(resource.texture, spritesheetData);\n\n            spritesheet.parse(() => {\n                const newTilesets = {\n                    ...tileSpritesheets,\n                    [tilesetName]: spritesheet\n                }\n                setTilesets(newTilesets);\n            })\n        });\n    }, [data, basePath, tileSpritesheets]);\n\n    const loadComplete = !!data && nextTilesetToload(data, tileSpritesheets) === undefined;\n\n    return {\n        loadComplete,\n        loadTilesets,\n        tileSpritesheets\n    }\n}\n\nexport default useTilesetsLoader;\n\n// Returns a TiledTilesetData that has not been loaded into tilesetsTextures yet\nconst nextTilesetToload = (tilesets: TiledTilesetData[], tilesetsTextures: {[key: string]: Spritesheet}) => {\n    return tilesets.find((t) => {\n        return !tilesetsTextures[t.name];\n    })\n}\n\n\nconst parseSpritesheetData = (tileset: TiledTilesetData): SpritesheetData => {\n    const columns = tileset.columns;\n\n    const frames: { [name: string]: SpriteData } = {};\n    for (let i = 0; i < tileset.tilecount; i++) {\n        const w = tileset.tilewidth;\n        const h = tileset.tileheight;\n        const x = (i % columns) * w;\n        const y = Math.floor(i / columns) * h;\n\n        frames[`${tileset.name}-${i + tileset.firstgid}`] = {\n            frame: {x, y, w, h},\n            spriteSourceSize: {x, y, w, h},\n            rotated: false,\n            trimmed: false,\n            sourceSize: { w, h}\n        };\n    }\n    const image = tileset.image;\n    const size = { w: tileset.imagewidth, h: tileset.imageheight };\n    return {\n        frames,\n        meta: {\n            image,\n            size,\n            scale: \"1\"\n        }\n    };\n}\n","import React, { useMemo } from 'react';\n\ninterface Props {\n    position: \"w\" | \"sw\" | \"s\" | \"se\" | \"e\";\n    icon?: string;\n    activated: boolean;\n    tileHeight: number;\n\n    onActivate?: () => void;\n    onDeactivate?: () => void;\n}\n\nconst Segment = (props: Props) => {\n    const {icon, onActivate, onDeactivate, tileHeight, activated} = props;\n    const segmentWidth = 32;\n    const segmentHeight = 46;\n    const rot = useMemo(() => {\n        switch (props.position) {\n            case \"w\": return 180;\n            case \"sw\": return 135;\n            case \"s\": return 90;\n            case \"se\": return 45;\n            default: return 0;\n        }\n    }, [props.position]);\n\n    const scale = activated ? 'scale(2)' : 'scale(1.5)';\n    const style = {\n        transform: `translate(${segmentWidth/2}px, ${tileHeight/2 - segmentHeight/2}px) ${scale} rotate(${rot}deg) translateX(${activated ? 27 : 35}px)`,\n        background: `url(${process.env.PUBLIC_URL}/img/scene/ui/combat/ring-segment.svg)`,\n        width: segmentWidth,\n        height: segmentHeight,\n        ...(activated && { zIndex: 2})\n    }\n\n    return (\n        <div\n            style={style}\n            className=\"segment\"\n            onMouseOver={onActivate}\n            onMouseOut={onDeactivate}\n        >\n            <img\n                src={icon}\n                style={{\n                    transform: `rotate(-${rot}deg)`,\n                    width: segmentWidth - 8\n                }}\n                alt=\"\"\n            />\n        </div>\n    )\n}\n\nexport default Segment;\n\n\n","import { SceneControllerContext } from 'components/world/QuestPanel/context/SceneControllerContext';\nimport React, { useContext, useMemo, useState } from 'react';\nimport { SceneActionType } from 'store/types/scene';\nimport { locationEquals } from 'utils/tilemap';\nimport { ActionIntent } from '../SceneUI';\nimport Segment from './Segment';\nimport \"./styles/combatUIWidget.scss\";\n\ninterface Props {\n    location: [number, number];\n    selectedActorId: string;\n    actionIntent?: ActionIntent;\n    onActionChange: (action?: SceneActionType) => void;\n}\n\n// CombatUIWidget shows a circle\nconst CombatUIWidget = (props: Props) => {\n    const {location, actionIntent, onActionChange,selectedActorId} = props;\n    const controller = useContext(SceneControllerContext)!;\n    const {tileWidth, tileHeight} = controller.getTileDimensions();\n    const transform = `translate(${tileWidth * location[0]}px, ${tileHeight * location[1]}px)`;\n    const [collapsed, setCollapsed] = useState(true);\n\n    const actorLocation = useMemo(() => {\n        return controller.getSceneActor(selectedActorId)?.location;\n    }, [])\n\n    const handleMouseMove = (e: React.MouseEvent) => {\n        e.preventDefault();\n        e.stopPropagation();\n    }\n\n    const handleMouseOver = () => {\n        if (!locationEquals(location, actorLocation ?? [0, 0])){\n            // cant expand the widget when on the current location of the actor\n            setCollapsed(false);\n        }\n    }\n\n    const handleMouseOut = () => {\n        setCollapsed(true); // todo enable\n    }\n\n    const handleSegmentActivate = (action: SceneActionType) => {\n        onActionChange(action);\n\n        // const ap = controller.calculateWalkApCosts(location, location);\n\n    }\n\n    const handleSegmentDeactivate = (_action: SceneActionType) => {\n        onActionChange(undefined);\n        // setText(\"\") // todo enablee\n    }\n\n\n    return (\n        <div\n            className={`combat-ui-widget ${collapsed ? \"collapsed\" : \"expanded\"}`}\n            style={{ transform }}\n            onMouseMove={handleMouseMove}\n            onMouseOver={handleMouseOver}\n            onMouseOut={handleMouseOut}\n        >\n            <Segment\n                position=\"w\"\n                tileHeight={tileHeight}\n                icon={`${process.env.PUBLIC_URL}/img/scene/ui/combat/icons/knife-thrust.svg`}\n                onActivate={() => handleSegmentActivate(SceneActionType.slash)}\n                onDeactivate={() => handleSegmentDeactivate(SceneActionType.slash)}\n                activated={actionIntent?.action === SceneActionType.slash}\n            />\n            <Segment\n                position=\"sw\"\n                tileHeight={tileHeight}\n                icon={`${process.env.PUBLIC_URL}/img/scene/ui/combat/icons/high-shot.svg`}\n                activated={false}\n            />\n            <Segment\n                position=\"s\"\n                tileHeight={tileHeight}\n                icon={`${process.env.PUBLIC_URL}/img/scene/ui/combat/icons/walking-boot.svg`}\n                onActivate={() => handleSegmentActivate(SceneActionType.move)}\n                onDeactivate={() => handleSegmentDeactivate(SceneActionType.move)}\n                activated={actionIntent?.action === SceneActionType.move}\n            />\n            <Segment \n                position=\"se\" \n                icon={`${process.env.PUBLIC_URL}/img/scene/ui/combat/icons/sunken-eye.svg`} \n                tileHeight={tileHeight}\n                activated={false}\n            />\n            <Segment \n                position=\"e\" \n                icon={`${process.env.PUBLIC_URL}/img/scene/ui/combat/icons/crosshair.svg`} \n                tileHeight={tileHeight}\n                activated={false}\n            />\n            <div className=\"info\" style={{ width: tileWidth }}>\n                {getText(actionIntent)}\n            </div>\n        </div>\n    )\n}\n\nexport default CombatUIWidget;\n\nconst getText = (actionIntent?: ActionIntent) => {\n    if (!actionIntent) return null;\n    if (actionIntent.action === SceneActionType.move) {\n        if (!actionIntent.path?.length) {\n            // no path possible\n            return null;\n        }\n        const insufficient = (actionIntent.actorAP || 0) < (actionIntent.apCost || 0);\n        return (\n            <>\n            <span>\n                Move\n            </span>\n            <span className={`${(insufficient) ? \"insufficient\": \"\"}`}>\n                {` ${actionIntent.apCost}`}AP\n            </span>\n            </>\n        );\n    }\n    if (actionIntent.action === SceneActionType.slash) {\n        if (!actionIntent.path?.length) {\n            // no path possible\n            return null;\n        }\n        const insufficient = (actionIntent.actorAP || 0) < (actionIntent.apCost || 0);\n        return (\n            <>\n            <span>\n                Slash\n            </span>\n            <span className={`${(insufficient) ? \"insufficient\": \"\"}`}>\n                {` ${actionIntent.apCost}`}AP\n            </span>\n            </>\n        );\n    }\n    return \"?\";\n}\n\n","import React from 'react';\nimport { SceneControllerContext } from 'components/world/QuestPanel/context/SceneControllerContext';\nimport { useContext } from 'react';\nimport { SceneActionType } from 'store/types/scene';\nimport \"./styles/normalUICursor.scss\";\n\ninterface Props {\n    location: [number, number];\n}\n\nconst NormalUICursor = (props: Props) => {\n    const {location} = props;\n    const controller = useContext(SceneControllerContext);\n\n    let blocked = controller?.locationIsBlocked(location) ?? false;\n    let action = SceneActionType.move;\n    if (blocked) {\n        // todo: can we have interactive tiles that are NOT blocking?\n        const object = controller?.getObjectAtLocation(location);\n        if (object?.properties.interactive){\n            // We're at an interactive object\n            action = SceneActionType.interact;\n            blocked = false;\n        }\n    }\n    const {tileWidth, tileHeight} = controller?.getTileDimensions() ?? { tileWidth: 64, tileHeight: 64 };\n    const transform = `translate(${tileWidth * location[0]}px, ${tileHeight * location[1]}px)`;\n    const backgroundImage = images[action];\n    const width = tileWidth;\n    const height = tileHeight;\n    return (\n        <div\n            className={`normal-ui-cursor ${blocked ? \"invalid\" : \"\"}`}\n            style={{ transform, backgroundImage, width, height }}\n        />\n    )\n}\n\nexport default NormalUICursor;\n\nconst images = {\n    [SceneActionType.move]:  `url(${process.env.PUBLIC_URL}/img/scene/ui/combat/icons/walking-boot.svg)`,\n    [SceneActionType.interact]: `url(${process.env.PUBLIC_URL}/img/scene/ui/combat/icons/sunken-eye.svg)`\n}","import { SceneControllerContext } from 'components/world/QuestPanel/context/SceneControllerContext';\nimport { useQuest } from 'hooks/store/quests';\nimport { Point } from 'pixi.js';\nimport React, {\n    PropsWithChildren,\n    useCallback,\n    useContext,\n    useEffect,\n    useRef,\n    useState\n} from 'react';\nimport { SceneActionType } from 'store/types/scene';\nimport { locationEquals } from 'utils/tilemap';\nimport CombatUIWidget from './CombatUIWidget';\nimport NormalUICursor from './NormalUICursor';\nimport \"./styles/sceneUI.scss\";\n\nexport interface Props {\n    sceneWidth: number;\n    sceneHeight: number;\n    selectedActorId: string;\n    actionIntent?: ActionIntent;\n\n    onMouseDown?: (location: [number, number]) => void;\n    onSetActionIntent: (intent?: ActionIntent) => void;\n}\n\nexport interface ActionIntent {\n    action: SceneActionType.move | SceneActionType.slash | SceneActionType.interact;\n    from: [number, number];\n    to: [number, number];\n    apCost?: number;\n    actor: string;\n    actorAP?: number;\n    path?: [number, number][];  // is undefined when path is invalid\n}\n\n// This thing scales itself based on the canvas which should be a sibling of this component\nconst SceneUI = (props: PropsWithChildren<Props>) => {\n    const {\n        children,\n        selectedActorId,\n        actionIntent,\n        sceneWidth,\n        sceneHeight,\n        onMouseDown,\n        onSetActionIntent\n    } = props;\n    const ref = useRef<HTMLDivElement>(null);\n    const mouseDown = useRef(false);\n    const scale = useRef(1);\n    const controller = useContext(SceneControllerContext);\n    const quest = useQuest(controller?.questName ?? \"\");\n    const scene = quest.scene;\n    const {combat} = scene ?? {};\n    const [cursorLocation, setCursorLocation] = useState<[number, number]>();\n\n    useEffect(() => {\n        // Scale the html element together with the sibling canvas\n        const handleResize = () => {\n            if (!ref.current) return;\n            const canvas = ref.current.parentNode?.querySelector(\"canvas\");\n            if (!canvas) throw Error(\"No canvas found as sibling of SceneUI\");\n\n            const currentWidth = canvas?.clientWidth;\n            scale.current = currentWidth/sceneWidth;\n            ref.current.style.transform = `scale(${scale.current})`;\n            ref.current.style.width = `${sceneWidth}px`;\n            ref.current.style.height = `${sceneHeight}px`;\n        }\n        window.addEventListener(\"resize\", handleResize);\n        handleResize();\n        return () => {\n            window.removeEventListener(\"resize\", handleResize);\n        };\n    }, [sceneHeight, sceneWidth]);\n\n    const handleMouseMove = (e: React.MouseEvent<HTMLDivElement>) => {\n        if (mouseDown.current) {\n            const location = findLocation(e) ?? [0, 0];\n\n            if (controller?.locationIsOutOfBounds(location)) {\n                setCursorLocation(undefined);\n                onSetActionIntent(undefined);\n                return;\n            }\n            if (!cursorLocation || !locationEquals(location, cursorLocation)){\n                setCursorLocation(location);\n            }\n        }\n    }\n\n    const handleMouseDown = (e: React.MouseEvent<HTMLDivElement>) => {\n        const location = findLocation(e);\n        if (location) onMouseDown?.(location);\n\n        mouseDown.current = true;\n        e.preventDefault();\n    }\n\n    const handleMouseUp = (_e: React.MouseEvent<HTMLDivElement>) => {\n        mouseDown.current = false;\n\n        setCursorLocation(undefined); // todo: uncomment to debug\n        if (!actionIntent) {\n            return\n        }\n        const selectedActorLocation = controller?.getSceneActor(selectedActorId)?.location;\n        if (selectedActorLocation && cursorLocation && !locationEquals(selectedActorLocation, cursorLocation)){\n            controller?.actorAttemptAction(selectedActorId, actionIntent.action, actionIntent.to);\n        }\n        onSetActionIntent?.(undefined);\n    }\n\n    const handleCombatActionChange = useCallback((action?: SceneActionType) => { // todo: beter name, not just combat\n        if (!action) {\n            onSetActionIntent(undefined);\n            return;\n        }\n        const {\n            location: from = [0, 0],\n            ap: actorAP,\n        } = controller?.getSceneActor(selectedActorId) ?? {};\n        const to = cursorLocation ?? [0, 0];\n        switch (action){\n            case SceneActionType.move:\n                case SceneActionType.slash: {\n                const path = controller?.findPath(from, to);\n                const apCost = combat ? controller?.calculateWalkApCosts(from, to) : undefined;\n\n                onSetActionIntent({\n                    action,\n                    from,\n                    to,\n                    apCost,\n                    actor: selectedActorId,\n                    actorAP,\n                    path,\n                })\n            }\n            break;\n            case SceneActionType.interact: {\n                const path = controller?.findPathNearest(from, to, true);\n                const apCost = 0; // can only inspect out of combat?\n\n                onSetActionIntent({\n                    action,\n                    from,\n                    to,\n                    apCost,\n                    actor: selectedActorId,\n                    actorAP,\n                    path,\n                })\n            }\n        }\n    }, [combat, controller, cursorLocation, onSetActionIntent, selectedActorId]);\n\n    useEffect(() => {\n        if (!combat && cursorLocation !== undefined) {\n            // Handle change of cursor when not in combat\n            let action = SceneActionType.move;\n            const object = controller?.getObjectAtLocation(cursorLocation);\n            if(object?.properties.interactive){\n                // We're at an interactive object\n                action = SceneActionType.interact;\n            }\n            handleCombatActionChange(action);\n        }\n    }, [cursorLocation, handleCombatActionChange, combat, controller])\n\n\n    const findLocation = (e: React.MouseEvent) => {\n        if (e.target instanceof Element){\n            const rect = (e.target).getBoundingClientRect();\n            const x = (e.clientX - rect.left) / scale.current;\n            const y = (e.clientY - rect.top) / scale.current;\n            return controller?.pointToSceneLocation(new Point(x, y));\n        }\n        throw new Error(\"You didnt give me the correct event\")\n    }\n\n    return (\n        <div\n            ref={ref}\n            className=\"scene-ui\"\n            onMouseMove={handleMouseMove}\n            onMouseDown={handleMouseDown}\n            onMouseUp={handleMouseUp}\n        >\n            {children}\n            {!scene?.combat && cursorLocation && (\n                <NormalUICursor location={cursorLocation} />\n            )}\n            {scene?.combat && cursorLocation && (\n                <CombatUIWidget\n                    location={cursorLocation}\n                    selectedActorId={selectedActorId}\n                    actionIntent={actionIntent}\n                    onActionChange={handleCombatActionChange}\n                />\n            )}\n        </div>\n    )\n}\n\nexport default SceneUI;","import { PixiComponent, applyDefaultProps, Graphics } from \"@inlet/react-pixi\";\nimport * as PIXI  from 'pixi.js';\nimport { Point } from \"pixi.js\";\n\ninterface Props  {\n    points?: Point[];\n    style?:  Partial<PIXI.LineStyle>;\n    dash?: number;\n    gap?: number;\n    speed?: number; // positive to move forward, negative to move backward, 0 to not move at all\n}\n\ninterface InternalDashedLine {\n    _destroy: boolean;\n    _raf: number;\n}\n\n/**\n * Draws a dashed line along a path\n */\nconst DashedLine = PixiComponent<React.ComponentProps<typeof Graphics> & Props, PIXI.Graphics>(\"DashedLine\", {\n    create() {\n        return new PIXI.Graphics();\n    },\n\n    applyProps(instance, oldProps: Props, newProps: Props) {\n        const {\n            points = [],\n            dash = 10,\n            gap = 5,\n            speed = 40,\n            style,\n            ...newP\n        } = newProps;\n\n        // apply rest props to PIXI.Graphics\n        applyDefaultProps(instance, oldProps, newP);\n        instance.clear();\n\n        const draw = () => {\n            if((this as unknown as InternalDashedLine)._destroy){\n                return;\n            }\n\n            instance.clear();\n            instance.lineStyle(style?.width ?? 10, style?.color, style?.alpha, style?.alignment, style?.native);\n            const offsetPercentage = (Date.now() % (10000/speed) + 1) / Math.abs(10000/speed);\n\n            let dashLeft = 0;\n            let gapLeft = 0;\n            if (offsetPercentage > 0) {\n                const progressOffset = (dash + gap) * offsetPercentage * (speed < -1 ? 1 : -1) ;\n                if (progressOffset < dash) {\n                    dashLeft = dash - progressOffset;\n                } else {\n                    gapLeft = gap - (progressOffset - dash);\n                }\n            }\n            const rotatedpoints = [];\n            for (const point of points) {\n                const p = point.clone();\n                const cosAngle = Math.cos(instance.rotation);\n                const sinAngle = Math.sin(instance.rotation);\n                const dx = p.x;\n                const dy = p.y;\n                p.x = (dx * cosAngle - dy * sinAngle);\n                p.y = (dx * sinAngle + dy * cosAngle);\n                rotatedpoints.push(p);\n            }\n\n            for (let i = 0; i < rotatedpoints.length - 1; i++) {\n                const p1 = rotatedpoints[i];\n                const p2 = rotatedpoints[i + 1];\n                const dx = p2.x - p1.x;\n                const dy = p2.y - p1.y;\n                const len = Math.sqrt(dx * dx + dy * dy);\n                const normal = {\n                    x: dx / len,\n                    y: dy / len\n                };\n                let progressOnLine = 0;\n\n                instance.moveTo(p1.x + gapLeft * normal.x, p1.y + gapLeft * normal.y);\n                while (progressOnLine <= len) {\n                    progressOnLine += gapLeft;\n                    if (dashLeft > 0) {\n                        progressOnLine += dashLeft;\n                    } else {\n                        progressOnLine += dash;\n                    }\n                    if (progressOnLine > len) {\n                        dashLeft = progressOnLine - len;\n                        progressOnLine = len;\n                    } else {\n                        dashLeft = 0;\n                    }\n                    instance.lineTo(p1.x + progressOnLine * normal.x, p1.y + progressOnLine * normal.y);\n                    progressOnLine += gap;\n                    if (progressOnLine > len && dashLeft === 0) {\n                        gapLeft = progressOnLine - len;\n                    } else {\n                        gapLeft = 0;\n                        instance.moveTo(p1.x + progressOnLine * normal.x, p1.y + progressOnLine * normal.y);\n                    }\n                }\n            }\n            if (speed !== 0) {\n                (this as unknown as InternalDashedLine)._raf = requestAnimationFrame(draw);\n            }\n        }\n        draw();\n    },\n\n    willUnmount() {\n        (this as unknown as InternalDashedLine)._destroy = true;\n        cancelAnimationFrame((this as unknown as InternalDashedLine)._raf);\n    }\n});\n\nexport default DashedLine;","import DashedLine from 'components/pixi/DashedLine';\nimport { Point } from 'pixi.js';\nimport React from 'react';\nimport { SceneActionType } from 'store/types/scene';\nimport { ActionIntent } from './ui/SceneUI'\n\nexport interface Props {\n  actionIntent: ActionIntent;\n  tileWidth: number;\n  tileHeight: number;\n}\n\nconst ActionPreview = (props: Props) => {\n  const {actionIntent, tileWidth, tileHeight} = props;\n\n  switch (actionIntent.action){\n    case SceneActionType.move:\n    case SceneActionType.interact:\n    case SceneActionType.slash: {\n      if (!actionIntent.path){\n        return null;\n      }\n      const convert = (p: number[]) => new Point(p[0] * (tileWidth) + (tileWidth / 2), p[1] * (tileHeight) + (tileHeight / 2));\n      const converted = [\n          convert(actionIntent.from),\n          ...actionIntent.path.map(p => convert(p))\n      ];\n      const valid = (!actionIntent.apCost) || actionIntent.apCost <= (actionIntent.actorAP || 0);\n\n      return (\n        <DashedLine\n          points={converted}\n          dash={10}\n          gap={15}\n          speed={20}\n          rotation={0}\n          style={{\n            width: 6,\n            color: valid ? 0xffffff : 0x8b0000,\n            alpha: 1,\n          }}\n        />)\n    }\n    default:\n      return null;\n  }\n}\n\nexport default ActionPreview;","import { useMemo } from 'react';\nimport { StoreState } from 'store/types';\nimport { useSelector } from 'react-redux';\nimport { LogChannel, LogEntry } from 'store/types/logEntry';\nimport { createSelector } from 'reselect';\n\nconst getLog = (state: StoreState) => state.log;\n\n// Returns the game log from redux store\nexport const useLog = () => {\n    const log = useSelector<StoreState, LogEntry[]>(store => store.log);\n    return log;\n}\n\nexport const useQuestLog = (questId: string) => {\n    const selectMemoized = useMemo(() => {\n        const selectQuestLogEntries = createSelector(\n            [getLog],\n            (log: LogEntry[]) => { return log.filter((l) => l.channel === LogChannel.quest && l.channelContext === questId) }\n        )\n        return selectQuestLogEntries;\n    }, [questId]);\n\n    return useSelector<StoreState, LogEntry[]>(selectMemoized);\n}\n\n","import { useEffect } from 'react';\nimport { useQuestLog } from 'hooks/store/useLog';\n\ninterface Props {\n    questId: string;\n}\n\nconst SceneLog = (props: Props) => {\n    const log = useQuestLog(props.questId);\n    useEffect(() => {\n        const lastLog = log.shift();\n        if ((lastLog?.time || 0) > Date.now() - 1000) {\n            // console.log(lastLog?.key)\n        }\n    }, [log]);\n    return null;\n}\n\nexport default SceneLog;","import { deductActorAp, enqueueSceneAction, startTurn } from \"store/actions/quests\";\nimport { StoreState } from \"store/types\";\nimport { Store, AnyAction } from \"redux\";\nimport { Allegiance } from \"store/types/combat\";\nimport { ActorObject, SceneAction, SceneActionType } from \"store/types/scene\";\nimport { locationEquals } from \"utils/tilemap\";\nimport { BaseSceneController, movementDuration } from \"./BaseSceneController\";\n\n\nexport class CombatController {\n  static sceneController?: BaseSceneController<unknown>;\n  protected static unsubscriber: () => void;\n\n  static initialize(sceneController: BaseSceneController<unknown>) {\n    this.sceneController = sceneController;\n\n    const storeChange = this.handleStoreChange.bind(this)\n    this.unsubscriber = sceneController.store.subscribe(storeChange);\n    // const selectQuest = createSelector(\n    //   [getQuests],\n    //   (quests: QuestStoreState[]) => { return quests.find(q => q.name === sceneController.questName) }\n    // )\n  }\n\n  static destroy() {\n    this.unsubscriber?.()\n  }\n\n  static handleStoreChange() {\n    if (!this.sceneController) return\n    // const questState = this.getQuestStoreState()\n    const adventurers = this.sceneController.sceneAdventurers;\n    const enemies = this.sceneController.sceneEnemies;\n    const quest = this.sceneController.quest;\n    // const { adventurers, enemies, quest } = this.sceneController ?? {};\n    if (adventurers && enemies && quest && quest.scene){\n      const totalAdventurerAp = adventurers.reduce((acc, value) => acc + value.ap, 0)\n      const { scene } = quest;\n      const { turn } = scene;\n      // No AP for the player left, switch to enemy turn\n      if (totalAdventurerAp === 0 && turn === Allegiance.player) {\n        \n        // console.log(\"END TURN\", totalAdventurerAp, totalEnemiesAp)\n        this.dispatch(startTurn(quest.name, Allegiance.enemy));\n        return\n      }\n      \n      \n      if (turn === Allegiance.enemy && !scene.actionQueue?.length) {\n        const totalEnemiesAp = enemies.reduce((acc, value) => acc + value.ap, 0)\n\n        if (totalEnemiesAp === 0) {\n          // No more AP left for the enemy, player turn\n          this.dispatch(startTurn(quest.name, Allegiance.player));\n          return\n        }\n\n\n        console.log(\"total enemy ap: \", totalEnemiesAp)\n        const enemy = this.findEnemyWithAp()\n        console.log(new Date().getTime(), \"do smt with: \", enemy, scene, scene.actionQueue)\n        if (enemy && enemy.location) {\n          const target = this.findNearestActor(enemy.location, Allegiance.player);\n          if (!target || !target.location) return // no target? did everyone die?\n          console.log('attack ', target)\n          const path = this.sceneController.findPath(enemy.location, target.location);\n\n          // this.dispatch(deductActorAp(quest.name, enemy.name, path?.length || 0));\n\n          // if (this.combat) {\n          //     const remaining = actor.ap || -1;\n          //     if (remaining < (path?.length || 0)) {\n          //         // return;\n          //     }\n          //     this.dispatch(deductActorAp(this.questName, actorId, path?.length || 0));\n          // }\n          path?.forEach((l, index) => {\n              const sceneAction: SceneAction = {\n                  actionType: SceneActionType.move,\n                  actorId: enemy.name,\n                  target: l as [number, number],\n                  endsAt: movementDuration * 10 * (index + 1) + performance.now()\n              };\n              this.dispatch(enqueueSceneAction(quest.name, sceneAction));\n          });\n          // break;\n        }\n\n      }\n      // console.log(totalAdventurerAp, totalEnemiesAp, quest.scene.turn )\n    }\n    // if (questState) {\n    //   console.log(questState)\n    //   console.log()\n    // }\n  }\n\n  static getQuestStoreState() {\n    return this.sceneController?.store.getState().quests.find(q => q.name === this.sceneController?.questName)\n  }\n\n  /** Finds the actor nearest to `from`, but not ON from */\n  static findNearestActor(from: [number, number], allegiance?: Allegiance) {\n    // const qss = this.getQuestStoreState();\n    // qss?.scene.\n    if (!this.sceneController) return undefined;\n    const actors = this.sceneController.sceneActors;\n    let distance = Number.MAX_VALUE;\n    let actor: ActorObject | undefined;\n    actors?.forEach(a => {\n      if (!a.location || !this.sceneController || locationEquals(a.location, from)) return\n      const steps = this.sceneController.findPath(from, a.location)?.length;\n      if (steps !== undefined && steps < distance) {\n        if (allegiance === undefined || a.allegiance === allegiance) {\n          distance = steps;\n          actor = a\n        }\n      }\n    })\n    return actor\n  }\n\n  /** Find next enemy with ap */\n  static findEnemyWithAp() {\n    if (!this.sceneController) return undefined;\n    const actors = this.sceneController.sceneActors;\n    return actors?.find(a => a.allegiance === Allegiance.enemy && a.ap > 0)\n  }\n\n  static dispatch(action: AnyAction) {\n    this.sceneController?.store.dispatch(action);\n  }\n}","import React, { useRef, useEffect, useContext, useState } from \"react\";\nimport { Container, Graphics } from '@inlet/react-pixi';\nimport { useQuestScene } from 'hooks/store/quests';\nimport Tilemap from './Tilemap';\nimport BridgedStage from 'components/pixi/util/BridgedStage';\nimport useTilesetsLoader from 'hooks/useTilesetsLoader';\nimport { SceneControllerContext } from '../../context/SceneControllerContext';\nimport SceneUI, { ActionIntent } from './ui/SceneUI';\nimport ActionPreview from './ActionPreview';\nimport { isAdventurer } from \"store/types/scene\";\nimport SceneLog from \"./SceneLog\";\nimport \"./styles/scene.scss\";\nimport { CombatController } from \"mechanics/scenes/CombatController\";\nimport { Rectangle } from \"pixi.js\";\n\nexport interface Props {\n    selectedActorId: string;\n    setSelectedActor: (id: string) => void;\n}\n\nconst DEBUG_ACTIONQUEUE = false;\nconst DEBUG_BLOCKEDTILES = false;\n\nconst Scene = (props: Props) => {\n    const {selectedActorId, setSelectedActor } = props;\n    const controller = useContext(SceneControllerContext)!;\n    const mapData = controller.mapData!;\n    const basePath = controller.basePath!;\n\n    const {\n        loadComplete,\n        loadTilesets,\n        tileSpritesheets\n    } = useTilesetsLoader(basePath);\n\n    const ref = useRef<HTMLDivElement>(null);\n    const scene = useQuestScene(controller.questName);\n    const combat = scene?.combat === true;\n    const {tileWidth, tileHeight} = controller.getTileDimensions();\n    const [currentActionIntent, setCurrentActionIntent] = useState<ActionIntent>();\n\n    useEffect(() => {\n        if (combat) {\n            console.log('combat on!')\n            CombatController.initialize(controller)\n        }\n        return () => { \n            console.log('combat off')\n            CombatController.destroy();\n        }\n    }, [combat]);\n\n    useEffect(() => {\n        if (!mapData) return;\n        loadTilesets(mapData.tilesets);\n    }, [loadTilesets, mapData]);\n\n    const handleUIMouseDown = (location: [number, number]) => {\n        const actor = controller.getObjectAtLocation(location);\n        if (actor && isAdventurer(actor) && actor?.name) {\n            // We can click on adventurers\n            props.setSelectedActor(actor.name);\n        }\n    }\n\n    if (!loadComplete || !mapData || !scene) {\n        return <div>loading scene...</div>\n    }\n\n    const sceneWidth = mapData.width * mapData.tilewidth;\n    const sceneHeight = mapData.height * mapData.tileheight;\n    return (\n        <div className=\"scene\" ref={ref}>\n            <BridgedStage width={sceneWidth} height={sceneHeight} >\n                <Container\n                    interactive={true}\n                    hitArea={new Rectangle(0, 0, sceneWidth, sceneHeight)}\n                >\n                    <Tilemap\n                        basePath={basePath}\n                        data={mapData}\n                        spritesheets={tileSpritesheets}\n                        objects={scene.objects}\n                        controller={controller}\n                        selectedActorId={selectedActorId}\n                        setSelectedActor={setSelectedActor}\n                    />\n                    { currentActionIntent && (<ActionPreview actionIntent={currentActionIntent} tileWidth={tileWidth} tileHeight={tileHeight}/>)}\n                    {DEBUG_BLOCKEDTILES && (\n                        <Graphics\n                            name=\"blocked-tiles\"\n                            draw={graphics => {\n                                const line = 3;\n                                for (let y = 0; y < mapData.height; y++) {\n                                    for (let x = 0; x < mapData.width; x++) {\n                                        const blocked = controller.locationIsBlocked([x, y]);\n\n                                        if (blocked) {\n                                            graphics.lineStyle(line, 0xFF0000);\n                                        } else {\n                                            graphics.lineStyle(line, 0xFFFFFF);\n                                        }\n                                        graphics.drawRect(x * tileWidth, y * tileHeight, tileWidth, tileHeight);\n                                        graphics.endFill();\n                                    }\n                                }\n                            }}\n                        />\n                    )}\n                </Container>\n            </BridgedStage>\n            {DEBUG_ACTIONQUEUE && (\n                <div style={{ position: 'absolute', bottom: 0}}>\n                    <h2>ActionQueue</h2>\n                    <ul>\n                        {scene.actionQueue && scene.actionQueue.map((action) => (\n                            <li key={JSON.stringify(action)}>{JSON.stringify(action)}</li>\n                        ))}\n                    </ul>\n                </div>\n            )}\n            <SceneUI\n                sceneWidth={sceneWidth}\n                sceneHeight={sceneHeight}\n                selectedActorId={selectedActorId}\n                actionIntent={currentActionIntent}\n                onMouseDown={handleUIMouseDown}\n                onSetActionIntent={setCurrentActionIntent}\n            />\n            <SceneLog questId={controller.questName} />\n        </div>\n    );\n}\n\nexport default Scene;\n","import React, { useState, useEffect } from \"react\";\nimport AdventurerTabstrip from './AdventurerTabstrip';\nimport { createSelectAdventurersOnQuest } from 'store/selectors/adventurers';\nimport { useSelector, useDispatch } from 'react-redux';\nimport QuestDetails from './QuestDetails';\nimport { useHistory } from 'react-router';\nimport { getWorldLink } from 'utils/routing';\nimport LootCache from './modals/LootCache';\nimport { useQuest } from 'hooks/store/quests';\nimport { setActiveSceneInteractionModal } from 'store/actions/quests';\nimport Situation from './modals/Situation';\nimport SceneControllerContextProvider from './context/SceneControllerContext';\nimport CombatBar from './CombatBar';\nimport AdventurerPanel from 'components/ui/adventurer/AdventurerPanel';\nimport { AdventurerSectionSelection } from \"components/ui/adventurer/AdventurerPanel\";\nimport \"./styles/questPanel.scss\";\n\nenum Layout {\n    auto,       // horizontal on large screens, vertical on small screens\n    vertical,\n    horizontal\n}\n\ninterface Props {\n    questName: string;\n    layout?: Layout;\n}\n\nconst QuestPanel = (props: Props) => {\n    const history = useHistory();\n    const dispatch = useDispatch();\n    const {layout = Layout.auto} = props;\n    const adventurers = useSelector(createSelectAdventurersOnQuest(props.questName));\n    const leader = adventurers[0];\n    const [selectedAdventurerId, setSelectedAdventurerID] = useState<string>(leader?.id);\n\n    const quest = useQuest(props.questName);\n    const activeInteractionModal = quest?.scene?.activeInteractionModal;\n\n    const handleAdventurerSelected = (adventurerId: string) => {\n        setSelectedAdventurerID(adventurerId);\n    }\n\n    const handleCloseLootCacheModal = () => {\n        dispatch(setActiveSceneInteractionModal(props.questName));\n    }\n\n    useEffect(() => {\n        if (!adventurers.length) {\n            // no adventurers, something went wrong, perhaps invalid url\n            // bounce back to world\n            history.push(getWorldLink());\n       }\n    }, [adventurers.length, history]);\n    if (!adventurers.length) return null;\n\n    return (\n        <SceneControllerContextProvider questName={props.questName}>\n            { quest?.scene?.combat && <CombatBar questName={props.questName} selectedAdventurerId={selectedAdventurerId}/>}\n            <div className={`quest-panel quest-panel-${Layout[layout]}`}>\n                <div className=\"quest-area\">\n                    <QuestDetails\n                        questName={props.questName}\n                        selectedActorId={selectedAdventurerId}\n                        setSelectedActor={handleAdventurerSelected}\n                    />\n                    { activeInteractionModal && activeInteractionModal.type === 'lootCache' && (\n                        <div className=\"modal\" onClick={handleCloseLootCacheModal}>\n                            <LootCache\n                                cacheName={activeInteractionModal.lootCache}\n                                adventurerId={selectedAdventurerId}\n                                onClose={handleCloseLootCacheModal}\n                            />\n                        </div>\n                    )}\n                    { activeInteractionModal && activeInteractionModal.type === 'situation' && (\n                        <div className=\"modal\" onClick={handleCloseLootCacheModal}>\n                            <Situation\n                                situation={activeInteractionModal.situation}\n                                adventurerId={selectedAdventurerId}\n                                onClose={handleCloseLootCacheModal}\n                            />\n                        </div>\n                    )}\n                </div>\n                <div className=\"party-area\">\n                    <AdventurerTabstrip\n                        adventurers={adventurers}\n                        selectedAdventurerId={selectedAdventurerId}\n                        onAdventurerTabSelected={handleAdventurerSelected}\n                        disabled={activeInteractionModal !== undefined}\n                    />\n                    <div className=\"adventurer-details\">\n                        <AdventurerSectionSelection />\n                        { selectedAdventurerId && (\n                            <AdventurerPanel\n                                adventurerId={selectedAdventurerId}\n                                questName={props.questName}\n                            />\n                        )}\n                    </div>\n                </div>\n            </div>\n        </SceneControllerContextProvider>\n    )\n}\n\nexport default QuestPanel;\n","import React from 'react';\nimport { useQuest } from 'hooks/store/quests';\nimport { getDefinition } from 'definitions/quests';\nimport { QuestDefinition } from 'definitions/quests/types';\nimport { TextManager } from 'global/TextManager';\nimport './styles/onTheRoad.scss';\n\nexport interface Props {\n    questName: string;\n}\n\n/* Shows the most recent log on a questnode */\nconst OnTheRoad = (props: Props) => {\n    const quest = useQuest(props.questName);\n    const questDefinition: QuestDefinition = getDefinition(quest.name);\n    let progress: number = Math.floor(quest.progress);\n    do {\n        const log = questDefinition.nodes[progress].log;\n        if (log) {\n            return (\n                <div>\n                    <p>{`${TextManager.get(log)}`}</p>\n                </div>\n            )\n        }\n        progress--;\n    } while (progress >= 0);\n    return <h1 className=\"on-the-road questname\">{TextManager.getQuestTitle(quest.name)}</h1>;\n}\n\nexport default OnTheRoad;","import React from 'react';\nimport Scene from 'components/world/QuestPanel/QuestDetails/scene/Scene';\nimport { useQuest } from 'hooks/store/quests';\nimport OnTheRoad from './OnTheRoad';\n\nexport interface Props {\n    questName: string;\n    selectedActorId: string;\n    setSelectedActor: (id: string) => void;\n}\n\nconst QuestDetails = (props: Props) => {\n    const quest = useQuest(props.questName);\n\n    if (!quest.sceneName) {\n        return <OnTheRoad questName={props.questName} />;\n    }\n    return (\n        <Scene {...props} />\n    );\n}\n\nexport default QuestDetails;","import React, { useRef, useContext } from \"react\";\nimport gsap from 'gsap';\nimport DraggableItemsList from 'components/ui/items/DraggableItemsList';\nimport { TextManager } from 'global/TextManager';\nimport AdventurerAvatar from 'components/ui/adventurer/AdventurerAvatar';\nimport { DragSourceType } from 'constants/dragging';\nimport { SceneControllerContext } from '../../context/SceneControllerContext';\nimport { useAdventurerState } from 'hooks/store/adventurers';\nimport Button from 'components/ui/buttons/Button';\nimport { adventurerFreeInventorySlots } from 'store/helpers/storeHelpers';\nimport Icon from 'components/ui/common/Icon';\nimport \"../styles/lootCache.scss\";\nimport \"../styles/modal.scss\";\n\ninterface Props {\n    cacheName: string;\n    adventurerId: string;\n    onClose: () => void;\n}\n\nconst LootCache = (props: Props) => {\n    const controller = useContext(SceneControllerContext)!;\n    const adventurer = useAdventurerState(props.adventurerId);\n    const freeSlots = adventurerFreeInventorySlots(adventurer);\n    const ref = useRef<HTMLDivElement>(null);\n    const cache = controller.getLootCache(props.cacheName);\n\n    if (!cache) {\n        return null;\n    }\n\n    const handleTakeGold = (e: React.MouseEvent) => {\n        e.stopPropagation();\n        // todo: animate gold flying away\n\n        controller.takeGoldFromCache(props.cacheName);\n    }\n\n    const handleTakeAllItems = (e: React.MouseEvent) => {\n        e.stopPropagation();\n        ref.current!.querySelectorAll(\".items-list .item\").forEach((el, index) => {\n            if (index >= freeSlots) return;\n            el.classList.add(\"taking\");\n        });\n        gsap.to(\".items-list .item.taking\", {\n            right: \"-100%\",\n            stagger: {\n              each: 0.1,\n              ease: \"power2.inOut\",\n            },\n            onComplete: () => {\n                for (let i = 0; i < freeSlots; i++) {\n                    controller.takeItemFromCache(0, props.cacheName, props.adventurerId);\n                }\n            }\n        });\n    }\n    return (\n        <div className={`interaction-modal loot-cache`} ref={ref}>\n            <div className=\"header\">\n                <div className=\"title\">\n                    {TextManager.get(cache.title, { adventurer: adventurer.name })}\n                </div>\n                <div className=\"close\" onClick={props.onClose} />\n            </div>\n            { cache.items.length > 0 && (\n                <div className=\"content\">\n                    <div className=\"items\">\n                        <DraggableItemsList\n                            items={cache.items}\n                            sourceType={DragSourceType.lootCache}\n                            sourceId={props.cacheName}\n                        />\n                    </div>\n                    <div className=\"adventurer\">\n                        <AdventurerAvatar adventurer={adventurer}/>\n                        <Button onClick={handleTakeAllItems} disabled={freeSlots === 0} size=\"small\">\n                            {TextManager.get(\"quest-common-loot-cache-take-all\")}\n                        </Button>\n                    </div>\n                </div>\n            )}\n            { !!cache.gold && (\n                <div className=\"content\">\n                    <div className=\"gold\">\n                        <Icon\n                            image=\"img/resources/gold.png\"\n                            size=\"medium\"\n                        />\n                        {TextManager.get(\"quest-common-loot-cache-gold\", { gold: cache.gold })}\n                    </div>\n                    <div className=\"take-gold\">\n                        <Button onClick={handleTakeGold} size=\"small\">\n                            {TextManager.get(\"quest-common-loot-cache-take\")}\n                        </Button>\n                    </div>\n                </div>\n            )}\n        </div>\n    )\n}\n\nexport default LootCache;","import React, { MouseEvent, useRef, useContext } from \"react\";\nimport { TextManager } from 'global/TextManager';\nimport { SceneControllerContext } from '../../context/SceneControllerContext';\nimport Button from 'components/ui/buttons/Button';\nimport \"../styles/situation.scss\";\nimport \"../styles/modal.scss\";\n\ninterface Props {\n    situation: string;\n    adventurerId: string;\n    onClose: () => void;\n}\n\nconst Situation = (props: Props) => {\n    const controller = useContext(SceneControllerContext);\n    const ref = useRef<HTMLDivElement>(null);\n    const situation = controller?.getSituation(props.situation, props.adventurerId);\n    if (!situation) return null;\n\n    const { title, choices, text } = situation;\n    const handleChoiceClick = (e: MouseEvent<HTMLButtonElement>) => {\n        const choice = e.currentTarget.getAttribute('data-option');\n        if (!choice || !controller) return\n        controller.handleSituationOptionClick(props.situation, choice, props.adventurerId);\n        e.stopPropagation();\n    }\n\n    const handleClose = (e: MouseEvent<HTMLDivElement>) => {\n        props.onClose();\n        e.stopPropagation();\n    }\n    return (\n        <div className={`interaction-modal situation`} ref={ref}>\n            <div className=\"header\">\n                <div className=\"title\">\n                    {TextManager.get(title)}\n                </div>\n                <div className=\"close\" onClick={handleClose} />\n            </div>\n            <div className=\"content\">\n            { text && (<div className=\"text\">{TextManager.get(text)}</div>)}\n            { choices?.map(choice => (\n                <Button key={choice} data-option={choice} onClick={handleChoiceClick}>{TextManager.get(choice)}</Button>\n            ))}\n        </div>\n        </div>\n    )\n}\n\nexport default Situation;","import React, { useContext } from \"react\";\nimport { useSelector } from 'react-redux';\nimport { createSelectAdventurersOnQuest } from 'store/selectors/adventurers';\nimport { SceneControllerContext } from '../context/SceneControllerContext';\nimport AdventurerAvatar from 'components/ui/adventurer/AdventurerAvatar';\nimport { TextManager } from 'global/TextManager';\nimport Button from 'components/ui/buttons/Button';\nimport { IconSize } from 'components/ui/common/Icon';\nimport \"./styles/combatBar.scss\";\n\ninterface Props {\n    questName: string;\n    selectedAdventurerId?: string;\n}\n\nconst CombatBar = (props: Props) => {\n    const {selectedAdventurerId} = props;\n    const adventurers = useSelector(createSelectAdventurersOnQuest(props.questName));\n    const controller = useContext(SceneControllerContext);\n\n    return (\n        <div className=\"combat-bar\">\n            <div className=\"title\">\n                {TextManager.get(\"ui-combat-bar-title\")}\n            </div>\n            <div className=\"adventurers\">\n                {adventurers.map(a => (\n                    <div key={a.id} className={`adventurer ${selectedAdventurerId === a.id ? \"selected\" : \"\"}`}>\n                        <AdventurerAvatar adventurer={a} size={IconSize.smallest}/>\n                        <div className=\"ap\">\n                            {controller?.getSceneActor(a.id)?.ap || 0} AP\n                        </div>\n                    </div>\n                ))}\n            </div>\n            <Button size=\"small\" onClick={() => controller?.endTurn()}>End turn</Button>\n        </div>\n    )\n}\n\nexport default CombatBar;\n","import * as React from \"react\";\r\nimport Tab from \"components/ui/tabs/Tab\";\r\nimport Tabstrip from \"components/ui/tabs/Tabstrip\";\r\nimport {LogChannel, LogEntry} from \"store/types/logEntry\";\r\nimport {TextManager} from \"global/TextManager\";\r\nimport {useEffect, useState} from 'react';\r\nimport Button from 'components/ui/buttons/Button';\r\nimport { useLog } from \"hooks/store/useLog\";\r\nimport { useActiveQuestNames } from \"hooks/store/quests\";\r\nimport { useLocation } from \"react-router-dom\";\r\nimport { getQuestLink, getTownLink } from \"utils/routing\";\r\nimport \"./styles/simplelog.scss\";\r\n\r\n// eslint-disable-next-line @typescript-eslint/no-empty-interface\r\nexport interface Props {\r\n}\r\n\r\nenum ChannelType {\r\n    all,\r\n    town,\r\n    quest,\r\n}\r\n\r\ninterface ChannelDefinition {\r\n    label: string;\r\n    tabType: ChannelType;\r\n    tabId: string;\r\n    channelContext?: string;\r\n}\r\n\r\n// const activeQuestNames: string[] = [];\r\n\r\nconst SimpleLog = () => {\r\n\r\n    const [expanded, setExpanded] = useState(false);\r\n    const [selectedTabId, setSelectedTabId] = useState<\"all\" | \"town\" | string>(\"all\");\r\n\r\n    const logEntries = useLog();\r\n    const activeQuestNames = useActiveQuestNames();\r\n    const location = useLocation<{pathname: string}>();\r\n\r\n    useEffect(() => {\r\n        if (location.pathname === getTownLink()){\r\n            setSelectedTabId(\"town\");\r\n            return;\r\n        }\r\n        activeQuestNames.forEach(q => {\r\n            if (location.pathname === getQuestLink(q)){\r\n                setSelectedTabId(`quest-${q}`);\r\n            }\r\n        })\r\n    }, [activeQuestNames, location]);\r\n\r\n    const channels: ChannelDefinition[]=[{\r\n        label: TextManager.get(\"ui-log-tab-all\"),\r\n        tabId: \"all\",\r\n        tabType: ChannelType.all,\r\n    }, {\r\n        label: TextManager.get(\"ui-log-tab-town\"),\r\n        tabId: \"town\",\r\n        tabType: ChannelType.town,\r\n    }];\r\n\r\n    const handleTabSelected = (tabId: string) => {\r\n        setSelectedTabId(tabId);\r\n    }\r\n\r\n    const handleToggleExpand=() => {\r\n        setExpanded(!expanded);\r\n    }\r\n\r\n    activeQuestNames.forEach((questName) => {\r\n        channels.push({\r\n            channelContext: questName,\r\n            label: TextManager.getQuestTitle(questName),\r\n            tabId: `quest-${questName}`,\r\n            tabType: ChannelType.quest,\r\n        });\r\n    });\r\n\r\n    let displayEntries: LogEntry[] = [];\r\n    const currentTab = channels.find((t) => t.tabId === selectedTabId);\r\n\r\n    switch (currentTab?.tabType) {\r\n        case ChannelType.all:\r\n            // All the things\r\n            displayEntries = logEntries;\r\n            break;\r\n\r\n        case ChannelType.town:\r\n            // Only town\r\n            displayEntries = logEntries.filter((lE) => lE.channel === LogChannel.town);\r\n            break;\r\n\r\n        case ChannelType.quest:\r\n            // Only the selected quest\r\n            displayEntries = logEntries.filter((lE) => lE.channel === LogChannel.quest && lE.channelContext === currentTab.channelContext);\r\n            break;\r\n    }\r\n\r\n    const getLogEntryRow = (logEntry: LogEntry) => {\r\n        const text = TextManager.get(logEntry.key, logEntry.context);\r\n        return (\r\n            <div className=\"entry\" key={logEntry.time}>\r\n                {text}\r\n            </div>\r\n        );\r\n    };\r\n\r\n    return (\r\n        <div className={`log${expanded ? \" expanded\" : \"\"}`}>\r\n            <div className=\"tab-bar\">\r\n                <Tabstrip className=\"tabs\" onTabSelected={handleTabSelected} activeTab={selectedTabId}>\r\n                    {channels.map((tab) => {\r\n                        return <Tab id={tab.tabId} key={tab.tabId}>{tab.label}</Tab>;\r\n                    })}\r\n                </Tabstrip>\r\n                <Button\r\n                    className=\"expand-button\"\r\n                    onClick={handleToggleExpand}\r\n                    square={true}\r\n                    size=\"medium\"\r\n                    text={expanded ? \"▼\" : \"▲\"}\r\n                />\r\n            </div>\r\n            <div className=\"log-entries\">\r\n                {displayEntries.map((entry) => getLogEntryRow(entry))}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default SimpleLog;\r\n","import WorldMap from \"components/world/WorldMap\";\r\nimport React, { useEffect, useRef } from \"react\";\r\nimport { Channel, MixMode, SoundManager } from \"global/SoundManager\";\r\nimport QuestPanel from './QuestPanel';\r\nimport { useRouteMatch, useHistory } from 'react-router';\r\nimport { getQuestLink, getWorldLink } from 'utils/routing';\r\nimport \"./styles/worldView.scss\";\r\n\r\n// eslint-disable-next-line @typescript-eslint/no-empty-interface\r\nexport interface Props {\r\n}\r\n\r\n/**\r\n * WorldView shows the map and QuestPanel\r\n * @param props\r\n */\r\nconst WorldView = () => {\r\n    const worldMapRef = useRef<HTMLDivElement>(null);\r\n    const match = useRouteMatch<{questname: string}>(`${getWorldLink()}/:questname`);\r\n    const selectedQuestName = match?.params.questname;\r\n    const history = useHistory();\r\n\r\n    useEffect(() => {\r\n        SoundManager.addSound(\"music/world\", \"sound/music/TheLoomingBattle.ogg\", () => {\r\n            SoundManager.playSound(\"music/world\", Channel.music, true, MixMode.fade, true);\r\n        })\r\n    }, []);\r\n\r\n    // const handleMapMove = (distance: number, angle: number) => {\r\n    //     const compassEl = compassRef!.current!;\r\n    //     const compassTextEl = compassEl.firstElementChild! as HTMLElement;\r\n\r\n    //     // Rotate the compass\r\n    //     compassEl.style.transform = `rotate(${angle - (Math.PI / 2)}rad)`;\r\n    //     compassEl.style.opacity = distance > 10 ? \"1\" : \"0\";\r\n    //     compassTextEl.style.transform = `rotate(${-angle + (Math.PI / 2)}rad)`;\r\n    //     compassTextEl.innerHTML = `${distance.toFixed(0)}`;\r\n    // };\r\n\r\n    // const handleCompassClick = () => {\r\n    //     //setScrollToPosition(new Vector2(1, 1));\r\n    // };\r\n\r\n    const handlePartyClick = (questName: string) => {\r\n        // if (questName === selectedQuestName) {\r\n        //     history.push(getWorldLink());\r\n        // } else {\r\n            history.push(getQuestLink(questName));\r\n        // }\r\n        SoundManager.playSound(\"ui/buttonClick\");\r\n    };\r\n\r\n    const handleRetrieveWorldViewRef = () => {\r\n        return worldMapRef;\r\n    }\r\n\r\n    return (\r\n        <div className=\"world-view\" ref={worldMapRef}>\r\n            {/* <div className=\"compass\" ref={compassRef} onClick={handleCompassClick}>\r\n                <div className=\"distance\"/>\r\n            </div> */}\r\n            <WorldMap\r\n                selectedQuestName={selectedQuestName}\r\n                // onMapMove={handleMapMove}\r\n                smallMap={selectedQuestName != null}\r\n                onPartyClick={handlePartyClick}\r\n                retrieveWorldViewRef={handleRetrieveWorldViewRef}\r\n            />\r\n            { selectedQuestName && (\r\n                <QuestPanel questName={selectedQuestName} />\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default WorldView;\r\n","import React, { PropsWithChildren, useEffect, useRef, useState } from 'react';\nimport { TooltipManager } from 'global/TooltipManager';\nimport { InfoWindow } from 'components/ui/modals/InfoWindow';\nimport './styles/tooltip.scss';\n\nconst ARROW_SIZE = 8; // warning: sync to tooltip.css var\nconst PADDING = 8;\n\nexport interface Props {\n    referenceRect: ClientRect;  // place tooltip in reference to this rect\n    placement?: Placement;\n    className?: string;\n}\n\nexport enum Placement {\n    bottom,\n    top,\n    left,\n    right,\n}\n\nexport const Tooltip = (props: PropsWithChildren<Props>) => {\n    const { children, referenceRect } = props;\n    let { className = \"\" } = props;\n    const ref = useRef<HTMLDivElement>(null);\n    const [placement, setPlacement] = useState<Placement>(props.placement || Placement.bottom);\n\n    const [containerRect, setContainerRect] = useState<ClientRect>(); // This is the\n\n    useEffect(() => {\n        // Reposition if needed\n        const tooltipElement = ref.current;\n        if (!tooltipElement) return;\n        if (!containerRect) return;\n        const tooltipRect = tooltipElement.getBoundingClientRect();\n\n        // Flip vertically\n        switch (placement) {\n            case Placement.top:\n                if (tooltipRect.top - tooltipRect.height - ARROW_SIZE - PADDING < containerRect!.top) {\n                    // Too high, place underneath\n                    setPlacement(Placement.bottom);\n                    return;\n                }\n                break;\n            case Placement.bottom:\n                if (tooltipRect.top + tooltipRect.height + ARROW_SIZE + PADDING > containerRect!.height) {\n                    // Too low, place top\n                    setPlacement(Placement.top);\n                    return;\n                }\n                break;\n        }\n        tooltipElement.style.opacity = \"1\"; // animated through css\n\n        const contentElement = tooltipElement.querySelector(\".tooltip-content\") as HTMLElement;\n        if (tooltipRect.left < containerRect!.left + PADDING) {\n            // Check left bounding edge\n            const offset = containerRect!.left - tooltipRect.left + PADDING;\n            contentElement.style.transform = `translateX(${offset}px)`;\n        } else if (tooltipRect.right > containerRect!.right - PADDING) {\n            // Check right bounding edge\n            const offset = tooltipRect.right - containerRect!.right + PADDING;\n            contentElement.style.transform = `translateX(${-offset}px)`;\n        } else {\n            contentElement.style.transform = '';\n        }\n\n    }, [setPlacement, containerRect, placement, referenceRect]);\n\n    const resize = () => {\n        TooltipManager.clear();\n    }\n\n    useEffect(() => {\n        setContainerRect(ref.current?.closest('.app')?.getBoundingClientRect());\n\n        window.addEventListener(\"resize\", resize);\n        return () => {\n            window.removeEventListener(\"resize\", resize);\n        };\n    }, []);\n\n\n    let x = 0;\n    let y = 0;\n\n    if (containerRect) {\n        switch (placement) {\n            case Placement.bottom:\n                x = referenceRect.left - containerRect!.left + referenceRect.width / 2;\n                y = referenceRect.top - containerRect!.top + referenceRect.height;\n                className += \" tooltip-bottom\";\n                break;\n            case Placement.top:\n                x = referenceRect.left - containerRect!.left + referenceRect.width / 2;\n                y = referenceRect.top - containerRect!.top;\n                className += \" tooltip-top\";\n                break;\n        }\n    }\n\n    return (\n        <div className={`tooltip ${className}`}\n            style={{\n                left: x,\n                opacity: 0,\n                top: y,\n            }}\n            ref={ref}\n        >\n            <div className=\"tooltip-arrow\" />\n            <InfoWindow className=\"tooltip-content\">\n                {children}\n            </InfoWindow>\n        </div>\n    );\n}\n\nexport default Tooltip;\n","import * as React from \"react\";\nimport { useDispatch } from 'react-redux';\nimport { Structure } from 'definitions/structures';\nimport { subtractGold } from 'store/actions/gold';\nimport { startBuildingStructure, finishBuildingStructure } from 'store/actions/structures';\nimport { startTask } from 'store/actions/tasks';\nimport { TaskType } from 'store/types/task';\nimport { Deed, getDefinition as getDeedDefinition} from 'definitions/items/deeds';\nimport useGoldState from 'hooks/store/useGoldState';\nimport { useStructureDefinition, useStructureState } from 'hooks/store/structures';\nimport { StructureState } from 'store/types/structure';\nimport { TextManager } from 'global/TextManager';\nimport Button from 'components/ui/buttons/Button';\n\ninterface Props {\n    item: Deed;\n}\n\nconst DeedContent = (props: Props) => {\n    const { item } = props;\n    const definition = getDeedDefinition(item)\n    const dispatch = useDispatch();\n\n    const gold = useGoldState();\n    const structureDefinition = useStructureDefinition(definition.structure);\n    const enoughGold = structureDefinition.cost.gold || 0 <= gold;\n    const structureStoreState = useStructureState(definition.structure);\n    const canBeBuilt = structureStoreState.state === StructureState.NotBuilt;\n    const disabled = !canBeBuilt || !enoughGold;\n    const subtext = TextManager.getItemSubtext(item);\n\n    const handleStartConstruction = (structure: Structure) => {\n\n        dispatch(subtractGold(structureDefinition.cost.gold || 0));\n        dispatch(startBuildingStructure(structure));\n\n        const callbacks = [ finishBuildingStructure(structure) ];\n        const time = structureDefinition.cost.time;\n        const start = startTask(TaskType.buildStructure,\n            `${structure}.build`,\n            \"town\",\n            time ?? 0,\n            callbacks);\n        dispatch(start);\n    }\n    return (\n        <div>\n            { subtext && (<p className=\"subtext\">{`\"${subtext}\"`}</p>)}\n            <Button\n                disabled={disabled}\n                size=\"small\"\n                onClick={() => handleStartConstruction(definition.structure)}\n            >\n                Start construction ({ structureDefinition.cost.gold } gold)\n            </Button>\n        </div>\n    );\n\n}\n\nexport default DeedContent;","import * as time from \"utils/format/time\";\n\nexport const STUDY_TIME = time.TWO_MINUTES;","import * as React from \"react\";\nimport { Item } from 'definitions/items/types';\nimport { getDefinition as getProductionDefinition, getProductionStructureForItem } from 'definitions/production';\nimport { useStructureState } from 'hooks/store/structures';\nimport { Structure } from 'definitions/structures';\nimport { ProducableItem, ProductionStructureStoreState, StructureState } from 'store/types/structure';\nimport { getDefinition as getItemDefinition } from 'definitions/items';\nimport { Link } from 'react-router-dom';\nimport { getStructureLink } from 'utils/routing';\nimport { TextManager } from 'global/TextManager';\nimport { useStudyingTasksStateByStructure } from 'hooks/store/useTasksState';\nimport { startTask } from 'store/actions/tasks';\nimport { TaskType } from 'store/types/task';\nimport { useDispatch } from 'react-redux';\nimport { addItemToToProduces } from 'store/actions/structures';\nimport { formatDuration } from 'utils/format/time';\nimport { STUDY_TIME } from 'mechanics/studying';\nimport Button from 'components/ui/buttons/Button';\n\ninterface Props {\n    item: ProducableItem;\n}\n\nconst ProduceOrStudy = (props: Props) => {\n    const structure = getProductionStructureForItem(props.item);\n    const itemDefinition = getItemDefinition(props.item);\n    if (itemDefinition.unique) {\n        return (\n            <p>Unique item</p>\n        )\n    }\n    if (!structure) {\n        return null;\n    }\n    return (\n        <ProducedAtStructure item={props.item} structure={structure} />\n    )\n}\n// refactor 2021-02-19 becomes 'CraftedAtStructure'\nconst ProducedAtStructure = (props: Props & { structure: Structure}) => {\n    const {structure} = props;\n    const structureStore: ProductionStructureStoreState = useStructureState(structure);\n    const studyTasks = useStudyingTasksStateByStructure(structure);\n    const dispatch = useDispatch();\n\n    if (!structure) {\n        return null;\n    }\n\n    // const structureDefinition = getStructureDefinition<ProductionStructureDefinition>(structure);\n    // Can already be produced\n    if (structureStore.produces.some((item: Item) => item === props.item)){\n        return (\n            <p>Constructed at:&nbsp;\n                <Link to={getStructureLink(structure)} >\n                    { TextManager.getStructureName(structure) }\n                </Link>\n            </p>\n        )\n    }\n\n    // Currently studied\n    const task = studyTasks.find(sT => sT.name === props.item);\n    if (task) {\n        return (\n            <p>\n                <Link to={getStructureLink(structure)} >\n                    {TextManager.get(\"ui-tooltip-study-currently-studying\")}\n                </Link>\n                {formatDuration(task.timeRemaining, true)}\n            </p>\n        )\n    }\n\n    // Cant study because the structure is not high lvl enough\n    const productionDefinition = getProductionDefinition(props.item);\n    if (structureStore.level < (productionDefinition.levelRequired || 0) || structureStore.state !== StructureState.Built) {\n\n        return (\n            <p className=\"invalid\">\n                {TextManager.get(\"ui-tooltip-study-requires-structure-level\", { structure, level: (productionDefinition.levelRequired || 0) + 1})}\n            </p>\n        )\n    }\n\n    const startStudy = () => {\n        const callbacks = [\n            addItemToToProduces(props.structure, props.item)\n        ];\n\n        const studyTime = STUDY_TIME;\n        const start = startTask(TaskType.studyItem,\n            props.item,\n            `${structure}.study`,\n            studyTime,\n            callbacks);\n        dispatch(start);\n    }\n\n    return (\n        <p>\n            <Button onClick={startStudy} size=\"small\">\n                {TextManager.get(\"ui-tooltip-study-start-study\")}\n            </Button>\n            Start studying this item at {' '}\n            <Link to={getStructureLink(structure)} >\n                { TextManager.getStructureName(structure) }\n            </Link>\n        </p>\n    );\n}\n\nexport default ProduceOrStudy;","import * as React from \"react\";\nimport { getDefinition as getWeaponDefinition, DamageType, WeaponTypeDefinition, WeaponType, Weapon } from 'definitions/items/weapons';\nimport { TextManager } from 'global/TextManager';\nimport ProduceOrStudy from './ProduceOrStudy';\n\ninterface Props {\n    item: Weapon;\n}\n\nconst WeaponContent = (props: Props) => {\n    const { item } = props;\n    const definition = getWeaponDefinition(item)\n\n    const subtext = TextManager.getItemSubtext(item);\n    const weaponType = TextManager.getWeaponType(definition.weaponType);\n    const { classification } = WeaponTypeDefinition[definition.weaponType];\n    const classificationText = TextManager.getWeaponClassification(classification);\n\n    return (\n        <>\n            <div>{weaponType}\n              {definition.weaponType !== WeaponType.shield && (` (${classificationText})`)}\n            </div>\n            { subtext && (<p className=\"subtext\">{`\"${subtext}\"`}</p>)}\n            { definition.damage && <p> damage: { definition.damage[DamageType.kinetic] } </p>}\n            <ProduceOrStudy item={item} />\n        </>\n    );\n\n}\n\nexport default WeaponContent;","import * as React from \"react\";\nimport { TextManager } from 'global/TextManager';\nimport { Apparel, getDefinition as getApparelDefinition } from 'definitions/items/apparel';\nimport ProduceOrStudy from './ProduceOrStudy';\n\ninterface Props {\n    item: Apparel;\n}\n\nconst ApparelContent = (props: Props) => {\n    const { item } = props;\n    const definition = getApparelDefinition(item)\n\n    const { damageReduction } = definition;\n    const subtext = TextManager.getItemSubtext(item);\n    const equipmentSlot = TextManager.getEquipmentSlot(definition.equipmentType);\n    return (\n        <>\n            <div>{`${equipmentSlot}`}</div>\n            { subtext && (<p className=\"subtext\">{`\"${subtext}\"`}</p>)}\n            { damageReduction && <p> { TextManager.get(\"ui-tooltip-damage-reduction\", { damageReduction}) } </p> }\n            <ProduceOrStudy item={item} />\n        </>\n    );\n};\n\nexport default ApparelContent;","import * as React from \"react\";\nimport { useDispatch, useSelector } from 'react-redux';\nimport { TextManager } from 'global/TextManager';\nimport Button from 'components/ui/buttons/Button';\nimport { Potion } from \"definitions/items/potions\";\nimport { ItemSource } from \"constants/items\";\nimport { DragSourceType } from \"constants/dragging\";\nimport { drinkPotion } from \"store/actions/adventurers\";\nimport { addLogText } from \"store/actions/log\";\nimport { LogChannel } from \"store/types/logEntry\";\nimport { StoreState } from \"store/types\";\nimport { AdventurerStoreState } from \"store/types/adventurer\";\n\ninterface Props {\n    item: Potion;\n    source?: ItemSource;\n}\n\nconst DeedContent = (props: Props) => {\n    const { item, source } = props;\n    const dispatch = useDispatch();\n    const subtext = TextManager.getItemSubtext(item);\n    const adventurers = useSelector<StoreState, AdventurerStoreState[]>(store => store.adventurers);\n\n    const handleDrink = () => {\n        if (!source?.id || !source?.slot) return\n        dispatch(drinkPotion(source.id, source.slot));\n\n        // Add log entry\n        const adventurer = adventurers.find(a => a.id === source.id)?.name\n        if (adventurer) {\n            dispatch(addLogText(\"adventurer-drink-potion\", { item, adventurer }, LogChannel.common));\n        }        \n    }\n\n    const onAnAdventurer = source && source.origin === DragSourceType.adventurerInventory;\n    return (\n        <div>\n            { subtext && (<p className=\"subtext\">{`\"${subtext}\"`}</p>)}\n            {onAnAdventurer && (\n                <Button\n                    disabled={false}\n                    size=\"small\"\n                    onClick={() => handleDrink()}\n                >\n                    Drink potion\n                </Button>\n            )}\n        </div>\n    );\n\n}\n\nexport default DeedContent;","import * as React from \"react\";\nimport { isApparel } from \"definitions/items/apparel\";\nimport { isDeed } from \"definitions/items/deeds\";\nimport { Item } from \"definitions/items/types\";\nimport { isWeapon } from \"definitions/items/weapons\";\nimport DeedContent from './DeedContent';\nimport WeaponContent from './WeaponContent';\nimport ApparelContent from './ApparelContent';\nimport { TextManager } from 'global/TextManager';\nimport { isPotion } from \"definitions/items/potions\";\nimport PotionContent from \"./PotionContent\";\nimport { ItemSource } from \"constants/items\";\nimport \"./styles/itemContext.scss\";\n\nexport interface Props {\n    item: Item;\n    source?: ItemSource;\n}\n\nconst ItemContext = (props: Props) => {\n    const { item, source } = props;\n    if (isDeed(item)) {\n        return <DeedContent item={item} />;\n    }\n    if (isWeapon(item)) {\n        return <WeaponContent item={item} />;\n    }\n    if (isWeapon(item)) {\n        return <WeaponContent item={item} />;\n    }\n    if (isApparel(item)) {\n        return <ApparelContent item={item} />;\n    }\n    if (isPotion(item)) {\n        return <PotionContent item={item} source={source} />;\n    }\n    const subtext = TextManager.getItemSubtext(item);\n    return (subtext && (<p className=\"subtext\">{`\"${subtext}\"`}</p>)) || null;\n}\nexport default ItemContext;","import * as React from \"react\";\nimport { TextManager } from 'global/TextManager';\nimport { useSelector } from 'react-redux';\nimport { StoreState } from 'store/types';\nimport { StructuresStoreState } from 'store/types/structures';\nimport { Resource } from 'definitions/resources';\nimport { getStructureByResource, getDefinition } from 'definitions/structures';\nimport { StructureState, StructureStoreState } from 'store/types/structure';\nimport { ResourceStructureLevelDefinition, ResourceStructureDefinition } from 'definitions/structures/types';\nimport { useMaxResourcesState, useResourcesState } from 'hooks/store/resources';\nimport { formatNumber } from 'utils/format/number';\nimport useGoldState from 'hooks/store/useGoldState';\nimport { useWorkersFreeState, useWorkersState } from 'hooks/store/useWorkersState';\nimport ReactMarkdown from \"react-markdown\";\nimport './resourceContext.scss';\n\nexport interface Props {\n    info: string;\n}\n\nconst ResourceContext = (props: Props) => {\n\n    const resource = props.info;\n    const resourcesState = useResourcesState();\n    const goldState = useGoldState();\n    const workersState = useWorkersState();\n    const workersFreeState = useWorkersFreeState();\n    const structureStates = useSelector<StoreState, StructuresStoreState>(store => store.structures);\n    const maxResources = useMaxResourcesState();\n\n    const renderProducedBy = () => {\n        const structure = getStructureByResource(resource as Resource);\n        const structureState: StructureStoreState = structureStates[structure];\n        if (structureState.state !== StructureState.Built) {\n            return (\n                <span>\n                    {TextManager.get(\"ui-tooltip-resource-produce-row-notbuilt\", {\n                        structure: TextManager.getStructureName(structure)\n                    })}\n                </span>\n            )\n        }\n        const structureDefinition = getDefinition<ResourceStructureDefinition>(structure);\n        const levelDefinition: ResourceStructureLevelDefinition = structureDefinition.levels[structureState.level];\n        const amount = levelDefinition.generates[resource as Resource];\n\n        return (\n            <span className=\"produced\">\n                <ReactMarkdown>\n                    {TextManager.get(\"ui-tooltip-resource-produce-row\", {\n                        structure,\n                        amount\n                    })}\n                </ReactMarkdown>\n            </span>\n        )\n    }\n\n    switch (resource) {\n        case Resource.fabric:\n        case Resource.food:\n        case Resource.iron:\n        case Resource.leather:\n        case Resource.stone:\n        case Resource.wood: {\n            const amount = formatNumber(resourcesState[resource] ?? 0, 0);\n            const full = (resourcesState[resource] ?? 0) >= (maxResources?.[resource] ?? 0);\n            return (\n                <div className=\"resource-context\">\n                    <div className=\"info\">\n                        {TextManager.get(`resource-${resource}-info`)}\n                    </div>\n                    <div>\n                        {TextManager.get(`ui-tooltip-resource-quantity`, { amount } )}\n                    </div>\n                    <div>\n                        {renderProducedBy()}\n                    </div>\n                    { full && (\n                        <div className=\"warning-full\">\n                            {TextManager.get(`ui-tooltip-resource-warehouse-full`, { resource })}\n                        </div>\n                    )}\n                </div>\n            )\n        }\n        case \"gold\": {\n            const amount = goldState;\n            return (\n                <>\n                    <div className=\"resource-context\">\n                        <div className=\"info\">\n                            {` ${TextManager.get(`resource-${resource}-info`)}`}\n                        </div>\n                    </div>\n                    <div>\n                        {TextManager.get(`ui-tooltip-resource-quantity`, { amount } )}\n                    </div>\n                </>\n            )\n        }\n        case \"workers\": {\n            const free = workersFreeState;\n            const total = workersState;\n            return (\n                <>\n                    <div className=\"resource-context\">\n                       <div className=\"info\">\n                        {` ${TextManager.get(`resource-${resource}-info`)}`}\n                        </div>\n                    </div>\n                    <div>\n                        {TextManager.get(`ui-tooltip-workers-quantity`, { free, total } )}\n                    </div>\n                </>\n            )\n        }\n        default:\n            throw new Error(\"Uknow value \" + resource);\n    }\n\n}\nexport default ResourceContext;","import React, { ComponentProps, PropsWithChildren } from 'react';\nimport './styles/infoWindow.scss';\n\nexport interface Props {\n    className?: string;\n}\n\n// An InfoWindow is a semi transparant black square. It is used for tooltips\n// and InfoModal\nexport const InfoWindow = (props: PropsWithChildren<Props> & ComponentProps<\"div\">) => {\n    const { className, children, ...otherProps } = props;\n    return (\n        <div\n            {...otherProps}\n            className={`info-window ${className || \"\"}`}\n        >\n            {children}\n        </div>\n    )\n}\n","import * as React from \"react\";\nimport * as PIXI from 'pixi.js';\nimport {AppContextProps} from \"hoc/withAppContext\";\nimport {useRef, useState, createContext, useEffect } from \"react\";\nimport {DndProvider } from \"react-dnd\";\nimport {HTML5Backend } from 'react-dnd-html5-backend';\nimport {Link, Redirect, Route, Switch, HashRouter} from \"react-router-dom\";\nimport {Persistor} from \"redux-persist\";\nimport {PixiPlugin } from 'gsap/all';\nimport {gsap } from 'gsap';\nimport {SoundManager} from \"global/SoundManager\";\nimport {TextManager} from \"global/TextManager\";\nimport debounce from \"debounce\";\nimport TownView from 'components/town/TownView';\nimport Toasts from 'components/ui/toasts/Toasts';\nimport Topbar from 'components/ui/topbar/Topbar';\nimport WorldView from 'components/world/WorldView';\nimport SimpleLog from 'components/log/SimpleLog';\nimport ContextTooltip from 'components/ui/tooltip/ContextTooltip';\nimport {TooltipManager } from 'global/TooltipManager';\nimport {getWorldLink, getTownLink } from 'utils/routing';\nimport { restartGame } from 'index';\nimport Button, { ButtonColor } from 'components/ui/buttons/Button';\nimport \"./styles/app.scss\";\n\nPixiPlugin.registerPIXI(PIXI);\ngsap.registerPlugin(PixiPlugin);\n\nexport enum View {\n    Town,\n    World,\n}\n\nexport interface Props {\n    persistor: Persistor;\n}\n\n\nexport const MAX_WIDTH = 960;\nexport const AppContext = createContext<AppContextProps | null>(null);\n\n\nconst App = (props: Props) => {\n    const containerRef = useRef<HTMLDivElement>(null);\n\n    const [activeWindows, setActiveWindows] = useState<React.ReactElement[]>([]);\n\n    const handleViewButtonClick = () => {\n        SoundManager.playSound(\"ui/buttonClick\");\n    };\n\n    const handleRestartClick = () => {\n        restartGame();\n\n    };\n\n    const renderTownView = () => <TownView />;\n    const renderWorldView = () => <WorldView />;\n\n    const handleWindowOpened = (window: React.ReactElement) => {\n        setActiveWindows([\n            ...activeWindows || [],\n            window,\n        ]);\n    };\n\n    /**\n     * Closes all windows\n     */\n    const handleWindowClose = () => {\n        setActiveWindows([]);\n    };\n\n    /**\n     * Closes the top window of the stack\n     */\n    const handleWindowBack = () => {\n        if (activeWindows && activeWindows.length) {\n            setActiveWindows(activeWindows.slice(0, -1));\n        }\n    };\n\n    const renderWindow = (): React.ReactElement | null => {\n        if (!activeWindows.length) {\n            return null;\n        }\n\n        const topWindow = activeWindows[activeWindows.length - 1];\n        const commonWindowProps = {\n            onClose: handleWindowClose,\n            onBack: handleWindowBack,\n            backEnabled: activeWindows.length > 1,\n            closeEnabled: true,\n        };\n\n        const element = React.cloneElement(topWindow, commonWindowProps);\n        return element;\n    };\n\n    useEffect(() => {\n        SoundManager.addSound(\"ui/buttonClick\", \"sound/ui/button-click.ogg\");\n        SoundManager.addSound(\"ui/equip\", \"sound/ui/equip.mp3\");\n        SoundManager.addSound(\"ui/error\", \"sound/ui/error.ogg\");\n        SoundManager.addSound(\"ui/levelUp\", \"sound/ui/level-up.ogg\");\n        SoundManager.addSound(\"ui/toast\", \"sound/ui/toast.ogg\");\n    }, []);\n\n    const handleAppClick = () => {\n        TooltipManager.clear();\n    };\n\n    useEffect(() => {\n        const handleScroll = debounce(() => {\n            TooltipManager.clear();\n        }, 100);\n        window.addEventListener(\"scroll\", handleScroll);\n        window.addEventListener(\"wheel\", handleScroll);\n        return () => {\n            window.removeEventListener(\"resize\", handleScroll);\n            window.removeEventListener(\"wheel\", handleScroll);\n        };\n    }, []);\n\n    return (\n        <AppContext.Provider value={{\n            onOpenWindow: handleWindowOpened,\n            onCloseWindow: handleWindowClose,\n        }} >\n            <div\n                className=\"app\"\n                ref={containerRef}\n                style={{\n                    maxWidth: MAX_WIDTH\n                }}\n                onClick={handleAppClick}\n            >\n                {/* <QuestRepaintTester /> */}\n                <DndProvider backend={HTML5Backend}>\n                <HashRouter>\n                    <Topbar persistor={props.persistor} />\n                    <div className=\"control-bar\">\n                        <Switch>\n                            <Route path=\"/\" exact={true} >\n                                <Redirect from=\"/\" to={getWorldLink()} />\n                            </Route>\n                            <Route path={getWorldLink()}>\n                                <Link to={getTownLink()}>\n                                    <Button onClick={() => handleViewButtonClick()} color=\"green\"> {TextManager.get(`ui-view-button-town`)} </Button>\n                                </Link>\n                            </Route>\n                            <Route path={getTownLink()}>\n                                <Link to={getWorldLink()}>\n                                    <Button onClick={() => handleViewButtonClick()}  > {TextManager.get(`ui-view-button-world`)} </Button>\n                                </Link>\n                            </Route>\n                        </Switch>\n                        {` | `}\n                        <Button onClick={() => handleRestartClick()} color={ButtonColor.purple} > Restart! </Button>\n                    </div>\n                    <Switch>\n                        <Route path={getTownLink()} render={renderTownView} />\n                        <Route path={getWorldLink()} render={renderWorldView} />\n                    </Switch>\n                    <SimpleLog/>\n                    {renderWindow()}\n                    <ContextTooltip />\n                    <Toasts />\n                </HashRouter>\n                </DndProvider>\n            </div>\n        </AppContext.Provider>\n    );\n};\n\nexport default App;\n","import * as React from \"react\";\nimport { TextManager } from 'global/TextManager';\nimport { TraitDefinition } from 'definitions/traits/types';\n import './styles/traitContext.scss';\n\nexport interface Props {\n    traitDefinition: TraitDefinition;\n}\n\nconst TraitContext = (props: Props) => {\n\n    const {traitDefinition} = props;\n\n    return (\n        <div className=\"trait-context\">\n            <div className=\"description\">\n                {TextManager.getTraitDescription(traitDefinition.trait)}\n            </div>\n            { traitDefinition.hasEffect && (\n            <div className=\"effect\">\n                {TextManager.getTraitEffect(traitDefinition.trait)}\n\n            </div>)}\n        </div>\n    )\n}\nexport default TraitContext;","import React, { ReactNode, useEffect, useState } from 'react';\nimport { ContextType } from 'constants/context';\nimport { TooltipManager, Context, EVENT_CONTEXT_UPDATED } from 'global/TooltipManager';\nimport { TextManager } from 'global/TextManager';\nimport ItemContext from './context/ItemContext';\nimport { Item, ItemDefinition } from 'definitions/items/types';\nimport { Resource } from 'definitions/resources';\nimport ResourceContext from './context/ResourceContext';\nimport Tooltip from '../Tooltip';\nimport { TraitDefinition } from 'definitions/traits/types';\nimport TraitContext from './context/TraitContext';\nimport { WeaponType } from 'definitions/items/weapons';\nimport { Rarity } from 'constants/items';\nimport { getDefinition } from 'definitions/items';\nimport './styles/contextTooltip.scss';\n\n// A contextual popup showing what you just clicked.\n// Can be an Item, Resource, Trait, skill\nconst ContextTooltip = () => {\n\n    const [selectedContext, setSelectedContext] = useState<Context | undefined>();\n\n    const tooltipUpdated = (context: Context | undefined) => {\n        setSelectedContext(context);\n    }\n    useEffect(() => {\n        TooltipManager.instance.addListener(EVENT_CONTEXT_UPDATED, tooltipUpdated);\n        return () => {\n            TooltipManager.instance.removeListener(EVENT_CONTEXT_UPDATED, tooltipUpdated);\n        }\n    }, []);\n    if (!selectedContext) { return null; }\n\n    const { info, type, className, source } = selectedContext;\n    const renderContent = () => {\n        switch (type) {\n            case ContextType.resource: {\n                const name = TextManager.getResourceName(info as Resource);\n                return (\n                    <>\n                        <div className=\"name resource\">{name}</div>\n                        <ResourceContext info={info as string} />\n                    </>\n                );\n            }\n            case ContextType.item: {\n                const item = info as Item;\n                const name = TextManager.getItemName(item);\n                const itemDefinition = getDefinition(item) as ItemDefinition;\n                return (\n                    <>\n                        <div className=\"header\">\n                            <div className={`name item ${getItemNameClassName(itemDefinition)}`}>{name}</div>\n                            <div className=\"secondary\">\n                                {TextManager.getItemType(itemDefinition.itemType)}\n                            </div>\n                        </div>\n                        <ItemContext item={item} source={source} />\n                    </>\n                );\n            }\n            case ContextType.trait: {\n                const traitDefinition = info as TraitDefinition;\n                const name = TextManager.getTraitName(traitDefinition.trait);\n                return (\n                    <>\n                        <div className=\"name trait\">\n                            {TextManager.get(\"ui-tooltip-type-trait\")}\n                            {name}\n                        </div>\n                        <TraitContext traitDefinition={traitDefinition} />\n                    </>\n                );\n            }\n            case ContextType.skill: {\n                const skill = info as WeaponType;\n                const name = TextManager.getSkillName(skill);\n                return (\n                    <>\n                        <div className=\"name skill\">\n                            {TextManager.get(\"ui-tooltip-type-skill\")}\n                            {name}\n                        </div>\n                        { TextManager.getSkillInfo(skill)}\n                    </>\n                );\n            }\n            case ContextType.component: {\n                const component = info as ReactNode;\n                return component;\n            }\n            default: {\n                throw new Error(`Unknown context type ${selectedContext.type}`)\n            }\n        }\n    }\n\n    return (\n        <Tooltip referenceRect={selectedContext.referenceRect} className={className}>\n            <div className=\"context-tooltip\">\n                {renderContent()}\n            </div>\n        </Tooltip>\n    )\n}\nexport default ContextTooltip;\n\nexport const getItemNameClassName = (item: ItemDefinition): string => {\n    const {rarity} = item;\n    switch (rarity) {\n        case Rarity.common:\n            return \"item-name-common\";\n        case Rarity.uncommon:\n            return \"item-name-uncommon\";\n        case Rarity.rare:\n            return \"item-name-rare\";\n        case Rarity.epic:\n            return \"item-name-epic\";\n        case Rarity.legendary:\n            return \"item-name-legendary\";\n    }\n    return \"item-name-common\";\n};\n","import seedrandom from \"seedrandom\";\n\nlet generator: seedrandom.prng;\nexport const init = (seed: string): void => {\n    dirty = true;\n    generator = seedrandom(seed, {state: true});\n}\n\nexport function random(): number {\n    if (!generator) { throw new Error(\"Call init() before random()\"); }\n    dirty = true;\n    return generator();\n}\n\n/**\n * Returns a random integer between min (inclusive) and max (inclusive).\n * The value is no lower than min (or the next integer greater than min\n * if min isn't an integer) and no greater than max (or the next integer\n * lower than max if max isn't an integer).\n */\nexport const randomInt = (min = 0, max = 10): number => {\n    min = Math.ceil(min);\n    max = Math.floor(max);\n    return Math.floor(random() * (max - min + 1)) + min;\n}\n\nexport const state = (): seedrandom.State => {\n    dirty = false;\n    return generator.state();\n}\n\nexport let dirty = false;\n","import { RESOURCE_INTERVAL } from 'constants/resources';\r\nimport { Resource } from 'definitions/resources';\r\nimport { getDefinition, Structure } from \"definitions/structures\";\r\nimport { ResourceStructureDefinition, ResourceStructureLevelDefinition, StructureType } from \"definitions/structures/types\";\r\nimport { getTimeMultiplier, TimeType } from 'mechanics/time';\r\nimport { selectMaxResources } from 'store/selectors/resources';\r\nimport { StoreState } from \"store/types\";\r\nimport { ResourceStoreState } from \"store/types/resources\";\r\nimport { StructuresStoreState } from \"store/types/structures\";\r\n\r\n\r\n /*\r\n  * Calculates how many resources are generated by the in the town.\r\n  * Will return a ResourceStoreState with the amount of each resource to add  */\r\nconst getProducedResources = (lastProducedUpdate: number, store: StoreState): ResourceStoreState|null => {\r\n    const structures: StructuresStoreState = store.structures;\r\n    const result: ResourceStoreState = {};\r\n    const timeMultiplier = getTimeMultiplier(TimeType.resourceGeneration);\r\n\r\n    // this function can run at different intervals\r\n    // faster or slower than once a minute\r\n    // we will multiply the resource amount by the factor to normalize\r\n    const factor = ((Date.now() - lastProducedUpdate) / (RESOURCE_INTERVAL / timeMultiplier));\r\n    const maxResources = selectMaxResources(store);\r\n\r\n    const handleStructure = (structure: string) => {\r\n        const structureDefinition = getDefinition(structure as Structure);\r\n\r\n        if (structureDefinition.type === StructureType.resource) {\r\n            const resourceStructureDefinition = structureDefinition as ResourceStructureDefinition;\r\n            const level: number = structures[structure as Structure].level;\r\n            const levelDefinition: ResourceStructureLevelDefinition = resourceStructureDefinition.levels[level];\r\n\r\n            // Store all the resources that this structure will generate this tick into `result`\r\n            Object.keys(levelDefinition.generates).reduce((accumulator: ResourceStoreState, key: string) => {\r\n                const resource = key as Resource;\r\n\r\n                const amount: number = levelDefinition.generates[resource]! * structures[structure as Structure].workers * factor;\r\n                accumulator[resource] = (accumulator[resource] || 0) + amount;\r\n                return accumulator;\r\n            }, result);\r\n        }\r\n    };\r\n\r\n    if (factor < 1) {\r\n        return null;\r\n    }\r\n    // Calculate what each structure generates. Stores in `result`.\r\n    Object.keys(structures).forEach((structure) => handleStructure(structure));\r\n\r\n    // Check if the warehouse can actually hold it\r\n    Object.keys(result).forEach((key: string) => {\r\n        const resource = key as Resource;\r\n        if (result[resource]) {\r\n            if (store.resources[resource]! + result[resource]! >= maxResources[resource]!) {\r\n                result[resource] = maxResources[resource]! - (store.resources[resource]!);\r\n            }\r\n        }\r\n        // console.log(`Adding: ${resource} ${result[resource]} factor ${factor}`);\r\n    });\r\n\r\n    return result;\r\n};\r\n\r\n\r\nexport default getProducedResources;\r\n","import { TextEntry } from \"constants/text\";\nimport { getDefinition } from \"definitions/quests\";\nimport { QuestDefinition, QuestNodeType } from 'definitions/quests/types';\n\nimport { Store } from \"redux\";\nimport { StoreState } from \"store/types\";\nimport { LogChannel } from \"store/types/logEntry\";\nimport { QuestStatus, QuestStoreState } from \"store/types/quest\";\nimport { ToastManager } from 'global/ToastManager';\nimport { TextManager } from 'global/TextManager';\nimport { Type } from 'components/ui/toasts/Toast';\nimport { getQuestLink } from 'utils/routing';\nimport { setSceneName } from 'store/actions/quests';\nimport { getQuestLeader } from 'store/helpers/storeHelpers';\nimport { getTimeMultiplier, TimeType } from 'mechanics/time';\n\nexport interface QuestUpdate {\n    name: string;\n    progress: number;\n}\n\nexport interface LogUpdate extends TextEntry {\n    key: string;\n    channel: LogChannel;\n    channelContext?: string;\n}\n\ninterface QuestGameTickResponse {\n    questUpdates: QuestUpdate[];\n    logUpdates: LogUpdate[];\n}\n\nconst getQuestUpdates = (delta: number, store: Store<StoreState>): QuestGameTickResponse => {\n\n    const speed = 4;    // in nodes per minute\n    const timeMultiplier = getTimeMultiplier(TimeType.questProgress);\n    const MS_PER_MINUTE = 60000;\n    const log: LogUpdate[] = [];\n    const quests: QuestUpdate[] = [];\n    const state: StoreState = store.getState();\n    // Moves the quest line progress. Only if currently at a 'nothing' node\n    // Otherwise the player has to do something to move the quest along\n    state.quests.forEach((quest: QuestStoreState) => {\n        if (quest.status !== QuestStatus.active) {\n            return;\n        }\n        const questDefinition: QuestDefinition = getDefinition(quest.name);\n        const currentProgress = quest.progress;\n        const currentNodeIndex = Math.floor(currentProgress);\n        const currentNode = questDefinition.nodes[currentNodeIndex];\n        if (currentNode.type === QuestNodeType.nothing) {\n            // Currently at a 'nothing' node\n            const progressIncrease = (delta / (MS_PER_MINUTE / timeMultiplier)) * speed;\n            // todo: [15/07/2019] speed could be different for each party\n            let nextProgress = Math.min(currentProgress + progressIncrease, questDefinition.nodes.length - 1);\n            const nodesPassed = Math.floor(nextProgress) - currentNodeIndex;\n            for (let i = 1; i <= nodesPassed; i++) {\n                // Loop through all the nodes we've passed since last tick\n                const nextNode = questDefinition.nodes[currentNodeIndex + i];\n                if (nextNode.type === QuestNodeType.encounter) {\n                    // We've hit an encounter node. set the progress to here and stop looking at other nodes\n\n                    store.dispatch(setSceneName(quest.name, nextNode.startScene));\n\n                    const questTitle = TextManager.getQuestTitle(quest.name);\n                    const leader = getQuestLeader(state.adventurers, quest);\n                    ToastManager.addToast(questTitle, Type.questEncounter, leader?.avatarImg, getQuestLink(quest.name));\n\n                    // Add quest to log\n                    if (nextNode.log) {\n                        log.push({\n                            channel: LogChannel.quest,\n                            channelContext: quest.name,\n                            key: nextNode.log,\n                        });\n                    }\n                    // Dont overshoot the encounter node\n                    nextProgress = currentProgress + i;\n\n                    break;\n                } else if (nextNode.type === QuestNodeType.nothing) {\n                    if (nextNode.log) {\n                        log.push({\n                            channel: LogChannel.quest,\n                            channelContext: quest.name,\n                            key: nextNode.log,\n                        });\n                    }\n                }\n            }\n            quests.push({\n                name: quest.name,\n                progress: nextProgress,\n            });\n        }\n    });\n    return {\n        logUpdates: log,\n        questUpdates: quests,\n    };\n};\n\nexport default getQuestUpdates;\n","import { State as seedrandomStateType } from \"seedrandom\";\nimport * as Random from \"utils/random\";\n\nconst getRngState = (): seedrandomStateType | null => {\n    if (Random.dirty) {\n        return Random.state();\n    }\n    return null;\n};\n\nexport default getRngState;\n","// In production, we register a service worker to serve assets from local cache.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on the 'N+1' visit to a page, since previously\n// cached resources are updated in the background.\n\n// To learn more about the benefits of this model, read https://goo.gl/KwvDNy.\n// This link also includes instructions on opting out of this behavior.\n\nconst isLocalhost = Boolean(\n  window.location.hostname === \"localhost\" ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === \"[::1]\" ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/,\n    ),\n);\n\nexport default function register() {\n  if (process.env.NODE_ENV === \"production\" && \"serviceWorker\" in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL!,\n      window.location.toString(),\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebookincubator/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener(\"load\", () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Lets check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            \"This web app is being served cache-first by a service \" +\n              \"worker. To learn more, visit https://goo.gl/SC7cgQ\",\n          );\n        });\n      } else {\n        // Is not local host. Just register service worker\n        registerValidSW(swUrl);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then((registration) => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker) {\n          installingWorker.onstatechange = () => {\n            if (installingWorker.state === \"installed\") {\n              if (navigator.serviceWorker.controller) {\n                // At this point, the old content will have been purged and\n                // the fresh content will have been added to the cache.\n                // It's the perfect time to display a 'New content is\n                // available; please refresh.' message in your web app.\n                console.log(\"New content is available; please refresh.\");\n              } else {\n                // At this point, everything has been precached.\n                // It's the perfect time to display a\n                // 'Content is cached for offline use.' message.\n                console.log(\"Content is cached for offline use.\");\n              }\n            }\n          };\n        }\n      };\n    })\n    .catch((error) => {\n      console.error(\"Error during service worker registration:\", error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then((response) => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      if (\n        response.status === 404 ||\n        response.headers.get(\"content-type\")!.indexOf(\"javascript\") === -1\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then((registration) => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl);\n      }\n    })\n    .catch(() => {\n      console.log(\n        \"No internet connection found. App is running in offline mode.\",\n      );\n    });\n}\n\nexport function unregister() {\n  if (\"serviceWorker\" in navigator) {\n    navigator.serviceWorker.ready.then((registration) => {\n      registration.unregister();\n    });\n  }\n}\n","import * as React from \"react\";\r\nimport * as ReactDOM from \"react-dom\";\r\nimport { Provider } from \"react-redux\";\r\nimport { Store, AnyAction, DeepPartial } from \"redux\";\r\nimport { Persistor } from \"redux-persist\";\r\nimport localforage from 'localforage';\r\nimport { gameTick, startGame } from \"store/actions/game\";\r\nimport { addLogText } from \"store/actions/log\";\r\nimport version from \"./constants/version\";\r\nimport updateCombat from \"mechanics/gameTick/combat\";\r\nimport App from \"./components/App\";\r\nimport getProducedResources from \"./mechanics/gameTick/producedResources\";\r\nimport getQuestUpdates, { LogUpdate } from \"./mechanics/gameTick/quests\";\r\nimport getRngState from \"./mechanics/gameTick/rngState\";\r\nimport registerServiceWorker from \"./registerServiceWorker\";\r\nimport configureStore from \"./utils/configureStore\";\r\nimport * as Random from \"./utils/random\";\r\nimport { TextManager } from \"./global/TextManager\";\r\nimport { loadResourceAsync } from 'utils/pixiJs';\r\nimport { processCompletedTasks } from 'mechanics/gameTick/tasks';\r\nimport { StoreState } from 'store/types';\r\nimport { getWorldLink } from \"utils/routing\";\r\nimport { createInitialStore } from \"store/reducers\";\r\nimport getHarvest from \"mechanics/gameTick/harvest\";\r\nimport \"./index.css\";\r\n\r\nconst TICK_INTERVAL = 2500;\r\nlet persistor: Persistor;\r\n\r\nconst initGame = async () => {\r\n    const texts = await loadResourceAsync(`${process.env.PUBLIC_URL}/lang/en.json`);\r\n    if (texts) {\r\n        TextManager.init(texts.data);\r\n    }\r\n    Random.init(\"GILLESROX2\");\r\n\r\n    setupStore();\r\n};\r\n\r\n/**\r\n * Attemps to read persisted store state. Calls `runGame`\r\n */\r\nconst setupStore = async (initial: DeepPartial<StoreState> = {}) => {\r\n    const storeConfiguration = await configureStore(initial);\r\n    const { store, isHydrated } = storeConfiguration;\r\n    persistor = storeConfiguration.persistor;\r\n\r\n    if (!isHydrated) {\r\n        startNewGame(store);\r\n    } else {\r\n        continueGame();\r\n    }\r\n    runGame(store);\r\n}\r\n\r\n/**\r\n * Gets called when a player starts a new game\r\n * @param store\r\n */\r\nconst startNewGame = (store: Store<StoreState, AnyAction>) => {\r\n    store.dispatch(startGame());\r\n    store.dispatch(addLogText(\"test-game-welcome\"));\r\n    // todo: here is a good place to launch a tutorial or something\r\n\r\n    console.log(`Starting new GAME (version ${version})`);\r\n};\r\n\r\n\r\n/**\r\n * Continue playing earlier persisted store\r\n * @param store\r\n */\r\nconst continueGame = () => {\r\n    console.log(`Continuing existing GAME (version ${version})`);\r\n};\r\n\r\n/**\r\n * Loads a saved game from a file\r\n */\r\nconst loadGame = async (state: StoreState) => {\r\n    // todo: implement in MenuWindow!\r\n    await persistor.purge();\r\n    const { store } = await configureStore(state);\r\n    runGame(store);\r\n\r\n    // We have to cause the page to reinitialize and all react components to remount\r\n    // eslint-disable-next-line no-restricted-globals\r\n    location.href = `#${getWorldLink()}`; // todo: load path from metadata '#/world/kill10Boars';\r\n}\r\n\r\nconst restartGame = () => {\r\n    // eslint-disable-next-line no-restricted-globals\r\n    if(confirm('Are you sure you wish to reset all your progress?')){\r\n        clearTimeout(interval);\r\n        persistor.purge();\r\n        localforage.clear();\r\n\r\n        setupStore(createInitialStore());\r\n        // eslint-disable-next-line no-restricted-globals\r\n        location.reload();\r\n        // location.href = `#${getTownLink()}`;\r\n        console.clear();\r\n    }\r\n}\r\n\r\n\r\nlet interval: NodeJS.Timeout;\r\nconst runGame = (store: Store<StoreState, AnyAction>) => {\r\n    clearTimeout(interval);\r\n\r\n    ReactDOM.render((\r\n        <Provider store={store}>\r\n            <App persistor={persistor} />\r\n        </Provider>\r\n        ),\r\n        document.getElementById(\"root\") as HTMLElement,\r\n    );\r\n    registerServiceWorker();\r\n\r\n    const gameLoop = () => {\r\n        const state: StoreState = store.getState();\r\n        const delta = Date.now() - state.engine.lastTick;\r\n\r\n        const logs: LogUpdate[] = [];\r\n        const resourcesUpdates = getProducedResources(state.engine.lastProducedUpdate, state);\r\n        const harvestUpdates = getHarvest(state);\r\n        const rngState = getRngState();\r\n        updateCombat(delta, store);\r\n        const { questUpdates, logUpdates } = getQuestUpdates(delta, store);\r\n        logs.push(...logUpdates);\r\n\r\n        store.dispatch(gameTick(delta, rngState, resourcesUpdates, questUpdates, harvestUpdates, logs));\r\n\r\n        processCompletedTasks(state.tasks, store.dispatch);\r\n    };\r\n\r\n    interval = setInterval(gameLoop, TICK_INTERVAL);\r\n};\r\nexport {runGame, restartGame, loadGame};\r\n\r\ninitGame();\r\n","import { AdventurerAction } from \"store/actions/adventurers\";\nimport { EquipmentSlotType } from \"components/ui/adventurer/EquipmentSlot\";\nimport { Reducer } from \"redux\";\nimport { AdventurerColor, AdventurerStoreState, BasicAttributesStoreState } from \"store/types/adventurer\";\nimport { Trait } from 'definitions/traits/types';\nimport { WeaponType } from 'definitions/items/weapons';\nimport { levelToXp } from \"mechanics/adventurers/levels\";\nimport { Action } from \"store/actions\";\nimport { getDefinition, isPotion } from \"definitions/items/potions\";\n\n/**\n * reducer\n * @param state\n * @param action\n */\nconst generateRandomAttributes = (): BasicAttributesStoreState => {\n    return {\n        strength: Math.floor(Math.random() * 3) + 9,\n        dexterity: Math.floor(Math.random() * 3) + 9,\n        intelligence: Math.floor(Math.random() * 3) + 9,\n        health: Math.floor(Math.random() * 3) + 9\n    };\n};\n\nconst avatarImgBasePath = \"/img/avatars\";\nconst spritesheetBasePath = \"img/scene/actors/\";\n\n// offHand]: Item.indomitableCarapace\n\n// Create a bunch of guys for debugging\nexport const initialAdventurers: AdventurerStoreState[] = [{\n    id: \"c4a5d270\",\n    equipment: {\n        [EquipmentSlotType.head]: \"apparel/cowl\",\n        [EquipmentSlotType.chest]: \"apparel/chest\",\n        [EquipmentSlotType.hands]: \"apparel/clothGloves\",\n        [EquipmentSlotType.shoulders]: \"apparel/shoulders2\",\n        [EquipmentSlotType.legs]: \"apparel/pants2\",\n        [EquipmentSlotType.feet]: \"apparel/boots3\"\n        // offHand: Item.indomitableCarapace\n    },\n    basicAttributes: generateRandomAttributes(),\n    health: Math.random() * 100,\n    xp: levelToXp(1),\n    baseAP: 6,\n    room: 0,\n    name: \"Ximena Maddox\",\n    traits: [Trait.houseMaddox, Trait.gloomy],\n    avatarImg: `${avatarImgBasePath}/female/f_14.png`,\n    spritesheetPath: `${spritesheetBasePath}elf-bow.json`,\n    color: AdventurerColor.purple,\n    skills: {\n        [WeaponType.crossbow]: 10,\n        [WeaponType.bow]: 10\n    },\n    inventory: [ \"deed/lumbermill\", null, \"weapon/simpleCrossbow\", \"weapon/dagger\", \"weapon/khopesh\", null, \"weapon/steelSword\", null,  \"potion/greaterMana\",  \"potion/majorHealth\",  null,  \"weapon/steelShield\",  null,  null,  null,  null],\n}, {\n    id: \"2e655832\",\n    equipment: {\n        [EquipmentSlotType.feet]: \"apparel/boots2\"\n    },\n    basicAttributes: generateRandomAttributes(),\n    name: \"Donte Houston\",\n    health: Math.random() * 100,\n    xp: Math.random() * 100,\n    baseAP: 6,\n    room: 1,\n    avatarImg: `${avatarImgBasePath}/male/m_05.png`,\n    spritesheetPath: `${spritesheetBasePath}elf-bow.json`,\n    color: AdventurerColor.teal,\n    traits: [Trait.houseHouston],\n    skills: {\n        [WeaponType.crossbow]: 12,\n        [WeaponType.staff]: 13\n    },\n    inventory: [ \"weapon/simpleCrossbow\", null, null, null, null, \"apparel/boots1\", \"apparel/chainmailHood\", \"apparel/nomadHelmet\", \"apparel/plateChest4\", null, \"weapon/buckler\", null, null, null,  null,  null,  null,  null,  null,  null,  null,  null, \"apparel/plateHelmet\", \"apparel/cowl\"],\n}, {\n    id: \"ec6f1050\",\n    equipment: {\n        [EquipmentSlotType.feet]: \"apparel/boots3\"\n        // offHand: Item.aegisOfValor\n    },\n    basicAttributes: generateRandomAttributes(),\n    name: \"Zackary \\\"bone bag\\\" Morris\",\n    health: Math.random() * 100,\n    xp: Math.random() * 100,\n    baseAP: 5,\n    room: 2,\n    traits: [Trait.gloomy],\n    skills: {\n        [WeaponType.sword]: 12,\n        [WeaponType.hammer]: 6\n    },\n    avatarImg: `${avatarImgBasePath}/male/m_09.png`,\n    spritesheetPath: `${spritesheetBasePath}skeleton.json`,\n    color: AdventurerColor.black,\n    inventory: [ \"weapon/greatswordOfGwai\", null, null, null, \"weapon/berserkerShield\" ],\n}, {\n    id: \"d299f98a\",\n    basicAttributes: generateRandomAttributes(),\n    equipment: {},\n    name: \"Mike Keith\",\n    health: Math.random() * 100,\n    xp: Math.random() * 100,\n    baseAP: 6,\n    room: 4,\n    avatarImg: `${avatarImgBasePath}/male/m_19.png`,\n    spritesheetPath: `${spritesheetBasePath}knight-sword.json`,\n    traits: [Trait.arrowFinder],\n    skills: {\n        [WeaponType.sword]: 13\n    },\n    inventory: [ null, null, null, null, \"weapon/khopesh\", \"apparel/hornedHelmet\", \"weapon/woodenBulwark\" ],\n}, {\n    id: \"96c686c3\",\n    equipment: {},\n    basicAttributes: generateRandomAttributes(),\n    name: \"Wayne Monroe\",\n    health: Math.random() * 100,\n    xp: Math.random() * 100,\n    baseAP: 4,\n    room: 5,\n    avatarImg: `${avatarImgBasePath}/male/m_08.png`,\n    spritesheetPath: `${spritesheetBasePath}orc-axe.json`,\n    traits: [Trait.houseMonroe, Trait.arrowFinder],\n    skills: {\n        [WeaponType.axe]: 12\n    },\n    inventory: [ null, null, null, \"weapon/goldenShield\" ],\n}, {\n    id: \"250d1a9d\",\n    basicAttributes: generateRandomAttributes(),\n    equipment: {},\n    name: \"Alexis Ortiz \",\n    health: Math.random() * 100,\n    xp: Math.random() * 100,\n    baseAP: 5,\n    room: 9,\n    avatarImg: `${avatarImgBasePath}/female/f_10.png`,\n    spritesheetPath: `${spritesheetBasePath}knight-sword.json`,\n    inventory: [ null, null, null, null, null ],\n    skills: {\n        [WeaponType.axe]: 10\n    },\n}, {\n    id: \"169384ef\",\n    equipment: {},\n    basicAttributes: generateRandomAttributes(),\n    name: \"Karlee Nolan\",\n    health: Math.random() * 100,\n    xp: Math.random() * 100,\n    baseAP: 5,\n    room: 3,\n    avatarImg: `${avatarImgBasePath}/female/f_16.png`,\n    spritesheetPath: `${spritesheetBasePath}troll-sword.json`,\n    inventory: [ \"weapon/greatswordOfGwai\", null, null, null ],\n    skills: {\n        [WeaponType.axe]: 10\n    },\n}, {\n    id: \"f22d66cb\",\n    basicAttributes: generateRandomAttributes(),\n    equipment: {},\n    name: \"Gylbarde the Earnest\",\n    health: Math.random() * 100,\n    xp: Math.random() * 100,\n    baseAP: 5,\n    room: 8,\n    avatarImg: `${avatarImgBasePath}/male/m_09.png`,\n    spritesheetPath: `${spritesheetBasePath}knight-sword.json`,\n    inventory: [ null, null, null, null, null ],\n    skills: {\n        [WeaponType.axe]: 13\n    },\n}, {\n    id: \"36c686c1\",\n    equipment: {},\n    basicAttributes: generateRandomAttributes(),\n    name: \"Lanslet of the Water\",\n    health: Math.random() * 100,\n    xp: Math.random() * 100,\n    baseAP: 6,\n\n    room: 6,\n    avatarImg: `${avatarImgBasePath}/male/m_26.png`,\n    spritesheetPath: `${spritesheetBasePath}knight-sword.json`,\n    inventory: [ \"weapon/greatswordOfGwai\", null, null, null, \"apparel/shoulders1\", \"apparel/fedora\", \"apparel/greaves2\" ],\n    skills: {\n        [WeaponType.axe]: 3\n    },\n}, {\n    id: \"12c613d4\",\n    equipment: {},\n    basicAttributes: generateRandomAttributes(),\n    name: \"Tedric the Bold\",\n    health: Math.random() * 100,\n    xp: Math.random() * 100,\n    baseAP: 6,\n    room: 7,\n    avatarImg: `${avatarImgBasePath}/male/m_33.png`,\n    spritesheetPath: `${spritesheetBasePath}knight-sword.json`,\n    inventory: [ \"weapon/greatswordOfGwai\", null, null, null ],\n    skills: {\n        [WeaponType.axe]: 10\n    },\n}];\n\n// TODO: To generate a random 11 digit number, use: Math.random().toString(36).substring(2)\n\nexport const adventurers: Reducer<AdventurerStoreState[], AdventurerAction> = (state: AdventurerStoreState[] = initialAdventurers, action: Action) => {\n\n    switch (action.type) {\n        // Moves an  item from one inventory slot to another\n        case \"drinkPotion\": {\n            const { adventurerId, fromSlot } = action;\n            const adventurer = state.find((a) => a.id === adventurerId);\n            if (!adventurer) {\n                throw new Error(`No adventurer ${adventurerId} found`)\n            }\n            const potion = adventurer.inventory[fromSlot];\n            if (!potion || !isPotion(potion)) {\n                throw new Error(`No potion found at index ${fromSlot} `)\n            }\n            const definition = getDefinition(potion);\n            switch (definition.category) {\n                case \"health\":\n                    console.log(`${adventurer.name} drinks a health potion`);\n                    break;\n                case \"soma\":\n                    console.log(`${adventurer.name} drinks a soma potion`);\n                    break;                \n                case \"mana\":\n                    console.log(`${adventurer.name} drinks a mana potion`);\n                    break;\n            }\n            const inventory = adventurer.inventory.map((element, index) => index !== fromSlot ? element : null);\n\n            return state.map((element: AdventurerStoreState) => {\n                if (element === adventurer) {\n                    return {\n                        ...element,\n                        inventory,\n                    };\n                }\n                return element;\n            });\n        }\n        // Moves an  item from one inventory slot to another\n        case \"moveItemInInventory\": {\n            const { adventurerId, fromSlot, toSlot } = action;\n            const adventurer = state.find((a) => a.id === adventurerId);\n            if (!adventurer) {\n                throw new Error(`No adventurer ${adventurerId} found`)\n            }\n            const inventory = adventurer.inventory.map((element, index) => {\n                if (index === fromSlot) { return adventurer.inventory[toSlot]; }\n                if (index === toSlot) { return adventurer.inventory[fromSlot]; }\n                return element;\n            });\n\n            return state.map((element: AdventurerStoreState) => {\n                if (element === adventurer) {\n                    return {\n                        ...element,\n                        inventory,\n                    };\n                }\n                return element;\n            });\n        }\n\n        case \"moveItemToOtherAdventurer\": {\n            // Moves an item from one adventurer to another\n            const { adventurerId: fromAdventurerId, fromSlot, toAdventurerId } = action;\n            const fromAdventurer = state.find((a) => a.id === fromAdventurerId);\n            if (!fromAdventurer) return state\n            const item = fromAdventurer.inventory[fromSlot];\n\n            return state.map((element: AdventurerStoreState) => {\n                if (element.id === fromAdventurerId) {\n                    // Clear out the item from this adventurer\n                    const inventory = element.inventory.concat();\n                    inventory[fromSlot] = null;\n                    return {\n                        ...element,\n                        inventory,\n                    };\n                } else if (element.id === toAdventurerId) {\n                    // Find first empty slot, add there\n                    const inventory = element.inventory.concat();\n                    const index = inventory.findIndex((slot) => slot === null);\n                    inventory[index] = item;\n                    // todo: what if there is no room?\n                    return {\n                        ...element,\n                        inventory,\n                    };\n                }\n                return element;\n            });\n        }\n\n        case \"addItemToInventory\": {\n            const { item } = action;\n            let { toSlot } = action;\n\n            return state.map((element: AdventurerStoreState) => {\n                if (element.id === action.adventurerId) {\n                    const inventory = element.inventory.concat();\n                    if (toSlot === null || toSlot === undefined) {\n                        toSlot = inventory.findIndex((val) => (val === null || val === undefined));\n                    }\n                    inventory[toSlot] = item;\n                    // todo: check if no space\n                    return {\n                        ...element,\n                        inventory,\n                    };\n                }\n                return element;\n            });\n        }\n\n        case \"removeItemFromInventory\": {\n            const { fromSlot } = action;\n\n            return state.map((adventurer: AdventurerStoreState) => {\n                if (adventurer.id === action.adventurerId) {\n                    const inventory = adventurer.inventory.map((element, index) => index !== fromSlot ? element : null);\n                    return {\n                        ...adventurer,\n                        inventory,\n                    };\n                }\n                return adventurer;\n            });\n        }\n\n        case \"assignEquipment\": {\n            // Assigns equipment to an adventurer\n            const { equipmentSlot, item, } = action;\n            return state.map((adventurer: AdventurerStoreState) => {\n                if (adventurer.id === action.adventurerId) {\n                    return {\n                        ...adventurer,\n                        equipment: {\n                            ...adventurer.equipment,\n                            [equipmentSlot]: item,\n                        },\n                    };\n                }\n                return adventurer;\n            });\n        }\n\n        case \"removeEquipment\": {\n            // Assigns equipment to an adventurer\n            const { equipmentSlot } = action;\n\n            return state.map((adventurer: AdventurerStoreState) => {\n                if (adventurer.id === action.adventurerId) {\n                    return {\n                        ...adventurer,\n                        equipment: {\n                            ...adventurer.equipment,\n                            [equipmentSlot]: null,\n                        },\n                    };\n                }\n                return adventurer;\n            });\n        }\n        case \"renameAdventurer\": {\n            // Rename adventurer\n            const { name } = action;\n            return state.map((adventurer: AdventurerStoreState) => {\n                if (adventurer.id === action.adventurerId) {\n                    return {\n                        ...adventurer,\n                        name\n                    };\n                }\n                return adventurer;\n            });\n        }\n        case \"addXP\": {\n            // Adds xp\n            const { xp } = action;\n            return state.map((adventurer: AdventurerStoreState) => {\n                if (adventurer.id === action.adventurerId) {\n                    return {\n                        ...adventurer,\n                        xp: adventurer.xp + xp\n                    };\n                }\n                return adventurer;\n            });\n        }\n\n    }\n    return state\n    // debug: this will auto-increase the levels of every adventurer at every tick\n    // return state.map((adventurer: AdventurerStoreState) => {\n    //     return {\n    //         ...adventurer,\n    //         xp: adventurer.xp + 1\n    //     };\n    // });\n};\n","import { Reducer } from \"redux\";\r\nimport { EngineStoreState } from \"store/types/engine\";\r\nimport { Action } from \"store/actions\";\r\nimport { formatDuration } from \"utils/format/time\";\r\nimport { HARVEST_INTERVAL } from \"mechanics/gameTick/harvest\";\r\n\r\n/**\r\n * reducer\r\n * @param state\r\n * @param action\r\n */\r\nexport const engine: Reducer<EngineStoreState> = (state: EngineStoreState = getInitialEngineState(), action: Action) => {\r\n    switch (action.type) {\r\n        case \"startGame\": {\r\n            return {\r\n                ...state,\r\n                gameStarted: Date.now()\r\n            };\r\n        }\r\n        case \"gameTick\": {\r\n\r\n            // Keep track of the last time resources were produced\r\n            const resourcesToAdd = action.resources;\r\n            const lastProducedUpdate = resourcesToAdd === null ? state.lastProducedUpdate : Date.now();\r\n\r\n            // Keep track of last harvest\r\n            const lastHarvest = action.harvest === null || !Object.keys(action.harvest).length ? state.lastHarvest : Date.now();\r\n\r\n            const previousTick = state.lastTick;\r\n\r\n            return {\r\n                ...state,\r\n                previousTick,\r\n                lastProducedUpdate,\r\n                lastTick: Date.now(),\r\n                lastHarvest\r\n            };\r\n        }\r\n\r\n        case \"reduceTime\": {\r\n            console.log(action.percentage)\r\n            if (action.percentage < 0 || action.percentage > 100) return state;\r\n            switch (action.time) { \r\n                case \"harvest\": {\r\n                    const timeLeft = HARVEST_INTERVAL - (Date.now() - state.lastHarvest);\r\n\r\n                    console.log('time left', formatDuration(timeLeft));\r\n                    const delta = timeLeft * (action.percentage / 100);\r\n                    console.log('delta', formatDuration(delta));\r\n                    return {\r\n                        ...state,\r\n                        lastHarvest: state.lastHarvest - delta\r\n                    }\r\n                }\r\n            }\r\n            return state;\r\n        }\r\n    }\r\n    return state;\r\n};\r\n\r\nexport const getInitialEngineState = () => {\r\n    return {\r\n        gameStarted: undefined,\r\n        previousTick: Date.now(),\r\n        lastTick: Date.now(),\r\n        lastProducedUpdate: Date.now(),\r\n        lastHarvest: Date.now()\r\n    }\r\n};\r\n","import { GoldAction } from \"store/actions/gold\";\nimport { Reducer } from \"redux\";\nimport { Action } from \"store/actions\";\n\n/**\n * reducer\n * @param state\n * @param action\n */\nexport const gold: Reducer<number, GoldAction> = (state: number = initialGoldState, action: Action) => {\n    switch (action.type) {\n        case \"addGold\":\n            // Adds (or subtract, if negative) gold from the players gold supply\n            return state + action.amount;\n    }\n    return state;\n};\n\nexport const initialGoldState = 40;","\r\nimport { StockpileAction } from \"store/actions/stockpile\";\r\nimport { Reducer } from \"redux\";\r\nimport { Item, ItemType } from \"definitions/items/types\";\r\nimport allItems, { getAllItemsByType } from \"definitions/items\";\r\nimport { StockpileStoreState } from \"store/types/stockpile\";\r\nimport { getDefinition } from \"definitions/structures\";\r\nimport { getDefinition as getItemDefinition } from \"definitions/items\";\r\nimport { WarehouseStructureDefinition } from \"definitions/structures/types\";\r\n\r\n// Items in warehouse\r\nexport const getInitialStockpile = (): StockpileStoreState => {\r\n    // Generate some random stuff\r\n    const result: StockpileStoreState = {\r\n        \"apparel\": [],\r\n        \"deed\": [],\r\n        \"herb\": [],\r\n        \"material\": [],\r\n        \"mineral\": [],\r\n        \"potion\": [],\r\n        \"questItem\": [],\r\n        \"trinket\": [],\r\n        \"weapon\": [],\r\n    };\r\n    const { maxStockpile } = getDefinition<WarehouseStructureDefinition>(\"warehouse\").levels[0];\r\n    Object.keys(result).forEach((itemTypeName: string) => {\r\n        const itemType = ItemType[itemTypeName as keyof typeof ItemType];\r\n        for (let i = 0; i < maxStockpile; i++) {\r\n            if (Math.random() < .5) {\r\n                result[itemTypeName as keyof typeof result].push(null)\r\n            } else {\r\n                const randomItem = getRandomItemOfType(itemType);\r\n                result[itemTypeName as keyof typeof result].push(randomItem);\r\n            }\r\n        }\r\n    })\r\n    return result;\r\n}\r\n\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nconst getRandomItem = (): Item => {\r\n    const all = Object.keys(allItems)\r\n    const randomIndex = Math.floor(Math.random() * all.length);\r\n    return all[randomIndex] as Item; \r\n}\r\n\r\nconst getRandomItemOfType = (itemType: ItemType): Item => {\r\n    const all = getAllItemsByType(itemType)\r\n    const randomIndex = Math.floor(Math.random() * all.length);\r\n    return all[randomIndex] as Item; \r\n}\r\n\r\n/**\r\n * reducer\r\n * @param state\r\n * @param action\r\n */\r\nexport const stockpile: Reducer<StockpileStoreState, StockpileAction> = (state = getInitialStockpile(), action: StockpileAction) => {\r\n    switch (action.type) {\r\n        case \"addItem\": {\r\n            const definition = getItemDefinition(action.item)\r\n            // toSlot is optional\r\n            const { item } = action;\r\n            let { toSlot } = (action);\r\n            const stockpileCategory = ItemType[definition.itemType] as keyof StockpileStoreState\r\n\r\n            if (toSlot === undefined) {\r\n                toSlot = state[stockpileCategory].findIndex((slot) => slot === null);  // find first empty element\r\n                if (toSlot === -1) {\r\n                    // Still not found. Add at end\r\n                    // todo: [07/07/2019] GAME DESIGN\r\n                    return {\r\n                        ...state,\r\n                        [stockpileCategory]: [\r\n                            ...state[stockpileCategory],\r\n                            item\r\n                        ]\r\n                    };\r\n                }\r\n            }\r\n            return {\r\n                ...state,\r\n                [stockpileCategory]: state[stockpileCategory].map((element, index) => index === toSlot ? item : element)\r\n            };\r\n        }\r\n\r\n        case \"moveItemInWarehouse\": {\r\n            const {\r\n                itemType,\r\n                fromSlot,\r\n                toSlot,\r\n            } = action;\r\n            const stockpileCategory = ItemType[itemType] as keyof StockpileStoreState\r\n\r\n            return {\r\n                ...state,\r\n                [stockpileCategory]: state[stockpileCategory].map((element, index) => {\r\n                    if (index === fromSlot) { return state[stockpileCategory][toSlot]; }\r\n                    if (index === toSlot) { return state[stockpileCategory][fromSlot]; }\r\n                    return element;\r\n                })\r\n            };\r\n        }\r\n        case \"removeItem\": {\r\n            const { itemType, fromSlot } = action;\r\n            const stockpileCategory = ItemType[itemType] as keyof StockpileStoreState\r\n\r\n                return {\r\n                ...state,\r\n                [stockpileCategory]: state[stockpileCategory].map((element, index) => index !== fromSlot ? element : null)\r\n            };\r\n        }\r\n\r\n        // // Adds slots with 'null' to the end\r\n        // case ActionType.addStockpileSlots: {\r\n        //     const {\r\n        //         slots,\r\n        //     } = (action as AddStockpileSlotsAction);\r\n\r\n        //     return [\r\n        //         ...state,\r\n        //         ...Array(slots).fill(null)\r\n        //     ];\r\n        // }\r\n    }\r\n\r\n    return state;\r\n};\r\n","import { GameAction } from \"store/actions/game\";\nimport {  LogAction } from \"store/actions/log\";\nimport { LogUpdate } from \"mechanics/gameTick/quests\";\nimport { Reducer } from \"redux\";\nimport { LogEntry } from \"store/types/logEntry\";\n\n/**\n * reducer\n * @param state\n * @param action\n */\nexport const log: Reducer<LogEntry[]> = (state: LogEntry[] = initialLogState, action: GameAction | LogAction) => {\n    switch (action.type) {\n        case \"addLogEntry\": {\n            const {entry, channel, channelContext} = action;\n            const {key, context} = entry;\n            const time = Date.now();\n            return [{\n                    channel,\n                    channelContext,\n                    context,\n                    key,\n                    time,\n                },\n                ...state,\n            ];\n        }\n        case \"gameTick\": {\n            if (!action.log.length) {\n                return state;\n            }\n        \n            // Add log entries\n            const logEntries = action.log.map((lU: LogUpdate): LogEntry => {\n                return {\n                    ...lU,\n                    time: Date.now(),\n                };\n            });\n            return [\n                ...logEntries,\n                ...state,\n            ];\n        }\n    }\n    return state;\n};\n\nexport const initialLogState = [];\n","import { Reducer } from \"redux\";\nimport { QuestStatus, QuestStoreState } from \"store/types/quest\";\nimport { isActorObject, SceneActionType } from 'store/types/scene';\nimport { QuestDefinition } from 'definitions/quests/types';\nimport { getDefinition } from 'definitions/quests';\nimport { initialQuestVars } from 'definitions/quests/kill10Boars/questVars';\nimport deepmerge from \"deepmerge\";\nimport { Action } from \"store/actions\";\nimport { Allegiance } from \"store/types/combat\";\n\nexport const initialQuestState: QuestStoreState[] = [{\n    name: \"kill10Boars\",\n    status: QuestStatus.active,\n    party: [\n        \"c4a5d270\",\n        \"2e655832\",\n        \"ec6f1050\",\n        \"d299f98a\",\n    ],\n    progress: 0,\n    questVars: initialQuestVars,\n    encounterResults: [],\n    icon: \"sigil1.png\",\n// }, {\n//     name: \"retrieveMagicAmulet\",\n//     party: [],\n//     status: QuestStatus.available,\n//     progress: 0,\n//     questVars: {},\n//     encounterResults: [],\n//     icon: \"sigil2.png\",\n//     reward: {\n//         gold: 4,\n//         items: [ Item.deedForWeaponsmith ],\n//     },\n}];\n\n/**\n * reducer\n * @param state\n * @param action\n */\nexport const quests: Reducer<QuestStoreState[]> = (state: QuestStoreState[] = initialQuestState, action: Action): QuestStoreState[] => {\n    switch (action.type) {\n        // Launches quest. Sets state to active, assigns adventurers\n        case \"launchQuest\": {\n            const party = action.assignedAventurers\n                .filter((adventurer) => !!adventurer)\n                .map((adventurer) => adventurer.id);\n\n            return state.map((qss) => {\n                if (qss.name === action.questName) {\n                    const questDefinition: QuestDefinition = getDefinition(action.questName);\n                    const questVars = questDefinition.getInitialQuestVars(qss);\n\n                    return {\n                        ...qss,\n                        status: QuestStatus.active,\n                        party,\n                        questVars\n                    };\n                }\n                return qss;\n            });\n        }\n\n        case \"exitEncounter\": {\n            return state.map((qss) => {\n                if (qss.name === action.questName) {\n                    const progress = qss.progress + 1;\n                    // const questDefinition: QuestDefinition = questDefinitions[qss.name];\n                    // const nextNode = questDefinition.nodes[Math.floor(progress)];\n        \n                    return {\n                        ...qss,\n                        progress,\n                        scene: undefined,\n                        sceneName: undefined\n                    };\n                }\n                return qss;\n            });\n        }\n\n        // Updates the questvars\n        case \"updateQuestVars\": {\n            return state.map((qss) => {\n                if (qss.name === action.questName) {\n                    return {\n                        ...qss,\n                        // todo: sort this out\n                        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n                        // @ts-ignore\n                        questVars: deepmerge(qss.questVars, action.vars, { arrayMerge: overwriteMerge })\n                    };\n                }\n                return qss;\n            });\n        }\n\n        // case \"updateEncounterResult\":\n        //     return updateEncounterResult(state, action as UpdateEncounterResultAction);\n\n        // case \"startEncounter\":\n        //     return startEncounter(state, action as StartEncounterAction);\n\n        // To change scene, set scene name. The scenecontroller will load the scene data and art assets\n        // and call setScene reducer\n        case \"setSceneName\": {\n            return state.map((qss) => {\n                if (qss.name === action.questName) {\n                    return {\n                        ...qss,\n                        sceneName: action.sceneName,\n                        scene: undefined\n                    };\n                }\n                return qss;\n            });\n        }\n\n        case \"setScene\": {\n            return state.map((qss) => {\n                if (qss.name === action.questName) {\n                    return {\n                        ...qss,\n                        scene: action.scene\n                    };\n                }\n                return qss;\n            });\n        }\n\n        // Enqueues a scene action on this quest\n        case \"enqueueSceneAction\": {\n            return state.map((qss) => {\n                if (qss.name === action.questName) {\n                    const scene = qss.scene;\n                    if (!scene) throw new Error(\"Something broke. No scene\");\n                    scene.actionQueue = [...scene.actionQueue || [], action.sceneAction];\n\n                    return {\n                        ...qss,\n                        scene\n                    };\n                }\n                return qss;\n            });\n        }\n\n        // next action on scene is completed\n        case \"completeSceneAction\": {\n            return state.map((qss) => {\n                if (qss.name === action.questName) {\n                    const scene = qss.scene;\n                    if (!scene || !scene.actionQueue) throw new Error(\"Something broke. No scene\");\n                    const sceneAction = scene.actionQueue[0];\n                    if (!sceneAction) return qss;\n\n                    switch (sceneAction.actionType) {\n                        case SceneActionType.move: {\n                            scene.objects = scene.objects.map((a) => {\n                                if (isActorObject(a) && a.name === sceneAction.actorId) {\n                                    return {\n                                        ...a,\n                                        location: sceneAction.target\n                                    };\n                                }\n                                return a;\n                            })\n                        }\n                    }\n\n                    // pop first action of the stack\n                    scene.actionQueue = [\n                        ...scene.actionQueue.slice(1)\n                    ];\n\n                    return {\n                        ...qss,\n                        scene\n                    };\n                }\n                return qss;\n            });\n        }\n\n        case \"setCombat\": {\n            const { combat } = action;\n            return state.map((qss) => {\n                if (qss.name === action.questName && qss.scene) {\n                    const scene = { \n                        ...qss.scene, \n                        combat,\n                        turn: combat ? Allegiance.player : undefined,\n                    };\n                    return {\n                        ...qss,\n                        scene\n                    };\n                }\n                return qss;\n            });\n        }\n\n        case \"endPlayerTurn\": {\n            return state.map((qss) => {\n                if (qss.name === action.questName) {\n                    const scene = qss.scene;\n                    if (!scene) throw new Error(\"Something broke. No scene\");\n        \n                    scene.objects = scene.objects.map(o => {\n                        if (isActorObject(o)) {\n                            const ap = 0;\n                            return {\n                                ...o,\n                                ap\n                            };\n                        }\n                        return o;\n                    })\n        \n                    return {\n                        ...qss,\n                        scene\n                    };\n                }\n                return qss;\n            });\n        }\n\n        case \"startTurn\": {\n            return state.map((qss) => {\n                if (qss.name === action.questName) {\n                    // const scene = qss.scene;\n                    if (!qss.scene) throw new Error(\"Something broke. No scene\");\n                    const { turn } = action;\n                    return {\n                        ...qss,\n                        scene: {\n                            ...qss.scene,\n                            turn\n                        }\n                    };\n                }\n                return qss;\n            });\n        }\n\n        case \"setActorAp\": {\n            return state.map((qss) => {\n                if (qss.name === action.questName) {\n                    const scene = qss.scene;\n                    if (!scene) throw new Error(\"Something broke. No scene\");\n        \n                    scene.objects = scene.objects.map(o => {\n                        if (isActorObject(o) && o.name === action.actor) {\n                            const ap = action.ap;\n                            return {\n                                ...o,\n                                ap\n                            };\n                        }\n                        return o;\n                    })\n        \n                    return {\n                        ...qss,\n                        scene\n                    };\n                }\n                return qss;\n            });\n        }\n\n        case \"deductActorAp\": {\n            return state.map((qss) => {\n                if (qss.name === action.questName) {\n                    const scene = qss.scene;\n                    if (!scene) throw new Error(\"Something broke. No scene\");\n        \n                    scene.objects = scene.objects.map(o => {\n                        if (isActorObject(o) && o.name === action.actor) {\n                            const ap = o.ap - action.ap;\n                            return {\n                                ...o,\n                                ap\n                            };\n                        }\n                        return o;\n                    })\n        \n                    return {\n                        ...qss,\n                        scene\n                    };\n                }\n                return qss;\n            });\n        }\n\n        // case \"updateSceneObjectAction\": {\n        //     return state.map((qss) => {\n        //         if (qss.name === action.questName) {\n        //             const scene = qss.scene;\n        //             if (!scene) throw new Error(\"Something broke. No scene\");\n        \n        //             scene.objects = scene.objects.map(tO => {\n        //                 if (tO.id === action.id) {\n        //                     return {\n        //                         ...tO,\n        //                         ...action.object\n        //                     }\n        //                 }\n        //                 return tO;\n        //             })\n        \n        //             return {\n        //                 ...qss,\n        //                 scene\n        //             };\n        //         }\n        //         return qss;\n        //     });\n        // }\n\n        case \"setActiveSceneInteractionModal\": {\n            return state.map((qss: QuestStoreState) => {\n                if (qss.name === action.questName && qss.scene) {\n                    qss.scene.activeInteractionModal = action.sceneInteractionModal\n                }\n                return qss;\n            });\n        }\n\n        case \"gameTick\": {\n            const questsToUpdate = action.quests;\n            if (!questsToUpdate.length) {\n                return state;\n            }\n        \n            return state.map((qss) => {\n                const questToUpdate = questsToUpdate.find((q) => q.name === qss.name);\n                if (questToUpdate) {\n                    const progress = questToUpdate.progress;\n                    // const currentEncounter = questToUpdate.currentEncounter;\n        \n                    return {\n                        ...qss,\n                        progress,\n                        // currentEncounter,\n                    };\n                }\n                return qss;\n            });\n        }\n    }\n    return state;\n};\n\nconst overwriteMerge = (_: [], sourceArray: []) => sourceArray\n\n","import { Reducer } from \"redux\";\r\nimport { ResourceStoreState } from \"store/types/resources\";\r\nimport { Resource } from \"definitions/resources\";\r\nimport { Action } from \"store/actions\";\r\n\r\n\r\nexport const resources: Reducer<ResourceStoreState> = (state: ResourceStoreState = initialResourcesState, action: Action) => {\r\n\r\n    const addResources = (resourcesToAdd: ResourceStoreState) => {\r\n        // todo: Check if warehouse can hold it\r\n        return Object.keys(state).reduce<ResourceStoreState>((acc, value) => {\r\n            const resource = value as Resource;\r\n            acc[resource] = (state[resource] ?? 0) + (resourcesToAdd[resource] || 0);\r\n            return acc;\r\n        }, {});\r\n    };\r\n\r\n    switch (action.type) {\r\n        case \"addResources\": {\r\n            const resourcesToAdd = action.resources;\r\n            return addResources(resourcesToAdd);\r\n        }\r\n        case \"removeResources\": {\r\n            const resourcesToRemove = action.resources;\r\n            return Object.keys(state).reduce<ResourceStoreState>((acc, value) => {\r\n                const resource = value as Resource;\r\n                acc[resource] = (state[resource] ?? 0) - (resourcesToRemove[resource] || 0);\r\n                return acc;\r\n            }, {});\r\n        }\r\n\r\n        case \"gameTick\": {\r\n            const resourcesToAdd = action.resources;\r\n            if (resourcesToAdd === null) {\r\n                return state;\r\n            }\r\n            return addResources(resourcesToAdd);\r\n        }\r\n    }\r\n    return state;\r\n};\r\n\r\nexport const initialResourcesState: ResourceStoreState = {\r\n    fabric: 0,\r\n    food: 0,\r\n    iron: 10,\r\n    leather: 0,\r\n    stone: 0,\r\n    wood: 10,\r\n};","import { Reducer } from \"redux\";\nimport { State as seedrandomStateType } from \"seedrandom\";\nimport { Action } from \"store/actions\";\n\nexport const initialRngState = false;\n/**\n * reducer\n * @param state\n * @param action\n */\nexport const rngState: Reducer<seedrandomStateType> = (state: seedrandomStateType = initialRngState, action: Action) => {\n    if (action.type === \"gameTick\" && action.rngState != null) {\n        state = Object.assign({}, action.rngState);\n    }\n    return state;\n};\n","import { Reducer } from \"redux\";\nimport { isProductionStructure, isResourceStructure, ResourceStructure, Structure } from \"definitions/structures\";\nimport { ProductionStructureStoreState, StructureState, StructureStoreState } from \"store/types/structure\";\nimport { StructuresStoreState } from \"store/types/structures\";\nimport { Action } from \"store/actions\";\n\n/**\n * reducer\n * @param state\n * @param action\n */\nexport const structures: Reducer<StructuresStoreState, Action> = (state: StructuresStoreState = initialStructuresState, action: Action) => {\n    switch (action.type) {\n        case \"startBuildingStructure\": {\n            return updateStructureState(state, action.structure, StructureState.Building);\n        }\n        case \"finishBuildingStructure\": {\n            return updateStructureState(state, action.structure, StructureState.Built);\n        }\n        case \"upgradeStructure\": {\n            // Upgrade to next level\n            const level = state[action.structure].level + 1;\n            const structureStore: StructureStoreState = {\n                ...state[action.structure],\n                level,\n            };\n            return {\n                ...state,\n                [action.structure]: structureStore,\n            };\n        }\n        case \"increaseWorkers\": {\n            const { workers: workersToAdd } = action;\n            const workers = state[action.structure].workers + workersToAdd;\n            const structureStore: StructureStoreState = {\n                ...state[action.structure],\n                workers,\n            };\n            return {\n                ...state,\n                [action.structure]: structureStore,\n            };\n        }\n        case \"decreaseWorkers\": {\n            const { workers: workersToRemove } = action;\n            const workers = state[action.structure].workers - workersToRemove;\n            const structureStore: StructureStoreState = {\n                ...state[action.structure],\n                workers,\n            };\n            return {\n                ...state,\n                [action.structure]: structureStore,\n            };\n        }\n        case \"setStructureState\": {\n            const { state: structureState } = action;\n            return updateStructureState(state, action.structure, structureState);\n        }\n        case \"addItemToToProduces\": {\n            // Adds given item to a structures' `produces` list\n            if (isProductionStructure(action.structure)){\n                return state;\n            }\n\n            const { item } = action;\n            const produces = [\n                ...(state[action.structure] as ProductionStructureStoreState).produces,\n                item\n            ];\n            const structureStore: ProductionStructureStoreState = {\n                ...state[action.structure],\n                produces,\n            };\n            return {\n                ...state,\n                [action.structure]: structureStore,\n            };\n        }\n        case \"removeItemFromHarvest\": {\n            // Should always be false but typescript doesnt know that\n            if (!isResourceStructure(action.structure)) return state;\n            const harvest = state[action.structure].harvest?.filter((h, i) => (i !== action.index));\n            return { \n                ...state,\n                [action.structure]: {\n                    ...state[action.structure],\n                    harvest\n                }\n            }\n        }\n        case \"gameTick\": {\n            if (!action.harvest || !Object.keys(action.harvest)?.length) {\n                return state;\n            }\n            // Copies harvest from harvest into structure\n            return Object.keys(state).reduce<StructuresStoreState>((acc, structureAsString) => {\n                const structure = structureAsString as Structure;\n                if (isResourceStructure(structure) && action.harvest?.[structure]?.length){\n                    const harvest = action.harvest[structure]\n                    acc[structure as ResourceStructure].harvest = [\n                        ...(acc[structure as ResourceStructure].harvest ?? []), \n                        ...harvest ?? []\n                    ]\n                }\n                return acc;\n            }, state);\n        }\n    }\n    return state;\n};\n\nconst updateStructureState = (state: StructuresStoreState, structure: Structure, structureState: StructureState) => {\n    const structureStore: StructureStoreState = {\n        ...state[structure],\n        state: structureState,\n    };\n    return {\n        ...state,\n        [structure]: structureStore,\n    };\n};\n\n\nconst structureInitialState: StructureStoreState = {\n    level: 0,\n    state: StructureState.NotBuilt,\n    workers: 0,\n};\n\nexport const initialStructuresState: StructuresStoreState = {\n    alchemist: { ...structureInitialState, produces: [ ] },\n    armoursmith: { ...structureInitialState, produces: [ \"apparel/boots1\" ] },\n    garden: { level: 0, workers: 0, state: StructureState.Built  }, // TODO: change back to NotBuilt\n    lumberMill: structureInitialState,\n    mine: { level: 0, workers: 0, state: StructureState.NotBuilt  },\n    quarry: structureInitialState,\n    tavern: { level: 0, workers: 0, state: StructureState.Built },\n    tannery: structureInitialState,\n    warehouse: { level: 0, workers: 0, state: StructureState.Built},\n    weaponsmith:  { ...structureInitialState, produces: [ \"weapon/simpleCrossbow\", \"weapon/dagger\" ] },\n    weaver: structureInitialState,\n    workshop: { ...structureInitialState, produces: [ \"questItem/torch\", \"questItem/sandwich\" ] },\n};\n","\nimport { TaskAction } from \"store/actions/tasks\";\nimport { Reducer } from \"redux\";\nimport { TaskStoreState } from \"store/types/task\";\nimport { TasksStoreState } from \"store/types/tasks\";\nimport { Action } from \"store/actions\";\n\n/**\n * Tasks reducer\n * @param state\n * @param action\n */\nexport const tasks: Reducer<TasksStoreState> = (state: TasksStoreState = initialTasksState, action: Action) => {\n    switch (action.type) {\n        case \"start\": {\n        // Adds a new task to the running tasks\n            const task: TaskStoreState = createTask(action);\n            const running = state.running.concat(task);\n            return {\n                ...state,\n                running,\n            };\n        }\n        case \"gameTick\": {\n            // Will update all tasks in `running`. If a running task expires it is placed in `complete`\n            // Note that completed tasks must be handled BEFORE the next call to ActionType.update, because\n            // this list is recreated every time\n            const now: number = Date.now();\n            const running: TaskStoreState[] = [];\n            const completed: TaskStoreState[] = [];\n            state.running.forEach((t) => {\n                const end = now + t.timeRemaining;\n                const progress = (now - t.startTime) / (end - t.startTime);\n                const timeRemaining = t.timeRemaining - (now - t.lastTick);\n                const task = {\n                    ...t,\n                    progress,\n                    lastTick: now,\n                    timeRemaining,\n                };\n                if (timeRemaining < 0) {\n                    completed.push(task);\n                } else {\n                    running.push(task);\n                }\n            });\n\n            return {\n                running,\n                completed,\n            };\n        }\n    }\n    return state;\n};\n\nconst createTask = (action: TaskAction): TaskStoreState => {\n    return {\n        name: action.name,\n        origin: action.origin,\n        type: action.taskType,\n        callbacks: action.callbacks,\n        timeRemaining: action.time,\n        startTime: Date.now(),\n        lastTick: Date.now(),\n        progress: 0,\n    };\n};\n\nexport const initialTasksState: TasksStoreState = {\n    completed: [],\n    running: [],\n};","import { Reducer } from \"redux\";\nimport { Action } from \"store/actions\";\nimport { WorkersAction } from \"store/actions/workers\";\n\n/**\n * reducer\n * @param state\n * @param action\n */\nexport const workers: Reducer<number, WorkersAction> = (state: number = initialWorkersState, action: Action) => {\n    switch (action.type) {\n        case \"addWorkers\":\n            // Adds (or subtract, if negative) from the players workers\n            return state + action.value;\n    }\n    return state;\n};\n\nexport const initialWorkersState = 13;","import { combineReducers } from \"redux\";\nimport { StoreState } from \"store/types\"\nimport { barBrawl } from \"store/types/combat\";\nimport { adventurers, initialAdventurers } from \"./adventurers\";\nimport { combat } from \"./combat\";\nimport { engine, getInitialEngineState } from \"./engine\";\nimport { gold, initialGoldState } from \"./gold\";\nimport { getInitialStockpile, stockpile } from \"./stockpile\";\nimport { initialLogState, log } from \"./log\";\nimport { initialQuestState, quests } from \"./quests\";\nimport { initialResourcesState, resources } from \"./resources\";\nimport { initialRngState, rngState } from \"./rngState\";\nimport { initialStructuresState, structures } from \"./structures\";\nimport { initialTasksState, tasks } from \"./tasks\";\nimport { initialWorkersState, workers } from \"./workers\";\n\nexport default combineReducers<StoreState>({\n    adventurers,\n    combat,\n    engine,\n    gold,\n    stockpile,\n    log,\n    quests,\n    resources,\n    rngState,\n    structures,\n    tasks,\n    workers,\n});\n\nexport const createInitialStore = () => ({\n    adventurers: initialAdventurers,\n    combat: barBrawl,\n    engine: getInitialEngineState(),\n    gold: initialGoldState,\n    stockpile: getInitialStockpile(),\n    log: initialLogState,\n    quests: initialQuestState,\n    resources: initialResourcesState,\n    rngState: initialRngState,\n    structures: initialStructuresState,\n    tasks: initialTasksState,\n    workers: initialWorkersState\n})","import { ActionType, AddCombatActionAction, MoveActorAction } from \"store/actions/combat\";\nimport { AnyAction, Reducer } from \"redux\";\nimport { barBrawl, CombatStoreState } from \"store/types/combat\";\n\n/**\n * reducer\n * @param state\n * @param action\n */\nexport const combat: Reducer<CombatStoreState> = (state: CombatStoreState = barBrawl, action: AnyAction) => {\n    switch (action.type) {\n        case ActionType.startCombatAction: {\n            const addAction = action as AddCombatActionAction;\n\n            return {\n                ...state,\n                action: {\n                    actor: addAction.actor,\n                    endsAt: addAction.endsAt,\n                    target: addAction.target,\n                    type: addAction.combatType,\n                },\n            };\n        }\n        case ActionType.moveActor: {\n            const moveAction = action as MoveActorAction;\n\n            // Moves an actor to another position\n            const actors = state.actors.map((a) => {\n                if (a.name === moveAction.actor) {\n                    return {\n                        ...a,\n                        location: moveAction.location,\n                    };\n                }\n                return a;\n            });\n\n            return {\n                ...state,\n                actors,\n            };\n        }\n        case ActionType.clearCombatAction: {\n            // Clears current combat action\n            return {\n                ...state,\n                action: undefined,\n            };\n        }\n    }\n    return state;\n};\n","import { createStore, DeepPartial, AnyAction, Store } from \"redux\";\nimport { Persistor, persistReducer, persistStore } from \"redux-persist\";\nimport localForage from 'localforage';\nimport rootReducer from \"store/reducers/index\";\nimport { asInt } from \"constants/version\";\nimport { storeIsRehydrated } from 'store/helpers/storeHelpers';\nimport { StoreState } from 'store/types';\n\nconst persistConfig = {\n    key: \"root\",\n    storage: localForage,\n    version: asInt,\n};\n\nconst persistedReducer = persistReducer<StoreState, AnyAction>(persistConfig, rootReducer);\n\ninterface ConfigureStoreResult {\n    store: Store;\n    persistor: Persistor;\n    isHydrated: boolean;\n}\n\n/**\n * Configures the redux store\n */\nconst configureStore = async (initial: DeepPartial<StoreState> = {}): Promise<ConfigureStoreResult> => {\n    return new Promise((resolve, _reject) => {\n        const store = createStore(\n            persistedReducer,\n            // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n            // @ts-ignore\n            initial,\n            // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n            // @ts-ignore\n            window.__REDUX_DEVTOOLS_EXTENSION__ && window.__REDUX_DEVTOOLS_EXTENSION__(),\n        );\n        const persistor = persistStore(store, undefined, () => {\n            const isHydrated = storeIsRehydrated(store.getState());\n            resolve({ store, persistor, isHydrated }) ;\n        });\n    });\n};\n\nexport default configureStore;","import { TaskStoreState, TaskType } from 'store/types/task';\nimport { TasksStoreState } from 'store/types/tasks';\nimport { AnyAction, Dispatch } from \"redux\";\nimport { ToastManager } from 'global/ToastManager';\nimport { TextManager } from 'global/TextManager';\nimport { Type } from 'components/ui/toasts/Toast';\nimport { getDefinition } from 'definitions/items';\nimport { Item } from 'definitions/items/types';\n\nexport const processCompletedTasks = (tasks: TasksStoreState, dispatch: Dispatch<AnyAction>) => {\n    const handleCompletedTask = (task: TaskStoreState) => {\n        // Fire all callbacks\n        task.callbacks.forEach((action) => dispatch(action));\n\n        switch (task.type) {\n            case TaskType.craftItem: {\n                const item = task.name as Item;\n                const title = TextManager.get(\"common-item-crafted\", { item });\n                const definition = getDefinition(item);\n                ToastManager.addToast(title, Type.itemCrafted, definition.iconImg);\n                break;\n            }\n        }\n    };\n\n    tasks.completed.forEach((task) => handleCompletedTask(task));\n};","import kill10Boars from './kill10Boars';\r\nimport retrieveMagicAmulet from './retrieveMagicAmulet';\r\nimport { QuestDefinition } from './types';\r\n\r\n\r\n\r\n\r\n// const fulruhmRaid: QuestDefinition = {\r\n//     nodes: [{\r\n//         x: -4,\r\n//         y: -1,\r\n//         type: QuestNodeType.nothing,\r\n//     }, {\r\n//         x: -4,\r\n//         y: -1,\r\n//         type: QuestNodeType.nothing,\r\n\r\nconst all = {\r\n    kill10Boars,\r\n    retrieveMagicAmulet,\r\n};\r\n\r\nexport default all;\r\n\r\nexport function getDefinition<T = unknown>(questName: string): QuestDefinition<T> {\r\n    \r\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n    // @ts-ignore\r\n    return all[questName];\r\n}\r\n","import { QuestStoreState } from 'store/types/quest';\nimport { QuestDefinition, QuestNodeType } from '../types';\nimport { initialQuestVars, Kill10BoarsQuestVars } from './questVars';\n\n\nconst kill10Boars: QuestDefinition<Kill10BoarsQuestVars> = {\n    getQuestVars: (questStore: QuestStoreState) => questStore.questVars as Kill10BoarsQuestVars,\n    getInitialQuestVars: (_questStore: QuestStoreState) => {\n        return initialQuestVars;\n    },\n    nodes: [{\n        x: 0,\n        y: 1,\n        type: QuestNodeType.nothing,\n        log: \"quest-kill10-boars-node0\",\n    }, {\n    //     x: 0,\n    //     y: 2,\n    //     type: QuestNodeType.nothing,\n    // }, {\n    //     x: 0,\n    //     y: 3,\n    //     type: QuestNodeType.nothing,\n    // }, {\n    //     x: 0,\n    //     y: 4,\n    //     type: QuestNodeType.nothing,\n    // }, {\n        x: 0,\n        y: 3,\n        type: QuestNodeType.encounter,\n        // log: \"quest-kill10-boars-enter-dungeon\",\n        startScene: \"dungeon.entrance\"\n    }, {\n        x: 1,\n        y: 3,\n        type: QuestNodeType.nothing,\n        log: \"quest-kill10-boars-leave-dungeon\",\n    }, {\n        x: 1,\n        y: 3,\n        type: QuestNodeType.nothing,\n        log: \"quest-kill10-boars-left-dungeon\"\n    }, {\n        x: 2,\n        y: 3,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 3,\n        y: 3,\n        type: QuestNodeType.encounter,\n        startScene: \"dungeon.hallway\"\n\n        //encounter: Encounter.backstabbed,\n    }, {\n        x: 4,\n        y: 4,\n        type: QuestNodeType.nothing,\n        log: \"The party spots a boss\",\n    }, {\n        x: 5,\n        y: 4,\n        type: QuestNodeType.nothing,\n    }],\n};\n\nexport default kill10Boars;","import { QuestStoreState } from 'store/types/quest';\nimport { QuestDefinition, QuestNodeType } from '../types';\n\nexport interface RetrieveMagicAmuletQuestVars {\n    baz: boolean;\n    zux: number;\n}\n\nconst retrieveMagicAmulet: QuestDefinition<RetrieveMagicAmuletQuestVars> = {\n    getQuestVars: (questStore: QuestStoreState) => questStore.questVars as RetrieveMagicAmuletQuestVars,\n    getInitialQuestVars: (_questStore: QuestStoreState) => {\n        const vars: RetrieveMagicAmuletQuestVars = {\n            baz: false,\n            zux: 13\n        }\n        return vars;\n    },\n    requiredItems: [\n        \"questItem/torch\",\n        \"questItem/torch\",\n        \"questItem/torch\",\n        \"questItem/sandwich\",\n        \"questItem/sandwich\",\n    ],\n    nodes: [{\n        x: 0,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 1,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 2,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 3,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 4,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 5,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 7,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 8,\n        y: 2,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 8,\n        y: 3,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 9,\n        y: 3,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 10,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 10,\n        y: 2,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 10,\n        y: 3,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 10,\n        y: 4,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 11,\n        y: 5,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 12,\n        y: 6,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 12,\n        y: 7,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 13,\n        y: 8,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 12,\n        y: 8,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 12,\n        y: 9,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 11,\n        y: 8,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 10,\n        y: 8,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 9,\n        y: 8,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 8,\n        y: 9,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 7,\n        y: 8,\n        type: QuestNodeType.encounter,\n        startScene: \"dungeon.hallway\"\n    }, {\n        x: 8,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 1,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 1,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 1,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 1,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 1,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 1,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 1,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 1,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }, {\n        x: 2,\n        y: 1,\n        type: QuestNodeType.encounter,\n        startScene: \"dungeon.hallway\"\n    }, {\n        x: 3,\n        y: 1,\n        type: QuestNodeType.nothing,\n    }],\n};\n\nexport default retrieveMagicAmulet;","// todo: refactor hooks https://github.com/react-dnd/react-dnd/pull/1244\nimport * as React from \"react\";\nimport { ConnectDropTarget, DropTarget, DropTargetConnector, DropTargetMonitor, DropTargetSpec } from \"react-dnd\";\nimport { DragType } from \"constants/dragging\";\nimport { getDefinition } from \"definitions/items\";\nimport { ApparelDefinition } from \"definitions/items/apparel\";\nimport { Item, ItemType } from \"definitions/items/types\";\nimport { WeaponDefinition, WeaponTypeDefinition, WeaponClassification } from 'definitions/items/weapons';\nimport { InventoryItemDragInfo } from 'components/ui/items/DraggableItemIcon';\nimport \"./styles/equipmentslot.scss\";\n\nconst dropTarget: DropTargetSpec<Props> = {\n    drop(props: Props, monitor: DropTargetMonitor) {\n        props.onDrop(monitor.getItem());\n    },\n    canDrop(props: Props, monitor: DropTargetMonitor)  {\n        const item = monitor.getItem<InventoryItemDragInfo>().item;\n\n        return itemAndEquipmentSlotMatch(item, props.type);\n    },\n};\n\nexport enum EquipmentSlotType {\n    feet,\n    hands,\n    chest,\n    legs,\n    head,\n    shoulders,\n    mainHand,\n    offHand,\n}\n\n// Returns true if item can be slotted in equipmentSlotType\nexport const itemAndEquipmentSlotMatch = (item: Item, equipmentSlotType: EquipmentSlotType) => {\n    switch (equipmentSlotType) {\n        case EquipmentSlotType.chest:\n        case EquipmentSlotType.feet:\n        case EquipmentSlotType.hands:\n        case EquipmentSlotType.head:\n        case EquipmentSlotType.legs:\n            return checkEquipment(item, equipmentSlotType);\n        case EquipmentSlotType.mainHand:\n        case EquipmentSlotType.offHand: {\n            const itemDefinition: WeaponDefinition = getDefinition(item) as WeaponDefinition;\n            if (itemDefinition.itemType !== ItemType.weapon) {\n                return false;\n            }\n            const { classification } = WeaponTypeDefinition[itemDefinition.weaponType];\n            switch (classification) {\n                case WeaponClassification.oneHanded:\n                    return true;\n                case WeaponClassification.mainHand:\n                    return equipmentSlotType === EquipmentSlotType.mainHand;\n                case WeaponClassification.offHand:\n                case WeaponClassification.shield:\n                    return equipmentSlotType === EquipmentSlotType.offHand;\n            }\n\n            // todo: prevent shields to be equipped in main hand\n            return true;\n        }\n        default:\n            return false;\n    }\n};\n\nexport interface Props {\n    type: EquipmentSlotType;\n    onDrop: (item: InventoryItemDragInfo) => void;\n}\n\nexport interface DropSourceProps {\n    canDrop: boolean;\n    isOver: boolean;\n    connectDropTarget: ConnectDropTarget;\n}\n\nconst collect = (connect: DropTargetConnector, monitor: DropTargetMonitor) => ({\n    canDrop: monitor.canDrop(),\n    connectDropTarget: connect.dropTarget(),\n    isOver: monitor.isOver(),\n});\n\n/**\n * The EquipmentSlot displays a slot in which an item can be placed.\n */\nconst EquipmentSlot = (props: React.PropsWithChildren<Props & DropSourceProps>) => {\n    const {\n        isOver,\n        canDrop,\n        connectDropTarget,\n    } = props;\n    const isActive = isOver && canDrop;\n    let borderColor = \"grey\";\n    if (isActive) {\n        borderColor = \"green\";\n    } else if (canDrop) {\n        borderColor = \"orange\";\n    }\n\n    return connectDropTarget(\n        <div className = \"equipment-slot\" style = { { borderColor }} title={EquipmentSlotType[props.type]}>\n            { props.children }\n        </div>,\n    );\n};\n\nexport default DropTarget<Props, DropSourceProps>(\n    DragType.ITEM,\n    dropTarget,\n    collect,\n)(EquipmentSlot);\n\nconst checkEquipment = (item: Item, equipmentType: EquipmentSlotType) => {\n    const itemDefinition = getDefinition(item);\n    if (itemDefinition.itemType !== ItemType.apparel) {\n        return false;\n    }\n    return (itemDefinition as ApparelDefinition).equipmentType === equipmentType;\n};\n","import { LogChannel } from \"store/types/logEntry\";\nimport { TextEntry } from 'constants/text';\n\nexport type LogAction = \n   { type: \"addLogEntry\", entry: TextEntry, channel: LogChannel, channelContext?: string }\n\n\nexport const addLogText = (key: string, context?: any, channel: LogChannel = LogChannel.common, channelContext?: string): LogAction => {\n    const entry: TextEntry = {\n        key,\n        context\n    };\n    return {\n        type: \"addLogEntry\",\n        entry,\n        channel,\n        channelContext,\n    };\n}\n\nexport const addLogEntry = (entry: TextEntry, channel: LogChannel = LogChannel.common, channelContext?: string): LogAction => ({\n    type: \"addLogEntry\",\n    entry,\n    channel,\n    channelContext,\n});\n","import { StoreState } from \"store/types\";\nimport { AdventurerStoreState } from \"store/types/adventurer\";\nimport { QuestStoreState } from \"store/types/quest\";\n\n// export const adventurersInParty = (store: StoreState, partyId: string): AdventurerStoreState[] => {\n//     const party: PartyStoreState = store.parties[partyId];\n//     return party.adventurers.map((id: string) => findAdventurerById(store, id)!);\n// };\n\nexport const adventurersOnQuest = (adventurers: AdventurerStoreState[], quest: QuestStoreState): AdventurerStoreState[] => {\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    return quest.party.map((id: string) => findAdventurerById(adventurers, id)!);\n};\n\nexport const getQuestLeader = (adventurers: AdventurerStoreState[], quest: QuestStoreState): AdventurerStoreState | undefined => {\n    const leaderId = quest.party[0];\n    return findAdventurerById(adventurers, leaderId);\n}\n\nexport const findAdventurerById = (adventurers: AdventurerStoreState[], id: string): AdventurerStoreState | undefined => {\n    return adventurers.find((a) => a.id === id);\n};\n\n/**\n * Returns the amount of free inventory slots on this adventurer\n */\nexport const adventurerFreeInventorySlots = (adventurer: AdventurerStoreState): number => {\n    return adventurer.inventory.filter(i => i === null).length;\n};\n\nexport const storeIsRehydrated = (store: StoreState): boolean => {\n    // Returns a value indicating whether this store is fresh or rehydrated\n    return store?.engine.gameStarted !== undefined;\n};\n\n","import { TextManager } from 'global/TextManager';\n\nexport const ONE_SECOND = 1000;\nexport const TWO_SECONDS = 2000;\nexport const THREE_SECONDS = 3000;\nexport const FOUR_SECONDS = 4000;\nexport const FIVE_SECONDS = 5000;\n// ...\nexport const TEN_SECONDS = 10000;\nexport const TWENTY_SECONDS = 20000;\nexport const THIRTY_SECONDS = 30000;\n\nexport const ONE_MINUTE = 60000;\nexport const TWO_MINUTES = 120000;\nexport const THREE_MINUTES = 180000;\nexport const FOUR_MINUTES = 240000;\n\nexport const HALF_HOUR = ONE_MINUTE * 30;\nexport const ONE_HOUR = ONE_MINUTE * 60;\nexport const ONE_DAY = ONE_HOUR * 24;\nexport const ONE_YEAR = ONE_DAY * 265.25;\n\nexport const formatDuration = (ms: number, short?: boolean): string => {\n    const timeUnitsList = [\n        { unit: short? 'y' : 'year', amount: ONE_YEAR },\n        { unit: short? 'd' : 'day', amount: ONE_DAY },\n        { unit: short? 'h' : 'hour', amount: ONE_HOUR },\n        { unit: short? 'm' : 'minute', amount: ONE_MINUTE },\n        { unit: short? 's': 'second', amount: ONE_SECOND },\n    ]\n    let time = Math.abs(ms);\n    const output: string[] = [];\n    timeUnitsList.forEach((el) => {\n        const tmp = Math.floor(time / el.amount);\n        time -= tmp * el.amount\n        if (tmp !== 0) {\n            const unit = TextManager.get(`common-time-${el.unit}${tmp > 1 && !short ? \"-plural\": \"\"}`);\n            output.push(`${tmp}${unit}`);\n        }\n    })\n    return output.join(\" \");\n}\n","import { Item, ItemDefinition, ItemType } from \"./types\";\nimport { EquipmentSlotType } from 'components/ui/adventurer/EquipmentSlot';\n\ntype Prefix = \"apparel/\";\nconst PREFIX = \"apparel/\";\nconst itemType = ItemType.apparel;\nconst basePath = \"/img/items/apparel/\";\n\n// export enum EquipmentSlotType {\n//     feet,\n//     hands,\n//     chest,\n//     legs,\n//     head,\n//     shoulders,\n// }\n\nexport interface ApparelDefinition extends ItemDefinition {\n    equipmentType: EquipmentSlotType;\n    damageReduction?: number;\n}\n\nconst apparel = {\n    boots1: {\n        equipmentType: EquipmentSlotType.feet,\n        itemType,\n        iconImg: `${basePath}boots_1.png`,\n    },\n    boots2: {\n        equipmentType: EquipmentSlotType.feet,\n        itemType,\n        damageReduction: 1,\n        iconImg: `${basePath}boots_2.png`,\n    },\n    boots3: {\n        equipmentType: EquipmentSlotType.feet,\n        itemType,\n        damageReduction: 2,\n        iconImg: `${basePath}boots_3.png`,\n    },\n    chainmailHood: {\n        equipmentType: EquipmentSlotType.head,\n        itemType,\n        iconImg: `${basePath}chainmail_hood.png`,\n        damageReduction: 3,\n    },\n    chest: {\n        equipmentType: EquipmentSlotType.chest,\n        itemType,\n        iconImg: `${basePath}chest_1.png`,\n        damageReduction: 2,\n    },\n    clothGloves: {\n        equipmentType: EquipmentSlotType.hands,\n        itemType,\n        iconImg: `${basePath}cloth_gloves.png`,\n        damageReduction: 1\n    },\n    cowl: {\n        equipmentType: EquipmentSlotType.head,\n        itemType,\n        iconImg: `${basePath}cowl.png`,\n        damageReduction: 2,\n    },\n    cultistBoots: {\n        equipmentType: EquipmentSlotType.feet,\n        itemType,\n        iconImg: `${basePath}cultist_boots.png`,\n        damageReduction: 2,\n    },\n    crimsonRogueBoots: {\n        equipmentType: EquipmentSlotType.feet,\n        itemType,\n        iconImg: `${basePath}crimson_rogue_boots.png`,\n        damageReduction: 2,\n    },\n    crimsonRogueBritches: {\n        equipmentType: EquipmentSlotType.legs,\n        itemType,\n        iconImg: `${basePath}crimson_rogue_britches.png`,\n        damageReduction: 2,\n    },\n    crimsonRogueCoif: {\n        equipmentType: EquipmentSlotType.head,\n        itemType,\n        iconImg: `${basePath}crimson_rogue_coif.png`,\n        damageReduction: 2,\n    },\n    crimsonRogueGrips: {\n        equipmentType: EquipmentSlotType.hands,\n        itemType,\n        iconImg: `${basePath}crimson_rogue_grips.png`,\n        damageReduction: 2,\n    },\n    crimsonRogueSpaulders: {\n        equipmentType: EquipmentSlotType.shoulders,\n        itemType,\n        iconImg: `${basePath}crimson_rogue_spaulders.png`,\n        damageReduction: 2,\n    },\n    crimsonRogueTunic: {\n        equipmentType: EquipmentSlotType.chest,\n        itemType,\n        iconImg: `${basePath}crimson_rogue_tunic.png`,\n        damageReduction: 2,\n    },\n    cultistGloves: {\n        equipmentType: EquipmentSlotType.hands,\n        itemType,\n        iconImg: `${basePath}cultist_gloves.png`,\n        damageReduction: 2,\n    },\n    cultistPants: {\n        equipmentType: EquipmentSlotType.legs,\n        itemType,\n        iconImg: `${basePath}cultist_pants.png`,\n        damageReduction: 2,\n    },\n    cultistRobe: {\n        equipmentType: EquipmentSlotType.chest,\n        itemType,\n        iconImg: `${basePath}cultist_robe.png`,\n        damageReduction: 2,\n    },\n    cultistShoulderwraps: {\n        equipmentType: EquipmentSlotType.shoulders,\n        itemType,\n        iconImg: `${basePath}cultist_shoulderwraps.png`,\n        damageReduction: 2,\n    },\n    darkPrinceBracers: {\n        equipmentType: EquipmentSlotType.hands,\n        itemType,\n        iconImg: `${basePath}dark_prince_bracers.png`,\n        damageReduction: 2,\n    },\n    darkPrinceCape: {\n        equipmentType: EquipmentSlotType.shoulders,\n        itemType,\n        iconImg: `${basePath}dark_prince_cape.png`,\n        damageReduction: 2,\n    },\n    darkPrinceCuirass: {\n        equipmentType: EquipmentSlotType.chest,\n        itemType,\n        iconImg: `${basePath}dark_prince_cuirass.png`,\n        damageReduction: 2,\n    },\n    darkPrinceHood: {\n        equipmentType: EquipmentSlotType.head,\n        itemType,\n        iconImg: `${basePath}dark_prince_hood.png`,\n        damageReduction: 2,\n    },\n    darkPrinceSarong: {\n        equipmentType: EquipmentSlotType.legs,\n        itemType,\n        iconImg: `${basePath}dark_prince_sarong.png`,\n        damageReduction: 2,\n    },\n    darkPrinceSlippers: {\n        equipmentType: EquipmentSlotType.feet,\n        itemType,\n        iconImg: `${basePath}dark_prince_slippers.png`,\n        damageReduction: 2,\n    },\n    dreadnoughtBoots: {\n        equipmentType: EquipmentSlotType.feet,\n        itemType,\n        iconImg: `${basePath}dreadnought_boots.png`,\n        damageReduction: 8,\n    },\n    dreadnoughtChest: {\n        equipmentType: EquipmentSlotType.chest,\n        itemType,\n        iconImg: `${basePath}dreadnought_chest.png`,\n        damageReduction: 8,\n    },\n    dreadnoughtGauntlets: {\n        equipmentType: EquipmentSlotType.hands,\n        itemType,\n        iconImg: `${basePath}dreadnought_gauntlets.png`,\n        damageReduction: 8,\n    },\n    dreadnoughtHelm: {\n        equipmentType: EquipmentSlotType.head,\n        itemType,\n        iconImg: `${basePath}dreadnought_helm.png`,\n        damageReduction: 8,\n    },\n    dreadnoughtLegplates: {\n        equipmentType: EquipmentSlotType.legs,\n        itemType,\n        iconImg: `${basePath}dreadnought_legplates.png`,\n        damageReduction: 8,\n    },\n    dreadnoughtPauldrons: {\n        equipmentType: EquipmentSlotType.shoulders,\n        itemType,\n        iconImg: `${basePath}dreadnought_pauldrons.png`,\n        damageReduction: 8,\n    },\n    druidChest: {\n        equipmentType: EquipmentSlotType.chest,\n        itemType,\n        iconImg: `${basePath}druid-chest.png`,\n    },\n    druidFeet: {\n        equipmentType: EquipmentSlotType.feet,\n        itemType,\n        iconImg: `${basePath}druid-feet.png`,\n    },\n    druidHands: {\n        equipmentType: EquipmentSlotType.hands,\n        itemType,\n        iconImg: `${basePath}druid-hands.png`,\n    },\n    druidHead: {\n        equipmentType: EquipmentSlotType.head,\n        itemType,\n        iconImg: `${basePath}druid-head.png`,\n    },\n    druidLegs: {\n        equipmentType: EquipmentSlotType.legs,\n        itemType,\n        iconImg: `${basePath}druid-legs.png`,\n    },\n    fedora: {\n        equipmentType: EquipmentSlotType.head,\n        itemType,\n        iconImg: `${basePath}fedora.png`,\n    },\n    footmanBoots: {\n        equipmentType: EquipmentSlotType.feet,\n        itemType,\n        iconImg: `${basePath}footman_boots.png`,\n    },\n    footmanBreastplate: {\n        equipmentType: EquipmentSlotType.chest,\n        itemType,\n        iconImg: `${basePath}footman_breastplate.png`,\n    },\n    footmanFaceguard: {\n        equipmentType: EquipmentSlotType.head,\n        itemType,\n        iconImg: `${basePath}footman_faceguard.png`,\n    },\n    footmanFists: {\n        equipmentType: EquipmentSlotType.hands,\n        itemType,\n        iconImg: `${basePath}footman_fists.png`,\n    },\n    footmanLegplates: {\n        equipmentType: EquipmentSlotType.legs,\n        itemType,\n        iconImg: `${basePath}footman_legplates.png`,\n    },\n    footmanPauldrons: {\n        equipmentType: EquipmentSlotType.shoulders,\n        itemType,\n        iconImg: `${basePath}footman_pauldrons.png`,\n    },\n    greaves1: {\n        equipmentType: EquipmentSlotType.feet,\n        itemType,\n        iconImg: `${basePath}greaves_1.png`,\n        damageReduction: 2,\n    },\n    greaves2: {\n        equipmentType: EquipmentSlotType.hands,\n        itemType,\n        iconImg: `${basePath}greaves_2.png`,\n    },\n    hornedHelmet: {\n        equipmentType: EquipmentSlotType.head,\n        itemType,\n        iconImg: `${basePath}horned_helmet.png`,\n    },\n    leatherGloves: {\n        equipmentType: EquipmentSlotType.hands,\n        itemType,\n        iconImg: `${basePath}leather_gloves.png`,\n    },\n    naturalistsCape: {\n        equipmentType: EquipmentSlotType.shoulders,\n        itemType,\n        iconImg: `${basePath}naturalists_cape.png`,\n    },\n    naturalistsCowl: {\n        equipmentType: EquipmentSlotType.head,\n        itemType,\n        iconImg: `${basePath}naturalists_cowl.png`,\n    },\n    naturalistsFootwraps: {\n        equipmentType: EquipmentSlotType.feet,\n        itemType,\n        iconImg: `${basePath}naturalists_footwraps.png`,\n    },\n    naturalistsVambraces: {\n        equipmentType: EquipmentSlotType.hands,\n        itemType,\n        iconImg: `${basePath}naturalists_vambraces.png`,\n    },\n    naturalistsVest: {\n        equipmentType: EquipmentSlotType.chest,\n        itemType,\n        iconImg: `${basePath}naturalists_vest.png`,\n    },\n    nomadHelmet: {\n        equipmentType: EquipmentSlotType.head,\n        itemType,\n        iconImg: `${basePath}nomad_helmet.png`,\n    },\n    pants1: {\n        equipmentType: EquipmentSlotType.legs,\n        itemType,\n        iconImg: `${basePath}pants_1.png`,\n        damageReduction: 3,\n    },\n    pants2: {\n        equipmentType: EquipmentSlotType.legs,\n        itemType,\n        iconImg: `${basePath}pants_2.png`,\n        damageReduction: 3\n    },\n    plateChest1: {\n        equipmentType: EquipmentSlotType.chest,\n        itemType,\n        iconImg: `${basePath}plate_chest_1.png`,\n    },\n    plateChest2: {\n        equipmentType: EquipmentSlotType.chest,\n        itemType,\n        iconImg: `${basePath}plate_chest_2.png`,\n    },\n    plateChest3: {\n        equipmentType: EquipmentSlotType.chest,\n        itemType,\n        iconImg: `${basePath}plate_chest_3.png`,\n    },\n    plateChest4: {\n        equipmentType: EquipmentSlotType.chest,\n        itemType,\n        iconImg: `${basePath}plate_chest_4.png`,\n    },\n    plateGloves1: {\n        equipmentType: EquipmentSlotType.hands,\n        itemType,\n        iconImg: `${basePath}plate_gloves_1.png`,\n    },\n    plateGloves2: {\n        equipmentType: EquipmentSlotType.hands,\n        itemType,\n        iconImg: `${basePath}plate_gloves_2.png`,\n    },\n    plateHelmet: {\n        equipmentType: EquipmentSlotType.head,\n        itemType,\n        iconImg: `${basePath}plate_helmet_1.png`,\n    },\n    platePants: {\n        equipmentType: EquipmentSlotType.legs,\n        itemType,\n        iconImg: `${basePath}plate_pants1.png`,\n    },\n    plateShoulders1: {\n        equipmentType: EquipmentSlotType.shoulders,\n        itemType,\n        iconImg: `${basePath}plate_shoulders_1.png`,\n    },\n    plateShoulders2: {\n        equipmentType: EquipmentSlotType.shoulders,\n        itemType,\n        iconImg: `${basePath}plate_shoulders_2.png`,\n    },\n    robe: {\n        equipmentType: EquipmentSlotType.chest,\n        itemType,\n        iconImg: `${basePath}robe_1.png`,\n    },\n    shoulders1: {\n        equipmentType: EquipmentSlotType.shoulders,\n        itemType,\n        iconImg: `${basePath}shoulders_1.png`,\n    },\n    shoulders2: {\n        equipmentType: EquipmentSlotType.shoulders,\n        itemType,\n        iconImg: `${basePath}shoulders_2.png`,\n        damageReduction: 2\n    },\n    shoulders3: {\n        equipmentType: EquipmentSlotType.shoulders,\n        itemType,\n        iconImg: `${basePath}shoulders_3.png`,\n    },\n    studdedLeatherShoulderguards: {\n        equipmentType: EquipmentSlotType.shoulders,\n        itemType,\n        iconImg: `${basePath}studded_leather_shoulderguards.png`,\n    },\n    sunchaserBritches: {\n        equipmentType: EquipmentSlotType.legs,\n        itemType,\n        iconImg: `${basePath}sunchaser_britches.png`,\n    },\n    sunchaserGloves: {\n        equipmentType: EquipmentSlotType.hands,\n        itemType,\n        iconImg: `${basePath}sunchaser_gloves.png`,\n    },\n    sunchaserHelm: {\n        equipmentType: EquipmentSlotType.head,\n        itemType,\n        iconImg: `${basePath}sunchaser_helm.png`,\n    },\n    sunchaserMantle: {\n        equipmentType: EquipmentSlotType.shoulders,\n        itemType,\n        iconImg: `${basePath}sunchaser_mantle.png`,\n    },\n    sunchaserMoccasins: {\n        equipmentType: EquipmentSlotType.feet,\n        itemType,\n        iconImg: `${basePath}sunchaser_moccasins.png`,\n    },\n    sunchaserTunic: {\n        equipmentType: EquipmentSlotType.chest,\n        itemType,\n        iconImg: `${basePath}sunchaser_tunic.png`,\n    },\n    templeGuardChestplate: {\n        equipmentType: EquipmentSlotType.chest,\n        itemType,\n        iconImg: `${basePath}temple_guard_chestplate.png`,\n    },\n    templeGuardGloves: {\n        equipmentType: EquipmentSlotType.hands,\n        itemType,\n        iconImg: `${basePath}temple_guard_gloves.png`,\n    },\n    templeGuardGreaves: {\n        equipmentType: EquipmentSlotType.shoulders,\n        itemType,\n        iconImg: `${basePath}temple_guard_greaves.png`,\n    },\n    templeGuardHelm: {\n        equipmentType: EquipmentSlotType.head,\n        itemType,\n        iconImg: `${basePath}temple_guard_helm.png`,\n    },\n    templeGuardLegplates: {\n        equipmentType: EquipmentSlotType.legs,\n        itemType,\n        iconImg: `${basePath}temple_guard_legplates.png`,\n    },\n    templeGuardPauldrons: {\n        equipmentType: EquipmentSlotType.shoulders,\n        itemType,\n        iconImg: `${basePath}temple_guard_pauldrons.png`,\n    },\n    vest: {\n        equipmentType: EquipmentSlotType.chest,\n        itemType,\n        iconImg: `${basePath}vest_1.png`,\n    },\n};\n\nexport type Apparel = `${Prefix}${keyof typeof apparel}`;\nconst all = Object.entries(apparel).reduce<{[key: string]: ApparelDefinition}>((acc, [key, value]) => {\n    acc[`${PREFIX}${key}`] = value;\n    return acc;    \n}, {}) as Record<Apparel, ApparelDefinition>;\nexport default all;\n\nexport function getDefinition(apparel: Apparel): ApparelDefinition {\n    return all[apparel];\n}\n\nexport const isApparel = (item: Item): item is Apparel => {\n    return !!all[item as Apparel];\n}","import { ILoaderResource, Loader } from \"pixi.js\";\n//todo: any\ninterface Location {\n    x: number;\n    y: number;\n}\n\nexport const lerpLocation = (point1: Location, point2: Location, alpha: number): Location => {\n    const x = lerp(point1.x, point2.x, alpha);\n    const y = lerp(point1.y, point2.y, alpha);\n    return { x, y };\n}\n\nconst lerp = (n1: number,  n2: number,  alpha: number) =>  {\n    return n1 + alpha * (n2 - n1);\n}\n\n// Uses the shared pixi loader to load a resource\nexport async function loadResourceAsync(path: string) { \n    const loader = Loader.shared;\n    return new Promise<ILoaderResource>((resolve, _reject) => {\n        if (loader.resources[path]) {\n            resolve(loader.resources[path]);\n        }\n        else {\n            loader.add(path).load((_, resources) => {\n                resolve(resources[path]);\n            });\n        }\n    });\n}\n\nexport const loadResource = (path: string, callback: (resource: any) => void) => { \n    const loader = Loader.shared;\n    if (loader.resources[path]) {\n        callback(loader.resources[path]);\n        return;\n    }\n    loader.add(path).load((_, resources) => { callback(resources[path]!)});\n}","export type GoldAction = {\n    type: \"addGold\",\n    amount: number\n}\n\nexport const addGold = (amount: number): GoldAction => ({\n    type: \"addGold\",\n    amount,\n})\n\nexport const subtractGold = (amount: number): GoldAction => ({\n    type: \"addGold\",\n    amount: -amount,\n})\n","import { Item, ItemDefinition, ItemType } from \"./types\";\n\ntype Prefix = \"potion/\";\nconst PREFIX = \"potion/\";\nconst itemType = ItemType.potion;\nconst basePath = \"/img/items/potions/\";\n\nexport type PotionCategory = \"health\" | \"soma\" | \"mana\"\nexport interface PotionDefinition extends ItemDefinition {\n    category: PotionCategory;\n}\n\nconst potions = {\n    minorHealth: {\n        category: 'health',\n        itemType,\n        iconImg: `${basePath}minor-health.png`,\n    },\n    minorMana: {\n        category: 'mana',\n        itemType,\n        iconImg: `${basePath}minor-mana.png`,\n    },\n    minorSoma: {\n        category: 'soma',\n        itemType,\n        iconImg: `${basePath}minor-soma.png`,\n    },\n    lesserHealth: {\n        category: 'health',\n        itemType,\n        iconImg: `${basePath}lesser-health.png`,\n    },\n    lesserMana: {\n        category: 'mana',\n        itemType,\n        iconImg: `${basePath}lesser-mana.png`,\n    },\n    lesserSoma: {\n        category: 'soma',\n        itemType,\n        iconImg: `${basePath}lesser-soma.png`,\n    },\n    majorHealth: {\n        category: 'health',\n        itemType,\n        iconImg: `${basePath}major-health.png`,\n    },\n    majorMana: {\n        category: 'mana',\n        itemType,\n        iconImg: `${basePath}major-mana.png`,\n    },\n    majorSoma: {\n        category: 'soma',\n        itemType,\n        iconImg: `${basePath}major-soma.png`,\n    },\n    greaterHealth: {\n        category: 'health',\n        itemType,\n        iconImg: `${basePath}greater-health.png`,\n    },\n    greaterMana: {\n        category: 'mana',\n        itemType,\n        iconImg: `${basePath}greater-mana.png`,\n    },\n    greaterSoma: {\n        category: 'soma',\n        itemType,\n        iconImg: `${basePath}greater-soma.png`,\n    },\n}\n\nexport type Potion = `${Prefix}${keyof typeof potions}`;\nconst all = Object.entries(potions).reduce<{[key: string]: PotionDefinition}>((acc, [key, value]) => {\n    acc[`${PREFIX}${key}`] = value as PotionDefinition;\n    return acc;    \n}, {}) as Record<Potion, PotionDefinition>;\nexport default all;\n\nexport function getDefinition(potion: Potion): PotionDefinition {\n    return all[potion];\n}\n\nexport const isPotion = (item: Item): item is Potion => {\n    return !!all[item as Potion];\n}"],"sourceRoot":""}