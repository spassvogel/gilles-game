{"version":3,"sources":["global/TextManager.ts","definitions/enemies/types.ts","components/ui/adventurer/EquipmentSlot/utils.ts","components/ui/adventurer/EquipmentSlot/EquipmentSlot.tsx","definitions/weaponTypes/types.ts","utils/format/time.ts","store/types/scene.ts","global/SoundManager.ts","definitions/items/types.ts","constants/items.ts","components/ui/common/Icon/utils.ts","components/ui/common/Icon/Icon.tsx","definitions/quests/types.ts","constants/dragging.ts","store/actions/quests.ts","hooks/store/adventurers.ts","definitions/items/index.ts","utils/routing.ts","store/actions/adventurers.ts","definitions/abilities/types.ts","mechanics/adventurers/attributes.ts","definitions/effects/types.ts","mechanics/adventurers/levels.ts","utils/tilemap.ts","definitions/items/weapons.ts","global/ToastManager.tsx","components/ui/toasts/Toast.tsx","mechanics/combat.ts","definitions/traits/types.ts","store/helpers/storeHelpers.ts","store/types/logEntry.ts","definitions/tempEffects/types.ts","store/types/adventurer.ts","utils/typescript.ts","definitions/items/apparel.ts","store/types/quest.ts","definitions/items/consumables.ts","global/BubbleManager.ts","definitions/quests/index.ts","definitions/quests/kill10Boars/index.ts","definitions/quests/retrieveMagicAmulet/index.ts","utils/pixiJs.ts","store/actions/log.ts","utils/random.ts","definitions/items/ammunition.ts","definitions/weaponTypes/index.ts","definitions/items/deeds.ts","mechanics/adventurers/hitpoints.ts","definitions/enemies/trolls.ts","definitions/enemies/index.ts","store/actions/gold.ts","definitions/items/questItems.ts","constants/text.ts","utils/aStar.ts","mechanics/scenes/BaseSceneController.ts","global/SceneControllerManager.ts","definitions/tempEffects/index.ts","definitions/items/herbs.ts","definitions/items/materials.ts","definitions/items/minerals.ts","definitions/items/trinkets.ts","store/reducers/adventurers.ts","utils/math.ts","constants/tiledMapData.ts","definitions/quests/kill10Boars/questVars.ts","definitions/effects/index.ts","definitions/quests/kill10Boars/encounters/dungeon.ts","registerServiceWorker.ts","definitions/structures/types.ts","store/actions/game.ts","utils/version.ts","constants/version.ts","mechanics/resources.ts","definitions/structures/alchemist.ts","definitions/resources/index.ts","definitions/structures/armoursmith.ts","definitions/structures/garden.ts","definitions/structures/lumberMill.ts","definitions/structures/mine.ts","definitions/structures/quarry.ts","definitions/structures/tannery.ts","definitions/structures/tavern.ts","definitions/structures/warehouse.ts","definitions/structures/weaponsmith.ts","definitions/structures/weaver.ts","definitions/structures/workshop.ts","mechanics/time.ts","definitions/structures/index.ts","store/selectors/resources.ts","mechanics/gameTick/producedResources.ts","mechanics/gameTick/quests.ts","mechanics/gameTick/rngState.ts","mechanics/lootTable.ts","store/types/structure.ts","mechanics/gameTick/harvest.ts","store/reducers/engine.ts","store/reducers/game.ts","store/reducers/stockpile.ts","store/reducers/log.ts","store/reducers/quests.ts","store/reducers/resources.ts","store/reducers/rngState.ts","store/reducers/settings.ts","store/reducers/structures.ts","store/types/task.ts","store/reducers/tasks.ts","store/reducers/index.ts","store/reducers/gold.ts","store/reducers/workers.ts","utils/configureStore.ts","store/middleware/effects.ts","store/middleware/utils.ts","store/middleware/traits.ts","mechanics/gameTick/tasks.ts","components/ui/loading/LoadingSpinner.tsx","utils/pixiJs/hitAreaShapes.ts","hoc/withAppContext.tsx","components/pixi/Viewport.tsx","components/App/styles/img/cursors/dwarven_gauntlet_extra_6.png","components/pixi/util/BridgedStage.tsx","components/town/TownStage.tsx","components/ui/buttons/Button/Button.tsx","components/town/Clouds.tsx","components/ui/common/progress/PlainProgressbar.tsx","hooks/store/structures.ts","components/ui/window/Window.tsx","hoc/withWindow.tsx","components/ui/common/progress/TickingProgressbar.tsx","hooks/store/engine.ts","hooks/usePrevious.ts","constants/context.ts","store/selectors/tasks.ts","hooks/store/useTasksState.ts","components/structures/StructureViewHeader.tsx","components/ui/buttons/IconButton/IconButton.tsx","components/structures/StructureLevel.tsx","global/TooltipManager.ts","components/ui/items/ItemIcon/utils.ts","components/ui/items/ItemIcon/ItemIcon.tsx","components/ui/common/UpDownValue/index.tsx","hooks/store/stockpile.ts","components/ui/items/ItemsBox.tsx","hooks/store/resources.ts","hooks/store/useGoldState.ts","components/structures/production/ResourcesCost.tsx","store/selectors/workers.ts","hooks/store/useWorkersState.ts","mechanics/crafting.ts","definitions/production/weaponsmith.ts","definitions/production/armoursmith.ts","definitions/production/workshop.ts","definitions/production/index.ts","store/actions/stockpile.ts","store/actions/resources.ts","store/actions/structures.ts","store/actions/tasks.ts","components/structures/production/CraftingDetails.tsx","components/structures/production/CraftingArea.tsx","components/structures/UpgradeHelpModal.tsx","components/structures/production/UpgradeHelpModalContent.tsx","components/structures/production/ProductionStructureView.tsx","utils/format/number.ts","components/structures/warehouse/ResourcesBox.tsx","store/types/resources.ts","components/ui/tabs/Tabstrip.tsx","components/ui/tabs/Tab.tsx","components/ui/adventurer/AdventurerAvatar/AdventurerAvatar.tsx","components/world/QuestPanel/AdventurerTabstrip.tsx","components/ui/inventory/InventorySlot.tsx","components/ui/items/DraggableItemIcon.tsx","components/ui/inventory/Inventory.tsx","components/world/QuestPanel/context/SceneControllerContext.tsx","hooks/actions/useItemActions.ts","components/ui/adventurer/AdventurerPanel/Level.tsx","utils/reselect.ts","hooks/store/quests.ts","components/ui/adventurer/AdventurerPanel/ApIndicator.tsx","definitions/traits/index.ts","components/ui/adventurer/AdventurerPanel/AdventurerTraits/AdventurerTraits.tsx","components/ui/adventurer/AdventurerPanel/AdventurerEquipment/Guy/Guy.tsx","components/ui/adventurer/AdventurerPanel/AdventurerEquipment/AdventurerEquipment.tsx","components/ui/adventurer/AdventurerPanel/Health.tsx","components/ui/adventurer/AdventurerPanel/ConsumeItemSlot.tsx","components/ui/adventurer/AdventurerPanel/ConsumeItem.tsx","components/ui/adventurer/AdventurerPanel/AdventurerEffects/EffectIcon.tsx","components/ui/adventurer/AdventurerPanel/AdventurerEffects/AdventurerTempEffects.tsx","components/ui/attributes/AttributeIndicator.tsx","components/ui/attributes/AttributeList/AttributeListItems.tsx","components/ui/attributes/AttributeList/AttributeList.tsx","components/ui/skills/SkillsList/SkillsListItems.tsx","components/ui/adventurer/AdventurerPanel/AdventurerAttributesAndSkills/AdventurerAttributesAndSkills.tsx","components/ui/adventurer/AdventurerPanel/AdventurerPanel.tsx","components/ui/adventurer/AdventurerPanel/AdventurerSectionSelection.tsx","components/ui/adventurer/AdventurerPanel/styles/images/icon-person.png","components/ui/adventurer/AdventurerPanel/styles/images/icon-crosshair.png","components/ui/adventurer/AdventurerPanel/styles/images/icon-helmet.png","components/ui/adventurer/AdventurerPanel/styles/images/icon-sword.png","components/structures/warehouse/UpgradeHelpModalContent.tsx","components/structures/warehouse/Stockpile.tsx","components/structures/warehouse/WarehouseStructureView.tsx","components/ui/adventurer/DroppableAdventurerSlot/index.tsx","components/structures/tavern/AssignAdventurers.tsx","components/structures/tavern/QuestBoard.tsx","components/structures/tavern/rooms/AdventurerButton.tsx","components/ui/adventurer/DraggableAdventurerAvatar/index.tsx","components/structures/tavern/rooms/RoomWithAdventurer.tsx","components/structures/tavern/rooms/RoomEmpty.tsx","components/structures/tavern/rooms/RoomList.tsx","components/structures/tavern/UpgradeHelpModalContent.tsx","components/structures/tavern/TavernStructureView.tsx","components/structures/resource/ResourceGenerationRow.tsx","components/ui/items/DraggableItemsList/ItemText.tsx","components/ui/items/DraggableItemsList/DraggableItemsList.tsx","components/structures/resource/HarvestProgress.tsx","components/structures/styles/images/warehouse/icon.png","components/structures/resource/UpgradeHelpModalContent.tsx","components/structures/resource/ResourceStructureView.tsx","components/town/StructureDetailsView/StructureDetailsView.tsx","components/town/StructureDetailsView/RoutedStructureDetailsView.tsx","components/structures/styles/images/alchemist/icon.png","components/structures/styles/images/armoursmith/icon.png","components/structures/styles/images/garden/icon.png","components/structures/styles/images/lumberMill/icon.png","components/structures/styles/images/mine/icon.png","components/structures/styles/images/quarry/icon.png","components/structures/styles/images/tannery/icon.png","components/structures/styles/images/tavern/icon.png","components/structures/styles/images/weaponsmith/icon.png","components/structures/styles/images/weaver/icon.png","components/structures/styles/images/workshop/icon.png","components/town/StructureLabels/StructureIconSprite.tsx","components/town/StructureLabels/StructureLabel.tsx","components/town/StructureLabels/StructureLabels.tsx","components/town/structures/LumberMill/LumberMill.tsx","components/pixi/ParticleEmitter.ts","components/town/structures/Tavern/index.tsx","components/town/structures/Generic/index.tsx","components/town/TownView/utils.ts","components/town/TownView/TownView.tsx","components/ui/toasts/Toasts.tsx","store/actions/settings.ts","hooks/store/settings.ts","components/ui/window/windows/SettingsWindow.tsx","constants/resources.ts","components/ui/common/Select/index.tsx","components/world/QuestPanel/QuestDetails/scene/SceneActor/utils.ts","components/ui/window/windows/CheatWindow.tsx","store/actions/workers.ts","store/selectors/adventurers.ts","components/ui/game/GameStats.tsx","utils/game.ts","components/ui/window/windows/SaveAndLoadWindow.tsx","components/ui/window/windows/MenuWindow.tsx","components/ui/topbar/Resourcebar.tsx","components/ui/topbar/Topbar.tsx","components/world/WorldMap/MapGrid.tsx","components/world/WorldMap/QuestMarker.tsx","components/world/WorldMap/QuestLine.tsx","components/world/WorldMap/DebugToggleCombat.tsx","components/world/WorldMap/utils.ts","components/world/WorldMap/WorldMap.tsx","components/pixi/tile/RectTileLayer.tsx","components/pixi/tile/ObjectTileLayer.tsx","components/pixi/tile/SpriteAnimated.tsx","mechanics/scenes/CombatController.ts","components/world/QuestPanel/QuestDetails/scene/SceneActor/useAnimation.ts","components/world/QuestPanel/QuestDetails/scene/SceneActor/useFrames.ts","components/world/QuestPanel/QuestDetails/scene/SceneActor/SceneActor.tsx","components/world/QuestPanel/QuestDetails/scene/SceneActor/useRandomOrientation.ts","components/world/QuestPanel/QuestDetails/scene/SceneAdventurer.tsx","components/world/QuestPanel/QuestDetails/scene/SceneEnemy.tsx","components/world/QuestPanel/QuestDetails/scene/Tilemap/ObjectSpriteLayer.tsx","components/world/QuestPanel/QuestDetails/scene/Tilemap/SceneEffectLayer.tsx","components/world/QuestPanel/QuestDetails/scene/Tilemap/Tilemap.tsx","components/world/QuestPanel/QuestDetails/scene/Tilemap/utils.ts","hooks/useTilesetsLoader.ts","components/ui/bubbles/Bubbles.tsx","components/world/QuestPanel/QuestDetails/scene/ui/hooks/useCanvasScaler.ts","components/world/QuestPanel/QuestDetails/scene/ui/NormalUICursor.tsx","components/world/QuestPanel/QuestDetails/scene/ui/CombatUIWidget/CombatUIWidget.tsx","components/world/QuestPanel/QuestDetails/scene/ui/ActionMenu/ActionButton.tsx","components/ui/enemy/EnemyAvatar/EnemyAvatar.tsx","components/world/QuestPanel/QuestDetails/scene/ui/ActionMenu/DiamondFrame.tsx","hooks/store/useDraggable.ts","components/world/QuestPanel/QuestDetails/scene/ui/ActionMenu/ActionMenu.tsx","definitions/abilities/index.ts","components/world/QuestPanel/QuestDetails/scene/ui/hooks/useActionIntents.ts","components/world/QuestPanel/QuestDetails/scene/ui/AdventurerCombatSceneUI.tsx","components/world/QuestPanel/QuestPanel.tsx","components/world/QuestPanel/QuestDetails/scene/ui/SceneUI.tsx","utils/interaction.ts","components/pixi/DashedLine.ts","components/world/QuestPanel/QuestDetails/scene/ActionPreview.tsx","hooks/store/useLog.ts","components/world/QuestPanel/QuestDetails/scene/SceneLog.tsx","components/world/QuestPanel/QuestDetails/scene/SceneDebug.tsx","components/world/QuestPanel/QuestDetails/scene/Scene.tsx","components/world/QuestPanel/QuestDetails/OnTheRoad.tsx","components/world/QuestPanel/QuestDetails/index.tsx","components/ui/adventurer/DroppableAdventurerAvatar/index.tsx","components/world/QuestPanel/modals/LootCache/LootCache.tsx","components/world/QuestPanel/modals/Situation/index.tsx","components/world/QuestPanel/CombatBar/CombatBar.tsx","components/world/QuestPanel/AdventurersPanel.tsx","components/ui/accordion/context/AccordionContext.tsx","components/ui/accordion/Accordion.tsx","components/ui/accordion/AccordionItem.tsx","components/ui/tooltip/ContextTooltip/context/ActorContext/CombatAttributes.tsx","components/world/QuestPanel/ActorsAccordion/ActorsAccordionAdventurerItem.tsx","components/world/QuestPanel/ActorsAccordion/ActorsAccordionEnemyItem.tsx","components/world/QuestPanel/ActorsAccordion/ActorsAccordion.tsx","components/log/SimpleLog.tsx","components/world/WorldView.tsx","utils/markdown.ts","components/markdown/ItemElement.tsx","components/markdown/Markdown.tsx","components/ui/tooltip/Tooltip/index.tsx","components/ui/tooltip/ContextTooltip/context/ItemContext/DeedContent.tsx","mechanics/studying.ts","components/ui/tooltip/ContextTooltip/context/ItemContext/common/ProduceOrStudy/ProducedAtStructure.tsx","components/ui/tooltip/ContextTooltip/context/ItemContext/common/ProduceOrStudy/ProduceOrStudy.tsx","components/ui/tooltip/ContextTooltip/context/ItemContext/WeaponContent/DamageList.tsx","components/ui/tooltip/ContextTooltip/context/TempEffectContext/getEffectDescription.ts","components/ui/tooltip/ContextTooltip/context/ItemContext/Effects.tsx","components/ui/tooltip/ContextTooltip/context/ItemContext/WeaponContent/AbilitiesList.tsx","components/ui/tooltip/ContextTooltip/context/ItemContext/WeaponContent/WeaponContent.tsx","components/ui/tooltip/ContextTooltip/context/ItemContext/ApparelContent.tsx","components/ui/tooltip/ContextTooltip/context/ItemContext/ConsumableContent.tsx","components/ui/tooltip/ContextTooltip/context/ItemContext/ItemContext.tsx","components/ui/tooltip/ContextTooltip/context/ResourceContext/index.tsx","components/ui/modals/InfoWindow/index.tsx","components/App/App.tsx","components/ui/tooltip/ContextTooltip/context/TraitContext/index.tsx","components/ui/tooltip/ContextTooltip/context/AttributeContext/AttributeContext.tsx","components/ui/tooltip/ContextTooltip/context/AttributeContext/utils.ts","components/ui/tooltip/ContextTooltip/context/ActorContext/AdventurerContext.tsx","components/ui/tooltip/ContextTooltip/context/ActorContext/EnemyContext.tsx","components/ui/tooltip/ContextTooltip/context/ActorContext/ActorContext.tsx","components/ui/tooltip/ContextTooltip/context/TempEffectContext/getTempEffectDescription.ts","components/ui/tooltip/ContextTooltip/context/TempEffectContext/index.tsx","components/ui/tooltip/ContextTooltip/utils.ts","components/ui/tooltip/ContextTooltip/ContextTooltip.tsx","components/Game/context.ts","components/debug/DebugItems/DebugItemsList.tsx","components/debug/DebugItems/DebugItems.tsx","components/debug/DebugSprites/DebugSpriteDemo.tsx","components/debug/DebugSprites/DebugSprites.tsx","components/debug/DebugAdventurers/AdventurersOverview.tsx","components/debug/DebugAdventurers/AdventurerXpInput.tsx","components/debug/DebugAdventurers/DebugAdventurerEdit.tsx","components/debug/DebugAdventurers/DebugAdventurers.tsx","components/debug/DebugContext/DebugContextTown.tsx","components/debug/DebugContext/DebugContextWorld.tsx","components/debug/DebugContext/DebugContext.tsx","components/debug/DebugView/DebugView.tsx","components/debug/DebugDrawer.tsx","components/Game/Game.tsx","components/ui/error/ErrorModal.tsx","index.tsx"],"names":["TextManager","texts","precompile","this","templates","notFound","compileAll","initialized","key","context","result","getDefault","console","error","decode","Error","template","getTemplate","textEntry","get","compile","ability","WeaponAbility","adventurerId","adventurerName","name","attribute","enemyType","slotType","toKebab","EquipmentSlotType","quest","sceneName","type","itemOrItemType","isItemType","itemCategory","ItemCategory","item","rarity","Rarity","structure","trait","effect","props","rest","EffectType","TempEffectType","Type","WeaponType","weaponClass","WeaponClassification","length","log","join","Object","keys","forEach","value","Handlebars","itemArticleDefined","getItemName","articleTemplate","noun","itemArticleAuto","itemArticleUndefined","article","itemType","getDefinition","JSON","stringify","link","getStructureLink","resource","getAdventurerName","actor","startsWith","ADVENTURER_PREFIX","checkIfEnemy","getEnemyName","substring","indexOf","itemAndEquipmentSlotMatch","equipmentSlotType","chest","feet","hands","head","legs","equipmentType","itemDefinition","apparel","checkEquipment","mainHand","offHand","ammunition","weapon","getWeaponTypeDefinition","weaponType","classification","oneHanded","shield","rangedWeaponInHand","equipment","mainHandItem","isWeapon","getWeaponDefinition","ranged","EquipmentSlot","onDrop","adventurer","useAdventurer","useDrop","accept","DragType","ITEM","drop","info","collect","monitor","getItem","canDrop","isOver","dropRef","className","push","title","ref","children","DamageType","FIVE_SECONDS","ONE_MINUTE","TWO_MINUTES","THREE_MINUTES","FOUR_MINUTES","HALF_HOUR","ONE_HOUR","ONE_DAY","ONE_YEAR","formatDuration","ms","short","timeUnitsList","unit","amount","time","Math","abs","output","el","tmp","floor","formatDateTime","Date","toLocaleTimeString","Allegiance","SceneActionType","isActorObject","object","TiledObjectType","isAdventurer","allegiance","player","isEnemy","enemy","getAdventurer","objects","find","o","getUniqueName","enemyId","Channel","MixMode","Music","STORAGE_KEY_VOLUME","SoundManager","music","localforage","ui","scene","ambient","_channelVolume","_initialized","gameSound","files","complete","promise","Promise","resolve","_reject","_sounds","loader","Loader","map","file","add","load","_","resources","values","filter","Boolean","r","sound","channel","loop","mixMode","singleInstance","storePosition","init","pixiSound","getSound","warn","volume","_currentSound","oldSoundInfo","instance","once","progress","duration","_storedPositions","start","play","fade","fadeOutSound","gsap","from","stop","on","destroy","random","soundInfo","to","onComplete","filters","_filter","setItem","TelephoneFilter","test","prototype","hasOwnProperty","call","IconSize","Border","sizeClassName","size","smallest","small","medium","big","biggest","borderClassName","border","gold","none","Icon","image","restProps","style","process","QuestNodeType","DragSourceType","ADVENTURER","launchQuest","questName","assignedAventurers","exitEncounter","updateQuestVars","vars","setSceneName","setScene","enqueueSceneAction","sceneAction","completeSceneAction","actorName","setCombat","combat","endPlayerTurn","startTurn","turn","adventurers","deductActorAp","ap","modifyEnemyHealth","health","setActiveSceneInteractionModal","sceneInteractionModal","useAdventurersInTown","useSelector","store","quests","adventurersInTown","useMemo","adventurersOnQuest","reduce","acc","val","status","QuestStatus","active","party","a","id","getAdventurersInTown","useAdventurers","adventurerSelector","useCallback","state","q","useAdventurerDamageReduction","findDR","damageReduction","shoulders","all","consumables","deeds","herbs","materials","minerals","questItems","trinkets","weapons","getWeaponOrApparelDefinition","isApparel","getApparelDefinition","getAllItemsByCategory","category","deed","herb","material","mineral","consumable","questItem","trinket","canStackItem","getWorldLink","getQuestLink","getTownLink","onlyHighlight","modifyHealth","consumeItem","fromSlot","moveItemInInventory","toSlot","addItemToInventory","removeItemFromInventory","assignEquipment","equipmentSlot","removeEquipment","changeEquipmentQuantity","quantity","addTempEffect","tempEffect","decreaseEffectCharge","setBasicAttributes","basicAttributes","renameAdventurer","addXp","xp","AttributeSourceType","MIN_VALUE","MAX_VALUE","generateBaseAttributes","origin","base","str","for","int","agi","calculateEffectiveAttributesExtended","collectEffects","attributeIncrease","effectSource","EffectSourceType","tempEffectType","convertOrigin","source","factor","calculateEffectiveAttributes","extended","xpToLevel","sqrt","levelToXp","level","pow","MAX_XP","parseProperties","properties","findTileset","gid","tilesets","tileset","i","firstgid","addAllTilesInLayerToList","list","layer","columns","data","tile","index","x","y","locationEquals","b","basePath","aegisOfValor","legendary","iconImg","arbalest","crossbow","epic","damage","kinetic","battleAxe","axe","common","boneBow","bow","berserkerShield","brassKnuckles","fist","bronzeDagger","knife","buckler","cleaver","club","dagger","rare","dirk","uncommon","falchion","sword","flail","goldenShield","greatswordOfGwai","unique","effects","halbert","poleArm","huntingBow","indomitableCarapace","jaggedBlade","javelin","khopesh","legionnaireSword","longbow","mace","morningStar","oakWoodBow","paintedBuckler","poisonedDagger","pikeStaff","ravenStaff","staff","scythe","savageStaff","simpleCrossbow","spear","steelShield","steelSword","warhammer","hammer","woodenBulwark","entries","EVENT_TOASTS_UPDATED","ToastManager","icon","stack","now","emit","playSound","setTimeout","toast","lifeTime","_instance","EventEmitter","Toast","achievementUnlocked","navigate","useNavigate","typeText","getToastType","onClick","AP_COST_MOVE","AP_COST_CONSUME","AP_COST_MELEE","AP_COST_SHOOT","ENEMY_BASE_AP","calculateInitialAP","attributes","calculateDodge","rollToHit","weaponSkill","roll","roll3D6","rollToDodge","randomInt","rollBodyPart","bodyParts","weightedRoll","Trait","findQuestByAdventurer","some","findAdventurerById","getQuestLeader","leaderId","adventurerFreeInventorySlots","inventory","adventurerWeapons","check","slot","adventurerAmmo","isAmmunition","undefined","getSceneObjectAtLocation","location","additionalFilter","getSceneObjectWithName","sA","storeIsRehydrated","engine","gameStarted","LogChannel","AdventurerColor","attributeList","obj","prop","listEnum","enumeration","v","isNaN","Number","crimsonRogueEffect","definitions","boots1","boots2","boots3","chainmailHood","clothGloves","cowl","cultistBoots","crimsonRogueBoots","crimsonRogueBritches","crimsonRogueCoif","crimsonRogueGrips","crimsonRogueSpaulders","crimsonRogueTunic","cultistGloves","cultistPants","cultistRobe","cultistShoulderwraps","darkPrinceBracers","darkPrinceCape","darkPrinceCuirass","darkPrinceHood","darkPrinceSarong","darkPrinceSlippers","dreadnoughtBoots","dreadnoughtChest","dreadnoughtGauntlets","dreadnoughtHelm","dreadnoughtLegplates","dreadnoughtPauldrons","druidChest","druidFeet","druidHands","druidHead","druidLegs","fedora","footmanBoots","footmanBreastplate","footmanFaceguard","footmanFists","footmanLegplates","footmanPauldrons","greaves1","greaves2","hornedHelmet","leatherGloves","naturalistsCape","naturalistsCowl","naturalistsFootwraps","naturalistsVambraces","naturalistsVest","nomadHelmet","pants1","pants2","plateChest1","plateChest2","plateChest3","plateChest4","plateGloves1","plateGloves2","plateHelmet","platePants","plateShoulders1","plateShoulders2","robe","shoulders1","shoulders2","shoulders3","studdedLeatherShoulderguards","sunchaserBritches","sunchaserGloves","sunchaserHelm","sunchaserMantle","sunchaserMoccasins","sunchaserTunic","templeGuardChestplate","templeGuardGloves","templeGuardGreaves","templeGuardHelm","templeGuardLegplates","templeGuardPauldrons","vest","witchhunterBoots","witchhunterBritches","witchhunterCape","witchhunterGambeson","witchhunterGrips","witchhunterHat","minorHealthPotion","minorManaPotion","minorSoma","lesserHealthPotion","lesserManaPotion","lesserSoma","majorHealthPotion","majorManaPotion","majorSoma","greaterHealthPotion","greaterManaPotion","greaterSoma","isConsumable","BubbleType","BubbleLayer","EVENT_BUBBLE_ADDED","BubbleManager","text","point","bubbleType","general","kill10Boars","getQuestVars","questStore","questVars","getInitialQuestVars","_questStore","initialQuestVars","nodes","encounter","startScene","nothing","retrieveMagicAmulet","baz","zux","requiredItems","lerpLocation","point1","point2","alpha","lerp","loadResourceAsync","path","shared","loadResource","callback","addLogText","channelContext","entry","addLogEntry","generator","dirty","seed","seedrandom","min","max","ceil","probabilities","cumulative","found","ammunitions","armorPiercingArrows","basicArrows","crossbowBolts","elfenArrows","abilities","cut","shoot","swing","parry","twoHanded","block","alchemist","armoursmith","lumbermill","tavern","weaponsmith","workshop","isDeed","calculateBaseHitpoints","fortitude","avatarImgBasePath","trolls","skills","armor","spritesheet","avatarImg","addGold","subtractGold","blueprints","crate","dynamite","dragonEye","eye","feather","food","heart","horn","letters","lockPicks","oil","orcFinger","plans","purpleGems","runestone","sandwich","teeth","tooth","torch","tusk","vase","vial","weeds","isQuestItem","isTextEntry","convertIn","l","convertOut","input","actorSpritesheetBasePath","effectSpritesheetBasePath","movementDuration","EVENT_SCENE_EFFECT","BaseSceneController","mapData","aStar","dataLoading","dataLoadComplete","jsonPath","blockedTiles","tileTypes","promises","addSound","createBlockedTiles","createTileTypes","createAStar","actorSpritesheetPaths","effectSpritesheetPaths","utils","clearTextureCache","layers","visible","p","width","blocksMovement","tiles","createObjects","updateScene","sceneObjects","dispatch","tileWidth","tilewidth","tileHeight","tileheight","destination","getObjectAtLocation","portal","exit","node","getSceneAdventurer","interactWithObject","intent","action","move","endsAt","performance","otherAdventurers","sceneAdventurers","availableLocations","findEmptyLocationsAround","otherAdventurer","getAdventurerByActor","closestPath","findClosestPath","otherIntent","delay","interact","slice","interactAction","melee","meleeAction","shootAction","locations","findPath","_actor","_object","Point","height","_name","lootCache","getLootCache","itemIndex","items","getAdventurerById","discardItem","_situation","_adventurerId","_option","target","includeLast","grid","getGrid","getGridNodes","matrix","c","getIsWalkable","tempAStar","AStarFinder","includeStartNode","heuristic","weight","results","radius","getTop","getRight","getBottom","getLeft","filtered","locationIsBlocked","weaponWithAbility","ammo","actorAP","apCost","calculateWalkApCosts","isValid","findPathNearest","actorId","sceneActors","s","row","blocked","objectLayers","TiledLayerType","objectgroup","objectLayer","layerId","sceneNamePrev","getAdventurers","round","adventurerObject","isSprite","spritesheetPath","enemySpawn","definition","getEnemyDefinition","toString","getState","settings","updated","storeState","getEnemyByActor","getTextEntry","addToast","questUpdate","sceneLocationToPoint","set","addBubble","effectPath","SceneControllerManager","controllerType","controllerTypes","require","getEffects","t","brokenLegs","healthDecreaseOnMove","burning","healthDecreaseOverTime","interval","soma","createTempEffect","angelicasSorrow","bansheeReeds","blissflower","bloodLotus","bogroot","ceviorise","chicory","dragonroot","heartsVine","hyacinthus","jaboticaba","kingsrose","lastSupper","mistagold","monksweed","moonFlower","mountainGrass","oakLeaf","patricksroot","sunleaf","trollsFeast","uwolic","wyrmvine","winterWeed","wizardsBane","arrowheads","beam","bolts","buckle","chain","cogs","gunpowder","ingot","nails","pile","planks","poisonVial","pulley","ribbon","rope","runeCarvedPlank","scales","spring","stake","stick","thread","woodenMask","amethyst","aquamarine","arminsHeart","dragonsTooth","greenOpal","jasper","malachite","moonstone","obsidian","roseQuartz","sapphire","spellstone","tigersEye","topaz","wyrdstone","magicAmulet","ring","generateRandomAttributes","generateAttributesHealthAndXp","initialAdventurers","durability","room","flavor","traits","houseMaddox","gloomy","color","purple","tempEffects","teal","houseHouston","black","charges","arrowFinder","houseMonroe","element","fromAdventurerId","toAdventurerId","fromAdventurer","concat","findIndex","tE","oldLevel","newLevel","n1","n2","clamp","Orientation","RenderOrder","dungeon","entered","entrance","chestOpen","hallway","doorOpen","harmful","filterType","e","DungeonEncounterSceneController","DungeonCanyonSceneController","DungeonEntranceSceneController","previousMusic","situation","getCurrentlyPlaying","DungeonHallwaySceneController","choices","option","discardItemType","interactive","part","DungeonHub1Controller","registerSceneController","isLocalhost","window","hostname","match","registerValidSW","swUrl","navigator","serviceWorker","register","then","registration","onupdatefound","installingWorker","installing","onstatechange","controller","catch","URL","href","addEventListener","fetch","response","headers","ready","unregister","reload","checkValidServiceWorker","StructureType","reduceTime","percentage","what","loadGame","convertIntToSemVer","version","asInt","semVer","parts","split","numericVersion","convertSemVerToInt","RESOURCE_INTERVAL","Resource","production","cost","levels","displayName","workerCapacity","unlocks","wood","iron","stone","garden","generates","harvest","lootTable","lumberMill","mine","quarry","tannery","leather","rooms","warehouse","maxResources","fabric","maxStockpile","weaver","TimeType","isProductionStructure","isResourceStructure","getStructureByResource","cheatTimeMultiplier","getTimeMultiplier","cheat","selectMaxResources","createSelector","structures","getProducedResources","lastProducedUpdate","timeMultiplier","resourceGeneration","structureDefinition","resourceStructureDefinition","levelDefinition","accumulator","workers","handleStructure","getQuestUpdates","delta","questProgress","initializeScene","questTitle","getQuestTitle","leader","questEncounter","questDefinition","currentProgress","currentNodeIndex","currentNode","progressIncrease","nextProgress","nodesPassed","nextNode","logUpdates","questUpdates","getRngState","Random","pick","table","totalWeight","randomNumber","StructureState","HARVEST_INTERVAL","getHarvest","lastHarvest","itemCount","getInitialEngineState","previousTick","lastTick","initialGameState","Version","getRandomItemTypeByCategory","getInitialStockpile","itemCategoryName","randomItem","initialLogState","overwriteMerge","sourceArray","initialQuestState","encounterResults","initialResourcesState","initialRngState","initialSettingsState","verboseCombatLog","debugEnableDebugDrawer","debugSceneShowPathable","debugSceneShowCellLocations","debugSceneShowActionQueue","TaskType","updateStructureState","structureState","structureStore","structureInitialState","NotBuilt","initialStructuresState","produces","Built","createTask","taskType","callbacks","timeRemaining","startTime","initialTasksState","completed","running","combinedReducer","combineReducers","resourcesToAdd","timeLeft","game","ignoreVersionDiff","stockpile","getItemDefinition","stockpileCategory","logEntries","lU","qss","deepmerge","arrayMerge","actionQueue","aq","aQ","adventurerInStore","activeInteractionModal","questsToUpdate","questToUpdate","addResources","resourcesToRemove","rngState","assign","setting","Building","workersToAdd","workersToRemove","h","structureAsString","tasks","task","end","createInitialStore","rootReducer","persistConfig","storage","localForage","persistedReducer","persistReducer","middlewares","storeApi","next","lastAction","lastAdventurerAction","effectTick","_storeApi","middlewareEnhancer","applyMiddleware","configureStore","initial","reject","composeEnhancers","composeWithDevTools","createStore","persistor","persistStore","isHydrated","processCompletedTasks","craftItem","itemCrafted","handleCompletedTask","LoadingSpinner","Array","HitAreaShapes","shapes","sprite","shape","PIXI","contains","withAppContext","WrappedComponent","AppContext","Consumer","Component","PixiComponentViewport","PixiComponent","create","viewport","PixiViewport","screenWidth","screenHeight","worldWidth","worldHeight","ticker","Ticker","interaction","app","renderer","plugins","event","minScale","maxScale","drag","pinch","wheel","direction","clampZoom","decelerate","Viewport","forwardRef","useApp","cursor","cursorStyles","pointer","BridgedStage","godray","GodrayFilter","options","autoDensity","sharedLoader","TownStage","blockScroll","innerRef","useRef","useImperativeHandle","current","useEffect","enabled","horizontalFactor","normalize","right","verticalFactor","bottom","gain","lacunarity","onScroll","preventDefault","passive","removeEventListener","ButtonSize","ButtonColor","randomCloud","randomY","Clouds","speed","useState","cloud","setCloud","setX","setY","useTick","Direction","Button","square","otherProps","blue","auto","useStructureState","structureSelector","useStructureDefinition","useStructureLevel","Window","musicFiltered","backEnabled","_e","onBack","closeEnabled","onClose","withWindow","React","PlainProgressbar","animationTime","variation","previousProgress","label","transition","useEngine","usePrevious","ContextType","TickingProgressbar","useDelta","animate","setAnimate","increasing","decreasing","getTasks","useCraftingTasksStateByStructure","createSelectCraftingTasksByStructure","useStudyingTasksStateByStructure","createSelectStudyingTasksByStructure","useUpgradeTasksStateByStructure","createSelectUpgradeTasksByStructure","StructureViewHeader","IconButton","StructureLevel","onHelpClicked","useDispatch","nextLevel","upgradeText","upgradeTasks","disabled","EVENT_CONTEXT_UPDATED","TooltipManager","originRect","referenceRect","deepEquals","lastContext","clear","getIconClassName","ItemIcon","showContext","currentTarget","getBoundingClientRect","showContextTooltip","stopPropagation","UpDownValue","displayValue","upDisabled","onUp","downDisabled","onDown","useStockpileState","useStockpileStateFlat","flat","ItemsBox","aggregate","itemsInInventory","tmpWarehouse","tmpItems","splice","removed","listItems","listItemClass","itemDescription","useResourcesState","useMaxResourcesState","useGoldState","ResourcesCost","storeResources","sufficientResources","availableGold","sufficientGold","resourceDescription","resourceDescriptions","getResourceName","selectFreeWorkers","useWorkersFreeState","calculateProductionTime","weaponsmithProduction","levelRequired","armoursmithProduction","workshopProduction","addItemToWarehouse","moveItemInWarehouse","removeItemFromWarehouse","removeResources","finishBuildingStructure","upgradeStructure","increaseWorkers","setStructureState","addItemToToProduces","startTask","CraftingDetails","resourcesState","stockpileState","workersFree","workersAssigned","setWorkersAssigned","getProductionDefinition","costResources","missingAtLeastOneResource","missingAtLeastOneItem","costMaterials","asNumber","craftingTime","makeTimeString","productionDefinition","handleCraft","CraftingArea","selectedItem","setSelectedItem","UpgradeHelpModal","addUpgradeCallbacks","goldCost","missingGold","canUpgrade","town","UpgradeHelpModalContent","ProductionStructureView","craftingTasks","studyingTasks","handleUpgradeCallbacks","content","component","roundIfNeeded","digits","EPSILON","formatNumber","SI_SYMBOL","tier","log10","suffix","scale","scaled","ResourcesBox","deltaResources","querySelector","rect","top","toFixed","full","empty","Tabstrip","activeTab","open","setOpen","Children","child","cloneElement","tabId","onTabSelected","checked","onChange","Tab","AdventurerAvatar","AdventurerTabstrip","onAdventurerTabSelected","selectedAdventurerId","InventorySlot","sourceId","dependencies","canDropHere","dragInfo","sourceType","adventurerEquipment","inventorySlot","isActive","DraggableItemIcon","useDrag","collected","dragRef","isDragging","Inventory","disabledIndex","iconSize","onStartDrag","slots","contents","onDropItem","SceneControllerContext","createContext","SceneControllerContextProvider","useStore","loaded","setLoaded","previousQuestVars","getSceneController","loadData","createScene","sceneEntered","sceneExited","Provider","useItemDropActions","sceneController","useContext","dropItemEquipment","actions","adventurerInventory","existingEquipment","dropItemInventory","otherItem","takeItemFromCache","dropItemWarehouse","Level","currentLevel","currentLevelXp","nextLevelXp","dingAnimationRunning","setDingAnimationRunning","lastState","lastAdventurer","lastDingAnimationRunning","createStringArraySelector","createSelectorCreator","defaultMemoize","stringArrayEqual","getQuests","getQuestNames","getQuestStatus","getActiveQuests","useQuest","questSelector","useQuestScene","useAdventurerActorObject","ApIndicator","useActorObject","hasEffect","lucky","AdventurerTraits","renderTrait","last","traitDefinition","getTraitName","Guy","renderDamageReduction","dR","AdventurerEquipment","onDropItemEquipment","getEquipmentSlot","Health","baseHP","ConsumeItemSlot","ConsumeItem","onConsumed","enoughAp","adventurerConsumeItem","getIconImage","effectType","EffectIcon","backgroundImage","AdventurerTempEffects","getTempEffectName","renderEffect","AttributeIndicator","additional","determineClass","AttributeListItems","extendedAttribute","components","getAttributeName","renderRow","AttributeList","hasAdditional","SkillsListItems","skill","getSkillName","AdventurerAttributesAndSkills","extendedAttributes","AdventurerPanel","horizontalMode","levelBar","onStartInventoryItemDrag","consumeItemIndex","setConsumeItemIndex","src","alt","getAdventurerFlavor","AdventurerSectionSelection","sectionParent","parentNode","debounce","fromTop","scrollTop","querySelectorAll","hash","lastIndexOf","section","document","offsetTop","clientHeight","classList","remove","smooth","res","WAREHOUSE","Stockpile","selectedItemCategory","setSelectedItemCategory","dragDropManager","useDragDropManager","dragging","getMonitor","dragItem","dragItemType","getItemType","getItemCategory","WarehouseStructureView","selectedAdventurer","setSelectedAdventurer","resourcesDelta","setResourcesDelta","previousResources","resourcesRef","structuresState","DroppableAdventurerSlot","AssignAdventurers","onAdventurerClicked","onAdventurerDropped","availableSlots","slotsContent","QuestBoard","availableQuests","selectedQuestName","onQuestClick","fullParty","enoughItems","every","amountRequired","checkEnoughItems","canLaunch","getQuestDescription","onRemoveAdventurer","onLaunchQuest","getQuestDetails","AdventurerButton","onAddAdventurer","isAssigned","emptySlot","getEmptySlot","DraggableAdventurerAvatar","RoomWithAdventurer","onQuest","expanded","assigned","SOURCE_ID","prompt","RoomEmpty","RoomList","roomCount","handleAdventurerClick","roomContent","getStructureName","TavernStructureView","setAassignedAdventurers","selectedQuest","setSelectedQuest","getAvailableQuests","available","handleAddAdventurer","copy","handleRemoveAdventurer","handleQuestClick","questLaunched","ResourceGenerationRow","ItemText","getItemSubtext","DraggableItemsList","renderButton","HarvestProgress","ResourceStructureView","selectHarvest","decreaseWorkers","resourceStructure","warehouseIcon","removeItemFromHarvest","handleItemTake","StructureDetailsView","buildTask","renderContent","RoutedStructureDetailsView","useParams","getImage","StructureIconSprite","TextStyle","fontFamily","fontSize","fill","wordWrap","wordWrapWidth","dropShadow","dropShadowAngle","dropShadowBlur","dropShadowDistance","blurFilter","BlurFilter","StructureLabel","structureName","metrics","TextMetrics","measureText","anchor","toUpperCase","StructureLabels","fontLoaded","setFontLoaded","FontFaceObserver","LumberMill","hitAreaShapes","atlas","textures","setTextures","selected","STRUCTURE_HIGHLIGHT_FILTER","rotation","setRotation","position","buttonMode","pointertap","onStructureClick","hitArea","texture","ParticleEmitter","applyProps","oldProps","newProps","config","newP","applyDefaultProps","newConfig","upgradeConfig","emitter","particles","elapsed","tick","destroyed","update","requestAnimationFrame","Tavern","smoke","Generic","getStructurePosition","OutlineFilter","hightlightMatch","useMatch","viewMatch","selectedStructure","params","viewportRef","tween","thickness","yoyo","repeat","pause","kill","handleStructureClick","zoomPercent","moveCenter","MAX_WIDTH","canvasWidth","setCanvasWidth","canvasHeight","setCanvasHeight","resize","worldViewWidth","clientWidth","worldViewHeight","scrollY","reverse","StructureComponent","getStructure","polygons","Toasts","activeToasts","setActiveToasts","toastsUpdated","addListener","removeListener","toastConfig","setSetting","useSettings","compose","getChannelControls","slider","lastChild","setChannelVolume","role","step","linear","parseFloat","defaultValue","getChannelVolume","handleBooleanChange","getAttribute","resourceOrder","DefaultSelect","styles","control","provided","minHeight","boxShadow","isFocused","container","_state","flex","padding","placeholder","whiteSpace","valueContainer","marginTop","indicatorsContainer","cheats","setCheats","setTimeMultiplier","handleChangeStructureState","onCheatStructureState","k","parseInt","typeKey","subtext","allItems","_evt","onCheatGold","onCheatWorkers","onCheatResources","Select","formatGroupLabel","formatOptionLabel","onCheatItem","setCheatTimeMultiplier","structureDef","getStructureDefinition","levelDef","getStructureRow","groupAdventurersByQuest","foundInParty","groupedAdventurers","foundAdventurers","createSelectAdventurersOnQuest","GameStats","adventurersNotInTown","loadGameMode","timePlaying","solo","encryptor","createEncryptor","loadedStore","setLoadedStore","loading","setLoading","handleClickLoad","gameVersion","confirm","onCloseWindow","createElement","encrypted","encrypt","setAttribute","encodeURIComponent","click","saveGame","fileReader","FileReader","onload","decrypt","parse","decryptSavedGame","readAsText","SaveAndLoadWindow","onOpenWindow","Resourcebar","goldState","createItem","Topbar","MapGrid","_props","Graphics","_oldProps","gridWidth","lineStyle","moveTo","lineTo","endFill","didMount","parent","beginFill","drawCircle","addChild","nearestX","world","nearestY","QuestMarker","encounterActive","avatar","maskGraphics","CIRCLE_DIAMETER","mask","pointerdown","QuestLine","positions","draw","graphics","xc","yc","quadraticCurveTo","DebugToggleCombat","WORLD_WIDTH","WORLD_HEIGHT","getQuestWorldLocation","roundedProgress","lastNode","nodeLocationToPoint","WorldMap","retrieveWorldViewRef","smallMap","activeQuests","selectMemoized","useActiveQuests","WIDTH","worldView","SMALL_HEIGHT","partyLocation","focusOnQuestingParty","backgroundColor","previousPositions","lastPosition","getPreviousPositions","currentPosition","questNode","onPartyClick","getQuestSceneTitle","RectTileLayer","CompositeRectTileLayer","horizontalTiles","spritesheets","w","spriteId","addFrame","ObjectTileLayer","SpriteAnimated","oldScale","newScale","gotoAndPlay","SPRITE_WIDTH","createColorReplaceFilter","replacements","MultiColorReplaceFilter","BLUES","REDS","TEALS","PURPLE","ORANGE","BLACK","WHITE","YELLOW","CombatController","storeChange","handleStoreChange","bind","unsubscriber","subscribe","enemies","sceneEnemies","totalAdventurerAp","findEnemyWithAp","findNearestActor","createActionIntent","getSceneActor","getActorMainhandItem","getActorSkills","targetAttributes","getActorAttributes","bubbleAtLocation","effectAtLocation","attacker","weaponDefinition","rawDamage","bodyPart","getArmor","absorbed","takeDamage","actors","distance","steps","allAnimations","useAnimation","actorRef","setOrientation","getTileDimensions","previousAction","timeout","actionSelector","nextAction","animation","setAnimation","animationTimeline","determineOrientation","currentLocation","north","northEast","east","southEast","south","southWest","west","northWest","moveActor","killTweensOf","timeline","ease","pixi","onStart","actorMoved","actorMeleeStart","actorMeleeEnd","actorShootStart","actorShootEnd","actorInteract","clearTimeout","useFrames","orientation","indexedFrames","frame","replace","prefix","meta","getFrames","spritesheetBasePath","SceneActor","idleAnimation","selectionColor","lookAt","setInterval","left","clearInterval","useRandomOrientation","frames","flipped","setFlipped","bearing","angle","atan2","PI","calculateBearing","orange","red","white","yellow","animationSpeed","isPlaying","pivot","SceneAdventurer","zIndex","SceneEnemy","ObjectSpriteLayer","sortableChildren","selectedActorId","SceneEffectLayer","addEffect","sheet","animations","animatedSprite","AnimatedSprite","Tilemap","tileObjects","spriteObjects","getLayerObjects","tilelayer","nextTilesetToload","tilesetsTextures","useTilesetsLoader","tileSpritesheets","setTilesets","setData","nextTileset","tilesetName","spritesheetData","tilecount","spriteSourceSize","rotated","trimmed","sourceSize","imagewidth","imageheight","parseSpritesheetData","Spritesheet","newTilesets","loadComplete","loadTilesets","Bubbles","timeouts","bubbleAdded","bubble","innerHTML","appendChild","removeChild","useCanvasScaler","sceneWidth","sceneHeight","handleResize","canvas","currentWidth","transform","recalculate","images","NormalUICursor","CombatUIWidget","intents","onEnemy","invalid","classNames","ActionButton","renderText","onSetActionIntent","onCloseMenu","cancelIntent","onMouseDown","onMouseUp","selectedActorLocation","actorAttemptAction","EnemyAvatar","actorObject","DiamondFrame","useDraggable","handle","offset","touchStart","evt","touches","clientX","clientY","mouseStart","setPosition","touchMove","mouseMove","dragEnd","ActionMenu","enemyTargetted","renderButtonText","aimedShot","cleave","slash","riposte","weaponAbility","useActionIntents","weaponIntents","getAbilityDefinition","moveIntent","AdventurerCombatSceneUI","cursorLocation","setCursorLocation","actionMenuOpen","setActionMenuOpen","combatIntents","hasValidIntents","Layout","SceneUI","actionIntent","adventurerCombatRef","mouseDownOnCanvas","scaler","findLocation","Element","touch","NaN","convertMouseOrTouchCoords","convertedX","convertedY","pointToSceneLocation","useLongPress","domRect","DOMRect","fromRect","handleClick","handleMouseDown","onMove","locationIsOutOfBounds","handleMouseMove","captureEvent","cancelOnMovement","detect","LongPressDetectEvents","BOTH","handleMouseUp","onTouch","onTouchEnd","DashedLine","points","dash","gap","alignment","native","offsetPercentage","dashLeft","gapLeft","progressOffset","rotatedpoints","clone","cosAngle","cos","sinAngle","sin","dx","dy","p1","p2","len","normal","progressOnLine","ActionPreview","convert","converted","valid","getLog","SceneLog","questId","useQuestLog","lastLog","shift","SceneDebug","allLocations","drawRect","Scene","setSelectedActor","currentActionIntent","setCurrentActionIntent","initialize","Rectangle","OnTheRoad","QuestDetails","DroppableAdventurerAvatar","LootCache","freeSlots","cache","cacheName","stagger","each","takeGoldFromCache","Situation","getSituation","handleChoiceClick","choice","handleSituationOptionClick","CombatBar","endTurn","AdventurersPanel","AccordionContext","Accordion","itemsExpanded","setItemsExpanded","toggleItem","AccordionItem","onHeaderClick","contentRef","setClientHeight","isExpanded","useLayoutEffect","CombatAttributes","ActorsAccordionAdventurerItem","ActorsAccordionEnemyItem","useEnemyActorObject","ActorsAccordion","onActorSelected","useQuestSceneEnemies","ChannelType","isEnemySelected","selectedObject","QuestPanel","layout","setSelectedActorId","handleActorSelected","handleCloseLootCacheModal","WorldView","worldViewRef","questname","reactMarkdownRemarkDirective","tree","visit","hName","hProperties","getRarityClassName","ItemElement","Markdown","remarkPlugins","directive","Placement","SimpleLog","setExpanded","selectedTabId","setSelectedTabId","activeQuestNames","questNameSelector","names","statuses","useActiveQuestNames","useLocation","pathname","channels","tabType","displayEntries","currentTab","lE","tab","logEntry","getLogEntryRow","DeedContent","getDeedDefinition","enoughGold","startBuildingStructure","buildStructure","handleStartConstruction","STUDY_TIME","ProducedAtStructure","studyTasks","sT","studyTime","studyItem","ProduceOrStudy","DamageList","dmgType","dmg","getEffectDescription","Effects","AbilitiesList","getAbilityName","WeaponContent","getWeaponType","classificationText","getWeaponClassification","ApparelContent","ConsumableContent","ItemContext","ResourceContext","workersState","workersFreeState","structureStates","renderProducedBy","free","total","InfoWindow","View","Tooltip","placement","setPlacement","containerRect","setContainerRect","tooltipElement","tooltipRect","opacity","contentElement","closest","TraitContext","getTraitDescription","getTraitEffect","AttributeContext","getAttributeMechanics","eAC","renderOrigin","getAttributeDescription","AdventurerContext","EnemyContext","attributesExtended","ActorContext","getTempEffectDescription","EffectContext","getTempEffectFlavor","getItemNameClassName","ContextTooltip","selectedContext","setSelectedContext","tooltipUpdated","TempEffectContext","getSkillInfo","emptyFn","GameActionsContext","pauseGame","continueGame","restartGame","parsers","getRarity","prepareText","asString","DebugItemsList","DebugItems","setSelected","DebugSpriteDemo","currentFrame","gotoAndStop","allSpritesheets","getSpritesheetPath","allOrientations","DebugSprites","setCurrentFrame","AdventurersOverview","onSetSelectedId","AdventurerXpInput","nextXp","DebugAdventurers","renderAttribute","handleChangeAttribute","selectedId","setSelectedId","groupKey","adventurersInGroup","classNamePrefix","DebugAdventurerEdit","DebugContextTown","DebugContextWorld","DebugContext","DebugView","page","setPage","DebugDrawer","useKey","PixiPlugin","registerPIXI","registerPlugin","App","containerRef","activeWindows","setActiveWindows","handleViewButtonClick","handleWindowClose","handleWindowBack","handleScroll","maxWidth","DndProvider","backend","HTML5Backend","topWindow","commonWindowProps","renderWindow","Game","paused","setStore","setPersistor","startNewGame","setupStore","configuration","newState","logs","resourcesUpdates","harvestUpdates","gameTick","ErrorModal","setState","getStoredState","initState","message","method","registerServiceWorker","createRoot","getElementById","render","FallbackComponent"],"mappings":"8TAqBsBA,EAAtB,yFAEE,SAAmBC,GAAsD,IAApBC,IAAmB,yDACtEC,KAAKF,MAAQA,EACbE,KAAKC,UAAY,GACjBD,KAAKE,SAAW,GAEZH,GACFC,KAAKG,aAEPH,KAAKI,aAAc,IAVvB,iBAaE,SAAkBC,EAAaC,GAC7B,IAAMC,EAASP,KAAKQ,WAAWH,EAAKC,GACpC,OAAe,OAAXC,GAKFE,QAAQC,MAAR,eAAsBL,EAAtB,+BACM,MAAN,OAAaA,EAAb,gBAEOM,iBAAOJ,KAvBpB,wBA4BE,SAAyBF,EAAaC,GACpC,IAAKN,KAAKI,YACR,MAAM,IAAIQ,MAAJ,gBAAmBZ,KAAnB,sBAER,IAAMa,EAAWb,KAAKc,YAAYT,GAClC,OAAKQ,EAGEA,EAASP,GAFP,OAlCb,0BAuCE,SAA2BS,GACzB,OAAOf,KAAKgB,IAAID,EAAUV,IAAKU,EAAUT,WAxC7C,yBA2CE,SAA0BD,GACxB,IAAIQ,EAAWb,KAAKC,UAAUI,GAM9B,OALKQ,GAAYb,KAAKF,MAAMO,KAE1BL,KAAKiB,QAAQZ,EAAKL,KAAKF,MAAMO,IAC7BQ,EAAWb,KAAKC,UAAUI,IAErBQ,IAlDX,4BAqDE,SAA6BK,GAC3B,OAAOlB,KAAKgB,IAAL,kBAAoBG,IAAcD,GAAlC,YAtDX,+BAyDE,SAAgCE,GAC9B,OAAOpB,KAAKgB,IAAL,qBAAuBI,EAAvB,YA1DX,iCA6DE,SAAkCA,EAAsBC,GACtD,OAAOrB,KAAKgB,IAAL,qBAAuBI,EAAvB,WAA8C,CAAEE,KAAMD,MA9DjE,8BAiEE,SAA+BE,GAC7B,OAAOvB,KAAKgB,IAAL,2BAA6BO,EAA7B,YAlEX,qCAqEE,SAAsCA,GACpC,OAAOvB,KAAKgB,IAAL,2BAA6BO,EAA7B,mBAtEX,mCAyEE,SAAoCA,GAClC,OAAOvB,KAAKgB,IAAL,2BAA6BO,EAA7B,iBA1EX,0BA6EE,SAA2BC,GACzB,OAAOxB,KAAKgB,IAAL,gBAAkBQ,EAAlB,YA9EX,8BAiFE,SAA+BC,GAC7B,OAAOzB,KAAKgB,IAAL,2BAA6BU,YAAQC,IAAkBF,QAlFlE,2BAqFE,SAA4BH,GAC1B,OAAOtB,KAAKgB,IAAL,gBAAkBU,YAAQJ,GAA1B,aAtFX,iCAyFE,SAAkCA,GAChC,OAAOtB,KAAKgB,IAAL,gBAAkBU,YAAQJ,GAA1B,mBA1FX,gCA6FE,SAAiCM,GAC/B,IAAMC,EAAYD,EAAMC,WAAa,GACrC,OAAO7B,KAAKgB,IAAL,gBAAkBU,YAAQE,EAAMN,MAAhC,kBAA+CI,YAAQG,GAAvD,aA/FX,6BAkGE,SAA8BC,GAC5B,OAAO9B,KAAKgB,IAAL,mBAAqBc,EAArB,YAnGX,yBAsGE,SAA0BC,GACxB,OAAIC,YAAWD,GACN/B,KAAKgB,IAAL,eAAiBU,YAAQK,GAAzB,UAEF/B,KAAKgB,IAAL,eAAiBU,YAAQK,EAAeD,MAAxC,YA1GX,6BA6GE,SAA8BG,GAC5B,OAAOjC,KAAKgB,IAAL,wBAA0BU,YAAQQ,IAAaD,QA9G1D,4BAiHE,SAA6BE,GAC3B,OAAOnC,KAAKQ,WAAL,eAAwBkB,YAAQS,GAAhC,eAlHX,uBAqHE,SAAwBC,GACtB,OAAOpC,KAAKgB,IAAL,iBAAmBqB,IAAOD,GAA1B,YAtHX,8BAyHE,SAA+BE,GAC7B,OAAOtC,KAAKgB,IAAL,oBAAsBU,YAAQY,GAA9B,YA1HX,0BA6HE,SAA2BC,GACzB,OAAOvC,KAAKgB,IAAL,gBAAkBU,YAAQa,GAA1B,YA9HX,kCAiIE,SAAmCC,EAAgBC,GACjD,IAAQX,EAAkBU,EAAlBV,KAASY,EAAjB,YAA0BF,EAA1B,GACA,OAAOxC,KAAKgB,IAAL,iBAAmBU,YAAQiB,IAAWb,IAAtC,2CAAiEY,GAASD,MAnIrF,6BAsIE,SAA8BD,GAC5B,OAAOxC,KAAKgB,IAAL,iBAAmBU,YAAQiB,IAAWH,EAAOV,OAA7C,cAvIX,2BA0IE,SAA4BU,GAC1B,OAAOxC,KAAKgB,IAAL,iBAAmBU,YAAQiB,IAAWH,EAAOV,OAA7C,YA3IX,sCA8IE,SAAuCU,EAAoBC,GACzD,IAAQX,EAAkBU,EAAlBV,KAASY,EAAjB,YAA0BF,EAA1B,GACA,OAAOxC,KAAKgB,IAAL,sBAAwBU,YAAQkB,IAAed,IAA/C,2CAA0EY,GAASD,MAhJ9F,iCAmJE,SAAkCD,GAChC,OAAOxC,KAAKgB,IAAL,sBAAwBU,YAAQkB,IAAeJ,EAAOV,OAAtD,cApJX,+BAuJE,SAAgCU,GAC9B,OAAOxC,KAAKgB,IAAL,sBAAwBU,YAAQkB,IAAeJ,EAAOV,OAAtD,YAxJX,iCA2JE,SAAkCS,GAChC,OAAOvC,KAAKgB,IAAL,gBAAkBU,YAAQa,GAA1B,mBA5JX,4BA+JE,SAA6BA,GAC3B,OAAOvC,KAAKgB,IAAL,gBAAkBU,YAAQa,GAA1B,cAhKX,0BAmKE,SAA2BT,GACzB,OAAO9B,KAAKgB,IAAL,wBAA0BU,YAAQmB,IAAKf,QApKlD,2BAuKE,SAA4BA,GAC1B,OAAO9B,KAAKgB,IAAL,yBAA2BU,YAAQoB,IAAWhB,QAxKzD,0BA2KE,SAA2BA,GACzB,OAAO9B,KAAKgB,IAAL,gBAAkBU,YAAQoB,IAAWhB,IAArC,YA5KX,0BA+KE,SAA2BA,GACzB,OAAO9B,KAAKgB,IAAL,gBAAkBU,YAAQoB,IAAWhB,IAArC,YAhLX,qCAmLE,SAAsCiB,GACpC,OAAO/C,KAAKgB,IAAL,0BAA4BU,YAAQsB,IAAqBD,QApLpE,4BAwLE,WACM/C,KAAKE,SAAS+C,SAChBxC,QAAQyC,IAAI,kCACZzC,QAAQyC,IAAI,IAAMlD,KAAKE,SAASiD,KAAK,aAAe,YA3L1D,wBAuME,WAA6B,IAAD,OAC1BC,OAAOC,KAAKrD,KAAKF,OAAOwD,SAAQ,SAACjD,GAC/B,EAAKY,QAAQZ,EAAK,EAAKP,MAAMO,SAzMnC,qBA6ME,SAAuBA,EAAakD,GAClC,IAAM1C,EAAW2C,UAAmBD,GACpCvD,KAAKC,UAAUI,GAAOQ,MA/M1B,KAAsBhB,EA+LLO,aAAc,EA/LTP,EAiMLC,W,EAjMKD,EAmMLI,e,EAnMKJ,EAqMLK,c,EAejB,IAMMuD,EAAqB,SAACtB,GAC1B,IAAMb,EAAOzB,EAAY6D,YAAYvB,GAC/BwB,EAAkB9D,EAAYiB,YAAY,0BAChD,OAAO,IAAI0C,aAAJ,UAA6BG,EAAgB,CAAEC,KAAMtC,OAGxDuC,EAAkB,SAAC1B,GACvB,OAb2B,SAACA,GAC5B,IAAMb,EAAOzB,EAAY6D,YAAYvB,GAC/BwB,EAAkB9D,EAAYiB,YAAY,4BAChD,OAAO,IAAI0C,aAAJ,UAA6BG,EAAgB,CAAEC,KAAMtC,MAUrDwC,CAAqB3B,IAG9BqB,iBAA0B,aAAa,SAACzB,EAAiCgC,GACvE,IAAIC,EAMJ,GAJEA,EADEhC,YAAWD,GACFA,EAEAA,EAAeD,MAEvBmC,YAAcD,GACjB,OAAO,IAAIR,aAAJ,uCAA0DQ,EAA1D,OAET,OAAQD,GACN,IAAK,KACH,OAAOF,EAAgBG,GACzB,IAAK,KAEL,IAAK,KACH,OAAOP,EAAmBO,GAC5B,QAGE,OAAO,IAAIR,aAAsBQ,OAIvCR,iBAA0B,gBAAgB,SAACrB,GACzC,OAAO,IAAIqB,aAAJ,gBAAmCU,KAAKC,UAAUhC,GAAlD,SAGTqB,iBAA0B,kBAAkB,SAAClB,GAC3C,IAAMhB,EAAOzB,EAAYmB,IAAZ,oBAA6BU,YAAQY,GAArC,UACb,OAAO,IAAIkB,aAAsBlC,MAGnCkC,iBAA0B,kBAAkB,SAAClB,GAC3C,IAAMhB,EAAOzB,EAAYmB,IAAZ,oBAA6BU,YAAQY,GAArC,UACP8B,EAAOC,YAAiB/B,GAC9B,OAAO,IAAIkB,aAAJ,WAA+BlC,EAA/B,cAAyC8C,EAAzC,SAGTZ,iBAA0B,iBAAiB,SAACc,GAC1C,IAAMhD,EAAOzB,EAAYmB,IAAZ,mBAA4BsD,EAA5B,UACb,OAAO,IAAId,aAAsBlC,MAGnCkC,iBAA0B,mBAAmB,SAACpC,GAC5C,IAAME,EAAOzB,EAAY0E,kBAAkBnD,GAC3C,OAAO,IAAIoC,aAAsBlC,MAGnCkC,iBAA0B,cAAc,SAACgB,GACvC,GCtR0B,SAAClD,GAC3B,QAAO,OAACA,QAAD,IAACA,KAAMmD,WAAWC,MDqRrBC,CAAaH,GAAQ,CACvB,IAAMlD,EAAOzB,EAAY+E,aAAZ,OAAyBJ,QAAzB,IAAyBA,OAAzB,EAAyBA,EAAOK,UAAU,EAAGL,EAAMM,QAAQ,OACxE,OAAO,IAAItB,aAAsBlC,GAEnC,IAAMA,EAAOzB,EAAY0E,kBAAkBC,GAC3C,OAAO,IAAIhB,aAAsBlC,O,0KExSvBK,E,2EAAAA,O,eAAAA,I,iBAAAA,I,iBAAAA,I,eAAAA,I,eAAAA,I,yBAAAA,I,uBAAAA,I,sBAAAA,M,KAWZ,IASaoD,EAA4B,SAACf,EAAoBgB,GAC5D,OAAQA,GACN,KAAKrD,EAAkBsD,MACvB,KAAKtD,EAAkBuD,KACvB,KAAKvD,EAAkBwD,MACvB,KAAKxD,EAAkByD,KACvB,KAAKzD,EAAkB0D,KACrB,OAhBiB,SAAClD,EAAgBmD,GACtC,IAAMC,EAAiBtB,YAAc9B,GACrC,OAAIoD,EAAetD,eAAiBC,IAAasD,SAGzCD,EAAqCD,gBAAkBA,EAWpDG,CAAezB,EAAUgB,GAClC,KAAKrD,EAAkB+D,SACvB,KAAK/D,EAAkBgE,QACrB,IAAMJ,EAAmCtB,YAAcD,GAEvD,GAAIuB,EAAetD,eAAiBC,IAAa0D,WAC/C,OAAO,EACF,GAAIL,EAAetD,eAAiBC,IAAa2D,OACtD,OAAO,EAGT,OAD2BC,YAAwBP,EAAeQ,YAA1DC,gBAEN,KAAKhD,IAAqBiD,UACxB,OAAO,EACT,KAAKjD,IAAqB0C,SACxB,OAAOV,IAAsBrD,EAAkB+D,SACjD,KAAK1C,IAAqB2C,QAC1B,KAAK3C,IAAqBkD,OACxB,OAAOlB,IAAsBrD,EAAkBgE,QAInD,OAAO,EAET,QACE,OAAO,IAMAQ,EAAqB,SAACC,GACjC,IAAMC,EAAeD,EAAUzE,EAAkB+D,UAEjD,GAAIW,GAAgBC,YAASD,EAAavE,MAAO,CAC/C,IAAMiE,EAAaQ,YAAoBF,EAAavE,MAAMiE,WAC1D,GAAID,YAAwBC,GAAYC,iBAAmBhD,IAAqBwD,OAC9E,OAAO,EAGX,OAAO,G,wBClBMC,EAlCO,SAAChE,GAErB,IAAQrB,EAAyBqB,EAAzBrB,aAAcsF,EAAWjE,EAAXiE,OAChBC,EAAaC,YAAcxF,GAEjC,EAAuCyF,aAAqD,iBAAO,CACjGC,OAAQC,IAASC,KACjBC,KAAM,SAACC,GACLR,EAAOQ,IAETC,QAAS,SAACC,GAAa,IAAD,EACdjF,EAAI,UAAGiF,EAAQC,iBAAX,aAAG,EAA0ClF,KAEvD,MAAO,CACLmF,UAFkBnF,GAAQ4C,EAA0B5C,EAAKL,KAAMW,EAAMX,OAASsF,EAAQE,UAGtFC,OAAQH,EAAQG,cAGlB,CAACnG,EAAcuF,EAAWP,YAb9B,0BAASmB,EAAT,EAASA,OAAQD,EAAjB,EAAiBA,QAAWE,EAA5B,KAeMC,EAAY,CAAC,kBAOnB,OARiBF,GAAUD,EAGzBG,EAAUC,KAAK,eACNJ,GACTG,EAAUC,KAAK,iBAIf,qBAAKD,UAAWA,EAAUtE,KAAK,KAAMwE,MAAOhG,EAAkBc,EAAMX,MAAO8F,IAAKJ,EAAhF,SACI/E,EAAMoF,a,iCClDP,IAAK7E,EASAF,EAoBAgF,EA7BZ,sG,SAAY9E,O,yBAAAA,I,uBAAAA,I,qBAAAA,I,yBAAAA,I,mBAAAA,I,oBAAAA,M,cASAF,K,UAAAA,E,UAAAA,E,YAAAA,E,oBAAAA,E,YAAAA,E,cAAAA,E,gBAAAA,E,cAAAA,E,cAAAA,E,gBAAAA,E,cAAAA,E,mBAAAA,M,cAoBAgF,K,mBAAAA,M,qCC/BZ,6TAMaC,EAAe,IAMfC,EAAa,IACbC,EAAc,KACdC,EAAgB,KAChBC,EAAe,KAEfC,EAAyB,GAAbJ,EACZK,EAAwB,GAAbL,EACXM,EAAqB,GAAXD,EACVE,EAAqB,OAAVD,EAEXE,EAAiB,SAACC,EAAYC,GACzC,IAAMC,EAAgB,CACpB,CAAEC,KAAMF,EAAQ,IAAM,OAAQG,OAAQN,GACtC,CAAEK,KAAMF,EAAQ,IAAM,MAAOG,OAAQP,GACrC,CAAEM,KAAMF,EAAQ,IAAM,OAAQG,OAAQR,GACtC,CAAEO,KAAMF,EAAQ,IAAM,SAAUG,OAAQb,GACxC,CAAEY,KAAMF,EAAQ,IAAM,SAAUG,OA1BV,MA4BpBC,EAAOC,KAAKC,IAAIP,GACdQ,EAAmB,GASzB,OARAN,EAAcrF,SAAQ,SAAC4F,GACrB,IAAMC,EAAMJ,KAAKK,MAAMN,EAAOI,EAAGL,QAEjC,GADAC,GAAQK,EAAMD,EAAGL,OACL,IAARM,EAAW,CACb,IAAMP,EAAO/I,IAAYmB,IAAZ,sBAA+BkI,EAAGN,MAAlC,OAAyCO,EAAM,IAAMT,EAAQ,UAAY,KACtFO,EAAOvB,KAAP,UAAeyB,GAAf,OAAqBP,QAGlBK,EAAO9F,KAAK,MAGRkG,EAAiB,SAACZ,GAC7B,OAAO,IAAIa,KAAKb,GAAIc,uB,8BCxCtB,kPAaYC,EAbZ,S,SAaYA,O,mBAAAA,I,kBAAAA,M,KA+BL,IAqDKC,EArDCC,EAAgB,SAACC,GAC5B,OAAOA,EAAO7H,OAAS8H,IAAgBpF,OAI5BqF,EAAe,SAACF,GAC3B,OAAOD,EAAcC,IAAWA,EAAOG,aAAeN,EAAWO,QAItDC,EAAU,SAACL,GACtB,OAAOD,EAAcC,IAAWA,EAAOG,aAAeN,EAAWS,OAItDC,EAAgB,SAACC,EAAwB/I,GACpD,OAAO+I,EAAQC,MAAK,SAAAC,GAAC,OAAIR,EAAaQ,IAAMA,EAAEjJ,eAAiBA,MAGpDkJ,EAAgB,SAACX,GAC5B,OAAIE,EAAaF,GACRA,EAAOvI,aAEZ4I,EAAQL,GACHA,EAAOY,QAET,Y,SA2BGd,K,YAAAA,E,oBAAAA,E,cAAAA,E,eAAAA,M,8IChGAe,EAOAC,EAMAC,E,oGAbAF,O,iBAAAA,I,WAAAA,I,iBAAAA,I,sBAAAA,M,cAOAC,O,mCAAAA,I,qBAAAA,I,gBAAAA,M,cAMAC,O,eAAAA,I,kBAAAA,M,KAsCZ,IAIMC,EAAqB,gBAEdC,EAAb,gIAaE,6HAGMJ,EAAQK,MAHd,SAG6BC,IAAYzD,QAAZ,UAAuBsD,EAAvB,YAA6CH,EAAQK,QAHlF,sJAnB2B,EAmB3B,uEAIML,EAAQO,GAJd,UAI0BD,IAAYzD,QAAZ,UAAuBsD,EAAvB,YAA6CH,EAAQO,KAJ/E,+JAlBwB,EAkBxB,6EAKMP,EAAQQ,MALd,UAK6BF,IAAYzD,QAAZ,UAAuBsD,EAAvB,YAA6CH,EAAQQ,QALlF,+JAjB2B,EAiB3B,gFAMMR,EAAQS,QANd,UAM+BH,IAAYzD,QAAZ,UAAuBsD,EAAvB,YAA6CH,EAAQS,UANpF,+JAhB6B,GAgB7B,iDAEEjL,KAAKkL,eAFP,EAQElL,KAAKmL,cAAe,EARtB,iDAbF,mHAyBE,WAA6BC,EAAsBC,EAA0BC,GAA7E,qFACQC,EAAU,IAAIC,SAAiB,SAACC,EAASC,GAI7C,GAHqB,kBAAVL,IACTA,EAAQ,CAACA,IAEP,EAAKM,QAAQP,GAIf,OAFQ,OAARE,QAAQ,IAARA,KAAW,EAAKK,QAAQP,SACxBK,EAAQ,EAAKE,QAAQP,IAIvB,IAAMQ,EAAS,IAAIC,SACnBR,EAAMS,KAAI,SAACC,GAAD,OAAUH,EAAOI,IAAID,MAC/BH,EAAOK,MAAK,SAACC,EAAGC,GACVA,IAGF,EAAKR,QAAQP,GAAahI,OAAOgJ,OAAOD,GAAWE,OAAOC,SAASR,KAAI,SAAAS,GAAC,OAAIA,EAAEC,SACtE,OAARlB,QAAQ,IAARA,KAAW,EAAKK,QAAQP,IACxBK,EAAQ,EAAKE,QAAQP,WApB7B,kBAwBSG,GAxBT,2CAzBF,yHA4DE,WAA8BH,GAA9B,+GAAoDqB,EAApD,+BAAuEjC,EAAQO,GAAI2B,EAAnF,gCAAiGC,EAAjG,+BAAoHlC,EAAQmC,eAAgBC,EAA5I,gCACO7M,KAAKmL,aADZ,gCAEUnL,KAAK8M,OAFf,wBAMUC,EAAY/M,KAAKgN,SAAS5B,KAE9B3K,QAAQwM,KAAR,2BAAiC7B,IAEnC2B,EAAUG,OAASlN,KAAKkL,eAAeuB,GACvCM,EAAUL,KAAOA,EAEjB,UAAI1M,KAAKmN,cAAcV,UAAvB,OAAI,EAA6BI,gBAEzBO,EAAepN,KAAKmN,cAAcV,IAC3BY,SAASC,KAAK,YAAY,SAACC,EAAkBC,GACxD,EAAKC,iBAAiBL,EAAahC,WAAamC,EAAWC,KAGzDE,EApBV,UAoBkB1N,KAAKyN,iBAAiBrC,UApBxC,QAoBsD,EApBtD,UAsB2B2B,EAAUY,KAAK,CAAED,UAtB5C,QAsBUL,EAtBV,OAwBQrN,KAAKmN,cAAcV,KACjBE,IAAYlC,EAAQmD,MAEtBhD,EAAaiD,aAAapB,GAE1BqB,IAAKC,KAAKV,EAAU,CAAEH,OAAQ,EAAGM,SAAU,OAClCb,IAAYlC,EAAQmC,gBAC7B5M,KAAKmN,cAAcV,GAASY,SAASW,QAGzChO,KAAKmN,cAAcV,GAAW,CAAEY,WAAUjC,YAAW2B,YAAWF,iBAChEQ,EAASY,GAAG,OAAO,WACjB,EAAKd,cAAcV,GAASY,SAASa,iBAC9B,EAAKf,cAAcV,MArChC,4GA5DF,6EAwGE,SAA0BD,GAA0B,IAAD,EAIjD,OAHI,UAACxM,KAAK2L,QAAQa,UAAd,OAAC,EAAqBvJ,QACxBxC,QAAQC,MAAR,6BAAoC8L,IAEH,IAA/BxM,KAAK2L,QAAQa,GAAOvJ,OACfjD,KAAK2L,QAAQa,GAAO,GAEpBxM,KAAK2L,QAAQa,GAAOzD,KAAKK,MAAML,KAAKoF,SAAWnO,KAAK2L,QAAQa,GAAOvJ,WA/GhF,uBAmHE,SAAwBwJ,GAAmB,IAAD,EACxC,UAAAzM,KAAKmN,cAAcV,UAAnB,SAA6BY,SAASa,iBAC/BlO,KAAKmN,cAAcV,KArH9B,0BAwHE,SAA2BA,GAAoC,IAAlBe,EAAiB,uDAAN,IAChDY,EAAYpO,KAAKmN,cAAcV,GACrCqB,IAAKO,GAAGD,EAAUf,SAAU,CAAEH,OAAQ,EAAGM,WAAUc,WAAY,WAC7DF,EAAUf,SAASa,eA3HzB,iCA+HE,SAAkCzB,GAAmB,IAAD,EAClD,iBAAOzM,KAAKmN,cAAcV,UAA1B,aAAO,EAA6BrB,YAhIxC,4BAmIE,SAA6BoB,GAC3B,QAASxM,KAAK2L,QAAQa,KApI1B,yBAuIE,SAAgCjJ,GAC1BvD,KAAKmN,cAAc3C,EAAQK,SAC7B7K,KAAKmN,cAAc3C,EAAQK,OAAOkC,UAAUwB,QAAUhL,EAAQ,CAAEvD,KAAKwO,SAAY,MAzIvF,8BA6IE,SAAwB/B,GACtB,OAAOzM,KAAKkL,eAAeuB,KA9I/B,8BAiJE,SAAwBA,EAAkBS,GAAgB,IAAD,EACvDlN,KAAKkL,eAAeuB,GAAWS,EAC/B,UAAIlN,KAAKmN,cAAcV,UAAvB,OAAI,EAA6BY,WAC/BrN,KAAKmN,cAAcV,GAASY,SAASH,OAASA,GAEhDpC,IAAY2D,QAAZ,UAAuB9D,EAAvB,YAA6C8B,GAAWS,OAtJ5D,KAAatC,EACIe,QAAsC,GAD1Cf,EAGIuC,cAA8C,GAHlDvC,EAKI6C,iBAA8C,GALlD7C,EAOIM,eAA4C,GAPhDN,EASIO,cAAe,EATnBP,EAWI4D,QAAU,IAAID,IAAQG,iB,kCC7DhC,IAAKxM,EAAZ,oE,SAAYA,O,2BAAAA,I,qBAAAA,I,2BAAAA,I,eAAAA,I,eAAAA,I,uBAAAA,I,qBAAAA,I,yBAAAA,I,qBAAAA,I,oBAAAA,M,KAqBL,IAAMF,EAAa,SAAC2M,GACzB,OAAQvL,OAAOwL,UAAUC,eAAeC,KAAKH,EAAM,U,6BChC9C,IAAKtM,EAAZ,kC,SAAYA,O,mBAAAA,I,uBAAAA,I,eAAAA,I,eAAAA,I,0BAAAA,M,2GCFA0M,EAUAC,E,yBAVAD,K,oBAAAA,E,cAAAA,E,gBAAAA,E,UAAAA,E,mBAAAA,M,cAUAC,K,YAAAA,E,aAAAA,M,KAKL,IAAMC,EAAgB,SAAhBA,EAAiBC,GAC5B,OAAQA,GACN,KAAKH,EAASI,SACZ,MAAO,gBACT,KAAKJ,EAASK,MACZ,MAAO,aACT,KAAKL,EAASM,OACZ,MAAO,cACT,KAAKN,EAASO,IACZ,MAAO,WACT,KAAKP,EAASQ,QACZ,MAAO,eAEX,OAAON,EAAcF,EAASM,SAGnBG,EAAkB,SAACC,GAC9B,OAAQA,GACN,KAAKT,EAAOU,KACV,MAAO,cACT,KAAKV,EAAOW,KACZ,QACE,MAAO,K,mECAEC,EA1BF,SAACnN,GACZ,IACEoN,EAMEpN,EANFoN,MACAX,EAKEzM,EALFyM,KACArH,EAIEpF,EAJFoF,SAHF,EAOIpF,EAHFgF,iBAJF,MAIc,GAJd,IAOIhF,EAFFgN,cALF,MAKW,OALX,EAMKK,EANL,YAOIrN,EAPJ,GASMsN,EAAQ,CAAE,QAAQ,QAAR,OAAiBC,gBAAjB,OAA0CH,EAA1C,OAEhB,OACE,8CACEpI,UAAS,eAAUwH,EAA+B,kBAATC,EAAqBH,EAASG,GAAQA,GAAtE,YAA+EzH,IACpFqI,GAFN,IAGEC,MAAOA,EAHT,UAKGlI,EACY,SAAX4H,GAAqBA,GACrB,qBAAKhI,UAAS,iBAAY+H,EAAmC,kBAAXC,EAAuBT,EAAOS,GAAUA,GAA5E,a,+BC5Bf,IAAKQ,EAAZ,kC,SAAYA,O,qBAAAA,I,0BAAAA,M,yCCFZ,oEACO,IAMKC,EANCnJ,EAAW,CACtBoJ,WAAY,aACZnJ,KAAM,S,SAIIkJ,O,6CAAAA,I,iDAAAA,I,yBAAAA,I,mBAAAA,I,6CAAAA,I,yBAAAA,I,0CAAAA,M,mCCkBZ,0bAEO,IAAME,EAAc,SAACC,EAAmBC,GAApB,MAAiF,CAC1GxO,KAAM,cACNuO,YACAC,uBAKWC,EAAgB,SAAC3O,GAAD,MAAiC,CAC5DE,KAAM,gBACNuO,UAAWzO,IAGA4O,EAAkB,SAAC5O,EAAe6O,GAAhB,MAA6D,CAC1F3O,KAAM,kBACNuO,UAAWzO,EACX6O,SAKWC,EAAe,SAACL,EAAmBxO,GAApB,MAAuD,CACjFC,KAAM,eACNuO,YACAxO,cAKW8O,EAAW,SAACN,EAAmBrF,GAApB,MAA6D,CACnFlJ,KAAM,WACNuO,YACArF,UAGW4F,EAAqB,SAACP,EAAmBQ,GAApB,MAA+D,CAC/F/O,KAAM,qBACNuO,YACAQ,gBAGWC,EAAsB,SAACT,EAAmBU,GAApB,MAAwD,CACzFjP,KAAM,sBACNuO,YACAU,cAGWC,EAAY,SAACX,EAAmBY,GAApB,MAAsD,CAC7EnP,KAAM,YACNuO,YACAY,WAGWC,EAAgB,SAACb,GAAD,MAAqC,CAChEvO,KAAM,gBACNuO,cAGWc,EAAY,SAACd,EAAmBe,EAAkBC,GAAtC,MAA6F,CACpHvP,KAAM,YACNuO,YACAe,OACAC,gBAGWC,EAAgB,SAACjB,EAAmB7L,EAAe+M,GAAnC,MAAgE,CAC3FzP,KAAM,gBACNuO,YACA7L,QACA+M,OAGWC,EAAoB,SAACnB,EAAmB7L,EAAeiN,GAAnC,MAAoE,CACnG3P,KAAM,oBACNuO,YACA7L,QACAiN,WAwBWC,EAAiC,SAACrB,EAAmBsB,GAApB,MAAoF,CAChI7P,KAAM,iCACNuO,YACAsB,2B,8NC7GWC,EAAuB,WAClC,IAAMP,EAAcQ,aAAgD,SAAAC,GAAK,OAAIA,EAAMT,eAC7EU,EAASF,aAA2C,SAAAC,GAAK,OAAIA,EAAMC,UAEnEC,EAAoBC,mBAAQ,WAChC,OAlByB,SAACZ,EAAqCU,GAEjE,IAAMG,EAAqBH,EAAOI,QAAiB,SAACC,EAAKC,GAIvD,OAHIA,EAAIC,SAAWC,IAAYC,QAC7BJ,EAAI1K,KAAJ,MAAA0K,EAAG,YAASC,EAAII,QAEXL,IACN,IAEH,OAAOf,EAAYhF,QAAO,SAACqG,GAAD,OAA6C,IAAtCR,EAAmBpN,QAAQ4N,EAAEC,OASrDC,CAAqBvB,EAAaU,KACxC,CAACV,EAAaU,IAEjB,OAAOC,GAGIa,EAAiB,WAC5B,OAAOhB,aAAgD,SAAAC,GAAK,OAAIA,EAAMT,gBAI3DzK,EAAgB,SAACxF,GAC5B,IAAM0R,EAAqBC,uBAEzB,SAACC,GAAD,OAAuBA,EAAM3B,YAAYjH,MAAK,SAAC6I,GAAD,OAAOA,EAAEN,KAAOvR,OAC9D,CAACA,IAEH,OAAOyQ,YAA8CiB,IAK1CI,EAA+B,SAAC9R,GAAqD,IAAD,EACzFuF,EAAaC,EAAcxF,GAC3B+R,EAAS,SAACrR,GACd,IAAMK,EAAkCwE,EAAWP,UAAUtE,GAC7D,OAAKK,GACE8B,YAAc9B,EAAKL,MAAMsR,iBADd,GAGpB,OAAO,EAAP,iBACGzR,IAAkBA,IAAkByD,MAAQ+N,EAAOxR,IAAkByD,OADxE,cAEGzD,IAAkBA,IAAkBsD,OAASkO,EAAOxR,IAAkBsD,QAFzE,cAGGtD,IAAkBA,IAAkBwD,OAASgO,EAAOxR,IAAkBwD,QAHzE,cAIGxD,IAAkBA,IAAkB0R,WAAaF,EAAOxR,IAAkB0R,YAJ7E,cAKG1R,IAAkBA,IAAkB0D,MAAQ8N,EAAOxR,IAAkB0D,OALxE,cAMG1D,IAAkBA,IAAkBuD,MAAQiO,EAAOxR,IAAkBuD,OANxE,I,iRC5CIoO,EAAG,2HACJ1N,KACAJ,KACA+N,KACAC,KACAC,KACAC,KACAC,KACAC,KACAC,KACAC,KAGUR,MAER,IAAMrP,EAAgB,SAACD,GAC5B,OAAOsP,EAAItP,IAGA+P,EAA+B,SAAC/P,GAC3C,GAAIgQ,YAAUhQ,GACZ,OAAOiQ,YAAqBjQ,GAE9B,GAAIsC,YAAStC,GACX,OAAOuC,YAAoBvC,GAG7B,MAAM,IAAIpD,MAAJ,UAAaoD,EAAb,sCAGKkQ,EAAwB,SAACC,GACpC,OAAQA,GACN,KAAKjS,IAAa0D,WAChB,OAAOxC,OAAOC,KAAKuC,KACrB,KAAK1D,IAAasD,QAChB,OAAOpC,OAAOC,KAAKmC,KACrB,KAAKtD,IAAakS,KAChB,OAAOhR,OAAOC,KAAKmQ,KACrB,KAAKtR,IAAamS,KAChB,OAAOjR,OAAOC,KAAKoQ,KACrB,KAAKvR,IAAaoS,SAChB,OAAOlR,OAAOC,KAAKqQ,KACrB,KAAKxR,IAAaqS,QAChB,OAAOnR,OAAOC,KAAKsQ,KACrB,KAAKzR,IAAasS,WAChB,OAAOpR,OAAOC,KAAKkQ,KACrB,KAAKrR,IAAauS,UAChB,OAAOrR,OAAOC,KAAKuQ,KACrB,KAAK1R,IAAawS,QAChB,OAAOtR,OAAOC,KAAKwQ,KACrB,KAAK3R,IAAa2D,OAChB,OAAOzC,OAAOC,KAAKyQ,OAIZa,EAAe,SAACR,GAC3B,OAAOA,IAAajS,IAAa0D,a,6BCpEnC,wIAIO,IAAMgP,EAAe,iBAAM,UACrBC,EAAe,SAACxE,GAAD,gBAA0BuE,IAA1B,YAA4CvE,IAE3DyE,EAAc,iBAAM,SACpBzQ,EAAmB,SAAC/B,GAAD,IAAuByS,EAAvB,wEAAoDD,IAApD,YAAqExS,GAArE,OAAiFyS,EAAgB,GAAK,W,8BCetI,0bAAO,IAAMC,EAAe,SAAC5T,EAAsByH,GAAvB,MAA6D,CACvF/G,KAAM,eACNV,eACAyH,WAGWoM,EAAc,SAAC7T,EAAsB8T,GAAvB,MAA+D,CACxFpT,KAAM,cACNV,eACA8T,aAGWC,EAAsB,SAAC/T,EAAsB8T,EAAkBE,GAAzC,MAA+E,CAChHtT,KAAM,sBACNV,eACA8T,WACAE,WAkBWC,EAAqB,SAACjU,EAAsBe,EAAYiT,GAAnC,MAA0E,CAC1GtT,KAAM,qBACNV,eACAe,OACAiT,WAGWE,EAA0B,SAAClU,EAAsB8T,GAAvB,MAA+D,CACpGpT,KAAM,0BACNV,eACA8T,aAGWK,EAAkB,SAACnU,EAAsBoU,EAAkCrT,GAAzD,MAA2F,CACxHL,KAAM,kBACNV,eACAe,OACAqT,kBAGWC,EAAkB,SAACrU,EAAsBoU,GAAvB,MAA+E,CAC5G1T,KAAM,kBACNV,eACAoU,kBAGWE,EAA0B,SAACtU,EAAsBoU,EAAkCG,GAAzD,MAAiG,CACtI7T,KAAM,0BACNV,eACAoU,gBACAG,aAIWC,EAAgB,SAAwBxU,EAAsByU,GAA9C,MAAmF,CAC9G/T,KAAM,gBACNV,eACAyU,eAGWC,EAAuB,SAAoB1U,EAAsBoB,GAA1C,MAA6F,CAC/HV,KAAM,uBACNV,eACAoB,WAIWuT,EAAqB,SAAC3U,EAAsB4U,GAAvB,MAAoF,CACpHlU,KAAM,qBACNV,eACA4U,oBAGWC,EAAmB,SAAC7U,EAAsBE,GAAvB,MAA2D,CACzFQ,KAAM,mBACNV,eACAE,SAGW4U,EAAQ,SAAC9U,EAAsB+U,GAAvB,MAAyD,CAC5ErU,KAAM,QACNV,eACA+U,Q,8BCvHK,IAAKhV,EAAZ,kC,SAAYA,O,yBAAAA,I,iBAAAA,I,iBAAAA,I,aAAAA,I,mBAAAA,I,iBAAAA,I,iBAAAA,I,iBAAAA,I,sBAAAA,M,oCCAZ,gNAwBYiV,EAxBZ,iBAMaC,EAAY,EACZC,EAAY,I,SAiBbF,O,eAAAA,I,eAAAA,I,4BAAAA,M,KAmBL,IAAMG,EAAyB,SAACP,GACrC,IAAMQ,EAA0B,CAAE1U,KAAMsU,EAAoBK,MAE5D,MAAO,CACLC,IAAK,CAAC,CAAEF,SAAQjT,MAAOyS,EAAgBU,MACvCC,IAAK,CAAC,CAAEH,SAAQjT,MAAOyS,EAAgBW,MACvCC,IAAK,CAAC,CAAEJ,SAAQjT,MAAOyS,EAAgBY,MACvCC,IAAK,CAAC,CAAEL,SAAQjT,MAAOyS,EAAgBa,QAyB9BC,EAAuC,SAACnQ,GACnD,IAAMpG,EAASgW,EAAuB5P,EAAWqP,iBA0BjD,OAvBAe,YAAepQ,EAAYhE,IAAWqU,mBAAmB1T,SAAQ,SAAA2T,GAC/D,IAAMT,EA1BY,SAACS,GACrB,OAAQA,EAAanV,MACnB,KAAKoV,IAAiB/U,KACpB,MAAO,CACLL,KAAMsU,EAAoBjU,KAC1BA,KAAM8U,EAAajT,UAGvB,KAAKkT,IAAiBrB,WACpB,MAAO,CACL/T,KAAMsU,EAAoBP,WAC1BsB,eAAgBF,EAAaE,iBAelBC,CAAcH,EAAaI,QAC1C,GAAIJ,EAAanV,OAASa,IAAWqU,kBAAmB,CACtD,IAAQzV,EAAc0V,EAAd1V,UACRhB,EAAOgB,GAAWmG,KAAK,CACrB8O,SACAjT,MAAOoD,EAAWqP,gBAAgBzU,GAAa0V,EAAaK,OAAS3Q,EAAWqP,gBAAgBzU,SAiB/FhB,GAGIgX,EAA+B,SAAC5Q,GAC3C,IAAM6Q,EAAWV,EAAqCnQ,GACtD,MAAO,CACL+P,IAAKc,EAASd,IAAIvE,QAAO,SAACC,EAAK7O,GAAN,OAAiB6O,EAAM7O,EAAMA,QAAQ,GAC9DoT,IAAKa,EAASb,IAAIxE,QAAO,SAACC,EAAK7O,GAAN,OAAiB6O,EAAM7O,EAAMA,QAAQ,GAC9DqT,IAAKY,EAASZ,IAAIzE,QAAO,SAACC,EAAK7O,GAAN,OAAiB6O,EAAM7O,EAAMA,QAAQ,GAC9DsT,IAAKW,EAASX,IAAI1E,QAAO,SAACC,EAAK7O,GAAN,OAAiB6O,EAAM7O,EAAMA,QAAQ,M,6BC3G3D,IAAKZ,EAkCAuU,EAlCZ,oE,SAAYvU,O,yCAAAA,I,+CAAAA,I,oDAAAA,M,cAkCAuU,O,2BAAAA,I,gBAAAA,M,qCCtCZ,0GAEaO,EAAY,SAACtB,GACxB,OAAOpN,KAAKK,MAHG,GAGcL,KAAK2O,KAAKvB,KAG5BwB,EAAY,SAACC,GACxB,OAAO7O,KAAK8O,IAAID,EAPD,GAOmB,IAIvBE,EAASH,EADG,K,8BCNzB,0KACO,IAQK/N,EARCmO,EAAkB,SAACC,GAC9B,OAAKA,EACEA,EAAW7F,QAAO,SAACC,EAAmD7O,GAE3E,OADA6O,EAAI7O,EAAMjC,MAAQiC,EAAMA,MACjB6O,IACN,IAJqB,K,SAOdxI,K,cAAAA,E,wBAAAA,E,iBAAAA,M,KAOL,IAAMqO,EAAc,SAACC,EAAaC,GAEvC,IADA,IAAIC,EACKC,EAAIF,EAASlV,OAAS,EAAGoV,GAAK,MACrCD,EAAUD,EAASE,IACPC,UAAYJ,GAFgBG,KAM1C,OAAOD,GAGIG,EAA2B,SAACC,EAAkBC,EAAuBC,GAChFD,EAAME,KAAKxG,QAAO,SAACC,EAAiBwG,EAAMC,GACxC,GAAID,EAAO,EAAG,CACZ,IAAME,EAAKD,EAAQH,EACbK,EAAIhQ,KAAKK,MAAMyP,EAAQH,GAC7BtG,EAAI1K,KAAK,CAACoR,EAAGC,IAEf,OAAO3G,IACNoG,IAGQQ,EAAiB,SAACtG,EAAauG,GAC1C,OAAOvG,EAAE,KAAOuG,EAAE,IAAMvG,EAAE,KAAOuG,EAAE,K,oJCpC/BhX,EAAeC,IAAa2D,OAC5BqT,EAAW,sBAQXpF,EAAU,CACdqF,aAAc,CACZlX,eACA8D,WAAYjD,IAAWoD,OACvB9D,OAAQC,IAAO+W,UACfC,QAAQ,GAAD,OAAKH,EAAL,uBAETI,SAAU,CACRrX,eACA8D,WAAYjD,IAAWyW,SACvBnX,OAAQC,IAAOmX,KACfH,QAAQ,GAAD,OAAKH,EAAL,gBACPO,OAAO,eAAI3R,IAAW4R,QAAU,KAElCC,UAAW,CACT1X,eACA8D,WAAYjD,IAAW8W,IACvBxX,OAAQC,IAAOwX,OACfR,QAAQ,GAAD,OAAKH,EAAL,kBACPO,OAAO,eAAI3R,IAAW4R,QAAU,KAElCI,QAAS,CACP7X,eACA8D,WAAYjD,IAAWiX,IACvB3X,OAAQC,IAAOwX,OACfR,QAAQ,GAAD,OAAKH,EAAL,gBACPO,OAAO,eAAI3R,IAAW4R,QAAU,KAElCM,gBAAiB,CACf/X,eACA8D,WAAYjD,IAAWoD,OACvB9D,OAAQC,IAAOmX,KACfH,QAAQ,GAAD,OAAKH,EAAL,yBAETe,cAAe,CACbhY,eACA8D,WAAYjD,IAAWoX,KACvBb,QAAQ,GAAD,OAAKH,EAAL,sBACP9W,OAAQC,IAAOwX,OACfJ,OAAO,eAAI3R,IAAW4R,QAAU,KAElCS,aAAc,CACZlY,eACA8D,WAAYjD,IAAWsX,MACvBf,QAAQ,GAAD,OAAKH,EAAL,qBACP9W,OAAQC,IAAOwX,OACfJ,OAAO,eAAI3R,IAAW4R,QAAU,IAElCW,QAAS,CACPpY,eACA8D,WAAYjD,IAAWoD,OACvB9D,OAAQC,IAAOwX,OACfR,QAAQ,GAAD,OAAKH,EAAL,gBAEToB,QAAS,CACPrY,eACA8D,WAAYjD,IAAWsX,MACvBf,QAAQ,GAAD,OAAKH,EAAL,eACP9W,OAAQC,IAAOwX,OACfJ,OAAO,eAAI3R,IAAW4R,QAAU,IAElCa,KAAM,CACJtY,eACA8D,WAAYjD,IAAWyX,KACvBlB,QAAQ,GAAD,OAAKH,EAAL,YACP9W,OAAQC,IAAOwX,OACfJ,OAAO,eAAI3R,IAAW4R,QAAU,IAElCc,OAAQ,CACNvY,eACA8D,WAAYjD,IAAWsX,MACvBf,QAAQ,GAAD,OAAKH,EAAL,cACP9W,OAAQC,IAAOoY,KACfhB,OAAO,eAAI3R,IAAW4R,QAAU,KAElCgB,KAAM,CACJzY,eACA8D,WAAYjD,IAAWsX,MACvBf,QAAQ,GAAD,OAAKH,EAAL,YACP9W,OAAQC,IAAOsY,SACflB,OAAO,eAAI3R,IAAW4R,QAAU,KAElCkB,SAAU,CACR3Y,eACA8D,WAAYjD,IAAW+X,MACvBxB,QAAQ,GAAD,OAAKH,EAAL,gBACP9W,OAAQC,IAAOoY,KACfhB,OAAO,eAAI3R,IAAW4R,QAAU,KAElCoB,MAAO,CACL7Y,eACA8D,WAAYjD,IAAWgY,MACvBzB,QAAQ,GAAD,OAAKH,EAAL,aACP9W,OAAQC,IAAOsY,SACflB,OAAO,eAAI3R,IAAW4R,QAAU,KAElCqB,aAAc,CACZ9Y,eACA8D,WAAYjD,IAAWoD,OACvB9D,OAAQC,IAAOoY,KACfpB,QAAQ,GAAD,OAAKH,EAAL,sBAET8B,iBAAkB,CAChB/Y,eACA8D,WAAYjD,IAAW+X,MACvBxB,QAAQ,GAAD,OAAKH,EAAL,uBACP+B,QAAQ,EACR7Y,OAAQC,IAAO+W,UACfK,OAAO,eAAI3R,IAAW4R,QAAU,IAChCwB,QAAS,CAAC,CACRpZ,KAAMa,IAAWqU,kBACjBzV,UAAW,MACX+V,OAAQ,KACP,CACDxV,KAAMa,IAAWqU,kBACjBzV,UAAW,MACX+V,OAAQ,KACP,CACDxV,KAAMa,IAAWqU,kBACjBzV,UAAW,MACX+V,OAAQ,KACP,CACDxV,KAAMa,IAAWqU,kBACjBzV,UAAW,MACX+V,OAAQ,OAGZ6D,QAAS,CACPlZ,eACA8D,WAAYjD,IAAWsY,QACvB/B,QAAQ,GAAD,OAAKH,EAAL,eACP9W,OAAQC,IAAOoY,KACfhB,OAAO,eAAI3R,IAAW4R,QAAU,KAElC2B,WAAY,CACVpZ,eACA8D,WAAYjD,IAAWiX,IACvBV,QAAQ,GAAD,OAAKH,EAAL,mBACP9W,OAAQC,IAAOwX,OACfJ,OAAO,eAAI3R,IAAW4R,QAAU,IAElC4B,oBAAqB,CACnBrZ,eACA8D,WAAYjD,IAAWoD,OACvB9D,OAAQC,IAAOmX,KACfyB,QAAQ,EACR5B,QAAQ,GAAD,OAAKH,EAAL,6BAETqC,YAAa,CACXtZ,eACA8D,WAAYjD,IAAWsX,MACvBhY,OAAQC,IAAOmX,KACfH,QAAQ,GAAD,OAAKH,EAAL,qBAETsC,QAAS,CACPvZ,eACA8D,WAAYjD,IAAWsY,QACvB/B,QAAQ,GAAD,OAAKH,EAAL,eACP9W,OAAQC,IAAOmX,KACfC,OAAO,eAAI3R,IAAW4R,QAAU,KAElC+B,QAAS,CACPxZ,eACA8D,WAAYjD,IAAW+X,MACvBxB,QAAQ,GAAD,OAAKH,EAAL,eACP9W,OAAQC,IAAOmX,KACfC,OAAO,eAAI3R,IAAW4R,QAAU,KAElCgC,iBAAkB,CAChBzZ,eACA8D,WAAYjD,IAAW+X,MACvBxB,QAAQ,GAAD,OAAKH,EAAL,yBACP9W,OAAQC,IAAOoY,KACfhB,OAAO,eAAI3R,IAAW4R,QAAU,IAElCiC,QAAS,CACP1Z,eACA8D,WAAYjD,IAAWiX,IACvBV,QAAQ,GAAD,OAAKH,EAAL,eACP9W,OAAQC,IAAOoY,KACfhB,OAAO,eAAI3R,IAAW4R,QAAU,IAElCkC,KAAM,CACJ3Z,eACA8D,WAAYjD,IAAWyX,KACvBlB,QAAQ,GAAD,OAAKH,EAAL,YACP9W,OAAQC,IAAOoY,KACfhB,OAAO,eAAI3R,IAAW4R,QAAU,KAElCmC,YAAa,CACX5Z,eACA8D,WAAYjD,IAAWyX,KACvBlB,QAAQ,GAAD,OAAKH,EAAL,oBACP9W,OAAQC,IAAOsY,SACflB,OAAO,eAAI3R,IAAW4R,QAAU,KAElCoC,WAAY,CACV7Z,eACA8D,WAAYjD,IAAWiX,IACvBV,QAAQ,GAAD,OAAKH,EAAL,mBACP9W,OAAQC,IAAOoY,KACfhB,OAAO,eAAI3R,IAAW4R,QAAU,KAElCqC,eAAgB,CACd9Z,eACA8D,WAAYjD,IAAWoD,OACvBmT,QAAQ,GAAD,OAAKH,EAAL,wBAET8C,eAAgB,CACd/Z,eACA8D,WAAYjD,IAAWsX,MACvBf,QAAQ,GAAD,OAAKH,EAAL,uBACP9W,OAAQC,IAAOmX,KACfC,OAAO,eAAI3R,IAAW4R,QAAU,KAElCuC,UAAW,CACTha,eACA8D,WAAYjD,IAAWsY,QACvB/B,QAAQ,GAAD,OAAKH,EAAL,kBACP9W,OAAQC,IAAOsY,SACflB,OAAO,eAAI3R,IAAW4R,QAAU,KAElCwC,WAAY,CACVja,eACA8D,WAAYjD,IAAWqZ,MACvB9C,QAAQ,GAAD,OAAKH,EAAL,mBACP9W,OAAQC,IAAOmX,KACfC,OAAO,eAAI3R,IAAW4R,QAAU,KAElC0C,OAAQ,CACNna,eACA8D,WAAYjD,IAAWsY,QACvB/B,QAAQ,GAAD,OAAKH,EAAL,cACP9W,OAAQC,IAAOwX,OACfJ,OAAO,eAAI3R,IAAW4R,QAAU,IAElC2C,YAAa,CACXpa,eACA8D,WAAYjD,IAAWqZ,MACvB9C,QAAQ,GAAD,OAAKH,EAAL,oBACP9W,OAAQC,IAAOmX,KACfC,OAAO,eAAI3R,IAAW4R,QAAU,IAElC4C,eAAgB,CACdra,eACA8D,WAAYjD,IAAWyW,SACvBF,QAAQ,GAAD,OAAKH,EAAL,gBACP9W,OAAQC,IAAOwX,OACfJ,OAAO,eAAI3R,IAAW4R,QAAU,IAElC6C,MAAO,CACLta,eACA8D,WAAYjD,IAAWsY,QACvB/B,QAAQ,GAAD,OAAKH,EAAL,aACP9W,OAAQC,IAAOoY,KACfhB,OAAO,eAAI3R,IAAW4R,QAAU,KAElC8C,YAAa,CACXva,eACA8D,WAAYjD,IAAWoD,OACvB9D,OAAQC,IAAOoY,KACfpB,QAAQ,GAAD,OAAKH,EAAL,qBAETuD,WAAY,CACVxa,eACA8D,WAAYjD,IAAW+X,MACvBxB,QAAQ,GAAD,OAAKH,EAAL,mBACP9W,OAAQC,IAAOsY,SACflB,OAAO,eAAI3R,IAAW4R,QAAU,KAElCgD,UAAW,CACTza,eACA8D,WAAYjD,IAAW6Z,OACvBtD,QAAQ,GAAD,OAAKH,EAAL,iBACP9W,OAAQC,IAAOoY,KACfhB,OAAO,eAAI3R,IAAW4R,QAAU,KAElCkD,cAAe,CACb3a,eACA8D,WAAYjD,IAAWoD,OACvB9D,OAAQC,IAAOwX,OACfR,QAAQ,GAAD,OAAKH,EAAL,wBAML5F,EAAMlQ,OAAOyZ,QAAQ/I,GAAS3B,QAA4C,SAACC,EAAD,GAAwB,IAAD,mBAAhB/R,EAAgB,KAAXkD,EAAW,KAErG,OADA6O,EAAI,GAAD,OA1SU,WA0SV,OAAa/R,IAASkD,EAClB6O,IACN,IAGI,SAASnO,EAAc4B,GAC5B,OAAOyN,EAAIzN,GAHEyN,MAMR,IAAMhN,EAAW,SAACnE,GACvB,QAASmR,EAAInR,K,8KC5SF2a,EAAuB,QAKvBC,EAAb,mKAQE,SAAgBpV,EAAe7F,EAAakb,EAAe5Y,GAAgB,IAAD,OAExEpE,KAAKid,MAAL,sBAAiBjd,KAAKid,OAAtB,CAA6B,CAC3BnU,KAAMQ,KAAK4T,MACXvV,QACA7F,OACAkb,OACA5Y,UAGFpE,KAAKqN,SAAS8P,KAAKL,EAAsB9c,KAAKid,OAE9CrS,IAAawS,UAAU,YAEvBC,YAAW,WAET,EAAKJ,MAAQ,EAAKA,MAAM5Q,QAAO,SAACiR,GAC9B,OAAOhU,KAAK4T,MAAQI,EAAMxU,KAAO,EAAKyU,YAExC,EAAKlQ,SAAS8P,KAAKL,EAAsB,EAAKG,SAE7Cjd,KAAKud,YA7BZ,oBAgCE,WACE,OAAOvd,KAAKwd,cAjChB,GAAmCC,KAAtBV,EACIS,UAAY,IAAIT,EADpBA,EAGIE,MAAuB,GAH3BF,EAKIQ,SAAWxV,K,6BCxB5B,sCAOYlF,EAPZ,+B,SAOYA,O,6CAAAA,I,iBAAAA,I,eAAAA,I,6BAAAA,I,mCAAAA,I,mCAAAA,I,iCAAAA,I,8BAAAA,M,KAqCG6a,IA1BD,SAACjb,GACb,IACEkF,EAIElF,EAJFkF,MADF,EAKIlF,EAHFX,YAFF,MAESe,EAAK8a,oBAFd,IAKIlb,EAFFua,YAHF,MAGS,wCAHT,EAIE5Y,EACE3B,EADF2B,KAEIwZ,EAAWC,cAQXC,EAAWje,IAAYke,aAAajc,GAC1C,OACE,sBAAK2F,UAAS,gBAAWrD,EAAO,WAAa,IAAM4Z,QARjC,WACd5Z,GACFwZ,EAASxZ,IAMX,UACE,qBAAKqD,UAAU,aAAf,SAA6BqW,IAC7B,qBAAKrW,UAAU,cAAf,SAA8BE,IAC9B,cAAC,IAAD,CAAMuH,KAAK,MAAMW,MAAOmN,EAAMvV,UAAU,aAAagI,OAAO,SAC5D,qBAAKhI,UAAU,gB,2YCnCRwW,EAAe,EACfC,EAAkB,EAClBC,EAAgB,EAChBC,EAAgB,EAChBC,EAAgB,EAEhBC,EAAqB,SAACC,EAAkC3G,GACnE,IAAQf,EAAQ0H,EAAR1H,IACR,OAAO9N,KAAKK,MAAM,IAAO,KAAOyN,GAAO,EAAKe,EAAQ,IAAO,KAWhD4G,EAAiB,SAACD,GAE7B,OAAa,EADGA,EAAR1H,KAIG4H,EAAY,WAAsB,IAArBC,EAAoB,uDAAN,EAChCC,EAAOC,cACb,OAAOD,GAAQD,GAGJG,EAAc,SAACN,GAG1B,OAFcC,EAAeD,GAChBO,YAAU,EAAG,MAOfC,EAAe,WAAO,IAAD,EAC1BC,GAAS,mBACZrd,IAAkByD,KAAO,IADb,cAEZzD,IAAkBsD,MAAQ,IAFd,cAGZtD,IAAkBwD,MAAQ,IAHd,cAIZxD,IAAkB0D,KAAO,IAJb,cAKZ1D,IAAkB0R,UAAY,KALlB,cAMZ1R,IAAkBuD,KAAO,KANb,GASf,OAAO+Z,YAAaD,K,8BC/Cf,IAAKE,EAAZ,kC,SAAYA,K,0BAAAA,E,gBAAAA,E,cAAAA,E,4BAAAA,E,0BAAAA,E,2BAAAA,M,yYCeCC,EAAwB,SAACxY,EAAkCoL,GACtE,OAAOA,EAAO3H,MAAK,SAAA6I,GAAC,OAAIA,EAAER,MAAM2M,MAAK,SAAA1M,GAAC,OAAIA,IAAM/L,EAAWgM,UAGhD0M,EAAqB,SAAChO,EAAqCsB,GACtE,OAAOtB,EAAYjH,MAAK,SAACsI,GAAD,OAAOA,EAAEC,KAAOA,MAG7BT,EAAqB,SAACb,EAAqCzP,GAEtE,OAAOA,EAAM6Q,MAAM3G,KAAI,SAAC6G,GAAD,OAAgB0M,EAAmBhO,EAAasB,OAG5D2M,EAAiB,SAACjO,EAAqCzP,GAClE,IAAM2d,EAAW3d,EAAM6Q,MAAM,GAC7B,OAAO4M,EAAmBhO,EAAakO,IAM5BC,EAA+B,SAAC7Y,GAC3C,OAAOA,EAAW8Y,UAAUpT,QAAO,SAAAgM,GAAC,OAAU,OAANA,KAAYpV,QAKzCyc,EAAoB,SAAC/Y,GAChC,IAAMgZ,EAAQ,SAACC,GACb,IAAMzd,EAAOwE,EAAWP,UAAUwZ,GAClC,QAASzd,GAAQmE,YAASnE,EAAKL,OAEjC,MAAM,GAAN,mBACK6d,EAAMhe,IAAkB+D,UAAY,CAACiB,EAAWP,UAAUzE,IAAkB+D,WAAa,IAD9F,YAEKia,EAAMhe,IAAkBgE,SAAW,CAACgB,EAAWP,UAAUzE,IAAkBgE,UAAY,MAMjFka,EAAiB,SAAClZ,GAC7B,IAAMxE,EAAOwE,EAAWP,UAAUzE,IAAkBgE,SACpD,OAAQxD,GAAQ2d,YAAa3d,EAAKL,MAAS6E,EAAWP,UAAUzE,IAAkBgE,cAA+Boa,GAItGC,EAA2B,SAAC7V,EAAwB8V,GAAyF,IAArEC,EAAoE,uDAAf,kBAAM,GAC9I,OAAO/V,EAAQC,MAAK,SAAAC,GAAC,OAAIA,EAAE4V,UAAYjH,YAAe3O,EAAE4V,SAAUA,IAAaC,EAAiB7V,OAGrF8V,EAAyB,SAAChW,EAAwB7I,GAC7D,OAAO6I,EAAQC,MAAK,SAAAgW,GAAE,OAAIvW,YAAauW,IAAOA,EAAGhf,eAAiBE,GAAQ0I,YAAQoW,IAAOA,EAAG7V,UAAYjJ,MAI7F+e,EAAoB,SAACvO,GAChC,YAAqCiO,KAAzB,OAALjO,QAAK,IAALA,OAAA,EAAAA,EAAOwO,OAAOC,e,6BC1EhB,IAAKC,EAAZ,kC,SAAYA,O,mBAAAA,I,eAAAA,I,kBAAAA,M,mCCIL,IAAK5d,EANZ,kC,SAMYA,O,2BAAAA,I,qBAAAA,I,gBAAAA,M,yCCNZ,wEA4BY6d,EA5BZ,M,SA4BYA,O,eAAAA,I,aAAAA,I,eAAAA,I,mBAAAA,I,mBAAAA,I,iBAAAA,I,iBAAAA,I,oBAAAA,M,KAgCL,IAAMC,EAA6B,CAAC,MAAO,MAAO,MAAO,Q,+BC3DzD,SAAS7R,EAAyC8R,EAAQC,GAC/D,OAAOxd,OAAOyL,eAAeC,KAAK6R,EAAKC,GASlC,SAAS/D,EAAW8D,GACzB,OAAOvd,OAAOyZ,QAAQ8D,GAZxB,sGAiBO,IAAME,EAAW,SAA+CC,GACrE,OAAO1d,OAAOC,KAAKyd,GAAazU,QAAO,SAAA0U,GAAC,OAAKC,MAAMC,OAAOF,OAAKjV,KAAI,SAAAiV,GAAC,OAAIE,OAAOF,Q,2ICX3E9e,EAAeC,IAAasD,QAC5B0T,EAAW,sBAEXgI,EAA6C,CACjDpf,KAAMa,IAAWqU,kBACjBzV,UAAW,MACX+V,OAAQ,MASJ6J,EAAc,CAClBC,OAAQ,CACN9b,cAAe3D,IAAkBuD,KACjCjD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,gBAETmI,OAAQ,CACN/b,cAAe3D,IAAkBuD,KACjCjD,eACAmR,gBAAiB,EACjBiG,QAAQ,GAAD,OAAKH,EAAL,gBAEToI,OAAQ,CACNhc,cAAe3D,IAAkBuD,KACjCjD,eACAmR,gBAAiB,EACjBiG,QAAQ,GAAD,OAAKH,EAAL,gBAETqI,cAAe,CACbjc,cAAe3D,IAAkByD,KACjCnD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,sBACP9F,gBAAiB,GAEnBnO,MAAO,CACLK,cAAe3D,IAAkBsD,MACjChD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,eACP9F,gBAAiB,GAEnBoO,YAAa,CACXlc,cAAe3D,IAAkBwD,MACjClD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,oBACP9F,gBAAiB,GAEnBqO,KAAM,CACJnc,cAAe3D,IAAkByD,KACjCnD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,YACP9F,gBAAiB,GAEnBsO,aAAc,CACZpc,cAAe3D,IAAkBuD,KACjCjD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,qBACP9F,gBAAiB,GAEnBuO,kBAAmB,CACjBrc,cAAe3D,IAAkBuD,KACjCjD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,2BACP9F,gBAAiB,EACjB8H,QAAS,CAACgG,IAEZU,qBAAsB,CACpBtc,cAAe3D,IAAkB0D,KACjCpD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,8BACP9F,gBAAiB,EACjB8H,QAAS,CAACgG,IAEZW,iBAAkB,CAChBvc,cAAe3D,IAAkByD,KACjCnD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,0BACP9F,gBAAiB,EACjB8H,QAAS,CAACgG,IAEZY,kBAAmB,CACjBxc,cAAe3D,IAAkBwD,MACjClD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,2BACP9F,gBAAiB,EACjB8H,QAAS,CAACgG,IAEZa,sBAAuB,CACrBzc,cAAe3D,IAAkB0R,UACjCpR,eACAoX,QAAQ,GAAD,OAAKH,EAAL,+BACP9F,gBAAiB,EACjB8H,QAAS,CAACgG,IAEZc,kBAAmB,CACjB1c,cAAe3D,IAAkBsD,MACjChD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,2BACP9F,gBAAiB,EACjB8H,QAAS,CAACgG,IAEZe,cAAe,CACb3c,cAAe3D,IAAkBwD,MACjClD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,sBACP9F,gBAAiB,GAEnB8O,aAAc,CACZ5c,cAAe3D,IAAkB0D,KACjCpD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,qBACP9F,gBAAiB,GAEnB+O,YAAa,CACX7c,cAAe3D,IAAkBsD,MACjChD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,oBACP9F,gBAAiB,GAEnBgP,qBAAsB,CACpB9c,cAAe3D,IAAkB0R,UACjCpR,eACAoX,QAAQ,GAAD,OAAKH,EAAL,6BACP9F,gBAAiB,GAEnBiP,kBAAmB,CACjB/c,cAAe3D,IAAkBwD,MACjClD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,2BACP9F,gBAAiB,GAEnBkP,eAAgB,CACdhd,cAAe3D,IAAkB0R,UACjCpR,eACAoX,QAAQ,GAAD,OAAKH,EAAL,wBACP9F,gBAAiB,GAEnBmP,kBAAmB,CACjBjd,cAAe3D,IAAkBsD,MACjChD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,2BACP9F,gBAAiB,GAEnBoP,eAAgB,CACdld,cAAe3D,IAAkByD,KACjCnD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,wBACP9F,gBAAiB,GAEnBqP,iBAAkB,CAChBnd,cAAe3D,IAAkB0D,KACjCpD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,0BACP9F,gBAAiB,GAEnBsP,mBAAoB,CAClBpd,cAAe3D,IAAkBuD,KACjCjD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,4BACP9F,gBAAiB,GAEnBuP,iBAAkB,CAChBrd,cAAe3D,IAAkBuD,KACjCjD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,yBACP9F,gBAAiB,GAEnBwP,iBAAkB,CAChBtd,cAAe3D,IAAkBsD,MACjChD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,yBACP9F,gBAAiB,GAEnByP,qBAAsB,CACpBvd,cAAe3D,IAAkBwD,MACjClD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,6BACP9F,gBAAiB,GAEnB0P,gBAAiB,CACfxd,cAAe3D,IAAkByD,KACjCnD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,wBACP9F,gBAAiB,GAEnB2P,qBAAsB,CACpBzd,cAAe3D,IAAkB0D,KACjCpD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,6BACP9F,gBAAiB,GAEnB4P,qBAAsB,CACpB1d,cAAe3D,IAAkB0R,UACjCpR,eACAoX,QAAQ,GAAD,OAAKH,EAAL,6BACP9F,gBAAiB,GAEnB6P,WAAY,CACV3d,cAAe3D,IAAkBsD,MACjChD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,oBAETgK,UAAW,CACT5d,cAAe3D,IAAkBuD,KACjCjD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,mBAETiK,WAAY,CACV7d,cAAe3D,IAAkBwD,MACjClD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,oBAETkK,UAAW,CACT9d,cAAe3D,IAAkByD,KACjCnD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,mBAETmK,UAAW,CACT/d,cAAe3D,IAAkB0D,KACjCpD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,mBAEToK,OAAQ,CACNhe,cAAe3D,IAAkByD,KACjCnD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,eAETqK,aAAc,CACZje,cAAe3D,IAAkBuD,KACjCjD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,sBAETsK,mBAAoB,CAClBle,cAAe3D,IAAkBsD,MACjChD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,4BAETuK,iBAAkB,CAChBne,cAAe3D,IAAkByD,KACjCnD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,0BAETwK,aAAc,CACZpe,cAAe3D,IAAkBwD,MACjClD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,sBAETyK,iBAAkB,CAChBre,cAAe3D,IAAkB0D,KACjCpD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,0BAET0K,iBAAkB,CAChBte,cAAe3D,IAAkB0R,UACjCpR,eACAoX,QAAQ,GAAD,OAAKH,EAAL,0BAET2K,SAAU,CACRve,cAAe3D,IAAkBuD,KACjCjD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,iBACP9F,gBAAiB,GAEnB0Q,SAAU,CACRxe,cAAe3D,IAAkBuD,KACjCjD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,kBAET6K,aAAc,CACZze,cAAe3D,IAAkByD,KACjCnD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,sBAET8K,cAAe,CACb1e,cAAe3D,IAAkBwD,MACjClD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,uBAET+K,gBAAiB,CACf3e,cAAe3D,IAAkB0R,UACjCpR,eACAoX,QAAQ,GAAD,OAAKH,EAAL,yBAETgL,gBAAiB,CACf5e,cAAe3D,IAAkByD,KACjCnD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,yBAETiL,qBAAsB,CACpB7e,cAAe3D,IAAkBuD,KACjCjD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,8BAETkL,qBAAsB,CACpB9e,cAAe3D,IAAkBwD,MACjClD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,8BAETmL,gBAAiB,CACf/e,cAAe3D,IAAkBsD,MACjChD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,yBAEToL,YAAa,CACXhf,cAAe3D,IAAkByD,KACjCnD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,qBAETqL,OAAQ,CACNjf,cAAe3D,IAAkB0D,KACjCpD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,eACP9F,gBAAiB,GAEnBoR,OAAQ,CACNlf,cAAe3D,IAAkB0D,KACjCpD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,eACP9F,gBAAiB,GAEnBqR,YAAa,CACXnf,cAAe3D,IAAkBsD,MACjChD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,sBAETwL,YAAa,CACXpf,cAAe3D,IAAkBsD,MACjChD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,sBAETyL,YAAa,CACXrf,cAAe3D,IAAkBsD,MACjChD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,sBAET0L,YAAa,CACXtf,cAAe3D,IAAkBsD,MACjChD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,sBAET2L,aAAc,CACZvf,cAAe3D,IAAkBwD,MACjClD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,uBAET4L,aAAc,CACZxf,cAAe3D,IAAkBwD,MACjClD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,uBAET6L,YAAa,CACXzf,cAAe3D,IAAkByD,KACjCnD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,uBAET8L,WAAY,CACV1f,cAAe3D,IAAkB0D,KACjCpD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,qBAET+L,gBAAiB,CACf3f,cAAe3D,IAAkB0R,UACjCpR,eACAoX,QAAQ,GAAD,OAAKH,EAAL,0BAETgM,gBAAiB,CACf5f,cAAe3D,IAAkB0R,UACjCpR,eACAoX,QAAQ,GAAD,OAAKH,EAAL,0BAETiM,KAAM,CACJ7f,cAAe3D,IAAkBsD,MACjChD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,eAETkM,WAAY,CACV9f,cAAe3D,IAAkB0R,UACjCpR,eACAoX,QAAQ,GAAD,OAAKH,EAAL,oBAETmM,WAAY,CACV/f,cAAe3D,IAAkB0R,UACjCpR,eACAoX,QAAQ,GAAD,OAAKH,EAAL,mBACP9F,gBAAiB,GAEnBkS,WAAY,CACVhgB,cAAe3D,IAAkB0R,UACjCpR,eACAoX,QAAQ,GAAD,OAAKH,EAAL,oBAETqM,6BAA8B,CAC5BjgB,cAAe3D,IAAkB0R,UACjCpR,eACAoX,QAAQ,GAAD,OAAKH,EAAL,uCAETsM,kBAAmB,CACjBlgB,cAAe3D,IAAkB0D,KACjCpD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,2BAETuM,gBAAiB,CACfngB,cAAe3D,IAAkBwD,MACjClD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,yBAETwM,cAAe,CACbpgB,cAAe3D,IAAkByD,KACjCnD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,uBAETyM,gBAAiB,CACfrgB,cAAe3D,IAAkB0R,UACjCpR,eACAoX,QAAQ,GAAD,OAAKH,EAAL,yBAET0M,mBAAoB,CAClBtgB,cAAe3D,IAAkBuD,KACjCjD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,4BAET2M,eAAgB,CACdvgB,cAAe3D,IAAkBsD,MACjChD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,wBAET4M,sBAAuB,CACrBxgB,cAAe3D,IAAkBsD,MACjChD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,gCAET6M,kBAAmB,CACjBzgB,cAAe3D,IAAkBwD,MACjClD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,4BAET8M,mBAAoB,CAClB1gB,cAAe3D,IAAkB0R,UACjCpR,eACAoX,QAAQ,GAAD,OAAKH,EAAL,6BAET+M,gBAAiB,CACf3gB,cAAe3D,IAAkByD,KACjCnD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,0BAETgN,qBAAsB,CACpB5gB,cAAe3D,IAAkB0D,KACjCpD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,+BAETiN,qBAAsB,CACpB7gB,cAAe3D,IAAkB0R,UACjCpR,eACAoX,QAAQ,GAAD,OAAKH,EAAL,+BAETkN,KAAM,CACJ9gB,cAAe3D,IAAkBsD,MACjChD,eACAoX,QAAQ,GAAD,OAAKH,EAAL,eAETmN,iBAAkB,CAChB/gB,cAAe3D,IAAkBuD,KACjC9C,OAAQC,IAAOmX,KACfvX,eACAoX,QAAQ,GAAD,OAAKH,EAAL,0BAEToN,oBAAqB,CACnBhhB,cAAe3D,IAAkB0D,KACjCjD,OAAQC,IAAOmX,KACfvX,eACAoX,QAAQ,GAAD,OAAKH,EAAL,6BAETqN,gBAAiB,CACfjhB,cAAe3D,IAAkB0R,UACjCjR,OAAQC,IAAOmX,KACfvX,eACAoX,QAAQ,GAAD,OAAKH,EAAL,yBAETsN,oBAAqB,CACnBlhB,cAAe3D,IAAkBsD,MACjC7C,OAAQC,IAAOmX,KACfvX,eACAoX,QAAQ,GAAD,OAAKH,EAAL,6BAETuN,iBAAkB,CAChBnhB,cAAe3D,IAAkBwD,MACjC/C,OAAQC,IAAOmX,KACfvX,eACAoX,QAAQ,GAAD,OAAKH,EAAL,0BAETwN,eAAgB,CACdphB,cAAe3D,IAAkByD,KACjChD,OAAQC,IAAOmX,KACfvX,eACAoX,QAAQ,GAAD,OAAKH,EAAL,yBAKL5F,EAAMlQ,OAAOyZ,QAAQsE,GAAahP,QAA6C,SAACC,EAAD,GAAwB,IAAD,mBAAhB/R,EAAgB,KAAXkD,EAAW,KAE1G,OADA6O,EAAI,GAAD,OA1fU,YA0fV,OAAa/R,IAASkD,EAClB6O,IACN,IAGI,SAASnO,EAAcuB,GAC5B,OAAO8N,EAAI9N,GAHE8N,MAMR,IAAMU,EAAY,SAAC7R,GACxB,QAASmR,EAAInR,K,6BCvgBR,IAAKoQ,EAAZ,kC,SAAYA,O,6BAAAA,I,yBAAAA,I,mBAAAA,I,0BAAAA,M,2HCCNtQ,EAAeC,IAAasS,WAC5B0E,EAAW,0BAQX3F,EAAc,CAClBoT,kBAAmB,CACjBxS,SAAU,SACV3R,OAAQ,GACRP,eACAoX,QAAQ,GAAD,OAAKH,EAAL,4BAET0N,gBAAiB,CACfzS,SAAU,OACVlS,eACAoX,QAAQ,GAAD,OAAKH,EAAL,0BAET2N,UAAW,CACT1S,SAAU,OACVlS,eACAoX,QAAQ,GAAD,OAAKH,EAAL,kBACP1W,OAAQ,KAEVskB,mBAAoB,CAClB3S,SAAU,SACV3R,OAAQ,GACRP,eACAoX,QAAQ,GAAD,OAAKH,EAAL,6BAET6N,iBAAkB,CAChB5S,SAAU,OACVlS,eACAoX,QAAQ,GAAD,OAAKH,EAAL,2BAET8N,WAAY,CACV7S,SAAU,OACVlS,eACAoX,QAAQ,GAAD,OAAKH,EAAL,mBACP1W,OAAQ,MAEVykB,kBAAmB,CACjB9S,SAAU,SACV3R,OAAQ,GACRP,eACAoX,QAAQ,GAAD,OAAKH,EAAL,4BAETgO,gBAAiB,CACf/S,SAAU,OACVlS,eACAoX,QAAQ,GAAD,OAAKH,EAAL,0BAETiO,UAAW,CACThT,SAAU,OACVlS,eACAoX,QAAQ,GAAD,OAAKH,EAAL,kBACP1W,OAAQ,KAEV4kB,oBAAqB,CACnBjT,SAAU,SACV3R,OAAQ,GACRP,eACAoX,QAAQ,GAAD,OAAKH,EAAL,8BAETmO,kBAAmB,CACjBlT,SAAU,OACVlS,eACAoX,QAAQ,GAAD,OAAKH,EAAL,4BAEToO,YAAa,CACXnT,SAAU,OACVlS,eACAoX,QAAQ,GAAD,OAAKH,EAAL,oBACP1W,OAAQ,IAKN8Q,EAAMlQ,OAAOyZ,QAAQtJ,GAAapB,QAAgD,SAACC,EAAD,GAAwB,IAAD,mBAAhB/R,EAAgB,KAAXkD,EAAW,KAE7G,OADA6O,EAAI,GAAD,OAnFU,eAmFV,OAAa/R,IAASkD,EAClB6O,IACN,IAGI,SAASnO,EAAcuQ,GAC5B,OAAOlB,EAAIkB,GAHElB,MAMR,IAAMiU,EAAe,SAACplB,GAC3B,QAASmR,EAAInR,K,0KC1FHqlB,EACAC,E,iDAFCC,EAAqB,e,SACtBF,O,mBAAAA,I,wBAAAA,M,cACAC,O,qBAAAA,I,kBAAAA,M,KAML,IAAME,EAAb,oKAGE,SAAiBC,EAAcC,GAAqG,IAAvFC,EAAsF,uDAA7DN,EAAWvW,OAAQwH,EAA0C,uDAArBgP,EAAYM,QACxH/nB,KAAKqN,SAAS8P,KAAKuK,EAAoBE,EAAMC,EAAOC,EAAYrP,KAJpE,oBAOE,WACE,OAAOzY,KAAKwd,cARhB,GAAoCC,KAAvBkK,EACInK,UAAY,IAAImK,G,uFCC3BrU,EAAM,CACV0U,YCXyD,CACzDC,aAAc,SAACC,GAAD,OAAiCA,EAAWC,WAC1DC,oBAAqB,SAACC,GACpB,OAAOC,KAETC,MAAO,CAAC,CACNzP,EAAG,EACHC,EAAG,EACHjX,KAAMmO,IAAcuY,UACpBC,WAAY,kBACX,CACD3P,EAAG,EACHC,EAAG,EACH7V,IAAK,mCACLpB,KAAMmO,IAAcyY,SACnB,CACD5P,EAAG,EACHC,EAAG,EACHjX,KAAMmO,IAAcyY,SACnB,CACD5P,EAAG,EACHC,EAAG,EACHjX,KAAMmO,IAAcuY,UACpBC,WAAY,oBACX,CACD3P,EAAG,EACHC,EAAG,EACHjX,KAAMmO,IAAcyY,QACpBxlB,IAAK,oCACJ,CACD4V,EAAG,EACHC,EAAG,EACHjX,KAAMmO,IAAcyY,QACpBxlB,IAAK,mCACJ,CACD4V,EAAG,EACHC,EAAG,EACHjX,KAAMmO,IAAcyY,SACnB,CACD5P,EAAG,EACHC,EAAG,EACHjX,KAAMmO,IAAcuY,UACpBC,WAAY,mBAGX,CACD3P,EAAG,EACHC,EAAG,EACHjX,KAAMmO,IAAcyY,QACpBxlB,IAAK,0BACJ,CACD4V,EAAG,EACHC,EAAG,EACHjX,KAAMmO,IAAcyY,WDzCtBC,oBETyE,CACzEV,aAAc,SAACC,GAAD,OAAiCA,EAAWC,WAC1DC,oBAAqB,SAACC,GAKpB,MAJ2C,CACzCO,KAAK,EACLC,IAAK,KAITC,cAAe,CACb,kBACA,kBACA,kBACA,qBACA,sBAEFP,MAAO,CAAC,CACNzP,EAAG,EACHC,EAAG,EACHjX,KAAMmO,IAAcyY,SACnB,CACD5P,EAAG,EACHC,EAAG,EACHjX,KAAMmO,IAAcyY,SACnB,CACD5P,EAAG,EACHC,EAAG,EACHjX,KAAMmO,IAAcyY,SACnB,CACD5P,EAAG,EACHC,EAAG,EACHjX,KAAMmO,IAAcyY,SACnB,CACD5P,EAAG,EACHC,EAAG,EACHjX,KAAMmO,IAAcyY,SACnB,CACD5P,EAAG,EACHC,EAAG,EACHjX,KAAMmO,IAAcyY,SACnB,CACD5P,EAAG,EACHC,EAAG,EACHjX,KAAMmO,IAAcyY,SACnB,CACD5P,EAAG,EACHC,EAAG,EACHjX,KAAMmO,IAAcyY,SACnB,CACD5P,EAAG,EACHC,EAAG,EACHjX,KAAMmO,IAAcyY,SACnB,CACD5P,EAAG,EACHC,EAAG,EACHjX,KAAMmO,IAAcyY,SACnB,CACD5P,EAAG,GACHC,EAAG,EACHjX,KAAMmO,IAAcyY,SACnB,CACD5P,EAAG,GACHC,EAAG,EACHjX,KAAMmO,IAAcyY,SACnB,CACD5P,EAAG,GACHC,EAAG,EACHjX,KAAMmO,IAAcyY,SACnB,CACD5P,EAAG,GACHC,EAAG,EACHjX,KAAMmO,IAAcyY,SACnB,CACD5P,EAAG,GACHC,EAAG,EACHjX,KAAMmO,IAAcyY,SACnB,CACD5P,EAAG,GACHC,EAAG,EACHjX,KAAMmO,IAAcyY,SACnB,CACD5P,EAAG,GACHC,EAAG,EACHjX,KAAMmO,IAAcyY,SACnB,CACD5P,EAAG,GACHC,EAAG,EACHjX,KAAMmO,IAAcyY,SACnB,CACD5P,EAAG,GACHC,EAAG,EACHjX,KAAMmO,IAAcyY,SACnB,CACD5P,EAAG,GACHC,EAAG,EACHjX,KAAMmO,IAAcyY,SACnB,CACD5P,EAAG,GACHC,EAAG,EACHjX,KAAMmO,IAAcyY,SACnB,CACD5P,EAAG,GACHC,EAAG,EACHjX,KAAMmO,IAAcyY,SACnB,CACD5P,EAAG,EACHC,EAAG,EACHjX,KAAMmO,IAAcyY,SACnB,CACD5P,EAAG,EACHC,EAAG,EACHjX,KAAMmO,IAAcyY,SACnB,CACD5P,EAAG,EACHC,EAAG,EACHjX,KAAMmO,IA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","file":"static/js/main.2902f4d3.chunk.js","sourcesContent":["import { paramCase as toKebab } from 'text-param-case';\nimport { decode } from 'html-entities';\nimport { TextEntry } from 'constants/text';\nimport { getDefinition } from 'definitions/items';\nimport { ItemType, ItemCategory, isItemType, Item } from 'definitions/items/types';\nimport { Resource } from 'definitions/resources';\nimport { Structure } from 'definitions/structures';\nimport * as Handlebars from 'handlebars';\nimport { Trait } from 'definitions/traits/types';\nimport { Type } from 'components/ui/toasts/Toast';\nimport { EquipmentSlotType } from 'components/ui/adventurer/EquipmentSlot';\nimport { getStructureLink } from 'utils/routing';\nimport { Attribute } from 'store/types/adventurer';\nimport { checkIfEnemy, EnemyType } from 'definitions/enemies/types';\nimport { QuestStoreState } from 'store/types/quest';\nimport { Effect, EffectType } from 'definitions/effects/types';\nimport { TempEffect, TempEffectType } from 'definitions/tempEffects/types';\nimport { Rarity } from 'constants/items';\nimport { WeaponClassification, WeaponType } from 'definitions/weaponTypes/types';\nimport { WeaponAbility } from 'definitions/abilities/types';\n\nexport abstract class TextManager {\n\n  public static init(texts: { [key: string]: string }, precompile = true) {\n    this.texts = texts;\n    this.templates = {};\n    this.notFound = [];\n\n    if (precompile) {\n      this.compileAll();\n    }\n    this.initialized = true;\n  }\n\n  public static get(key: string, context?: unknown): string {\n    const result = this.getDefault(key, context);\n    if (result === null) {\n      if (process.env.NODE_ENV === 'development') {\n        this.notFound.push(key);\n      }\n\n      console.error(`Key '${key}' not found in TextManager`);\n      return `<<'${key}' missing>>`;\n    } else {\n      return decode(result);\n    }\n  }\n\n  // Will return `null` when no text found, otherwise will return the text\n  public static getDefault(key: string, context?: unknown): string | null {\n    if (!this.initialized) {\n      throw new Error(`Error ${this} not initialized!`);\n    }\n    const template = this.getTemplate(key);\n    if (!template) {\n      return null;\n    }\n    return template(context);\n  }\n\n  public static getTextEntry(textEntry: TextEntry): string {\n    return this.get(textEntry.key, textEntry.context);\n  }\n\n  public static getTemplate(key: string) {\n    let template = this.templates[key];\n    if (!template && this.texts[key]) {\n      // Template not found but key is defined. Needs to be compiled\n      this.compile(key, this.texts[key]);\n      template = this.templates[key];\n    }\n    return template;\n  }\n\n  public static getAbilityName(ability: WeaponAbility) {\n    return this.get(`ability-${WeaponAbility[ability]}-name`);\n  }\n\n  public static getAdventurerName(adventurerId: string) {\n    return this.get(`adventurer-${adventurerId}-name`);\n  }\n\n  public static getAdventurerFlavor(adventurerId: string, adventurerName?: string) {\n    return this.get(`adventurer-${adventurerId}-flavor`, { name: adventurerName });\n  }\n\n  public static getAttributeName(attribute: Attribute): string {\n    return this.get(`common-attribute-${attribute}-name`);\n  }\n\n  public static getAttributeDescription(attribute: Attribute): string {\n    return this.get(`common-attribute-${attribute}-description`);\n  }\n\n  public static getAttributeMechanics(attribute: Attribute): string {\n    return this.get(`common-attribute-${attribute}-mechanics`);\n  }\n\n  public static getEnemyName(enemyType: EnemyType) {\n    return this.get(`enemy-${enemyType}-name`);\n  }\n\n  public static getEquipmentSlot(slotType: EquipmentSlotType) {\n    return this.get(`ui-equipmentslot-${toKebab(EquipmentSlotType[slotType])}`);\n  }\n\n  public static getQuestTitle(name: string) {\n    return this.get(`quest-${toKebab(name)}-title`);\n  }\n\n  public static getQuestDescription(name: string) {\n    return this.get(`quest-${toKebab(name)}-description`);\n  }\n\n  public static getQuestSceneTitle(quest: QuestStoreState) {\n    const sceneName = quest.sceneName || '';\n    return this.get(`quest-${toKebab(quest.name)}-scene-${toKebab(sceneName)}-title`);\n  }\n\n  public static getResourceName(type: Resource) {\n    return this.get(`resource-${type}-name`);\n  }\n\n  public static getItemName(itemOrItemType: Item | ItemType): string {\n    if (isItemType(itemOrItemType)){\n      return this.get(`item-${toKebab(itemOrItemType)}-name`);\n    }\n    return this.get(`item-${toKebab(itemOrItemType.type)}-name`);\n  }\n\n  public static getItemCategory(itemCategory: ItemCategory): string {\n    return this.get(`item-category-${toKebab(ItemCategory[itemCategory])}`);\n  }\n\n  public static getItemSubtext(item: ItemType): string | null {\n    return this.getDefault(`item-${toKebab(item)}-subtext`);\n  }\n\n  public static getRarity(rarity: Rarity): string {\n    return this.get(`rarity-${Rarity[rarity]}-name`);\n  }\n\n  public static getStructureName(structure: Structure): string {\n    return this.get(`structure-${toKebab(structure)}-name`);\n  }\n\n  public static getTraitName(trait: Trait): string {\n    return this.get(`trait-${toKebab(trait)}-name`);\n  }\n\n  public static getEffectDescription(effect: Effect, props?: { [key: string]: string }): string {\n    const { type, ...rest } = effect;\n    return this.get(`effect-${toKebab(EffectType[type])}-description`, { ...rest, ...props } );\n  }\n\n  public static getEffectFlavor(effect: Effect): string {\n    return this.get(`effect-${toKebab(EffectType[effect.type])}-flavor`);\n  }\n\n  public static getEffectName(effect: Effect): string {\n    return this.get(`effect-${toKebab(EffectType[effect.type])}-name`);\n  }\n\n  public static getTempEffectDescription(effect: TempEffect, props?: { [key: string]: string }): string {\n    const { type, ...rest } = effect;\n    return this.get(`temp-effect-${toKebab(TempEffectType[type])}-description`, { ...rest, ...props } );\n  }\n\n  public static getTempEffectFlavor(effect: TempEffect): string {\n    return this.get(`temp-effect-${toKebab(TempEffectType[effect.type])}-flavor`);\n  }\n\n  public static getTempEffectName(effect: TempEffect): string {\n    return this.get(`temp-effect-${toKebab(TempEffectType[effect.type])}-name`);\n  }\n\n  public static getTraitDescription(trait: Trait): string {\n    return this.get(`trait-${toKebab(trait)}-description`);\n  }\n\n  public static getTraitEffect(trait: Trait): string {\n    return this.get(`trait-${toKebab(trait)}-effect`);\n  }\n\n  public static getToastType(type: Type): string {\n    return this.get(`ui-toast-type-${toKebab(Type[type])}`);\n  }\n\n  public static getWeaponType(type: WeaponType) {\n    return this.get(`ui-weapon-type-${toKebab(WeaponType[type])}`);\n  }\n\n  public static getSkillName(type: WeaponType) {\n    return this.get(`skill-${toKebab(WeaponType[type])}-name`);\n  }\n\n  public static getSkillInfo(type: WeaponType) {\n    return this.get(`skill-${toKebab(WeaponType[type])}-info`);\n  }\n\n  public static getWeaponClassification(weaponClass: WeaponClassification) {\n    return this.get(`ui-weapon-class-${toKebab(WeaponClassification[weaponClass])}`);\n  }\n\n  // will print all unfound text strings to the console\n  public static printNotFounds() {\n    if (this.notFound.length) {\n      console.log('TextManager strings not found:');\n      console.log('\"' + this.notFound.join('\": \"\",\\n\"') + '\": \"\"');\n    }\n  }\n\n  private static initialized = false;\n\n  private static texts: Record<string, string>;\n\n  private static templates: Record<string, Handlebars.TemplateDelegate<unknown>>;\n\n  private static notFound: string[];\n\n  private static compileAll() {\n    Object.keys(this.texts).forEach((key: string) =>  {\n      this.compile(key, this.texts[key]);\n    });\n  }\n\n  private static compile(key: string, value: string) {\n    const template = Handlebars.compile(value);\n    this.templates[key] = template;\n  }\n}\n\n\nconst itemArticleUndefined = (item: ItemType) => {\n  const name = TextManager.getItemName(item);\n  const articleTemplate = TextManager.getTemplate('common-article-undefined');\n  return new Handlebars.SafeString(`${articleTemplate({ noun: name })}`);\n};\n\nconst itemArticleDefined = (item: ItemType) => {\n  const name = TextManager.getItemName(item);\n  const articleTemplate = TextManager.getTemplate('common-article-defined');\n  return new Handlebars.SafeString(`${articleTemplate({ noun: name })}`);\n};\n\nconst itemArticleAuto = (item: ItemType) => {\n  return itemArticleUndefined(item);\n};\n\nHandlebars.registerHelper('item:name', (itemOrItemType: Item | ItemType, article?: string) => {\n  let itemType: ItemType;\n  if (isItemType(itemOrItemType)){\n    itemType = itemOrItemType;\n  } else {\n    itemType = itemOrItemType.type;\n  }\n  if (!getDefinition(itemType)) {\n    return new Handlebars.SafeString(`<<ITEM DEFINITION NOT FOUND: ${itemType}>>`);\n  }\n  switch (article) {\n    case 'aA':  // article Auto\n      return itemArticleAuto(itemType);\n    case 'aD':  // article Defined \"a sword\"\n      return itemArticleDefined(itemType);\n    case 'aU':  // article Defined \"the sword\"\n      return itemArticleDefined(itemType);\n    default:\n      // No article\n      // const name = itemDefinitions[item].name;\n      return new Handlebars.SafeString(itemType);\n  }\n});\n\nHandlebars.registerHelper('item:trigger', (item: Item) => {\n  return new Handlebars.SafeString(`:item[${JSON.stringify(item)}]`);\n});\n\nHandlebars.registerHelper('structure:name', (structure: Structure) => {\n  const name = TextManager.get(`structure-${toKebab(structure)}-name`);\n  return new Handlebars.SafeString(name);\n});\n\nHandlebars.registerHelper('structure:link', (structure: Structure) => {\n  const name = TextManager.get(`structure-${toKebab(structure)}-name`);\n  const link = getStructureLink(structure);\n  return new Handlebars.SafeString( `[${name}](#${link})`);\n});\n\nHandlebars.registerHelper('resource:name', (resource: string) => {\n  const name = TextManager.get(`resource-${resource}-name`);\n  return new Handlebars.SafeString(name);\n});\n\nHandlebars.registerHelper('adventurer:name', (adventurerId: string) => {\n  const name = TextManager.getAdventurerName(adventurerId);\n  return new Handlebars.SafeString(name);\n});\n\nHandlebars.registerHelper('actor:name', (actor: string) => {\n  if (checkIfEnemy(actor)) {\n    const name = TextManager.getEnemyName(actor?.substring(0, actor.indexOf('_')));\n    return new Handlebars.SafeString(name);\n  }\n  const name = TextManager.getAdventurerName(actor);\n  return new Handlebars.SafeString(name);\n});\n","import { EquipmentSlotType } from 'components/ui/adventurer/EquipmentSlot';\nimport { Ammunition } from 'definitions/items/ammunition';\nimport { Item } from 'definitions/items/types';\nimport { Weapon } from 'definitions/items/weapons';\nimport { ADVENTURER_PREFIX } from 'store/reducers/adventurers';\nimport { AttributesStoreState, SkillsStoreState } from 'store/types/adventurer';\nimport { Troll } from './trolls';\n\nexport interface EnemyDefinition {\n  attributes: AttributesStoreState;\n  skills: SkillsStoreState;           //\n  mainHand: Item<Weapon>;\n  offHand?: Item<Weapon> | Item<Ammunition>;\n  armor: Partial<{ [key in EquipmentSlotType]: number }>;\n  spritesheet: string;\n  avatarImg: string;\n}\n\nexport type EnemyType = Troll;\n\n// Given the id of an adventurer or enemyType, check if its an enemy or adventurer\nexport const checkIfEnemy = (name: string) => {\n  return !name?.startsWith(ADVENTURER_PREFIX);\n};\n","import { getDefinition } from 'definitions/items';\nimport { ApparelDefinition } from 'definitions/items/apparel';\nimport { ItemType, ItemCategory } from 'definitions/items/types';\nimport { getDefinition as getWeaponDefinition, isWeapon, WeaponDefinition } from 'definitions/items/weapons';\nimport { EquipmentStoreState } from 'store/types/adventurer';\nimport { getDefinition as getWeaponTypeDefinition } from 'definitions/weaponTypes';\nimport { WeaponClassification } from 'definitions/weaponTypes/types';\n\nexport enum EquipmentSlotType {\n  feet,\n  hands,\n  chest,\n  legs,\n  head,\n  shoulders,\n  mainHand,\n  offHand,\n}\n\nconst checkEquipment = (item: ItemType, equipmentType: EquipmentSlotType) => {\n  const itemDefinition = getDefinition(item);\n  if (itemDefinition.itemCategory !== ItemCategory.apparel) {\n    return false;\n  }\n  return (itemDefinition as ApparelDefinition).equipmentType === equipmentType;\n};\n\n// Returns true if item can be slotted in equipmentSlotType\nexport const itemAndEquipmentSlotMatch = (itemType: ItemType, equipmentSlotType: EquipmentSlotType) => {\n  switch (equipmentSlotType) {\n    case EquipmentSlotType.chest:\n    case EquipmentSlotType.feet:\n    case EquipmentSlotType.hands:\n    case EquipmentSlotType.head:\n    case EquipmentSlotType.legs:\n      return checkEquipment(itemType, equipmentSlotType);\n    case EquipmentSlotType.mainHand:\n    case EquipmentSlotType.offHand: {\n      const itemDefinition: WeaponDefinition = getDefinition(itemType) as WeaponDefinition;\n\n      if (itemDefinition.itemCategory === ItemCategory.ammunition) {\n        return true;\n      } else if (itemDefinition.itemCategory !== ItemCategory.weapon) {\n        return false;\n      }\n      const { classification } = getWeaponTypeDefinition(itemDefinition.weaponType);\n      switch (classification) {\n        case WeaponClassification.oneHanded:\n          return true;\n        case WeaponClassification.mainHand:\n          return equipmentSlotType === EquipmentSlotType.mainHand;\n        case WeaponClassification.offHand:\n        case WeaponClassification.shield:\n          return equipmentSlotType === EquipmentSlotType.offHand;\n      }\n\n      // todo: prevent shields to be equipped in main hand\n      return true;\n    }\n    default:\n      return false;\n  }\n};\n\n\n// Returns true if a ranged weapon is held\nexport const rangedWeaponInHand = (equipment: EquipmentStoreState) => {\n  const mainHandItem = equipment[EquipmentSlotType.mainHand];\n\n  if (mainHandItem && isWeapon(mainHandItem.type)) {\n    const weaponType = getWeaponDefinition(mainHandItem.type).weaponType;\n    if (getWeaponTypeDefinition(weaponType).classification === WeaponClassification.ranged) {\n      return true;\n    }\n  }\n  return false;\n};\n","import { useDrop } from 'react-dnd';\nimport { DragType } from 'constants/dragging';\nimport { InventoryItemDragInfo } from 'components/ui/items/DraggableItemIcon';\nimport { EquipmentSlotType, itemAndEquipmentSlotMatch } from './utils';\nimport { PropsWithChildren } from 'react';\nimport { useAdventurer } from 'hooks/store/adventurers';\nimport './styles/equipmentslot.scss';\n\n\nexport interface Props {\n  type: EquipmentSlotType;\n  adventurerId: string;\n  onDrop: (item: InventoryItemDragInfo) => void;\n}\n\nexport interface CollectedProps {\n  canDrop: boolean;\n  isOver: boolean;\n}\n\n/**\n * The EquipmentSlot displays a slot in which an item can be placed.\n */\nconst EquipmentSlot = (props: PropsWithChildren<Props>) => {\n\n  const { adventurerId, onDrop } = props;\n  const adventurer = useAdventurer(adventurerId);\n\n  const [{ isOver, canDrop }, dropRef] = useDrop<InventoryItemDragInfo, void, CollectedProps>(() => ({\n    accept: DragType.ITEM,\n    drop: (info: InventoryItemDragInfo) => {\n      onDrop(info);\n    },\n    collect: (monitor) => {\n      const item = monitor.getItem<InventoryItemDragInfo>()?.item;\n      const validDrop = !!item && itemAndEquipmentSlotMatch(item.type, props.type) && monitor.canDrop();\n      return {\n        canDrop: validDrop,\n        isOver: monitor.isOver(),\n      };\n    },\n  }), [adventurerId, adventurer.equipment]);\n  const isActive = isOver && canDrop;\n  const className = ['equipment-slot'];\n  if (isActive) {\n    className.push('drop-active');\n  } else if (canDrop) {\n    className.push('drop-possible');\n  }\n\n  return (\n    <div className={className.join(' ')} title={EquipmentSlotType[props.type]} ref={dropRef}>\n      { props.children }\n    </div>\n  );\n};\n\nexport default EquipmentSlot;\n","import { WeaponAbility } from 'definitions/abilities/types';\n\nexport enum WeaponClassification {\n  oneHanded,  // Can be used in main hand or off hand\n  mainHand,   // Can only be used in main hand\n  offHand,    // Can only be used in the off hand\n  twoHanded,  // Can be used in the main hand and will disable off hand from being used\n  shield,     // ?\n  ranged,      // requires ammunition\n}\n\nexport enum WeaponType {\n  axe = 'axe',\n  bow = 'bow',\n  club = 'club',\n  crossbow = 'crossbow',\n  fist = 'fist',\n  flail = 'flail',\n  hammer = 'hammer',\n  knife = 'knife',\n  staff = 'staff',\n  shield = 'shield',\n  sword = 'sword',\n  poleArm = 'poleArm',\n}\n\nexport type WeaponTypeDefinition = {\n  classification: WeaponClassification;\n  abilities: WeaponAbility[];\n};\n\nexport enum DamageType {\n  kinetic = 'kinetic',\n}\n\nexport interface DamageDefinition {\n  [DamageType.kinetic]: number | undefined;\n}\n","import { TextManager } from 'global/TextManager';\n\nexport const ONE_SECOND = 1000;\nexport const TWO_SECONDS = 2000;\nexport const THREE_SECONDS = 3000;\nexport const FOUR_SECONDS = 4000;\nexport const FIVE_SECONDS = 5000;\n// ...\nexport const TEN_SECONDS = 10000;\nexport const TWENTY_SECONDS = 20000;\nexport const THIRTY_SECONDS = 30000;\n\nexport const ONE_MINUTE = 60000;\nexport const TWO_MINUTES = 120000;\nexport const THREE_MINUTES = 180000;\nexport const FOUR_MINUTES = 240000;\n\nexport const HALF_HOUR = ONE_MINUTE * 30;\nexport const ONE_HOUR = ONE_MINUTE * 60;\nexport const ONE_DAY = ONE_HOUR * 24;\nexport const ONE_YEAR = ONE_DAY * 265.25;\n\nexport const formatDuration = (ms: number, short?: boolean): string => {\n  const timeUnitsList = [\n    { unit: short ? 'y' : 'year', amount: ONE_YEAR },\n    { unit: short ? 'd' : 'day', amount: ONE_DAY },\n    { unit: short ? 'h' : 'hour', amount: ONE_HOUR },\n    { unit: short ? 'm' : 'minute', amount: ONE_MINUTE },\n    { unit: short ? 's' : 'second', amount: ONE_SECOND },\n  ];\n  let time = Math.abs(ms);\n  const output: string[] = [];\n  timeUnitsList.forEach((el) => {\n    const tmp = Math.floor(time / el.amount);\n    time -= tmp * el.amount;\n    if (tmp !== 0) {\n      const unit = TextManager.get(`common-time-${el.unit}${tmp > 1 && !short ? '-plural' : ''}`);\n      output.push(`${tmp}${unit}`);\n    }\n  });\n  return output.join(' ');\n};\n\nexport const formatDateTime = (ms: number): string => {\n  return new Date(ms).toLocaleTimeString();\n};","import { Merge } from 'type-fest';\nimport { Location } from 'utils/tilemap';\nimport { TiledObjectData } from 'constants/tiledMapData';\nimport { Item } from 'definitions/items/types';\nimport { TiledObjectType } from 'utils/tilemap';\nimport { ActionIntent } from 'components/world/QuestPanel/QuestDetails/scene/ui/SceneUI';\nimport { EnemyType } from 'definitions/enemies/types';\n\n\nexport interface SceneStoreState {\n  objects: SceneObject[];\n  actionQueue?: SceneAction[];\n  activeInteractionModal?: SceneInteractionModal;\n  combat: boolean;\n  turn?: Allegiance;\n}\n\nexport enum Allegiance {\n  player,\n  enemy,\n}\n\nexport type SceneObject = Merge<TiledObjectData, {\n  layerId: number;\n  properties: { [key: string]: string | boolean | number };\n  location?: Location;\n}>;\n\n\nexport type AdventurerObject = SceneObject & {\n  id?: number;\n  adventurerId: string;\n  allegiance: Allegiance.player;\n  ap: number;           // Remaining AP\n};\n\nexport type EnemyObject = SceneObject & {\n  enemyType: EnemyType;\n  enemyId: string;\n  level: number;\n  allegiance: Allegiance.enemy;\n  ap: number;           // Remaining AP\n  health: number;\n};\n\nexport type ActorObject = AdventurerObject | EnemyObject;\n\n// Type guard for ActorObject\nexport const isActorObject = (object: SceneObject): object is ActorObject => {\n  return object.type === TiledObjectType.actor;\n};\n\n// Returns true if given scene Object is an Adventurer (player controlled Actor)\nexport const isAdventurer = (object: SceneObject): object is AdventurerObject => {\n  return isActorObject(object) && object.allegiance === Allegiance.player;\n};\n\n// Returns true if given scene Object is an Enemy (AI controlled Actor)\nexport const isEnemy = (object: SceneObject): object is EnemyObject => {\n  return isActorObject(object) && object.allegiance === Allegiance.enemy;\n};\n\n// Returns the ActorObject belonging to given adventurerId\nexport const getAdventurer = (objects: SceneObject[], adventurerId: string): AdventurerObject | undefined => {\n  return objects.find(o => isAdventurer(o) && o.adventurerId === adventurerId) as AdventurerObject;\n};\n\nexport const getUniqueName = (object: SceneObject) => {\n  if (isAdventurer(object)) {\n    return object.adventurerId;\n  }\n  if (isEnemy(object)) {\n    return object.enemyId;\n  }\n  return 'UNKNOWN';\n};\n\n// export type Actor = SceneObject & {\n//   type: \"actor\";\n//   //allegiance: Allegiance;\n//   health: number;\n//   //remainingAP: number;\n// }\n\nexport type SceneInteractionModal =\n| { type: 'lootCache', lootCache: string }\n| { type: 'situation', situation: string };\n\nexport interface LootCache {\n  title: string;\n  items: Item[];\n  gold?: number;\n  open?: boolean;\n}\n\nexport interface SceneAction {\n  intent: ActionIntent;\n  endsAt: number;\n  delay?: number;\n}\n\nexport enum SceneActionType {\n  move = 'move',\n  interact = 'interact',\n  melee = 'melee',\n  shoot = 'shoot',\n}\n\n// move,\n// interact,\n// melee,\n// shoot,\n// }\n","import localforage from 'localforage';\nimport { Sound, IMediaInstance, filters } from '@pixi/sound';\nimport { gsap } from 'gsap';\nimport { Loader } from 'pixi.js';\n\nexport enum Channel {\n  music,\n  ui,\n  scene,\n  ambient,\n}\n\nexport enum MixMode {\n  singleInstance,   // Only one sound plays at the same time in this channel\n  layered,      // Multiple sounds can play in this channel\n  fade,        // Fades out currently playing sound on this channel and fades new music in\n}\n\nexport enum Music {\n  town,\n  world,\n}\n\nexport type GameSound =\n  'ambient/structure/alchemist' |\n  'ambient/structure/smith' |\n  'ambient/structure/tavern' |\n  'ambient/structure/warehouse' |\n  'ui/buttonClick' |\n  'ui/equip' |\n  'ui/error' |\n  'ui/levelUp' |\n  'ui/toast' |\n  'music/combat' |\n  'music/town' |\n  'music/world' |\n  'music/violettesElficSong' |\n  'scene/bow' |\n  'scene/crossbow' |\n  'scene/daggerSwish' |\n  'scene/doorOpen' |\n  'scene/drinking' |\n  'scene/meleeHit' |\n  'scene/metalBash' |\n  'scene/parry' |\n  'scene/shieldBash' |\n  'scene/swish'\n;\n\ntype SoundInfo = {\n  instance: IMediaInstance;\n  gameSound: GameSound;\n  pixiSound: Sound;\n  storePosition?: boolean;\n};\n\nconst DEFAULT_MUSIC_VOLUME = 0;\nconst DEFAULT_UI_VOLUME = 1;\nconst DEFAULT_SCENE_VOLUME = 1;\nconst DEFAULT_AMBIENT_VOLUME = 0.2;\nconst STORAGE_KEY_VOLUME = 'channelVolume';\n\nexport class SoundManager {\n  private static _sounds: { [key: string]: Sound[] } = {};\n\n  private static _currentSound: { [key: number]: SoundInfo } = {};  // per channel\n\n  private static _storedPositions: { [key: string]: number } = {};\n\n  private static _channelVolume: { [key: number]: number } = {};\n\n  private static _initialized = false;\n\n  private static _filter = new filters.TelephoneFilter();\n\n  public static async init() {\n    // Attempt to fetch volumes from storage. If not set, revert to defaults\n    this._channelVolume = {\n      [(Channel.music)]: await localforage.getItem(`${STORAGE_KEY_VOLUME}-${Channel.music}`) ?? DEFAULT_MUSIC_VOLUME,\n      [(Channel.ui)]: await localforage.getItem(`${STORAGE_KEY_VOLUME}-${Channel.ui}`) ?? DEFAULT_UI_VOLUME,\n      [(Channel.scene)]: await localforage.getItem(`${STORAGE_KEY_VOLUME}-${Channel.scene}`) ?? DEFAULT_SCENE_VOLUME,\n      [(Channel.ambient)]: await localforage.getItem(`${STORAGE_KEY_VOLUME}-${Channel.ambient}`) ?? DEFAULT_AMBIENT_VOLUME,\n    };\n    this._initialized = true;\n  }\n\n\n  public static async addSound(gameSound: GameSound, files: string[] | string, complete?: (sounds: Sound[]) => void) {\n    const promise = new Promise<Sound[]>((resolve, _reject) => {\n      if (typeof files === 'string') {\n        files = [files];\n      }\n      if (this._sounds[gameSound]) {\n        // Sound already loaded. Great.\n        complete?.(this._sounds[gameSound]);\n        resolve(this._sounds[gameSound]);\n        return;\n      }\n\n      const loader = new Loader();\n      files.map((file) => loader.add(file));\n      loader.load((_, resources) => {\n        if (resources) {\n          // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n          // @ts-ignore no 'sound' property on LoaderResource\n          this._sounds[gameSound] = Object.values(resources).filter(Boolean).map(r => r.sound);\n          complete?.(this._sounds[gameSound]);\n          resolve(this._sounds[gameSound]);\n        }\n      });\n    });\n    return promise;\n  }\n\n  /**\n   * Plays a sound. The sound needs to be loaded through `addSound` first!\n   * @param gameSound the GameSound to play\n   * @param channel channel to play the sound on\n   * @param loop true to make the sound repeat\n   * @param mixMode how to mix in the new sound into the channel\n   * @param storePosition Store position of current sound on this channel in order to resume\n   */\n  public static async playSound(gameSound: GameSound, channel: Channel = Channel.ui, loop = false, mixMode: MixMode = MixMode.singleInstance, storePosition = false) {\n    if (!this._initialized) {\n      await this.init();\n    }\n\n    try {\n      const pixiSound = this.getSound(gameSound);\n      if (!pixiSound) {\n        console.warn(`Can't find sound ${gameSound}`);\n      }\n      pixiSound.volume = this._channelVolume[channel];\n      pixiSound.loop = loop;\n\n      if (this._currentSound[channel]?.storePosition) {\n        // Did we have to store the position of the current sound?\n        const oldSoundInfo = this._currentSound[channel];\n        oldSoundInfo.instance.once('progress', (progress: number, duration: number) => {\n          this._storedPositions[oldSoundInfo.gameSound] = progress * duration;\n        });\n      }\n      const start = this._storedPositions[gameSound] ?? 0;\n\n      const instance = await pixiSound.play({ start });\n\n      if (this._currentSound[channel]) {\n        if (mixMode === MixMode.fade) {\n        // Fade out current sound on this channel and fade in new sound\n          SoundManager.fadeOutSound(channel);\n          // Fade in the new sound\n          gsap.from(instance, { volume: 0, duration: 0.75 });\n        } else if (mixMode === MixMode.singleInstance) {\n          this._currentSound[channel].instance.stop();\n        }\n      }\n      this._currentSound[channel] = { instance, gameSound, pixiSound, storePosition };\n      instance.on('end', () => {\n        this._currentSound[channel].instance.destroy();\n        delete this._currentSound[channel];\n      });\n    // eslint-disable-next-line no-empty\n    } catch (_e) {\n    }\n  }\n\n  protected static getSound(sound: GameSound): Sound {\n    if (!this._sounds[sound]?.length) {\n      console.error(`No sound found for ${sound}`);\n    }\n    if (this._sounds[sound].length === 1) {\n      return this._sounds[sound][0];\n    } else {\n      return this._sounds[sound][Math.floor(Math.random() * this._sounds[sound].length)];\n    }\n  }\n\n  public static stopSound(channel: Channel) {\n    this._currentSound[channel]?.instance.destroy();\n    delete this._currentSound[channel];\n  }\n\n  public static fadeOutSound(channel: Channel, duration = 0.75) {\n    const soundInfo = this._currentSound[channel];\n    gsap.to(soundInfo.instance, { volume: 0, duration, onComplete: () => {\n      soundInfo.instance.destroy();\n    } });\n  }\n\n  public static getCurrentlyPlaying(channel: Channel) {\n    return this._currentSound[channel]?.gameSound;\n  }\n\n  public static hasSoundLoaded(sound:  GameSound) {\n    return !!this._sounds[sound];\n  }\n\n  public static set musicFiltered(value: boolean) {\n    if (this._currentSound[Channel.music]) {\n      this._currentSound[Channel.music].pixiSound.filters = value ? [ this._filter ] : [];\n    }\n  }\n\n  static getChannelVolume(channel: Channel): number {\n    return this._channelVolume[channel];\n  }\n\n  static setChannelVolume(channel: Channel, volume:number) {\n    this._channelVolume[channel] = volume;\n    if (this._currentSound[channel]?.instance) {\n      this._currentSound[channel].instance.volume = volume;\n    }\n    localforage.setItem(`${STORAGE_KEY_VOLUME}-${channel}`, volume);\n  }\n}\n","import { Rarity } from 'constants/items';\nimport { Ammunition } from './ammunition';\nimport { Apparel } from './apparel';\nimport { Deed } from './deeds';\nimport { Herb } from './herbs';\nimport { Material } from './materials';\nimport { Mineral } from './minerals';\nimport { Consumable } from './consumables';\nimport { QuestItem } from './questItems';\nimport { Trinket } from './trinkets';\nimport { Weapon } from './weapons';\n\nexport enum ItemCategory {\n  ammunition,\n  apparel,\n  consumable,\n  deed,\n  herb,\n  material,\n  mineral,\n  questItem,\n  trinket,\n  weapon,\n}\n\nexport type ItemType = Ammunition | Apparel | Deed | Herb | Material | Mineral | Consumable | QuestItem | Trinket | Weapon;\n\nexport type Item<T = ItemType> = {\n  type: T;\n  quantity?: number; // defaults to 1\n  durability?: number; // 0 to 1\n};\n\nexport const isItemType = (test: Item | ItemType): test is ItemType => {\n  return !Object.prototype.hasOwnProperty.call(test, 'type');\n};\n\nexport interface ItemDefinition {\n  itemCategory: ItemCategory;\n  iconImg: string;\n  rarity?: Rarity;\n  //  articleUndefined?: string;  // Key to text\n  unique?: boolean;       // Indicate that this item is unique.\n  // Not actually enforced by anything,\n  // but used to generate the article ('a' or 'the')\n}\n","import { DragSourceType } from './dragging';\n\nexport enum Rarity {\n  // gray = common, green = uncommon, blue = rare, purple = epic, orange = legendary\n  common,\n  uncommon,\n  rare,\n  epic,\n  legendary,\n}\n\n// Information about where an item is found\nexport interface ItemSource {\n  origin: DragSourceType;\n  id?: string;  // eg: adventurerId\n  slot?: number;  // slot in the inventory\n}\n","export enum IconSize {\n  smallest = 'smallest',\n  small = 'small',\n  medium = 'medium',\n  big = 'big',\n  biggest = 'biggest',\n}\n\nexport type IconSizeType = IconSize | keyof typeof IconSize;\n\nexport enum Border {\n  none = 'none',\n  gold = 'gold',\n}\n\nexport const sizeClassName = (size?: IconSize): string => {\n  switch (size) {\n    case IconSize.smallest:\n      return 'size-smallest';\n    case IconSize.small:\n      return 'size-small';\n    case IconSize.medium:\n      return 'size-medium';\n    case IconSize.big:\n      return 'size-big';\n    case IconSize.biggest:\n      return 'size-biggest';\n  }\n  return sizeClassName(IconSize.medium);\n};\n\nexport const borderClassName = (border?: Border): string => {\n  switch (border) {\n    case Border.gold:\n      return 'border-gold';\n    case Border.none:\n    default:\n      return '';\n  }\n};\n","import { ComponentProps, CSSProperties, PropsWithChildren } from 'react';\nimport { sizeClassName, borderClassName, IconSizeType, Border, IconSize } from './utils';\nimport './styles/icon.scss';\n\nexport interface Props {\n  image: string;\n  size?: IconSizeType;\n  className?: string;\n  border?: Border | keyof typeof Border;\n}\n\nconst Icon = (props: PropsWithChildren<Props> & ComponentProps<'div'>) => {\n  const {\n    image,\n    size,\n    children,\n    className = '',\n    border = 'none',\n    ...restProps\n  } = props;\n\n  const style = { '--img': `url(\"${process.env.PUBLIC_URL}${image}\")` } as CSSProperties;\n\n  return (\n    <div\n      className={`icon ${sizeClassName((typeof size === 'string') ? IconSize[size] : size)} ${className}`}\n      {...restProps}\n      style={style}\n    >\n      {children}\n      { border !== 'none' && border && (\n        <div className={`border ${borderClassName((typeof border === 'string') ? Border[border] : border)} `}/>\n      )}\n    </div>\n  );\n};\n\nexport default Icon;\n","import { QuestStoreState } from 'store/types/quest';\nimport { ItemType } from 'definitions/items/types';\n\nexport enum QuestNodeType {\n  nothing = 0,  // Nothing much going on here\n  encounter = 1,\n  // combat = 2,   // Not implemented\n  // boss = 3,\n}\n\n// eslint-disable-next-line @typescript-eslint/ban-types\nexport interface QuestDefinition<TQuestVars = unknown> {\n  nodes: QuestNode[];\n  requiredItems?: ItemType[];\n  getQuestVars: (questStoreState: QuestStoreState) => TQuestVars;\n  getInitialQuestVars: (questStoreState: QuestStoreState) => TQuestVars;\n}\n\ntype AllNodeTypes = {\n  x: number;\n  y: number;\n  log?: string;\n};\n\nexport type QuestNode  =\n  | AllNodeTypes & { type: QuestNodeType.nothing }\n  | AllNodeTypes & { type: QuestNodeType.encounter, startScene: string };\n","\n// Things that can be dragged\nexport const DragType = {\n  ADVENTURER: 'adventurer',   // Adventurer avatar\n  ITEM: 'item',         // A game 'item' (equipment, etc)\n};\n\n// Source, where it comes from\nexport enum DragSourceType {\n  adventurerInventory,\n  adventurerConsumeItem,\n  warehouse,\n  tavern,\n  adventurerEquipment,\n  lootCache,\n  resourceStructure, // harvest\n}\n","import { AdventurerStoreState } from 'store/types/adventurer';\nimport { SceneAction, SceneStoreState, SceneInteractionModal, Allegiance } from 'store/types/scene';\nimport { PartialDeep } from 'type-fest';\nimport { Location } from 'utils/tilemap';\n\nexport type QuestAction =\n  { type: 'launchQuest', questName: string, assignedAventurers: AdventurerStoreState[] }\n  |  { type: 'exitEncounter', questName: string }\n  |  { type: 'updateQuestVars', questName: string, vars: PartialDeep<unknown> }\n  |  { type: 'setSceneName', questName: string, sceneName: string }\n  |  { type: 'setScene', questName: string, scene: SceneStoreState; }\n  |  { type: 'enqueueSceneAction', questName: string, sceneAction: SceneAction }\n  |  { type: 'completeSceneAction', questName: string, actorName: string }\n  |  { type: 'setCombat', questName: string, combat: boolean }\n  |  { type: 'endPlayerTurn', questName: string }\n  |  { type: 'startTurn', questName: string, turn: Allegiance, adventurers?: AdventurerStoreState[] }\n  |  { type: 'deductActorAp', questName: string,  actor: string, ap: number }\n  |  { type: 'setActorAp', questName: string, actor: string, ap: number }\n  |  { type: 'setActorLocation', questName: string, actor: string, location: Location }\n  |  { type: 'modifyEnemyHealth', questName: string, actor: string, health: number }\n  //  |  { type: \"updateEncounterResult\", questName: string, nodeIndex: number, result: string }\n  |  { type: 'setActiveSceneInteractionModal', questName: string, sceneInteractionModal?: SceneInteractionModal }\n\n;\n\n\n/**\n * Embark upon a new quest */\nexport const launchQuest = (questName: string, assignedAventurers: AdventurerStoreState[]): QuestAction => ({\n  type: 'launchQuest',\n  questName,\n  assignedAventurers,\n});\n\n/**\n * Completes the current encounter so the party can continue the quest */\nexport const exitEncounter = (quest: string): QuestAction => ({\n  type: 'exitEncounter',\n  questName: quest,\n});\n\nexport const updateQuestVars = (quest: string, vars: PartialDeep<unknown>): QuestAction => ({\n  type: 'updateQuestVars',\n  questName: quest,\n  vars,\n});\n\n/**\n * Sets name of the current scene of a quest */\nexport const setSceneName = (questName: string, sceneName: string): QuestAction =>({\n  type: 'setSceneName',\n  questName,\n  sceneName,\n});\n\n/**\n * Fills in the scene of a quest */\nexport const setScene = (questName: string, scene: SceneStoreState): QuestAction => ({\n  type: 'setScene',\n  questName,\n  scene,\n});\n\nexport const enqueueSceneAction = (questName: string, sceneAction: SceneAction): QuestAction => ({\n  type: 'enqueueSceneAction',\n  questName,\n  sceneAction,\n});\n\nexport const completeSceneAction = (questName: string, actorName: string): QuestAction => ({\n  type: 'completeSceneAction',\n  questName,\n  actorName,\n});\n\nexport const setCombat = (questName: string, combat: boolean): QuestAction => ({\n  type: 'setCombat',\n  questName,\n  combat,\n});\n\nexport const endPlayerTurn = (questName: string): QuestAction => ({\n  type: 'endPlayerTurn',\n  questName,\n});\n\nexport const startTurn = (questName: string, turn: Allegiance, adventurers?: AdventurerStoreState[]): QuestAction => ({\n  type: 'startTurn',\n  questName,\n  turn,\n  adventurers,\n});\n\nexport const deductActorAp = (questName: string, actor: string, ap: number): QuestAction => ({\n  type: 'deductActorAp',\n  questName,\n  actor,\n  ap,\n});\n\nexport const modifyEnemyHealth = (questName: string, actor: string, health: number): QuestAction => ({\n  type: 'modifyEnemyHealth',\n  questName,\n  actor,\n  health,\n});\n\nexport const setActorAp = (questName: string, actor: string, ap: number): QuestAction => ({\n  type: 'setActorAp',\n  questName,\n  actor,\n  ap,\n});\nexport const setActorLocation = (questName: string, actor: string, location: Location): QuestAction => ({\n  type: 'setActorLocation',\n  questName,\n  actor,\n  location,\n});\n\n\n// export const updateEncounterResult = (questName: string, nodeIndex: number, result: string): QuestAction => ({\n//   type: \"updateEncounterResult\",\n//   questName,\n//   nodeIndex,\n//   result,\n// })\n\nexport const setActiveSceneInteractionModal = (questName: string, sceneInteractionModal?: SceneInteractionModal): QuestAction => ({\n  type: 'setActiveSceneInteractionModal',\n  questName,\n  sceneInteractionModal,\n});\n\n","import { AdventurerStoreState } from 'store/types/adventurer';\nimport { QuestStoreState, QuestStatus } from 'store/types/quest';\nimport { StoreState } from 'store/types';\nimport { useSelector } from 'react-redux';\nimport { useMemo, useCallback } from 'react';\nimport { EquipmentSlotType } from 'components/ui/adventurer/EquipmentSlot';\nimport { Apparel, getDefinition } from 'definitions/items/apparel';\nimport { Item } from 'definitions/items/types';\n\nconst getAdventurersInTown = (adventurers: AdventurerStoreState[], quests: QuestStoreState[]): AdventurerStoreState[] => {\n  // Get an array of all adventurer ids on any active quest\n  const adventurersOnQuest = quests.reduce<string[]>((acc, val: QuestStoreState) => {\n    if (val.status === QuestStatus.active) {\n      acc.push(...val.party);\n    }\n    return acc;\n  }, []);\n\n  return adventurers.filter((a) => adventurersOnQuest.indexOf(a.id) === -1);\n};\n\n/** Returns all the adventurers currently not on a mission */\nexport const useAdventurersInTown = () => {\n  const adventurers = useSelector<StoreState, AdventurerStoreState[]>(store => store.adventurers);\n  const quests = useSelector<StoreState, QuestStoreState[]>(store => store.quests);\n\n  const adventurersInTown = useMemo(() => {\n    return getAdventurersInTown(adventurers, quests);\n  }, [adventurers, quests]);\n\n  return adventurersInTown;\n};\n\nexport const useAdventurers = () => {\n  return useSelector<StoreState, AdventurerStoreState[]>(store => store.adventurers);\n};\n\n/** Returns the adventurer from store */\nexport const useAdventurer = (adventurerId: string) => {\n  const adventurerSelector = useCallback(\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    (state: StoreState) => state.adventurers.find((q) => q.id === adventurerId)!,\n    [adventurerId],\n  );\n  return useSelector<StoreState, AdventurerStoreState>(adventurerSelector);\n};\n\n/* Returns a map keyed by EquipmentSlotType with DR of an adventurer.\n   0 if nothing worn or if item does not have DR */\nexport const useAdventurerDamageReduction = (adventurerId: string): { [key: string]: number } => {\n  const adventurer = useAdventurer(adventurerId);\n  const findDR = (type: EquipmentSlotType) => {\n    const item: Item<Apparel> | undefined = adventurer.equipment[type as EquipmentSlotType] as Item<Apparel>;\n    if (!item) return 0;\n    return getDefinition(item.type).damageReduction || 0;\n  };\n  return {\n    [EquipmentSlotType[EquipmentSlotType.head]]: findDR(EquipmentSlotType.head),\n    [EquipmentSlotType[EquipmentSlotType.chest]]: findDR(EquipmentSlotType.chest),\n    [EquipmentSlotType[EquipmentSlotType.hands]]: findDR(EquipmentSlotType.hands),\n    [EquipmentSlotType[EquipmentSlotType.shoulders]]: findDR(EquipmentSlotType.shoulders),\n    [EquipmentSlotType[EquipmentSlotType.legs]]: findDR(EquipmentSlotType.legs),\n    [EquipmentSlotType[EquipmentSlotType.feet]]: findDR(EquipmentSlotType.feet),\n  };\n};\n\nexport const useAdventurerMainhandItem = (adventurerId: string) => {\n  const adventurer = useAdventurer(adventurerId);\n  return adventurer.equipment[EquipmentSlotType.mainHand];\n};\n","import ammunition, { Ammunition } from './ammunition';\nimport apparel, { Apparel, isApparel, getDefinition as getApparelDefinition, ApparelDefinition } from './apparel';\nimport deeds, { Deed } from './deeds';\nimport herbs, { Herb } from './herbs';\nimport materials, { Material } from './materials';\nimport minerals, { Mineral } from './minerals';\nimport consumables, { Consumable } from './consumables';\nimport questItems, { QuestItem } from './questItems';\nimport trinkets, { Trinket } from './trinkets';\nimport weapons, { Weapon, WeaponDefinition, isWeapon, getDefinition as getWeaponDefinition  } from './weapons';\nimport { ItemType, ItemDefinition, ItemCategory } from './types';\n\nconst all = {\n  ...ammunition,\n  ...apparel,\n  ...consumables,\n  ...deeds,\n  ...herbs,\n  ...materials,\n  ...minerals,\n  ...questItems,\n  ...trinkets,\n  ...weapons,\n};\n\nexport default all;\n\nexport const getDefinition = (itemType: ItemType): ItemDefinition => {\n  return all[itemType];\n};\n\nexport const getWeaponOrApparelDefinition = (itemType: ItemType): WeaponDefinition | ApparelDefinition => {\n  if (isApparel(itemType)) {\n    return getApparelDefinition(itemType);\n  }\n  if (isWeapon(itemType)) {\n    return getWeaponDefinition(itemType);\n  }\n\n  throw new Error(`${itemType} is neither a weapon nor apparel`);\n};\n\nexport const getAllItemsByCategory = (category: ItemCategory): ItemType[] => {\n  switch (category) {\n    case ItemCategory.ammunition:\n      return Object.keys(ammunition) as Ammunition[];\n    case ItemCategory.apparel:\n      return Object.keys(apparel) as Apparel[];\n    case ItemCategory.deed:\n      return Object.keys(deeds) as Deed[];\n    case ItemCategory.herb:\n      return Object.keys(herbs) as Herb[];\n    case ItemCategory.material:\n      return Object.keys(materials) as Material[];\n    case ItemCategory.mineral:\n      return Object.keys(minerals) as Mineral[];\n    case ItemCategory.consumable:\n      return Object.keys(consumables) as Consumable[];\n    case ItemCategory.questItem:\n      return Object.keys(questItems) as QuestItem[];\n    case ItemCategory.trinket:\n      return Object.keys(trinkets) as Trinket[];\n    case ItemCategory.weapon:\n      return Object.keys(weapons) as Weapon[];\n  }\n};\n\nexport const canStackItem = (category: ItemCategory): boolean => {\n  return category === ItemCategory.ammunition;\n};\n","// Utilities for routing\n\nimport { Structure } from 'definitions/structures';\n\nexport const getWorldLink = () => '/world';\nexport const getQuestLink = (questName: string) => `${getWorldLink()}/${questName}`;\n\nexport const getTownLink = () => '/town';\nexport const getStructureLink = (structure: Structure, onlyHighlight = false) => `${getTownLink()}/${structure}${onlyHighlight ? '' : '/view'}`;\n","import { EquipmentSlotType } from 'components/ui/adventurer/EquipmentSlot';\nimport { Effect } from 'definitions/effects/types';\nimport { Item } from 'definitions/items/types';\nimport { TempEffect } from 'definitions/tempEffects/types';\nimport { AttributesStoreState } from 'store/types/adventurer';\n\nexport type AdventurerAction =\n  { type: 'modifyHealth', adventurerId: string, amount: number }\n  | { type: 'consumeItem', adventurerId: string, fromSlot: number }\n  | { type: 'moveItemInInventory', adventurerId: string, fromSlot: number, toSlot: number }\n  | { type: 'moveItemToOtherAdventurer', adventurerId: string, fromSlot: number, toSlot?: number, toAdventurerId: string }\n  | { type: 'addItemToInventory', adventurerId: string, item: Item, toSlot?: number }\n  | { type: 'changeItemQuantity', adventurerId: string, slot: number, quantity: number }\n  | { type: 'removeItemFromInventory', adventurerId: string, fromSlot: number }\n  | { type: 'assignEquipment', adventurerId: string, item: Item, equipmentSlot: EquipmentSlotType }\n  | { type: 'removeEquipment', adventurerId: string, equipmentSlot: EquipmentSlotType }\n  | { type: 'changeEquipmentQuantity', adventurerId: string, equipmentSlot: EquipmentSlotType, quantity: number }\n  | { type: 'addTempEffect', adventurerId: string, tempEffect: TempEffect }\n  | { type: 'decreaseEffectCharge', adventurerId: string, effect: Omit<Effect, 'lastTick'> }\n  | { type: 'setBasicAttributes', adventurerId: string, basicAttributes: AttributesStoreState }\n  | { type: 'renameAdventurer', adventurerId: string, name: string }\n  | { type: 'addXp', adventurerId: string, xp: number; };\n\nexport const modifyHealth = (adventurerId: string, amount: number): AdventurerAction => ({\n  type: 'modifyHealth',\n  adventurerId,\n  amount,\n});\n\nexport const consumeItem = (adventurerId: string, fromSlot: number): AdventurerAction => ({\n  type: 'consumeItem',\n  adventurerId,\n  fromSlot,\n});\n\nexport const moveItemInInventory = (adventurerId: string, fromSlot: number, toSlot: number): AdventurerAction => ({\n  type: 'moveItemInInventory',\n  adventurerId,\n  fromSlot,\n  toSlot,\n});\n\n/**\n * Moves the an item from one adventurers' inventory to another\n * @param fromAdventurerId adventurer whose inventory to take the item from\n * @param fromSlot index of the inventory item\n * @param toAdventurerId player who to give the item to\n */\nexport const moveItemToOtherAdventurer = (fromAdventurerId: string, fromSlot: number, toAdventurerId: string, toSlot?: number): AdventurerAction => ({\n  type: 'moveItemToOtherAdventurer',\n  adventurerId: fromAdventurerId,\n  fromSlot,\n  toAdventurerId,\n  toSlot,\n});\n\n// If slot is not provided, will take the first empty slot\nexport const addItemToInventory = (adventurerId: string, item: Item, toSlot?: number): AdventurerAction => ({\n  type: 'addItemToInventory',\n  adventurerId,\n  item,\n  toSlot,\n});\n\nexport const removeItemFromInventory = (adventurerId: string, fromSlot: number): AdventurerAction => ({\n  type: 'removeItemFromInventory',\n  adventurerId,\n  fromSlot,\n});\n\nexport const assignEquipment = (adventurerId: string, equipmentSlot: EquipmentSlotType, item: Item): AdventurerAction => ({\n  type: 'assignEquipment',\n  adventurerId,\n  item,\n  equipmentSlot,\n});\n\nexport const removeEquipment = (adventurerId: string, equipmentSlot: EquipmentSlotType): AdventurerAction => ({\n  type: 'removeEquipment',\n  adventurerId,\n  equipmentSlot,\n});\n\nexport const changeEquipmentQuantity = (adventurerId: string, equipmentSlot: EquipmentSlotType, quantity: number): AdventurerAction => ({\n  type: 'changeEquipmentQuantity',\n  adventurerId,\n  equipmentSlot,\n  quantity,\n});\n\n// Adds temporary effect to adventurernpm\nexport const addTempEffect = <T extends TempEffect> (adventurerId: string, tempEffect: T): AdventurerAction => ({\n  type: 'addTempEffect',\n  adventurerId,\n  tempEffect,\n});\n\nexport const decreaseEffectCharge = <T extends Effect> (adventurerId: string, effect: Omit<T, 'lastTick'>): AdventurerAction => ({\n  type: 'decreaseEffectCharge',\n  adventurerId,\n  effect,\n});\n\n// Only used for debugging\nexport const setBasicAttributes = (adventurerId: string, basicAttributes: AttributesStoreState): AdventurerAction => ({\n  type: 'setBasicAttributes',\n  adventurerId,\n  basicAttributes,\n});\n\nexport const renameAdventurer = (adventurerId: string, name: string): AdventurerAction => ({\n  type: 'renameAdventurer',\n  adventurerId,\n  name,\n});\n\nexport const addXp = (adventurerId: string, xp: number): AdventurerAction => ({\n  type: 'addXp',\n  adventurerId,\n  xp,\n});\n","export enum WeaponAbility {\n  aimedShot,\n  swing,\n  block,\n  cut,\n  cleave,\n  shoot,\n  slash,\n  parry,\n  riposte,    // When held in off hand, will counterattack melee attacks\n}","import { EffectSource, EffectSourceType, EffectType } from 'definitions/effects/types';\nimport { AdventurerStoreState, Attribute, AttributesStoreState } from 'store/types/adventurer';\nimport { ItemType } from 'definitions/items/types';\nimport { collectEffects } from 'definitions/effects';\nimport { TempEffectType } from 'definitions/tempEffects/types';\n\nexport const MIN_VALUE = 1;   // minimum value of any base attribute\nexport const MAX_VALUE = 20;  // maximum value of any base attribute\n\n\nexport type AttributesExtended = {\n  [key in Attribute]: ExtendedAttributeComponents[]\n};\n\nexport type ExtendedAttribute = {\n  attribute: Attribute;\n  components: ExtendedAttributeComponents[];\n};\n\nexport type ExtendedAttributeComponents = {\n  origin: AttributeSource,\n  value: number\n};\n\nexport enum AttributeSourceType {\n  base,\n  item,\n  tempEffect,\n}\n\n// The source of the attribute modifier\nexport type AttributeSource = {\n  type: AttributeSourceType.base\n} | {\n  type: AttributeSourceType.tempEffect\n  tempEffectType: TempEffectType\n} | {\n  type: AttributeSourceType.item\n  item: ItemType\n};\n\n\n// Turns base attribues into AttributesExtended\nexport const generateBaseAttributes = (basicAttributes: AttributesStoreState): AttributesExtended => {\n  const origin: AttributeSource = { type: AttributeSourceType.base };\n\n  return {\n    str: [{ origin, value: basicAttributes.str }],\n    for: [{ origin, value: basicAttributes.for }],\n    int: [{ origin, value: basicAttributes.int }],\n    agi: [{ origin, value: basicAttributes.agi }],\n  };\n};\n\nconst convertOrigin = (effectSource: EffectSource): AttributeSource => {\n  switch (effectSource.type) {\n    case EffectSourceType.item: {\n      return {\n        type: AttributeSourceType.item,\n        item: effectSource.itemType,\n      };\n    }\n    case EffectSourceType.tempEffect: {\n      return {\n        type: AttributeSourceType.tempEffect,\n        tempEffectType: effectSource.tempEffectType,\n      };\n    }\n    // default:\n    //   throw new Error(`Unknown effect source type ${effectSource.type}`)\n  }\n};\n\n\n// Returns the extended list of effective attributes (where each component comes from)\nexport const calculateEffectiveAttributesExtended = (adventurer: AdventurerStoreState): AttributesExtended  => {\n  const result = generateBaseAttributes(adventurer.basicAttributes);\n\n  // Add all 'attributeIncrease' effects\n  collectEffects(adventurer, EffectType.attributeIncrease).forEach(effectSource => {\n    const origin = convertOrigin(effectSource.source);\n    if (effectSource.type === EffectType.attributeIncrease) { // this is always true but typescript doesnt know that\n      const { attribute } = effectSource;\n      result[attribute].push({\n        origin,\n        value: adventurer.basicAttributes[attribute] * effectSource.factor - adventurer.basicAttributes[attribute],\n      });\n    }\n  });\n  // Add effects of soma\n  // const somaEffects = adventurer.tempEffects.filter(e => e.type === EffectType.soma) as EffectSoma[];\n  // if (somaEffects.length > 0) {\n  //   const ordered = somaEffects.sort((a: EffectSoma, b: EffectSoma) => b.factor - a.factor);\n  //   // the biggest soma counts\n  //   const top = ordered[0];\n  //   const origin: AttributeSource = { type: AttributeSourceType.soma };\n  //   result.str.push({ origin, value: adventurer.basicAttributes.str * top.factor - adventurer.basicAttributes.str})\n  //   result.for.push({ origin, value: adventurer.basicAttributes.for * top.factor - adventurer.basicAttributes.for})\n  //   result.int.push({ origin, value: adventurer.basicAttributes.int * top.factor - adventurer.basicAttributes.int})\n  //   result.agi.push({ origin, value: adventurer.basicAttributes.agi * top.factor - adventurer.basicAttributes.agi})\n  // }\n\n  return result;\n};\n\nexport const calculateEffectiveAttributes = (adventurer: AdventurerStoreState): AttributesStoreState  => {\n  const extended = calculateEffectiveAttributesExtended(adventurer);\n  return {\n    str: extended.str.reduce((acc, value) => (acc + value.value), 0),\n    for: extended.for.reduce((acc, value) => (acc + value.value), 0),\n    int: extended.int.reduce((acc, value) => (acc + value.value), 0),\n    agi: extended.agi.reduce((acc, value) => (acc + value.value), 0),\n  };\n};\n","import { ItemType } from 'definitions/items/types';\nimport { TempEffectType } from 'definitions/tempEffects/types';\nimport { Attribute } from 'store/types/adventurer';\n\nexport enum EffectType {\n  attributeIncrease,\n  healthDecreaseOnMove,               // every step decreases health\n  healthDecreaseOverTime,\n}\n\nexport type BaseEffect = {\n  type: EffectType;\n  timeRemaining?: number;   // if set, the effect will wear off\n  charges?: number;         // if set, amount of charges still remaining\n};\n\nexport type EffectAttibuteIncrease = BaseEffect & {\n  type: EffectType.attributeIncrease,\n  attribute: Attribute,\n  factor: number,   // multiply base attribute by this\n};\n\nexport type EffectHealthDecreaseOnMove = BaseEffect & {\n  type: EffectType.healthDecreaseOnMove,\n  damage: number\n};\n\nexport type EffectHealthDecreaseOverTime = BaseEffect & {\n  type: EffectType.healthDecreaseOverTime,\n  interval: number,\n  damage: number\n};\n\nexport type Effect = EffectAttibuteIncrease\n| EffectHealthDecreaseOnMove\n| EffectHealthDecreaseOverTime;\n\n\nexport enum EffectSourceType {\n  tempEffect,\n  item,\n}\n\nexport type EffectSource = {\n  type: EffectSourceType.tempEffect,\n  tempEffectType: TempEffectType\n} | {\n  type: EffectSourceType.item\n  itemType: ItemType\n};\n\nexport type EffectWithSource = Effect & {\n  source: EffectSource\n};\n\n","const CONSTANT = 0.5;\n\nexport const xpToLevel = (xp: number) => {\n  return Math.floor(CONSTANT * Math.sqrt(xp));\n};\n\nexport const levelToXp = (level: number) => {\n  return Math.pow(level / CONSTANT, 2);\n};\n\nexport const MAX_LEVEL = 80; //maximum level an adventurer can e\nexport const MAX_XP = levelToXp(MAX_LEVEL);\n\n\n// print out required xp\n// for(let i = 1; i < 20; i++) {\n//   console.log(levelToXp(i))\n// }\n","import { TiledProperty, TiledLayerData, TiledTilesetData } from 'constants/tiledMapData';\n\nexport type Location = [number, number];\n\n// Unpack array of properties into key/value object for fast retrieval\nexport const parseProperties = (properties?: TiledProperty[]): { [key: string]: string | boolean | number } => {\n  if (!properties) return {};\n  return properties.reduce((acc: { [key: string]: string | boolean | number }, value: TiledProperty) => {\n    acc[value.name] = value.value;\n    return acc;\n  }, {});\n};\n\nexport enum TiledObjectType {\n  actor = 'actor',\n  enemySpawn = 'enemySpawn',\n  portal = 'portal',\n}\n\n// finds tileset based on gid\nexport const findTileset = (gid: number, tilesets: TiledTilesetData[]): TiledTilesetData | undefined => {\n  let tileset;\n  for (let i = tilesets.length - 1; i >= 0; i--) {\n    tileset = tilesets[i];\n    if (tileset.firstgid <= gid) {\n      break;\n    }\n  }\n  return tileset;\n};\n/** Add tiles in this layer to list */\nexport const addAllTilesInLayerToList = (list: Location[], layer: TiledLayerData, columns: number): void => {\n  layer.data.reduce((acc: Location[], tile, index) => {\n    if (tile > 0) {\n      const x = (index % columns);\n      const y = Math.floor(index / columns);\n      acc.push([x, y]);\n    }\n    return acc;\n  }, list);\n};\n\nexport const locationEquals = (a: Location, b: Location): boolean => {\n  return a[0] === b[0] && a[1] === b[1];\n};\n","import { ItemType, ItemDefinition, ItemCategory } from './types';\nimport { Rarity } from 'constants/items';\nimport { Effect, EffectAttibuteIncrease, EffectType } from 'definitions/effects/types';\nimport { WeaponType, DamageDefinition, DamageType } from 'definitions/weaponTypes/types';\n\ntype Prefix = 'weapon/';\nconst PREFIX = 'weapon/';\nconst itemCategory = ItemCategory.weapon;\nconst basePath = '/img/items/weapons/';\n\nexport interface WeaponDefinition extends ItemDefinition {\n  weaponType: WeaponType;\n  damage?: DamageDefinition;\n  effects?: Effect[];\n}\n\nconst weapons = {\n  aegisOfValor: {\n    itemCategory,\n    weaponType: WeaponType.shield,\n    rarity: Rarity.legendary,\n    iconImg: `${basePath}aegis-of-valor.png`,\n  },\n  arbalest: {\n    itemCategory,\n    weaponType: WeaponType.crossbow,\n    rarity: Rarity.epic,\n    iconImg: `${basePath}arbalest.png`,\n    damage: { [DamageType.kinetic]: 40 },\n  },\n  battleAxe: {\n    itemCategory,\n    weaponType: WeaponType.axe,\n    rarity: Rarity.common,\n    iconImg: `${basePath}battle-axe.png`,\n    damage: { [DamageType.kinetic]: 20 },\n  },\n  boneBow: {\n    itemCategory,\n    weaponType: WeaponType.bow,\n    rarity: Rarity.common,\n    iconImg: `${basePath}bone-bow.png`,\n    damage: { [DamageType.kinetic]: 15 },\n  },\n  berserkerShield: {\n    itemCategory,\n    weaponType: WeaponType.shield,\n    rarity: Rarity.epic,\n    iconImg: `${basePath}berserker-shield.png`,\n  },\n  brassKnuckles: {\n    itemCategory,\n    weaponType: WeaponType.fist,\n    iconImg: `${basePath}brass-knuckles.png`,\n    rarity: Rarity.common,\n    damage: { [DamageType.kinetic]: 10 },\n  },\n  bronzeDagger: {\n    itemCategory,\n    weaponType: WeaponType.knife,\n    iconImg: `${basePath}bronze-dagger.png`,\n    rarity: Rarity.common,\n    damage: { [DamageType.kinetic]: 8 },\n  },\n  buckler: {\n    itemCategory,\n    weaponType: WeaponType.shield,\n    rarity: Rarity.common,\n    iconImg: `${basePath}buckler.png`,\n  },\n  cleaver: {\n    itemCategory,\n    weaponType: WeaponType.knife,\n    iconImg: `${basePath}cleaver.png`,\n    rarity: Rarity.common,\n    damage: { [DamageType.kinetic]: 5 },\n  },\n  club: {\n    itemCategory,\n    weaponType: WeaponType.club,\n    iconImg: `${basePath}club.png`,\n    rarity: Rarity.common,\n    damage: { [DamageType.kinetic]: 8 },\n  },\n  dagger: {\n    itemCategory,\n    weaponType: WeaponType.knife,\n    iconImg: `${basePath}dagger.png`,\n    rarity: Rarity.rare,\n    damage: { [DamageType.kinetic]: 10 },\n  },\n  dirk: {\n    itemCategory,\n    weaponType: WeaponType.knife,\n    iconImg: `${basePath}dirk.png`,\n    rarity: Rarity.uncommon,\n    damage: { [DamageType.kinetic]: 10 },\n  },\n  falchion: {\n    itemCategory,\n    weaponType: WeaponType.sword,\n    iconImg: `${basePath}falchion.png`,\n    rarity: Rarity.rare,\n    damage: { [DamageType.kinetic]: 12 },\n  },\n  flail: {\n    itemCategory,\n    weaponType: WeaponType.flail,\n    iconImg: `${basePath}flail.png`,\n    rarity: Rarity.uncommon,\n    damage: { [DamageType.kinetic]: 15 },\n  },\n  goldenShield: {\n    itemCategory,\n    weaponType: WeaponType.shield,\n    rarity: Rarity.rare,\n    iconImg: `${basePath}golden-shield.png`,\n  },\n  greatswordOfGwai: {\n    itemCategory,\n    weaponType: WeaponType.sword,\n    iconImg: `${basePath}greatsword-gwai.png`,\n    unique: true,\n    rarity: Rarity.legendary,\n    damage: { [DamageType.kinetic]: 25 },\n    effects: [{\n      type: EffectType.attributeIncrease,\n      attribute: 'agi',\n      factor: 1.1,\n    }, {\n      type: EffectType.attributeIncrease,\n      attribute: 'for',\n      factor: 1.1,\n    }, {\n      type: EffectType.attributeIncrease,\n      attribute: 'int',\n      factor: 1.1,\n    }, {\n      type: EffectType.attributeIncrease,\n      attribute: 'str',\n      factor: 1.1,\n    }] as EffectAttibuteIncrease[],\n  },\n  halbert: {\n    itemCategory,\n    weaponType: WeaponType.poleArm,\n    iconImg: `${basePath}halbert.png`,\n    rarity: Rarity.rare,\n    damage: { [DamageType.kinetic]: 12 },\n  },\n  huntingBow: {\n    itemCategory,\n    weaponType: WeaponType.bow,\n    iconImg: `${basePath}hunting-bow.png`,\n    rarity: Rarity.common,\n    damage: { [DamageType.kinetic]: 5 },\n  },\n  indomitableCarapace: {\n    itemCategory,\n    weaponType: WeaponType.shield,\n    rarity: Rarity.epic,\n    unique: true,\n    iconImg: `${basePath}indomitable-carapace.png`,\n  },\n  jaggedBlade: {\n    itemCategory,\n    weaponType: WeaponType.knife,\n    rarity: Rarity.epic,\n    iconImg: `${basePath}jagged-blade.png`,\n  },\n  javelin: {\n    itemCategory,\n    weaponType: WeaponType.poleArm,\n    iconImg: `${basePath}javelin.png`,\n    rarity: Rarity.epic,\n    damage: { [DamageType.kinetic]: 25 },\n  },\n  khopesh: {\n    itemCategory,\n    weaponType: WeaponType.sword,\n    iconImg: `${basePath}khopesh.png`,\n    rarity: Rarity.epic,\n    damage: { [DamageType.kinetic]: 15 },\n  },\n  legionnaireSword: {\n    itemCategory,\n    weaponType: WeaponType.sword,\n    iconImg: `${basePath}legionnaire-sword.png`,\n    rarity: Rarity.rare,\n    damage: { [DamageType.kinetic]: 8 },\n  },\n  longbow: {\n    itemCategory,\n    weaponType: WeaponType.bow,\n    iconImg: `${basePath}longbow.png`,\n    rarity: Rarity.rare,\n    damage: { [DamageType.kinetic]: 6 },\n  },\n  mace: {\n    itemCategory,\n    weaponType: WeaponType.club,\n    iconImg: `${basePath}mace.png`,\n    rarity: Rarity.rare,\n    damage: { [DamageType.kinetic]: 15 },\n  },\n  morningStar: {\n    itemCategory,\n    weaponType: WeaponType.club,\n    iconImg: `${basePath}morning-star.png`,\n    rarity: Rarity.uncommon,\n    damage: { [DamageType.kinetic]: 13 },\n  },\n  oakWoodBow: {\n    itemCategory,\n    weaponType: WeaponType.bow,\n    iconImg: `${basePath}oakwood-bow.png`,\n    rarity: Rarity.rare,\n    damage: { [DamageType.kinetic]: 23 },\n  },\n  paintedBuckler: {\n    itemCategory,\n    weaponType: WeaponType.shield,\n    iconImg: `${basePath}painted-buckler.png`,\n  },\n  poisonedDagger: {\n    itemCategory,\n    weaponType: WeaponType.knife,\n    iconImg: `${basePath}poisoned-dagger.png`,\n    rarity: Rarity.epic,\n    damage: { [DamageType.kinetic]: 12 },\n  },\n  pikeStaff: {\n    itemCategory,\n    weaponType: WeaponType.poleArm,\n    iconImg: `${basePath}pike-staff.png`,\n    rarity: Rarity.uncommon,\n    damage: { [DamageType.kinetic]: 22 },\n  },\n  ravenStaff: {\n    itemCategory,\n    weaponType: WeaponType.staff,\n    iconImg: `${basePath}raven-staff.png`,\n    rarity: Rarity.epic,\n    damage: { [DamageType.kinetic]: 13 },\n  },\n  scythe: {\n    itemCategory,\n    weaponType: WeaponType.poleArm,\n    iconImg: `${basePath}scythe.png`,\n    rarity: Rarity.common,\n    damage: { [DamageType.kinetic]: 5 },\n  },\n  savageStaff: {\n    itemCategory,\n    weaponType: WeaponType.staff,\n    iconImg: `${basePath}savage-staff.png`,\n    rarity: Rarity.epic,\n    damage: { [DamageType.kinetic]: 8 },\n  },\n  simpleCrossbow: {\n    itemCategory,\n    weaponType: WeaponType.crossbow,\n    iconImg: `${basePath}crossbow.png`,\n    rarity: Rarity.common,\n    damage: { [DamageType.kinetic]: 5 },\n  },\n  spear: {\n    itemCategory,\n    weaponType: WeaponType.poleArm,\n    iconImg: `${basePath}spear.png`,\n    rarity: Rarity.rare,\n    damage: { [DamageType.kinetic]: 10 },\n  },\n  steelShield: {\n    itemCategory,\n    weaponType: WeaponType.shield,\n    rarity: Rarity.rare,\n    iconImg: `${basePath}steel-shield.png`,\n  },\n  steelSword: {\n    itemCategory,\n    weaponType: WeaponType.sword,\n    iconImg: `${basePath}steel-sword.png`,\n    rarity: Rarity.uncommon,\n    damage: { [DamageType.kinetic]: 14 },\n  },\n  warhammer: {\n    itemCategory,\n    weaponType: WeaponType.hammer,\n    iconImg: `${basePath}warhammer.png`,\n    rarity: Rarity.rare,\n    damage: { [DamageType.kinetic]: 16 },\n  },\n  woodenBulwark: {\n    itemCategory,\n    weaponType: WeaponType.shield,\n    rarity: Rarity.common,\n    iconImg: `${basePath}wooden-bulwark.png`,\n  },\n};\n\n\nexport type Weapon = `${Prefix}${keyof typeof weapons}`;\nconst all = Object.entries(weapons).reduce<{ [key: string]: WeaponDefinition }>((acc, [key, value]) => {\n  acc[`${PREFIX}${key}`] = value;\n  return acc;\n}, {}) as Record<Weapon, WeaponDefinition>;\nexport default all;\n\nexport function getDefinition(weapon: Weapon): WeaponDefinition {\n  return all[weapon];\n}\n\nexport const isWeapon = (item: ItemType): item is Weapon => {\n  return !!all[item as Weapon];\n};\n","import { FIVE_SECONDS } from 'utils/format/time';\nimport { Type } from 'components/ui/toasts/Toast';\nimport EventEmitter from 'events';\nimport TypedEmitter from 'typed-emitter';\nimport { SoundManager } from './SoundManager';\n\nexport interface ToastConfig {\n  time: number;\n  title: string;\n  type?: Type;\n  icon?: string;\n  link?: string;\n}\n\nexport const EVENT_TOASTS_UPDATED = 'toast';\ntype ToastEvents = {\n  [EVENT_TOASTS_UPDATED]: (context: ToastConfig[] | undefined) => void;\n};\n\nexport class ToastManager extends (EventEmitter as unknown as new () => TypedEmitter<ToastEvents>) {\n  private static _instance = new ToastManager();\n\n  private static stack: ToastConfig[] = [];\n\n  private static lifeTime = FIVE_SECONDS; // Time each toast lives\n  // also update CSS animation!\n\n  static addToast(title: string, type?: Type, icon?: string, link?: string) {\n\n    this.stack = [...this.stack, {\n      time: Date.now(),\n      title,\n      type,\n      icon,\n      link,\n    }];\n\n    this.instance.emit(EVENT_TOASTS_UPDATED, this.stack);\n\n    SoundManager.playSound('ui/toast');\n\n    setTimeout(() => {\n      // Remove all popups that have expired\n      this.stack = this.stack.filter((toast) => {\n        return Date.now() - toast.time < this.lifeTime;\n      });\n      this.instance.emit(EVENT_TOASTS_UPDATED, this.stack);\n\n    }, this.lifeTime);\n  }\n\n  static get instance() {\n    return this._instance;\n  }\n}\n","import { TextManager } from 'global/TextManager';\nimport { ToastConfig } from 'global/ToastManager';\nimport { useNavigate } from 'react-router';\nimport Icon from 'components/ui/common/Icon';\n\ntype Props = ToastConfig;\n\nexport enum Type {\n  achievementUnlocked,\n  cheat,\n  game,\n  itemCrafted,\n  questCompleted,\n  questEncounter,\n  questLaunched,\n  questUpdate,\n}\n\nconst Toast = (props: Props) => {\n  const {\n    title,\n    type = Type.achievementUnlocked,\n    icon = '/img/items/quest-items/dragon-eye.png',\n    link,\n  } = props;\n  const navigate = useNavigate();\n\n  const handleClick = () => {\n    if (link) {\n      navigate(link);\n    }\n  };\n\n  const typeText = TextManager.getToastType(type);\n  return (\n    <div className={`toast ${link ? 'withlink' : ''}`} onClick={handleClick}>\n      <div className=\"label type\">{typeText}</div>\n      <div className=\"label title\">{title}</div>\n      <Icon size=\"big\" image={icon} className=\"toast-icon\" border=\"gold\" />\n      <div className=\"banner\"/>\n    </div>\n  );\n};\n\nexport default Toast;\n","import { EquipmentSlotType } from 'components/ui/adventurer/EquipmentSlot';\nimport { AttributesStoreState } from 'store/types/adventurer';\nimport {  randomInt, roll3D6, weightedRoll } from 'utils/random';\n\nexport const AP_COST_MOVE = 1; // amount of AP to deduct for each tile moved\nexport const AP_COST_CONSUME = 2; // amount of AP to deduct for consuming an item\nexport const AP_COST_MELEE = 1; // amount of AP to deduct for consuming an item\nexport const AP_COST_SHOOT = 1; // amount of AP to deduct for consuming an item\nexport const ENEMY_BASE_AP = 6;\n\nexport const calculateInitialAP = (attributes: AttributesStoreState, level: number) => {\n  const { agi } = attributes;\n  return Math.floor(0.2 * (1.16 ^ agi) + 1 + (level / 10)) + 300; // todo: remove the 300\n  // for (let dx = 1; dx < 21; dx++) {\n  //     console.lxg(`lvl 1, dx ${dx}: ${calculateInitialAP(dx, 1)}`)\n  // }\n  // for (let dx = 1; dx < 21; dx++) {\n  //     console.lxg(`lvl 10, dx ${dx}: ${calculateInitialAP(dx, 10)}`)\n  // }\n};\n\n// Calculates base dodge %. Note that there should be a modifier applied for\n// relative difference in levels\nexport const calculateDodge = (attributes: AttributesStoreState) => {\n  const { agi } = attributes;\n  return agi * 3;\n};\n\nexport const rollToHit = (weaponSkill = 0) => {\n  const roll = roll3D6();\n  return roll <= weaponSkill;\n};\n\nexport const rollToDodge = (attributes: AttributesStoreState) => {\n  const dodge = calculateDodge(attributes);\n  const roll = randomInt(0, 100);\n  return dodge > roll;\n  // todo: level difference modifier?\n};\n\n\n// Returns a weighted random bodypart\nexport const rollBodyPart = () => {\n  const bodyParts = {\n    [EquipmentSlotType.head]: 0.1,\n    [EquipmentSlotType.chest]: 0.4,\n    [EquipmentSlotType.hands]: 0.1,\n    [EquipmentSlotType.legs]: 0.3,\n    [EquipmentSlotType.shoulders]: 0.05,\n    [EquipmentSlotType.feet]: 0.05,\n  };\n\n  return weightedRoll(bodyParts);\n};\n\n","export interface TraitDefinition {\n  trait: Trait;\n  hasEffect?: boolean;    // shown in tooltip\n}\n\nexport enum Trait {\n  arrowFinder = 'arrowFinder',\n  gloomy = 'gloomy',\n  lucky = 'lucky',\n  houseHouston = 'houseHouston',\n  houseMaddox = 'houseMaddox',\n  houseMonroe = 'houseMonroe',\n}\n\n","import { Location } from 'utils/tilemap';\nimport { EquipmentSlotType } from 'components/ui/adventurer/EquipmentSlot';\nimport { Item } from 'definitions/items/types';\nimport { isWeapon, Weapon } from 'definitions/items/weapons';\nimport { StoreState } from 'store/types';\nimport { AdventurerStoreState } from 'store/types/adventurer';\nimport { QuestStoreState } from 'store/types/quest';\nimport { isAdventurer, isEnemy, SceneObject } from 'store/types/scene';\nimport { locationEquals } from 'utils/tilemap';\nimport { Ammunition } from 'definitions/items/ammunition';\nimport { isAmmunition } from 'definitions/items/ammunition';\n\n// export const adventurersInParty = (store: StoreState, partyId: string): AdventurerStoreState[] => {\n//   const party: PartyStoreState = store.parties[partyId];\n//   return party.adventurers.map((id: string) => findAdventurerById(store, id)!);\n// };\n\n/**\n * Returns the quest the given adventurer is currently on. Can be undefined if not on a quest\n */\nexport const findQuestByAdventurer = (adventurer: AdventurerStoreState, quests: QuestStoreState[]) => {\n  return quests.find(q => q.party.some(a => a === adventurer.id));\n};\n\nexport const findAdventurerById = (adventurers: AdventurerStoreState[], id: string): AdventurerStoreState | undefined => {\n  return adventurers.find((a) => a.id === id);\n};\n\nexport const adventurersOnQuest = (adventurers: AdventurerStoreState[], quest: QuestStoreState): AdventurerStoreState[] => {\n  // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n  return quest.party.map((id: string) => findAdventurerById(adventurers, id)!);\n};\n\nexport const getQuestLeader = (adventurers: AdventurerStoreState[], quest: QuestStoreState): AdventurerStoreState | undefined => {\n  const leaderId = quest.party[0];\n  return findAdventurerById(adventurers, leaderId);\n};\n\n\n/**\n * Returns the amount of free inventory slots on this adventurer */\nexport const adventurerFreeInventorySlots = (adventurer: AdventurerStoreState): number => {\n  return adventurer.inventory.filter(i => i === null).length;\n};\n\n/**\n * Returns the weapons the adventurer has. Can be 0, 1 or 2 */\nexport const adventurerWeapons = (adventurer: AdventurerStoreState): [Item<Weapon>?, Item<Weapon>?] => {\n  const check = (slot: EquipmentSlotType) => {\n    const item = adventurer.equipment[slot];\n    return !!item && isWeapon(item.type);\n  };\n  return [\n    ...check(EquipmentSlotType.mainHand) ? [adventurer.equipment[EquipmentSlotType.mainHand]] : [],\n    ...check(EquipmentSlotType.offHand) ? [adventurer.equipment[EquipmentSlotType.offHand]] : [],\n  ] as [Item<Weapon>?, Item<Weapon>?];\n};\n\n/**\n * Returns the ammo in the offhand slot */\nexport const adventurerAmmo = (adventurer: AdventurerStoreState): Item<Ammunition> | undefined => {\n  const item = adventurer.equipment[EquipmentSlotType.offHand];\n  return (item && isAmmunition(item.type)) ? adventurer.equipment[EquipmentSlotType.offHand] as Item<Ammunition> : undefined;\n};\n\n// Searches `objects` list and returns the object at `location` (if any)\nexport const getSceneObjectAtLocation = (objects: SceneObject[], location: Location, additionalFilter: (object: SceneObject) => boolean = () => true) => {\n  return objects.find(o => o.location && locationEquals(o.location, location) && additionalFilter(o));\n};\n\nexport const getSceneObjectWithName = (objects: SceneObject[], name: string) => {\n  return objects.find(sA => isAdventurer(sA) && sA.adventurerId === name || isEnemy(sA) && sA.enemyId === name);\n};\n\n// Returns a value indicating whether this store is fresh or rehydrated\nexport const storeIsRehydrated = (store: StoreState): boolean => {\n  return store?.engine.gameStarted !== undefined;\n};\n\n","import { TextEntry } from 'constants/text';\n\nexport enum LogChannel {\n  common,         // Only visible in 'all'\n  town,           // Visible in 'all' and town\n  quest,          // Visible in 'all' and the appropriate quest tab\n}\n\nexport interface LogEntry extends TextEntry {\n  time: number;\n  channel: LogChannel;\n  channelContext?: string;\n}\n","// export type TempEffect\n\n// TempEffect (todo: find better name) contains a number of effects that\n// are temporary active on an adventurer\nimport { Effect } from 'definitions/effects/types';\n\nexport enum TempEffectType {\n  brokenLegs,               // every step decreases health\n  burning,\n  soma,\n}\n\nexport type BaseTempEffect = {\n  type: TempEffectType;\n  effects: Effect[];\n  timeRemaining?: number;   // if set, the effect will wear off\n  charges?: number;         // if set, amount of charges still remaining\n};\n\nexport type TempEffectBrokenLegs = BaseTempEffect & {\n  type: TempEffectType.brokenLegs,\n  damage: number\n};\n\nexport type TempEffectBurning = BaseTempEffect & {\n  type: TempEffectType.burning,\n  interval: number,\n  damage: number\n};\n\nexport type TempEffectSoma = BaseTempEffect & {\n  type: TempEffectType.soma,\n  factor: number\n};\n\nexport type TempEffect = TempEffectBrokenLegs\n| TempEffectBurning\n| TempEffectSoma;\n","import { EquipmentSlotType } from 'components/ui/adventurer/EquipmentSlot';\nimport { Ammunition } from 'definitions/items/ammunition';\nimport { Apparel } from 'definitions/items/apparel';\nimport { Item } from 'definitions/items/types';\nimport { Weapon } from 'definitions/items/weapons';\nimport { Trait } from 'definitions/traits/types';\nimport { TempEffect } from 'definitions/tempEffects/types';\nimport { WeaponType } from 'definitions/weaponTypes/types';\n\nexport interface AdventurerStoreState {\n  id: string;\n  name?: string;\n  flavor?: boolean;           // Has lore text, language key: `adventurer-{id}-flavor\n  avatarImg: string;\n  spritesheetPath: string;      // Path to JSON of spritesheet to use in scenes\n  color?: AdventurerColor;\n  traits?: Trait[];\n  health: number;           // When this reaches zero, the adventurer is dead\n  xp: number;\n\n  equipment: EquipmentStoreState;   // equipment\n  tempEffects: TempEffect[];          // combat effects\n  inventory: (null | Item)[];\n  basicAttributes: AttributesStoreState;\n  skills: SkillsStoreState;       //\n  room: number;             // Adventurer is lodged in this room in the tavern\n}\n\nexport enum AdventurerColor {\n  blue,\n  red,\n  teal,\n  purple,\n  orange,\n  black,\n  white,\n  yellow,\n}\n\nexport type Equipment = Apparel | Weapon | Ammunition;\n\nexport type EquipmentStoreState = {\n  [EquipmentSlotType.head]?: Item<Apparel>;\n  [EquipmentSlotType.shoulders]?: Item<Apparel>;\n  [EquipmentSlotType.chest]?: Item<Apparel>;\n  [EquipmentSlotType.hands]?: Item<Apparel>;\n  [EquipmentSlotType.legs]?: Item<Apparel>;\n  [EquipmentSlotType.feet]?: Item<Apparel>;\n  [EquipmentSlotType.mainHand]?: Item<Weapon>;\n  [EquipmentSlotType.offHand]?: Item<Weapon> | Item<Ammunition>;\n};\n\nexport interface AttributesStoreState {\n  str: number;\n  for: number;\n  int: number;\n  agi: number;\n}\n\n// Determines the order in which the attributes are shown\nexport const attributeList: Attribute[] = ['str', 'for', 'int', 'agi'];\n\nexport type Attribute = keyof AttributesStoreState;\n\nexport type SkillsStoreState = {\n  [key in WeaponType]?: number\n};\n","// Ensures type safety for typescript\nexport function hasOwnProperty<X, Y extends PropertyKey>(obj: X, prop: Y): obj is X & Record<Y, unknown> {\n  return Object.hasOwnProperty.call(obj, prop);\n}\n\nexport type Entries<T> = {\n  [K in keyof T]: [K, T[K]]\n}[keyof T][];\n\n\n// Type safe entries ([key, value] pair)\nexport function entries<T>(obj: T): Entries<T> {\n  return Object.entries(obj) as Entries<T>;\n}\n\n\n// Returns a list of enum values\nexport const listEnum = <T extends { [key: string]: number | string }>(enumeration: T) => {\n  return Object.keys(enumeration).filter(v => !isNaN(Number(v))).map(v => Number(v));\n};\n","import { ItemType, ItemDefinition, ItemCategory } from './types';\nimport { EquipmentSlotType } from 'components/ui/adventurer/EquipmentSlot';\nimport { Effect, EffectAttibuteIncrease, EffectType } from 'definitions/effects/types';\nimport { Rarity } from 'constants/items';\n\ntype Prefix = 'apparel/';\nconst PREFIX = 'apparel/';\nconst itemCategory = ItemCategory.apparel;\nconst basePath = '/img/items/apparel/';\n\nconst crimsonRogueEffect: EffectAttibuteIncrease = {\n  type: EffectType.attributeIncrease,\n  attribute: 'agi',\n  factor: 1.05,\n};\n\nexport interface ApparelDefinition extends ItemDefinition {\n  equipmentType: EquipmentSlotType;\n  damageReduction?: number;\n  effects?: Effect[];\n}\n\nconst definitions = {\n  boots1: {\n    equipmentType: EquipmentSlotType.feet,\n    itemCategory,\n    iconImg: `${basePath}boots_1.png`,\n  },\n  boots2: {\n    equipmentType: EquipmentSlotType.feet,\n    itemCategory,\n    damageReduction: 1,\n    iconImg: `${basePath}boots_2.png`,\n  },\n  boots3: {\n    equipmentType: EquipmentSlotType.feet,\n    itemCategory,\n    damageReduction: 2,\n    iconImg: `${basePath}boots_3.png`,\n  },\n  chainmailHood: {\n    equipmentType: EquipmentSlotType.head,\n    itemCategory,\n    iconImg: `${basePath}chainmail_hood.png`,\n    damageReduction: 3,\n  },\n  chest: {\n    equipmentType: EquipmentSlotType.chest,\n    itemCategory,\n    iconImg: `${basePath}chest_1.png`,\n    damageReduction: 2,\n  },\n  clothGloves: {\n    equipmentType: EquipmentSlotType.hands,\n    itemCategory,\n    iconImg: `${basePath}cloth_gloves.png`,\n    damageReduction: 1,\n  },\n  cowl: {\n    equipmentType: EquipmentSlotType.head,\n    itemCategory,\n    iconImg: `${basePath}cowl.png`,\n    damageReduction: 2,\n  },\n  cultistBoots: {\n    equipmentType: EquipmentSlotType.feet,\n    itemCategory,\n    iconImg: `${basePath}cultist_boots.png`,\n    damageReduction: 2,\n  },\n  crimsonRogueBoots: {\n    equipmentType: EquipmentSlotType.feet,\n    itemCategory,\n    iconImg: `${basePath}crimson_rogue_boots.png`,\n    damageReduction: 2,\n    effects: [crimsonRogueEffect],\n  },\n  crimsonRogueBritches: {\n    equipmentType: EquipmentSlotType.legs,\n    itemCategory,\n    iconImg: `${basePath}crimson_rogue_britches.png`,\n    damageReduction: 2,\n    effects: [crimsonRogueEffect],\n  },\n  crimsonRogueCoif: {\n    equipmentType: EquipmentSlotType.head,\n    itemCategory,\n    iconImg: `${basePath}crimson_rogue_coif.png`,\n    damageReduction: 2,\n    effects: [crimsonRogueEffect],\n  },\n  crimsonRogueGrips: {\n    equipmentType: EquipmentSlotType.hands,\n    itemCategory,\n    iconImg: `${basePath}crimson_rogue_grips.png`,\n    damageReduction: 2,\n    effects: [crimsonRogueEffect],\n  },\n  crimsonRogueSpaulders: {\n    equipmentType: EquipmentSlotType.shoulders,\n    itemCategory,\n    iconImg: `${basePath}crimson_rogue_spaulders.png`,\n    damageReduction: 2,\n    effects: [crimsonRogueEffect],\n  },\n  crimsonRogueTunic: {\n    equipmentType: EquipmentSlotType.chest,\n    itemCategory,\n    iconImg: `${basePath}crimson_rogue_tunic.png`,\n    damageReduction: 2,\n    effects: [crimsonRogueEffect],\n  },\n  cultistGloves: {\n    equipmentType: EquipmentSlotType.hands,\n    itemCategory,\n    iconImg: `${basePath}cultist_gloves.png`,\n    damageReduction: 2,\n  },\n  cultistPants: {\n    equipmentType: EquipmentSlotType.legs,\n    itemCategory,\n    iconImg: `${basePath}cultist_pants.png`,\n    damageReduction: 2,\n  },\n  cultistRobe: {\n    equipmentType: EquipmentSlotType.chest,\n    itemCategory,\n    iconImg: `${basePath}cultist_robe.png`,\n    damageReduction: 2,\n  },\n  cultistShoulderwraps: {\n    equipmentType: EquipmentSlotType.shoulders,\n    itemCategory,\n    iconImg: `${basePath}cultist_shoulderwraps.png`,\n    damageReduction: 2,\n  },\n  darkPrinceBracers: {\n    equipmentType: EquipmentSlotType.hands,\n    itemCategory,\n    iconImg: `${basePath}dark_prince_bracers.png`,\n    damageReduction: 2,\n  },\n  darkPrinceCape: {\n    equipmentType: EquipmentSlotType.shoulders,\n    itemCategory,\n    iconImg: `${basePath}dark_prince_cape.png`,\n    damageReduction: 2,\n  },\n  darkPrinceCuirass: {\n    equipmentType: EquipmentSlotType.chest,\n    itemCategory,\n    iconImg: `${basePath}dark_prince_cuirass.png`,\n    damageReduction: 2,\n  },\n  darkPrinceHood: {\n    equipmentType: EquipmentSlotType.head,\n    itemCategory,\n    iconImg: `${basePath}dark_prince_hood.png`,\n    damageReduction: 2,\n  },\n  darkPrinceSarong: {\n    equipmentType: EquipmentSlotType.legs,\n    itemCategory,\n    iconImg: `${basePath}dark_prince_sarong.png`,\n    damageReduction: 2,\n  },\n  darkPrinceSlippers: {\n    equipmentType: EquipmentSlotType.feet,\n    itemCategory,\n    iconImg: `${basePath}dark_prince_slippers.png`,\n    damageReduction: 2,\n  },\n  dreadnoughtBoots: {\n    equipmentType: EquipmentSlotType.feet,\n    itemCategory,\n    iconImg: `${basePath}dreadnought_boots.png`,\n    damageReduction: 8,\n  },\n  dreadnoughtChest: {\n    equipmentType: EquipmentSlotType.chest,\n    itemCategory,\n    iconImg: `${basePath}dreadnought_chest.png`,\n    damageReduction: 8,\n  },\n  dreadnoughtGauntlets: {\n    equipmentType: EquipmentSlotType.hands,\n    itemCategory,\n    iconImg: `${basePath}dreadnought_gauntlets.png`,\n    damageReduction: 8,\n  },\n  dreadnoughtHelm: {\n    equipmentType: EquipmentSlotType.head,\n    itemCategory,\n    iconImg: `${basePath}dreadnought_helm.png`,\n    damageReduction: 8,\n  },\n  dreadnoughtLegplates: {\n    equipmentType: EquipmentSlotType.legs,\n    itemCategory,\n    iconImg: `${basePath}dreadnought_legplates.png`,\n    damageReduction: 8,\n  },\n  dreadnoughtPauldrons: {\n    equipmentType: EquipmentSlotType.shoulders,\n    itemCategory,\n    iconImg: `${basePath}dreadnought_pauldrons.png`,\n    damageReduction: 8,\n  },\n  druidChest: {\n    equipmentType: EquipmentSlotType.chest,\n    itemCategory,\n    iconImg: `${basePath}druid-chest.png`,\n  },\n  druidFeet: {\n    equipmentType: EquipmentSlotType.feet,\n    itemCategory,\n    iconImg: `${basePath}druid-feet.png`,\n  },\n  druidHands: {\n    equipmentType: EquipmentSlotType.hands,\n    itemCategory,\n    iconImg: `${basePath}druid-hands.png`,\n  },\n  druidHead: {\n    equipmentType: EquipmentSlotType.head,\n    itemCategory,\n    iconImg: `${basePath}druid-head.png`,\n  },\n  druidLegs: {\n    equipmentType: EquipmentSlotType.legs,\n    itemCategory,\n    iconImg: `${basePath}druid-legs.png`,\n  },\n  fedora: {\n    equipmentType: EquipmentSlotType.head,\n    itemCategory,\n    iconImg: `${basePath}fedora.png`,\n  },\n  footmanBoots: {\n    equipmentType: EquipmentSlotType.feet,\n    itemCategory,\n    iconImg: `${basePath}footman_boots.png`,\n  },\n  footmanBreastplate: {\n    equipmentType: EquipmentSlotType.chest,\n    itemCategory,\n    iconImg: `${basePath}footman_breastplate.png`,\n  },\n  footmanFaceguard: {\n    equipmentType: EquipmentSlotType.head,\n    itemCategory,\n    iconImg: `${basePath}footman_faceguard.png`,\n  },\n  footmanFists: {\n    equipmentType: EquipmentSlotType.hands,\n    itemCategory,\n    iconImg: `${basePath}footman_fists.png`,\n  },\n  footmanLegplates: {\n    equipmentType: EquipmentSlotType.legs,\n    itemCategory,\n    iconImg: `${basePath}footman_legplates.png`,\n  },\n  footmanPauldrons: {\n    equipmentType: EquipmentSlotType.shoulders,\n    itemCategory,\n    iconImg: `${basePath}footman_pauldrons.png`,\n  },\n  greaves1: {\n    equipmentType: EquipmentSlotType.feet,\n    itemCategory,\n    iconImg: `${basePath}greaves_1.png`,\n    damageReduction: 2,\n  },\n  greaves2: {\n    equipmentType: EquipmentSlotType.feet,\n    itemCategory,\n    iconImg: `${basePath}greaves_2.png`,\n  },\n  hornedHelmet: {\n    equipmentType: EquipmentSlotType.head,\n    itemCategory,\n    iconImg: `${basePath}horned_helmet.png`,\n  },\n  leatherGloves: {\n    equipmentType: EquipmentSlotType.hands,\n    itemCategory,\n    iconImg: `${basePath}leather_gloves.png`,\n  },\n  naturalistsCape: {\n    equipmentType: EquipmentSlotType.shoulders,\n    itemCategory,\n    iconImg: `${basePath}naturalists_cape.png`,\n  },\n  naturalistsCowl: {\n    equipmentType: EquipmentSlotType.head,\n    itemCategory,\n    iconImg: `${basePath}naturalists_cowl.png`,\n  },\n  naturalistsFootwraps: {\n    equipmentType: EquipmentSlotType.feet,\n    itemCategory,\n    iconImg: `${basePath}naturalists_footwraps.png`,\n  },\n  naturalistsVambraces: {\n    equipmentType: EquipmentSlotType.hands,\n    itemCategory,\n    iconImg: `${basePath}naturalists_vambraces.png`,\n  },\n  naturalistsVest: {\n    equipmentType: EquipmentSlotType.chest,\n    itemCategory,\n    iconImg: `${basePath}naturalists_vest.png`,\n  },\n  nomadHelmet: {\n    equipmentType: EquipmentSlotType.head,\n    itemCategory,\n    iconImg: `${basePath}nomad_helmet.png`,\n  },\n  pants1: {\n    equipmentType: EquipmentSlotType.legs,\n    itemCategory,\n    iconImg: `${basePath}pants_1.png`,\n    damageReduction: 3,\n  },\n  pants2: {\n    equipmentType: EquipmentSlotType.legs,\n    itemCategory,\n    iconImg: `${basePath}pants_2.png`,\n    damageReduction: 3,\n  },\n  plateChest1: {\n    equipmentType: EquipmentSlotType.chest,\n    itemCategory,\n    iconImg: `${basePath}plate_chest_1.png`,\n  },\n  plateChest2: {\n    equipmentType: EquipmentSlotType.chest,\n    itemCategory,\n    iconImg: `${basePath}plate_chest_2.png`,\n  },\n  plateChest3: {\n    equipmentType: EquipmentSlotType.chest,\n    itemCategory,\n    iconImg: `${basePath}plate_chest_3.png`,\n  },\n  plateChest4: {\n    equipmentType: EquipmentSlotType.chest,\n    itemCategory,\n    iconImg: `${basePath}plate_chest_4.png`,\n  },\n  plateGloves1: {\n    equipmentType: EquipmentSlotType.hands,\n    itemCategory,\n    iconImg: `${basePath}plate_gloves_1.png`,\n  },\n  plateGloves2: {\n    equipmentType: EquipmentSlotType.hands,\n    itemCategory,\n    iconImg: `${basePath}plate_gloves_2.png`,\n  },\n  plateHelmet: {\n    equipmentType: EquipmentSlotType.head,\n    itemCategory,\n    iconImg: `${basePath}plate_helmet_1.png`,\n  },\n  platePants: {\n    equipmentType: EquipmentSlotType.legs,\n    itemCategory,\n    iconImg: `${basePath}plate_pants1.png`,\n  },\n  plateShoulders1: {\n    equipmentType: EquipmentSlotType.shoulders,\n    itemCategory,\n    iconImg: `${basePath}plate_shoulders_1.png`,\n  },\n  plateShoulders2: {\n    equipmentType: EquipmentSlotType.shoulders,\n    itemCategory,\n    iconImg: `${basePath}plate_shoulders_2.png`,\n  },\n  robe: {\n    equipmentType: EquipmentSlotType.chest,\n    itemCategory,\n    iconImg: `${basePath}robe_1.png`,\n  },\n  shoulders1: {\n    equipmentType: EquipmentSlotType.shoulders,\n    itemCategory,\n    iconImg: `${basePath}shoulders_1.png`,\n  },\n  shoulders2: {\n    equipmentType: EquipmentSlotType.shoulders,\n    itemCategory,\n    iconImg: `${basePath}shoulders_2.png`,\n    damageReduction: 2,\n  },\n  shoulders3: {\n    equipmentType: EquipmentSlotType.shoulders,\n    itemCategory,\n    iconImg: `${basePath}shoulders_3.png`,\n  },\n  studdedLeatherShoulderguards: {\n    equipmentType: EquipmentSlotType.shoulders,\n    itemCategory,\n    iconImg: `${basePath}studded_leather_shoulderguards.png`,\n  },\n  sunchaserBritches: {\n    equipmentType: EquipmentSlotType.legs,\n    itemCategory,\n    iconImg: `${basePath}sunchaser_britches.png`,\n  },\n  sunchaserGloves: {\n    equipmentType: EquipmentSlotType.hands,\n    itemCategory,\n    iconImg: `${basePath}sunchaser_gloves.png`,\n  },\n  sunchaserHelm: {\n    equipmentType: EquipmentSlotType.head,\n    itemCategory,\n    iconImg: `${basePath}sunchaser_helm.png`,\n  },\n  sunchaserMantle: {\n    equipmentType: EquipmentSlotType.shoulders,\n    itemCategory,\n    iconImg: `${basePath}sunchaser_mantle.png`,\n  },\n  sunchaserMoccasins: {\n    equipmentType: EquipmentSlotType.feet,\n    itemCategory,\n    iconImg: `${basePath}sunchaser_moccasins.png`,\n  },\n  sunchaserTunic: {\n    equipmentType: EquipmentSlotType.chest,\n    itemCategory,\n    iconImg: `${basePath}sunchaser_tunic.png`,\n  },\n  templeGuardChestplate: {\n    equipmentType: EquipmentSlotType.chest,\n    itemCategory,\n    iconImg: `${basePath}temple_guard_chestplate.png`,\n  },\n  templeGuardGloves: {\n    equipmentType: EquipmentSlotType.hands,\n    itemCategory,\n    iconImg: `${basePath}temple_guard_gloves.png`,\n  },\n  templeGuardGreaves: {\n    equipmentType: EquipmentSlotType.shoulders,\n    itemCategory,\n    iconImg: `${basePath}temple_guard_greaves.png`,\n  },\n  templeGuardHelm: {\n    equipmentType: EquipmentSlotType.head,\n    itemCategory,\n    iconImg: `${basePath}temple_guard_helm.png`,\n  },\n  templeGuardLegplates: {\n    equipmentType: EquipmentSlotType.legs,\n    itemCategory,\n    iconImg: `${basePath}temple_guard_legplates.png`,\n  },\n  templeGuardPauldrons: {\n    equipmentType: EquipmentSlotType.shoulders,\n    itemCategory,\n    iconImg: `${basePath}temple_guard_pauldrons.png`,\n  },\n  vest: {\n    equipmentType: EquipmentSlotType.chest,\n    itemCategory,\n    iconImg: `${basePath}vest_1.png`,\n  },\n  witchhunterBoots: {\n    equipmentType: EquipmentSlotType.feet,\n    rarity: Rarity.epic,\n    itemCategory,\n    iconImg: `${basePath}witchhunter_boots.png`,\n  },\n  witchhunterBritches: {\n    equipmentType: EquipmentSlotType.legs,\n    rarity: Rarity.epic,\n    itemCategory,\n    iconImg: `${basePath}witchhunter_britches.png`,\n  },\n  witchhunterCape: {\n    equipmentType: EquipmentSlotType.shoulders,\n    rarity: Rarity.epic,\n    itemCategory,\n    iconImg: `${basePath}witchhunter_cape.png`,\n  },\n  witchhunterGambeson: {\n    equipmentType: EquipmentSlotType.chest,\n    rarity: Rarity.epic,\n    itemCategory,\n    iconImg: `${basePath}witchhunter_gambeson.png`,\n  },\n  witchhunterGrips: {\n    equipmentType: EquipmentSlotType.hands,\n    rarity: Rarity.epic,\n    itemCategory,\n    iconImg: `${basePath}witchhunter_grips.png`,\n  },\n  witchhunterHat: {\n    equipmentType: EquipmentSlotType.head,\n    rarity: Rarity.epic,\n    itemCategory,\n    iconImg: `${basePath}witchhunter_hat.png`,\n  },\n};\n\nexport type Apparel = `${Prefix}${keyof typeof definitions}`;\nconst all = Object.entries(definitions).reduce<{ [key: string]: ApparelDefinition }>((acc, [key, value]) => {\n  acc[`${PREFIX}${key}`] = value;\n  return acc;\n}, {}) as Record<Apparel, ApparelDefinition>;\nexport default all;\n\nexport function getDefinition(apparel: Apparel): ApparelDefinition {\n  return all[apparel];\n}\n\nexport const isApparel = (item: ItemType): item is Apparel => {\n  return !!all[item as Apparel];\n};\n","import { ItemType } from 'definitions/items/types';\nimport { SceneStoreState } from './scene';\n\nexport enum QuestStatus {\n  unavailable,\n  available,  // on the quest board\n  active,\n  completed,\n  // todo: failed?\n}\n\nexport interface QuestReward {\n  gold?: number;\n  items?: ItemType[];\n}\n\nexport interface QuestStoreState {\n  name: string;\n  status: QuestStatus;\n  party: string[];        // list of adventurer ids\n  progress: number;         // Which questnode the party is at currently\n  questVars: unknown;       //\n  encounterResults: string[];   // Store what option the place chose during an encounter // OBSOLETE\n  icon: string;\n\n  reward?: QuestReward;\n  scene?: SceneStoreState;\n  sceneName?: string;\n  sceneNamePrev?: string;\n}\n","import { ItemType, ItemDefinition, ItemCategory } from './types';\n\ntype Prefix = 'consumable/';\nconst PREFIX = 'consumable/';\nconst itemCategory = ItemCategory.consumable;\nconst basePath = '/img/items/consumables/';\n\nexport type ConsumableCategory = 'health' | 'soma' | 'mana';\nexport interface ConsumableDefinition extends ItemDefinition {\n  category: ConsumableCategory;\n  effect?: number;\n}\n\nconst consumables = {\n  minorHealthPotion: {\n    category: 'health',\n    effect: 10,\n    itemCategory,\n    iconImg: `${basePath}minor-health-potion.png`,\n  },\n  minorManaPotion: {\n    category: 'mana',\n    itemCategory,\n    iconImg: `${basePath}minor-mana-potion.png`,\n  },\n  minorSoma: {\n    category: 'soma',\n    itemCategory,\n    iconImg: `${basePath}minor-soma.png`,\n    effect: 1.1,\n  },\n  lesserHealthPotion: {\n    category: 'health',\n    effect: 25,\n    itemCategory,\n    iconImg: `${basePath}lesser-health-potion.png`,\n  },\n  lesserManaPotion: {\n    category: 'mana',\n    itemCategory,\n    iconImg: `${basePath}lesser-mana-potion.png`,\n  },\n  lesserSoma: {\n    category: 'soma',\n    itemCategory,\n    iconImg: `${basePath}lesser-soma.png`,\n    effect: 1.25,\n  },\n  majorHealthPotion: {\n    category: 'health',\n    effect: 50,\n    itemCategory,\n    iconImg: `${basePath}major-health-potion.png`,\n  },\n  majorManaPotion: {\n    category: 'mana',\n    itemCategory,\n    iconImg: `${basePath}major-mana-potion.png`,\n  },\n  majorSoma: {\n    category: 'soma',\n    itemCategory,\n    iconImg: `${basePath}major-soma.png`,\n    effect: 1.5,\n  },\n  greaterHealthPotion: {\n    category: 'health',\n    effect: 75,\n    itemCategory,\n    iconImg: `${basePath}greater-health-potion.png`,\n  },\n  greaterManaPotion: {\n    category: 'mana',\n    itemCategory,\n    iconImg: `${basePath}greater-mana-potion.png`,\n  },\n  greaterSoma: {\n    category: 'soma',\n    itemCategory,\n    iconImg: `${basePath}greater-soma.png`,\n    effect: 2,\n  },\n};\n\nexport type Consumable = `${Prefix}${keyof typeof consumables}`;\nconst all = Object.entries(consumables).reduce<{ [key: string]: ConsumableDefinition }>((acc, [key, value]) => {\n  acc[`${PREFIX}${key}`] = value as ConsumableDefinition;\n  return acc;\n}, {}) as Record<Consumable, ConsumableDefinition>;\nexport default all;\n\nexport function getDefinition(consumable: Consumable): ConsumableDefinition {\n  return all[consumable];\n}\n\nexport const isConsumable = (item: ItemType): item is Consumable => {\n  return !!all[item as Consumable];\n};\n","import EventEmitter from 'events';\nimport { Point } from 'pixi.js';\nimport TypedEmitter from 'typed-emitter';\n\n\nexport const EVENT_BUBBLE_ADDED = 'bubbleAdded';\nexport enum BubbleType { combat, resource }\nexport enum BubbleLayer { general, scene }\n\ntype BubbleEvents = {\n  [EVENT_BUBBLE_ADDED]: (text: string, point: Point, bubbleType?: BubbleType, layer?: BubbleLayer) => void;\n};\n\nexport class BubbleManager extends (EventEmitter as unknown as new () => TypedEmitter<BubbleEvents>) {\n  private static _instance = new BubbleManager();\n\n  static addBubble(text: string, point: Point, bubbleType: BubbleType = BubbleType.combat, layer: BubbleLayer = BubbleLayer.general) {\n    this.instance.emit(EVENT_BUBBLE_ADDED, text, point, bubbleType, layer);\n  }\n\n  static get instance() {\n    return this._instance;\n  }\n}\n","import kill10Boars from './kill10Boars';\r\nimport retrieveMagicAmulet from './retrieveMagicAmulet';\r\nimport { QuestDefinition } from './types';\r\n\r\n\r\n// const fulruhmRaid: QuestDefinition = {\r\n//   nodes: [{\r\n//     x: -4,\r\n//     y: -1,\r\n//     type: QuestNodeType.nothing,\r\n//   }, {\r\n//     x: -4,\r\n//     y: -1,\r\n//     type: QuestNodeType.nothing,\r\n\r\nconst all = {\r\n  kill10Boars,\r\n  retrieveMagicAmulet,\r\n};\r\n\r\nexport default all;\r\n\r\nexport function getDefinition<T = unknown>(questName: string): QuestDefinition<T> {\r\n  return all[questName as keyof typeof all] as unknown as QuestDefinition<T>;\r\n}\r\n","import { QuestStoreState } from 'store/types/quest';\nimport { QuestDefinition, QuestNodeType } from '../types';\nimport { initialQuestVars, Kill10BoarsQuestVars } from './questVars';\n\n\nconst kill10Boars: QuestDefinition<Kill10BoarsQuestVars> = {\n  getQuestVars: (questStore: QuestStoreState) => questStore.questVars as Kill10BoarsQuestVars,\n  getInitialQuestVars: (_questStore: QuestStoreState) => {\n    return initialQuestVars;\n  },\n  nodes: [{\n    x: 0,\n    y: 1,\n    type: QuestNodeType.encounter,\n    startScene: 'dungeon.canyon',\n  }, {\n    x: 0,\n    y: 2,\n    log: 'quest-kill10-boars-enter-dungeon',\n    type: QuestNodeType.nothing,\n  }, {\n    x: 0,\n    y: 3,\n    type: QuestNodeType.nothing,\n  }, {\n    x: 0,\n    y: 3,\n    type: QuestNodeType.encounter,\n    startScene: 'dungeon.entrance',\n  }, {\n    x: 1,\n    y: 3,\n    type: QuestNodeType.nothing,\n    log: 'quest-kill10-boars-leave-dungeon',\n  }, {\n    x: 1,\n    y: 3,\n    type: QuestNodeType.nothing,\n    log: 'quest-kill10-boars-left-dungeon',\n  }, {\n    x: 2,\n    y: 3,\n    type: QuestNodeType.nothing,\n  }, {\n    x: 3,\n    y: 3,\n    type: QuestNodeType.encounter,\n    startScene: 'dungeon.hallway',\n\n    //encounter: Encounter.backstabbed,\n  }, {\n    x: 4,\n    y: 4,\n    type: QuestNodeType.nothing,\n    log: 'The party spots a boss',\n  }, {\n    x: 5,\n    y: 4,\n    type: QuestNodeType.nothing,\n  }],\n};\n\nexport default kill10Boars;\n","import { QuestStoreState } from 'store/types/quest';\nimport { QuestDefinition, QuestNodeType } from '../types';\n\nexport interface RetrieveMagicAmuletQuestVars {\n  baz: boolean;\n  zux: number;\n}\n\nconst retrieveMagicAmulet: QuestDefinition<RetrieveMagicAmuletQuestVars> = {\n  getQuestVars: (questStore: QuestStoreState) => questStore.questVars as RetrieveMagicAmuletQuestVars,\n  getInitialQuestVars: (_questStore: QuestStoreState) => {\n    const vars: RetrieveMagicAmuletQuestVars = {\n      baz: false,\n      zux: 13,\n    };\n    return vars;\n  },\n  requiredItems: [\n    'questItem/torch',\n    'questItem/torch',\n    'questItem/torch',\n    'questItem/sandwich',\n    'questItem/sandwich',\n  ],\n  nodes: [{\n    x: 0,\n    y: 1,\n    type: QuestNodeType.nothing,\n  }, {\n    x: 1,\n    y: 1,\n    type: QuestNodeType.nothing,\n  }, {\n    x: 2,\n    y: 1,\n    type: QuestNodeType.nothing,\n  }, {\n    x: 3,\n    y: 1,\n    type: QuestNodeType.nothing,\n  }, {\n    x: 4,\n    y: 1,\n    type: QuestNodeType.nothing,\n  }, {\n    x: 5,\n    y: 1,\n    type: QuestNodeType.nothing,\n  }, {\n    x: 7,\n    y: 1,\n    type: QuestNodeType.nothing,\n  }, {\n    x: 8,\n    y: 2,\n    type: QuestNodeType.nothing,\n  }, {\n    x: 8,\n    y: 3,\n    type: QuestNodeType.nothing,\n  }, {\n    x: 9,\n    y: 3,\n    type: QuestNodeType.nothing,\n  }, {\n    x: 10,\n    y: 1,\n    type: QuestNodeType.nothing,\n  }, {\n    x: 10,\n    y: 2,\n    type: QuestNodeType.nothing,\n  }, {\n    x: 10,\n    y: 3,\n    type: QuestNodeType.nothing,\n  }, {\n    x: 10,\n    y: 4,\n    type: QuestNodeType.nothing,\n  }, {\n    x: 11,\n    y: 5,\n    type: QuestNodeType.nothing,\n  }, {\n    x: 12,\n    y: 6,\n    type: QuestNodeType.nothing,\n  }, {\n    x: 12,\n    y: 7,\n    type: QuestNodeType.nothing,\n  }, {\n    x: 13,\n    y: 8,\n    type: QuestNodeType.nothing,\n  }, {\n    x: 12,\n    y: 8,\n    type: QuestNodeType.nothing,\n  }, {\n    x: 12,\n    y: 9,\n    type: QuestNodeType.nothing,\n  }, {\n    x: 11,\n    y: 8,\n    type: QuestNodeType.nothing,\n  }, {\n    x: 10,\n    y: 8,\n    type: QuestNodeType.nothing,\n  }, {\n    x: 9,\n    y: 8,\n    type: QuestNodeType.nothing,\n  }, {\n    x: 8,\n    y: 9,\n    type: QuestNodeType.nothing,\n  }, {\n    x: 7,\n    y: 8,\n    type: QuestNodeType.encounter,\n    startScene: 'dungeon.hallway',\n  }, {\n    x: 8,\n    y: 1,\n    type: QuestNodeType.nothing,\n  }, {\n    x: 1,\n    y: 1,\n    type: QuestNodeType.nothing,\n  }, {\n    x: 1,\n    y: 1,\n    type: QuestNodeType.nothing,\n  }, {\n    x: 1,\n    y: 1,\n    type: QuestNodeType.nothing,\n  }, {\n    x: 1,\n    y: 1,\n    type: QuestNodeType.nothing,\n  }, {\n    x: 1,\n    y: 1,\n    type: QuestNodeType.nothing,\n  }, {\n    x: 1,\n    y: 1,\n    type: QuestNodeType.nothing,\n  }, {\n    x: 1,\n    y: 1,\n    type: QuestNodeType.nothing,\n  }, {\n    x: 1,\n    y: 1,\n    type: QuestNodeType.nothing,\n  }, {\n    x: 2,\n    y: 1,\n    type: QuestNodeType.encounter,\n    startScene: 'dungeon.hallway',\n  }, {\n    x: 3,\n    y: 1,\n    type: QuestNodeType.nothing,\n  }],\n};\n\nexport default retrieveMagicAmulet;","import { Loader, LoaderResource } from 'pixi.js';\nimport { lerp } from './math';\n\nexport interface Coords {\n  x: number;\n  y: number;\n}\n\nexport const lerpLocation = (point1: Coords, point2: Coords, alpha: number): Coords => {\n  const x = lerp(point1.x, point2.x, alpha);\n  const y = lerp(point1.y, point2.y, alpha);\n  return { x, y };\n};\n\n// Uses the shared pixi loader to load a resource\nexport async function loadResourceAsync(path: string) {\n  const loader = Loader.shared;\n  return new Promise<LoaderResource>((resolve, _reject) => {\n    if (loader.resources[path]) {\n      resolve(loader.resources[path]);\n    } else {\n      loader.add(path).load((_, resources) => {\n        resolve(resources[path]);\n      });\n    }\n  });\n}\n\nexport const loadResource = (path: string, callback: (resource: LoaderResource) => void) => {\n  const loader = Loader.shared;\n  if (loader.resources[path]) {\n    callback(loader.resources[path]);\n    return;\n  }\n  loader.add(path).load((_, resources) => { callback(resources[path]);});\n};\n","import { LogChannel } from 'store/types/logEntry';\nimport { TextEntry } from 'constants/text';\n\nexport type LogAction =\n  { type: 'addLogEntry', entry: TextEntry, channel: LogChannel, channelContext?: string };\n\n\nexport const addLogText = (key: string, context?: unknown, channel: LogChannel = LogChannel.common, channelContext?: string): LogAction => {\n  const entry: TextEntry = {\n    key,\n    context,\n  };\n  return {\n    type: 'addLogEntry',\n    entry,\n    channel,\n    channelContext,\n  };\n};\n\nexport const addLogEntry = (entry: TextEntry, channel: LogChannel = LogChannel.common, channelContext?: string): LogAction => ({\n  type: 'addLogEntry',\n  entry,\n  channel,\n  channelContext,\n});\n","import seedrandom from 'seedrandom';\nimport { entries } from './typescript';\n\ninterface Prng {\n  (): number;\n  state(): seedrandom.State;\n}\nlet generator: Prng;\nexport let dirty = false;\n\nexport const init = (seed: string): void => {\n  dirty = true;\n  generator = seedrandom(seed, { state: true });\n};\n\nexport function random(): number {\n  if (!generator) { throw new Error('Call init() before random()'); }\n  dirty = true;\n  return generator();\n}\n\n/**\n * Returns a random integer between min (inclusive) and max (inclusive).\n * The value is no lower than min (or the next integer greater than min\n * if min isn't an integer) and no greater than max (or the next integer\n * lower than max if max isn't an integer).\n */\nexport const randomInt = (min = 0, max = 10): number => {\n  min = Math.ceil(min);\n  max = Math.floor(max);\n  return Math.floor(random() * (max - min + 1)) + min;\n};\n\nexport const roll3D6 = (): number =>  {\n  return randomInt(1, 6) + randomInt(1, 6) + randomInt(1, 6);\n};\n\n/**\n * Returns a weighed random key of `probabilities`\n * Provide an object with keys T and probability as a number (fraction of 1)\n * @param probabilities object with probability as values\n * @returns one of the keys of `probabilities`\n */\nexport const weightedRoll = <T extends number | string>(probabilities: { [key in T]: number }): T => {\n  const roll = random();\n  let cumulative = 0;\n  const found = entries(probabilities).find(([_key, value]: [T, number] ) => {\n    cumulative += value;\n    if (roll < cumulative) {\n      return true;\n    }\n    return false;\n  });\n  if (!found) {\n    return entries(probabilities)[0][0];\n  }\n  return found[0];\n};\n\n// Test weightedRoll\n// const testWeighedRoll = () => {\n//   const test = {\n//     A: 0.2,\n//     B: 0.2,\n//     C: 0.6,\n//   };\n\n//   const result = {\n//     A: 0,\n//     B: 0,\n//     C: 0,\n//   };\n\n//   const testAmount = 100000;\n//   for (let i = 0; i < testAmount; i += 1) {\n//     result[weightedRoll(test)] += 1;\n//   }\n\n//   entries(result).forEach(([key, value]) => {\n//     console.lxg(`option: ${key} was chosen ${value / (testAmount / 100)}% (prob: ${(1 / (value / (testAmount / 100))).toFixed(3)}) of the time (abs: ${value})`);\n//   });\n// };\n\nexport const state = (): seedrandom.State => {\n  dirty = false;\n  return generator.state();\n};\n","import { WeaponType } from 'definitions/weaponTypes/types';\nimport {  ItemType, ItemDefinition, ItemCategory } from './types';\n\ntype Prefix = 'ammunition/';\nconst PREFIX = 'ammunition/';\nconst itemCategory = ItemCategory.ammunition;\nconst basePath = '/img/items/ammunition/';\n\nexport interface AmmunitionDefinition extends ItemDefinition {\n  weaponType: WeaponType;\n}\n\nconst ammunitions = {\n  armorPiercingArrows: {\n    itemCategory,\n    iconImg: `${basePath}armor-piercing-arrows.png`,\n    weaponType: WeaponType.bow,\n  },\n  basicArrows: {\n    itemCategory,\n    iconImg: `${basePath}basic-arrows.png`,\n    weaponType: WeaponType.bow,\n  },\n  crossbowBolts: {\n    itemCategory,\n    iconImg: `${basePath}crossbow-bolts.png`,\n    weaponType: WeaponType.crossbow,\n  },\n  elfenArrows: {\n    itemCategory,\n    iconImg: `${basePath}elfen-arrows.png`,\n    weaponType: WeaponType.bow,\n  },\n};\n\n\nexport type Ammunition = `${Prefix}${keyof typeof ammunitions}`;\nconst all = Object.entries(ammunitions).reduce<{ [key: string]: AmmunitionDefinition }>((acc, [key, value]) => {\n  acc[`${PREFIX}${key}`] = value;\n  return acc;\n}, {}) as Record<Ammunition, AmmunitionDefinition>;\nexport default all;\n\nexport function getDefinition(ammunition: Ammunition): AmmunitionDefinition {\n  return all[ammunition];\n}\n\nexport const isAmmunition = (item: ItemType): item is Ammunition => {\n  return !!all[item as Ammunition];\n};\n","import { WeaponAbility } from 'definitions/abilities/types';\nimport { WeaponClassification, WeaponType, WeaponTypeDefinition } from './types';\n\nexport const all: { [key in WeaponType]: WeaponTypeDefinition } = {\n  [WeaponType.axe]: {\n    classification: WeaponClassification.oneHanded,\n    abilities: [WeaponAbility.cut],\n  },\n  [WeaponType.bow]: {\n    classification: WeaponClassification.ranged,\n    abilities: [WeaponAbility.shoot],\n  },\n  [WeaponType.club]: {\n    classification: WeaponClassification.oneHanded,\n    abilities: [WeaponAbility.swing, WeaponAbility.parry],\n  },\n  [WeaponType.crossbow]: {\n    classification: WeaponClassification.ranged,\n    abilities: [/*WeaponAbility.aimedShot,*/ WeaponAbility.shoot],\n  },\n  [WeaponType.fist]: {\n    classification: WeaponClassification.oneHanded,\n    abilities: [WeaponAbility.swing],\n  },\n  [WeaponType.flail]: {\n    classification: WeaponClassification.mainHand,\n    abilities: [WeaponAbility.swing, WeaponAbility.parry],\n  },\n  [WeaponType.hammer]: {\n    classification: WeaponClassification.oneHanded,\n    abilities: [WeaponAbility.swing, WeaponAbility.parry],\n  },\n  [WeaponType.knife]: {\n    classification: WeaponClassification.oneHanded,\n    abilities: [WeaponAbility.cut, WeaponAbility.parry],\n  },\n  [WeaponType.staff]: {\n    classification: WeaponClassification.twoHanded,\n    abilities: [WeaponAbility.swing, WeaponAbility.parry],\n  },\n  [WeaponType.sword]: {\n    classification: WeaponClassification.oneHanded,\n    abilities: [WeaponAbility.swing, WeaponAbility.parry],\n  },\n  [WeaponType.poleArm]: {\n    classification: WeaponClassification.twoHanded,\n    abilities: [WeaponAbility.swing, WeaponAbility.parry],\n  },\n  [WeaponType.shield]: {\n    classification: WeaponClassification.shield,\n    abilities: [WeaponAbility.block],\n  },\n};\n\nexport const getDefinition = (weaponType: WeaponType): WeaponTypeDefinition => {\n  return all[weaponType];\n};\n","import { Structure } from '../structures';\nimport { ItemType, ItemDefinition, ItemCategory } from './types';\n\ntype Prefix = 'deed/';\nconst PREFIX = 'deed/';\nconst itemCategory = ItemCategory.deed;\nconst basePath = '/img/items/deeds/';\n\nexport interface DeedDefinition extends ItemDefinition {\n  structure: Structure;\n}\n\nconst deeds = {\n  alchemist: {\n    structure: 'alchemist' as const,\n    itemCategory,\n    iconImg: `${basePath}deed.png`,\n  },\n  armoursmith: {\n    structure: 'armoursmith' as const,\n    itemCategory,\n    iconImg: `${basePath}deed.png`,\n  },\n  lumbermill: {\n    structure: 'lumberMill' as const,\n    itemCategory,\n    iconImg: `${basePath}deed.png`,\n  },\n  tavern: {\n    structure: 'tavern' as const,\n    itemCategory,\n    iconImg: `${basePath}deed.png`,\n  },\n  weaponsmith: {\n    structure: 'weaponsmith' as const,\n    itemCategory,\n    iconImg: `${basePath}deed.png`,\n  },\n  workshop: {\n    structure: 'workshop' as const,\n    itemCategory,\n    iconImg: `${basePath}deed.png`,\n  },\n};\n\nexport type Deed = `${Prefix}${keyof typeof deeds}`;\nconst all = Object.entries(deeds).reduce<{ [key: string]: DeedDefinition }>((acc, [key, value]) => {\n  acc[`${PREFIX}${key}`] = value;\n  return acc;\n}, {}) as Record<Deed, DeedDefinition>;\nexport default all;\n\nexport function getDefinition(deed: Deed): DeedDefinition {\n  return all[deed] as unknown as DeedDefinition;\n}\n\nexport const isDeed = (item: ItemType): item is Deed => {\n  return !!all[item as Deed];\n};\n","// Calculates base hitpoints (hitpoints when at full health) given level and fort\nexport const calculateBaseHitpoints = (level: number, fortitude = 10) => {\n  return (20 * level) + (fortitude / 4) * 20;\n};\n","import { EquipmentSlotType } from 'components/ui/adventurer/EquipmentSlot';\nimport { WeaponType } from 'definitions/weaponTypes/types';\nimport { EnemyDefinition } from './types';\nconst avatarImgBasePath = '/img/avatars/monster/';\n\ntype TrollDefinition = {\n  [key: string]: EnemyDefinition\n};\nconst trolls: TrollDefinition = {\n  'troll-developer': {\n    attributes: {\n      str: 6,\n      for: 5,\n      int: 16,\n      agi: 8,\n    },\n    skills: {\n      [WeaponType.sword]: 12,\n    },\n    mainHand: { type: 'weapon/steelSword' },\n    armor: {\n      [EquipmentSlotType.feet]: 1,\n      [EquipmentSlotType.hands]: 1,\n      [EquipmentSlotType.chest]: 1,\n      [EquipmentSlotType.legs]: 1,\n      [EquipmentSlotType.head]: 1,\n      [EquipmentSlotType.shoulders]: 1,\n    },\n    spritesheet: 'troll-sword.json',\n    avatarImg: `${avatarImgBasePath}orc_01.png`,\n  },\n  'troll-manager': {\n    attributes: {\n      str: 8,\n      for: 7,\n      int: 12,\n      agi: 20,\n    },\n    skills: {\n      [WeaponType.axe]: 12,\n    },\n    mainHand: { type: 'weapon/battleAxe' },\n    armor: {\n\n    },\n    spritesheet: 'troll-axe.json',\n    avatarImg: `${avatarImgBasePath}orc_02.png`,\n  },\n  'troll-accountant': {\n    attributes: {\n      str: 8,\n      for: 7,\n      int: 12,\n      agi: 10,\n    },\n    skills: {\n      [WeaponType.axe]: 12,\n    },\n    mainHand: { type: 'weapon/battleAxe' },\n    armor: {\n      [EquipmentSlotType.feet]: 2,\n      [EquipmentSlotType.hands]: 3,\n      [EquipmentSlotType.chest]: 3,\n      [EquipmentSlotType.legs]: 2,\n      [EquipmentSlotType.head]: 2,\n      [EquipmentSlotType.shoulders]: 2,\n    },\n    spritesheet: 'troll-axe.json',\n    avatarImg: `${avatarImgBasePath}orc_03.png`,\n  },\n};\n\nexport default trolls;\nexport type Troll = `${keyof typeof trolls}`;\n\n","import { EnemyDefinition, EnemyType } from './types';\nimport trolls from './trolls';\n\nconst all = {\n  ...trolls,\n};\n\nexport default all;\nexport function getDefinition(enemy: EnemyType): EnemyDefinition {\n  return all[enemy] as unknown as EnemyDefinition;\n}\n","export type GoldAction = {\n  type: 'addGold',\n  amount: number\n};\n\nexport const addGold = (amount: number): GoldAction => ({\n  type: 'addGold',\n  amount,\n});\n\nexport const subtractGold = (amount: number): GoldAction => ({\n  type: 'addGold',\n  amount: -amount,\n});\n","import { ItemType, ItemDefinition, ItemCategory } from './types';\n\ntype Prefix = 'questItem/';\nconst PREFIX = 'questItem/';\nconst itemCategory = ItemCategory.questItem;\nconst basePath = '/img/items/quest-items/';\n\n\nconst questItems = {\n  blueprints: {\n    itemCategory,\n    iconImg: `${basePath}blueprints.png`,\n  },\n  crate: {\n    itemCategory,\n    iconImg: `${basePath}crate.png`,\n  },\n  dynamite: {\n    itemCategory,\n    iconImg: `${basePath}dynamite.png`,\n  },\n  dragonEye: {\n    itemCategory,\n    iconImg: `${basePath}dragon-eye.png`,\n  },\n  eye: {\n    itemCategory,\n    iconImg: `${basePath}eye.png`,\n  },\n  feather: {\n    itemCategory,\n    iconImg: `${basePath}feather.png`,\n  },\n  food: {\n    itemCategory,\n    iconImg: `${basePath}food.png`,\n  },\n  heart: {\n    itemCategory,\n    iconImg: `${basePath}heart.png`,\n  },\n  horn: {\n    itemCategory,\n    iconImg: `${basePath}horn.png`,\n  },\n  key: {\n    itemCategory,\n    iconImg: `${basePath}key.png`,\n  },\n  letters: {\n    itemCategory,\n    iconImg: `${basePath}letters.png`,\n  },\n  lockPicks: {\n    itemCategory,\n    iconImg: `${basePath}lock-picks.png`,\n  },\n  oil: {\n    itemCategory,\n    iconImg: `${basePath}oil.png`,\n  },\n  orcFinger: {\n    itemCategory,\n    iconImg: `${basePath}orc-finger.png`,\n  },\n  plans: {\n    itemCategory,\n    iconImg: `${basePath}plans.png`,\n  },\n  purpleGems: {\n    itemCategory,\n    iconImg: `${basePath}purple-gems.png`,\n  },\n  runestone: {\n    itemCategory,\n    iconImg: `${basePath}runestone.png`,\n  },\n  sandwich: {\n    itemCategory,\n    iconImg: `${basePath}sandwich.png`,\n  },\n  teeth: {\n    itemCategory,\n    iconImg: `${basePath}teeth.png`,\n  },\n  tooth: {\n    itemCategory,\n    iconImg: `${basePath}tooth.png`,\n  },\n  torch: {\n    itemCategory,\n    iconImg: `${basePath}torch.png`,\n  },\n  tusk: {\n    itemCategory,\n    iconImg: `${basePath}tusk.png`,\n  },\n  vase: {\n    itemCategory,\n    iconImg: `${basePath}vase.png`,\n  },\n  vial: {\n    itemCategory,\n    iconImg: `${basePath}vial.png`,\n  },\n  weeds: {\n    itemCategory,\n    iconImg: `${basePath}weeds.png`,\n  },\n};\n\n\nexport type QuestItem = `${Prefix}${keyof typeof questItems}`;\nconst all = Object.entries(questItems).reduce<{ [key: string]: ItemDefinition }>((acc, [key, value]) => {\n  acc[`${PREFIX}${key}`] = value;\n  return acc;\n}, {}) as Record<QuestItem, ItemDefinition>;\nexport default all;\n\nexport function getDefinition(questItem: QuestItem): ItemDefinition {\n  return all[questItem];\n}\n\nexport const isQuestItem = (item: ItemType): item is QuestItem => {\n  return !!all[item as QuestItem];\n};\n","export interface TextEntry {\n  key: string;\n  context?: unknown;\n}\n\nexport function isTextEntry(test: string | TextEntry): test is TextEntry {\n  return typeof test !== 'string';\n}\n","import { Location } from 'utils/tilemap';\n\n// This is the format AStarFind works with\nexport const convertIn = (l: Location) => ({ x: l[0], y: l[1] });\nexport const convertOut = (input: number[]): Location => [input[0], input[1]];\n","import { Store, AnyAction, DeepPartial } from 'redux';\nimport EventEmitter from 'events';\nimport TypedEmitter from 'typed-emitter';\nimport { Location } from 'utils/tilemap';\nimport { addAllTilesInLayerToList, locationEquals, TiledObjectType, parseProperties } from 'utils/tilemap';\nimport { StoreState } from 'store/types';\nimport { loadResourceAsync } from 'utils/pixiJs';\nimport { TiledLayerType, TiledMapData, TiledObjectData } from 'constants/tiledMapData';\nimport { AStarFinder } from 'astar-typescript';\nimport { AdventurerStoreState } from 'store/types/adventurer';\nimport { setScene, setSceneName, exitEncounter, enqueueSceneAction, updateQuestVars, deductActorAp, endPlayerTurn } from 'store/actions/quests';\nimport {\n  SceneObject,\n  ActorObject,\n  LootCache,\n  SceneActionType,\n  SceneAction,\n  isActorObject,\n  isAdventurer,\n  isEnemy,\n  Allegiance,\n  EnemyObject,\n  AdventurerObject,\n} from 'store/types/scene';\nimport { ToastManager } from 'global/ToastManager';\nimport { Type } from 'components/ui/toasts/Toast';\nimport { getQuestLink } from 'utils/routing';\nimport { TextEntry, isTextEntry } from 'constants/text';\nimport { TextManager } from 'global/TextManager';\nimport { addLogEntry } from 'store/actions/log';\nimport { getDefinition } from 'definitions/quests';\nimport { getDefinition as getEnemyDefinition } from 'definitions/enemies';\nimport { LogChannel } from 'store/types/logEntry';\nimport { addGold } from 'store/actions/gold';\nimport { addItemToInventory, removeItemFromInventory } from 'store/actions/adventurers';\nimport { adventurersOnQuest, getSceneObjectAtLocation, getSceneObjectWithName } from 'store/helpers/storeHelpers';\nimport { SoundManager } from 'global/SoundManager';\nimport { Item, ItemType } from 'definitions/items/types';\nimport { Loader, Point, utils } from 'pixi.js';\nimport { AP_COST_MOVE, AP_COST_SHOOT, calculateInitialAP } from 'mechanics/combat';\nimport { xpToLevel } from 'mechanics/adventurers/levels';\nimport { EnemyType } from 'definitions/enemies/types';\nimport { BubbleLayer, BubbleManager, BubbleType } from 'global/BubbleManager';\nimport { convertIn, convertOut } from 'utils/aStar';\nimport { ActionIntent, WeaponWithAbility } from 'components/world/QuestPanel/QuestDetails/scene/ui/SceneUI';\nimport { Ammunition } from 'definitions/items/ammunition';\nimport { calculateEffectiveAttributes } from 'mechanics/adventurers/attributes';\n\nconst actorSpritesheetBasePath = `${process.env.PUBLIC_URL}/img/scene/actors/`;\nconst effectSpritesheetBasePath = `${process.env.PUBLIC_URL}/img/scene/effects/`;\nexport const movementDuration = 500; // time every tile movement takes\n\nexport const EVENT_SCENE_EFFECT = 'eventSceneEffect';\ntype SceneEffectsEvents = {\n  [EVENT_SCENE_EFFECT]: (path: string, point: Point) => void;\n};\n\n/**\n * This is a type of God class that knows pretty much everything about a scene\n */\nexport class BaseSceneController<TQuestVars> extends (EventEmitter as unknown as new () => TypedEmitter<SceneEffectsEvents>) {\n\n  public questName: string;\n\n  public mapData?: TiledMapData;\n\n  public aStar?: AStarFinder;\n\n  public dataLoading = false;\n\n  public dataLoadComplete = false;\n\n  public store: Store<StoreState, AnyAction>;\n\n  protected jsonPath?: string;\n\n  protected blockedTiles: Location[] = [];\n\n  protected tileTypes: { [name: string]: number } = {}; // map tiletype to gid\n\n  constructor(store: Store<StoreState, AnyAction>, questName: string) {\n    super();\n    this.store = store;\n    this.questName = questName;\n  }\n\n  get basePath(): string | null {\n    return `${process.env.PUBLIC_URL}/scenes`;\n  }\n\n  // Loads tiles from json, loads all scene assets\n  async loadData(callback: () => void) {\n    if (this.dataLoadComplete) {\n      return callback();\n    }\n    if (!this.jsonPath) {\n      throw new Error('No jsonPath defined!');\n    }\n    this.dataLoading = true;\n\n    // Load map json\n    await loadResourceAsync(`${process.env.PUBLIC_URL}/${this.jsonPath}`);\n\n    // load sounds\n    const promises = [\n      SoundManager.addSound('scene/bow', ['sound/scene/bow-01.mp3', 'sound/scene/bow-02.mp3']),\n      SoundManager.addSound('scene/crossbow', ['sound/scene/crossbow-01.mp3', 'sound/scene/crossbow-02.mp3', 'sound/scene/crossbow-03.mp3', 'sound/scene/crossbow-04.mp3']),\n      SoundManager.addSound('scene/daggerSwish', ['sound/scene/dagger-swish.ogg']),\n      SoundManager.addSound('scene/meleeHit', ['sound/scene/melee-hit-01.mp3', 'sound/scene/melee-hit-02.mp3', 'sound/scene/melee-hit-03.mp3']),\n      SoundManager.addSound('scene/metalBash', ['sound/scene/metal-bash-01.mp3', 'sound/scene/metal-bash-02.mp3', 'sound/scene/metal-bash-03.mp3']),\n      SoundManager.addSound('scene/parry', ['sound/scene/parry-01.ogg', 'sound/scene/parry-02.ogg']),\n      SoundManager.addSound('scene/shieldBash', ['sound/scene/shield-bash-impact.mp3']),\n      SoundManager.addSound('scene/swish', ['sound/scene/swish-01.mp3', 'sound/scene/swish-02.mp3', 'sound/scene/swish-03.mp3', 'sound/scene/swish-04.mp3']),\n      SoundManager.addSound('scene/doorOpen', ['sound/scene/door.ogg']),\n    ];\n\n    await Promise.all(promises);\n\n    const resource = Loader.shared.resources[`${process.env.PUBLIC_URL}/${this.jsonPath}`];\n    if (!resource.data) {\n      throw new Error(`No map data found at ${process.env.PUBLIC_URL}/${this.jsonPath}`);\n    }\n    this.mapData = resource.data;\n\n    // Create aStar based on blocked tiles\n    this.createBlockedTiles();\n    this.createTileTypes();\n    this.aStar = this.createAStar();\n\n    for (const path of this.actorSpritesheetPaths) {\n      await loadResourceAsync(`${actorSpritesheetBasePath}${path}`);\n    }\n    for (const path of this.effectSpritesheetPaths) {\n      await loadResourceAsync(`${effectSpritesheetBasePath}${path}`);\n    }\n\n    utils.clearTextureCache();\n    this.dataLoadComplete = true;\n    this.dataLoading = false;\n    callback();\n  }\n\n  createBlockedTiles(objects?: SceneObject[]) {\n    this.blockedTiles = [];\n    this.mapData?.layers.filter(layer => layer.visible).forEach(layer => {\n      if (layer.properties && layer.properties.some(p => p.name === 'blocksMovement' && p.value === true)){\n        addAllTilesInLayerToList(this.blockedTiles, layer, layer.width);\n      }\n    });\n    objects?.forEach(o => {\n      if (o.properties.blocksMovement === true && o.location){\n        this.blockedTiles.push(o.location);\n      }\n    });\n  }\n\n  createTileTypes() {\n    this.mapData?.tilesets.forEach((tileset) => {\n      tileset.tiles?.forEach((tile) => {\n        this.tileTypes[tile.type] = tile.id + tileset.firstgid;\n      });\n    });\n  }\n\n  // Constructs the scene and dispatches it to be saved to the store\n  createScene() {\n    const objects = this.createObjects();\n    const combat = false;\n    this.updateScene(objects, combat);\n  }\n\n  updateScene(objects: SceneObject[] = this.sceneObjects, combat: boolean = this.combat) {\n    const scene = {\n      ...this.quest.scene,\n      objects,\n      combat,\n    };\n    this.dispatch(setScene(this.questName, scene));\n\n    this.createBlockedTiles(objects);\n\n    // Create aStar based on blocked tiles\n    if (this.mapData) {\n      this.aStar = this.createAStar();\n    }\n  }\n\n  sceneEntered() {\n    utils.clearTextureCache();\n    return;\n  }\n\n  sceneExited() {\n    return;\n  }\n\n  // Convenience function returns an object with tileWidth and tileHeight properties\n  getTileDimensions() {\n    return {\n      tileWidth: this.mapData?.tilewidth || 0,\n      tileHeight: this.mapData?.tileheight || 0,\n    };\n  }\n\n  actorMoved(actor: string, location: Location) {\n    const isNotAnActor = (object: SceneObject) => !isActorObject(object);\n\n    if (this.combat) {\n      // Take away AP for moving\n      this.dispatch(deductActorAp(this.questName, actor, AP_COST_MOVE));\n    }\n    const destination = this.getObjectAtLocation(location, isNotAnActor);\n    if (!destination) return;\n\n    if (destination.type === TiledObjectType.portal) {\n\n      // We've hit a portal\n      if (destination.properties.exit) {\n        // Exit the encounter\n        const index = Math.floor(this.quest.progress) + 1;\n        const definition = getDefinition(this.questName);\n        const node = definition.nodes[index];\n        if (node.log) {\n          // If the next node has a log entry, add it\n          this.log(node.log);\n        }\n        this.dispatch(exitEncounter(this.questName));\n      } else if (destination.properties.to) {\n        // Load another scene\n        this.dispatch(setSceneName(this.questName, destination.properties.to as string));\n      }\n    }\n  }\n\n  actorInteract(adventurerId: string, location: Location) {\n    const actor = this.getSceneAdventurer(adventurerId);\n    const object = this.getObjectAtLocation(location);\n\n    if (!object) {\n      console.warn('No object found');\n      return;\n    }\n    if (actor) {\n      this.interactWithObject(actor, object);\n    }\n  }\n\n  actorAttemptAction(intent: ActionIntent) {\n    // Tries to perform action on given actor\n    const { actor, action, to } = intent;\n    if (!actor) return;\n    const { location } = actor;\n    if (!location) throw new Error('No location found!');\n\n    switch (action) {\n      case SceneActionType.move: {\n        // Find path to move using aStar\n\n        this.dispatch(enqueueSceneAction(this.questName, {\n          endsAt: performance.now() + (intent.path?.length ?? 0 + 1) * movementDuration,\n          intent,\n        }));\n\n        if (!this.combat) {\n          // Follow behaviour. Other adventurers follow this adventurer\n          const otherAdventurers = this.sceneAdventurers.filter(a => a !== actor);\n          let availableLocations = this.findEmptyLocationsAround(to, 6);\n\n          otherAdventurers.forEach((otherAdventurer, index) => {\n            const health = this.getAdventurerByActor(otherAdventurer)?.health ?? 0;\n            if (!otherAdventurer.location || health <= 0) {\n              return;\n            }\n\n            const closestPath = this.findClosestPath(otherAdventurer.location, availableLocations);\n            if (closestPath && closestPath.length > 0) {\n              availableLocations = availableLocations.filter(l => !locationEquals(l, closestPath[closestPath?.length - 1]));\n              const otherIntent: ActionIntent = {\n                ...intent,\n                from: otherAdventurer.location,\n                to: closestPath[closestPath?.length - 1],\n                actor: otherAdventurer,\n                path: closestPath,\n              };\n\n              this.dispatch(enqueueSceneAction(this.questName, {\n                endsAt: performance.now() + (otherIntent.path?.length ?? 0 + 1) * movementDuration,\n                intent: otherIntent,\n                delay: (index + 1) / 2,\n              }));\n            }\n          });\n        }\n        break;\n      }\n      case SceneActionType.interact: {\n\n        // bump off the last location from the path\n        const path = (intent.path && intent.path?.length > 0 ) ? intent.path.slice(0, -1) : [];\n        const interactAction: SceneAction = {\n          endsAt: movementDuration * (intent.path?.length ?? 0) + performance.now(),\n          intent: {\n            ...intent,\n            path,\n          },\n        };\n        this.dispatch(enqueueSceneAction(this.questName, interactAction));\n        break;\n      }\n      case SceneActionType.melee: {\n        // // Find path to move towards the target\n        // const path = this.findPath(location, to);\n        // const target = path?.pop();\n        // if (!path || !target) {\n        //   // No path possible.. cant do anything now\n        //   return;\n        // }\n\n        // // Walk towards the target\n        // path?.forEach((l, index) => {\n        //   const moveAction: SceneAction = {\n        //     // actionType: SceneActionType.move,\n        //     // actor: getUniqueName(actor),\n        //     // target: l as Location,\n        //     endsAt: movementDuration * (index + 1) + performance.now(),\n        //     intent,\n        //   };\n        //   this.dispatch(enqueueSceneAction(this.questName, moveAction));\n        // });\n\n        // bump off the last location from the path\n        const path = (intent.path && intent.path?.length > 0 ) ? intent.path.slice(0, -1) : [];\n        const meleeAction: SceneAction = {\n\n          endsAt: movementDuration * (intent.path?.length ?? 0) + performance.now(),\n          intent: {\n            ...intent,\n            path,\n          },\n        };\n        this.dispatch(enqueueSceneAction(this.questName, meleeAction));\n        break;\n      }\n      case SceneActionType.shoot: {\n\n        const shootAction: SceneAction = {\n          endsAt: 500 + performance.now(),\n          intent,\n        };\n        this.dispatch(enqueueSceneAction(this.questName, shootAction));\n      }\n    }\n  }\n\n  findClosestPath(from: Location, locations: Location[]) {\n    return locations.reduce<Location[] | undefined>((acc, value) => {\n      const path = this.findPath(from, value);\n      if (acc === undefined || (path && path?.length < acc.length)) {\n        acc = path;\n      }\n      return acc;\n    }, undefined);\n  }\n\n  interactWithObject(_actor: AdventurerObject, _object: SceneObject) {\n    // override\n  }\n\n  // Converts pixel coordinate (where 0,0 is top left of the canvas) to scene location\n  pointToSceneLocation(point: Point): Location {\n    if (!this.mapData?.tilewidth || !this.mapData?.tileheight) {\n      return [0, 0];\n    }\n    return [Math.floor(point.x / this.mapData.tilewidth), Math.floor(point.y / this.mapData.tilewidth)];\n  }\n\n  // returns the pixel coordinate of the top left corner of the given location\n  public sceneLocationToPoint(location: Location): Point {\n    if (!this.mapData?.tilewidth || !this.mapData?.tileheight) {\n      return new Point();\n    }\n    return new Point(location[0] * this.mapData.tilewidth, location[1] * this.mapData.tileheight);\n  }\n\n  // Returns true if the tile is blocked\n  locationIsBlocked(location: Location){\n    return this.blockedTiles.some((l) => locationEquals(l, location));\n  }\n\n  // Returns true if outsie of the bounds of the map\n  locationIsOutOfBounds(location: Location) {\n    if (!this.mapData) return true;\n\n    return location[0] < 0 || location[1] < 0 ||\n      location[0] >= this.mapData.width ||\n      location[1] >= this.mapData.height;\n  }\n\n  // Should be overridden\n  getLootCache(_name: string): LootCache | undefined {\n    // Override this to retrieve LootCache from questvars\n    return;\n  }\n\n  takeGoldFromCache(name: string) {\n    // Override this to remove gold from questvars\n    const lootCache = this.getLootCache(name);\n    if (lootCache){\n      this.dispatch(addGold(lootCache.gold || 0));\n    }\n  }\n\n  takeItemFromCache(itemIndex: number, name: string, adventurerId: string, toSlot?: number) {\n    // Override this to remove items from questvars\n    const lootCache = this.getLootCache(name);\n    if (!lootCache) return;\n\n    const item = lootCache.items[itemIndex];\n    this.dispatch(addItemToInventory(adventurerId, item, toSlot));\n  }\n\n  discardItem(item: Item, adventurerId: string) {\n    const adventurer = this.getAdventurerById(adventurerId);\n    const itemIndex = adventurer?.inventory.indexOf(item);\n    if (itemIndex !== undefined) {\n      this.dispatch(removeItemFromInventory(adventurerId, itemIndex));\n    }\n  }\n\n  // Discards first item of type\n  discardItemType(itemType: ItemType, adventurerId: string) {\n    const adventurer = this.getAdventurerById(adventurerId);\n    const item = adventurer?.inventory.find(i => i?.type === itemType);\n    if (item) {\n      this.discardItem(item, adventurerId);\n    }\n  }\n\n  getSituation(_situation: string, _adventurerId?: string) : Situation | undefined {\n    return undefined;\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-empty-function\n  handleSituationOptionClick(_situation: string, _option: string, _adventurerId: string) {\n  }\n\n  /**\n   * Returns a path from two locations on the map\n   * @param origin\n   * @param target\n   */\n  findPath(origin: Location, target: Location) {\n    return this\n      .aStar?.findPath(convertIn(origin), convertIn(target))\n      .map(convertOut);\n  }\n\n  /**\n   * Finds a path from origin to a tile next to target (closest from origin)\n   * It doesn't matter if target is unpathable\n   * @param origin\n   * @param target\n   */\n  public findPathNearest(origin: Location, target: Location, includeLast = false) {\n    // todo; shortcut, if already neighbour, return early\n    const grid = this.aStar?.getGrid().getGridNodes();\n    if (!grid) return [];\n\n    const matrix = grid.map(r => r.map(c => (c.getIsWalkable() ? 0 : 1)));\n    matrix[target[1]][target[0]] = 0; // make target pathable\n    const tempAStar = new AStarFinder({\n      grid: {\n        matrix,\n      },\n      includeStartNode: false,\n      heuristic: 'Manhattan',\n      weight: 0.2,\n    });\n\n    return tempAStar.findPath(convertIn(origin), convertIn(target))\n      .map(convertOut)\n      .slice(0, includeLast ? undefined : -1);\n  }\n\n  /**\n   * Searches around @param origin to find empty, pathable locations\n   * @param origin location to search around\n   * @param amount of locations to find\n   */\n  public findEmptyLocationsAround(origin: Location, amount: number) {\n    const results: Location[] = [];\n    let radius = 1;\n\n    const getTop = (): Location[] => {\n      const y = -radius + origin[1];\n      const result = [];\n      for (let x = -radius + origin[0]; x <= radius + origin[0]; x++) {\n        result.push([x, y] as Location);\n      }\n      return result;\n    };\n    const getRight = () => {\n      const x = radius + origin[0];\n      const result = [];\n      for (let y = -radius + 1 + origin[1]; y <= radius - 1 + origin[1]; y++) {\n        result.push([x, y] as Location);\n      }\n      return result;\n    };\n    const getBottom = () => {\n      const y = radius + origin[1];\n      const result = [];\n      for (let x = -radius + origin[0]; x <= radius + origin[0]; x++) {\n        result.push([x, y] as Location);\n      }\n      return result;\n    };\n    const getLeft = () => {\n      const x = -radius + origin[0];\n      const result = [];\n      for (let y = -radius + 1 + origin[1]; y <= radius - 1 + origin[1]; y++) {\n        result.push([x, y] as Location);\n      }\n      return result;\n    };\n\n    const notOutside = (location: Location) => {\n      if (!this.mapData) return false;\n      return location[0] >= 0 && location[0] < this.mapData.width\n        && location[1] >= 1 && location[1] < this.mapData.height;\n    };\n\n    while (radius < (this.mapData?.width ?? 2)) {\n      // determine locations in square radius\n      const square: Location[] = [\n        ...getTop(),\n        ...getRight(),\n        ...getBottom(),\n        ...getLeft(),\n      ];\n      const filtered = square.filter(l => notOutside(l) && !this.locationIsBlocked(l));\n      results.push(...filtered.slice(0, amount - results.length));\n      if (results.length === amount) break;\n      radius++;\n    }\n    return results;\n  }\n\n  /**\n   * Calculates the AP costs to walk\n   */\n  calculateWalkApCosts(from: Location, to: Location) {\n    return this.findPath(from, to)?.length || 0;\n  }\n\n  /**\n   *\n   */\n  createActionIntent(action: SceneActionType, actor: ActorObject, location: Location, weaponWithAbility?: WeaponWithAbility, ammo?: Item<Ammunition>): ActionIntent | undefined {\n    const {\n      location: from = [0, 0],\n      ap: actorAP,\n    } = actor;\n    const to = location ?? [0, 0];\n    switch (action){\n      case SceneActionType.move:  {\n        const path = this.findPath(from, to);\n        const apCost = this.combat ? this.calculateWalkApCosts(from, to) : undefined;\n        const isValid = !!path?.length && (!this.combat || (apCost ?? 0) <= (actorAP ?? 0));\n\n        return ({\n          action,\n          from,\n          to,\n          apCost,\n          actor,\n          actorAP,\n          path,\n          isValid,\n        });\n      }\n\n      case SceneActionType.melee: {\n        const path = this.findPath(from, to);\n        if (!path) throw new Error('No path found');\n        // const lastStep = path?.length > 1 ? path[path.length - 2] : path[path.length - 1];\n        const apCost = this.calculateWalkApCosts(from, to);\n        // if (!path) throw new Error(\"No path found\");\n        // todo properly calculate AP\n        // const lastStep = path?.length > 1 ? path[path.length - 2] : path[path.length - 1];\n        // const apCost = this.calculateWalkApCosts(from, lastStep) + AP_COST_MELEE;\n        const enemy = this.getObjectAtLocation(location, isEnemy);\n        const isValid = !!enemy && (apCost ?? 0) <= (actorAP ?? 0);\n        if (!weaponWithAbility) return undefined;\n\n        return ({\n          action,\n          from,\n          to,\n          apCost,\n          actor,\n          actorAP,\n          path,\n          isValid,\n          weaponWithAbility,\n        });\n      }\n\n      case SceneActionType.interact: {\n        const path = this.findPathNearest(from, to, true);\n        const isValid = true;\n\n        return ({\n          action,\n          from,\n          to,\n          actor,\n          path,\n          isValid,\n        });\n      }\n      case SceneActionType.shoot: {\n        const apCost = AP_COST_SHOOT;\n        const enemy = this.getObjectAtLocation(location, isEnemy);\n        const isValid = !!enemy && (apCost ?? 0) <= (actorAP ?? 0);\n        if (!weaponWithAbility) return undefined;\n        if (!ammo) return undefined;\n\n        return ({\n          action,\n          from,\n          to,\n          apCost,\n          actor,\n          actorAP,\n          isValid,\n          weaponWithAbility,\n          ammo,\n        });\n      }\n    }\n  }\n\n  /**\n   * Forfeits all player ap\n   */\n  public endTurn() {\n    this.dispatch(endPlayerTurn(this.questName));\n  }\n\n  public getSceneActor(actorId: string): ActorObject | undefined {\n    return getSceneObjectWithName(this.sceneActors, actorId) as ActorObject;\n  }\n\n  public getSceneAdventurer(adventurerId: string): AdventurerObject | undefined {\n    return this.sceneActors.find((s) => isAdventurer(s) && s.adventurerId === adventurerId) as AdventurerObject;\n  }\n\n  /**\n   *\n   * @param location\n   * @param additionalFilter can specifiy an additional filter\n   * @returns\n   */\n  public getObjectAtLocation(location: Location, additionalFilter: (object: SceneObject) => boolean = () => true) {\n    return getSceneObjectAtLocation(this.quest.scene?.objects ?? [], location, additionalFilter);\n  }\n\n  protected createAStar() {\n    if (!this.mapData) return;\n    const matrix: number[][] = [];\n    if (this.mapData){\n      for (let y = 0; y < this.mapData.height; y++) {\n        const row: number[] = [];\n        for (let x = 0; x < this.mapData.width; x++) {\n          const location: Location = [x, y];\n          const blocked = this.locationIsBlocked(location);\n          row.push(blocked ? 1 : 0);\n        }\n        matrix.push(row);\n      }\n    }\n\n    return new AStarFinder({\n      grid: {\n        matrix,\n      },\n      includeStartNode: false,\n      heuristic: 'Manhattan',\n      weight: 0.2,\n    });\n  }\n\n  // Create SceneObject from this.mapData\n  protected createObjects(): SceneObject[] {\n    if (!this.mapData) {\n      throw new Error('No mapData');\n    }\n\n    const objectLayers = this.mapData.layers.filter(layer => layer.type === TiledLayerType.objectgroup);\n    const objects: SceneObject[] = [];\n    objectLayers.forEach(objectLayer => {\n      objectLayer.objects.reduce((acc:  SceneObject[], value: TiledObjectData) => {\n\n        // reduce the props array into an object with key/values\n        const properties = parseProperties(value.properties);\n        const location: Location = [\n          value.x / (this.mapData?.tilewidth || 1),\n          (value.y - (value.gid ? value.height : 0)) / (this.mapData?.tileheight || 1),\n        ];\n\n        const object: SceneObject | null = {\n          ...value,\n          layerId: objectLayer.id,\n          properties,\n          location,\n        };\n\n        if (object.type === TiledObjectType.portal) {\n          if ((!object.properties.to && !this.quest.sceneNamePrev) || object.properties.to === this.quest.sceneNamePrev) {\n            // todo: instead store location in var and spawn adventurers at the end\n            const adventurers = this.getAdventurers();\n            const { width, height, layerId } = object;\n            const locations = [\n              location,\n              ...this.findEmptyLocationsAround(location, adventurers.length - 1),\n            ];\n\n            adventurers.forEach((adventurer, i) => {\n              if (!object) throw new Error();\n              if (adventurer.health <= 0) {\n                return;\n              }\n\n              const x = Math.round(object.x);\n              const y = Math.round(object.y);\n              const level = xpToLevel(adventurer.xp);\n              const adventurerObject: AdventurerObject = {\n                id: 0,\n                adventurerId: adventurer.id,\n                x,\n                y,\n                location: locations[i],\n                width,\n                height,\n                layerId,\n                visible: true,\n                type: TiledObjectType.actor,\n                ap: calculateInitialAP(adventurer.basicAttributes, level),\n                allegiance: Allegiance.player,\n                properties: {\n                  adventurerId: adventurer.id,\n                  isSprite: true,\n                  spritesheet: adventurer.spritesheetPath,\n                },\n              };\n              acc.push(adventurerObject);\n            });\n          }\n        } else if (object.type === TiledObjectType.enemySpawn) {\n          object.type = TiledObjectType.actor;\n          if (isActorObject(object)) { // typeguard, is always true but we need to tell typescript it's an actor\n            object.allegiance = Allegiance.enemy;\n          }\n          if (isEnemy(object)) { // typeguard, is always true but we need to tell typescript it's an actor\n            const definition = getEnemyDefinition(object.properties.enemyType as EnemyType);\n            const level = object.properties.level as number ?? 1;\n            object.enemyId = `${object.properties.enemyType}_${Math.random().toString(36).substring(7)}`;\n            object.enemyType = object.properties.enemyType as string;\n            object.health = Math.random() * 20; // todo\n            object.ap = calculateInitialAP(definition.attributes, level);\n            object.name = object.properties.name as string;\n            object.level = level;\n            object.allegiance = Allegiance.enemy;\n            object.properties.isSprite = true;\n            object.properties.spritesheet = definition.spritesheet;\n          }\n        }\n\n        if (object) {\n          acc.push(object);\n        }\n        return acc;\n      }, objects);\n    });\n    return objects;\n  }\n\n  // Scene\n  protected get combat() {\n    return !!this.quest.scene?.combat;\n  }\n\n  public get sceneObjects(): SceneObject[]  {\n    return this.quest.scene?.objects || [];\n  }\n\n  public get sceneActors(): ActorObject[] {\n    return this.sceneObjects.filter<ActorObject>(isActorObject);\n  }\n\n  public get sceneAdventurers(): AdventurerObject[] {\n    return this.sceneObjects.filter<ActorObject>(isAdventurer) as AdventurerObject[];\n  }\n\n  public get sceneEnemies(): ActorObject[] {\n    return this.sceneObjects.filter<ActorObject>(isEnemy);\n  }\n\n  // Quest\n  public get quest() {\n    const storeState = this.store.getState();\n    const quest = storeState.quests.find(q => q.name === this.questName);\n    if (!quest) throw new Error('No quest :(');\n    return quest;\n  }\n\n  protected get questVars(): TQuestVars {\n    return this.quest.questVars as unknown as TQuestVars;\n  }\n\n  protected get actorSpritesheetPaths(): string[] {\n    const adventurers = this.getAdventurers();\n    return [\n      ...adventurers.map(a => a.spritesheetPath),\n      'troll-sword.json',   // todo: only load enemy sprites that are actually needed\n      'troll-axe.json',      // todo: only load enemy sprites that are actually needed\n    ];\n  }\n\n  protected get effectSpritesheetPaths(): string[] {\n    return [\n      'blood_1/blood_1.json',\n      'blood_2/blood_2.json',\n    ];\n  }\n\n  public get settings() {\n    return this.store.getState().settings;\n  }\n\n  // Provide questvars to update\n  protected updateQuestVars(updated: DeepPartial<TQuestVars>) {\n    this.dispatch(updateQuestVars(this.questName, updated));\n  }\n\n  public getAdventurers(): AdventurerStoreState[] {\n    const storeState = this.store.getState();\n    return adventurersOnQuest(storeState.adventurers, this.quest);\n  }\n\n  public getAdventurerByActor(actor: AdventurerObject) {\n    const storeState = this.store.getState();\n    return storeState.adventurers.find(a => a.id === actor.adventurerId);\n  }\n\n  public getEnemyByActor(actor: EnemyObject) {\n    return getEnemyDefinition(actor.enemyType);\n  }\n\n  protected getAdventurerById(id: string) {\n    const storeState = this.store.getState();\n    return storeState.adventurers.find(a => a.id === id);\n  }\n\n  public getActorSkills(actor: ActorObject) {\n    if (isAdventurer(actor)) {\n      const adventurer = this.getAdventurerByActor(actor);\n      if (!adventurer) throw new Error('No adventurer found');\n      return adventurer.skills;\n    }\n    const enemy = this.getEnemyByActor(actor);\n    return enemy.skills;\n  }\n\n  public getActorAttributes(actor: ActorObject) {\n    if (isAdventurer(actor)) {\n      const adventurer = this.getAdventurerByActor(actor);\n      if (!adventurer) throw new Error('No adventurer found');\n      return calculateEffectiveAttributes(adventurer);\n    }\n    const enemy = this.getEnemyByActor(actor);\n    return enemy.attributes;\n  }\n\n  protected questUpdate(input: string | TextEntry, icon?: string, toast = false): void {\n    const textEntry: TextEntry = isTextEntry(input) ? input : { key: input };\n    const title = TextManager.getTextEntry(textEntry);\n    if (toast) {\n      ToastManager.addToast(title, Type.questUpdate, icon, getQuestLink(this.questName));\n    }\n    this.log(textEntry);\n  }\n\n  public log(input: string | TextEntry): void {\n    const textEntry: TextEntry = isTextEntry(input) ? input : { key: input };\n    this.dispatch(addLogEntry(textEntry, LogChannel.quest, this.questName));\n  }\n\n  public bubbleAtLocation(text: string, location: Location, bubbleType?: BubbleType) {\n    const point = this.sceneLocationToPoint(location);\n    point.set(point.x + (this.mapData?.tilewidth ?? 2) / 2, point.y);\n    BubbleManager.addBubble(text, point, bubbleType, BubbleLayer.scene);\n  }\n\n  // Store\n  protected dispatch(action: AnyAction) {\n    this.store.dispatch(action);\n  }\n\n\n  public effectAtLocation(effectPath: string, location: Location) {\n    const point = this.sceneLocationToPoint(location);\n    // point.set(point.x, point.y);\n    this.emit(EVENT_SCENE_EFFECT, `${effectSpritesheetBasePath}${effectPath}`, point);\n  }\n}\n\nexport interface Situation {\n  title: string;\n  choices?: string[];\n  text?: string;\n}\n","import { Store, AnyAction } from 'redux';\nimport { StoreState } from 'store/types';\nimport { BaseSceneController } from 'mechanics/scenes/BaseSceneController';\n\nexport abstract class SceneControllerManager {\n  static store: { [key: string]: BaseSceneController<unknown> } = {};\n\n  static controllerTypes: { [key: string]: typeof BaseSceneController } = {};\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  static registerSceneController(questName: string, sceneName: string, controllerType: any) {\n    this.controllerTypes[`${questName}.${sceneName}`] = controllerType;\n  }\n\n  /**\n   * Gets the scenecontroller for scene. Creates it if it doesnt exist\n   */\n  static getSceneController(questName: string, sceneName: string, store: Store<StoreState, AnyAction>): BaseSceneController<unknown> {\n    if (!this.store[`${questName}.${sceneName}`]) {\n      if (!this.controllerTypes[`${questName}.${sceneName}`]) {\n        throw new Error(`No controller registered for ${questName}.${sceneName}`);\n      }\n      this.store[`${questName}.${sceneName}`] = new this.controllerTypes[`${questName}.${sceneName}`](store, questName);\n    }\n    return this.store[`${questName}.${sceneName}`];\n  }\n\n  static destroySceneConroller(questName: string, sceneName: string ) {\n    delete this.store[`${questName}.${sceneName}`];\n  }\n}\n\nrequire('definitions/quests/kill10Boars/encounters/dungeon');\n","import { Effect, EffectType } from 'definitions/effects/types';\nimport { Attribute, attributeList } from 'store/types/adventurer';\nimport { TempEffect, TempEffectType } from './types';\n\nexport type EffectDefinition = {\n  harmful: boolean;\n};\n\nexport const getEffects = <T extends TempEffect> (tempEffect: Omit<T, 'effects'>): Effect[] => {\n  const t = tempEffect as T;\n  switch (t.type) {\n    case TempEffectType.brokenLegs: {\n      return [{\n        type: EffectType.healthDecreaseOnMove,\n        damage: t.damage,\n      }];\n    }\n    case TempEffectType.burning: {\n      return [{\n        type: EffectType.healthDecreaseOverTime,\n        interval: t.interval,\n        damage: t.damage,\n      }];\n    }\n    case TempEffectType.soma: {\n      return attributeList.map((attribute: Attribute) => ({\n        type: EffectType.attributeIncrease,\n        attribute,\n        factor: t.factor,\n      }));\n    }\n    default:\n      return [];\n  }\n};\n\n// given all props of TempEffect of\nexport const createTempEffect = <T extends TempEffect> (tempEffect: Omit<T, 'effects'>) => {\n  return {\n    ...tempEffect,\n    effects: getEffects(tempEffect),\n  };\n};\n\n// const all = {\n//   [EffectType.attributeIncrease]: {\n//     harmful: false\n//   },\n//   [EffectType.brokenLegs]: {\n//     harmful: true\n//   },\n//   [EffectType.burning]: {\n//     harmful: true\n//   },\n//   [EffectType.soma]: {\n//     harmful: false\n//   }\n// };\n\n// export default all;\n// export function getDefinition(effectType: EffectType): EffectDefinition {\n//   return all[effectType] as unknown as EffectDefinition;\n// }\n","import { ItemType, ItemDefinition, ItemCategory } from './types';\n\ntype Prefix = 'herb/';\nconst PREFIX = 'herb/';\nconst itemCategory = ItemCategory.herb;\nconst basePath = '/img/items/herbs/';\n\nconst herbs = {\n  angelicasSorrow: {\n    itemCategory,\n    iconImg: `${basePath}angelicas-sorrow.png`,\n  },\n  bansheeReeds: {\n    itemCategory,\n    iconImg: `${basePath}banshee-reeds.png`,\n  },\n  blissflower: {\n    itemCategory,\n    iconImg: `${basePath}blissflower.png`,\n  },\n  bloodLotus: {\n    itemCategory,\n    iconImg: `${basePath}blood-lotus.png`,\n  },\n  bogroot: {\n    itemCategory,\n    iconImg: `${basePath}bogroot.png`,\n  },\n  ceviorise: {\n    itemCategory,\n    iconImg: `${basePath}ceviorise.png`,\n  },\n  chicory: {\n    itemCategory,\n    iconImg: `${basePath}chicory.png`,\n  },\n  dragonroot: {\n    itemCategory,\n    iconImg: `${basePath}dragonroot.png`,\n  },\n  heartsVine: {\n    itemCategory,\n    iconImg: `${basePath}hearts-vine.png`,\n  },\n  hyacinthus: {\n    itemCategory,\n    iconImg: `${basePath}hyacinthus.png`,\n  },\n  jaboticaba: {\n    itemCategory,\n    iconImg: `${basePath}jaboticaba.png`,\n  },\n  kingsrose: {\n    itemCategory,\n    iconImg: `${basePath}kingsrose.png`,\n  },\n  lastSupper: {\n    itemCategory,\n    iconImg: `${basePath}last-supper.png`,\n  },\n  mistagold: {\n    itemCategory,\n    iconImg: `${basePath}mistagold.png`,\n  },\n  monksweed: {\n    itemCategory,\n    iconImg: `${basePath}monksweed.png`,\n  },\n  moonFlower: {\n    itemCategory,\n    iconImg: `${basePath}moon-flower.png`,\n  },\n  mountainGrass: {\n    itemCategory,\n    iconImg: `${basePath}mountain-grass.png`,\n  },\n  oakLeaf: {\n    itemCategory,\n    iconImg: `${basePath}oak-leaf.png`,\n  },\n  patricksroot: {\n    itemCategory,\n    iconImg: `${basePath}patricksroot.png`,\n  },\n  sunleaf: {\n    itemCategory,\n    iconImg: `${basePath}sunleaf.png`,\n  },\n  trollsFeast: {\n    itemCategory,\n    iconImg: `${basePath}trolls-feast.png`,\n  },\n  uwolic: {\n    itemCategory,\n    iconImg: `${basePath}uwolic.png`,\n  },\n  wyrmvine: {\n    itemCategory,\n    iconImg: `${basePath}wyrmvine.png`,\n  },\n  winterWeed: {\n    itemCategory,\n    iconImg: `${basePath}winter-weed.png`,\n  },\n  wizardsBane: {\n    itemCategory,\n    iconImg: `${basePath}wizards-bane.png`,\n  },\n};\n\nexport type Herb = `${Prefix}${keyof typeof herbs}`;\nconst all = Object.entries(herbs).reduce<{ [key: string]: ItemDefinition }>((acc, [key, value]) => {\n  acc[`${PREFIX}${key}`] = value;\n  return acc;\n}, {}) as Record<Herb, ItemDefinition>;\nexport default all;\n\nexport function getDefinition(herb: Herb): ItemDefinition {\n  return all[herb];\n}\n\nexport const isHerb = (item: ItemType): item is Herb => {\n  return !!all[item as Herb];\n};\n","import { ItemType, ItemDefinition, ItemCategory } from './types';\n\ntype Prefix = 'material/';\nconst PREFIX = 'material/';\nconst itemCategory = ItemCategory.material;\nconst basePath = '/img/items/materials/';\n\n\nconst materials = {\n  arrowheads: {\n    itemCategory,\n    iconImg: `${basePath}arrowheads.png`,\n  },\n  beam: {\n    itemCategory,\n    iconImg: `${basePath}beam.png`,\n  },\n  bolts: {\n    itemCategory,\n    iconImg: `${basePath}bolts.png`,\n  },\n  buckle: {\n    itemCategory,\n    iconImg: `${basePath}buckle.png`,\n  },\n  chain: {\n    itemCategory,\n    iconImg: `${basePath}chain.png`,\n  },\n  cogs: {\n    itemCategory,\n    iconImg: `${basePath}cogs.png`,\n  },\n  gunpowder: {\n    itemCategory,\n    iconImg: `${basePath}gunpowder.png`,\n  },\n  ingot: {\n    itemCategory,\n    iconImg: `${basePath}ingot.png`,\n  },\n  nails: {\n    itemCategory,\n    iconImg: `${basePath}nails.png`,\n  },\n  pile: {\n    itemCategory,\n    iconImg: `${basePath}pile.png`,\n  },\n  planks: {\n    itemCategory,\n    iconImg: `${basePath}planks.png`,\n  },\n  poisonVial: {\n    itemCategory,\n    iconImg: `${basePath}poison-vial.png`,\n  },\n  pulley: {\n    itemCategory,\n    iconImg: `${basePath}pulley.png`,\n  },\n  ribbon: {\n    itemCategory,\n    iconImg: `${basePath}ribbon.png`,\n  },\n  rope: {\n    itemCategory,\n    iconImg: `${basePath}rope.png`,\n  },\n  runeCarvedPlank: {\n    itemCategory,\n    iconImg: `${basePath}rune-carved-plank.png`,\n  },\n  scales: {\n    itemCategory,\n    iconImg: `${basePath}scales.png`,\n  },\n  spring: {\n    itemCategory,\n    iconImg: `${basePath}spring.png`,\n  },\n  stake: {\n    itemCategory,\n    iconImg: `${basePath}stake.png`,\n  },\n  stick: {\n    itemCategory,\n    iconImg: `${basePath}stick.png`,\n  },\n  thread: {\n    itemCategory,\n    iconImg: `${basePath}thread.png`,\n  },\n  woodenMask: {\n    itemCategory,\n    iconImg: `${basePath}wooden-mask.png`,\n  },\n};\n\n\nexport type Material = `${Prefix}${keyof typeof materials}`;\nconst all = Object.entries(materials).reduce<{ [key: string]: ItemDefinition }>((acc, [key, value]) => {\n  acc[`${PREFIX}${key}`] = value;\n  return acc;\n}, {}) as Record<Material, ItemDefinition>;\nexport default all;\n\nexport function getDefinition(material: Material): ItemDefinition {\n  return all[material];\n}\n\nexport const isMaterial = (item: ItemType): item is Material => {\n  return !!all[item as Material];\n};\n","import { ItemType, ItemDefinition, ItemCategory } from './types';\n\ntype Prefix = 'mineral/';\nconst PREFIX = 'mineral/';\nconst itemCategory = ItemCategory.mineral;\nconst basePath = '/img/items/minerals/';\n\n// Minerals can be used to imbue magical powers to weapons and armor\nconst minerals = {\n  amethyst: {\n    itemCategory,\n    iconImg: `${basePath}amethyst.png`,\n  },\n  aquamarine: {\n    itemCategory,\n    iconImg: `${basePath}aquamarine.png`,\n  },\n  arminsHeart: {\n    itemCategory,\n    iconImg: `${basePath}armins-heart.png`,\n  },\n  dragonsTooth: {\n    itemCategory,\n    iconImg: `${basePath}dragons-tooth.png`,\n  },\n  greenOpal: {\n    itemCategory,\n    iconImg: `${basePath}green-opal.png`,\n  },\n  jasper: {\n    itemCategory,\n    iconImg: `${basePath}jasper.png`,\n  },\n  malachite: {\n    itemCategory,\n    iconImg: `${basePath}malachite.png`,\n  },\n  moonstone: {\n    itemCategory,\n    iconImg: `${basePath}moonstone.png`,\n  },\n  obsidian: {\n    itemCategory,\n    iconImg: `${basePath}obsidian.png`,\n  },\n  roseQuartz: {\n    itemCategory,\n    iconImg: `${basePath}rose-quartz.png`,\n  },\n  sapphire: {\n    itemCategory,\n    iconImg: `${basePath}sapphire.png`,\n  },\n  spellstone: {\n    itemCategory,\n    iconImg: `${basePath}spellstone.png`,\n  },\n  tigersEye: {\n    itemCategory,\n    iconImg: `${basePath}tigers-eye.png`,\n  },\n  topaz: {\n    itemCategory,\n    iconImg: `${basePath}topaz.png`,\n  },\n  wyrdstone: {\n    itemCategory,\n    iconImg: `${basePath}wyrdstone.png`,\n  },\n};\n\n\nexport type Mineral = `${Prefix}${keyof typeof minerals}`;\nconst all = Object.entries(minerals).reduce<{ [key: string]: ItemDefinition }>((acc, [key, value]) => {\n  acc[`${PREFIX}${key}`] = value;\n  return acc;\n}, {}) as Record<Mineral, ItemDefinition>;\nexport default all;\n\nexport function getDefinition(mineral: Mineral): ItemDefinition {\n  return all[mineral];\n}\n\nexport const isMineral = (item: ItemType): item is Mineral => {\n  return !!all[item as Mineral];\n};\n","import {  ItemType, ItemDefinition, ItemCategory } from './types';\n\ntype Prefix = 'trinket/';\nconst PREFIX = 'trinket/';\nconst itemCategory = ItemCategory.trinket;\nconst basePath = '/img/items/trinkets/';\n\nconst trinkets = {\n  magicAmulet: {\n    itemCategory,\n    iconImg: `${basePath}magic_amulet.png`,\n  },\n  ring: {\n    itemCategory,\n    iconImg: `${basePath}ring.png`,\n  },\n};\n\n\nexport type Trinket = `${Prefix}${keyof typeof trinkets}`;\nconst all = Object.entries(trinkets).reduce<{ [key: string]: ItemDefinition }>((acc, [key, value]) => {\n  acc[`${PREFIX}${key}`] = value;\n  return acc;\n}, {}) as Record<Trinket, ItemDefinition>;\nexport default all;\n\nexport function getDefinition(trinket: Trinket): ItemDefinition {\n  return all[trinket];\n}\n\nexport const isTrinket = (item: ItemType): item is Trinket => {\n  return !!all[item as Trinket];\n};\n","import { AdventurerAction } from 'store/actions/adventurers';\nimport { EquipmentSlotType } from 'components/ui/adventurer/EquipmentSlot';\nimport { Reducer } from 'redux';\nimport { AdventurerColor, AdventurerStoreState, AttributesStoreState } from 'store/types/adventurer';\nimport { Trait } from 'definitions/traits/types';\nimport { levelToXp, MAX_XP, xpToLevel } from 'mechanics/adventurers/levels';\nimport { Action } from 'store/actions';\nimport { getDefinition, isConsumable } from 'definitions/items/consumables';\nimport { Item } from 'definitions/items/types';\nimport { Effect } from 'definitions/effects/types';\nimport { calculateBaseHitpoints } from 'mechanics/adventurers/hitpoints';\nimport { TempEffectBrokenLegs, TempEffectBurning, TempEffectType } from 'definitions/tempEffects/types';\nimport { createTempEffect } from 'definitions/tempEffects';\nimport { WeaponType } from 'definitions/weaponTypes/types';\n\n\nconst generateRandomAttributes = (): AttributesStoreState => {\n  return {\n    str: Math.floor(Math.random() * 3) + 9,\n    for: Math.floor(Math.random() * 3) + 9,\n    int: Math.floor(Math.random() * 3) + 9,\n    agi: Math.floor(Math.random() * 3) + 9,\n  };\n};\nconst generateAttributesHealthAndXp = (level = 1) => {\n  const basicAttributes = generateRandomAttributes();\n  const xp = levelToXp(level) + (Math.random() * levelToXp(level + 1));\n  const health = 20 + Math.random() * (calculateBaseHitpoints(level, basicAttributes.for) - 20);\n  return {\n    basicAttributes,\n    xp,\n    health,\n  };\n};\nconst avatarImgBasePath = '/img/avatars/';\nexport const ADVENTURER_PREFIX = 'adv_';\n\n// Create a bunch of guys for debugging\nexport const initialAdventurers: AdventurerStoreState[] = [{\n  id: `${ADVENTURER_PREFIX}c4a5d270`,\n  equipment: {\n    [EquipmentSlotType.head]: { type: 'apparel/cowl', durability: 0.25 },\n    [EquipmentSlotType.chest]: { type: 'apparel/chest', durability: 0.5 },\n    [EquipmentSlotType.hands]: { type: 'apparel/clothGloves' },\n    [EquipmentSlotType.shoulders]: { type: 'apparel/shoulders2' },\n    [EquipmentSlotType.legs]: { type: 'apparel/pants2' },\n    [EquipmentSlotType.feet]: { type: 'apparel/boots3' },\n    [EquipmentSlotType.mainHand]: { type: 'weapon/longbow' },\n    [EquipmentSlotType.offHand]: { type: 'ammunition/basicArrows', quantity: 200 },\n    // offHand: Item.indomitableCarapace\n  },\n  ...generateAttributesHealthAndXp(),\n  room: 0,\n  name: 'Sasha Falcon',\n  flavor: true,\n  traits: [Trait.houseMaddox, Trait.gloomy],\n  avatarImg: `${avatarImgBasePath}female/f_14.png`,\n  spritesheetPath: 'elf-bow.json',\n  color: AdventurerColor.purple,\n  skills: {\n    [WeaponType.crossbow]: 10,\n    [WeaponType.bow]: 10,\n  },\n  tempEffects: [],\n  inventory: [ { type: 'deed/lumbermill' }, null, { type: 'weapon/simpleCrossbow' }, { type: 'weapon/dagger' }, { type: 'weapon/khopesh' }, null, { type: 'weapon/steelSword' }, null,  { type: 'consumable/lesserSoma' }, { type: 'consumable/minorSoma' }, { type: 'consumable/greaterManaPotion' },  { type: 'consumable/majorHealthPotion' },  null,  { type: 'weapon/steelShield' },  null,  null,  null,  null],\n}, {\n  id: `${ADVENTURER_PREFIX}2e655832`,\n  equipment: {\n    [EquipmentSlotType.feet]: { type: 'apparel/boots2' },\n    [EquipmentSlotType.mainHand]: { type: 'weapon/simpleCrossbow' },\n    [EquipmentSlotType.offHand]: { type: 'ammunition/crossbowBolts', quantity: 150 },\n  },\n  ...generateAttributesHealthAndXp(),\n  name: 'Addison Chilson',\n  flavor: true,\n\n  room: 1,\n  avatarImg: `${avatarImgBasePath}female/f_16.png`,\n  spritesheetPath: 'elf-bow.json',\n  color: AdventurerColor.teal,\n  traits: [Trait.houseHouston],\n  skills: {\n    [WeaponType.crossbow]: 12,\n    [WeaponType.staff]: 13,\n  },\n  tempEffects: [],\n  inventory: [ { type: 'weapon/simpleCrossbow' }, null, { type: 'consumable/greaterSoma' }, null, null, null, { type: 'apparel/boots1' }, { type: 'apparel/chainmailHood' }, { type: 'apparel/nomadHelmet' }, { type: 'apparel/plateChest4' }, null, { type: 'weapon/buckler' }, null, null, null,  null,  null,  null,  null,  null,  null,  null,  null, { type: 'apparel/plateHelmet' }, { type: 'apparel/cowl' }],\n}, {\n  id: `${ADVENTURER_PREFIX}ec6f1050`,\n  equipment: {\n    [EquipmentSlotType.feet]: { type: 'apparel/boots3' },\n    [EquipmentSlotType.mainHand]: { type: 'weapon/greatswordOfGwai' },\n    // offHand: Item.aegisOfValor\n  },\n  ...generateAttributesHealthAndXp(),\n  name: \"Zackary 'bone bag' Morris\",\n  flavor: true,\n\n  room: 2,\n  traits: [Trait.gloomy],\n  skills: {\n    [WeaponType.sword]: 12,\n    [WeaponType.hammer]: 6,\n  },\n  avatarImg: `${avatarImgBasePath}male/m_36.png`,\n  spritesheetPath: 'skeleton.json',\n  color: AdventurerColor.black,\n  tempEffects: [\n    createTempEffect<TempEffectBrokenLegs>({\n      type: TempEffectType.brokenLegs,\n      damage: 10,\n      charges: 10,\n    }),\n    createTempEffect<TempEffectBurning>({\n      type: TempEffectType.burning,\n      damage: 10,\n      interval: 500,\n    }),\n  ],\n  // tempEffects: [{\n  //   type: EffectType.healthDecreaseOnMove,\n  //   lastTick: Date.now(),\n  //   damage: 10,\n  //   charges: 10\n  // }, {\n  //   type: EffectType.healthDecreaseOverTime,\n  //   lastTick: Date.now(),\n  //   damage: 4,\n  //   interval: 5000\n  // }],\n  inventory: [{ type: 'weapon/greatswordOfGwai' }, { type: 'consumable/greaterSoma' }, { type: 'consumable/greaterSoma' }, null, null, null, { type: 'weapon/berserkerShield' }, { type: 'weapon/warhammer' }],\n}, {\n  id: `${ADVENTURER_PREFIX}d299f98a`,\n  ...generateAttributesHealthAndXp(),\n  equipment: {\n    [EquipmentSlotType.mainHand]: { type: 'weapon/steelSword' },\n  },\n  name: 'Mike Keith',\n  flavor: true,\n\n  room: 4,\n  avatarImg: `${avatarImgBasePath}male/m_19.png`,\n  spritesheetPath: 'knight-sword.json',\n  traits: [Trait.arrowFinder],\n  skills: {\n    [WeaponType.sword]: 13,\n  },\n  tempEffects: [],\n  inventory: [ null, null, null, null, { type: 'weapon/khopesh' }, { type: 'apparel/hornedHelmet' }, { type: 'weapon/woodenBulwark' } ],\n}, {\n  id: '96c686c3',\n  equipment: {},\n  ...generateAttributesHealthAndXp(),\n  name: 'Wayne Monroe',\n  flavor: true,\n\n  room: 5,\n  avatarImg: `${avatarImgBasePath}male/m_08.png`,\n  spritesheetPath: 'orc-axe.json',\n  traits: [Trait.houseMonroe, Trait.arrowFinder],\n  skills: {\n    [WeaponType.axe]: 12,\n  },\n  tempEffects: [],\n  inventory: [ null, null, null, { type: 'weapon/goldenShield' }],\n}, {\n  id: `${ADVENTURER_PREFIX}250d1a9d`,\n  ...generateAttributesHealthAndXp(),\n  name: 'Alexis Ortiz ',\n  flavor: true,\n\n  room: 9,\n  avatarImg: `${avatarImgBasePath}female/f_10.png`,\n  spritesheetPath: 'knight-sword.json',\n  inventory: [ null, null, null, null, null ],\n  skills: {\n    [WeaponType.axe]: 10,\n  },\n  equipment: {\n    [EquipmentSlotType.mainHand]: { type: 'weapon/longbow' },\n    [EquipmentSlotType.offHand]: { type: 'ammunition/basicArrows', quantity: 50 },\n  },\n  tempEffects: [],\n}, {\n  id: `${ADVENTURER_PREFIX}169384ef`,\n  ...generateAttributesHealthAndXp(),\n  name: 'Karlee Nolan',\n  flavor: true,\n\n  room: 3,\n  avatarImg: `${avatarImgBasePath}female/f_16.png`,\n  spritesheetPath: 'troll-sword.json',\n  inventory: [ { type: 'weapon/greatswordOfGwai' }, null, null, null ],\n  skills: {\n    [WeaponType.axe]: 10,\n  },\n  equipment: {\n    [EquipmentSlotType.mainHand]: { type: 'weapon/simpleCrossbow' },\n    [EquipmentSlotType.offHand]: { type: 'ammunition/crossbowBolts', quantity: 40 },\n  },\n  tempEffects: [],\n}, {\n  id: `${ADVENTURER_PREFIX}f22d66cb`,\n  ...generateAttributesHealthAndXp(),\n  equipment: {},\n  name: 'Gylbarde the Earnest',\n\n  room: 8,\n  avatarImg: `${avatarImgBasePath}male/m_09.png`,\n  spritesheetPath: 'knight-sword.json',\n  inventory: [ null, null, null, null, null ],\n  skills: {\n    [WeaponType.axe]: 13,\n  },\n  tempEffects: [],\n}, {\n  id: `${ADVENTURER_PREFIX}36c686c1`,\n  equipment: {},\n  ...generateAttributesHealthAndXp(),\n  name: 'Lanslet of the Water',\n\n  room: 6,\n  avatarImg: `${avatarImgBasePath}male/m_26.png`,\n  spritesheetPath: 'knight-sword.json',\n  inventory: [ { type: 'weapon/greatswordOfGwai' }, null, null, null, { type: 'apparel/shoulders1' }, { type: 'apparel/fedora' }, { type: 'apparel/greaves2' }],\n  skills: {\n    [WeaponType.axe]: 3,\n  },\n  tempEffects: [],\n}, {\n  id: `${ADVENTURER_PREFIX}12c613d4`,\n  equipment: {},\n  ...generateAttributesHealthAndXp(),\n  name: 'Tedric the Bold',\n\n  room: 7,\n  avatarImg: `${avatarImgBasePath}male/m_33.png`,\n  spritesheetPath: 'knight-sword.json',\n  inventory: [ { type: 'weapon/greatswordOfGwai' }, null, null, null ],\n  skills: {\n    [WeaponType.axe]: 10,\n  },\n  tempEffects: [\n    createTempEffect<TempEffectBrokenLegs>({\n      type: TempEffectType.brokenLegs,\n      damage: 8,\n      charges: 10,\n    }),\n  ],\n}, {\n  id: `${ADVENTURER_PREFIX}5a402ef1`,\n  equipment: {\n    [EquipmentSlotType.head]: { type: 'apparel/crimsonRogueCoif', durability: 0.25 },\n    [EquipmentSlotType.chest]: { type: 'apparel/crimsonRogueTunic', durability: 0.5 },\n    [EquipmentSlotType.hands]: { type: 'apparel/crimsonRogueGrips' },\n    [EquipmentSlotType.shoulders]: { type: 'apparel/crimsonRogueSpaulders' },\n    [EquipmentSlotType.legs]: { type: 'apparel/crimsonRogueBritches' },\n    [EquipmentSlotType.feet]: { type: 'apparel/crimsonRogueBoots' },\n    [EquipmentSlotType.mainHand]: { type: 'weapon/dagger' },\n    [EquipmentSlotType.offHand]: { type: 'weapon/dagger' },\n  },\n  ...generateAttributesHealthAndXp(),\n  room: 11,\n  name: 'Allynna Nerilar',\n  flavor: true,\n  traits: [Trait.houseMaddox, Trait.gloomy],\n  avatarImg: `${avatarImgBasePath}female/f_21.png`,\n  spritesheetPath: 'elf-bow.json',\n  color: AdventurerColor.purple,\n  skills: {\n    [WeaponType.knife]: 15,\n    [WeaponType.bow]: 11,\n  },\n  tempEffects: [],\n  inventory: [ { type: 'deed/lumbermill' }, null, { type: 'weapon/simpleCrossbow' }, { type: 'weapon/dagger' }, { type: 'weapon/khopesh' }, null, { type: 'weapon/steelSword' }, null,  { type: 'consumable/lesserSoma' }, { type: 'consumable/minorSoma' }, { type: 'consumable/greaterManaPotion' },  { type: 'consumable/majorHealthPotion' },  null,  { type: 'weapon/steelShield' },  null,  null,  null,  null],\n}];\n\n// To generate a random 11 digit number, use: Math.random().toString(36).substring(2)\n\n// eslint-disable-next-line @typescript-eslint/default-param-last\nexport const adventurers: Reducer<AdventurerStoreState[], AdventurerAction> = (state: AdventurerStoreState[] = initialAdventurers, action: Action) => {\n\n  switch (action.type) {\n    // Changes adventurers health\n    case 'modifyHealth': {\n      return state.map((adventurer: AdventurerStoreState) => {\n        if (adventurer.id === action.adventurerId) {\n          const health = adventurer.health += action.amount;\n          return {\n            ...adventurer,\n            health,\n          };\n        }\n        return adventurer;\n      });\n    }\n\n    // Moves an item from one inventory slot to another\n    case 'consumeItem': {\n      const { adventurerId, fromSlot } = action;\n      const adventurer = state.find((a) => a.id === adventurerId);\n      if (!adventurer) {\n        throw new Error(`No adventurer ${adventurerId} found`);\n      }\n      let { health } = adventurer;\n      const consumable = adventurer.inventory[fromSlot];\n      if (!consumable || !isConsumable(consumable.type)) {\n        throw new Error(`No potion found at index ${fromSlot} `);\n      }\n      const definition = getDefinition(consumable.type);\n      // todo: 2021-09-02 Drink potions\n      switch (definition.category) {\n        case 'health':\n          health = Math.min((definition.effect ?? 0) + health, 100);\n          break;\n        case 'soma':\n          // handled by effects middleware\n          console.log(`${adventurer.name} drinks a soma potion`);\n          break;\n        case 'mana':\n          console.log(`${adventurer.name} drinks a mana potion`);\n          break;\n      }\n\n      // take item from the inventory\n      const inventory = adventurer.inventory.map((element, index) => index !== fromSlot ? element : null);\n      return state.map((element: AdventurerStoreState) => {\n        if (element === adventurer) {\n          return {\n            ...element,\n            health,\n            inventory,\n          };\n        }\n        return element;\n      });\n    }\n\n    // Moves an item from one inventory slot to another\n    case 'moveItemInInventory': {\n      const { adventurerId, fromSlot, toSlot } = action;\n      const adventurer = state.find((a) => a.id === adventurerId);\n      if (!adventurer) {\n        throw new Error(`No adventurer ${adventurerId} found`);\n      }\n      const inventory = adventurer.inventory.map((element, index) => {\n        if (index === fromSlot) { return adventurer.inventory[toSlot]; }\n        if (index === toSlot) { return adventurer.inventory[fromSlot]; }\n        return element;\n      });\n\n      return state.map((element: AdventurerStoreState) => {\n        if (element === adventurer) {\n          return {\n            ...element,\n            inventory,\n          };\n        }\n        return element;\n      });\n    }\n\n    case 'moveItemToOtherAdventurer': {\n      // Moves an item from one adventurer to another\n      const { adventurerId: fromAdventurerId, fromSlot, toAdventurerId } = action;\n      const fromAdventurer = state.find((a) => a.id === fromAdventurerId);\n      if (!fromAdventurer) return state;\n      const item = fromAdventurer.inventory[fromSlot];\n\n      return state.map((element: AdventurerStoreState) => {\n        if (element.id === fromAdventurerId) {\n          // Clear out the item from this adventurer\n          const inventory = element.inventory.concat();\n          inventory[fromSlot] = null;\n          return {\n            ...element,\n            inventory,\n          };\n        } else if (element.id === toAdventurerId) {\n          // Find first empty slot, add there\n          const inventory = element.inventory.concat();\n          const index = inventory.findIndex((slot) => slot === null);\n          inventory[index] = item;\n          // todo: what if there is no room?\n          return {\n            ...element,\n            inventory,\n          };\n        }\n        return element;\n      });\n    }\n\n    case 'addItemToInventory': {\n      const { item } = action;\n      let { toSlot } = action;\n\n      return state.map((element: AdventurerStoreState) => {\n        if (element.id === action.adventurerId) {\n          const inventory = element.inventory.concat();\n          if (toSlot === null || toSlot === undefined) {\n            toSlot = inventory.findIndex((val) => (val === null || val === undefined));\n          }\n          inventory[toSlot] = item;\n          // todo: check if no space\n          return {\n            ...element,\n            inventory,\n          };\n        }\n        return element;\n      });\n    }\n\n    case 'removeItemFromInventory': {\n      const { fromSlot } = action;\n\n      return state.map((adventurer: AdventurerStoreState) => {\n        if (adventurer.id === action.adventurerId) {\n          const inventory = adventurer.inventory.map((element, index) => index !== fromSlot ? element : null);\n          return {\n            ...adventurer,\n            inventory,\n          };\n        }\n        return adventurer;\n      });\n    }\n\n\n    case 'changeItemQuantity': {\n      // Change quantity of an item in invntory\n      const { slot, quantity } = action;\n\n      return state.map((adventurer: AdventurerStoreState) => {\n        if (adventurer.id === action.adventurerId) {\n          const inventory = adventurer.inventory.map((item, index) => index !== slot ? item : ({\n            ...item,\n            quantity,\n          }) as Item);\n          return {\n            ...adventurer,\n            inventory,\n          };\n        }\n        return adventurer;\n      });\n    }\n\n    case 'assignEquipment': {\n      // Assigns equipment to an adventurer\n      const { equipmentSlot, item } = action;\n      return state.map((adventurer: AdventurerStoreState) => {\n        if (adventurer.id === action.adventurerId) {\n          return {\n            ...adventurer,\n            equipment: {\n              ...adventurer.equipment,\n              [equipmentSlot]: item,\n            },\n          };\n        }\n        return adventurer;\n      });\n    }\n\n    case 'removeEquipment': {\n      // Assigns equipment to an adventurer\n      const { equipmentSlot } = action;\n\n      return state.map((adventurer: AdventurerStoreState) => {\n        if (adventurer.id === action.adventurerId) {\n          return {\n            ...adventurer,\n            equipment: {\n              ...adventurer.equipment,\n              [equipmentSlot]: null,\n            },\n          };\n        }\n        return adventurer;\n      });\n    }\n\n    case 'changeEquipmentQuantity': {\n      // Change quantity of an item equipped\n      const { equipmentSlot, quantity } = action;\n\n      return state.map((adventurer: AdventurerStoreState) => {\n        if (adventurer.id === action.adventurerId) {\n          return {\n            ...adventurer,\n            equipment: {\n              ...adventurer.equipment,\n              [equipmentSlot]: {\n                ...adventurer.equipment[equipmentSlot],\n                quantity,\n              },\n            },\n          };\n        }\n        return adventurer;\n      });\n    }\n\n    case 'addTempEffect': {\n      // adds an effect\n      return state.map((adventurer: AdventurerStoreState) => {\n        if (adventurer.id === action.adventurerId) {\n          return {\n            ...adventurer,\n            tempEffects: [\n              action.tempEffect,\n              ...adventurer.tempEffects,\n            ],\n          };\n        }\n        return adventurer;\n      });\n    }\n\n    case 'decreaseEffectCharge': {\n      // decreases charges of given effect by 1\n      return state.map((adventurer: AdventurerStoreState) => {\n        if (adventurer.id === action.adventurerId) {\n          return {\n            ...adventurer,\n            tempEffects: adventurer.tempEffects.map((tE) => ({\n              ...tE,\n              effects: tE.effects.reduce<Effect[]>((acc, value) => {\n                if (value === action.effect) {\n                  // if charges is < 2 remove from list\n                  if (value.charges && value.charges > 1) {\n                    const charges = value.charges - 1;\n                    acc.push({\n                      ...value,\n                      charges,\n                    });\n                  }\n                } else {\n                  acc.push(value);\n                }\n                return acc;\n              }, []),\n            })),\n          };\n        }\n        return adventurer;\n      });\n    }\n\n    case 'renameAdventurer': {\n      // Rename adventurer\n      const { name } = action;\n      return state.map((adventurer: AdventurerStoreState) => {\n        if (adventurer.id === action.adventurerId) {\n          return {\n            ...adventurer,\n            name,\n          };\n        }\n        return adventurer;\n      });\n    }\n\n    case 'setBasicAttributes': {\n      // Used for debugging only, update BA of an adventurer\n      const { basicAttributes } = action;\n      return state.map((adventurer: AdventurerStoreState) => {\n        if (adventurer.id === action.adventurerId) {\n          return {\n            ...adventurer,\n            basicAttributes,\n          };\n        }\n        return adventurer;\n      });\n    }\n\n    case 'addXp': {\n      // Adds xp\n      return state.map((adventurer: AdventurerStoreState) => {\n        if (adventurer.id === action.adventurerId) {\n          const oldLevel = xpToLevel(adventurer.xp);\n          const xp = Math.min(adventurer.xp + action.xp, MAX_XP);\n          const newLevel = xpToLevel(xp);\n          let health = adventurer.health;\n          if (newLevel > oldLevel) {\n            // When achieving a new level, immediately get full health\n            health = calculateBaseHitpoints(newLevel, adventurer.basicAttributes.for);\n          }\n          return {\n            ...adventurer,\n            xp,\n            health,\n          };\n        }\n        return adventurer;\n      });\n    }\n\n  }\n  return state;\n  // debug: this will auto-increase the levels of every adventurer at every tick\n  // return state.map((adventurer: AdventurerStoreState) => {\n  //   return {\n  //     ...adventurer,\n  //     xp: adventurer.xp + 1\n  //   };\n  // });\n};\n","export const lerp = (n1: number,  n2: number,  alpha: number): number => {\n  return n1 + alpha * (n2 - n1);\n};\n\nexport const clamp = (val: number, min: number, max: number): number => {\n  return val > max ? max : val < min ? min : val;\n};\n","export interface TiledMapData {\n  width: number;\n  height: number;\n  tilewidth: number;\n  tileheight: number;\n  infinite: boolean;\n  backgroundcolor: string | null;\n  orientation: Orientation;\n  renderorder: RenderOrder;\n  tilesets: TiledTilesetData[];\n  layers: TiledLayerData[];\n}\n\nexport interface TiledTilesetData {\n  columns: number;\n  firstgid: number;\n  source: string;\n  image: string;\n  imagewidth: number;\n  imageheight: number;\n  tilewidth: number;\n  tileheight: number;\n  tilecount: number;\n  name: string;\n  margin: number; // todo:\n  spacing: number; // todo\n  tiles?: TileData[];\n}\n\nexport interface TileData {\n  id: number,\n  image: string;\n  type: string;\n  properties?: TiledProperty[];\n}\n\nexport interface TiledLayerData {\n  data: number[];\n  objects: TiledObjectData[];\n  type: TiledLayerType;\n  height: number;\n  id: number;\n  name: string;\n  opacity: number; // not supported atm\n  visible: boolean;\n  x: number;\n  y: number;\n  width: number;\n  properties?: TiledProperty[];\n}\n\nexport interface TiledObjectData {\n  gid?: number;\n  id: number | string;\n  name?: string;\n  properties?: TiledProperty[];\n  polygon?: { x: number, y: number }[];\n  type: string;\n  visible: boolean;\n  width: number;\n  height: number;\n  x: number;\n  y: number;\n}\n\nexport enum TiledLayerType {\n  tilelayer = 'tilelayer',\n  objectgroup = 'objectgroup',\n}\n\nexport interface TiledProperty {\n  name: string,\n  type: string,\n  value: string | number | boolean;\n}\n\nenum Orientation {\n  orthagonal = 'orthagonal',\n  isometric = 'isometric',\n  staggered = 'staggered',\n  hexagonal = 'hexagonal',\n}\n\nenum RenderOrder {\n  rightUp = 'right-up',\n  rightDown = 'right-down',\n  leftUp = 'left-up',\n  leftDown = 'left-down',\n}\n","import { LootCache } from 'store/types/scene';\n\nexport interface Kill10BoarsQuestVars {\n  dungeon: {\n    entered: boolean,\n    entrance: {\n      chestOpen: boolean,\n      chest: LootCache,\n    }\n    hallway: {\n      doorOpen: boolean,\n      chestOpen: boolean,\n      chest: LootCache,\n    }\n    // situations: {\n    //   altar: {\n    //     candleLit: boolean\n    //   },\n    // }\n  }\n}\n\nexport const initialQuestVars: Kill10BoarsQuestVars = {\n  dungeon: {\n    entered: false,\n    entrance: {\n      chestOpen: false,\n      chest: {\n        title: 'encounter-dungeon-caches-chest',\n        items: [\n          { type: 'apparel/nomadHelmet' },\n          { type: 'questItem/teeth' },\n          { type: 'material/poisonVial' },\n          { type: 'apparel/fedora' },\n        ],\n        gold: 100,\n      },\n      // altar: {\n      //   title: \"quest-kill10-boars-dungeonentrance-altar\",\n      //   items: [\n      //     Item.bolts,\n      //     Item.letters\n      //   ]\n      // },\n    },\n    hallway: {\n      chest: {\n        title: 'encounter-dungeon-caches-chest',\n        items: [ { type: 'questItem/key' }],\n      },\n      chestOpen: false,\n      doorOpen: false,\n    },\n  },\n};\n","import { getWeaponOrApparelDefinition } from 'definitions/items';\nimport { isAmmunition } from 'definitions/items/ammunition';\nimport { AdventurerStoreState } from 'store/types/adventurer';\nimport { entries } from 'utils/typescript';\nimport { EffectSource, EffectSourceType, EffectType, EffectWithSource } from './types';\n\nexport type EffectDefinition = {\n  harmful: boolean;\n};\n\nconst all = {\n  [EffectType.attributeIncrease]: {\n    harmful: false,\n  },\n  [EffectType.healthDecreaseOnMove]: {\n    harmful: true,\n  },\n  [EffectType.healthDecreaseOverTime]: {\n    harmful: true,\n  },\n};\n\nexport default all;\nexport const getDefinition = (effectType: EffectType): EffectDefinition  => {\n  return all[effectType] as unknown as EffectDefinition;\n};\n\n\n// returns all effects on an adventurer (temp effects, equipment etc)\nexport const collectEffects = (adventurer: AdventurerStoreState, filterType?: EffectType): EffectWithSource[] => {\n  const result: EffectWithSource[] = [];\n\n  // Add effects from temp effects\n  adventurer.tempEffects.forEach(tempEffect => {\n    tempEffect.effects.forEach(e => {\n      if (filterType === undefined || filterType === e.type) {\n        const source: EffectSource = {\n          type: EffectSourceType.tempEffect,\n          tempEffectType: tempEffect.type,\n        };\n\n        result.push({\n          ...e,\n          source,\n        });\n      }\n    });\n  });\n\n  // Add effects from equipment\n  entries(adventurer.equipment).forEach((entry) => {\n    if (!entry) return;\n    const [, item] = entry;\n    if (!item || isAmmunition(item.type)) return;\n\n    const def = getWeaponOrApparelDefinition(item.type);\n    def.effects?.forEach(e => {\n      if (filterType === undefined || filterType === e.type) {\n        const source: EffectSource = {\n          type: EffectSourceType.item,\n          itemType: item.type,\n        };\n\n        result.push({\n          ...e,\n          source,\n        });\n      }\n    });\n  });\n\n  return result;\n};\n","import { BaseSceneController } from 'mechanics/scenes/BaseSceneController';\nimport { SceneControllerManager } from 'global/SceneControllerManager';\nimport { SceneObject, LootCache, AdventurerObject } from 'store/types/scene';\nimport { setActiveSceneInteractionModal } from 'store/actions/quests';\nimport { Kill10BoarsQuestVars } from '../questVars';\nimport { Channel, GameSound, MixMode, SoundManager } from 'global/SoundManager';\nimport { Item } from 'definitions/items/types';\n\nconst TILE_DOOR_UPPER_CLOSED = 121 + 131;\nconst TILE_DOOR_LOWER_CLOSED = 121 + 143;\nconst TILE_DOOR_UPPER_OPEN = 121 + 107;\nconst TILE_DOOR_LOWER_OPEN = 121 + 119;\n\nabstract class DungeonEncounterSceneController extends BaseSceneController<Kill10BoarsQuestVars>  {\n\n  // getLootCache(name: string): LootCache | undefined {\n  //   return this.questVars.dungeon.lootCaches[name];\n  // }\n\n  // takeGoldFromCache(name: string) {\n  //   super.takeGoldFromCache(name);  // first add gold to inventory\n  //   const lootCache = this.getLootCache(name);\n  //   if (lootCache){\n  //     const questVars = this.questVars;\n  //     questVars.dungeon.lootCaches[name].gold = 0;\n  //     this.store.dispatch(updateQuestVars(this.questName, questVars));\n  //   }\n  // }\n\n  // takeItemFromCache(itemIndex: number, name: string, adventurer: AdventurerStoreState, toSlot?: number) {\n  //   super.takeItemFromCache(itemIndex, name, adventurer, toSlot);\n  //   const lootCache = this.getLootCache(name);\n  //   if (lootCache){\n  //     const questVars = this.questVars;\n  //     const items = questVars.dungeon.lootCaches[name].items.filter((_: any, index: number) => index !== itemIndex);\n  //     questVars.dungeon.lootCaches[name].items = items;\n  //     this.store.dispatch(updateQuestVars(this.questName, questVars));\n  //   }\n  // }\n}\n\nexport class DungeonCanyonSceneController extends DungeonEncounterSceneController {\n  jsonPath = 'scenes/dungeon/canyon-64.json';\n}\nexport class DungeonEntranceSceneController extends DungeonEncounterSceneController {\n  previousMusic?: GameSound;\n\n  jsonPath = 'scenes/dungeon/dungeon-entrance-64.json';\n\n\n  getLootCache(_: string): LootCache | undefined {\n    return this.questVars.dungeon.entrance.chest;\n  }\n\n  takeGoldFromCache(name: 'chest') {\n    super.takeGoldFromCache(name);  // first add gold to inventory\n    this.updateQuestVars({\n      dungeon: { entrance: { chest: { gold: 0 } } },\n    });\n  }\n\n  takeItemFromCache(itemIndex: number, name: string, adventurerId: string, toSlot?: number) {\n    super.takeItemFromCache(itemIndex, name, adventurerId, toSlot);\n    const lootCache = this.getLootCache(name);\n    if (lootCache){\n      const items = lootCache.items.filter((_:Item, index: number) => index !== itemIndex);\n      this.updateQuestVars({\n        dungeon: { entrance: { chest: { items } } },\n      });\n    }\n  }\n\n  updateScene(objects: SceneObject[] = this.sceneObjects, combat: boolean = this.combat) {\n    objects = objects.map(o => {\n      switch (o.name) {\n        case 'chest': {\n          return {\n            ...o,\n            gid: this.questVars.dungeon.entrance.chestOpen ? this.tileTypes['chest.open'] : this.tileTypes['chest.closed'],\n          };\n        }\n      }\n      return o;\n    });\n    super.updateScene(objects, combat);\n  }\n\n  interactWithObject(actor: AdventurerObject, object: SceneObject) {\n    switch (object.name) {\n      // todo: I want to share this common stuff with other SceneControllers\n      case 'chest':\n        if (!this.questVars.dungeon.entrance.chestOpen) {\n          const textEntry = { key: 'quest-common-adventurer-opened-chest', context: { adventurer: object } };\n          this.questUpdate(textEntry, '/img/items/misc/chest-02.png');\n\n          this.updateQuestVars({\n            dungeon: { entrance: { chestOpen: true } },\n          });\n        }\n        // display loot modal\n        this.store.dispatch(setActiveSceneInteractionModal(this.questName, {\n          type: 'lootCache',\n          lootCache: object.name,\n        }));\n        break;\n\n      case 'altar':\n        this.store.dispatch(setActiveSceneInteractionModal(this.questName, {\n          type: 'situation',\n          situation: 'altar',\n        }));\n        break;\n    }\n    super.interactWithObject(actor, object);\n  }\n\n  sceneEntered() {\n    if (!this.questVars.dungeon.entered) {\n      // this.questUpdate(\"quest-kill10-boars-enter-dungeon-see-chest\");\n    }\n    this.previousMusic = SoundManager.getCurrentlyPlaying(Channel.music);\n\n    if (this.combat){\n      SoundManager.addSound('music/combat', 'sound/music/TribalHut.ogg', () => {\n        SoundManager.playSound('music/combat', Channel.music, true, MixMode.fade, true);\n      });\n    } else {\n      SoundManager.addSound('music/violettesElficSong', ['sound/music/ViolettesElficSongForLamentandHope.ogg'], () => {\n        SoundManager.playSound('music/violettesElficSong', Channel.music, true, MixMode.fade, true);\n      });\n    }\n\n\n    super.sceneEntered();\n  }\n\n  sceneExited() {\n    if (this.previousMusic) {\n      SoundManager.playSound(this.previousMusic, Channel.music, true, MixMode.fade, true);\n    }\n\n    super.sceneExited();\n  }\n\n  getSituation(situation: string, adventurerId?: string) {\n    switch (situation) {\n      // case 'altar':\n      //   const questVars = this.questVars;\n      //   if (questVars.dungeon.situations.altar.candleLit) {\n      //     return {\n      //       title: 'quest-kill10-boars-dungeonentrance-altar',\n      //       choices: [\n      //         \"quest-kill10-boars-dungeonentrance-altar-rummagedrawers\"\n      //       ]\n      //     }f\n      //   }\n      //   return {\n      //     title: 'quest-kill10-boars-dungeonentrance-altar',\n      //     choices: [\n      //       \"quest-kill10-boars-dungeonentrance-altar-lightcandle\",\n      //       \"quest-kill10-boars-dungeonentrance-altar-rummagedrawers\"\n      //     ]\n      //   }\n      default:\n        return super.getSituation(situation, adventurerId);\n    }\n  }\n\n  handleSituationOptionClick(_situation: string, _option: string, _adventurerId: string) {\n    // switch (situation) {\n    // case 'altar': {\n    //   switch (option) {\n    //     case 'quest-kill10-boars-dungeonentrance-altar-lightcandle':\n    //       const questVars = this.questVars;\n    //       questVars.dungeon.situations.altar.candleLit = true;\n    //       this.store.dispatch(updateQuestVars(this.questName, questVars));\n    //       break;\n\n    //     case 'quest-kill10-boars-dungeonentrance-altar-rummagedrawers':\n    //       // display loot modal!\n    //       this.store.dispatch(setActiveSceneInteractionModal(this.questName, {\n    //         type: 'lootCache',\n    //         lootCache: 'altar'\n    //       }));\n    //       break;\n    //   }\n    // }\n    // }\n  }\n}\n\nexport class DungeonHallwaySceneController extends DungeonEncounterSceneController {\n  // jsonPath = \"scenes/ork-dungeon-level2.json\";\n  jsonPath = 'scenes/dungeon/dungeon-entry-64.json';\n\n  getLootCache(_: string): LootCache | undefined {\n    return this.questVars.dungeon.hallway.chest;\n  }\n\n  sceneEntered() {\n    console.log('ENTERED THE HALLWAy');\n    super.sceneEntered();\n  }\n\n  interactWithObject(actor: AdventurerObject, object: SceneObject) {\n    switch (object.name) {\n      // todo: I want to share this common stuff with other SceneControllers\n      case 'chest':\n        if (!this.questVars.dungeon.hallway.chestOpen) {\n          const adventurer = this.getAdventurerByActor(actor)?.name;\n          const textEntry = { key: 'quest-common-adventurer-opened-chest', context: { adventurer } };\n          this.questUpdate(textEntry, '/img/items/misc/chest-02.png');\n\n          this.updateQuestVars({\n            dungeon: { hallway: { chestOpen: true } },\n          });\n        }\n        // display loot modal\n        this.store.dispatch(setActiveSceneInteractionModal(this.questName, {\n          type: 'lootCache',\n          lootCache: object.name,\n        }));\n        break;\n      case 'door1':\n        if (!this.questVars.dungeon.hallway.doorOpen) {\n          this.store.dispatch(setActiveSceneInteractionModal(this.questName, {\n            type: 'situation',\n            situation: 'door',\n          }));\n        }\n        break;\n      case 'latrine':\n        this.questUpdate('quest-kill10-boars-dungeonentrance-latrine');\n        break;\n    }\n    super.interactWithObject(actor, object);\n  }\n\n  getSituation(situation: string, adventurerId?: string) {\n    switch (situation) {\n      case 'door': {\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        const adventurer = this.getAdventurerById(adventurerId!);\n        if (adventurer && adventurer.inventory.some(i => i?.type === 'questItem/key')) {\n          // Adventurer has key\n          return {\n            title: 'quest-kill10-boars-dungeonentrance-door',\n            choices: [\n              'quest-common-scenerio-door-open',\n            ],\n          };\n        }\n        return {\n          title: 'quest-kill10-boars-dungeonentrance-door',\n          text: 'quest-kill10-boars-dungeonentrance-door-needs-key',\n        };\n      }\n      default:\n        return super.getSituation(situation, adventurerId);\n    }\n  }\n\n\n  handleSituationOptionClick(situation: string, option: string, adventurerId: string) {\n    switch (situation) {\n      case 'door': {\n        // Only one option, to open\n        this.updateQuestVars({\n          dungeon: { hallway: { doorOpen: true } },\n        });\n\n        SoundManager.playSound('scene/doorOpen', Channel.scene, false, MixMode.singleInstance);\n\n        this.discardItemType('questItem/key', adventurerId);\n        const adventurer = this.getAdventurerById(adventurerId)?.name;\n        const textEntry = { key: 'quest-common-adventurer-opened-door', context: { adventurer } };\n        this.questUpdate(textEntry, '/img/items/misc/chest-02.png');\n\n        this.dispatch(setActiveSceneInteractionModal(this.questName));\n      }\n    }\n  }\n\n  // Todo: figure out an easier way to do this\n  takeItemFromCache(itemIndex: number, name: string, adventurerId: string, toSlot?: number) {\n    super.takeItemFromCache(itemIndex, name, adventurerId, toSlot);\n    const lootCache = this.getLootCache(name);\n    if (lootCache){\n      const items = lootCache.items.filter((_: unknown, index: number) => index !== itemIndex);\n      this.updateQuestVars({\n        dungeon: { hallway: { chest: { items } } },\n      });\n    }\n  }\n\n  updateScene(objects: SceneObject[] = this.sceneObjects, combat: boolean = this.combat) {\n    objects = objects.map(o => {\n      switch (o.name) {\n        case 'chest': {\n          return {\n            ...o,\n            gid: this.questVars.dungeon.entrance.chestOpen ? this.tileTypes['chest.open'] : this.tileTypes['chest.closed'],\n          };\n        }\n        case 'door1': {\n          if ( this.questVars.dungeon.hallway.doorOpen) {\n            const properties = { ...o.properties, blocksMovement: false, interactive: false };\n            if (o.properties.part === 'upper') {\n              return { ...o, gid: TILE_DOOR_UPPER_OPEN, properties };\n            } else {\n              return { ...o, gid: TILE_DOOR_LOWER_OPEN, properties };\n            }\n          } else {\n            if (o.properties.part === 'upper') {\n              return { ...o, gid: TILE_DOOR_UPPER_CLOSED };\n            } else {\n              return { ...o, gid: TILE_DOOR_LOWER_CLOSED };\n            }\n          }\n        }\n      }\n      return o;\n    });\n    super.updateScene(objects, combat);\n  }\n}\n\nexport class DungeonHub1Controller extends DungeonEncounterSceneController {\n  jsonPath = 'scenes/dungeon/dungeon-hub1.json';\n}\n\nSceneControllerManager.registerSceneController('kill10Boars', 'dungeon.canyon', DungeonCanyonSceneController);\nSceneControllerManager.registerSceneController('kill10Boars', 'dungeon.entrance', DungeonEntranceSceneController);\nSceneControllerManager.registerSceneController('kill10Boars', 'dungeon.hub1', DungeonHub1Controller);\nSceneControllerManager.registerSceneController('kill10Boars', 'dungeon.hallway', DungeonHallwaySceneController);\n","// In production, we register a service worker to serve assets from local cache.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on the \"N+1\" visit to a page, since previously\n// cached resources are updated in the background.\n\n// To learn more about the benefits of this model, read https://goo.gl/KwvDNy.\n// This link also includes instructions on opting out of this behavior.\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/,\n    ),\n);\n\nfunction registerValidSW(swUrl: string) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker) {\n          installingWorker.onstatechange = () => {\n            if (installingWorker.state === 'installed') {\n              if (navigator.serviceWorker.controller) {\n                // At this point, the old content will have been purged and\n                // the fresh content will have been added to the cache.\n                // It's the perfect time to display a \"New content is\n                // available; please refresh.\" message in your web app.\n                console.log('New content is available; please refresh.');\n              } else {\n                // At this point, everything has been precached.\n                // It's the perfect time to display a\n                // \"Content is cached for offline use.\" message.\n                console.log('Content is cached for offline use.');\n              }\n            }\n          };\n        }\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      if (\n        response.status === 404 ||\n        response.headers.get('content-type')?.indexOf('javascript') === -1\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.',\n      );\n    });\n}\n\nexport default function register() {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebookincubator/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (!isLocalhost) {\n        // Is not local host. Just register service worker\n        registerValidSW(swUrl);\n      } else {\n        // This is running on localhost. Lets check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl);\n      }\n    });\n  }\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import { ItemType } from 'definitions/items/types';\nimport { ResourceStoreState } from 'store/types/resources';\nimport { ProducableItem } from 'store/types/structure';\nimport { CostStoreState } from '../production/types';\n\nexport enum StructureType {\n  resource,\n  production,\n  tavern,\n  warehouse,\n}\n\nexport interface StructureDefinition {\n  type: StructureType;\n  cost: CostStoreState;\n  levels: StructureLevelDefinition[];\n}\n\nexport interface StructureLevelDefinition {\n  displayName: string;      // At this moment we can potentially support different names depending on the level\n  // of the structure. But this is not implemented because I feel it can cause confusion\n  cost: CostStoreState;     //\n  workerCapacity: number;   // number of workers that can work at this structure at this level\n}\n\nexport interface ResourceStructureDefinition extends StructureDefinition {\n  levels: ResourceStructureLevelDefinition[];\n}\n\ninterface HarvestDefinition {\n  amount: number;\n  lootTable: { [key in ItemType]?: number };\n}\n\nexport interface ResourceStructureLevelDefinition extends StructureLevelDefinition {\n  generates: ResourceStoreState;\n  harvest?: HarvestDefinition;\n}\n\nexport interface ProductionStructureDefinition extends StructureDefinition {\n  levels: ProductionStructureLevelDefinition[];\n}\n\nexport interface ProductionStructureLevelDefinition extends StructureLevelDefinition {\n  unlocks: ProducableItem[];\n}\n\nexport interface WarehouseStructureDefinition extends StructureDefinition {\n  levels: WarehouseStructureLevelDefinition[];\n}\n\nexport interface WarehouseStructureLevelDefinition extends StructureLevelDefinition {\n  maxResources: ResourceStoreState;\n  maxStockpile: number;\n}\n\nexport interface TavernStructureDefinition extends StructureDefinition {\n  levels: TavernStructureLevelDefinition[];\n}\n\nexport interface TavernStructureLevelDefinition extends StructureLevelDefinition {\n  rooms: number;\n}\n","import { HarvestUpdate } from 'mechanics/gameTick/harvest';\nimport { LogUpdate, QuestUpdate } from 'mechanics/gameTick/quests';\nimport { State as seedrandomStateType } from 'seedrandom';\nimport { StoreState } from 'store/types';\nimport { ResourceStoreState } from 'store/types/resources';\n\nexport type Time = 'harvest' | 'task';\nexport type GameAction =\n  { type: 'gameTick', delta: number, rngState: seedrandomStateType | null, resources: ResourceStoreState | null, quests: QuestUpdate[], harvest: HarvestUpdate | null, log: LogUpdate[] }\n  | { type: 'startGame' }\n  | { type: 'loadGame', state: StoreState }\n  | { type: 'ignoreVersionDiff' }\n  | { type: 'reduceTime', percentage: number, time: Time, what?: string };\n\n\nexport const startGame = (): GameAction => ({\n  type: 'startGame',\n});\n\nexport const gameTick = (delta: number, rngState: seedrandomStateType | null, resources: ResourceStoreState | null, quests: QuestUpdate[], harvest: HarvestUpdate | null, log: LogUpdate[]): GameAction => ({\n  type: 'gameTick',\n  delta,\n  rngState,\n  resources,\n  quests,\n  harvest,\n  log,\n});\n\nexport const reduceTime = (percentage: number, time: Time, what?: string): GameAction => ({\n  type: 'reduceTime',\n  percentage,\n  time,\n  what,\n});\n\nexport const ignoreVersionDiff = () => ({\n  type: 'ignoreVersionDiff',\n});\n\nexport const loadGame = (state: StoreState) => ({\n  type: 'loadGame',\n  state,\n});\n","/**\n * Convert a sematic versioning string into an 32-bit integer.\n *\n * Make sure the input string is compatible with the standard found\n * at semver.org. Since this only uses 10-bit per major/minor/patch version,\n * the highest possible SemVer string would be 1023.1023.1023.\n * @param  {string} semVer SemVer string\n * @return {number}     Numeric version\n */\nexport const convertSemVerToInt = (semVer: string): number => {\n  // Split a given version string into three parts.\n  const parts = semVer.split('.').map((part) => Number(part));\n  // Check if we got exactly three parts, otherwise throw an error.\n  if (parts.length !== 3) {\n    throw new Error(`Received invalid version string: ${semVer}`);\n  }\n  // Make sure that no part is larger than 1023 or else it\n  // won't fit into a 32-bit integer.\n  parts.forEach((part: number) => {\n    if (part >= 1024) {\n      throw new Error(`Version string invalid, ${part} is too large`);\n    }\n  });\n  let numericVersion = 0;\n  // Shift all parts either 0, 10 or 20 bits to the left.\n  for (let i = 0; i < 3; i++) {\n    numericVersion |= parts[i] << i * 10;\n  }\n  return numericVersion;\n};\n\n/**\n * Converts a 32-bit integer into a semantic versioning (SemVer) compatible string.\n * @param  {number} version Numeric version\n * @return {string}   SemVer string\n */\nexport const convertIntToSemVer = (version: number): string => {\n  // Works by shifting the numeric version to the right and then masking it\n  // with 0b1111111111 (or 1023 in decimal).\n  // eslint-disable-next-line no-mixed-operators\n  return `${version & 1023}.${version >> 10 & 1023}.${version >> 20 & 1023}`;\n};\n","import { convertSemVerToInt } from 'utils/version';\n\n// <MAJOR>.<MINOR>.<RELEASE>\n\nconst version = '0.2.1';\n\nexport default version;\nexport const asInt: number = convertSemVerToInt(version);\n","import { ONE_MINUTE } from 'utils/format/time';\n\nexport const RESOURCE_INTERVAL = ONE_MINUTE; // every minute constitutes a resource tick.\n","import { ONE_MINUTE, TWO_MINUTES } from 'utils/format/time';\nimport { ProductionStructureDefinition, StructureType } from './types';\n\nconst alchemist: ProductionStructureDefinition = {\n  type: StructureType.production,\n  cost: {\n    gold: 40,\n    time: 4000,\n  },\n  levels: [{\n    displayName: 'structure-alchemist-name',\n    // level 1:\n    workerCapacity: 2,\n    cost: {\n      gold: 0,\n    },\n    unlocks: [],\n  }, {\n    // level 2:\n    displayName: 'structure-alchemist-name',\n    workerCapacity: 5,\n    cost: {\n      gold: 30,\n      resources: {\n        wood: 100,\n        iron: 100,\n        stone: 100,\n      },\n      time: ONE_MINUTE,\n    },\n    unlocks: [],\n  }, {\n    // level 3:\n    displayName: 'structure-alchemist-name',\n    workerCapacity: 10,\n    cost: {\n      gold: 50,\n      time: TWO_MINUTES,\n    },\n    unlocks: [],\n  }],\n};\n\nexport default alchemist;\n","export enum Resource {\n  wood = 'wood',\n  iron = 'iron',\n  stone = 'stone',\n  leather = 'leather',\n  fabric = 'fabric',\n  food = 'food',\n}\n\n\nexport interface ResourceDefinition {\n  resource: Resource;\n  iconImg: string;\n}\n\nconst all = {\n  [Resource.wood]: {\n    resource: Resource.wood,\n    iconImg: '/img/resources/wood.png',\n  },\n  [Resource.iron]: {\n    resource: Resource.iron,\n    iconImg: '/img/resources/iron.png',\n  },\n  [Resource.stone]: {\n    resource: Resource.stone,\n    iconImg: '/img/resources/stone.png',\n  },\n  [Resource.leather]: {\n    resource: Resource.leather,\n    iconImg: '/img/resources/leather.png',\n  },\n  [Resource.fabric]: {\n    resource: Resource.fabric,\n    iconImg: '/img/resources/fabric.png',\n  },\n  [Resource.food]: {\n    resource: Resource.food,\n    iconImg: '/img/resources/food.png',\n  },\n};\n\nexport default all;\n","import { ProductionStructureDefinition, StructureType } from './types';\nimport { ONE_MINUTE, TWO_MINUTES } from 'utils/format/time';\n\nconst armoursmith: ProductionStructureDefinition = {\n  cost: {\n    gold: 40,\n    time: 4000,\n  },\n  type: StructureType.production,\n  levels: [{\n    // level 1:\n    displayName: 'structure-armoursmith-name',\n    workerCapacity: 2,\n    cost: {\n      gold: 0,\n    },\n    unlocks: ['apparel/boots1' ],\n  }, {\n    // level 2:\n    displayName: 'structure-armoursmith-name',\n    workerCapacity: 5,\n    cost: {\n      gold: 30,\n      resources: {\n        wood: 100,\n        iron: 100,\n        stone: 100,\n      },\n      time: ONE_MINUTE,\n    },\n    unlocks: ['apparel/chest' ],\n  }, {\n    // level 3:\n    displayName: 'structure-armoursmith-name',\n    workerCapacity: 10,\n    cost: {\n      gold: 50,\n      time: TWO_MINUTES,\n    },\n    unlocks: ['apparel/cowl'],\n  }],\n};\nexport default armoursmith;\n","import { ONE_MINUTE, TWO_MINUTES } from 'utils/format/time';\nimport { ResourceStructureDefinition, StructureType } from './types';\n\nconst garden: ResourceStructureDefinition = {\n  type: StructureType.resource,\n  cost: {\n    gold: 40,\n    time: 4000,\n  },\n  levels: [{\n    displayName: 'structure-garden-name',\n    // level 1:\n    workerCapacity: 2,\n    cost: {\n      gold: 0,\n    },\n    generates: { food: 2 },\n    harvest: {\n      amount: 3,\n      lootTable: {\n        'herb/bogroot': 2,\n        'herb/winterWeed': 1,\n      },\n    },\n  }, {\n    displayName: 'structure-garden-name',\n    // level 2:\n    workerCapacity: 5,\n    cost: {\n      gold: 30,\n      resources: {\n        wood: 100,\n        iron: 100,\n        stone: 100,\n      },\n      time: ONE_MINUTE,\n    },\n    generates: { food: 4 },\n    harvest: {\n      amount: 5,\n      lootTable: {\n        'herb/bogroot': 2,\n        'herb/winterWeed': 1,\n        'herb/hyacinthus': 1, \n        'herb/bloodLotus': 1, \n      },\n    },\n  }, {\n    // level 3:\n    displayName: 'structure-garden-name',\n    workerCapacity: 10,\n    cost: {\n      gold: 50,\n      time: TWO_MINUTES,\n    },\n    generates: { food: 8 },\n  }],\n};\n\nexport default garden;\n","import { ResourceStructureDefinition, StructureType } from './types';\nimport { HALF_HOUR, ONE_MINUTE, TWO_MINUTES } from 'utils/format/time';\n\nconst lumberMill: ResourceStructureDefinition = {\n  type: StructureType.resource,\n  cost: {\n    gold: 31,\n    time: HALF_HOUR,\n  },\n  levels: [{\n    // level 0:\n    displayName: 'structure-lumber-mill-name',\n    workerCapacity: 2,\n    cost: {\n      gold: 0,\n    },\n    generates: { wood: 2 },\n  }, {\n    // level 1:\n    displayName: 'structure-lumber-mill-name',\n    workerCapacity: 5,\n    cost: {\n      gold: 30,\n      resources: {\n        wood: 100,\n        iron: 100,\n        stone: 100,\n      },\n      time: ONE_MINUTE,\n    },\n    generates: { wood: 2 },\n  }, {\n    // level 2:\n    displayName: 'structure-lumber-mill-name',\n    workerCapacity: 10,\n    cost: {\n      gold: 50,\n      time: TWO_MINUTES,\n    },\n    generates: { wood: 2 },\n  }],\n};\n\nexport default lumberMill;\n","import { ONE_MINUTE, TWO_MINUTES } from 'utils/format/time';\nimport { ResourceStructureDefinition, StructureType } from './types';\n\nconst mine: ResourceStructureDefinition = {\n  cost: {\n    gold: 40,\n    time: 4000,\n  },\n  type: StructureType.resource,\n  levels: [{\n    displayName: 'structure-mine-name',\n    // level 0:\n    workerCapacity: 2,\n    cost: {\n      gold: 0,\n    },\n    generates: { iron: 2 },   \n    harvest: {\n      amount: 3,\n      lootTable: {\n        'mineral/roseQuartz': 2,\n        'mineral/topaz': 1,\n      },\n    },\n  }, {\n    displayName: 'structure-mine-name',\n    // level 1:\n    workerCapacity: 5,\n    cost: {\n      gold: 30,\n      resources: {\n        wood: 100,\n        iron: 100,\n        stone: 100,\n      },\n      time: ONE_MINUTE,\n    },\n    generates: { iron: 2 },\n    harvest: {\n      amount: 5,\n      lootTable: {\n        'mineral/roseQuartz': 2,\n        'mineral/topaz': 2,\n        'mineral/jasper': 1,\n        'mineral/greenOpal': 1,\n      },\n    },\n  }, {\n    displayName: 'structure-mine-name',\n    // level 2:\n    workerCapacity: 10,\n    cost: {\n      gold: 50,\n      time: TWO_MINUTES,\n    },\n    generates: { iron: 2 },\n    harvest: {\n      amount: 5,\n      lootTable: {\n        'mineral/roseQuartz': 1,\n        'mineral/topaz': 1,\n        'mineral/jasper': 1,\n        'mineral/greenOpal': 1,\n        'mineral/malachite': 1,\n        'mineral/tigersEye': 1,\n      },\n    },\n  }],\n};\nexport default mine;\n","import { ONE_MINUTE, TWO_MINUTES } from 'utils/format/time';\nimport { ResourceStructureDefinition, StructureType } from './types';\n\nconst quarry: ResourceStructureDefinition = {\n  cost: {\n    gold: 40,\n    time: 4000,\n  },\n  type: StructureType.resource,\n  levels: [{\n    displayName: 'structure-quarry-name',\n    // level 1:\n    workerCapacity: 2,\n    cost: {\n      gold: 0,\n    },\n    generates: { stone: 2 },\n  }, {\n    // level 2:\n    displayName: 'structure-quarry-name',\n    workerCapacity: 5,\n    cost: {\n      gold: 30,\n      resources: {\n        wood: 100,\n        iron: 100,\n        stone: 100,\n      },\n      time: ONE_MINUTE,\n    },\n    generates: { stone: 4 },\n  }, {\n    // level 3:\n    displayName: 'structure-quarry-name',\n    workerCapacity: 10,\n    cost: {\n      gold: 50,\n      time: TWO_MINUTES,\n    },\n    generates: { stone: 6 },\n  }],\n};\n\nexport default quarry;\n","import { ONE_MINUTE, TWO_MINUTES } from 'utils/format/time';\nimport { ResourceStructureDefinition, StructureType } from './types';\n\nconst tannery: ResourceStructureDefinition = {\n  cost: {\n    gold: 40,\n    time: 4000,\n  },\n  type: StructureType.resource,\n  levels: [{\n    displayName: 'structure-tannery-name',\n    // level 1:\n    workerCapacity: 2,\n    cost: {\n      gold: 0,\n    },\n    generates: { leather: 2 },\n  }, {\n    // level 2:\n    displayName: 'structure-tannery-name',\n    workerCapacity: 5,\n    cost: {\n      gold: 30,\n      resources: {\n        wood: 100,\n        iron: 100,\n        stone: 100,\n      },\n      time: ONE_MINUTE,\n    },\n    generates: { leather: 5 },\n  }, {\n    // level 3:\n    displayName: 'structure-tannery-name',\n    workerCapacity: 10,\n    cost: {\n      gold: 50,\n      time: TWO_MINUTES,\n    },\n    generates: { leather: 7 },\n  }],\n};\n\nexport default tannery;\n","import { ONE_MINUTE, TWO_MINUTES } from 'utils/format/time';\nimport { StructureType, TavernStructureDefinition } from './types';\n\nconst tavern: TavernStructureDefinition = {\n  cost: {\n    gold: 40,\n    time: 4000,\n  },\n  type: StructureType.tavern,\n  levels: [{\n    displayName: 'structure-tavern-name',\n    // level 1:\n    workerCapacity: 2,\n    cost: {\n      gold: 0,\n    },\n    rooms: 10,\n  }, {\n    // level 2:\n    displayName: 'structure-tavern-name',\n    workerCapacity: 5,\n    cost: {\n      gold: 30,\n      resources: {\n        wood: 100,\n        iron: 100,\n        stone: 100,\n      },\n      time: ONE_MINUTE,\n    },\n    rooms: 12,\n  }, {\n    // level 3:\n    displayName: 'structure-tavern-name',\n    workerCapacity: 10,\n    cost: {\n      gold: 50,\n      time: TWO_MINUTES,\n    },\n    rooms: 15,\n  }],\n};\n\nexport default tavern;\n","import { FOUR_MINUTES, TWO_MINUTES } from 'utils/format/time';\nimport {  StructureType, WarehouseStructureDefinition } from './types';\n\nconst warehouse: WarehouseStructureDefinition = {\n  cost: {\n    gold: 40,\n    time: 4000,\n  },\n  type: StructureType.warehouse,\n  levels: [{\n    displayName: 'structure-warehouse-name',\n    // level 1:\n    workerCapacity: 2,\n    cost: {\n      gold: 0,\n    },\n    maxResources: {\n      fabric: 200,\n      food: 200,\n      iron: 200,\n      leather: 200,\n      stone: 200,\n      wood: 200,\n    },\n    maxStockpile: 16,\n  }, {\n    // level 2:\n    displayName: 'structure-warehouse-name',\n    workerCapacity: 5,\n    cost: {\n      gold: 13,\n      resources: {\n        wood: 100,\n        iron: 100,\n        stone: 100,\n      },\n      time: FOUR_MINUTES,\n    },\n    maxResources: {\n      fabric: 500,\n      food: 500,\n      iron: 500,\n      leather: 500,\n      stone: 500,\n      wood: 500,\n    },\n    maxStockpile: 32,\n  }, {\n    // level 3:\n    displayName: 'structure-warehouse-name',\n    workerCapacity: 10,\n    cost: {\n      gold: 50,\n      resources: {\n        wood: 200,\n        iron: 200,\n        stone: 200,\n      },\n      time: TWO_MINUTES * 5,\n    },\n    maxResources: {\n      fabric: 1000,\n      food: 1000,\n      iron: 1000,\n      leather: 1000,\n      stone: 1000,\n      wood: 1000,\n    },\n    maxStockpile: 48,\n  }],\n};\n\nexport default warehouse;\n","import { ProductionStructureDefinition, StructureType } from './types';\nimport { ONE_MINUTE, THREE_MINUTES, TWO_MINUTES } from 'utils/format/time';\n\nconst weaponsmith: ProductionStructureDefinition = {\n  type: StructureType.production,\n  cost: {\n    gold: 40,\n    time: 4000,\n  },\n  levels: [{\n    // level 1:\n    displayName: 'structure-weaponsmith-name',\n    workerCapacity: 2,\n    cost: {\n      gold: 0,\n    },\n    unlocks: [],\n  }, {\n    // level 2:\n    displayName: 'structure-weaponsmith-name',\n    workerCapacity: 5,\n    cost: {\n      gold: 30,\n      resources: {\n        wood: 100,\n        iron: 100,\n        stone: 100,\n      },\n      time: ONE_MINUTE,\n    },\n    unlocks: [],\n  }, {\n    // level 3:\n    displayName: 'structure-weaponsmith-name',\n    workerCapacity: 10,\n    cost: {\n      gold: 50,\n      time: TWO_MINUTES,\n\n    },\n    unlocks: [],\n  }, {\n    // level 4:\n    displayName: 'structure-weaponsmith-name',\n    workerCapacity: 14,\n    cost: {\n      gold: 50,\n      time: THREE_MINUTES,\n    },\n    unlocks: ['weapon/poisonedDagger'],\n  }],\n};\nexport default weaponsmith;\n","import { ONE_MINUTE, THREE_MINUTES } from 'utils/format/time';\nimport { ResourceStructureDefinition, StructureType } from './types';\n\nconst weaver: ResourceStructureDefinition = {\n  cost: {\n    gold: 40,\n    time: 4000,\n  },\n  type: StructureType.resource,\n  levels: [{\n    displayName: 'structure-weaver-name',\n    // level 0:\n    workerCapacity: 2,\n    cost: {\n      gold: 0,\n    },\n    generates: { fabric: 2 },\n  }, {\n    displayName: 'structure-weaver-name',\n    // level 1:\n    workerCapacity: 5,\n    cost: {\n      gold: 30,\n      resources: {\n        wood: 100,\n        iron: 100,\n        stone: 100,\n      },\n      time: ONE_MINUTE,\n    },\n    generates: { fabric: 5 },\n  }, {\n    displayName: 'structure-weaver-name',\n    // level 2:\n    workerCapacity: 10,\n    cost: {\n      gold: 50,\n      time: THREE_MINUTES,\n    },\n    generates: { fabric: 7 },\n  }],\n};\n\nexport default weaver;\n","import { ONE_MINUTE, THREE_MINUTES, TWO_MINUTES } from 'utils/format/time';\nimport { ProductionStructureDefinition, StructureType } from './types';\n\nconst workshop: ProductionStructureDefinition = {\n  type: StructureType.production,\n  cost: {\n    gold: 40,\n    time: 4000,\n  },\n  levels: [{\n    // level 1:\n    displayName: 'structure-workshop-name',\n    workerCapacity: 2,\n    cost: {\n      gold: 0,\n    },\n    unlocks: [ ],\n  }, {\n    // level 2:\n    displayName: 'structure-workshop-name',\n    workerCapacity: 5,\n    cost: {\n      gold: 30,\n      resources: {\n        wood: 100,\n        iron: 100,\n        stone: 100,\n      },\n      time: ONE_MINUTE,\n    },\n    unlocks: [],\n  }, {\n    // level 3:\n    displayName: 'structure-workshop-name',\n    workerCapacity: 10,\n    cost: {\n      gold: 50,\n      time: TWO_MINUTES,\n    },\n    unlocks: [],\n  }, {\n    // level 4:\n    displayName: 'structure-workshop-name',\n    workerCapacity: 14,\n    cost: {\n      gold: 50,\n      time: THREE_MINUTES,\n    },\n    unlocks: [],\n  }],\n};\nexport default workshop;\n","export enum TimeType {\n  questProgress,      // progress on the worldmap\n  resourceGeneration,\n  cheat,\n}\n// todo: should come from store?\n\nlet cheatTimeMultiplier = 1;\nexport const setCheatTimeMultiplier = (value: number) => {\n  cheatTimeMultiplier = value;\n};\n\nexport const getTimeMultiplier = (type: TimeType): number => {\n  switch (type) {\n    case TimeType.cheat:\n      return cheatTimeMultiplier;\n    // todo: implement different multipliers for different timetypes?\n    // the idea is to have speed boosts in different areas of the game\n    default:\n      return cheatTimeMultiplier;\n  }\n};\n\n","import alchemist from './alchemist';\nimport armoursmith from './armoursmith';\nimport garden from './garden';\nimport lumberMill from './lumberMill';\nimport mine from './mine';\nimport quarry from './quarry';\nimport tannery from './tannery';\nimport tavern from './tavern';\nimport { StructureDefinition } from './types';\nimport warehouse from './warehouse';\nimport weaponsmith from './weaponsmith';\nimport weaver from './weaver';\nimport workshop from './workshop';\nimport { Resource } from 'definitions/resources';\n\nexport type Structure =\n  'alchemist' |\n  'armoursmith' |\n  'garden' |\n  'lumberMill' |\n  'mine' |\n  'quarry' |\n  'tavern' |\n  'tannery' |\n  'warehouse' |\n  'weaponsmith' |\n  'weaver' |\n  'workshop';\n\n\nexport type ProductionStructure = 'alchemist' | 'armoursmith' | 'weaponsmith' | 'workshop';\nexport type ResourceStructure = 'garden' | 'lumberMill' | 'mine' | 'quarry' | 'tannery' | 'weaver';\n\n// Type guard\nexport const isProductionStructure = (structure: Structure): structure is ProductionStructure => {\n  return structure === 'alchemist' ||\n    structure === 'armoursmith' ||\n    structure === 'weaponsmith' ||\n    structure === 'workshop';\n};\n// Type guard\nexport const isResourceStructure = (structure: Structure): structure is ResourceStructure => {\n  return structure === 'garden' ||\n    structure === 'lumberMill' ||\n    structure === 'mine' ||\n    structure === 'quarry' ||\n    structure === 'tannery' ||\n    structure === 'weaver';\n};\nconst all = {\n  alchemist,\n  armoursmith,\n  garden,\n  lumberMill,\n  mine,\n  quarry,\n  tavern,\n  tannery,\n  warehouse,\n  weaponsmith,\n  weaver,\n  workshop,\n};\n\nexport default all;\n\nexport function getDefinition<T extends StructureDefinition>(structure: Structure): T {\n  return all[structure] as unknown as T;\n}\n\n\n\nexport function getStructureByResource(resource: Resource) : Structure {\n  switch (resource) {\n    case Resource.fabric:\n      return 'weaver';\n    case Resource.food:\n      return 'garden';\n    case Resource.iron:\n      return 'mine';\n    case Resource.leather:\n      return 'tannery';\n    case Resource.stone:\n      return 'quarry';\n    case Resource.wood:\n      return 'lumberMill';\n  }\n}\n","import { getDefinition } from 'definitions/structures';\nimport { WarehouseStructureDefinition, WarehouseStructureLevelDefinition } from 'definitions/structures/types';\nimport { createSelector } from 'reselect';\nimport { StoreState } from 'store/types';\n\nconst getWarehouseLevel = (state: StoreState) => {\n  return state.structures.warehouse.level;\n};\n\n\nconst maxResources = (level: number) => {\n  const structureDefinition = getDefinition<WarehouseStructureDefinition>('warehouse');\n  const levelDefinition: WarehouseStructureLevelDefinition = structureDefinition.levels[level];\n  return levelDefinition.maxResources;\n};\n\n// Selects a ResourceStoreState with maximum stockpile of each resource the warehouse supports\nexport const selectMaxResources = createSelector([\n  getWarehouseLevel],\nmaxResources,\n);","/* eslint-disable @typescript-eslint/no-non-null-assertion */\nimport { RESOURCE_INTERVAL } from 'mechanics/resources';\nimport { Resource } from 'definitions/resources';\nimport { getDefinition, Structure } from 'definitions/structures';\nimport { ResourceStructureDefinition, ResourceStructureLevelDefinition, StructureType } from 'definitions/structures/types';\nimport { getTimeMultiplier, TimeType } from 'mechanics/time';\nimport { selectMaxResources } from 'store/selectors/resources';\nimport { StoreState } from 'store/types';\nimport { ResourceStoreState } from 'store/types/resources';\nimport { StructuresStoreState } from 'store/types/structures';\n\n\n/*\n  * Calculates how many resources are generated by the in the town.\n  * Will return a ResourceStoreState with the amount of each resource to add  */\nconst getProducedResources = (lastProducedUpdate: number, store: StoreState): ResourceStoreState | null => {\n  const structures: StructuresStoreState = store.structures;\n  const result: ResourceStoreState = {};\n  const timeMultiplier = getTimeMultiplier(TimeType.resourceGeneration);\n\n  // this function can run at different intervals\n  // faster or slower than once a minute\n  // we will multiply the resource amount by the factor to normalize\n  const factor = ((Date.now() - lastProducedUpdate) / (RESOURCE_INTERVAL / timeMultiplier));\n  const maxResources = selectMaxResources(store);\n\n  const handleStructure = (structure: string) => {\n    const structureDefinition = getDefinition(structure as Structure);\n\n    if (structureDefinition.type === StructureType.resource) {\n      const resourceStructureDefinition = structureDefinition as ResourceStructureDefinition;\n      const level: number = structures[structure as Structure].level;\n      const levelDefinition: ResourceStructureLevelDefinition = resourceStructureDefinition.levels[level];\n\n      // Store all the resources that this structure will generate this tick into `result`\n      Object.keys(levelDefinition.generates).reduce((accumulator: ResourceStoreState, key: string) => {\n        const resource = key as Resource;\n\n        const amount: number = levelDefinition.generates[resource]! * structures[structure as Structure].workers * factor;\n        accumulator[resource] = (accumulator[resource] || 0) + amount;\n        return accumulator;\n      }, result);\n    }\n  };\n\n  if (factor < 1) {\n    return null;\n  }\n  // Calculate what each structure generates. Stores in `result`.\n  Object.keys(structures).forEach((structure) => handleStructure(structure));\n\n  // Check if the warehouse can actually hold it\n  Object.keys(result).forEach((key: string) => {\n    const resource = key as Resource;\n    if (result[resource]) {\n      if (store.resources[resource]! + result[resource]! >= maxResources[resource]!) {\n        result[resource] = maxResources[resource]! - (store.resources[resource]!);\n      }\n    }\n    // console.log(`Adding: ${resource} ${result[resource]} factor ${factor}`);\n  });\n\n  return result;\n};\n\n\nexport default getProducedResources;\n","import { TextEntry } from 'constants/text';\nimport { getDefinition } from 'definitions/quests';\nimport { QuestDefinition, QuestNodeType } from 'definitions/quests/types';\n\nimport { Store } from 'redux';\nimport { StoreState } from 'store/types';\nimport { LogChannel } from 'store/types/logEntry';\nimport { QuestStatus, QuestStoreState } from 'store/types/quest';\nimport { ToastManager } from 'global/ToastManager';\nimport { TextManager } from 'global/TextManager';\nimport { Type } from 'components/ui/toasts/Toast';\nimport { getQuestLink } from 'utils/routing';\nimport { setSceneName } from 'store/actions/quests';\nimport { getQuestLeader } from 'store/helpers/storeHelpers';\nimport { getTimeMultiplier, TimeType } from 'mechanics/time';\n\nexport interface QuestUpdate {\n  name: string;\n  progress: number;\n}\n\nexport interface LogUpdate extends TextEntry {\n  key: string;\n  channel: LogChannel;\n  channelContext?: string;\n}\n\ninterface QuestGameTickResponse {\n  questUpdates: QuestUpdate[];\n  logUpdates: LogUpdate[];\n}\n\nconst getQuestUpdates = (delta: number, store: Store<StoreState>): QuestGameTickResponse => {\n\n  const speed = 4;  // in nodes per minute\n  const timeMultiplier = getTimeMultiplier(TimeType.questProgress);\n  const MS_PER_MINUTE = 60000;\n  const log: LogUpdate[] = [];\n  const quests: QuestUpdate[] = [];\n  const state: StoreState = store.getState();\n\n  // Will set the scene name on the given quest\n  // SceneControllerContextProvider will detect this and load the scene data\n  const initializeScene = (quest: QuestStoreState, sceneName: string) => {\n    store.dispatch(setSceneName(quest.name, sceneName));\n\n    const questTitle = TextManager.getQuestTitle(quest.name);\n    const leader = getQuestLeader(state.adventurers, quest);\n    ToastManager.addToast(questTitle, Type.questEncounter, leader?.avatarImg, getQuestLink(quest.name));\n  };\n\n  // Moves the quest line progress. Only if currently at a 'nothing' node\n  // Otherwise the player has to do something to move the quest along\n  state.quests.forEach((quest: QuestStoreState) => {\n    if (quest.status !== QuestStatus.active) {\n      return;\n    }\n    const questDefinition: QuestDefinition = getDefinition(quest.name);\n    const currentProgress = quest.progress;\n    const currentNodeIndex = Math.floor(currentProgress);\n    const currentNode = questDefinition.nodes[currentNodeIndex];\n\n    if (currentNode.type === QuestNodeType.encounter) {\n      if (quest.sceneName === undefined) {\n        // This happens when the first node is an encounter. Initialize it right away\n        initializeScene(quest, currentNode.startScene);\n      }\n    }\n    if (currentNode.type === QuestNodeType.nothing) {\n      // Currently at a 'nothing' node\n      const progressIncrease = (delta / (MS_PER_MINUTE / timeMultiplier)) * speed;\n      // todo: [15/07/2019] speed could be different for each party\n      let nextProgress = Math.min(currentProgress + progressIncrease, questDefinition.nodes.length - 1);\n      const nodesPassed = Math.floor(nextProgress) - currentNodeIndex;\n      for (let i = 1; i <= nodesPassed; i++) {\n        // Loop through all the nodes we've passed since last tick\n        const nextNode = questDefinition.nodes[currentNodeIndex + i];\n        if (nextNode.type === QuestNodeType.encounter) {\n          // We've hit an encounter node. set the progress to here and stop looking at other nodes\n          initializeScene(quest, nextNode.startScene);\n\n          // Add quest to log\n          if (nextNode.log) {\n            log.push({\n              channel: LogChannel.quest,\n              channelContext: quest.name,\n              key: nextNode.log,\n            });\n          }\n          // Dont overshoot the encounter node\n          nextProgress = currentProgress + i;\n\n          break;\n        } else if (nextNode.type === QuestNodeType.nothing) {\n          if (nextNode.log) {\n            log.push({\n              channel: LogChannel.quest,\n              channelContext: quest.name,\n              key: nextNode.log,\n            });\n          }\n        }\n      }\n      quests.push({\n        name: quest.name,\n        progress: nextProgress,\n      });\n    }\n  });\n  return {\n    logUpdates: log,\n    questUpdates: quests,\n  };\n};\n\nexport default getQuestUpdates;\n","import { State as seedrandomStateType } from 'seedrandom';\nimport * as Random from 'utils/random';\n\nconst getRngState = (): seedrandomStateType | null => {\n  if (Random.dirty) {\n    return Random.state();\n  }\n  return null;\n};\n\nexport default getRngState;\n","import { ItemType } from 'definitions/items/types';\n\n// export function pick<T extends string, TEnumValue extends number>(table: {[key in keyof T]?: TEnumValue}) : T {\n// export function pick<T =Item>(table: {[key in Item]?: number}) : T {\nexport function pick(table: { [key in ItemType]?: number }) : ItemType {\n  const totalWeight = Object.values(table).reduce((acc, value) => (acc ?? 0 ) + (value ?? 0), 0) ?? 0;\n  const randomNumber = Math.floor(Math.random() * totalWeight + 1);\n\n  let weight = 0;\n  const entries = Object.entries(table);\n  for (let i = 0; i < entries.length; i++) {\n    weight += entries[i][1];\n    if (randomNumber <= weight) {\n      return entries[i][0] as unknown as ItemType;\n    }\n  }\n  throw new Error();\n}\n\n/* Tests distribution */\nexport const test = () => {\n  const lootTable: { [key in ItemType]?: number } = {\n    'herb/bogroot': 2,\n    'herb/winterWeed': 1,\n  };\n  const result: { [key in ItemType]?: number } = {};\n  for (let i = 0; i < 500; i++) {\n    const picked = pick(lootTable);\n    result[picked] = (result[picked] ?? 0) + 1;\n  }\n  // console.log(result)\n};\n// */\n","import { Apparel } from 'definitions/items/apparel';\nimport { QuestItem } from 'definitions/items/questItems';\nimport { Item } from 'definitions/items/types';\nimport { Weapon } from 'definitions/items/weapons';\n\nexport enum StructureState {\n  NotBuilt,\n  Building,\n  Built,\n}\n\nexport interface StructureStoreState {\n  level: number;\n  workers: number;\n  state: StructureState;\n}\n\nexport type ProducableItem = Weapon | Apparel | QuestItem;\n\nexport interface ProductionStructureStoreState extends StructureStoreState {\n  produces: ProducableItem[];\n}\n\nexport interface ResourceStructureState extends StructureStoreState {\n  harvest?: Item[]; // Items currently available for harvest at this structure\n}\n","import { ItemType } from 'definitions/items/types';\nimport { getDefinition, Structure } from 'definitions/structures';\nimport { ResourceStructureDefinition, ResourceStructureLevelDefinition, StructureType } from 'definitions/structures/types';\nimport { StoreState } from 'store/types';\nimport { StructuresStoreState } from 'store/types/structures';\nimport { pick } from 'mechanics/lootTable';\nimport { ONE_HOUR } from 'utils/format/time';\nimport { ResourceStructureState } from 'store/types/structure';\n\n\n/*\n  * Items to be harvested  */\nexport type HarvestUpdate = {\n  [key in Structure]?: ItemType[]\n};\n\nexport const HARVEST_INTERVAL = ONE_HOUR * 3; // every three hours constitutes a harvest tick.\n\n\nconst getHarvest = (state: StoreState): HarvestUpdate | null => {\n  const { lastHarvest } = state.engine;\n  const structures: StructuresStoreState = state.structures;\n  const result: HarvestUpdate = {};\n\n  const handleStructure = (structure: Structure) => {\n    const structureDefinition = getDefinition(structure);\n\n    if (structureDefinition.type === StructureType.resource) {\n      const resourceStructureDefinition = structureDefinition as ResourceStructureDefinition;\n      const level: number = structures[structure as Structure].level;\n      const levelDefinition: ResourceStructureLevelDefinition = resourceStructureDefinition.levels[level];\n\n      if (levelDefinition.harvest?.lootTable){\n        const structureState = structures[structure] as ResourceStructureState;\n        let itemCount = structureState.harvest?.length ?? 0;\n        const items: ItemType[] = [];\n        while (itemCount < levelDefinition.harvest.amount) {\n          items.push(pick(levelDefinition.harvest.lootTable));\n          itemCount ++;\n        }\n\n        result[structure] = items;\n      }\n\n    }\n  };\n\n\n  // Calculate what each structure generates. Stores in `result`.\n  if (Date.now() - lastHarvest > HARVEST_INTERVAL){\n    Object.keys(structures).forEach((structure) => handleStructure(structure as Structure));\n  }\n  return result;\n};\n\n\nexport default getHarvest;\n","import { Reducer } from 'redux';\nimport { EngineStoreState } from 'store/types/engine';\nimport { HARVEST_INTERVAL } from 'mechanics/gameTick/harvest';\nimport { GameAction } from 'store/actions/game';\n\nexport const getInitialEngineState = () => {\n  return {\n    gameStarted: undefined,\n    previousTick: Date.now(),\n    lastTick: Date.now(),\n    lastProducedUpdate: Date.now(),\n    lastHarvest: Date.now(),\n  };\n};\n\n/**\n * reducer\n * @param state\n * @param action\n */\n// eslint-disable-next-line @typescript-eslint/default-param-last\nexport const engine: Reducer<EngineStoreState, GameAction> = (state = getInitialEngineState(), action) => {\n  switch (action.type) {\n    case 'startGame': {\n      return {\n        ...state,\n        gameStarted: Date.now(),\n      };\n    }\n    case 'gameTick': {\n\n      // Keep track of the last time resources were produced\n      const resourcesToAdd = action.resources;\n      const lastProducedUpdate = resourcesToAdd === null ? state.lastProducedUpdate : Date.now();\n\n      // Keep track of last harvest\n      const lastHarvest = action.harvest === null || !Object.keys(action.harvest).length ? state.lastHarvest : Date.now();\n\n      const previousTick = state.lastTick;\n\n      return {\n        ...state,\n        previousTick,\n        lastProducedUpdate,\n        lastTick: Date.now(),\n        lastHarvest,\n      };\n    }\n\n    case 'reduceTime': {\n      if (action.percentage < 0 || action.percentage > 100) return state;\n      switch (action.time) {\n        case 'harvest': {\n          const timeLeft = HARVEST_INTERVAL - (Date.now() - state.lastHarvest);\n\n          const delta = timeLeft * (action.percentage / 100);\n          return {\n            ...state,\n            lastHarvest: state.lastHarvest - delta,\n          };\n        }\n      }\n      return state;\n    }\n  }\n  return state;\n};\n\n","import { Reducer } from 'redux';\nimport { GameAction } from 'store/actions/game';\nimport { GameStoreState } from 'store/types/game';\nimport * as Version from 'constants/version';\n\nexport const initialGameState: GameStoreState = {\n  version: Version.asInt,\n};\n/**\n * reducer\n * @param state\n * @param action\n */\n// eslint-disable-next-line @typescript-eslint/default-param-last\nexport const game: Reducer<GameStoreState, GameAction> = (state = initialGameState, action) => {\n  switch (action.type) {\n    // when user dismisses the warning about version incompatibility\n    case 'ignoreVersionDiff': {\n      return {\n        ...state,\n        ignoreVersionDiff: Version.asInt,\n      };\n    }\n  }\n  return state;\n};\n\n","\nimport { StockpileAction } from 'store/actions/stockpile';\nimport { Reducer } from 'redux';\nimport { ItemType, ItemCategory, Item } from 'definitions/items/types';\nimport allItems, { canStackItem, getAllItemsByCategory } from 'definitions/items';\nimport { StockpileStoreState } from 'store/types/stockpile';\nimport { getDefinition } from 'definitions/structures';\nimport { getDefinition as getItemDefinition } from 'definitions/items';\nimport { WarehouseStructureDefinition } from 'definitions/structures/types';\n\nconst getRandomItemTypeByCategory = (itemCategory: ItemCategory): ItemType => {\n  const all = getAllItemsByCategory(itemCategory);\n  const randomIndex = Math.floor(Math.random() * all.length);\n  return all[randomIndex] as ItemType;\n};\n\n// Items in warehouse\nexport const getInitialStockpile = (): StockpileStoreState => {\n  // Generate some random stuff\n  const result: StockpileStoreState = {\n    'ammunition': [],\n    'apparel': [],\n    'deed': [],\n    'herb': [],\n    'material': [],\n    'mineral': [],\n    'consumable': [],\n    'questItem': [],\n    'trinket': [],\n    'weapon': [],\n  };\n\n  const { maxStockpile } = getDefinition<WarehouseStructureDefinition>('warehouse').levels[0];\n  Object.keys(result).forEach((itemCategoryName: string) => {\n    const itemCategory = ItemCategory[itemCategoryName as keyof typeof ItemCategory];\n    for (let i = 0; i < maxStockpile; i++) {\n      if (Math.random() < .5) {\n        result[itemCategoryName as keyof typeof result].push(null);\n      } else {\n        const randomItem: Item = { type: getRandomItemTypeByCategory(itemCategory) };\n        if (canStackItem(itemCategory)){\n          randomItem.quantity = Math.floor(Math.random() * 100);\n        }\n        const category = result[itemCategoryName as keyof typeof result] as Item[];\n        category.push(randomItem);\n      }\n    }\n  });\n  return result;\n};\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nconst getRandomItem = (): ItemType => {\n  const all = Object.keys(allItems);\n  const randomIndex = Math.floor(Math.random() * all.length);\n  return all[randomIndex] as ItemType;\n};\n\n\n\n/**\n * reducer\n * @param state\n * @param action\n */\n// eslint-disable-next-line @typescript-eslint/default-param-last\nexport const stockpile: Reducer<StockpileStoreState, StockpileAction> = (state = getInitialStockpile(), action) => {\n  switch (action.type) {\n    case 'addItem': {\n      const definition = getItemDefinition(action.item.type);\n      // toSlot is optional\n      const { item } = action;\n      let { toSlot } = (action);\n      const stockpileCategory = ItemCategory[definition.itemCategory] as keyof StockpileStoreState;\n\n      if (toSlot === undefined) {\n        toSlot = state[stockpileCategory].findIndex((slot) => slot === null);  // find first empty element\n        if (toSlot === -1) {\n          // Still not found. Add at end\n          // todo: [07/07/2019] GAME DESIGN\n          return {\n            ...state,\n            [stockpileCategory]: [\n              ...state[stockpileCategory],\n              item,\n            ],\n          };\n        }\n      }\n      return {\n        ...state,\n        [stockpileCategory]: state[stockpileCategory].map((element, index) => index === toSlot ? item : element),\n      };\n    }\n\n    case 'moveItemInWarehouse': {\n      const {\n        itemCategory,\n        fromSlot,\n        toSlot,\n      } = action;\n      const stockpileCategory = ItemCategory[itemCategory] as keyof StockpileStoreState;\n\n      return {\n        ...state,\n        [stockpileCategory]: state[stockpileCategory].map((element, index) => {\n          if (index === fromSlot) { return state[stockpileCategory][toSlot]; }\n          if (index === toSlot) { return state[stockpileCategory][fromSlot]; }\n          return element;\n        }),\n      };\n    }\n    case 'removeItem': {\n      const { itemCategory, fromSlot } = action;\n      const stockpileCategory = ItemCategory[itemCategory] as keyof StockpileStoreState;\n\n      return {\n        ...state,\n        [stockpileCategory]: state[stockpileCategory].map((element, index) => index !== fromSlot ? element : null),\n      };\n    }\n\n    // // Adds slots with 'null' to the end\n    // case ActionType.addStockpileSlots: {\n    //   const {\n    //     slots,\n    //   } = (action as AddStockpileSlotsAction);\n\n    //   return [\n    //     ...state,\n    //     ...Array(slots).fill(null)\n    //   ];\n    // }\n  }\n\n  return state;\n};\n","import { GameAction } from 'store/actions/game';\nimport { LogAction } from 'store/actions/log';\nimport { LogUpdate } from 'mechanics/gameTick/quests';\nimport { Reducer } from 'redux';\nimport { LogEntry } from 'store/types/logEntry';\n\nexport const initialLogState = [];\n\n/**\n * reducer\n * @param state\n * @param action\n */\n// eslint-disable-next-line @typescript-eslint/default-param-last\nexport const log: Reducer<LogEntry[]> = (state: LogEntry[] = initialLogState, action: GameAction | LogAction) => {\n  switch (action.type) {\n    case 'addLogEntry': {\n      const { entry, channel, channelContext } = action;\n      const { key, context } = entry;\n      const time = Date.now();\n      return [{\n        channel,\n        channelContext,\n        context,\n        key,\n        time,\n      },\n      ...state,\n      ];\n    }\n    case 'gameTick': {\n      if (!action.log.length) {\n        return state;\n      }\n\n      // Add log entries\n      const logEntries = action.log.map((lU: LogUpdate): LogEntry => {\n        return {\n          ...lU,\n          time: Date.now(),\n        };\n      });\n      return [\n        ...logEntries,\n        ...state,\n      ];\n    }\n  }\n  return state;\n};\n\n","import { Reducer } from 'redux';\nimport { QuestStatus, QuestStoreState } from 'store/types/quest';\nimport { Allegiance, getUniqueName, isActorObject, isAdventurer, isEnemy, SceneActionType } from 'store/types/scene';\nimport { QuestDefinition } from 'definitions/quests/types';\nimport { getDefinition } from 'definitions/quests';\nimport { initialQuestVars } from 'definitions/quests/kill10Boars/questVars';\nimport deepmerge from 'deepmerge';\nimport { Action } from 'store/actions';\nimport { calculateInitialAP, ENEMY_BASE_AP } from 'mechanics/combat';\nimport { xpToLevel } from 'mechanics/adventurers/levels';\n\nconst overwriteMerge = (_: [], sourceArray: []) => sourceArray;\n\nexport const initialQuestState: QuestStoreState[] = [{\n  name: 'kill10Boars',\n  status: QuestStatus.active,\n  party: [\n    'adv_c4a5d270',\n    'adv_2e655832',\n    'adv_ec6f1050',\n    'adv_d299f98a',\n  ],\n  progress: 0,\n  questVars: initialQuestVars,\n  encounterResults: [],\n  icon: 'sigil1.png',\n// }, {\n//   name: \"retrieveMagicAmulet\",\n//   party: [],\n//   status: QuestStatus.available,\n//   progress: 0,\n//   questVars: {},\n//   encounterResults: [],\n//   icon: \"sigil2.png\",\n//   reward: {\n//     gold: 4,\n//     items: [ Item.deedForWeaponsmith ],\n//   },\n}];\n\n/**\n * reducer\n * @param state\n * @param action\n */\n// eslint-disable-next-line @typescript-eslint/default-param-last\nexport const quests: Reducer<QuestStoreState[]> = (state: QuestStoreState[] = initialQuestState, action: Action): QuestStoreState[] => {\n  switch (action.type) {\n    // Launches quest. Sets state to active, assigns adventurers\n    case 'launchQuest': {\n      const party = action.assignedAventurers\n        .filter((adventurer) => !!adventurer)\n        .map((adventurer) => adventurer.id);\n\n      return state.map((qss) => {\n        if (qss.name === action.questName) {\n          const questDefinition: QuestDefinition = getDefinition(action.questName);\n          const questVars = questDefinition.getInitialQuestVars(qss);\n\n          return {\n            ...qss,\n            status: QuestStatus.active,\n            party,\n            questVars,\n          };\n        }\n        return qss;\n      });\n    }\n\n    case 'exitEncounter': {\n      return state.map((qss) => {\n        if (qss.name === action.questName) {\n          const progress = qss.progress + 1;\n          // const questDefinition: QuestDefinition = questDefinitions[qss.name];\n          // const nextNode = questDefinition.nodes[Math.floor(progress)];\n\n          return {\n            ...qss,\n            progress,\n            scene: undefined,\n            sceneName: undefined,\n          };\n        }\n        return qss;\n      });\n    }\n\n    // Updates the questvars\n    case 'updateQuestVars': {\n      return state.map((qss) => {\n        if (qss.name === action.questName) {\n          return {\n            ...qss,\n            questVars: deepmerge(qss.questVars as Partial<unknown>, action.vars as Partial<unknown>, { arrayMerge: overwriteMerge }),\n          };\n        }\n        return qss;\n      });\n    }\n\n    // case \"updateEncounterResult\":\n    //   return updateEncounterResult(state, action as UpdateEncounterResultAction);\n\n    // case \"startEncounter\":\n    //   return startEncounter(state, action as StartEncounterAction);\n\n    // To change scene, set scene name. The scenecontroller will load the scene data and art assets\n    // and call setScene reducer\n    case 'setSceneName': {\n      return state.map((qss) => {\n        if (qss.name === action.questName) {\n          return {\n            ...qss,\n            sceneName: action.sceneName,\n            sceneNamePrev: qss.sceneName,\n            scene: undefined,\n          };\n        }\n        return qss;\n      });\n    }\n\n    case 'setScene': {\n      return state.map((qss) => {\n        if (qss.name === action.questName) {\n          return {\n            ...qss,\n            scene: action.scene,\n          };\n        }\n        return qss;\n      });\n    }\n\n    // Enqueues a scene action on this quest\n    case 'enqueueSceneAction': {\n      return state.map((qss) => {\n        if (qss.name === action.questName) {\n          const scene = qss.scene;\n          if (!scene) throw new Error('Something broke. No scene');\n          scene.actionQueue = [\n            ...scene.actionQueue ?? [],\n            action.sceneAction,\n          ];\n\n          return {\n            ...qss,\n            scene,\n          };\n        }\n        return qss;\n      });\n    }\n\n    // next action on scene is completed\n    case 'completeSceneAction': {\n      return state.map((qss) => {\n        if (qss.name === action.questName) {\n          const scene = qss.scene;\n          if (!scene || !scene.actionQueue) return qss;\n          const sceneAction = scene.actionQueue.find(aq => getUniqueName(aq.intent.actor) === action.actorName);\n          if (!sceneAction) return qss;\n\n          switch (sceneAction.intent.action) {\n            case SceneActionType.move:\n            case SceneActionType.melee:\n            case SceneActionType.interact: {\n              scene.objects = scene.objects.map((a) => {\n                if (getUniqueName(a) === action.actorName && sceneAction.intent.path?.[sceneAction.intent.path.length - 1]) {\n                  return {\n                    ...a,\n                    location: sceneAction.intent.path[sceneAction.intent.path.length - 1],\n                  };\n                }\n                return a;\n              });\n            }\n          }\n\n          const index = scene.actionQueue.findIndex(aQ => (getUniqueName(aQ.intent.actor) === action.actorName));\n          scene.actionQueue = scene.actionQueue.filter((_, i) => i !== index);\n\n          return {\n            ...qss,\n            scene,\n          };\n        }\n        return qss;\n      });\n    }\n\n    case 'setCombat': {\n      const { combat } = action;\n      return state.map((qss) => {\n        if (qss.name === action.questName && qss.scene) {\n          const scene = {\n            ...qss.scene,\n            combat,\n            turn: combat ? Allegiance.player : undefined,\n          };\n          return {\n            ...qss,\n            scene,\n          };\n        }\n        return qss;\n      });\n    }\n\n    case 'endPlayerTurn': {\n      return state.map((qss) => {\n        if (qss.name === action.questName) {\n          const scene = qss.scene;\n          if (!scene) throw new Error('Something broke. No scene');\n\n          scene.objects = scene.objects.map(o => {\n            if (isActorObject(o)) {\n              const ap = 0;\n              return {\n                ...o,\n                ap,\n              };\n            }\n            return o;\n          });\n\n          return {\n            ...qss,\n            scene,\n          };\n        }\n        return qss;\n      });\n    }\n\n    case 'startTurn': {\n      // Starts a combat turn, either for Player or Enemy\n      return state.map((qss) => {\n        if (qss.name === action.questName) {\n          if (!qss.scene) throw new Error('Something broke. No scene');\n          const { turn } = action;\n          const scene = qss.scene;\n\n          if (turn === Allegiance.player) {\n            scene.objects = scene.objects.map(o => {\n              if (isAdventurer(o)) {\n                const adventurerInStore = action.adventurers?.find(a => a.id === o.name);\n                if (adventurerInStore){\n                  const level = xpToLevel(adventurerInStore.xp);\n                  const ap = calculateInitialAP(adventurerInStore.basicAttributes, level);\n                  return {\n                    ...o,\n                    ap,\n                  };\n                }\n                return o;\n              }\n              return o;\n            });\n          } else if (turn === Allegiance.enemy) {\n            scene.objects = scene.objects.map(o => {\n              if (isEnemy(o)) {\n                const ap = ENEMY_BASE_AP;\n                return {\n                  ...o,\n                  ap,\n                };\n              }\n              return o;\n            });\n          }\n\n          return {\n            ...qss,\n            scene: {\n              ...scene,\n              turn,\n            },\n          };\n        }\n        return qss;\n      });\n    }\n\n    case 'setActorAp': {\n      return state.map((qss) => {\n        if (qss.name === action.questName) {\n          const scene = qss.scene;\n          if (!scene) throw new Error('Something broke. No scene');\n\n          scene.objects = scene.objects.map(o => {\n            if (isActorObject(o) && o.name === action.actor) {\n              const ap = action.ap;\n              return {\n                ...o,\n                ap,\n              };\n            }\n            return o;\n          });\n\n          return {\n            ...qss,\n            scene,\n          };\n        }\n        return qss;\n      });\n    }\n\n    case 'deductActorAp': {\n      return state.map((qss) => {\n        if (qss.name === action.questName) {\n          const scene = qss.scene;\n          if (!scene) throw new Error('Something broke. No scene');\n\n          scene.objects = scene.objects.map(o => {\n            if (isAdventurer(o) && o.adventurerId === action.actor || isEnemy(o) && o.enemyId === action.actor) {\n              const ap = o.ap - action.ap;\n              return {\n                ...o,\n                ap,\n              };\n            }\n            return o;\n          });\n\n          return {\n            ...qss,\n            scene,\n          };\n        }\n        return qss;\n      });\n    }\n\n    case 'modifyEnemyHealth': {\n      return state.map((qss) => {\n        if (qss.name === action.questName) {\n          const scene = qss.scene;\n          if (!scene) throw new Error('Something broke. No scene');\n          const objects = scene.objects.map(o => {\n            if (isActorObject(o) && o.name === action.actor) {\n              // todo\n              // const health = o.health + action.health;\n              const health = 23;\n              return {\n                ...o,\n                health,\n              };\n            }\n            return o;\n          });\n\n          return {\n            ...qss,\n            scene: {\n              ...scene,\n              objects,\n            },\n          };\n        }\n        return qss;\n      });\n    }\n\n    // case \"updateSceneObjectAction\": {\n    //   return state.map((qss) => {\n    //     if (qss.name === action.questName) {\n    //       const scene = qss.scene;\n    //       if (!scene) throw new Error(\"Something broke. No scene\");\n\n    //       scene.objects = scene.objects.map(tO => {\n    //         if (tO.id === action.id) {\n    //           return {\n    //             ...tO,\n    //             ...action.object\n    //           }\n    //         }\n    //         return tO;\n    //       })\n\n    //       return {\n    //         ...qss,\n    //         scene\n    //       };\n    //     }\n    //     return qss;\n    //   });\n    // }\n\n    case 'setActorLocation': {\n      return state.map((qss) => {\n        if (qss.name === action.questName) {\n          const scene = qss.scene;\n          if (!scene) throw new Error('Something broke. No scene');\n\n          scene.objects = scene.objects.map(o => {\n            if (getUniqueName(o) === action.actor) {\n              const location = action.location;\n              return {\n                ...o,\n                location,\n              };\n            }\n            return o;\n          });\n\n          return {\n            ...qss,\n            scene,\n          };\n        }\n        return qss;\n      });\n    }\n\n    case 'setActiveSceneInteractionModal': {\n      return state.map((qss: QuestStoreState) => {\n        if (qss.name === action.questName && qss.scene) {\n          qss.scene.activeInteractionModal = action.sceneInteractionModal;\n        }\n        return qss;\n      });\n    }\n\n    case 'gameTick': {\n      const questsToUpdate = action.quests;\n      if (!questsToUpdate.length) {\n        return state;\n      }\n\n      return state.map((qss) => {\n        const questToUpdate = questsToUpdate.find((q) => q.name === qss.name);\n        if (questToUpdate) {\n          const progress = questToUpdate.progress;\n          // const currentEncounter = questToUpdate.currentEncounter;\n\n          return {\n            ...qss,\n            progress,\n            // currentEncounter,\n          };\n        }\n        return qss;\n      });\n    }\n  }\n  return state;\n};\n\n\n","import { Reducer } from 'redux';\nimport { ResourceStoreState } from 'store/types/resources';\nimport { Resource } from 'definitions/resources';\nimport { ResourcesAction } from 'store/actions/resources';\nimport { GameAction } from 'store/actions/game';\n\nexport const initialResourcesState: ResourceStoreState = {\n  fabric: 0,\n  food: 0,\n  iron: 10,\n  leather: 0,\n  stone: 0,\n  wood: 10,\n};\n\n// eslint-disable-next-line @typescript-eslint/default-param-last\nexport const resources: Reducer<ResourceStoreState, ResourcesAction | GameAction> = (state = initialResourcesState, action) => {\n\n  const addResources = (resourcesToAdd: ResourceStoreState) => {\n    // todo: Check if warehouse can hold it\n    return Object.keys(state).reduce<ResourceStoreState>((acc, value) => {\n      const resource = value as Resource;\n      acc[resource] = (state[resource] ?? 0) + (resourcesToAdd[resource] || 0);\n      return acc;\n    }, {});\n  };\n\n  switch (action.type) {\n    case 'addResources': {\n      const resourcesToAdd = action.resources;\n      return addResources(resourcesToAdd);\n    }\n    case 'removeResources': {\n      const resourcesToRemove = action.resources;\n      return Object.keys(state).reduce<ResourceStoreState>((acc, value) => {\n        const resource = value as Resource;\n        acc[resource] = (state[resource] ?? 0) - (resourcesToRemove[resource] || 0);\n        return acc;\n      }, {});\n    }\n\n    case 'gameTick': {\n      const resourcesToAdd = action.resources;\n      if (resourcesToAdd === null) {\n        return state;\n      }\n      return addResources(resourcesToAdd);\n    }\n  }\n  return state;\n};\n\n","import { Reducer } from 'redux';\nimport { State as seedrandomStateType } from 'seedrandom';\nimport { GameAction } from 'store/actions/game';\n\nexport const initialRngState = {};\n/**\n * reducer\n * @param state\n * @param action\n */\n// eslint-disable-next-line @typescript-eslint/default-param-last\nexport const rngState: Reducer<seedrandomStateType, GameAction> = (state = initialRngState, action) => {\n  if (action.type === 'gameTick' && action.rngState != null) {\n    state = Object.assign({}, action.rngState);\n  }\n  return state;\n};\n","import { Reducer } from 'redux';\nimport { SettingsAction } from 'store/actions/settings';\nimport { SettingsState } from 'store/types/settings';\n\n\nexport const initialSettingsState: SettingsState = {\n  verboseCombatLog: false,\n  debugEnableDebugDrawer: true,\n  debugSceneShowPathable: false,\n  debugSceneShowCellLocations: false,\n  debugSceneShowActionQueue: false,\n};\n\n/**\n * reducer\n * @param state\n * @param action\n */\n// eslint-disable-next-line @typescript-eslint/default-param-last\nexport const settings: Reducer<SettingsState, SettingsAction> = (state = initialSettingsState, action) => {\n  switch (action.type) {\n    case 'setSetting': {\n      return {\n        ...state,\n        [action.setting]: action.value,\n      };\n    }\n  }\n  return state;\n};\n","import { Reducer } from 'redux';\nimport { isProductionStructure, isResourceStructure, ResourceStructure, Structure } from 'definitions/structures';\nimport { ProductionStructureStoreState, StructureState, StructureStoreState } from 'store/types/structure';\nimport { StructuresStoreState } from 'store/types/structures';\nimport { StructuresAction } from 'store/actions/structures';\nimport { GameAction } from 'store/actions/game';\nimport { Item } from 'definitions/items/types';\n\n\nconst updateStructureState = (state: StructuresStoreState, structure: Structure, structureState: StructureState) => {\n  const structureStore: StructureStoreState = {\n    ...state[structure],\n    state: structureState,\n  };\n  return {\n    ...state,\n    [structure]: structureStore,\n  };\n};\n\nconst structureInitialState: StructureStoreState = {\n  level: 0,\n  state: StructureState.NotBuilt,\n  workers: 0,\n};\n\nexport const initialStructuresState: StructuresStoreState = {\n  alchemist: { ...structureInitialState, produces: [ ] },\n  armoursmith: { ...structureInitialState, produces: [ 'apparel/boots1' ] },\n  garden: { level: 0, workers: 0, state: StructureState.Built  }, // TODO: change back to NotBuilt\n  lumberMill: structureInitialState,\n  mine: { level: 0, workers: 0, state: StructureState.NotBuilt  },\n  quarry: structureInitialState,\n  tavern: { level: 2, workers: 0, state: StructureState.Built },\n  tannery: structureInitialState,\n  warehouse: { level: 0, workers: 0, state: StructureState.Built },\n  weaponsmith:  { ...structureInitialState, produces: [ 'weapon/simpleCrossbow', 'weapon/dagger' ] },\n  weaver: structureInitialState,\n  workshop: { ...structureInitialState, produces: [ 'questItem/torch', 'questItem/sandwich' ] },\n};\n\n\n/**\n * reducer\n * @param state\n * @param action\n */\n// eslint-disable-next-line @typescript-eslint/default-param-last\nexport const structures: Reducer<StructuresStoreState, StructuresAction | GameAction> = (state = initialStructuresState, action) => {\n  switch (action.type) {\n    case 'startBuildingStructure': {\n      return updateStructureState(state, action.structure, StructureState.Building);\n    }\n\n    case 'finishBuildingStructure': {\n      return updateStructureState(state, action.structure, StructureState.Built);\n    }\n\n    case 'upgradeStructure': {\n      // Upgrade to next level\n      const level = state[action.structure].level + 1;\n      const structureStore: StructureStoreState = {\n        ...state[action.structure],\n        level,\n      };\n      return {\n        ...state,\n        [action.structure]: structureStore,\n      };\n    }\n\n    case 'increaseWorkers': {\n      const { workers: workersToAdd } = action;\n      const workers = state[action.structure].workers + workersToAdd;\n      const structureStore: StructureStoreState = {\n        ...state[action.structure],\n        workers,\n      };\n      return {\n        ...state,\n        [action.structure]: structureStore,\n      };\n    }\n\n    case 'decreaseWorkers': {\n      const { workers: workersToRemove } = action;\n      const workers = state[action.structure].workers - workersToRemove;\n      const structureStore: StructureStoreState = {\n        ...state[action.structure],\n        workers,\n      };\n      return {\n        ...state,\n        [action.structure]: structureStore,\n      };\n    }\n\n    case 'setStructureState': {\n      const { state: structureState } = action;\n      return updateStructureState(state, action.structure, structureState);\n    }\n\n    case 'addItemToToProduces': {\n      // Adds given item to a structures' `produces` list\n      if (!isProductionStructure(action.structure)){\n        return state;\n      }\n      const { item } = action;\n      const produces = [\n        ...(state[action.structure] as ProductionStructureStoreState).produces,\n        item,\n      ];\n      const structureStore: ProductionStructureStoreState = {\n        ...state[action.structure],\n        produces,\n      };\n      return {\n        ...state,\n        [action.structure]: structureStore,\n      };\n    }\n\n    case 'removeItemFromHarvest': {\n      // Should always be false but typescript doesnt know that\n      if (!isResourceStructure(action.structure)) return state;\n      const harvest = state[action.structure].harvest?.filter((h, i) => (i !== action.index));\n      return {\n        ...state,\n        [action.structure]: {\n          ...state[action.structure],\n          harvest,\n        },\n      };\n    }\n\n    case 'gameTick': {\n      if (!action.harvest || !Object.keys(action.harvest)?.length) {\n        return state;\n      }\n      // Copies harvest from harvest into structure\n      return Object.keys(state).reduce<StructuresStoreState>((acc, structureAsString) => {\n        const structure = structureAsString as Structure;\n        if (isResourceStructure(structure) && action.harvest?.[structure]?.length){\n          const harvest: Item[] = (action.harvest[structure] ?? []).map(type => ({ type }));\n          acc[structure as ResourceStructure].harvest = [\n            ...(acc[structure as ResourceStructure].harvest ?? []),\n            ...harvest,\n          ];\n        }\n        return acc;\n      }, state);\n    }\n  }\n  return state;\n};\n\n","import { AnyAction } from 'redux';\n\nexport enum TaskType {\n  buildStructure,\n  upgradeStructure,\n  craftItem,\n  studyItem,\n}\n\nexport interface TaskStoreState {\n  type: TaskType;\n  name: string;\n  origin: string;\n  startTime: number;    // time the task was scheduled\n  lastTick: number;     // time of last tick\n  timeRemaining: number;\n  progress: number;     // value between 0 and 1 indicating progress\n  callbacks: AnyAction[];\t  // actions to dispatch on complete\n}\n","\nimport { TaskAction } from 'store/actions/tasks';\nimport { Reducer } from 'redux';\nimport { TaskStoreState } from 'store/types/task';\nimport { TasksStoreState } from 'store/types/tasks';\nimport { GameAction } from 'store/actions/game';\n\nconst createTask = (action: TaskAction): TaskStoreState => {\n  return {\n    name: action.name,\n    origin: action.origin,\n    type: action.taskType,\n    callbacks: action.callbacks,\n    timeRemaining: action.time,\n    startTime: Date.now(),\n    lastTick: Date.now(),\n    progress: 0,\n  };\n};\n\nexport const initialTasksState: TasksStoreState = {\n  completed: [],\n  running: [],\n};\n\n/**\n * Tasks reducer\n * @param state\n * @param action\n */\n// eslint-disable-next-line @typescript-eslint/default-param-last\nexport const tasks: Reducer<TasksStoreState, TaskAction | GameAction> = (state: TasksStoreState = initialTasksState, action) => {\n  switch (action.type) {\n    case 'start': {\n    // Adds a new task to the running tasks\n      const task: TaskStoreState = createTask(action);\n      const running = state.running.concat(task);\n      return {\n        ...state,\n        running,\n      };\n    }\n    case 'gameTick': {\n      // Will update all tasks in `running`. If a running task expires it is placed in `complete`\n      // Note that completed tasks must be handled BEFORE the next call to ActionType.update, because\n      // this list is recreated every time\n      const now: number = Date.now();\n      const running: TaskStoreState[] = [];\n      const completed: TaskStoreState[] = [];\n      state.running.forEach((t) => {\n        const end = now + t.timeRemaining;\n        const progress = (now - t.startTime) / (end - t.startTime);\n        const timeRemaining = t.timeRemaining - (now - t.lastTick);\n        const task = {\n          ...t,\n          progress,\n          lastTick: now,\n          timeRemaining,\n        };\n        if (timeRemaining < 0) {\n          completed.push(task);\n        } else {\n          running.push(task);\n        }\n      });\n\n      return {\n        running,\n        completed,\n      };\n    }\n    case 'reduceTime': {\n      if (action.percentage < 0 || action.percentage > 100) return state;\n      if (action.time === 'task') {\n        const running: TaskStoreState[] = [];\n        state.running.forEach((t) => {\n          const timeRemaining = t.timeRemaining / 100 * action.percentage;\n          if (t.name === action.what) {\n            const task = {\n              ...t,\n              timeRemaining,\n            };\n            running.push(task);\n          } else {\n            running.push(t);\n          }\n        });\n        return {\n          ...state,\n          running,\n        };\n      }\n      return state;\n    }\n  }\n  return state;\n};\n","import { combineReducers } from 'redux';\nimport { StoreState } from 'store/types';\nimport { adventurers, initialAdventurers } from './adventurers';\nimport { engine, getInitialEngineState } from './engine';\nimport { game, initialGameState } from './game';\nimport { gold, initialGoldState } from './gold';\nimport { getInitialStockpile, stockpile } from './stockpile';\nimport { initialLogState, log } from './log';\nimport { initialQuestState, quests } from './quests';\nimport { initialResourcesState, resources } from './resources';\nimport { initialRngState, rngState } from './rngState';\nimport { initialSettingsState, settings } from './settings';\nimport { initialStructuresState, structures } from './structures';\nimport { initialTasksState, tasks } from './tasks';\nimport { initialWorkersState, workers } from './workers';\nimport { Action } from 'store/actions';\n\nexport const combinedReducer = combineReducers<StoreState>({\n  adventurers,\n  engine,\n  game,\n  gold,\n  stockpile,\n  log,\n  quests,\n  resources,\n  rngState,\n  settings,\n  structures,\n  tasks,\n  workers,\n});\n\n\nexport const createInitialStore = () => ({\n  adventurers: initialAdventurers,\n  engine: getInitialEngineState(),\n  game: initialGameState,\n  gold: initialGoldState,\n  stockpile: getInitialStockpile(),\n  log: initialLogState,\n  quests: initialQuestState,\n  resources: initialResourcesState,\n  rngState: initialRngState,\n  settings: initialSettingsState,\n  structures: initialStructuresState,\n  tasks: initialTasksState,\n  workers: initialWorkersState,\n});\n\n// eslint-disable-next-line @typescript-eslint/default-param-last\nconst rootReducer = (state: StoreState = createInitialStore(), action: Action) => {\n  switch (action.type) {\n    case 'loadGame':\n      return action.state;\n    default:\n      return combinedReducer(state, action);\n  }\n};\n\nexport default rootReducer;\n\n","import { GoldAction } from 'store/actions/gold';\nimport { Reducer } from 'redux';\n\nexport const initialGoldState = 40;\n/**\n * reducer\n * @param state\n * @param action\n */\n// eslint-disable-next-line @typescript-eslint/default-param-last\nexport const gold: Reducer<number, GoldAction> = (state = initialGoldState, action) => {\n  switch (action.type) {\n    case 'addGold':\n      // Adds (or subtract, if negative) gold from the players gold supply\n      return state + action.amount;\n  }\n  return state;\n};\n\n","import { Reducer } from 'redux';\nimport { WorkersAction } from 'store/actions/workers';\n\nexport const initialWorkersState = 13;\n\n/**\n * reducer\n * @param state\n * @param action\n */\n// eslint-disable-next-line @typescript-eslint/default-param-last\nexport const workers: Reducer<number, WorkersAction> = (state = initialWorkersState, action) => {\n  switch (action.type) {\n    case 'addWorkers':\n      // Adds (or subtract, if negative) from the players workers\n      return state + action.value;\n  }\n  return state;\n};\n\n","import { createStore, DeepPartial, applyMiddleware, Middleware, Store } from 'redux';\nimport { Persistor, persistReducer, persistStore } from 'redux-persist';\nimport { composeWithDevTools } from 'redux-devtools-extension';\nimport localForage from 'localforage';\nimport * as Version from 'constants/version';\nimport rootReducer from 'store/reducers';\nimport { storeIsRehydrated } from 'store/helpers/storeHelpers';\nimport { StoreState } from 'store/types';\nimport { effectsMiddleware } from 'store/middleware/effects';\nimport { traitsMiddleware } from 'store/middleware/traits';\nimport { convertIntToSemVer } from './version';\nimport { Action } from 'store/actions';\nimport { PersistPartial } from 'redux-persist/es/persistReducer';\n\nexport const PERSIST_KEY = 'root';\n\nexport const persistConfig = {\n  key: PERSIST_KEY,\n  storage: localForage,\n  version: Version.asInt,\n};\n\nconst persistedReducer = persistReducer<StoreState, Action>(persistConfig, rootReducer);\n\ninterface ConfigureStoreResult {\n  store: Store;\n  persistor: Persistor;\n  isHydrated: boolean;\n}\n\n// all middlewares\nconst middlewares: Middleware[] = [\n  effectsMiddleware,\n  traitsMiddleware,\n];\nconst middlewareEnhancer = applyMiddleware(...middlewares);\n\n/**\n * Configures the redux store\n */\nconst configureStore = async (initial: DeepPartial<StoreState> = {}): Promise<ConfigureStoreResult> => {\n  return new Promise((resolve, reject) => {\n    try {\n      const version = initial?.game?.version ? convertIntToSemVer(initial.game.version) : Version.default;\n      const composeEnhancers = composeWithDevTools({\n        name: `Gidletown (${version})`,\n      })(middlewareEnhancer);\n\n      const store = createStore(\n        persistedReducer,\n        (initial as StoreState & PersistPartial),\n        composeEnhancers,\n      );\n      const persistor = persistStore(store, undefined, () => {\n        const isHydrated = storeIsRehydrated(store.getState());\n        resolve({ store, persistor, isHydrated }) ;\n      });\n    } catch (e) {\n      console.error('An error has occurred', e);\n      reject(e);\n    }\n  });\n};\n\nexport default configureStore;\n","import { collectEffects } from 'definitions/effects';\nimport { Effect, EffectType } from 'definitions/effects/types';\nimport { getDefinition, isConsumable } from 'definitions/items/consumables';\nimport { createTempEffect } from 'definitions/tempEffects';\nimport { TempEffectSoma, TempEffectType } from 'definitions/tempEffects/types';\nimport { Middleware } from 'redux';\nimport { Action } from 'store/actions';\nimport { addTempEffect, decreaseEffectCharge, modifyHealth } from 'store/actions/adventurers';\nimport { StoreState } from 'store/types';\nimport { SceneActionType } from 'store/types/scene';\nimport { lastAdventurerAction, AppMiddlewareAPI } from './utils';\n\nconst effectTick = (storeApi: AppMiddlewareAPI, effect: Effect, adventurerId: string) => {\n  if (effect.charges) {\n    storeApi.dispatch(decreaseEffectCharge(adventurerId, effect));\n  }\n};\n\nexport const effectsMiddleware: Middleware<unknown, StoreState> = (storeApi: AppMiddlewareAPI) => next => (action: Action) => {\n  const state = storeApi.getState();\n\n  for (const adventurer of state.adventurers) {\n    const lastAction = lastAdventurerAction(adventurer, action, storeApi);\n    const effects = collectEffects(adventurer);\n    effects.forEach(effect => {\n      switch (effect.type) {\n        case EffectType.healthDecreaseOnMove: {\n          // Broken legs effect reduces health at every move\n          if (lastAction === SceneActionType.move) {\n            storeApi.dispatch(modifyHealth(adventurer.id, -5));\n\n            effectTick(storeApi, effect, adventurer.id);\n          }\n        }\n      }\n    });\n  }\n\n  switch (action.type) {\n    case 'consumeItem': {\n      // Apply effect after consuming item\n      const { adventurerId, fromSlot } = action;\n      const adventurer = state.adventurers.find((a) => a.id === adventurerId);\n      if (!adventurer) {\n        throw new Error(`No adventurer ${adventurerId} found`);\n      }\n      const consumable = adventurer.inventory[fromSlot];\n      if (!consumable || !isConsumable(consumable.type)) {\n        throw new Error(`No potion found at index ${fromSlot} `);\n      }\n      const definition = getDefinition(consumable.type);\n      switch (definition.category) {\n        case 'soma': {\n          const tempEffect = createTempEffect<TempEffectSoma>({\n            type: TempEffectType.soma,\n            factor: definition.effect ?? 1,\n          });\n          storeApi.dispatch(addTempEffect(adventurerId, tempEffect));\n        }\n      }\n    }\n  }\n\n  next(action);\n};\n\n\n","import { MiddlewareAPI, Dispatch } from 'redux';\nimport { Action } from 'store/actions';\nimport { findQuestByAdventurer } from 'store/helpers/storeHelpers';\nimport { StoreState } from 'store/types';\nimport { AdventurerStoreState } from 'store/types/adventurer';\nimport { getUniqueName } from 'store/types/scene';\n\nexport type AppMiddlewareAPI = MiddlewareAPI<Dispatch<Action>, StoreState>;\n\n/**\n * If the adventurer just completed a scene action returns the corresponding SceneActionType\n */\nexport const lastAdventurerAction = (adventurer: AdventurerStoreState, action: Action, storeApi: AppMiddlewareAPI) => {\n  if (action.type === 'completeSceneAction') {\n    const state = storeApi.getState();\n    const quest = findQuestByAdventurer(adventurer, state.quests);\n    const sceneAction = quest?.scene?.actionQueue?.[0];\n    if (sceneAction?.intent.actor && getUniqueName(sceneAction.intent.actor) === adventurer.id) {\n      return quest?.scene?.actionQueue?.[0].intent.action;\n    }\n  }\n};\n\n","import { Middleware } from 'redux';\nimport { Action } from 'store/actions';\nimport { StoreState } from 'store/types';\nimport { /*lastAdventurerAction, */ AppMiddlewareAPI } from './utils';\n\nexport const traitsMiddleware: Middleware<\nunknown,\nStoreState\n> = (_storeApi: AppMiddlewareAPI) => next => (action: Action) => {\n  // const state = storeApi.getState()\n\n  //for (const adventurer of state.adventurers) {\n  // const lastAction = lastAdventurerAction(adventurer, action, storeApi);\n  // (adventurer.traits ?? []).forEach(trait => {\n\n  // })\n  //}\n  next(action);\n};\n\n","import { TaskStoreState, TaskType } from 'store/types/task';\nimport { TasksStoreState } from 'store/types/tasks';\nimport { AnyAction, Dispatch } from 'redux';\nimport { ToastManager } from 'global/ToastManager';\nimport { TextManager } from 'global/TextManager';\nimport { Type } from 'components/ui/toasts/Toast';\nimport { getDefinition } from 'definitions/items';\nimport { ItemType } from 'definitions/items/types';\n\nexport const processCompletedTasks = (tasks: TasksStoreState, dispatch: Dispatch<AnyAction>) => {\n  const handleCompletedTask = (task: TaskStoreState) => {\n    // Fire all callbacks\n    task.callbacks.forEach((action) => dispatch(action));\n\n    switch (task.type) {\n      case TaskType.craftItem: {\n        const type = task.name as ItemType;\n        const item = { type };\n        const title = TextManager.get('common-item-crafted', { item });\n        const definition = getDefinition(type);\n        ToastManager.addToast(title, Type.itemCrafted, definition.iconImg);\n        break;\n      }\n    }\n  };\n\n  tasks.completed.forEach((task) => handleCompletedTask(task));\n};\n","import './styles/loadingSpinner.scss';\n\nconst LoadingSpinner = () => {\n  const rings = 5;\n  return (\n    <div className=\"loading-spinner\">\n    {[...Array(rings)].map((e, i) => (\n      <div className=\"ring\" key={i}>\n        <div className=\"inner\"/>\n      </div>\n    ))}\n    </div>\n  );\n};\nexport default LoadingSpinner;\n","import * as PIXI from 'pixi.js';\nimport { IHitArea } from 'pixi.js';\n// Adapted from https://github.com/explooosion/hitarea-shapes/blob/master/src/index.js\n\nexport default class HitAreaShapes implements IHitArea {\n  public shapes: PIXI.Polygon[];\n\n  constructor(shapes: { [key: string]: { shape: number[] }[] } = {}, sprite = '0') {\n\n    this.shapes = shapes[sprite].map((definition: { shape: number[]; }) => {\n      const shape: number[] = definition.shape;\n      return new PIXI.Polygon(shape);\n    });\n  }\n\n  /**\n   * Called by hitArea\n   * @param {number} x\n   * @param {number} y\n   */\n  contains(x = 0, y = 0) {\n    return (!this.shapes || this.shapes.length === 0)\n      ? false\n      : this.shapes.some(shape => shape.contains(x, y));\n  }\n}\n","import { AppContext } from 'components/App';\nimport * as React from 'react';\nimport { Component, ComponentType } from 'react';\n\n// Sharing context within the entire App\nexport interface AppContextProps {\n  onOpenWindow: (window: React.ReactElement) => void;\n  onCloseWindow: () => void;\n}\n\nexport const withAppContext = <TWrappedComponentProps extends AppContextProps>(WrappedComponent: ComponentType<TWrappedComponentProps>) => {\n  type WrappedComponentPropsExceptProvided = Exclude<keyof TWrappedComponentProps, keyof AppContextProps>;\n  type ForwardedProps = Pick<TWrappedComponentProps, WrappedComponentPropsExceptProvided>;\n  return class WithContext extends Component<ForwardedProps> {\n    public render() {\n      return (\n        <AppContext.Consumer>\n          { // eslint-disable-next-line @typescript-eslint/no-explicit-any\n           (context: any) => <WrappedComponent {...this.props } {...context} />}\n        </AppContext.Consumer>\n      );\n    }\n  };\n};\n","import { forwardRef, PropsWithChildren } from 'react';\nimport { Viewport as PixiViewport } from 'pixi-viewport';\nimport { PixiComponent, useApp } from '@inlet/react-pixi';\nimport gauntlet from 'components/App/styles/img/cursors/dwarven_gauntlet_extra_6.png';\nimport { InteractionEvent, Application, Ticker } from 'pixi.js';\n\ninterface Props {\n  onClick?(event: InteractionEvent): void;\n  screenWidth: number,\n  screenHeight: number,\n  worldWidth: number,\n  worldHeight: number,\n  minScale?: number;\n  maxScale?: number;\n}\n\ninterface PixiComponentProps {\n  app: Application;\n}\n\nconst PixiComponentViewport = PixiComponent('Viewport', {\n  create: (props: PixiComponentProps & Props) => {\n    const viewport = new PixiViewport({\n      screenWidth: props.screenWidth,\n      screenHeight: props.screenHeight,\n      worldWidth: props.worldWidth,\n      worldHeight: props.worldHeight,\n      ticker: Ticker.shared,\n      interaction: props.app.renderer.plugins.interaction,\n      // the interaction module is important for wheel to work properly when renderer.view is placed or scaled\n    });\n    viewport.on('clicked', (event) => { if (props.onClick) props.onClick(event); });\n\n    const {\n      minScale = 1,\n      maxScale = 2,\n    } = props;\n\n    viewport\n      .drag()\n      .pinch()\n      .wheel()\n      .clamp({ direction: 'all' })\n      .clampZoom({ minScale, maxScale })\n      .decelerate();\n\n    return viewport as unknown as PixiViewport;\n  },\n});\n\n/** Viewport leverages pixi-viewport to create a pannable map\n * https://davidfig.github.io/pixi-viewport/jsdoc/\n */\nconst Viewport = forwardRef<PixiViewport, PropsWithChildren<Props>>((props, ref) => {\n  const app = useApp();\n  if (app) {\n    // Perhaps this is better moved somewhere else\n    const cursor = `url('${gauntlet}'), auto`;\n    app.renderer.plugins.interaction.cursorStyles.pointer = cursor;\n  }\n  return <PixiComponentViewport app={app} {...props} ref={ref} />;\n});\nViewport.displayName = 'Viewport';\nexport default Viewport;\n","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAgCAYAAAABtRhCAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAB3RJTUUH3gMODzc3YHmYGgAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAE50lEQVRIx7WXW0wcVRjHfzO7y16YZbfAytACvbjU1hqkLVZMbbSXBEPUNjX6YDYanwYfTXzxrb7qm0lTJ018QhOjaWI0trFYbRoqpYVuwy2UpRS2lAF22YUdtuxt1ofKCIXShaZfMjm37+Q33zn/cxMURWHRVFXNAyiKIvCMTFwKO6Ne4ONPTpngZwoE6Lx6FYCDhwLPDLoMeKPtV8b6ewkEAssiVVU1v/gtLS+dhnUDFUUResZvUhLXuNF+ZVmkBw8F6B+4b5avXR8x82fUC+uCWhoaGsxCV1fXKZelGOvMNPcXspw9+zV60s3MzAweTwXJZBLJXYXPt8XMJ5NJbgX/pqGh4ctCgNalBUVRhId/u5tsQqf9UpDGxkZCoRCtra2mX2trK5qmAZhpoWZdrTIvCOyQihn8/RydsQSVm6uQJAnZ6zV9MjYbkUgEAL/fj6p+my9kOYmPViiKIgQn+8mLIv1jowSONtN0+OgyGEAkEkHXdTRNQ5Kkjal0qY3MJciLIsdOvslYXy9xbXxZu67rAEiSZOafCtgzfpM8Al2/deDEwJZOrYAu2lNFqKpq/rPjLTTtbWY0Psu1jovUVm7Hmk1jS6eYmXooEiH//0pYj3BWFc2RukM4HpxHMAz6x0aRvT1scfsYT0yTTwnEtXEsuQzxhbQ5j08F/O7H0+zz+ThQWsK52yGuBNs5XPcqllwOVzrOjv2HsZaXsuv1OtySnYSeort7kE+Vt56o1FWBo7EollwGQ7Sww13McHyWbE8n9VVVNLzWzMDkXSYGujl/uY1wNIamaciybO4+a0FXXRbd04P8PHydu/EYtmwaSy7NaCzOi0eO09F5kfk7/bhSSZ4T8zQ2NiLLMgCyLPPe+5+vudWtqlJFUYRF8MhsHNHIcXKnn86rfxK8P4Etk8G5kKR4YZ758F1OnDixrP9aUHGt8V6ExlMLbLP7GBoeAkGkxuWhKJfFlUoiJRNE7o0TCARM8UiS9NgjTnySqhRFEUZmR/jm5l9YsynGolG0RJQqpwd7OoU0P0dqZJD0TJyWlhZzU/D7/Txfe2wFVCxUzttLPNyaGEc0svx0+zZVW/cD4Eo/wJuIkevtwZiKLhteWZZXQAsGdk9PscluRzByODxlnL78Aw17mpDdZdizGUr0GNEbndRvKeeD5rcpLy83oRWVjeuLUFEUYTQ+jMfpwutw4CgpJVmzm6/++QVDtFDpLkU0DLxzUabbB6ir9vHGtp3mxi5JkhmluJ6zzONw/pfaMUSR0HyaL6530zYRBmBz7QFqj9YhSQ5efsXPQjxS2MJ/nJUUS8zEZ/G4nPSEQgyHLj08kCehtQuqy66w94/vEfIGNaVliEYGr6No40AAj9OBkDcYHmpb0RaO9hGO9lFdtodubQqAovQCG1IpgGgYlNlsbCqyrekXjvaZ+SlD3Dgwoc9hyWU4WP1SQf6lNbXouo6u6+ZtvmCgoihCcErDks2QCA3w4YF3ngjz+/1omsbkRMfG5nBkdoQ7bjeEe9hVVsZHe5u4FB7nXqTX9Kmvf5eKys3IskwwGGR4qG3ZW0VY+pgpxFRVze/zvcBWbylep5OMzY5hsVLsLiFd5MTqq+DedJRQKLQCtiHg0uv91k21uF1uPE4XhsVC1monlsqSmE8yOdGx6itsQ8BHwavN9+P6/Avf+1eTf20QhwAAAABJRU5ErkJggg==\"","import React from 'react';\nimport { ReactReduxContext, Provider } from 'react-redux';\nimport { Stage } from '@inlet/react-pixi';\n\n// Contexts are not passed through the reconcilers with the new Context API.\n// This means we lose the redux context\n// Create a wrapper component that consumes the context and provides it again in the new reconciler context:\n// https://github.com/inlet/react-pixi/issues/77\nconst BridgedStage = (props: React.ComponentProps<typeof Stage>) => {\n  const { children, ...restProps } = props;\n  return (\n    <ReactReduxContext.Consumer>\n      {({ store }) => (\n        <Stage {...restProps}>\n          <Provider store={store}>\n            {children}\n          </Provider>\n        </Stage>\n      )}\n    </ReactReduxContext.Consumer>\n  );\n};\n\nexport default BridgedStage;\n","import { useRef, useEffect, PropsWithChildren, forwardRef, useImperativeHandle } from 'react';\nimport { Sprite } from '@inlet/react-pixi';\nimport { Viewport as PixiViewport } from 'pixi-viewport';\nimport Viewport from 'components/pixi/Viewport';\nimport { gsap } from 'gsap';\nimport { GodrayFilter } from '@pixi/filter-godray';\nimport BridgedStage from 'components/pixi/util/BridgedStage';\n\nexport interface Props {\n  screenWidth: number;\n  screenHeight: number;\n  worldWidth: number;\n  worldHeight: number;\n  blockScroll: boolean;\n}\n\nexport const godray = new GodrayFilter();\n\nconst options = {\n  autoDensity: true,\n  sharedLoader: true,\n};\n\n\nconst TownStage = forwardRef<PixiViewport, PropsWithChildren<Props>>((props, ref: React.Ref<PixiViewport>) => {\n  const {\n    children,\n    screenWidth,\n    screenHeight,\n    worldWidth,\n    worldHeight,\n    blockScroll,\n  } = props;\n\n  const innerRef = useRef<PixiViewport>(null);\n\n  useImperativeHandle(ref, () => {\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    return innerRef.current!;\n  });\n\n\n  useEffect(() => {\n    godray.enabled = false;\n    if (innerRef.current) {\n\n      const viewport = innerRef.current;\n      viewport.on('moved', () => {\n        const horizontalFactor = gsap.utils.normalize(viewport.screenWidth, worldWidth, viewport.right);\n        const verticalFactor = gsap.utils.normalize(worldHeight, viewport.screenHeight, viewport.bottom);\n        const factor = Math.max(horizontalFactor * verticalFactor - .4, 0);\n\n        godray.gain =  factor;\n        godray.lacunarity = 2.4;\n        godray.enabled = godray.gain > 0;\n      });\n    }\n\n    const onScroll = (e: WheelEvent) => {\n      // Scrolling the mouse is just used for zoom, not for actual scrolling\n      e.preventDefault();\n    };\n\n    if (blockScroll) {\n      window.addEventListener('wheel', onScroll, { passive: false });\n    }\n    return () => {\n      window.removeEventListener('wheel', onScroll);\n    };\n  }, [blockScroll, worldHeight, worldWidth]);\n\n  return (\n    <BridgedStage width={screenWidth} height={screenHeight} options={options} >\n      <Viewport\n        screenWidth={screenWidth}\n        screenHeight={screenHeight}\n        worldWidth={worldWidth}\n        worldHeight={worldHeight}\n        ref={innerRef}>\n        <Sprite\n          name=\"background\"\n          image={`${process.env.PUBLIC_URL}/img/town/town-alpha/background.png`}\n          filters={[godray]}\n        >\n          {children}\n        </Sprite>\n      </Viewport>\n    </BridgedStage>\n\n  );\n});\nTownStage.displayName = 'TownStage';\n\nexport default TownStage;\n","import * as React from 'react';\nimport { PropsWithChildren } from 'react';\nimport './styles/button.scss';\n\nexport enum ButtonSize {\n  auto, // will select either medium or small, depending on screen size\n  large,\n  medium,\n  small,\n}\n\nexport enum ButtonColor {\n  blue = 'blue',\n  purple = 'purple',\n  green = 'green',\n}\n\nexport type Props = PropsWithChildren<{\n  text?: string;\n  color?: ButtonColor | keyof typeof ButtonColor; // Can use enum or string\n  size?: ButtonSize | keyof typeof ButtonSize; // Can use enum or string\n  className?: string;\n  disabled?: boolean;\n  square?: boolean;\n  onClick?: React.MouseEventHandler<Element>;\n}>;\n\n\nconst Button = (props: React.ComponentProps<'button'> & Props) => {\n  const { color, square, text, ...otherProps } = props;\n\n  const handleClick = (e: React.MouseEvent<HTMLButtonElement>) => {\n    props.onClick?.(e);\n  };\n\n  const className = [\n    'button',\n    (props.className ?? ''),\n    `button-${typeof color === 'string' ? color : ButtonColor[color ?? ButtonColor.blue]}`,\n    `button-${typeof props.size === 'string' ? props.size : ButtonSize[props.size ?? ButtonSize.auto]}`,\n    `${square ? 'button-square' : ''}`,\n  ];\n\n  return (\n    <button\n      {...otherProps}\n      className={className.join(' ')}\n      onClick={handleClick}\n    >\n      <span>\n        {!!text && text}\n        {!text && props.children}\n      </span>\n    </button>\n  );\n};\n\nexport default Button;\n","import { useState } from 'react';\nimport { Sprite, useTick } from '@inlet/react-pixi';\n\ninterface Props {\n  worldWidth: number;\n  speed?: number;\n}\n\n\nconst randomCloud = () => Math.floor(Math.random() * 2) + 1;\nconst randomY = () => Math.random() * -300 - 200;\n\nconst Clouds = (props: Props) => {\n  const { speed = 1 } = props;\n  const [cloud, setCloud] = useState(randomCloud());\n  const image = `${process.env.PUBLIC_URL}/img/town/clouds/cloud-0${cloud}.png`;\n  const [x, setX] = useState(-2000);\n  const [y, setY] = useState(randomY());\n\n  useTick((delta:number | undefined) => {\n    if (x > props.worldWidth){\n      setX(2000 - Math.random() * 1000);\n      setY(randomY());\n      setCloud(randomCloud());\n    } else {\n      setX(x + speed * (delta || 1));\n    }\n  });\n\n  return (\n    <Sprite\n      // name={`cloud ${cloud}`}\n      image={image}\n      alpha={0.8}\n      x={x}\n      y={y}\n    />\n  );\n};\n\nexport default Clouds;\n","import React, { useRef } from 'react';\nimport { clamp } from 'utils/math';\nimport './styles/progressbar.scss';\n\nexport enum Direction {\n  increasing,\n  decreasing,\n}\n\nexport interface Props {\n  progress?: number;     // between 0 and 1\n  label?: string;\n  className?: string;\n  direction?: Direction; // only used to prevent the bar from animating back to the start state\n  animationTime?: number;\n  variation?: 'normal' | 'health'\n}\n\nconst PlainProgressbar = (props: Props) => {\n  const { className = '', animationTime, variation = 'normal' } = props;\n  const previousProgress = useRef(0);\n  const progress: number = clamp(props.progress || 0, 0, 1);\n\n  previousProgress.current = progress;\n  return (\n        <div className={`progressbar progressbar--variation-${variation} ${className}`}>\n            <div className=\"progressbar-label\">{props.label}</div>\n            <div className=\"progressbar-bar\" style={{\n              width: `${progress * 100}%`,\n              ...(animationTime && { transition: `width ${animationTime}ms linear` }),\n            }}/>\n        </div>\n  );\n};\n\nexport default PlainProgressbar;\n\n","import { useCallback } from 'react';\nimport { StoreState } from 'store/types';\nimport { useSelector } from 'react-redux';\nimport { StructureStoreState } from 'store/types/structure';\nimport { getDefinition, Structure  } from 'definitions/structures';\nimport { StructureDefinition, StructureLevelDefinition } from 'definitions/structures/types';\n\n// Returns the structure state from redux store\nexport const useStructureState = <T extends StructureStoreState>(structure: Structure): T => {\n  const structureSelector = useCallback(\n    (state: StoreState) => state.structures[structure] as T,\n    [structure],\n  );\n  return useSelector<StoreState, T>(structureSelector);\n};\n\nexport const useStructureDefinition = <T extends StructureDefinition>(structure: Structure): T => {\n  const structureDefinition = getDefinition<T>(structure);\n  if (!structureDefinition) {\n    throw new Error(`No definition found for structure ${structure}.`);\n  }\n  return structureDefinition;\n};\n\nexport const useStructureLevel = <T extends StructureLevelDefinition>(structure: Structure): T => {\n  const { level } = useStructureState(structure);\n  const structureDefinition = useStructureDefinition(structure);\n  return structureDefinition.levels[level] as T;\n};\n","import * as React from 'react';\nimport { SoundManager } from 'global/SoundManager';\nimport Button from '../buttons/Button';\nimport { PropsWithChildren, useEffect } from 'react';\n\n// todo: refactor using WindowManager [30/03/2020]\nexport interface Props {\n  title: string;\n  backEnabled?: boolean;\n  closeEnabled?: boolean;\n  onClose?: () => void;\n  onBack?: () => void;\n}\n\n/**\n *\n */\nconst Window = (props: PropsWithChildren<Props>) => {\n\n  const handleClose = (_e: React.MouseEvent) => {\n    if (props.onClose) {\n      props?.onClose();\n\n      SoundManager.playSound('ui/buttonClick');\n    }\n  };\n\n  const handleBack = (_e: React.MouseEvent) => {\n    if (props.onBack) {\n      props?.onBack();\n\n      SoundManager.playSound('ui/buttonClick');\n    }\n  };\n\n  useEffect(() => {\n    SoundManager.musicFiltered = true;\n    return () => {\n      SoundManager.musicFiltered = false;\n    };\n  });\n\n  return (\n        <div className=\"window\">\n            <div className=\"header\">\n                { props.backEnabled !== false && (\n                    <Button\n                        className=\"back-button\"\n                        onClick={handleBack}\n                        square={true}\n                        size={'medium'}\n                        color=\"purple\"\n                        text=\"<\"\n                    />\n                )}\n                <h3>{ props.title }</h3>\n                { props.closeEnabled !== false && (\n                    <Button\n                        className=\"close-button\"\n                        onClick={handleClose}\n                        square={true}\n                        size={'medium'}\n                        color=\"purple\"\n                        text=\"x\"\n                    />\n                )}\n            </div>\n            { props.children }\n        </div>\n  );\n};\n\nexport default Window;\n","import Window, { Props } from 'components/ui/window/Window';\nimport * as React from 'react';\nimport 'components/ui/window/styles/window.scss';\n\nexport const withWindow = <TWrappedComponentProps extends Props>(WrappedComponent: React.ComponentType<TWrappedComponentProps>) => {\n  return class WithWindow extends React.Component<TWrappedComponentProps> {\n\n    public render() {\n      return <Window { ...this.props } >\n        <WrappedComponent { ...this.props } />\n      </Window>;\n    }\n  };\n};\n","import { useDelta } from 'hooks/store/engine';\nimport { useEffect, useState } from 'react';\nimport PlainProgressbar from './PlainProgressbar';\nimport usePrevious from 'hooks/usePrevious';\n\nexport enum Direction {\n  increasing,\n  decreasing,\n}\n\nexport interface Props {\n  progress: number;   // between 0 and 1\n  label?: string;\n  className?: string;\n  direction?: Direction; // only used to prevent the bar from animating back to the start state\n  animate?: boolean;\n}\n\nconst TickingProgressbar = (props: Props) => {\n  const { className = '', label, direction, progress = 0 } = props;\n  const previousProgress = usePrevious(progress) || 0;\n  // We use the delta time since last tick to animate\n  const delta = useDelta();\n\n  // If we have a direction defined and we're going the other direction, dont animate\n  // because we've basically reset the progress bar and we just want to animate in one direction\n  const [animate, setAnimate] = useState(false);\n\n  useEffect(() => {\n    setAnimate(\n      direction === undefined ||\n      (direction === Direction.increasing && progress > previousProgress) ||\n      (direction === Direction.decreasing && progress < previousProgress),\n    );\n  }, [direction, previousProgress, progress]);\n\n  // previousProgress.current = progress;\n  return (\n    <PlainProgressbar\n      progress={progress}\n      label={label}\n      className={className}\n      animationTime={animate ? delta : 0}\n    />\n  );\n};\n\nexport default TickingProgressbar;\n","\nimport { StoreState } from 'store/types';\nimport { useSelector } from 'react-redux';\nimport { EngineStoreState } from 'store/types/engine';\n\n// Returns the 'engine' part from redux store\nexport const useEngine = () => {\n  return useSelector<StoreState, EngineStoreState>(store => store.engine);\n};\n\nexport const useDelta = () => {\n  const engine = useEngine();\n  return Date.now() - engine.previousTick;\n};","import { useEffect, useRef } from 'react';\n\nconst usePrevious = <T>(value: T): T | undefined => {\n  const ref = useRef<T>();\n  useEffect(() => {\n    ref.current = value;\n  }, [value]);\n  return ref.current;\n};\nexport default usePrevious;\n","import { ReactNode } from 'react';\nimport { ItemType } from 'definitions/items/types';\nimport { TraitDefinition } from 'definitions/traits/types';\nimport { ActorObject } from 'store/types/scene';\nimport { Effect } from 'definitions/effects/types';\nimport { ExtendedAttribute } from 'mechanics/adventurers/attributes';\nimport { WeaponType } from 'definitions/weaponTypes/types';\n\n// Things that can be shown on the ContextPopup\nexport enum ContextType {\n  actor,\n  attribute,\n  component,\n  item,\n  resource,\n  skill,\n  tempEffect,\n  trait,\n}\n\nexport type ContextInfo = ItemType | TraitDefinition | WeaponType | string | ReactNode | ExtendedAttribute | ActorObject | Effect;\n","import { createSelector } from 'reselect';\nimport { StoreState } from 'store/types';\nimport { TasksStoreState } from 'store/types/tasks';\nimport { Structure } from 'definitions/structures';\n\nconst getTasks = (state: StoreState) => state.tasks;\n\n/*\n * Returns a selector for the store that selects all crafting tasks running for given structure */\nexport const createSelectCraftingTasksByStructure = (structure: Structure) => {\n  const craftingTasksByStructure = (tasks: TasksStoreState) => {\n    return tasks.running.filter((val) => val.origin === `${structure}.craft`);\n  };\n  return createSelector([\n    getTasks],\n  craftingTasksByStructure,\n  );\n};\n\n/*\n * Returns a selector for the store that selects all study tasks running for given structure */\nexport const createSelectStudyingTasksByStructure = (structure: Structure) => {\n  const studyingTasksByStructure = (tasks: TasksStoreState) => {\n    return tasks.running.filter((val) => val.origin === `${structure}.study`);\n  };\n  return createSelector([\n    getTasks],\n  studyingTasksByStructure,\n  );\n};\n\n/*\n * Returns a selector for the store that selects all upgrade tasks running for given structure\n * Typically 0 or 1 */\nexport const createSelectUpgradeTasksByStructure = (structure: Structure) => {\n  const upgradeTasksByStructure = (tasks: TasksStoreState) => {\n    return tasks.running.filter((val) => val.name === `${structure}.upgrade`);\n  };\n  return createSelector([\n    getTasks],\n  upgradeTasksByStructure,\n  );\n};\n","import { useSelector } from 'react-redux';\nimport { TasksStoreState } from 'store/types/tasks';\nimport { createSelectCraftingTasksByStructure, createSelectStudyingTasksByStructure, createSelectUpgradeTasksByStructure } from 'store/selectors/tasks';\nimport { Structure } from 'definitions/structures';\nimport { StoreState } from 'store/types';\n\n// Returns all the tasks from redux store\nexport const useTasksState = () => {\n  return useSelector<StoreState, TasksStoreState>(store => store.tasks);\n};\n\n// Returns all running crafting tasks for given structure\nexport const useCraftingTasksStateByStructure = (structure: Structure) => {\n  return useSelector(createSelectCraftingTasksByStructure(structure));\n};\n\n// Returns all running crafting tasks for given structure\nexport const useStudyingTasksStateByStructure = (structure: Structure) => {\n  return useSelector(createSelectStudyingTasksByStructure(structure));\n};\n\n// Returns all running update tasks for given structure\nexport const useUpgradeTasksStateByStructure = (structure: Structure) => {\n  return useSelector(createSelectUpgradeTasksByStructure(structure));\n};\n\n","import { Structure } from 'definitions/structures';\nimport './styles/structureViewHeader.scss';\n\ninterface Props {\n  structure: Structure;\n}\n\nconst StructureViewHeader = (props: Props) => {\n  // const displayName = TextManager.getStructureName(props.structure);\n  return (\n    <div className={`structureview-header structureview-header-${props.structure}`}>\n      {/* <h1 className=\"app-h1-white\">{displayName}</h1> */}\n    </div>\n  );\n};\n\nexport default StructureViewHeader;\n","import Icon, { IconSize, IconSizeType } from 'components/ui/common/Icon';\nimport { ComponentProps, PropsWithChildren } from 'react';\nimport './styles/iconButton.scss';\n\nexport type Props = PropsWithChildren<{\n  iconImg: string;\n  size?: IconSizeType; // Can use enum or string\n}>;\n\n\nconst IconButton = (props: ComponentProps<'button'> & Props) => {\n  const { iconImg, children, ...otherProps } = props;\n\n  const className = [\n    'icon-button',\n    (props.className ?? ''),\n    `size-${typeof props.size === 'string' ? props.size : IconSize[props.size ?? IconSize.medium]}`,\n  ];\n\n  return (\n    <button\n      {...otherProps}\n      className={className.join(' ')}\n    >\n      <Icon\n        image={iconImg}\n        size={props.size}\n      />\n      { children && (\n        <div className=\"text\">\n          {children}\n        </div>\n      )}\n    </button>\n  );\n};\n\nexport default IconButton;\n","import { TextManager } from 'global/TextManager';\nimport { Structure } from 'definitions/structures';\nimport { useStructureDefinition, useStructureState } from 'hooks/store/structures';\nimport Button from 'components/ui/buttons/Button';\nimport { useUpgradeTasksStateByStructure } from 'hooks/store/useTasksState';\nimport { formatDuration } from 'utils/format/time';\nimport { TickingProgressbar } from 'components/ui/common/progress';\nimport { reduceTime } from 'store/actions/game';\nimport { useDispatch } from 'react-redux';\nimport IconButton from 'components/ui/buttons/IconButton';\nimport './styles/structureLevel.scss';\n\nexport interface Props {\n  structure: Structure;\n  onHelpClicked?: (e: React.MouseEvent) => void;\n}\n\nconst StructureLevel = (props: Props) => {\n  const {\n    structure,\n    onHelpClicked,\n  } = props;\n  const dispatch = useDispatch();\n  const structureState = useStructureState(structure);\n  const level: number = structureState.level;\n  const structureDefinition = useStructureDefinition(structure);\n\n  const nextLevel = structureDefinition.levels[level + 1];\n  const upgradeText = nextLevel == null ? TextManager.get('ui-structure-upgrade-max') : TextManager.get('ui-structure-upgrade', { level: level + 2 });\n\n  const upgradeTasks = useUpgradeTasksStateByStructure(structure);\n  const handleReduceTime50 = () => {\n    if (!upgradeTasks.length) return;\n    dispatch(reduceTime(50, 'task', upgradeTasks[0].name));\n  };\n\n  if (upgradeTasks.length) {\n    const t = upgradeTasks[0];\n    return (\n      <div className=\"upgrade-progress-container\">\n        <TickingProgressbar\n          key={`${t.name}${t.startTime}`}\n          className=\"upgrading\"\n          label={`${TextManager.get('structure-upgrade-button-upgrading')} (${formatDuration(t.timeRemaining)})`}\n          progress={t.progress}\n        />\n        <IconButton iconImg=\"/img/ui/misc/clock.png\" size=\"smallest\" onClick={handleReduceTime50}>50%</IconButton>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"upgrade-stucture-button\">\n      <label>\n        {TextManager.get('ui-structure-level')}\n        { level + 1 }\n      </label>\n      <Button\n        className=\"upgrade\"\n        onClick={onHelpClicked}\n        disabled={nextLevel == null}\n      >\n        { upgradeText }\n      </Button>\n    </div>\n  );\n};\n\nexport default StructureLevel;\n","import { ContextInfo, ContextType } from 'constants/context';\nimport { ItemSource } from 'constants/items';\nimport deepEquals from 'deep-equal';\nimport EventEmitter from 'events';\nimport TypedEmitter from 'typed-emitter';\n\nexport interface Context {\n  type: ContextType;\n  info: ContextInfo;\n  source?: ItemSource;\n  referenceRect: DOMRect;\n  className?: string;\n}\n\nexport const EVENT_CONTEXT_UPDATED = 'tooltipContextUpdated';\ntype TooltipEvents = {\n  [EVENT_CONTEXT_UPDATED]: (context: Context | undefined) => void;\n};\n\nexport class TooltipManager extends (EventEmitter as unknown as new () => TypedEmitter<TooltipEvents>) {\n  private static _instance = new TooltipManager();\n\n  private static lastContext: Context | undefined;\n\n  // Note you probably want to call event.stopPropagation() after calling this\n  static showContextTooltip(type: ContextType, info: ContextInfo, originRect: DOMRect, className?: string, source?: ItemSource) {\n    const context = { type, info, referenceRect: originRect, className, source };\n\n    if (deepEquals(context, this.lastContext)) {\n      this.clear();\n    } else {\n      this.instance.emit(EVENT_CONTEXT_UPDATED, context);\n      this.lastContext = context;\n    }\n  }\n\n  static clear() {\n    this.instance.emit(EVENT_CONTEXT_UPDATED, undefined);\n    this.lastContext = undefined;\n  }\n\n  static get instance() {\n    return this._instance;\n  }\n}\n","import { IconSize } from 'components/ui/common/Icon';\nimport { Rarity } from 'constants/items';\n\nexport const getIconClassName = (rarity?: Rarity): string => {\n  switch (rarity) {\n    case Rarity.common:\n      return 'item-icon-common';\n    case Rarity.uncommon:\n      return 'item-icon-uncommon';\n    case Rarity.rare:\n      return 'item-icon-rare';\n    case Rarity.epic:\n      return 'item-icon-epic';\n    case Rarity.legendary:\n      return 'item-icon-legendary';\n  }\n  return getIconClassName(Rarity.common);\n};\n\nexport const sizeClassName = (size?: IconSize): string => {\n  switch (size) {\n    case IconSize.smallest:\n      return 'item-icon-size-smallest';\n    case IconSize.small:\n      return 'item-icon-size-small';\n    case IconSize.medium:\n      return 'item-icon-size-medium';\n    case IconSize.big:\n      return 'item-icon-size-big';\n    case IconSize.biggest:\n      return 'item-icon-size-biggest';\n  }\n  return sizeClassName(IconSize.medium);\n};\n","import { ContextType } from 'constants/context';\nimport { ItemSource } from 'constants/items';\nimport { getDefinition } from 'definitions/items';\nimport { Item } from 'definitions/items/types';\nimport { TooltipManager } from 'global/TooltipManager';\nimport Icon, { IconSize } from 'components/ui/common/Icon';\nimport { getIconClassName, sizeClassName } from './utils';\nimport './styles/itemIcon.scss';\n\nexport interface Props {\n  item: Item;\n  onClick?: (event: React.MouseEvent) => void;\n  size?: IconSize;\n  showContext?: boolean;\n  source?: ItemSource;\n}\n\nconst ItemIcon = (props: Props) => {\n  const { item, size, source } = props;\n  const itemDefinition = getDefinition(item.type);\n\n  if (!itemDefinition) {\n    throw new Error(`could not find definition for ${item}`);\n  }\n\n  const handleClick = (event: React.MouseEvent) => {\n    if (props.showContext !== false) {\n      const origin = (event.currentTarget as HTMLElement);\n      const originRect = origin.getBoundingClientRect();\n      TooltipManager.showContextTooltip(ContextType.item, item, originRect, undefined, source);\n      event.stopPropagation();\n    }\n\n    if (props.onClick) {\n      props.onClick(event);\n    }\n  };\n\n  const className = `item-icon ${getIconClassName(itemDefinition.rarity)} ${sizeClassName(size)}`;\n\n  return (\n    <div className={className}>\n      <Icon\n        image={itemDefinition.iconImg}\n        size={props.size}\n        onClick={handleClick}\n      />\n      {item.quantity && item.quantity > 1 && (\n        <div className=\"quantity\">{item.quantity}</div>\n      )}\n    </div>\n  );\n};\n\nexport default ItemIcon;\n","// Todo: come up with a less stupid name\nimport * as React from 'react';\nimport './styles/updownvalue.scss';\n\nexport interface DispatchProps {\n  onUp?: (e: React.MouseEvent) => void;\n  onDown?: (e: React.MouseEvent) => void;\n}\nexport interface Props extends DispatchProps {\n  label?: string;\n  value?: number;\n  max?: number;\n  upDisabled?: boolean;\n  downDisabled?: boolean;\n}\n\nconst UpDownValue = (props: Props) => {\n  const handleUp = (e: React.MouseEvent) => {\n    if (props.onUp && !props.upDisabled) { props.onUp(e); }\n  };\n\n  const handleDown = (e: React.MouseEvent) => {\n    if (props.onDown && !props.downDisabled) { props.onDown(e); }\n  };\n\n  let displayValue;\n  if (props.max == null) {\n    displayValue = props.value;\n  } else {\n    displayValue = (\n      <span>\n        {props.value} / <span className=\"max\">{ props.max }</span>\n      </span>\n    );\n  }\n  return (\n    <div className=\"updownvalue\">\n        <label> { props.label }</label>\n        { displayValue }\n        <i className={ 'arrow up' + (props.upDisabled ? ' disabled' : '' )}\n        onClick={handleUp}\n        />\n        <i className={'arrow down' + (props.downDisabled ? ' disabled' : '')}\n        onClick={handleDown}\n        />\n    </div>\n  );\n};\n\nexport default UpDownValue;\n","\nimport { StoreState } from 'store/types';\nimport { useSelector } from 'react-redux';\nimport { StockpileStoreState } from 'store/types/stockpile';\nimport { useMemo } from 'react';\nimport { ItemType } from 'definitions/items/types';\n\n// Returns the stockpile of items grouped into itemCategory\nexport const useStockpileState = () => {\n  return useSelector<StoreState, StockpileStoreState>(state => state.stockpile);\n};\n\nexport const useStockpileStateFlat = (): ItemType[] => {\n  const stockpile = useStockpileState();\n  return useMemo(() => {\n    const all = Object.values(stockpile).flat();\n    return all;\n  }, [stockpile]);\n};\n","import { getDefinition } from 'definitions/items';\nimport { ItemType } from 'definitions/items/types';\nimport { TextManager } from 'global/TextManager';\nimport { useMemo } from 'react';\nimport Icon from 'components/ui/common/Icon';\nimport { useStockpileStateFlat } from 'hooks/store/stockpile';\nimport './styles/itemsBox.scss';\n\nexport interface Props {\n  className?: string;\n  items: ItemType[];\n\n  // itemsInInventory?: Item[]; // Items that are in `items` array and also in inventory\n}\n\n\n/**\n * The ItemsBox displays a list of items, to be used as requirements for something\n */\nconst ItemsBox = (props: Props) => {\n  const { items } = props;\n  const className = (props.className || '') + ' items-box';\n  const aggregate = items.reduce<{ [key: string]: number }>((acc, value) => {\n    if (!acc[value]) {\n      acc[value] = 0;\n    }\n    acc[value]++;\n    return acc;\n  }, {});\n\n  const stockpile = useStockpileStateFlat();\n  const itemsInInventory: ItemType[] = useMemo(() => {\n    const tmpWarehouse = [ ...stockpile];\n    const tmpItems: ItemType[] = [];\n    items.forEach((item: ItemType) => {\n      const found = tmpWarehouse.findIndex((i) => i === item);\n      if (found > -1) {\n        // Remove the item from tmpWarehouse and add to itemsInInventory\n        const [ removed ] = tmpWarehouse.splice(found, 1);\n        if (removed) {\n          tmpItems.push(removed);\n        }\n      }\n    });\n    return tmpItems;\n  }, [items, stockpile]);\n\n\n  const listItems = Object.keys(aggregate).map((key: string) => {\n    const item = key as ItemType;\n    const amount = aggregate[key] as number;\n    let listItemClass = 'item';\n\n    // Check if we have enough\n    const amountInInventory = itemsInInventory ? itemsInInventory.filter((i) => i === item).length : 0;\n    if (amount > amountInInventory) {\n      listItemClass += ' missing';\n    }\n    const itemDescription = getDefinition(item);\n    return (\n      <li className={listItemClass} key={item}>\n        <Icon\n          image={itemDescription.iconImg}\n          size=\"smallest\"\n        />\n        <div className=\"name\">\n          { `${TextManager.getItemName(item)} (${ amount })` }\n        </div>\n      </li>\n    );\n  });\n\n  return (\n    <ul className={className} >\n      {listItems}\n    </ul>\n  );\n};\n\nexport default ItemsBox;\n","import { StoreState } from 'store/types';\nimport { useSelector } from 'react-redux';\nimport { ResourceStoreState } from 'store/types/resources';\nimport { selectMaxResources } from 'store/selectors/resources';\n\n// Returns the resources from the warehouse\nexport const useResourcesState = () => {\n  return useSelector<StoreState, ResourceStoreState>(store => store.resources);\n};\n\n// Returns the maximum of each resource that the warehouse can hold\nexport const useMaxResourcesState = () => {\n  return useSelector<StoreState, ResourceStoreState>(selectMaxResources);\n};\n","import { StoreState } from 'store/types';\nimport { useSelector } from 'react-redux';\n\n// Returns the gold from redux store\nconst useGoldState = () => {\n  return useSelector<StoreState, number>(store => store.gold);\n};\n\nexport default useGoldState;\n","import { Resource } from 'definitions/resources';\nimport resourceDescriptions from 'definitions/resources';\nimport * as React from 'react';\nimport { ResourceStoreState } from 'store/types/resources';\nimport { TextManager } from 'global/TextManager';\nimport { useMemo } from 'react';\nimport { useResourcesState } from 'hooks/store/resources';\nimport Icon from 'components/ui/common/Icon';\nimport { ContextType } from 'constants/context';\nimport { TooltipManager } from 'global/TooltipManager';\nimport useGoldState from 'hooks/store/useGoldState';\nimport './styles/resourcesCost.scss';\n\nexport interface Props {\n  className?: string;\n  resources: ResourceStoreState;\n  gold?: number;\n}\n\n/**\n *\n */\nconst ResourcesCost = (props: Props) => {\n  const {\n    resources,\n    gold,\n  } = props;\n\n  const storeResources = useResourcesState();\n\n  const sufficientResources = useMemo(() => {\n    return Object.keys(resources).reduce<{ [key: string]: boolean }>((acc, value) => {\n      const resource = value as Resource;\n      // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n      acc[value] = storeResources[resource]! >= resources[resource]!;\n      return acc;\n    }, {});\n  }, [resources, storeResources]);\n  const availableGold = useGoldState();\n  const sufficientGold = gold === undefined || availableGold >= gold;\n\n  const className = (props.className || '') + ' resources-cost';\n  const listItems = Object.keys(props.resources).map((key: string) => {\n    const resource = key as Resource;\n    let listItemClass = 'resource';\n    if (sufficientResources && !sufficientResources[resource]) {\n      listItemClass += ' insufficient';\n    }\n    const resourceDescription = resourceDescriptions[resource];\n    if (!resourceDescription) {\n      throw new Error(`No resource description found for ${resource}`);\n    }\n\n    const handleClick = (event: React.MouseEvent) => {\n\n      const origin = (event.currentTarget as HTMLElement);\n      const originRect = origin.getBoundingClientRect();\n      TooltipManager.showContextTooltip(ContextType.resource, resource, originRect);\n      event.stopPropagation();\n    };\n\n    return (\n      <li\n        className={listItemClass}\n        key={resource}\n      >\n        <Icon\n          image={resourceDescription.iconImg}\n          size=\"smallest\"\n          onClick={handleClick}\n        />\n        <div className=\"name\">\n          {TextManager.getResourceName(resource as Resource)}\n        </div>\n        <div className=\"amount\" >\n          { props.resources[resource] }\n        </div>\n      </li>\n    );\n  });\n\n  return (\n    <ul className={className}>\n      {listItems}\n      {gold && (\n        <li className={['gold', ...(sufficientGold ? [] : ['insufficient'])].join(' ')}>\n          <Icon\n            image=\"img/resources/gold.png\"\n            size=\"smallest\"\n          />\n          <div className=\"name\">\n            {TextManager.get('resource-gold-name')}\n          </div>\n          <div className=\"amount\" >\n            { gold }\n          </div>\n        </li>\n      )}\n    </ul>\n  );\n};\n\nexport default ResourcesCost;\n","import { Structure } from 'definitions/structures';\nimport { createSelector } from 'reselect';\nimport { StoreState } from 'store/types';\nimport { StructureStoreState } from 'store/types/structure';\nimport { StructuresStoreState } from 'store/types/structures';\n\nconst getStructures = (state: StoreState) => state.structures;\nconst getWorkers = (state: StoreState) => state.workers;\n\nconst calculateFreeWorkers = (structures: StructuresStoreState, workers: number) => {\n  // Add up all the workers used by all structures in town\n  const workersUsed = Object.keys(structures).map((name) => structures[name as Structure])\n    .reduce((acc: number, value: StructureStoreState) => acc += value.workers, 0);\n\n  return workers - workersUsed;\n};\n\nexport const selectFreeWorkers = createSelector([\n  getStructures,\n  getWorkers],\ncalculateFreeWorkers,\n);\n","import { StoreState } from 'store/types';\nimport { useSelector } from 'react-redux';\nimport { selectFreeWorkers } from 'store/selectors/workers';\n\n// Returns all the workers from redux store\nexport const useWorkersState = () => {\n  return useSelector<StoreState, number>(store => store.workers);\n};\n\n// Returns all the workers not working on something from redux store\nexport const useWorkersFreeState = () => {\n  return useSelector<StoreState, number>(selectFreeWorkers);\n};\n\n","export const MAX_WORKERS_CRAFTING = 6;\n\n/**\n * Calculates the production time for productionDefinition with given amount of workers\n * @param productionDefinition\n * @param workers\n */\nexport const calculateProductionTime = (time: number, workers: number): number => {\n  if (workers > MAX_WORKERS_CRAFTING) {\n    throw new Error(`Cannot possibly have more than ${MAX_WORKERS_CRAFTING} on one item!`);\n  }\n  // Each additional worker shaves off 10% of the production time\n  return time - (.1 * time * (workers - 1));\n};\n","\nimport { Weapon } from 'definitions/items/weapons';\nimport * as time from 'utils/format/time';\nimport { ProductionDefinition } from './types';\n\nconst weaponsmithProduction: { [key in Weapon]?: ProductionDefinition } = {\n  'weapon/aegisOfValor': {\n    item: { type: 'weapon/aegisOfValor' },\n    levelRequired: 3,\n    cost: {\n      resources: { wood: 20, iron: 5 },\n      time: time.HALF_HOUR,\n    },\n  },\n  'weapon/arbalest': {\n    item: { type: 'weapon/arbalest' },\n    cost: {\n      resources: { wood: 20, iron: 5 },\n      time: time.HALF_HOUR,\n    },\n  },\n  'weapon/battleAxe': {\n    item: { type: 'weapon/battleAxe' },\n    cost: {\n      resources: { wood: 20, iron: 5 },\n      time: time.HALF_HOUR,\n    },\n  },\n  'weapon/berserkerShield': {\n    item: { type: 'weapon/berserkerShield' },\n    levelRequired: 2,\n    cost: {\n      resources: { wood: 20, iron: 5 },\n      time: time.HALF_HOUR,\n    },\n  },\n  'weapon/brassKnuckles': {\n    item: { type: 'weapon/brassKnuckles' },\n    cost: {\n      resources: { wood: 20, iron: 5 },\n      time: time.HALF_HOUR,\n    },\n  },\n  'weapon/simpleCrossbow': {\n    item: { type: 'weapon/simpleCrossbow' },\n    cost: {\n      resources: { wood: 20, iron: 5 },\n      time: time.HALF_HOUR,\n    },\n  },\n  'weapon/cleaver': {\n    item: { type: 'weapon/cleaver' },\n    cost: {\n      resources: { wood: 10, iron: 15 },\n      time: time.HALF_HOUR,\n    },\n  },\n  'weapon/club': {\n    item: { type: 'weapon/club' },\n    cost: {\n      resources: { wood: 30 },\n      time: time.HALF_HOUR,\n    },\n  },\n  'weapon/dagger': {\n    item: { type: 'weapon/dagger' },\n    cost: {\n      resources: { wood: 10, iron: 10 },\n      time: time.ONE_HOUR,\n    },\n  },\n  'weapon/flail': {\n    item: { type: 'weapon/flail' },\n    cost: {\n      resources: { wood: 10, iron: 10 },\n      time: time.ONE_HOUR,\n    },\n  },\n  'weapon/goldenShield': {\n    item: { type: 'weapon/goldenShield' },\n    levelRequired: 2,\n    cost: {\n      resources: { wood: 20, iron: 5 },\n      time: time.HALF_HOUR,\n    },\n  },\n  'weapon/javelin': {\n    item: { type: 'weapon/javelin' },\n    cost: {\n      resources: { wood: 20, iron: 10 },\n      time: time.ONE_HOUR + time.HALF_HOUR,\n    },\n  },\n  'weapon/khopesh': {\n    item: { type: 'weapon/khopesh' },\n    cost: {\n      resources: { wood: 15, iron: 40 },\n      time:  time.TWO_MINUTES,\n    },\n  },\n  'weapon/longbow': {\n    item: { type: 'weapon/longbow' },\n    cost: {\n      resources: { wood: 40, iron: 5 },\n      time: time.ONE_HOUR,\n    },\n  },\n  'weapon/mace': {\n    item: { type: 'weapon/mace' },\n    cost: {\n      resources: { wood: 15, iron: 10 },\n      time: time.ONE_HOUR,\n    },\n  },\n  'weapon/morningStar': {\n    item: { type: 'weapon/morningStar' },\n    cost: {\n      resources: { wood: 15, iron: 15 },\n      time: time.ONE_HOUR,\n    },\n  },\n  'weapon/paintedBuckler': {\n    item: { type: 'weapon/paintedBuckler' },\n    cost: {\n      resources: { wood: 20, iron: 10 },\n      time: time.ONE_HOUR + time.HALF_HOUR,\n    },\n  },\n  'weapon/poisonedDagger': {\n    item: { type: 'weapon/poisonedDagger' },\n    cost: {\n      resources: { wood: 50, iron: 15 },\n      materials: [ 'material/poisonVial' ],\n      time: time.ONE_HOUR,\n    },\n  },\n  'weapon/ravenStaff': {\n    item: { type: 'weapon/ravenStaff' },\n    cost: {\n      resources: { wood: 15, iron: 10, food: 5 },\n      time: time.ONE_HOUR,\n    },\n  },\n  'weapon/savageStaff': {\n    item: { type: 'weapon/savageStaff' },\n    cost: {\n      resources: { wood: 15, iron: 10, food: 5 },\n      time: time.ONE_HOUR,\n    },\n  },\n  'weapon/spear': {\n    item: { type: 'weapon/spear' },\n    cost: {\n      resources: { wood: 15, iron: 15 },\n      time: time.ONE_HOUR,\n    },\n  },\n  'weapon/steelShield': {\n    item: { type: 'weapon/steelShield' },\n    cost: {\n      resources: { wood: 15, iron: 15 },\n      time: time.ONE_HOUR,\n    },\n  },\n  'weapon/steelSword': {\n    item: { type: 'weapon/steelSword' },\n    cost: {\n      resources: { wood: 10, iron: 30 },\n      time:  time.ONE_HOUR,\n    },\n  },\n  'weapon/warhammer': {\n    item: { type: 'weapon/warhammer' },\n    cost: {\n      resources: { wood: 10, iron: 30 },\n      time:  time.ONE_HOUR,\n    },\n  },\n  'weapon/woodenBulwark': {\n    item: { type: 'weapon/woodenBulwark' },\n    cost: {\n      resources: { wood: 10, iron: 30 },\n      time:  time.ONE_HOUR,\n    },\n  },\n};\nexport default weaponsmithProduction;\n\nexport const getDefinition = (item: Weapon) => {\n  return weaponsmithProduction[item];\n};\n","import { Apparel } from 'definitions/items/apparel';\nimport * as time from 'utils/format/time';\nimport {  ProductionDefinition } from './types';\n\n// todo: real values for costs\nconst armoursmithProduction: { [key in Apparel]?: ProductionDefinition } = {\n  'apparel/boots1': {\n    item: { type: 'apparel/boots1' },\n    cost: {\n      resources: {\n        wood: 10,\n        iron: 45,\n      },\n      time: time.ONE_HOUR,\n    },\n  },\n  'apparel/boots2': {\n    item: { type: 'apparel/boots2' },\n    cost: {\n      resources: {\n        wood: 10,\n        iron: 45,\n      },\n      time: time.ONE_HOUR,\n    },\n    levelRequired: 2,\n  },\n  'apparel/boots3': {\n    item: { type: 'apparel/boots3' },\n    cost: {\n      resources: {\n        wood: 10,\n        iron: 45,\n      },\n      time: time.ONE_HOUR,\n    },\n    levelRequired: 3,\n  },\n  'apparel/chainmailHood': {\n    item: { type: 'apparel/chainmailHood' },\n    cost: {\n      resources: {\n        wood: 10,\n        iron: 45,\n      },\n      time: time.ONE_HOUR,\n    },\n  },\n  'apparel/chest': {\n    item: { type: 'apparel/chest' },\n    cost: {\n      resources: {\n        wood: 10,\n        iron: 45,\n      },\n      time: time.ONE_HOUR,\n    },\n  },\n  'apparel/clothGloves': {\n    item: { type: 'apparel/clothGloves' },\n    cost: {\n      resources: {\n        wood: 10,\n        iron: 45,\n      },\n      time: time.ONE_HOUR,\n    },\n  },\n  'apparel/cowl': {\n    item: { type: 'apparel/cowl' },\n    cost: {\n      resources: {\n        wood: 10,\n        iron: 45,\n      },\n      time: time.ONE_HOUR,\n    },\n  },\n  'apparel/druidChest': {\n    item: { type: 'apparel/druidHands' },\n    cost: {\n      resources: {\n        wood: 10,\n        iron: 45,\n      },\n      time: time.ONE_HOUR,\n    },\n    levelRequired: 2,\n  },\n  'apparel/druidFeet': {\n    item: { type: 'apparel/druidFeet' },\n    cost: {\n      resources: {\n        wood: 10,\n        iron: 45,\n      },\n      time: time.ONE_HOUR,\n    },\n    levelRequired: 2,\n  },\n  'apparel/druidHands': {\n    item: { type: 'apparel/druidHands' },\n    cost: {\n      resources: {\n        wood: 10,\n        iron: 45,\n      },\n      time: time.ONE_HOUR,\n    },\n    levelRequired: 2,\n  },\n  'apparel/druidHead': {\n    item: { type: 'apparel/druidHead' },\n    cost: {\n      resources: {\n        wood: 10,\n        iron: 45,\n      },\n      time: time.ONE_HOUR,\n    },\n    levelRequired: 2,\n  },\n  'apparel/druidLegs': {\n    item: { type: 'apparel/druidLegs' },\n    cost: {\n      resources: {\n        wood: 10,\n        iron: 45,\n      },\n      time: time.ONE_HOUR,\n    },\n    levelRequired: 2,\n  },\n  'apparel/fedora': {\n    item: { type: 'apparel/fedora' },\n    cost: {\n      resources: {\n        wood: 10,\n        iron: 45,\n      },\n      time: time.ONE_HOUR,\n    },\n  },\n  'apparel/greaves1': {\n    item: { type: 'apparel/greaves1' },\n    cost: {\n      resources: {\n        wood: 10,\n        iron: 45,\n      },\n      time: time.ONE_HOUR,\n    },\n  },\n  'apparel/greaves2': {\n    item: { type: 'apparel/greaves2' },\n    cost: {\n      resources: {\n        wood: 10,\n        iron: 45,\n      },\n      time: time.ONE_HOUR,\n    },\n  },\n  'apparel/hornedHelmet': {\n    item: { type: 'apparel/hornedHelmet' },\n    cost: {\n      resources: {\n        wood: 10,\n        iron: 45,\n      },\n      time: time.ONE_HOUR,\n    },\n  },\n  'apparel/leatherGloves': {\n    item: { type: 'apparel/leatherGloves' },\n    cost: {\n      resources: {\n        wood: 10,\n        iron: 45,\n      },\n      time: time.ONE_HOUR,\n    },\n  },\n  'apparel/nomadHelmet': {\n    item: { type: 'apparel/nomadHelmet' },\n    cost: {\n      resources: {\n        wood: 10,\n        iron: 45,\n      },\n      time: time.ONE_HOUR,\n    },\n  },\n  'apparel/pants1': {\n    item: { type: 'apparel/pants1' },\n    cost: {\n      resources: {\n        wood: 10,\n        iron: 45,\n      },\n      time: time.ONE_HOUR,\n    },\n  },\n  'apparel/pants2': {\n    item: { type: 'apparel/pants2' },\n    cost: {\n      resources: {\n        wood: 10,\n        iron: 45,\n      },\n      time: time.ONE_HOUR,\n    },\n  },\n  'apparel/plateChest1': {\n    item: { type: 'apparel/plateChest1' },\n    cost: {\n      resources: {\n        wood: 10,\n        iron: 45,\n      },\n      time: time.ONE_HOUR,\n    },\n  },\n  'apparel/plateChest2': {\n    item: { type: 'apparel/plateChest2' },\n    cost: {\n      resources: {\n        wood: 10,\n        iron: 45,\n      },\n      time: time.ONE_HOUR,\n    },\n  },\n  'apparel/plateChest3': {\n    item: { type: 'apparel/plateChest3' },\n    cost: {\n      resources: {\n        wood: 10,\n        iron: 45,\n      },\n      time: time.ONE_HOUR,\n    },\n  },\n  'apparel/plateChest4': {\n    item: { type: 'apparel/plateChest4' },\n    cost: {\n      resources: {\n        wood: 10,\n        iron: 45,\n      },\n      time: time.ONE_HOUR,\n    },\n  },\n  'apparel/plateGloves1': {\n    item: { type: 'apparel/plateGloves1' },\n    cost: {\n      resources: {\n        wood: 10,\n        iron: 45,\n      },\n      time: time.ONE_HOUR,\n    },\n  },\n  'apparel/plateGloves2': {\n    item: { type: 'apparel/plateGloves2' },\n    cost: {\n      resources: {\n        wood: 10,\n        iron: 45,\n      },\n      time: time.ONE_HOUR,\n    },\n  },\n  'apparel/plateHelmet': {\n    item: { type: 'apparel/plateHelmet' },\n    cost: {\n      resources: {\n        wood: 10,\n        iron: 45,\n      },\n      time: time.ONE_HOUR,\n    },\n  },\n  'apparel/platePants': {\n    item: { type: 'apparel/platePants' },\n    cost: {\n      resources: {\n        wood: 10,\n        iron: 45,\n      },\n      time: time.ONE_HOUR,\n    },\n  },\n  'apparel/plateShoulders1': {\n    item: { type: 'apparel/plateShoulders1' },\n    cost: {\n      resources: {\n        wood: 10,\n        iron: 45,\n      },\n      time: time.ONE_HOUR,\n    },\n  },\n  'apparel/plateShoulders2': {\n    item: { type: 'apparel/plateShoulders2' },\n    cost: {\n      resources: {\n        wood: 10,\n        iron: 45,\n      },\n      time: time.ONE_HOUR,\n    },\n  },\n  'apparel/robe': {\n    item: { type: 'apparel/robe' },\n    cost: {\n      resources: { wood: 10, iron: 45 },\n      time: time.ONE_HOUR,\n    },\n  },\n  'apparel/shoulders1': {\n    item: { type: 'apparel/shoulders1' },\n    cost: {\n      resources: { wood: 10, iron: 45 },\n      time: time.ONE_HOUR,\n    },\n\n  },\n  'apparel/shoulders2': {\n    item: { type: 'apparel/shoulders2' },\n    cost: {\n      resources: { wood: 10, iron: 45 },\n      time: time.ONE_HOUR,\n    },\n\n  },\n  'apparel/shoulders3': {\n    item: { type: 'apparel/shoulders3' },\n    cost: {\n      resources: { wood: 10, iron: 45 },\n      time: time.ONE_HOUR,\n    },\n\n  },\n  'apparel/vest': {\n    item: { type: 'apparel/vest' },\n    cost: {\n      resources: { wood: 10, iron: 45 },\n      time: time.ONE_HOUR,\n    },\n  },\n};\nexport default armoursmithProduction;\n","import { QuestItem } from 'definitions/items/questItems';\nimport * as time from 'utils/format/time';\nimport { ProductionDefinition } from './types';\n\nconst workshopProduction: { [key in QuestItem]?: ProductionDefinition } = {\n  'questItem/torch': {\n    item: { type: 'questItem/torch' },\n    cost: {\n      resources: { wood: 2, fabric: 1 },\n      time: time.ONE_MINUTE,\n    },\n  },\n  'questItem/sandwich': {\n    item: { type: 'questItem/sandwich' },\n    cost: {\n      resources: { food: 1 },\n      time: time.ONE_MINUTE / 2,\n    },\n  },\n};\nexport default workshopProduction;\n\n","import weaponsmithProduction from './weaponsmith';\nimport armoursmithProduction from './armoursmith';\nimport { Structure } from 'definitions/structures';\nimport { ProductionDefinition } from './types';\nimport workshopProduction from './workshop';\n// import alchemistProduction from './alchemist';\nimport { isWeapon } from 'definitions/items/weapons';\nimport { isApparel } from 'definitions/items/apparel';\nimport { isQuestItem } from 'definitions/items/questItems';\nimport { ProducableItem } from 'store/types/structure';\n\n// Returns the structure that produces given Item, or null if this Item is not produced anywhere\nexport const getProductionStructureForItem = (item: ProducableItem): Structure | null => {\n  // if (alchemistProduction[item]){\n  //   return Structure.alchemist;\n  // }\n  if (isApparel(item) && armoursmithProduction[item]){\n    return 'armoursmith';\n  }\n  if (isWeapon(item) && weaponsmithProduction[item]){\n    return 'weaponsmith';\n  }\n  if (isQuestItem(item) && workshopProduction[item]){\n    return 'workshop';\n  }\n  return null;\n};\n\n\nconst all = {\n  // ...alchemistProduction,\n  ...armoursmithProduction,\n  ...weaponsmithProduction,\n  ...workshopProduction,\n};\n\nexport const getDefinition = (item: ProducableItem ): ProductionDefinition => {\n  // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n  return all[item]!;\n};\n\n\n","import { Item, ItemCategory } from 'definitions/items/types';\nimport { Action } from 'redux';\n\nexport type StockpileAction =\n  { type: 'addItem', item: Item, toSlot?: number }\n  | { type: 'moveItemInWarehouse', itemCategory: ItemCategory, fromSlot: number, toSlot: number }\n  | { type: 'removeItem', itemCategory: ItemCategory, fromSlot: number };\n//  |  { type: \"addStockpileSlots\"\n\n\n\nexport interface AddStockpileSlotsAction extends Action {\n  slots: number;\n}\n\n// Adds one Item to the warehouse\n// slot is optional, will take the first empty slot if not provided\nexport const addItemToWarehouse = (item: Item, toSlot?: number): StockpileAction => {\n  return {\n    type: 'addItem',\n    item,\n    toSlot,\n  };\n};\n\n// When an Item is moved from one slot to the other in the warehouse\nexport const moveItemInWarehouse = (itemCategory: ItemCategory, fromSlot: number, toSlot: number): StockpileAction => {\n  return {\n    type: 'moveItemInWarehouse',\n    itemCategory,\n    fromSlot,\n    toSlot,\n  };\n};\n\nexport const removeItemFromWarehouse = (itemCategory: ItemCategory, fromSlot: number): StockpileAction => {\n  return {\n    type: 'removeItem',\n    itemCategory,\n    fromSlot,\n  };\n};\n\n// export function addStockpileSlots(slots: number): AddStockpileSlotsAction {\n//   return {\n//     type: ActionType.addStockpileSlots,\n//     slots,\n//   };\n// }\n","import { ResourceStoreState } from 'store/types/resources';\n\nexport type ResourcesAction =\n  { type: 'addResources', resources: ResourceStoreState }\n  | { type: 'removeResources', resources: ResourceStoreState };\n\nexport const addResources = (resources: ResourceStoreState): ResourcesAction => ({\n  type: 'addResources',\n  resources,\n});\n\nexport const addResource = (resource: string, value: number): ResourcesAction => {\n  return addResources({\n    [resource]: value,\n  });\n};\n\nexport const removeResources = (resources: ResourceStoreState): ResourcesAction => ({\n  type: 'removeResources',\n  resources,\n});\n","import { Structure } from 'definitions/structures';\nimport { ProducableItem, StructureState } from 'store/types/structure';\n\nexport type StructuresAction =\n  { type: 'upgradeStructure', structure: Structure }\n  |  { type: 'increaseWorkers', structure: Structure, workers: number }\n  |  { type: 'decreaseWorkers', structure: Structure, workers: number }\n  |  { type: 'startBuildingStructure', structure: Structure }\n  |  { type: 'finishBuildingStructure', structure: Structure }\n  |  { type: 'setStructureState', structure: Structure, state: StructureState }\n  |  { type: 'addItemToToProduces', structure: Structure, item: ProducableItem }\n  |  { type: 'removeItemFromHarvest', structure: Structure, index: number };\n\n\nexport const startBuildingStructure = (structure: Structure): StructuresAction => ({\n  type: 'startBuildingStructure',\n  structure,\n});\n\nexport const finishBuildingStructure = (structure: Structure): StructuresAction => ({\n  type: 'finishBuildingStructure',\n  structure,\n});\n\nexport const upgradeStructure = (structure: Structure): StructuresAction => ({\n  type: 'upgradeStructure',\n  structure,\n});\n\n// Increases workers used by given structure by given amount\nexport const increaseWorkers = (structure: Structure, workers = 1): StructuresAction => ({\n  type: 'increaseWorkers',\n  structure,\n  workers,\n});\n\n// Decreases workers used by given structure by given amount\nexport const decreaseWorkers = (structure: Structure, workers = 1): StructuresAction => ({\n  type: 'decreaseWorkers',\n  structure,\n  workers,\n});\n\n// Set state directly\nexport const setStructureState = (structure: Structure, state: StructureState): StructuresAction => ({\n  type: 'setStructureState',\n  structure,\n  state,\n});\n\n// Structure can now preoduce this\nexport const addItemToToProduces = (structure: Structure, item: ProducableItem): StructuresAction => ({\n  type: 'addItemToToProduces',\n  structure,\n  item,\n});\n\n// Take item at specified index\nexport const removeItemFromHarvest = (structure: Structure, index: number): StructuresAction => ({\n  type: 'removeItemFromHarvest',\n  structure,\n  index,\n});\n","import { AnyAction } from 'redux';\nimport { TaskType } from 'store/types/task';\n\n\nexport type TaskAction = {\n  type: 'start',\n  taskType: TaskType;\n  name: string;\n  origin: string;\n  time: number;\n  callbacks: AnyAction[];\n};\n\nexport function startTask(taskType: TaskType, name: string, origin: string, time: number, callbacks: AnyAction[]): TaskAction {\n  return {\n    type: 'start',\n    taskType,\n    name,\n    origin,\n    time,\n    callbacks,\n  };\n}\n","import { useState } from 'react';\nimport { useDispatch } from 'react-redux';\nimport Button from 'components/ui/buttons/Button';\nimport UpDownValue from 'components/ui/common/UpDownValue';\nimport ItemsBox from 'components/ui/items/ItemsBox';\nimport ResourcesCost from 'components/structures/production/ResourcesCost';\nimport { ItemType } from 'definitions/items/types';\nimport { TextManager } from 'global/TextManager';\nimport { useResourcesState } from 'hooks/store/resources';\nimport { useWorkersFreeState } from 'hooks/store/useWorkersState';\nimport { calculateProductionTime, MAX_WORKERS_CRAFTING } from 'mechanics/crafting';\nimport { formatDuration } from 'utils/format/time';\nimport { getDefinition as getProductionDefinition } from 'definitions/production';\nimport { ProductionDefinition } from 'definitions/production/types';\nimport { addItemToWarehouse } from 'store/actions/stockpile';\nimport { removeResources } from 'store/actions/resources';\nimport { increaseWorkers } from 'store/actions/structures';\nimport { startTask } from 'store/actions/tasks';\nimport { TaskType } from 'store/types/task';\nimport { Structure } from 'definitions/structures';\nimport { Resource } from 'definitions/resources';\nimport { ProducableItem } from 'store/types/structure';\nimport { useStockpileStateFlat } from 'hooks/store/stockpile';\n\nexport interface Props {\n  item: ProducableItem;\n  structure: Structure;\n}\n\nconst CraftingDetails = (props: Props) => {\n  const { item, structure } = props;\n  const dispatch = useDispatch();\n  const resourcesState = useResourcesState();\n  const stockpileState = useStockpileStateFlat();\n  const workersFree = useWorkersFreeState();\n  const [workersAssigned, setWorkersAssigned] = useState<number>(0);\n\n  const produces = getProductionDefinition(item);\n  const costResources = produces.cost.resources || {};\n  const missingAtLeastOneResource = Object.keys(costResources)\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    .some((key) => { const resource:Resource = key as Resource; return costResources[resource]! > resourcesState[resource]!; });\n\n  let missingAtLeastOneItem = false;\n  const costMaterials = produces.cost.materials;\n  if (costMaterials) {\n    missingAtLeastOneItem = costMaterials.some((i: ItemType) => stockpileState.indexOf(i) === -1);\n  }\n\n  const disabled = missingAtLeastOneResource || missingAtLeastOneItem || workersAssigned < 1;\n  // TODO: [10/07/2019] Perhaps each item can have a number of minimum workers?\n\n  const makeTimeString = (asNumber: number): string => {\n    if (workersAssigned === 0) {\n      return '';\n    }\n    const craftingTime = calculateProductionTime(asNumber, workersAssigned);\n    const time = formatDuration(craftingTime);\n    return TextManager.get('ui-structure-production-crafting-time', { time });\n  };\n\n  const handleCraft = (productionDefinition: ProductionDefinition, workers: number) => {\n    const craftingTime = calculateProductionTime(productionDefinition.cost.time || 0, workers);\n    dispatch(removeResources(productionDefinition.cost.resources || {}));\n    dispatch(increaseWorkers(structure, workers));\n\n    const callbacks = [\n      addItemToWarehouse(productionDefinition.item),\n      increaseWorkers(structure, workers),\n    ];\n    const start = startTask(\n      TaskType.craftItem,\n      productionDefinition.item.type,\n      `${structure}.craft`,\n      craftingTime,\n      callbacks);\n    dispatch(start);\n  };\n\n  const handleClick = (e: React.MouseEvent) => {\n    e.stopPropagation();\n\n    handleCraft(produces, workersAssigned);\n    setWorkersAssigned(0);\n  };\n\n  const handleUp = (e: React.MouseEvent) => {\n    e.stopPropagation();\n    setWorkersAssigned(workersAssigned + 1);\n  };\n\n  const handleDown = (e: React.MouseEvent) => {\n    e.stopPropagation();\n    setWorkersAssigned(workersAssigned - 1);\n  };\n\n\n  return (\n    <div className=\"crafting-details\">\n      { TextManager.get('ui-structure-production-craft-a', { item }) }\n      <div className=\"crafting-costs\">\n        <fieldset>\n          <ResourcesCost resources={costResources} />\n        </fieldset>\n        <fieldset>\n          {costMaterials && <ItemsBox items={costMaterials} />}\n        </fieldset>\n      </div>\n      <div className=\"buttonrow\">\n        <div>\n          <UpDownValue\n            value={workersAssigned}\n            label={TextManager.get('ui-structure-production-workers')}\n            onUp={handleUp}\n            onDown={handleDown}\n            upDisabled={\n              workersAssigned >= workersFree ||\n              workersAssigned >= MAX_WORKERS_CRAFTING\n            }\n            downDisabled={workersAssigned < 1}\n          />\n          { makeTimeString(produces.cost.time || 0)}\n        </div>\n        <div>\n          <Button\n            disabled={disabled}\n            className=\"craft\"\n            onClick={handleClick}\n          >\n            {TextManager.get('ui-structure-production-craft')}\n          </Button>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default CraftingDetails;\n","import { useState } from 'react';\nimport { IconSize } from 'components/ui/common/Icon';\nimport ItemIcon from 'components/ui/items/ItemIcon';\nimport { Structure } from 'definitions/structures';\nimport { ProducableItem, ProductionStructureStoreState } from 'store/types/structure';\nimport { useStructureState } from 'hooks/store/structures';\nimport { TextManager } from 'global/TextManager';\nimport CraftingDetails from './CraftingDetails';\n\nexport interface Props {\n  structure: Structure;\n}\n\nconst CraftingArea = (props: Props) => {\n  const { structure } = props;\n  const [selectedItem, setSelectedItem] = useState<ProducableItem>();\n\n  const storeState = useStructureState<ProductionStructureStoreState>(structure);\n  const handleSelectCraftingItem = (item: ProducableItem) => {\n    setSelectedItem(item);\n  };\n\n  return (\n    <>\n      <div> { TextManager.get('ui-structure-production-craft') }</div>\n      <div className=\"crafting-area\">\n        <ul className=\"vertical-tab-bar\">\n          {storeState.produces.map((type) => (\n            <li\n              key={`craft${type}`}\n              onClick={() => handleSelectCraftingItem(type)}\n              className={selectedItem === type ? 'selected' : ''}\n            >\n              <ItemIcon item={{ type }} size={IconSize.smallest} />\n              { TextManager.getItemName(type) }\n            </li>\n          ))}\n        </ul>\n        { selectedItem && <CraftingDetails item={selectedItem} structure={structure} /> }\n      </div>\n    </>\n  );\n};\n\nexport default CraftingArea;\n","import { PropsWithChildren } from 'react';\nimport { TextManager } from 'global/TextManager';\nimport useGoldState from 'hooks/store/useGoldState';\nimport { Structure } from 'definitions/structures';\nimport ResourcesCost from './production/ResourcesCost';\nimport { ResourceStructureDefinition } from 'definitions/structures/types';\nimport { useStructureDefinition } from 'hooks/store/structures';\nimport { Resource } from 'definitions/resources';\nimport { useResourcesState } from 'hooks/store/resources';\nimport { useDispatch } from 'react-redux';\nimport { AnyAction } from 'redux';\nimport { subtractGold } from 'store/actions/gold';\nimport { addLogText } from 'store/actions/log';\nimport { upgradeStructure } from 'store/actions/structures';\nimport { startTask } from 'store/actions/tasks';\nimport { LogChannel } from 'store/types/logEntry';\nimport { TaskType } from 'store/types/task';\nimport Button from 'components/ui/buttons/Button';\nimport { removeResources } from 'store/actions/resources';\nimport { formatDuration } from 'utils/format/time';\nimport './styles/upgradeHelpModal.scss';\n\nexport interface Props  {\n  structure: Structure;\n  level: number;\n\n  addUpgradeCallbacks?: (level: number) => AnyAction[]; // add custom actions after upgrade is done\n}\n\n\nconst UpgradeHelpModal = (props: PropsWithChildren<Props>) => {\n  const { structure, level, addUpgradeCallbacks, children } = props;\n  const dispatch = useDispatch();\n  const structureDefinition: ResourceStructureDefinition = useStructureDefinition(structure);\n  const nextLevel = structureDefinition.levels[level + 1];\n\n  const { time } = nextLevel.cost;\n\n  const gold = useGoldState();\n  const goldCost = (nextLevel != null ? nextLevel.cost.gold || 0 : -1);\n  const missingGold = goldCost > gold;\n\n  const resourcesState = useResourcesState();\n  const costResources = nextLevel.cost.resources || {};\n  const missingAtLeastOneResource = Object.keys(costResources)\n    .some((key) => {\n      const resource = key as Resource;\n      return (costResources[resource] ?? 0) > (resourcesState?.[resource] ?? 0);\n    });\n\n  const canUpgrade = nextLevel != null && !missingGold && !missingAtLeastOneResource;\n\n  const handleUpgrade = () => {\n    dispatch(subtractGold(goldCost));\n    dispatch(removeResources(costResources));\n    const callbacks = [\n      ...(addUpgradeCallbacks?.(level + 1) || []),\n      upgradeStructure(structure),\n      addLogText('log-town-upgrade-structure-complete', {\n        level: level + 1,\n        structure,\n      }, LogChannel.town),\n    ];\n\n    const start = startTask(TaskType.upgradeStructure,\n      `${structure}.upgrade`,\n      'town',\n      nextLevel.cost.time ?? 0,\n      callbacks);\n    dispatch(start);\n  };\n\n  return (\n    <div className=\"structure-upgrade-help-modal\">\n      <div className=\"top\">\n        <h3>{TextManager.get('ui-structure-help-upgrade-title', { structure } )}</h3>\n        <div className=\"level\">\n          {TextManager.get('ui-structure-help-upgrade-header-level', {\n            level: level + 2,\n          })}\n        </div>\n      </div>\n      <div className=\"cost\">\n        <h3>Costs</h3>\n        { nextLevel.cost.resources && <ResourcesCost resources={nextLevel.cost.resources} gold={nextLevel.cost.gold} className=\"wrap\" /> }\n      </div>\n      <Button\n        className=\"start\"\n        onClick={handleUpgrade}\n        disabled={!canUpgrade}\n      >\n        { TextManager.get('ui-structure-help-upgrade-start', {\n          time: formatDuration(time ?? 0),\n        })}\n      </Button>\n      {children}\n    </div>\n  );\n};\n\nexport default UpgradeHelpModal;\n","import { Structure } from 'definitions/structures';\nimport { ProductionStructureDefinition } from 'definitions/structures/types';\nimport { IconSize } from 'components/ui/common/Icon';\nimport ItemIcon from 'components/ui/items/ItemIcon';\nimport { ItemType } from 'definitions/items/types';\nimport { useStructureDefinition } from 'hooks/store/structures';\nimport { TextManager } from 'global/TextManager';\nimport './styles/upgradeHelpModalContent.scss';\n\nexport interface Props  {\n  structure: Structure;\n  level: number;\n}\n\nconst UpgradeHelpModalContent = (props: Props) => {\n  const { level, structure } = props;\n  const structureDefinition = useStructureDefinition<ProductionStructureDefinition>(structure);\n  const nextLevel = structureDefinition.levels[level + 1];\n\n  const renderRow = (type: ItemType) => {\n    return (\n      <ItemIcon key={type} item={{ type }} size={IconSize.small} />\n    );\n  };\n\n  return (\n    <div className=\"upgrade-help-model-content-production\">\n      <h3>{TextManager.get('ui-structure-help-upgrade-unlocks-crafting')}</h3>\n      <div className=\"unlocks\">\n        {nextLevel.unlocks.map(item => renderRow(item))}\n      </div>\n    </div>\n  );\n};\n\nexport default UpgradeHelpModalContent;\n","import { useEffect } from 'react';\nimport { ItemType } from 'definitions/items/types';\nimport { Structure } from 'definitions/structures';\nimport { ProductionStructureDefinition } from 'definitions/structures/types';\nimport { TextManager } from 'global/TextManager';\nimport { formatDuration } from 'utils/format/time';\nimport { TickingProgressbar } from 'components/ui/common/progress';\nimport { useStructureDefinition, useStructureState } from 'hooks/store/structures';\nimport { useCraftingTasksStateByStructure, useStudyingTasksStateByStructure } from 'hooks/store/useTasksState';\nimport StructureViewHeader from '../StructureViewHeader';\nimport StructureLevel from '../StructureLevel';\nimport { TooltipManager } from 'global/TooltipManager';\nimport { ContextType } from 'constants/context';\nimport CraftingArea from './CraftingArea';\nimport { addItemToToProduces } from 'store/actions/structures';\nimport UpgradeHelpModal from '../UpgradeHelpModal';\nimport UpgradeHelpModalContent from './UpgradeHelpModalContent';\nimport { SoundManager, Channel } from 'global/SoundManager';\nimport './styles/productionStructureView.scss';\n\nexport interface Props {\n  structure: Structure;\n}\n\nconst ProductionStructureView = (props: Props) => {\n  const { structure } = props;\n  const level = useStructureState(structure).level;\n\n  const craftingTasks = useCraftingTasksStateByStructure(structure);\n  const studyingTasks = useStudyingTasksStateByStructure(structure);\n  const structureDefinition = useStructureDefinition<ProductionStructureDefinition>(props.structure);\n\n  useEffect(() => {\n    if (structure === 'armoursmith' || structure === 'weaponsmith') {\n      SoundManager.addSound('ambient/structure/smith', 'sound/structures/smith.ogg', () => {\n        SoundManager.playSound('ambient/structure/smith', Channel.ambient, true);\n      });\n    }\n    if (structure === 'alchemist') {\n      SoundManager.addSound('ambient/structure/alchemist', 'sound/structures/alchemist.ogg', () => {\n        SoundManager.playSound('ambient/structure/alchemist', Channel.ambient, true);\n      });\n    }\n    return () => SoundManager.fadeOutSound(Channel.ambient);\n  }, [structure]);\n\n  const handleUpgradeCallbacks = (nextLevel: number) => {\n    const nextLevelDefinition = structureDefinition.levels[nextLevel];\n    return nextLevelDefinition.unlocks.map(item => addItemToToProduces(structure, item));\n  };\n\n  const handleHelpClicked = (event: React.MouseEvent) => {\n    const origin = (event.currentTarget as HTMLElement);\n    const originRect = origin.getBoundingClientRect();\n    const content = (\n      <UpgradeHelpModal\n        level={level}\n        structure={structure}\n        addUpgradeCallbacks={handleUpgradeCallbacks}\n      >\n        <UpgradeHelpModalContent level={level} structure={structure}/>\n      </UpgradeHelpModal>\n    );\n    TooltipManager.showContextTooltip(ContextType.component, content, originRect, 'upgrade-structure-tooltip');\n\n    event.stopPropagation();\n  };\n\n  return (\n    // TODO: abstract some stuff to generic StructureView\n    <>\n      <StructureViewHeader structure={props.structure} />\n      <div className = \"production-structure-view\">\n        <section>\n          <StructureLevel\n            structure={structure}\n            onHelpClicked={handleHelpClicked}\n          />\n          <CraftingArea structure={structure} />\n          <fieldset>\n            <legend>{TextManager.get('ui-structure-production-crafting')}</legend>\n            {craftingTasks.map((t) => (\n              <TickingProgressbar\n                key={`${t.name}${t.startTime}`}\n                label={`${TextManager.getItemName(t.name as ItemType)} (${formatDuration(t.timeRemaining)})`}\n                progress={t.progress}\n              />\n            ))}\n          </fieldset>\n          {studyingTasks.length > 0 && (\n          <fieldset>\n            <legend>{TextManager.get('ui-structure-production-studying')}</legend>\n            {studyingTasks.map((t) => (\n              <TickingProgressbar\n                key={`${t.name}${t.startTime}`}\n                label={`${TextManager.getItemName(t.name as ItemType)} (${formatDuration(t.timeRemaining)})`}\n                progress={t.progress}\n              />\n            ))}\n          </fieldset>\n          )}\n        </section>\n      </div>\n    </>\n  );\n};\n\nexport default ProductionStructureView;\n","\nexport const roundIfNeeded = (input: number, digits = 1): number => {\n  return Math.round((input + Number.EPSILON) * Math.pow(10, digits)) / Math.pow(10, digits);\n};\n\nexport const formatNumber = (input: number, digits = 1): string => {\n  const SI_SYMBOL = ['', 'k', 'M', 'G', 'T', 'P', 'E'];\n\n  // what tier? (determines SI symbol)\n  const tier = Math.log10(input) / 3 | 0;\n\n  // if zero, we don't need a suffix\n  if (tier === 0) return roundIfNeeded(input, digits) + '';\n\n  // get suffix and determine scale\n  const suffix = SI_SYMBOL[tier];\n  const scale = Math.pow(10, tier * 3);\n\n  // scale the number\n  const scaled = input / scale;\n  // format number and add suffix\n  return roundIfNeeded(scaled, digits) + suffix;\n};\n","import { useRef } from 'react';\nimport { useSelector } from 'react-redux';\nimport { Resource } from 'definitions/resources';\nimport resourceDescriptions from 'definitions/resources';\nimport { ResourceStoreState } from 'store/types/resources';\nimport { TextManager } from 'global/TextManager';\nimport ReactMarkdown from 'react-markdown';\nimport { StructuresStoreState } from 'store/types/structures';\nimport { getStructureByResource } from 'definitions/structures';\nimport { StoreState } from 'store/types';\nimport { StructureState } from 'store/types/structure';\nimport { formatNumber } from 'utils/format/number';\nimport Icon from '../../ui/common/Icon';\nimport { BubbleLayer, BubbleManager, BubbleType } from 'global/BubbleManager';\nimport { Point } from 'pixi.js';\nimport './styles/resourcesBox.scss';\n\nexport interface Props {\n  className?: string;\n  resources: ResourceStoreState;\n  structures: StructuresStoreState;\n  maxResources: ResourceStoreState;\n  deltaResources: ResourceStoreState;\n}\n\n/**\n * The ResourcesBox is used in the Warehouse to show a list of resources\n */\nconst ResourcesBox = (props: Props) => {\n  const {\n    resources,\n    deltaResources,\n  } = props;\n  const structures = useSelector<StoreState, StructuresStoreState>(store => store.structures);\n  const className = `resources-box ${(props.className || '')}`;\n  const ref = useRef<HTMLDivElement>(null);\n\n  return (\n    <div className={className} ref={ref}>\n      {\n        Object.keys(resources).map((value: string) => {\n          const resource = value as Resource;\n          const resourceDescription = resourceDescriptions[resource];\n          const amount = props.resources[resource] || 0;\n          if (!resourceDescription) {\n            throw new Error(`No resource description found for ${resource}`);\n          }\n\n          if (deltaResources[resource]) {\n            // Show bubble\n            const el = ref.current?.querySelector(`[data-resource=\"${resource}\"] .amount`);\n            const rect = el?.getBoundingClientRect();\n            const point = new Point(rect?.right, rect?.top);\n\n            BubbleManager.addBubble(`+ ${deltaResources[resource]?.toFixed(2)}`, point, BubbleType.resource, BubbleLayer.general);\n          }\n\n          const structure = getStructureByResource(Resource[resource]);\n\n          const full = amount >= (props.maxResources?.[resource] ?? 0);\n          return (\n            <div className=\"row\" data-resource={resource} key={resource}>\n              <Icon image={resourceDescription.iconImg} size=\"smallest\"/>\n              <div className=\"name\">\n                { TextManager.getResourceName(resource as Resource) }\n              </div>\n              <div className={`amount${full ? ' full' : ''}`}  >\n                { formatNumber(amount, 0) }\n              </div>\n              <div className=\"max\" >\n                { ` /${props.maxResources[resource]}` }\n              </div>\n              <div className=\"structure\">\n                {structures[structure].state === StructureState.Built ? (\n                  <ReactMarkdown>{TextManager.get('ui-structure-warehouse-resources-source-link', { structure })}</ReactMarkdown>\n                ) : (\n                  <>\n                    <ReactMarkdown>{TextManager.get('ui-structure-warehouse-resources-source', { structure })}</ReactMarkdown>\n                    <span className=\"unbuilt\">\n                      {TextManager.get('ui-structure-warehouse-resources-source-unbuilt')}\n                    </span>\n                  </>\n                )}\n              </div>\n            </div>\n          );\n        })\n      }\n    </div>\n  );\n};\n\nexport default ResourcesBox;\n\n\n","import { Resource } from 'definitions/resources';\n\n// The keys should be the same as the enum Resource\nexport interface ResourceStoreState {\n  [Resource.wood]?: number;\n  [Resource.iron]?: number;\n  [Resource.stone]?: number;\n  [Resource.leather]?: number;\n  [Resource.fabric]?: number;\n  [Resource.food]?: number;\n}\n\nexport const empty: ResourceStoreState = {\n  fabric: 0,\n  food: 0,\n  iron: 0,\n  leather: 0,\n  stone: 0,\n  wood: 0,\n};\n","import React, { useState } from 'react';\nimport { Props as TabProps } from './Tab';\nimport { SoundManager } from 'global/SoundManager';\nimport './styles/tabstrip.scss';\n\nexport interface Props<T extends string> {\n  className?: string;\n  children: React.ReactElement<TabProps<T>>[] |  React.ReactElement<TabProps<T>>;\n  activeTab?: string;\n  disabled?: boolean;\n  onClick?: React.MouseEventHandler<Element>;\n  onTabSelected?: (tabId: T) => void;\n}\n\nconst Tabstrip = <T extends string> (props: Props<T>) => {\n  const { activeTab = null, onClick } = props;\n  // used in autocollapse\n  const [open, setOpen] = useState(false);\n\n  if (!activeTab && props.children && props.children) {\n    //activeTab = props.children[0].props.id;\n  }\n  const className = `${props.className}${(props.disabled ? ' disabled' : '')}`;\n\n  const handleTabClick = (tabId: T) => {\n    if (props.onTabSelected && props.disabled !== true) {\n      props.onTabSelected(tabId);\n    }\n  };\n\n  const children = React.Children.map(props.children, (child: React.ReactElement<TabProps<T>>) => {\n    const clone: React.ReactElement<TabProps<T>> = React.cloneElement(child, {\n      active: child.props.id === activeTab,\n      onClick: () => { handleTabClick(child.props.id); },\n    });\n    return clone;\n  });\n\n  const handleClick = (e: React.MouseEvent<Element>) => {\n    SoundManager.playSound('ui/buttonClick');\n    onClick?.(e);\n    setOpen(!open);\n  };\n\n  return (\n    <>\n      <ul className={`tabstrip ${className ?? ''}`} onClick={handleClick}>\n        <input type=\"checkbox\" className=\"open\" id=\"open\" checked={open} onChange={() => setOpen(!open)} />\n        {children}\n      </ul>\n    </>\n  );\n};\n\nexport default Tabstrip;\n","import * as React from 'react';\n\nexport interface Props<T extends string>  {\n  id: T;\n  className?: string;\n  onClick?: React.MouseEventHandler<Element>;\n  active?: boolean;\n}\n\n\nconst Tab = <T extends string> (props: React.PropsWithChildren<Props<T>>) => {\n  const handleClick = (e: React.MouseEvent<HTMLLIElement>) => {\n    if (props.onClick) {\n      props.onClick(e);\n    }\n  };\n  const className = ((props.active) ? 'active' : '') + (props.className || '');\n  return (\n    <li className={`tabstrip-tab ${className}`} onClick={handleClick}>\n      {props.children}\n    </li>\n  );\n};\n\nexport default Tab;\n","import Icon, { IconSize } from 'components/ui/common/Icon';\nimport { AdventurerStoreState } from 'store/types/adventurer';\nimport './styles/adventurerAvatar.scss';\n\nexport interface Props {\n  adventurer: AdventurerStoreState;\n  className?: string;\n  displayName?: boolean;\n  onClick?: (adventurerId: string) => void;\n  size?: IconSize;\n}\n\n/**\n * The AdventurerAvatar displays the avatar of an adventurer\n */\nconst AdventurerAvatar = (props: Props) => {\n  const {\n    adventurer,\n    size,\n  } = props;\n\n  const className = `${(props.className || '')} avatar`;\n\n  const handleClick = () => {\n    if (props.onClick) {\n      props.onClick(props.adventurer.id);\n    }\n  };\n  return (\n    <Icon\n      className={className}\n      image={adventurer.avatarImg}\n      size={size}\n      onClick={handleClick}\n    />\n  );\n};\n\nexport default AdventurerAvatar;\n","import Tabstrip from 'components/ui/tabs/Tabstrip';\nimport { AdventurerStoreState } from 'store/types/adventurer';\nimport Tab from 'components/ui/tabs/Tab';\nimport AdventurerAvatar from 'components/ui/adventurer/AdventurerAvatar';\nimport { IconSize } from 'components/ui/common/Icon';\n\ninterface Props {\n  adventurers: AdventurerStoreState[];\n  selectedAdventurerId?: string;\n  onAdventurerTabSelected: (adventurerId: string) => void;\n  disabled?: boolean;\n}\n\n// Shows adventurer portraits in a tabstrip\nconst AdventurerTabstrip = (props: Props) => {\n  const { adventurers, onAdventurerTabSelected } = props;\n\n  const handleAdventurerTabSelected = (adventurerId: string) => {\n    const adventurer = props.adventurers.find(a => a.id === adventurerId);\n    if (adventurer) onAdventurerTabSelected(adventurer.id);\n  };\n\n  const renderAdventurerTab = (adventurer: AdventurerStoreState) => (\n    <Tab id={adventurer.id} key={adventurer.id}>\n      <AdventurerAvatar adventurer={adventurer} size={IconSize.small}/>\n    </Tab>\n  );\n  return (\n    <Tabstrip\n      className=\"adventurers-tabstrip\"\n      onTabSelected={handleAdventurerTabSelected}\n      activeTab={props.selectedAdventurerId}\n      disabled={props.disabled}\n    >\n      {adventurers.map((a) => renderAdventurerTab(a))}\n    </Tabstrip>\n  );\n};\n\nexport default AdventurerTabstrip;\n","import { PropsWithChildren } from 'react';\nimport { DragSourceType, DragType } from 'constants/dragging';\nimport { Item } from 'definitions/items/types';\nimport { useDrop } from 'react-dnd';\nimport { InventoryItemDragInfo } from '../items/DraggableItemIcon';\nimport { IconSize } from '../common/Icon';\nimport { itemAndEquipmentSlotMatch } from '../adventurer/EquipmentSlot';\n\nexport interface Props {\n  item: Item | null;\n  sourceId?: string;\n  size?: IconSize;\n  disabled?: boolean;\n  dependencies?: unknown[];\n  onDrop: (info: InventoryItemDragInfo) => void;\n  canDropHere?: ( dragInfo: InventoryItemDragInfo ) => boolean;\n}\n\nexport interface CollectedProps {\n  canDrop: boolean;\n  isOver: boolean;\n}\n\n/**\n * The InventorySlot displays a slot in which an item can be placed.\n */\nconst InventorySlot = (props: PropsWithChildren<Props>) => {\n  const {\n    item,\n    disabled,\n    sourceId,\n    dependencies = [],\n    canDropHere,\n    onDrop,\n  } = props;\n\n  const [{ isOver, canDrop }, dropRef] = useDrop<InventoryItemDragInfo, void, CollectedProps>(() => ({\n    accept: DragType.ITEM,\n    collect: (monitor) => ({\n      canDrop: monitor.canDrop(),\n      isOver: monitor.isOver(),\n    }),\n    canDrop: (dragInfo: InventoryItemDragInfo) => {\n      if (dragInfo.sourceType === DragSourceType.adventurerEquipment && dragInfo.inventorySlot !== undefined) {\n        return item == null || itemAndEquipmentSlotMatch(item.type, dragInfo.inventorySlot);\n      }\n      return canDropHere?.(dragInfo) ?? true;\n    },\n    drop: (dragInfo: InventoryItemDragInfo) => {\n      return onDrop(dragInfo);\n    },\n  }), [sourceId, ...dependencies]);\n  const isActive = isOver && canDrop;\n\n  const className = [\n    'inventory-item',\n    ...(disabled ? ['disabled'] : []),\n    ...(isActive ? ['drop-active'] : []),\n    ...(!isActive && canDrop ? ['drop-possible'] : []),\n  ].join(' ');\n\n\n  return (\n    <div className={className} ref={dropRef}>\n      { props.children }\n    </div>\n  );\n};\n\nexport default InventorySlot;\n\n","import { useMemo } from 'react';\nimport { IconSize } from 'components/ui/common/Icon';\nimport { DragSourceType, DragType } from 'constants/dragging';\nimport { Item } from 'definitions/items/types';\nimport ItemIcon from './ItemIcon';\nimport { useDrag } from 'react-dnd';\nimport { ItemSource } from 'constants/items';\n\nexport interface Props {\n  index: number;\n  item: Item;\n  sourceType: DragSourceType;\n  sourceId?: string;\n  size?: IconSize;\n\n  onStartDrag?: () => void;\n  onClick?: (event: React.MouseEvent) => void;\n}\n\ninterface CollectedProps {\n  isDragging: boolean;\n}\n\nexport interface InventoryItemDragInfo { // todo: rename to ItemDragInfo\n  item: Item;\n  inventorySlot?: number;\n  sourceId?: string;\n  sourceType: DragSourceType;\n}\n\n\nconst DraggableItemIcon = (props: Props) => {\n\n  const { item, onClick, size, index, sourceType, sourceId } = props;\n\n  const [collected, dragRef] = useDrag<InventoryItemDragInfo, null, CollectedProps>(() => ({\n    type: DragType.ITEM,\n    item: {\n      inventorySlot: index,\n      item,\n      sourceId,\n      sourceType,\n    },\n  }), [item]);\n\n  const handleClick = (event: React.MouseEvent) => {\n    onClick?.(event);\n  };\n\n  const source = useMemo<ItemSource>(() => ({\n    origin: sourceType,\n    id: sourceId,\n    slot: index,\n  }), [index, sourceId, sourceType]);\n\n  if (collected.isDragging) {\n    // TODO: can show some sort of empty state?\n    return null;\n  }\n\n  // The wrapping div is needed by ReactDnD\n  return (\n    <div ref={dragRef}>\n      <ItemIcon\n        item={item}\n        source={source}\n        onClick={handleClick}\n        size={size}\n      />\n    </div>\n  );\n};\n\nexport default DraggableItemIcon;\n","import { DragSourceType } from 'constants/dragging';\nimport { Item } from 'definitions/items/types';\nimport InventorySlot from './InventorySlot';\nimport DraggableItemIcon, { InventoryItemDragInfo } from '../items/DraggableItemIcon';\nimport { IconSize } from '../common/Icon';\nimport './styles/inventory.scss';\n\nexport type Props = {\n  items: (Item | null)[];\n  sourceId?: string;   // who does this inventory belong to?\n  sourceType: DragSourceType;\n  iconSize?: IconSize;\n  className?: string;\n  disabledIndex?: number;\n\n  onDropItem: (item: Item, fromSlot: number, toSlot: number, sourceType: DragSourceType, sourceId?: string) => void;\n  onStartDrag?: (item: Item, fromSlot: number) => void;\n  canDropHere?: (dragInfo: InventoryItemDragInfo) => boolean;\n};\n\n/**\n * Inventory is used to show Items. They can be dragged about\n * @param props\n */\nconst Inventory = (props: Props) => {\n  const { items, disabledIndex, sourceId, sourceType, iconSize, canDropHere, onStartDrag } = props;\n  const slots = [];\n  for (let i = 0; i < items.length; i++) {\n    let contents;\n    const item = items[i];\n    const handleDrop = (dragInfo: InventoryItemDragInfo) => {\n      if (dragInfo.inventorySlot === i && dragInfo.sourceType === props.sourceType && dragInfo.sourceId === props.sourceId) {\n        return;\n      }\n      if (props.onDropItem && dragInfo.inventorySlot !== undefined) {\n        const { inventorySlot: fromSlot } = dragInfo;\n        props.onDropItem(dragInfo.item, fromSlot, i, dragInfo.sourceType, dragInfo.sourceId);\n      }\n    };\n\n    const handleCheckDrop = (dragInfo: InventoryItemDragInfo) => {\n      return canDropHere ? canDropHere(dragInfo) : true;\n    };\n\n    const handleStartDrag = () => {\n      if (item) {\n        onStartDrag?.(item, i);\n      }\n    };\n\n    if (item) {\n      contents = (\n        <DraggableItemIcon\n          index={i}\n          sourceId={sourceId}\n          sourceType={sourceType}\n          item={item}\n          onStartDrag={handleStartDrag}\n        />\n      );\n    }\n\n    const slot = (\n      <InventorySlot\n        key={`inventory-slot-${i}`}\n        item={item}\n        size={iconSize}\n        disabled={disabledIndex === i}\n        sourceId={sourceId}\n        onDrop={handleDrop}\n        canDropHere={handleCheckDrop}\n        dependencies={[items]}\n      >\n        {contents}\n      </InventorySlot>\n    );\n    slots.push(slot);\n  }\n  return (\n    <div className={`inventory ${props.className ? props.className : ''}`}>\n      {slots}\n    </div>\n  );\n};\nexport default Inventory;\n","import { createContext, PropsWithChildren, useState, useMemo, useEffect } from 'react';\nimport { useStore } from 'react-redux';\nimport { SceneControllerManager } from 'global/SceneControllerManager';\nimport { BaseSceneController } from 'mechanics/scenes/BaseSceneController';\nimport { StoreState } from 'store/types';\nimport LoadingSpinner from 'components/ui/loading/LoadingSpinner';\nimport usePrevious from 'hooks/usePrevious';\n\nexport const SceneControllerContext = createContext<BaseSceneController<unknown> | null>(null);\n\nexport interface Props {\n  questName: string;\n}\n\nconst SceneControllerContextProvider = (props: PropsWithChildren<Props>) => {\n  const { questName, children } = props;\n  const store = useStore<StoreState>();\n  const [loaded, setLoaded] = useState<boolean>(false);\n  const storeState = store.getState();\n  const quest = storeState.quests.find(q => q.name === questName);\n  if (!quest) throw Error('No quest found');\n  const { scene, sceneName, questVars } = quest;\n  const previousQuestVars = usePrevious(questVars);\n\n  const controller = useMemo(() => {\n    if (!sceneName) {\n      return null;\n    }\n    return SceneControllerManager.getSceneController(questName, sceneName, store);\n  }, [questName, sceneName, store]);\n\n  useEffect(() => {\n    setLoaded(false);\n    if (sceneName && controller && !controller.dataLoading) {\n      const loadingComplete = () => {\n        setLoaded(true);\n\n        // If the store has no scene for this quest yet, create and store it!\n        if (!scene && controller) {\n          controller.createScene();\n        }\n        controller.sceneEntered();\n      };\n      controller.loadData(loadingComplete);\n    }\n    return () => {\n      controller?.sceneExited();\n    };\n  }, [controller, questName, scene, sceneName]);\n\n  useEffect(() => {\n    if (questVars !== previousQuestVars && controller?.dataLoadComplete) {\n      controller.updateScene();\n    }\n  }, [controller, previousQuestVars, questVars]);\n\n  if (controller && (controller.dataLoading || !loaded)) {\n    return (\n      <LoadingSpinner />\n    );\n  }\n  return (\n    <SceneControllerContext.Provider value={controller}>\n      {children}\n    </SceneControllerContext.Provider>\n  );\n};\n\nexport default SceneControllerContextProvider;\n","import { useContext } from 'react';\nimport { useDispatch } from 'react-redux';\nimport { Action } from 'redux';\nimport { removeItemFromInventory, assignEquipment, addItemToInventory, removeEquipment, moveItemInInventory } from 'store/actions/adventurers';\nimport { removeItemFromWarehouse, addItemToWarehouse, moveItemInWarehouse } from 'store/actions/stockpile';\nimport { EquipmentSlotType } from 'components/ui/adventurer/EquipmentSlot';\nimport { Item, ItemCategory } from 'definitions/items/types';\nimport { DragSourceType } from 'constants/dragging';\nimport { AdventurerStoreState } from 'store/types/adventurer';\nimport { SceneControllerContext } from 'components/world/QuestPanel/context/SceneControllerContext';\nimport { InventoryItemDragInfo } from 'components/ui/items/DraggableItemIcon';\nimport { SoundManager } from 'global/SoundManager';\nimport { useStockpileState } from 'hooks/store/stockpile';\nimport { getDefinition } from 'definitions/items';\nimport { StockpileStoreState } from 'store/types/stockpile';\n\n/* Exposes\n- dropItemEquipment,\n- dropItemInventory,\n- dropItemWarehouse\nto use in various places in the UI when an item is dropped somewhere\n*/\nconst useItemDropActions = () => {\n  const dispatch = useDispatch();\n  const sceneController = useContext(SceneControllerContext);  // is only available when in a scene\n  const stockpile = useStockpileState();\n\n  // When an item gets dropped on equipment slot\n  const dropItemEquipment = (dragInfo: InventoryItemDragInfo, slotType: EquipmentSlotType, adventurer: AdventurerStoreState) => {\n    const item = dragInfo.item;\n    const actions: Action[] = [];\n\n    SoundManager.playSound('ui/equip');\n    switch (dragInfo.sourceType) {\n      // Dragged from inventory\n      case DragSourceType.adventurerInventory: {\n        actions.push(\n          // Item gets removed from inventory\n          removeItemFromInventory(adventurer.id, dragInfo.inventorySlot ?? -1),\n          // Item gets assigned to an equipment slot\n          assignEquipment(adventurer.id, slotType, item),\n        );\n\n        const existingEquipment = adventurer.equipment[slotType as EquipmentSlotType];\n        if (existingEquipment) {\n          // There is already an item in this slot. Place in inventory\n          actions.push(addItemToInventory(adventurer.id, existingEquipment, dragInfo.inventorySlot ?? -1));\n        }\n        break;\n      }\n      // Dragged from warehouse.\n      case DragSourceType.warehouse: {\n        const definition = getDefinition(item.type);\n        actions.push(\n          removeItemFromWarehouse(definition.itemCategory, dragInfo.inventorySlot ?? -1),\n          assignEquipment(adventurer.id, slotType, item),\n        );\n\n        const existingEquipment = adventurer.equipment[slotType as EquipmentSlotType];\n        if (existingEquipment) {\n          // There is already an item in this slot. Place in warehouse\n          actions.push(addItemToWarehouse(existingEquipment, dragInfo.inventorySlot ?? -1));\n        }\n        break;\n      }\n\n      // Dragged from equipment slot (only applicable to weapons)\n      case DragSourceType.adventurerEquipment: {\n        actions.push(\n          assignEquipment(adventurer.id, slotType, item),\n        );\n\n        const existingEquipment = adventurer.equipment[slotType as EquipmentSlotType];\n        const fromSlot = dragInfo.inventorySlot ?? -1;\n        if (existingEquipment) {\n          // Another weapon was there, switch them\n          actions.push(assignEquipment(adventurer.id, fromSlot, existingEquipment));\n        } else {\n          // Clear the slot where it came from\n          actions.push(removeEquipment(adventurer.id, fromSlot));\n        }\n        break;\n      }\n    }\n    actions.forEach(a => dispatch(a));\n  };\n\n  // When an item gets dropped on an adventurer inventory\n  const dropItemInventory = (item: Item, fromSlot: number, toSlot: number, sourceType: DragSourceType, adventurer: AdventurerStoreState, sourceId?: string): void => {\n    const actions: Action[] = [];\n\n    switch (sourceType) {\n      // Drag from one inventory slot to another\n      case DragSourceType.adventurerInventory:\n        actions.push(moveItemInInventory(adventurer.id, fromSlot, toSlot));\n        break;\n\n      // Dragged from warehouse\n      case DragSourceType.warehouse: {\n        const definition = getDefinition(item.type);\n        actions.push(\n          removeItemFromWarehouse(definition.itemCategory, fromSlot),\n          addItemToInventory(adventurer.id, item, toSlot),\n        );\n        const otherItem = adventurer.inventory[toSlot];\n        if (otherItem) {\n          actions.push(\n            addItemToWarehouse(otherItem, fromSlot),\n          );\n        }\n        break;\n      }\n\n      // Drag from equipment slot\n      case DragSourceType.adventurerEquipment: {\n        actions.push(\n          addItemToInventory(adventurer.id, item, toSlot),\n        );\n\n        const existingEquipment = adventurer.inventory[toSlot];\n        if (existingEquipment) {\n          // Was dropped on another piece of equipment in inventory, switch them\n          actions.push(assignEquipment(adventurer.id, fromSlot, existingEquipment));\n        } else {\n          // Clear the slot where it came from\n          actions.push(removeEquipment(adventurer.id, fromSlot));\n        }\n        break;\n      }\n\n      // Dragged from lootCache on a scene\n      case DragSourceType.lootCache: {\n        if (sceneController && sourceId) {\n          // Let the scene controller handle this action\n          sceneController.takeItemFromCache(fromSlot, sourceId, adventurer.id, toSlot);\n        }\n      }\n    }\n    actions.forEach(a => dispatch(a));\n  };\n\n  // When an item gets dropped on the warehouse inventory\n  const dropItemWarehouse = (item: Item, fromSlot: number, toSlot: number, sourceType: DragSourceType, sourceId = ''): void => {\n    const actions: Action[] = [];\n    const definition = getDefinition(item.type);\n    const stockpileCategory = ItemCategory[definition.itemCategory] as keyof StockpileStoreState;\n\n    switch (sourceType) {\n      // Dragged from the warehouse itself\n      case DragSourceType.warehouse: {\n        actions.push(\n          moveItemInWarehouse(definition.itemCategory, fromSlot, toSlot),\n        );\n        const otherItem = stockpile[stockpileCategory][toSlot];\n        if (otherItem) {\n          actions.push(\n            addItemToInventory(sourceId, otherItem, fromSlot),\n          );\n        }\n        break;\n      }\n      // Dragged from an adventurer inventory\n      case DragSourceType.adventurerInventory: {\n        actions.push(\n          removeItemFromInventory(sourceId, fromSlot),\n          addItemToWarehouse(item, toSlot),\n        );\n        const otherItem = stockpile[stockpileCategory][toSlot];\n        if (otherItem) {\n          actions.push(\n            addItemToInventory(sourceId, otherItem, fromSlot),\n          );\n        }\n        break;\n      }\n      // Drag from equipment slot\n      case DragSourceType.adventurerEquipment: {\n        actions.push(\n          removeEquipment(sourceId, fromSlot),\n          addItemToWarehouse(item, toSlot),\n        );\n\n        const otherItem = stockpile[stockpileCategory][toSlot];\n        if (otherItem) {\n          actions.push(\n            assignEquipment(sourceId, fromSlot, otherItem),\n          );\n        }\n        break;\n      }\n    }\n    actions.forEach(a => dispatch(a));\n  };\n  return {\n    dropItemEquipment,\n    dropItemInventory,\n    dropItemWarehouse,\n  };\n};\n\nexport default useItemDropActions;\n","import { levelToXp, MAX_XP, xpToLevel } from 'mechanics/adventurers/levels';\nimport PlainProgressbar from 'components/ui/common/progress/PlainProgressbar';\nimport { TextManager } from 'global/TextManager';\nimport { useEffect, useMemo, useState } from 'react';\nimport usePrevious from 'hooks/usePrevious';\nimport { useAdventurer } from 'hooks/store/adventurers';\nimport { SoundManager } from 'global/SoundManager';\nimport './styles/level.scss';\n\nexport interface Props {\n  adventurerId: string;\n}\n\nconst Level = (props: Props) => {\n  const { adventurerId } = props;\n  const { xp } = useAdventurer(adventurerId);\n  const currentLevel = xpToLevel(xp);\n  const currentLevelXp = levelToXp(currentLevel); // start\n  const nextLevel = currentLevel + 1;\n  const nextLevelXp = levelToXp(nextLevel);\n  const [dingAnimationRunning, setDingAnimationRunning] = useState(false);\n\n  const lastState = usePrevious({ currentLevel, currentLevelXp, nextLevel, nextLevelXp });\n  const lastAdventurer = usePrevious(adventurerId);\n\n  useEffect(() => {\n    if (lastAdventurer !== adventurerId) {\n      setDingAnimationRunning(false);\n    } else if (nextLevel > (lastState?.nextLevel ?? 0)) {\n      SoundManager.playSound('ui/levelUp');\n      setDingAnimationRunning(true);\n\n      setTimeout(() => {\n        setDingAnimationRunning(false);\n      }, 2000);\n    }\n  }, [adventurerId, lastAdventurer, lastState?.nextLevel, nextLevel]);\n\n  const lastDingAnimationRunning = usePrevious(dingAnimationRunning);\n\n  const progress = useMemo(() => {\n    return dingAnimationRunning ? 1 : (xp - currentLevelXp) / (nextLevelXp - currentLevelXp);\n  }, [currentLevelXp, dingAnimationRunning, nextLevelXp, xp]);\n\n  const label = useMemo(() => {\n    if (dingAnimationRunning) {\n      return TextManager.get('ui-adventurer-info-xp-level-up');\n    }\n    if (xp >= MAX_XP) {\n      return TextManager.get('ui-adventurer-info-xp-level-max');\n    }\n    return TextManager.get('ui-adventurer-info-xp-progress', {\n      xp: Math.floor(xp - currentLevelXp),\n      next: nextLevelXp - currentLevelXp,\n    });\n  }, [dingAnimationRunning, xp, currentLevelXp, nextLevelXp]);\n\n  return (\n    <div className=\"level\">\n      <div className=\"text\">\n        {TextManager.get('ui-adventurer-info-level', { level: currentLevel })}\n      </div>\n      <PlainProgressbar\n        progress={progress}\n        animationTime={lastAdventurer === adventurerId && !lastDingAnimationRunning ? 300 : 0}\n        label={label}\n      />\n    </div>\n  );\n};\nexport default Level;\n","import { createSelectorCreator, defaultMemoize } from 'reselect';\nimport stringArrayEqual from 'string-arrays-equal';\n\nexport const createStringArraySelector = createSelectorCreator(\n  defaultMemoize,\n  stringArrayEqual,\n);\n","import { useCallback, useMemo } from 'react';\nimport { StoreState } from 'store/types';\nimport { useSelector } from 'react-redux';\nimport { QuestStatus, QuestStoreState } from 'store/types/quest';\nimport { createSelector } from 'reselect';\nimport { createStringArraySelector } from 'utils/reselect';\nimport { ActorObject, AdventurerObject, EnemyObject, isAdventurer, isEnemy, SceneObject, SceneStoreState } from 'store/types/scene';\n\nconst getQuests = (state: StoreState) => state.quests;\nconst getQuestNames = (state: StoreState) => state.quests.map(q => q.name);\nconst getQuestStatus = (state: StoreState) => state.quests.map(q => q.status);\n\n\nconst getActiveQuests = (quests: QuestStoreState[]) => {\n  // returns the names of the active quests\n  return quests.filter((q) => q.status === QuestStatus.active);\n};\n\n// Returns the quest from redux store\nexport const useQuest = (questName: string) => {\n  const questSelector = useCallback(\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    (state: StoreState) => state.quests.find((q) => q.name === questName)!,\n    [questName],\n  );\n  const quest = useSelector<StoreState, QuestStoreState>(questSelector);\n  return quest;\n};\n\nexport const useQuestScene = (questName: string) => {\n  const scene = useSelector<StoreState, SceneStoreState | undefined>(\n    store => store.quests.find((q) => q.name === questName)?.scene);\n  return scene;\n};\n\n// Returns the active quests from the store\nexport const useActiveQuests = () => {\n  const selectMemoized = useMemo(() => {\n    const activeQuests = createSelector(\n      [getQuests],\n      getActiveQuests,\n    );\n\n    return activeQuests;\n  }, []);\n\n  return useSelector<StoreState, QuestStoreState[]>(selectMemoized);\n};\n\n// Returns the active quests from the store\nexport const useActiveQuestNames = () => {\n  const questNameSelector = useMemo(() => createStringArraySelector(\n    [getQuestNames, getQuestStatus],\n    (names: string[], statuses: QuestStatus[]) => names.filter((_: string, index: number) => statuses[index] === QuestStatus.active),\n  ), []);\n  return useSelector<StoreState, string[]>(questNameSelector);\n};\n\nexport const useQuestSceneObjectByName = <T extends SceneObject>(questName: string, actorName: string): (T | undefined) =>  {\n  const scene = useQuestScene(questName);\n  return useMemo(() => {\n    return scene?.objects.find(sA => sA.name === actorName) as T;\n  }, [actorName, scene?.objects]);\n};\n\nexport const useQuestSceneObjectById = <T extends SceneObject>(questName: string, actorId: string): (T | undefined) =>  {\n  const scene = useQuestScene(questName);\n  return useMemo(() => {\n    return scene?.objects.find(sA => sA.id === actorId) as T;\n  }, [actorId, scene?.objects]);\n};\n\nexport const useActorObject = (questName: string, actorName: string): ActorObject =>  {\n  const scene = useQuestScene(questName);\n  return useMemo(() => {\n    return scene?.objects.find(sA => sA.name === actorName) as ActorObject;\n  }, [actorName, scene?.objects]);\n};\n\nexport const useAdventurerActorObject = (questName: string, adventurerId: string): AdventurerObject | undefined=>  {\n  const scene = useQuestScene(questName);\n  return useMemo(() => {\n    return scene?.objects.find(sA => isAdventurer(sA) && sA.adventurerId === adventurerId) as AdventurerObject | undefined;\n  }, [adventurerId, scene?.objects]);\n};\n\nexport const useEnemyActorObject = (questName: string, enemyId: string): EnemyObject =>  {\n  const scene = useQuestScene(questName);\n  return useMemo(() => {\n    return scene?.objects.find(sA => isEnemy(sA) && sA.enemyId === enemyId) as EnemyObject;\n  }, [enemyId, scene?.objects]);\n};\n\nexport const useQuestSceneEnemies = (questName: string): EnemyObject[] =>  {\n  const scene = useQuestScene(questName);\n  return useMemo(() => {\n    return scene?.objects.filter(isEnemy) ?? [];\n  }, [scene?.objects]);\n};\n\nexport const useQuestActionQueue = (questName: string) =>  {\n  const scene = useQuestScene(questName);\n  return useMemo(() => {\n    return scene?.actionQueue ?? [];\n  }, [scene?.actionQueue]);\n};\n","import { TextManager } from 'global/TextManager';\nimport { useActorObject, useQuest } from 'hooks/store/quests';\nimport { AdventurerStoreState } from 'store/types/adventurer';\n\nexport interface Props {\n  adventurer: AdventurerStoreState;\n  questName: string;\n}\n\n/** Used when AdventurerPanel is used in Quest view\n */\nconst ApIndicator = (props: Props) => {\n  const { questName, adventurer } = props;\n  const quest = useQuest(questName);\n\n  const actor = useActorObject(questName ?? '', adventurer.id);\n  const ap = actor?.ap || 0;\n\n  if (!quest?.scene?.combat) {\n    return null;\n  }\n  return (\n    <span>{TextManager.get('ui-adventurer-info-ap-remaining', { ap })}</span>\n  );\n};\n\nexport default ApIndicator;\n","import { TraitDefinition, Trait } from './types';\n\nconst all = {\n  [Trait.arrowFinder]: {\n    trait: Trait.arrowFinder,\n    hasEffect: true,\n  },\n  [Trait.gloomy]: {\n    trait: Trait.gloomy,\n    hasEffect: true,\n  },\n  [Trait.lucky]: {\n    trait: Trait.lucky,\n    hasEffect: true,\n  },\n  [Trait.houseHouston]: {\n    trait: Trait.houseHouston,\n  },\n  [Trait.houseMaddox]: {\n    trait: Trait.houseMaddox,\n  },\n  [Trait.houseMonroe]: {\n    trait: Trait.houseMonroe,\n  },\n};\n\nexport const getDefinition = (trait: Trait): TraitDefinition => {\n  return all[trait];\n};\n","import React, { Fragment } from 'react';\nimport { useAdventurer } from 'hooks/store/adventurers';\nimport { Trait } from 'definitions/traits/types';\nimport { getDefinition } from 'definitions/traits';\nimport { TextManager } from 'global/TextManager';\nimport { ContextType } from 'constants/context';\nimport { TooltipManager } from 'global/TooltipManager';\nimport './styles/adventurerTraits.scss';\n\ninterface Props {\n  adventurerId: string;\n}\n\nconst AdventurerTraits = (props: Props) => {\n  const adventurer = useAdventurer(props.adventurerId);\n\n  const renderTrait = (trait: Trait, last: boolean) => {\n    const traitDefinition = getDefinition(trait);\n    const handleClick = (event: React.MouseEvent) => {\n      const origin = (event.currentTarget as HTMLElement);\n      const originRect = origin.getBoundingClientRect();\n\n      TooltipManager.showContextTooltip(ContextType.trait, traitDefinition, originRect);\n      event.stopPropagation();\n    };\n    return (\n      <Fragment key={trait}>\n        <li onClick={handleClick}>\n          {TextManager.getTraitName(trait)}\n        </li>\n        {!last && (', ')}\n      </Fragment>\n    );\n  };\n\n  if (!adventurer?.traits) {\n    return null;\n  }\n  return (\n    <>\n      <h3 className='title'>{TextManager.get('ui-adventurer-info-traits-title')}</h3>\n      <ul className=\"adventurer-traits\">\n        {adventurer.traits && adventurer.traits.map((t, i, a)=> renderTrait(t, i === a.length - 1))}\n      </ul>\n    </>\n  );\n};\n\nexport default AdventurerTraits;\n","import React from 'react';\nimport { EquipmentSlotType } from 'components/ui/adventurer/EquipmentSlot';\nimport { useAdventurerDamageReduction } from 'hooks/store/adventurers';\nimport './styles/guy.scss';\n\nexport interface Props {\n  adventurerId: string\n}\n\n// A silhouette of a person with the Damage Reduction numbers\nconst Guy = (props: Props) => {\n  const { adventurerId } = props;\n\n  const damageReduction = useAdventurerDamageReduction(adventurerId);\n  const renderDamageReduction = (equipmentType: EquipmentSlotType) => {\n    const dR = damageReduction[EquipmentSlotType[equipmentType]];\n    if (!dR) {\n      return null;\n    }\n    return (\n      <div className={EquipmentSlotType[equipmentType]} key={equipmentType}>\n        {dR}\n      </div>\n    );\n  };\n\n  return (\n    <li className=\"guy\">\n      {(renderDamageReduction(EquipmentSlotType.head))}\n      {(renderDamageReduction(EquipmentSlotType.chest))}\n      {(renderDamageReduction(EquipmentSlotType.hands))}\n      {(renderDamageReduction(EquipmentSlotType.shoulders))}\n      {(renderDamageReduction(EquipmentSlotType.legs))}\n      {(renderDamageReduction(EquipmentSlotType.feet))}\n    </li>\n  );\n};\n\nexport default Guy;\n","import EquipmentSlot, { EquipmentSlotType, rangedWeaponInHand } from 'components/ui/adventurer/EquipmentSlot';\nimport { Item } from 'definitions/items/types';\nimport DraggableItemIcon, { InventoryItemDragInfo } from 'components/ui/items/DraggableItemIcon';\nimport { DragSourceType } from 'constants/dragging';\nimport { TextManager } from 'global/TextManager';\nimport { IconSize } from 'components/ui/common/Icon';\nimport Guy from './Guy';\nimport { useAdventurer } from 'hooks/store/adventurers';\nimport './styles/adventurerEquipment.scss';\n\nexport interface Props {\n  adventurerId: string\n  onDropItemEquipment: (dragInfo: InventoryItemDragInfo, slotType: EquipmentSlotType) => void;\n}\n\n// Shows the gear an adventurer is wearing\nconst AdventurerEquipment = (props: Props) => {\n  const { adventurerId, onDropItemEquipment } = props;\n  const adventurer = useAdventurer(adventurerId);\n\n  const getEquipmentSlot = (slotType: EquipmentSlotType) => {\n    // returns EquipmentSlot\n    const item: Item | undefined = adventurer.equipment[slotType];\n    let text = TextManager.getEquipmentSlot(slotType);\n\n    if (slotType === EquipmentSlotType.offHand) {\n      // If there a ranged weapon in the main hand the offHand is for ammo\n      if (rangedWeaponInHand(adventurer.equipment)) {\n        text = TextManager.get('ui-equipmentslot-ammunition');\n      }\n    }\n    const handleDrop = (dragInfo: InventoryItemDragInfo) => {\n      onDropItemEquipment(dragInfo, slotType);\n    };\n\n    return (\n      <li className={EquipmentSlotType[slotType]}>\n        <EquipmentSlot\n          onDrop={handleDrop}\n          adventurerId={adventurerId}\n          type={slotType}\n        >\n          {item && (\n            <DraggableItemIcon\n              index={slotType}\n              sourceId={adventurer.id}\n              sourceType={DragSourceType.adventurerEquipment}\n              item={item}\n              size={IconSize.medium}\n            />\n          )}\n        </EquipmentSlot>\n        <span className=\"info\">\n          {text}\n        </span>\n      </li>\n    );\n  };\n\n  return (\n    <ul className=\"adventurer-equipment\">\n      {getEquipmentSlot(EquipmentSlotType.head)}\n      {getEquipmentSlot(EquipmentSlotType.chest)}\n      {getEquipmentSlot(EquipmentSlotType.hands)}\n      {getEquipmentSlot(EquipmentSlotType.shoulders)}\n      {getEquipmentSlot(EquipmentSlotType.legs)}\n      {getEquipmentSlot(EquipmentSlotType.feet)}\n      {getEquipmentSlot(EquipmentSlotType.mainHand)}\n      {getEquipmentSlot(EquipmentSlotType.offHand)}\n      <Guy adventurerId={adventurer.id} />\n    </ul>\n  );\n};\n\nexport default AdventurerEquipment;\n\n\n","import PlainProgressbar from 'components/ui/common/progress/PlainProgressbar';\nimport { useAdventurer } from 'hooks/store/adventurers';\nimport { TextManager } from 'global/TextManager';\nimport { xpToLevel } from 'mechanics/adventurers/levels';\nimport { calculateBaseHitpoints } from 'mechanics/adventurers/hitpoints';\nimport { roundIfNeeded } from 'utils/format/number';\n\nexport type Props = {\n  adventurerId: string;\n};\n\nconst Health = (props: Props) => {\n  const { adventurerId } = props;\n  const { health, basicAttributes, xp } = useAdventurer(adventurerId);\n  const level = xpToLevel(xp);\n  const baseHP = calculateBaseHitpoints(level, basicAttributes.for);\n\n  const label = health > 0 ? `${roundIfNeeded(Math.max(health, 0))}/${baseHP}` : TextManager.get('ui-adventurer-info-dead');\n  return (\n    <div className=\"health\">\n      {TextManager.get('ui-adventurer-info-health')}\n      <PlainProgressbar\n        progress={health / baseHP}\n        label={label}\n        variation=\"health\"\n      />\n    </div>\n  );\n};\nexport default Health;\n","import { useDrop } from 'react-dnd';\nimport { DragType } from 'constants/dragging';\nimport { InventoryItemDragInfo } from 'components/ui/items/DraggableItemIcon';\nimport { isConsumable } from 'definitions/items/consumables';\nimport { PropsWithChildren } from 'react';\nimport './styles/consumeItemSlot.scss';\n\nexport interface Props {\n  onDrop: (item: InventoryItemDragInfo) => void;\n}\n\nexport interface CollectedProps {\n  canDrop: boolean;\n  isOver: boolean;\n}\n\n\n/**\n * The ConsumeItemSlot displays a slot in which a consumable item can be placed\n */\nconst ConsumeItemSlot = (props: PropsWithChildren<Props>) => {\n\n  const { onDrop } = props;\n  const [{ canDrop, isOver }, dropRef] = useDrop<InventoryItemDragInfo, void, CollectedProps>(() => ({\n    // The type (or types) to accept - strings or symbols\n    accept: DragType.ITEM,\n    canDrop: ({ item }: InventoryItemDragInfo) => {\n      // Can only drop consumables here\n      return isConsumable(item.type);\n    },\n    drop: (info: InventoryItemDragInfo) => {\n      onDrop(info);\n    },\n    // Props to collect\n    collect: (monitor) => ({\n      isOver: monitor.isOver(),\n      canDrop: monitor.canDrop(),\n    }),\n    //  // The border is still green for some reason ??\n    //  collect: (monitor: DropTargetMonitor<InventoryItemDragInfo>) => {\n    //   const dragInfo = monitor.getItem();\n    //   // Can only drop consumables here\n    //   const canDrop = dragInfo !== null && isConsumable(dragInfo.item) && monitor.canDrop()\n    //   // console.log(canDrop)\n    //   return {\n    //   isOver: monitor.isOver(),\n    //   canDrop\n    //   }\n    // }\n  }));\n  const className = ['consume-item-slot'];\n  if (isOver) {\n    className.push('drop-active');\n  } else if (canDrop) {\n    className.push('drop-possible');\n  }\n  return (\n    <div className={className.join(' ')} ref={dropRef}>\n      {props.children}\n    </div>\n  );\n};\n\nexport default ConsumeItemSlot;\n","import { useAdventurer } from 'hooks/store/adventurers';\nimport { TextManager } from 'global/TextManager';\nimport DraggableItemIcon, { InventoryItemDragInfo } from 'components/ui/items/DraggableItemIcon';\nimport { useMemo } from 'react';\nimport ConsumeItemSlot from './ConsumeItemSlot';\nimport Button from 'components/ui/buttons/Button';\nimport { DragSourceType } from 'constants/dragging';\nimport { IconSize } from 'components/ui/common/Icon';\nimport { consumeItem } from 'store/actions/adventurers';\nimport { useDispatch } from 'react-redux';\nimport { addLogText } from 'store/actions/log';\nimport { LogChannel } from 'store/types/logEntry';\nimport { useQuest } from 'hooks/store/quests';\nimport { getAdventurer } from 'store/types/scene';\nimport { AP_COST_CONSUME } from 'mechanics/combat';\nimport { deductActorAp } from 'store/actions/quests';\nimport { Channel, SoundManager } from 'global/SoundManager';\nimport {  isConsumable } from 'definitions/items/consumables';\nimport './styles/consumeItem.scss';\n\nexport interface Props {\n  adventurerId: string;\n  questName?: string;\n  fromSlot?: number;\n\n  onDrop?: (index: number) => void;\n  onConsumed?: () => void;\n}\n\nconst ConsumeItem = (props: Props) => {\n  const { adventurerId, questName, fromSlot, onDrop, onConsumed } = props;\n  const adventurer = useAdventurer(adventurerId);\n  const quest = useQuest(questName ?? '');\n  const dispatch = useDispatch();\n  const combat = !!quest?.scene?.combat; // if in combat mode, you have to pay AP to consume an item\n  const ap = useMemo(() => {\n    return getAdventurer(quest?.scene?.objects ?? [], adventurerId)?.ap ?? 0;\n  }, [quest, adventurerId]);\n\n  const enoughAp = ap >= AP_COST_CONSUME;\n\n  const handleDrop = (dragInfo: InventoryItemDragInfo) => {\n    if (dragInfo.inventorySlot !== undefined){\n      onDrop?.(dragInfo.inventorySlot);\n    }\n  };\n\n  const item = useMemo(() => {\n    if (fromSlot === undefined) return null;\n    return adventurer?.inventory[fromSlot];\n  }, [adventurer, fromSlot]);\n\n  const handleConsumeItem = () => {\n    if (!adventurerId || !fromSlot) return;\n    const consumable = adventurer.inventory[fromSlot];\n    if (!consumable || !isConsumable(consumable.type)) {\n      throw new Error(`No potion found at index ${fromSlot} `);\n    }\n    if (combat) {\n      if (!questName) return;\n      // Deduct AP from adventurer if in combat\n      dispatch(deductActorAp(questName, adventurerId, AP_COST_CONSUME));\n    }\n\n    dispatch(consumeItem(adventurerId, fromSlot));\n    SoundManager.playSound('scene/drinking', Channel.scene);\n    onConsumed?.();\n\n    // Add log entry\n    if (adventurer) {\n      dispatch(addLogText('adventurer-drink-potion', { item, adventurer: adventurerId }, LogChannel.common));\n    }\n  };\n  return (\n    <fieldset className=\"consume-item\">\n      <legend>{TextManager.get('ui-adventurer-info-use-item')}</legend>\n      <div className=\"content\">\n\n        <ConsumeItemSlot onDrop={handleDrop}>\n          {item && (\n             <DraggableItemIcon\n              index={0}\n              sourceId={adventurerId}\n              sourceType={DragSourceType.adventurerConsumeItem}\n              item={item}\n              size={IconSize.small}\n            />\n          )}\n        </ConsumeItemSlot>\n        <Button\n          className=\"consume-button\"\n          onClick={handleConsumeItem}\n          disabled={!item || (combat && !enoughAp)}\n        >\n          {TextManager.get('ui-adventurer-info-use-item')}\n          {combat && ' ' + TextManager.get('ui-adventurer-info-use-item-ap-cost', { ap: AP_COST_CONSUME })}\n        </Button>\n      </div>\n    </fieldset>\n  );\n};\nexport default ConsumeItem;\n","import { TempEffectType } from 'definitions/tempEffects/types';\n\ninterface Props {\n  effectType: TempEffectType;\n}\n\nconst getIconImage = (effectType: TempEffectType) => {\n  switch (effectType) {\n    case TempEffectType.brokenLegs:\n      return 'knee-bandage.svg';\n    case TempEffectType.burning:\n      return 'flaming-claw.svg';\n    case TempEffectType.soma:\n      return 'embrassed-energy.svg';\n  }\n};\n\nconst EffectIcon = (props: Props) => {\n  const { effectType } = props;\n  // const effectDefinition = getDefinition(effectType);\n  const harmful = true;\n  return (\n    <div\n      className={`effect-icon ${harmful ? 'harmful' : 'not-harmful'}`}\n      style={{\n        backgroundImage: `url(${process.env.PUBLIC_URL}/img/ui/icons/${getIconImage(effectType)})`,\n      }}\n    />\n  );\n};\n\nexport default EffectIcon;\n\n","import React, { Fragment } from 'react';\nimport { useAdventurer } from 'hooks/store/adventurers';\nimport { TextManager } from 'global/TextManager';\nimport { ContextType } from 'constants/context';\nimport { TooltipManager } from 'global/TooltipManager';\nimport EffectIcon from './EffectIcon';\nimport { TempEffect } from 'definitions/tempEffects/types';\nimport './styles/adventurerEffects.scss';\n\ninterface Props {\n  adventurerId: string;\n\n}\n\n// Shows temp effects\nconst AdventurerTempEffects = (props: Props) => {\n  const adventurer = useAdventurer(props.adventurerId);\n\n  const renderEffect = (effect: TempEffect) => {\n    // const effectDefinition = getDefinition(effect.type);\n\n    const handleClick = (event: React.MouseEvent) => {\n      const origin = (event.currentTarget as HTMLElement).querySelector('.name');\n      if (!origin) return;\n      const originRect = origin.getBoundingClientRect();\n\n      TooltipManager.showContextTooltip(ContextType.tempEffect, effect, originRect);\n      event.stopPropagation();\n    };\n    return (\n      <Fragment key={effect.type}>\n        <li onClick={handleClick}>\n          <EffectIcon effectType={effect.type} />\n          <div className=\"name\">\n            {TextManager.getTempEffectName(effect)}\n          </div>\n        </li>\n      </Fragment>\n    );\n  };\n\n  if (!adventurer?.tempEffects) {\n    return null;\n  }\n  return (\n    <>\n      <p>{TextManager.get('ui-adventurer-info-effects-title')}</p>\n      <ul className=\"adventurer-effects\">\n        {adventurer.tempEffects && adventurer.tempEffects.map((effect)=> renderEffect(effect))}\n      </ul>\n    </>\n  );\n};\n\nexport default AdventurerTempEffects;\n","import { MAX_VALUE } from 'mechanics/adventurers/attributes';\nimport { useCallback } from 'react';\nimport './styles/attributeIndicator.scss';\n\ntype Props = {\n  base: number;\n  additional?: number;\n};\n\nconst AttributeIndicator = (props: Props) => {\n  const { base, additional = 0 } = props;\n\n  const determineClass = useCallback((index: number) => {\n    if (index <= Math.round(base - 1)) {\n      return 'base';\n    }\n    if (index > Math.round(base - 1) && index <= Math.round(base - 1) + Math.round(additional)) {\n      return 'additional';\n    }\n    return '';\n  }, [additional, base]);\n\n\n\n  return (\n    <div className=\"attribute-indicator\" >\n      {[...Array(MAX_VALUE)].map((_, i) => (\n        <div key={i} className={`blip ${determineClass(i)}`}></div>\n      ))}\n    </div>\n  );\n};\n\nexport default AttributeIndicator;\n","import { Attribute, attributeList } from 'store/types/adventurer';\nimport { TextManager } from 'global/TextManager';\nimport { TooltipManager } from 'global/TooltipManager';\nimport { ContextType } from 'constants/context';\nimport { AttributesExtended, AttributeSourceType, ExtendedAttribute } from 'mechanics/adventurers/attributes';\nimport { roundIfNeeded } from 'utils/format/number';\nimport AttributeIndicator from 'components/ui/attributes/AttributeIndicator';\nimport { Fragment } from 'react';\n\ntype Props = {\n  attributes: AttributesExtended;\n  small?: boolean;\n};\n\n// Seperate list of attributes, intended to share the same container as SkillsListItems\nconst AttributeListItems = (props: Props) => {\n  const { attributes, small } = props;\n\n  const renderRow = (attribute: Attribute) => {\n    const extendedAttribute: ExtendedAttribute = {\n      attribute,\n      components: attributes[attribute],\n    };\n    const handleClick = (event: React.MouseEvent) => {\n      const origin = (event.currentTarget as HTMLElement);\n      const originRect = origin.getBoundingClientRect();\n\n      TooltipManager.showContextTooltip(ContextType.attribute, extendedAttribute, originRect);\n      event.stopPropagation();\n    };\n\n    // Split out base and additional attribute components\n    const { base, additional } = extendedAttribute.components.reduce((acc, value) => {\n      if (value.origin.type === AttributeSourceType.base) {\n        acc.base += value.value;\n      } else {\n        acc.additional += value.value;\n      }\n      return acc;\n    }, { base: 0, additional: 0 });\n\n    return (\n      <Fragment key={attribute}>\n        <div className=\"name\">\n          <span onClick={handleClick}>\n            {small ? attribute : TextManager.getAttributeName(attribute)}\n          </span>\n        </div>\n        <AttributeIndicator base={base} additional={additional} />\n        <div className=\"value-base\">\n          {roundIfNeeded(base)}\n        </div>\n        <div className=\"value-additional\">\n          { additional > 0 && (`+${roundIfNeeded(additional)}`)}\n        </div>\n      </Fragment>\n    );\n  };\n\n\n  return (\n    <>\n      {attributeList.map(a => renderRow(a))}\n    </>\n  );\n};\n\nexport default AttributeListItems;\n","import { AttributesExtended, AttributeSourceType, MAX_VALUE } from 'mechanics/adventurers/attributes';\nimport { CSSProperties } from 'react';\nimport { entries } from 'utils/typescript';\nimport AttributeListItems from './AttributeListItems';\nimport './styles/attributeList.scss';\n\n\ntype Props = {\n  attributes: AttributesExtended;\n  small?: boolean;\n};\n\nconst style = { '--item-count': MAX_VALUE } as CSSProperties;\nconst AttributeList = (props: Props) => {\n  const { attributes } = props;\n  const hasAdditional = entries(attributes).some(([_attr, comp]) => comp.some(c => c.origin.type !== AttributeSourceType.base));\n\n  return (\n    <div className={`attribute-list ${hasAdditional ? 'has-additional' : ''}`} style={style}>\n      <AttributeListItems attributes={attributes} />\n    </div>\n  );\n};\nexport default AttributeList;\n","import { TextManager } from 'global/TextManager';\nimport { TooltipManager } from 'global/TooltipManager';\nimport { ContextType } from 'constants/context';\nimport { roundIfNeeded } from 'utils/format/number';\nimport AttributeIndicator from 'components/ui/attributes/AttributeIndicator';\nimport { Fragment } from 'react';\nimport { WeaponType } from 'definitions/weaponTypes/types';\nimport { SkillsStoreState } from 'store/types/adventurer';\n\ntype Props = {\n  skills: SkillsStoreState;\n};\n\n// Seperate list of skills, intended to share the same container as AttributeListItems\nconst SkillsListItems = (props: Props) => {\n  const { skills } = props;\n\n  const renderRow = (skill: WeaponType) => {\n    const handleClick = (event: React.MouseEvent) => {\n      const origin = (event.currentTarget as HTMLElement);\n      const originRect = origin.getBoundingClientRect();\n\n      TooltipManager.showContextTooltip(ContextType.skill, skill, originRect);\n      event.stopPropagation();\n    };\n\n    const value = skills[skill] ?? 0;\n    return (\n      <Fragment key={skill}>\n        <div className=\"name\">\n          <span onClick={handleClick}>\n            {TextManager.getSkillName(skill)}\n          </span>\n        </div>\n        <AttributeIndicator base={skills[skill] ?? 0} />\n        <div className=\"value-base\">\n          {roundIfNeeded(value)}\n        </div>\n        <div className=\"value-additional\"></div>\n      </Fragment>\n    );\n  };\n\n  return (\n    <>\n       {Object.keys(skills)?.map((s) => {\n         const skill: WeaponType = s as WeaponType;\n         return renderRow(skill);\n       })}\n    </>\n  );\n};\nexport default SkillsListItems;\n","import { AttributeListItems } from 'components/ui/attributes/AttributeList';\nimport SkillsListItems from 'components/ui/skills/SkillsList';\nimport { TextManager } from 'global/TextManager';\nimport { useAdventurer } from 'hooks/store/adventurers';\nimport { AttributeSourceType, calculateEffectiveAttributesExtended, MAX_VALUE } from 'mechanics/adventurers/attributes';\nimport { CSSProperties, useMemo } from 'react';\nimport { entries } from 'utils/typescript';\nimport './styles/attributesAndSkills.scss';\n\ntype Props = {\n  adventurerId: string;\n  skills?: boolean; // whether to show skills\n};\n\nconst style = { '--item-count': MAX_VALUE } as CSSProperties;\nconst AdventurerAttributesAndSkills = (props: Props) => {\n  const { adventurerId, skills } = props;\n  const adventurer = useAdventurer(adventurerId);\n  const extendedAttributes = useMemo(() => calculateEffectiveAttributesExtended(adventurer), [adventurer]);\n  const hasAdditional = entries(extendedAttributes).some(([_attr, comp]) => comp.some(c => c.origin.type !== AttributeSourceType.base));\n\n  return (\n    <section className={`attributes-and-skills ${hasAdditional ? 'has-additional' : ''}`} style={style} id='skills'>\n      <h3 className='title'>{TextManager.get('ui-adventurer-info-attributes-title')}</h3>\n      <AttributeListItems attributes={extendedAttributes} />\n      { skills && (\n        <>\n          <h3 className='title'>{TextManager.get('ui-adventurer-info-skills-title')}</h3>\n          <SkillsListItems skills={adventurer.skills} />\n        </>\n      )}\n    </section>\n  );\n};\n\nexport default AdventurerAttributesAndSkills;\n\n","import { useEffect, useState } from 'react';\nimport { DragSourceType } from 'constants/dragging';\nimport Inventory from 'components/ui/inventory/Inventory';\nimport useItemDropActions from 'hooks/actions/useItemActions';\nimport { EquipmentSlotType } from 'components/ui/adventurer/EquipmentSlot';\nimport { InventoryItemDragInfo } from 'components/ui/items/DraggableItemIcon';\nimport { Item } from 'definitions/items/types';\nimport { useAdventurer } from 'hooks/store/adventurers';\nimport Level from 'components/ui/adventurer/AdventurerPanel/Level';\nimport ApIndicator from './ApIndicator';\nimport AdventurerTraits from './AdventurerTraits';\nimport AdventurerEquipment from './AdventurerEquipment';\nimport { TextManager } from 'global/TextManager';\nimport ReactMarkdown from 'react-markdown';\nimport Health from './Health';\nimport ConsumeItem from './ConsumeItem';\nimport AdventurerEffects from './AdventurerEffects';\nimport AdventurerAttributesAndSkills from './AdventurerAttributesAndSkills';\nimport './styles/adventurerPanel.scss';\n\nexport interface Props {\n  adventurerId: string;\n  questName?: string;\n  horizontalMode?: boolean;\n\n  name?: boolean; // whether to show the adventurer name\n  levelBar?: boolean; // whether to show the level bar\n  effects?: boolean; // whether to show effects\n  traits?: boolean; // whether to show traits\n  skills?: boolean; // whether to show skills\n\n  onStartInventoryItemDrag?: (item: Item, fromSlot: number) => void;\n}\n\n/** Vertical panel showing adventurer info\n */\nconst AdventurerPanel = (props: Props) => {\n  const {\n    adventurerId,\n    questName,\n    horizontalMode,\n    name = true,\n    levelBar = true,\n    effects = true,\n    traits = true,\n    skills = true,\n    onStartInventoryItemDrag,\n  } = props;\n  const adventurer = useAdventurer(adventurerId);\n  const {\n    dropItemEquipment,\n    dropItemInventory,\n  } = useItemDropActions();\n\n  const handleDropItemEquipment = (dragInfo: InventoryItemDragInfo, slotType: EquipmentSlotType) => {\n    dropItemEquipment(dragInfo, slotType, adventurer);\n  };\n  const [consumeItemIndex, setConsumeItemIndex] = useState<number>();\n\n  const handleDropItemInventory = (item: Item, fromSlot: number, toSlot: number, sourceType: DragSourceType, sourceId?: string) => {\n    if (sourceType === DragSourceType.adventurerConsumeItem) {\n      setConsumeItemIndex(undefined);\n    } else {\n      dropItemInventory(item, fromSlot, toSlot, sourceType, adventurer, sourceId);\n    }\n  };\n\n  const handleDropConsumeItem = (fromSlot: number) => {\n    setConsumeItemIndex(fromSlot);\n  };\n\n  useEffect(() => {\n    // selecting another adventurer cancels the consume intent\n    setConsumeItemIndex(undefined);\n  }, [adventurerId]);\n\n  const handleItemConsumed = () => {\n    setConsumeItemIndex(undefined);\n  };\n\n  if (!adventurer) return null;\n\n  return (\n    <div className={`adventurer-panel${(horizontalMode ? ' horizontal' : '')}`}>\n       <section id=\"common\">\n         <div className=\"info\">\n         { name && (\n          <div className=\"name\">\n            <h3 className=\"title\">{adventurer.name}</h3>\n            {questName && <ApIndicator questName={questName} adventurer={adventurer} />}\n          </div>\n         )}\n        { levelBar && <Level adventurerId={adventurer.id}/> }\n        { adventurer.flavor && (\n          <span className=\"flavor\">\n            <img className=\"portrait\" src={`${process.env.PUBLIC_URL}${adventurer.avatarImg}`} alt={adventurer.name} />\n            <ReactMarkdown>\n              {TextManager.getAdventurerFlavor(adventurer.id, adventurer.name)}\n            </ReactMarkdown>\n          </span>\n        )}\n        <Health adventurerId={adventurer.id}/>\n        { effects && <AdventurerEffects adventurerId={adventurerId}/> }\n        { traits && <AdventurerTraits adventurerId={adventurerId}/> }\n        </div>\n      </section>\n      <AdventurerAttributesAndSkills adventurerId={adventurerId} skills={skills} />\n      <section id=\"equipment\">\n        <div className=\"equipment\">\n          <h3 className='title'>{TextManager.get('ui-adventurer-info-equipment-title')}</h3>\n          <AdventurerEquipment\n            adventurerId={adventurerId}\n            onDropItemEquipment={handleDropItemEquipment}\n          />\n        </div>\n      </section>\n      <section id=\"inventory\">\n        <h3 className='title'>{TextManager.get('ui-adventurer-info-inventory-title')}</h3>\n        <Inventory\n          sourceType={DragSourceType.adventurerInventory}\n          sourceId={adventurerId}\n          disabledIndex={consumeItemIndex}\n          items={adventurer.inventory}\n          className=\"inventory-medium\"\n          onDropItem={handleDropItemInventory}\n          onStartDrag={onStartInventoryItemDrag}\n        />\n        <ConsumeItem\n          adventurerId={adventurer.id}\n          questName={questName}\n          fromSlot={consumeItemIndex}\n          onDrop={handleDropConsumeItem}\n          onConsumed={handleItemConsumed}\n        />\n      </section>\n    </div>\n  );\n};\n\nexport default AdventurerPanel;\n","import { useEffect, useRef } from 'react';\nimport debounce from 'debounce';\nimport { TextManager } from 'global/TextManager';\nimport { HashLink } from 'react-router-hash-link';\nimport iconPerson from './styles/images/icon-person.png';\nimport iconHelmet from './styles/images/icon-helmet.png';\nimport iconCrosshair from './styles/images/icon-crosshair.png';\nimport iconSword from './styles/images/icon-sword.png';\nimport './styles/adventurerSectionSelection.scss';\n\nconst AdventurerSectionSelection = () => {\n  const ref = useRef<HTMLUListElement>(null);\n\n  useEffect(() => {\n    const sectionParent = ref?.current?.parentNode as HTMLElement;\n\n    const onScroll = debounce(() => {\n      const fromTop = sectionParent.scrollTop;\n      ref.current?.querySelectorAll('a')?.forEach(link => {\n        const hash = link.hash.substring(link.hash.lastIndexOf('#'));\n        const section = document.querySelector(hash) as HTMLElement;\n\n        if (section && section.offsetTop <= fromTop && section.offsetTop + section.clientHeight > fromTop) {\n          link.classList.add('active');\n        } else {\n          link.classList.remove('active');\n        }\n      });\n    }, 50);\n    sectionParent?.addEventListener('scroll', onScroll);\n    return () => {\n      sectionParent?.removeEventListener('scroll', onScroll);\n    };\n  }, []);\n\n  return (\n    <ul className=\"adventurer-section-selection\" ref={ref}>\n      <li title={TextManager.get('ui-adventurer-info-general-title')}>\n        <HashLink smooth to=\"#common\" className=\"active\">\n          <img src={iconPerson} alt={TextManager.get('ui-adventurer-info-general-title')} />\n        </HashLink>\n      </li>\n      <li title={TextManager.get('ui-adventurer-info-skills-title')}>\n        <HashLink smooth to=\"#skills\">\n          <img src={iconCrosshair} alt={TextManager.get('ui-adventurer-info-skills-title')}/>\n        </HashLink>\n      </li>\n      <li title={TextManager.get('ui-adventurer-info-equipment-title')}>\n        <HashLink smooth to=\"#equipment\">\n          <img src={iconHelmet} alt={TextManager.get('ui-adventurer-info-equipment-title')}/>\n        </HashLink>\n      </li>\n      <li title={TextManager.get('ui-adventurer-info-inventory-title')}>\n        <HashLink smooth to={'#inventory' }>\n          <img src={iconSword} alt={TextManager.get('ui-adventurer-info-inventory-title')}/>\n        </HashLink>\n      </li>\n    </ul>\n  );\n};\n\nexport default AdventurerSectionSelection;\n","export default \"data:image/png;base64,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UmVhZHlxyWU8AAADcWlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDIgNzkuMTYwOTI0LCAyMDE3LzA3LzEzLTAxOjA2OjM5ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIgeG1wTU06T3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOjNmZjJmYzA3LThiNGEtNjQ0Yi1iMjNkLTViMDFlOWRlOGVjZSIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo2RDkzMzJCMjUxNkExMUVBOUM3MDk0RTkwOTBCRTk4NiIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo2RDkzMzJCMTUxNkExMUVBOUM3MDk0RTkwOTBCRTk4NiIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgKFdpbmRvd3MpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6N2RhZTkyNzMtYWI4NC03OTQ0LThjZjctZjliMTFkZjk3MTk4IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjNmZjJmYzA3LThiNGEtNjQ0Yi1iMjNkLTViMDFlOWRlOGVjZSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PvfQy5UAAAAGUExURf///////1V89WwAAAACdFJOU/8A5bcwSgAAAkZJREFUeNrs3cGO4yAUBdHi/396dqPuie3IgOFdT9U+4ixa6gTDM21qHDV5iYe189Ws4E5Fs4g7D81C7xwzS70zzCz2jptZ7h01swM8RGaHd8jMJnA/mV3gbjLbwL1k9oE7yezzdprZCg4Us0IMe8lsBt8nsxt8m8x28F3y28Wwn0wB8D3yu8VQgUwJ8B3ym8VQg/xiMRQhK64jhipkxWXEUIasuIoY6pAVK1ZcVgyFyIoVK1asWLFixUvFfttUrFixu1iK3fFW7NMxxc+KfZK+QOyJkAXivHNCnh5bIc47U+hJ0xXivPPHgWe8A8/RB95VCLzBMpHcVonj7jW1wLtjgffzAu9AjpoHlm1byG2PuNs8tmZbT247xXn3/m+bJyzX2kLzlMXanBZx2/88h+WCPXuFlpbiyuKehy4z/rqn/Wp65kOP71f0fOhRccd/tq17m2F79GnPTNNOhLCuKWLWNi6GYmSKeb+bKef9ZqYi+JJMSfAVmZLey+8oVcGnZMqCz8jUBZ+QKQw+JlMZfEimNPiITG3wAZni4E8y1cEfZMqD/yVTHxwo5lwMAWQSwL/I0WKIIJMB/kEOFkMIOVcMKWRiwIFissWQQw4VQxA5UwxJZMVLxBBFVqz4SExWihW/Q2xmZmZmZmZmZmZmZmZmZmZmZmZmZmZmVUq7DxJ8azMCHTVx43i2QsromOJTpj68pee7HXHrzik80dact3nJbdXeOv5Ne2+acAFs14zprdiRyeN7sPveaNJHXf8miDHo3/4IMAAA0TKWRcqboAAAAABJRU5ErkJggg==\"","export default \"data:image/png;base64,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UmVhZHlxyWU8AAADcWlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDIgNzkuMTYwOTI0LCAyMDE3LzA3LzEzLTAxOjA2OjM5ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIgeG1wTU06T3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOjNmZjJmYzA3LThiNGEtNjQ0Yi1iMjNkLTViMDFlOWRlOGVjZSIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDoyNzBDNjVEMjUxNzExMUVBODM1MkY4N0UwMUZBQ0UxNyIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDoyNzBDNjVEMTUxNzExMUVBODM1MkY4N0UwMUZBQ0UxNyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgKFdpbmRvd3MpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6ODUyMmFiMmUtMjAyMS1hYTQ0LWE2NGUtODI3YjBkYzg0NTA5IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjNmZjJmYzA3LThiNGEtNjQ0Yi1iMjNkLTViMDFlOWRlOGVjZSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PtCL+cMAAAAGUExURf///////1V89WwAAAACdFJOU/8A5bcwSgAAA49JREFUeNrs3VFy3DAMA1Dg/pfuBTqTFQlqBBP8TKw1X+S0WWpFgVcD/4nLGQQccMABBxxwwAEHHHDAAQcccMABBxxwwAEHvAGMP+M7YByEPRiFsAWjEX5gtMMKDEm4gCEMAzDE8TgYA/EwGEPxKBiD8SAYw/EYGBfiJTBgI4YNV0SGk1chhhNXQYaZty2GGbdNxlUvf/7imBi3vH8V8W6JccP7a9XyhhjT3tMy7bQYo9xaXXqUjEFvvRA/KMaYt7fyMCbGjFex1DIjxoT3bOjIjZTgThqCy5tiyL3Hg+fuJgH3EhANaYhx1UvVmLpYCq4NH79pB9y9tXBYUQyZt/wCd+5cAvfvqh1ZEeOql+KhBTGueqkeey7WgHkDzMtgzQOlH376U7vq5cT4w1+M9q14E8xrYNV/+yOvcPSP/VWvIrp/CQT8uLebDOy8zXRaYPItsQr8mreVUQNMPifWgOEDxiSYtJxieHrraQVs4i0nVgSTr4q7YLiBMQImbacYthNcTA6+E1zLrgImnxZ3wHAEQw0mnacYzhNcyTBgqye6kCKsJ7iQI7wn+DzJgP94LdJBXAPDF4yAq2DS/ZkO2O2JPk00YLsn+jDTgNeC4Q2GBEz6T3HAAQe8B0waic9qQrd7TfQqWG59FwIOOOCAAw444IADDjjggAMOOOCAAx7K9rNFvJRpAw444M+CP70gns94BLwBnE/ifQmcT9OuBOcT8V8Cr9vkkW08O8Ff3oq3brNlttN+HrxuS/y+pgfr2lqkcclTYgyA1zUf2tdeal0DsX0t4tL18PPgdY0897VqXdeMd1+75XUNtfe1TF/XFD/nPHwfvO7okn2H0+w7fmjdAVP7jhDbd0jcumMA9x30uO8oz32Hte47jnffgcvrjtTed2h676x6weXNd6eVN7SNNPpXd9+Nl97BSzf4QX8XOfinTY898Ngmz2KNprqPs3GZqLpULUoVt66WL5JV0+pVuNJ23doVyuJho+xY2aN8/l11sbRTZy1szD77zkRxuFVYPt+O/vMXx/bg9yrphj0HuksHdi0W2mslbi0lBItDTlwJmE5eapb/bLgqMG28lC3wenCF4FmyMEvyfbI0R/J1sjhD8m2yPD/yZfJAdpyIV7VjYAV5KjGOxYPaWXAVPZwRx+Md7CXw4DLCw+DCUkvAAQcccMABBxxwwAEHHHDAAQcccMABBxxwwB8E/xNgADKop7nSnBUxAAAAAElFTkSuQmCC\"","export default \"data:image/png;base64,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UmVhZHlxyWU8AAADcWlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDIgNzkuMTYwOTI0LCAyMDE3LzA3LzEzLTAxOjA2OjM5ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIgeG1wTU06T3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOjNmZjJmYzA3LThiNGEtNjQ0Yi1iMjNkLTViMDFlOWRlOGVjZSIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpDNDRDQkUzODUxNzUxMUVBQjM5REFCODVERTEzMUU2MSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpDNDRDQkUzNzUxNzUxMUVBQjM5REFCODVERTEzMUU2MSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgKFdpbmRvd3MpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6ZDI0YWU3ZTAtMDM1Ny04MTQ5LWJhZDQtY2Y2NjM5MWIwMWEyIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjNmZjJmYzA3LThiNGEtNjQ0Yi1iMjNkLTViMDFlOWRlOGVjZSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Pm/dvNIAAAAGUExURf///////1V89WwAAAACdFJOU/8A5bcwSgAAAlpJREFUeNrs3UFy4zAMRNHG/S89s0hNZWLJIgUSQjsf+268rVBlU7FudDorl2ymLmerCLsMrUrtCrOKtWmz6rU5sx7RJsx6jHuTrAe5t8h6lHuDrIe502Q9zp0kq4N3RqwO3BmymniHxWrCHSarj3dMrEbeIbEacYfI6uW9FquZ91Ksbt4rsdp5L8Rqx70gq6P3nVgtvW/E6uk9F6up91T8KWCpq1htvSdi9fUei9XYeyhWZ++R+APAUmuxentfxWrufRG7g6XuYrX3/hB7g6X+YmuwZCCWg/e72BgsWYh9wZKH2BYsmYgBF4ElF7EpWLIRAy4BSz5iwBVgyUgMuAAsOYkBA/YG6y9YgAEDLgUzDMMwDMMwvhMPDGDAgAEDBlz442k3L+C+f1zxlNcPLDevH1hu3kqxfilYbt4qsdvXs9v3vtmJwu2oYnYH8rpd+dzcvO6EbpdNt1usAAMGDBgwYMCAAQMGDBgwYMCAAQMGDBgwYMCAAQMGDBgwYMCAAQMGDBgwYMCAAQMGDBgwYMCAAQMGDBgwYMCAAX80OLzAqdci6sGRe/GkHByRe8ipGPwVTXSUgv9FEyWV4HgFz9fUgb9HEz1l4DgDTzYVgX9EE10l4JdooqwCHNfg8br94KNoonA3+DiaaNwMjhnwUOdW8Gk00boR/CaaqN0Hjnvgq+Jd4PfRRPUe8FU00b0FHFnwm/YN4IFoon85eCiaWLAaHOvAxyvWgkejiSUrwePRxJaF4NgBftmzDDwVTSxaBY594P9XrQHPRu8vi1ggnk/eXhaxQDwf/CPAAEWCOZah9n1oAAAAAElFTkSuQmCC\"","export default \"data:image/png;base64,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UmVhZHlxyWU8AAADcWlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDIgNzkuMTYwOTI0LCAyMDE3LzA3LzEzLTAxOjA2OjM5ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIgeG1wTU06T3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOjNmZjJmYzA3LThiNGEtNjQ0Yi1iMjNkLTViMDFlOWRlOGVjZSIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo5OTY0QUNENDUxNzQxMUVBQjZGRENDOUJGNDMzNjU3NCIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo5OTY0QUNEMzUxNzQxMUVBQjZGRENDOUJGNDMzNjU3NCIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgKFdpbmRvd3MpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6ZDI0YWU3ZTAtMDM1Ny04MTQ5LWJhZDQtY2Y2NjM5MWIwMWEyIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjNmZjJmYzA3LThiNGEtNjQ0Yi1iMjNkLTViMDFlOWRlOGVjZSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PpwgK6gAAAAGUExURf///////1V89WwAAAACdFJOU/8A5bcwSgAAA19JREFUeNrc21ty4zAMRNHG/jc9qfm3RcjEo683EJ2STQINRGH50eEHjRMaJzROaJzQOKFxQuOExgmNExonNE5onNA4oXFC44TGCY0TGic0Tmic0DihcULjhMYJjRMaJzROaJzQOKFxQuOExgmNExonNE5onNBvTuivpdC/OaEPFKFPS6GvApFxm3QF15zIuD26kgJFZNwWXVFpKTJuh66sKRAZt0FX2M6JjJvXlTbiIuOmdcURisi4WV15+CUyblLXEFuKjJvTtQTOIuOmdE2jApFxM7q2IY/IuAld43hOZFy/rnWwKjKuW9c8EhcZ16trX2YQGdepG1hDERnXpxtZIBIZ16UbWv0SGdejG1vaExnXoRtctxQZV68bXZQVGVetG15xFhlXqxtfThcZV6lb8G8FIuPqdBtwZboVuCrdDlyRbgmuRrcFV6Jbg6vQ7cEV6Bbh7us24a7rVuFu63bhLuuW4e7qtuGu6tbhbur24S7qFuLu6Tbi4tYy0krc48OfLoasxJ3oZIs70skVd6aTKS4OH9wTd6qTJe5YJ0fcuU6GuAfd41/fjcvoZIdL6eSGy+lkhovkTeaFy+pkhUvr5ITL62SEe6GTD+6r7vPzmOCiq/ofwSXvOzNc9DWmA7jD3twUF52ZSTvuIK40xkVvnNeMO4qabXHRnTS34g7HBKa4gSFII+54wmWJO5/fOeIS00lDXGb26odLTZbtcLm5uRsuuRVghsvuPHjh0hsdVrj8vooT7sU2jhGu8d2Fgc4K13ZmhoHODNdUq4SBzg7X0iOEgc4Q19Cbh4HOEleeiYWBzhRXnEWHgc4WVzoDCgOdMa5y9mqgs4pRsjqvCCypM4svc7pzhOFtnnlDdpVY7utnVkVnf1tWHVD+4DDqXt+cijbJw7sj3yQ1enufWSR+7y9rg7T2l0pkfdL+W5m1fEryaw25esL1e4G8eDp5o/pfO1m+09os3Qq41bet3Oi415Tue3dXO+5tN8LlOGFXnXk9K9nUvRYEQXsSP6cINq2D4kJk3H8dFhci4/50YFxiUhBkXZB14akLMO7wzAxfXWBxR7VKeOsCijvoEcJfF0jcY28eDF0AcQ+ZWHB0gcN9TWuDpQsY7suUJHi6QOE+TieDqQsQ7sNWAAQX/wQYAPYPhm0aAm5YAAAAAElFTkSuQmCC\"","import { Fragment } from 'react';\nimport resourceDescriptions from 'definitions/resources';\nimport { WarehouseStructureDefinition } from 'definitions/structures/types';\nimport { Resource } from 'definitions/resources';\nimport Icon from 'components/ui/common/Icon';\nimport { TextManager } from 'global/TextManager';\nimport { useStructureDefinition } from 'hooks/store/structures';\nimport './styles/upgradeHelpModalContent.scss';\n\nexport interface Props  {\n  level: number;\n}\n\nconst UpgradeHelpModalContent = (props: Props) => {\n  const { level } = props;\n  const structureDefinition = useStructureDefinition<WarehouseStructureDefinition>('warehouse');\n\n  const currentLevel = structureDefinition.levels[level];\n  const nextLevel = structureDefinition.levels[level + 1];\n\n  const renderRow = (resource: Resource) => {\n    const resourceDescription = resourceDescriptions[resource];\n\n    return (\n      <Fragment key={resource}>\n        <div><Icon image={resourceDescription.iconImg} size=\"smallest\"/></div>\n        <div>{TextManager.getResourceName(resource)}</div>\n        <div className=\"number\">{currentLevel.maxResources[resource]}</div>\n        <div className=\"arrow\">»</div>\n        <div className=\"number\">{nextLevel.maxResources[resource]}</div>\n      </Fragment>\n    );\n  };\n\n  return (\n    <div className=\"upgrade-help-model-content-warehouse\">\n      <h3>{TextManager.get('ui-structure-help-upgrade-improvements')}</h3>\n      <div className=\"storage-increase\">\n        <div className=\"header\"/>\n        <div className=\"header\">\n          {TextManager.get('ui-structure-warehouse-help-upgrade-header-capacity')}\n        </div>\n        <div className=\"header number\">\n          {TextManager.get('ui-structure-help-upgrade-header-level', {\n            level: level + 1,\n          })}\n        </div>\n        <div className=\"header\"/>\n        <div className=\"header number\">\n        {TextManager.get('ui-structure-help-upgrade-header-level', {\n          level: level + 2,\n        })}\n        </div>\n        {Object.keys(nextLevel.maxResources).map(res => renderRow(res as Resource))}\n      </div>\n    </div>\n  );\n};\n\nexport default UpgradeHelpModalContent;\n","import { useEffect, useMemo, useState } from 'react';\nimport { useDragDropManager } from 'react-dnd';\nimport Inventory from 'components/ui/inventory/Inventory';\nimport { DragSourceType, DragType } from 'constants/dragging';\nimport { useStockpileState } from 'hooks/store/stockpile';\nimport useItemDropActions from 'hooks/actions/useItemActions';\nimport { Item, ItemCategory } from 'definitions/items/types';\nimport Tabstrip from 'components/ui/tabs/Tabstrip';\nimport Tab from 'components/ui/tabs/Tab';\nimport { StockpileStoreState } from 'store/types/stockpile';\nimport { TextManager } from 'global/TextManager';\nimport { getDefinition } from 'definitions/items';\nimport { InventoryItemDragInfo } from 'components/ui/items/DraggableItemIcon';\nimport './styles/stockpile.scss';\n\nconst WAREHOUSE = DragSourceType.warehouse;\n\nconst Stockpile = () => {\n  const stockpile = useStockpileState();\n  const { dropItemWarehouse } = useItemDropActions();\n  const [selectedItemCategory, setSelectedItemCategory] = useState<string>(Object.keys(stockpile)[0]);\n\n  const handleDropItemWarehouse = (item: Item, fromSlot: number, toSlot: number, sourceType: DragSourceType, sourceId?: string): void => {\n    dropItemWarehouse(item, fromSlot, toSlot, sourceType, sourceId);\n  };\n  const dragDropManager = useDragDropManager();\n  const dragging = dragDropManager.getMonitor().isDragging();\n\n  useEffect(() => {\n    // If we're dragging some item, switch to the appropriate category so we can drop it here\n    if (dragging) {\n      const dragItem: InventoryItemDragInfo = dragDropManager.getMonitor().getItem();\n      const dragItemType = dragDropManager.getMonitor().getItemType();\n\n      if (dragItem && dragItemType === DragType.ITEM) {\n        const item = dragItem.item;\n        const definition = getDefinition(item.type);\n        setSelectedItemCategory(ItemCategory[definition.itemCategory]);\n      }\n    }\n  }, [dragDropManager, dragging]);\n\n  const handleCheckDropItem = (dragInfo: InventoryItemDragInfo) => {\n    // can only drop on the appropriate category\n    const definition = getDefinition(dragInfo.item.type);\n    return (definition.itemCategory === ItemCategory[selectedItemCategory as keyof typeof ItemCategory]);\n  };\n\n  const items = useMemo(() => {\n    return stockpile[selectedItemCategory as keyof StockpileStoreState];\n  }, [selectedItemCategory, stockpile]);\n\n  return (\n    <div className=\"stockpile\">\n      <Tabstrip className=\"tabs auto-collapse\" onTabSelected={setSelectedItemCategory} activeTab={selectedItemCategory}>\n      {Object.keys(stockpile).map((itemCategory) => {\n        return (\n          <Tab id={itemCategory} key={itemCategory}>\n            {TextManager.getItemCategory(ItemCategory[itemCategory as keyof typeof ItemCategory])}\n          </Tab>);\n      })}\n      </Tabstrip>\n      <Inventory\n        sourceType={WAREHOUSE}\n        className=\"inventory-large\"\n        items={items}\n        onDropItem={handleDropItemWarehouse}\n        // onStartDrag={handleStartDrag}\n        canDropHere={handleCheckDropItem}\n      />\n    </div>\n  );\n};\n\nexport default Stockpile;\n","import ResourcesBox from 'components/structures/warehouse/ResourcesBox';\nimport { WarehouseStructureLevelDefinition } from 'definitions/structures/types';\nimport usePrevious from 'hooks/usePrevious';\nimport { useEffect, useRef, useState } from 'react';\nimport { empty, ResourceStoreState } from 'store/types/resources';\nimport { StructuresStoreState } from 'store/types/structures';\nimport { TextManager } from 'global/TextManager';\nimport { TooltipManager } from 'global/TooltipManager';\nimport AdventurerTabstrip from 'components/world/QuestPanel/AdventurerTabstrip';\nimport { useStructureLevel, useStructureState } from 'hooks/store/structures';\nimport { useResourcesState } from 'hooks/store/resources';\nimport { useSelector } from 'react-redux';\nimport { StoreState } from 'store/types';\nimport { useAdventurersInTown } from 'hooks/store/adventurers';\nimport StructureLevel from '../StructureLevel';\nimport AdventurerPanel from 'components/ui/adventurer/AdventurerPanel';\nimport { ContextType } from 'constants/context';\nimport { Resource } from 'definitions/resources';\nimport UpgradeHelpModal from '../UpgradeHelpModal';\nimport UpgradeHelpModalContent from './UpgradeHelpModalContent';\nimport Stockpile from './Stockpile';\nimport { Channel, SoundManager } from 'global/SoundManager';\nimport './styles/warehouseStructureView.scss';\n\n\nconst WarehouseStructureView = () => {\n\n  const adventurersInTown = useAdventurersInTown();\n  const [selectedAdventurer, setSelectedAdventurer] = useState<string>(adventurersInTown[0]?.id);\n  const resources = useResourcesState();\n  const [resourcesDelta, setResourcesDelta] = useState<ResourceStoreState>(empty);  // updating this will trigger animation\n  const previousResources = usePrevious(resources);\n  const resourcesRef = useRef<HTMLFieldSetElement>(null);\n  const structuresState = useSelector<StoreState, StructuresStoreState>(store => store.structures);\n\n  useEffect(() => {\n    SoundManager.addSound('ambient/structure/warehouse', 'sound/structures/warehouse.ogg', () => {\n      SoundManager.playSound('ambient/structure/warehouse', Channel.ambient, true);\n    });\n    return () => SoundManager.fadeOutSound(Channel.ambient);\n  }, []);\n\n  useEffect(() => {\n    // Calculate delta\n    const delta = Object.keys(resources).reduce<ResourceStoreState>((acc, value) => {\n      const resource = value as Resource;\n      if (previousResources && previousResources[resource]) {\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        acc[resource] = resources[resource]! - previousResources[resource]!;\n      }\n      return acc;\n    }, {});\n\n    setResourcesDelta(delta);\n  }, [resources, previousResources]);\n\n  const structureState = useStructureState('warehouse');\n  const { level } = structureState;\n  const levelDefinition = useStructureLevel<WarehouseStructureLevelDefinition>('warehouse');\n\n\n  const handleAdventurerTabSelected = (tabId: string) => {\n    setSelectedAdventurer(tabId);\n  };\n\n  const handleHelpClicked = (event: React.MouseEvent) => {\n    const origin = (event.currentTarget as HTMLElement);\n    const originRect = origin.getBoundingClientRect();\n    const content = (\n      <UpgradeHelpModal level={level} structure={'warehouse'}>\n        <UpgradeHelpModalContent level={level} />\n      </UpgradeHelpModal>\n    );\n    TooltipManager.showContextTooltip(ContextType.component, content, originRect, 'upgrade-structure-tooltip');\n\n    event.stopPropagation();\n  };\n\n  return (\n    <div className=\"warehouse-structureview\">\n      <StructureLevel structure={'warehouse'} onHelpClicked={handleHelpClicked} />\n      <fieldset className=\"resources\" ref={resourcesRef}>\n        <legend>{TextManager.get('ui-structure-warehouse-resources')}</legend>\n        <ResourcesBox\n          resources={resources}\n          structures={structuresState}\n          maxResources={levelDefinition.maxResources}\n          deltaResources={resourcesDelta}\n        />\n      </fieldset>\n      <h3>{TextManager.get('ui-structure-warehouse-stockpile')}</h3>\n      <Stockpile />\n      <h3>{TextManager.get('ui-structure-warehouse-adventurers')}</h3>\n      <div>\n        <AdventurerTabstrip\n          adventurers={adventurersInTown}\n          selectedAdventurerId={selectedAdventurer}\n          onAdventurerTabSelected={handleAdventurerTabSelected}\n        />\n        <div className=\"adventurer-inventory\">\n          { selectedAdventurer && (\n            <AdventurerPanel\n              adventurerId={selectedAdventurer}\n              horizontalMode={true}\n              traits={false}\n              skills={false}\n            />\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default WarehouseStructureView;\n","import { DragType } from 'constants/dragging';\nimport { useDrop } from 'react-dnd';\nimport { AdventurerAvatarDragInfo } from '../DraggableAdventurerAvatar';\nimport './styles/droppableadventurerslot.scss';\n\nexport interface Props {\n  onDrop: (item: AdventurerAvatarDragInfo) => void;\n}\n\nexport type CollectedProps = {\n  canDrop: boolean;\n  isOver: boolean;\n};\n\n/*\n * Can drop adventurers on this */\nconst DroppableAdventurerSlot = (props: Props) => {\n  const {\n    onDrop,\n  } = props;\n  // const isActive = isOver && canDrop;\n\n\n  const [{ isOver, canDrop }, dropRef] = useDrop<AdventurerAvatarDragInfo, void, CollectedProps>(() => ({\n    accept: DragType.ADVENTURER,\n    collect: (monitor) => ({\n      canDrop: monitor.canDrop(),\n      isOver: monitor.isOver(),\n    }),\n    drop: (dragInfo: AdventurerAvatarDragInfo) => {\n      return onDrop(dragInfo);\n    },\n  }));\n\n  const className = [\n    'droppable-adventurer-slot',\n    ...(isOver ? ['active-drop'] : []),\n    ...(!isOver && canDrop ? ['can-drop'] : []),\n  ].join(' ');\n\n  return (\n    <div className={className} ref={dropRef} />\n  );\n};\n\nexport default DroppableAdventurerSlot;\n","import { AdventurerStoreState } from 'store/types/adventurer';\nimport AdventurerAvatar from 'components/ui/adventurer/AdventurerAvatar';\nimport { AdventurerAvatarDragInfo } from 'components/ui/adventurer/DraggableAdventurerAvatar';\nimport DroppableAdventurerSlot from 'components/ui/adventurer/DroppableAdventurerSlot';\nimport { IconSize } from 'components/ui/common/Icon';\nimport './styles/assignadventurers.scss';\n\nexport interface DispatchProps {\n  onAdventurerDropped: (item: AdventurerAvatarDragInfo, index: number) => void;\n  onAdventurerClicked: (adventurer: AdventurerStoreState) => void;\n}\n\nexport interface Props {\n  availableSlots: number;\n  assignedAventurers: AdventurerStoreState[];\n}\n\n/*\n * Displays a number of slots to drag adventurers to */\nconst AssignAdventurers = (props: Props & DispatchProps) => {\n  const slotsContent = () => {\n    const slots: JSX.Element[] = [];\n    for (let i = 0; i < props.availableSlots; i++) {\n      let content;\n      let className = '';\n      const hasAdventurer = !!props.assignedAventurers[i];\n\n      if (hasAdventurer) {\n        const adventurer = props.assignedAventurers[i];\n        content = (\n          <AdventurerAvatar\n            adventurer={adventurer}\n            displayName={false}\n            size={IconSize.small}\n            onClick={() => props.onAdventurerClicked(adventurer) }\n          />\n        );\n        className = 'has-adventurer';\n      } else {\n        content = (\n          <DroppableAdventurerSlot\n            onDrop={(item: AdventurerAvatarDragInfo) => { props.onAdventurerDropped(item, i); }}\n          />\n        );\n      }\n      slots.push(\n        <li\n          key={`slot${i}`}\n          className={className}\n        >\n          {content}\n        </li>,\n      );\n    }\n    return slots;\n  };\n\n  return (\n    <ul className=\"assign-adventurers\">\n      { slotsContent() }\n    </ul>\n  );\n};\n\nexport default AssignAdventurers;\n","import { ItemType } from 'definitions/items/types';\nimport { getDefinition } from 'definitions/quests';\nimport { AdventurerStoreState } from 'store/types/adventurer';\nimport { QuestStoreState } from 'store/types/quest';\nimport { TextManager } from 'global/TextManager';\nimport AssignAdventurers from './AssignAdventurers';\nimport { QuestDefinition } from 'definitions/quests/types';\nimport Button from 'components/ui/buttons/Button';\nimport ItemsBox from 'components/ui/items/ItemsBox';\nimport { AdventurerAvatarDragInfo } from 'components/ui/adventurer/DraggableAdventurerAvatar';\nimport { useStockpileStateFlat } from 'hooks/store/stockpile';\nimport './styles/questboard.scss';\n\nexport const AVAILABLE_SLOTS = 5;\nconst minimumCountAdventurers = 3;  // we need this many adventurers to start the quest\n\n\nexport interface Props {\n  availableQuests: QuestStoreState[];\n  selectedQuestName?: string;     // name of selected quest\n  assignedAventurers: AdventurerStoreState[];\n\n  onQuestClick: (questName: string) => void;\n  onAdventurerDropped: (item: AdventurerAvatarDragInfo, index: number) => void;\n  onRemoveAdventurer: (adventurer: AdventurerStoreState) => void;\n  onLaunchQuest: () => void;\n}\n\nconst QuestBoard = (props: Props) => {\n\n  const items = useStockpileStateFlat();\n\n  /**\n   * Returns true if all the items required by the quest are in the inventory\n   */\n  const checkEnoughItems = (questDefinition: QuestDefinition): boolean => {\n    if (!questDefinition.requiredItems) {\n      return true;\n    }\n    return questDefinition.requiredItems.every((item: ItemType) => {\n      const amountRequired = (questDefinition.requiredItems)?.filter((i) => i === item).length;\n      return items.filter((i) => i === item).length >= (amountRequired ?? 0);\n    });\n  };\n\n  const getQuestDetails = () => {\n    if (!props.selectedQuestName) {\n      return null;\n    }\n    const quest = props.availableQuests.find((q) => q.name === props.selectedQuestName);\n    if (!quest) {\n      return (\n        <div> { TextManager.get('ui-structure-tavern-quest-launched') } </div>\n      );\n    }\n    const questDefinition = getDefinition(quest.name);\n\n    // Need a full party to launch\n    const fullParty = props.assignedAventurers.filter((a) => a !== null).length >= minimumCountAdventurers;\n    // Check if we have the required items\n    const enoughItems = checkEnoughItems(questDefinition);\n\n    const canLaunch = fullParty && enoughItems;\n\n    return (\n      <div className=\"quest-details\">\n        {TextManager.getQuestDescription(props.selectedQuestName)}\n        <AssignAdventurers\n          availableSlots={AVAILABLE_SLOTS}\n          assignedAventurers={props.assignedAventurers}\n          onAdventurerClicked={props.onRemoveAdventurer}\n          onAdventurerDropped={props.onAdventurerDropped}\n        />\n        <ItemsBox items={ questDefinition.requiredItems || [] }/>\n        <Button disabled={!canLaunch} onClick = { () => props.onLaunchQuest() }>\n          {TextManager.get('ui-structure-tavern-button-launch-quest')}\n        </Button>\n      </div>\n    );\n  };\n\n  // quest board, expanded quest info + assign adventurers + launch button\n  return (\n    <div className=\"quest-board\">\n      <h2>\n        {TextManager.get('ui-structure-tavern-title-quest-board')}\n      </h2>\n      <ul className=\"quest-list\">\n        {props.availableQuests.map((q) => {\n          const className = `quest ${(q.name === props.selectedQuestName) ? ' selected' : ''}`;\n          return (\n            <li key={q.name}\n              className={className}\n              onClick={() => {props.onQuestClick(q.name);} }\n            >\n              <div\n                className=\"icon\"\n                style={{ backgroundImage: `url(${process.env.PUBLIC_URL})` }}\n              />\n              <div className=\"title\">{TextManager.getQuestTitle(q.name) } </div>\n            </li>\n          );\n        })}\n      </ul>\n      { getQuestDetails() }\n    </div>\n  );\n};\n\nexport default QuestBoard;\n","import { AdventurerStoreState } from 'store/types/adventurer';\nimport { AVAILABLE_SLOTS } from '../QuestBoard';\nimport Button from 'components/ui/buttons/Button';\nimport { TextManager } from 'global/TextManager';\nimport './styles/adventurerButton.scss';\n\nexport interface Props {\n  adventurer: AdventurerStoreState;\n  assignedAventurers: AdventurerStoreState[];  // assigned to a quest in the QuestBoard\n  questName: string;\n\n  onAddAdventurer: (adventurer: AdventurerStoreState, index: number) => void;\n  onRemoveAdventurer: (adventurer: AdventurerStoreState) => void;\n}\n\n// Finds the first array index with a falsey value\nconst getEmptySlot = (assignedAventurers: AdventurerStoreState[]) => {\n  for (let i = 0; i < AVAILABLE_SLOTS; i++) {\n    if (!assignedAventurers[i]) {\n      return i;\n    }\n  }\n  return 0;\n};\n\n// Toggles adventurer participation in a quest\nconst AdventurerButton = (props: Props) => {\n  const {\n    adventurer,\n    assignedAventurers,\n    questName,\n    onAddAdventurer,\n    onRemoveAdventurer,\n  } = props;\n\n  const isAssigned = assignedAventurers.indexOf(adventurer) > -1;\n  const quest = TextManager.getQuestTitle(questName);\n\n  const handleAddClick = () => {\n    const emptySlot = getEmptySlot(assignedAventurers);\n    onAddAdventurer(adventurer, emptySlot);\n  };\n\n  const handleRemoveClick = () => {\n    onRemoveAdventurer(adventurer);\n  };\n\n  if (isAssigned) {\n    return (\n      <Button onClick={handleRemoveClick} className=\"adventurer-button\">\n        {TextManager.get('ui-structure-tavern-button-leave-quest')}\n      </Button>\n    );\n  }\n  // Skip holes\n  if (assignedAventurers.filter(Boolean).length === AVAILABLE_SLOTS) {\n    return (\n      <Button disabled={true} className=\"adventurer-button\">\n          {TextManager.get('ui-structure-tavern-button-join-quest-full-party')}\n      </Button>\n    );\n  }\n  return (\n    <Button onClick={handleAddClick}  className=\"adventurer-button\">\n      {TextManager.get('ui-structure-tavern-button-join-quest', { quest })}\n    </Button>\n  );\n};\n\nexport default AdventurerButton;\n\n","import { DragSourceType, DragType } from 'constants/dragging';\nimport { useDrag } from 'react-dnd';\nimport { AdventurerStoreState } from 'store/types/adventurer';\nimport AdventurerAvatar, { Props as AdventurerAvatarProps } from '../AdventurerAvatar';\nimport './styles/draggableadventureravatar.scss';\n\nexport interface Props {\n  sourceId?: string;\n  onClick?: () => void;\n  disabled?: boolean;\n}\n\ninterface CollectedProps {\n  isDragging: boolean;\n}\n\nexport interface AdventurerAvatarDragInfo {\n  adventurer: AdventurerStoreState;\n  sourceId?: string;\n}\n\nconst DraggableAdventurerAvatar = (props: Props & AdventurerAvatarProps) => {\n  const [collected, dragRef] = useDrag<AdventurerAvatarDragInfo, null, CollectedProps>(() => ({\n    type: DragType.ADVENTURER,\n    item: {\n      adventurer: props.adventurer,\n      sourceId: props.sourceId,\n      sourceType: DragSourceType.adventurerInventory,\n    },\n  }), []);\n\n  const { disabled } = props;\n  let className = 'draggable-adventurer-avatar';\n  if (disabled) {\n    className += ' disabled';\n  }\n  if (collected.isDragging) {\n    className += ' dragging';\n  }\n\n  /*if (isDragging) {\n    // TODO: can show some sort of empty state?\n    return null;\n  }*/\n  return (\n    <div className={className} ref={dragRef}>\n      <AdventurerAvatar\n        // Copy all props down to AdventurerAvatar\n        { ...props }\n      />\n    </div>\n  );\n};\n\nexport default DraggableAdventurerAvatar;\n","import { AdventurerStoreState } from 'store/types/adventurer';\nimport { SOURCE_ID } from '../TavernStructureView';\nimport AdventurerButton from './AdventurerButton';\nimport { TextManager } from 'global/TextManager';\nimport DraggableAdventurerAvatar from 'components/ui/adventurer/DraggableAdventurerAvatar';\nimport AdventurerPanel from 'components/ui/adventurer/AdventurerPanel';\nimport { renameAdventurer } from 'store/actions/adventurers';\nimport { useDispatch } from 'react-redux';\n\nexport interface Props {\n  adventurer: AdventurerStoreState;\n  onQuest: boolean;\n  assignedAventurers: AdventurerStoreState[];\n  expanded: boolean;\n  selectedQuestName?: string;\n\n  onClick: (adventurer: AdventurerStoreState) => void;\n  onAddAdventurer: (adventurer: AdventurerStoreState, index: number) => void;\n  onRemoveAdventurer: (adventurer: AdventurerStoreState) => void;\n}\n\n// Room block that has adventurer\nconst RoomWithAdventurer = (props: Props) => {\n  const {\n    adventurer,\n    onQuest,\n    assignedAventurers,\n    expanded,\n    selectedQuestName,\n    onClick,\n    onAddAdventurer,\n    onRemoveAdventurer,\n  } = props;\n\n  const dispatch = useDispatch();\n  const assigned = assignedAventurers.indexOf(adventurer) > -1; // assigned to a quest in the QuestBoard\n\n  const handleRename = (e: React.MouseEvent<HTMLSpanElement>) => {\n    e.stopPropagation();\n    const name = prompt('Enter new name', adventurer.name);\n    if (name && name !== adventurer.name) {\n      dispatch(renameAdventurer(adventurer.id, name));\n    }\n  };\n\n  return (\n    <>\n      <div\n        className={`room ${expanded ? 'expanded' : ''}`}\n        onClick={() => onClick(adventurer)}\n      >\n        <DraggableAdventurerAvatar\n          disabled={assigned || onQuest}\n          adventurer={adventurer}\n          className=\"adventurer-icon\"\n          sourceId={SOURCE_ID}\n          key={`avatar:${adventurer.id}`}\n        />\n        <div>\n          <section>\n            {adventurer.name}\n          </section>\n          <section className=\"on-a-quest\">\n           {(onQuest) && TextManager.get('ui-structure-tavern-on-a-quest') }\n          </section>\n        </div>\n        <span className=\"rename\" onClick={handleRename}>rename</span>\n      </div>\n      { expanded && (\n        <div className=\"adventurer-details\">\n          <AdventurerPanel adventurerId={adventurer.id} name={false} />\n          { (!onQuest && selectedQuestName) && (\n            <AdventurerButton\n              adventurer={adventurer}\n              assignedAventurers={assignedAventurers}\n              questName={selectedQuestName}\n              onAddAdventurer={onAddAdventurer}\n              onRemoveAdventurer={onRemoveAdventurer}\n            />\n          )}\n        </div>\n      )}\n    </>\n  );\n};\n\nexport default RoomWithAdventurer;\n","import React, {  } from 'react';\n\n// eslint-disable-next-line @typescript-eslint/no-empty-interface\nexport interface Props {\n}\n\nconst RoomEmpty = () => {\n  return (\n        <div className=\"room\">\n            (empty room)\n        </div>\n  );\n};\n\nexport default RoomEmpty;\n","import { useState } from 'react';\nimport { AdventurerStoreState } from 'store/types/adventurer';\nimport { QuestStoreState } from 'store/types/quest';\nimport RoomWithAdventurer from './RoomWithAdventurer';\nimport RoomEmpty from './RoomEmpty';\nimport { TextManager } from 'global/TextManager';\nimport './styles/roomList.scss';\n\nexport interface Props {\n  roomCount: number;\n  adventurers: AdventurerStoreState[];\n  assignedAventurers: AdventurerStoreState[];\n  quests: QuestStoreState[];\n  selectedQuestName?: string;     // name of selected quest\n\n  onAddAdventurer: (adventurer: AdventurerStoreState, index: number) => void;\n  onRemoveAdventurer: (adventurer: AdventurerStoreState) => void;\n}\n\nconst RoomList = (props: Props) => {\n  const {\n    roomCount,\n    adventurers,\n    assignedAventurers,\n    selectedQuestName,\n    onAddAdventurer,\n    onRemoveAdventurer,\n  } = props;\n  const [selectedAdventurer, setSelectedAdventurer] = useState<string>();\n\n  const getQuestByAdventurer = (adventurerId: string): QuestStoreState | undefined => {\n    return Object.values(props.quests).find((quest) => {\n      return quest.party.indexOf(adventurerId) > -1;\n    });\n  };\n\n  const handleAdventurerClick = (adventurer: AdventurerStoreState) => {\n    if (selectedAdventurer === adventurer.id) {\n      setSelectedAdventurer(undefined);\n    } else {\n      setSelectedAdventurer(adventurer.id);\n    }\n  };\n\n  const roomContent: JSX.Element[] = [];\n  for (let i = 0; i < roomCount; i++) {\n    const adventurer = adventurers.find((a) => a.room === i);\n    if (!adventurer) {\n      roomContent.push((\n        <RoomEmpty key={`room${i}`} />\n      ));\n      continue;\n    }\n    const onQuest = !!getQuestByAdventurer(adventurer.id);\n\n    roomContent.push((\n      <RoomWithAdventurer\n        key={adventurer.id}\n        adventurer={adventurer}\n        assignedAventurers={assignedAventurers}\n        selectedQuestName={selectedQuestName}\n        expanded={selectedAdventurer === adventurer.id}\n        onQuest={onQuest}\n\n        onClick={handleAdventurerClick}\n        onAddAdventurer={onAddAdventurer}\n        onRemoveAdventurer={onRemoveAdventurer}\n      />\n    ));\n  }\n\n  return (\n    <div className=\"room-list\">\n      <h2>{TextManager.get('ui-structure-tavern-rooms')}</h2>\n      { roomContent }\n    </div>\n  );\n};\n\nexport default RoomList;\n","import * as React from 'react';\nimport { getDefinition } from 'definitions/structures';\nimport { TavernStructureDefinition } from 'definitions/structures/types';\nimport Icon from 'components/ui/common/Icon';\nimport { TextManager } from 'global/TextManager';\nimport './styles/upgradeHelpModalContent.scss';\n\nexport interface Props  {\n  level: number;\n}\n\nconst UpgradeHelpModalContent = (props: Props) => {\n  const { level } = props;\n  const structureDefinition: TavernStructureDefinition = getDefinition('tavern');\n\n  const currentLevel = structureDefinition.levels[level];\n  const nextLevel = structureDefinition.levels[level + 1];\n\n\n  return (\n    <div className=\"upgrade-help-model-content-tavern\">\n      <h3>{TextManager.get('ui-structure-help-upgrade-improvements')}</h3>\n\n      <div className=\"rooms-increase\">\n        <div className=\"header\"/>\n        <div className=\"header\">\n          {TextManager.getStructureName('tavern')}\n        </div>\n        <div className=\"header number\">\n          {TextManager.get('ui-structure-help-upgrade-header-level', {\n            level: level + 1,\n          })}\n        </div>\n        <div className=\"header\"/>\n        <div className=\"header number\">\n          {TextManager.get('ui-structure-help-upgrade-header-level', {\n            level: level + 2,\n          })}\n        </div>\n        <div><Icon image=\"img/ui/structures/tavern.png\" size=\"smallest\"/></div>\n        <div>{TextManager.get('ui-structure-tavern-rooms')}</div>\n        <div className=\"number\">{currentLevel.rooms}</div>\n        <div className=\"arrow\">»</div>\n        <div className=\"number\">{nextLevel.rooms}</div>\n      </div>\n    </div>\n  );\n};\n\nexport default UpgradeHelpModalContent;\n","import { TavernStructureDefinition, TavernStructureLevelDefinition } from 'definitions/structures/types';\nimport { AdventurerStoreState } from 'store/types/adventurer';\nimport { QuestStatus, QuestStoreState } from 'store/types/quest';\nimport { TextManager } from 'global/TextManager';\nimport { ToastManager } from 'global/ToastManager';\nimport { TooltipManager } from 'global/TooltipManager';\nimport { ContextType } from 'constants/context';\nimport { Type } from 'components/ui/toasts/Toast';\nimport { getQuestLink } from 'utils/routing';\nimport RoomList from './rooms/RoomList';\nimport { useEffect, useState } from 'react';\nimport QuestBoard from './QuestBoard';\nimport { useStructureDefinition, useStructureState } from 'hooks/store/structures';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { StoreState } from 'store/types';\nimport { launchQuest } from 'store/actions/quests';\nimport { AdventurerAvatarDragInfo } from 'components/ui/adventurer/DraggableAdventurerAvatar';\nimport StructureLevel from '../StructureLevel';\nimport StructureViewHeader from '../StructureViewHeader';\nimport UpgradeHelpModal from '../UpgradeHelpModal';\nimport UpgradeHelpModalContent from './UpgradeHelpModalContent';\nimport { Channel, SoundManager } from 'global/SoundManager';\nimport './styles/tavernStructureView.scss';\n\nexport const SOURCE_ID = 'tavern';\n\n// The UI for the tavern\nconst TavernStructureView = () => {\n  const level = useStructureState('tavern').level;\n  const adventurers = useSelector<StoreState, AdventurerStoreState[]>(store => store.adventurers);\n  const quests = useSelector<StoreState, QuestStoreState[]>(store => store.quests);\n\n  const [assignedAventurers, setAassignedAdventurers] = useState<AdventurerStoreState[]>([]);\n  const [selectedQuest, setSelectedQuest] = useState<string>();\n\n  const structureDefinition = useStructureDefinition<TavernStructureDefinition>('tavern');\n  const levelDefinition: TavernStructureLevelDefinition = structureDefinition.levels[level];\n\n  const dispatch = useDispatch();\n\n  useEffect(() => {\n    SoundManager.addSound('ambient/structure/tavern', 'sound/structures/tavern.ogg', () => {\n      SoundManager.playSound('ambient/structure/tavern', Channel.ambient, true);\n    });\n    return () => SoundManager.fadeOutSound(Channel.ambient);\n  }, []);\n\n  const onLaunchQuest = (questName: string) => {\n    dispatch(launchQuest(questName, assignedAventurers));\n  };\n\n  const getAvailableQuests = quests.filter((q) => q.status === QuestStatus.available );\n\n  const handleQuestClick = (name: string): void => {\n    if (selectedQuest === name) {\n      setSelectedQuest(undefined);\n    } else {\n      setSelectedQuest(name);\n    }\n\n    // Unassign all adventurers\n    setAassignedAdventurers([]);\n  };\n\n  const handleAddAdventurer = (adventurer: AdventurerStoreState, index: number): void => {\n    const copy = [ ...assignedAventurers];\n    copy[index] = adventurer;\n    setAassignedAdventurers(copy);\n  };\n\n  const handleAdventurerDropped = (item: AdventurerAvatarDragInfo, index: number) => {\n    if (item.sourceId === SOURCE_ID) {\n      handleAddAdventurer(item.adventurer, index);\n    }\n  };\n\n  const handleRemoveAdventurer = (adventurer: AdventurerStoreState): void => {\n    const index = assignedAventurers.indexOf(adventurer);\n    const copy = [ ...assignedAventurers];\n    delete copy[index];\n    setAassignedAdventurers(copy);\n  };\n\n  const handleLaunchQuest = (): void => {\n    if (!selectedQuest) return;\n\n    const questTitle = TextManager.getQuestTitle(selectedQuest);\n    const leader = assignedAventurers[0];\n    ToastManager.addToast(questTitle, Type.questLaunched, leader?.avatarImg, getQuestLink(selectedQuest));\n    onLaunchQuest(selectedQuest);\n  };\n\n  const handleHelpClicked = (event: React.MouseEvent) => {\n    const origin = (event.currentTarget as HTMLElement);\n    const originRect = origin.getBoundingClientRect();\n    const content = (\n      <UpgradeHelpModal level={level} structure={'tavern'}>\n        <UpgradeHelpModalContent level={level} />\n      </UpgradeHelpModal>\n    );\n    TooltipManager.showContextTooltip(ContextType.component, content, originRect, 'upgrade-structure-tooltip');\n\n    event.stopPropagation();\n  };\n\n  return (\n    <>\n      <StructureViewHeader structure={'tavern'} />\n      <div className=\"tavern-structure-view\">\n        <StructureLevel structure={'tavern'} onHelpClicked={handleHelpClicked}/>\n        <section>\n          <RoomList\n            roomCount={levelDefinition.rooms}\n            adventurers={adventurers}\n            assignedAventurers={assignedAventurers}\n            quests={quests}\n            selectedQuestName={selectedQuest}\n            onAddAdventurer={handleAddAdventurer}\n            onRemoveAdventurer={handleRemoveAdventurer}\n          />\n          <QuestBoard\n            availableQuests={getAvailableQuests}\n            selectedQuestName={selectedQuest}\n            assignedAventurers={assignedAventurers}\n            onQuestClick={(name: string) => handleQuestClick(name)}\n            onAdventurerDropped={handleAdventurerDropped}\n            onRemoveAdventurer={handleRemoveAdventurer}\n            onLaunchQuest={handleLaunchQuest}\n          />\n        </section>\n      </div>\n    </>\n  );\n};\n\nexport default TavernStructureView;\n","import ReactMarkdown from 'react-markdown';\nimport { Structure } from 'definitions/structures';\nimport { TextManager } from 'global/TextManager';\nimport { useEngine } from 'hooks/store/engine';\nimport { formatDuration } from 'utils/format/time';\nimport { RESOURCE_INTERVAL } from 'mechanics/resources';\nimport { Direction } from 'components/ui/common/progress/PlainProgressbar';\nimport { Resource } from 'definitions/resources';\nimport { useStructureLevel, useStructureState } from 'hooks/store/structures';\nimport { ResourceStructureLevelDefinition } from 'definitions/structures/types';\nimport Icon from 'components/ui/common/Icon';\nimport resourceDescriptions from 'definitions/resources';\nimport TickingProgressbar from 'components/ui/common/progress/TickingProgressbar';\nimport { useMaxResourcesState, useResourcesState } from 'hooks/store/resources';\n\ninterface Props {\n  structure: Structure;\n  resource: Resource;\n}\n\nconst ResourceGenerationRow = (props: Props) => {\n  const { structure, resource } = props;\n  const engine = useEngine();\n  const { workers } = useStructureState(structure);\n\n  const levelDefinition = useStructureLevel<ResourceStructureLevelDefinition>(structure);\n  const generates = levelDefinition.generates[resource] || 0;\n  const delta = RESOURCE_INTERVAL - (Date.now() - engine.lastProducedUpdate);\n  const resourceDescription = resourceDescriptions[resource];\n  const resources = useResourcesState();\n  const maxResources = useMaxResourcesState();\n  const full = (resources[resource] ?? 0) >= (maxResources?.[resource] ?? 0);\n  if (full) {\n    return (\n      <div className=\"resource-generation-row\">\n        <div className=\"error-full\">\n        <ReactMarkdown>\n          {TextManager.get('ui-structure-resource-warehouse-full', { structure, resource })}\n        </ReactMarkdown>\n        </div>\n      </div>\n    );\n  }\n  return (\n    <div className=\"resource-generation-row\">\n      <div className=\"info\">\n        <Icon image={resourceDescription.iconImg} size=\"smallest\"/>\n        <div>\n          {TextManager.get('ui-structure-resource-generates', {\n            amount: generates,\n            resource,\n          })}\n        </div>\n      </div>\n      {full}\n      { workers > 0 &&\n      <TickingProgressbar\n        className=\"generating\"\n        direction={Direction.decreasing}\n        label={`${TextManager.get('ui-structure-resource-next-generates', {\n          amount: generates * workers,\n          resource,\n          time: formatDuration(delta),\n        })}`}\n        progress={delta / RESOURCE_INTERVAL}\n      />}\n      { !workers && TextManager.get('ui-structure-resource-no-workers')}\n    </div>\n  );\n};\nexport default ResourceGenerationRow;\n","import * as React from 'react';\nimport { Item } from 'definitions/items/types';\nimport { TextManager } from 'global/TextManager';\n\ninterface Props {\n  item: Item;\n}\n\nconst ItemText = ({ item }: Props) => (\n  <div className=\"text\">\n    <p className=\"name\">{TextManager.getItemName(item.type)}</p>\n    <p className=\"subtext\">{TextManager.getItemSubtext(item.type)}</p>\n  </div>\n);\n\nexport default ItemText;\n","import * as React from 'react';\nimport { Item } from 'definitions/items/types';\nimport { DragSourceType } from 'constants/dragging';\nimport DraggableItemIcon from '../DraggableItemIcon';\nimport ItemText from './ItemText';\nimport { ReactNode } from 'react';\nimport './styles/itemsList.scss';\n\nexport interface Props {\n  className?: string;\n  items: Item[];\n  sourceType: DragSourceType;\n  sourceId?: string;\n  slots?: number; // optionally always show this amount of slots\n  renderButton?: (item: Item, index: number) => ReactNode\n}\n\n/**\n * The ItemsList displays a list of items vertically. Shows icon and description\n */\nconst DraggableItemsList = (props: Props) => {\n  const { renderButton, items } = props;\n  const className = `items-list ${props.className ?? ''}`;\n  const slots = props.slots ?? items.length;\n\n  return (\n    <ul className={className} >\n      {[...Array(slots)].map((_, index )=> {\n        const item = items[index];\n        return (\n          <li\n            key={`${item}${index}`}\n            className=\"item-row\"\n          >\n            <div className=\"item-placeholder\" />\n            { item && (\n              <>\n                <DraggableItemIcon\n                  item={item}\n                  index={index}\n                  sourceId={props.sourceId}\n                  sourceType={props.sourceType}\n                />\n                <ItemText item={item} />\n              </>\n            )}\n            { (item && renderButton) && renderButton(item, index) }\n          </li>\n        );\n      })}\n    </ul>\n  );\n};\n\nexport default DraggableItemsList;\n","import { TickingProgressbar } from 'components/ui/common/progress';\nimport { Direction } from 'components/ui/common/progress/TickingProgressbar';\nimport { Structure } from 'definitions/structures';\nimport { TextManager } from 'global/TextManager';\nimport { useEngine } from 'hooks/store/engine';\nimport { HARVEST_INTERVAL } from 'mechanics/gameTick/harvest';\nimport { formatDuration } from 'utils/format/time';\nimport IconButton from 'components/ui/buttons/IconButton';\nimport { useDispatch } from 'react-redux';\nimport { reduceTime } from 'store/actions/game';\nimport './styles/harvestProgress.scss';\n\ninterface Props {\n  structure: Structure;\n}\n\nconst HarvestProgress = (props: Props) => {\n  const { structure } = props;\n  const engine = useEngine();\n  const dispatch = useDispatch();\n  const delta = HARVEST_INTERVAL - (Date.now() - engine.lastHarvest);\n\n  const handleReduceTime50 = () => {\n    dispatch(reduceTime(50, 'harvest', structure));\n  };\n\n  return (\n    <div className=\"harvest-progress\">\n      <TickingProgressbar\n         className=\"harvest-progress\"\n         direction={Direction.decreasing}\n         label={`${TextManager.get('ui-structure-resource-next-harvest', {\n           time: formatDuration(delta),\n         })}`}\n         progress={delta / HARVEST_INTERVAL}\n      />\n      <IconButton iconImg=\"/img/ui/misc/clock.png\" size=\"smallest\" onClick={handleReduceTime50}> 50%</IconButton>\n    </div>\n  );\n};\n\nexport default HarvestProgress;\n","export default __webpack_public_path__ + \"static/media/icon.745e2ffb.png\";","import { Fragment } from 'react';\nimport { getDefinition, Structure } from 'definitions/structures';\nimport resourceDescriptions from 'definitions/resources';\nimport { ResourceStructureDefinition } from 'definitions/structures/types';\nimport { Resource } from 'definitions/resources';\nimport Icon from 'components/ui/common/Icon';\nimport { TextManager } from 'global/TextManager';\nimport './styles/upgradeHelpModalContent.scss';\n\nexport interface Props  {\n  structure: Structure;\n  level: number;\n}\n\nconst UpgradeHelpModalContent = (props: Props) => {\n  const { level, structure } = props;\n  const structureDefinition: ResourceStructureDefinition = getDefinition(structure);\n\n  const currentLevel = structureDefinition.levels[level];\n  const nextLevel = structureDefinition.levels[level + 1];\n\n  const renderRow = (resource: Resource) => {\n    const resourceDescription = resourceDescriptions[resource];\n\n    return (\n      <Fragment key={resource}>\n        <div><Icon image={resourceDescription.iconImg} size=\"smallest\"/></div>\n        <div>\n           {TextManager.get('ui-structure-resource-help-upgrade-resource-generates', { resource })}\n        </div>\n        <div className=\"number\">{currentLevel.generates[resource]}</div>\n        <div className=\"arrow\">›</div>\n        <div className=\"number\">{nextLevel.generates[resource]}</div>\n      </Fragment>\n    );\n  };\n\n  return (\n    <div className=\"upgrade-help-model-content-resource\">\n      <div className=\"grid generates-increase\">\n        <div className=\"header\">\n          <h3>{TextManager.get('ui-structure-help-upgrade-improvements')}</h3>\n        </div>\n        <div className=\"header\"/>\n        <div className=\"header number\">\n          {TextManager.get('ui-structure-help-upgrade-header-level', {\n            level: level + 1,\n          })}\n        </div>\n        <div className=\"header\"/>\n        <div className=\"header number\">\n        {TextManager.get('ui-structure-help-upgrade-header-level', {\n          level: level + 2,\n        })}\n        </div>\n        <div><Icon image={'/img/resources/worker.png'} size=\"smallest\"/></div>\n        <div>{TextManager.get('ui-structure-help-upgrade-worker-capacity')}</div>\n        <div className=\"number\">{currentLevel.workerCapacity}</div>\n        <div className=\"arrow\">»</div>\n        <div className=\"number\">{nextLevel.workerCapacity}</div>\n        {Object.keys(nextLevel.generates).map(res => renderRow(res as Resource))}\n      </div>\n    </div>\n  );\n};\n\nexport default UpgradeHelpModalContent;\n","import { ResourceStructure, Structure  } from 'definitions/structures';\nimport { ResourceStructureLevelDefinition } from 'definitions/structures/types';\nimport UpDownValue from 'components/ui/common/UpDownValue';\nimport { useSelector, useDispatch } from 'react-redux';\nimport ReactMarkdown from 'react-markdown';\nimport { StoreState } from 'store/types';\nimport { selectFreeWorkers } from 'store/selectors/workers';\nimport { decreaseWorkers, increaseWorkers, removeItemFromHarvest } from 'store/actions/structures';\nimport StructureViewHeader from '../StructureViewHeader';\nimport { TextManager } from 'global/TextManager';\nimport StructureLevel from '../StructureLevel';\nimport { TooltipManager } from 'global/TooltipManager';\nimport { ContextType } from 'constants/context';\nimport { useStructureLevel, useStructureState } from 'hooks/store/structures';\nimport ResourceGenerationRow from './ResourceGenerationRow';\nimport { Resource } from 'definitions/resources';\nimport DraggableItemsList from 'components/ui/items/DraggableItemsList';\nimport { Item } from 'definitions/items/types';\nimport { DragSourceType } from 'constants/dragging';\nimport HarvestProgress from './HarvestProgress';\nimport IconButton from 'components/ui/buttons/IconButton';\nimport warehouseIcon from 'components/structures/styles/images/warehouse/icon.png';\nimport { addItemToWarehouse } from 'store/actions/stockpile';\nimport UpgradeHelpModal from '../UpgradeHelpModal';\nimport UpgradeHelpModalContent from './UpgradeHelpModalContent';\nimport './styles/resourceStructureView.scss';\n\nexport interface Props  {\n  structure: Structure;\n}\n\nconst selectHarvest = (store: StoreState, structure: ResourceStructure): Item[] => {\n  return store.structures[structure].harvest ?? [];\n};\n\n// todo: 02/12/2019 [ ] Can show progress bar in resource screen\nconst ResourceStructureView = (props: Props) => {\n  const { structure } = props;\n\n  // Fetch needed values from store\n  const { level, workers } = useStructureState(structure);\n  const workersFree = useSelector<StoreState, number>((store) => selectFreeWorkers(store));\n  const harvest = useSelector<StoreState, Item[]>((store) => selectHarvest(store, structure as ResourceStructure));\n  const levelDefinition = useStructureLevel<ResourceStructureLevelDefinition>(structure);\n\n  // Reducer dispatch\n  const dispatch = useDispatch();\n  const handleWorkersDown = () => {\n    dispatch(decreaseWorkers(props.structure));\n  };\n\n  const handleWorkersUp = () => {\n    dispatch(increaseWorkers(props.structure));\n  };\n\n\n  const upDisabled = workers === levelDefinition.workerCapacity || (workersFree || 0) < 1;\n  const downDisabled = workers === 0;\n\n  const handleHelpClicked = (event: React.MouseEvent) => {\n    const origin = (event.currentTarget as HTMLElement);\n    const originRect = origin.getBoundingClientRect();\n    const content = (\n      <UpgradeHelpModal level={level} structure={structure}>\n        <UpgradeHelpModalContent level={level} structure={structure}/>\n      </UpgradeHelpModal>\n    );\n    TooltipManager.showContextTooltip(ContextType.component, content, originRect, 'upgrade-structure-tooltip');\n\n    event.stopPropagation();\n  };\n\n  const handleItemTake = (item: Item, index: number) => {\n    dispatch(removeItemFromHarvest(structure, index));\n    dispatch(addItemToWarehouse(item));\n  };\n\n  return (\n    <>\n      <StructureViewHeader structure={props.structure} />\n      <div className=\"resource-structure-view\">\n        <section>\n          <StructureLevel structure={structure} onHelpClicked={handleHelpClicked}/>\n          <UpDownValue\n            label={TextManager.get('ui-structure-production-workers')}\n            value={workers}\n            max={levelDefinition.workerCapacity}\n            upDisabled={upDisabled}\n            downDisabled={downDisabled}\n            onDown={handleWorkersDown}\n            onUp={handleWorkersUp}\n          />\n          { /** Generates this resource */}\n          <h3>Generates</h3>\n          { Object.keys(levelDefinition.generates).map(r => <ResourceGenerationRow structure={structure} resource={r as Resource} key={r} />)}\n\n          { levelDefinition.harvest && (\n            <>\n              { /** Generates these items */}\n              <h3>Harvest</h3>\n              <ReactMarkdown>\n                {TextManager.get(`ui-structure-resource-harvest-${structure}`)}\n              </ReactMarkdown>\n              <HarvestProgress structure={structure} />\n              <DraggableItemsList\n                items={harvest}\n                sourceType={DragSourceType.resourceStructure}\n                sourceId={structure}\n                slots={levelDefinition.harvest?.amount}\n                renderButton={(item: Item, index: number) => (<IconButton iconImg={warehouseIcon} onClick={() => handleItemTake(item, index)} >Take</IconButton>)}\n              />\n\n            </>\n          )}\n        </section>\n      </div>\n    </>\n  );\n};\n\nexport default ResourceStructureView;\n\n","import { getDefinition, Structure } from 'definitions/structures';\nimport { StructureDefinition, StructureType } from 'definitions/structures/types';\nimport { StructureState } from 'store/types/structure';\nimport { useSelector } from 'react-redux';\nimport { StoreState } from 'store/types';\nimport { TasksStoreState } from 'store/types/tasks';\nimport { useStructureState } from 'hooks/store/structures';\nimport { withWindow } from 'hoc/withWindow';\nimport { Props as WindowProps } from 'components/ui/window/Window';\nimport { formatDuration } from 'utils/format/time';\nimport { TickingProgressbar } from 'components/ui/common/progress';\nimport ProductionStructureView from 'components/structures/production/ProductionStructureView';\nimport WarehouseStructureView from 'components/structures/warehouse/WarehouseStructureView';\nimport TavernStructureView from 'components/structures/tavern/TavernStructureView';\nimport ResourceStructureView from 'components/structures/resource/ResourceStructureView';\nimport './styles/structuredetailsview.scss';\n\ninterface Props {\n  structure: Structure;\n}\n\nconst StructureDetailsView = (props: Props & WindowProps) => {\n  const { structure } = props;\n  const tasks = useSelector<StoreState, TasksStoreState>(store => store.tasks);\n  const buildTask = tasks.running.filter((val) =>\n    val.origin === 'town' && val.name === `${structure}.build`)[0];\n  const structureState = useStructureState(structure);\n\n  const renderContent = () => {\n    if (structureState.state === StructureState.Building) {\n      if (!buildTask) return null;\n      return (\n        <div className=\"building\">\n          <TickingProgressbar\n            progress={buildTask.progress}\n            label={`Building... (${formatDuration(buildTask.timeRemaining)})`}\n          />\n        </div>\n      );\n    } else {\n\n      const structureDefinition: StructureDefinition = getDefinition(structure);\n      switch (structureDefinition.type) {\n        case StructureType.production: {\n          return <ProductionStructureView structure={structure} />;\n        }\n        case StructureType.resource: {\n          return <ResourceStructureView structure={structure} />;\n        }\n        case StructureType.warehouse: {\n          return <WarehouseStructureView />;\n        }\n        case StructureType.tavern: {\n          return <TavernStructureView />;\n        }\n        default: {\n          return <div>{structure}</div>;\n        }\n      }\n    }\n  };\n\n  return (\n    <div className=\"structure-details\">\n      { renderContent() }\n    </div>\n  );\n};\n\nexport default StructureDetailsView;\nexport const StructureDetailsWindow = withWindow(StructureDetailsView);\n","import { Structure } from 'definitions/structures';\nimport { Link, useParams } from 'react-router-dom';\nimport { TextManager } from 'global/TextManager';\nimport Button from 'components/ui/buttons/Button';\nimport { getStructureLink } from 'utils/routing';\nimport StructureDetailsView from './StructureDetailsView';\nimport './styles/structuredetailsview.scss';\n\nconst RoutedStructureDetailsView = () => {\n  const { structure } = useParams<{ structure: Structure }>();\n  if (!structure) return null;\n\n  const title = TextManager.getStructureName(structure);\n  return (\n    <div className=\"structure-details-window \">\n      <div className=\"header\">\n        <h3>{ title }</h3>\n        <Link to={getStructureLink(structure, true)}>\n          <Button\n            className=\"close-button\"\n            square={true}\n            size={'medium'}\n            color=\"purple\"\n            text=\"x\"\n          />\n        </Link>\n      </div>\n      <StructureDetailsView structure={structure} title={title} />\n    </div>\n  );\n};\n\nexport default RoutedStructureDetailsView;\n","export default __webpack_public_path__ + \"static/media/icon.049af8e1.png\";","export default __webpack_public_path__ + \"static/media/icon.c8d10643.png\";","export default __webpack_public_path__ + \"static/media/icon.0e0cc642.png\";","export default __webpack_public_path__ + \"static/media/icon.98ba42d7.png\";","export default __webpack_public_path__ + \"static/media/icon.2819a92b.png\";","export default __webpack_public_path__ + \"static/media/icon.d422c1b8.png\";","export default __webpack_public_path__ + \"static/media/icon.cb41f623.png\";","export default __webpack_public_path__ + \"static/media/icon.8c08d004.png\";","export default __webpack_public_path__ + \"static/media/icon.54fdc54f.png\";","export default __webpack_public_path__ + \"static/media/icon.288a01cf.png\";","export default __webpack_public_path__ + \"static/media/icon.701060d5.png\";","import { ComponentProps } from 'react';\nimport { Sprite } from '@inlet/react-pixi';\nimport alchemist from 'components/structures/styles/images/alchemist/icon.png';\nimport armoursmith from 'components/structures/styles/images/armoursmith/icon.png';\nimport garden from 'components/structures/styles/images/garden/icon.png';\nimport lumberMill from 'components/structures/styles/images/lumberMill/icon.png';\nimport mine from 'components/structures/styles/images/mine/icon.png';\nimport quarry from 'components/structures/styles/images/quarry/icon.png';\nimport tannery from 'components/structures/styles/images/tannery/icon.png';\nimport tavern from 'components/structures/styles/images/tavern/icon.png';\nimport warehouse from 'components/structures/styles/images/warehouse/icon.png';\nimport weaponsmith from 'components/structures/styles/images/weaponsmith/icon.png';\nimport weaver from 'components/structures/styles/images/weaver/icon.png';\nimport workshop from 'components/structures/styles/images/workshop/icon.png';\nimport { Structure } from 'definitions/structures';\n\ninterface Props {\n  structure: Structure;\n}\n\nconst getImage = (structure: Structure) => {\n  switch (structure) {\n    case 'alchemist': return alchemist;\n    case 'armoursmith': return armoursmith;\n    case 'garden': return garden;\n    case 'lumberMill': return lumberMill;\n    case 'mine': return mine;\n    case 'quarry': return quarry;\n    case 'tannery': return tannery;\n    case 'tavern': return tavern;\n    case 'warehouse': return warehouse;\n    case 'weaponsmith': return weaponsmith;\n    case 'weaver': return weaver;\n    case 'workshop': return workshop;\n    default:\n      throw new Error(`No such structure ${structure}`);\n  }\n};\n\nconst StructureIconSprite = (props: Props & ComponentProps<typeof Sprite>) => (\n  <Sprite\n    image={getImage(props.structure)}\n    {...props}\n  />\n);\nexport default StructureIconSprite;\n","import { Container, Sprite, Text } from '@inlet/react-pixi';\nimport { Structure } from 'definitions/structures';\nimport { useStructureState } from 'hooks/store/structures';\nimport { StructureState } from 'store/types/structure';\nimport { TextManager } from 'global/TextManager';\nimport { BlurFilter } from '@pixi/filter-blur';\nimport StructureIconSprite from './StructureIconSprite';\nimport { TextStyle, TextMetrics } from 'pixi.js';\n\ninterface Props {\n  structure: Structure;\n  x: number;\n  y: number;\n}\n\nconst style = new TextStyle({\n  fontFamily : 'Gabriela',\n  fontSize: 25,\n  fill: 0xffffff,\n  wordWrap: true,\n  wordWrapWidth: 200,\n  dropShadow: true,\n  dropShadowAngle: 0.9,\n  dropShadowBlur: 10,\n  dropShadowDistance: 0,\n});\n\nconst blurFilter = new BlurFilter(2, 2);\nconst borderWidth = 985; // width of original border image\n\nconst StructureLabel = (props: Props) => {\n  const { x, y } = props;\n  const structure = useStructureState(props.structure);\n  // const mask = useRef<PIXI.Graphics>(null);\n  if (structure.state !== StructureState.Built){\n    return null;\n  }\n  const structureName = TextManager.getStructureName(props.structure) ?? '';\n\n  const metrics = TextMetrics.measureText(`${structureName}`, style);\n  return (\n    <Container\n      x={x}\n      y={y}\n      name={props.structure}\n    >\n      <Sprite\n        name=\"background\"\n        image={`${process.env.PUBLIC_URL}/img/town/structure-label/background.png`}\n        scale={[(metrics.width + 16) / 190, 25.5]}\n        alpha={0.5}\n        filters={[blurFilter]}\n        y={3.5}\n        x={8}\n      />\n      <Sprite\n        name=\"border-top\"\n        image={`${process.env.PUBLIC_URL}/img/town/structure-label/border-top.png`}\n        scale={[(metrics.width + 30) / borderWidth, 0.2]}\n        y={2}\n      />\n       <Sprite\n          name=\"border-bottom\"\n          image={`${process.env.PUBLIC_URL}/img/town/structure-label/border-top.png`}\n          y={28}\n          scale={[(metrics.width + 30) / borderWidth, 0.2]}\n       />\n       <StructureIconSprite\n          name=\"icon\"\n          structure={props.structure}\n          y={-2}\n          x={metrics.width + 12}\n          scale={[0.015, 0.015]}\n       />\n      {/* <Graphics\n        name=\"mask\"\n        ref={mask}\n        draw={graphics => {\n            graphics.beginFill(0xff0000)\n            graphics.drawRect(-32, 6, metrics.width + 60, 32-6);\n            graphics.endFill();\n        }}\n      /> */}\n      <Text\n        anchor={[0, 0]}\n        text={`  ${structureName[0].toUpperCase() + structureName.slice(1)}  `}\n        style={style}\n      />\n    </Container>\n  );\n};\n\nexport default StructureLabel;\n","import React, { useEffect, useState } from 'react';\nimport { Container } from '@inlet/react-pixi';\nimport FontFaceObserver from 'fontfaceobserver';\nimport StructureLabel from './StructureLabel';\n\nconst StructureLabels = () => {\n  const [fontLoaded, setFontLoaded] = useState(false);\n  useEffect(() => {\n    const font = new FontFaceObserver('Gabriela');\n    font.load().then(function () {\n      setFontLoaded(true);\n    });\n  }, []);\n\n  if (!fontLoaded) return null;\n  return (\n    <Container name=\"structure-labels\">\n      <StructureLabel structure={'tavern'} x={645} y={535} />\n      <StructureLabel structure={'warehouse'} x={430} y={130} />\n      <StructureLabel structure={'lumberMill'} x={235} y={410} />\n      <StructureLabel structure={'alchemist'} x={375} y={460} />\n      <StructureLabel structure={'weaponsmith'} x={435} y={495} />\n      <StructureLabel structure={'armoursmith'} x={515} y={425} />\n      <StructureLabel structure={'weaver'} x={555} y={370} />\n      <StructureLabel structure={'tannery'} x={255} y={520} />\n      <StructureLabel structure={'mine'} x={185} y={590} />\n      <StructureLabel structure={'workshop'} x={345} y={660} />\n      <StructureLabel structure={'quarry'} x={685} y={666} />\n      <StructureLabel structure={'garden'} x={785} y={776} />\n    </Container>\n  );\n};\n\nexport default StructureLabels;\n","import React, { useState, useEffect } from 'react';\nimport { Structure } from 'definitions/structures';\nimport { Sprite, useApp, useTick } from '@inlet/react-pixi';\nimport HitAreaShapes from 'utils/pixiJs/hitAreaShapes';\nimport { STRUCTURE_HIGHLIGHT_FILTER } from 'components/town/TownView';\nimport { loadResource } from 'utils/pixiJs';\nimport { Point, Texture } from 'pixi.js';\n\nconst BLADE_ROTATION_SPEED = 0.01;\n\nexport interface Props {\n  onStructureClick: (structure: Structure | null) => void;\n  position: Point;\n  selected?: boolean;\n  hitAreaShapes: HitAreaShapes;\n}\n\nconst LumberMill = (props: Props) => {\n  const { hitAreaShapes } = props;\n  const structure: Structure = 'lumberMill';\n  const atlas = `${process.env.PUBLIC_URL}/img/town/town-alpha/${structure}.json`;\n  const [textures, setTextures] = useState<{ [name: string]: Texture }>();\n  const filters = props.selected ? [STRUCTURE_HIGHLIGHT_FILTER] : [];\n\n  const app = useApp();\n\n  useEffect(() => {\n    loadResource(atlas, (resource) => {\n      if (resource) {\n        setTextures(resource.textures);\n      }\n    });\n  }, [app, app.loader, atlas]);\n\n  const [rotation, setRotation] = useState(0);\n  useTick((delta:number | undefined) => setRotation(r => r + (BLADE_ROTATION_SPEED * (delta ?? 0))));\n\n\n  if (!textures) return null;\n  return (\n    <Sprite\n      name={structure}\n      position={props.position}\n      interactive={true}\n      buttonMode={true}\n      pointertap={() => {\n        props.onStructureClick(structure);\n      }}\n      hitArea={hitAreaShapes}\n      filters={filters}\n      texture={textures['structure.png']}\n    >\n      <Sprite\n        name=\"blades\"\n        texture={textures['blades.png']}\n        anchor={new Point(0.5, 0.5)}\n        x={15}\n        y={10}\n        rotation={rotation}\n      />\n    </Sprite>\n  );\n};\n\nexport default LumberMill;\n","import { ComponentProps } from 'react';\nimport { PixiComponent, applyDefaultProps, Container } from '@inlet/react-pixi';\nimport * as PIXI  from 'pixi.js';\nimport * as particles from '@pixi/particle-emitter';\nimport { upgradeConfig } from '@pixi/particle-emitter';\n\ninterface Props  {\n  image: string;\n  config: particles.EmitterConfigV1;\n}\n\n\nconst ParticleEmitter = PixiComponent<Props & ComponentProps<typeof Container>, PIXI.ParticleContainer>('ParticleEmitter', {\n  create: () => new PIXI.ParticleContainer(256, {}),\n\n  applyProps: (instance, oldProps: Props, newProps: Props) => {\n    const { image, config, ...newP } = newProps;\n\n    // apply rest props to PIXI.ParticleContainer\n    applyDefaultProps(instance, oldProps, newP);\n\n    const newConfig = upgradeConfig(config, [PIXI.Texture.from(image)]);\n    const emitter = new particles.Emitter(\n      instance,\n      newConfig,\n    );\n\n    let elapsed = performance.now();\n\n    const tick = () => {\n      if (instance.destroyed) {\n        return;\n      }\n\n      const now = performance.now();\n      // const amp = Math.random() * 5 + 15;\n      // const amp = 15;\n      // const freq = 0.0015;\n      // emitter.acceleration.x = (Math.sin((elapsed * freq)) * amp) + 15;\n\n      emitter.update((now - elapsed) * 0.0003);\n\n      elapsed = now;\n      requestAnimationFrame(tick);\n    };\n    emitter.emit = true;\n    // emitter.update(00.2);\n\n    tick();\n  },\n});\n\nexport default ParticleEmitter;\n","import { Sprite, Container } from '@inlet/react-pixi';\nimport { Point } from 'pixi.js';\nimport { Structure } from 'definitions/structures';\nimport HitAreaShapes from 'utils/pixiJs/hitAreaShapes';\nimport smoke from './smoke.json';\nimport ParticleEmitter from 'components/pixi/ParticleEmitter';\nimport { STRUCTURE_HIGHLIGHT_FILTER } from 'components/town/TownView';\n\nexport interface Props {\n  onStructureClick: (structure: Structure | null) => void;\n  position: Point;\n  selected?: boolean;\n  hitAreaShapes: HitAreaShapes;\n}\n\nconst Tavern = (props: Props) => {\n  const { hitAreaShapes, position } = props;\n  const structure: Structure = 'tavern';\n  const filters = props.selected ? [STRUCTURE_HIGHLIGHT_FILTER] : [];\n\n  return (\n    <Container position={position}>\n      <Sprite\n        name={structure}\n        interactive={true}\n        buttonMode={true}\n        pointertap={() => { props.onStructureClick(structure); }}\n        filters={filters}\n        hitArea={hitAreaShapes}\n        image={`${process.env.PUBLIC_URL}/img/town/town-alpha/${structure}.png`}\n      />\n      <ParticleEmitter\n        name=\"smoke\"\n        x={107}\n        y={-2}\n        image={`${process.env.PUBLIC_URL}/img/town/effects/smokeparticle.png`}\n        config={smoke}\n      />\n    </Container>\n  );\n};\nexport default Tavern;\n","import { Structure } from 'definitions/structures';\nimport { Sprite } from '@inlet/react-pixi';\nimport HitAreaShapes from 'utils/pixiJs/hitAreaShapes';\nimport { STRUCTURE_HIGHLIGHT_FILTER } from 'components/town/TownView';\nimport { Point } from 'pixi.js';\n\nexport interface Props {\n  onStructureClick: (structure: Structure | null) => void;\n  position: Point;\n  selected?: boolean;\n  structure: Structure;\n  hitAreaShapes: HitAreaShapes;\n}\n\nconst Generic = (props: Props) => {\n  const { structure, position, hitAreaShapes, selected, onStructureClick } = props;\n  const filters = selected ? [STRUCTURE_HIGHLIGHT_FILTER] : [];\n\n  const handlePointerTap = () => {\n    onStructureClick(structure);\n  };\n\n  return (\n    <Sprite\n      name={structure}\n      position={position}\n      interactive={true}\n      buttonMode={true}\n      pointertap={handlePointerTap}\n      hitArea={hitAreaShapes}\n      filters={filters}\n      image={`${process.env.PUBLIC_URL}/img/town/town-alpha/${structure}.png`}\n    >\n      {/* <Graphics\n        name=\"hitarea\"\n        draw={graphics => {\n          graphics.beginFill(0xffffff);\n          hitAreaShapes.shapes.map(shape => graphics.drawPolygon(shape))\n          graphics.endFill();\n        }}\n      /> */}\n    </Sprite>\n  );\n};\nexport default Generic;\n","import { Structure } from 'definitions/structures';\nimport LumberMill from '../structures/LumberMill';\nimport Tavern from '../structures/Tavern';\nimport Generic from '../structures/Generic';\nimport { Point } from 'pixi.js';\n\nexport const getStructure = (structure: Structure) => {\n  switch (structure) {\n    case 'workshop':\n    case 'quarry':\n    case 'tannery':\n    case 'alchemist':\n    case 'garden':\n    case 'weaponsmith':\n    case 'armoursmith':\n    case 'warehouse':\n    case 'mine':\n    case 'weaver':\n      return Generic;\n    case 'lumberMill':\n      return LumberMill;\n    case 'tavern':\n      return Tavern;\n  }\n};\n\nexport const getStructurePosition = (structure: Structure) => {\n  let x;\n  let y;\n  switch (structure) {\n    case 'workshop':\n      x = 373;\n      y = 610;\n      break;\n    case 'quarry':\n      x = 632;\n      y = 633;\n      break;\n    case 'tannery':\n      x = 372;\n      y = 460;\n      break;\n    case 'tavern':\n      x = 500;\n      y = 469;\n      break;\n    case 'alchemist':\n      x = 411;\n      y = 371;\n      break;\n    case 'garden':\n      x = 822;\n      y = 689;\n      break;\n    case 'weaponsmith':\n      x = 449;\n      y = 460;\n      break;\n    case 'armoursmith':\n      x = 473;\n      y = 442;\n      break;\n    case 'warehouse':\n      x = 471;\n      y = 130;\n      break;\n    case 'lumberMill':\n      x = 403;\n      y = 320;\n      break;\n    case 'mine':\n      x = 183;\n      y = 527;\n      break;\n    case 'weaver':\n      x = 484;\n      y = 333;\n      break;\n  }\n  return new Point(x, y);\n};\n","import { useRef, useEffect, useState } from 'react';\nimport { useSelector } from 'react-redux';\nimport { Structure } from 'definitions/structures';\nimport { StructuresStoreState } from 'store/types/structures';\nimport { SoundManager, Channel, MixMode } from 'global/SoundManager';\nimport { Route, Routes, useMatch, useNavigate } from 'react-router';\nimport { OutlineFilter } from '@pixi/filter-outline';\nimport { getStructureLink, getTownLink } from 'utils/routing';\nimport { StructureState, StructureStoreState } from 'store/types/structure';\nimport { Viewport as PixiViewport } from 'pixi-viewport';\nimport { StoreState } from 'store/types';\nimport { gsap } from 'gsap';\nimport { MAX_WIDTH } from 'components/App';\nimport HitAreaShapes from 'utils/pixiJs/hitAreaShapes';\nimport polygons from '../hitAreas.json';\nimport { withAppContext } from 'hoc/withAppContext';\nimport TownStage from '../TownStage';\nimport Clouds from '../Clouds';\nimport RoutedStructureDetailsView from '../StructureDetailsView';\nimport StructureLabels from '../StructureLabels';\nimport { getStructure, getStructurePosition } from './utils';\nimport './styles/townView.scss';\n\nconst HEIGHT = 1079;\nconst WORLD_WIDTH = 1024;\nconst WORLD_HEIGHT = 1600;\n\n\nexport const STRUCTURE_HIGHLIGHT_FILTER = new OutlineFilter(8, 0xffcc00);\n\nconst TownView = () => {\n  const hightlightMatch = useMatch(`${getTownLink()}/:structure`);\n  const viewMatch = useMatch(`${getTownLink()}/:structure/view`);\n  const selectedStructure = hightlightMatch?.params.structure;\n  const ref = useRef<HTMLDivElement>(null);\n  const viewportRef = useRef<PixiViewport>(null);\n  const dragging = useRef(false);\n  const navigate = useNavigate();\n\n  useEffect(() => {\n    SoundManager.addSound('music/town', 'sound/music/Soliloquy.mp3', () => {\n      SoundManager.playSound('music/town', Channel.music, true, MixMode.fade, true);\n    });\n  }, []);\n\n  useEffect(() => {\n    const tween = gsap.to(STRUCTURE_HIGHLIGHT_FILTER, {\n      duration: .6,\n      thickness: 2,\n      yoyo: true,\n      repeat: -1,\n    });\n    return () => {\n      tween.pause(0);\n      tween.kill();\n    };\n  }, []);\n\n  useEffect(() => {\n    if (viewportRef.current) {\n\n      const viewport = viewportRef.current;\n      viewport.on('drag-start', (e) => {\n        dragging.current = true;\n        e.event.stopPropagation();\n      });\n      viewport.on('drag-end', () => { dragging.current = false; });\n    }\n  }, []);\n\n  const handleStructureClick = (structure: Structure | null) => {\n    if (!dragging.current && structure) {\n      SoundManager.playSound('ui/buttonClick');\n      navigate(getStructureLink(structure));\n    }\n  };\n\n  const structures = useSelector<StoreState, StructuresStoreState>((state: StoreState) => {\n    return state.structures;\n  });\n\n  const renderStructures = () => {\n    const orderedStructures: Structure[] = [\n      'workshop',\n      'quarry',\n      'tavern',\n      'tannery',\n      'alchemist',\n      'garden',\n      'weaponsmith',\n      'armoursmith',\n      'warehouse',\n      'mine',\n      'lumberMill',\n      'weaver',\n    ];\n    return orderedStructures.reverse().map((structure) => {\n      const structureStore: StructureStoreState = structures[structure];\n      if (structureStore.state === StructureState.NotBuilt) {\n        return null;\n      }\n      // todo: refactor into seperate components\n\n      const StructureComponent = getStructure(structure);\n      const position = getStructurePosition(structure);\n      const hitAreaShapes = new HitAreaShapes(polygons, structure as string);\n      return (\n        <StructureComponent\n          position={position}\n          structure={structure}\n          hitAreaShapes={hitAreaShapes}\n          onStructureClick={handleStructureClick}\n          key={structure}\n          selected={selectedStructure === structure}\n        />\n      );\n    });\n  };\n\n  useEffect(() => {\n    if (selectedStructure && viewportRef.current) {\n      const viewport = viewportRef.current;\n      viewport.zoomPercent(0);\n      const position = getStructurePosition(selectedStructure as Structure);\n      viewport.moveCenter(position);\n    }\n  }, [selectedStructure]);\n\n  const [canvasWidth, setCanvasWidth] = useState(MAX_WIDTH);\n  const [canvasHeight, setCanvasHeight] = useState(HEIGHT);\n\n  useEffect(() => {\n    // This will set the dimensions of the canvas tot that of the townview\n    const resize = () => {\n      const worldViewWidth = ref.current?.clientWidth || MAX_WIDTH;\n      const worldViewHeight = ref.current?.clientHeight || HEIGHT;\n\n      setCanvasWidth(worldViewWidth);\n      setCanvasHeight(worldViewHeight);\n    };\n    resize();\n    window.addEventListener('resize', resize);\n    return () => {\n      window.removeEventListener('resize', resize);\n      window.scrollY = 0;\n    };\n  }, []);\n\n\n  return (\n    <div className=\"town-view\" ref={ref}>\n      {/* <Legenda structures={structures} /> */}\n      { viewMatch === null && (\n        <TownStage\n          screenWidth={canvasWidth}\n          screenHeight={canvasHeight}\n          worldWidth={WORLD_WIDTH}\n          worldHeight={WORLD_HEIGHT}\n          ref={viewportRef}\n          blockScroll={viewMatch === null}\n        >\n          <Clouds worldWidth={canvasWidth} />\n          {renderStructures()}\n          <Clouds worldWidth={canvasWidth} />\n          <StructureLabels />\n        </TownStage>\n      )}\n      <Routes>\n        <Route path=\":structure/view\" element={<RoutedStructureDetailsView />} />\n      </Routes>\n    </div>\n  );\n};\n\nexport default withAppContext(TownView);\n","import React, { useEffect, useState } from 'react';\nimport { ToastManager, ToastConfig, EVENT_TOASTS_UPDATED } from 'global/ToastManager';\nimport Toast from './Toast';\nimport './styles/toasts.scss';\n\n// Toasts can be added by calling ToastManager.addToast\n// ToastManager will inform whenever the something is added to the list of toasts via EVENT_TOASTS_UPDATED\n// The toasts themselves will fade out via css transition\nconst Toasts = () => {\n\n  const [activeToasts, setActiveToasts] = useState<ToastConfig[]>([]);\n\n  const toastsUpdated = (stack?: ToastConfig[]) => {\n    if (stack) setActiveToasts(stack);\n  };\n\n  useEffect(() => {\n    ToastManager.instance.addListener(EVENT_TOASTS_UPDATED, toastsUpdated);\n    return () => {\n      ToastManager.instance.removeListener(EVENT_TOASTS_UPDATED, toastsUpdated);\n    };\n  }, []);\n\n  return (\n    <div className=\"toasts\" >\n      { activeToasts.map((toastConfig) => (\n        <Toast key={toastConfig.time} {...toastConfig}/>\n      ))}\n    </div>\n  );\n};\n\nexport default Toasts;\n","import { SettingsState } from 'store/types/settings';\n\nexport type SettingsKey = keyof SettingsState;\n\nexport type SettingsAction = {\n  type: 'setSetting',\n  setting: SettingsKey\n  value: unknown\n};\n\nexport const setSetting = (setting: SettingsKey, value: unknown): SettingsAction => ({\n  type: 'setSetting',\n  setting,\n  value,\n});\n","import { useSelector } from 'react-redux';\nimport { StoreState } from 'store/types';\nimport { SettingsState } from 'store/types/settings';\n\nexport const useSettings = () => {\n  return useSelector<StoreState, SettingsState>(state => state.settings);\n};\n","import * as React from 'react';\nimport { compose } from 'redux';\nimport { useDispatch } from 'react-redux';\nimport { ChangeEvent } from 'react';\nimport gsap from 'gsap';\nimport { Channel, SoundManager } from 'global/SoundManager';\nimport { withWindow } from 'hoc/withWindow';\nimport { setSetting, SettingsKey } from 'store/actions/settings';\nimport { useSettings } from 'hooks/store/settings';\nimport './styles/settings.scss';\n\nconst SettingsWindow = () => {\n  const settings = useSettings();\n  const dispatch = useDispatch();\n\n  const getChannelControls = (channel: Channel) => {\n    const handleVolumeChange = (e: ChangeEvent<HTMLInputElement>) => {\n      const linear = parseFloat(e.target.value);\n      const log = Math.pow(linear, 2);\n      SoundManager.setChannelVolume(channel, log);\n    };\n\n    const handleMuteClick = (e: React.MouseEvent<HTMLButtonElement>) => {\n      const slider = (e.currentTarget as HTMLButtonElement).parentNode?.lastChild;\n      if (slider) {\n        gsap.to(slider, {\n          duration: .5,\n          value: 0,\n          onComplete: () => {\n            SoundManager.setChannelVolume(channel, 0);\n          },\n        });\n      }\n    };\n\n    return (\n      <p>\n        <label>{Channel[channel]}</label>\n        <button onClick={handleMuteClick}>\n          <span role=\"img\" aria-label=\"Mute\">🔇</span>\n        </button>\n        <input\n          type=\"range\"\n          min=\"0\"\n          max=\"1\"\n          step=\"0.05\"\n          onChange={handleVolumeChange}\n          defaultValue={`${Math.sqrt(SoundManager.getChannelVolume(channel))}`}\n        />\n      </p>\n    );\n  };\n\n  const handleBooleanChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const setting = e.currentTarget.getAttribute('setting-name');\n    if (setting === null) throw new Error('No setting');\n    dispatch(setSetting(setting as SettingsKey, e.currentTarget.checked));\n  };\n\n  return (\n    <div className=\"settings-window\">\n      <details open className=\"settings-section sound\" >\n        <summary>Sound volume</summary>\n        <section>\n          {getChannelControls(Channel.ui)}\n          {getChannelControls(Channel.scene)}\n          {getChannelControls(Channel.music)}\n          {getChannelControls(Channel.ambient)}\n        </section>\n      </details>\n      <details open className=\"settings-section combat\" >\n        <summary>Combat</summary>\n        <section>\n          <p>\n          <label>Verbose combat log</label>\n          <input\n            type=\"checkbox\"\n            checked={settings.verboseCombatLog}\n            setting-name=\"verboseCombatLog\"\n            onChange={handleBooleanChange}\n          />\n        </p>\n        </section>\n      </details>\n      <details open className=\"settings-section debug\" >\n        <summary>Debug</summary>\n        <section>\n          <p>\n          <label>Enable debug drawer (~ key)</label>\n          <input\n            type=\"checkbox\"\n            checked={settings.debugEnableDebugDrawer}\n            setting-name=\"debugEnableDebugDrawer\"\n            onChange={handleBooleanChange}\n          />\n        </p>\n        </section>\n\n      </details>\n    </div>\n  );\n};\n\nexport default compose(\n  withWindow,\n)(SettingsWindow);\n","import { Resource } from 'definitions/resources';\n\n// Whenever a list of resource is shown, use this order\nexport const resourceOrder = [\n  Resource.food,\n  Resource.wood,\n  Resource.iron,\n  Resource.stone,\n  Resource.fabric,\n  Resource.leather,\n];\n","import React from 'react';\nimport Select, { Props } from 'react-select';\n\n\nfunction DefaultSelect<Option, IsMulti extends boolean = false>(props: Props<Option, IsMulti>) {\n  return <Select\n    styles={{\n      control: (provided, state) => ({\n        ...provided,\n        minHeight: 'inherit',\n        height: '32px',\n        boxShadow: '0',\n        border: state.isFocused ? '1px solid orange' : '1px solid #B1B1B1',\n        ':hover': {\n          border: '1px solid orange',\n        },       \n      }),\n      container: (provided, _state) => ({\n        ...provided,\n        flex: 1,\n      }),\n      option: (provided) => ({\n        ...provided,\n        padding: '4px 12px',\n      }),\n      placeholder: (provided) => ({\n        ...provided,\n        whiteSpace: 'nowrap',\n      }), \n      valueContainer: (provided) => ({\n        ...provided,\n        marginTop: '-2px',\n      }), \n      indicatorsContainer: (provided) => ({\n        ...provided,\n        marginTop: '-2px',\n\n        'div': {\n          padding: '4px',\n        },\n      }),\n      \n    }}\n    {...props}\n  />;\n}\nDefaultSelect.displayName = 'DefaultSelect';\n\nexport default DefaultSelect;","import { Location } from 'utils/tilemap';\nimport { MultiColorReplaceFilter } from '@pixi/filter-multi-color-replace';\n\n\nexport enum Orientation {\n  north = 'n',\n  northEast = 'ne',\n  east = 'e',\n  southEast = 'se',\n  south = 's',\n  southWest = 'sw',\n  west = 'w',\n  northWest = 'nw',\n}\n\nexport const SPRITE_WIDTH = 142;\n\n// Calculates an orientation that origin would be in if it was looking at destination\nexport const calculateBearing = (origin: Location, destination: Location) => {\n  const angle = Math.atan2(destination[1] - origin[1], destination[0] - origin[0]);\n  const result = Math.round((angle / (2 * Math.PI / 8) + 8) % 8);\n  const orientations = [Orientation.east, Orientation.southEast, Orientation.south, Orientation.southWest, Orientation.west, Orientation.northWest, Orientation.north, Orientation.northEast];\n  return orientations[result];\n};\n\nexport const createColorReplaceFilter = (from: number[], to: number[]) => {\n  const replacements: Location[] = from.map((val, index) => {\n    return [\n      from[index], to[index],\n    ];\n  });\n  // todo!!\n  return new MultiColorReplaceFilter(replacements, 0.15);\n};\n\nexport const BLUES = [\n  0x000e5f,\n  0x00227f,\n  0x0038a5,\n  0x0055cc,\n];\n\nexport const REDS = [\n  0x570800,\n  0x700c00,\n  0x901000,\n  0xb51700,\n];\n\nexport const TEALS = [\n  0x00330d,\n  0x00653a,\n  0x08936f,\n  0x30bea5,\n];\n\nexport const PURPLE = [\n  0x3b0d3a,\n  0x641d5e,\n  0x884696,\n  0xaa61bd,\n];\n\nexport const ORANGE = [\n  0x802d0c,\n  0xaa4a12,\n  0xd16d11,\n  0xf59717,\n];\n\nexport const BLACK = [\n  0x0d0d1a,\n  0x1a1b2b,\n  0x25263a,\n  0x35354c,\n];\n\nexport const WHITE = [\n  0x30375e,\n  0x676993,\n  0xa9aac2,\n  0xe6e6e6,\n];\n\nexport const YELLOW = [\n  0xc28600,\n  0xd6ae10,\n  0xe9d333,\n  0xfdf959,\n];\n","import { useEffect, useMemo,  useState } from 'react';\nimport { getDefinition } from 'definitions/items';\nimport { ItemType, ItemCategory } from 'definitions/items/types';\nimport { getDefinition as getStructureDefinition, Structure } from 'definitions/structures';\nimport { StructureState, StructureStoreState } from 'store/types/structure';\nimport { StructuresStoreState } from 'store/types/structures';\nimport { TextManager } from 'global/TextManager';\nimport { ToastManager } from 'global/ToastManager';\nimport { Type } from 'components/ui/toasts/Toast';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { addLogText } from 'store/actions/log';\nimport { LogChannel } from 'store/types/logEntry';\nimport { resourceOrder } from 'constants/resources';\nimport { ResourceStoreState } from 'store/types/resources';\nimport { addResources } from 'store/actions/resources';\nimport { setStructureState } from 'store/actions/structures';\nimport { StoreState } from 'store/types';\nimport { addGold } from 'store/actions/gold';\nimport { addItemToWarehouse } from 'store/actions/stockpile';\nimport { withWindow } from 'hoc/withWindow';\nimport { getTimeMultiplier, setCheatTimeMultiplier, TimeType } from 'mechanics/time';\nimport ItemIcon from 'components/ui/items/ItemIcon';\nimport { IconSize } from 'components/ui/common/Icon';\nimport Button from 'components/ui/buttons/Button';\nimport Select from 'components/ui/common/Select';\nimport allItems from 'definitions/items';\nimport { addWorkers } from 'store/actions/workers';\nimport './styles/cheat.scss';\n\ninterface Options {\n  label: ItemCategory;\n  value: string;\n  subtext: string\n}\n\nconst CheatWindow = () => {\n\n  const [cheats, setCheats] = useState({\n    gold: 50,\n    resources: 50,\n    workers: 10,\n  });\n  const [selectedItem, setSelectedItem] = useState<string | null>();\n  const dispatch = useDispatch();\n  const [timeMultiplier, setTimeMultiplier] = useState(getTimeMultiplier(TimeType.cheat));\n\n  const onCheatGold = (amount: number) => {\n    dispatch(addGold(amount));\n    dispatch(addLogText('common-cheat-gold-added', { amount }, LogChannel.common));\n  };\n\n  const onCheatItem = (type: ItemType) => {\n    const item = { type };\n    dispatch(addItemToWarehouse(item));\n    dispatch(addLogText('common-cheat-item-added', { item }, LogChannel.common));\n  };\n\n  const onCheatResources = (amount: number) => {\n    // Create ResourceStoreState where value of each resource is `amount`\n    const resources = resourceOrder.reduce((acc: ResourceStoreState, resource) => {\n      acc[resource] = amount;\n      return acc;\n    }, {});\n\n    dispatch(addResources(resources));\n    dispatch(addLogText('common-cheat-resources-added', { amount }, LogChannel.common));\n  };\n\n  const onCheatStructureState = (structure: Structure, state: StructureState) => {\n    dispatch(setStructureState(structure, state));\n  };\n\n  const onCheatWorkers = (amount: number) => {\n    dispatch(addWorkers(amount));\n    dispatch(addLogText('common-cheat-workers-added', { amount }, LogChannel.common));\n  };\n\n  const structures = useSelector<StoreState, StructuresStoreState>(store => store.structures);\n\n\n  const handleChangeStructureState = (structure: Structure, checked: boolean) => {\n    onCheatStructureState(structure, checked ? StructureState.Built : StructureState.NotBuilt);\n    if (checked) {\n      ToastManager.addToast(`The ${TextManager.getStructureName(structure)} is constructed`, Type.cheat);\n    } else {\n      ToastManager.addToast(`The ${TextManager.getStructureName(structure)} is not constructed`, Type.cheat);\n    }\n  };\n\n  const getStructureRow = (structure: Structure) => {\n    const structureDef = getStructureDefinition(structure);\n    const structureStore: StructureStoreState = structures[structure];\n    const levelDef = structureDef.levels[structureStore.level];\n\n    const displayName = TextManager.get(levelDef.displayName);\n\n    return (\n      <div\n        className=\"label-dropdown\"\n        key={structure}\n      >\n        <label title={structure}>\n          {`${displayName}`}\n        </label>\n        <input\n          key={structure}\n          type=\"checkbox\"\n          checked={structureStore.state === StructureState.Built}\n          onChange={() => handleChangeStructureState(structure, structureStore.state !== StructureState.Built)}\n        />\n      </div>\n    );\n  };\n\n  const handleCheatGold = (_evt: React.MouseEvent<HTMLButtonElement>) => {\n    const amount = cheats.gold;\n    onCheatGold(amount);\n\n    const text = TextManager.get('common-cheat-gold-added', { amount });\n    const icon = '/img/resources/gold.png';\n    ToastManager.addToast(text, Type.cheat, icon);\n  };\n\n  const handleCheatWorkers = (_evt: React.MouseEvent<HTMLButtonElement>) => {\n    const amount = cheats.workers;\n    onCheatWorkers(amount);\n    const text = TextManager.get('common-cheat-workers-added', { amount });\n    const icon = '/img/resources/worker.png';\n    ToastManager.addToast(text, Type.cheat, icon);\n  };\n\n  const handleCheatResources = (_evt: React.MouseEvent<HTMLButtonElement>) => {\n    onCheatResources(cheats.resources);\n    const text = TextManager.get('common-cheat-resources-added', { amount: cheats.resources });\n    ToastManager.addToast(text, Type.cheat);\n  };\n\n  const handleCheatItem = (_evt: React.MouseEvent<HTMLButtonElement>) => {\n    const item = selectedItem as ItemType;\n    onCheatItem(item);\n\n    const text = TextManager.get('common-cheat-item-added', { item });\n    const icon = getDefinition(item).iconImg;\n    ToastManager.addToast(text, Type.cheat, icon);\n  };\n\n  const handleChangeGold = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const amount = Number.parseFloat(event.target.value);\n    setCheats({\n      ...cheats,\n      gold: amount,\n    });\n  };\n\n  const handleChangeWorkers = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const amount = Number.parseFloat(event.target.value);\n    setCheats({\n      ...cheats,\n      workers: amount,\n    });\n  };\n\n  const handleChangeResources = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const amount = Number.parseFloat(event.target.value);\n    setCheats({\n      ...cheats,\n      resources: amount,\n    });\n  };\n\n  const handleChangeTimeMultiplier = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const value = Number.parseFloat(event.target.value);\n    setTimeMultiplier(value);\n    setCheatTimeMultiplier(value);\n  };\n\n  const items = useMemo(() => (Object.keys(ItemCategory)\n    .filter(k => !isNaN(parseInt(k))) // such a weird way to unumerate an enum.. sigh\n    .map((typeKey: string) => {\n      const type = ItemCategory[typeKey as unknown as number] as unknown as ItemCategory;\n      return {\n        label: type as unknown as ItemCategory,\n        value: '',\n        subtext: '',\n        options: Object.keys(allItems)\n          // eslint-disable-next-line eqeqeq\n          .filter((item: string) => getDefinition(item as ItemType).itemCategory as unknown as string == typeKey)\n          .map((item: string) => ({\n            value: item,\n            label: TextManager.getItemName(item as ItemType),\n            subtext: TextManager.getItemSubtext(item as ItemType),\n          }),\n          ),\n      };\n    })\n  ), []);\n\n  useEffect(() => {\n    if (process.env.NODE_ENV === 'development') {\n      TextManager.printNotFounds();\n    }\n  }, []);\n\n  return (\n    <div className=\"cheat-window\">\n      <div className=\"label-numberbox-button\">\n        <label>Gold</label>\n        <input type=\"number\"\n          value={cheats.gold}\n          style={{ width: '50px' }}\n          onChange={handleChangeGold} />\n        <button onClick={handleCheatGold}>Add</button>\n      </div>\n      <div className=\"label-numberbox-button\">\n        <label>Workers</label>\n        <input type=\"number\"\n          value={cheats.workers}\n          style={{ width: '50px' }}\n          onChange={handleChangeWorkers} />\n        <button onClick={handleCheatWorkers}>Add</button>\n      </div>\n      <div className=\"label-numberbox-button\">\n        <label>Resources</label>\n        <input type=\"number\"\n          value={cheats.resources}\n          style={{ width: '50px' }}\n          onChange={handleChangeResources} />\n        <button onClick={handleCheatResources}>Add</button>\n      </div>\n      <div className=\"label-numberbox-button\">\n        <label>Items</label>\n        <Select<Options, false>\n          placeholder={'Find item in any category...'}\n          onChange={(e) => setSelectedItem(e?.value)}\n          formatGroupLabel={(data) => (\n            <div className=\"item-group\">\n              <div className=\"item-group-label\">{data.label}</div>\n              <div className=\"item-group-count\">{data.options.length} items</div>\n            </div>\n          )}\n          formatOptionLabel={option => (\n            <div className=\"item-option\">\n              <ItemIcon item={ { type: option.value as ItemType }} size={IconSize.smallest} />\n              <div className=\"item-label\">\n                {option.label}\n                <span>{(option as unknown as { subtext: string }).subtext}</span>\n              </div>\n            </div>\n          )}\n          options={items} />\n        <Button onClick={handleCheatItem}>Add</Button>\n      </div>\n      <div className=\"label-range-value\">\n        <label>Speed</label>\n        <input\n          type=\"range\"\n          min=\"1\" max=\"10\" value={timeMultiplier} step={1}\n          onChange={handleChangeTimeMultiplier}\n        />\n        {timeMultiplier}x speed\n      </div>\n      <div>\n        <h2>Structures</h2>\n      </div>\n      { Object.keys(structures).map((structure) => getStructureRow(structure as Structure))}\n    </div>\n  );\n};\n\nexport default withWindow(CheatWindow);\n\n","export type WorkersAction = {\n  type: 'addWorkers',\n  value: number\n};\n\nexport const addWorkers = (value: number): WorkersAction => ({\n  type: 'addWorkers',\n  value,\n});\n\nexport const subtractWorkers = (value: number): WorkersAction => ({\n  type: 'addWorkers',\n  value: -value,\n});\n","import { createSelector } from 'reselect';\nimport { adventurersOnQuest } from 'store/helpers/storeHelpers';\nimport { StoreState } from 'store/types';\nimport { AdventurerStoreState } from 'store/types/adventurer';\nimport { QuestStatus, QuestStoreState } from 'store/types/quest';\n\n// maybe this is not used anymore?\n\n// Store accessors\nconst getAdventurers = (state: StoreState): AdventurerStoreState[] => state.adventurers;\nconst getQuests = (state: StoreState): QuestStoreState[] => state.quests;\n\nexport const groupAdventurersByQuest = (adventurers: AdventurerStoreState[], quests: QuestStoreState[]): Record<string, AdventurerStoreState[]> => {\n  const foundInParty: AdventurerStoreState[] = []; // store the adventurers in parties in a temp array\n\n  const groupedAdventurers = Object.values(quests).reduce<{ [key: string]: AdventurerStoreState[] }>((acc, value) => {\n    const foundAdventurers = adventurersOnQuest(adventurers, value);\n    if (value.status === QuestStatus.active) {\n      // Only active quests\n      acc[value.name] = foundAdventurers;\n    }\n    foundInParty.push(...foundAdventurers);\n    return acc;\n  }, {});\n\n  // Add a special group called 'solo' for those adventurers not in a party\n  const soloKey = 'solo';\n  groupedAdventurers[soloKey] = adventurers.filter((a) => foundInParty.indexOf(a) === -1);\n\n  return groupedAdventurers;\n};\n\nconst getAdventurersInTown = (adventurers: AdventurerStoreState[], quests: QuestStoreState[]): AdventurerStoreState[] => {\n  // Get an array of all adventurer ids on any active quest\n  const adventurersNotInTown = quests.reduce<string[]>((acc, val: QuestStoreState) => {\n    if (val.status === QuestStatus.active) {\n      acc.push(...val.party);\n    }\n    return acc;\n  }, []);\n\n  return adventurers.filter((a) => adventurersNotInTown.indexOf(a.id) === -1);\n};\n\n/** Returns an object keyed by active quests whose value is a list of AdventurerStoreState */\nexport const selectAdventurersGroupedByQuest = createSelector([\n  getAdventurers,\n  getQuests],\ngroupAdventurersByQuest,\n);\n\n/** Returns a selector keyed by active quests whose value is a list of AdventurerStoreState */\nexport const createSelectAdventurersOnQuest = (questName: string) => {\n  const getAdventurersOnQuest = (adventurers: AdventurerStoreState[], quests: QuestStoreState[]): AdventurerStoreState[] => {\n    const quest = quests.find(q => q.name === questName);\n    if (!quest) throw new Error(`No quest named ${questName}`);\n    return adventurersOnQuest(adventurers, quest);\n  };\n\n  return createSelector([\n    getAdventurers,\n    getQuests],\n  getAdventurersOnQuest,\n  );\n};\n\n/** Returns an object keyed by active quests whose value is a list of AdventurerStoreState */\nexport const selectAdventurersInTown = createSelector([\n  getAdventurers,\n  getQuests],\ngetAdventurersInTown,\n);\n","// Displays various game stats\nimport { Resource } from 'definitions/resources';\nimport { Structure } from 'definitions/structures';\nimport { TextManager } from 'global/TextManager';\nimport { Fragment, useMemo } from 'react';\nimport { groupAdventurersByQuest } from 'store/selectors/adventurers';\nimport { StoreState } from 'store/types';\nimport { QuestStatus } from 'store/types/quest';\nimport { StructureState } from 'store/types/structure';\nimport { formatDateTime, formatDuration } from 'utils/format/time';\nimport { convertIntToSemVer } from 'utils/version';\nimport * as Version from 'constants/version';\nimport './styles/gameStats.scss';\n\ntype Props = {\n  state: StoreState;\n  loadGameMode?: boolean;\n};\n\nconst GameStats = (props: Props) => {\n  const { state, loadGameMode } = props;\n  const timePlaying = formatDuration(state.engine.lastTick - (state.engine.gameStarted ?? 0), true);\n  const groupedAdventurers = groupAdventurersByQuest(state.adventurers, state.quests);\n  const version = useMemo(() => {\n    if (!state.game?.version) return 'unknown';\n    if (state.game.version === Version.asInt) {\n      return convertIntToSemVer(state.game.version);\n    }\n    return (\n      <>\n        <span className=\"invalid\">{convertIntToSemVer(state.game.version)}</span>\n        <span className=\"prop\"> (current: </span>\n        <span>{convertIntToSemVer(Version.asInt)}</span>\n        <span className=\"prop\">) </span>\n      </>\n    );\n  }, [state.game.version]);\n\n  return (\n    <div className=\"game-stats\">\n      <div className=\"column\">\n        <fieldset>\n          <legend>General</legend>\n          <dl>\n            <dt>Time playing</dt>\n            <dd>{timePlaying}</dd>\n            { loadGameMode && (\n              <>\n                <dt>Time saved</dt>\n                <dd>{formatDateTime(state.engine.lastTick)}</dd>\n              </>\n            )}\n            <dt>Version</dt>\n            <dd>{version}</dd>\n            <dt>Quests active</dt>\n            <dd>{state.quests.filter(q => q.status === QuestStatus.active).length}</dd>\n            <dt>Quests completed</dt>\n            <dd>{state.quests.filter(q => q.status === QuestStatus.completed).length}</dd>\n          </dl>\n        </fieldset>\n        <fieldset>\n          <legend>Structures</legend>\n          <dl>\n            {Object.keys(state.structures).map(key => {\n              const structure = key as Structure;\n              if (state.structures[structure].state === StructureState.Built) {\n                return (\n                  <Fragment key={structure}>\n                    <dt>{TextManager.getStructureName(structure)}</dt>\n                    <dd>{TextManager.get('ui-structure-level')} {state.structures[structure].level + 1}</dd>\n                  </Fragment>\n                );\n              }\n              if (state.structures[structure].state === StructureState.Building) {\n                return (\n                  <Fragment key={structure}>\n                    <dt>{TextManager.getStructureName(structure)}</dt>\n                    <dd>constructing...</dd>\n                  </Fragment>\n                );\n              }\n              return null;\n            })}\n          </dl>\n        </fieldset>\n      </div>\n      <div className=\"column\">\n        <fieldset>\n          <legend>Resources</legend>\n          <dl>\n            {Object.keys(state.resources).map(key => {\n              const resource = key as Resource;\n              return (\n                <Fragment key={resource}>\n                  <dt>{TextManager.getResourceName(resource)}</dt>\n                  <dd>{state.resources[resource]}</dd>\n                </Fragment>\n              );\n            })}\n            <dt>{TextManager.get('resource-gold-name')}</dt>\n            <dd>{state.gold}</dd>\n            <dt>{TextManager.get('resource-workers-name')}</dt>\n            <dd>{state.workers}</dd>\n          </dl>\n        </fieldset>\n        <fieldset>\n          <legend>Adventurers</legend>\n          <dl>\n            <dt>In tavern</dt>\n            <dd>{groupedAdventurers.solo.length}</dd>\n            <dt>On quest</dt>\n            <dd>{state.adventurers.length - groupedAdventurers.solo.length}</dd>\n          </dl>\n        </fieldset>\n      </div>\n    </div>\n  );\n};\n\nexport default GameStats;\n","import { createEncryptor } from 'simple-encryptor';\nimport { StoreState } from 'store/types';\nconst key = 'P5mw}jD>5c6Y]yqy';\nconst encryptor = createEncryptor(key);\n\nexport const saveGame = (storeState: StoreState) => {\n  const a = document.createElement('a');\n  const text = JSON.stringify(storeState);\n  const encrypted = encryptor.encrypt(text);\n  const filename = 'Gidletown save.json';\n  a.setAttribute('href', 'data:text/json;charset=utf-8,' + encodeURIComponent(encrypted));\n  a.setAttribute('download', filename);\n  a.click();\n};\n\nexport const decryptSavedGame = (encrypted: string) : StoreState => {\n  const text = encryptor.decrypt(encrypted);\n  return JSON.parse(text);\n};\n","import { Props as WindowProps } from 'components/ui/window/Window';\nimport { AppContextProps, withAppContext } from 'hoc/withAppContext';\nimport { withWindow } from 'hoc/withWindow';\nimport { compose } from 'redux';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { StoreState } from 'store/types';\nimport * as Version from 'constants/version';\nimport {  useState } from 'react';\nimport { ToastManager } from 'global/ToastManager';\nimport { Type } from 'components/ui/toasts/Toast';\nimport { TextManager } from 'global/TextManager';\nimport Button from 'components/ui/buttons/Button';\nimport { decryptSavedGame, saveGame } from 'utils/game';\nimport GameStats from 'components/ui/game/GameStats';\nimport LoadingSpinner from 'components/ui/loading/LoadingSpinner';\nimport { loadGame } from 'store/actions/game';\nimport { convertIntToSemVer } from 'utils/version';\nimport './styles/saveAndLoad.scss';\n\n\ntype AllProps = WindowProps;\nconst SaveAndLoad = (props: AllProps & AppContextProps) => {\n  const storeState = useSelector<StoreState, StoreState>(state => state);\n  const [loadedStore, setLoadedStore] = useState<StoreState>();\n  const [loading, setLoading] = useState(false);\n  const dispatch = useDispatch();\n\n  const handleClickSave = () => {\n    saveGame(storeState);\n  };\n\n  const handleClickLoad = async () => {\n    if (!loadedStore) return;\n\n    // If we're loading a game made with an older version, inform the user\n    const gameVersion = loadedStore.game?.version;\n    if (gameVersion < Version.asInt && loadedStore.game?.ignoreVersionDiff !== Version.asInt) {\n      if (!window.confirm(`This game was initialized with version ${convertIntToSemVer(gameVersion)} which is older than the current client (${Version.default}). This might cause problems. Continue anyway? \\n\\n `)) {\n        return;\n      }\n      loadedStore.game.ignoreVersionDiff = Version.asInt;\n    }\n\n    setLoading(true);\n    setLoadedStore(undefined);\n\n    dispatch(loadGame(loadedStore));\n    ToastManager.addToast(TextManager.get('ui-game-loaded'), Type.game, '/img/items/misc/magic-eye.png');\n    props.onCloseWindow();\n\n  };\n\n  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const fileReader = new FileReader();\n    fileReader.onload = () => {\n      const encrypted = fileReader.result as string;\n      const state =  decryptSavedGame(encrypted);\n\n      setLoadedStore(state);\n    };\n    if (e.target.files){\n      fileReader.readAsText(e.target.files[0]);\n    }\n  };\n\n  return (\n    <div className=\"save-and-load\">\n      <section>\n        Save game to disk:&nbsp;\n        <Button onClick={handleClickSave}>Save</Button>\n      </section>\n      <section>\n        Load game from disk:&nbsp;\n        <input type=\"file\" onChange={handleFileChange} accept=\".json\" />\n        <Button onClick={handleClickLoad} disabled={!loadedStore}>Load</Button>\n      </section>\n      <div>\n        { loading && <LoadingSpinner /> }\n        { loadedStore && <GameStats state={loadedStore} loadGameMode />}\n      </div>\n    </div>\n  );\n};\n\nexport default compose(\n  withWindow,\n  withAppContext,\n)(SaveAndLoad) as React.ComponentType<AllProps>;\n","import { Props as WindowProps } from 'components/ui/window/Window';\nimport { AppContextProps, withAppContext } from 'hoc/withAppContext';\nimport { withWindow } from 'hoc/withWindow';\nimport * as React from 'react';\nimport { compose } from 'redux';\nimport SettingsWindow from './SettingsWindow';\nimport CheatWindow from './CheatWindow';\nimport { useSelector } from 'react-redux';\nimport { StoreState } from 'store/types';\nimport Button from 'components/ui/buttons/Button';\nimport GameStats from 'components/ui/game/GameStats';\nimport SaveAndLoadWindow from './SaveAndLoadWindow';\nimport './styles/menu.scss';\n\n\ntype AllProps = WindowProps;\nconst Menu = (props: AllProps & AppContextProps) => {\n\n  const storeState = useSelector<StoreState, StoreState>(state => state);\n\n  const handleClickCheats = () => {\n    const window = <CheatWindow title=\"Cheats\" />;\n    props.onOpenWindow(window);\n  };\n\n  const handleClickSettings = () => {\n    const window = <SettingsWindow title=\"Settings\" />;\n    props.onOpenWindow(window);\n  };\n\n  const handleClickSaveAndLoad = () => {\n    const window = <SaveAndLoadWindow title=\"Save and Load\" />;\n    props.onOpenWindow(window);\n  };\n\n  return (\n    <div className=\"menu\">\n      <p>\n        <Button onClick={handleClickSaveAndLoad}>Save and load</Button>\n      </p>\n      <p>\n        <Button onClick={handleClickCheats}>Cheats!</Button>\n      </p>\n      <p>\n        <Button onClick={handleClickSettings}>Settings</Button>\n      </p>\n      <div>\n        <GameStats state={storeState} />\n      </div>\n    </div>\n  );\n};\n\nexport default compose(\n  withWindow,\n  withAppContext,\n)(Menu) as React.ComponentType<AllProps>;\n","import { resourceOrder } from 'constants/resources';\nimport resourceDescriptions, { Resource } from 'definitions/resources';\nimport * as React from 'react';\nimport { ResourceStoreState } from 'store/types/resources';\nimport { formatNumber } from 'utils/format/number';\nimport { TooltipManager } from 'global/TooltipManager';\nimport { ContextType } from 'constants/context';\nimport useGoldState from 'hooks/store/useGoldState';\nimport { useMaxResourcesState, useResourcesState } from 'hooks/store/resources';\nimport { useWorkersFreeState } from 'hooks/store/useWorkersState';\nimport Icon from 'components/ui/common/Icon';\nimport './styles/resourcebar.scss';\n\nexport interface StateProps  {\n  gold: number;\n  workers: number;  // total\n  workersFree: number;\n  resources: ResourceStoreState;\n}\n\n/** Shown on top in the UI */\nconst Resourcebar = () => {\n\n  const goldState = useGoldState();\n  const storeResources = useResourcesState();\n  const workersFree = useWorkersFreeState();\n  const maxResources = useMaxResourcesState();\n\n  const createItem = (icon: string, amount: number, type: Resource | 'workers' | 'gold') => {\n    const full = type !== 'workers' && type !== 'gold' && (amount ?? 0) >= (maxResources?.[type] ?? 0);\n\n    const handleClick = (event: React.MouseEvent) => {\n\n      const origin = (event.currentTarget as HTMLElement);\n      const originRect = origin.getBoundingClientRect();\n      TooltipManager.showContextTooltip(ContextType.resource, type, originRect);\n      event.stopPropagation();\n    };\n\n    return (\n      <li key={type} onClick={handleClick}>\n        <Icon\n          image={icon}\n          size=\"smallest\"\n        />\n        <div className={`amount ${full ? 'full' : ''}`}>\n          { formatNumber(amount, 0) }\n        </div>\n      </li>\n    );\n  };\n\n  const resources = resourceOrder.map((resource) => {\n    const resourceDescription = resourceDescriptions[resource];\n    return createItem(resourceDescription.iconImg, storeResources[resource] ?? 0, resource);\n  });\n\n  resources.push(\n    createItem('/img/resources/worker.png', workersFree, 'workers'),\n    createItem('/img/resources/gold.png', goldState, 'gold'),\n  );\n\n  return (\n    <ul className=\"resourcebar\">\n      { resources }\n    </ul>\n  );\n};\nexport default Resourcebar;\n","import Menu from 'components/ui/window/windows/MenuWindow';\nimport * as React from 'react';\nimport Resourcebar from './Resourcebar';\nimport { useContext } from 'react';\nimport { AppContext } from 'components/App';\nimport './styles/topbar.scss';\n\nconst Topbar = () => {\n  const context = useContext(AppContext);\n\n  const handleClick = (_e: React.MouseEvent<HTMLDivElement, MouseEvent>) => {\n    const window = <Menu title = \"Menu\" />;\n    context?.onOpenWindow(window);\n  };\n\n  return (\n    <div className=\"topbar\">\n      <div className=\"topbar-left\">\n        <Resourcebar />\n      </div>\n      <div className=\"topbar-right\">\n        <div className=\"hamburger\" onClick={handleClick}>☰</div>\n      </div>\n    </div>\n  );\n};\nexport default Topbar;\n","import { Graphics, Point } from 'pixi.js';\nimport { PixiComponent } from '@inlet/react-pixi';\n\ninterface Props {\n  width: number;\n  height: number;\n  gridWidth: number;\n}\n\nconst gridColor = 0xfff; // grey\nconst dotColor = 0x5203fc;  // purple\n\n// For debugging. Displays a grid\nconst MapGrid = PixiComponent('Rectangle', {\n  create: (_props: Props) => new Graphics(),\n  applyProps: (instance: Graphics, _oldProps, props) => {\n    const { width, height, gridWidth } = props;\n\n    instance.clear();\n    instance.lineStyle(1, gridColor, 0.5);\n    for (let y = 0; y < height; y++) {\n      instance.moveTo(0, y * gridWidth);\n      instance.lineTo(width, y * gridWidth);\n    }\n\n    for (let x = 0; x < width; x++) {\n      instance.moveTo(x * gridWidth, 0);\n      instance.lineTo(x * gridWidth, height);\n    }\n    instance.endFill();\n\n    // Store props to access them in didMount\n    // todo: figure out a nicer way to access props in didmount\n    Object.assign(instance, {\n      gridWidth,\n      worldWidth: width,\n      worldHeight: height,\n    });\n  },\n\n  didMount: (instance: Graphics, parent) => {\n\n    const point = new Graphics();\n    point.beginFill(dotColor);\n    point.drawCircle(0, 0, 3);\n    point.endFill();\n    point.x = -999; // offscreen\n    instance.addChild(point);\n\n    const { gridWidth/*, worldWidth, worldHeight*/ } = instance as unknown as { gridWidth: number };\n    parent.addListener('clicked', (event: { world: Point }) => {\n      const nearestX = Math.round(event.world.x / gridWidth) * gridWidth;\n      const nearestY = Math.round(event.world.y / gridWidth) * gridWidth;\n\n      // Move the purple dot\n      point.x = nearestX;\n      point.y = nearestY;\n    });\n\n    // Node locations work on a centered coordinate system\n    // const toNodeLocation = (x: number, y: number) => {\n    //   return {\n    //     x: (x - Math.floor(worldWidth / 2)) / gridWidth,\n    //     y: (y - Math.floor(worldHeight / 2)) / gridWidth,\n    //   };\n    // };\n  },\n});\n\n\n\nexport default MapGrid;\n","import React, { useRef, useEffect } from 'react';\nimport { Sprite } from '@inlet/react-pixi';\nimport * as PIXI from 'pixi.js';\nimport { QuestStoreState } from 'store/types/quest';\nimport { AdventurerStoreState } from 'store/types/adventurer';\nimport { Point } from 'pixi.js';\n\ninterface Props {\n  quest: QuestStoreState;\n  position: Point;\n  selected?: boolean;\n  encounterActive?: boolean;\n  onClick?: (quest: QuestStoreState) => void;\n  leader: AdventurerStoreState;\n}\nconst CIRCLE_DIAMETER = 256; // = avatar size / 2\n\nconst QuestMarker = (props: Props) => {\n  const { quest, leader, encounterActive, position, onClick, selected } = props;\n  const image = selected ? '/img/world/map-marker-selected.png' : '/img/world/map-marker.png';\n\n  const avatar = useRef<PIXI.Sprite>(null);\n  // Mask has to be a child of the avatar in order to move with it\n  useEffect(() => {\n    const sprite = avatar.current as PIXI.Sprite;\n\n    const maskGraphics = new PIXI.Graphics();\n    maskGraphics.beginFill(0xBADA55);\n    maskGraphics.drawCircle(0, 0, CIRCLE_DIAMETER * 1);\n    maskGraphics.endFill();\n\n    sprite.mask = maskGraphics;\n    sprite.addChild(maskGraphics);\n  }, [avatar]);\n\n  return (\n    <Sprite\n      image={`${process.env.PUBLIC_URL}${image}`}\n      name={quest.name}\n      x={position.x}\n      y={position.y}\n      interactive={true}\n      buttonMode={true}\n      scale={new Point(0.1, 0.1)}\n      anchor={new Point(0.5, 1)}\n      pointerdown={() => {\n        if (onClick) {\n          onClick(quest);\n        }\n      }}\n    >\n      { leader && (\n      <Sprite\n        image={`${process.env.PUBLIC_URL}${leader.avatarImg}`}\n        name=\"avatar\"\n        anchor={new Point(0.5, 0.5)}\n        x={0}\n        y={-396}\n        scale={new Point(0.66, 0.66)}\n        ref={avatar}\n      />)}\n      {encounterActive && (\n      <Sprite\n        image={`${process.env.PUBLIC_URL}/img/world/quest-alert.png`}\n        name=\"quest-alert\"\n        anchor={new Point(0.5, 1)}\n        x={180}\n        y={-396}\n        scale={new Point(2, 2)}\n      />\n      )}\n    </Sprite>\n  );\n};\n\nexport default QuestMarker;\n","import React from 'react';\nimport { Graphics } from '@inlet/react-pixi';\nimport { Point } from 'pixi.js';\n\ninterface Props {\n  positions: Point[];\n}\n\nconst QuestLine = (props: Props) => {\n  const { positions } = props;\n  if (props.positions.length > 2) {\n    return <Graphics\n      name=\"questline\"\n      x={0}\n      y={0}\n      draw={graphics => {\n        graphics.lineStyle(3, 0xFF3300);\n        graphics.moveTo(positions[0].x, positions[0].y);\n\n        let i = 0;\n        for (i = 1; i < positions.length - 2; i ++) {\n          const xc = (positions[i].x + positions[i + 1].x) / 2;\n          const yc = (positions[i].y + positions[i + 1].y) / 2;\n          graphics.quadraticCurveTo(positions[i].x, positions[i].y, xc, yc);\n        }\n        graphics.quadraticCurveTo(positions[i].x, positions[i].y, positions[i + 1].x, positions[i + 1].y);\n        graphics.endFill();\n      }}\n    />;\n  }\n  return null;\n};\n\nexport default QuestLine;\n","import { useDispatch } from 'react-redux';\n// import MapGrid from './MapGrid';\nimport { useQuest } from 'hooks/store/quests';\nimport { setCombat } from 'store/actions/quests';\nimport { Allegiance } from 'store/types/scene';\n\n// temporary\nexport const DebugToggleCombat = ({ questName }: { questName: string }) => {\n  const quest = useQuest(questName);\n  const dispatch = useDispatch();\n\n  if (quest.scene?.combat && quest.scene.turn !== undefined) {\n    return (\n      <button onClick={() => dispatch(setCombat(questName, false))}>\n        combat: on ({Allegiance[quest.scene.turn]})\n      </button>\n    );\n  }\n  return (\n    <button onClick={() => dispatch(setCombat(questName, true))}>\n      combat: off\n    </button>\n  );\n};\n","import { QuestStoreState } from 'store/types/quest';\nimport { Coords, lerpLocation } from 'utils/pixiJs';\nimport { getDefinition } from 'definitions/quests';\nimport { Point } from 'pixi.js';\n\nconst GRID_WIDTH = 10;    // width or height of each node location in pixels\nexport const FULL_HEIGHT = 1024;\nexport const SMALL_HEIGHT = 64;   // Used when QuestPanel is open\nexport const WORLD_WIDTH = 1500;\nexport const WORLD_HEIGHT = 1061;\n\nexport const getQuestWorldLocation = (quest: QuestStoreState): Coords => {\n  const questDefinition = getDefinition(quest.name);\n  const roundedProgress = Math.floor(quest.progress);\n  const lastNode = questDefinition.nodes[roundedProgress];\n\n  const nextNode = questDefinition.nodes[roundedProgress + 1];\n  if (!nextNode) {\n    // We've reached the last node\n    return lastNode;\n  }\n  return lerpLocation(lastNode, nextNode, quest.progress - roundedProgress);\n};\n\n// Node locations work on a centered coordinate system\nexport const nodeLocationToPoint = (location: { x: number; y: number; }) => {\n  const x = location.x * GRID_WIDTH + WORLD_WIDTH / 2;\n  const y = location.y * GRID_WIDTH + WORLD_HEIGHT / 2;\n  return new Point(x, y);\n};\n\nexport const getPreviousPositions = (quest: QuestStoreState) => {\n  const positions: Point[] = [];\n  const questDefinition = getDefinition(quest.name);\n\n  for (let i = 0; i < quest.progress; i++) {\n    positions.push(nodeLocationToPoint(questDefinition.nodes[i]));\n  }\n  const lastPosition = nodeLocationToPoint(getQuestWorldLocation(quest));\n  positions.push(lastPosition);\n  return positions;\n};\n","import { useEffect, useRef, useCallback, useState, RefObject } from 'react';\nimport { Stage, Sprite } from '@inlet/react-pixi';\nimport { Viewport as PixiViewport } from 'pixi-viewport';\nimport { useSelector } from 'react-redux';\nimport { QuestStoreState } from 'store/types/quest';\nimport { QuestDefinition, QuestNodeType, QuestNode } from 'definitions/quests/types';\nimport Viewport from '../../pixi/Viewport';\nimport MapGrid from './MapGrid';\nimport QuestMarker from './QuestMarker';\nimport { AdventurerStoreState } from 'store/types/adventurer';\nimport QuestLine from './QuestLine';\nimport { MAX_WIDTH as WIDTH } from 'components/App';\nimport { getDefinition } from 'definitions/quests';\nimport { TextManager } from 'global/TextManager';\nimport { getQuestLeader } from 'store/helpers/storeHelpers';\nimport { StoreState } from 'store/types';\nimport { useActiveQuests } from 'hooks/store/quests';\nimport { useNavigate } from 'react-router-dom';\nimport { getWorldLink } from 'utils/routing';\nimport { DebugToggleCombat } from './DebugToggleCombat';\nimport { FULL_HEIGHT, SMALL_HEIGHT, nodeLocationToPoint, getPreviousPositions, getQuestWorldLocation, WORLD_WIDTH, WORLD_HEIGHT } from './utils';\nimport { IApplicationOptions } from 'pixi.js';\nimport './styles/worldMap.scss';\n\nconst GRID_WIDTH = 100;\nexport interface Props {\n  selectedQuestName?: string;\n  smallMap: boolean;\n  onPartyClick: (questName: string) => void;\n  retrieveWorldViewRef: () => RefObject<HTMLDivElement>;\n}\n\nconst WorldMap = (props: Props) => {\n  const { retrieveWorldViewRef, smallMap } = props;\n  const questSelector = useCallback(\n    (state: StoreState) => state.quests.find((q) => q.name === props.selectedQuestName),\n    [props.selectedQuestName],\n  );\n\n  const selectedQuest = useSelector<StoreState, QuestStoreState | undefined>(questSelector);\n  const adventurers = useSelector<StoreState, AdventurerStoreState[]>((store) => store.adventurers);\n  const activeQuests = useActiveQuests();\n  const navigate = useNavigate();\n  const viewportRef = useRef<PixiViewport>(null);\n\n  const handlePartyClick = (name: string) => {\n    props.onPartyClick(name);\n  };\n\n  const handleClose = () => {\n    navigate(getWorldLink());\n  };\n\n  // useEffect(() => {\n  //   const onScroll = (e: WheelEvent) => {\n  //     // When the map is big, scrolling the mouse is just used for zoom, not for actual scrolling\n  //     if (!smallMap) {\n  //       e.preventDefault();\n  //     }\n  //   }\n  //   window.addEventListener(\"wheel\", onScroll, {passive: false} );\n  //   return () => {\n  //     window.removeEventListener(\"wheel\", onScroll);\n  //   };\n  // }, [smallMap]);\n\n\n  const [canvasWidth, setCanvasWidth] = useState(WIDTH);\n  const [canvasHeight, setCanvasHeight] = useState(FULL_HEIGHT);\n\n  // puts the given party in the center of the map\n  const focusOnQuestingParty = (quest: QuestStoreState) => {\n    const viewport = viewportRef.current;\n    if (viewport) {\n      const partyLocation = getQuestWorldLocation(quest);\n      const point = nodeLocationToPoint(partyLocation);\n      viewport.moveCenter(point.x, point.y);\n    }\n  };\n\n  useEffect(() => {\n    // This will set the dimensions of the canvas tot that of the parent (worldview)\n    const resize = () => {\n      const worldView = retrieveWorldViewRef();\n      const worldViewWidth = worldView.current?.clientWidth || WIDTH;\n      const worldViewHeight = worldView.current?.clientHeight || FULL_HEIGHT;\n\n      setCanvasWidth(worldViewWidth);\n      if (smallMap) {\n        if (worldViewWidth < 576) {\n          // Small screens\n          setCanvasHeight(SMALL_HEIGHT / 2);\n        } else {\n          setCanvasHeight(SMALL_HEIGHT);\n        }\n      } else {\n        setCanvasHeight(worldViewHeight);\n      }\n\n      const viewport = viewportRef.current;\n      if (viewport) {\n        viewport.resize(canvasWidth, canvasHeight);\n      }\n    };\n    resize();\n    window.addEventListener('resize', resize);\n    return () => {\n      window.removeEventListener('resize', resize);\n    };\n  }, [canvasHeight, canvasWidth, retrieveWorldViewRef, smallMap]);\n\n  useEffect(() => {\n    if (selectedQuest) {\n      focusOnQuestingParty(selectedQuest);\n    } else {\n      const viewport = viewportRef.current;\n      const point = nodeLocationToPoint({ x: 0, y: 0 });\n      viewport?.moveCenter(point.x, point.y);\n    }\n  }, [selectedQuest, canvasHeight]);\n\n  useEffect(() => {\n    // focus on center of the map\n    if (viewportRef.current) {\n      const viewport = viewportRef.current;\n      const point = nodeLocationToPoint({ x: 0, y: 0 });\n      viewport.moveCenter(point.x / 2, point.y / 2 + 10);\n    }\n  }, [canvasWidth]);\n\n  const renderQuestlines = () => {\n    return activeQuests.map((quest) => {\n      const previousPositions = getPreviousPositions(quest);\n      return (\n        <QuestLine positions={previousPositions} key={quest.name} />\n      );\n    });\n  };\n\n  const renderMarkers = () => {\n    return activeQuests.map((quest) => {\n      const location = getQuestWorldLocation(quest);\n      const currentPosition = nodeLocationToPoint(location);\n      const leader = getQuestLeader(adventurers, quest) ?? adventurers[0];\n      const questDefinition: QuestDefinition = getDefinition(quest.name);\n      const progress: number = Math.floor(quest.progress);\n      const questNode: QuestNode = questDefinition.nodes[progress];\n\n      return (\n        <QuestMarker\n          quest={quest}\n          leader={leader}\n          position={currentPosition}\n          key={quest.name}\n          selected={quest === selectedQuest}\n          encounterActive={questNode.type === QuestNodeType.encounter}\n          onClick={(q) => handlePartyClick(q.name)}\n        />\n      );\n    });\n  };\n\n  const handleMapClick = () => {\n    /// todo: close map\n    // if(smallMap === true && selectedQuest) {\n    //   props.onPartyClick(selectedQuest.name);\n    // }\n  };\n\n  const options: IApplicationOptions = {\n    backgroundColor: 0xa09b92,\n    autoDensity: true,\n    sharedLoader: true,\n    width: canvasWidth,\n    height: canvasHeight,\n  };\n\n  return (\n    <div className=\"world-map\">\n      <Stage width={canvasWidth} height={canvasHeight} options={options}>\n        <Viewport screenWidth={canvasWidth} screenHeight={canvasHeight} worldWidth={WORLD_WIDTH} worldHeight={WORLD_HEIGHT} ref={viewportRef} >\n          <Sprite\n            image={`${process.env.PUBLIC_URL}/img/world/map-default.png`}\n            interactive={true}\n            pointerdown={handleMapClick}\n          >\n            {renderQuestlines()}\n            {renderMarkers()}\n          </Sprite>\n          <MapGrid width={WORLD_WIDTH} height={WORLD_HEIGHT} gridWidth={GRID_WIDTH} />\n        </Viewport>\n      </Stage>\n      {props.selectedQuestName && (\n        <div className=\"title\">\n          <span>\n            <DebugToggleCombat questName={props.selectedQuestName} />\n            {TextManager.getQuestTitle(props.selectedQuestName)}\n            {' | '}\n            {selectedQuest?.sceneName ? TextManager.getQuestSceneTitle(selectedQuest) : '...'}\n          </span>\n          <span onClick={handleClose} className=\"close\">x</span>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default WorldMap;\n\n","import { PixiComponent } from '@inlet/react-pixi';\nimport * as PIXI  from 'pixi.js';\nimport { TiledLayerData, TiledTilesetData } from 'constants/tiledMapData';\nimport { findTileset } from 'utils/tilemap';\nimport { CompositeRectTileLayer } from '@pixi/tilemap';\n\n\ninterface Props  {\n  horizontalTiles: number;\n  layer: TiledLayerData;\n  tilesets: TiledTilesetData[];\n  spritesheets: { [key: string]: PIXI.Spritesheet }\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst RectTileLayer = PixiComponent<Props, any>('RectTileLayer', {\n  create(_props: Props) {\n    const tileLayer = new CompositeRectTileLayer();\n    return tileLayer;\n  },\n\n  applyProps(instance, oldProps: Props, props: Props) {\n    const { layer, tilesets, horizontalTiles, spritesheets } = props;\n    if (!layer.data) {\n      return;\n    }\n    for (let i = 0; i < layer.data.length; i++) {\n      const tileset = findTileset(layer.data[i], tilesets);\n      if (!tileset) continue;\n\n      const w = tileset.tilewidth;\n      const h = tileset.tileheight;\n      const x = (i % horizontalTiles) * w;\n      const y = Math.floor(i / horizontalTiles) * h;\n      const spritesheet = spritesheets[tileset.name];\n\n      if (layer.data[i] > 0) {\n        const spriteId = `${tileset.name}-${layer.data[i]}`;\n        if (!spritesheet.textures[spriteId]) {\n          continue;\n        }\n        instance.addFrame(spritesheet.textures[spriteId], x, y);\n      }\n    }\n  },\n});\n\nexport default RectTileLayer;\n\n\n","import { PixiComponent } from '@inlet/react-pixi';\nimport * as PIXI from 'pixi.js';\nimport { TiledTilesetData } from 'constants/tiledMapData';\nimport { SceneObject } from 'store/types/scene';\nimport { findTileset } from 'utils/tilemap';\nimport { CompositeRectTileLayer } from '@pixi/tilemap';\n\ninterface Props  {\n  objects: SceneObject[];\n  tilesets: TiledTilesetData[];\n  spritesheets: { [key: string]: PIXI.Spritesheet }\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any \nconst ObjectTileLayer = PixiComponent<Props, any>('ObjectTileLayer', {\n  create(_props: Props) {\n    const tileLayer = new CompositeRectTileLayer();\n    return tileLayer;\n  },\n\n  applyProps(instance, _oldProps: Props, props: Props) {\n    const { objects, tilesets, spritesheets } = props;\n    if (!objects.length) {\n      return;\n    }\n    instance.clear();\n    if (!objects) return;\n\n    objects.forEach((object) => {\n      if (!object.gid) return; // todo!\n      const tileset = findTileset(object.gid, tilesets);\n      if (!tileset) return;\n\n      const x = object.x;\n      const y = object.y - tileset.tileheight;\n      const spritesheet = spritesheets[tileset.name];\n\n      // todo: add sprites!\n      const spriteId = `${tileset.name}-${object.gid}`;\n      instance.addFrame(spritesheet.textures[spriteId], x, y);\n    \n    });\n  },\n});\n\nexport default ObjectTileLayer;\n\n","import { PixiComponent, applyDefaultProps, AnimatedSprite } from '@inlet/react-pixi';\nimport * as PIXI from 'pixi.js';\n\nconst scaleChanged = (oldScale: [number, number], newScale: [number, number]) => {\n  if (!oldScale || !newScale) return true;\n  return oldScale[0] != newScale[0] || oldScale[1] != newScale[1];\n};\n\nconst SpriteAnimated = PixiComponent<React.ComponentProps<typeof AnimatedSprite>, PIXI.AnimatedSprite>('SpriteAnimated', {\n  create: ({ textures, name }) => {\n    if (!textures?.[0]) {\n      console.warn(`Something went wrong with ${name}`);\n    }\n    const animatedSprite = new PIXI.AnimatedSprite(textures || [], true);\n    return animatedSprite;\n  },\n  applyProps: (instance, oldProps, newProps) => {\n    if (oldProps.textures !== newProps.textures\n      || scaleChanged(oldProps.scale as [number, number], newProps.scale as [number, number])) {\n      applyDefaultProps(instance, oldProps, newProps);\n      instance.gotoAndPlay(0);\n    }\n\n    // gotoAndStop\n  },\n});\n\nexport default SpriteAnimated;\n\n","import { deductActorAp, enqueueSceneAction, modifyEnemyHealth, startTurn } from 'store/actions/quests';\nimport { AnyAction } from 'redux';\nimport { Location } from 'utils/tilemap';\nimport { ActorObject, Allegiance, EnemyObject, getUniqueName, isAdventurer, SceneAction, SceneActionType } from 'store/types/scene';\nimport { locationEquals } from 'utils/tilemap';\nimport { BaseSceneController, movementDuration } from './BaseSceneController';\nimport { Channel, MixMode, SoundManager } from 'global/SoundManager';\nimport { getDefinition as getWeaponDefinition } from 'definitions/items/weapons';\nimport { AP_COST_MELEE, AP_COST_SHOOT, calculateDodge, rollBodyPart, rollToDodge, rollToHit } from 'mechanics/combat';\nimport { EquipmentSlotType } from 'components/ui/adventurer/EquipmentSlot';\nimport { TextEntry } from 'constants/text';\nimport { roll3D6 } from 'utils/random';\nimport { changeEquipmentQuantity, modifyHealth } from 'store/actions/adventurers';\nimport { ActionIntent } from 'components/world/QuestPanel/QuestDetails/scene/ui/SceneUI';\nimport {  getDefinition, isApparel } from 'definitions/items/apparel';\nimport { TextManager } from 'global/TextManager';\nimport { DamageType, WeaponType } from 'definitions/weaponTypes/types';\n\n\nexport class CombatController {\n  static sceneController: BaseSceneController<unknown>;\n\n  protected static unsubscriber: () => void;\n\n  static initialize(sceneController: BaseSceneController<unknown>) {\n    this.sceneController = sceneController;\n\n    const storeChange = this.handleStoreChange.bind(this);\n    this.unsubscriber = sceneController.store.subscribe(storeChange);\n    // const selectQuest = createSelector(\n    //   [getQuests],\n    //   (quests: QuestStoreState[]) => { return quests.find(q => q.name === sceneController.questName) }\n    // )\n  }\n\n  static destroy() {\n    this.unsubscriber?.();\n  }\n\n  static handleStoreChange() {\n    if (!this.sceneController) return;\n    // const questState = this.getQuestStoreState()\n    const adventurers = this.sceneController.sceneAdventurers;\n    const enemies = this.sceneController.sceneEnemies;\n    const quest = this.sceneController.quest;\n    if (adventurers && enemies && quest && quest.scene && !quest.scene.actionQueue?.length){\n      const totalAdventurerAp = adventurers.reduce((acc, value) => acc + value.ap, 0);\n      const { scene } = quest;\n      const { turn } = scene;\n\n      // No AP for the player left, switch to enemy turn\n      if (totalAdventurerAp === 0 && turn === Allegiance.player) {\n\n        this.dispatch(startTurn(quest.name, Allegiance.enemy));\n        return;\n      }\n\n\n      if (turn === Allegiance.enemy && scene.actionQueue?.length === 0) {\n        const totalEnemiesAp = enemies.reduce((acc, value) => acc + value.ap, 0);\n\n        if (totalEnemiesAp === 0) {\n          // No more AP left for the enemy, player turn\n          this.dispatch(startTurn(quest.name, Allegiance.player, this.sceneController.getAdventurers()));\n          return;\n        }\n\n        const enemy = this.findEnemyWithAp();\n        if (enemy && enemy.location) {\n          const target = this.findNearestActor(enemy.location, Allegiance.player);\n          if (!target || !target.location) return; // no target? did everyone die?\n          const path = this.sceneController.findPath(enemy.location, target.location);\n          const intent = this.sceneController.createActionIntent(SceneActionType.move, enemy, target.location);\n          if (!intent || intent.action !== SceneActionType.move) return;\n\n          path?.forEach((l, index) => {\n            if (index >= enemy.ap - 1) return;\n            const sceneAction: SceneAction = {\n              endsAt: movementDuration * (index + 1) + performance.now(),\n              intent,\n            };\n            this.dispatch(enqueueSceneAction(quest.name, sceneAction));\n          });\n        }\n      }\n    }\n  }\n\n  // Call when actor melee animation starts\n  public static actorMeleeStart(actorId: string, intent: ActionIntent) {\n    if (!this.sceneController) return;\n\n    SoundManager.playSound('scene/swish', Channel.scene, false, MixMode.singleInstance);\n    const actor = this.sceneController.getSceneActor(actorId);\n    if (!actor) throw new Error('No actor found');\n    const weapon = this.getActorMainhandItem(actor);\n    if (!weapon) throw new Error('No weapon found');\n    const definition = getWeaponDefinition(weapon.type);\n\n    switch (definition.weaponType) {\n      case WeaponType.knife: {\n        SoundManager.playSound('scene/daggerSwish', Channel.scene, false, MixMode.singleInstance);\n        break;\n      }\n      default: {\n        SoundManager.playSound('scene/swish', Channel.scene, false, MixMode.singleInstance);\n        break;\n      }\n    }\n  }\n\n  public static actorMeleeEnd(actorId: string, intent: ActionIntent) {\n    const location = intent.to;\n    const ap = AP_COST_MELEE;\n    this.dispatch(deductActorAp(this.questName, actorId, ap));\n    const actor = this.sceneController.getSceneActor(actorId);\n    if (!actor) throw new Error('No actor found');\n    if (intent.action !== SceneActionType.melee) throw new Error('Wrong action type');\n    const { weapon } = intent.weaponWithAbility;\n    if (!weapon) throw new Error('No weapon found');\n    const definition = getWeaponDefinition(weapon.type);\n    const skills = this.sceneController.getActorSkills(actor);\n    const roll = roll3D6();\n\n    // Roll to hit\n    if (roll <= (skills[definition.weaponType] ?? 0)) {\n\n      const target = this.sceneController.getObjectAtLocation(location) as ActorObject;\n      const targetAttributes = this.sceneController.getActorAttributes(target);\n      const dodge = calculateDodge(targetAttributes);\n\n      this.sceneController.bubbleAtLocation('HIT', location);\n      this.sceneController.effectAtLocation('blood_1/blood_1.json', location);\n\n    } else {\n      this.sceneController.bubbleAtLocation('MISS', location);\n\n      if (this.settings.verboseCombatLog) {\n        this.log({ key: 'scene-combat-attack-slash-missed-verbose', context: {\n          attacker: getUniqueName(actor),\n          weapon,\n          ap,\n          roll,\n          weaponType: definition.weaponType,\n          skill: skills[definition.weaponType],\n        } });\n      } else {\n        this.log({ key: 'scene-combat-attack-slash-missed', context: {\n          attacker: getUniqueName(actor),\n          weapon,\n        } });\n      }\n    }\n    // todo: see if slash misses\n    // todo: process the hit, take away any HP?\n  }\n\n  public static actorShootStart(actorId: string, intent: ActionIntent) {\n    const actor = this.sceneController.getSceneActor(actorId);\n    if (!actor) throw new Error('No actor found');\n    if (intent.action !== SceneActionType.shoot) throw new Error('Wrong action type');\n    const { weapon } = intent.weaponWithAbility;\n    if (!weapon) throw new Error('No weapon found');\n    const definition = getWeaponDefinition(weapon.type);\n\n    switch (definition.weaponType) {\n      case WeaponType.bow: {\n        SoundManager.playSound('scene/bow', Channel.scene, false, MixMode.singleInstance);\n        break;\n      }\n      case WeaponType.crossbow: {\n        SoundManager.playSound('scene/crossbow', Channel.scene, false, MixMode.singleInstance);\n        break;\n      }\n    }\n\n    const { ammo } = intent;\n    if (ammo && isAdventurer(actor)) {\n      let quantity = (ammo.quantity || 1);\n      this.dispatch(changeEquipmentQuantity(actorId, EquipmentSlotType.offHand, --quantity));\n    }\n  }\n\n  public static actorShootEnd(actorId: string, intent: ActionIntent) {\n    const ap = AP_COST_SHOOT;\n    const location = intent.to;\n    // Take away AP for shooting\n    this.dispatch(deductActorAp(this.questName, actorId, ap));\n    const actor = this.sceneController.getSceneActor(actorId);\n    if (!actor) throw new Error('No actor found');\n    if (intent.action !== SceneActionType.shoot) throw new Error('Wrong action type');\n    const { weapon } = intent.weaponWithAbility;\n    if (!weapon) throw new Error('No weapon found');\n    const weaponDefinition = getWeaponDefinition(weapon.type);\n    const skills = this.sceneController.getActorSkills(actor);\n    const target = this.sceneController.getObjectAtLocation(intent.to) as ActorObject;\n\n    if (rollToHit(skills[weaponDefinition.weaponType])) {\n\n      const targetAttributes = this.sceneController.getActorAttributes(target);\n      if (rollToDodge(targetAttributes)){\n        // Dodged!\n        this.log({\n          key: 'scene-combat-attack-shoot-dodged',\n          context: {\n            attacker: getUniqueName(actor),\n            weapon,\n            target: getUniqueName(target),\n          },\n        });\n      } else {\n        // Hit!\n        // todo: calculate damage types?\n        const rawDamage = weaponDefinition.damage?.[DamageType.kinetic] ?? 0;\n        const bodyPart = rollBodyPart();\n        const armor = this.getArmor(target, bodyPart);\n        const damage = rawDamage - armor;\n        const absorbed = rawDamage - damage;\n        this.takeDamage(target, damage);\n\n\n        this.sceneController.bubbleAtLocation('HIT', location);\n        this.sceneController.effectAtLocation('blood_2/blood_2.json', location);\n\n        this.log({\n          key: 'scene-combat-attack-shoot-hit',\n          context: {\n            attacker: getUniqueName(actor),\n            weapon,\n            bodyPart: TextManager.getEquipmentSlot(bodyPart),\n            target: getUniqueName(target),\n            damage,\n            absorbed,\n          },\n        });\n      }\n\n\n    } else {\n      this.log({\n        key: this.settings.verboseCombatLog ? 'scene-combat-attack-shoot-missed-verbose' : 'scene-combat-attack-shoot-missed',\n        context: {\n          attacker: getUniqueName(actor),\n          weapon,\n          ap,\n          roll: rollToHit,\n          weaponType: weaponDefinition.weaponType,\n          skill: skills[weaponDefinition.weaponType],\n        },\n      });\n    }\n    // todo: process the hit, take away any HP?\n  }\n\n  static getQuestStoreState() {\n    return this.sceneController?.store.getState().quests.find(q => q.name === this.sceneController?.questName);\n  }\n\n  /** Finds the actor nearest to `from`, but not ON from */\n  static findNearestActor(from: Location, allegiance?: Allegiance) {\n    if (!this.sceneController) return undefined;\n    const actors = this.sceneController.sceneActors;\n    let distance = Number.MAX_VALUE;\n    let actor: ActorObject | undefined;\n    actors?.forEach(a => {\n      if (!a.location || !this.sceneController || locationEquals(a.location, from)) return;\n      const steps = this.sceneController.findPath(from, a.location)?.length;\n      if (steps !== undefined && steps < distance) {\n        if (allegiance === undefined || a.allegiance === allegiance) {\n          distance = steps;\n          actor = a;\n        }\n      }\n    });\n    return actor;\n  }\n\n  /** Find next enemy with ap */\n  static findEnemyWithAp() {\n    if (!this.sceneController) return undefined;\n    const actors = this.sceneController.sceneActors;\n    return actors?.find(a => a.allegiance === Allegiance.enemy && a.ap > 0) as EnemyObject;\n  }\n\n  protected static get questName() {\n    return this.sceneController.questName;\n  }\n\n  protected static getActorMainhandItem(actor: ActorObject) {\n    if (isAdventurer(actor)) {\n      const adventurer = this.sceneController.getAdventurerByActor(actor);\n      if (!adventurer) throw new Error('No adventurer found');\n      return adventurer.equipment[EquipmentSlotType.mainHand];\n    }\n    const enemy = this.sceneController.getEnemyByActor(actor);\n    return enemy.mainHand;\n  }\n\n  protected static getArmor(actor: ActorObject, bodyPart: EquipmentSlotType) {\n    if (isAdventurer(actor)) {\n      const adventurer = this.sceneController.getAdventurerByActor(actor);\n      if (!adventurer) throw new Error('No adventurer found');\n      const equipment = adventurer.equipment[bodyPart]?.type;\n      if (!equipment || !isApparel(equipment)) return 0;\n      return getDefinition(equipment).damageReduction ?? 0;\n    }\n    const enemy = this.sceneController.getEnemyByActor(actor);\n    return enemy.armor[bodyPart] ?? 0;\n  }\n\n  protected static takeDamage(actor: ActorObject, damage: number) {\n    if (isAdventurer(actor)) {\n      this.dispatch(modifyHealth(actor.adventurerId, -damage));\n    } else {\n      this.dispatch(modifyEnemyHealth(this.questName, actor.enemyId, -damage));\n    }\n  }\n\n  // protected static getActorOffhandItem(actor: ActorObject) {\n  //   if (isAdventurer(actor)) {\n  //     const adventurer = this.sceneController.getAdventurerByActor(actor);\n  //     if (!adventurer) throw new Error('No adventurer found');\n  //     return adventurer.equipment[EquipmentSlotType.offHand];\n  //   }\n  //   const enemy = this.sceneController.getEnemyByActor(actor);\n  //   return enemy.offHand;\n  // }\n\n  static dispatch(action: AnyAction) {\n    this.sceneController?.store.dispatch(action);\n  }\n\n  protected static log(input: string | TextEntry): void {\n    this.sceneController.log(input);\n  }\n\n  public static get settings() {\n    return this.sceneController.settings;\n  }\n}\n","import { RefObject, useCallback, useEffect, useRef, useState } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { Container } from 'pixi.js';\nimport { gsap } from 'gsap';\nimport { useQuest } from 'hooks/store/quests';\nimport { BaseSceneController } from 'mechanics/scenes/BaseSceneController';\nimport { CombatController } from 'mechanics/scenes/CombatController';\nimport { completeSceneAction } from 'store/actions/quests';\nimport { StoreState } from 'store/types';\nimport { getUniqueName, SceneAction, SceneActionType } from 'store/types/scene';\nimport { Location } from 'utils/tilemap';\nimport { Orientation } from '.';\n\nexport const allAnimations = ['stand', 'attack', 'walk', 'die'] as const;\nexport type Animation = typeof allAnimations[number];\n\nconst useAnimation = (\n  controller: BaseSceneController<unknown>,\n  actorRef: RefObject<Container>,\n  actorName: string,\n  location: Location,\n  health: number,\n  setOrientation: (o: Orientation) => void,\n) => {\n  const { tileWidth, tileHeight } = controller.getTileDimensions();\n  const previousAction = useRef<SceneAction>();\n  const timeout = useRef<NodeJS.Timeout>();\n  const dispatch = useDispatch();\n  const quest = useQuest(controller.questName);\n\n  const actionSelector = useCallback(() => {\n    if (!quest.scene?.actionQueue) {\n      return undefined;\n    }\n    return quest.scene.actionQueue.filter(a => (getUniqueName(a.intent.actor) === actorName))[0];\n  }, [quest.scene?.actionQueue, actorName]);\n\n  const nextAction = useSelector<StoreState, SceneAction | undefined>(actionSelector);\n  const [animation, setAnimation] = useState<Animation>('stand');\n  const animationTimeline = useRef<gsap.core.Timeline>();\n\n  useEffect(() => {\n    if (health <= 0) {\n      setAnimation('die');\n    }\n  }, [health]);\n\n  // Handle actions\n  useEffect(() => {\n    // Determines orientation based on where the target is\n    const determineOrientation = (currentLocation: Location, target: Location) => {\n      if (currentLocation[0] === target[0] && currentLocation[1] > target[1]) {\n        setOrientation(Orientation.north);\n      } else if (currentLocation[0] < target[0] && currentLocation[1] > target[1]) {\n        setOrientation(Orientation.northEast);\n      } else if (currentLocation[0] < target[0] && currentLocation[1] === target[1]) {\n        setOrientation(Orientation.east);\n      } else if (currentLocation[0] < target[0] && currentLocation[1] < target[1]) {\n        setOrientation(Orientation.southEast);\n      } else if (currentLocation[0] === target[0] && currentLocation[1] < target[1]) {\n        setOrientation(Orientation.south);\n      } else if (currentLocation[0] > target[0] && currentLocation[1] < target[1]) {\n        setOrientation(Orientation.southWest);\n      } else if (currentLocation[0] > target[0] && currentLocation[1] === target[1]) {\n        setOrientation(Orientation.west);\n      } else if (currentLocation[0] > target[0] && currentLocation[1] > target[1]) {\n        setOrientation(Orientation.northWest);\n      }\n    };\n\n    // Initiates move animation\n    const moveActor = (path: Location[], duration: number, delay?: number, onComplete?: () => void) => {\n      if (duration < 0) {\n        onComplete?.();\n      }\n\n      gsap.killTweensOf(actorRef.current);\n      animationTimeline.current = gsap.timeline({\n        delay: delay,\n        onComplete: onComplete,\n      });\n      path.forEach((l, index) => {\n        // Queue up all the steps\n        animationTimeline.current?.to(actorRef.current, {\n          duration: duration / (path.length ?? 1),\n          ease: 'linear',\n          pixi: {\n            x: l[0] * tileWidth,\n            y: l[1] * tileHeight,\n          },\n          onStart: () => {\n            // determine orientation\n            const currentLocation = path[index - 1] ?? location;\n            determineOrientation(currentLocation, l);\n            setAnimation('walk');\n          },\n        });\n      });\n    };\n\n    if (nextAction && nextAction !== previousAction.current) {\n      const { intent } = nextAction;\n      // console.log(`next action is ${nextAction.intent.to} (${nextAction.actionType}), \\ncurrent location is: ${location}\\nprev action was ${previousAction?.current?.target} `)\n      switch (nextAction.intent.action) {\n        case SceneActionType.move: {\n          const moveComplete = () => {\n            setAnimation('stand');\n            dispatch(completeSceneAction(quest.name, actorName));\n            controller.actorMoved(actorName, nextAction.intent.to);\n          };\n\n          const duration = (nextAction.endsAt - performance.now()) / 1000;\n          moveActor(nextAction.intent.path ?? [], duration, nextAction.delay, moveComplete);\n          break;\n        }\n        case SceneActionType.melee: {\n          const moveComplete = () => {\n            determineOrientation(location, nextAction.intent.to);\n            setAnimation('attack');\n            CombatController.actorMeleeStart(actorName, intent);\n\n            const attackComplete = () => {\n              setAnimation('stand');\n              dispatch(completeSceneAction(controller.questName, actorName));\n              CombatController.actorMeleeEnd(actorName, intent);\n            };\n            setTimeout(attackComplete, 500);\n          };\n\n          const duration = (nextAction.endsAt - performance.now()) / 1000;\n          moveActor(nextAction.intent.path ?? [], duration, nextAction.delay, moveComplete);\n          break;\n        }\n        case SceneActionType.shoot: {\n          determineOrientation(location, nextAction.intent.to);\n          setAnimation('attack');\n          CombatController.actorShootStart(actorName, intent);\n\n          const attackComplete = () => {\n            setAnimation('stand');\n            dispatch(completeSceneAction(controller.questName, actorName));\n            CombatController.actorShootEnd(actorName, intent);\n          };\n          setTimeout(attackComplete, 500);\n          break;\n        }\n        case SceneActionType.interact: {\n          const moveComplete = () => {\n            setAnimation('stand');\n            controller.actorInteract(actorName, nextAction.intent.to);\n            dispatch(completeSceneAction(controller.questName, actorName));\n          };\n\n          const duration = (nextAction.endsAt - performance.now()) / 1000;\n          moveActor(nextAction.intent.path ?? [], duration, nextAction.delay, moveComplete);\n\n          break;\n        }\n      }\n      previousAction.current = nextAction;\n    }\n  }, [actorName, actorRef, controller, dispatch, location, nextAction, quest.name, setOrientation, tileHeight, tileWidth]);\n\n  useEffect(() => {\n    if (timeout.current) {\n      clearTimeout(timeout.current);\n    }\n  }, [animation]);\n\n  useEffect(() => {\n    return () => {\n      animationTimeline.current?.kill();\n    };\n  }, []);\n\n  return animation;\n};\n\nexport default useAnimation;\n","import { useMemo } from 'react';\nimport { Loader, Texture } from 'pixi.js';\nimport { Orientation } from '.';\nimport { Animation } from './useAnimation';\n\n// returns the frames used by the current animation\nconst useFrames = (spritesheetPath: string, animation: Animation, orientation: Orientation) => {\n  const indexedFrames = useMemo(() => {\n    if (!spritesheetPath) return;\n\n    if (!Loader.shared.resources[spritesheetPath]?.textures){\n      throw new Error(`No textures for ${spritesheetPath}`);\n    }\n    const allFrames = Object.keys(Loader.shared.resources[spritesheetPath].textures ?? {});\n    return allFrames.reduce((acc: { [key: string]: Texture[] }, frame: string) => {\n      // frames are in the format of: 'stand-n', 'walk0-ne', 'walk1-ne' etc\n      // create a mapping with arrays keyed by the part without the number,\n      // eg: 'stand-n': [TEXTURE:stand-n] and 'walk-ne': [TEXTURE:walk0-ne, TEXTURE:walk1-ne]\n      const key = frame.replace(/[0-9]/g, '');\n      if (!acc[key]) {\n        acc[key] = [];\n      }\n      const texture = Loader.shared.resources[spritesheetPath].textures?.[frame];\n      if (texture) acc[key].push(texture);\n      return acc;\n    }, {});\n  }, [spritesheetPath]);\n\n  return useMemo(() => {\n    if (!indexedFrames) return;\n    const spritesheet = Loader.shared.resources[spritesheetPath];\n\n    const getFrames = () => {\n      // Prefix all animations with the name of the image (without the extension) and a hyphen\n      // So `orc-axe-walk0-n`, `skeleton-attack1-e`\n      const prefix = `${spritesheet.data.meta.image.substring(0, spritesheet.data.meta.image.lastIndexOf('.'))}-`;\n      switch (orientation) {\n        case Orientation.northWest:\n          return `${prefix}${animation}-${Orientation.northEast}`;\n        case Orientation.west:\n          return `${prefix}${animation}-${Orientation.east}`;\n        case Orientation.southWest:\n          return `${prefix}${animation}-${Orientation.southEast}`;\n        default:\n          return `${prefix}${animation}-${orientation}`;\n      }\n    };\n    return indexedFrames[getFrames()];\n  }, [animation, indexedFrames, orientation, spritesheetPath]);\n};\n\nexport default useFrames;\n","import { useMemo,  useEffect, useRef, PropsWithChildren, useState, ComponentProps, useCallback } from 'react';\nimport { Location } from 'utils/tilemap';\nimport { Container, Graphics } from '@inlet/react-pixi';\nimport { Filter, Graphics as PixiGraphics, Container as PixiContainer } from 'pixi.js';\nimport { ActorObject, getUniqueName } from 'store/types/scene';\nimport { BaseSceneController } from 'mechanics/scenes/BaseSceneController';\nimport SpriteAnimated from 'components/pixi/tile/SpriteAnimated';\nimport { AdventurerColor } from 'store/types/adventurer';\nimport { useRandomOrientation } from './useRandomOrientation';\nimport { BLACK, BLUES, calculateBearing, createColorReplaceFilter, ORANGE, Orientation, PURPLE, REDS, SPRITE_WIDTH, TEALS, WHITE, YELLOW } from './utils';\nimport useAnimation from './useAnimation';\nimport useFrames from './useFrames';\nimport { useQuest } from 'hooks/store/quests';\n\nconst spritesheetBasePath = `${process.env.PUBLIC_URL}/img/scene/actors/`;\n\nexport interface Props  {\n  actor: ActorObject;\n  health: number;\n  spritesheetPath: string;\n  color?: AdventurerColor;\n  controller: BaseSceneController<unknown>;\n  selectionColor?: number;\n  location?: Location; // tile coordinate space\n  lookAt?: Location;\n  idleAnimation?: boolean;  // Only when lookAt is undefined, will randomly turn around\n}\n\n// This is a wrapper that exposes a location property. Will set x and y on children\nconst SceneActor = (props: PropsWithChildren<Props> & ComponentProps<typeof Container>) => {\n  const {\n    location = [0, 0],\n    controller,\n    health,\n    idleAnimation,\n    color,\n    selectionColor,\n    children,\n    spritesheetPath,\n    lookAt,\n    actor,\n    ...rest\n  } = props;\n\n  const { tileWidth, tileHeight } = controller.getTileDimensions();\n\n  const { x, y } = useMemo(() => {\n    // console.log('prev', prevLocation, 'location', location);\n    return {\n      x: location[0] * tileWidth,\n      y: location[1] * tileHeight,\n    };\n  }, [location, tileWidth, tileHeight]);\n\n  const actorRef = useRef<PixiContainer>(null);\n\n  const [orientation, setOrientation] = useState<Orientation>(Orientation.north);\n  const animation = useAnimation(controller, actorRef, getUniqueName(actor), location, health, setOrientation);\n  const quest = useQuest(props.controller.questName);\n  const combat = quest.scene?.combat;\n  useRandomOrientation(!!idleAnimation && !lookAt && health > 0 && !combat, orientation, setOrientation);\n\n  const frames = useFrames(`${spritesheetBasePath}${spritesheetPath}`, animation, orientation);\n  const [flipped, setFlipped] = useState(false);\n\n  const drawCircle = useCallback((graphics: PixiGraphics) => {\n    const line = 3;\n    graphics.lineStyle(line, selectionColor);\n    graphics.drawCircle(tileWidth / 2, tileHeight / 2, tileWidth / 2 - line);\n    graphics.endFill();\n  }, [selectionColor, tileHeight, tileWidth]);\n\n  useEffect(() => {\n    if (lookAt !== undefined) {\n      const bearing = calculateBearing(location, lookAt);\n      setOrientation(bearing);\n    }\n  }, [location, lookAt]);\n\n  useEffect(() => {\n    setFlipped(orientation === Orientation.southWest || orientation === Orientation.west || orientation === Orientation.northWest);\n  }, [orientation]);\n\n  const scale = useMemo(() => {\n    return [(flipped ? -1 : 1), 1] as [number, number];\n  }, [flipped]);\n\n  const filters = useMemo<Filter[]>(() => {\n    switch (color) {\n      case AdventurerColor.black:\n        return [createColorReplaceFilter(BLUES, BLACK)];\n      case AdventurerColor.orange:\n        return [createColorReplaceFilter(BLUES, ORANGE)];\n      case AdventurerColor.purple:\n        return [createColorReplaceFilter(BLUES, PURPLE)];\n      case AdventurerColor.red:\n        return [createColorReplaceFilter(BLUES, REDS)];\n      case AdventurerColor.teal:\n        return [createColorReplaceFilter(BLUES, TEALS)];\n      case AdventurerColor.white:\n        return [createColorReplaceFilter(BLUES, WHITE)];\n      case AdventurerColor.yellow:\n        return [createColorReplaceFilter(BLUES, YELLOW)];\n      default:\n        return [];\n    }\n  }, [color]);\n\n  return (\n    <Container x={x} y={y} ref={actorRef} {...rest}>\n      {selectionColor !== undefined && (\n        <Graphics\n          name=\"selectioncircle-back\"\n          draw={drawCircle}\n        />\n      )}\n      { spritesheetPath && frames && (\n        <SpriteAnimated\n          animationSpeed={0.1}\n          name={`${actor.id}-sprite`}\n          isPlaying={true}\n          textures={frames}\n          x={SPRITE_WIDTH / 4}\n          y={20}\n          scale={scale}\n          anchor={[.5, .5]}\n          pivot={[0, 0]}\n          filters={filters}\n        />\n      )}\n      {children}\n      {/* {combat && (\n        <ActorStats tileWidth={tileWidth} actor={actor} />\n      )} */}\n      {selectionColor !== undefined && (\n        <Graphics\n          name=\"selectioncircle-front\"\n          alpha={0.25}\n          draw={drawCircle}\n        />\n      )}\n    </Container>\n  );\n};\n\nexport default SceneActor;\n","import { useEffect } from 'react';\nimport { Orientation } from './utils';\n\nexport const useRandomOrientation = (enabled: boolean, orientation: Orientation, setOrientation: React.Dispatch<React.SetStateAction<Orientation>>) => {\n  useEffect(() => {\n    if (!enabled) return;\n\n    // Idle animation\n    // Randomly turn left or right\n    const randomOrientation = () => {\n      const left = Math.random() < .5;\n      if (orientation === Orientation.north && left) {\n        setOrientation(Orientation.northWest);\n      } else if (orientation === Orientation.northWest && left) {\n        setOrientation(Orientation.west);\n      } else if (orientation === Orientation.west && left) {\n        setOrientation(Orientation.southWest);\n      } else if (orientation === Orientation.southWest && left) {\n        setOrientation(Orientation.south);\n      } else if (orientation === Orientation.south && left) {\n        setOrientation(Orientation.southEast);\n      } else if (orientation === Orientation.southEast && left) {\n        setOrientation(Orientation.east);\n      } else if (orientation === Orientation.east && left) {\n        setOrientation(Orientation.northEast);\n      } else if (orientation === Orientation.northEast && left) {\n        setOrientation(Orientation.north);\n      }\n      if (orientation === Orientation.north && !left) {\n        setOrientation(Orientation.northEast);\n      } else if (orientation === Orientation.northEast && !left) {\n        setOrientation(Orientation.east);\n      } else if (orientation === Orientation.east && !left) {\n        setOrientation(Orientation.southEast);\n      } else if (orientation === Orientation.southEast && !left) {\n        setOrientation(Orientation.south);\n      } else if (orientation === Orientation.south && !left) {\n        setOrientation(Orientation.southWest);\n      } else if (orientation === Orientation.southWest && !left) {\n        setOrientation(Orientation.west);\n      } else if (orientation === Orientation.west && !left) {\n        setOrientation(Orientation.northWest);\n      } else if (orientation === Orientation.northWest && !left) {\n        setOrientation(Orientation.north);\n      }\n    };\n    const minDuration = 2000;\n    const maxDuration = 4000;\n    const duration = minDuration + Math.random() * maxDuration;\n    const interval = setInterval(randomOrientation, duration);\n    return () => clearInterval(interval);\n  }, [enabled, orientation, setOrientation]);\n};\n","import { Container } from '@inlet/react-pixi';\nimport { useRef } from 'react';\nimport { AdventurerObject } from 'store/types/scene';\nimport SceneActor, { Props as SceneActorProps } from './SceneActor';\nimport { Container as PixiContainer } from 'pixi.js';\nimport { useAdventurer } from 'hooks/store/adventurers';\n\ninterface Props  {\n  actor: AdventurerObject;\n  selected: boolean;\n}\n\n// The adventurers avatar on the scene\nconst SceneAdventurer = (props: Props & Omit<SceneActorProps, 'children' | 'name' | 'health'>) => {\n  const {\n    controller,\n    location,\n    actor,\n    selected,\n    spritesheetPath,\n  } = props;\n\n  const ref = useRef<PixiContainer>(null);\n  const adventurer = useAdventurer(actor.adventurerId);\n  const { health } = adventurer;\n\n  return (\n    <Container ref={ref} zIndex={health}>\n      <SceneActor\n        actor={actor}\n        health={adventurer.health}\n        controller={controller}\n        spritesheetPath={spritesheetPath}\n        location={location}\n        selectionColor={selected ? 0xffffff : undefined }\n        idleAnimation={Math.random() < 0.5}\n      />\n    </Container>\n  );\n};\n\nexport default SceneAdventurer;\n","import { Container } from '@inlet/react-pixi';\nimport { EnemyObject } from 'store/types/scene';\nimport SceneActor, { Props as SceneActorProps } from './SceneActor';\n\ninterface Props  {\n  actor: EnemyObject;\n  selected: boolean;\n}\n\n// The enemy on the scene\nconst SceneEnemy = (props: Props & Omit<SceneActorProps, 'children' | 'name' | 'health'>) => {\n  const {\n    controller,\n    location,\n    actor,\n    selected,\n    spritesheetPath,\n  } = props;\n  const { health } = actor;\n\n  return (\n    <Container zIndex={health}>\n      <SceneActor\n        actor={actor}\n        health={actor.health}\n        controller={controller}\n        spritesheetPath={spritesheetPath}\n        selectionColor={selected ? 0x8b0000 : undefined }\n        location={location}\n      />\n    </Container>\n  );\n};\n\nexport default SceneEnemy;\n","import { Container } from '@inlet/react-pixi';\nimport { Container as PixiContainer } from 'pixi.js';\nimport { isAdventurer, isEnemy, SceneObject } from 'store/types/scene';\nimport SceneAdventurer from '../SceneAdventurer';\nimport { BaseSceneController } from 'mechanics/scenes/BaseSceneController';\nimport { TiledObjectType } from 'utils/tilemap';\nimport SceneEnemy from '../SceneEnemy';\nimport { useRef } from 'react';\n\ninterface Props {\n  objects: SceneObject[];\n  controller: BaseSceneController<unknown>;\n  selectedActorId: string;\n}\n\nconst ObjectSpriteLayer = (props: Props) => {\n  const { objects, controller } = props;\n  const ref = useRef<PixiContainer>(null);\n\n  return (\n    <Container sortableChildren ref={ref}>\n      {objects.map((object) => {\n        const { location } = object;\n        const { adventurerId, spritesheet } = object.properties as { [key: string]: string };\n        switch (object.type) {\n          case TiledObjectType.actor: {\n            if (isAdventurer(object)) {\n              return (\n                <SceneAdventurer\n                  location={location}\n                  controller={controller}\n                  actor={object}\n                  key={adventurerId}\n                  spritesheetPath={spritesheet}\n                  selected={props.selectedActorId === object.adventurerId }\n                />\n              );\n            } else if (isEnemy(object)) {\n              return (\n                <SceneEnemy\n                  actor={object}\n                  controller={controller}\n                  spritesheetPath={spritesheet}\n                  location={location}\n                  key={object.enemyId}\n                  idleAnimation={Math.random() < 0.5}\n                  lookAt={[4, 3]}\n                  selected={props.selectedActorId === object.enemyId }\n                />\n              );\n            }\n            break;\n          }\n          default:\n            return null;\n        }\n        return null;\n      })}\n    </Container>\n  );\n};\n\nexport default ObjectSpriteLayer;\n","import { Container } from '@inlet/react-pixi';\nimport { BaseSceneController, EVENT_SCENE_EFFECT } from 'mechanics/scenes/BaseSceneController';\nimport { useEffect, useRef } from 'react';\nimport { AnimatedSprite, Container as PixiContainer, Point, Loader } from 'pixi.js';\n\n// eslint-disable-next-line @typescript-eslint/no-empty-interface\ninterface Props {\n  controller: BaseSceneController<unknown>;\n}\n\n\nconst SceneEffectLayer = (props: Props) => {\n  const { controller } = props;\n\n  const ref = useRef<PixiContainer>(null);\n  useEffect(() => {\n    const addEffect = (path: string, point: Point) => {\n      const resource = Loader.shared.resources[path];\n      const sheet = resource?.spritesheet;\n      if (sheet?.animations) {\n        const animatedSprite = new AnimatedSprite(sheet.animations.play);\n        animatedSprite.x = point.x;\n        animatedSprite.y = point.y;\n        animatedSprite.animationSpeed = resource.data.meta.speed;\n        animatedSprite.loop = false;\n        animatedSprite.onComplete = () => {\n          animatedSprite.destroy();\n        };\n        animatedSprite.gotoAndPlay(0);\n        ref.current?.addChild(animatedSprite);\n      }\n    };\n    controller?.addListener(EVENT_SCENE_EFFECT, addEffect);\n    return () => {\n      controller.removeListener(EVENT_SCENE_EFFECT, addEffect);\n    };\n\n  }, [controller]);\n\n  return (\n    <Container name=\"SceneEffectLayer\" ref={ref}>\n\n    </Container>\n  );\n};\n\nexport default SceneEffectLayer;\n","import { Fragment, PropsWithChildren } from 'react';\nimport { TiledMapData, TiledLayerType } from 'constants/tiledMapData';\nimport { Container } from '@inlet/react-pixi';\nimport RectTileLayer from 'components/pixi/tile/RectTileLayer';\nimport * as PIXI from 'pixi.js';\nimport ObjectTileLayer from 'components/pixi/tile/ObjectTileLayer';\nimport { SceneObject } from 'store/types/scene';\nimport ObjectSpriteLayer from './ObjectSpriteLayer';\nimport { BaseSceneController } from 'mechanics/scenes/BaseSceneController';\nimport { Props as SceneProps } from '../Scene';\nimport { getLayerObjects } from './utils';\nimport SceneEffectLayer from './SceneEffectLayer';\n\ninterface Props extends SceneProps {\n  basePath: string;\n  data: TiledMapData;\n  spritesheets: { [key: string]: PIXI.Spritesheet }\n  objects: SceneObject[];\n  controller: BaseSceneController<unknown>;\n  selectedActorId: string;\n}\n\nconst Tilemap = (props: PropsWithChildren<Props>) => {\n  const { data, objects, controller, spritesheets, selectedActorId } = props;\n\n  return (\n    <Container >\n      {data.layers\n        .filter(l => l.visible)\n        .map(layer => {\n          if (layer.type === TiledLayerType.objectgroup) {\n            const { tileObjects, spriteObjects } = getLayerObjects(objects, layer);\n            return (\n              <Fragment key={layer.name}>\n                { !!tileObjects.length && (\n                  <ObjectTileLayer\n                    objects={tileObjects}\n                    tilesets={data.tilesets || []}\n                    spritesheets={spritesheets}\n                  />\n                )}\n                { !!spriteObjects.length && (\n                  <ObjectSpriteLayer\n                    key={layer.name}\n                    objects={spriteObjects || []}\n                    controller={controller}\n                    selectedActorId={selectedActorId}\n                  />\n                )}\n              </Fragment>\n            );\n          }\n          if (layer.type === TiledLayerType.tilelayer) {\n            return (\n              <RectTileLayer\n                key={layer.name}\n                layer={layer}\n                horizontalTiles={data.width}\n                tilesets={data.tilesets}\n                spritesheets={spritesheets}\n              />\n            );\n          }\n          return null;\n        })\n      }\n      <SceneEffectLayer controller={controller} />\n    </Container>\n  );\n};\n\nexport default Tilemap;\n\n","import { TiledLayerData } from 'constants/tiledMapData';\nimport { SceneObject } from 'store/types/scene';\n\nexport const getLayerObjects = (objects: SceneObject[], layer: TiledLayerData) => {\n  return objects.reduce<{ tileObjects: SceneObject[], spriteObjects: SceneObject[] }>((acc, value) => {\n    if (value.layerId === layer.id) {\n      if (value.gid !== undefined) {\n        acc.tileObjects.push(value);\n      } else if (value.properties.isSprite === true) {\n        acc.spriteObjects.push(value);\n      }\n    }\n    return acc;\n  }, { tileObjects: [], spriteObjects: [] });\n};\n","import { useState, useEffect } from 'react';\nimport { loadResource } from 'utils/pixiJs';\nimport { TiledTilesetData } from 'constants/tiledMapData';\nimport { SpritesheetData, SpriteData } from 'constants/spritesheetData';\nimport { Spritesheet } from 'pixi.js';\n\n// Returns a TiledTilesetData that has not been loaded into tilesetsTextures yet\nconst nextTilesetToload = (tilesets: TiledTilesetData[], tilesetsTextures: { [key: string]: Spritesheet }) => {\n  return tilesets.find((t) => {\n    return !tilesetsTextures[t.name];\n  });\n};\n\n\nconst parseSpritesheetData = (tileset: TiledTilesetData): SpritesheetData => {\n  const columns = tileset.columns;\n\n  const frames: { [name: string]: SpriteData } = {};\n  for (let i = 0; i < tileset.tilecount; i++) {\n    const w = tileset.tilewidth;\n    const h = tileset.tileheight;\n    const x = (i % columns) * w;\n    const y = Math.floor(i / columns) * h;\n\n    frames[`${tileset.name}-${i + tileset.firstgid}`] = {\n      frame: { x, y, w, h },\n      spriteSourceSize: { x, y, w, h },\n      rotated: false,\n      trimmed: false,\n      sourceSize: { w, h },\n    };\n  }\n  const image = tileset.image;\n  const size = { w: tileset.imagewidth, h: tileset.imageheight };\n  return {\n    frames,\n    meta: {\n      image,\n      size,\n      scale: '1',\n    },\n  };\n};\n\nconst useTilesetsLoader = (basePath: string) => {\n  const [tileSpritesheets, setTilesets] = useState<{ [key: string]: Spritesheet }>({});\n  const [data, setData] = useState<TiledTilesetData[]>();\n\n  const loadTilesets = (value: TiledTilesetData[]) => {\n    setData(value);\n  };\n\n  useEffect(() => {\n    if (!data) return;\n    const nextTileset = nextTilesetToload(data, tileSpritesheets);\n    if (!nextTileset) return;\n\n    const tilesetName = nextTileset.name;\n    const image = nextTileset.image.substring(nextTileset.image.indexOf('/'));\n    loadResource(`${basePath}/${image}`, (resource) => {\n      if (!resource) return;\n      if (resource.error) {\n        throw new Error(`Loading ${basePath}/${image}\\n${resource.error}`);\n      }\n\n      const spritesheetData = parseSpritesheetData(nextTileset);\n      if (!resource.texture) throw new Error(`No texure found ${basePath}/${image}`);\n      const spritesheet = new Spritesheet(resource.texture, spritesheetData);\n\n      spritesheet.parse(() => {\n        const newTilesets = {\n          ...tileSpritesheets,\n          [tilesetName]: spritesheet,\n        };\n        setTilesets(newTilesets);\n      });\n    });\n  }, [data, basePath, tileSpritesheets]);\n\n  const loadComplete = !!data && nextTilesetToload(data, tileSpritesheets) === undefined;\n\n  return {\n    loadComplete,\n    loadTilesets,\n    tileSpritesheets,\n  };\n};\n\nexport default useTilesetsLoader;\n","import { useEffect, useRef } from 'react';\nimport { BubbleLayer, BubbleManager, BubbleType, EVENT_BUBBLE_ADDED } from 'global/BubbleManager';\nimport { Point } from 'pixi.js';\nimport './styles/bubbles.scss';\n\ntype Props = {\n  layer: BubbleLayer\n};\n\n// Bubbles can be added by calling BubbleManager.addBubble\n// BubbleManager will inform whenever the something is added\n// The bubbles themselves will fade out via css transition\nconst Bubbles = (props: Props) => {\n  const ref = useRef<HTMLDivElement>(null);\n  const timeouts = useRef<NodeJS.Timeout[]>([]);\n\n  useEffect(() => {\n    const bubbleAdded = (text: string, point: Point, type?: BubbleType, layer?: BubbleLayer) => {\n      if (layer === props.layer){\n        const bubble = document.createElement('div');\n        bubble.innerHTML = `${text}`;\n        bubble.className = `bubble${type !== undefined && ` type-${BubbleType[type]}`}`;\n        bubble.style.left = `${point.x}px`;\n        bubble.style.top = `${point.y}px`;\n        ref.current?.appendChild(bubble);\n\n        const timeout = setTimeout(() => {\n          timeouts.current = timeouts.current.filter((t: NodeJS.Timeout) => t !== timeout);\n          ref.current?.removeChild(bubble);\n        }, 2000);\n        // Keep track of running timeouts in case this component gets unmounted\n        timeouts.current.push(timeout);\n      }\n    };\n\n    BubbleManager.instance.addListener(EVENT_BUBBLE_ADDED, bubbleAdded);\n    return () => {\n      BubbleManager.instance.removeListener(EVENT_BUBBLE_ADDED, bubbleAdded);\n    };\n  }, [props.layer]);\n\n  useEffect(() => {\n    return () => {\n      timeouts.current.forEach(t => clearTimeout(t));\n    };\n  }, []);\n\n  return (\n    <div className=\"bubbles\" ref={ref} />\n  );\n};\n\nexport default Bubbles;\n","import { useCallback, useEffect, useRef } from 'react';\n\n// Will resize ref based on a 'canvas' tag thats next to the ref\n// Returns the scale level (1 = full scale, 0.5 half scale)\nconst useCanvasScaler = (ref: React.RefObject<HTMLDivElement>, sceneWidth: number, sceneHeight: number) => {\n  const scale = useRef(1);\n\n  const handleResize = useCallback(() => {\n    if (!ref.current) return 1;\n    const canvas = ref.current.parentNode?.querySelector('canvas');\n    if (!canvas) throw Error(`No canvas found as sibling of ${ref.current}`);\n\n    const currentWidth = canvas?.clientWidth;\n    scale.current = currentWidth / sceneWidth;\n    ref.current.style.transform = `scale(${scale.current})`;\n    ref.current.style.width = `${sceneWidth}px`;\n    ref.current.style.height = `${sceneHeight}px`;\n    return scale.current;\n\n  }, [ref, sceneHeight, sceneWidth]);\n\n  useEffect(() => {\n    // Scale the html element together with the sibling canvas\n    window.addEventListener('resize', handleResize);\n    handleResize();\n    return () => {\n      window.removeEventListener('resize', handleResize);\n    };\n  }, [handleResize, ref, sceneHeight, sceneWidth]);\n\n  return { scale: scale.current, recalculate: handleResize };\n};\n\nexport default useCanvasScaler;\n","import { Location } from 'utils/tilemap';\nimport { SceneControllerContext } from 'components/world/QuestPanel/context/SceneControllerContext';\nimport { useContext } from 'react';\nimport { SceneActionType } from 'store/types/scene';\nimport './styles/normalUICursor.scss';\n\ninterface Props {\n  location: Location;\n}\n\n\nconst images = {\n  [SceneActionType.move]: `url(${process.env.PUBLIC_URL}/img/ui/icons/icons/walking-boot.svg)`,\n  [SceneActionType.interact]: `url(${process.env.PUBLIC_URL}/img/ui/icons/icons/sunken-eye.svg)`,\n};\n\nconst NormalUICursor = (props: Props) => {\n  const { location } = props;\n  const controller = useContext(SceneControllerContext);\n\n  let blocked = controller?.locationIsBlocked(location) ?? false;\n  let action = SceneActionType.move;\n  if (blocked) {\n    // todo: can we have interactive tiles that are NOT blocking?\n    const object = controller?.getObjectAtLocation(location);\n    if (object?.properties.interactive){\n      // We're at an interactive object\n      action = SceneActionType.interact;\n      blocked = false;\n    }\n  }\n  const { tileWidth, tileHeight } = controller?.getTileDimensions() ?? { tileWidth: 64, tileHeight: 64 };\n  const transform = `translate(${tileWidth * location[0]}px, ${tileHeight * location[1]}px)`;\n  const backgroundImage = images[action];\n  const width = tileWidth;\n  const height = tileHeight;\n  return (\n    <div\n      className={`normal-ui-cursor ${blocked ? 'invalid' : ''}`}\n      style={{ transform, backgroundImage, width, height }}\n    />\n  );\n};\n\nexport default NormalUICursor;\n","import { SceneControllerContext } from 'components/world/QuestPanel/context/SceneControllerContext';\nimport { Location } from 'utils/tilemap';\nimport { useContext } from 'react';\nimport { isEnemy } from 'store/types/scene';\nimport { ActionIntent } from '../SceneUI';\nimport './styles/combatUIWidget.scss';\n\ninterface Props {\n  location: Location;\n  selectedActorId: string;\n  intents: ActionIntent[];\n}\n\n// CombatUIWidget shows a circle\nconst CombatUIWidget = (props: Props) => {\n  const { location, intents } = props;\n  const controller = useContext(SceneControllerContext);\n  if (!controller) throw Error('No scene controller');\n  const { tileWidth, tileHeight } = controller.getTileDimensions();\n  const transform = `translate(${tileWidth * location[0]}px, ${tileHeight * location[1]}px)`;\n\n  const onEnemy = !!controller?.getObjectAtLocation(location, isEnemy);\n  const invalid = intents.every(i => !i.isValid);\n\n  const classNames = [\n    'combat-ui-widget',\n    ...(invalid ? ['invalid'] : []),\n    ...(onEnemy ? ['on-enemy'] : []),\n  ];\n\n  return (\n    <div\n      className={classNames.join(' ')}\n      style={{ transform }}\n    >\n    </div>\n  );\n};\n\nexport default CombatUIWidget;\n\n\n","import { Location } from 'utils/tilemap';\nimport { AdventurerStoreState } from 'store/types/adventurer';\nimport { ReactNode, useCallback, useContext, useEffect } from 'react';\nimport { SceneControllerContext } from 'components/world/QuestPanel/context/SceneControllerContext';\nimport { ActionIntent } from '../SceneUI';\nimport { locationEquals } from 'utils/tilemap';\nimport './styles/actionButton.scss';\n\ntype Props = {\n  adventurer: AdventurerStoreState;\n  location: Location;\n  intent: ActionIntent;\n  renderText: (intent: ActionIntent) => ReactNode;\n  onSetActionIntent: (intent?: ActionIntent) => void;\n  onCloseMenu: () => void;\n};\n\nconst ActionButton = (props: Props) => {\n  const {\n    adventurer,\n    location,\n    intent,\n    renderText,\n    onSetActionIntent,\n    onCloseMenu,\n  } = props;\n  const controller = useContext(SceneControllerContext);\n  if (!controller) throw new Error('No controller');\n\n\n  // Released the mouse outside of th\n  const cancelIntent = useCallback(() => {\n    window.removeEventListener('mouseup', cancelIntent);\n    onSetActionIntent?.(undefined);\n  }, [onSetActionIntent]);\n\n  const handleMouseDown = () => {\n    onSetActionIntent?.(intent);\n    window.addEventListener('mouseup', cancelIntent);\n  };\n\n  const handleMouseUp = () => {\n    const selectedActorLocation = controller?.getSceneActor(adventurer.id)?.location;\n    if (selectedActorLocation && location && !locationEquals(selectedActorLocation, location) && intent){\n      controller?.actorAttemptAction(intent);\n      onCloseMenu();\n    }\n\n    onSetActionIntent?.(undefined);\n  };\n\n  useEffect(() => {\n    return () => { window.removeEventListener('mouseup', cancelIntent); };\n  }, [cancelIntent]);\n\n  return (\n    <div\n      className=\"action-button\"\n      onMouseDown={handleMouseDown}\n      onMouseUp={handleMouseUp}\n    >\n      {renderText(intent)}\n    </div>\n  );\n};\n\nexport default ActionButton;\n","import Icon, { IconSize } from 'components/ui/common/Icon';\nimport { getDefinition } from 'definitions/enemies';\nimport { EnemyObject } from 'store/types/scene';\nimport './styles/enemyAvatar.scss';\n\nexport interface Props {\n  actorObject: EnemyObject\n  className?: string;\n  onClick?: (adventurerId: string) => void;\n  size?: IconSize;\n}\n\n/**\n * The EnemyAvatar displays the avatar of an enemy scene object\n */\nconst EnemyAvatar = (props: Props) => {\n  const {\n    actorObject,\n    size,\n  } = props;\n\n  const className = `${(props.className || '')} enemy-avatar`;\n  const definition = getDefinition(actorObject.enemyType);\n\n  const handleClick = () => {\n    if (props.onClick) {\n      props.onClick(actorObject.enemyId);\n    }\n  };\n  return (\n    <Icon\n      className={className}\n      image={definition.avatarImg}\n      size={size}\n      onClick={handleClick}\n    />\n  );\n};\n\nexport default EnemyAvatar;\n","import { ComponentProps } from 'react';\nimport './styles/diamondFrame.scss';\n\ntype Props = ComponentProps<'div'>;\n\nconst DiamondFrame = (props: Props) => {\n  const { children, className = '', ...restProps } = props;\n  return (\n    <div {...restProps} className={`diamond-frame ${className}`}>\n      { children }\n    </div>\n  );\n};\n\nexport default DiamondFrame;","import { RefObject, useEffect, useRef } from 'react';\n\nconst useDraggable = (element: RefObject<HTMLElement>, handle?: RefObject<HTMLElement>) => {\n  const initial = useRef<{ x: number, y: number }>();\n  const offset = useRef<{ x: number, y: number }>({ x: 0, y: 0 });\n  const current = useRef<{ x: number, y: number }>();\n  const active = useRef(false);\n\n  useEffect(() => {\n    const el = element.current;\n    if (!el) return;\n    if (!handle) {\n      // eslint-disable-next-line react-hooks/exhaustive-deps\n      handle = element;\n    }\n\n    const touchStart = (evt: TouchEvent) => {\n      offset.current = {\n        x: el.getBoundingClientRect().left ?? 0,\n        y: el.getBoundingClientRect().top ?? 0,\n      };\n      initial.current = {\n        x: evt.touches[0].clientX - offset.current.x,\n        y: evt.touches[0].clientY - offset.current.y,\n      };\n      if (evt.target === handle?.current) {\n        active.current = true;\n      }\n    };\n\n    const mouseStart = (evt: MouseEvent) => {\n      offset.current = {\n        x: el.getBoundingClientRect().left ?? 0,\n        y: el.getBoundingClientRect().top ?? 0,\n      };\n      initial.current = {\n        x: evt.clientX - offset.current.x,\n        y: evt.clientY - offset.current.y,\n      };\n\n      if (evt.target === handle?.current) {\n        active.current = true;\n      }\n    };\n\n    const setPosition = () => {\n      if (element.current) {\n        element.current.style.left = `${current.current?.x ?? 0}px`;\n        element.current.style.top = `${current.current?.y ?? 0}px`;\n      }\n    };\n\n    const touchMove = (evt: TouchEvent) => {\n      if (active.current) {\n\n        evt.preventDefault();\n        current.current = {\n          x: evt.touches[0].clientX - (initial.current?.x ?? 0),\n          y: evt.touches[0].clientY - (initial.current?.y ?? 0),\n        };\n\n        offset.current = current.current;\n        setPosition();\n      }\n    };\n\n    const mouseMove = (evt: MouseEvent) => {\n      if (active.current) {\n\n        evt.preventDefault();\n        current.current = {\n          x: evt.clientX - (initial.current?.x ?? 0),\n          y: evt.clientY - (initial.current?.y ?? 0),\n        };\n        offset.current = current.current;\n        setPosition();\n      }\n    };\n\n\n    const dragEnd = () => {\n      if (!initial.current) return;\n\n      initial.current = current.current;\n      active.current = false;\n    };\n\n\n    el.addEventListener('touchstart', touchStart, false);\n    document.addEventListener('touchend', dragEnd, false);\n    document.addEventListener('touchmove', touchMove, false);\n\n    el.addEventListener('mousedown', mouseStart, false);\n    document.addEventListener('mouseup', dragEnd, false);\n    document.addEventListener('mousemove', mouseMove, false);\n\n    return () => {\n      el.removeEventListener('touchstart', touchStart, false);\n      document.removeEventListener('touchend', dragEnd, false);\n      document.removeEventListener('touchend', dragEnd, false);\n      document.removeEventListener('touchmove', touchMove, false);\n\n      el.removeEventListener('mousedown', mouseStart, false);\n      document.removeEventListener('mouseup', dragEnd, false);\n      document.removeEventListener('mousemove', mouseMove, false);\n    };\n  }, []);\n};\n\nexport default useDraggable;\n","import { useCallback, useContext, useMemo, useRef } from 'react';\nimport { Location } from 'utils/tilemap';\nimport { AdventurerStoreState } from 'store/types/adventurer';\nimport { useAdventurer } from 'hooks/store/adventurers';\nimport { SceneControllerContext } from 'components/world/QuestPanel/context/SceneControllerContext';\nimport { EnemyObject, isEnemy, SceneActionType } from 'store/types/scene';\nimport { ActionIntent } from '../SceneUI';\nimport ActionButton from './ActionButton';\nimport AdventurerAvatar from 'components/ui/adventurer/AdventurerAvatar';\nimport EnemyAvatar from 'components/ui/enemy/EnemyAvatar';\nimport ItemIcon from 'components/ui/items/ItemIcon';\nimport { IconSize } from 'components/ui/common/Icon';\nimport { WeaponAbility } from 'definitions/abilities/types';\nimport DiamondFrame from './DiamondFrame';\nimport useDraggable from 'hooks/store/useDraggable';\nimport './styles/actionMenu.scss';\n\ntype Props = {\n  adventurerId: string;\n  location: Location;\n  intents: ActionIntent[];\n  onClose: () => void;\n  onSetActionIntent: (intent?: ActionIntent) => void;\n};\n\nconst ActionMenu = (props: Props) => {\n  const { adventurerId, location, intents, onClose, onSetActionIntent } = props;\n  const adventurer: AdventurerStoreState = useAdventurer(adventurerId);\n  const controller = useContext(SceneControllerContext);\n  if (!controller) throw new Error('No controller');\n\n  const ref = useRef<HTMLDivElement>(null);\n  const handle = useRef<HTMLDivElement>(null);\n  useDraggable(ref, handle);\n\n  const enemyTargetted = useMemo(() => {\n    return controller?.getObjectAtLocation(location, isEnemy) as EnemyObject;\n  }, [controller, location]);\n\n\n  const renderButtonText = useCallback((intent: ActionIntent) => {\n    switch (intent.action) {\n      case SceneActionType.move: {\n        return `Move ${intent.apCost} AP`;\n      }\n      case SceneActionType.melee:\n      case SceneActionType.shoot: {\n        if (!intent.weaponWithAbility) {\n          return undefined;\n        }\n        return (\n          <>\n            <ItemIcon\n              size={IconSize.smallest}\n              item={intent.weaponWithAbility.weapon}\n            />\n            {/* {TextManager.getItemName(intent.weaponWithAbility?.weapon)} */}\n                    -\n            {WeaponAbility[intent.weaponWithAbility.ability]}\n            {intent &&\n              JSON.stringify(intent?.apCost)\n            }\n          </>\n        );\n      }\n    }\n  }, []);\n\n  return (\n    <div className=\"action-menu-background\" onClick={onClose}>\n      <div className=\"action-menu\" ref={ref}>\n        <div className=\"background\" ref={handle}>\n          <DiamondFrame className=\"adventurer-frame gold\">\n            <AdventurerAvatar adventurer={adventurer} size={IconSize.big}/>\n          </DiamondFrame>\n          {enemyTargetted?.name && (\n\n            <DiamondFrame className=\"enemy-frame gold\">\n              <EnemyAvatar actorObject={enemyTargetted} size={IconSize.big}/>\n            </DiamondFrame>\n          )}\n        </div>\n        <div className=\"action-button action-button-close\" onClick={onClose}>x close</div>\n\n        <ul className=\"button-list\">\n          {intents.filter(i => i.isValid).map((intent, i) => (\n            <li key={`${intent.action}${i}`}>\n              <ActionButton\n                adventurer={adventurer}\n                location={location}\n                intent={intent}\n                onSetActionIntent={onSetActionIntent}\n                renderText={renderButtonText}\n                onCloseMenu={onClose}\n              />\n            </li>\n          ))}\n          <li>\n              <div className=\"action-button\">sdfsdfs</div>\n          </li>\n          <li>\n              <div className=\"action-button\">sdfsdfs</div>\n          </li>\n        </ul>\n        {/* <div>\n          {enemyTargetted?.name && (\n            <>\n              {TextManager.getEnemyName(enemyTargetted.name)}\n              <EnemyAvatar actorObject={enemyTargetted}/>\n            </>\n          )}\n        </div> */}\n      </div>\n    </div>\n  );\n};\n\nexport default ActionMenu;\n\n","import { WeaponAbility } from './types';\n\nexport type WeaponAbilityDefinition = {\n  passive?: boolean;\n};\n\nconst all = {\n  [WeaponAbility.aimedShot]: {\n\n  },\n  [WeaponAbility.swing]: {\n\n  },\n  [WeaponAbility.block]: {\n    passive: true,\n  },\n  [WeaponAbility.cut]: {\n\n  },\n  [WeaponAbility.cleave]: {\n\n  },\n  [WeaponAbility.shoot]: {\n\n  },\n  [WeaponAbility.slash]: {\n\n  },\n  [WeaponAbility.parry]: {\n    passive: true,\n  },\n  [WeaponAbility.riposte]: {\n    passive: true,\n  },\n};\n\nexport default all;\nexport const getDefinition = (weaponAbility: WeaponAbility): WeaponAbilityDefinition => {\n  return all[weaponAbility];\n};\n\n","import { useContext, useMemo } from 'react';\nimport { Location } from 'utils/tilemap';\nimport { AdventurerStoreState } from 'store/types/adventurer';\nimport { useAdventurer } from 'hooks/store/adventurers';\nimport { SceneControllerContext } from 'components/world/QuestPanel/context/SceneControllerContext';\nimport { adventurerAmmo, adventurerWeapons } from 'store/helpers/storeHelpers';\nimport { getDefinition as getWeaponDefinition } from 'definitions/items/weapons';\nimport { SceneActionType } from 'store/types/scene';\nimport { ActionIntent } from '../SceneUI';\nimport { getDefinition as getWeaponTypeDefinition } from 'definitions/weaponTypes';\nimport { WeaponClassification } from 'definitions/weaponTypes/types';\nimport { getDefinition as getAbilityDefinition } from 'definitions/abilities';\n\nconst useActionIntents = (adventurerId: string, location?: Location ) => {\n  const adventurer: AdventurerStoreState = useAdventurer(adventurerId);\n  const weapons = adventurerWeapons(adventurer);\n  const controller = useContext(SceneControllerContext);\n  if (!controller) throw new Error('No controller');\n\n  // const enemyTargetted = useMemo(() => {\n  //   if (!location) return undefined;\n  //   return controller?.getObjectAtLocation(location, isEnemy);\n  // }, [controller, location]);\n\n\n  const actorObject = controller?.getSceneAdventurer(adventurer.id);\n\n  const weaponIntents = useMemo(() => {\n    if  (!actorObject || !location) return [];\n    const result: ActionIntent[] = [];\n    weapons?.forEach((weapon) => {\n      if (!weapon) return;\n      const definition = getWeaponDefinition(weapon.type);\n      const weaponType = getWeaponTypeDefinition(definition.weaponType);\n      const { classification } = weaponType;\n      weaponType.abilities.forEach((ability) => {\n        const abilityDefinition = getAbilityDefinition(ability);\n        if (abilityDefinition.passive) return;\n        const weaponWithAbility = { weapon, ability };\n\n        // Ranged weapons trigger a 'shoot' action, others a melee\n        const action = classification === WeaponClassification.ranged ? SceneActionType.shoot : SceneActionType.melee;\n        if (action === SceneActionType.melee) {\n          const intent = controller?.createActionIntent(action, actorObject, location, weaponWithAbility);\n          if (intent) { // TODO: and enough AP\n            result.push(intent);\n          }\n        } else {\n          const ammo = adventurerAmmo(adventurer);\n          if (!ammo) throw new Error('no ammo');\n          const intent = controller?.createActionIntent(action, actorObject, location, weaponWithAbility, ammo);\n          if (intent) { // TODO: and enough AP\n            result.push(intent);\n          }\n        }\n      });\n    });\n    return result;\n  }, [actorObject, adventurer, controller, location, weapons]);\n\n  const moveIntent = useMemo(() => {\n    if (!actorObject || !location) return;\n    return controller?.createActionIntent(SceneActionType.move, actorObject, location);\n  }, [actorObject, controller, location]);\n\n  return useMemo(() => {\n    return [\n      ...weaponIntents,\n      ...(moveIntent ? [moveIntent] : []),\n    ];\n  }, [moveIntent, weaponIntents]);\n};\n\nexport default useActionIntents;\n","import CombatUIWidget from './CombatUIWidget';\nimport ActionMenu from './ActionMenu/ActionMenu';\nimport useActionIntents from './hooks/useActionIntents';\nimport { Location } from 'utils/tilemap';\nimport { forwardRef, useCallback, useImperativeHandle, useState } from 'react';\nimport { ActionIntent } from './SceneUI';\n\ntype Props = {\n  selectedAdventurerId: string;\n  cursorLocation: Location;\n  setCursorLocation: (location?: Location) => void;\n  onSetActionIntent: (intent?: ActionIntent) => void;\n};\n\nexport type Refs = {\n  actionMenuOpen: boolean;\n  onMouseUp: () => void;\n};\n\n// part of the UI that is shown when an adventurer is selected and the scene is in combat\nconst AdventurerCombatSceneUI = forwardRef<Refs, Props>((props: Props, ref) => {\n// const AdventurerCombatSceneUI = (props: Props) => {\n  const { selectedAdventurerId, cursorLocation, setCursorLocation, onSetActionIntent } = props;\n  const [actionMenuOpen, setActionMenuOpen] = useState(false);\n  const combatIntents = useActionIntents(selectedAdventurerId, cursorLocation);\n\n  const handleCloseActionMenu = () => {\n    setActionMenuOpen(false);\n    setCursorLocation(undefined);\n  };\n\n  const onMouseUp = useCallback(() => {\n    // open action\n    const hasValidIntents = !!combatIntents.length && combatIntents.some(i => i.isValid);\n    if (cursorLocation && hasValidIntents){\n      setActionMenuOpen(true);\n    } else {\n      setCursorLocation(undefined);\n      setActionMenuOpen(false);\n    }\n\n    onSetActionIntent?.(undefined);\n  }, [combatIntents, cursorLocation, onSetActionIntent, setCursorLocation]);\n\n  useImperativeHandle(ref, () => {\n    return {\n      actionMenuOpen,\n      onMouseUp,\n    };\n  });\n\n  return (\n    <>\n      <CombatUIWidget\n        location={cursorLocation}\n        intents={combatIntents}\n        selectedActorId={selectedAdventurerId}\n      />\n      { (actionMenuOpen && cursorLocation && combatIntents) && (\n        <ActionMenu\n          adventurerId={selectedAdventurerId}\n          location={cursorLocation}\n          intents={combatIntents}\n          onClose={handleCloseActionMenu}\n          onSetActionIntent={onSetActionIntent}\n        />\n      )}\n    </>\n  );\n});\nAdventurerCombatSceneUI.displayName = 'AdventurerCombatSceneUI';\nexport default AdventurerCombatSceneUI;\n","import { useState, useEffect } from 'react';\nimport { createSelectAdventurersOnQuest } from 'store/selectors/adventurers';\nimport { useSelector, useDispatch } from 'react-redux';\nimport QuestDetails from './QuestDetails';\nimport { useNavigate } from 'react-router-dom';\nimport { getWorldLink } from 'utils/routing';\nimport LootCache from './modals/LootCache';\nimport { useQuest } from 'hooks/store/quests';\nimport { setActiveSceneInteractionModal } from 'store/actions/quests';\nimport Situation from './modals/Situation';\nimport SceneControllerContextProvider from './context/SceneControllerContext';\nimport CombatBar from './CombatBar';\nimport AdventurersPanel from './AdventurersPanel';\nimport ActorsAccordion from './ActorsAccordion';\nimport { getSceneObjectWithName } from 'store/helpers/storeHelpers';\nimport { isEnemy, SceneObject } from 'store/types/scene';\nimport './styles/questPanel.scss';\n\nenum Layout {\n  auto,     // horizontal on large screens, vertical on small screens\n  vertical,\n  horizontal,\n}\n\ninterface Props {\n  questName: string;\n  layout?: Layout;\n}\n\nconst isEnemySelected = (objects: SceneObject[], name: string): boolean => {\n  const selectedObject = getSceneObjectWithName(objects, name);\n  return !!selectedObject && isEnemy(selectedObject);\n};\n\nconst QuestPanel = (props: Props) => {\n  const navigate = useNavigate();\n  const dispatch = useDispatch();\n  const { layout = Layout.auto, questName } = props;\n  const adventurers = useSelector(createSelectAdventurersOnQuest(questName));\n  const leader = adventurers[0];\n  const [selectedActorId, setSelectedActorId] = useState<string>(leader?.id);\n\n  const quest = useQuest(questName);\n  const activeInteractionModal = quest?.scene?.activeInteractionModal;\n\n  const handleActorSelected = (actorId: string) => {\n    // can only select enemies when in combat\n    // in fact, only time enemies are visible is in combat, but still ...\n    if ((!quest?.scene?.combat && isEnemySelected(quest.scene?.objects ?? [], actorId))) {\n      return;\n    }\n    setSelectedActorId(actorId);\n  };\n\n  const handleCloseLootCacheModal = () => {\n    dispatch(setActiveSceneInteractionModal(questName));\n  };\n\n  useEffect(() => {\n    if (!adventurers.length) {\n      // no adventurers, something went wrong, perhaps invalid url\n      // bounce back to world\n      navigate(getWorldLink());\n    }\n  }, [adventurers.length, navigate]);\n\n  useEffect(() => {\n    // When returning from combat and an enemy is still selected, select the leader instead\n    if (!quest?.scene?.combat && selectedActorId) {\n      const enemySelected = isEnemySelected(quest.scene?.objects ?? [], selectedActorId);\n      if (enemySelected){\n        setSelectedActorId(leader?.id);\n      }\n    }\n  }, [leader?.id, quest.scene?.combat, quest.scene?.objects, selectedActorId]);\n  if (!adventurers.length) return null;\n\n  return (\n    <SceneControllerContextProvider questName={questName}>\n      { quest?.scene?.combat && <CombatBar questName={questName} selectedAdventurerId={selectedActorId}/>}\n        <div className={`quest-panel quest-panel-${Layout[layout]}`}>\n          <div className=\"quest-area\">\n            <QuestDetails\n              questName={questName}\n              selectedActorId={selectedActorId}\n              setSelectedActor={handleActorSelected}\n            />\n            { activeInteractionModal && activeInteractionModal.type === 'lootCache' && (\n              <div className=\"modal\" onClick={handleCloseLootCacheModal}>\n                <LootCache\n                  cacheName={activeInteractionModal.lootCache}\n                  adventurerId={selectedActorId}\n                  onClose={handleCloseLootCacheModal}\n                />\n              </div>\n            )}\n            { activeInteractionModal && activeInteractionModal.type === 'situation' && (\n              <div className=\"modal\" onClick={handleCloseLootCacheModal}>\n                <Situation\n                  situation={activeInteractionModal.situation}\n                  adventurerId={selectedActorId}\n                  onClose={handleCloseLootCacheModal}\n                />\n              </div>\n            )}\n          </div>\n          <div className=\"party-area\">\n          { !quest?.scene?.combat && (\n            <AdventurersPanel\n              adventurers={adventurers}\n              adventurerId={selectedActorId}\n              onAdventurerTabSelected={handleActorSelected}\n              disabled={activeInteractionModal !== undefined}\n              questName={questName}\n            />\n          )}\n          { quest?.scene?.combat && (\n            <ActorsAccordion\n              selectedActorId={selectedActorId}\n              questName={questName}\n              onActorSelected={handleActorSelected}\n            />\n          )}\n          </div>\n        </div>\n    </SceneControllerContextProvider>\n  );\n};\n\nexport default QuestPanel;\n","import React, {\n  PropsWithChildren,\n  useContext,\n  useEffect,\n  useRef,\n  useState,\n} from 'react';\nimport { Point } from 'pixi.js';\nimport { LongPressDetectEvents, useLongPress } from 'use-long-press';\nimport { SceneControllerContext } from 'components/world/QuestPanel/context/SceneControllerContext';\nimport { ContextType } from 'constants/context';\nimport { Location } from 'utils/tilemap';\nimport { TooltipManager } from 'global/TooltipManager';\nimport { useAdventurerActorObject, useQuest } from 'hooks/store/quests';\nimport { ActorObject, SceneActionType } from 'store/types/scene';\nimport { locationEquals } from 'utils/tilemap';\nimport { convertMouseOrTouchCoords, MouseOrTouchEvent } from 'utils/interaction';\nimport Bubbles from 'components/ui/bubbles/Bubbles';\nimport { BubbleLayer } from 'global/BubbleManager';\nimport { Item } from 'definitions/items/types';\nimport { Weapon } from 'definitions/items/weapons';\nimport useCanvasScaler from './hooks/useCanvasScaler';\nimport NormalUICursor from './NormalUICursor';\nimport { Ammunition } from 'definitions/items/ammunition';\nimport { WeaponAbility } from 'definitions/abilities/types';\nimport AdventurerCombatSceneUI, { Refs } from './AdventurerCombatSceneUI';\nimport './styles/sceneUI.scss';\n\nexport type Props = {\n  sceneWidth: number;\n  sceneHeight: number;\n  selectedActorId: string;\n  actionIntent?: ActionIntent;\n\n  onMouseDown?: (location: Location) => void;\n  onSetActionIntent: (intent?: ActionIntent) => void;\n};\n\ntype BaseActionIntent = {\n  action: SceneActionType;\n  from: Location;\n  to: Location;\n  actor: ActorObject;\n  path?: Location[];  // is undefined when path is invalid\n  isValid: boolean;\n};\n\nexport type WeaponWithAbility = {\n  weapon: Item<Weapon>;\n  ability: WeaponAbility;\n};\n\nexport type ActionIntent = BaseActionIntent & {\n  // Non combat action\n  action: SceneActionType.interact;\n} | BaseActionIntent & {\n  //\n  action: SceneActionType.move;\n  apCost?: number;\n  actorAP?: number;\n} | BaseActionIntent & {\n  //\n  action: SceneActionType.melee;\n  apCost?: number;\n  actorAP?: number;\n  weaponWithAbility: WeaponWithAbility;\n} | BaseActionIntent & {\n  action: SceneActionType.shoot;\n  apCost?: number;\n  actorAP?: number;\n  weaponWithAbility: WeaponWithAbility;\n  ammo: Item<Ammunition>;\n};\n\n\n// This thing scales itself based on the canvas which should be a sibling of this component\nconst SceneUI = (props: PropsWithChildren<Props>) => {\n  const {\n    children,\n    selectedActorId,\n    actionIntent,\n    sceneWidth,\n    sceneHeight,\n    onMouseDown,\n    onSetActionIntent,\n  } = props;\n  const ref = useRef<HTMLDivElement>(null);\n  const adventurerCombatRef = useRef<Refs>(null);\n  const mouseDownOnCanvas = useRef(false);\n  const controller = useContext(SceneControllerContext);\n  const quest = useQuest(controller?.questName ?? '');\n  const scene = quest.scene;\n  const { combat, actionQueue } = scene ?? {};\n  const [cursorLocation, setCursorLocation] = useState<Location>();\n  const scaler = useCanvasScaler(ref, sceneWidth, sceneHeight);\n\n  // when enemy is selected, this is undefined\n  const selectedAdventurer = useAdventurerActorObject(controller?.questName ?? '', selectedActorId);\n\n  useEffect(() => {\n    scaler.scale = scaler.recalculate();\n  }, [scaler]);\n\n  const findLocation = (e: MouseOrTouchEvent) => {\n    if (e.target instanceof Element) {\n      const {\n        x,\n        y,\n      } = convertMouseOrTouchCoords(e);\n      const rect = (e.target).getBoundingClientRect();\n      const convertedX = (x - rect.left) / scaler.scale;\n      const convertedY = (y - rect.top) / scaler.scale;\n\n      return controller?.pointToSceneLocation(new Point(convertedX, convertedY));\n    }\n    throw new Error('You didnt give me the correct event');\n  };\n\n  const handleMouseMove = (e: MouseOrTouchEvent<HTMLDivElement>) => {\n    if (mouseDownOnCanvas.current) {\n      const location = findLocation(e) ?? [0, 0];\n\n      if (controller?.locationIsOutOfBounds(location)) {\n        setCursorLocation(undefined);\n        onSetActionIntent(undefined);\n        return;\n      }\n      if (!cursorLocation || !locationEquals(location, cursorLocation)){\n        setCursorLocation(location);\n      }\n    }\n  };\n\n\n  const handleClick = (e: React.MouseEvent<HTMLDivElement>) => {\n    const location = findLocation(e);\n    if (!controller || !location || !(e.target instanceof Element)) return;\n    const object = controller.getObjectAtLocation(location);\n    if (!object || object.type !== 'actor') return;\n\n    // Show context tooltip\n    const { tileWidth, tileHeight } = controller.getTileDimensions();\n    const width = tileWidth * scaler.scale;\n    const height = tileHeight * scaler.scale;\n    const rect = (e.target).getBoundingClientRect();\n    const x = (location[0] * width) + (rect.left ?? 0);\n    const y = (location[1] * height) + (rect.top ?? 0);\n    const domRect = DOMRect.fromRect({ x, y, width, height });\n\n    TooltipManager.showContextTooltip(ContextType.actor, object, domRect, '');\n    e.stopPropagation();\n  };\n\n  const handleMouseDown = (e: MouseOrTouchEvent ) => {\n    if (adventurerCombatRef.current?.actionMenuOpen) return;\n    if (actionQueue?.length) return; // dont allow new actions to be created\n\n    const location = findLocation(e);\n    if (location) onMouseDown?.(location);\n\n    mouseDownOnCanvas.current = true;\n    // e.preventDefault();\n  };\n\n  const bind = useLongPress((e) => {\n    if (e) {\n      handleClick(e as React.MouseEvent<HTMLDivElement>);\n      e.preventDefault();\n      e.stopPropagation();\n    }\n  }, {\n    onStart: (e) => { handleMouseDown(e as MouseOrTouchEvent<HTMLDivElement>);},\n    onMove: (e) => { handleMouseMove(e as MouseOrTouchEvent<HTMLDivElement>);},\n    captureEvent: true,\n    cancelOnMovement: 8,\n    detect: LongPressDetectEvents.BOTH,\n  });\n\n  const handleMouseUp = (e: MouseOrTouchEvent<HTMLDivElement>) => {\n    bind.onMouseUp(e as unknown as React.MouseEvent<Element, MouseEvent>);\n    mouseDownOnCanvas.current = false;\n\n    if (!combat) {\n      // Not in combat, do the action immediately\n      setCursorLocation(undefined);\n      if (!actionIntent) {\n        return;\n      }\n      const selectedActorLocation = controller?.getSceneAdventurer(selectedActorId)?.location;\n      if (selectedActorLocation && cursorLocation && !locationEquals(selectedActorLocation, cursorLocation) && actionIntent) {\n        controller?.actorAttemptAction(actionIntent);\n        onSetActionIntent(undefined);\n      }\n    } else {\n      adventurerCombatRef.current?.onMouseUp();\n    }\n\n    e.stopPropagation();\n  };\n\n  useEffect(() => {\n    // Non combat action\n    if (!combat && cursorLocation !== undefined) {\n      // Handle change of cursor when not in combat\n      let action = SceneActionType.move;\n      const object = controller?.getObjectAtLocation(cursorLocation);\n      if (object?.properties.interactive){\n        // We're at an interactive object\n        action = SceneActionType.interact;\n      }\n      const actor = controller?.getSceneAdventurer(selectedActorId);\n      if (!action || !actor || !cursorLocation) {\n        onSetActionIntent(undefined);\n      } else {\n        const intent = controller?.createActionIntent(action, actor, cursorLocation);\n        if (!intent || intent.action === SceneActionType.move || intent.action === SceneActionType.interact) {\n          onSetActionIntent?.(intent);\n        }\n      }\n    }\n  }, [cursorLocation, combat, controller, selectedActorId, onSetActionIntent]);\n\n  useEffect(() => {\n    // When interacting with the canvas, dont scroll the app\n    const onTouch = (e: Event) => {\n      if (mouseDownOnCanvas.current) {\n        e.preventDefault();\n      }\n    };\n\n    window.addEventListener('touchmove', onTouch, { passive: false } );\n    return () => {\n      window.removeEventListener('touchmove', onTouch);\n    };\n  }, []);\n\n  useEffect(() => {\n    const onLeave = () => {\n      if (mouseDownOnCanvas.current){\n        mouseDownOnCanvas.current = false;\n        setCursorLocation(undefined);\n        onSetActionIntent?.(undefined);\n      }\n    };\n    ref.current?.addEventListener('mouseleave', onLeave);\n  }, [onSetActionIntent]);\n\n  return (\n    <div\n      ref={ref}\n      className=\"scene-ui\"\n      {...bind}\n      onMouseUp={handleMouseUp}\n      onTouchEnd={handleMouseUp}\n    >\n      {children}\n      {!scene?.combat && cursorLocation && (\n        <NormalUICursor location={cursorLocation} />\n      )}\n      {scene?.combat && cursorLocation && !!selectedAdventurer &&  (\n        <AdventurerCombatSceneUI\n          ref={adventurerCombatRef}\n          cursorLocation={cursorLocation}\n          selectedAdventurerId={selectedActorId}\n          setCursorLocation={setCursorLocation}\n          onSetActionIntent={onSetActionIntent}\n        />\n      )}\n      <Bubbles layer={BubbleLayer.scene} />\n    </div>\n  );\n};\n\nexport default SceneUI;\n","import { hasOwnProperty } from './typescript';\n\nexport type MouseOrTouchEvent<T = HTMLElement> = React.MouseEvent<T> | React.TouchEvent<T>;\n\n// Normalizes `clientX` and `clientY` props from either a mouse or a touch event\nexport const convertMouseOrTouchCoords = (e: MouseOrTouchEvent) => {\n  if (hasOwnProperty(e, 'clientX') && hasOwnProperty(e, 'clientY')){\n    return { x: e.clientX, y: e.clientY };\n  }\n  if (hasOwnProperty(e, 'touches')) {\n    const touch = e.touches[0];\n    if (touch) {\n      return { x: touch.clientX, y: touch.clientY };\n    }\n  }\n  return { x: NaN, y: NaN };\n};\n\n","import { PixiComponent, applyDefaultProps, Graphics } from '@inlet/react-pixi';\nimport { LineStyle } from 'pixi.js';\nimport { Point } from 'pixi.js';\nimport * as PIXI from 'pixi.js';\n\ninterface Props  {\n  points?: Point[];\n  style?:  Partial<LineStyle>;\n  dash?: number;\n  gap?: number;\n  speed?: number; // positive to move forward, negative to move backward, 0 to not move at all\n}\n\n/**\n * Draws a dashed line along a path\n */\nconst DashedLine = PixiComponent<React.ComponentProps<typeof Graphics> & Props, PIXI.Graphics>('DashedLine', {\n  create: () => {\n    return new PIXI.Graphics();\n  },\n\n  applyProps: (instance: PIXI.Graphics, oldProps: Props, newProps: Props) => {\n    const {\n      points = [],\n      dash = 10,\n      gap = 5,\n      speed = 40,\n      style,\n      ...newP\n    } = newProps;\n\n    // apply rest props to PIXI.Graphics\n    applyDefaultProps(instance, oldProps, newP);\n    instance.clear();\n\n    const draw = () => {\n\n      if (instance.destroyed) {\n        // component is unmounted, cancel drawing the line\n        return;\n      }\n\n      instance.clear();\n      instance.lineStyle(style?.width ?? 10, style?.color, style?.alpha, style?.alignment, style?.native);\n      const offsetPercentage = (Date.now() % (10000 / speed) + 1) / Math.abs(10000 / speed);\n\n      let dashLeft = 0;\n      let gapLeft = 0;\n      if (offsetPercentage > 0) {\n        const progressOffset = (dash + gap) * offsetPercentage * (speed < -1 ? 1 : -1) ;\n        if (progressOffset < dash) {\n          dashLeft = dash - progressOffset;\n        } else {\n          gapLeft = gap - (progressOffset - dash);\n        }\n      }\n      const rotatedpoints = [];\n      for (const point of points) {\n        const p = point.clone();\n        const cosAngle = Math.cos(instance.rotation);\n        const sinAngle = Math.sin(instance.rotation);\n        const dx = p.x;\n        const dy = p.y;\n        p.x = (dx * cosAngle - dy * sinAngle);\n        p.y = (dx * sinAngle + dy * cosAngle);\n        rotatedpoints.push(p);\n      }\n\n      for (let i = 0; i < rotatedpoints.length - 1; i++) {\n        const p1 = rotatedpoints[i];\n        const p2 = rotatedpoints[i + 1];\n        const dx = p2.x - p1.x;\n        const dy = p2.y - p1.y;\n        const len = Math.sqrt(dx * dx + dy * dy);\n        const normal = {\n          x: dx / len,\n          y: dy / len,\n        };\n        let progressOnLine = 0;\n\n        instance.moveTo(p1.x + gapLeft * normal.x, p1.y + gapLeft * normal.y);\n        while (progressOnLine <= len) {\n          progressOnLine += gapLeft;\n          if (dashLeft > 0) {\n            progressOnLine += dashLeft;\n          } else {\n            progressOnLine += dash;\n          }\n          if (progressOnLine > len) {\n            dashLeft = progressOnLine - len;\n            progressOnLine = len;\n          } else {\n            dashLeft = 0;\n          }\n          instance.lineTo(p1.x + progressOnLine * normal.x, p1.y + progressOnLine * normal.y);\n          progressOnLine += gap;\n          if (progressOnLine > len && dashLeft === 0) {\n            gapLeft = progressOnLine - len;\n          } else {\n            gapLeft = 0;\n            instance.moveTo(p1.x + progressOnLine * normal.x, p1.y + progressOnLine * normal.y);\n          }\n        }\n      }\n      if (speed !== 0) {\n        requestAnimationFrame(draw);\n      }\n    };\n    draw();\n  },\n});\n\nexport default DashedLine;\n","import DashedLine from 'components/pixi/DashedLine';\nimport { Point } from 'pixi.js';\nimport { SceneActionType } from 'store/types/scene';\nimport { ActionIntent } from './ui/SceneUI';\nimport { Graphics } from '@inlet/react-pixi';\n\nexport interface Props {\n  actionIntent: ActionIntent;\n  tileWidth: number;\n  tileHeight: number;\n}\n\nconst ActionPreview = (props: Props) => {\n  const { actionIntent, tileWidth, tileHeight } = props;\n  const convert = (p: number[]) => new Point(p[0] * (tileWidth) + (tileWidth / 2), p[1] * (tileHeight) + (tileHeight / 2));\n\n  switch (actionIntent.action){\n    case SceneActionType.interact: {\n      if (!actionIntent.path){\n        return null;\n      }\n      const converted = [\n        convert(actionIntent.from),\n        ...actionIntent.path.map(p => convert(p)),\n      ];\n\n      return (\n        <DashedLine\n          points={converted}\n          dash={10}\n          gap={15}\n          speed={20}\n          rotation={0}\n          style={{\n            width: 6,\n            color: 0xffffff,\n            alpha: 1,\n          }}\n        />\n      );\n    }\n    case SceneActionType.move:\n    case SceneActionType.melee: {\n      if (!actionIntent.path){\n        return null;\n      }\n      const converted = [\n        convert(actionIntent.from),\n        ...actionIntent.path.map(p => convert(p)),\n      ];\n      const valid = (!actionIntent.apCost) || actionIntent.apCost <= (actionIntent.actorAP || 0);\n\n      return (\n        <DashedLine\n          points={converted}\n          dash={10}\n          gap={15}\n          speed={20}\n          rotation={0}\n          style={{\n            width: 6,\n            color: valid ? 0xffffff : 0x8b0000,\n            alpha: 1,\n          }}\n        />\n      );\n    }\n    case SceneActionType.shoot: {\n      // draw arrow: https://math.stackexchange.com/questions/1314006/drawing-an-arrow\n      const valid = (!actionIntent.apCost) || actionIntent.apCost <= (actionIntent.actorAP || 0);\n      const from = convert(actionIntent.from);\n      const to = convert(actionIntent.to);\n      return (\n        <Graphics\n          name=\"line\"\n          draw={graphics => {\n            graphics.lineStyle(4, valid ? 0xcb8c06 : 0x8b0000, 1);\n            graphics.moveTo(from.x, from.y);\n            graphics.lineTo(to.x, to.y);\n            graphics.endFill();\n          }}\n        />\n      );\n    }\n    default:\n      return null;\n  }\n};\n\nexport default ActionPreview;\n","import { useMemo } from 'react';\nimport { StoreState } from 'store/types';\nimport { useSelector } from 'react-redux';\nimport { LogChannel, LogEntry } from 'store/types/logEntry';\nimport { createSelector } from 'reselect';\n\nconst getLog = (state: StoreState) => state.log;\n\n// Returns the game log from redux store\nexport const useLog = () => {\n  const log = useSelector<StoreState, LogEntry[]>(store => store.log);\n  return log;\n};\n\nexport const useQuestLog = (questId: string) => {\n  const selectMemoized = useMemo(() => {\n    const selectQuestLogEntries = createSelector(\n      [getLog],\n      (log: LogEntry[]) => { return log.filter((l) => l.channel === LogChannel.quest && l.channelContext === questId); },\n    );\n    return selectQuestLogEntries;\n  }, [questId]);\n\n  return useSelector<StoreState, LogEntry[]>(selectMemoized);\n};\n\n","import { useEffect } from 'react';\nimport { useQuestLog } from 'hooks/store/useLog';\n\ninterface Props {\n  questId: string;\n}\n\nconst SceneLog = (props: Props) => {\n  const log = useQuestLog(props.questId);\n  useEffect(() => {\n    const lastLog = log.shift();\n    if ((lastLog?.time || 0) > Date.now() - 1000) {\n      // console.log(lastLog?.key)\n    }\n  }, [log]);\n  return null;\n};\n\nexport default SceneLog;\n","import { Graphics, Text } from '@inlet/react-pixi';\nimport { useSettings } from 'hooks/store/settings';\nimport { BaseSceneController } from 'mechanics/scenes/BaseSceneController';\nimport { TextStyle } from 'pixi.js';\nimport { useMemo } from 'react';\nimport { Location } from 'utils/tilemap';\n\ntype Props = {\n  controller: BaseSceneController<unknown>\n};\n\nconst style = new TextStyle({\n  fontFamily : 'Gabriela',\n  fontSize: 24,\n  fill: 0xffffff,\n  wordWrap: true,\n  wordWrapWidth: 200,\n  dropShadow: true,\n  dropShadowAngle: 0.9,\n  dropShadowBlur: 10,\n  dropShadowDistance: 0,\n});\n\n// various debug stuff for scene, can be set via settings\nconst SceneDebug = (props: Props) => {\n  const settings = useSettings();\n  const { controller } = props;\n  const mapData = controller.mapData;\n  const { tileWidth, tileHeight } = controller.getTileDimensions();\n\n  const allLocations = useMemo<Location[]>(() => {\n    if (!mapData) return [];\n    const result = [];\n    for (let y = 0; y < mapData.height; y++) {\n      for (let x = 0; x < mapData.width; x++) {\n        result.push([x, y] as Location);\n      }\n    }\n    return result;\n  }, [mapData]);\n  if (!mapData) return null;\n\n  return (\n  <>\n    {settings.debugSceneShowPathable && (\n      <Graphics\n        name=\"blocked-tiles\"\n        draw={graphics => {\n          const line = 3;\n          for (let y = 0; y < mapData.height; y++) {\n            for (let x = 0; x < mapData.width; x++) {\n              const blocked = controller.locationIsBlocked([x, y]);\n\n              if (blocked) {\n                graphics.lineStyle(line, 0xFF0000);\n              } else {\n                graphics.lineStyle(line, 0xFFFFFF);\n              }\n              graphics.drawRect(x * tileWidth, y * tileHeight, tileWidth, tileHeight);\n              graphics.endFill();\n            }\n          }\n        }}\n      />\n    )}\n    {settings.debugSceneShowCellLocations && (\n      allLocations.map(([x, y]) => (\n        <Text\n          anchor={0.5}\n          alpha={0.5}\n          style={style}\n          x={x * tileWidth + tileWidth / 2}\n          y={y * tileHeight + tileHeight / 2}\n          text={`[${x},${y}]`} key={`[${x},${y}]`}\n        />\n      ))\n    )}\n  </>\n  );\n};\n\nexport default SceneDebug;\n","import { useRef, useEffect, useContext, useState } from 'react';\nimport { Container } from '@inlet/react-pixi';\nimport { useQuestScene } from 'hooks/store/quests';\nimport { Location } from 'utils/tilemap';\nimport Tilemap from './Tilemap';\nimport BridgedStage from 'components/pixi/util/BridgedStage';\nimport useTilesetsLoader from 'hooks/useTilesetsLoader';\nimport { SceneControllerContext } from '../../context/SceneControllerContext';\nimport SceneUI, { ActionIntent } from './ui/SceneUI';\nimport ActionPreview from './ActionPreview';\nimport { isAdventurer, isEnemy } from 'store/types/scene';\nimport SceneLog from './SceneLog';\nimport { CombatController } from 'mechanics/scenes/CombatController';\nimport { Rectangle } from 'pixi.js';\nimport { useSettings } from 'hooks/store/settings';\nimport SceneDebug from './SceneDebug';\nimport './styles/scene.scss';\n\nexport interface Props {\n  selectedActorId: string;\n  setSelectedActor: (id: string) => void;\n}\n\nconst Scene = (props: Props) => {\n  const settings = useSettings();\n  const { selectedActorId, setSelectedActor } = props;\n  const controller = useContext(SceneControllerContext);\n  if (!controller) throw new Error('No controller found');\n  const mapData = controller.mapData;\n  const basePath = controller.basePath;\n  if (!basePath) throw new Error('No basePath found');\n\n  const {\n    loadComplete,\n    loadTilesets,\n    tileSpritesheets,\n  } = useTilesetsLoader(basePath);\n\n  const ref = useRef<HTMLDivElement>(null);\n  const scene = useQuestScene(controller.questName);\n  const combat = scene?.combat === true;\n  const { tileWidth, tileHeight } = controller.getTileDimensions();\n  const [currentActionIntent, setCurrentActionIntent] = useState<ActionIntent>();\n\n  useEffect(() => {\n    if (combat) {\n      CombatController.initialize(controller);\n    }\n    return () => {\n      CombatController.destroy();\n    };\n  }, [combat, controller]);\n\n  useEffect(() => {\n    if (!mapData) return;\n    loadTilesets(mapData.tilesets);\n  }, [loadTilesets, mapData]);\n\n  const handleUIMouseDown = (location: Location) => {\n    const actor = controller.getObjectAtLocation(location);\n    if (actor && isAdventurer(actor)) {\n      // We can click on adventurers\n      props.setSelectedActor(actor.adventurerId);\n    }\n    if (actor && isEnemy(actor)) {\n      // We can click on enemies too\n      props.setSelectedActor(actor.enemyId);\n    }\n  };\n\n  if (!loadComplete || !mapData || !scene) {\n    return <div>loading scene...</div>;\n  }\n\n  const sceneWidth = mapData.width * mapData.tilewidth;\n  const sceneHeight = mapData.height * mapData.tileheight;\n  return (\n    <div className=\"scene\" ref={ref}>\n      <BridgedStage width={sceneWidth} height={sceneHeight}>\n        <Container\n          interactive={true}\n          hitArea={new Rectangle(0, 0, sceneWidth, sceneHeight)}\n        >\n          <Tilemap\n            basePath={basePath}\n            data={mapData}\n            spritesheets={tileSpritesheets}\n            objects={scene.objects}\n            controller={controller}\n            selectedActorId={selectedActorId}\n            setSelectedActor={setSelectedActor}\n          />\n          { currentActionIntent && (<ActionPreview actionIntent={currentActionIntent} tileWidth={tileWidth} tileHeight={tileHeight}/>)}\n          <SceneDebug controller={controller} />\n        </Container>\n      </BridgedStage>\n      {settings.debugSceneShowActionQueue && (\n        <div style={{ position: 'absolute', bottom: 0 }}>\n          <h2>ActionQueue</h2>\n          <ul>\n            {scene.actionQueue && scene.actionQueue.map((action) => (\n              <li key={JSON.stringify(action)}>{JSON.stringify(action)}</li>\n            ))}\n          </ul>\n        </div>\n      )}\n      <SceneUI\n        sceneWidth={sceneWidth}\n        sceneHeight={sceneHeight}\n        selectedActorId={selectedActorId}\n        actionIntent={currentActionIntent}\n        onMouseDown={handleUIMouseDown}\n        onSetActionIntent={setCurrentActionIntent}\n      />\n      <SceneLog questId={controller.questName} />\n    </div>\n  );\n};\n\nexport default Scene;\n","import React from 'react';\nimport { useQuest } from 'hooks/store/quests';\nimport { getDefinition } from 'definitions/quests';\nimport { QuestDefinition } from 'definitions/quests/types';\nimport { TextManager } from 'global/TextManager';\nimport './styles/onTheRoad.scss';\n\nexport interface Props {\n  questName: string;\n}\n\n/* Shows the most recent log on a questnode */\nconst OnTheRoad = (props: Props) => {\n  const quest = useQuest(props.questName);\n  const questDefinition: QuestDefinition = getDefinition(quest.name);\n  let progress: number = Math.floor(quest.progress);\n  do {\n    const log = questDefinition.nodes[progress].log;\n    if (log) {\n      return (\n        <div>\n          <p>{`${TextManager.get(log)}`}</p>\n        </div>\n      );\n    }\n    progress--;\n  } while (progress >= 0);\n  return <h1 className=\"on-the-road questname\">{TextManager.getQuestTitle(quest.name)}</h1>;\n};\n\nexport default OnTheRoad;\n","import Scene from 'components/world/QuestPanel/QuestDetails/scene/Scene';\nimport { useQuest } from 'hooks/store/quests';\nimport OnTheRoad from './OnTheRoad';\n\nexport interface Props {\n  questName: string;\n  selectedActorId: string;\n  setSelectedActor: (id: string) => void;\n}\n\nconst QuestDetails = (props: Props) => {\n  const quest = useQuest(props.questName);\n\n  if (!quest.sceneName) {\n    return <OnTheRoad questName={props.questName} />;\n  }\n  return (\n    <Scene {...props} />\n  );\n};\n\nexport default QuestDetails;\n","import { DragType } from 'constants/dragging';\nimport { useDrop } from 'react-dnd';\nimport AdventurerAvatar, { Props as AdventurerAvatarProps }  from '../AdventurerAvatar';\nimport { InventoryItemDragInfo } from 'components/ui/items/DraggableItemIcon';\nimport './styles/droppableadventureravatar.scss';\n\nexport interface Props extends AdventurerAvatarProps {\n  onDrop: (dragInfo: InventoryItemDragInfo) => void;\n}\n\nexport interface CollectedProps {\n  canDrop: boolean;\n  isOver: boolean;\n}\n\n/**\n * The AdventurerAvatar displays the avatar of an adventurer in the party screen\n */\nconst DroppableAdventurerAvatar = (props: Props) => {\n  const { onDrop } = props;\n\n  const [, dropRef] = useDrop<InventoryItemDragInfo, void, CollectedProps>(() => ({\n    accept: DragType.ITEM,\n    collect: (monitor) => ({\n      canDrop: monitor.canDrop(),\n      isOver: monitor.isOver(),\n    }),\n    drop: (dragInfo: InventoryItemDragInfo) => {\n      return onDrop(dragInfo);\n    },\n  }));\n\n  return (\n    <div className=\"droppable-adventurer-avatar\" ref={dropRef}>\n      <AdventurerAvatar\n        adventurer={props.adventurer}\n        onClick={props.onClick }\n      />\n    </div>\n  );\n};\n\nexport default DroppableAdventurerAvatar;\n\n","import React, { useRef, useContext } from 'react';\nimport gsap from 'gsap';\nimport DraggableItemsList from 'components/ui/items/DraggableItemsList';\nimport { TextManager } from 'global/TextManager';\nimport { DragSourceType } from 'constants/dragging';\nimport { SceneControllerContext } from '../../context/SceneControllerContext';\nimport { useAdventurer } from 'hooks/store/adventurers';\nimport Button from 'components/ui/buttons/Button';\nimport { adventurerFreeInventorySlots } from 'store/helpers/storeHelpers';\nimport Icon from 'components/ui/common/Icon';\nimport { InventoryItemDragInfo } from 'components/ui/items/DraggableItemIcon';\nimport DroppableAdventurerAvatar from 'components/ui/adventurer/DroppableAdventurerAvatar';\nimport '../styles/modal.scss';\nimport '../styles/lootCache.scss';\n\ninterface Props {\n  cacheName: string;\n  adventurerId: string;\n  onClose: () => void;\n}\n\nconst LootCache = (props: Props) => {\n  const controller = useContext(SceneControllerContext);\n\n  const adventurer = useAdventurer(props.adventurerId);\n  const freeSlots = adventurerFreeInventorySlots(adventurer);\n  const ref = useRef<HTMLDivElement>(null);\n\n  if (!controller) {\n    return null;\n  }\n  const cache = controller.getLootCache(props.cacheName);\n  if (!cache) {\n    return null;\n  }\n\n  const handleTakeGold = (e: React.MouseEvent) => {\n    e.stopPropagation();\n    // todo: animate gold flying away\n\n    controller.takeGoldFromCache(props.cacheName);\n  };\n\n  const handleTakeAllItems = (e: React.MouseEvent) => {\n    e.stopPropagation();\n    if (ref.current) {\n      ref.current.querySelectorAll('.items-list .item-icon').forEach((el, index) => {\n        if (index >= freeSlots) return;\n        el.classList.add('taking');\n      });\n      gsap.to('.items-list .item-icon.taking', {\n        right: '-50vw',\n        stagger: {\n          each: 0.1,\n          ease: 'power2.inOut',\n        },\n        onComplete: () => {\n          for (let i = 0; i < freeSlots; i++) {\n            controller.takeItemFromCache(0, props.cacheName, props.adventurerId);\n          }\n        },\n      });\n    }\n  };\n\n  const handleDrop = (item: InventoryItemDragInfo) => {\n    controller.takeItemFromCache(item.inventorySlot ?? 0, props.cacheName, props.adventurerId);\n  };\n\n  return (\n    <div className={'interaction-modal loot-cache'} ref={ref}>\n      <div className=\"header\">\n        <div className=\"title\">\n          {TextManager.get(cache.title, { adventurer: adventurer.name })}\n        </div>\n        <div className=\"close\" onClick={props.onClose} />\n      </div>\n      { cache.items.length > 0 && (\n        <div className=\"content\">\n          <div className=\"items\">\n            <DraggableItemsList\n              items={cache.items}\n              sourceType={DragSourceType.lootCache}\n              sourceId={props.cacheName}\n            />\n          </div>\n          <div className=\"adventurer\">\n            <DroppableAdventurerAvatar adventurer={adventurer} onDrop={handleDrop} />\n            <Button onClick={handleTakeAllItems} disabled={freeSlots === 0} size=\"small\">\n              {TextManager.get('quest-common-loot-cache-take-all')}\n            </Button>\n          </div>\n        </div>\n      )}\n      { !!cache.gold && (\n        <div className=\"content\">\n          <div className=\"gold\">\n            <Icon\n              image=\"img/resources/gold.png\"\n              size=\"medium\"\n            />\n            {TextManager.get('quest-common-loot-cache-gold', { gold: cache.gold })}\n          </div>\n          <div className=\"take-gold\">\n            <Button onClick={handleTakeGold} size=\"small\">\n              {TextManager.get('quest-common-loot-cache-take')}\n            </Button>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default LootCache;\n","import { MouseEvent, useRef, useContext } from 'react';\nimport { TextManager } from 'global/TextManager';\nimport { SceneControllerContext } from '../../context/SceneControllerContext';\nimport Button from 'components/ui/buttons/Button';\nimport '../styles/situation.scss';\nimport '../styles/modal.scss';\n\ninterface Props {\n  situation: string;\n  adventurerId: string;\n  onClose: () => void;\n}\n\nconst Situation = (props: Props) => {\n  const controller = useContext(SceneControllerContext);\n  const ref = useRef<HTMLDivElement>(null);\n  const situation = controller?.getSituation(props.situation, props.adventurerId);\n  if (!situation) return null;\n\n  const { title, choices, text } = situation;\n  const handleChoiceClick = (e: MouseEvent<HTMLButtonElement>) => {\n    const choice = e.currentTarget.getAttribute('data-option');\n    if (!choice || !controller) return;\n    controller.handleSituationOptionClick(props.situation, choice, props.adventurerId);\n    e.stopPropagation();\n  };\n\n  const handleClose = (e: MouseEvent<HTMLDivElement>) => {\n    props.onClose();\n    e.stopPropagation();\n  };\n  return (\n    <div className='interaction-modal situation' ref={ref}>\n      <div className=\"header\">\n        <div className=\"title\">\n          {TextManager.get(title)}\n        </div>\n        <div className=\"close\" onClick={handleClose} />\n      </div>\n      <div className=\"content\">\n      { text && (<div className=\"text\">{TextManager.get(text)}</div>)}\n      { choices?.map(choice => (\n        <Button key={choice} data-option={choice} onClick={handleChoiceClick}>{TextManager.get(choice)}</Button>\n      ))}\n    </div>\n    </div>\n  );\n};\n\nexport default Situation;","import { useContext } from 'react';\nimport { SceneControllerContext } from '../context/SceneControllerContext';\nimport { TextManager } from 'global/TextManager';\nimport Button from 'components/ui/buttons/Button';\nimport './styles/combatBar.scss';\n\ninterface Props {\n  questName: string;\n  selectedAdventurerId?: string;\n}\n\nconst CombatBar = (_props: Props) => {\n  // const { selectedAdventurerId } = props;\n  // const adventurers = useSelector(createSelectAdventurersOnQuest(props.questName));\n  const controller = useContext(SceneControllerContext);\n\n  return (\n    <div className=\"combat-bar\">\n      <div className=\"title\">\n        {TextManager.get('ui-combat-bar-title')}\n      </div>\n      {/* <div className=\"adventurers\">\n        {adventurers.map(a => (\n          <div key={a.id} className={`adventurer ${selectedAdventurerId === a.id ? 'selected' : ''}`}>\n            <AdventurerAvatar adventurer={a} size={IconSize.smallest}/>\n            <div className=\"ap\">\n              {controller?.getSceneActor(a.id)?.ap || 0} AP\n            </div>\n          </div>\n        ))}\n      </div> */}\n      <Button size=\"medium\" onClick={() => controller?.endTurn()}>End turn</Button>\n    </div>\n  );\n};\n\nexport default CombatBar;\n","import AdventurerPanel, { AdventurerSectionSelection } from 'components/ui/adventurer/AdventurerPanel';\nimport { AdventurerStoreState } from 'store/types/adventurer';\nimport AdventurerTabstrip from './AdventurerTabstrip';\n\ntype Props = {\n  adventurerId: string;\n  adventurers: AdventurerStoreState[];\n  onAdventurerTabSelected: (adventurerId: string) => void;\n  questName?: string;\n  disabled?: boolean;\n};\n\n// A tabstrip with adventurer details below it\nconst AdventurersPanel = (props: Props) => {\n  const { adventurerId, adventurers, onAdventurerTabSelected, disabled, questName } = props;\n  return (\n    <>\n     <AdventurerTabstrip\n        adventurers={adventurers}\n        selectedAdventurerId={adventurerId}\n        onAdventurerTabSelected={onAdventurerTabSelected}\n        disabled={disabled}\n      />\n      <div className=\"adventurer-details\">\n        <AdventurerSectionSelection />\n        { adventurerId && (\n          <AdventurerPanel\n            adventurerId={adventurerId}\n            questName={questName}\n          />\n        )}\n      </div>\n    </>\n  );\n};\n\nexport default AdventurersPanel;\n","import { createContext } from 'react';\n\nexport interface AccordionContextProps {\n  itemsExpanded: string[]\n  toggleItem: (item: string) => void\n}\nexport const AccordionContext = createContext<AccordionContextProps | null>(null);\n","import { ComponentProps, useState } from 'react';\nimport { AccordionContext } from './context/AccordionContext';\nimport './styles/accordion.scss';\n\ntype Props = ComponentProps<'div'>;\n\nconst Accordion = (props: Props) => {\n  const { children, className } = props;\n  const [itemsExpanded, setItemsExpanded] = useState<string[]>([]);\n\n  const toggleItem = (id: string) => {\n    if (itemsExpanded.indexOf(id) > -1) {\n      setItemsExpanded(itemsExpanded.filter(i => i !== id));\n    } else {\n      setItemsExpanded([...itemsExpanded, id]);\n    }\n  };\n  return (\n    <AccordionContext.Provider value={{\n      itemsExpanded,\n      toggleItem,\n    }} >\n    <div className={`accordion ${className ?? ''}`}>\n      {children}\n    </div>\n    </AccordionContext.Provider>\n  );\n};\n\nexport default Accordion;\n","import { ComponentProps, CSSProperties, ReactElement, useContext, useLayoutEffect, useRef, useState } from 'react';\nimport { Merge } from 'type-fest';\nimport { AccordionContext } from './context/AccordionContext';\n\nexport type Props = Merge<ComponentProps<'div'>, {\n  id: string;\n  onHeaderClick?: () => void;\n  title: string | ReactElement\n}>;\n\nconst AccordionItem = (props: Props) => {\n  const { title = '', className, id, children, onHeaderClick, ...rest } = props;\n  const context = useContext(AccordionContext);\n  const contentRef = useRef<HTMLDivElement>(null);\n  const [clientHeight, setClientHeight] = useState(0);\n  const isExpanded = context?.itemsExpanded.indexOf(id) !== -1;\n\n  const classNames = [\n    'accordion-item',\n    className ?? '',\n    ...(isExpanded ? ['expanded'] : []),\n  ];\n\n  const handleHeaderClick = () => {\n    context?.toggleItem(id);\n    onHeaderClick?.();\n  };\n\n  useLayoutEffect(() => {\n    if (!isExpanded && contentRef.current) {\n      setClientHeight(contentRef.current?.clientHeight);\n    }\n  }, [isExpanded]);\n\n  // when clientHeight is 0, it means it's collapsed. Set max-height to 1200\n  const style = { '--content-height': clientHeight || 1200 } as CSSProperties;\n  return (\n    <div className={classNames.join(' ')} style={style}>\n      <header className='header' { ...rest } onClick={handleHeaderClick}>\n        {title}\n      </header>\n      <div className=\"content\" ref={contentRef}>\n        {children}\n      </div>\n    </div>\n  );\n};\n\nexport default AccordionItem;\n\n\n\n","import { calculateDodge, calculateInitialAP } from 'mechanics/combat';\nimport { AttributesStoreState } from 'store/types/adventurer';\nimport { roundIfNeeded } from 'utils/format/number';\n\ntype Props = {\n  attributes: AttributesStoreState;\n  level: number;\n};\n\nconst CombatAttributes = (props: Props) => {\n  const { attributes, level } = props;\n  return (\n    <>\n      <div>\n        AP each turn: {calculateInitialAP(attributes, level)}\n      </div>\n      <div>\n        Dodge: {roundIfNeeded(calculateDodge(attributes))}%\n      </div>\n    </>\n  );\n};\n\nexport default CombatAttributes;\n","import { useMemo } from 'react';\nimport { Merge } from 'type-fest';\nimport { useAdventurer } from 'hooks/store/adventurers';\nimport Attributes from 'components/ui/attributes/AttributeList';\nimport { xpToLevel } from 'mechanics/adventurers/levels';\nimport { TextManager } from 'global/TextManager';\nimport { calculateEffectiveAttributes, calculateEffectiveAttributesExtended } from 'mechanics/adventurers/attributes';\nimport AccordionItem, { Props as AccordionItemProps } from 'components/ui/accordion/AccordionItem';\nimport CombatAttributes from 'components/ui/tooltip/ContextTooltip/context/ActorContext/CombatAttributes';\nimport { useAdventurerActorObject } from 'hooks/store/quests';\n\ntype Props = Merge<Omit<AccordionItemProps, 'id' | 'title'>, {\n  adventurerId: string\n  selected: boolean\n  questName: string;\n}>;\n\nconst ActorsAccordionAdventurerItem = (props: Props) => {\n  const { adventurerId, selected, questName, ...rest } = props;\n  const adventurer = useAdventurer(adventurerId);\n  const attributes = calculateEffectiveAttributes(adventurer);\n  const { xp } = adventurer;\n  const level = xpToLevel(xp);\n  const extendedAttributes = useMemo(() => calculateEffectiveAttributesExtended(adventurer), [adventurer]);\n  const actor = useAdventurerActorObject(questName ?? '', adventurerId);\n\n  return (\n    <AccordionItem\n      className={`actors-accordion-item ${selected ? 'selected' : ''}`}\n      { ...rest}\n      id={adventurerId}\n      title={(<>\n        <div className=\"name\">{TextManager.getAdventurerName(adventurerId)}</div>\n        <div className=\"ap\">AP: {actor?.ap}</div>\n      </>)}\n    >\n      <div>\n        <div className=\"name-and-level\">\n          <div className=\"level\">\n            {TextManager.get('ui-tooltip-actor-level', { level })}\n          </div>\n        </div>\n        <Attributes attributes={extendedAttributes} small />\n        <CombatAttributes attributes={attributes} level={level} />\n      </div>\n    </AccordionItem>\n  );\n};\n\nexport default ActorsAccordionAdventurerItem;\n","import { Merge } from 'type-fest';\nimport { TextManager } from 'global/TextManager';\nimport AccordionItem, { Props as AccordionItemProps } from 'components/ui/accordion/AccordionItem';\nimport { useEnemyActorObject } from 'hooks/store/quests';\nimport { getDefinition } from 'definitions/enemies';\nimport { generateBaseAttributes } from 'mechanics/adventurers/attributes';\nimport Attributes from 'components/ui/attributes/AttributeList';\nimport CombatAttributes from 'components/ui/tooltip/ContextTooltip/context/ActorContext/CombatAttributes';\n\ntype Props = Merge<Omit<AccordionItemProps, 'id' | 'title'>, {\n  enemyId: string;\n  selected: boolean;\n  questName: string;\n}>;\n\nconst ActorsAccordionEnemyItem = (props: Props) => {\n  const { enemyId, selected, questName, ...rest } = props;\n  const actorObject = useEnemyActorObject(questName, enemyId);\n  if (!actorObject) throw new Error(`No actor found with id ${enemyId}`);\n  const definition = getDefinition(actorObject.enemyType);\n  const level = actorObject.level ?? 1;\n  const extendedAttributes = generateBaseAttributes(definition.attributes);\n  const attributes = definition.attributes;\n\n  return (\n    <AccordionItem\n      className={`actors-accordion-item ${selected ? 'selected' : ''}`}\n      { ...rest}\n      id={enemyId}\n      title={(<>\n        <div className=\"name\">{TextManager.getEnemyName(actorObject.enemyType)}</div>\n        <div className=\"ap\">AP: 3</div>\n      </>)}\n    >\n      <div>\n        <div className=\"name-and-level\">\n          <div className=\"level\">\n            {TextManager.get('ui-tooltip-actor-level', { level })}\n          </div>\n        </div>\n        <Attributes attributes={extendedAttributes} small />\n        <CombatAttributes attributes={attributes} level={level} />\n      </div>\n    </AccordionItem>\n  );\n};\n\nexport default ActorsAccordionEnemyItem;\n","import Accordion from 'components/ui/accordion/Accordion';\nimport ActorsAccordionAdventurerItem from './ActorsAccordionAdventurerItem';\nimport { createSelectAdventurersOnQuest } from 'store/selectors/adventurers';\nimport { useSelector } from 'react-redux';\nimport ActorsAccordionEnemyItem from './ActorsAccordionEnemyItem';\nimport { useQuestSceneEnemies } from 'hooks/store/quests';\nimport './styles/actorsAccordion.scss';\n\ntype Props = {\n  selectedActorId: string;\n  onActorSelected: (actorId: string) => void;\n  questName: string;\n};\n\n// A tabstrip with adventurer / enemy details below it\nconst ActorsAccordion = (props: Props) => {\n  const { selectedActorId, questName, onActorSelected } = props;\n  const adventurers = useSelector(createSelectAdventurersOnQuest(questName));\n  const enemies = useQuestSceneEnemies(questName);\n\n  return (\n    <Accordion className=\"actors-accordion\">\n      {adventurers.map(a => (\n        <ActorsAccordionAdventurerItem\n          selected={selectedActorId === a.id}\n          key={a.id}\n          adventurerId={a.id}\n          questName={questName}\n          onHeaderClick={() => { onActorSelected(a.id);}}\n        />\n      ))}\n      {enemies.map(e => (\n        <ActorsAccordionEnemyItem\n          enemyId={e.enemyId}\n          key={e.id}\n          selected={selectedActorId === e.enemyId}\n          onHeaderClick={() => { onActorSelected(e.enemyId);}}\n          questName={questName}\n        />\n      ))}\n    </Accordion>\n  );\n};\n\nexport default ActorsAccordion;\n","import Tab from 'components/ui/tabs/Tab';\nimport Tabstrip from 'components/ui/tabs/Tabstrip';\nimport { LogChannel, LogEntry } from 'store/types/logEntry';\nimport { TextManager } from 'global/TextManager';\nimport { useEffect, useState } from 'react';\nimport Button from 'components/ui/buttons/Button';\nimport { useLog } from 'hooks/store/useLog';\nimport { useActiveQuestNames } from 'hooks/store/quests';\nimport { useLocation } from 'react-router-dom';\nimport { getQuestLink, getTownLink } from 'utils/routing';\nimport Markdown from 'components/markdown/Markdown';\nimport './styles/simplelog.scss';\n\n// eslint-disable-next-line @typescript-eslint/no-empty-interface\nexport interface Props {\n}\n\nenum ChannelType {\n  all,\n  town,\n  quest,\n}\n\ninterface ChannelDefinition {\n  label: string;\n  tabType: ChannelType;\n  tabId: string;\n  channelContext?: string;\n}\n\nconst SimpleLog = () => {\n  const [expanded, setExpanded] = useState(false);\n  const [selectedTabId, setSelectedTabId] = useState<'all' | 'town' | string>('all');\n\n  const logEntries = useLog();\n  const activeQuestNames = useActiveQuestNames();\n  const location = useLocation();\n\n  useEffect(() => {\n    if (location.pathname === getTownLink()){\n      setSelectedTabId('town');\n      return;\n    }\n    activeQuestNames.forEach(q => {\n      if (location.pathname === getQuestLink(q)){\n        setSelectedTabId(`quest-${q}`);\n      }\n    });\n  }, [activeQuestNames, location]);\n\n  const channels: ChannelDefinition[] = [{\n    label: TextManager.get('ui-log-tab-all'),\n    tabId: 'all',\n    tabType: ChannelType.all,\n  }, {\n    label: TextManager.get('ui-log-tab-town'),\n    tabId: 'town',\n    tabType: ChannelType.town,\n  }];\n\n  const handleTabSelected = (tabId: string) => {\n    setSelectedTabId(tabId);\n  };\n\n  const handleToggleExpand = () => {\n    setExpanded(!expanded);\n  };\n\n  activeQuestNames.forEach((questName) => {\n    channels.push({\n      channelContext: questName,\n      label: TextManager.getQuestTitle(questName),\n      tabId: `quest-${questName}`,\n      tabType: ChannelType.quest,\n    });\n  });\n\n  let displayEntries: LogEntry[] = [];\n  const currentTab = channels.find((t) => t.tabId === selectedTabId);\n\n  switch (currentTab?.tabType) {\n    case ChannelType.all:\n      // All the things\n      displayEntries = logEntries;\n      break;\n\n    case ChannelType.town:\n      // Only town\n      displayEntries = logEntries.filter((lE) => lE.channel === LogChannel.town);\n      break;\n\n    case ChannelType.quest:\n      // Only the selected quest\n      displayEntries = logEntries.filter((lE) => lE.channel === LogChannel.quest && lE.channelContext === currentTab.channelContext);\n      break;\n  }\n\n\n  const getLogEntryRow = (logEntry: LogEntry) => {\n    const text = TextManager.get(logEntry.key, logEntry.context);\n\n    return (\n      <div className=\"entry\" key={logEntry.time}>\n        <Markdown>{text}</Markdown>\n      </div>\n    );\n  };\n\n  return (\n    <div className={`log${expanded ? ' expanded' : ''}`}>\n      <div className=\"tab-bar\">\n        <Tabstrip className=\"tabs\" onTabSelected={handleTabSelected} activeTab={selectedTabId}>\n          {channels.map((tab) => {\n            return <Tab id={tab.tabId} key={tab.tabId}>{tab.label}</Tab>;\n          })}\n        </Tabstrip>\n        <Button\n          className=\"expand-button\"\n          onClick={handleToggleExpand}\n          square={true}\n          size=\"medium\"\n          text={expanded ? '▼' : '▲'}\n        />\n      </div>\n      <div className=\"log-entries\">\n        {displayEntries.map((entry) => getLogEntryRow(entry))}\n      </div>\n    </div>\n  );\n};\n\nexport default SimpleLog;\n\n","import WorldMap from 'components/world/WorldMap';\nimport { useEffect, useRef } from 'react';\nimport { Channel, MixMode, SoundManager } from 'global/SoundManager';\nimport QuestPanel from './QuestPanel';\nimport { useMatch, useNavigate } from 'react-router';\nimport { getWorldLink } from 'utils/routing';\nimport './styles/worldView.scss';\n\n/**\n * WorldView shows the map and QuestPanel\n * @param props\n */\nconst WorldView = () => {\n  const worldViewRef = useRef<HTMLDivElement>(null);\n  const match = useMatch(`${getWorldLink()}/:questname`);\n  const selectedQuestName = match?.params.questname;\n  const navigate = useNavigate();\n\n  useEffect(() => {\n    SoundManager.addSound('music/world', 'sound/music/TheLoomingBattle.ogg', () => {\n      SoundManager.playSound('music/world', Channel.music, true, MixMode.fade, true);\n    });\n  }, []);\n\n  // const handleMapMove = (distance: number, angle: number) => {\n  //   const compassEl = compassRef!.current!;\n  //   const compassTextEl = compassEl.firstElementChild! as HTMLElement;\n\n  //   // Rotate the compass\n  //   compassEl.style.transform = `rotate(${angle - (Math.PI / 2)}rad)`;\n  //   compassEl.style.opacity = distance > 10 ? \"1\" : \"0\";\n  //   compassTextEl.style.transform = `rotate(${-angle + (Math.PI / 2)}rad)`;\n  //   compassTextEl.innerHTML = `${distance.toFixed(0)}`;\n  // };\n\n  // const handleCompassClick = () => {\n  //   //setScrollToPosition(new Vector2(1, 1));\n  // };\n\n  const handlePartyClick = (questName: string) => {\n    // if (questName === selectedQuestName) {\n    //   history.push(getWorldLink());\n    // } else {\n    navigate(questName);\n    // }\n    SoundManager.playSound('ui/buttonClick');\n  };\n\n  const handleRetrieveWorldViewRef = () => {\n    return worldViewRef;\n  };\n\n  return (\n    <div className=\"world-view\" ref={worldViewRef}>\n      {/* <div className=\"compass\" ref={compassRef} onClick={handleCompassClick}>\n        <div className=\"distance\"/>\n      </div> */}\n      <WorldMap\n        selectedQuestName={selectedQuestName}\n        // onMapMove={handleMapMove}\n        smallMap={selectedQuestName != null}\n        onPartyClick={handlePartyClick}\n        retrieveWorldViewRef={handleRetrieveWorldViewRef}\n      />\n      { selectedQuestName && (\n        <QuestPanel questName={selectedQuestName} />\n      )}\n    </div>\n  );\n};\n\nexport default WorldView;\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { visit } from 'unist-util-visit';\n\nexport const reactMarkdownRemarkDirective = () => {\n  return (tree: any) => {\n    visit(\n      tree,\n      ['textDirective', 'leafDirective', 'containerDirective'],\n      (node: any) => {\n        node.data = {\n          hName: node.name,\n          hProperties: node.attributes,\n          ...node.data,\n        };\n        return node;\n      },\n    );\n  };\n};\n","import { ReactNode, useMemo } from 'react';\nimport { ContextType } from 'constants/context';\nimport { TextManager } from 'global/TextManager';\nimport { TooltipManager } from 'global/TooltipManager';\nimport { ElementContent } from 'react-markdown/lib/ast-to-react';\nimport { getDefinition } from 'definitions/items';\nimport { Rarity } from 'constants/items';\n\ntype Props = {\n  children: ReactNode[]\n};\n\nconst getRarityClassName = (rarity?: Rarity): string => {\n  switch (rarity) {\n    case Rarity.common:\n      return 'item-trigger-common';\n    case Rarity.uncommon:\n      return 'item-trigger-uncommon';\n    case Rarity.rare:\n      return 'item-trigger-rare';\n    case Rarity.epic:\n      return 'item-trigger-epic';\n    case Rarity.legendary:\n      return 'item-trigger-legendary';\n  }\n  return '';\n};\n\n// To be used inside Markdown component\nconst ItemElement = (props: Props) => {\n  const { children } = props;\n\n  const item = useMemo(() => {\n    if (typeof children[0] === 'string') {\n      return JSON.parse(children[0]);\n    }\n  }, [children]);\n\n  const definition = useMemo(() => {\n    if (!item) return;\n    return getDefinition(item.type);\n  }, [item]);\n\n  const handleClick = (event: React.MouseEvent) => {\n    const origin = (event.currentTarget as HTMLElement);\n    const originRect = origin.getBoundingClientRect();\n\n    TooltipManager.showContextTooltip(ContextType.item, item, originRect);\n    event.stopPropagation();\n  };\n\n  return (\n    <>\n      [\n      <span className={`trigger ${getRarityClassName(definition?.rarity)}`} onClick={handleClick}>\n        {TextManager.getItemName(item)}\n      </span>\n      ]\n    </>\n  );\n};\n\nexport default ItemElement;\n\ndeclare global {\n  // eslint-disable-next-line @typescript-eslint/no-namespace\n  namespace JSX {\n    interface IntrinsicElements {\n      'item': ElementContent[]\n    }\n  }\n}\n","import ReactMarkdown from 'react-markdown';\nimport directive from 'remark-directive';\nimport { reactMarkdownRemarkDirective } from '../../utils/markdown';\nimport ItemElement from './ItemElement';\nimport './styles/markdown.scss';\n\ntype Props = {\n  children: string\n};\n\nconst Markdown = (props: Props) => {\n  const { children } = props;\n  return (\n    <ReactMarkdown\n      className=\"markdown\"\n      remarkPlugins={[directive, reactMarkdownRemarkDirective]}\n      components={{ item: ItemElement }}\n    >{children}</ReactMarkdown>\n  );\n};\n\nexport default Markdown;\n","import React, { PropsWithChildren, useEffect, useRef, useState } from 'react';\nimport { TooltipManager } from 'global/TooltipManager';\nimport { InfoWindow } from 'components/ui/modals/InfoWindow';\nimport './styles/tooltip.scss';\n\nconst ARROW_SIZE = 8; // warning: sync to tooltip.css var\nconst PADDING = 8;\n\nexport interface Props {\n  referenceRect: DOMRect;  // place tooltip in reference to this rect\n  placement?: Placement;\n  className?: string;\n}\n\nexport enum Placement {\n  bottom,\n  top,\n  left,\n  right,\n}\n\nexport const Tooltip = (props: PropsWithChildren<Props>) => {\n  const { children, referenceRect } = props;\n  let { className = '' } = props;\n  const ref = useRef<HTMLDivElement>(null);\n  const [placement, setPlacement] = useState<Placement>(props.placement || Placement.bottom);\n\n  const [containerRect, setContainerRect] = useState<DOMRect>(); // This is the\n\n  useEffect(() => {\n    // Reposition if needed\n    const tooltipElement = ref.current;\n    if (!tooltipElement) return;\n    if (!containerRect || !containerRect) return;\n    const tooltipRect = tooltipElement.getBoundingClientRect();\n\n    // Flip vertically\n    switch (placement) {\n      case Placement.top:\n        if (tooltipRect.top - tooltipRect.height - ARROW_SIZE - PADDING < containerRect.top) {\n          // Too high, place underneath\n          setPlacement(Placement.bottom);\n          return;\n        }\n        break;\n      case Placement.bottom:\n        if (tooltipRect.top + tooltipRect.height + ARROW_SIZE + PADDING > containerRect.height) {\n          // Too low, place top\n          setPlacement(Placement.top);\n          return;\n        }\n        break;\n    }\n    tooltipElement.style.opacity = '1'; // animated through css\n\n    const contentElement = tooltipElement.querySelector('.tooltip-content') as HTMLElement;\n    if (tooltipRect.left < containerRect.left + PADDING) {\n      // Check left bounding edge\n      const offset = containerRect.left - tooltipRect.left + PADDING;\n      contentElement.style.transform = `translateX(${offset}px)`;\n    } else if (tooltipRect.right > containerRect.right - PADDING) {\n      // Check right bounding edge\n      const offset = tooltipRect.right - containerRect.right + PADDING;\n      contentElement.style.transform = `translateX(${-offset}px)`;\n    } else {\n      contentElement.style.transform = '';\n    }\n\n  }, [setPlacement, containerRect, placement, referenceRect]);\n\n  const resize = () => {\n    TooltipManager.clear();\n  };\n\n  useEffect(() => {\n    setContainerRect(ref.current?.closest('.app')?.getBoundingClientRect());\n\n    window.addEventListener('resize', resize);\n    return () => {\n      window.removeEventListener('resize', resize);\n    };\n  }, []);\n\n\n  let x = 0;\n  let y = 0;\n\n  if (containerRect) {\n    switch (placement) {\n      case Placement.bottom:\n        x = referenceRect.left - containerRect.left + referenceRect.width / 2;\n        y = referenceRect.top - containerRect.top + referenceRect.height;\n        className += ' tooltip-bottom';\n        break;\n      case Placement.top:\n        x = referenceRect.left - containerRect.left + referenceRect.width / 2;\n        y = referenceRect.top - containerRect.top;\n        className += ' tooltip-top';\n        break;\n    }\n  }\n\n  return (\n    <div className={`tooltip ${className}`}\n      style={{\n        left: x,\n        opacity: 0,\n        top: y,\n      }}\n      ref={ref}\n    >\n      <div className=\"tooltip-arrow\" />\n      <InfoWindow className=\"tooltip-content\">\n        {children}\n      </InfoWindow>\n    </div>\n  );\n};\n\nexport default Tooltip;\n","import * as React from 'react';\nimport { useDispatch } from 'react-redux';\nimport { Structure } from 'definitions/structures';\nimport { subtractGold } from 'store/actions/gold';\nimport { startBuildingStructure, finishBuildingStructure } from 'store/actions/structures';\nimport { startTask } from 'store/actions/tasks';\nimport { TaskType } from 'store/types/task';\nimport { Deed, getDefinition as getDeedDefinition } from 'definitions/items/deeds';\nimport useGoldState from 'hooks/store/useGoldState';\nimport { useStructureDefinition, useStructureState } from 'hooks/store/structures';\nimport { StructureState } from 'store/types/structure';\nimport { TextManager } from 'global/TextManager';\nimport Button from 'components/ui/buttons/Button';\nimport { Item } from 'definitions/items/types';\n\ninterface Props {\n  item: Item<Deed>;\n}\n\nconst DeedContent = (props: Props) => {\n  const { item } = props;\n  const definition = getDeedDefinition(item.type);\n  const dispatch = useDispatch();\n\n  const gold = useGoldState();\n  const structureDefinition = useStructureDefinition(definition.structure);\n  const enoughGold = structureDefinition.cost.gold || 0 <= gold;\n  const structureStoreState = useStructureState(definition.structure);\n  const canBeBuilt = structureStoreState.state === StructureState.NotBuilt;\n  const disabled = !canBeBuilt || !enoughGold;\n  const subtext = TextManager.getItemSubtext(item.type);\n\n  const handleStartConstruction = (structure: Structure) => {\n\n    dispatch(subtractGold(structureDefinition.cost.gold || 0));\n    dispatch(startBuildingStructure(structure));\n\n    const callbacks = [ finishBuildingStructure(structure) ];\n    const time = structureDefinition.cost.time;\n    const start = startTask(TaskType.buildStructure,\n      `${structure}.build`,\n      'town',\n      time ?? 0,\n      callbacks);\n    dispatch(start);\n  };\n  return (\n    <div>\n      { subtext && (<p className=\"subtext\">{`\"${subtext}\"`}</p>)}\n      <Button\n        disabled={disabled}\n        size=\"small\"\n        onClick={() => handleStartConstruction(definition.structure)}\n      >\n        Start construction ({ structureDefinition.cost.gold } gold)\n      </Button>\n    </div>\n  );\n\n};\n\nexport default DeedContent;\n","import * as time from 'utils/format/time';\n\nexport const STUDY_TIME = time.TWO_MINUTES;","import { ItemType } from 'definitions/items/types';\nimport { getDefinition as getProductionDefinition } from 'definitions/production';\nimport { useStructureState } from 'hooks/store/structures';\nimport { Structure } from 'definitions/structures';\nimport { ProducableItem, ProductionStructureStoreState, StructureState } from 'store/types/structure';\nimport { Link } from 'react-router-dom';\nimport { getStructureLink } from 'utils/routing';\nimport { TextManager } from 'global/TextManager';\nimport { useStudyingTasksStateByStructure } from 'hooks/store/useTasksState';\nimport { startTask } from 'store/actions/tasks';\nimport { TaskType } from 'store/types/task';\nimport { useDispatch } from 'react-redux';\nimport { addItemToToProduces } from 'store/actions/structures';\nimport { formatDuration } from 'utils/format/time';\nimport { STUDY_TIME } from 'mechanics/studying';\nimport Button from 'components/ui/buttons/Button';\nimport ReactMarkdown from 'react-markdown';\n\n\ninterface Props {\n  item: ProducableItem;\n  structure: Structure;\n}\n\n// refactor 2021-02-19 becomes 'CraftedAtStructure'\nconst ProducedAtStructure = (props: Props) => {\n  const { structure } = props;\n  const structureStore: ProductionStructureStoreState = useStructureState(structure);\n  const studyTasks = useStudyingTasksStateByStructure(structure);\n  const dispatch = useDispatch();\n\n  if (!structure) {\n    return null;\n  }\n\n  // const structureDefinition = getStructureDefinition<ProductionStructureDefinition>(structure);\n  // Can already be produced\n  if (structureStore.produces.some((item: ItemType) => item === props.item)){\n    return (\n      <p>Constructed at:&nbsp;\n        <Link to={getStructureLink(structure)} >\n          { TextManager.getStructureName(structure) }\n        </Link>\n      </p>\n    );\n  }\n\n  // Currently studied\n  const task = studyTasks.find(sT => sT.name === props.item);\n  if (task) {\n    return (\n      <p>\n        <Link to={getStructureLink(structure)} >\n          {TextManager.get('ui-tooltip-study-currently-studying')}\n        </Link>\n        {formatDuration(task.timeRemaining, true)}\n      </p>\n    );\n  }\n\n  // Cant study because the structure is not high lvl enough\n  const productionDefinition = getProductionDefinition(props.item);\n  if (structureStore.level < (productionDefinition.levelRequired || 0) || structureStore.state !== StructureState.Built) {\n\n    return (\n      <p className=\"invalid\">\n        {TextManager.get('ui-tooltip-study-requires-structure-level', { structure, level: (productionDefinition.levelRequired || 0) + 1 })}\n      </p>\n    );\n  }\n\n  const startStudy = () => {\n    const callbacks = [\n      addItemToToProduces(props.structure, props.item),\n    ];\n\n    const studyTime = STUDY_TIME;\n    const start = startTask(TaskType.studyItem,\n      props.item,\n      `${structure}.study`,\n      studyTime,\n      callbacks);\n    dispatch(start);\n  };\n\n  return (\n    <p>\n      <Button onClick={startStudy} size=\"small\">\n        {TextManager.get('ui-tooltip-study-start-study')}\n      </Button>\n      <ReactMarkdown>{TextManager.get('ui-tooltip-study-start', { structure })}</ReactMarkdown>\n    </p>\n  );\n};\n\nexport default ProducedAtStructure;\n","import { getProductionStructureForItem } from 'definitions/production';\nimport { ProducableItem } from 'store/types/structure';\nimport { getDefinition as getItemDefinition } from 'definitions/items';\nimport ProducedAtStructure from './ProducedAtStructure';\nimport { TextManager } from 'global/TextManager';\n\ninterface Props {\n  item: ProducableItem;\n}\n\nconst ProduceOrStudy = (props: Props) => {\n  const structure = getProductionStructureForItem(props.item);\n  const itemDefinition = getItemDefinition(props.item);\n  if (itemDefinition.unique) {\n    return (\n      <p>{TextManager.get('ui-tooltip-unique-item')}</p>\n    );\n  }\n  if (!structure) {\n    return null;\n  }\n  return (\n    <ProducedAtStructure item={props.item} structure={structure} />\n  );\n};\n\n\nexport default ProduceOrStudy;\n","import { Fragment } from 'react';\nimport { TextManager } from 'global/TextManager';\nimport { DamageDefinition } from 'definitions/weaponTypes/types';\n\ninterface Props {\n  damage: DamageDefinition;\n}\n\nconst DamageList = (props: Props) => {\n  const { damage } = props;\n  return (\n    <dl>\n      {Object.entries(damage).map(([dmgType, dmg]) => (\n        <Fragment key={dmgType}>\n          <dd>{TextManager.get(`damage-type-${dmgType}`)}</dd>\n          <dt>{dmg}</dt>\n        </Fragment>\n      ))}\n    </dl>\n  );\n};\n\nexport default DamageList;\n","import { Effect, EffectType } from 'definitions/effects/types';\nimport { TextManager } from 'global/TextManager';\n\n// todo: move somewhere else\nconst getEffectDescription = ( effect: Effect) => {\n  switch (effect.type) {\n    case EffectType.attributeIncrease: {\n      const attribute = TextManager.getAttributeName(effect.attribute);\n      const percentage = (effect.factor * 100 - 100).toFixed( );\n\n      return TextManager.getEffectDescription(effect, { attribute, percentage });\n    }\n    case EffectType.healthDecreaseOverTime: {\n      const interval = (effect.interval / 1000).toFixed( );\n      return TextManager.getEffectDescription(effect, { interval });\n    }\n    case EffectType.healthDecreaseOnMove: {\n      return TextManager.getEffectDescription(effect);\n    }\n  }\n};\nexport default getEffectDescription;\n","import { Effect } from 'definitions/effects/types';\nimport getEffectDescription from '../TempEffectContext/getEffectDescription';\n\ninterface Props {\n  effects: Effect[];\n}\n\n// Displays list of effects\nconst Effects = (props: Props) => {\n  const { effects } = props;\n  // const definition = getApparelDefinition(item.type)\n\n  return (\n    <ul>\n      {effects.map((e, i) => (\n        <li key={`${e.type}${i}`}>\n          {getEffectDescription(e)}\n        </li>\n      ))}\n    </ul>\n  );\n};\n\nexport default Effects;\n","import { getDefinition } from 'definitions/weaponTypes';\nimport { WeaponType } from 'definitions/weaponTypes/types';\nimport { TextManager } from 'global/TextManager';\nimport { getDefinition as getAbilityDefinition } from 'definitions/abilities/index';\n\ntype Props = {\n  weaponType: WeaponType;\n};\n\nconst AbilitiesList = (props: Props) => {\n  const { weaponType } = props;\n  const { abilities } = getDefinition(weaponType);\n  return (\n    <ul className=\"abilities-list\">\n      {abilities.map((ability) => {\n        const definition = getAbilityDefinition(ability);\n        return (\n          <li key={ability}>\n            {TextManager.getAbilityName(ability)}\n            {' '}\n            <span className=\"passive\">\n              {!!definition.passive && '(passive)'}\n            </span>\n          </li>\n        );\n      })}\n    </ul>\n  );\n};\n\nexport default AbilitiesList;\n","import { getDefinition as getWeaponDefinition, Weapon } from 'definitions/items/weapons';\nimport { TextManager } from 'global/TextManager';\nimport ProduceOrStudy from '../common/ProduceOrStudy';\nimport { Item } from 'definitions/items/types';\nimport DamageList from './DamageList';\nimport Effects from '../Effects';\nimport { getDefinition as getWeaponTypeDefinition } from 'definitions/weaponTypes';\nimport { WeaponType } from 'definitions/weaponTypes/types';\nimport AbilitiesList from './AbilitiesList';\nimport './styles/weaponContent.scss';\n\ninterface Props {\n  item: Item<Weapon>;\n}\n\nconst WeaponContent = (props: Props) => {\n  const { item } = props;\n  const definition = getWeaponDefinition(item.type);\n\n  const subtext = TextManager.getItemSubtext(item.type);\n  const weaponType = TextManager.getWeaponType(definition.weaponType);\n  const { classification } = getWeaponTypeDefinition(definition.weaponType);\n  const classificationText = TextManager.getWeaponClassification(classification);\n\n  return (\n    <div className=\"weapon-content\">\n      <div className=\"subheader\">{weaponType}\n        {definition.weaponType !== WeaponType.shield && (` (${classificationText})`)}\n      </div>\n      <hr />\n      { definition.damage && <DamageList damage={definition.damage} /> }\n      { !!(definition.effects?.length) && (\n        <Effects effects={definition.effects}/>\n      )}\n      <hr />\n      <AbilitiesList weaponType={definition.weaponType} />\n      <hr />\n      <ProduceOrStudy item={item.type} />\n      { subtext && (\n        <>\n          <hr />\n          <p className=\"secondary\">{`\"${subtext}\"`}</p>\n        </>\n      )}\n    </div>\n  );\n\n};\n\nexport default WeaponContent;\n","import { TextManager } from 'global/TextManager';\nimport { Apparel, getDefinition as getApparelDefinition } from 'definitions/items/apparel';\nimport ProduceOrStudy from './common/ProduceOrStudy';\nimport { Item } from 'definitions/items/types';\nimport Effects from './Effects';\n\ninterface Props {\n  item: Item<Apparel>;\n}\n\nconst ApparelContent = (props: Props) => {\n  const { item } = props;\n  const definition = getApparelDefinition(item.type);\n\n  const { damageReduction } = definition;\n  const subtext = TextManager.getItemSubtext(item.type);\n  const equipmentSlot = TextManager.getEquipmentSlot(definition.equipmentType);\n  const { durability = 1 } = item;\n\n  return (\n    <>\n      <div className=\"subheader\">{`${equipmentSlot}`}</div>\n      { subtext && (<p className=\"secondary\">{`\"${subtext}\"`}</p>)}\n      <hr />\n      { damageReduction && <p> { TextManager.get('ui-tooltip-damage-reduction', { damageReduction }) } </p> }\n      { !!(definition.effects?.length) && (\n        <Effects effects={definition.effects}/>\n      )}\n      <dl>\n        <dt>{TextManager.get('ui-tooltip-durability')}</dt>\n        <dd>{(durability * 100).toFixed(0)}%</dd>\n      </dl>\n      <ProduceOrStudy item={item.type} />\n    </>\n  );\n};\n\nexport default ApparelContent;\n","import * as React from 'react';\nimport { TextManager } from 'global/TextManager';\nimport { Consumable } from 'definitions/items/consumables';\nimport { ItemSource } from 'constants/items';\nimport { Item } from 'definitions/items/types';\n\n\ninterface Props {\n  item: Item<Consumable>;\n  source?: ItemSource;\n}\n\nconst ConsumableContent = (props: Props) => {\n  const { item } = props;\n  const subtext = TextManager.getItemSubtext(item.type);\n\n  return (\n    <div>\n      { subtext && (<p className=\"subtext\">{`\"${subtext}\"`}</p>)}\n    </div>\n  );\n\n};\n\nexport default ConsumableContent;\n","import * as React from 'react';\nimport { Apparel, isApparel } from 'definitions/items/apparel';\nimport { Deed, isDeed } from 'definitions/items/deeds';\nimport { Item } from 'definitions/items/types';\nimport { isWeapon, Weapon } from 'definitions/items/weapons';\nimport DeedContent from './DeedContent';\nimport WeaponContent from './WeaponContent';\nimport ApparelContent from './ApparelContent';\nimport { TextManager } from 'global/TextManager';\nimport { Consumable, isConsumable } from 'definitions/items/consumables';\nimport ConsumableContent from './ConsumableContent';\nimport { ItemSource } from 'constants/items';\n\nexport interface Props {\n  item: Item;\n  source?: ItemSource;\n}\n\nconst ItemContext = (props: Props) => {\n  const { item, source } = props;\n\n  if (isDeed(item.type)) {\n    return <DeedContent item={item as Item<Deed>} />;\n  }\n  if (isWeapon(item.type)) {\n    return <WeaponContent item={item as Item<Weapon>} />;\n  }\n  if (isApparel(item.type)) {\n    return <ApparelContent item={item as Item<Apparel>} />;\n  }\n  if (isConsumable(item.type)) {\n    return <ConsumableContent item={item as Item<Consumable>} source={source} />;\n  }\n  const subtext = TextManager.getItemSubtext(item.type);\n  return (subtext && (<p className=\"subtext\">{`\"${subtext}\"`}</p>)) || null;\n};\nexport default ItemContext;\n","import * as React from 'react';\nimport { TextManager } from 'global/TextManager';\nimport { useSelector } from 'react-redux';\nimport { StoreState } from 'store/types';\nimport { StructuresStoreState } from 'store/types/structures';\nimport { Resource } from 'definitions/resources';\nimport { getStructureByResource, getDefinition } from 'definitions/structures';\nimport { StructureState, StructureStoreState } from 'store/types/structure';\nimport { ResourceStructureLevelDefinition, ResourceStructureDefinition } from 'definitions/structures/types';\nimport { useMaxResourcesState, useResourcesState } from 'hooks/store/resources';\nimport { formatNumber } from 'utils/format/number';\nimport useGoldState from 'hooks/store/useGoldState';\nimport { useWorkersFreeState, useWorkersState } from 'hooks/store/useWorkersState';\nimport ReactMarkdown from 'react-markdown';\nimport './resourceContext.scss';\n\nexport interface Props {\n  info: string;\n}\n\nconst ResourceContext = (props: Props) => {\n\n  const resource = props.info;\n  const resourcesState = useResourcesState();\n  const goldState = useGoldState();\n  const workersState = useWorkersState();\n  const workersFreeState = useWorkersFreeState();\n  const structureStates = useSelector<StoreState, StructuresStoreState>(store => store.structures);\n  const maxResources = useMaxResourcesState();\n\n  const renderProducedBy = () => {\n    const structure = getStructureByResource(resource as Resource);\n    const structureState: StructureStoreState = structureStates[structure];\n    if (structureState.state !== StructureState.Built) {\n      return (\n        <span>\n          {TextManager.get('ui-tooltip-resource-produce-row-notbuilt', {\n            structure: TextManager.getStructureName(structure),\n          })}\n        </span>\n      );\n    }\n    const structureDefinition = getDefinition<ResourceStructureDefinition>(structure);\n    const levelDefinition: ResourceStructureLevelDefinition = structureDefinition.levels[structureState.level];\n    const amount = levelDefinition.generates[resource as Resource];\n\n    return (\n      <span className=\"produced\">\n        <ReactMarkdown components={{ p: 'span' }}>\n          {TextManager.get('ui-tooltip-resource-produce-row', {\n            structure,\n            amount,\n          })}\n        </ReactMarkdown>\n      </span>\n    );\n  };\n\n  switch (resource) {\n    case Resource.fabric:\n    case Resource.food:\n    case Resource.iron:\n    case Resource.leather:\n    case Resource.stone:\n    case Resource.wood: {\n      const amount = formatNumber(resourcesState[resource] ?? 0, 0);\n      const full = (resourcesState[resource] ?? 0) >= (maxResources?.[resource] ?? 0);\n      return (\n        <div className=\"resource-context\">\n          <hr />\n          <div className=\"subheader\">\n            {TextManager.get('ui-tooltip-resource-quantity', { amount } )}\n          </div>\n          <div>\n            {renderProducedBy()}\n          </div>\n          { full && (\n            <div className=\"warning-full\">\n              {TextManager.get('ui-tooltip-resource-warehouse-full', { resource })}\n            </div>\n          )}\n          <hr />\n          <p className=\"secondary\">\n            {TextManager.get(`resource-${resource}-info`)}\n          </p>\n        </div>\n      );\n    }\n    case 'gold': {\n      const amount = goldState;\n      return (\n        <>\n          <div className=\"resource-context\">\n            <div>\n              {TextManager.get('ui-tooltip-resource-quantity', { amount } )}\n            </div>\n            <p className=\"secondary\">\n              {` ${TextManager.get(`resource-${resource}-info`)}`}\n            </p>\n          </div>\n        </>\n      );\n    }\n    case 'workers': {\n      const free = workersFreeState;\n      const total = workersState;\n      return (\n        <>\n          <div className=\"resource-context\">\n            <div>\n              {TextManager.get('ui-tooltip-workers-quantity', { free, total } )}\n            </div>\n            <p className=\"secondary\">\n            {` ${TextManager.get(`resource-${resource}-info`)}`}\n            </p>\n          </div>\n        </>\n      );\n    }\n    default:\n      throw new Error('Uknow value ' + resource);\n  }\n\n};\nexport default ResourceContext;\n","import React, { ComponentProps, PropsWithChildren } from 'react';\nimport './styles/infoWindow.scss';\n\nexport interface Props {\n  className?: string;\n}\n\n// An InfoWindow is a semi transparant black square. It is used for tooltips\n// and InfoModal\nexport const InfoWindow = (props: PropsWithChildren<Props> & ComponentProps<'div'>) => {\n  const { className, children, ...otherProps } = props;\n  return (\n    <div\n      {...otherProps}\n      className={`info-window ${className || ''}`}\n    >\n      {children}\n    </div>\n  );\n};\n","import * as PIXI from 'pixi.js';\nimport { AppContextProps } from 'hoc/withAppContext';\nimport { useRef, useState, createContext, useEffect, useContext, ReactElement, cloneElement } from 'react';\nimport { DndProvider } from 'react-dnd';\nimport { HTML5Backend } from 'react-dnd-html5-backend';\nimport { HashRouter, Navigate } from 'react-router-dom';\nimport {\n  Routes,\n  Route,\n  Link,\n} from 'react-router-dom';\nimport { PixiPlugin } from 'gsap/all';\nimport { gsap } from 'gsap';\nimport { SoundManager } from 'global/SoundManager';\nimport { TextManager } from 'global/TextManager';\nimport debounce from 'debounce';\nimport TownView from 'components/town/TownView';\nimport Toasts from 'components/ui/toasts/Toasts';\nimport Topbar from 'components/ui/topbar/Topbar';\nimport WorldView from 'components/world/WorldView';\nimport SimpleLog from 'components/log/SimpleLog';\nimport ContextTooltip from 'components/ui/tooltip/ContextTooltip';\nimport { TooltipManager } from 'global/TooltipManager';\nimport { getWorldLink, getTownLink } from 'utils/routing';\nimport Button, { ButtonColor } from 'components/ui/buttons/Button';\nimport Bubbles from 'components/ui/bubbles/Bubbles';\nimport { BubbleLayer } from 'global/BubbleManager';\nimport { GameActionsContext } from 'components/Game/context';\nimport DebugDrawer from 'components/debug/DebugDrawer';\nimport './styles/app.scss';\n\nPixiPlugin.registerPIXI(PIXI);\ngsap.registerPlugin(PixiPlugin);\n\n\ndeclare global {\n  interface Window { __PIXI_INSPECTOR_GLOBAL_HOOK__: { register: (x: { PIXI: typeof PIXI }) => void }; }\n}\nif (process.env.NODE_ENV === 'development') {\n  // Register pixi inspector chrome plugin\n  // https://chrome.google.com/webstore/detail/pixijs-devtools/aamddddknhcagpehecnhphigffljadon\n  window.__PIXI_INSPECTOR_GLOBAL_HOOK__?.register({ PIXI: PIXI });\n}\n\nexport enum View {\n  Town,\n  World,\n}\n\nexport const MAX_WIDTH = 960;\nexport const AppContext = createContext<AppContextProps | null>(null);\n\n\nconst App = () => {\n  const containerRef = useRef<HTMLDivElement>(null);\n  const { restartGame } = useContext(GameActionsContext);\n  const [activeWindows, setActiveWindows] = useState<ReactElement[]>([]);\n\n  const handleViewButtonClick = () => {\n    SoundManager.playSound('ui/buttonClick');\n  };\n\n  const handleRestartClick = () => {\n    restartGame();\n  };\n\n\n  const handleWindowOpened = (window: React.ReactElement) => {\n    setActiveWindows([\n      ...activeWindows || [],\n      window,\n    ]);\n  };\n\n  /**\n   * Closes all windows\n   */\n  const handleWindowClose = () => {\n    setActiveWindows([]);\n  };\n\n  /**\n   * Closes the top window of the stack\n   */\n  const handleWindowBack = () => {\n    if (activeWindows && activeWindows.length) {\n      setActiveWindows(activeWindows.slice(0, -1));\n    }\n  };\n\n  const renderWindow = (): ReactElement | null => {\n    if (!activeWindows.length) {\n      return null;\n    }\n\n    const topWindow = activeWindows[activeWindows.length - 1];\n    const commonWindowProps = {\n      onClose: handleWindowClose,\n      onBack: handleWindowBack,\n      backEnabled: activeWindows.length > 1,\n      closeEnabled: true,\n    };\n\n    const element = cloneElement(topWindow, commonWindowProps);\n    return element;\n  };\n\n  useEffect(() => {\n    SoundManager.addSound('ui/buttonClick', 'sound/ui/button-click.ogg');\n    SoundManager.addSound('ui/equip', 'sound/ui/equip.mp3');\n    SoundManager.addSound('ui/error', 'sound/ui/error.ogg');\n    SoundManager.addSound('ui/levelUp', 'sound/ui/level-up.ogg');\n    SoundManager.addSound('ui/toast', 'sound/ui/toast.ogg');\n\n    SoundManager.addSound('scene/drinking', 'sound/scene/drinking.ogg');\n  }, []);\n\n  const handleAppClick = () => {\n    TooltipManager.clear();\n  };\n\n  useEffect(() => {\n    const handleScroll = debounce(() => {\n      TooltipManager.clear();\n    }, 100);\n    window.addEventListener('scroll', handleScroll);\n    window.addEventListener('wheel', handleScroll);\n    return () => {\n      window.removeEventListener('resize', handleScroll);\n      window.removeEventListener('wheel', handleScroll);\n    };\n  }, []);\n\n  return (\n    <AppContext.Provider value={{\n      onOpenWindow: handleWindowOpened,\n      onCloseWindow: handleWindowClose,\n    }} >\n      <div\n        className=\"app\"\n        ref={containerRef}\n        style={{\n          maxWidth: MAX_WIDTH,\n        }}\n        onClick={handleAppClick}\n      >\n        {/* <QuestRepaintTester /> */}\n        <DndProvider backend={HTML5Backend}>\n        <HashRouter>\n          <Topbar />\n          <div className=\"control-bar\">\n            <Routes>\n              <Route path=\"/\" element={(\n                <Navigate to={getWorldLink()} />\n              )}>\n                {/* <Redirect from=\"/\" to={getWorldLink()} /> */}\n              </Route>\n              <Route path={`${getWorldLink()}/*`} element={(\n                <Link to={getTownLink()}>\n                  <Button onClick={() => handleViewButtonClick()} color=\"green\"> {TextManager.get('ui-view-button-town')} </Button>\n                </Link>)}\n              />\n              <Route path={`${getTownLink()}/*`} element={(\n                <Link to={getWorldLink()}>\n                  <Button onClick={() => handleViewButtonClick()} color=\"green\"> {TextManager.get('ui-view-button-world')} </Button>\n                </Link>)}\n              />\n            </Routes>\n            {' | '}\n            <Button onClick={() => handleRestartClick()} color={ButtonColor.purple} > Restart! </Button>\n          </div>\n          <Routes>\n            <Route path={`${getTownLink()}/*`} element={(<TownView />)} />\n            <Route path={`${getWorldLink()}/*`} element={(<WorldView />)} />\n          </Routes>\n          <SimpleLog/>\n          {renderWindow()}\n          <DebugDrawer />\n          <ContextTooltip />\n          <Toasts />\n          <Bubbles layer={BubbleLayer.general} />\n        </HashRouter>\n        </DndProvider>\n      </div>\n    </AppContext.Provider>\n  );\n};\n\nexport default App;\n","import * as React from 'react';\nimport { TextManager } from 'global/TextManager';\nimport { TraitDefinition } from 'definitions/traits/types';\nimport './styles/traitContext.scss';\n\nexport interface Props {\n  traitDefinition: TraitDefinition;\n}\n\nconst TraitContext = (props: Props) => {\n\n  const { traitDefinition } = props;\n\n  return (\n    <div className=\"trait-context\">\n      <div className=\"description\">\n        {TextManager.getTraitDescription(traitDefinition.trait)}\n      </div>\n      { traitDefinition.hasEffect && (\n      <div className=\"effect\">\n        {TextManager.getTraitEffect(traitDefinition.trait)}\n\n      </div>)}\n    </div>\n  );\n};\nexport default TraitContext;\n","import { Fragment } from 'react';\nimport { TextManager } from 'global/TextManager';\nimport { AttributeSourceType, ExtendedAttribute } from 'mechanics/adventurers/attributes';\nimport { roundIfNeeded } from 'utils/format/number';\nimport { renderOrigin } from './utils';\nimport './styles/attributeContext.scss';\n\nexport interface Props {\n  extendedAttribute: ExtendedAttribute;\n}\n\nconst AttributeContext = (props: Props) => {\n  const { extendedAttribute } = props;\n  return (\n    <div className=\"attribute-context\">\n      <hr />\n      <div className=\"mechanics\">\n        {TextManager.getAttributeMechanics(extendedAttribute.attribute)}\n      </div>\n      <hr />\n      <dl className=\"values\">\n        {extendedAttribute.components.map((eAC, i) => {\n          const origin = renderOrigin(eAC.origin, extendedAttribute.attribute);\n          return (\n            <Fragment key={eAC.origin.type + i}>\n              <dt title={origin}>{origin}</dt>\n              <dd className={eAC.origin.type === AttributeSourceType.base ? 'base' : 'additional'}>{roundIfNeeded(eAC.value)}</dd>\n            </Fragment>\n          );\n        })}\n      </dl>\n      <hr />\n      <div className=\"description\">\n        {TextManager.getAttributeDescription(extendedAttribute.attribute)}\n      </div>\n    </div>\n  );\n};\nexport default AttributeContext;\n","import { TextManager } from 'global/TextManager';\nimport { AttributeSource, AttributeSourceType } from 'mechanics/adventurers/attributes';\nimport { Attribute } from 'store/types/adventurer';\n\nexport const renderOrigin = (origin: AttributeSource, attribute: Attribute) => {\n  switch (origin.type) {\n    case AttributeSourceType.base:\n      return `base ${TextManager.getAttributeName(attribute)}`;\n    case AttributeSourceType.tempEffect:\n      return 'soma'; // todo: split out which tempEffect\n    case AttributeSourceType.item:\n      return TextManager.getItemName(origin.item);\n  }\n};\n","import { useMemo } from 'react';\nimport { useAdventurer } from 'hooks/store/adventurers';\nimport { AdventurerObject } from 'store/types/scene';\nimport Attributes from 'components/ui/attributes/AttributeList';\nimport { xpToLevel } from 'mechanics/adventurers/levels';\nimport { TextManager } from 'global/TextManager';\nimport CombatAttributes from './CombatAttributes';\nimport { calculateEffectiveAttributes, calculateEffectiveAttributesExtended } from 'mechanics/adventurers/attributes';\n\ninterface Props {\n  actorObject: AdventurerObject\n}\n\nconst AdventurerContext = (props: Props) => {\n  const { actorObject } = props;\n  const adventurer = useAdventurer(actorObject.adventurerId);\n  const attributes = calculateEffectiveAttributes(adventurer);\n  const { name, xp } = adventurer;\n  const level = xpToLevel(xp);\n  const extendedAttributes = useMemo(() => calculateEffectiveAttributesExtended(adventurer), [adventurer]);\n\n  return (\n    <div>\n      <div className=\"name-and-level\">\n        <div className=\"name\">\n          {name}\n        </div>\n        <div className=\"level\">\n          {TextManager.get('ui-tooltip-actor-level', { level })}\n        </div>\n      </div>\n      <Attributes attributes={extendedAttributes} small />\n      <CombatAttributes attributes={attributes} level={level} />\n    </div>\n  );\n};\n\nexport default AdventurerContext;\n","import { EnemyObject } from 'store/types/scene';\nimport { getDefinition } from 'definitions/enemies';\nimport { EnemyType } from 'definitions/enemies/types';\nimport { TextManager } from 'global/TextManager';\nimport Attributes from 'components/ui/attributes/AttributeList';\nimport CombatAttributes from './CombatAttributes';\nimport { generateBaseAttributes } from 'mechanics/adventurers/attributes';\nimport { calculateBaseHitpoints } from 'mechanics/adventurers/hitpoints';\nimport { formatNumber } from 'utils/format/number';\n\ninterface Props {\n  actorObject: EnemyObject\n}\n\nconst EnemyContext = (props: Props) => {\n  const { actorObject } = props;\n  const definition = getDefinition(actorObject.enemyType as EnemyType);\n  const level = actorObject.level ?? 1;\n  const attributesExtended = generateBaseAttributes(definition.attributes);\n\n  return (\n    <div>\n      <div className=\"name-and-level\">\n        <div className=\"name\">\n          {TextManager.getEnemyName(actorObject.enemyType as EnemyType)}\n        </div>\n        <div className=\"level\">\n          {TextManager.get('ui-tooltip-actor-level', { level })}\n        </div>\n      </div>\n      <div>\n        <div>\n          health:\n        </div>\n        <div>\n          {formatNumber(actorObject.health, 2)}/\n          {calculateBaseHitpoints(actorObject.level ?? 1, definition.attributes.for)}\n        </div>\n      </div>\n      <Attributes attributes={attributesExtended} small />\n      <CombatAttributes attributes={definition.attributes} level={level} />\n    </div>\n  );\n};\n\nexport default EnemyContext;\n","import * as React from 'react';\nimport { ActorObject, Allegiance } from 'store/types/scene';\nimport AdventurerContext from './AdventurerContext';\nimport EnemyContext from './EnemyContext';\nimport './styles/actorContext.scss';\n\n\ninterface Props {\n  actorObject: ActorObject\n}\n\n// Shows stuff relevant for combat\nconst ActorContext = (props: Props) => {\n  const { actorObject } = props;\n  return (\n    <div className=\"actor-context\">\n      {actorObject.allegiance === Allegiance.player && (<AdventurerContext actorObject={actorObject} />)}\n      {actorObject.allegiance === Allegiance.enemy && (<EnemyContext actorObject={actorObject} />)}\n    </div>\n  );\n};\n\nexport default ActorContext;\n","import { TempEffect, TempEffectType } from 'definitions/tempEffects/types';\nimport { TextManager } from 'global/TextManager';\n\n\nconst getTempEffectDescription = (effect: TempEffect) => {\n\n  switch (effect.type) {\n    case TempEffectType.burning: {\n      const interval = (effect.interval / 1000).toFixed( );\n      return TextManager.getTempEffectDescription(effect, { interval });\n    }\n\n    case TempEffectType.brokenLegs:\n      return TextManager.getTempEffectDescription(effect);\n\n    case TempEffectType.soma: {\n      const percentage = (effect.factor * 100 - 100).toFixed( );\n      return TextManager.getTempEffectDescription(effect, { percentage });\n    }\n  }\n};\nexport default getTempEffectDescription;\n","import { TextManager } from 'global/TextManager';\nimport getTempEffectDescription from './getTempEffectDescription';\nimport { TempEffect } from 'definitions/tempEffects/types';\nimport './styles/effectContext.scss';\n\nexport interface Props {\n  effect: TempEffect;\n}\n\nconst EffectContext = (props: Props) => {\n  const { effect } = props;\n  const { charges } = effect;\n  return (\n    <div className=\"effect-context\">\n      <hr />\n\n      <div className=\"description\">\n         { getTempEffectDescription(effect)}\n      </div>\n      { /* show time remaining */ }\n      { charges && (\n        <div>\n          {TextManager.get(charges === 1 ? 'ui-tooltip-effect-one-charge-remains' : 'ui-tooltip-effect-n-charges-remain', { charges }) }\n        </div>\n      )}\n      <hr />\n      <div className=\"flavor secondary\">\n        {TextManager.getTempEffectFlavor(effect)}\n      </div>\n    </div>\n  );\n};\nexport default EffectContext;\n","import { Rarity } from 'constants/items';\nimport { ItemDefinition } from 'definitions/items/types';\n\nexport const getItemNameClassName = (item: ItemDefinition): string => {\n  const { rarity } = item;\n  switch (rarity) {\n    case Rarity.common:\n      return 'item-name-common';\n    case Rarity.uncommon:\n      return 'item-name-uncommon';\n    case Rarity.rare:\n      return 'item-name-rare';\n    case Rarity.epic:\n      return 'item-name-epic';\n    case Rarity.legendary:\n      return 'item-name-legendary';\n  }\n  return 'item-name-common';\n};\n","import { ReactNode, useEffect, useState } from 'react';\nimport { ContextType } from 'constants/context';\nimport { TooltipManager, Context, EVENT_CONTEXT_UPDATED } from 'global/TooltipManager';\nimport { TextManager } from 'global/TextManager';\nimport ItemContext from './context/ItemContext';\nimport { ItemDefinition, Item } from 'definitions/items/types';\nimport { Resource } from 'definitions/resources';\nimport ResourceContext from './context/ResourceContext';\nimport Tooltip from '../Tooltip';\nimport { TraitDefinition } from 'definitions/traits/types';\nimport TraitContext from './context/TraitContext';\nimport { getDefinition } from 'definitions/items';\nimport AttributeContext from './context/AttributeContext';\nimport { ActorObject } from 'store/types/scene';\nimport ActorContext from './context/ActorContext';\nimport TempEffectContext from './context/TempEffectContext';\nimport { ExtendedAttribute } from 'mechanics/adventurers/attributes';\nimport { TempEffect } from 'definitions/tempEffects/types';\nimport { getItemNameClassName } from './utils';\nimport { WeaponType } from 'definitions/weaponTypes/types';\nimport './styles/contextTooltip.scss';\n\n// A contextual popup showing what you just clicked.\n// Can be an Item, Resource, Trait, skill, etc\nconst ContextTooltip = () => {\n\n  const [selectedContext, setSelectedContext] = useState<Context | undefined>();\n\n  const tooltipUpdated = (context: Context | undefined) => {\n    setSelectedContext(context);\n  };\n  useEffect(() => {\n    TooltipManager.instance.addListener(EVENT_CONTEXT_UPDATED, tooltipUpdated);\n    return () => {\n      TooltipManager.instance.removeListener(EVENT_CONTEXT_UPDATED, tooltipUpdated);\n    };\n  }, []);\n  if (!selectedContext) { return null; }\n\n  const { info, type, className, source } = selectedContext;\n  const renderContent = () => {\n    switch (type) {\n      case ContextType.actor: {\n        return (\n          <ActorContext actorObject={info as ActorObject} />\n        );\n      }\n      case ContextType.attribute: {\n        const extendedAttribute = info as ExtendedAttribute;\n        const name = TextManager.getAttributeName(extendedAttribute.attribute);\n        return (\n          <>\n            <div className=\"header\">\n              <div className=\"name effect\">{name}</div>\n              <div className=\"secondary\">\n                { TextManager.get('ui-tooltip-attribute')}\n              </div>\n            </div>\n            <AttributeContext extendedAttribute={extendedAttribute} />\n          </>\n        );\n      }\n      case ContextType.tempEffect: {\n        const effect = info as TempEffect;\n        const name = TextManager.getTempEffectName(effect);\n        return (\n          <>\n            <div className=\"header\">\n              <div className=\"name effect\">{name}</div>\n              <div className=\"secondary\">\n                { TextManager.get('ui-tooltip-effect')}\n              </div>\n            </div>\n            <TempEffectContext effect={effect} />\n          </>\n        );\n      }\n      case ContextType.resource: {\n        const name = TextManager.getResourceName(info as Resource);\n        return (\n          <>\n            <div className=\"header\">\n              <div className=\"name resource\">{name}</div>\n              <div className=\"secondary\">\n                { TextManager.get('ui-tooltip-resource-resource')}\n              </div>\n            </div>\n            <ResourceContext info={info as string} />\n          </>\n        );\n      }\n      case ContextType.item: {\n        const item = info as Item;\n        const name = TextManager.getItemName(item.type);\n        const itemDefinition = getDefinition(item.type) as ItemDefinition;\n        return (\n          <>\n            <div className=\"header\">\n              <div className={`name item ${getItemNameClassName(itemDefinition)}`}>{name}</div>\n              <div className=\"secondary\">\n                {TextManager.getItemCategory(itemDefinition.itemCategory)}\n              </div>\n            </div>\n            <ItemContext item={item} source={source} />\n          </>\n        );\n      }\n      case ContextType.trait: {\n        const traitDefinition = info as TraitDefinition;\n        const name = TextManager.getTraitName(traitDefinition.trait);\n        return (\n          <>\n            <div className=\"name trait\">\n              {TextManager.get('ui-tooltip-type-trait')}\n              {name}\n            </div>\n            <TraitContext traitDefinition={traitDefinition} />\n          </>\n        );\n      }\n      case ContextType.skill: {\n        const skill = info as WeaponType;\n        const name = TextManager.getSkillName(skill);\n        return (\n          <>\n            <div className=\"name skill\">\n              {TextManager.get('ui-tooltip-type-skill')}\n              {name}\n            </div>\n            { TextManager.getSkillInfo(skill)}\n          </>\n        );\n      }\n      case ContextType.component: {\n        const component = info as ReactNode;\n        return component;\n      }\n      default: {\n        throw new Error(`Unknown context type ${selectedContext.type}`);\n      }\n    }\n  };\n\n  return (\n    <Tooltip referenceRect={selectedContext.referenceRect} className={className}>\n      <div className=\"context-tooltip\">\n        {renderContent()}\n      </div>\n    </Tooltip>\n  );\n};\nexport default ContextTooltip;\n","import { createContext } from 'react';\n\nexport type GameActionsContextProps = {\n  pauseGame: () => void,\n  continueGame: () => void,\n  restartGame: () => void,\n};\n\nconst emptyFn = () => undefined;\n\nexport const GameActionsContext = createContext<GameActionsContextProps>({\n  // values will all be overwritten in Game\n  pauseGame: emptyFn,\n  continueGame: emptyFn,\n  restartGame: emptyFn,\n});\n","import { IconSize } from 'components/ui/common/Icon';\nimport ItemIcon from 'components/ui/items/ItemIcon';\nimport { ApparelDefinition } from 'definitions/items/apparel';\nimport { ItemDefinition, ItemType } from 'definitions/items/types';\nimport { TextManager } from 'global/TextManager';\nimport { entries } from 'utils/typescript';\nimport './styles/debugItemsList.scss';\n\ntype Props = {\n  items: { [key: string]: ItemDefinition }\n};\n\nconst parseRarity = (input: unknown) => {\n  const object = input as Pick<ItemDefinition, 'rarity'>;\n  if (object.rarity !== undefined) {\n    return {\n      ...object,\n      rarity: `Rarity.${TextManager.getRarity(object.rarity)}`,\n    };\n  }\n  return object as unknown;\n};\n\nconst parseEquipmentType = (input: unknown ) => {\n  const object = input as Pick<ApparelDefinition, 'equipmentType'>;\n  if (object.equipmentType !== undefined) {\n    return {\n      ...object,\n      equipmentType: `EquipmentSlotType.${TextManager.getEquipmentSlot(object.equipmentType)}`,\n    };\n  }\n  return object as unknown;\n};\n\nconst parsers = [\n  parseRarity,\n  parseEquipmentType,\n];\n\nconst prepareText = (definition: ItemDefinition) => {\n\n  const text = parsers.reduce((acc, value) => {\n    return value(acc);\n  }, definition as unknown);\n\n  const asString = JSON.stringify(text, undefined, 2)\n    .replace(/\\n /g, '\\n')\n    .replace(/ \"/g, '\"')\n    .replace(/\\n {3}\\{/g, '{')\n    .replace(/\\n {4}/g, '\\n  ')\n    .replace(/\\n \\}/g, '\\n}')\n    .replace(/\\n {3}\\},/g, '\\n}, ')\n    .replace(/\\n {3}\\}\\n ]/g, '\\n}]');\n\n  return asString.substring(2, asString.length - 2);\n};\n\nconst DebugItemsList = (props: Props) => {\n  const { items } = props;\n  return (\n    <div className=\"debug-items-list\">\n      {entries(items).map(([key, value]) => {\n        return (\n          <div className=\"item\" key={key}>\n            <ItemIcon item={{ type: key as ItemType }} size={IconSize.big} />\n            <div className=\"info\">\n              <h4>{TextManager.getItemName(key as ItemType)}</h4>\n              <pre>\n                {prepareText(value)}\n              </pre>\n            </div>\n          </div>\n        );\n      })}\n    </div>\n  );\n};\n\nexport default DebugItemsList;\n\n\n\n","import Tab from 'components/ui/tabs/Tab';\nimport Tabstrip from 'components/ui/tabs/Tabstrip';\nimport { ItemCategory } from 'definitions/items/types';\nimport { TextManager } from 'global/TextManager';\nimport { useState } from 'react';\nimport { listEnum } from 'utils/typescript';\nimport ammunition from 'definitions/items/ammunition';\nimport apparel from 'definitions/items/apparel';\nimport deeds from 'definitions/items/deeds';\nimport herbs from 'definitions/items/herbs';\nimport materials from 'definitions/items/materials';\nimport minerals from 'definitions/items/minerals';\nimport consumables from 'definitions/items/consumables';\nimport questItems from 'definitions/items/questItems';\nimport trinkets from 'definitions/items/trinkets';\nimport weapons from 'definitions/items/weapons';\nimport DebugItemsList from './DebugItemsList';\n\nconst DebugItems = () => {\n  const [selected, setSelected] = useState<string>(`${listEnum(ItemCategory)[0]}`);\n\n  return (\n    <div className=\"debug-items content\">\n      <Tabstrip className=\"tabs auto-collapse\" onTabSelected={setSelected} activeTab={selected}>\n        {listEnum(ItemCategory).map((itemCategory) => {\n          return (\n          <Tab id={`${itemCategory}`} key={itemCategory}>\n            {TextManager.getItemCategory(itemCategory)}\n          </Tab>);\n        })}\n      </Tabstrip>\n      <div className=\"items\">\n        {selected === `${ItemCategory.ammunition}` && <DebugItemsList items={ammunition} />}\n        {selected === `${ItemCategory.apparel}` && <DebugItemsList items={apparel} />}\n        {selected === `${ItemCategory.deed}` && <DebugItemsList items={deeds} />}\n        {selected === `${ItemCategory.herb}` && <DebugItemsList items={herbs} />}\n        {selected === `${ItemCategory.material}` && <DebugItemsList items={materials} />}\n        {selected === `${ItemCategory.mineral}` && <DebugItemsList items={minerals} />}\n        {selected === `${ItemCategory.consumable}` && <DebugItemsList items={consumables} />}\n        {selected === `${ItemCategory.questItem}` && <DebugItemsList items={questItems} />}\n        {selected === `${ItemCategory.trinket}` && <DebugItemsList items={trinkets} />}\n        {selected === `${ItemCategory.weapon}` && <DebugItemsList items={weapons} />}\n      </div>\n    </div>\n  );\n};\n\nexport default DebugItems;\n","import SpriteAnimated from 'components/pixi/tile/SpriteAnimated';\nimport { Stage } from '@inlet/react-pixi';\nimport { Orientation } from 'components/world/QuestPanel/QuestDetails/scene/SceneActor';\nimport useFrames from 'components/world/QuestPanel/QuestDetails/scene/SceneActor/useFrames';\nimport { SPRITE_WIDTH } from 'components/world/QuestPanel/QuestDetails/scene/SceneActor/utils';\nimport { Animation } from 'components/world/QuestPanel/QuestDetails/scene/SceneActor/useAnimation';\nimport { useEffect, useRef, useState } from 'react';\nimport { AnimatedSprite } from 'pixi.js';\n\ntype Props = {\n  spritesheetPath: string;\n  animation: Animation;\n  orientation: Orientation;\n  currentFrame?: number;\n};\n\nconst options = {\n  autoDensity: true,\n  sharedLoader: true,\n};\n\nconst DebugSpriteDemo = (props: Props) => {\n  const { spritesheetPath, animation, orientation, currentFrame } = props;\n  const ref = useRef<AnimatedSprite>(null);\n\n  const frames = useFrames(spritesheetPath, animation, orientation);\n  const [flipped, setFlipped] = useState(false);\n\n  useEffect(() => {\n    setFlipped(orientation === Orientation.southWest || orientation === Orientation.west || orientation === Orientation.northWest);\n  }, [orientation]);\n\n  useEffect(() => {\n    if (currentFrame) {\n      ref.current?.gotoAndStop(currentFrame);\n    }\n  }, [currentFrame]);\n\n  return (\n    <Stage options={options} width={SPRITE_WIDTH * 2} height={SPRITE_WIDTH * 2}>\n      <SpriteAnimated\n        animationSpeed={0.1}\n        isPlaying={true}\n        textures={frames}\n        x={SPRITE_WIDTH}\n        y={SPRITE_WIDTH}\n        scale={[(flipped ? -1 : 1), 1]}\n        anchor={[.5, .5]}\n        pivot={[0, 0]}\n        ref={ref}\n      />\n    </Stage>\n  );\n};\n\nexport default DebugSpriteDemo;\n","import { useEffect, useState } from 'react';\nimport DebugSpriteDemo from './DebugSpriteDemo';\nimport { loadResourceAsync } from 'utils/pixiJs';\nimport LoadingSpinner from 'components/ui/loading/LoadingSpinner';\nimport { allAnimations, Animation } from 'components/world/QuestPanel/QuestDetails/scene/SceneActor/useAnimation';\nimport { Orientation } from 'components/world/QuestPanel/QuestDetails/scene/SceneActor';\nimport './styles/debugSprites.scss';\n\nconst allSpritesheets = ['elf-bow', 'knight-sword', 'orc-axe', 'skeleton', 'troll-axe', 'troll-sword'] as const;\ntype Spritesheet = typeof allSpritesheets[number];\n\nconst getSpritesheetPath = (spritesheet: Spritesheet) => `${process.env.PUBLIC_URL}/img/scene/actors/${spritesheet}.json`;\nconst allOrientations = [\n  Orientation.north,\n  Orientation.northEast,\n  Orientation.east,\n  Orientation.southEast,\n  Orientation.south,\n  Orientation.southWest,\n  Orientation.west,\n  Orientation.northWest,\n];\n\nconst DebugSprites = () => {\n  const [spritesheet, setSelected] = useState<Spritesheet>('elf-bow');\n  const [animation, setAnimation] = useState<Animation>('stand');\n  const [orientation, setOrientation] = useState<Orientation>(Orientation.north);\n  const [currentFrame, setCurrentFrame] = useState<number>(0);\n\n  const [loaded, setLoaded] = useState(false);\n\n  useEffect(() => {\n    (async () => {\n      const spritesheets = allSpritesheets.map(s => getSpritesheetPath(s));\n      for (const path of spritesheets) {\n        await loadResourceAsync(path);\n      }\n\n      setLoaded(true);\n    })();\n  });\n\n  if (!loaded) {\n    return (\n      <LoadingSpinner />\n    );\n  }\n\n  return (\n    <div className=\"debug-sprites\">\n      <div>\n        <select value={spritesheet} onChange={(e) => { setSelected(e.currentTarget.value as Spritesheet); }}>\n          {allSpritesheets.map(s => <option key={s}>{s}</option>)}\n        </select>\n        <select value={animation} onChange={(e) => { setAnimation(e.currentTarget.value as Animation); }}>\n          {allAnimations.map(a => <option key={a}>{a}</option>)}\n        </select>\n        <select value={orientation} onChange={(e) => { setOrientation(e.currentTarget.value as Orientation); }}>\n          {allOrientations.map(o => <option key={o}>{o}</option>)}\n        </select>\n        <input type=\"number\" value={currentFrame} onChange={(e) => setCurrentFrame(e.currentTarget.value as unknown as number)} />\n      </div>\n      <DebugSpriteDemo\n        spritesheetPath={getSpritesheetPath(spritesheet)}\n        animation={animation}\n        orientation={orientation}\n        currentFrame={currentFrame}\n      />\n    </div>\n  );\n};\n\nexport default DebugSprites;\n","import AdventurerAvatar from 'components/ui/adventurer/AdventurerAvatar';\nimport { IconSize } from 'components/ui/common/Icon';\nimport { TextManager } from 'global/TextManager';\nimport { useAdventurers } from 'hooks/store/adventurers';\nimport './styles/adventurersOverview.scss';\n\ntype Props = {\n  onSetSelectedId: (id: string) => void\n};\n\nconst AdventurersOverview = (props: Props) => {\n  const { onSetSelectedId } = props;\n  const adventurers = useAdventurers();\n\n  return (\n    <div className=\"adventurers-overview\">\n      {adventurers.map(a => (\n        <div className=\"adventurer\" key={a.id} onClick={() => onSetSelectedId(a.id)}>\n          <AdventurerAvatar adventurer={a} size={IconSize.biggest} />\n          <div className=\"name\">\n            {TextManager.getAdventurerName(a.id)}\n          </div>\n        </div>\n      ))}\n    </div>\n  );\n};\n\nexport default AdventurersOverview;\n","import { levelToXp, MAX_XP, xpToLevel } from 'mechanics/adventurers/levels';\n\ntype Props = {\n  xp: number;\n  onChange: (xp: number) => void\n};\n\nconst AdventurerXpInput = (props: Props) => {\n  const { xp, onChange } = props;\n  const level = xpToLevel(xp);\n  const nextXp = levelToXp(level + 1);\n  const progress = xp / nextXp;\n\n  return (\n    <div className=\"xp-input input\">\n      <input\n        type=\"number\"\n        min={0}\n        max={MAX_XP}\n        value={xp}\n        className=\"xp\"\n        onChange={(e) => onChange(Number(e.currentTarget.value) - xp)}\n      />\n      <div className=\"progress-mini-bg\">\n        <div \n          className=\"progress-mini-bar\" \n          style={{ width: `${progress * 100}%` }}\n        >\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default AdventurerXpInput;","import { Fragment } from 'react';\nimport { useDispatch } from 'react-redux';\nimport { TextManager } from 'global/TextManager';\nimport { MAX_VALUE, MIN_VALUE } from 'mechanics/adventurers/attributes';\nimport { Attribute, attributeList } from 'store/types/adventurer';\nimport { addXp, modifyHealth, renameAdventurer, setBasicAttributes } from 'store/actions/adventurers';\nimport { xpToLevel } from 'mechanics/adventurers/levels';\nimport { calculateBaseHitpoints } from 'mechanics/adventurers/hitpoints';\nimport { useAdventurer } from 'hooks/store/adventurers';\nimport AdventurerXpInput from './AdventurerXpInput';\nimport { formatNumber } from 'utils/format/number';\nimport AdventurerAvatar from 'components/ui/adventurer/AdventurerAvatar';\nimport { IconSize } from 'components/ui/common/Icon';\n\ntype Props = {\n  adventurerId: string;\n};\n\nconst DebugAdventurers = (props: Props) => {\n  const dispatch = useDispatch();\n  const { adventurerId } = props;\n  const adventurer = useAdventurer(adventurerId);\n  const { xp, basicAttributes, health } = adventurer;\n  const level = xpToLevel(xp);\n  const baseHP = calculateBaseHitpoints(level, basicAttributes.for);\n\n  const handleChangeAttribute = (attribute: Attribute, value: number) => {\n    dispatch(setBasicAttributes(adventurer.id, {\n      ...basicAttributes,\n      [attribute]: value,\n    }));\n  };\n\n  const renderAttribute = (attribute: Attribute) => {\n    return (\n      <Fragment key={attribute}>\n        <dt>\n          {TextManager.getAttributeName(attribute)}\n        </dt>\n        <dd>\n          <div className=\"slider\">\n            <input\n              type=\"range\"\n              min={MIN_VALUE}\n              max={MAX_VALUE}\n              value={basicAttributes[attribute]}\n              onChange={(e) => handleChangeAttribute(attribute, Number(e.currentTarget.value))}\n            />\n            <div className=\"value\">\n              ({basicAttributes[attribute]})\n            </div>\n          </div>\n        </dd>\n      </Fragment>\n    );\n  };\n\n  const handleRename = (e: React.ChangeEvent<HTMLInputElement>) => {\n    dispatch(renameAdventurer(adventurer.id, e.currentTarget.value));\n  };\n\n  const handleChangeHealth = (value: number) => {\n    dispatch(modifyHealth(adventurer.id, value));\n  };\n\n  const handleChangeXP = (value: number) => {\n    dispatch(addXp(adventurer.id, value));\n  };\n\n\n  return (\n    <div className=\"debug-adventurer-edit\">\n      <AdventurerAvatar adventurer={adventurer} size={IconSize.biggest} />\n      {TextManager.getAdventurerFlavor(adventurerId, adventurer.name)}\n      <fieldset>\n        <summary>General</summary>\n        <dl>\n          <dt>Name</dt>\n          <dd>\n            <div className=\"slider\">\n              <input\n                type=\"text\"\n                value={adventurer.name}\n                onChange={handleRename}\n              />\n            </div>\n          </dd>\n          <dt>XP</dt>\n          <dd>\n            <div className=\"slider\">\n              <AdventurerXpInput\n                xp={xp}\n                onChange={handleChangeXP}\n              />\n              <span className=\"info\">\n                (level {xpToLevel(xp)})\n              </span>\n            </div>\n          </dd>\n          <dt>Health</dt>\n          <dd>\n            <div className=\"slider\">\n              <input\n                type=\"range\"\n                min={0}\n                max={baseHP}\n                value={health}\n                onChange={(e) => handleChangeHealth(Number(e.currentTarget.value) - health)}\n                />\n              <span className=\"info value\">\n                ({formatNumber(health, 2)}/{formatNumber(baseHP, 2)})\n              </span>\n            </div>\n          </dd>\n        </dl>\n      </fieldset>\n      <fieldset>\n        <summary>Attributes</summary>\n        <dl>\n          {attributeList.map(a => renderAttribute(a))}\n        </dl>\n      </fieldset>\n    </div>\n  );\n};\n\nexport default DebugAdventurers;\n\n","import AdventurerAvatar from 'components/ui/adventurer/AdventurerAvatar';\nimport { IconSize } from 'components/ui/common/Icon';\nimport Select from 'components/ui/common/Select';\nimport { TextManager } from 'global/TextManager';\nimport { useAdventurers } from 'hooks/store/adventurers';\nimport { useMemo, useState } from 'react';\nimport { useSelector } from 'react-redux';\nimport { groupAdventurersByQuest } from 'store/selectors/adventurers';\nimport { StoreState } from 'store/types';\nimport { AdventurerStoreState } from 'store/types/adventurer';\nimport AdventurersOverview from './AdventurersOverview';\nimport DebugAdventurerEdit from './DebugAdventurerEdit';\nimport './styles/debugAdventurers.scss';\n\ninterface Options {\n  value: string;\n  label: string;\n}\n\nconst DebugAdventurers = () => {\n  const [selectedId, setSelectedId] = useState<string | null>();\n  const adventurers = useAdventurers();\n  const quests = useSelector((state: StoreState) => state.quests);\n\n  const items = useMemo(() => {\n    const groupedAdventurers = groupAdventurersByQuest(adventurers, quests);\n    return Object.keys(groupedAdventurers).map((groupKey: string) => {\n      const adventurersInGroup = groupedAdventurers[groupKey];\n      const title = groupKey === 'solo' ? 'solo' : TextManager.getQuestTitle(groupKey);\n      return {\n        label: title,\n        options: adventurersInGroup.map((adventurer: AdventurerStoreState) => ({\n          adventurer,\n          value: adventurer.id,\n          label: title,\n        }),\n        ),\n      };\n    });\n  }, [adventurers, quests]);\n\n  return (\n    <div className=\"debug-adventurers\">\n\n    <Select<Options, false>\n      className=\"adventurer-list\"\n      classNamePrefix=\"adventurer-list\"\n      placeholder={'Adventurers (grouped by quest)'}\n      onChange={(e) => setSelectedId(e?.value)}\n      formatGroupLabel={(data) => (\n        <div className=\"item-group\">\n          <div className=\"item-group-label\">{data.label}</div>\n          <div className=\"item-group-count\">{data.options.length} adventurers</div>\n        </div>\n      )}\n      formatOptionLabel={(option) => {\n        const adventurer = adventurers.find(a => a.id === option.value);\n        if (!adventurer) return null;\n        return (\n          <div className=\"item-option\">\n            <AdventurerAvatar adventurer={adventurer} size={IconSize.smallest} />\n            <div className=\"item-label\">\n              {adventurer.name}\n            </div>\n          </div>\n        );\n      }}\n      options={items} />\n      { selectedId && (\n        <DebugAdventurerEdit adventurerId={selectedId} />\n      )}\n      {! selectedId && (\n        <AdventurersOverview onSetSelectedId={setSelectedId} />\n      )}\n    </div>\n  );\n};\n\nexport default DebugAdventurers;\n\n","import { getDefinition as getStructureDefinition, Structure } from 'definitions/structures';\nimport { StructureState, StructureStoreState } from 'store/types/structure';\nimport { StructuresStoreState } from 'store/types/structures';\nimport { TextManager } from 'global/TextManager';\nimport { ToastManager } from 'global/ToastManager';\nimport { Type } from 'components/ui/toasts/Toast';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { setStructureState } from 'store/actions/structures';\nimport { StoreState } from 'store/types';\nimport './styles/debugContextTown.scss';\n\nconst DebugContextTown = () => {\n  const dispatch = useDispatch();\n  const structures = useSelector<StoreState, StructuresStoreState>(store => store.structures);\n\n  const onCheatStructureState = (structure: Structure, state: StructureState) => {\n    dispatch(setStructureState(structure, state));\n  };\n\n  const handleChangeStructureState = (structure: Structure, checked: boolean) => {\n    onCheatStructureState(structure, checked ? StructureState.Built : StructureState.NotBuilt);\n    if (checked) {\n      ToastManager.addToast(`The ${TextManager.getStructureName(structure)} is constructed`, Type.cheat);\n    } else {\n      ToastManager.addToast(`The ${TextManager.getStructureName(structure)} is not constructed`, Type.cheat);\n    }\n  };\n\n  const getStructureRow = (structure: Structure) => {\n    const structureDef = getStructureDefinition(structure);\n    const structureStore: StructureStoreState = structures[structure];\n    const levelDef = structureDef.levels[structureStore.level];\n\n    const displayName = TextManager.get(levelDef.displayName);\n\n    return (\n      <div\n        className=\"label-dropdown\"\n        key={structure}\n      >\n        <label title={structure}>\n          {`${displayName}`}\n        </label>\n        <input\n          key={structure}\n          type=\"checkbox\"\n          checked={structureStore.state === StructureState.Built}\n          onChange={() => handleChangeStructureState(structure, structureStore.state !== StructureState.Built)}\n        />\n      </div>\n    );\n  };\n  return (\n    <div className=\"debug-context-town\">\n    <h2>Structures</h2>\n      <div className=\"structures\">\n        { Object.keys(structures).map((structure) => getStructureRow(structure as Structure))}\n      </div>\n    </div>\n  );\n};\n\nexport default DebugContextTown;\n","import { useDispatch } from 'react-redux';\nimport './styles/debugContextTown.scss';\nimport { setSetting, SettingsKey } from 'store/actions/settings';\nimport { useSettings } from 'hooks/store/settings';\n\nconst DebugContextWorld = () => {\n  const settings = useSettings();\n  const dispatch = useDispatch();\n\n  const handleBooleanChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const setting = e.currentTarget.getAttribute('setting-name');\n    if (setting === null) throw new Error('No setting');\n    dispatch(setSetting(setting as SettingsKey, e.currentTarget.checked));\n  };\n\n  return (\n    <div className=\"debug-context-world\">\n      <h2>Scene</h2>\n      <section>\n        <p>\n          <label>Show pathable tiles</label>\n          <input\n            type=\"checkbox\"\n            checked={settings.debugSceneShowPathable}\n            setting-name=\"debugSceneShowPathable\"\n            onChange={handleBooleanChange}\n          />\n        </p>\n      </section>\n      <section>\n        <p>\n          <label>Show action queue tiles</label>\n          <input\n            type=\"checkbox\"\n            checked={settings.debugSceneShowActionQueue}\n            setting-name=\"debugSceneShowActionQueue\"\n            onChange={handleBooleanChange}\n          />\n        </p>\n      </section>\n      <section>\n        <p>\n          <label>Show cell locations</label>\n          <input\n            type=\"checkbox\"\n            checked={settings.debugSceneShowCellLocations}\n            setting-name=\"debugSceneShowCellLocations\"\n            onChange={handleBooleanChange}\n          />\n        </p>\n      </section>\n    </div>\n  );\n};\n\nexport default DebugContextWorld;\n","import { Route, Routes } from 'react-router-dom';\nimport { getTownLink, getWorldLink } from 'utils/routing';\nimport DebugContextTown from './DebugContextTown';\nimport DebugContextWorld from './DebugContextWorld';\nimport './styles/debugContext.scss';\n\nconst DebugContext = () => {\n\n  return (\n    <div className=\"debug-context\">\n       <Routes>\n        <Route path={getWorldLink()} element={(<DebugContextWorld />)} />\n        <Route path={getTownLink()} element={(<DebugContextTown />)} />\n      </Routes>\n    </div>\n  );\n};\n\nexport default DebugContext;\n","import { useState } from 'react';\nimport Button from 'components/ui/buttons/Button';\nimport DebugItems from '../DebugItems';\nimport DebugSprites from '../DebugSprites/DebugSprites';\nimport DebugAdventurers from '../DebugAdventurers';\nimport DebugContext from '../DebugContext/DebugContext';\nimport './styles/debugView.scss';\n\nconst allPages = ['context', 'items',  'sprites', 'adventurers'] as const;\ntype Page = typeof allPages[number];\n\nconst DebugView = () => {\n  const [page, setPage] = useState<Page>('context');\n\n  return (\n    <div className=\"debug\">\n      <ul className=\"menu\">\n        <li>\n          <Button onClick={() => setPage('context')} color={page === 'context' ? 'green' : 'blue'}> Context</Button>\n        </li>\n        <li>\n          <Button onClick={() => setPage('items')} color={page === 'items' ? 'green' : 'blue'}> Items</Button>\n        </li>\n        <li>\n          <Button onClick={() => setPage('sprites')} color={page === 'sprites' ? 'green' : 'blue'}> Sprites</Button>\n        </li>\n        <li>\n          <Button onClick={() => setPage('adventurers')} color={page === 'adventurers' ? 'green' : 'blue'}> Adventurers</Button>\n        </li>\n      </ul>\n      { page === 'context' && <DebugContext />}\n      { page === 'items' && <DebugItems />}\n      { page === 'sprites' && <DebugSprites />}\n      { page === 'adventurers' && <DebugAdventurers />}\n    </div>\n  );\n};\n\nexport default DebugView;\n","import { useState } from 'react';\nimport useKey from '@rooks/use-key';\nimport DebugView from './DebugView';\nimport { useSettings } from 'hooks/store/settings';\nimport './styles/debugDrawer.scss';\n\nconst DebugDrawer = () => {\n  const [open, setOpen] = useState(false);\n  const settings = useSettings();\n\n  useKey('~', () => {\n    setOpen(!open && settings.debugEnableDebugDrawer);\n  });\n\n  if (!open) return null;\n  return (\n    <div className=\"debug-drawer\">\n      <div className=\"close\" onClick={() => setOpen(false)}>x</div>\n      <DebugView />\n    </div>\n  );\n};\n\nexport default DebugDrawer;\n\n","import { useCallback, useEffect, useRef, useState } from 'react';\nimport { Provider as StoreProvider } from 'react-redux';\nimport { Store, AnyAction, DeepPartial } from 'redux';\nimport { Persistor } from 'redux-persist';\nimport { PersistPartial } from 'redux-persist/es/persistReducer';\nimport { gameTick, ignoreVersionDiff, startGame } from 'store/actions/game';\nimport { addLogText } from 'store/actions/log';\nimport * as Version from 'constants/version';\nimport getProducedResources from 'mechanics/gameTick/producedResources';\nimport getQuestUpdates, { LogUpdate } from 'mechanics/gameTick/quests';\nimport getRngState from 'mechanics/gameTick/rngState';\nimport configureStore from 'utils/configureStore';\nimport { processCompletedTasks } from 'mechanics/gameTick/tasks';\nimport { StoreState } from 'store/types';\nimport { createInitialStore } from 'store/reducers';\nimport getHarvest from 'mechanics/gameTick/harvest';\nimport { convertIntToSemVer } from 'utils/version';\nimport { loadGame } from 'store/actions/game';\nimport LoadingSpinner from 'components/ui/loading/LoadingSpinner';\nimport { PersistGate } from 'redux-persist/integration/react';\nimport App from 'components/App';\nimport { GameActionsContext } from './context';\n\nconst TICK_INTERVAL = 2500; // main game tick\n\n\nconst Game = () => {\n  const paused = useRef(false);\n  const [store, setStore] = useState<Store<StoreState & PersistPartial, AnyAction>>();\n  const [persistor, setPersistor] = useState<Persistor>();\n\n  /**\n   * Gets called when a player starts a new game\n   * @param store\n   */\n  const startNewGame = useCallback(() => {\n    store?.dispatch(startGame());\n    store?.dispatch(addLogText('test-game-welcome'));\n    // todo: here is a good place to launch a tutorial or something\n\n    console.log(`Starting new GAME (version ${Version.default})`);\n  }, [store]);\n\n  /**\n   * Attemps to read persisted store state. Sets `store` state when done */\n  const setupStore = useCallback(async (initial: DeepPartial<StoreState> = {}) => {\n    const configuration = await configureStore(initial);\n\n    if (!configuration.isHydrated) {\n      startNewGame();\n    }\n    setStore(configuration.store);\n    setPersistor(configuration.persistor);\n  }, [startNewGame]);\n\n  /**\n   * Puts loads the game with a fresh empty store */\n  const restartGame = useCallback(() => {\n    if (window.confirm('Are you sure you wish to reset all your progress?')){\n      const newState = createInitialStore();\n      store?.dispatch(loadGame(newState));\n      startNewGame();\n    }\n  }, [startNewGame, store]);\n\n  /**\n   * Whenever store changes\n   * Will kick off the main game loop.  */\n  useEffect(() => {\n    let interval: NodeJS.Timeout;\n    if (!store) return;\n    try {\n      const gameVersion = store.getState().game?.version;\n      if (gameVersion < Version.asInt && store.getState().game?.ignoreVersionDiff !== Version.asInt) {\n        if (!window.confirm(`This game was initialized with version ${convertIntToSemVer(gameVersion)} which is older than the current client (${Version.default}). This might cause problems. Continue anyway? \\n\\n(pressing cancel will reset progress) `)) {\n          restartGame();\n          return;\n        }\n        store.dispatch(ignoreVersionDiff());\n      }\n\n      const gameLoop = () => {\n        if (paused.current) return;\n\n        const state: StoreState = store.getState();\n        const delta = Date.now() - state.engine.lastTick;\n\n        const logs: LogUpdate[] = [];\n        const resourcesUpdates = getProducedResources(state.engine.lastProducedUpdate, state);\n        const harvestUpdates = getHarvest(state);\n        const rngState = getRngState();\n        const { questUpdates, logUpdates } = getQuestUpdates(delta, store);\n        logs.push(...logUpdates);\n\n        store.dispatch(gameTick(delta, rngState, resourcesUpdates, questUpdates, harvestUpdates, logs));\n\n        processCompletedTasks(state.tasks, store.dispatch);\n      };\n\n      interval = setInterval(gameLoop, TICK_INTERVAL);\n    } catch (e) {\n      console.warn(e);\n    }\n    return () => {\n      clearInterval(interval);\n    };\n  }, [restartGame, store]);\n\n  const pauseGame = useCallback(() => {\n    paused.current = true;\n  }, []);\n\n  const continueGame = useCallback(() => {\n    paused.current = false;\n  }, []);\n\n\n  useEffect(() => {\n    if (!store) {\n      // Initial bootup\n      setupStore();\n    }\n  }, [setupStore, store]);\n\n  if (!store || !persistor) {\n    return <LoadingSpinner />;\n  }\n  return (\n    <GameActionsContext.Provider value={{\n      pauseGame,\n      continueGame,\n      restartGame,\n    }}>\n\n      <StoreProvider store={store}>\n        <PersistGate loading={null} persistor={persistor}>\n          <App />\n        </PersistGate>\n      </StoreProvider>\n    </GameActionsContext.Provider>\n  );\n};\n\nexport default Game;\n\n","import localforage from 'localforage';\nimport { useEffect, useState } from 'react';\nimport { FallbackProps } from 'react-error-boundary';\nimport { getStoredState } from 'redux-persist';\nimport { persistConfig } from 'utils/configureStore';\nimport { InfoWindow } from '../modals/InfoWindow';\nimport Tab from '../tabs/Tab';\nimport Tabstrip from '../tabs/Tabstrip';\nimport './styles/errorModal.scss';\n\nconst ErrorModal = (props: FallbackProps) => {\n  const { error } = props;\n  const [selectedTabId, setSelectedTabId] = useState<'stack' | 'store'>('stack');\n  const [state, setState] = useState<string>('(no store state found)');\n\n  useEffect(() => {\n    (async () => {\n      const initState = await getStoredState(persistConfig);\n      setState(JSON.stringify(initState, undefined, 2));\n    })();\n  });\n\n  // if (process.env.NODE_ENV !== \"production\") {\n  //   resetErrorBoundary();\n  //   return null;\n  // }\n\n  const handleTabSelected = (tabId: typeof selectedTabId) => {\n    setSelectedTabId(tabId);\n  };\n\n  const handleReset = () => {\n    localforage.clear();\n    window.location.reload();\n    // restartGame();\n  };\n\n\n  return (\n    <div className=\"error\">\n      <InfoWindow className=\"error-modal\" title=\"\">\n        <h2 className=\"title\" >\n          Something went horribly wrong\n          <a href={`${process.env.PUBLIC_URL}`} className=\"close\">x</a>\n        </h2>\n        <div className=\"content\">\n          <pre>{error.message}</pre>\n\n        <Tabstrip className=\"tabs\" onTabSelected={handleTabSelected} activeTab={selectedTabId}>\n          <Tab id={'stack'}>Stack</Tab>\n          <Tab id={'store'}>Store</Tab>\n        </Tabstrip>\n        { selectedTabId === 'stack' && (\n          <pre>{error.stack}</pre>\n        )}\n        { selectedTabId === 'store' && (\n          <pre>{state}</pre>\n        )}\n        <form action=\"https://formspree.io/f/mayvnnbp\" method=\"POST\" className=\"buttons\">\n          <input type=\"hidden\" name=\"message\" value={error.message} />\n          <input type=\"hidden\" name=\"stack\" value={error.stack} />\n          <input type=\"hidden\" name=\"store\" value={state} />\n          <button type=\"reset\" onClick={handleReset}>Reset game</button>\n          <button type=\"submit\">Report bug</button>\n        </form>\n      </div>\n      </InfoWindow>\n    </div>\n  );\n};\n\nexport default ErrorModal;\n","import { createRoot } from 'react-dom/client';\nimport registerServiceWorker from './registerServiceWorker';\nimport * as Random from './utils/random';\nimport { TextManager } from './global/TextManager';\nimport { loadResourceAsync } from 'utils/pixiJs';\nimport { ErrorBoundary } from 'react-error-boundary';\nimport Game from 'components/Game';\nimport ErrorModal from 'components/ui/error/ErrorModal';\nimport './index.css';\n\nconst initialize = async () => {\n  registerServiceWorker();\n  const texts = await loadResourceAsync(`${process.env.PUBLIC_URL}/lang/en.json`);\n  if (texts) {\n    TextManager.init(texts.data);\n  }\n  Random.init('GILLESROX2');\n\n  const root = createRoot(document.getElementById('root')  as HTMLElement);\n  root.render((\n    <ErrorBoundary FallbackComponent={ErrorModal} >\n      <Game />\n    </ErrorBoundary>\n  ));\n};\n\ninitialize();\n\n"],"sourceRoot":""}